var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
import './index-ee0e95b8.js';
import { p as process } from './events-a71dfb91.js';
import { B as Buffer } from './buffer-es6-4f6a9935.js';
function e(t, a) { if (!e.watchedElementData) {
    e.watchedElementData = [];
    var t_1 = function () { e.watchedElementData.forEach((function (e) { e.element.offsetWidth === e.offsetWidth && e.element.offsetHeight === e.offsetHeight || (e.offsetWidth = e.element.offsetWidth, e.offsetHeight = e.element.offsetHeight, e.callback()); })); };
    window.addEventListener("resize", t_1), new MutationObserver(t_1).observe(document.body, { attributes: !0, childList: !0, characterData: !0, subtree: !0 });
} e.watchedElementData.push({ element: t, offsetWidth: t.offsetWidth, offsetHeight: t.offsetHeight, callback: a }); }
var t = function () { var e = null != (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i) || navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Pixel/i) || navigator.userAgent.match(/Windows Phone/i)), t = function () { var e = navigator.userAgent; var t, a, i, s = navigator.appName, n = "" + parseFloat(navigator.appVersion), l = parseInt(navigator.appVersion, 10); return -1 != (a = e.indexOf("Opera")) ? (s = "Opera", n = e.substring(a + 6), -1 != (a = e.indexOf("Version")) && (n = e.substring(a + 8))) : -1 != (a = e.indexOf("MSIE")) ? (s = "Microsoft Internet Explorer", n = e.substring(a + 5)) : -1 != (a = e.indexOf("Edge")) ? (s = "Edge", n = e.substring(a + 4)) : -1 != (a = e.indexOf("Chrome")) ? (s = "Chrome", n = e.substring(a + 7)) : -1 != (a = e.indexOf("Safari")) ? (s = "Safari", n = e.substring(a + 7), -1 != (a = e.indexOf("Version")) && (n = e.substring(a + 8))) : -1 != (a = e.indexOf("Firefox")) ? (s = "Firefox", n = e.substring(a + 8)) : (t = e.lastIndexOf(" ") + 1) < (a = e.lastIndexOf("/")) && (s = e.substring(t, a), n = e.substring(a + 1), s.toLowerCase() == s.toUpperCase() && (s = navigator.appName)), -1 != (i = n.indexOf(";")) && (n = n.substring(0, i)), -1 != (i = n.indexOf(" ")) && (n = n.substring(0, i)), l = parseInt("" + n, 10), isNaN(l) && (n = "" + parseFloat(navigator.appVersion), l = parseInt(navigator.appVersion, 10)), { browserName: s, fullVersion: n, majorVersion: l, appName: navigator.appName, userAgent: navigator.userAgent }; }(), a = function () { var e, t; try {
    e = document.createElement("canvas").getContext("webgl");
}
catch (e) { } if (!e)
    return; try {
    t = document.createElement("canvas").getContext("webgl2");
}
catch (e) { } var a = e.getExtension("WEBGL_debug_renderer_info"), i = e.getParameter(a.UNMASKED_VENDOR_WEBGL), s = e.getParameter(a.UNMASKED_RENDERER_WEBGL), n = e.getParameter(e.MAX_TEXTURE_SIZE); var l; return s.match(/NVIDIA/i) ? l = "NVidia" : s.match(/AMD/i) || s.match(/Radeon/i) ? l = "AMD" : s.match(/Intel/i) ? l = "Intel" : s.match(/Mali/i) ? l = "ARM" : s.match(/Adreno/i) ? l = "Adreno" : console.warn("Unable to determine GPU vendor:", s), { vendor: i, renderer: s, gpuVendor: l, maxTextureSize: n, supportsWebGL2: null != t }; }(); var i = "Low"; if (a)
    if (e)
        i = "Low";
    else {
        var e_1 = a.renderer.replace(/[()]/g, "").split(" ");
        if ("NVidia" == a.gpuVendor) {
            var t_2 = e_1.indexOf("GTX");
            if (-1 != t_2) {
                var a_1 = e_1[t_2 + 1];
                if (a_1.endsWith("M")) {
                    i = parseInt(a_1.substring(0, a_1.length - 2)) >= 900 ? "Medium" : "Low";
                }
                else {
                    i = parseInt(a_1) >= 1030 ? "High" : "Medium";
                }
            }
            else
                i = -1 != e_1.indexOf("TITAN") || -1 != e_1.indexOf("Quadro") ? "High" : "Low";
        }
        else if ("AMD" == a.gpuVendor) {
            var t_3 = e_1.indexOf("Radeon");
            if (-1 != t_3) {
                var a_2 = e_1.indexOf("RX");
                if (-1 != a_2)
                    if ("Vega" == e_1[a_2 + 1])
                        i = "High";
                    else {
                        var t_4 = e_1[a_2 + 1];
                        var s = void 0;
                        t_4.endsWith("X") ? (s = parseInt(t_4.substring(0, t_4.length - 2)), i = "High") : s = parseInt(t_4), i = s >= 480 ? "High" : "Medium";
                    }
                else if ("Pro" == e_1[t_3 + 1]) {
                    i = parseInt(e_1[a_2 + 1]) >= 450 ? "Medium" : "Low";
                }
                else if ("Sky" == e_1[t_3 + 1]) {
                    i = parseInt(e_1[a_2 + 1]) >= 700 ? "Medium" : "Low";
                }
                else
                    i = "Low";
            }
            else
                i = -1 != e_1.indexOf("FirePro") || -1 != e_1.indexOf("Quadro") ? "High" : "Low";
        }
        else
            ("Adreno" == a.gpuVendor || "Intel" == a.gpuVendor) && (i = "Low");
    } return { isMobileDevice: e, isIOSDevice: null != (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/iPod/i)), browserName: t.browserName, fullVersion: t.fullVersion, majorVersion: t.majorVersion, appName: t.appName, userAgent: t.userAgent, webGLSupported: null != a, gpuDesc: a, deviceCategory: i }; }();
var a = Object.freeze({ __proto__: null, SystemDesc: t });
var i = Math.PI / 180;
Math.HALF_PI = .5 * Math.PI, Math.TWO_PI = 2 * Math.PI;
Math.radToDeg = function (e) { return e / i; }, Math.degToRad = function (e) { return e * i; }, Number.isNumeric = function (e) { return !isNaN(parseFloat(e)) && isFinite(e); }, String.prototype.replaceAll = function (e, t) { return this.replace(new RegExp(e, "g"), t); };
var m = function (e) { var t, a, i, s = 0; if (0 === e.length)
    return s; for (t = 0, i = e.length; t < i; t++)
    a = e.charCodeAt(t), s = (s << 5) - s + a, s |= 0; return Math.abs(s); };
function u(e, t, a) {
    if (t === void 0) { t = 0; }
    if (a === void 0) { a = 5; }
    return JSON.stringify(e, (function (e, t) { return t && t.toFixed ? Number(t.toFixed(a)) : t; }), t);
}
String.prototype.hash = function () { return m(this); }, String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, ""); }, String.prototype.ltrim = function () { return this.replace(/^\s+/, ""); }, String.prototype.rtrim = function () { return this.replace(/\s+$/, ""); }, String.prototype.lpad = function (e, t) { var a = this; for (; a.length < t;)
    a = e + a; return a; }, String.prototype.rpad = function (e, t) { var a = this; for (; a.length < t;)
    a += e; return a; }, Math.randomInt = function (e, t) { return e = Math.ceil(e), t = Math.floor(t), Math.floor(Math.random() * (t - e)) + e; }, Math.lerp = function (e, t, a) { return e + a * (t - e); }, Math.clamp = function (e, t, a) { return Math.min(Math.max(e, t), a); }, Math.nearestPow2 = function (e) { return Math.pow(2, Math.round(Math.log(e) / Math.log(2))); }, Math.nearestPow10 = function (e) { return Math.pow(10, Math.round(Math.log10(e) / Math.log10(10))); }, Math.nextPow2 = function (e) { var t = 0; for (; e > 0;)
    t++, e >>= 1; return 1 << t; }, Math.fract = function (e) { return 0 == e ? 0 : e < 0 ? e > -1 ? -e : -e % Math.floor(-e) : e < 1 ? e : e % Math.floor(e); }, Math.remap = function (e, t, a, i, s) { return i + (e - t) / (a - t) * (s - i); }, Math.convertFloat32ArrayToUInt16Array = function (e) { var t = new Uint16Array(e.length), a = new Int32Array(e.buffer), i = function (e) { var t = e >> 16 & 32768, a = e >> 12 & 2047; var i = e >> 23 & 255; return i < 103 ? t : i > 142 ? (t |= 31744, t |= (255 == i ? 0 : 1) && 8388607 & e, t) : i < 113 ? (a |= 2048, t |= (a >> 114 - i) + (a >> 113 - i & 1), t) : (t |= i - 112 << 10 | a >> 1, t += 1 & a, t); }; for (var s = 0; s < e.length; s++)
    t[s] = i(a[s]); return t; }, Math.decode16BitFloatFrom2xUInt8 = function (e) { var t = e[0], a = (120 & t) >> 3; var i = 0 == a ? 0 : 2048; var s = i + ((7 & t) << 8) + e[1]; return i = 0 == a ? 1 : 0, (128 & t ? 1 : -1) * s * Math.pow(2, a + i - 16); }, Math.encode16BitFloatInto2xUInt8 = function (e) { c || (c = new Uint8Array(2)); var t = e >= 0 ? 128 : 0; e = Math.abs(e); var a, i = 15, s = 1024; for (var t_5 = 15; t_5 > 0; t_5--)
    e < s && (s /= 2, i--); a = 0 == i ? e / s / 2 : (e - s) / s; var n = Math.round(2048 * a), l = n / 256, r = n - 256 * l; return c[0] = t + 8 * i + l, c[1] = r, e >= 2048 && (c[0] = 255), c; }, Math.encode16BitFloat = function (e) { var t = new Float32Array(1); t[0] = e; return (function (e) { var t = e >> 16 & 32768, a = e >> 12 & 2047; var i = e >> 23 & 255; return i < 103 ? t : i > 142 ? (t |= 31744, t |= (255 == i ? 0 : 1) && 8388607 & e, t) : i < 113 ? (a |= 2048, t |= (a >> 114 - i) + (a >> 113 - i & 1), t) : (t |= i - 112 << 10 | a >> 1, t += 1 & a, t); })(new Int32Array(t.buffer)[0]); }, Math.decode16BitFloat = function (e) { var t = (32768 & e) >> 15, a = (31744 & e) >> 10, i = 1023 & e; return 0 == a ? (t ? -1 : 1) * Math.pow(2, -14) * (i / Math.pow(2, 10)) : 31 == a ? i ? NaN : 1 / 0 * (t ? -1 : 1) : (t ? -1 : 1) * Math.pow(2, a - 15) * (1 + i / Math.pow(2, 10)); }, Math.smoothStep = function (e, t, a) { var i = Math.clamp((a - e) / (t - e), 0, 1); return i * i * (3 - 2 * i); }, Math.linStep = function (e, t, a) { return Math.clamp((a - e) / (t - e), 0, 1); };
var p = /** @class */ (function () {
    function p() {
    }
    p.prototype.isValid = function () { for (var _b = 0, _c = this.__data; _b < _c.length; _b++) {
        var e_2 = _c[_b];
        if (e_2 == 1 / 0 || isNaN(e_2))
            return !1;
    } return !0; };
    p.createFromFloat32Buffer = function (e, t) { throw new Error("Not yet implemented for this type:" + this.constructor.name); };
    p.numElements = function () { throw new Error("Not yet implemented for this type:" + this.constructor.name); };
    p.prototype.asArray = function () { return this.__data; };
    p.prototype.toString = function () { return u(this.toJSON()); };
    return p;
}());
var g = new /** @class */ (function () {
    function class_1() {
        this.__types = {}, this.__names = {}, this.registerType("SInt32", 5), this.registerType("UInt32", 4), this.registerType("Float32", 6);
    }
    class_1.prototype.registerType = function (e, t) { this.__types[e] = t, t.name ? this.__names[t.name] = e : this.__names[t] = e; };
    class_1.prototype.getType = function (e) { return this.__types[e]; };
    class_1.prototype.getTypeName = function (e) { if (this.__names[e])
        return this.__names[e]; if (this.__names[e.name])
        return this.__names[e.name]; throw e; };
    return class_1;
}());
var _ = /** @class */ (function (_super) {
    __extends(_, _super);
    function _(e, t) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof Float32Array || e instanceof Uint32Array || e instanceof Int32Array)
            _this.__data = e;
        else if (e instanceof ArrayBuffer) {
            var a_3 = e, i_1 = t;
            _this.__data = new Float32Array(a_3, i_1, 2);
        }
        else
            null != e && "object" == typeof e ? (_this.__data = new Float32Array(2), _this.fromJSON(e)) : (_this.__data = new Float32Array(2), _this.__data[0] = e, _this.__data[1] = t);
        return _this;
    }
    Object.defineProperty(_.prototype, "x", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(_.prototype, "y", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    _.prototype.set = function (e, t) { this.__data[0] = e, this.__data[1] = t; };
    _.prototype.setFromOther = function (e) { this.x = e.x, this.y = e.y; };
    _.prototype.equal = function (e) { return this.x == e.x && this.y == e.y; };
    _.prototype.notEquals = function (e) { return this.x != e.x && this.y != e.y; };
    _.prototype.approxEqual = function (e, t) {
        if (t === void 0) { t = Number.EPSILON; }
        return Math.abs(this.x - e.x) < t && Math.abs(this.y - e.y) < t;
    };
    _.prototype.add = function (e) { return new _(this.x + e.x, this.y + e.y); };
    _.prototype.addInPlace = function (e) { this.x += e.x, this.y += e.y; };
    _.prototype.subtract = function (e) { return new _(this.x - e.x, this.y - e.y); };
    _.prototype.subtractInPlace = function (e) { return this.x -= e.x, this.y -= e.y, this; };
    _.prototype.scale = function (e) { return new _(this.x * e, this.y * e); };
    _.prototype.scaleInPlace = function (e) { this.x *= e, this.y *= e; };
    _.prototype.invert = function () { return new _(1 / this.x, 1 / this.y); };
    _.prototype.invertInPlace = function () { return this.x = 1 / this.x, this.y = 1 / this.y, this; };
    _.prototype.multiply = function (e) { return new _(this.x * e.x, this.y * e.y); };
    _.prototype.multiplyInPlace = function (e) { this.x *= e.x, this.y *= e.y; };
    _.prototype.lengthSquared = function () { var e = this.__data[0], t = this.__data[1]; return e * e + t * t; };
    _.prototype.length = function () { return Math.sqrt(this.lengthSquared()); };
    _.prototype.distanceTo = function (e) { var t = this.__data[0] - e.x, a = this.__data[1] - e.y; return Math.sqrt(t * t + a * a); };
    _.prototype.normalize = function () { var e = this.__data[0], t = this.__data[1]; var a = e * e + t * t; return a < Number.EPSILON ? new _ : (a = 1 / Math.sqrt(a), new _(e * a, t * a)); };
    _.prototype.normalizeInPlace = function () { var e = this.__data[0], t = this.__data[1]; var a = e * e + t * t; a < Number.EPSILON || (a = 1 / Math.sqrt(a), this.set(e * a, t * a)); };
    _.prototype.dot = function (e) { return this.x * e.x + this.y * e.y; };
    _.prototype.cross = function (e) { return this.x * e.y - this.y * e.x; };
    _.prototype.angleTo = function (e) { var t = this.normalize().dot(e.normalize()); return t > 1 ? 0 : t < -1 ? Math.PI : Math.acos(t); };
    _.prototype.signedAngleTo = function (e) { var t = this.angleTo(e); return this.cross(e) < 0 ? -t : t; };
    _.prototype.rotate = function (e) { var t = Math.cos(e), a = Math.sin(e); return new _(this.x * t - this.y * a, this.x * a + this.y * t); };
    _.prototype.lerp = function (e, t) { var a = this.x, i = this.y; return new _(a + t * (e.x - a), i + t * (e.y - i)); };
    _.prototype.setRandomDir = function (e) {
        if (e === void 0) { e = 1; }
        var t = 2 * Math.random() * Math.PI;
        return this.__data[0] = Math.cos(t) * zScale, this.__data[1] = Math.sin(t) * zScale, this;
    };
    _.prototype.setRandom = function (e) {
        if (e === void 0) { e = 1; }
        return this.__data[0] = Math.random() * e, this.__data[1] = Math.random() * e, this;
    };
    _.prototype.clone = function () { return new _(this.__data[0], this.__data[1]); };
    _.prototype.asArray = function () { return this.__data; };
    _.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (_.bind.apply(_, __spreadArrays([void 0], e)))();
    };
    _.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new _(e, 4 * t);
    };
    _.createFromFloat32Array = function (e) { return new _(e); };
    _.numElements = function () { return 2; };
    _.prototype.toJSON = function () { return { x: this.x, y: this.y }; };
    _.prototype.fromJSON = function (e) { this.x = e.x, this.y = e.y; };
    return _;
}(p));
g.registerType("Vec2", _);
var Z = /** @class */ (function (_super) {
    __extends(Z, _super);
    function Z(e, t, a) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof Float32Array || e instanceof Uint32Array)
            _this.__data = e;
        else if (e instanceof ArrayBuffer) {
            var a_4 = e, i_2 = t;
            _this.__data = new Float32Array(a_4, i_2, 3);
        }
        else
            null != e && "object" == typeof e ? (_this.__data = new Float32Array(3), _this.fromJSON(e)) : (_this.__data = new Float32Array(3), _this.__data[0] = e, _this.__data[1] = t, _this.__data[2] = a);
        return _this;
    }
    Object.defineProperty(Z.prototype, "x", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Z.prototype, "y", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Z.prototype, "z", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Z.prototype, "xy", {
        get: function () { return new _(this.__data[0], this.__data[1]); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Z.prototype, "yz", {
        get: function () { return new _(this.__data[1], this.__data[2]); },
        enumerable: true,
        configurable: true
    });
    Z.prototype.set = function (e, t, a) { this.x = e, this.y = void 0 !== t ? t : e, this.z = void 0 !== a ? a : e; };
    Z.prototype.setDataArray = function (e) { this.__data = e; };
    Z.prototype.setFromOther = function (e) { this.x = e.x, this.y = e.y, this.z = e.z; };
    Z.prototype.isNull = function () { return Math.abs(this.x) < Number.EPSILON && Math.abs(this.y) < Number.EPSILON && Math.abs(this.z) < Number.EPSILON; };
    Z.prototype.is111 = function () { return Math.abs(1 - this.x) < Number.EPSILON && Math.abs(1 - this.y) < Number.EPSILON && Math.abs(1 - this.z) < Number.EPSILON; };
    Z.prototype.equal = function (e) { return this.x == e.x && this.y == e.y && this.z == e.z; };
    Z.prototype.notEquals = function (e) { return this.x != e.x && this.y != e.y && this.z != e.z; };
    Z.prototype.approxEqual = function (e, t) {
        if (t === void 0) { t = Number.EPSILON; }
        return Math.abs(this.x - e.x) < t && Math.abs(this.y - e.y) < t && Math.abs(this.z - e.z) < t;
    };
    Z.prototype.add = function (e) { return new Z(this.x + e.x, this.y + e.y, this.z + e.z); };
    Z.prototype.addInPlace = function (e) { this.x += e.x, this.y += e.y, this.z += e.z; };
    Z.prototype.subtract = function (e) { return new Z(this.x - e.x, this.y - e.y, this.z - e.z); };
    Z.prototype.subtractInPlace = function (e) { this.x -= e.x, this.y -= e.y, this.z -= e.z; };
    Z.prototype.multiply = function (e) { return new Z(this.x * e.x, this.y * e.y, this.z * e.z); };
    Z.prototype.multiplyInPlace = function (e) { this.x *= e.x, this.y *= e.y, this.z *= e.z; };
    Z.prototype.divide = function (e) { return new Z(this.x / e.x, this.y / e.y, this.z / e.z); };
    Z.prototype.divideInPlace = function (e) { this.x /= e.x, this.y /= e.y, this.z /= e.z; };
    Z.prototype.scale = function (e) { return new Z(this.x * e, this.y * e, this.z * e); };
    Z.prototype.scaleInPlace = function (e) { this.x *= e, this.y *= e, this.z *= e; };
    Z.prototype.negate = function () { return new Z(-this.x, -this.y, -this.z); };
    Z.prototype.inverse = function () { return new Z(1 / this.x, 1 / this.y, 1 / this.z); };
    Z.prototype.lengthSquared = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2]; return e * e + t * t + a * a; };
    Z.prototype.length = function () { return Math.sqrt(this.lengthSquared()); };
    Z.prototype.distanceTo = function (e) { var t = this.__data[0] - e.x, a = this.__data[1] - e.y, i = this.__data[2] - e.z; return Math.sqrt(t * t + a * a + i * i); };
    Z.prototype.normalize = function () { var e = this.__data[0] * this.__data[0] + this.__data[1] * this.__data[1] + this.__data[2] * this.__data[2]; return e < Number.EPSILON ? new Z : (e = 1 / Math.sqrt(e), new Z(this.__data[0] * e, this.__data[1] * e, this.__data[2] * e)); };
    Z.prototype.normalizeInPlace = function () { var e = this.__data[0] * this.__data[0] + this.__data[1] * this.__data[1] + this.__data[2] * this.__data[2]; if (e < Number.EPSILON)
        return; e = Math.sqrt(e); var t = 1 / e; return this.__data[0] *= t, this.__data[1] *= t, this.__data[2] *= t, e; };
    Z.prototype.resize = function (e) { var t = this.__data[0] * this.__data[0] + this.__data[1] * this.__data[1] + this.__data[2] * this.__data[2]; if (t < Number.EPSILON)
        return; var a = e / Math.sqrt(t); return new Z(this.__data[0] * a, this.__data[1] * a, this.__data[2] * a); };
    Z.prototype.resizeInPlace = function (e) { var t = this.__data[0] * this.__data[0] + this.__data[1] * this.__data[1] + this.__data[2] * this.__data[2]; if (t < Number.EPSILON)
        return; var a = e / Math.sqrt(t); this.__data[0] *= a, this.__data[1] *= a, this.__data[2] *= a; };
    Z.prototype.dot = function (e) { return this.x * e.x + this.y * e.y + this.z * e.z; };
    Z.prototype.cross = function (e) { var t = this.x, a = this.y, i = this.z, s = e.x, n = e.y, l = e.z; return new Z(a * l - i * n, i * s - t * l, t * n - a * s); };
    Z.prototype.angleTo = function (e) { var t = this.dot(e); return t > 1 ? 0 : Math.acos(t); };
    Z.prototype.lerp = function (e, t) { var a = this.x, i = this.y, s = this.z; return new Z(a + t * (e.x - a), i + t * (e.y - i), s + t * (e.z - s)); };
    Z.prototype.abs = function () { return new Z(Math.abs(this.x), Math.abs(this.y), Math.abs(this.z)); };
    Z.prototype.setRandomDir = function (e) {
        if (e === void 0) { e = 1; }
        var t = 2 * Math.random() * Math.PI, a = 2 * Math.random() - 1, i = Math.sqrt(1 - a * a) * e;
        return this.__data[0] = Math.cos(t) * i, this.__data[1] = Math.sin(t) * i, this.__data[2] = a * e, this;
    };
    Z.prototype.setRandom = function (e) {
        if (e === void 0) { e = 1; }
        return this.__data[0] = (Math.random() - .5) * e, this.__data[1] = (Math.random() - .5) * e, this.__data[2] = (Math.random() - .5) * e, this;
    };
    Z.prototype.clone = function () { return new Z(this.__data[0], this.__data[1], this.__data[2]); };
    Z.prototype.asArray = function () { return this.__data; };
    Z.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (Z.bind.apply(Z, __spreadArrays([void 0], e)))();
    };
    Z.createFromJSON = function (e) { var t = new Z; return t.fromJSON(e), t; };
    Z.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new Z(e, 4 * t);
    };
    Z.createFromFloat32Array = function (e) { return new Z(e); };
    Z.numElements = function () { return 3; };
    Z.prototype.toJSON = function () { return { x: this.x, y: this.y, z: this.z }; };
    Z.prototype.fromJSON = function (e) { this.x = e.x, this.y = e.y, this.z = e.z; };
    return Z;
}(p));
g.registerType("Vec3", Z);
var G = /** @class */ (function (_super) {
    __extends(G, _super);
    function G(e, t, a, i) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 0; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof ArrayBuffer) {
            var a_5 = e, i_3 = t;
            _this.__data = new Float32Array(a_5, i_3, 4);
        }
        else
            null != e && "object" == typeof e ? (_this.__data = new Float32Array(4), _this.fromJSON(e)) : (_this.__data = new Float32Array(4), _this.__data[0] = e, _this.__data[1] = t, _this.__data[2] = a, _this.__data[3] = i);
        return _this;
    }
    Object.defineProperty(G.prototype, "x", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(G.prototype, "y", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(G.prototype, "z", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(G.prototype, "t", {
        get: function () { return this.__data[3]; },
        set: function (e) { this.__data[3] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(G.prototype, "xyz", {
        get: function () { return new Z(this.__data[0], this.__data[1], this.__data[2]); },
        enumerable: true,
        configurable: true
    });
    G.prototype.set = function (e, t, a, i) { this.x = e, this.y = t, this.z = a, this.t = i; };
    G.prototype.setFromOther = function (e) { this.x = e.x, this.y = e.y, this.z = e.z, this.t = e.t; };
    G.prototype.equal = function (e) { return this.x == e.x && this.y == e.y && this.z == e.z && this.t == e.t; };
    G.prototype.notEquals = function (e) { return this.x != e.x && this.y != e.y && this.z != e.z && this.t != e.t; };
    G.prototype.approxEqual = function (e, t) {
        if (t === void 0) { t = Number.EPSILON; }
        return Math.abs(this.x - e.x) < t && Math.abs(this.y - e.y) < t && Math.abs(this.z - e.z) < t && Math.abs(this.t - e.t) < t;
    };
    G.prototype.add = function (e) { return new G(this.x + e.x, this.y + e.y, this.z + e.z, this.t + e.t); };
    G.prototype.addInPlace = function (e) { this.x += e.x, this.y += e.y, this.z += e.z, this.t += e.t; };
    G.prototype.subtract = function (e) { return new G(this.x - e.x, this.y - e.y, this.z - e.z, this.t - e.t); };
    G.prototype.subtractInPlace = function (e) { this.x -= e.x, this.y -= e.y, this.z -= e.z, this.t -= e.t; };
    G.prototype.multiply = function (e) { return new G(this.x * e.x, this.y * e.y, this.z * e.z, this.t * e.t); };
    G.prototype.multiplyInPlace = function (e) { this.x *= e.x, this.y *= e.y, this.z *= e.z, this.t *= e.t; };
    G.prototype.divide = function (e) { return new G(this.x / e.x, this.y / e.y, this.z / e.z, this.t / e.t); };
    G.prototype.divideInPlace = function (e) { this.x /= e.x, this.y /= e.y, this.z /= e.z, this.t /= e.t; };
    G.prototype.scale = function (e) { return new G(this.x * e, this.y * e, this.z * e, this.t * e); };
    G.prototype.scaleInPlace = function (e) { this.set(this.x * e, this.y * e, this.z * e, this.t * e); };
    G.prototype.length = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[2]; return Math.sqrt(e * e + t * t + a * a + i * i); };
    G.prototype.lengthSquared = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3]; return e * e + t * t + a * a + i * i; };
    G.prototype.normalize = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3]; var s = e * e + t * t + a * a + i * i; return s < Number.EPSILON ? new G : (s = 1 / Math.sqrt(s), new G(e * s, t * s, a * s)); };
    G.prototype.normalizeInPlace = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3]; var s = e * e + t * t + a * a + i * i; s < Number.EPSILON || (s = 1 / Math.sqrt(s), this.set(e * s, t * s, a * s, i * s)); };
    G.prototype.dot = function (e) { return this.x * e.x + this.y * e.y + this.z * e.z + this.t * b.t; };
    G.prototype.cross = function (e) { var t = this.x, a = this.y, i = this.z, s = this.t, n = e.x, l = e.y, r = e.z, o = e.t; return new G(a * r - i * l, i * o - s * r, s * n - t * o, t * l - a * n); };
    G.prototype.angleTo = function (e) { var t = this.normalize(), a = e.normalize(), i = t.dot(a); return i > 1 ? 0 : Math.acos(i); };
    G.prototype.lerp = function (e, t) { var a = this.x, i = this.y, s = this.z; return at = this.t, new G(a + t * (e.x - a), i + t * (e.y - i), s + t * (e.z - s), at + t * (e.t - at)); };
    G.prototype.random = function (e) {
        if (e === void 0) { e = 1; }
        var t = 2 * glMatrix.RANDOM() * Math.PI, a = 2 * glMatrix.RANDOM() - 1, i = Math.sqrt(1 - a * a) * e;
        return out[0] = Math.cos(t) * i, out[1] = Math.sin(t) * i, out[2] = a * e, out;
    };
    G.prototype.clone = function () { return new G(this.__data[0], this.__data[1], this.__data[2], this.__data[3]); };
    G.prototype.toVec3 = function () { return new Z(this.__data[0], this.__data[1], this.__data[2]); };
    G.prototype.asArray = function () { return this.__data; };
    G.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (Z.bind.apply(Z, __spreadArrays([void 0], e)))();
    };
    G.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new G(e, 4 * t);
    };
    G.numElements = function () { return 4; };
    G.prototype.toJSON = function () { return { x: this.x, y: this.y, z: this.z, t: this.t }; };
    return G;
}(p));
g.registerType("Vec4", G);
var X = /** @class */ (function (_super) {
    __extends(X, _super);
    function X(e, t, a, i) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 255; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof Uint8Array)
            _this.__data = e;
        else if (e instanceof ArrayBuffer) {
            var a_6 = e, i_4 = t;
            _this.__data = new Uint8Array(a_6, i_4, 4);
        }
        else
            _this.__data = new Uint8Array(4), "string" == typeof e ? e.startsWith("#") ? _this.setFromHex(e) : _this.setFromCSSColorName(e) : (_this.__data[0] = e, _this.__data[1] = t, _this.__data[2] = a, _this.__data[3] = i);
        return _this;
    }
    Object.defineProperty(X.prototype, "r", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(X.prototype, "g", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(X.prototype, "b", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(X.prototype, "a", {
        get: function () { return this.__data[3]; },
        set: function (e) { this.__data[3] = e; },
        enumerable: true,
        configurable: true
    });
    X.prototype.set = function (e, t, a, i) {
        if (i === void 0) { i = 255; }
        this.r = e, this.g = t, this.b = a, this.a = i;
    };
    X.prototype.setFromOther = function (e) { this.r = e.r, this.g = e.g, this.b = e.b, this.a = e.a; };
    X.prototype.setFromArray = function (e) { this.r = e[0], this.g = e[1], this.b = e[2], this.a = 4 == e.length ? e[3] : 1; };
    X.prototype.setFromHex = function (e) { var t = function (e) { var t = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e); return t ? { r: parseInt(t[1], 16), g: parseInt(t[2], 16), b: parseInt(t[3], 16) } : null; }(e); t ? this.set(t.r, t.g, t.b) : console.warn("Invalid hex code:" + e); };
    X.prototype.setFromCSSColorName = function (e) { e.startsWith("#") ? this.setFromHex(e) : this.setFromHex((function (e) { var t = { aliceblue: "#f0f8ff", antiquewhite: "#faebd7", aqua: "#00ffff", aquamarine: "#7fffd4", azure: "#f0ffff", beige: "#f5f5dc", bisque: "#ffe4c4", black: "#000000", blanchedalmond: "#ffebcd", blue: "#0000ff", blueviolet: "#8a2be2", brown: "#a52a2a", burlywood: "#deb887", cadetblue: "#5f9ea0", chartreuse: "#7fff00", chocolate: "#d2691e", coral: "#ff7f50", cornflowerblue: "#6495ed", cornsilk: "#fff8dc", crimson: "#dc143c", cyan: "#00ffff", darkblue: "#00008b", darkcyan: "#008b8b", darkgoldenrod: "#b8860b", darkgray: "#a9a9a9", darkgreen: "#006400", darkkhaki: "#bdb76b", darkmagenta: "#8b008b", darkolivegreen: "#556b2f", darkorange: "#ff8c00", darkorchid: "#9932cc", darkred: "#8b0000", darksalmon: "#e9967a", darkseagreen: "#8fbc8f", darkslateblue: "#483d8b", darkslategray: "#2f4f4f", darkturquoise: "#00ced1", darkviolet: "#9400d3", deeppink: "#ff1493", deepskyblue: "#00bfff", dimgray: "#696969", dodgerblue: "#1e90ff", firebrick: "#b22222", floralwhite: "#fffaf0", forestgreen: "#228b22", fuchsia: "#ff00ff", gainsboro: "#dcdcdc", ghostwhite: "#f8f8ff", gold: "#ffd700", goldenrod: "#daa520", gray: "#808080", green: "#008000", greenyellow: "#adff2f", honeydew: "#f0fff0", hotpink: "#ff69b4", "indianred ": "#cd5c5c", indigo: "#4b0082", ivory: "#fffff0", khaki: "#f0e68c", lavender: "#e6e6fa", lavenderblush: "#fff0f5", lawngreen: "#7cfc00", lemonchiffon: "#fffacd", lightblue: "#add8e6", lightcoral: "#f08080", lightcyan: "#e0ffff", lightgoldenrodyellow: "#fafad2", lightgrey: "#d3d3d3", lightgreen: "#90ee90", lightpink: "#ffb6c1", lightsalmon: "#ffa07a", lightseagreen: "#20b2aa", lightskyblue: "#87cefa", lightslategray: "#778899", lightsteelblue: "#b0c4de", lightyellow: "#ffffe0", lime: "#00ff00", limegreen: "#32cd32", linen: "#faf0e6", magenta: "#ff00ff", maroon: "#800000", mediumaquamarine: "#66cdaa", mediumblue: "#0000cd", mediumorchid: "#ba55d3", mediumpurple: "#9370d8", mediumseagreen: "#3cb371", mediumslateblue: "#7b68ee", mediumspringgreen: "#00fa9a", mediumturquoise: "#48d1cc", mediumvioletred: "#c71585", midnightblue: "#191970", mintcream: "#f5fffa", mistyrose: "#ffe4e1", moccasin: "#ffe4b5", navajowhite: "#ffdead", navy: "#000080", oldlace: "#fdf5e6", olive: "#808000", olivedrab: "#6b8e23", orange: "#ffa500", orangered: "#ff4500", orchid: "#da70d6", palegoldenrod: "#eee8aa", palegreen: "#98fb98", paleturquoise: "#afeeee", palevioletred: "#d87093", papayawhip: "#ffefd5", peachpuff: "#ffdab9", peru: "#cd853f", pink: "#ffc0cb", plum: "#dda0dd", powderblue: "#b0e0e6", purple: "#800080", rebeccapurple: "#663399", red: "#ff0000", rosybrown: "#bc8f8f", royalblue: "#4169e1", saddlebrown: "#8b4513", salmon: "#fa8072", sandybrown: "#f4a460", seagreen: "#2e8b57", seashell: "#fff5ee", sienna: "#a0522d", silver: "#c0c0c0", skyblue: "#87ceeb", slateblue: "#6a5acd", slategray: "#708090", snow: "#fffafa", springgreen: "#00ff7f", steelblue: "#4682b4", tan: "#d2b48c", teal: "#008080", thistle: "#d8bfd8", tomato: "#ff6347", turquoise: "#40e0d0", violet: "#ee82ee", wheat: "#f5deb3", white: "#ffffff", whitesmoke: "#f5f5f5", yellow: "#ffff00", yellowgreen: "#9acd32" }; return void 0 !== t[e.toLowerCase()] && t[e.toLowerCase()]; })(e)); };
    X.prototype.toHex = function () { function e(e) { var t = e.toString(16); return 1 == t.length ? "0" + t : t; } return "#" + e(this.r) + e(this.g) + e(this.b); };
    X.prototype.equal = function (e) { return this.r == e.r && this.g == e.g && this.b == e.b && this.a == e.a; };
    X.prototype.notequals = function (e) { return this.r != e.r && this.g != e.g && this.b != e.b && this.a != e.a; };
    X.prototype.approxEqual = function (e, t) {
        if (t === void 0) { t = Number.EPSILON; }
        return Math.abs(this.r - e.r) < t && Math.abs(this.g - e.g) < t && Math.abs(this.b - e.b) < t && Math.abs(this.a - e.a) < t;
    };
    X.prototype.add = function (e) { return new X(this.r + e.r, this.g + e.g, this.b + e.b, this.a + e.a); };
    X.prototype.subtract = function (e) { return new X(this.r - e.r, this.g - e.g, this.b - e.b, this.a - e.a); };
    X.prototype.scale = function (e) { return new X(this.r * e, this.g * e, this.b * e, this.a * e); };
    X.prototype.scaleInPlace = function (e) { this.r *= e, this.g *= e, this.b *= e, this.a *= e; };
    X.prototype.applyGamma = function (e) { this.set(Math.pow(this.r, e), Math.pow(this.g, e), Math.pow(this.b, e), this.a); };
    X.prototype.toLinear = function (e) {
        if (e === void 0) { e = 2.2; }
        return new X(Math.pow(this.r, e), Math.pow(this.g, e), Math.pow(this.b, e), this.a);
    };
    X.prototype.toGamma = function (e) {
        if (e === void 0) { e = 2.2; }
        return new X(Math.pow(this.r, 1 / e), Math.pow(this.g, 1 / e), Math.pow(this.b, 1 / e), this.a);
    };
    X.prototype.luminance = function () { return .2126 * this.r + .7152 * this.g + .0722 * this.b; };
    X.prototype.lerp = function (e, t) { var a = this.r, i = this.g, s = this.b, n = this.a; return new X(a + t * (e.r - a), i + t * (e.g - i), s + t * (e.b - s), n + t * (e.a - n)); };
    X.random = function (e, t) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = !1; }
        return e > 0 ? new X(e + Math.random() * (1 - e), e + Math.random() * (1 - e), e + Math.random() * (1 - e), t ? e + Math.random() * (1 - e) : 1) : e < 0 ? new X(Math.random() * (1 + e), Math.random() * (1 + e), Math.random() * (1 + e), t ? Math.random() * (1 + e) : 1) : new X(Math.random(), Math.random(), Math.random(), t ? Math.random() : 1);
    };
    X.prototype.clone = function () { return new X(this.__data[0], this.__data[1], this.__data[2], this.__data[3]); };
    X.prototype.asArray = function () { return this.__data; };
    X.prototype.as3ComponentArray = function () { return [this.__data[0], this.__data[1], this.__data[2]]; };
    X.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (X.bind.apply(X, __spreadArrays([void 0], e)))();
    };
    X.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new X(e, 4 * t);
    };
    X.numElements = function () { return 4; };
    X.prototype.toJSON = function () { return { r: this.r, g: this.g, b: this.b, a: this.a }; };
    X.prototype.fromJSON = function (e) { this.r = e.r, this.g = e.g, this.b = e.b, this.a = e.a; };
    X.prototype.toCSSString = function () { return "rgba(" + Math.round(255 * this.r) + ", " + Math.round(255 * this.g) + ", " + Math.round(255 * this.b) + ", " + this.a + ")"; };
    return X;
}(p));
g.registerType("RGBA", X);
var y = /** @class */ (function (_super) {
    __extends(y, _super);
    function y(e, t, a, i) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 1; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof Float32Array)
            _this.__data = e;
        else if (e instanceof ArrayBuffer) {
            var a_7 = e, i_5 = t;
            _this.__data = new Float32Array(a_7, i_5, 4);
        }
        else
            _this.__data = new Float32Array(4), "string" == typeof e ? e.startsWith("#") ? _this.setFromHex(e) : _this.setFromCSSColorName(e) : (_this.__data[0] = e, _this.__data[1] = t, _this.__data[2] = a, _this.__data[3] = i);
        return _this;
    }
    Object.defineProperty(y.prototype, "r", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(y.prototype, "g", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(y.prototype, "b", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(y.prototype, "a", {
        get: function () { return this.__data[3]; },
        set: function (e) { this.__data[3] = e; },
        enumerable: true,
        configurable: true
    });
    y.prototype.set = function (e, t, a, i) {
        if (i === void 0) { i = 1; }
        this.r = e, this.g = t, this.b = a, this.a = i;
    };
    y.prototype.setFromOther = function (e) { this.r = e.r, this.g = e.g, this.b = e.b, this.a = e.a; };
    y.prototype.setFromScalarArray = function (e) { this.r = e[0], this.g = e[1], this.b = e[2], this.a = 4 == e.length ? e[3] : 1; };
    y.prototype.getAsRGBArray = function () { return [255 * this.r, 255 * this.g, 255 * this.b]; };
    y.prototype.getAsRGBDict = function () { return { r: 255 * this.r, g: 255 * this.g, b: 255 * this.b }; };
    y.prototype.setFromRGB = function (e, t, a, i) { this.r = e / 255, this.g = t / 255, this.b = a / 255, this.a = i ? i / 255 : 1; };
    y.prototype.setFromRGBArray = function (e) { this.r = e[0] / 255, this.g = e[1] / 255, this.b = e[2] / 255, this.a = 4 == e.length ? e[3] / 255 : 1; };
    y.prototype.setFromRGBDict = function (e) { this.r = e.r / 255, this.g = e.g / 255, this.b = e.b / 255, this.a = 4 == e.a ? e.a / 255 : 1; };
    y.prototype.setFromHex = function (e) { var t = function (e) { var t = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e); return t ? { r: parseInt(t[1], 16), g: parseInt(t[2], 16), b: parseInt(t[3], 16) } : null; }(e); t ? this.setFromRGB(t.r, t.g, t.b) : console.warn("Invalid hex code:" + e); };
    y.prototype.setFromCSSColorName = function (e) { e.startsWith("#") ? this.setFromHex(e) : this.setFromHex((function (e) { var t = { aliceblue: "#f0f8ff", antiquewhite: "#faebd7", aqua: "#00ffff", aquamarine: "#7fffd4", azure: "#f0ffff", beige: "#f5f5dc", bisque: "#ffe4c4", black: "#000000", blanchedalmond: "#ffebcd", blue: "#0000ff", blueviolet: "#8a2be2", brown: "#a52a2a", burlywood: "#deb887", cadetblue: "#5f9ea0", chartreuse: "#7fff00", chocolate: "#d2691e", coral: "#ff7f50", cornflowerblue: "#6495ed", cornsilk: "#fff8dc", crimson: "#dc143c", cyan: "#00ffff", darkblue: "#00008b", darkcyan: "#008b8b", darkgoldenrod: "#b8860b", darkgray: "#a9a9a9", darkgreen: "#006400", darkkhaki: "#bdb76b", darkmagenta: "#8b008b", darkolivegreen: "#556b2f", darkorange: "#ff8c00", darkorchid: "#9932cc", darkred: "#8b0000", darksalmon: "#e9967a", darkseagreen: "#8fbc8f", darkslateblue: "#483d8b", darkslategray: "#2f4f4f", darkturquoise: "#00ced1", darkviolet: "#9400d3", deeppink: "#ff1493", deepskyblue: "#00bfff", dimgray: "#696969", dodgerblue: "#1e90ff", firebrick: "#b22222", floralwhite: "#fffaf0", forestgreen: "#228b22", fuchsia: "#ff00ff", gainsboro: "#dcdcdc", ghostwhite: "#f8f8ff", gold: "#ffd700", goldenrod: "#daa520", gray: "#808080", green: "#008000", greenyellow: "#adff2f", honeydew: "#f0fff0", hotpink: "#ff69b4", "indianred ": "#cd5c5c", indigo: "#4b0082", ivory: "#fffff0", khaki: "#f0e68c", lavender: "#e6e6fa", lavenderblush: "#fff0f5", lawngreen: "#7cfc00", lemonchiffon: "#fffacd", lightblue: "#add8e6", lightcoral: "#f08080", lightcyan: "#e0ffff", lightgoldenrodyellow: "#fafad2", lightgrey: "#d3d3d3", lightgreen: "#90ee90", lightpink: "#ffb6c1", lightsalmon: "#ffa07a", lightseagreen: "#20b2aa", lightskyblue: "#87cefa", lightslategray: "#778899", lightsteelblue: "#b0c4de", lightyellow: "#ffffe0", lime: "#00ff00", limegreen: "#32cd32", linen: "#faf0e6", magenta: "#ff00ff", maroon: "#800000", mediumaquamarine: "#66cdaa", mediumblue: "#0000cd", mediumorchid: "#ba55d3", mediumpurple: "#9370d8", mediumseagreen: "#3cb371", mediumslateblue: "#7b68ee", mediumspringgreen: "#00fa9a", mediumturquoise: "#48d1cc", mediumvioletred: "#c71585", midnightblue: "#191970", mintcream: "#f5fffa", mistyrose: "#ffe4e1", moccasin: "#ffe4b5", navajowhite: "#ffdead", navy: "#000080", oldlace: "#fdf5e6", olive: "#808000", olivedrab: "#6b8e23", orange: "#ffa500", orangered: "#ff4500", orchid: "#da70d6", palegoldenrod: "#eee8aa", palegreen: "#98fb98", paleturquoise: "#afeeee", palevioletred: "#d87093", papayawhip: "#ffefd5", peachpuff: "#ffdab9", peru: "#cd853f", pink: "#ffc0cb", plum: "#dda0dd", powderblue: "#b0e0e6", purple: "#800080", rebeccapurple: "#663399", red: "#ff0000", rosybrown: "#bc8f8f", royalblue: "#4169e1", saddlebrown: "#8b4513", salmon: "#fa8072", sandybrown: "#f4a460", seagreen: "#2e8b57", seashell: "#fff5ee", sienna: "#a0522d", silver: "#c0c0c0", skyblue: "#87ceeb", slateblue: "#6a5acd", slategray: "#708090", snow: "#fffafa", springgreen: "#00ff7f", steelblue: "#4682b4", tan: "#d2b48c", teal: "#008080", thistle: "#d8bfd8", tomato: "#ff6347", turquoise: "#40e0d0", violet: "#ee82ee", wheat: "#f5deb3", white: "#ffffff", whitesmoke: "#f5f5f5", yellow: "#ffff00", yellowgreen: "#9acd32" }; return void 0 !== t[e.toLowerCase()] && t[e.toLowerCase()]; })(e)); };
    y.prototype.toHex = function () { function e(e) { var t = Math.round(255 * e).toString(16); return 1 == t.length ? "0" + t : t; } return "#" + e(this.r) + e(this.g) + e(this.b); };
    y.prototype.equal = function (e) { return this.r == e.r && this.g == e.g && this.b == e.b && this.a == e.a; };
    y.prototype.notequals = function (e) { return this.r != e.r && this.g != e.g && this.b != e.b && this.a != e.a; };
    y.prototype.approxEqual = function (e, t) {
        if (t === void 0) { t = Number.EPSILON; }
        return Math.abs(this.r - e.r) < t && Math.abs(this.g - e.g) < t && Math.abs(this.b - e.b) < t && Math.abs(this.a - e.a) < t;
    };
    y.prototype.add = function (e) { return new y(this.r + e.r, this.g + e.g, this.b + e.b, this.a + e.a); };
    y.prototype.subtract = function (e) { return new y(this.r - e.r, this.g - e.g, this.b - e.b, this.a - e.a); };
    y.prototype.scale = function (e) { return new y(this.r * e, this.g * e, this.b * e, this.a * e); };
    y.prototype.scaleInPlace = function (e) { this.r *= e, this.g *= e, this.b *= e, this.a *= e; };
    y.prototype.applyGamma = function (e) { this.set(Math.pow(this.r, e), Math.pow(this.g, e), Math.pow(this.b, e), this.a); };
    y.prototype.toLinear = function (e) {
        if (e === void 0) { e = 2.2; }
        return new y(Math.pow(this.r, e), Math.pow(this.g, e), Math.pow(this.b, e), this.a);
    };
    y.prototype.toGamma = function (e) {
        if (e === void 0) { e = 2.2; }
        return new y(Math.pow(this.r, 1 / e), Math.pow(this.g, 1 / e), Math.pow(this.b, 1 / e), this.a);
    };
    y.prototype.luminance = function () { return .2126 * this.r + .7152 * this.g + .0722 * this.b; };
    y.prototype.lerp = function (e, t) { var a = this.r, i = this.g, s = this.b, n = this.a; return new y(a + t * (e.r - a), i + t * (e.g - i), s + t * (e.b - s), n + t * (e.a - n)); };
    y.random = function (e, t) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = !1; }
        return e > 0 ? new y(e + Math.random() * (1 - e), e + Math.random() * (1 - e), e + Math.random() * (1 - e), t ? e + Math.random() * (1 - e) : 1) : e < 0 ? new y(Math.random() * (1 + e), Math.random() * (1 + e), Math.random() * (1 + e), t ? Math.random() * (1 + e) : 1) : new y(Math.random(), Math.random(), Math.random(), t ? Math.random() : 1);
    };
    y.prototype.clone = function () { return new y(this.__data[0], this.__data[1], this.__data[2], this.__data[3]); };
    y.prototype.asArray = function () { return this.__data; };
    y.prototype.as3ComponentArray = function () { return [this.__data[0], this.__data[1], this.__data[2]]; };
    y.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (y.bind.apply(y, __spreadArrays([void 0], e)))();
    };
    y.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new y(e, 4 * t);
    };
    y.numElements = function () { return 4; };
    y.prototype.toJSON = function () { return { r: this.r, g: this.g, b: this.b, a: this.a }; };
    y.prototype.fromJSON = function (e) { this.r = e.r, this.g = e.g, this.b = e.b, this.a = e.a; };
    y.prototype.toCSSString = function () { return "rgba(" + Math.round(255 * this.r) + ", " + Math.round(255 * this.g) + ", " + Math.round(255 * this.b) + ", " + this.a + ")"; };
    return y;
}(p));
g.registerType("Color", y);
var f = /** @class */ (function (_super) {
    __extends(f, _super);
    function f(e, t, a, i) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 0; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(i))
            switch (i) {
                case "XYZ":
                    _this.order = 0;
                    break;
                case "YZX":
                    _this.order = 1;
                    break;
                case "ZXY":
                    _this.order = 2;
                    break;
                case "XZY":
                    _this.order = 3;
                    break;
                case "ZYX":
                    _this.order = 4;
                    break;
                case "YXZ":
                    _this.order = 5;
                    break;
                default: throw new Error("Invalid Euler Angles Order:" + i);
            }
        else
            _this.order = i;
        if (e instanceof ArrayBuffer) {
            var a_8 = e, i_6 = t;
            _this.__data = new Float32Array(a_8, i_6, 4);
        }
        else
            _this.__data = new Float32Array(3), _this.__data[0] = e, _this.__data[1] = t, _this.__data[2] = a;
        return _this;
    }
    Object.defineProperty(f.prototype, "x", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(f.prototype, "y", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(f.prototype, "z", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    f.prototype.set = function (e, t, a) { this.__data[0] = e, this.__data[1] = t, this.__data[2] = a; };
    return f;
}(p));
g.registerType("EulerAngles", f);
var V = /** @class */ (function (_super) {
    __extends(V, _super);
    function V(e, t, a, i, s, n, l, r, o) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 0; }
        if (s === void 0) { s = 1; }
        if (n === void 0) { n = 0; }
        if (l === void 0) { l = 0; }
        if (r === void 0) { r = 0; }
        if (o === void 0) { o = 1; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof ArrayBuffer) {
            var a_9 = e, i_7 = t;
            _this.__data = new Float32Array(a_9, i_7, 9);
        }
        else
            _this.__data = new Float32Array(9), _this.set(e, t, a, i, s, n, l, r, o);
        return _this;
    }
    Object.defineProperty(V.prototype, "m00", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m01", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m02", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m10", {
        get: function () { return this.__data[3]; },
        set: function (e) { this.__data[3] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m11", {
        get: function () { return this.__data[4]; },
        set: function (e) { this.__data[4] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m12", {
        get: function () { return this.__data[5]; },
        set: function (e) { this.__data[5] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m20", {
        get: function () { return this.__data[6]; },
        set: function (e) { this.__data[6] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m21", {
        get: function () { return this.__data[7]; },
        set: function (e) { this.__data[7] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "m22", {
        get: function () { return this.__data[8]; },
        set: function (e) { this.__data[8] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "xAxis", {
        get: function () { return Z.createFromFloat32Buffer(this.__data.buffer, 0); },
        set: function (e) { this.xAxis.set(e.x, e.y, e.z); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "yAxis", {
        get: function () { return Z.createFromFloat32Buffer(this.__data.buffer, 3); },
        set: function (e) { this.yAxis.set(e.x, e.y, e.z); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(V.prototype, "zAxis", {
        get: function () { return Z.createFromFloat32Buffer(this.__data.buffer, 6); },
        set: function (e) { this.zAxis.set(e.x, e.y, e.z); },
        enumerable: true,
        configurable: true
    });
    V.prototype.set = function (e, t, a, i, s, n, l, r, o) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 0; }
        if (s === void 0) { s = 1; }
        if (n === void 0) { n = 0; }
        if (l === void 0) { l = 0; }
        if (r === void 0) { r = 0; }
        if (o === void 0) { o = 1; }
        this.__data[0] = e, this.__data[1] = t, this.__data[2] = a, this.__data[3] = i, this.__data[4] = s, this.__data[5] = n, this.__data[6] = l, this.__data[7] = r, this.__data[8] = o;
    };
    V.prototype.setIdentity = function () { this.set(); };
    V.prototype.setFromMat = function (e) { this.__data[0] = e.m00, this.__data[1] = e.m01, this.__data[2] = e.m02, this.__data[3] = e.m10, this.__data[4] = e.m11, this.__data[5] = e.m12, this.__data[6] = e.m20, this.__data[7] = e.m21, this.__data[8] = e.m22; };
    V.prototype.setFromDirectionAndUpvector = function (e, t) { var a = e, i = a.length(); if (i < Number.EPSILON)
        return void this.setIdentity(); a.scaleInPlace(1 / i); var s = t.cross(a), n = s.length(); n > Number.EPSILON && s.scaleInPlace(1 / n); var l = a.cross(s), r = l.length(); r > Number.EPSILON && l.scaleInPlace(1 / r), this.set(s.x, s.y, s.z, l.x, l.y, l.z, a.x, a.y, a.z); };
    V.prototype.inverse = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3], s = this.__data[4], n = this.__data[5], l = this.__data[6], r = this.__data[7], o = this.__data[8], d = o * s - n * r, h = -o * i + n * l, c = r * i - s * l, m = e * d + t * h + a * c; return m ? (m = 1 / m, new V(d * m, (-o * t + a * r) * m, (n * t - a * s) * m, h * m, (o * e - a * l) * m, (-n * e + a * i) * m, c * m, (-r * e + t * l) * m, (s * e - t * i) * m)) : (console.warn("Unable to invert Mat3"), null); };
    V.prototype.invertInPlace = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3], s = this.__data[4], n = this.__data[5], l = this.__data[6], r = this.__data[7], o = this.__data[8], d = o * s - n * r, h = -o * i + n * l, c = r * i - s * l, m = e * d + t * h + a * c; return m ? (m = 1 / m, this.set(d * m, (-o * t + a * r) * m, (n * t - a * s) * m, h * m, (o * e - a * l) * m, (-n * e + a * i) * m, c * m, (-r * e + t * l) * m, (s * e - t * i) * m), !0) : (console.warn("Unable to invert Mat3"), !1); };
    V.prototype.transpose = function () { return V(this.__data[0], this.__data[3], this.__data[6], this.__data[1], this.__data[4], this.__data[7], this.__data[2], this.__data[5], this.__data[8]); };
    V.prototype.transposeInPlace = function () { var e = this.__data[1], t = this.__data[2], a = this.__data[5]; this.__data[1] = this.__data[3], this.__data[2] = this.__data[6], this.__data[3] = e, this.__data[5] = this.__data[7], this.__data[6] = t, this.__data[7] = a; };
    V.prototype.transformVec3 = function (e) { return new Z(this.__data[0] * e.x + this.__data[1] * e.y + this.__data[2] * e.z, this.__data[3] * e.x + this.__data[4] * e.y + this.__data[5] * e.z, this.__data[6] * e.x + this.__data[7] * e.y + this.__data[8] * e.z); };
    V.prototype.clone = function () { return new V(this.__data[0], this.__data[1], this.__data[2], this.__data[3], this.__data[4], this.__data[5], this.__data[6], this.__data[7], this.__data[8], this.__data[9]); };
    V.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (V.bind.apply(V, __spreadArrays([void 0], e)))();
    };
    V.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new V(e, 4 * t);
    };
    V.prototype.toJSON = function () { return this.__data; };
    V.prototype.fromJSON = function (e) { this.__data = new Float32Array(e); };
    V.prototype.toString = function () { return this.toJSON().toString(); };
    return V;
}(p));
g.registerType("Mat3", V);
var I = /** @class */ (function (_super) {
    __extends(I, _super);
    function I(e, t, a, i, s, n, l, r, o, d, h, c, m, u, b, p) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 0; }
        if (s === void 0) { s = 0; }
        if (n === void 0) { n = 1; }
        if (l === void 0) { l = 0; }
        if (r === void 0) { r = 0; }
        if (o === void 0) { o = 0; }
        if (d === void 0) { d = 0; }
        if (h === void 0) { h = 1; }
        if (c === void 0) { c = 0; }
        if (m === void 0) { m = 0; }
        if (u === void 0) { u = 0; }
        if (b === void 0) { b = 0; }
        if (p === void 0) { p = 1; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof Float32Array)
            _this.__data = e;
        else if (e instanceof ArrayBuffer) {
            var a_10 = e, i_8 = t;
            _this.__data = new Float32Array(a_10, i_8, 16);
        }
        else
            _this.__data = new Float32Array(16), _this.set(e, t, a, i, s, n, l, r, o, d, h, c, m, u, b, p);
        return _this;
    }
    Object.defineProperty(I.prototype, "m00", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m01", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m02", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m03", {
        get: function () { return this.__data[3]; },
        set: function (e) { this.__data[3] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m10", {
        get: function () { return this.__data[4]; },
        set: function (e) { this.__data[4] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m11", {
        get: function () { return this.__data[5]; },
        set: function (e) { this.__data[5] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m12", {
        get: function () { return this.__data[6]; },
        set: function (e) { this.__data[6] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m13", {
        get: function () { return this.__data[7]; },
        set: function (e) { this.__data[7] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m20", {
        get: function () { return this.__data[8]; },
        set: function (e) { this.__data[8] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m21", {
        get: function () { return this.__data[9]; },
        set: function (e) { this.__data[9] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m22", {
        get: function () { return this.__data[10]; },
        set: function (e) { this.__data[10] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m23", {
        get: function () { return this.__data[11]; },
        set: function (e) { this.__data[11] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m30", {
        get: function () { return this.__data[12]; },
        set: function (e) { this.__data[12] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m31", {
        get: function () { return this.__data[13]; },
        set: function (e) { this.__data[13] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m32", {
        get: function () { return this.__data[14]; },
        set: function (e) { this.__data[14] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "m33", {
        get: function () { return this.__data[15]; },
        set: function (e) { this.__data[15] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "xAxis", {
        get: function () { return Z.createFromFloat32Buffer(this.__data.buffer, 0); },
        set: function (e) { this.xAxis.set(e.x, e.y, e.z); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "yAxis", {
        get: function () { return Z.createFromFloat32Buffer(this.__data.buffer, 4); },
        set: function (e) { this.yAxis.set(e.x, e.y, e.z); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "zAxis", {
        get: function () { return Z.createFromFloat32Buffer(this.__data.buffer, 8); },
        set: function (e) { this.zAxis.set(e.x, e.y, e.z); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(I.prototype, "translation", {
        get: function () { return Z.createFromFloat32Buffer(this.__data.buffer, 12); },
        set: function (e) { this.translation.set(e.x, e.y, e.z); },
        enumerable: true,
        configurable: true
    });
    I.prototype.set = function (e, t, a, i, s, n, l, r, o, d, h, c, m, u, b, p) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 0; }
        if (s === void 0) { s = 0; }
        if (n === void 0) { n = 1; }
        if (l === void 0) { l = 0; }
        if (r === void 0) { r = 0; }
        if (o === void 0) { o = 0; }
        if (d === void 0) { d = 0; }
        if (h === void 0) { h = 1; }
        if (c === void 0) { c = 0; }
        if (m === void 0) { m = 0; }
        if (u === void 0) { u = 0; }
        if (b === void 0) { b = 0; }
        if (p === void 0) { p = 1; }
        this.__data[0] = e, this.__data[1] = t, this.__data[2] = a, this.__data[3] = i, this.__data[4] = s, this.__data[5] = n, this.__data[6] = l, this.__data[7] = r, this.__data[8] = o, this.__data[9] = d, this.__data[10] = h, this.__data[11] = c, this.__data[12] = m, this.__data[13] = u, this.__data[14] = b, this.__data[15] = p;
    };
    I.prototype.setIdentity = function () { this.set(); };
    I.prototype.setDataArray = function (e) { this.__data = e; };
    I.prototype.setFromMat4 = function (e) { this.__data[0] = e.m00, this.__data[1] = e.m01, this.__data[2] = e.m02, this.__data[3] = e.m03, this.__data[4] = e.m10, this.__data[5] = e.m11, this.__data[6] = e.m12, this.__data[7] = e.m13, this.__data[8] = e.m20, this.__data[9] = e.m21, this.__data[10] = e.m22, this.__data[11] = e.m23, this.__data[12] = e.m30, this.__data[13] = e.m31, this.__data[14] = e.m32, this.__data[15] = e.m33; };
    I.prototype.toMat3 = function (e) { return new V(this.__data[0], this.__data[1], this.__data[2], this.__data[4], this.__data[5], this.__data[6], this.__data[8], this.__data[9], this.__data[10]); };
    I.prototype.transposeInPlace = function () { var e = this.__data[1], t = this.__data[2], a = this.__data[3], i = this.__data[6], s = this.__data[7], n = this.__data[11]; this.__data[1] = this.__data[4], this.__data[2] = this.__data[8], this.__data[3] = this.__data[12], this.__data[4] = e, this.__data[6] = this.__data[9], this.__data[7] = this.__data[13], this.__data[8] = t, this.__data[9] = i, this.__data[11] = this.__data[14], this.__data[12] = a, this.__data[13] = s, this.__data[14] = n; };
    I.prototype.transpose = function () { return new I(this.__data[0], this.__data[4], this.__data[8], this.__data[12], this.__data[1], this.__data[5], this.__data[9], this.__data[13], this.__data[2], this.__data[6], this.__data[10], this.__data[14], this.__data[3], this.__data[7], this.__data[11], this.__data[15]); };
    I.prototype.inverse = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3], s = this.__data[4], n = this.__data[5], l = this.__data[6], r = this.__data[7], o = this.__data[8], d = this.__data[9], h = this.__data[10], c = this.__data[11], m = this.__data[12], u = this.__data[13], b = this.__data[14], p = this.__data[15], g = e * n - t * s, _ = e * l - a * s, Z = e * r - i * s, G = t * l - a * n, X = t * r - i * n, y = a * r - i * l, f = o * u - d * m, V = o * b - h * m, R = o * p - c * m, x = d * b - h * u, S = d * p - c * u, W = h * p - c * b; var L = g * W - _ * S + Z * x + G * R - X * V + y * f; return L ? (L = 1 / L, new I((n * W - l * S + r * x) * L, (a * S - t * W - i * x) * L, (u * y - b * X + p * G) * L, (h * X - d * y - c * G) * L, (l * R - s * W - r * V) * L, (e * W - a * R + i * V) * L, (b * Z - m * y - p * _) * L, (o * y - h * Z + c * _) * L, (s * S - n * R + r * f) * L, (t * R - e * S - i * f) * L, (m * X - u * Z + p * g) * L, (d * Z - o * X - c * g) * L, (n * V - s * x - l * f) * L, (e * x - t * V + a * f) * L, (u * _ - m * G - b * g) * L, (o * G - d * _ + h * g) * L)) : (console.warn("Unable to invert Mat4"), null); };
    I.prototype.invertInPlace = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3], s = this.__data[4], n = this.__data[5], l = this.__data[6], r = this.__data[7], o = this.__data[8], d = this.__data[9], h = this.__data[10], c = this.__data[11], m = this.__data[12], u = this.__data[13], b = this.__data[14], p = this.__data[15], g = e * n - t * s, _ = e * l - a * s, Z = e * r - i * s, G = t * l - a * n, X = t * r - i * n, y = a * r - i * l, f = o * u - d * m, V = o * b - h * m, I = o * p - c * m, R = d * b - h * u, x = d * p - c * u, S = h * p - c * b; var W = g * S - _ * x + Z * R + G * I - X * V + y * f; return W ? (W = 1 / W, this.set((n * S - l * x + r * R) * W, (a * x - t * S - i * R) * W, (u * y - b * X + p * G) * W, (h * X - d * y - c * G) * W, (l * I - s * S - r * V) * W, (e * S - a * I + i * V) * W, (b * Z - m * y - p * _) * W, (o * y - h * Z + c * _) * W, (s * x - n * I + r * f) * W, (t * I - e * x - i * f) * W, (m * X - u * Z + p * g) * W, (d * Z - o * X - c * g) * W, (n * V - s * R - l * f) * W, (e * R - t * V + a * f) * W, (u * _ - m * G - b * g) * W, (o * G - d * _ + h * g) * W), !0) : (console.warn("Unable to invert Mat4"), !1); };
    I.prototype.setInverse = function (e) { var t = e.__data[0], a = e.__data[1], i = e.__data[2], s = e.__data[3], n = e.__data[4], l = e.__data[5], r = e.__data[6], o = e.__data[7], d = e.__data[8], h = e.__data[9], c = e.__data[10], m = e.__data[11], u = e.__data[12], b = e.__data[13], p = e.__data[14], g = e.__data[15], _ = t * l - a * n, Z = t * r - i * n, G = t * o - s * n, X = a * r - i * l, y = a * o - s * l, f = i * o - s * r, V = d * b - h * u, I = d * p - c * u, R = d * g - m * u, x = h * p - c * b, S = h * g - m * b, W = c * g - m * p; var L = _ * W - Z * S + G * x + X * R - y * I + f * V; if (!L)
        throw new Error("Unable to invert Mat4"); L = 1 / L, this.set((l * W - r * S + o * x) * L, (i * S - a * W - s * x) * L, (b * f - p * y + g * X) * L, (c * y - h * f - m * X) * L, (r * R - n * W - o * I) * L, (t * W - i * R + s * I) * L, (p * G - u * f - g * Z) * L, (d * f - c * G + m * Z) * L, (n * S - l * R + o * V) * L, (a * R - t * S - s * V) * L, (u * y - b * G + g * _) * L, (h * G - d * y - m * _) * L, (l * I - n * x - r * V) * L, (t * x - a * I + i * V) * L, (b * Z - u * X - p * _) * L, (d * X - h * Z + c * _) * L); };
    I.prototype.multiply = function (e) { var t = this.__data[0], a = this.__data[1], i = this.__data[2], s = this.__data[3], n = this.__data[4], l = this.__data[5], r = this.__data[6], o = this.__data[7], d = this.__data[8], h = this.__data[9], c = this.__data[10], m = this.__data[11], u = this.__data[12], b = this.__data[13], p = this.__data[14], g = this.__data[15], _ = e.asArray(); var Z = _[0], G = _[1], X = _[2], y = _[3]; var f = new I; return f.m00 = Z * t + G * n + X * d + y * u, f.m01 = Z * a + G * l + X * h + y * b, f.m02 = Z * i + G * r + X * c + y * p, f.m03 = Z * s + G * o + X * m + y * g, Z = _[4], G = _[5], X = _[6], y = _[7], f.m10 = Z * t + G * n + X * d + y * u, f.m11 = Z * a + G * l + X * h + y * b, f.m12 = Z * i + G * r + X * c + y * p, f.m13 = Z * s + G * o + X * m + y * g, Z = _[8], G = _[9], X = _[10], y = _[11], f.m20 = Z * t + G * n + X * d + y * u, f.m21 = Z * a + G * l + X * h + y * b, f.m22 = Z * i + G * r + X * c + y * p, f.m23 = Z * s + G * o + X * m + y * g, Z = _[12], G = _[13], X = _[14], y = _[15], f.m30 = Z * t + G * n + X * d + y * u, f.m31 = Z * a + G * l + X * h + y * b, f.m32 = Z * i + G * r + X * c + y * p, f.m33 = Z * s + G * o + X * m + y * g, f; };
    I.prototype.multiplyInPlace = function (e) { var t = this.asArray(), a = t[0], i = t[1], s = t[2], n = t[3], l = t[4], r = t[5], o = t[6], d = t[7], h = t[8], c = t[9], m = t[10], u = t[11], b = t[12], p = t[13], g = t[14], _ = t[15], Z = e.asArray(); var G = Z[0], X = Z[1], y = Z[2], f = Z[3]; return this.m00 = G * a + X * l + y * h + f * b, this.m01 = G * i + X * r + y * c + f * p, this.m02 = G * s + X * o + y * m + f * g, this.m03 = G * n + X * d + y * u + f * _, G = Z[4], X = Z[5], y = Z[6], f = Z[7], this.m10 = G * a + X * l + y * h + f * b, this.m11 = G * i + X * r + y * c + f * p, this.m12 = G * s + X * o + y * m + f * g, this.m13 = G * n + X * d + y * u + f * _, G = Z[8], X = Z[9], y = Z[10], f = Z[11], this.m20 = G * a + X * l + y * h + f * b, this.m21 = G * i + X * r + y * c + f * p, this.m22 = G * s + X * o + y * m + f * g, this.m23 = G * n + X * d + y * u + f * _, G = Z[12], X = Z[13], y = Z[14], f = Z[15], this.m30 = G * a + X * l + y * h + f * b, this.m31 = G * i + X * r + y * c + f * p, this.m32 = G * s + X * o + y * m + f * g, this.m33 = G * n + X * d + y * u + f * _, this; };
    I.prototype.postmultiplyInPlace = function (e) { var t = e.asArray(), a = t[0], i = t[1], s = t[2], n = t[3], l = t[4], r = t[5], o = t[6], d = t[7], h = t[8], c = t[9], m = t[10], u = t[11], b = t[12], p = t[13], g = t[14], _ = t[15], Z = this.asArray(); var G = Z[0], X = Z[1], y = Z[2], f = Z[3]; return this.m00 = G * a + X * l + y * h + f * b, this.m01 = G * i + X * r + y * c + f * p, this.m02 = G * s + X * o + y * m + f * g, this.m03 = G * n + X * d + y * u + f * _, G = Z[4], X = Z[5], y = Z[6], f = Z[7], this.m10 = G * a + X * l + y * h + f * b, this.m11 = G * i + X * r + y * c + f * p, this.m12 = G * s + X * o + y * m + f * g, this.m13 = G * n + X * d + y * u + f * _, G = Z[8], X = Z[9], y = Z[10], f = Z[11], this.m20 = G * a + X * l + y * h + f * b, this.m21 = G * i + X * r + y * c + f * p, this.m22 = G * s + X * o + y * m + f * g, this.m23 = G * n + X * d + y * u + f * _, G = Z[12], X = Z[13], y = Z[14], f = Z[15], this.m30 = G * a + X * l + y * h + f * b, this.m31 = G * i + X * r + y * c + f * p, this.m32 = G * s + X * o + y * m + f * g, this.m33 = G * n + X * d + y * u + f * _, this; };
    I.prototype.translateInPlace = function (e) { var t = this.__data, a = e.x, i = e.y, s = e.z; return t[12] = t[0] * a + t[4] * i + t[8] * s + t[12], t[13] = t[1] * a + t[5] * i + t[9] * s + t[13], t[14] = t[2] * a + t[6] * i + t[10] * s + t[14], t[15] = t[3] * a + t[7] * i + t[11] * s + t[15], this; };
    I.prototype.setLookAt = function (e, t, a) { var i = e.subtract(t), s = i.length(); if (s < Number.EPSILON)
        return void this.setIdentity(); i.scaleInPlace(1 / s); var n = a.cross(i), l = n.length(); l > Number.EPSILON && n.scaleInPlace(1 / l); var r = i.cross(n), o = r.length(); o > Number.EPSILON && r.scaleInPlace(1 / o), this.set(n.x, n.y, n.z, 0, r.x, r.y, r.z, 0, i.x, i.y, i.z, 0, e.x, e.y, e.z, 1); };
    I.prototype.setRotation = function (e, t) { var a = e.length(); if (Math.abs(a) < Number.EPSILON)
        return null; var i = e.x / a, s = e.y / a, n = e.z / a, l = Math.sin(t), r = Math.cos(t), o = 1 - r, d = this.__data; return d[0] = i * i * o + r, d[1] = s * i * o + n * l, d[2] = n * i * o - s * l, d[3] = 0, d[4] = i * s * o - n * l, d[5] = s * s * o + r, d[6] = n * s * o + i * l, d[7] = 0, d[8] = i * n * o + s * l, d[9] = s * n * o - i * l, d[10] = n * n * o + r, d[11] = 0, d[12] = 0, d[13] = 0, d[14] = 0, d[15] = 1, this; };
    I.prototype.setXRotation = function (e) { var t = Math.sin(e), a = Math.cos(e), i = this.__data; return i[0] = 1, i[1] = 0, i[2] = 0, i[3] = 0, i[4] = 0, i[5] = a, i[6] = t, i[7] = 0, i[8] = 0, i[9] = -t, i[10] = a, i[11] = 0, i[12] = 0, i[13] = 0, i[14] = 0, i[15] = 1, this; };
    I.prototype.setYRotation = function (e) { var t = Math.sin(e), a = Math.cos(e), i = this.__data; return i[0] = a, i[1] = 0, i[2] = -t, i[3] = 0, i[4] = 0, i[5] = 1, i[6] = 0, i[7] = 0, i[8] = t, i[9] = 0, i[10] = a, i[11] = 0, i[12] = 0, i[13] = 0, i[14] = 0, i[15] = 1, this; };
    I.prototype.setZRotation = function (e) { var t = Math.sin(e), a = Math.cos(e), i = this.__data; return i[0] = a, i[1] = t, i[2] = 0, i[3] = 0, i[4] = -t, i[5] = a, i[6] = 0, i[7] = 0, i[8] = 0, i[9] = 0, i[10] = 1, i[11] = 0, i[12] = 0, i[13] = 0, i[14] = 0, i[15] = 1, this; };
    I.prototype.transformVec4 = function (e) { var t = this.__data, a = e.x, i = e.y, s = e.z, n = e.t; return new Vec4(t[0] * a + t[4] * i + t[8] * s + t[12] * n, t[1] * a + t[5] * i + t[9] * s + t[13] * n, t[2] * a + t[6] * i + t[10] * s + t[14] * n, t[3] * a + t[7] * i + t[11] * s + t[15] * n); };
    I.prototype.transformVec3 = function (e) { var t = this.__data, a = e.x, i = e.y, s = e.z; return new Z(t[0] * a + t[4] * i + t[8] * s + t[12], t[1] * a + t[5] * i + t[9] * s + t[13], t[2] * a + t[6] * i + t[10] * s + t[14]); };
    I.prototype.rotateVec3 = function (e) { var t = this.__data, a = e.x, i = e.y, s = e.z; return new Z(t[0] * a + t[4] * i + t[8] * s, t[1] * a + t[5] * i + t[9] * s, t[2] * a + t[6] * i + t[10] * s); };
    I.prototype.setPerspectiveMatrix = function (e, t, a, i) { var s = Math.tan(.5 * Math.PI - .5 * e), n = 1 / (a - i); this.set(s / t, 0, 0, 0, 0, s, 0, 0, 0, 0, (a + i) * n, -1, 0, 0, a * i * n * 2, 0); };
    I.prototype.setOrthographicMatrix = function (e, t, a, i, s, n) { var l = 1 / (e - t), r = 1 / (a - i), o = 1 / (s - n); this.set(-2 * l, 0, 0, 0, 0, -2 * r, 0, 0, 0, 0, 2 * o, 0, (e + t) * l, (i + a) * r, (n + s) * o, 1); };
    I.prototype.setScale = function (e, t, a) { e instanceof Z ? this.set(e.x, 0, 0, 0, 0, e.y, 0, 0, 0, 0, e.z, 0, 0, 0, 0, 1) : this.set(e, 0, 0, 0, 0, t, 0, 0, 0, 0, a, 0, 0, 0, 0, 1); };
    I.prototype.setFromMat3x4Array = function (e) { this.set(e[0], e[1], e[2], 0, e[3], e[4], e[5], 0, e[6], e[7], e[8], 0, e[9], e[10], e[11], 1); };
    I.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new I(e, 4 * t);
    };
    I.prototype.clone = function () { return new I(this.__data[0], this.__data[1], this.__data[2], this.__data[3], this.__data[4], this.__data[5], this.__data[6], this.__data[7], this.__data[8], this.__data[9], this.__data[10], this.__data[11], this.__data[12], this.__data[13], this.__data[14], this.__data[15]); };
    I.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (I.bind.apply(I, __spreadArrays([void 0], e)))();
    };
    I.prototype.toJSON = function () { return this.__data; };
    I.prototype.fromJSON = function (e) { this.__data = new Float32Array(e); };
    return I;
}(p));
g.registerType("Mat4", I);
var R = /** @class */ (function (_super) {
    __extends(R, _super);
    function R(e, t, a, i) {
        var _b;
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = 0; }
        if (i === void 0) { i = 1; }
        var _this = this;
        if (_this = _super.call(this) || this, e instanceof ArrayBuffer) {
            var a_11 = e, i_9 = t;
            _this.__data = new Float32Array(a_11, i_9, 4);
        }
        else if (_this.__data = new Float32Array(4), "object" == typeof e) {
            _this.__data[0] = 0, _this.__data[1] = 0, _this.__data[2] = 0, _this.__data[3] = 1;
            for (var t_6 in e)
                Array.isArray(e[t_6]) ? (_b = _this[t_6]).call.apply(_b, __spreadArrays([_this], e[t_6])) : _this[t_6].call(_this, e[t_6]);
        }
        else
            _this.__data[0] = e, _this.__data[1] = t, _this.__data[2] = a, _this.__data[3] = i;
        return _this;
    }
    Object.defineProperty(R.prototype, "x", {
        get: function () { return this.__data[0]; },
        set: function (e) { this.__data[0] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(R.prototype, "y", {
        get: function () { return this.__data[1]; },
        set: function (e) { this.__data[1] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(R.prototype, "z", {
        get: function () { return this.__data[2]; },
        set: function (e) { this.__data[2] = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(R.prototype, "w", {
        get: function () { return this.__data[3]; },
        set: function (e) { this.__data[3] = e; },
        enumerable: true,
        configurable: true
    });
    R.prototype.set = function (e, t, a, i) { this.__data[0] = e, this.__data[1] = t, this.__data[2] = a, this.__data[3] = i; };
    R.prototype.setDataArray = function (e) { this.__data = e; };
    R.prototype.setFromOther = function (e) { this.__data[0] = e.x, this.__data[1] = e.y, this.__data[2] = e.z, this.__data[3] = e.w; };
    R.prototype.setFromEulerAngles = function (e) { var t = new Z; switch (e.order) {
        case 0:
            t.set(e.x, -e.y, e.z);
            break;
        case 1:
            t.set(e.y, -e.z, e.x);
            break;
        case 2:
            t.set(e.z, -e.x, e.y);
            break;
        case 3:
            t.set(e.x, e.z, e.y);
            break;
        case 4:
            t.set(e.z, e.y, e.x);
            break;
        case 5:
            t.set(e.y, e.x, e.z);
            break;
        default: throw new Error("sdrty");
    } var a = .5 * t.x, i = .5 * t.y, s = .5 * t.z, n = Math.cos(a), l = Math.cos(i), r = Math.cos(s), o = Math.sin(a), d = Math.sin(i), h = Math.sin(s), c = n * r, m = n * h, u = o * r, b = o * h, p = l * u - d * m, g = l * b + d * c, _ = l * m - d * u; switch (this.w = l * c + d * b, e.order) {
        case 0:
            this.x = p, this.y = -g, this.z = _;
            break;
        case 1:
            this.x = _, this.y = p, this.z = -g;
            break;
        case 2:
            this.x = -g, this.y = _, this.z = p;
            break;
        case 3:
            this.x = p, this.y = _, this.z = g;
            break;
        case 4:
            this.x = _, this.y = g, this.z = p;
            break;
        case 5:
            this.x = g, this.y = p, this.z = _;
            break;
        default: throw new Error("sdrty");
    } };
    R.prototype.toEulerAngles = function (e) { var t = new Z; switch (e) {
        case 0:
            t.set(this.z, this.x, this.y);
            break;
        case 1:
            t.set(this.x, this.y, this.z);
            break;
        case 2:
            t.set(this.y, this.z, this.x);
            break;
        case 3:
            t.set(this.y, -this.x, this.z);
            break;
        case 4:
            t.set(this.x, -this.z, this.y);
            break;
        case 5:
            t.set(this.z, -this.y, this.x);
            break;
        default: throw new Error("Invalid rotation order:" + e);
    } var a = new Z, i = t.x * t.y + t.z * this.w; if (i > .49999)
        a.y = 2 * Math.atan2(t.x, this.w), a.z = .5 * Math.PI, a.x = 0;
    else if (i < -.49999)
        a.y = -2 * Math.atan2(t.x, this.w), a.z = -.5 * Math.PI, a.x = 0;
    else {
        var e_3 = t.x * t.x, s = t.y * t.y, n = t.z * t.z;
        a.y = Math.atan2(2 * t.y * this.w - 2 * t.x * t.z, 1 - 2 * s - 2 * n), a.z = Math.asin(2 * i), a.x = Math.atan2(2 * t.x * this.w - 2 * t.y * t.z, 1 - 2 * e_3 - 2 * n);
    } switch (e) {
        case 0: return new f(a.y, a.z, a.x, e);
        case 1: return new f(a.x, a.y, a.z, e);
        case 2: return new f(a.z, a.x, a.y, e);
        case 3: return new f(-a.y, a.x, a.z, e);
        case 4: return new f(a.x, a.z, -a.y, e);
        case 5: return new f(a.z, -a.y, a.x, e);
    } };
    R.prototype.setFromAxisAndAngle = function (e, t) { var a = t / 2, i = e.normalize().scale(Math.sin(a)); this.set(i.x, i.y, i.z, Math.cos(a)); };
    R.prototype.setFromDirectionAndUpvector = function (e, t) { var a = new V; a.setFromDirectionAndUpvector(e, t), this.setFromMat3(a); };
    R.prototype.setFrom2Vectors = function (e, t) { e.normalize(), t.normalize(); var a = e.cross(t), i = e.dot(t), s = Math.sqrt(2 * (1 + i)); this.set(a.x / s, a.y / s, a.z / s, s / 2), this.normalizeInPlace(); };
    R.prototype.setFromMat3 = function (e) { var t = e.__data[0] + e.__data[4] + e.__data[8]; var a; if (t > 0)
        a = Math.sqrt(t + 1), this.__data[3] = .5 * a, a = .5 / a, this.__data[0] = (e.__data[5] - e.__data[7]) * a, this.__data[1] = (e.__data[6] - e.__data[2]) * a, this.__data[2] = (e.__data[1] - e.__data[3]) * a;
    else {
        var t_7 = 0;
        e.__data[4] > e.__data[0] && (t_7 = 1), e.__data[8] > e.__data[3 * t_7 + t_7] && (t_7 = 2);
        var i_10 = (t_7 + 1) % 3, s = (t_7 + 2) % 3;
        a = Math.sqrt(e.__data[3 * t_7 + t_7] - e.__data[3 * i_10 + i_10] - e.__data[3 * s + s] + 1), this.__data[t_7] = .5 * a, a = .5 / a, this.__data[3] = (e.__data[3 * i_10 + s] - e.__data[3 * s + i_10]) * a, this.__data[i_10] = (e.__data[3 * i_10 + t_7] + e.__data[3 * t_7 + i_10]) * a, this.__data[s] = (e.__data[3 * s + t_7] + e.__data[3 * t_7 + s]) * a;
    } this.normalizeInPlace(); };
    R.prototype.setFromMat4 = function (e) { var t = e.__data[0] + e.__data[5] + e.__data[10]; var a; if (t > 0)
        a = Math.sqrt(t + 1), this.__data[3] = .5 * a, a = .5 / a, this.__data[0] = (e.__data[6] - e.__data[9]) * a, this.__data[1] = (e.__data[8] - e.__data[2]) * a, this.__data[2] = (e.__data[1] - e.__data[4]) * a;
    else {
        var t_8 = 0;
        e.__data[5] > e.__data[0] && (t_8 = 1), e.__data[10] > e.__data[4 * t_8 + t_8] && (t_8 = 2);
        var i_11 = (t_8 + 1) % 3, s = (t_8 + 2) % 3;
        a = Math.sqrt(e.__data[4 * t_8 + t_8] - e.__data[4 * i_11 + i_11] - e.__data[4 * s + s] + 1), this.__data[t_8] = .5 * a, a = .5 / a, this.__data[3] = (e.__data[4 * i_11 + s] - e.__data[4 * s + i_11]) * a, this.__data[i_11] = (e.__data[4 * i_11 + t_8] + e.__data[4 * t_8 + i_11]) * a, this.__data[s] = (e.__data[4 * s + t_8] + e.__data[4 * t_8 + s]) * a;
    } this.normalizeInPlace(); };
    R.prototype.isIdentity = function () { return this.getAngle() < Number.EPSILON; };
    R.prototype.getAngle = function () { return 2 * Math.acos(this.w); };
    R.prototype.equal = function (e) { return this.x == e.x && this.y == e.y && this.z == e.z && this.w == e.w; };
    R.prototype.notequals = function (e) { return this.x != e.x && this.y != e.y && this.z != e.z && this.w != e.w; };
    R.prototype.approxEqual = function (e, t) {
        if (t === void 0) { t = Number.EPSILON; }
        return Math.abs(this.x - e.x) < t && Math.abs(this.y - e.y) < t && Math.abs(this.z - e.z) < t && Math.abs(this.w - e.w) < t;
    };
    R.prototype.add = function (e) { return new R(this.x + e.x, this.y + e.y, this.z + e.z, this.w + e.w); };
    R.prototype.addInPlace = function (e) { this.x += e.x, this.y += e.y, this.z += e.z, this.w += e.w; };
    R.prototype.subtract = function (e) { return new R(this.x - e.x, this.y - e.y, this.z - e.z, this.w - e.w); };
    R.prototype.scale = function (e) { return new R(this.x * e, this.y * e, this.z * e, this.w * e); };
    R.prototype.scaleInPlace = function (e) { this.x *= e, this.y *= e, this.z *= e, this.w *= e; };
    R.prototype.length = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3]; return Math.sqrt(e * e + t * t + a * a + i * i); };
    R.prototype.lengthSquared = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3]; return e * e + t * t + a * a + i * i; };
    R.prototype.normalize = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3]; var s = e * e + t * t + a * a + i * i; return s < Number.EPSILON ? new R : (s = 1 / Math.sqrt(s), new R(e * s, t * s, a * s)); };
    R.prototype.normalizeInPlace = function () { var e = this.__data[0], t = this.__data[1], a = this.__data[2], i = this.__data[3]; var s = e * e + t * t + a * a + i * i; s < Number.EPSILON || (s = 1 / Math.sqrt(s), this.set(e * s, t * s, a * s, i * s)); };
    R.prototype.dot = function (e) { return this.x * e.x + this.y * e.y + this.z * e.z + this.w * e.w; };
    R.prototype.cross = function (e) { var t = this.x, a = this.y, i = this.z, s = this.w, n = e.x, l = e.y, r = e.z, o = e.w; return new R(a * r - i * l, i * o - s * r, s * n - t * o, t * l - a * n); };
    R.prototype.conjugate = function () { return new R(-this.x, -this.y, -this.z, this.w); };
    R.prototype.inverse = function () { return this.conjugate(); };
    R.prototype.alignWith = function (e) { this.dot(e) < 0 && this.set(-this.x, -this.y, -this.z, -this.w); };
    R.prototype.multiply = function (e) { var t = this.__data[0], a = this.__data[1], i = this.__data[2], s = this.__data[3], n = e.__data[0], l = e.__data[1], r = e.__data[2], o = e.__data[3]; return new R(t * o + s * n + a * r - i * l, a * o + s * l + i * n - t * r, i * o + s * r + t * l - a * n, s * o - t * n - a * l - i * r); };
    R.prototype.multiplyInPlace = function (e) { var t = this.__data[0], a = this.__data[1], i = this.__data[2], s = this.__data[3], n = e.__data[0], l = e.__data[1], r = e.__data[2], o = e.__data[3]; this.set(t * o + s * n + a * r - i * l, a * o + s * l + i * n - t * r, i * o + s * r + t * l - a * n, s * o - t * n - a * l - i * r); };
    R.prototype.rotateVec3 = function (e) { var t = new R(e.x, e.y, e.z, 0), a = this.multiply(t).multiply(this.conjugate()); return new Z(a.x, a.y, a.z); };
    R.prototype.rotateX = function (e) { e *= .5; var t = this.x, a = this.y, i = this.z, s = this.w, n = Math.sin(e), l = Math.cos(e); this.x = t * l + s * n, this.y = a * l + i * n, this.z = i * l - a * n, this.w = s * l - t * n; };
    R.prototype.rotateY = function (e) { e *= .5; var t = this.x, a = this.y, i = this.z, s = this.w, n = Math.sin(e), l = Math.cos(e); this.x = t * l - i * n, this.y = a * l + s * n, this.z = i * l + t * n, this.w = s * l - a * n; };
    R.prototype.rotateZ = function (e) { e *= .5; var t = this.x, a = this.y, i = this.z, s = this.w, n = Math.sin(e), l = Math.cos(e); this.x = t * l + a * n, this.y = a * l - t * n, this.z = i * l + s * n, this.w = s * l - i * n; };
    R.prototype.toMat3 = function () { var e = this.x, t = this.y, a = this.z, i = this.w, s = e + e, n = t + t, l = a + a, r = e * s, o = t * s, d = t * n, h = a * s, c = a * n, m = a * l, u = i * s, b = i * n, p = i * l, g = new V; return g.__data[0] = 1 - d - m, g.__data[3] = o - p, g.__data[6] = h + b, g.__data[1] = o + p, g.__data[4] = 1 - r - m, g.__data[7] = c - u, g.__data[2] = h - b, g.__data[5] = c + u, g.__data[8] = 1 - r - d, g; };
    R.prototype.getXaxis = function () { var e = this.x * this.y, t = this.x * this.z, a = this.y * this.y, i = this.y * this.w, s = this.z * this.z, n = this.z * this.w; return new Z(1 - 2 * (s + a), 2 * (e + n), 2 * (t - i)); };
    R.prototype.getYaxis = function () { var e = this.x * this.x, t = this.x * this.y, a = this.x * this.w, i = this.y * this.z, s = this.z * this.z, n = this.z * this.w; return new Z(2 * (t - n), 1 - 2 * (s + e), 2 * (i + a)); };
    R.prototype.getZaxis = function () { var e = this.x * this.x, t = this.x * this.z, a = this.x * this.w, i = this.y * this.y, s = this.y * this.z, n = this.y * this.w; new Z; return new Z(2 * (n + t), 2 * (s - a), 1 - 2 * (i + e)); };
    R.prototype.mirror = function (e) { switch (e) {
        case 0: return new R(this.z, this.w, this.x, this.y);
        case 1: return new R(-this.w, this.z, this.y, -this.x);
        case 2: return new R(this.x, this.y, this.z, -this.w);
    } };
    R.prototype.toMat4 = function () { var e = this.x, t = this.y, a = this.z, i = this.w, s = e + e, n = t + t, l = a + a, r = e * s, o = t * s, d = t * n, h = a * s, c = a * n, m = a * l, u = i * s, b = i * n, p = i * l, g = new I; return g.__data[0] = 1 - d - m, g.__data[4] = o - p, g.__data[8] = h + b, g.__data[1] = o + p, g.__data[5] = 1 - r - m, g.__data[9] = c - u, g.__data[2] = h - b, g.__data[6] = c + u, g.__data[10] = 1 - r - d, g; };
    R.prototype.lerp = function (e, t) { var a = new R(this.x + t * (e.x - this.x), this.y + t * (e.y - this.y), this.z + t * (e.z - this.z), this.w + t * (e.w - this.w)); return a.normalizeInPlace(), a; };
    R.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (R.bind.apply(R, __spreadArrays([void 0], e)))();
    };
    R.createFromFloat32Buffer = function (e, t) {
        if (t === void 0) { t = 0; }
        return new R(e, 4 * t);
    };
    R.numElements = function () { return 4; };
    R.prototype.clone = function () { return new R(this.__data[0], this.__data[1], this.__data[2], this.__data[3]); };
    R.prototype.toJSON = function () { return { x: this.x, y: this.y, z: this.z, w: this.w }; };
    R.prototype.fromJSON = function (e) { this.__data[0] = e.x, this.__data[1] = e.y, this.__data[2] = e.z, this.__data[3] = e.w, this.normalizeInPlace(); };
    return R;
}(p));
g.registerType("Quat", R);
var x = /** @class */ (function () {
    function x(e, t) {
        this.start = e instanceof Z ? e : new Z, this.dir = t instanceof Z ? t : new Z;
    }
    x.prototype.closestPoint = function (e) { var t = e.subtract(this.start).dot(this.dir); if (t < Number.EPSILON)
        return this.start; var a = t / this.dir.dot(this.dir); return this.start.add(this.dir.scale(a)); };
    x.prototype.pointAtDist = function (e) { return this.start.add(this.dir.scale(e)); };
    x.prototype.intersectRayVector = function (e) { var t = this.dir, a = e.dir, i = this.start.subtract(e.start), s = t.dot(t), n = t.dot(a), l = a.dot(a), r = t.dot(i), o = a.dot(i); if (0 == s && 0 == l)
        return this.start.distanceTo(e.start); if (0 == s)
        return e.closestPoint(this.start); if (0 == l)
        return this.closestPoint(e.start); var d = s * l - n * n; var h, c; return d < .001 ? (h = 0, c = n > l ? r / n : o / l) : (h = (n * o - l * r) / d, c = (s * o - n * r) / d), [h, c]; };
    x.prototype.intersectRayPlane = function (e) { var t = this.start.subtract(e.start), a = e.dir.dot(this.dir), i = -e.dir.dot(t); if (Math.abs(a) < Number.PRECISION)
        return -1; var s = i / a; return s < -Number.PRECISION ? -1 : s; };
    x.prototype.clone = function () { return new x(this.start.clone(), this.dir.clone()); };
    x.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (x.bind.apply(x, __spreadArrays([void 0], e)))();
    };
    x.prototype.toJSON = function () { return { start: this.start, dir: this.dir }; };
    x.prototype.fromJSON = function (e) { this.start.fromJSON(e.start), this.dir.fromJSON(e.dir); };
    x.prototype.toString = function () { return u(this.toJSON()); };
    return x;
}());
g.registerType("Ray", x);
new Z(1, 1, 1);
var S = /** @class */ (function () {
    function S(e, t, a) {
        if (e instanceof Float32Array)
            this.setFromFloat32Array(e);
        else {
            if (e instanceof Z)
                this.tr = e;
            else {
                if (e instanceof R && null == t && null == a)
                    return this.tr = new Z, this.ori = e, void (this.sc = new Z(1, 1, 1));
                this.tr = new Z;
            }
            this.ori = t instanceof R ? t : new R, this.sc = a instanceof Z ? a : new Z(1, 1, 1);
        }
    }
    S.prototype.set = function (e, t, a) { this.tr = e, this.ori = t, a instanceof Z && (this.sc = a); };
    S.prototype.setFromOther = function (e) { this.tr = e.tr, this.ori = e.ori, this.sc = e.sc; };
    S.prototype.isIdentity = function () { return this.tr.isNull() && this.ori.isIdentity() && this.sc.is111(); };
    S.prototype.setLookAt = function (e, t, a) { var i = e.subtract(t); if (i.length() < Number.EPSILON)
        throw new Error("Invalid dir"); this.ori.setFromDirectionAndUpvector(i, a), this.tr = e; };
    S.prototype.multiply = function (e) { var t = this.sc; return this.sc.x == this.sc.y && this.sc.x == this.sc.z || (t = e.ori.rotateVec3(this.sc), Math.sign(t.x) != Math.sign(this.sc.x) && (t.x = -t.x), Math.sign(t.y) != Math.sign(this.sc.y) && (t.y = -t.y), Math.sign(t.z) != Math.sign(this.sc.z) && (t.z = -t.z)), new S(this.tr.add(this.ori.rotateVec3(t.multiply(e.tr))), this.ori.multiply(e.ori), t.multiply(e.sc)); };
    S.prototype.inverse = function () { var e = new S; return e.ori = this.ori.inverse(), this.sc.x != this.sc.y || this.sc.x != this.sc.z ? (e.sc = e.ori.rotateVec3(this.sc), Math.sign(e.sc.x) != Math.sign(this.sc.x) && (e.sc.x = -e.sc.x), Math.sign(e.sc.y) != Math.sign(this.sc.y) && (e.sc.y = -e.sc.y), Math.sign(e.sc.z) != Math.sign(this.sc.z) && (e.sc.z = -e.sc.z)) : e.sc = this.sc.inverse(), e.tr = e.ori.rotateVec3(this.tr.negate().multiply(e.sc)), e; };
    S.prototype.transformVec3 = function (e) { return this.tr.add(this.ori.rotateVec3(this.sc.multiply(e))); };
    S.prototype.toMat4 = function () { var e = new I(this.sc.x, 0, 0, 0, 0, this.sc.y, 0, 0, 0, 0, this.sc.z, 0, 0, 0, 0, 1), t = this.ori.toMat4(), a = new I; return a.translation = this.tr, a.multiply(t).multiply(e); };
    S.prototype.fromMat4 = function (e) { this.tr = e.translation, this.ori.setFromMat4(e); };
    S.prototype.setFromFloat32Array = function (e) { if (7 == e.length)
        return this.tr = new Z(e.buffer, e.byteOffset), this.ori = new R(e.buffer, e.byteOffset + 12), void (this.sc = new Z(1, 1, 1)); if (8 != e.length)
        return 10 == e.length ? (this.tr = new Z(e.buffer, e.byteOffset), this.ori = new R(e.buffer, e.byteOffset + 12), void (this.sc = new Z(e.buffer, e.byteOffset + 21))) : void 0; {
        this.tr = new Z(e.buffer, e.byteOffset), this.ori = new R(e.buffer, e.byteOffset + 12);
        var t_9 = e[7];
        this.sc = new Z(t_9, t_9, t_9);
    } };
    S.prototype.clone = function () { return new S(this.tr.clone(), this.ori.clone(), this.sc.clone()); };
    S.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (S.bind.apply(S, __spreadArrays([void 0], e)))();
    };
    S.prototype.toJSON = function () { var e = { tr: this.tr.toJSON(), ori: this.ori.toJSON() }; return this.sc.is111() || (e.sc = this.sc.toJSON()), e; };
    S.prototype.fromJSON = function (e) { this.tr.fromJSON(e.tr), this.ori.fromJSON(e.ori), e.sc && this.sc.fromJSON(e.sc); };
    S.prototype.toString = function () { return u(this.toJSON()); };
    return S;
}());
g.registerType("Xfo", S);
var W = /** @class */ (function () {
    function W(e, t) {
        this.p0 = e instanceof _ ? e : new _(Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY), this.p1 = t instanceof _ ? t : new _(Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY);
    }
    W.prototype.set = function (e, t) { this.p0 = e, this.p1 = t; };
    W.prototype.reset = function () { this.p0.x = Number.POSITIVE_INFINITY, this.p1.x = Number.NEGATIVE_INFINITY, this.p0.y = Number.POSITIVE_INFINITY, this.p1.y = Number.NEGATIVE_INFINITY; };
    W.prototype.isValid = function () { return this.p0.x != Number.POSITIVE_INFINITY && this.p1.x != Number.NEGATIVE_INFINITY && this.p0.y != Number.POSITIVE_INFINITY && this.p1.y != Number.NEGATIVE_INFINITY; };
    W.prototype.addPoint = function (e) { (this.p0.x == Number.POSITIVE_INFINITY || e.x < this.p0.x) && (this.p0.x = e.x), (this.p0.y == Number.POSITIVE_INFINITY || e.y < this.p0.y) && (this.p0.y = e.y), (this.p1.y == Number.NEGATIVE_INFINITY || e.x > this.p1.x) && (this.p1.x = e.x), (this.p1.y == Number.NEGATIVE_INFINITY || e.y > this.p1.y) && (this.p1.y = e.y); };
    W.prototype.size = function () { return this.p1.subtract(this.p0); };
    W.prototype.diagonal = function () { return this.p1.subtract(this.p0); };
    W.prototype.center = function () { var e = this.p1.subtract(this.p0); return e.scaleInPlace(.5), e.addInPlace(this.p0), e; };
    W.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (W.bind.apply(W, __spreadArrays([void 0], e)))();
    };
    W.prototype.toJSON = function () { return { p0: this.p0.toJSON(), p1: this.p1.toJSON() }; };
    W.prototype.toString = function () { return u(this.toJSON()); };
    return W;
}());
g.registerType("Box2", W);
var L = /** @class */ (function (_super) {
    __extends(L, _super);
    function L(e, t) {
        if (t === void 0) { t = 0; }
        var _this = this;
        _this = _super.call(this) || this, _this.pos = e instanceof Z ? e : new Z, _this.radius = t;
        return _this;
    }
    L.prototype.clone = function () { return new Sphere(this.pos.clone(), this.radius); };
    L.prototype.intersectsBox = function (e) { return e.intersectsSphere(this); };
    L.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (Sphere.bind.apply(Sphere, __spreadArrays([void 0], e)))();
    };
    L.prototype.toJSON = function () { return { pos: this.pos.toJSON(), radius: this.radius }; };
    L.prototype.toString = function () { return u(this.toJSON()); };
    return L;
}(p));
g.registerType("SphereType", L);
var v = /** @class */ (function () {
    function v(e, t) {
        e instanceof Float32Array ? this.setFromFloat32Array(e) : (this.p0 = e instanceof Z ? e : new Z(Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY), this.p1 = t instanceof Z ? t : new Z(Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY));
    }
    Object.defineProperty(v.prototype, "min", {
        get: function () { return this.p0; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(v.prototype, "max", {
        get: function () { return this.p1; },
        enumerable: true,
        configurable: true
    });
    v.prototype.set = function (e, t) { this.p0 = e, this.p1 = t; };
    v.prototype.reset = function () { this.p0.x = Number.POSITIVE_INFINITY, this.p1.x = Number.NEGATIVE_INFINITY, this.p0.y = Number.POSITIVE_INFINITY, this.p1.y = Number.NEGATIVE_INFINITY, this.p0.z = Number.POSITIVE_INFINITY, this.p1.z = Number.NEGATIVE_INFINITY; };
    v.prototype.isValid = function () { return this.p0.x != Number.POSITIVE_INFINITY && this.p1.x != Number.NEGATIVE_INFINITY && this.p0.y != Number.POSITIVE_INFINITY && this.p1.y != Number.NEGATIVE_INFINITY && this.p0.z != Number.POSITIVE_INFINITY && this.p1.z != Number.NEGATIVE_INFINITY; };
    v.prototype.addPoint = function (e) { e.x != Number.POSITIVE_INFINITY && e.x != Number.NEGATIVE_INFINITY && (e.x < this.p0.x && (this.p0.x = e.x), e.x > this.p1.x && (this.p1.x = e.x)), e.y != Number.POSITIVE_INFINITY && e.y != Number.NEGATIVE_INFINITY && (e.y < this.p0.y && (this.p0.y = e.y), e.y > this.p1.y && (this.p1.y = e.y)), e.z != Number.POSITIVE_INFINITY && e.z != Number.NEGATIVE_INFINITY && (e.z < this.p0.z && (this.p0.z = e.z), e.z > this.p1.z && (this.p1.z = e.z)); };
    v.prototype.addBox3 = function (e, t) { t ? (this.addPoint(t.transformVec3(e.p0)), this.addPoint(t.transformVec3(new Z(e.p0.x, e.p0.y, e.p1.z))), this.addPoint(t.transformVec3(new Z(e.p0.x, e.p1.y, e.p0.z))), this.addPoint(t.transformVec3(new Z(e.p1.x, e.p0.y, e.p0.z))), this.addPoint(t.transformVec3(new Z(e.p0.x, e.p1.y, e.p1.z))), this.addPoint(t.transformVec3(new Z(e.p1.x, e.p0.y, e.p1.z))), this.addPoint(t.transformVec3(new Z(e.p1.x, e.p1.y, e.p0.z))), this.addPoint(t.transformVec3(e.p1))) : (this.addPoint(e.p0), this.addPoint(e.p1)); };
    v.prototype.size = function () { return this.p1.subtract(this.p0); };
    v.prototype.diagonal = function () { return this.p1.subtract(this.p0); };
    v.prototype.center = function () { var e = this.p1.subtract(this.p0); return e.scaleInPlace(.5), e.addInPlace(this.p0), e; };
    v.prototype.toMat4 = function () { var e = this.p1.x - this.p0.x, t = this.p1.y - this.p0.y, a = this.p1.z - this.p0.z; return new I(e, 0, 0, 0, 0, t, 0, 0, 0, 0, a, 0, this.p0.x, this.p0.y, this.p0.z, 1); };
    v.prototype.getBoundingSphere = function () { return new L(this.center(), .5 * this.diagonal().length()); };
    v.prototype.intersectsBox = function (e) { return !(e.max.x < this.min.x || e.min.x > this.max.x || e.max.y < this.min.y || e.min.y > this.max.y || e.max.z < this.min.z || e.min.z > this.max.z); };
    v.prototype.intersectsSphere = function (e) { return closestPoint.distanceToSquared(e.center) <= e.radius * e.radius; };
    v.prototype.intersectsPlane = function (e) { var t, a; return e.normal.x > 0 ? (t = e.normal.x * this.min.x, a = e.normal.x * this.max.x) : (t = e.normal.x * this.max.x, a = e.normal.x * this.min.x), e.normal.y > 0 ? (t += e.normal.y * this.min.y, a += e.normal.y * this.max.y) : (t += e.normal.y * this.max.y, a += e.normal.y * this.min.y), e.normal.z > 0 ? (t += e.normal.z * this.min.z, a += e.normal.z * this.max.z) : (t += e.normal.z * this.max.z, a += e.normal.z * this.min.z), t <= -e.constant && a >= -e.constant; };
    v.prototype.clone = function () { return new v(this.p0.clone(), this.p1.clone()); };
    v.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (v.bind.apply(v, __spreadArrays([void 0], e)))();
    };
    v.sizeInBytes = function () { return 24; };
    v.prototype.toJSON = function () { return { p0: this.p0.toJSON(), p1: this.p1.toJSON() }; };
    v.prototype.fromJSON = function (e) { this.p0.fromJSON(e.p0), this.p1.fromJSON(e.p1); };
    v.prototype.loadBin = function (e, t) { this.p0.loadBin(e, t), this.p0.loadBin(e, t + 12); };
    v.prototype.setFromFloat32Array = function (e) { this.p0 = new Z(e.buffer, e.byteOffset), this.p1 = new Z(e.buffer, e.byteOffset + 12); };
    v.prototype.toString = function () { return u(this.toJSON()); };
    return v;
}());
g.registerType("Box3", v);
var M = /** @class */ (function (_super) {
    __extends(M, _super);
    function M(e, t) {
        if (t === void 0) { t = 0; }
        var _this = this;
        _this = _super.call(this) || this, _this.normal = e instanceof Z ? e : new Z, _this.w = t;
        return _this;
    }
    M.prototype.set = function (e, t, a, i) { this.normal.set(e, t, a), this.w = i; };
    M.prototype.divideScalar = function (e) { this.normal.scaleInPlace(1 / e), this.w /= e; };
    M.prototype.distanceToPoint = function (e) { return e.dot(this.normal) + this.w; };
    M.prototype.normalizeInPlace = function () { var e = 1 / this.normal.length(); this.normal.scaleInPlace(e), this.w *= e; };
    M.prototype.clone = function () { return new Plane(this.normal.clone(), this.w); };
    M.create = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        return new (Plane.bind.apply(Plane, __spreadArrays([void 0], e)))();
    };
    M.prototype.toJSON = function () { return { normal: this.normal.toJSON(), w: this.w }; };
    M.prototype.toString = function () { return u(this.toJSON()); };
    return M;
}(p));
g.registerType("PlaneType", M);
var F = /** @class */ (function () {
    function F(e, t, a, i, s, n) {
        this.planes = [e || new M, t || new M, a || new M, i || new M, s || new M, n || new M];
    }
    F.prototype.setFromMatrix = function (e) { var t = e, a = this.planes; a[0].set(t.m03 - t.m00, t.m13 - t.m10, t.m23 - t.m20, t.m33 - t.m30), a[1].set(t.m03 + t.m00, t.m13 + t.m10, t.m23 + t.m20, t.m33 + t.m30), a[2].set(t.m03 + t.m01, t.m13 + t.m11, t.m23 + t.m21, t.m33 + t.m31), a[3].set(t.m03 - t.m01, t.m13 - t.m11, t.m23 - t.m21, t.m33 - t.m31), a[4].set(t.m03 - t.m02, t.m13 - t.m12, t.m23 - t.m22, t.m33 - t.m32), a[5].set(t.m03 + t.m02, t.m13 + t.m12, t.m23 + t.m22, t.m33 + t.m32), a.forEach(function (e) { return e.normalizeInPlace(); }); };
    F.prototype.intersectsBox = function (e) { var t = new Z, a = this.planes, i = e.min, s = e.max; for (var e_4 = 0; e_4 < 6; e_4++) {
        var n = a[e_4];
        if (t.x = n.normal.x > 0 ? s.x : i.x, t.y = n.normal.y > 0 ? s.y : i.y, t.z = n.normal.z > 0 ? s.z : i.z, n.distanceToPoint(t) < 0)
            return !1;
    } return !0; };
    F.prototype.toJSON = function () { return { p0: this.p0.toJSON(), p1: this.p1.toJSON(), p2: this.p2.toJSON(), p3: this.p3.toJSON(), p4: this.p4.toJSON(), p5: this.p5.toJSON() }; };
    F.prototype.fromJSON = function (e) { this.p0.fromJSON(e.p0), this.p1.fromJSON(e.p1), this.p2.fromJSON(e.p2), this.p3.fromJSON(e.p3), this.p4.fromJSON(e.p4), this.p5.fromJSON(e.p5); };
    F.prototype.toString = function () { return u(this.toJSON()); };
    return F;
}());
g.registerType("Frustum", F);
var T = Object.freeze({ __proto__: null, UInt8: 0, SInt8: 1, SInt16: 3, UInt16: 2, SInt32: 5, UInt32: 4, Float32: 6, hashStr: m, JSON_stringify_fixedPrecision: u, AttrValue: p, Vec2: _, Vec3: Z, Vec4: G, RGBA: X, Color: y, EulerAngles: f, Quat: R, Ray: x, Mat3: V, Mat4: I, Xfo: S, Box2: W, Box3: v, Frustum: F, PlaneType: M, SphereType: L, typeRegistry: g });
var C = /** @class */ (function () {
    function C(e) {
        if (e === void 0) { e = !1; }
        this.__slots = [], this.__toggledSignal = e, this.__toggled = !1, this.__data = null, this.connect = this.connect.bind(this), this.disconnect = this.disconnect.bind(this), this.emit = this.emit.bind(this);
    }
    C.prototype.connect = function (e) { if (null == e)
        throw new Error("a function callback must be passed to Signal.connect"); if (-1 != this.__slots.indexOf(e))
        return void console.warn("fn '" + e.name + "' already connected to Signal."); var t = this.__slots.length; return this.__slots[t] = e, this.__toggledSignal && this.__toggled && (this.__data ? e.apply(void 0, this.__data) : e()), t; };
    C.prototype.disconnect = function (e) { if (null == e)
        throw new Error("a function callback must be passed to Signal.disconnect"); var t = []; if (this.__slots.forEach((function (a, i) { a === e && t.push(i); })), 0 != t.length)
        for (var _b = 0, t_10 = t; _b < t_10.length; _b++) {
            var e_5 = t_10[_b];
            this.__slots[e_5] = void 0;
        }
    else
        console.warn("callback :" + e.name + " was not connected to this signal:" + this.__name); };
    C.prototype.disconnectId = function (e) { if (!this.__slots[e])
        throw new Error("Invalid ID"); this.__slots[e] = void 0; };
    C.prototype.emit = function () {
        var e = [];
        for (var _b = 0; _b < arguments.length; _b++) {
            e[_b] = arguments[_b];
        }
        this.__toggledSignal && (this.__toggled ? console.warn("Toggled signals should only be fired once, or untoggled before re-firing..") : (this.__toggled = !0, this.__data = e));
        var t = this.__slots.length;
        for (var a_12 = 0; a_12 < t; a_12++) {
            var t_11 = this.__slots[a_12];
            t_11 && t_11.apply(void 0, e);
        }
    };
    C.prototype.isToggled = function () { return this.__toggled; };
    C.prototype.setToggled = function (e) { this.__toggled = e, this.__data = void 0; };
    C.prototype.getNumConnections = function () { return this.__slots.length; };
    C.prototype.untoggle = function () { this.__toggled = !1, this.__data = void 0; };
    return C;
}());
var Y = /** @class */ (function () {
    function Y(e, t) {
        if (e === void 0) { e = 0; }
        if (t === void 0) { t = 0; }
        this.root = { x: 0, y: 0, w: e, h: t }, this.resized = new C;
    }
    Y.prototype.fit = function (e) {
        var _this = this;
        if (0 == e.length)
            return;
        var t = !1;
        this.root.w < e[0].w && (this.root.w = e[0].w, t = !0), this.root.h < e[0].h && (this.root.h = e[0].h, t = !0), t && this.resized.emit(this.root.w, this.root.h);
        e.forEach(function (e) { e.fit = _this.__addBlock(e); });
    };
    Y.prototype.__addBlock = function (e) { var t = this.findNode(this.root, e.w, e.h); return t ? this.splitNode(t, e.w, e.h) : this.growNode(e.w, e.h); };
    Y.prototype.addBlock = function (e) { var t = !1; this.root.w < e.w && (this.root.w = e.w, t = !0), this.root.h < e.h && (this.root.h = e.h, t = !0), t && this.resized.emit(this.root.w, this.root.h); var a = this.findNode(this.root, e.w, e.h); return a ? this.splitNode(a, e.w, e.h) : this.growNode(e.w, e.h); };
    Y.prototype.findNode = function (e, t, a) { return e.used ? this.findNode(e.right, t, a) || this.findNode(e.down, t, a) : t <= e.w && a <= e.h ? e : null; };
    Y.prototype.splitNode = function (e, t, a) { return e.used = !0, e.down = { x: e.x, y: e.y + a, w: e.w, h: e.h - a }, e.right = { x: e.x + t, y: e.y, w: e.w - t, h: a }, e; };
    Y.prototype.growNode = function (e, t) { var a = e <= this.root.w, i = t <= this.root.h, s = i && this.root.h >= this.root.w + e, n = a && this.root.w >= this.root.h + t; return s ? this.growRight(e, t) : n ? this.growDown(e, t) : i ? this.growRight(e, t) : a ? this.growDown(e, t) : null; };
    Y.prototype.growRight = function (e, t) { this.root = { used: !0, x: 0, y: 0, w: this.root.w + e, h: this.root.h, down: this.root, right: { x: this.root.w, y: 0, w: e, h: this.root.h } }; var a = this.findNode(this.root, e, t); var i; return a && (i = this.splitNode(a, e, t)), this.resized.emit(this.root.w, this.root.h), i; };
    Y.prototype.growDown = function (e, t) { this.root = { used: !0, x: 0, y: 0, w: this.root.w, h: this.root.h + t, down: { x: 0, y: this.root.h, w: this.root.w, h: t }, right: this.root }; var a = this.findNode(this.root, e, t); var i; return a && (i = this.splitNode(a, e, t)), this.resized.emit(this.root.w, this.root.h), i; };
    return Y;
}());
var N = /** @class */ (function () {
    function N(e) {
        if (e === void 0) { e = 0; }
        this.__asyncCount = e, this.ready = new C(!0), this.incAsyncCount = function (e) {
            if (e === void 0) { e = 1; }
            this.__asyncCount += e, this.ready.setToggled(!1);
        }.bind(this), this.decAsyncCount = function () { this.__asyncCount > 0 && (this.__asyncCount--, 0 == this.__asyncCount && this.__asyncsCompleted()); }.bind(this), this.__asyncsCompleted = function () { this.ready.emit(); }.bind(this);
    }
    Object.defineProperty(N.prototype, "count", {
        get: function () { return this.__asyncCount; },
        enumerable: true,
        configurable: true
    });
    return N;
}());
var K = function (e) { if (window.TextDecoder)
    return new TextDecoder("utf-8").decode(e); {
    var t_12 = "";
    for (var a_13 = 0; a_13 < e.length; a_13++)
        t_12 += String.fromCharCode(e[a_13]);
    return t_12;
} };
var w = Object.freeze({ __proto__: null, GrowingPacker: Y, Async: N, Signal: C, decodeText: K });
var z = 0;
var U = /** @class */ (function () {
    function U() {
        if ("RefCounted" == this.constructor.name)
            throw new Error("RefCounted should not be instantiated directly.");
        this.__id = ++z, this.__refs = [], this.destructing = new C, this.__destroyed = !1;
    }
    U.prototype.getId = function () { return this.__id; };
    U.prototype.numRefs = function () { return this.__refs.length; };
    U.prototype.addRef = function (e) { if (!e)
        throw new Error("Error in RefCounted.addRef: Must provide a referer"); return this.__refs.push(e), !0; };
    U.prototype.removeRef = function (e) { if (!e)
        throw new Error("Error in RefCounted.removeRef: Must provide a referer"); var t = this.__refs.indexOf(e); if (-1 == t)
        throw new Error("Error in RefCounted.removeRef: referer not found in refs list."); this.__refs.splice(t, 1), 0 == this.__refs.length && this.destroy(); };
    U.prototype.getRefer = function (e) { return this.__refs[e]; };
    U.prototype.getRefIndex = function (e) { return this.__refs.indexOf(e); };
    U.prototype.isDestroyed = function () { return this.__destroyed; };
    U.prototype.destroy = function () { this.__destroyed = !0, this.destructing.emit(this); };
    return U;
}());
var J = new /** @class */ (function () {
    function class_2() {
        this.__registeredClasses = {}, this.__classNames = {};
    }
    class_2.prototype.registerClass = function (e, t) { this.__registeredClasses[e] = { cls: t, callbacks: [] }, this.__classNames[t.name] = e; };
    class_2.prototype.registerCallback = function (e, t) { var a = this.__registeredClasses[e]; a ? a.callbacks.push(t) : console.warn("Factory not registered:" + e); };
    class_2.prototype.getClass = function (e) { if (this.__registeredClasses[e])
        return this.__registeredClasses[e].cls; };
    class_2.prototype.getClassName = function (e) { return this.__classNames[e.constructor.name] ? this.__classNames[e.constructor.name] : e.constructor.name; };
    class_2.prototype.isConstructing = function () { return this.__constructing; };
    class_2.prototype.constructClass = function (e) {
        var _b;
        var t = this.__registeredClasses[e];
        if (!t)
            return console.warn("Factory not registered:" + e), null;
        this.__constructing = !0;
        var a = Array.prototype.slice.call(arguments, 1), i = new ((_b = t.cls).bind.apply(_b, __spreadArrays([void 0], a)))();
        return this.__constructing = !1, this.invokeCallbacks(i), i;
    };
    class_2.prototype.invokeCallbacks = function (e) { if (this.__classNames[e.constructor.name]) {
        var t_13 = this.__registeredClasses[this.__classNames[e.constructor.name]];
        for (var _b = 0, _c = t_13.callbacks; _b < _c.length; _b++) {
            var a_14 = _c[_b];
            a_14(e);
        }
    } };
    return class_2;
}()), P = { NORMAL: 0, OPERATOR_GETVALUE: 1 }, E = { USER_SETVALUE: 0, REMOTEUSER_SETVALUE: 1, USER_SETVALUE_DONE: 2, OPERATOR_SETVALUE: 3, OPERATOR_DIRTIED: 4, COMPUTED_VALUE: 4, GENERATED_VALUE: 4, DATA_LOAD: 4 }, H = { USER_EDITED: 2, DISABLED: 4 }, k = 0, B = 1, D = 2;
var O = /** @class */ (function () {
    function O(e) {
        this.__name = e, this.__cleanerFns = [], this.__boundOps = [], this.__state = k, this.__flags = 0, this.valueChanged = new C, this.nameChanged = new C, this.getName = this.getName.bind(this), this.setName = this.setName.bind(this), this.getValue = this.getValue.bind(this), this.setValue = this.setValue.bind(this);
    }
    O.prototype.getName = function () { return this.__name; };
    O.prototype.setName = function (e) { if (e != this.__name) {
        var t_14 = this.__name;
        this.__name = e, this.nameChanged.emit(this.__name, t_14);
    } };
    O.prototype.getOwner = function () { return this.ownerItem; };
    O.prototype.addOwner = function (e) { this.ownerItem = e; };
    O.prototype.getPath = function () { var e = this.getOwner(); if (e && e.getName) {
        if (e.getPath) {
            var t_15 = e.getPath().slice();
            return t_15.push(this.__name), t_15;
        }
        return [e.getName(), this.__name];
    } return [this.__name]; };
    O.prototype.setFlag = function (e) { this.__flags |= e; };
    O.prototype.clearFlag = function (e) { this.__flags &= ~e; };
    O.prototype.testFlag = function (e) { return 0 != (this.__flags & e); };
    O.prototype.getValue = function () { };
    O.prototype.setValue = function (e) { };
    O.prototype.setEnabled = function (e) { console.warn("Deprecated Method: This method will be removed soon."), e ? this.setFlag(H.DISABLED) : this.clearFlag(H.DISABLED); };
    O.prototype.isEnabled = function () { console.warn("Deprecated Method: This method will be removed soon."), this.testFlag(H.DISABLED); };
    O.prototype.bindOperator = function (e) { this.__boundOps.push(e), this.__state = B, this.valueChanged.emit(E.OPERATOR_DIRTIED); };
    O.prototype.unbindOperator = function (e) { var t = this.__boundOps.indexOf(e); if (-1 == t)
        return !1; this.__boundOps.splice(t, 1), this.__state = B, this.valueChanged.emit(E.OPERATOR_DIRTIED); };
    O.prototype.setDirty = function (e) { return -1 == this.__cleanerFns.indexOf(e) && (this.__cleanerFns.push(e), this.__state = B, this.valueChanged.emit(E.OPERATOR_DIRTIED), !0); };
    O.prototype.setDirtyFromOp = function () { return this.__state == k && (this.__state = B, this.valueChanged.emit(E.OPERATOR_DIRTIED)), !0; };
    O.prototype.isDirty = function () { return this.__state == B; };
    O.prototype._clean = function () { this.__state = D; var e = this.__cleanerFns; this.__cleanerFns = []; for (var _b = 0, e_6 = e; _b < e_6.length; _b++) {
        var t_16 = e_6[_b];
        var e_7 = t_16(this.__value);
        null != e_7 && (this.__value = e_7);
    } for (var _c = 0, _d = this.__boundOps; _c < _d.length; _c++) {
        var e_8 = _d[_c];
        e_8.evaluate();
    } this.__state = k; };
    O.prototype.removeCleanerFn = function (e) { var t = this.__cleanerFns.indexOf(e); if (-1 == t)
        return 0; this.__cleanerFns.splice(t, 1); };
    O.prototype.clone = function (e) { console.error("TOOD: implment me"); };
    O.prototype.destroy = function () { };
    return O;
}());
var Q = /** @class */ (function (_super) {
    __extends(Q, _super);
    function Q(e, t, a) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__value = t, _this.__dataType = a || t.constructor.name;
        return _this;
    }
    Q.prototype.getDataType = function () { return this.__dataType; };
    Q.prototype.getValue = function (e) {
        if (e === void 0) { e = P.NORMAL; }
        return this.__state == B && this._clean(), this.__value;
    };
    Q.prototype.setClean = function (e) { this.__value = e; };
    Q.prototype.setValue = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        this.__cleanerFns.length > 0 && (this.__cleanerFns = []), (e.fromJSON || this.__value != e) && (this.__value = e, t != E.USER_SETVALUE && t != E.REMOTEUSER_SETVALUE || this.setFlag(H.USER_EDITED), t != E.OPERATOR_SETVALUE && this.valueChanged.emit(t));
    };
    Q.prototype.setValueDone = function () { this.valueChanged.emit(E.USER_SETVALUE_DONE); };
    Q.prototype.toJSON = function (e, t) { return this.__value.toJSON ? { value: this.__value.toJSON(e, t) } : { value: this.__value }; };
    Q.prototype.fromJSON = function (e, t, a) { null != e.value ? (this.setFlag(H.USER_EDITED), e.value.type && null == this.__value && (this.__value = J.constructClass(e.value.type)), null != this.__value && this.__value.fromJSON ? (this.__value.fromJSON(e.value, t), this.valueChanged.emit(E.DATA_LOAD)) : this.setValue(e.value, E.DATA_LOAD)) : console.warn("Invalid Parameter JSON"); };
    Q.prototype.readBinary = function (e, t) { console.error("TODO"); };
    Q.prototype.clone = function (e) { var t = this.__value; return t.clone && (t = t.clone()), new Q(this.__name, t, this.__dataType); };
    return Q;
}(O));
var A = 0;
var q = /** @class */ (function () {
    function q() {
        this.__id = ++A, this.__params = [], this.__paramMapping = {}, this.__paramSignalIds = {}, this.parameterAdded = new C, this.parameterRemoved = new C, this.parameterValueChanged = new C;
    }
    q.prototype.getId = function () { return this.__id; };
    q.prototype.numParameters = function () { return this.__params.length; };
    q.prototype.getParameters = function () { return this.__params; };
    q.prototype.getParameterIndex = function (e) { return this.__paramMapping[e]; };
    q.prototype.getParameterByIndex = function (e) { return this.__params[e]; };
    q.prototype.hasParameter = function (e) { return e in this.__paramMapping; };
    q.prototype.getParameter = function (e) { var t = this.__paramMapping[e]; return -1 == t ? null : this.__params[t]; };
    q.prototype.__parameterValueChanged = function (e, t) { this.parameterValueChanged.emit(e, t); };
    q.prototype.addParameter = function (e) {
        var _this = this;
        var t = e.getName();
        return null != this.__paramMapping[t] && (console.warn("Replacing Parameter:" + t), this.removeParameter(t)), this.__paramSignalIds[t] = e.valueChanged.connect(function (t) { return _this.__parameterValueChanged(e, t); }), this.__params.push(e), this.__paramMapping[t] = this.__params.length - 1, this.parameterAdded.emit(t), e;
    };
    q.prototype.insertParameter = function (e, t) {
        var _this = this;
        var a = e.getName();
        null != this.__paramMapping[a] && (console.warn("Replacing Parameter:" + a), this.removeParameter(a)), this.__paramSignalIds[a] = e.valueChanged.connect(function (t) { return _this.__parameterValueChanged(e, t); }), this.__params.splice(t, 0, e);
        var i = {};
        for (var e_9 = 0; e_9 < this.__params.length; e_9++)
            i[this.__params[e_9].getName()] = e_9;
        return this.__paramMapping = i, this.parameterAdded.emit(a), e;
    };
    q.prototype.removeParameter = function (e) { null == this.__paramMapping[e] && console.throw("Unable to Remove Parameter:" + e); var t = this.__paramMapping[e]; this.__params[this.__paramMapping[e]].valueChanged.disconnectId(this.__paramSignalIds[e]), this.__params.splice(t, 1); var a = {}; for (var e_10 = 0; e_10 < this.__params.length; e_10++)
        a[this.__params[e_10].getName()] = e_10; this.__paramMapping = a, this.parameterRemoved.emit(e); };
    q.prototype.replaceParameter = function (e) {
        var _this = this;
        var t = e.getName(), a = this.__paramMapping[t];
        return this.__params[this.__paramMapping[t]].valueChanged.disconnectId(this.__paramSignalIds[t]), this.__paramSignalIds[t] = e.valueChanged.connect(function (t) { return _this.__parameterValueChanged(e, t); }), this.__params[a] = e, e;
    };
    q.prototype.toJSON = function (e, t) { var a = {}; var i = 0; for (var _b = 0, _c = this.__params; _b < _c.length; _b++) {
        var s = _c[_b];
        if (s.testFlag(H.USER_EDITED))
            if (s.numRefs() > 1 && 0 != s.getRefIndex(this))
                a[s.getName()] = { paramPath: e.makeRelative(s.getPath()) }, i++;
            else {
                var n = s.toJSON(e, t);
                n && (a[s.getName()] = n, i++);
            }
    } if (i > 0)
        return { params: a }; };
    q.prototype.fromJSON = function (e, t, a) {
        var _this = this;
        if (e.params) {
            var _loop_1 = function (a_15) {
                var i_12 = e.params[a_15], s = this_1.getParameter(a_15);
                s ? i_12.paramPath ? t.resolvePath(i_12.paramPath, function (e) { _this.replaceParameter(e); }, function (e) { console.warn("Unable to resolve shared parameter:" + i_12.paramPath); }) : s.fromJSON(i_12, t) : console.warn("Param not found:" + a_15);
            };
            var this_1 = this;
            for (var a_15 in e.params) {
                _loop_1(a_15);
            }
        }
    };
    q.prototype.readBinary = function (e, t) { if (t.versions["zea-engine"].greaterOrEqualThan([0, 0, 3])) {
        var a_16 = e.loadUInt32();
        for (var i_13 = 0; i_13 < a_16; i_13++) {
            var a_17 = e.loadStr(), i_14 = e.loadStr();
            var s = this.getParameter(i_14);
            if (!s) {
                if (s = J.constructClass(a_17, i_14), !s) {
                    console.error("Unable to construct prop:" + i_14 + " of type:" + a_17);
                    continue;
                }
                this.addParameter(s);
            }
            s.readBinary(e, t);
        }
    } };
    q.prototype.toString = function () { return JSON.stringify(this.toJSON(), null, 2); };
    q.prototype.copyFrom = function (e, t) { var a = e.numParameters(); for (; a--;) {
        var t_17 = e.getParameterByIndex(a), i_15 = this.getParameter(t_17.getName());
        i_15 ? i_15.setValue(t_17.getValue(), E.OPERATOR_SETVALUE) : this.addParameter(t_17.clone());
    } };
    q.prototype.destroy = function () { for (var _b = 0, _c = this.__params; _b < _c.length; _b++) {
        var e_11 = _c[_b];
        e_11.destroy();
    } _super.prototype.destroy.call(this); };
    return q;
}());
var $ = { USER_EDITED: 2, IGNORE_BBOX: 4, BIN_NODE: 8, INVISIBLE: 16 };
var ee = 0;
var te = /** @class */ (function (_super) {
    __extends(te, _super);
    function te(e) {
        var _this = this;
        _this = _super.call(this) || this, null == e && (e = J.getClassName(_this)), _this.__name = e, _this.__path = [e], _this.__ownerItem = void 0, _this.__flags = 0, _this.__selectable = !0, _this.__selected = !1, _this.selectedChanged = new C, _this.__metaData = {}, _this.nameChanged = new C, ee++;
        return _this;
    }
    te.getNumBaseItems = function () { return ee; };
    te.prototype.__parameterValueChanged = function (e, t) { _super.prototype.__parameterValueChanged.call(this, e, t), t != E.USER_SETVALUE && t != E.REMOTEUSER_SETVALUE || this.setFlag($.USER_EDITED); };
    te.prototype.getName = function () { return this.__name; };
    te.prototype.setName = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        if (this.__name != e) {
            var a_18 = this.__name;
            this.__name = e, this.__updatePath(), this.nameChanged.emit(e, a_18, t);
        }
    };
    te.prototype.__updatePath = function () { null == this.__ownerItem ? this.__path = [this.__name] : (this.__path = this.__ownerItem.getPath().slice(), this.__path.push(this.__name)); };
    te.prototype.getPath = function () { return this.__path; };
    te.prototype.setFlag = function (e) { this.__flags |= e; };
    te.prototype.clearFlag = function (e) { this.__flags &= ~e; };
    te.prototype.testFlag = function (e) { return 0 != (this.__flags & e); };
    te.prototype.resolvePath = function (e, t) { if (t == e.length)
        return this; if (">" == e[t] && t == e.length - 1)
        return this.getParameter(e[t + 1]); var a = this.getParameter(e[t]); if (a)
        return a; throw new Error("Invalid path:" + e + " member not found"); };
    te.prototype.getOwner = function () { return this.__ownerItem; };
    te.prototype.setOwner = function (e) { this.__ownerItem !== e && (this.__ownerItem = e, this.__updatePath()); };
    te.prototype.getSelectable = function () { return this.__selectable; };
    te.prototype.setSelectable = function (e) { return this.__selectable != e && (this.__selectable = e, !0); };
    te.prototype.isSelected = function () { return this.__selected; };
    te.prototype.getSelected = function () { return this.__selected; };
    te.prototype.setSelected = function (e) { this.__selected = e, this.selectedChanged.emit(this.__selected); };
    te.prototype.getMetadata = function (e) { return this.__metaData[e]; };
    te.prototype.hasMetadata = function (e) { return e in this.__metaData; };
    te.prototype.setMetadata = function (e, t) { this.__metaData[e] = t; };
    te.prototype.deleteMetadata = function (e) { delete this.__metaData[e]; };
    te.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return !a && this.testFlag($.USER_EDITED) && (a = {}), a && (a.name = this.__name, this.testFlag($.BIN_NODE) || (a.type = J.getClassName(this))), a; };
    te.prototype.fromJSON = function (e, t, a) { e.name && (this.__name = e.name), _super.prototype.fromJSON.call(this, e, t, a), this.__flags |= $.USER_EDITED; };
    te.prototype.readBinary = function (e, t) { e.loadStr(); this.setName(e.loadStr()), _super.prototype.readBinary.call(this, e, t); };
    te.prototype.clone = function (e) { throw new Error(this.constructor.name + " does not implment its clone method"); };
    te.prototype.copyFrom = function (e, t) { _super.prototype.copyFrom.call(this, e, t), this.setName(e.getName()); };
    te.prototype.destroy = function () { _super.prototype.destroy.call(this); };
    return te;
}(q));
var ae = function (e) { return e.substring(0, e.lastIndexOf("/")) + "/"; }, ie = function (e, t, a, i, s) { var n = new XMLHttpRequest; n.responseType = t; try {
    n.addEventListener("timeout", (function (t) { throw new Error("The request for " + e + " timed out."); })), n.addEventListener("error", (function (t) { throw new Error("The request for " + e + ": xhr.readyState:" + n.readyState); })), n.addEventListener("abort", (function (t) { throw new Error("The request for " + e + ": xhr.readyState:" + n.readyState); })), n.addEventListener("loadend", (function (e) { 200 == n.status ? a(n) : i(n.statusText); })), n.open("GET", e, !0), n.send();
}
catch (e) {
    i(e);
} }, se = function (e, t, a, i) { ie(e, "text", function (e) { t(e.responseText); }, function (t) { if (null == a)
    throw new Error("Unable to XHR File:" + e); a(t); }); }, ne = function (e, t, a, i) { ie(e, "json", function (e) { t(e.response, e); }, function (t) { if (null == a)
    throw new Error("Unable to XHR File:" + e); a(t); }); }, le = function (e, t, a, i) { ie(e, "document", function (e) { t(e.responseXML); }, function (t) { if (null == a)
    throw new Error("Unable to XHR File:" + e); a(t); }); }, re = function (e, t, a, i) { ie(e, "arraybuffer", function (e) { t(e.response); }, function (t) { if (null == a)
    throw new Error("Unable to XHR File:" + e); a(t); }); }, oe = "[object process]" === Object.prototype.toString.call("undefined" != typeof process ? process : 0), de = oe && "function" == typeof module.require ? module.require : null;
function he(e, t, a) {
    if (t === void 0) { t = null; }
    if (a === void 0) { a = !1; }
    var i = oe ? function (e, t) { return Buffer.from(e, "base64").toString(t ? "utf16" : "utf8"); }(e, a) : function (e, t) { var a = atob(e); if (t) {
        var e_12 = new Uint8Array(a.length);
        return Array.prototype.forEach.call(e_12, function (e, t, i) { i[t] = a.charCodeAt(t); }), String.fromCharCode.apply(null, new Uint16Array(e_12.buffer));
    } return a; }(e, a), s = i.indexOf("\n", 10) + 1, n = i.substring(s) + (t ? "//# sourceMappingURL=" + t : "");
    if (de) {
        var e_13 = de("worker_threads").Worker;
        return function (t) { return new e_13(n, Object.assign({}, t, { eval: !0 })); };
    }
    var l = new Blob([n], { type: "application/javascript" }), r = URL.createObjectURL(l);
    return function (e) { return new Worker(r, e); };
}
var ce = he("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwpNb2R1bGU9e0VOVklST05NRU5UOiJXT1JLRVIifTtjb25zdCBlPXt9O3ZhciB0Oyh0PWUpLnVucGFja0JyaWRnZT1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHQ9e307ZnVuY3Rpb24gcihuKXtpZih0W25dKXJldHVybiB0W25dLmV4cG9ydHM7dmFyIG89dFtuXT17aTpuLGw6ITEsZXhwb3J0czp7fX07cmV0dXJuIGVbbl0uY2FsbChvLmV4cG9ydHMsbyxvLmV4cG9ydHMsciksby5sPSEwLG8uZXhwb3J0c31yZXR1cm4gci5tPWUsci5jPXQsci5kPWZ1bmN0aW9uKGUsdCxuKXtyLm8oZSx0KXx8T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7ZW51bWVyYWJsZTohMCxnZXQ6bn0pfSxyLnI9ZnVuY3Rpb24oZSl7InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJlN5bWJvbC50b1N0cmluZ1RhZyYmT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsU3ltYm9sLnRvU3RyaW5nVGFnLHt2YWx1ZToiTW9kdWxlIn0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0sci50PWZ1bmN0aW9uKGUsdCl7aWYoMSZ0JiYoZT1yKGUpKSw4JnQpcmV0dXJuIGU7aWYoNCZ0JiYib2JqZWN0Ij09dHlwZW9mIGUmJmUmJmUuX19lc01vZHVsZSlyZXR1cm4gZTt2YXIgbj1PYmplY3QuY3JlYXRlKG51bGwpO2lmKHIucihuKSxPYmplY3QuZGVmaW5lUHJvcGVydHkobiwiZGVmYXVsdCIse2VudW1lcmFibGU6ITAsdmFsdWU6ZX0pLDImdCYmInN0cmluZyIhPXR5cGVvZiBlKWZvcih2YXIgbyBpbiBlKXIuZChuLG8sZnVuY3Rpb24odCl7cmV0dXJuIGVbdF19LmJpbmQobnVsbCxvKSk7cmV0dXJuIG59LHIubj1mdW5jdGlvbihlKXt2YXIgdD1lJiZlLl9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gZS5kZWZhdWx0fTpmdW5jdGlvbigpe3JldHVybiBlfTtyZXR1cm4gci5kKHQsImEiLHQpLHR9LHIubz1mdW5jdGlvbihlLHQpe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KX0sci5wPSIiLHIoci5zPTIpfShbZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTtjb25zdCBvPXIoMSksaT17MDoiRVJBUl9TVUNDRVNTIiwxMDoiRVJBUl9FTkRfQVJDSElWRSIsMTE6IkVSQVJfTk9fTUVNT1JZIiwxMjoiRVJBUl9CQURfREFUQSIsMTM6IkVSQVJfQkFEX0FSQ0hJVkUiLDE0OiJFUkFSX1VOS05PV05fRk9STUFUIiwxNToiRVJBUl9FT1BFTiIsMTY6IkVSQVJfRUNSRUFURSIsMTc6IkVSQVJfRUNMT1NFIiwxODoiRVJBUl9FUkVBRCIsMTk6IkVSQVJfRVdSSVRFIiwyMDoiRVJBUl9TTUFMTF9CVUYiLDIxOiJFUkFSX1VOS05PV04iLDIyOiJFUkFSX01JU1NJTkdfUEFTU1dPUkQiLDIzOiJFUkFSX0VSRUZFUkVOQ0UiLDI0OiJFUkFSX0JBRF9QQVNTV09SRCJ9LGE9ezA6IlN1Y2Nlc3MiLDExOiJOb3QgZW5vdWdoIG1lbW9yeSIsMTI6IkFyY2hpdmUgaGVhZGVyIG9yIGRhdGEgYXJlIGRhbWFnZWQiLDEzOiJGaWxlIGlzIG5vdCBSQVIgYXJjaGl2ZSIsMTQ6IlVua25vd24gYXJjaGl2ZSBmb3JtYXQiLDE1OiJGaWxlIG9wZW4gZXJyb3IiLDE2OiJGaWxlIGNyZWF0ZSBlcnJvciIsMTc6IkZpbGUgY2xvc2UgZXJyb3IiLDE4OiJGaWxlIHJlYWQgZXJyb3IiLDE5OiJGaWxlIHdyaXRlIGVycm9yIiwyMDoiQnVmZmVyIGZvciBhcmNoaXZlIGNvbW1lbnQgaXMgdG9vIHNtYWxsLCBjb21tZW50IHRydW5jYXRlZCIsMjE6IlVua25vd24gZXJyb3IiLDIyOiJQYXNzd29yZCBmb3IgZW5jcnlwdGVkIGZpbGUgb3IgaGVhZGVyIGlzIG5vdCBzcGVjaWZpZWQiLDIzOiJDYW5ub3Qgb3BlbiBmaWxlIHNvdXJjZSBmb3IgcmVmZXJlbmNlIHJlY29yZCIsMjQ6Ildyb25nIHBhc3N3b3JkIGlzIHNwZWNpZmllZCJ9O2NsYXNzIHN7Y29uc3RydWN0b3IoZT0iIil7dGhpcy5fcGFzc3dvcmQ9ZSx0aGlzLl9hcmNoaXZlPW51bGx9Z2V0RmlsZUxpc3QoKXtsZXQgZSxbdCxyXT10aGlzLm9wZW5BcmMoITApO2lmKCJTVUNDRVNTIiE9PXQuc3RhdGUpZT1bdCxudWxsXTtlbHNle2xldCB0LG4sbz1bXTtmb3IoO1t0LG5dPXRoaXMucHJvY2Vzc05leHRGaWxlKCgpPT4hMCksIlNVQ0NFU1MiPT09dC5zdGF0ZTspby5wdXNoKG4uZmlsZUhlYWRlcik7ZT0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpyLGZpbGVIZWFkZXJzOm99XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLGV9ZXh0cmFjdEFsbCgpe2xldCBlLFt0LHJdPXRoaXMub3BlbkFyYyghMSk7aWYoIlNVQ0NFU1MiIT09dC5zdGF0ZSllPVt0LG51bGxdO2Vsc2V7bGV0IHQsbixvPVtdO2Zvcig7W3Qsbl09dGhpcy5wcm9jZXNzTmV4dEZpbGUoKCk9PiExKSwiU1VDQ0VTUyI9PT10LnN0YXRlOylvLnB1c2gobik7ZT0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpyLGZpbGVzOm99XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLGV9ZXh0cmFjdEZpbGVzKGUsdCl7bGV0IHIsW24sb109dGhpcy5vcGVuQXJjKCExLHQpLGk9e307Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDsrK3QpaVtlW3RdXT10O2lmKCJTVUNDRVNTIiE9PW4uc3RhdGUpcj1bbixudWxsXTtlbHNle2xldCB0LG4sYT1BcnJheShlLmxlbmd0aCkuZmlsbChudWxsKSxzPTA7Zm9yKDs7KXtsZXQgcj0hMSxvPW51bGw7aWYoW3Qsbl09dGhpcy5wcm9jZXNzTmV4dEZpbGUoZT0+ZSBpbiBpPyhvPWlbZV0sITEpOihyPSEwLCEwKSksIlNVQ0NFU1MiIT09dC5zdGF0ZSlicmVhaztpZighciYmKGFbb109biwrK3M9PT1lLmxlbmd0aCkpe3QucmVhc29uPSJFUkFSX0VORF9BUkNISVZFIjticmVha319cj0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpvLGZpbGVzOmF9XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLHJ9ZmlsZUNyZWF0ZWQoZSl7fWNsb3NlKGUpe3RoaXMuX2xhc3RGaWxlQ29udGVudD10aGlzLmNsb3NlRmlsZShlKX1vcGVuQXJjKGUsdCl7by5FeHQuY3VycmVudD10aGlzLHRoaXMuX2FyY2hpdmU9bmV3IG4uUmFyQXJjaGl2ZTtsZXQgcixpPXRoaXMuX2FyY2hpdmUub3Blbih0aGlzLl9maWxlUGF0aCx0fHx0aGlzLl9wYXNzd29yZCxlKTtyZXR1cm4gcj0wIT09aS5zdGF0ZS5lcnJDb2RlP1t0aGlzLmdldEZhaWxJbmZvKGkuc3RhdGUuZXJyQ29kZSxpLnN0YXRlLmVyclR5cGUpLG51bGxdOlt7c3RhdGU6IlNVQ0NFU1MifSx7Y29tbWVudDppLmNvbW1lbnQsZmxhZ3M6e3ZvbHVtZTowIT0oMSZpLmZsYWdzKSxsb2NrOjAhPSg0JmkuZmxhZ3MpLHNvbGlkOjAhPSg4JmkuZmxhZ3MpLGF1dGhJbmZvOjAhPSgzMiZpLmZsYWdzKSxyZWNvdmVyeVJlY29yZDowIT0oNjQmaS5mbGFncyksaGVhZGVyRW5jcnlwdGVkOjAhPSgxMjgmaS5mbGFncyl9fV0sby5FeHQuY3VycmVudD1udWxsLHJ9cHJvY2Vzc05leHRGaWxlKGUpe2xldCB0O28uRXh0LmN1cnJlbnQ9dGhpcztsZXQgcj10aGlzLl9hcmNoaXZlLmdldEZpbGVIZWFkZXIoKSxuPVt7c3RhdGU6IlNVQ0NFU1MifSxudWxsXTtpZigwPT09ci5zdGF0ZS5lcnJDb2RlKXtsZXQgdD1lKHIubmFtZSk7dGhpcy5fbGFzdEZpbGVDb250ZW50PW51bGw7bGV0IG89dGhpcy5fYXJjaGl2ZS5yZWFkRmlsZSh0KTswPT09by5lcnJDb2RlfHx0fHwoblswXT10aGlzLmdldEZhaWxJbmZvKG8uZXJyQ29kZSxvLmVyclR5cGUpLDIyPT09by5lcnJDb2RlP289dGhpcy5fYXJjaGl2ZS5yZWFkRmlsZSghMCk6by5lcnJDb2RlPTApLDA9PT1vLmVyckNvZGU/blsxXT10aGlzLl9sYXN0RmlsZUNvbnRlbnQ6KHIuc3RhdGUuZXJyQ29kZT1vLmVyckNvZGUsci5zdGF0ZS5lcnJUeXBlPW8uZXJyVHlwZSksdGhpcy5fbGFzdEZpbGVDb250ZW50PW51bGx9cmV0dXJuIHQ9MCE9PXIuc3RhdGUuZXJyQ29kZT9bdGhpcy5nZXRGYWlsSW5mbyhyLnN0YXRlLmVyckNvZGUsci5zdGF0ZS5lcnJUeXBlKSxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2ZpbGVIZWFkZXI6e25hbWU6ci5uYW1lLGZsYWdzOntlbmNyeXB0ZWQ6MCE9KDQmci5mbGFncyksc29saWQ6MCE9KDE2JnIuZmxhZ3MpLGRpcmVjdG9yeTowIT0oMzImci5mbGFncyl9LHBhY2tTaXplOnIucGFja1NpemUsdW5wU2l6ZTpyLnVucFNpemUsY3JjOnIuY3JjLHRpbWU6ZnVuY3Rpb24oZSl7Y29uc3QgdD1bNSw2LDUsNSw0LDddO2xldCByPVtdO2ZvcihsZXQgbiBvZiB0KXIucHVzaChlJigxPDxuKS0xKSxlPj49bjtsZXQgbj1lPT5lPDEwPyIwIitlOiIiK2U7cmV0dXJuYCR7MTk4MCsocj1yLnJldmVyc2UoKSlbMF19LSR7bihyWzFdKX0tJHtuKHJbMl0pfWArYFQke24oclszXSl9OiR7bihyWzRdKX06JHtuKDIqcls1XSl9LjAwMGB9KHIudGltZSksdW5wVmVyOmAke01hdGguZmxvb3Ioci51bnBWZXIvMTApfS4ke3IudW5wVmVyJTEwfWAsbWV0aG9kOmZ1bmN0aW9uKGUpe3JldHVybns0ODoiU3RvcmluZyIsNDk6IkZhc3Rlc3QiLDUwOiJGYXN0Iiw1MToiTm9ybWFsIiw1MjoiR29vZCIsNTM6IkJlc3QifVtlXXx8IlVua25vd24ifShyLm1ldGhvZCl9LGV4dHJhY3Q6bn1dLG8uRXh0LmN1cnJlbnQ9bnVsbCx0fWNsb3NlQXJjKCl7by5FeHQuY3VycmVudD10aGlzLHRoaXMuX2FyY2hpdmUuZGVsZXRlKCksby5FeHQuY3VycmVudD1udWxsLHRoaXMuX2FyY2hpdmU9bnVsbH1nZXRGYWlsSW5mbyhlLHQpe3JldHVybntzdGF0ZToiRkFJTCIscmVhc29uOmlbZV0sbXNnOmFbZV19fX1zLl9jdXJyZW50PW51bGwsdC5FeHRyYWN0b3I9c30sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSx0LkV4dD17Y3VycmVudDpudWxsfX0sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxmdW5jdGlvbihlKXtmb3IodmFyIHIgaW4gZSl0Lmhhc093blByb3BlcnR5KHIpfHwodFtyXT1lW3JdKX0ocigzKSk7dmFyIG49cigxKTt0LkV4dD1uLkV4dH0sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTtjb25zdCBuPXIoNCksbz1yKDYpO3QuY3JlYXRlRXh0cmFjdG9yRnJvbURhdGE9ZnVuY3Rpb24oZSx0PSIiKXtyZXR1cm4gbmV3IG4uRGF0YUV4dHJhY3RvcihlLHQpfSx0LmNyZWF0ZUV4dHJhY3RvckZyb21GaWxlPWZ1bmN0aW9uKGUsdD0iIixyPSIiKXtyZXR1cm4gbmV3IG8uRmlsZUV4dHJhY3RvcihlLHQscil9fSxmdW5jdGlvbihlLHQscil7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO2NvbnN0IG89cig1KSxpPXIoMCk7dC5EYXRhRXh0cmFjdG9yPWNsYXNzIGV4dGVuZHMgaS5FeHRyYWN0b3J7Y29uc3RydWN0b3IoZSx0KXtzdXBlcih0KSx0aGlzLmRhdGFGaWxlcz17fSx0aGlzLmRhdGFGaWxlTWFwPXt9LHRoaXMuY3VycmVudEZkPTE7bGV0IHI9e2ZpbGU6bmV3IG8uRGF0YUZpbGUobmV3IFVpbnQ4QXJyYXkoZSkpLGZkOnRoaXMuY3VycmVudEZkKyt9O3RoaXMuX2ZpbGVQYXRoPSJfZGVmYXVsdFVucmFySlNfLnJhciIsdGhpcy5kYXRhRmlsZXNbdGhpcy5fZmlsZVBhdGhdPXIsdGhpcy5kYXRhRmlsZU1hcFtyLmZkXT10aGlzLl9maWxlUGF0aH1vcGVuKGUpe2xldCB0PXRoaXMuZGF0YUZpbGVzW2VdO3JldHVybiB0P3QuZmQ6MH1jcmVhdGUoZSl7bGV0IHQ9dGhpcy5jdXJyZW50RmQrKztyZXR1cm4gdGhpcy5kYXRhRmlsZXNbZV09e2ZpbGU6bmV3IG8uRGF0YUZpbGUsZmQ6dGhpcy5jdXJyZW50RmQrK30sdGhpcy5kYXRhRmlsZU1hcFt0XT1lLHR9Y2xvc2VGaWxlKGUpe2xldCB0PXRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbZV1dO2lmKCF0KXJldHVybiBudWxsO2xldCByPXQuZmlsZS5yZWFkQWxsKCk7cmV0dXJuIDEhPT1lPyhkZWxldGUgdGhpcy5kYXRhRmlsZXNbdGhpcy5kYXRhRmlsZU1hcFtlXV0sZGVsZXRlIHRoaXMuZGF0YUZpbGVNYXBbZV0pOnQuZmlsZS5zZWVrKDAsIlNFVCIpLHJ9cmVhZChlLHQscil7bGV0IG89dGhpcy5kYXRhRmlsZXNbdGhpcy5kYXRhRmlsZU1hcFtlXV07aWYoIW8pcmV0dXJuLTE7bGV0IGk9by5maWxlLnJlYWQocik7cmV0dXJuIG51bGw9PT1pPy0xOihuLkhFQVBVOC5zZXQoaSx0KSxpLmJ5dGVMZW5ndGgpfXdyaXRlKGUsdCxyKXtsZXQgbz10aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW2VdXTtyZXR1cm4hIW8mJihvLmZpbGUud3JpdGUobi5IRUFQVTguc2xpY2UodCx0K3IpKSwhMCl9dGVsbChlKXtsZXQgdD10aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW2VdXTtyZXR1cm4gdD90LmZpbGUudGVsbCgpOi0xfXNlZWsoZSx0LHIpe2xldCBuPXRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbZV1dO3JldHVybiEhbiYmbi5maWxlLnNlZWsodCxyKX19fSxmdW5jdGlvbihlLHQscil7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLHQuRGF0YUZpbGU9Y2xhc3N7Y29uc3RydWN0b3IoZSl7dGhpcy5idWZmZXJzPVtdLHRoaXMucG9zPTAsdGhpcy5zaXplPTAsZSYmKHRoaXMuYnVmZmVycy5wdXNoKGUpLHRoaXMuc2l6ZT1lLmJ5dGVMZW5ndGgsdGhpcy5wb3M9MCl9cmVhZChlKXtpZih0aGlzLmZsYXR0ZW4oKSxlK3RoaXMucG9zPnRoaXMuc2l6ZSlyZXR1cm4gbnVsbDtsZXQgdD10aGlzLnBvcztyZXR1cm4gdGhpcy5wb3MrPWUsdGhpcy5idWZmZXJzWzBdLnNsaWNlKHQsdGhpcy5wb3MpfXJlYWRBbGwoKXtyZXR1cm4gdGhpcy5mbGF0dGVuKCksdGhpcy5idWZmZXJzWzBdfXdyaXRlKGUpe3JldHVybiB0aGlzLmJ1ZmZlcnMucHVzaChlKSx0aGlzLnNpemUrPWUuYnl0ZUxlbmd0aCx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RoLCEwfXRlbGwoKXtyZXR1cm4gdGhpcy5wb3N9c2VlayhlLHQpe2xldCByPXRoaXMucG9zO3JldHVybiJTRVQiPT09dD9yPWU6IkNVUiI9PT10P3IrPWU6cj10aGlzLnNpemUtZSwhKHI8MHx8cj50aGlzLnNpemV8fCh0aGlzLnBvcz1yLDApKX1mbGF0dGVuKCl7aWYodGhpcy5idWZmZXJzLmxlbmd0aDw9MSlyZXR1cm47bGV0IGU9bmV3IFVpbnQ4QXJyYXkodGhpcy5zaXplKSx0PTA7Zm9yKGxldCByIG9mIHRoaXMuYnVmZmVycyllLnNldChyLHQpLHQrPXIuYnl0ZUxlbmd0aDt0aGlzLmJ1ZmZlcnM9W2VdfX19LGZ1bmN0aW9uKGUsdCxyKXsoZnVuY3Rpb24oZSl7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO2NvbnN0IG89cigxMiksaT1yKDEzKSxhPXIoMCk7dC5GaWxlRXh0cmFjdG9yPWNsYXNzIGV4dGVuZHMgYS5FeHRyYWN0b3J7Y29uc3RydWN0b3IoZSx0LHIpe3N1cGVyKHIpLHRoaXMuX2ZpbGVQYXRoPWUsdGhpcy5maWxlTWFwPXt9LHRoaXMuX3RhcmdldD10fW9wZW4oZSl7bGV0IHQ9by5vcGVuU3luYyhlLCJyIik7cmV0dXJuIHRoaXMuZmlsZU1hcFt0XT17c2l6ZTpvLmZzdGF0U3luYyh0KS5zaXplLHBvczowLG5hbWU6ZX0sdH1jcmVhdGUoZSl7bGV0IHQ9aS5qb2luKHRoaXMuX3RhcmdldCxlKTtpLnBhcnNlKHQpLmRpci5zcGxpdCgiLyIpLnJlZHVjZSgoZSx0KT0+KGUrPXQrIi8iLG8uZXhpc3RzU3luYyhlKXx8by5ta2RpclN5bmMoZSksZSksIiIpO2xldCByPW8ub3BlblN5bmModCwidyIpO3JldHVybiB0aGlzLmZpbGVNYXBbcl09e3NpemU6MCxwb3M6MCxuYW1lOmV9LHJ9Y2xvc2VGaWxlKGUpe3JldHVybiBkZWxldGUgdGhpcy5maWxlTWFwW2VdLG8uY2xvc2VTeW5jKGUpLG51bGx9cmVhZCh0LHIsaSl7bGV0IGE9dGhpcy5maWxlTWFwW3RdLHM9bmV3IGUoaSksdT1vLnJlYWRTeW5jKHQscywwLGksYS5wb3MpO3JldHVybiBuLkhFQVBVOC5zZXQocyxyKSxhLnBvcys9dSx1fXdyaXRlKHQscixpKXtsZXQgYT10aGlzLmZpbGVNYXBbdF0scz1vLndyaXRlU3luYyh0LG5ldyBlKG4uSEVBUFU4LnN1YmFycmF5KHIscitpKSksMCxpKTtyZXR1cm4gYS5wb3MrPXMsYS5zaXplKz1zLHM9PT1pfXRlbGwoZSl7cmV0dXJuIHRoaXMuZmlsZU1hcFtlXS5wb3N9c2VlayhlLHQscil7bGV0IG49dGhpcy5maWxlTWFwW2VdLG89bi5wb3M7cmV0dXJuIlNFVCI9PT1yP289MDoiRU5EIj09PXImJihvPW4uc2l6ZSksISgobys9dCk8MHx8bz5uLnNpemV8fChuLnBvcz1vLDApKX19fSkuY2FsbCh0aGlzLHIoNykuQnVmZmVyKX0sZnVuY3Rpb24oZSx0LHIpeyhmdW5jdGlvbihlKXsKLyohCiAqIFRoZSBidWZmZXIgbW9kdWxlIGZyb20gbm9kZS5qcywgZm9yIHRoZSBicm93c2VyLgogKgogKiBAYXV0aG9yICAgRmVyb3NzIEFib3VraGFkaWplaCA8ZmVyb3NzQGZlcm9zcy5vcmc+IDxodHRwOi8vZmVyb3NzLm9yZz4KICogQGxpY2Vuc2UgIE1JVAogKi8KdmFyIG49cig5KSxvPXIoMTApLGk9cigxMSk7ZnVuY3Rpb24gYSgpe3JldHVybiB1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/MjE0NzQ4MzY0NzoxMDczNzQxODIzfWZ1bmN0aW9uIHMoZSx0KXtpZihhKCk8dCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW52YWxpZCB0eXBlZCBhcnJheSBsZW5ndGgiKTtyZXR1cm4gdS5UWVBFRF9BUlJBWV9TVVBQT1JUPyhlPW5ldyBVaW50OEFycmF5KHQpKS5fX3Byb3RvX189dS5wcm90b3R5cGU6KG51bGw9PT1lJiYoZT1uZXcgdSh0KSksZS5sZW5ndGg9dCksZX1mdW5jdGlvbiB1KGUsdCxyKXtpZighKHUuVFlQRURfQVJSQVlfU1VQUE9SVHx8dGhpcyBpbnN0YW5jZW9mIHUpKXJldHVybiBuZXcgdShlLHQscik7aWYoIm51bWJlciI9PXR5cGVvZiBlKXtpZigic3RyaW5nIj09dHlwZW9mIHQpdGhyb3cgbmV3IEVycm9yKCJJZiBlbmNvZGluZyBpcyBzcGVjaWZpZWQgdGhlbiB0aGUgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZyIpO3JldHVybiBmKHRoaXMsZSl9cmV0dXJuIGModGhpcyxlLHQscil9ZnVuY3Rpb24gYyhlLHQscixuKXtpZigibnVtYmVyIj09dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcignInZhbHVlIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlcicpO3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgQXJyYXlCdWZmZXImJnQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcj9mdW5jdGlvbihlLHQscixuKXtpZih0LmJ5dGVMZW5ndGgscjwwfHx0LmJ5dGVMZW5ndGg8cil0aHJvdyBuZXcgUmFuZ2VFcnJvcigiJ29mZnNldCcgaXMgb3V0IG9mIGJvdW5kcyIpO2lmKHQuYnl0ZUxlbmd0aDxyKyhufHwwKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiJ2xlbmd0aCcgaXMgb3V0IG9mIGJvdW5kcyIpO3JldHVybiB0PXZvaWQgMD09PXImJnZvaWQgMD09PW4/bmV3IFVpbnQ4QXJyYXkodCk6dm9pZCAwPT09bj9uZXcgVWludDhBcnJheSh0LHIpOm5ldyBVaW50OEFycmF5KHQscixuKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KGU9dCkuX19wcm90b19fPXUucHJvdG90eXBlOmU9ZChlLHQpLGV9KGUsdCxyLG4pOiJzdHJpbmciPT10eXBlb2YgdD9mdW5jdGlvbihlLHQscil7aWYoInN0cmluZyI9PXR5cGVvZiByJiYiIiE9PXJ8fChyPSJ1dGY4IiksIXUuaXNFbmNvZGluZyhyKSl0aHJvdyBuZXcgVHlwZUVycm9yKCciZW5jb2RpbmciIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTt2YXIgbj0wfHAodCxyKSxvPShlPXMoZSxuKSkud3JpdGUodCxyKTtyZXR1cm4gbyE9PW4mJihlPWUuc2xpY2UoMCxvKSksZX0oZSx0LHIpOmZ1bmN0aW9uKGUsdCl7aWYodS5pc0J1ZmZlcih0KSl7dmFyIHI9MHxoKHQubGVuZ3RoKTtyZXR1cm4gMD09PShlPXMoZSxyKSkubGVuZ3RofHx0LmNvcHkoZSwwLDAsciksZX1pZih0KXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIEFycmF5QnVmZmVyJiZ0LmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyfHwibGVuZ3RoImluIHQpcmV0dXJuIm51bWJlciIhPXR5cGVvZiB0Lmxlbmd0aHx8ZnVuY3Rpb24oZSl7cmV0dXJuIGUhPWV9KHQubGVuZ3RoKT9zKGUsMCk6ZChlLHQpO2lmKCJCdWZmZXIiPT09dC50eXBlJiZpKHQuZGF0YSkpcmV0dXJuIGQoZSx0LmRhdGEpfXRocm93IG5ldyBUeXBlRXJyb3IoIkZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBhcnJheS1saWtlIG9iamVjdC4iKX0oZSx0KX1mdW5jdGlvbiBsKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCcic2l6ZSIgYXJndW1lbnQgbXVzdCBiZSBhIG51bWJlcicpO2lmKGU8MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcignInNpemUiIGFyZ3VtZW50IG11c3Qgbm90IGJlIG5lZ2F0aXZlJyl9ZnVuY3Rpb24gZihlLHQpe2lmKGwodCksZT1zKGUsdDwwPzA6MHxoKHQpKSwhdS5UWVBFRF9BUlJBWV9TVVBQT1JUKWZvcih2YXIgcj0wO3I8dDsrK3IpZVtyXT0wO3JldHVybiBlfWZ1bmN0aW9uIGQoZSx0KXt2YXIgcj10Lmxlbmd0aDwwPzA6MHxoKHQubGVuZ3RoKTtlPXMoZSxyKTtmb3IodmFyIG49MDtuPHI7bis9MSllW25dPTI1NSZ0W25dO3JldHVybiBlfWZ1bmN0aW9uIGgoZSl7aWYoZT49YSgpKXRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4IithKCkudG9TdHJpbmcoMTYpKyIgYnl0ZXMiKTtyZXR1cm4gMHxlfWZ1bmN0aW9uIHAoZSx0KXtpZih1LmlzQnVmZmVyKGUpKXJldHVybiBlLmxlbmd0aDtpZigidW5kZWZpbmVkIiE9dHlwZW9mIEFycmF5QnVmZmVyJiYiZnVuY3Rpb24iPT10eXBlb2YgQXJyYXlCdWZmZXIuaXNWaWV3JiYoQXJyYXlCdWZmZXIuaXNWaWV3KGUpfHxlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKXJldHVybiBlLmJ5dGVMZW5ndGg7InN0cmluZyIhPXR5cGVvZiBlJiYoZT0iIitlKTt2YXIgcj1lLmxlbmd0aDtpZigwPT09cilyZXR1cm4gMDtmb3IodmFyIG49ITE7Oylzd2l0Y2godCl7Y2FzZSJhc2NpaSI6Y2FzZSJsYXRpbjEiOmNhc2UiYmluYXJ5IjpyZXR1cm4gcjtjYXNlInV0ZjgiOmNhc2UidXRmLTgiOmNhc2Ugdm9pZCAwOnJldHVybiBVKGUpLmxlbmd0aDtjYXNlInVjczIiOmNhc2UidWNzLTIiOmNhc2UidXRmMTZsZSI6Y2FzZSJ1dGYtMTZsZSI6cmV0dXJuIDIqcjtjYXNlImhleCI6cmV0dXJuIHI+Pj4xO2Nhc2UiYmFzZTY0IjpyZXR1cm4geihlKS5sZW5ndGg7ZGVmYXVsdDppZihuKXJldHVybiBVKGUpLmxlbmd0aDt0PSgiIit0KS50b0xvd2VyQ2FzZSgpLG49ITB9fWZ1bmN0aW9uIG0oZSx0LHIpe3ZhciBuPWVbdF07ZVt0XT1lW3JdLGVbcl09bn1mdW5jdGlvbiB5KGUsdCxyLG4sbyl7aWYoMD09PWUubGVuZ3RoKXJldHVybi0xO2lmKCJzdHJpbmciPT10eXBlb2Ygcj8obj1yLHI9MCk6cj4yMTQ3NDgzNjQ3P3I9MjE0NzQ4MzY0NzpyPC0yMTQ3NDgzNjQ4JiYocj0tMjE0NzQ4MzY0OCkscj0rcixpc05hTihyKSYmKHI9bz8wOmUubGVuZ3RoLTEpLHI8MCYmKHI9ZS5sZW5ndGgrcikscj49ZS5sZW5ndGgpe2lmKG8pcmV0dXJuLTE7cj1lLmxlbmd0aC0xfWVsc2UgaWYocjwwKXtpZighbylyZXR1cm4tMTtyPTB9aWYoInN0cmluZyI9PXR5cGVvZiB0JiYodD11LmZyb20odCxuKSksdS5pc0J1ZmZlcih0KSlyZXR1cm4gMD09PXQubGVuZ3RoPy0xOkUoZSx0LHIsbixvKTtpZigibnVtYmVyIj09dHlwZW9mIHQpcmV0dXJuIHQmPTI1NSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQmJiJmdW5jdGlvbiI9PXR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mP28/VWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGUsdCxyKTpVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGUsdCxyKTpFKGUsW3RdLHIsbixvKTt0aHJvdyBuZXcgVHlwZUVycm9yKCJ2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXIiKX1mdW5jdGlvbiBFKGUsdCxyLG4sbyl7dmFyIGksYT0xLHM9ZS5sZW5ndGgsdT10Lmxlbmd0aDtpZih2b2lkIDAhPT1uJiYoInVjczIiPT09KG49U3RyaW5nKG4pLnRvTG93ZXJDYXNlKCkpfHwidWNzLTIiPT09bnx8InV0ZjE2bGUiPT09bnx8InV0Zi0xNmxlIj09PW4pKXtpZihlLmxlbmd0aDwyfHx0Lmxlbmd0aDwyKXJldHVybi0xO2E9MixzLz0yLHUvPTIsci89Mn1mdW5jdGlvbiBjKGUsdCl7cmV0dXJuIDE9PT1hP2VbdF06ZS5yZWFkVUludDE2QkUodCphKX1pZihvKXt2YXIgbD0tMTtmb3IoaT1yO2k8cztpKyspaWYoYyhlLGkpPT09Yyh0LC0xPT09bD8wOmktbCkpe2lmKC0xPT09bCYmKGw9aSksaS1sKzE9PT11KXJldHVybiBsKmF9ZWxzZS0xIT09bCYmKGktPWktbCksbD0tMX1lbHNlIGZvcihyK3U+cyYmKHI9cy11KSxpPXI7aT49MDtpLS0pe2Zvcih2YXIgZj0hMCxkPTA7ZDx1O2QrKylpZihjKGUsaStkKSE9PWModCxkKSl7Zj0hMTticmVha31pZihmKXJldHVybiBpfXJldHVybi0xfWZ1bmN0aW9uIGcoZSx0LHIsbil7cj1OdW1iZXIocil8fDA7dmFyIG89ZS5sZW5ndGgtcjtuPyhuPU51bWJlcihuKSk+byYmKG49byk6bj1vO3ZhciBpPXQubGVuZ3RoO2lmKGklMiE9MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGhleCBzdHJpbmciKTtuPmkvMiYmKG49aS8yKTtmb3IodmFyIGE9MDthPG47KythKXt2YXIgcz1wYXJzZUludCh0LnN1YnN0cigyKmEsMiksMTYpO2lmKGlzTmFOKHMpKXJldHVybiBhO2VbcithXT1zfXJldHVybiBhfWZ1bmN0aW9uIHYoZSx0LHIsbil7cmV0dXJuICQoVSh0LGUubGVuZ3RoLXIpLGUscixuKX1mdW5jdGlvbiB3KGUsdCxyLG4pe3JldHVybiAkKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxyPTA7cjxlLmxlbmd0aDsrK3IpdC5wdXNoKDI1NSZlLmNoYXJDb2RlQXQocikpO3JldHVybiB0fSh0KSxlLHIsbil9ZnVuY3Rpb24gXyhlLHQscixuKXtyZXR1cm4gdyhlLHQscixuKX1mdW5jdGlvbiBiKGUsdCxyLG4pe3JldHVybiAkKHoodCksZSxyLG4pfWZ1bmN0aW9uIEEoZSx0LHIsbil7cmV0dXJuICQoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHIsbixvLGk9W10sYT0wO2E8ZS5sZW5ndGgmJiEoKHQtPTIpPDApOysrYSluPShyPWUuY2hhckNvZGVBdChhKSk+Pjgsbz1yJTI1NixpLnB1c2gobyksaS5wdXNoKG4pO3JldHVybiBpfSh0LGUubGVuZ3RoLXIpLGUscixuKX1mdW5jdGlvbiBUKGUsdCxyKXtyZXR1cm4gMD09PXQmJnI9PT1lLmxlbmd0aD9uLmZyb21CeXRlQXJyYXkoZSk6bi5mcm9tQnl0ZUFycmF5KGUuc2xpY2UodCxyKSl9ZnVuY3Rpb24gUyhlLHQscil7cj1NYXRoLm1pbihlLmxlbmd0aCxyKTtmb3IodmFyIG49W10sbz10O288cjspe3ZhciBpLGEscyx1LGM9ZVtvXSxsPW51bGwsZj1jPjIzOT80OmM+MjIzPzM6Yz4xOTE/MjoxO2lmKG8rZjw9cilzd2l0Y2goZil7Y2FzZSAxOmM8MTI4JiYobD1jKTticmVhaztjYXNlIDI6MTI4PT0oMTkyJihpPWVbbysxXSkpJiYodT0oMzEmYyk8PDZ8NjMmaSk+MTI3JiYobD11KTticmVhaztjYXNlIDM6aT1lW28rMV0sYT1lW28rMl0sMTI4PT0oMTkyJmkpJiYxMjg9PSgxOTImYSkmJih1PSgxNSZjKTw8MTJ8KDYzJmkpPDw2fDYzJmEpPjIwNDcmJih1PDU1Mjk2fHx1PjU3MzQzKSYmKGw9dSk7YnJlYWs7Y2FzZSA0Omk9ZVtvKzFdLGE9ZVtvKzJdLHM9ZVtvKzNdLDEyOD09KDE5MiZpKSYmMTI4PT0oMTkyJmEpJiYxMjg9PSgxOTImcykmJih1PSgxNSZjKTw8MTh8KDYzJmkpPDwxMnwoNjMmYSk8PDZ8NjMmcyk+NjU1MzUmJnU8MTExNDExMiYmKGw9dSl9bnVsbD09PWw/KGw9NjU1MzMsZj0xKTpsPjY1NTM1JiYobC09NjU1MzYsbi5wdXNoKGw+Pj4xMCYxMDIzfDU1Mjk2KSxsPTU2MzIwfDEwMjMmbCksbi5wdXNoKGwpLG8rPWZ9cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciB0PWUubGVuZ3RoO2lmKHQ8PWspcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLGUpO2Zvcih2YXIgcj0iIixuPTA7bjx0OylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZyxlLnNsaWNlKG4sbis9aykpO3JldHVybiByfShuKX10LkJ1ZmZlcj11LHQuU2xvd0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4rZSE9ZSYmKGU9MCksdS5hbGxvYygrZSl9LHQuSU5TUEVDVF9NQVhfQllURVM9NTAsdS5UWVBFRF9BUlJBWV9TVVBQT1JUPXZvaWQgMCE9PWUuVFlQRURfQVJSQVlfU1VQUE9SVD9lLlRZUEVEX0FSUkFZX1NVUFBPUlQ6ZnVuY3Rpb24oKXt0cnl7dmFyIGU9bmV3IFVpbnQ4QXJyYXkoMSk7cmV0dXJuIGUuX19wcm90b19fPXtfX3Byb3RvX186VWludDhBcnJheS5wcm90b3R5cGUsZm9vOmZ1bmN0aW9uKCl7cmV0dXJuIDQyfX0sNDI9PT1lLmZvbygpJiYiZnVuY3Rpb24iPT10eXBlb2YgZS5zdWJhcnJheSYmMD09PWUuc3ViYXJyYXkoMSwxKS5ieXRlTGVuZ3RofWNhdGNoKGUpe3JldHVybiExfX0oKSx0LmtNYXhMZW5ndGg9YSgpLHUucG9vbFNpemU9ODE5Mix1Ll9hdWdtZW50PWZ1bmN0aW9uKGUpe3JldHVybiBlLl9fcHJvdG9fXz11LnByb3RvdHlwZSxlfSx1LmZyb209ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBjKG51bGwsZSx0LHIpfSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQmJih1LnByb3RvdHlwZS5fX3Byb3RvX189VWludDhBcnJheS5wcm90b3R5cGUsdS5fX3Byb3RvX189VWludDhBcnJheSwidW5kZWZpbmVkIiE9dHlwZW9mIFN5bWJvbCYmU3ltYm9sLnNwZWNpZXMmJnVbU3ltYm9sLnNwZWNpZXNdPT09dSYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHUsU3ltYm9sLnNwZWNpZXMse3ZhbHVlOm51bGwsY29uZmlndXJhYmxlOiEwfSkpLHUuYWxsb2M9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBmdW5jdGlvbihlLHQscixuKXtyZXR1cm4gbCh0KSx0PD0wP3MoZSx0KTp2b2lkIDAhPT1yPyJzdHJpbmciPT10eXBlb2Ygbj9zKGUsdCkuZmlsbChyLG4pOnMoZSx0KS5maWxsKHIpOnMoZSx0KX0obnVsbCxlLHQscil9LHUuYWxsb2NVbnNhZmU9ZnVuY3Rpb24oZSl7cmV0dXJuIGYobnVsbCxlKX0sdS5hbGxvY1Vuc2FmZVNsb3c9ZnVuY3Rpb24oZSl7cmV0dXJuIGYobnVsbCxlKX0sdS5pc0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4hKG51bGw9PWV8fCFlLl9pc0J1ZmZlcil9LHUuY29tcGFyZT1mdW5jdGlvbihlLHQpe2lmKCF1LmlzQnVmZmVyKGUpfHwhdS5pc0J1ZmZlcih0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzIik7aWYoZT09PXQpcmV0dXJuIDA7Zm9yKHZhciByPWUubGVuZ3RoLG49dC5sZW5ndGgsbz0wLGk9TWF0aC5taW4ocixuKTtvPGk7KytvKWlmKGVbb10hPT10W29dKXtyPWVbb10sbj10W29dO2JyZWFrfXJldHVybiByPG4/LTE6bjxyPzE6MH0sdS5pc0VuY29kaW5nPWZ1bmN0aW9uKGUpe3N3aXRjaChTdHJpbmcoZSkudG9Mb3dlckNhc2UoKSl7Y2FzZSJoZXgiOmNhc2UidXRmOCI6Y2FzZSJ1dGYtOCI6Y2FzZSJhc2NpaSI6Y2FzZSJsYXRpbjEiOmNhc2UiYmluYXJ5IjpjYXNlImJhc2U2NCI6Y2FzZSJ1Y3MyIjpjYXNlInVjcy0yIjpjYXNlInV0ZjE2bGUiOmNhc2UidXRmLTE2bGUiOnJldHVybiEwO2RlZmF1bHQ6cmV0dXJuITF9fSx1LmNvbmNhdD1mdW5jdGlvbihlLHQpe2lmKCFpKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTtpZigwPT09ZS5sZW5ndGgpcmV0dXJuIHUuYWxsb2MoMCk7dmFyIHI7aWYodm9pZCAwPT09dClmb3IodD0wLHI9MDtyPGUubGVuZ3RoOysrcil0Kz1lW3JdLmxlbmd0aDt2YXIgbj11LmFsbG9jVW5zYWZlKHQpLG89MDtmb3Iocj0wO3I8ZS5sZW5ndGg7KytyKXt2YXIgYT1lW3JdO2lmKCF1LmlzQnVmZmVyKGEpKXRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTthLmNvcHkobixvKSxvKz1hLmxlbmd0aH1yZXR1cm4gbn0sdS5ieXRlTGVuZ3RoPXAsdS5wcm90b3R5cGUuX2lzQnVmZmVyPSEwLHUucHJvdG90eXBlLnN3YXAxNj1mdW5jdGlvbigpe3ZhciBlPXRoaXMubGVuZ3RoO2lmKGUlMiE9MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDE2LWJpdHMiKTtmb3IodmFyIHQ9MDt0PGU7dCs9MiltKHRoaXMsdCx0KzEpO3JldHVybiB0aGlzfSx1LnByb3RvdHlwZS5zd2FwMzI9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmxlbmd0aDtpZihlJTQhPTApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAzMi1iaXRzIik7Zm9yKHZhciB0PTA7dDxlO3QrPTQpbSh0aGlzLHQsdCszKSxtKHRoaXMsdCsxLHQrMik7cmV0dXJuIHRoaXN9LHUucHJvdG90eXBlLnN3YXA2ND1mdW5jdGlvbigpe3ZhciBlPXRoaXMubGVuZ3RoO2lmKGUlOCE9MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHMiKTtmb3IodmFyIHQ9MDt0PGU7dCs9OCltKHRoaXMsdCx0KzcpLG0odGhpcyx0KzEsdCs2KSxtKHRoaXMsdCsyLHQrNSksbSh0aGlzLHQrMyx0KzQpO3JldHVybiB0aGlzfSx1LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3ZhciBlPTB8dGhpcy5sZW5ndGg7cmV0dXJuIDA9PT1lPyIiOjA9PT1hcmd1bWVudHMubGVuZ3RoP1ModGhpcywwLGUpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj0hMTtpZigodm9pZCAwPT09dHx8dDwwKSYmKHQ9MCksdD50aGlzLmxlbmd0aClyZXR1cm4iIjtpZigodm9pZCAwPT09cnx8cj50aGlzLmxlbmd0aCkmJihyPXRoaXMubGVuZ3RoKSxyPD0wKXJldHVybiIiO2lmKChyPj4+PTApPD0odD4+Pj0wKSlyZXR1cm4iIjtmb3IoZXx8KGU9InV0ZjgiKTs7KXN3aXRjaChlKXtjYXNlImhleCI6cmV0dXJuIFIodGhpcyx0LHIpO2Nhc2UidXRmOCI6Y2FzZSJ1dGYtOCI6cmV0dXJuIFModGhpcyx0LHIpO2Nhc2UiYXNjaWkiOnJldHVybiBQKHRoaXMsdCxyKTtjYXNlImxhdGluMSI6Y2FzZSJiaW5hcnkiOnJldHVybiBEKHRoaXMsdCxyKTtjYXNlImJhc2U2NCI6cmV0dXJuIFQodGhpcyx0LHIpO2Nhc2UidWNzMiI6Y2FzZSJ1Y3MtMiI6Y2FzZSJ1dGYxNmxlIjpjYXNlInV0Zi0xNmxlIjpyZXR1cm4gTyh0aGlzLHQscik7ZGVmYXVsdDppZihuKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIrZSk7ZT0oZSsiIikudG9Mb3dlckNhc2UoKSxuPSEwfX0uYXBwbHkodGhpcyxhcmd1bWVudHMpfSx1LnByb3RvdHlwZS5lcXVhbHM9ZnVuY3Rpb24oZSl7aWYoIXUuaXNCdWZmZXIoZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciIpO3JldHVybiB0aGlzPT09ZXx8MD09PXUuY29tcGFyZSh0aGlzLGUpfSx1LnByb3RvdHlwZS5pbnNwZWN0PWZ1bmN0aW9uKCl7dmFyIGU9IiIscj10LklOU1BFQ1RfTUFYX0JZVEVTO3JldHVybiB0aGlzLmxlbmd0aD4wJiYoZT10aGlzLnRvU3RyaW5nKCJoZXgiLDAscikubWF0Y2goLy57Mn0vZykuam9pbigiICIpLHRoaXMubGVuZ3RoPnImJihlKz0iIC4uLiAiKSksIjxCdWZmZXIgIitlKyI+In0sdS5wcm90b3R5cGUuY29tcGFyZT1mdW5jdGlvbihlLHQscixuLG8pe2lmKCF1LmlzQnVmZmVyKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIiKTtpZih2b2lkIDA9PT10JiYodD0wKSx2b2lkIDA9PT1yJiYocj1lP2UubGVuZ3RoOjApLHZvaWQgMD09PW4mJihuPTApLHZvaWQgMD09PW8mJihvPXRoaXMubGVuZ3RoKSx0PDB8fHI+ZS5sZW5ndGh8fG48MHx8bz50aGlzLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigib3V0IG9mIHJhbmdlIGluZGV4Iik7aWYobj49byYmdD49cilyZXR1cm4gMDtpZihuPj1vKXJldHVybi0xO2lmKHQ+PXIpcmV0dXJuIDE7aWYodGhpcz09PWUpcmV0dXJuIDA7Zm9yKHZhciBpPShvPj4+PTApLShuPj4+PTApLGE9KHI+Pj49MCktKHQ+Pj49MCkscz1NYXRoLm1pbihpLGEpLGM9dGhpcy5zbGljZShuLG8pLGw9ZS5zbGljZSh0LHIpLGY9MDtmPHM7KytmKWlmKGNbZl0hPT1sW2ZdKXtpPWNbZl0sYT1sW2ZdO2JyZWFrfXJldHVybiBpPGE/LTE6YTxpPzE6MH0sdS5wcm90b3R5cGUuaW5jbHVkZXM9ZnVuY3Rpb24oZSx0LHIpe3JldHVybi0xIT09dGhpcy5pbmRleE9mKGUsdCxyKX0sdS5wcm90b3R5cGUuaW5kZXhPZj1mdW5jdGlvbihlLHQscil7cmV0dXJuIHkodGhpcyxlLHQsciwhMCl9LHUucHJvdG90eXBlLmxhc3RJbmRleE9mPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4geSh0aGlzLGUsdCxyLCExKX0sdS5wcm90b3R5cGUud3JpdGU9ZnVuY3Rpb24oZSx0LHIsbil7aWYodm9pZCAwPT09dCluPSJ1dGY4IixyPXRoaXMubGVuZ3RoLHQ9MDtlbHNlIGlmKHZvaWQgMD09PXImJiJzdHJpbmciPT10eXBlb2YgdCluPXQscj10aGlzLmxlbmd0aCx0PTA7ZWxzZXtpZighaXNGaW5pdGUodCkpdGhyb3cgbmV3IEVycm9yKCJCdWZmZXIud3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0WywgbGVuZ3RoXSkgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCIpO3R8PTAsaXNGaW5pdGUocik/KHJ8PTAsdm9pZCAwPT09biYmKG49InV0ZjgiKSk6KG49cixyPXZvaWQgMCl9dmFyIG89dGhpcy5sZW5ndGgtdDtpZigodm9pZCAwPT09cnx8cj5vKSYmKHI9byksZS5sZW5ndGg+MCYmKHI8MHx8dDwwKXx8dD50aGlzLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMiKTtufHwobj0idXRmOCIpO2Zvcih2YXIgaT0hMTs7KXN3aXRjaChuKXtjYXNlImhleCI6cmV0dXJuIGcodGhpcyxlLHQscik7Y2FzZSJ1dGY4IjpjYXNlInV0Zi04IjpyZXR1cm4gdih0aGlzLGUsdCxyKTtjYXNlImFzY2lpIjpyZXR1cm4gdyh0aGlzLGUsdCxyKTtjYXNlImxhdGluMSI6Y2FzZSJiaW5hcnkiOnJldHVybiBfKHRoaXMsZSx0LHIpO2Nhc2UiYmFzZTY0IjpyZXR1cm4gYih0aGlzLGUsdCxyKTtjYXNlInVjczIiOmNhc2UidWNzLTIiOmNhc2UidXRmMTZsZSI6Y2FzZSJ1dGYtMTZsZSI6cmV0dXJuIEEodGhpcyxlLHQscik7ZGVmYXVsdDppZihpKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIrbik7bj0oIiIrbikudG9Mb3dlckNhc2UoKSxpPSEwfX0sdS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJue3R5cGU6IkJ1ZmZlciIsZGF0YTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzLl9hcnJ8fHRoaXMsMCl9fTt2YXIgaz00MDk2O2Z1bmN0aW9uIFAoZSx0LHIpe3ZhciBuPSIiO3I9TWF0aC5taW4oZS5sZW5ndGgscik7Zm9yKHZhciBvPXQ7bzxyOysrbyluKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDEyNyZlW29dKTtyZXR1cm4gbn1mdW5jdGlvbiBEKGUsdCxyKXt2YXIgbj0iIjtyPU1hdGgubWluKGUubGVuZ3RoLHIpO2Zvcih2YXIgbz10O288cjsrK28pbis9U3RyaW5nLmZyb21DaGFyQ29kZShlW29dKTtyZXR1cm4gbn1mdW5jdGlvbiBSKGUsdCxyKXt2YXIgbj1lLmxlbmd0aDsoIXR8fHQ8MCkmJih0PTApLCghcnx8cjwwfHxyPm4pJiYocj1uKTtmb3IodmFyIG89IiIsaT10O2k8cjsrK2kpbys9aihlW2ldKTtyZXR1cm4gb31mdW5jdGlvbiBPKGUsdCxyKXtmb3IodmFyIG49ZS5zbGljZSh0LHIpLG89IiIsaT0wO2k8bi5sZW5ndGg7aSs9MilvKz1TdHJpbmcuZnJvbUNoYXJDb2RlKG5baV0rMjU2Km5baSsxXSk7cmV0dXJuIG99ZnVuY3Rpb24gQyhlLHQscil7aWYoZSUxIT0wfHxlPDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm9mZnNldCBpcyBub3QgdWludCIpO2lmKGUrdD5yKXRocm93IG5ldyBSYW5nZUVycm9yKCJUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoIil9ZnVuY3Rpb24gTihlLHQscixuLG8saSl7aWYoIXUuaXNCdWZmZXIoZSkpdGhyb3cgbmV3IFR5cGVFcnJvcignImJ1ZmZlciIgYXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciBpbnN0YW5jZScpO2lmKHQ+b3x8dDxpKXRocm93IG5ldyBSYW5nZUVycm9yKCcidmFsdWUiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKTtpZihyK24+ZS5sZW5ndGgpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIEYoZSx0LHIsbil7dDwwJiYodD02NTUzNSt0KzEpO2Zvcih2YXIgbz0wLGk9TWF0aC5taW4oZS5sZW5ndGgtciwyKTtvPGk7KytvKWVbcitvXT0odCYyNTU8PDgqKG4/bzoxLW8pKT4+PjgqKG4/bzoxLW8pfWZ1bmN0aW9uIE0oZSx0LHIsbil7dDwwJiYodD00Mjk0OTY3Mjk1K3QrMSk7Zm9yKHZhciBvPTAsaT1NYXRoLm1pbihlLmxlbmd0aC1yLDQpO288aTsrK28pZVtyK29dPXQ+Pj44KihuP286My1vKSYyNTV9ZnVuY3Rpb24gSShlLHQscixuLG8saSl7aWYocituPmUubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmRleCBvdXQgb2YgcmFuZ2UiKTtpZihyPDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIEIoZSx0LHIsbixpKXtyZXR1cm4gaXx8SShlLDAsciw0KSxvLndyaXRlKGUsdCxyLG4sMjMsNCkscis0fWZ1bmN0aW9uIEwoZSx0LHIsbixpKXtyZXR1cm4gaXx8SShlLDAsciw4KSxvLndyaXRlKGUsdCxyLG4sNTIsOCkscis4fXUucHJvdG90eXBlLnNsaWNlPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbj10aGlzLmxlbmd0aDtpZigoZT1+fmUpPDA/KGUrPW4pPDAmJihlPTApOmU+biYmKGU9biksKHQ9dm9pZCAwPT09dD9uOn5+dCk8MD8odCs9bik8MCYmKHQ9MCk6dD5uJiYodD1uKSx0PGUmJih0PWUpLHUuVFlQRURfQVJSQVlfU1VQUE9SVCkocj10aGlzLnN1YmFycmF5KGUsdCkpLl9fcHJvdG9fXz11LnByb3RvdHlwZTtlbHNle3ZhciBvPXQtZTtyPW5ldyB1KG8sdm9pZCAwKTtmb3IodmFyIGk9MDtpPG87KytpKXJbaV09dGhpc1tpK2VdfXJldHVybiByfSx1LnByb3RvdHlwZS5yZWFkVUludExFPWZ1bmN0aW9uKGUsdCxyKXtlfD0wLHR8PTAscnx8QyhlLHQsdGhpcy5sZW5ndGgpO2Zvcih2YXIgbj10aGlzW2VdLG89MSxpPTA7KytpPHQmJihvKj0yNTYpOyluKz10aGlzW2UraV0qbztyZXR1cm4gbn0sdS5wcm90b3R5cGUucmVhZFVJbnRCRT1mdW5jdGlvbihlLHQscil7ZXw9MCx0fD0wLHJ8fEMoZSx0LHRoaXMubGVuZ3RoKTtmb3IodmFyIG49dGhpc1tlKy0tdF0sbz0xO3Q+MCYmKG8qPTI1Nik7KW4rPXRoaXNbZSstLXRdKm87cmV0dXJuIG59LHUucHJvdG90eXBlLnJlYWRVSW50OD1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsMSx0aGlzLmxlbmd0aCksdGhpc1tlXX0sdS5wcm90b3R5cGUucmVhZFVJbnQxNkxFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwyLHRoaXMubGVuZ3RoKSx0aGlzW2VdfHRoaXNbZSsxXTw8OH0sdS5wcm90b3R5cGUucmVhZFVJbnQxNkJFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwyLHRoaXMubGVuZ3RoKSx0aGlzW2VdPDw4fHRoaXNbZSsxXX0sdS5wcm90b3R5cGUucmVhZFVJbnQzMkxFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSw0LHRoaXMubGVuZ3RoKSwodGhpc1tlXXx0aGlzW2UrMV08PDh8dGhpc1tlKzJdPDwxNikrMTY3NzcyMTYqdGhpc1tlKzNdfSx1LnByb3RvdHlwZS5yZWFkVUludDMyQkU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8QyhlLDQsdGhpcy5sZW5ndGgpLDE2Nzc3MjE2KnRoaXNbZV0rKHRoaXNbZSsxXTw8MTZ8dGhpc1tlKzJdPDw4fHRoaXNbZSszXSl9LHUucHJvdG90eXBlLnJlYWRJbnRMRT1mdW5jdGlvbihlLHQscil7ZXw9MCx0fD0wLHJ8fEMoZSx0LHRoaXMubGVuZ3RoKTtmb3IodmFyIG49dGhpc1tlXSxvPTEsaT0wOysraTx0JiYobyo9MjU2KTspbis9dGhpc1tlK2ldKm87cmV0dXJuIG4+PShvKj0xMjgpJiYobi09TWF0aC5wb3coMiw4KnQpKSxufSx1LnByb3RvdHlwZS5yZWFkSW50QkU9ZnVuY3Rpb24oZSx0LHIpe2V8PTAsdHw9MCxyfHxDKGUsdCx0aGlzLmxlbmd0aCk7Zm9yKHZhciBuPXQsbz0xLGk9dGhpc1tlKy0tbl07bj4wJiYobyo9MjU2KTspaSs9dGhpc1tlKy0tbl0qbztyZXR1cm4gaT49KG8qPTEyOCkmJihpLT1NYXRoLnBvdygyLDgqdCkpLGl9LHUucHJvdG90eXBlLnJlYWRJbnQ4PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwxLHRoaXMubGVuZ3RoKSwxMjgmdGhpc1tlXT8tMSooMjU1LXRoaXNbZV0rMSk6dGhpc1tlXX0sdS5wcm90b3R5cGUucmVhZEludDE2TEU9ZnVuY3Rpb24oZSx0KXt0fHxDKGUsMix0aGlzLmxlbmd0aCk7dmFyIHI9dGhpc1tlXXx0aGlzW2UrMV08PDg7cmV0dXJuIDMyNzY4JnI/NDI5NDkwMTc2MHxyOnJ9LHUucHJvdG90eXBlLnJlYWRJbnQxNkJFPWZ1bmN0aW9uKGUsdCl7dHx8QyhlLDIsdGhpcy5sZW5ndGgpO3ZhciByPXRoaXNbZSsxXXx0aGlzW2VdPDw4O3JldHVybiAzMjc2OCZyPzQyOTQ5MDE3NjB8cjpyfSx1LnByb3RvdHlwZS5yZWFkSW50MzJMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksdGhpc1tlXXx0aGlzW2UrMV08PDh8dGhpc1tlKzJdPDwxNnx0aGlzW2UrM108PDI0fSx1LnByb3RvdHlwZS5yZWFkSW50MzJCRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksdGhpc1tlXTw8MjR8dGhpc1tlKzFdPDwxNnx0aGlzW2UrMl08PDh8dGhpc1tlKzNdfSx1LnByb3RvdHlwZS5yZWFkRmxvYXRMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksby5yZWFkKHRoaXMsZSwhMCwyMyw0KX0sdS5wcm90b3R5cGUucmVhZEZsb2F0QkU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8QyhlLDQsdGhpcy5sZW5ndGgpLG8ucmVhZCh0aGlzLGUsITEsMjMsNCl9LHUucHJvdG90eXBlLnJlYWREb3VibGVMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsOCx0aGlzLmxlbmd0aCksby5yZWFkKHRoaXMsZSwhMCw1Miw4KX0sdS5wcm90b3R5cGUucmVhZERvdWJsZUJFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSw4LHRoaXMubGVuZ3RoKSxvLnJlYWQodGhpcyxlLCExLDUyLDgpfSx1LnByb3RvdHlwZS53cml0ZVVJbnRMRT1mdW5jdGlvbihlLHQscixuKXtlPStlLHR8PTAscnw9MCxufHxOKHRoaXMsZSx0LHIsTWF0aC5wb3coMiw4KnIpLTEsMCk7dmFyIG89MSxpPTA7Zm9yKHRoaXNbdF09MjU1JmU7KytpPHImJihvKj0yNTYpOyl0aGlzW3QraV09ZS9vJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZVVJbnRCRT1mdW5jdGlvbihlLHQscixuKXtlPStlLHR8PTAscnw9MCxufHxOKHRoaXMsZSx0LHIsTWF0aC5wb3coMiw4KnIpLTEsMCk7dmFyIG89ci0xLGk9MTtmb3IodGhpc1t0K29dPTI1NSZlOy0tbz49MCYmKGkqPTI1Nik7KXRoaXNbdCtvXT1lL2kmMjU1O3JldHVybiB0K3J9LHUucHJvdG90eXBlLndyaXRlVUludDg9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwxLDI1NSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlR8fChlPU1hdGguZmxvb3IoZSkpLHRoaXNbdF09MjU1JmUsdCsxfSx1LnByb3RvdHlwZS53cml0ZVVJbnQxNkxFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsMiw2NTUzNSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09MjU1JmUsdGhpc1t0KzFdPWU+Pj44KTpGKHRoaXMsZSx0LCEwKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlVUludDE2QkU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwyLDY1NTM1LDApLHUuVFlQRURfQVJSQVlfU1VQUE9SVD8odGhpc1t0XT1lPj4+OCx0aGlzW3QrMV09MjU1JmUpOkYodGhpcyxlLHQsITEpLHQrMn0sdS5wcm90b3R5cGUud3JpdGVVSW50MzJMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDQsNDI5NDk2NzI5NSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdCszXT1lPj4+MjQsdGhpc1t0KzJdPWU+Pj4xNix0aGlzW3QrMV09ZT4+PjgsdGhpc1t0XT0yNTUmZSk6TSh0aGlzLGUsdCwhMCksdCs0fSx1LnByb3RvdHlwZS53cml0ZVVJbnQzMkJFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsNCw0Mjk0OTY3Mjk1LDApLHUuVFlQRURfQVJSQVlfU1VQUE9SVD8odGhpc1t0XT1lPj4+MjQsdGhpc1t0KzFdPWU+Pj4xNix0aGlzW3QrMl09ZT4+PjgsdGhpc1t0KzNdPTI1NSZlKTpNKHRoaXMsZSx0LCExKSx0KzR9LHUucHJvdG90eXBlLndyaXRlSW50TEU9ZnVuY3Rpb24oZSx0LHIsbil7aWYoZT0rZSx0fD0wLCFuKXt2YXIgbz1NYXRoLnBvdygyLDgqci0xKTtOKHRoaXMsZSx0LHIsby0xLC1vKX12YXIgaT0wLGE9MSxzPTA7Zm9yKHRoaXNbdF09MjU1JmU7KytpPHImJihhKj0yNTYpOyllPDAmJjA9PT1zJiYwIT09dGhpc1t0K2ktMV0mJihzPTEpLHRoaXNbdCtpXT0oZS9hPj4wKS1zJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZUludEJFPWZ1bmN0aW9uKGUsdCxyLG4pe2lmKGU9K2UsdHw9MCwhbil7dmFyIG89TWF0aC5wb3coMiw4KnItMSk7Tih0aGlzLGUsdCxyLG8tMSwtbyl9dmFyIGk9ci0xLGE9MSxzPTA7Zm9yKHRoaXNbdCtpXT0yNTUmZTstLWk+PTAmJihhKj0yNTYpOyllPDAmJjA9PT1zJiYwIT09dGhpc1t0K2krMV0mJihzPTEpLHRoaXNbdCtpXT0oZS9hPj4wKS1zJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZUludDg9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwxLDEyNywtMTI4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlR8fChlPU1hdGguZmxvb3IoZSkpLGU8MCYmKGU9MjU1K2UrMSksdGhpc1t0XT0yNTUmZSx0KzF9LHUucHJvdG90eXBlLndyaXRlSW50MTZMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDIsMzI3NjcsLTMyNzY4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09MjU1JmUsdGhpc1t0KzFdPWU+Pj44KTpGKHRoaXMsZSx0LCEwKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlSW50MTZCRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDIsMzI3NjcsLTMyNzY4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09ZT4+PjgsdGhpc1t0KzFdPTI1NSZlKTpGKHRoaXMsZSx0LCExKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlSW50MzJMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDQsMjE0NzQ4MzY0NywtMjE0NzQ4MzY0OCksdS5UWVBFRF9BUlJBWV9TVVBQT1JUPyh0aGlzW3RdPTI1NSZlLHRoaXNbdCsxXT1lPj4+OCx0aGlzW3QrMl09ZT4+PjE2LHRoaXNbdCszXT1lPj4+MjQpOk0odGhpcyxlLHQsITApLHQrNH0sdS5wcm90b3R5cGUud3JpdGVJbnQzMkJFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsNCwyMTQ3NDgzNjQ3LC0yMTQ3NDgzNjQ4KSxlPDAmJihlPTQyOTQ5NjcyOTUrZSsxKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09ZT4+PjI0LHRoaXNbdCsxXT1lPj4+MTYsdGhpc1t0KzJdPWU+Pj44LHRoaXNbdCszXT0yNTUmZSk6TSh0aGlzLGUsdCwhMSksdCs0fSx1LnByb3RvdHlwZS53cml0ZUZsb2F0TEU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBCKHRoaXMsZSx0LCEwLHIpfSx1LnByb3RvdHlwZS53cml0ZUZsb2F0QkU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBCKHRoaXMsZSx0LCExLHIpfSx1LnByb3RvdHlwZS53cml0ZURvdWJsZUxFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gTCh0aGlzLGUsdCwhMCxyKX0sdS5wcm90b3R5cGUud3JpdGVEb3VibGVCRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIEwodGhpcyxlLHQsITEscil9LHUucHJvdG90eXBlLmNvcHk9ZnVuY3Rpb24oZSx0LHIsbil7aWYocnx8KHI9MCksbnx8MD09PW58fChuPXRoaXMubGVuZ3RoKSx0Pj1lLmxlbmd0aCYmKHQ9ZS5sZW5ndGgpLHR8fCh0PTApLG4+MCYmbjxyJiYobj1yKSxuPT09cilyZXR1cm4gMDtpZigwPT09ZS5sZW5ndGh8fDA9PT10aGlzLmxlbmd0aClyZXR1cm4gMDtpZih0PDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoInRhcmdldFN0YXJ0IG91dCBvZiBib3VuZHMiKTtpZihyPDB8fHI+PXRoaXMubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VTdGFydCBvdXQgb2YgYm91bmRzIik7aWYobjwwKXRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VFbmQgb3V0IG9mIGJvdW5kcyIpO24+dGhpcy5sZW5ndGgmJihuPXRoaXMubGVuZ3RoKSxlLmxlbmd0aC10PG4tciYmKG49ZS5sZW5ndGgtdCtyKTt2YXIgbyxpPW4tcjtpZih0aGlzPT09ZSYmcjx0JiZ0PG4pZm9yKG89aS0xO28+PTA7LS1vKWVbbyt0XT10aGlzW28rcl07ZWxzZSBpZihpPDFlM3x8IXUuVFlQRURfQVJSQVlfU1VQUE9SVClmb3Iobz0wO288aTsrK28pZVtvK3RdPXRoaXNbbytyXTtlbHNlIFVpbnQ4QXJyYXkucHJvdG90eXBlLnNldC5jYWxsKGUsdGhpcy5zdWJhcnJheShyLHIraSksdCk7cmV0dXJuIGl9LHUucHJvdG90eXBlLmZpbGw9ZnVuY3Rpb24oZSx0LHIsbil7aWYoInN0cmluZyI9PXR5cGVvZiBlKXtpZigic3RyaW5nIj09dHlwZW9mIHQ/KG49dCx0PTAscj10aGlzLmxlbmd0aCk6InN0cmluZyI9PXR5cGVvZiByJiYobj1yLHI9dGhpcy5sZW5ndGgpLDE9PT1lLmxlbmd0aCl7dmFyIG89ZS5jaGFyQ29kZUF0KDApO288MjU2JiYoZT1vKX1pZih2b2lkIDAhPT1uJiYic3RyaW5nIiE9dHlwZW9mIG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZyIpO2lmKCJzdHJpbmciPT10eXBlb2YgbiYmIXUuaXNFbmNvZGluZyhuKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGVuY29kaW5nOiAiK24pfWVsc2UibnVtYmVyIj09dHlwZW9mIGUmJihlJj0yNTUpO2lmKHQ8MHx8dGhpcy5sZW5ndGg8dHx8dGhpcy5sZW5ndGg8cil0aHJvdyBuZXcgUmFuZ2VFcnJvcigiT3V0IG9mIHJhbmdlIGluZGV4Iik7aWYocjw9dClyZXR1cm4gdGhpczt2YXIgaTtpZih0Pj4+PTAscj12b2lkIDA9PT1yP3RoaXMubGVuZ3RoOnI+Pj4wLGV8fChlPTApLCJudW1iZXIiPT10eXBlb2YgZSlmb3IoaT10O2k8cjsrK2kpdGhpc1tpXT1lO2Vsc2V7dmFyIGE9dS5pc0J1ZmZlcihlKT9lOlUobmV3IHUoZSxuKS50b1N0cmluZygpKSxzPWEubGVuZ3RoO2ZvcihpPTA7aTxyLXQ7KytpKXRoaXNbaSt0XT1hW2klc119cmV0dXJuIHRoaXN9O3ZhciB4PS9bXitcLzAtOUEtWmEtei1fXS9nO2Z1bmN0aW9uIGooZSl7cmV0dXJuIGU8MTY/IjAiK2UudG9TdHJpbmcoMTYpOmUudG9TdHJpbmcoMTYpfWZ1bmN0aW9uIFUoZSx0KXt2YXIgcjt0PXR8fDEvMDtmb3IodmFyIG49ZS5sZW5ndGgsbz1udWxsLGk9W10sYT0wO2E8bjsrK2Epe2lmKChyPWUuY2hhckNvZGVBdChhKSk+NTUyOTUmJnI8NTczNDQpe2lmKCFvKXtpZihyPjU2MzE5KXsodC09Myk+LTEmJmkucHVzaCgyMzksMTkxLDE4OSk7Y29udGludWV9aWYoYSsxPT09bil7KHQtPTMpPi0xJiZpLnB1c2goMjM5LDE5MSwxODkpO2NvbnRpbnVlfW89cjtjb250aW51ZX1pZihyPDU2MzIwKXsodC09Myk+LTEmJmkucHVzaCgyMzksMTkxLDE4OSksbz1yO2NvbnRpbnVlfXI9NjU1MzYrKG8tNTUyOTY8PDEwfHItNTYzMjApfWVsc2UgbyYmKHQtPTMpPi0xJiZpLnB1c2goMjM5LDE5MSwxODkpO2lmKG89bnVsbCxyPDEyOCl7aWYoKHQtPTEpPDApYnJlYWs7aS5wdXNoKHIpfWVsc2UgaWYocjwyMDQ4KXtpZigodC09Mik8MClicmVhaztpLnB1c2gocj4+NnwxOTIsNjMmcnwxMjgpfWVsc2UgaWYocjw2NTUzNil7aWYoKHQtPTMpPDApYnJlYWs7aS5wdXNoKHI+PjEyfDIyNCxyPj42JjYzfDEyOCw2MyZyfDEyOCl9ZWxzZXtpZighKHI8MTExNDExMikpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvZGUgcG9pbnQiKTtpZigodC09NCk8MClicmVhaztpLnB1c2gocj4+MTh8MjQwLHI+PjEyJjYzfDEyOCxyPj42JjYzfDEyOCw2MyZyfDEyOCl9fXJldHVybiBpfWZ1bmN0aW9uIHooZSl7cmV0dXJuIG4udG9CeXRlQXJyYXkoZnVuY3Rpb24oZSl7aWYoKGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGUudHJpbT9lLnRyaW0oKTplLnJlcGxhY2UoL15ccyt8XHMrJC9nLCIiKX0oZSkucmVwbGFjZSh4LCIiKSkubGVuZ3RoPDIpcmV0dXJuIiI7Zm9yKDtlLmxlbmd0aCU0IT0wOyllKz0iPSI7cmV0dXJuIGV9KGUpKX1mdW5jdGlvbiAkKGUsdCxyLG4pe2Zvcih2YXIgbz0wO288biYmIShvK3I+PXQubGVuZ3RofHxvPj1lLmxlbmd0aCk7KytvKXRbbytyXT1lW29dO3JldHVybiBvfX0pLmNhbGwodGhpcyxyKDgpKX0sZnVuY3Rpb24oZSx0KXt2YXIgcjtyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCk7dHJ5e3I9cnx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKXx8KDAsZXZhbCkoInRoaXMiKX1jYXRjaChlKXsib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmKHI9d2luZG93KX1lLmV4cG9ydHM9cn0sZnVuY3Rpb24oZSx0LHIpe3QuYnl0ZUxlbmd0aD1mdW5jdGlvbihlKXt2YXIgdD1jKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIDMqKHIrbikvNC1ufSx0LnRvQnl0ZUFycmF5PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxyPWMoZSksbj1yWzBdLGE9clsxXSxzPW5ldyBpKGZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gMyoodCtyKS80LXJ9KDAsbixhKSksdT0wLGw9YT4wP24tNDpuLGY9MDtmPGw7Zis9NCl0PW9bZS5jaGFyQ29kZUF0KGYpXTw8MTh8b1tlLmNoYXJDb2RlQXQoZisxKV08PDEyfG9bZS5jaGFyQ29kZUF0KGYrMildPDw2fG9bZS5jaGFyQ29kZUF0KGYrMyldLHNbdSsrXT10Pj4xNiYyNTUsc1t1KytdPXQ+PjgmMjU1LHNbdSsrXT0yNTUmdDtyZXR1cm4gMj09PWEmJih0PW9bZS5jaGFyQ29kZUF0KGYpXTw8MnxvW2UuY2hhckNvZGVBdChmKzEpXT4+NCxzW3UrK109MjU1JnQpLDE9PT1hJiYodD1vW2UuY2hhckNvZGVBdChmKV08PDEwfG9bZS5jaGFyQ29kZUF0KGYrMSldPDw0fG9bZS5jaGFyQ29kZUF0KGYrMildPj4yLHNbdSsrXT10Pj44JjI1NSxzW3UrK109MjU1JnQpLHN9LHQuZnJvbUJ5dGVBcnJheT1mdW5jdGlvbihlKXtmb3IodmFyIHQscj1lLmxlbmd0aCxvPXIlMyxpPVtdLGE9MCxzPXItbzthPHM7YSs9MTYzODMpaS5wdXNoKGYoZSxhLGErMTYzODM+cz9zOmErMTYzODMpKTtyZXR1cm4gMT09PW8/KHQ9ZVtyLTFdLGkucHVzaChuW3Q+PjJdK25bdDw8NCY2M10rIj09IikpOjI9PT1vJiYodD0oZVtyLTJdPDw4KStlW3ItMV0saS5wdXNoKG5bdD4+MTBdK25bdD4+NCY2M10rblt0PDwyJjYzXSsiPSIpKSxpLmpvaW4oIiIpfTtmb3IodmFyIG49W10sbz1bXSxpPSJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhBcnJheT9VaW50OEFycmF5OkFycmF5LGE9IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iLHM9MCx1PWEubGVuZ3RoO3M8dTsrK3MpbltzXT1hW3NdLG9bYS5jaGFyQ29kZUF0KHMpXT1zO2Z1bmN0aW9uIGMoZSl7dmFyIHQ9ZS5sZW5ndGg7aWYodCU0PjApdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0Iik7dmFyIHI9ZS5pbmRleE9mKCI9Iik7cmV0dXJuLTE9PT1yJiYocj10KSxbcixyPT09dD8wOjQtciU0XX1mdW5jdGlvbiBsKGUpe3JldHVybiBuW2U+PjE4JjYzXStuW2U+PjEyJjYzXStuW2U+PjYmNjNdK25bNjMmZV19ZnVuY3Rpb24gZihlLHQscil7Zm9yKHZhciBuLG89W10saT10O2k8cjtpKz0zKW49KGVbaV08PDE2JjE2NzExNjgwKSsoZVtpKzFdPDw4JjY1MjgwKSsoMjU1JmVbaSsyXSksby5wdXNoKGwobikpO3JldHVybiBvLmpvaW4oIiIpfW9bIi0iLmNoYXJDb2RlQXQoMCldPTYyLG9bIl8iLmNoYXJDb2RlQXQoMCldPTYzfSxmdW5jdGlvbihlLHQpe3QucmVhZD1mdW5jdGlvbihlLHQscixuLG8pe3ZhciBpLGEscz04Km8tbi0xLHU9KDE8PHMpLTEsYz11Pj4xLGw9LTcsZj1yP28tMTowLGQ9cj8tMToxLGg9ZVt0K2ZdO2ZvcihmKz1kLGk9aCYoMTw8LWwpLTEsaD4+PS1sLGwrPXM7bD4wO2k9MjU2KmkrZVt0K2ZdLGYrPWQsbC09OCk7Zm9yKGE9aSYoMTw8LWwpLTEsaT4+PS1sLGwrPW47bD4wO2E9MjU2KmErZVt0K2ZdLGYrPWQsbC09OCk7aWYoMD09PWkpaT0xLWM7ZWxzZXtpZihpPT09dSlyZXR1cm4gYT9OYU46MS8wKihoPy0xOjEpO2ErPU1hdGgucG93KDIsbiksaS09Y31yZXR1cm4oaD8tMToxKSphKk1hdGgucG93KDIsaS1uKX0sdC53cml0ZT1mdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGEscyx1LGM9OCppLW8tMSxsPSgxPDxjKS0xLGY9bD4+MSxkPTIzPT09bz9NYXRoLnBvdygyLC0yNCktTWF0aC5wb3coMiwtNzcpOjAsaD1uPzA6aS0xLHA9bj8xOi0xLG09dDwwfHwwPT09dCYmMS90PDA/MTowO2Zvcih0PU1hdGguYWJzKHQpLGlzTmFOKHQpfHx0PT09MS8wPyhzPWlzTmFOKHQpPzE6MCxhPWwpOihhPU1hdGguZmxvb3IoTWF0aC5sb2codCkvTWF0aC5MTjIpLHQqKHU9TWF0aC5wb3coMiwtYSkpPDEmJihhLS0sdSo9MiksKHQrPWErZj49MT9kL3U6ZCpNYXRoLnBvdygyLDEtZikpKnU+PTImJihhKyssdS89MiksYStmPj1sPyhzPTAsYT1sKTphK2Y+PTE/KHM9KHQqdS0xKSpNYXRoLnBvdygyLG8pLGErPWYpOihzPXQqTWF0aC5wb3coMixmLTEpKk1hdGgucG93KDIsbyksYT0wKSk7bz49ODtlW3IraF09MjU1JnMsaCs9cCxzLz0yNTYsby09OCk7Zm9yKGE9YTw8b3xzLGMrPW87Yz4wO2VbcitoXT0yNTUmYSxoKz1wLGEvPTI1NixjLT04KTtlW3IraC1wXXw9MTI4Km19fSxmdW5jdGlvbihlLHQpe3ZhciByPXt9LnRvU3RyaW5nO2UuZXhwb3J0cz1BcnJheS5pc0FycmF5fHxmdW5jdGlvbihlKXtyZXR1cm4iW29iamVjdCBBcnJheV0iPT1yLmNhbGwoZSl9fSxmdW5jdGlvbih0LHIpe3QuZXhwb3J0cz1lfSxmdW5jdGlvbihlLHQscil7KGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHIoZSx0KXtmb3IodmFyIHI9MCxuPWUubGVuZ3RoLTE7bj49MDtuLS0pe3ZhciBvPWVbbl07Ii4iPT09bz9lLnNwbGljZShuLDEpOiIuLiI9PT1vPyhlLnNwbGljZShuLDEpLHIrKyk6ciYmKGUuc3BsaWNlKG4sMSksci0tKX1pZih0KWZvcig7ci0tO3IpZS51bnNoaWZ0KCIuLiIpO3JldHVybiBlfXZhciBuPS9eKFwvP3wpKFtcc1xTXSo/KSgoPzpcLnsxLDJ9fFteXC9dKz98KShcLlteLlwvXSp8KSkoPzpbXC9dKikkLyxvPWZ1bmN0aW9uKGUpe3JldHVybiBuLmV4ZWMoZSkuc2xpY2UoMSl9O2Z1bmN0aW9uIGkoZSx0KXtpZihlLmZpbHRlcilyZXR1cm4gZS5maWx0ZXIodCk7Zm9yKHZhciByPVtdLG49MDtuPGUubGVuZ3RoO24rKyl0KGVbbl0sbixlKSYmci5wdXNoKGVbbl0pO3JldHVybiByfXQucmVzb2x2ZT1mdW5jdGlvbigpe2Zvcih2YXIgdD0iIixuPSExLG89YXJndW1lbnRzLmxlbmd0aC0xO28+PS0xJiYhbjtvLS0pe3ZhciBhPW8+PTA/YXJndW1lbnRzW29dOmUuY3dkKCk7aWYoInN0cmluZyIhPXR5cGVvZiBhKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLnJlc29sdmUgbXVzdCBiZSBzdHJpbmdzIik7YSYmKHQ9YSsiLyIrdCxuPSIvIj09PWEuY2hhckF0KDApKX1yZXR1cm4obj8iLyI6IiIpKyh0PXIoaSh0LnNwbGl0KCIvIiksKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhbikuam9pbigiLyIpKXx8Ii4ifSx0Lm5vcm1hbGl6ZT1mdW5jdGlvbihlKXt2YXIgbj10LmlzQWJzb2x1dGUoZSksbz0iLyI9PT1hKGUsLTEpO3JldHVybihlPXIoaShlLnNwbGl0KCIvIiksKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhbikuam9pbigiLyIpKXx8bnx8KGU9Ii4iKSxlJiZvJiYoZSs9Ii8iKSwobj8iLyI6IiIpK2V9LHQuaXNBYnNvbHV0ZT1mdW5jdGlvbihlKXtyZXR1cm4iLyI9PT1lLmNoYXJBdCgwKX0sdC5qb2luPWZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO3JldHVybiB0Lm5vcm1hbGl6ZShpKGUsKGZ1bmN0aW9uKGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLmpvaW4gbXVzdCBiZSBzdHJpbmdzIik7cmV0dXJuIGV9KSkuam9pbigiLyIpKX0sdC5yZWxhdGl2ZT1mdW5jdGlvbihlLHIpe2Z1bmN0aW9uIG4oZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aCYmIiI9PT1lW3RdO3QrKyk7Zm9yKHZhciByPWUubGVuZ3RoLTE7cj49MCYmIiI9PT1lW3JdO3ItLSk7cmV0dXJuIHQ+cj9bXTplLnNsaWNlKHQsci10KzEpfWU9dC5yZXNvbHZlKGUpLnN1YnN0cigxKSxyPXQucmVzb2x2ZShyKS5zdWJzdHIoMSk7Zm9yKHZhciBvPW4oZS5zcGxpdCgiLyIpKSxpPW4oci5zcGxpdCgiLyIpKSxhPU1hdGgubWluKG8ubGVuZ3RoLGkubGVuZ3RoKSxzPWEsdT0wO3U8YTt1KyspaWYob1t1XSE9PWlbdV0pe3M9dTticmVha312YXIgYz1bXTtmb3IodT1zO3U8by5sZW5ndGg7dSsrKWMucHVzaCgiLi4iKTtyZXR1cm4oYz1jLmNvbmNhdChpLnNsaWNlKHMpKSkuam9pbigiLyIpfSx0LnNlcD0iLyIsdC5kZWxpbWl0ZXI9IjoiLHQuZGlybmFtZT1mdW5jdGlvbihlKXt2YXIgdD1vKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIHJ8fG4/KG4mJihuPW4uc3Vic3RyKDAsbi5sZW5ndGgtMSkpLHIrbik6Ii4ifSx0LmJhc2VuYW1lPWZ1bmN0aW9uKGUsdCl7dmFyIHI9byhlKVsyXTtyZXR1cm4gdCYmci5zdWJzdHIoLTEqdC5sZW5ndGgpPT09dCYmKHI9ci5zdWJzdHIoMCxyLmxlbmd0aC10Lmxlbmd0aCkpLHJ9LHQuZXh0bmFtZT1mdW5jdGlvbihlKXtyZXR1cm4gbyhlKVszXX07dmFyIGE9ImIiPT09ImFiIi5zdWJzdHIoLTEpP2Z1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZS5zdWJzdHIodCxyKX06ZnVuY3Rpb24oZSx0LHIpe3JldHVybiB0PDAmJih0PWUubGVuZ3RoK3QpLGUuc3Vic3RyKHQscil9fSkuY2FsbCh0aGlzLHIoMTQpKX0sZnVuY3Rpb24oZSx0KXt2YXIgcixuLG89ZS5leHBvcnRzPXt9O2Z1bmN0aW9uIGkoKXt0aHJvdyBuZXcgRXJyb3IoInNldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBhKCl7dGhyb3cgbmV3IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBzKGUpe2lmKHI9PT1zZXRUaW1lb3V0KXJldHVybiBzZXRUaW1lb3V0KGUsMCk7aWYoKHI9PT1pfHwhcikmJnNldFRpbWVvdXQpcmV0dXJuIHI9c2V0VGltZW91dCxzZXRUaW1lb3V0KGUsMCk7dHJ5e3JldHVybiByKGUsMCl9Y2F0Y2godCl7dHJ5e3JldHVybiByLmNhbGwobnVsbCxlLDApfWNhdGNoKHQpe3JldHVybiByLmNhbGwodGhpcyxlLDApfX19IWZ1bmN0aW9uKCl7dHJ5e3I9ImZ1bmN0aW9uIj09dHlwZW9mIHNldFRpbWVvdXQ/c2V0VGltZW91dDppfWNhdGNoKGUpe3I9aX10cnl7bj0iZnVuY3Rpb24iPT10eXBlb2YgY2xlYXJUaW1lb3V0P2NsZWFyVGltZW91dDphfWNhdGNoKGUpe249YX19KCk7dmFyIHUsYz1bXSxsPSExLGY9LTE7ZnVuY3Rpb24gZCgpe2wmJnUmJihsPSExLHUubGVuZ3RoP2M9dS5jb25jYXQoYyk6Zj0tMSxjLmxlbmd0aCYmaCgpKX1mdW5jdGlvbiBoKCl7aWYoIWwpe3ZhciBlPXMoZCk7bD0hMDtmb3IodmFyIHQ9Yy5sZW5ndGg7dDspe2Zvcih1PWMsYz1bXTsrK2Y8dDspdSYmdVtmXS5ydW4oKTtmPS0xLHQ9Yy5sZW5ndGh9dT1udWxsLGw9ITEsZnVuY3Rpb24oZSl7aWYobj09PWNsZWFyVGltZW91dClyZXR1cm4gY2xlYXJUaW1lb3V0KGUpO2lmKChuPT09YXx8IW4pJiZjbGVhclRpbWVvdXQpcmV0dXJuIG49Y2xlYXJUaW1lb3V0LGNsZWFyVGltZW91dChlKTt0cnl7bihlKX1jYXRjaCh0KXt0cnl7cmV0dXJuIG4uY2FsbChudWxsLGUpfWNhdGNoKHQpe3JldHVybiBuLmNhbGwodGhpcyxlKX19fShlKX19ZnVuY3Rpb24gcChlLHQpe3RoaXMuZnVuPWUsdGhpcy5hcnJheT10fWZ1bmN0aW9uIG0oKXt9by5uZXh0VGljaz1mdW5jdGlvbihlKXt2YXIgdD1uZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aC0xKTtpZihhcmd1bWVudHMubGVuZ3RoPjEpZm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyl0W3ItMV09YXJndW1lbnRzW3JdO2MucHVzaChuZXcgcChlLHQpKSwxIT09Yy5sZW5ndGh8fGx8fHMoaCl9LHAucHJvdG90eXBlLnJ1bj1mdW5jdGlvbigpe3RoaXMuZnVuLmFwcGx5KG51bGwsdGhpcy5hcnJheSl9LG8udGl0bGU9ImJyb3dzZXIiLG8uYnJvd3Nlcj0hMCxvLmVudj17fSxvLmFyZ3Y9W10sby52ZXJzaW9uPSIiLG8udmVyc2lvbnM9e30sby5vbj1tLG8uYWRkTGlzdGVuZXI9bSxvLm9uY2U9bSxvLm9mZj1tLG8ucmVtb3ZlTGlzdGVuZXI9bSxvLnJlbW92ZUFsbExpc3RlbmVycz1tLG8uZW1pdD1tLG8ucHJlcGVuZExpc3RlbmVyPW0sby5wcmVwZW5kT25jZUxpc3RlbmVyPW0sby5saXN0ZW5lcnM9ZnVuY3Rpb24oZSl7cmV0dXJuW119LG8uYmluZGluZz1mdW5jdGlvbihlKXt0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIil9LG8uY3dkPWZ1bmN0aW9uKCl7cmV0dXJuIi8ifSxvLmNoZGlyPWZ1bmN0aW9uKGUpe3Rocm93IG5ldyBFcnJvcigicHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkIil9LG8udW1hc2s9ZnVuY3Rpb24oKXtyZXR1cm4gMH19XSl9KHQuZnMpO2NvbnN0IHI9ZS51bnBhY2tCcmlkZ2U7bGV0IG47dmFyIG89ZnVuY3Rpb24oZSl7Y29uc3QgdD17fTtjcmVkZW50aWFscz0ib21pdCI7dmFyIG4sbz12b2lkIDAhPT10P3Q6e30saT1yLkV4dCxhPXtvcGVuOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC5vcGVuLmFwcGx5KGkuY3VycmVudCxhcmd1bWVudHMpfSxjbG9zZTpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQuY2xvc2UuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9LHJlYWQ6ZnVuY3Rpb24oKXtyZXR1cm4gaS5jdXJyZW50LnJlYWQuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9LHdyaXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC53cml0ZS5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sdGVsbDpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQudGVsbC5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sc2VlazpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQuc2Vlay5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sY3JlYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC5jcmVhdGUuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9fSxzPXt9O2ZvcihuIGluIG8pby5oYXNPd25Qcm9wZXJ0eShuKSYmKHNbbl09b1tuXSk7by5hcmd1bWVudHM9W10sby50aGlzUHJvZ3JhbT0iLi90aGlzLnByb2dyYW0iLG8ucXVpdD1mdW5jdGlvbihlLHQpe3Rocm93IHR9LG8ucHJlUnVuPVtdLG8ucG9zdFJ1bj1bXTt2YXIgdT0hMSxjPSExLGw9ITE7aWYoby5FTlZJUk9OTUVOVCl7aWYoIldFQiI9PT1vLkVOVklST05NRU5UKXU9ITA7ZWxzZSBpZigiV09SS0VSIj09PW8uRU5WSVJPTk1FTlQpYz0hMDtlbHNlIGlmKCJOT0RFIj09PW8uRU5WSVJPTk1FTlQpbD0hMDtlbHNlIGlmKCJTSEVMTCIhPT1vLkVOVklST05NRU5UKXRocm93IG5ldyBFcnJvcigiTW9kdWxlWydFTlZJUk9OTUVOVCddIHZhbHVlIGlzIG5vdCB2YWxpZC4gbXVzdCBiZSBvbmUgb2Y6IFdFQnxXT1JLRVJ8Tk9ERXxTSEVMTC4iKX1lbHNlIHU9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3csYz0iZnVuY3Rpb24iPT10eXBlb2YgaW1wb3J0U2NyaXB0cyxsPSJvYmplY3QiPT10eXBlb2YgcHJvY2VzcyYmImZ1bmN0aW9uIj09dHlwZW9mIHJlcXVpcmUmJiF1JiYhYztmb3IobiBpbih1fHxjKSYmKG8ucmVhZD1mdW5jdGlvbihlKXt2YXIgdD1uZXcgWE1MSHR0cFJlcXVlc3Q7cmV0dXJuIHQub3BlbigiR0VUIixlLCExKSx0LnNlbmQobnVsbCksdC5yZXNwb25zZVRleHR9LGMmJihvLnJlYWRCaW5hcnk9ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IFhNTEh0dHBSZXF1ZXN0O3JldHVybiB0Lm9wZW4oIkdFVCIsZSwhMSksdC5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIix0LnNlbmQobnVsbCksbmV3IFVpbnQ4QXJyYXkodC5yZXNwb25zZSl9KSxvLnJlYWRBc3luYz1mdW5jdGlvbihlLHQscil7dmFyIG49bmV3IFhNTEh0dHBSZXF1ZXN0O24ub3BlbigiR0VUIixlLCEwKSxuLnJlc3BvbnNlVHlwZT0iYXJyYXlidWZmZXIiLG4ub25sb2FkPWZ1bmN0aW9uKCl7MjAwPT1uLnN0YXR1c3x8MD09bi5zdGF0dXMmJm4ucmVzcG9uc2U/dChuLnJlc3BvbnNlKTpyKCl9LG4ub25lcnJvcj1yLG4uc2VuZChudWxsKX0sby5zZXRXaW5kb3dUaXRsZT1mdW5jdGlvbihlKXtkb2N1bWVudC50aXRsZT1lfSksby5wcmludD0idW5kZWZpbmVkIiE9dHlwZW9mIGNvbnNvbGU/Y29uc29sZS5sb2cuYmluZChjb25zb2xlKToidW5kZWZpbmVkIiE9dHlwZW9mIHByaW50P3ByaW50Om51bGwsby5wcmludEVycj0idW5kZWZpbmVkIiE9dHlwZW9mIHByaW50RXJyP3ByaW50RXJyOiJ1bmRlZmluZWQiIT10eXBlb2YgY29uc29sZSYmY29uc29sZS53YXJuLmJpbmQoY29uc29sZSl8fG8ucHJpbnQsby5wcmludD1vLnByaW50LG8ucHJpbnRFcnI9by5wcmludEVycixzKXMuaGFzT3duUHJvcGVydHkobikmJihvW25dPXNbbl0pO3M9dm9pZCAwO2Z1bmN0aW9uIGYoZSl7eSgheCk7dmFyIHQ9TDtyZXR1cm4gTD1MK2UrMTUmLTE2LHR9ZnVuY3Rpb24gZChlKXt5KCQpO3ZhciB0PUZbJD4+Ml0scj10K2UrMTUmLTE2O2lmKChGWyQ+PjJdPXIscj49cSkmJiFIKCkpcmV0dXJuIEZbJD4+Ml09dCwwO3JldHVybiB0fWZ1bmN0aW9uIGgoZSx0KXtyZXR1cm4gdHx8KHQ9MTYpLGU9TWF0aC5jZWlsKGUvdCkqdH1mdW5jdGlvbiBwKGUpe3N3aXRjaChlKXtjYXNlImkxIjpjYXNlImk4IjpyZXR1cm4gMTtjYXNlImkxNiI6cmV0dXJuIDI7Y2FzZSJpMzIiOnJldHVybiA0O2Nhc2UiaTY0IjpyZXR1cm4gODtjYXNlImZsb2F0IjpyZXR1cm4gNDtjYXNlImRvdWJsZSI6cmV0dXJuIDg7ZGVmYXVsdDppZigiKiI9PT1lW2UubGVuZ3RoLTFdKXJldHVybiA0O2lmKCJpIj09PWVbMF0pe3ZhciB0PXBhcnNlSW50KGUuc3Vic3RyKDEpKTtyZXR1cm4geSh0JTg9PTApLHQvOH1yZXR1cm4gMH19bmV3IEFycmF5KDApO3ZhciBtPTA7ZnVuY3Rpb24geShlLHQpe2V8fHJyKCJBc3NlcnRpb24gZmFpbGVkOiAiK3QpfWZ1bmN0aW9uIEUoZSx0LHIsbil7c3dpdGNoKCIqIj09PShyPXJ8fCJpOCIpLmNoYXJBdChyLmxlbmd0aC0xKSYmKHI9ImkzMiIpLHIpe2Nhc2UiaTEiOmNhc2UiaTgiOlJbZT4+MF09dDticmVhaztjYXNlImkxNiI6Q1tlPj4xXT10O2JyZWFrO2Nhc2UiaTMyIjpGW2U+PjJdPXQ7YnJlYWs7Y2FzZSJpNjQiOnRlbXBJNjQ9W3Q+Pj4wLCh0ZW1wRG91YmxlPXQsK25lKHRlbXBEb3VibGUpPj0xP3RlbXBEb3VibGU+MD8oMHxhZSgraWUodGVtcERvdWJsZS80Mjk0OTY3Mjk2KSw0Mjk0OTY3Mjk1KSk+Pj4wOn5+K29lKCh0ZW1wRG91YmxlLSsofn50ZW1wRG91YmxlPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRltlPj4yXT10ZW1wSTY0WzBdLEZbZSs0Pj4yXT10ZW1wSTY0WzFdO2JyZWFrO2Nhc2UiZmxvYXQiOklbZT4+Ml09dDticmVhaztjYXNlImRvdWJsZSI6QltlPj4zXT10O2JyZWFrO2RlZmF1bHQ6cnIoImludmFsaWQgdHlwZSBmb3Igc2V0VmFsdWU6ICIrcil9fWZ1bmN0aW9uIGcoZSx0LHIsbil7dmFyIG8saTsibnVtYmVyIj09dHlwZW9mIGU/KG89ITAsaT1lKToobz0hMSxpPWUubGVuZ3RoKTt2YXIgYSxzPSJzdHJpbmciPT10eXBlb2YgdD90Om51bGw7aWYoYT00PT1yP246WyJmdW5jdGlvbiI9PXR5cGVvZiBKdD9KdDpmLFF0LGYsZF1bdm9pZCAwPT09cj8yOnJdKE1hdGgubWF4KGkscz8xOnQubGVuZ3RoKSksbyl7dmFyIHU7Zm9yKG49YSx5KDA9PSgzJmEpKSx1PWErKC00JmkpO248dTtuKz00KUZbbj4+Ml09MDtmb3IodT1hK2k7bjx1OylSW24rKz4+MF09MDtyZXR1cm4gYX1pZigiaTgiPT09cylyZXR1cm4gZS5zdWJhcnJheXx8ZS5zbGljZT9PLnNldChlLGEpOk8uc2V0KG5ldyBVaW50OEFycmF5KGUpLGEpLGE7Zm9yKHZhciBjLGwsaCxtPTA7bTxpOyl7dmFyIGc9ZVttXTswIT09KGM9c3x8dFttXSk/KCJpNjQiPT1jJiYoYz0iaTMyIiksRShhK20sZyxjKSxoIT09YyYmKGw9cChjKSxoPWMpLG0rPWwpOm0rK31yZXR1cm4gYX1mdW5jdGlvbiB2KGUsdCl7aWYoMD09PXR8fCFlKXJldHVybiIiO2Zvcih2YXIgcixuPTAsbz0wO258PXI9T1tlK28+PjBdLCgwIT1yfHx0KSYmKG8rKywhdHx8byE9dCk7KTt0fHwodD1vKTt2YXIgaT0iIjtpZihuPDEyOCl7Zm9yKHZhciBhO3Q+MDspYT1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZyxPLnN1YmFycmF5KGUsZStNYXRoLm1pbih0LDEwMjQpKSksaT1pP2krYTphLGUrPTEwMjQsdC09MTAyNDtyZXR1cm4gaX1yZXR1cm4gYihlKX12YXIgdz0idW5kZWZpbmVkIiE9dHlwZW9mIFRleHREZWNvZGVyP25ldyBUZXh0RGVjb2RlcigidXRmOCIpOnZvaWQgMDtmdW5jdGlvbiBfKGUsdCl7Zm9yKHZhciByPXQ7ZVtyXTspKytyO2lmKHItdD4xNiYmZS5zdWJhcnJheSYmdylyZXR1cm4gdy5kZWNvZGUoZS5zdWJhcnJheSh0LHIpKTtmb3IodmFyIG4sbyxpLGEscyx1PSIiOzspe2lmKCEobj1lW3QrK10pKXJldHVybiB1O2lmKDEyOCZuKWlmKG89NjMmZVt0KytdLDE5MiE9KDIyNCZuKSlpZihpPTYzJmVbdCsrXSwyMjQ9PSgyNDAmbik/bj0oMTUmbik8PDEyfG88PDZ8aTooYT02MyZlW3QrK10sMjQwPT0oMjQ4Jm4pP249KDcmbik8PDE4fG88PDEyfGk8PDZ8YToocz02MyZlW3QrK10sbj0yNDg9PSgyNTImbik/KDMmbik8PDI0fG88PDE4fGk8PDEyfGE8PDZ8czooMSZuKTw8MzB8bzw8MjR8aTw8MTh8YTw8MTJ8czw8Nnw2MyZlW3QrK10pKSxuPDY1NTM2KXUrPVN0cmluZy5mcm9tQ2hhckNvZGUobik7ZWxzZXt2YXIgYz1uLTY1NTM2O3UrPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8Yz4+MTAsNTYzMjB8MTAyMyZjKX1lbHNlIHUrPVN0cmluZy5mcm9tQ2hhckNvZGUoKDMxJm4pPDw2fG8pO2Vsc2UgdSs9U3RyaW5nLmZyb21DaGFyQ29kZShuKX19ZnVuY3Rpb24gYihlKXtyZXR1cm4gXyhPLGUpfWZ1bmN0aW9uIEEoZSx0LHIsbil7aWYoIShuPjApKXJldHVybiAwO2Zvcih2YXIgbz1yLGk9cituLTEsYT0wO2E8ZS5sZW5ndGg7KythKXt2YXIgcz1lLmNoYXJDb2RlQXQoYSk7aWYocz49NTUyOTYmJnM8PTU3MzQzJiYocz02NTUzNisoKDEwMjMmcyk8PDEwKXwxMDIzJmUuY2hhckNvZGVBdCgrK2EpKSxzPD0xMjcpe2lmKHI+PWkpYnJlYWs7dFtyKytdPXN9ZWxzZSBpZihzPD0yMDQ3KXtpZihyKzE+PWkpYnJlYWs7dFtyKytdPTE5MnxzPj42LHRbcisrXT0xMjh8NjMmc31lbHNlIGlmKHM8PTY1NTM1KXtpZihyKzI+PWkpYnJlYWs7dFtyKytdPTIyNHxzPj4xMix0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2UgaWYoczw9MjA5NzE1MSl7aWYociszPj1pKWJyZWFrO3RbcisrXT0yNDB8cz4+MTgsdFtyKytdPTEyOHxzPj4xMiY2Myx0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2UgaWYoczw9NjcxMDg4NjMpe2lmKHIrND49aSlicmVhazt0W3IrK109MjQ4fHM+PjI0LHRbcisrXT0xMjh8cz4+MTgmNjMsdFtyKytdPTEyOHxzPj4xMiY2Myx0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2V7aWYocis1Pj1pKWJyZWFrO3RbcisrXT0yNTJ8cz4+MzAsdFtyKytdPTEyOHxzPj4yNCY2Myx0W3IrK109MTI4fHM+PjE4JjYzLHRbcisrXT0xMjh8cz4+MTImNjMsdFtyKytdPTEyOHxzPj42JjYzLHRbcisrXT0xMjh8NjMmc319cmV0dXJuIHRbcl09MCxyLW99ZnVuY3Rpb24gVChlLHQscil7cmV0dXJuIEEoZSxPLHQscil9ZnVuY3Rpb24gUyhlKXtmb3IodmFyIHQ9MCxyPTA7cjxlLmxlbmd0aDsrK3Ipe3ZhciBuPWUuY2hhckNvZGVBdChyKTtuPj01NTI5NiYmbjw9NTczNDMmJihuPTY1NTM2KygoMTAyMyZuKTw8MTApfDEwMjMmZS5jaGFyQ29kZUF0KCsrcikpLG48PTEyNz8rK3Q6dCs9bjw9MjA0Nz8yOm48PTY1NTM1PzM6bjw9MjA5NzE1MT80Om48PTY3MTA4ODYzPzU6Nn1yZXR1cm4gdH0idW5kZWZpbmVkIiE9dHlwZW9mIFRleHREZWNvZGVyJiZuZXcgVGV4dERlY29kZXIoInV0Zi0xNmxlIik7ZnVuY3Rpb24gayhlKXtmb3IodmFyIHQ9MCxyPSIiOzspe3ZhciBuPUZbZSs0KnQ+PjJdO2lmKDA9PW4pcmV0dXJuIHI7aWYoKyt0LG4+PTY1NTM2KXt2YXIgbz1uLTY1NTM2O3IrPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8bz4+MTAsNTYzMjB8MTAyMyZvKX1lbHNlIHIrPVN0cmluZy5mcm9tQ2hhckNvZGUobil9fWZ1bmN0aW9uIFAoKXt2YXIgZT1mdW5jdGlvbigpe3ZhciBlPW5ldyBFcnJvcjtpZighZS5zdGFjayl7dHJ5e3Rocm93IG5ldyBFcnJvcigwKX1jYXRjaCh0KXtlPXR9aWYoIWUuc3RhY2spcmV0dXJuIihubyBzdGFjayB0cmFjZSBhdmFpbGFibGUpIn1yZXR1cm4gZS5zdGFjay50b1N0cmluZygpfSgpO3JldHVybiBvLmV4dHJhU3RhY2tUcmFjZSYmKGUrPSJcbiIrby5leHRyYVN0YWNrVHJhY2UoKSksZS5yZXBsYWNlKC9fX1pbXHdcZF9dKy9nLChmdW5jdGlvbihlKXtyZXR1cm4gZT09ZT9lOmUrIiBbIitlKyJdIn0pKX12YXIgRCxSLE8sQyxOLEYsTSxJLEIsTCx4LGosVSx6LCQ7ZnVuY3Rpb24gVyhlLHQpe3JldHVybiBlJXQ+MCYmKGUrPXQtZSV0KSxlfWZ1bmN0aW9uIFkoZSl7by5idWZmZXI9RD1lfWZ1bmN0aW9uIFYoKXtvLkhFQVA4PVI9bmV3IEludDhBcnJheShEKSxvLkhFQVAxNj1DPW5ldyBJbnQxNkFycmF5KEQpLG8uSEVBUDMyPUY9bmV3IEludDMyQXJyYXkoRCksby5IRUFQVTg9Tz1uZXcgVWludDhBcnJheShEKSxvLkhFQVBVMTY9Tj1uZXcgVWludDE2QXJyYXkoRCksby5IRUFQVTMyPU09bmV3IFVpbnQzMkFycmF5KEQpLG8uSEVBUEYzMj1JPW5ldyBGbG9hdDMyQXJyYXkoRCksby5IRUFQRjY0PUI9bmV3IEZsb2F0NjRBcnJheShEKX1mdW5jdGlvbiBIKCl7dmFyIGU9by51c2luZ1dhc20/NjU1MzY6MTY3NzcyMTYsdD0yMTQ3NDgzNjQ4LWU7aWYoRlskPj4yXT50KXJldHVybiExO3ZhciByPXE7Zm9yKHE9TWF0aC5tYXgocSwxNjc3NzIxNik7cTxGWyQ+PjJdOylxPXE8PTUzNjg3MDkxMj9XKDIqcSxlKTpNYXRoLm1pbihXKCgzKnErMjE0NzQ4MzY0OCkvNCxlKSx0KTt2YXIgbj1vLnJlYWxsb2NCdWZmZXIocSk7cmV0dXJuIG4mJm4uYnl0ZUxlbmd0aD09cT8oWShuKSxWKCksITApOihxPXIsITEpfUw9VT0kPTAseD0hMSxvLnJlYWxsb2NCdWZmZXJ8fChvLnJlYWxsb2NCdWZmZXI9ZnVuY3Rpb24oZSl7dmFyIHQ7dHJ5e2lmKEFycmF5QnVmZmVyLnRyYW5zZmVyKXQ9QXJyYXlCdWZmZXIudHJhbnNmZXIoRCxlKTtlbHNle3ZhciByPVI7dD1uZXcgQXJyYXlCdWZmZXIoZSksbmV3IEludDhBcnJheSh0KS5zZXQocil9fWNhdGNoKGUpe3JldHVybiExfXJldHVybiEhWHQodCkmJnR9KTt0cnl7RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKEFycmF5QnVmZmVyLnByb3RvdHlwZSwiYnl0ZUxlbmd0aCIpLmdldCkobmV3IEFycmF5QnVmZmVyKDQpKX1jYXRjaChlKXsoZnVuY3Rpb24oZSl7cmV0dXJuIGUuYnl0ZUxlbmd0aH0pfXZhciBHPW8uVE9UQUxfU1RBQ0t8fDUyNDI4ODAscT1vLlRPVEFMX01FTU9SWXx8MTY3NzcyMTY7aWYocTxHJiZvLnByaW50RXJyKCJUT1RBTF9NRU1PUlkgc2hvdWxkIGJlIGxhcmdlciB0aGFuIFRPVEFMX1NUQUNLLCB3YXMgIitxKyIhIChUT1RBTF9TVEFDSz0iK0crIikiKSxvLmJ1ZmZlcj9EPW8uYnVmZmVyOigib2JqZWN0Ij09dHlwZW9mIFdlYkFzc2VtYmx5JiYiZnVuY3Rpb24iPT10eXBlb2YgV2ViQXNzZW1ibHkuTWVtb3J5PyhvLndhc21NZW1vcnk9bmV3IFdlYkFzc2VtYmx5Lk1lbW9yeSh7aW5pdGlhbDpxLzY1NTM2fSksRD1vLndhc21NZW1vcnkuYnVmZmVyKTpEPW5ldyBBcnJheUJ1ZmZlcihxKSxvLmJ1ZmZlcj1EKSxWKCksRlswXT0xNjY4NTA5MDI5LENbMV09MjU0NTksMTE1IT09T1syXXx8OTkhPT1PWzNdKXRocm93IlJ1bnRpbWUgZXJyb3I6IGV4cGVjdGVkIHRoZSBzeXN0ZW0gdG8gYmUgbGl0dGxlLWVuZGlhbiEiO2Z1bmN0aW9uIFgoZSl7Zm9yKDtlLmxlbmd0aD4wOyl7dmFyIHQ9ZS5zaGlmdCgpO2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0KXt2YXIgcj10LmZ1bmM7Im51bWJlciI9PXR5cGVvZiByP3ZvaWQgMD09PXQuYXJnP28uZHluQ2FsbF92KHIpOm8uZHluQ2FsbF92aShyLHQuYXJnKTpyKHZvaWQgMD09PXQuYXJnP251bGw6dC5hcmcpfWVsc2UgdCgpfX12YXIgSz1bXSxKPVtdLFo9W10sUT1bXSxlZT1bXSx0ZT0hMTtmdW5jdGlvbiByZShlLHQscil7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDsrK24pUlt0Kys+PjBdPWUuY2hhckNvZGVBdChuKTtyfHwoUlt0Pj4wXT0wKX12YXIgbmU9TWF0aC5hYnMsb2U9TWF0aC5jZWlsLGllPU1hdGguZmxvb3IsYWU9TWF0aC5taW4sc2U9MCx1ZT1udWxsO2Z1bmN0aW9uIGNlKGUpe3NlKyssby5tb25pdG9yUnVuRGVwZW5kZW5jaWVzJiZvLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMoc2UpfWZ1bmN0aW9uIGxlKGUpe2lmKHNlLS0sby5tb25pdG9yUnVuRGVwZW5kZW5jaWVzJiZvLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMoc2UpLDA9PXNlJiZ1ZSl7dmFyIHQ9dWU7dWU9bnVsbCx0KCl9fW8ucHJlbG9hZGVkSW1hZ2VzPXt9LG8ucHJlbG9hZGVkQXVkaW9zPXt9O2Z1bmN0aW9uIGZlKGUpe3JldHVybiBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGg/ZS5zdGFydHNXaXRoKCJkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsIik6MD09PWUuaW5kZXhPZigiZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCIpfSFmdW5jdGlvbigpe3ZhciB0PSJ1bnBhY2sud2FzdCIscj0idW5wYWNrLnRlbXAuYXNtLmpzIjsiZnVuY3Rpb24iPT10eXBlb2Ygby5sb2NhdGVGaWxlJiYoZmUodCl8fCh0PW8ubG9jYXRlRmlsZSh0KSksZmUoZSl8fChlPW8ubG9jYXRlRmlsZShlKSksZmUocil8fChyPW8ubG9jYXRlRmlsZShyKSkpO3ZhciBuPXtnbG9iYWw6bnVsbCxlbnY6bnVsbCxhc20yd2FzbTp7ImY2NC1yZW0iOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUldH0sZGVidWdnZXI6ZnVuY3Rpb24oKXt9fSxwYXJlbnQ6b30saT1udWxsO2Z1bmN0aW9uIGEoKXt0cnl7aWYoby53YXNtQmluYXJ5KXJldHVybiBuZXcgVWludDhBcnJheShvLndhc21CaW5hcnkpO2lmKG8ucmVhZEJpbmFyeSlyZXR1cm4gby5yZWFkQmluYXJ5KGUpO3Rocm93Im9uIHRoZSB3ZWIsIHdlIG5lZWQgdGhlIHdhc20gYmluYXJ5IHRvIGJlIHByZWxvYWRlZCBhbmQgc2V0IG9uIE1vZHVsZVsnd2FzbUJpbmFyeSddLiBlbWNjLnB5IHdpbGwgZG8gdGhhdCBmb3IgeW91IHdoZW4gZ2VuZXJhdGluZyBIVE1MIChidXQgbm90IEpTKSJ9Y2F0Y2goZSl7cnIoZSl9fWZ1bmN0aW9uIHModCxyLHMpe2lmKCJvYmplY3QiIT10eXBlb2YgV2ViQXNzZW1ibHkpcmV0dXJuIG8ucHJpbnRFcnIoIm5vIG5hdGl2ZSB3YXNtIHN1cHBvcnQgZGV0ZWN0ZWQiKSwhMTtpZighKG8ud2FzbU1lbW9yeSBpbnN0YW5jZW9mIFdlYkFzc2VtYmx5Lk1lbW9yeSkpcmV0dXJuIG8ucHJpbnRFcnIoIm5vIG5hdGl2ZSB3YXNtIE1lbW9yeSBpbiB1c2UiKSwhMTtmdW5jdGlvbiBsKGUsdCl7KGk9ZS5leHBvcnRzKS5tZW1vcnkmJmZ1bmN0aW9uKGUpe3ZhciB0PW8uYnVmZmVyO2UuYnl0ZUxlbmd0aDx0LmJ5dGVMZW5ndGgmJm8ucHJpbnRFcnIoInRoZSBuZXcgYnVmZmVyIGluIG1lcmdlTWVtb3J5IGlzIHNtYWxsZXIgdGhhbiB0aGUgcHJldmlvdXMgb25lLiBpbiBuYXRpdmUgd2FzbSwgd2Ugc2hvdWxkIGdyb3cgbWVtb3J5IGhlcmUiKTt2YXIgcj1uZXcgSW50OEFycmF5KHQpO25ldyBJbnQ4QXJyYXkoZSkuc2V0KHIpLFkoZSksVigpfShpLm1lbW9yeSksby5hc209aSxvLnVzaW5nV2FzbT0hMCxsZSgpfWlmKHIubWVtb3J5PW8ud2FzbU1lbW9yeSxuLmdsb2JhbD17TmFOOk5hTixJbmZpbml0eToxLzB9LG5bImdsb2JhbC5NYXRoIl09TWF0aCxuLmVudj1yLGNlKCksby5pbnN0YW50aWF0ZVdhc20pdHJ5e3JldHVybiBvLmluc3RhbnRpYXRlV2FzbShuLGwpfWNhdGNoKGUpe3JldHVybiBvLnByaW50RXJyKCJNb2R1bGUuaW5zdGFudGlhdGVXYXNtIGNhbGxiYWNrIGZhaWxlZCB3aXRoIGVycm9yOiAiK2UpLCExfWZ1bmN0aW9uIGYoZSl7bChlLmluc3RhbmNlLGUubW9kdWxlKX1mdW5jdGlvbiBkKHQpeyhvLndhc21CaW5hcnl8fCF1JiYhY3x8ImZ1bmN0aW9uIiE9dHlwZW9mIGZldGNoP25ldyBQcm9taXNlKChmdW5jdGlvbihlLHQpe2UoYSgpKX0pKTpmZXRjaChlLHtjcmVkZW50aWFsczoib21pdCJ9KS50aGVuKChmdW5jdGlvbih0KXtpZighdC5vayl0aHJvdyJmYWlsZWQgdG8gbG9hZCB3YXNtIGJpbmFyeSBmaWxlIGF0ICciK2UrIiciO3JldHVybiB0LmFycmF5QnVmZmVyKCl9KSkuY2F0Y2goKGZ1bmN0aW9uKCl7cmV0dXJuIGEoKX0pKSkudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGUsbil9KSkudGhlbih0KS5jYXRjaCgoZnVuY3Rpb24oZSl7by5wcmludEVycigiZmFpbGVkIHRvIGFzeW5jaHJvbm91c2x5IHByZXBhcmUgd2FzbTogIitlKSxycihlKX0pKX1yZXR1cm4gby53YXNtQmluYXJ5fHwiZnVuY3Rpb24iIT10eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmd8fGZlKGUpfHwiZnVuY3Rpb24iIT10eXBlb2YgZmV0Y2g/ZChmKTpXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyhmZXRjaChlLHtjcmVkZW50aWFsczoib21pdCJ9KSxuKS50aGVuKGYpLmNhdGNoKChmdW5jdGlvbihlKXtvLnByaW50RXJyKCJ3YXNtIHN0cmVhbWluZyBjb21waWxlIGZhaWxlZDogIitlKSxvLnByaW50RXJyKCJmYWxsaW5nIGJhY2sgdG8gQXJyYXlCdWZmZXIgaW5zdGFudGlhdGlvbiIpLGQoZil9KSkse319by5hc21QcmVsb2FkPW8uYXNtLG8ucmVhbGxvY0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSl7ZT1XKGUsby51c2luZ1dhc20/NjU1MzY6MTY3NzcyMTYpO3ZhciB0PW8uYnVmZmVyLmJ5dGVMZW5ndGg7aWYoby51c2luZ1dhc20pdHJ5e3JldHVybi0xIT09by53YXNtTWVtb3J5Lmdyb3coKGUtdCkvNjU1MzYpP28uYnVmZmVyPW8ud2FzbU1lbW9yeS5idWZmZXI6bnVsbH1jYXRjaChlKXtyZXR1cm4gbnVsbH19KGUpfSxvLmFzbT1mdW5jdGlvbihlLHQscil7aWYoISh0PXQpLnRhYmxlKXt2YXIgbj1vLndhc21UYWJsZVNpemU7dm9pZCAwPT09biYmKG49MTAyNCk7dmFyIGk9by53YXNtTWF4VGFibGVTaXplOyJvYmplY3QiPT10eXBlb2YgV2ViQXNzZW1ibHkmJiJmdW5jdGlvbiI9PXR5cGVvZiBXZWJBc3NlbWJseS5UYWJsZT90LnRhYmxlPXZvaWQgMCE9PWk/bmV3IFdlYkFzc2VtYmx5LlRhYmxlKHtpbml0aWFsOm4sbWF4aW11bTppLGVsZW1lbnQ6ImFueWZ1bmMifSk6bmV3IFdlYkFzc2VtYmx5LlRhYmxlKHtpbml0aWFsOm4sZWxlbWVudDoiYW55ZnVuYyJ9KTp0LnRhYmxlPW5ldyBBcnJheShuKSxvLndhc21UYWJsZT10LnRhYmxlfXZhciBhO3JldHVybiB0Lm1lbW9yeUJhc2V8fCh0Lm1lbW9yeUJhc2U9by5TVEFUSUNfQkFTRSksdC50YWJsZUJhc2V8fCh0LnRhYmxlQmFzZT0wKSwoYT1zKDAsdCkpfHxycigibm8gYmluYXJ5ZW4gbWV0aG9kIHN1Y2NlZWRlZC4gY29uc2lkZXIgZW5hYmxpbmcgbW9yZSBvcHRpb25zLCBsaWtlIGludGVycHJldGluZywgaWYgeW91IHdhbnQgdGhhdDogaHR0cHM6Ly9naXRodWIuY29tL2tyaXBrZW4vZW1zY3JpcHRlbi93aWtpL1dlYkFzc2VtYmx5I2JpbmFyeWVuLW1ldGhvZHMiKSxhfX0oKSxMPTY3OTg0LEoucHVzaCh7ZnVuYzpmdW5jdGlvbigpe0d0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe0h0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe1Z0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe1l0KCl9fSk7by5TVEFUSUNfQkFTRT0xMDI0LG8uU1RBVElDX0JVTVA9NjY5NjAsTCs9MTY7dmFyIGRlPXtsYXN0OjAsY2F1Z2h0OltdLGluZm9zOnt9LGRlQWRqdXN0OmZ1bmN0aW9uKGUpe2lmKCFlfHxkZS5pbmZvc1tlXSlyZXR1cm4gZTtmb3IodmFyIHQgaW4gZGUuaW5mb3Mpe3ZhciByPSt0O2lmKGRlLmluZm9zW3JdLmFkanVzdGVkPT09ZSlyZXR1cm4gcn1yZXR1cm4gZX0sYWRkUmVmOmZ1bmN0aW9uKGUpe2UmJmRlLmluZm9zW2VdLnJlZmNvdW50Kyt9LGRlY1JlZjpmdW5jdGlvbihlKXtpZihlKXt2YXIgdD1kZS5pbmZvc1tlXTt5KHQucmVmY291bnQ+MCksdC5yZWZjb3VudC0tLDAhPT10LnJlZmNvdW50fHx0LnJldGhyb3dufHwodC5kZXN0cnVjdG9yJiZvLmR5bkNhbGxfdmkodC5kZXN0cnVjdG9yLGUpLGRlbGV0ZSBkZS5pbmZvc1tlXSxoZShlKSl9fSxjbGVhclJlZjpmdW5jdGlvbihlKXtlJiYoZGUuaW5mb3NbZV0ucmVmY291bnQ9MCl9fTtmdW5jdGlvbiBoZShlKXt0cnl7cmV0dXJuIEt0KGUpfWNhdGNoKGUpe319ZnVuY3Rpb24gcGUoKXt2YXIgZT1kZS5sYXN0O2lmKCFlKXJldHVybiAwfChadCgwKSwwKTt2YXIgdD1kZS5pbmZvc1tlXSxyPXQudHlwZTtpZighcilyZXR1cm4gMHwoWnQoMCksZSk7dmFyIG49QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtvLl9fX2N4YV9pc19wb2ludGVyX3R5cGUocik7cGUuYnVmZmVyfHwocGUuYnVmZmVyPUp0KDQpKSxGW3BlLmJ1ZmZlcj4+Ml09ZSxlPXBlLmJ1ZmZlcjtmb3IodmFyIGk9MDtpPG4ubGVuZ3RoO2krKylpZihuW2ldJiZvLl9fX2N4YV9jYW5fY2F0Y2gobltpXSxyLGUpKXJldHVybiBlPUZbZT4+Ml0sdC5hZGp1c3RlZD1lLDB8KFp0KG5baV0pLGUpO3JldHVybiBlPUZbZT4+Ml0sMHwoWnQociksZSl9dmFyIG1lPXtFUEVSTToxLEVOT0VOVDoyLEVTUkNIOjMsRUlOVFI6NCxFSU86NSxFTlhJTzo2LEUyQklHOjcsRU5PRVhFQzo4LEVCQURGOjksRUNISUxEOjEwLEVBR0FJTjoxMSxFV09VTERCTE9DSzoxMSxFTk9NRU06MTIsRUFDQ0VTOjEzLEVGQVVMVDoxNCxFTk9UQkxLOjE1LEVCVVNZOjE2LEVFWElTVDoxNyxFWERFVjoxOCxFTk9ERVY6MTksRU5PVERJUjoyMCxFSVNESVI6MjEsRUlOVkFMOjIyLEVORklMRToyMyxFTUZJTEU6MjQsRU5PVFRZOjI1LEVUWFRCU1k6MjYsRUZCSUc6MjcsRU5PU1BDOjI4LEVTUElQRToyOSxFUk9GUzozMCxFTUxJTks6MzEsRVBJUEU6MzIsRURPTTozMyxFUkFOR0U6MzQsRU5PTVNHOjQyLEVJRFJNOjQzLEVDSFJORzo0NCxFTDJOU1lOQzo0NSxFTDNITFQ6NDYsRUwzUlNUOjQ3LEVMTlJORzo0OCxFVU5BVENIOjQ5LEVOT0NTSTo1MCxFTDJITFQ6NTEsRURFQURMSzozNSxFTk9MQ0s6MzcsRUJBREU6NTIsRUJBRFI6NTMsRVhGVUxMOjU0LEVOT0FOTzo1NSxFQkFEUlFDOjU2LEVCQURTTFQ6NTcsRURFQURMT0NLOjM1LEVCRk9OVDo1OSxFTk9TVFI6NjAsRU5PREFUQTo2MSxFVElNRTo2MixFTk9TUjo2MyxFTk9ORVQ6NjQsRU5PUEtHOjY1LEVSRU1PVEU6NjYsRU5PTElOSzo2NyxFQURWOjY4LEVTUk1OVDo2OSxFQ09NTTo3MCxFUFJPVE86NzEsRU1VTFRJSE9QOjcyLEVET1RET1Q6NzMsRUJBRE1TRzo3NCxFTk9UVU5JUTo3NixFQkFERkQ6NzcsRVJFTUNIRzo3OCxFTElCQUNDOjc5LEVMSUJCQUQ6ODAsRUxJQlNDTjo4MSxFTElCTUFYOjgyLEVMSUJFWEVDOjgzLEVOT1NZUzozOCxFTk9URU1QVFk6MzksRU5BTUVUT09MT05HOjM2LEVMT09QOjQwLEVPUE5PVFNVUFA6OTUsRVBGTk9TVVBQT1JUOjk2LEVDT05OUkVTRVQ6MTA0LEVOT0JVRlM6MTA1LEVBRk5PU1VQUE9SVDo5NyxFUFJPVE9UWVBFOjkxLEVOT1RTT0NLOjg4LEVOT1BST1RPT1BUOjkyLEVTSFVURE9XTjoxMDgsRUNPTk5SRUZVU0VEOjExMSxFQUREUklOVVNFOjk4LEVDT05OQUJPUlRFRDoxMDMsRU5FVFVOUkVBQ0g6MTAxLEVORVRET1dOOjEwMCxFVElNRURPVVQ6MTEwLEVIT1NURE9XTjoxMTIsRUhPU1RVTlJFQUNIOjExMyxFSU5QUk9HUkVTUzoxMTUsRUFMUkVBRFk6MTE0LEVERVNUQUREUlJFUTo4OSxFTVNHU0laRTo5MCxFUFJPVE9OT1NVUFBPUlQ6OTMsRVNPQ0tUTk9TVVBQT1JUOjk0LEVBRERSTk9UQVZBSUw6OTksRU5FVFJFU0VUOjEwMixFSVNDT05OOjEwNixFTk9UQ09OTjoxMDcsRVRPT01BTllSRUZTOjEwOSxFVVNFUlM6ODcsRURRVU9UOjEyMixFU1RBTEU6MTE2LEVOT1RTVVA6OTUsRU5PTUVESVVNOjEyMyxFSUxTRVE6ODQsRU9WRVJGTE9XOjc1LEVDQU5DRUxFRDoxMjUsRU5PVFJFQ09WRVJBQkxFOjEzMSxFT1dORVJERUFEOjEzMCxFU1RSUElQRTo4Nn07ZnVuY3Rpb24geWUoZSl7cmV0dXJuIG8uX19fZXJybm9fbG9jYXRpb24mJihGW28uX19fZXJybm9fbG9jYXRpb24oKT4+Ml09ZSksZX12YXIgRWU9ezA6IlN1Y2Nlc3MiLDE6Ik5vdCBzdXBlci11c2VyIiwyOiJObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5IiwzOiJObyBzdWNoIHByb2Nlc3MiLDQ6IkludGVycnVwdGVkIHN5c3RlbSBjYWxsIiw1OiJJL08gZXJyb3IiLDY6Ik5vIHN1Y2ggZGV2aWNlIG9yIGFkZHJlc3MiLDc6IkFyZyBsaXN0IHRvbyBsb25nIiw4OiJFeGVjIGZvcm1hdCBlcnJvciIsOToiQmFkIGZpbGUgbnVtYmVyIiwxMDoiTm8gY2hpbGRyZW4iLDExOiJObyBtb3JlIHByb2Nlc3NlcyIsMTI6Ik5vdCBlbm91Z2ggY29yZSIsMTM6IlBlcm1pc3Npb24gZGVuaWVkIiwxNDoiQmFkIGFkZHJlc3MiLDE1OiJCbG9jayBkZXZpY2UgcmVxdWlyZWQiLDE2OiJNb3VudCBkZXZpY2UgYnVzeSIsMTc6IkZpbGUgZXhpc3RzIiwxODoiQ3Jvc3MtZGV2aWNlIGxpbmsiLDE5OiJObyBzdWNoIGRldmljZSIsMjA6Ik5vdCBhIGRpcmVjdG9yeSIsMjE6IklzIGEgZGlyZWN0b3J5IiwyMjoiSW52YWxpZCBhcmd1bWVudCIsMjM6IlRvbyBtYW55IG9wZW4gZmlsZXMgaW4gc3lzdGVtIiwyNDoiVG9vIG1hbnkgb3BlbiBmaWxlcyIsMjU6Ik5vdCBhIHR5cGV3cml0ZXIiLDI2OiJUZXh0IGZpbGUgYnVzeSIsMjc6IkZpbGUgdG9vIGxhcmdlIiwyODoiTm8gc3BhY2UgbGVmdCBvbiBkZXZpY2UiLDI5OiJJbGxlZ2FsIHNlZWsiLDMwOiJSZWFkIG9ubHkgZmlsZSBzeXN0ZW0iLDMxOiJUb28gbWFueSBsaW5rcyIsMzI6IkJyb2tlbiBwaXBlIiwzMzoiTWF0aCBhcmcgb3V0IG9mIGRvbWFpbiBvZiBmdW5jIiwzNDoiTWF0aCByZXN1bHQgbm90IHJlcHJlc2VudGFibGUiLDM1OiJGaWxlIGxvY2tpbmcgZGVhZGxvY2sgZXJyb3IiLDM2OiJGaWxlIG9yIHBhdGggbmFtZSB0b28gbG9uZyIsMzc6Ik5vIHJlY29yZCBsb2NrcyBhdmFpbGFibGUiLDM4OiJGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQiLDM5OiJEaXJlY3Rvcnkgbm90IGVtcHR5Iiw0MDoiVG9vIG1hbnkgc3ltYm9saWMgbGlua3MiLDQyOiJObyBtZXNzYWdlIG9mIGRlc2lyZWQgdHlwZSIsNDM6IklkZW50aWZpZXIgcmVtb3ZlZCIsNDQ6IkNoYW5uZWwgbnVtYmVyIG91dCBvZiByYW5nZSIsNDU6IkxldmVsIDIgbm90IHN5bmNocm9uaXplZCIsNDY6IkxldmVsIDMgaGFsdGVkIiw0NzoiTGV2ZWwgMyByZXNldCIsNDg6IkxpbmsgbnVtYmVyIG91dCBvZiByYW5nZSIsNDk6IlByb3RvY29sIGRyaXZlciBub3QgYXR0YWNoZWQiLDUwOiJObyBDU0kgc3RydWN0dXJlIGF2YWlsYWJsZSIsNTE6IkxldmVsIDIgaGFsdGVkIiw1MjoiSW52YWxpZCBleGNoYW5nZSIsNTM6IkludmFsaWQgcmVxdWVzdCBkZXNjcmlwdG9yIiw1NDoiRXhjaGFuZ2UgZnVsbCIsNTU6Ik5vIGFub2RlIiw1NjoiSW52YWxpZCByZXF1ZXN0IGNvZGUiLDU3OiJJbnZhbGlkIHNsb3QiLDU5OiJCYWQgZm9udCBmaWxlIGZtdCIsNjA6IkRldmljZSBub3QgYSBzdHJlYW0iLDYxOiJObyBkYXRhIChmb3Igbm8gZGVsYXkgaW8pIiw2MjoiVGltZXIgZXhwaXJlZCIsNjM6Ik91dCBvZiBzdHJlYW1zIHJlc291cmNlcyIsNjQ6Ik1hY2hpbmUgaXMgbm90IG9uIHRoZSBuZXR3b3JrIiw2NToiUGFja2FnZSBub3QgaW5zdGFsbGVkIiw2NjoiVGhlIG9iamVjdCBpcyByZW1vdGUiLDY3OiJUaGUgbGluayBoYXMgYmVlbiBzZXZlcmVkIiw2ODoiQWR2ZXJ0aXNlIGVycm9yIiw2OToiU3Jtb3VudCBlcnJvciIsNzA6IkNvbW11bmljYXRpb24gZXJyb3Igb24gc2VuZCIsNzE6IlByb3RvY29sIGVycm9yIiw3MjoiTXVsdGlob3AgYXR0ZW1wdGVkIiw3MzoiQ3Jvc3MgbW91bnQgcG9pbnQgKG5vdCByZWFsbHkgZXJyb3IpIiw3NDoiVHJ5aW5nIHRvIHJlYWQgdW5yZWFkYWJsZSBtZXNzYWdlIiw3NToiVmFsdWUgdG9vIGxhcmdlIGZvciBkZWZpbmVkIGRhdGEgdHlwZSIsNzY6IkdpdmVuIGxvZy4gbmFtZSBub3QgdW5pcXVlIiw3NzoiZi5kLiBpbnZhbGlkIGZvciB0aGlzIG9wZXJhdGlvbiIsNzg6IlJlbW90ZSBhZGRyZXNzIGNoYW5nZWQiLDc5OiJDYW4gICBhY2Nlc3MgYSBuZWVkZWQgc2hhcmVkIGxpYiIsODA6IkFjY2Vzc2luZyBhIGNvcnJ1cHRlZCBzaGFyZWQgbGliIiw4MToiLmxpYiBzZWN0aW9uIGluIGEub3V0IGNvcnJ1cHRlZCIsODI6IkF0dGVtcHRpbmcgdG8gbGluayBpbiB0b28gbWFueSBsaWJzIiw4MzoiQXR0ZW1wdGluZyB0byBleGVjIGEgc2hhcmVkIGxpYnJhcnkiLDg0OiJJbGxlZ2FsIGJ5dGUgc2VxdWVuY2UiLDg2OiJTdHJlYW1zIHBpcGUgZXJyb3IiLDg3OiJUb28gbWFueSB1c2VycyIsODg6IlNvY2tldCBvcGVyYXRpb24gb24gbm9uLXNvY2tldCIsODk6IkRlc3RpbmF0aW9uIGFkZHJlc3MgcmVxdWlyZWQiLDkwOiJNZXNzYWdlIHRvbyBsb25nIiw5MToiUHJvdG9jb2wgd3JvbmcgdHlwZSBmb3Igc29ja2V0Iiw5MjoiUHJvdG9jb2wgbm90IGF2YWlsYWJsZSIsOTM6IlVua25vd24gcHJvdG9jb2wiLDk0OiJTb2NrZXQgdHlwZSBub3Qgc3VwcG9ydGVkIiw5NToiTm90IHN1cHBvcnRlZCIsOTY6IlByb3RvY29sIGZhbWlseSBub3Qgc3VwcG9ydGVkIiw5NzoiQWRkcmVzcyBmYW1pbHkgbm90IHN1cHBvcnRlZCBieSBwcm90b2NvbCBmYW1pbHkiLDk4OiJBZGRyZXNzIGFscmVhZHkgaW4gdXNlIiw5OToiQWRkcmVzcyBub3QgYXZhaWxhYmxlIiwxMDA6Ik5ldHdvcmsgaW50ZXJmYWNlIGlzIG5vdCBjb25maWd1cmVkIiwxMDE6Ik5ldHdvcmsgaXMgdW5yZWFjaGFibGUiLDEwMjoiQ29ubmVjdGlvbiByZXNldCBieSBuZXR3b3JrIiwxMDM6IkNvbm5lY3Rpb24gYWJvcnRlZCIsMTA0OiJDb25uZWN0aW9uIHJlc2V0IGJ5IHBlZXIiLDEwNToiTm8gYnVmZmVyIHNwYWNlIGF2YWlsYWJsZSIsMTA2OiJTb2NrZXQgaXMgYWxyZWFkeSBjb25uZWN0ZWQiLDEwNzoiU29ja2V0IGlzIG5vdCBjb25uZWN0ZWQiLDEwODoiQ2FuJ3Qgc2VuZCBhZnRlciBzb2NrZXQgc2h1dGRvd24iLDEwOToiVG9vIG1hbnkgcmVmZXJlbmNlcyIsMTEwOiJDb25uZWN0aW9uIHRpbWVkIG91dCIsMTExOiJDb25uZWN0aW9uIHJlZnVzZWQiLDExMjoiSG9zdCBpcyBkb3duIiwxMTM6Ikhvc3QgaXMgdW5yZWFjaGFibGUiLDExNDoiU29ja2V0IGFscmVhZHkgY29ubmVjdGVkIiwxMTU6IkNvbm5lY3Rpb24gYWxyZWFkeSBpbiBwcm9ncmVzcyIsMTE2OiJTdGFsZSBmaWxlIGhhbmRsZSIsMTIyOiJRdW90YSBleGNlZWRlZCIsMTIzOiJObyBtZWRpdW0gKGluIHRhcGUgZHJpdmUpIiwxMjU6Ik9wZXJhdGlvbiBjYW5jZWxlZCIsMTMwOiJQcmV2aW91cyBvd25lciBkaWVkIiwxMzE6IlN0YXRlIG5vdCByZWNvdmVyYWJsZSJ9LGdlPXtzcGxpdFBhdGg6ZnVuY3Rpb24oZSl7cmV0dXJuL14oXC8/fCkoW1xzXFNdKj8pKCg/OlwuezEsMn18W15cL10rP3wpKFwuW14uXC9dKnwpKSg/OltcL10qKSQvLmV4ZWMoZSkuc2xpY2UoMSl9LG5vcm1hbGl6ZUFycmF5OmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPTAsbj1lLmxlbmd0aC0xO24+PTA7bi0tKXt2YXIgbz1lW25dOyIuIj09PW8/ZS5zcGxpY2UobiwxKToiLi4iPT09bz8oZS5zcGxpY2UobiwxKSxyKyspOnImJihlLnNwbGljZShuLDEpLHItLSl9aWYodClmb3IoO3I7ci0tKWUudW5zaGlmdCgiLi4iKTtyZXR1cm4gZX0sbm9ybWFsaXplOmZ1bmN0aW9uKGUpe3ZhciB0PSIvIj09PWUuY2hhckF0KDApLHI9Ii8iPT09ZS5zdWJzdHIoLTEpO3JldHVybihlPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhdCkuam9pbigiLyIpKXx8dHx8KGU9Ii4iKSxlJiZyJiYoZSs9Ii8iKSwodD8iLyI6IiIpK2V9LGRpcm5hbWU6ZnVuY3Rpb24oZSl7dmFyIHQ9Z2Uuc3BsaXRQYXRoKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIHJ8fG4/KG4mJihuPW4uc3Vic3RyKDAsbi5sZW5ndGgtMSkpLHIrbik6Ii4ifSxiYXNlbmFtZTpmdW5jdGlvbihlKXtpZigiLyI9PT1lKXJldHVybiIvIjt2YXIgdD1lLmxhc3RJbmRleE9mKCIvIik7cmV0dXJuLTE9PT10P2U6ZS5zdWJzdHIodCsxKX0sZXh0bmFtZTpmdW5jdGlvbihlKXtyZXR1cm4gZ2Uuc3BsaXRQYXRoKGUpWzNdfSxqb2luOmZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO3JldHVybiBnZS5ub3JtYWxpemUoZS5qb2luKCIvIikpfSxqb2luMjpmdW5jdGlvbihlLHQpe3JldHVybiBnZS5ub3JtYWxpemUoZSsiLyIrdCl9LHJlc29sdmU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9IiIsdD0hMSxyPWFyZ3VtZW50cy5sZW5ndGgtMTtyPj0tMSYmIXQ7ci0tKXt2YXIgbj1yPj0wP2FyZ3VtZW50c1tyXTpUZS5jd2QoKTtpZigic3RyaW5nIiE9dHlwZW9mIG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnRzIHRvIHBhdGgucmVzb2x2ZSBtdXN0IGJlIHN0cmluZ3MiKTtpZighbilyZXR1cm4iIjtlPW4rIi8iK2UsdD0iLyI9PT1uLmNoYXJBdCgwKX1yZXR1cm4odD8iLyI6IiIpKyhlPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhdCkuam9pbigiLyIpKXx8Ii4ifSxyZWxhdGl2ZTpmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIHIoZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aCYmIiI9PT1lW3RdO3QrKyk7Zm9yKHZhciByPWUubGVuZ3RoLTE7cj49MCYmIiI9PT1lW3JdO3ItLSk7cmV0dXJuIHQ+cj9bXTplLnNsaWNlKHQsci10KzEpfWU9Z2UucmVzb2x2ZShlKS5zdWJzdHIoMSksdD1nZS5yZXNvbHZlKHQpLnN1YnN0cigxKTtmb3IodmFyIG49cihlLnNwbGl0KCIvIikpLG89cih0LnNwbGl0KCIvIikpLGk9TWF0aC5taW4obi5sZW5ndGgsby5sZW5ndGgpLGE9aSxzPTA7czxpO3MrKylpZihuW3NdIT09b1tzXSl7YT1zO2JyZWFrfXZhciB1PVtdO2ZvcihzPWE7czxuLmxlbmd0aDtzKyspdS5wdXNoKCIuLiIpO3JldHVybih1PXUuY29uY2F0KG8uc2xpY2UoYSkpKS5qb2luKCIvIil9fSx2ZT17dHR5czpbXSxpbml0OmZ1bmN0aW9uKCl7fSxzaHV0ZG93bjpmdW5jdGlvbigpe30scmVnaXN0ZXI6ZnVuY3Rpb24oZSx0KXt2ZS50dHlzW2VdPXtpbnB1dDpbXSxvdXRwdXQ6W10sb3BzOnR9LFRlLnJlZ2lzdGVyRGV2aWNlKGUsdmUuc3RyZWFtX29wcyl9LHN0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oZSl7dmFyIHQ9dmUudHR5c1tlLm5vZGUucmRldl07aWYoIXQpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtlLnR0eT10LGUuc2Vla2FibGU9ITF9LGNsb3NlOmZ1bmN0aW9uKGUpe2UudHR5Lm9wcy5mbHVzaChlLnR0eSl9LGZsdXNoOmZ1bmN0aW9uKGUpe2UudHR5Lm9wcy5mbHVzaChlLnR0eSl9LHJlYWQ6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighZS50dHl8fCFlLnR0eS5vcHMuZ2V0X2NoYXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5YSU8pO2Zvcih2YXIgaT0wLGE9MDthPG47YSsrKXt2YXIgczt0cnl7cz1lLnR0eS5vcHMuZ2V0X2NoYXIoZS50dHkpfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9aWYodm9pZCAwPT09cyYmMD09PWkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUFHQUlOKTtpZihudWxsPT1zKWJyZWFrO2krKyx0W3IrYV09c31yZXR1cm4gaSYmKGUubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksaX0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighZS50dHl8fCFlLnR0eS5vcHMucHV0X2NoYXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5YSU8pO2Zvcih2YXIgaT0wO2k8bjtpKyspdHJ5e2UudHR5Lm9wcy5wdXRfY2hhcihlLnR0eSx0W3IraV0pfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9cmV0dXJuIG4mJihlLm5vZGUudGltZXN0YW1wPURhdGUubm93KCkpLGl9fSxkZWZhdWx0X3R0eV9vcHM6e2dldF9jaGFyOmZ1bmN0aW9uKGUpe2lmKCFlLmlucHV0Lmxlbmd0aCl7dmFyIHQ9bnVsbDtpZihsKXt2YXIgcj1uZXcgQnVmZmVyKDI1Niksbj0wLG89IndpbjMyIiE9cHJvY2Vzcy5wbGF0Zm9ybSxpPXByb2Nlc3Muc3RkaW4uZmQ7aWYobyl7dmFyIGE9ITE7dHJ5e2k9ZnMub3BlblN5bmMoIi9kZXYvc3RkaW4iLCJyIiksYT0hMH1jYXRjaChlKXt9fXRyeXtuPWZzLnJlYWRTeW5jKGksciwwLDI1NixudWxsKX1jYXRjaChlKXtpZigtMT09ZS50b1N0cmluZygpLmluZGV4T2YoIkVPRiIpKXRocm93IGU7bj0wfWEmJmZzLmNsb3NlU3luYyhpKSx0PW4+MD9yLnNsaWNlKDAsbikudG9TdHJpbmcoInV0Zi04Iik6bnVsbH1lbHNlInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJiJmdW5jdGlvbiI9PXR5cGVvZiB3aW5kb3cucHJvbXB0P251bGwhPT0odD13aW5kb3cucHJvbXB0KCJJbnB1dDogIikpJiYodCs9IlxuIik6ImZ1bmN0aW9uIj09dHlwZW9mIHJlYWRsaW5lJiZudWxsIT09KHQ9cmVhZGxpbmUoKSkmJih0Kz0iXG4iKTtpZighdClyZXR1cm4gbnVsbDtlLmlucHV0PSR0KHQsITApfXJldHVybiBlLmlucHV0LnNoaWZ0KCl9LHB1dF9jaGFyOmZ1bmN0aW9uKGUsdCl7bnVsbD09PXR8fDEwPT09dD8oby5wcmludChfKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSk6MCE9dCYmZS5vdXRwdXQucHVzaCh0KX0sZmx1c2g6ZnVuY3Rpb24oZSl7ZS5vdXRwdXQmJmUub3V0cHV0Lmxlbmd0aD4wJiYoby5wcmludChfKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSl9fSxkZWZhdWx0X3R0eTFfb3BzOntwdXRfY2hhcjpmdW5jdGlvbihlLHQpe251bGw9PT10fHwxMD09PXQ/KG8ucHJpbnRFcnIoXyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pOjAhPXQmJmUub3V0cHV0LnB1c2godCl9LGZsdXNoOmZ1bmN0aW9uKGUpe2Uub3V0cHV0JiZlLm91dHB1dC5sZW5ndGg+MCYmKG8ucHJpbnRFcnIoXyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pfX19LHdlPXtvcHNfdGFibGU6bnVsbCxtb3VudDpmdW5jdGlvbihlKXtyZXR1cm4gd2UuY3JlYXRlTm9kZShudWxsLCIvIiwxNjg5NSwwKX0sY3JlYXRlTm9kZTpmdW5jdGlvbihlLHQscixuKXtpZihUZS5pc0Jsa2RldihyKXx8VGUuaXNGSUZPKHIpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTt3ZS5vcHNfdGFibGV8fCh3ZS5vcHNfdGFibGU9e2Rpcjp7bm9kZTp7Z2V0YXR0cjp3ZS5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6d2Uubm9kZV9vcHMuc2V0YXR0cixsb29rdXA6d2Uubm9kZV9vcHMubG9va3VwLG1rbm9kOndlLm5vZGVfb3BzLm1rbm9kLHJlbmFtZTp3ZS5ub2RlX29wcy5yZW5hbWUsdW5saW5rOndlLm5vZGVfb3BzLnVubGluayxybWRpcjp3ZS5ub2RlX29wcy5ybWRpcixyZWFkZGlyOndlLm5vZGVfb3BzLnJlYWRkaXIsc3ltbGluazp3ZS5ub2RlX29wcy5zeW1saW5rfSxzdHJlYW06e2xsc2Vlazp3ZS5zdHJlYW1fb3BzLmxsc2Vla319LGZpbGU6e25vZGU6e2dldGF0dHI6d2Uubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOndlLm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTp7bGxzZWVrOndlLnN0cmVhbV9vcHMubGxzZWVrLHJlYWQ6d2Uuc3RyZWFtX29wcy5yZWFkLHdyaXRlOndlLnN0cmVhbV9vcHMud3JpdGUsYWxsb2NhdGU6d2Uuc3RyZWFtX29wcy5hbGxvY2F0ZSxtbWFwOndlLnN0cmVhbV9vcHMubW1hcCxtc3luYzp3ZS5zdHJlYW1fb3BzLm1zeW5jfX0sbGluazp7bm9kZTp7Z2V0YXR0cjp3ZS5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6d2Uubm9kZV9vcHMuc2V0YXR0cixyZWFkbGluazp3ZS5ub2RlX29wcy5yZWFkbGlua30sc3RyZWFtOnt9fSxjaHJkZXY6e25vZGU6e2dldGF0dHI6d2Uubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOndlLm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTpUZS5jaHJkZXZfc3RyZWFtX29wc319KTt2YXIgbz1UZS5jcmVhdGVOb2RlKGUsdCxyLG4pO3JldHVybiBUZS5pc0RpcihvLm1vZGUpPyhvLm5vZGVfb3BzPXdlLm9wc190YWJsZS5kaXIubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmRpci5zdHJlYW0sby5jb250ZW50cz17fSk6VGUuaXNGaWxlKG8ubW9kZSk/KG8ubm9kZV9vcHM9d2Uub3BzX3RhYmxlLmZpbGUubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmZpbGUuc3RyZWFtLG8udXNlZEJ5dGVzPTAsby5jb250ZW50cz1udWxsKTpUZS5pc0xpbmsoby5tb2RlKT8oby5ub2RlX29wcz13ZS5vcHNfdGFibGUubGluay5ub2RlLG8uc3RyZWFtX29wcz13ZS5vcHNfdGFibGUubGluay5zdHJlYW0pOlRlLmlzQ2hyZGV2KG8ubW9kZSkmJihvLm5vZGVfb3BzPXdlLm9wc190YWJsZS5jaHJkZXYubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmNocmRldi5zdHJlYW0pLG8udGltZXN0YW1wPURhdGUubm93KCksZSYmKGUuY29udGVudHNbdF09byksb30sZ2V0RmlsZURhdGFBc1JlZ3VsYXJBcnJheTpmdW5jdGlvbihlKXtpZihlLmNvbnRlbnRzJiZlLmNvbnRlbnRzLnN1YmFycmF5KXtmb3IodmFyIHQ9W10scj0wO3I8ZS51c2VkQnl0ZXM7KytyKXQucHVzaChlLmNvbnRlbnRzW3JdKTtyZXR1cm4gdH1yZXR1cm4gZS5jb250ZW50c30sZ2V0RmlsZURhdGFBc1R5cGVkQXJyYXk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuY29udGVudHM/ZS5jb250ZW50cy5zdWJhcnJheT9lLmNvbnRlbnRzLnN1YmFycmF5KDAsZS51c2VkQnl0ZXMpOm5ldyBVaW50OEFycmF5KGUuY29udGVudHMpOm5ldyBVaW50OEFycmF5fSxleHBhbmRGaWxlU3RvcmFnZTpmdW5jdGlvbihlLHQpe2lmKGUuY29udGVudHMmJmUuY29udGVudHMuc3ViYXJyYXkmJnQ+ZS5jb250ZW50cy5sZW5ndGgmJihlLmNvbnRlbnRzPXdlLmdldEZpbGVEYXRhQXNSZWd1bGFyQXJyYXkoZSksZS51c2VkQnl0ZXM9ZS5jb250ZW50cy5sZW5ndGgpLCFlLmNvbnRlbnRzfHxlLmNvbnRlbnRzLnN1YmFycmF5KXt2YXIgcj1lLmNvbnRlbnRzP2UuY29udGVudHMubGVuZ3RoOjA7aWYocj49dClyZXR1cm47dD1NYXRoLm1heCh0LHIqKHI8MTA0ODU3Nj8yOjEuMTI1KXwwKSwwIT1yJiYodD1NYXRoLm1heCh0LDI1NikpO3ZhciBuPWUuY29udGVudHM7cmV0dXJuIGUuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkodCksdm9pZChlLnVzZWRCeXRlcz4wJiZlLmNvbnRlbnRzLnNldChuLnN1YmFycmF5KDAsZS51c2VkQnl0ZXMpLDApKX1mb3IoIWUuY29udGVudHMmJnQ+MCYmKGUuY29udGVudHM9W10pO2UuY29udGVudHMubGVuZ3RoPHQ7KWUuY29udGVudHMucHVzaCgwKX0scmVzaXplRmlsZVN0b3JhZ2U6ZnVuY3Rpb24oZSx0KXtpZihlLnVzZWRCeXRlcyE9dCl7aWYoMD09dClyZXR1cm4gZS5jb250ZW50cz1udWxsLHZvaWQoZS51c2VkQnl0ZXM9MCk7aWYoIWUuY29udGVudHN8fGUuY29udGVudHMuc3ViYXJyYXkpe3ZhciByPWUuY29udGVudHM7cmV0dXJuIGUuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkobmV3IEFycmF5QnVmZmVyKHQpKSxyJiZlLmNvbnRlbnRzLnNldChyLnN1YmFycmF5KDAsTWF0aC5taW4odCxlLnVzZWRCeXRlcykpKSx2b2lkKGUudXNlZEJ5dGVzPXQpfWlmKGUuY29udGVudHN8fChlLmNvbnRlbnRzPVtdKSxlLmNvbnRlbnRzLmxlbmd0aD50KWUuY29udGVudHMubGVuZ3RoPXQ7ZWxzZSBmb3IoO2UuY29udGVudHMubGVuZ3RoPHQ7KWUuY29udGVudHMucHVzaCgwKTtlLnVzZWRCeXRlcz10fX0sbm9kZV9vcHM6e2dldGF0dHI6ZnVuY3Rpb24oZSl7dmFyIHQ9e307cmV0dXJuIHQuZGV2PVRlLmlzQ2hyZGV2KGUubW9kZSk/ZS5pZDoxLHQuaW5vPWUuaWQsdC5tb2RlPWUubW9kZSx0Lm5saW5rPTEsdC51aWQ9MCx0LmdpZD0wLHQucmRldj1lLnJkZXYsVGUuaXNEaXIoZS5tb2RlKT90LnNpemU9NDA5NjpUZS5pc0ZpbGUoZS5tb2RlKT90LnNpemU9ZS51c2VkQnl0ZXM6VGUuaXNMaW5rKGUubW9kZSk/dC5zaXplPWUubGluay5sZW5ndGg6dC5zaXplPTAsdC5hdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5tdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5jdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5ibGtzaXplPTQwOTYsdC5ibG9ja3M9TWF0aC5jZWlsKHQuc2l6ZS90LmJsa3NpemUpLHR9LHNldGF0dHI6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT10Lm1vZGUmJihlLm1vZGU9dC5tb2RlKSx2b2lkIDAhPT10LnRpbWVzdGFtcCYmKGUudGltZXN0YW1wPXQudGltZXN0YW1wKSx2b2lkIDAhPT10LnNpemUmJndlLnJlc2l6ZUZpbGVTdG9yYWdlKGUsdC5zaXplKX0sbG9va3VwOmZ1bmN0aW9uKGUsdCl7dGhyb3cgVGUuZ2VuZXJpY0Vycm9yc1ttZS5FTk9FTlRdfSxta25vZDpmdW5jdGlvbihlLHQscixuKXtyZXR1cm4gd2UuY3JlYXRlTm9kZShlLHQscixuKX0scmVuYW1lOmZ1bmN0aW9uKGUsdCxyKXtpZihUZS5pc0RpcihlLm1vZGUpKXt2YXIgbjt0cnl7bj1UZS5sb29rdXBOb2RlKHQscil9Y2F0Y2goZSl7fWlmKG4pZm9yKHZhciBvIGluIG4uY29udGVudHMpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PVEVNUFRZKX1kZWxldGUgZS5wYXJlbnQuY29udGVudHNbZS5uYW1lXSxlLm5hbWU9cix0LmNvbnRlbnRzW3JdPWUsZS5wYXJlbnQ9dH0sdW5saW5rOmZ1bmN0aW9uKGUsdCl7ZGVsZXRlIGUuY29udGVudHNbdF19LHJtZGlyOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUubG9va3VwTm9kZShlLHQpO2Zvcih2YXIgbiBpbiByLmNvbnRlbnRzKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RFTVBUWSk7ZGVsZXRlIGUuY29udGVudHNbdF19LHJlYWRkaXI6ZnVuY3Rpb24oZSl7dmFyIHQ9WyIuIiwiLi4iXTtmb3IodmFyIHIgaW4gZS5jb250ZW50cyllLmNvbnRlbnRzLmhhc093blByb3BlcnR5KHIpJiZ0LnB1c2gocik7cmV0dXJuIHR9LHN5bWxpbms6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPXdlLmNyZWF0ZU5vZGUoZSx0LDQxNDcxLDApO3JldHVybiBuLmxpbms9cixufSxyZWFkbGluazpmdW5jdGlvbihlKXtpZighVGUuaXNMaW5rKGUubW9kZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtyZXR1cm4gZS5saW5rfX0sc3RyZWFtX29wczp7cmVhZDpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWUubm9kZS5jb250ZW50cztpZihvPj1lLm5vZGUudXNlZEJ5dGVzKXJldHVybiAwO3ZhciBhPU1hdGgubWluKGUubm9kZS51c2VkQnl0ZXMtbyxuKTtpZih5KGE+PTApLGE+OCYmaS5zdWJhcnJheSl0LnNldChpLnN1YmFycmF5KG8sbythKSxyKTtlbHNlIGZvcih2YXIgcz0wO3M8YTtzKyspdFtyK3NdPWlbbytzXTtyZXR1cm4gYX0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvLGkpe2lmKCFuKXJldHVybiAwO3ZhciBhPWUubm9kZTtpZihhLnRpbWVzdGFtcD1EYXRlLm5vdygpLHQuc3ViYXJyYXkmJighYS5jb250ZW50c3x8YS5jb250ZW50cy5zdWJhcnJheSkpe2lmKGkpcmV0dXJuIGEuY29udGVudHM9dC5zdWJhcnJheShyLHIrbiksYS51c2VkQnl0ZXM9bixuO2lmKDA9PT1hLnVzZWRCeXRlcyYmMD09PW8pcmV0dXJuIGEuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkodC5zdWJhcnJheShyLHIrbikpLGEudXNlZEJ5dGVzPW4sbjtpZihvK248PWEudXNlZEJ5dGVzKXJldHVybiBhLmNvbnRlbnRzLnNldCh0LnN1YmFycmF5KHIscituKSxvKSxufWlmKHdlLmV4cGFuZEZpbGVTdG9yYWdlKGEsbytuKSxhLmNvbnRlbnRzLnN1YmFycmF5JiZ0LnN1YmFycmF5KWEuY29udGVudHMuc2V0KHQuc3ViYXJyYXkocixyK24pLG8pO2Vsc2UgZm9yKHZhciBzPTA7czxuO3MrKylhLmNvbnRlbnRzW28rc109dFtyK3NdO3JldHVybiBhLnVzZWRCeXRlcz1NYXRoLm1heChhLnVzZWRCeXRlcyxvK24pLG59LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09cj9uKz1lLnBvc2l0aW9uOjI9PT1yJiZUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiYobis9ZS5ub2RlLnVzZWRCeXRlcyksbjwwKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7cmV0dXJuIG59LGFsbG9jYXRlOmZ1bmN0aW9uKGUsdCxyKXt3ZS5leHBhbmRGaWxlU3RvcmFnZShlLm5vZGUsdCtyKSxlLm5vZGUudXNlZEJ5dGVzPU1hdGgubWF4KGUubm9kZS51c2VkQnl0ZXMsdCtyKX0sbW1hcDpmdW5jdGlvbihlLHQscixuLG8saSxhKXtpZighVGUuaXNGaWxlKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9ERVYpO3ZhciBzLHUsYz1lLm5vZGUuY29udGVudHM7aWYoMiZhfHxjLmJ1ZmZlciE9PXQmJmMuYnVmZmVyIT09dC5idWZmZXIpe2lmKChvPjB8fG8rbjxlLm5vZGUudXNlZEJ5dGVzKSYmKGM9Yy5zdWJhcnJheT9jLnN1YmFycmF5KG8sbytuKTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjLG8sbytuKSksdT0hMCwhKHM9SnQobikpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT01FTSk7dC5zZXQoYyxzKX1lbHNlIHU9ITEscz1jLmJ5dGVPZmZzZXQ7cmV0dXJue3B0cjpzLGFsbG9jYXRlZDp1fX0sbXN5bmM6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighVGUuaXNGaWxlKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9ERVYpO2lmKDImbylyZXR1cm4gMDt3ZS5zdHJlYW1fb3BzLndyaXRlKGUsdCwwLG4sciwhMSk7cmV0dXJuIDB9fX0sX2U9e2Riczp7fSxpbmRleGVkREI6ZnVuY3Rpb24oKXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGluZGV4ZWREQilyZXR1cm4gaW5kZXhlZERCO3ZhciBlPW51bGw7cmV0dXJuIm9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJihlPXdpbmRvdy5pbmRleGVkREJ8fHdpbmRvdy5tb3pJbmRleGVkREJ8fHdpbmRvdy53ZWJraXRJbmRleGVkREJ8fHdpbmRvdy5tc0luZGV4ZWREQikseShlLCJJREJGUyB1c2VkLCBidXQgaW5kZXhlZERCIG5vdCBzdXBwb3J0ZWQiKSxlfSxEQl9WRVJTSU9OOjIxLERCX1NUT1JFX05BTUU6IkZJTEVfREFUQSIsbW91bnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlLm1vdW50LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sc3luY2ZzOmZ1bmN0aW9uKGUsdCxyKXtfZS5nZXRMb2NhbFNldChlLChmdW5jdGlvbihuLG8pe2lmKG4pcmV0dXJuIHIobik7X2UuZ2V0UmVtb3RlU2V0KGUsKGZ1bmN0aW9uKGUsbil7aWYoZSlyZXR1cm4gcihlKTt2YXIgaT10P246byxhPXQ/bzpuO19lLnJlY29uY2lsZShpLGEscil9KSl9KSl9LGdldERCOmZ1bmN0aW9uKGUsdCl7dmFyIHIsbj1fZS5kYnNbZV07aWYobilyZXR1cm4gdChudWxsLG4pO3RyeXtyPV9lLmluZGV4ZWREQigpLm9wZW4oZSxfZS5EQl9WRVJTSU9OKX1jYXRjaChlKXtyZXR1cm4gdChlKX1pZighcilyZXR1cm4gdCgiVW5hYmxlIHRvIGNvbm5lY3QgdG8gSW5kZXhlZERCIik7ci5vbnVwZ3JhZGVuZWVkZWQ9ZnVuY3Rpb24oZSl7dmFyIHQscj1lLnRhcmdldC5yZXN1bHQsbj1lLnRhcmdldC50cmFuc2FjdGlvbjsodD1yLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoX2UuREJfU1RPUkVfTkFNRSk/bi5vYmplY3RTdG9yZShfZS5EQl9TVE9SRV9OQU1FKTpyLmNyZWF0ZU9iamVjdFN0b3JlKF9lLkRCX1NUT1JFX05BTUUpKS5pbmRleE5hbWVzLmNvbnRhaW5zKCJ0aW1lc3RhbXAiKXx8dC5jcmVhdGVJbmRleCgidGltZXN0YW1wIiwidGltZXN0YW1wIix7dW5pcXVlOiExfSl9LHIub25zdWNjZXNzPWZ1bmN0aW9uKCl7bj1yLnJlc3VsdCxfZS5kYnNbZV09bix0KG51bGwsbil9LHIub25lcnJvcj1mdW5jdGlvbihlKXt0KHRoaXMuZXJyb3IpLGUucHJldmVudERlZmF1bHQoKX19LGdldExvY2FsU2V0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9e307ZnVuY3Rpb24gbihlKXtyZXR1cm4iLiIhPT1lJiYiLi4iIT09ZX1mdW5jdGlvbiBvKGUpe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gZ2Uuam9pbjIoZSx0KX19Zm9yKHZhciBpPVRlLnJlYWRkaXIoZS5tb3VudHBvaW50KS5maWx0ZXIobikubWFwKG8oZS5tb3VudHBvaW50KSk7aS5sZW5ndGg7KXt2YXIgYSxzPWkucG9wKCk7dHJ5e2E9VGUuc3RhdChzKX1jYXRjaChlKXtyZXR1cm4gdChlKX1UZS5pc0RpcihhLm1vZGUpJiZpLnB1c2guYXBwbHkoaSxUZS5yZWFkZGlyKHMpLmZpbHRlcihuKS5tYXAobyhzKSkpLHJbc109e3RpbWVzdGFtcDphLm10aW1lfX1yZXR1cm4gdChudWxsLHt0eXBlOiJsb2NhbCIsZW50cmllczpyfSl9LGdldFJlbW90ZVNldDpmdW5jdGlvbihlLHQpe3ZhciByPXt9O19lLmdldERCKGUubW91bnRwb2ludCwoZnVuY3Rpb24oZSxuKXtpZihlKXJldHVybiB0KGUpO3RyeXt2YXIgbz1uLnRyYW5zYWN0aW9uKFtfZS5EQl9TVE9SRV9OQU1FXSwicmVhZG9ubHkiKTtvLm9uZXJyb3I9ZnVuY3Rpb24oZSl7dCh0aGlzLmVycm9yKSxlLnByZXZlbnREZWZhdWx0KCl9LG8ub2JqZWN0U3RvcmUoX2UuREJfU1RPUkVfTkFNRSkuaW5kZXgoInRpbWVzdGFtcCIpLm9wZW5LZXlDdXJzb3IoKS5vbnN1Y2Nlc3M9ZnVuY3Rpb24oZSl7dmFyIG89ZS50YXJnZXQucmVzdWx0O2lmKCFvKXJldHVybiB0KG51bGwse3R5cGU6InJlbW90ZSIsZGI6bixlbnRyaWVzOnJ9KTtyW28ucHJpbWFyeUtleV09e3RpbWVzdGFtcDpvLmtleX0sby5jb250aW51ZSgpfX1jYXRjaChlKXtyZXR1cm4gdChlKX19KSl9LGxvYWRMb2NhbEVudHJ5OmZ1bmN0aW9uKGUsdCl7dmFyIHIsbjt0cnl7bj1UZS5sb29rdXBQYXRoKGUpLm5vZGUscj1UZS5zdGF0KGUpfWNhdGNoKGUpe3JldHVybiB0KGUpfXJldHVybiBUZS5pc0RpcihyLm1vZGUpP3QobnVsbCx7dGltZXN0YW1wOnIubXRpbWUsbW9kZTpyLm1vZGV9KTpUZS5pc0ZpbGUoci5tb2RlKT8obi5jb250ZW50cz13ZS5nZXRGaWxlRGF0YUFzVHlwZWRBcnJheShuKSx0KG51bGwse3RpbWVzdGFtcDpyLm10aW1lLG1vZGU6ci5tb2RlLGNvbnRlbnRzOm4uY29udGVudHN9KSk6dChuZXcgRXJyb3IoIm5vZGUgdHlwZSBub3Qgc3VwcG9ydGVkIikpfSxzdG9yZUxvY2FsRW50cnk6ZnVuY3Rpb24oZSx0LHIpe3RyeXtpZihUZS5pc0Rpcih0Lm1vZGUpKVRlLm1rZGlyKGUsdC5tb2RlKTtlbHNle2lmKCFUZS5pc0ZpbGUodC5tb2RlKSlyZXR1cm4gcihuZXcgRXJyb3IoIm5vZGUgdHlwZSBub3Qgc3VwcG9ydGVkIikpO1RlLndyaXRlRmlsZShlLHQuY29udGVudHMse2Nhbk93bjohMH0pfVRlLmNobW9kKGUsdC5tb2RlKSxUZS51dGltZShlLHQudGltZXN0YW1wLHQudGltZXN0YW1wKX1jYXRjaChlKXtyZXR1cm4gcihlKX1yKG51bGwpfSxyZW1vdmVMb2NhbEVudHJ5OmZ1bmN0aW9uKGUsdCl7dHJ5e1RlLmxvb2t1cFBhdGgoZSk7dmFyIHI9VGUuc3RhdChlKTtUZS5pc0RpcihyLm1vZGUpP1RlLnJtZGlyKGUpOlRlLmlzRmlsZShyLm1vZGUpJiZUZS51bmxpbmsoZSl9Y2F0Y2goZSl7cmV0dXJuIHQoZSl9dChudWxsKX0sbG9hZFJlbW90ZUVudHJ5OmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1lLmdldCh0KTtuLm9uc3VjY2Vzcz1mdW5jdGlvbihlKXtyKG51bGwsZS50YXJnZXQucmVzdWx0KX0sbi5vbmVycm9yPWZ1bmN0aW9uKGUpe3IodGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0sc3RvcmVSZW1vdGVFbnRyeTpmdW5jdGlvbihlLHQscixuKXt2YXIgbz1lLnB1dChyLHQpO28ub25zdWNjZXNzPWZ1bmN0aW9uKCl7bihudWxsKX0sby5vbmVycm9yPWZ1bmN0aW9uKGUpe24odGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0scmVtb3ZlUmVtb3RlRW50cnk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUuZGVsZXRlKHQpO24ub25zdWNjZXNzPWZ1bmN0aW9uKCl7cihudWxsKX0sbi5vbmVycm9yPWZ1bmN0aW9uKGUpe3IodGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0scmVjb25jaWxlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj0wLG89W107T2JqZWN0LmtleXMoZS5lbnRyaWVzKS5mb3JFYWNoKChmdW5jdGlvbihyKXt2YXIgaT1lLmVudHJpZXNbcl0sYT10LmVudHJpZXNbcl07KCFhfHxpLnRpbWVzdGFtcD5hLnRpbWVzdGFtcCkmJihvLnB1c2gociksbisrKX0pKTt2YXIgaT1bXTtpZihPYmplY3Qua2V5cyh0LmVudHJpZXMpLmZvckVhY2goKGZ1bmN0aW9uKHIpe3QuZW50cmllc1tyXTtlLmVudHJpZXNbcl18fChpLnB1c2gociksbisrKX0pKSwhbilyZXR1cm4gcihudWxsKTt2YXIgYT0wLHM9KCJyZW1vdGUiPT09ZS50eXBlP2UuZGI6dC5kYikudHJhbnNhY3Rpb24oW19lLkRCX1NUT1JFX05BTUVdLCJyZWFkd3JpdGUiKSx1PXMub2JqZWN0U3RvcmUoX2UuREJfU1RPUkVfTkFNRSk7ZnVuY3Rpb24gYyhlKXtyZXR1cm4gZT9jLmVycm9yZWQ/dm9pZCAwOihjLmVycm9yZWQ9ITAscihlKSk6KythPj1uP3IobnVsbCk6dm9pZCAwfXMub25lcnJvcj1mdW5jdGlvbihlKXtjKHRoaXMuZXJyb3IpLGUucHJldmVudERlZmF1bHQoKX0sby5zb3J0KCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ImxvY2FsIj09PXQudHlwZT9fZS5sb2FkUmVtb3RlRW50cnkodSxlLChmdW5jdGlvbih0LHIpe2lmKHQpcmV0dXJuIGModCk7X2Uuc3RvcmVMb2NhbEVudHJ5KGUscixjKX0pKTpfZS5sb2FkTG9jYWxFbnRyeShlLChmdW5jdGlvbih0LHIpe2lmKHQpcmV0dXJuIGModCk7X2Uuc3RvcmVSZW1vdGVFbnRyeSh1LGUscixjKX0pKX0pKSxpLnNvcnQoKS5yZXZlcnNlKCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ImxvY2FsIj09PXQudHlwZT9fZS5yZW1vdmVMb2NhbEVudHJ5KGUsYyk6X2UucmVtb3ZlUmVtb3RlRW50cnkodSxlLGMpfSkpfX0sYmU9e2lzV2luZG93czohMSxzdGF0aWNJbml0OmZ1bmN0aW9uKCl7YmUuaXNXaW5kb3dzPSEhcHJvY2Vzcy5wbGF0Zm9ybS5tYXRjaCgvXndpbi8pO3ZhciBlPXByb2Nlc3MuYmluZGluZygiY29uc3RhbnRzIik7ZS5mcyYmKGU9ZS5mcyksYmUuZmxhZ3NGb3JOb2RlTWFwPXsxMDI0OmUuT19BUFBFTkQsNjQ6ZS5PX0NSRUFULDEyODplLk9fRVhDTCwwOmUuT19SRE9OTFksMjplLk9fUkRXUiw0MDk2OmUuT19TWU5DLDUxMjplLk9fVFJVTkMsMTplLk9fV1JPTkxZfX0sYnVmZmVyRnJvbTpmdW5jdGlvbihlKXtyZXR1cm4gQnVmZmVyLmFsbG9jP0J1ZmZlci5mcm9tKGUpOm5ldyBCdWZmZXIoZSl9LG1vdW50OmZ1bmN0aW9uKGUpe3JldHVybiB5KGwpLGJlLmNyZWF0ZU5vZGUobnVsbCwiLyIsYmUuZ2V0TW9kZShlLm9wdHMucm9vdCksMCl9LGNyZWF0ZU5vZGU6ZnVuY3Rpb24oZSx0LHIsbil7aWYoIVRlLmlzRGlyKHIpJiYhVGUuaXNGaWxlKHIpJiYhVGUuaXNMaW5rKHIpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIG89VGUuY3JlYXRlTm9kZShlLHQscik7cmV0dXJuIG8ubm9kZV9vcHM9YmUubm9kZV9vcHMsby5zdHJlYW1fb3BzPWJlLnN0cmVhbV9vcHMsb30sZ2V0TW9kZTpmdW5jdGlvbihlKXt2YXIgdDt0cnl7dD1mcy5sc3RhdFN5bmMoZSksYmUuaXNXaW5kb3dzJiYodC5tb2RlPXQubW9kZXwoMjkyJnQubW9kZSk+PjIpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX1yZXR1cm4gdC5tb2RlfSxyZWFsUGF0aDpmdW5jdGlvbihlKXtmb3IodmFyIHQ9W107ZS5wYXJlbnQhPT1lOyl0LnB1c2goZS5uYW1lKSxlPWUucGFyZW50O3JldHVybiB0LnB1c2goZS5tb3VudC5vcHRzLnJvb3QpLHQucmV2ZXJzZSgpLGdlLmpvaW4uYXBwbHkobnVsbCx0KX0sZmxhZ3NGb3JOb2RlOmZ1bmN0aW9uKGUpe2UmPS0yMDk3MTUzLGUmPS0yMDQ5LGUmPS0zMjc2OSxlJj0tNTI0Mjg5O3ZhciB0PTA7Zm9yKHZhciByIGluIGJlLmZsYWdzRm9yTm9kZU1hcCllJnImJih0fD1iZS5mbGFnc0Zvck5vZGVNYXBbcl0sZV49cik7aWYoZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiB0fSxub2RlX29wczp7Z2V0YXR0cjpmdW5jdGlvbihlKXt2YXIgdCxyPWJlLnJlYWxQYXRoKGUpO3RyeXt0PWZzLmxzdGF0U3luYyhyKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9cmV0dXJuIGJlLmlzV2luZG93cyYmIXQuYmxrc2l6ZSYmKHQuYmxrc2l6ZT00MDk2KSxiZS5pc1dpbmRvd3MmJiF0LmJsb2NrcyYmKHQuYmxvY2tzPSh0LnNpemUrdC5ibGtzaXplLTEpL3QuYmxrc2l6ZXwwKSx7ZGV2OnQuZGV2LGlubzp0Lmlubyxtb2RlOnQubW9kZSxubGluazp0Lm5saW5rLHVpZDp0LnVpZCxnaWQ6dC5naWQscmRldjp0LnJkZXYsc2l6ZTp0LnNpemUsYXRpbWU6dC5hdGltZSxtdGltZTp0Lm10aW1lLGN0aW1lOnQuY3RpbWUsYmxrc2l6ZTp0LmJsa3NpemUsYmxvY2tzOnQuYmxvY2tzfX0sc2V0YXR0cjpmdW5jdGlvbihlLHQpe3ZhciByPWJlLnJlYWxQYXRoKGUpO3RyeXtpZih2b2lkIDAhPT10Lm1vZGUmJihmcy5jaG1vZFN5bmMocix0Lm1vZGUpLGUubW9kZT10Lm1vZGUpLHZvaWQgMCE9PXQudGltZXN0YW1wKXt2YXIgbj1uZXcgRGF0ZSh0LnRpbWVzdGFtcCk7ZnMudXRpbWVzU3luYyhyLG4sbil9dm9pZCAwIT09dC5zaXplJiZmcy50cnVuY2F0ZVN5bmMocix0LnNpemUpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGxvb2t1cDpmdW5jdGlvbihlLHQpe3ZhciByPWdlLmpvaW4yKGJlLnJlYWxQYXRoKGUpLHQpLG49YmUuZ2V0TW9kZShyKTtyZXR1cm4gYmUuY3JlYXRlTm9kZShlLHQsbil9LG1rbm9kOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWJlLmNyZWF0ZU5vZGUoZSx0LHIsbiksaT1iZS5yZWFsUGF0aChvKTt0cnl7VGUuaXNEaXIoby5tb2RlKT9mcy5ta2RpclN5bmMoaSxvLm1vZGUpOmZzLndyaXRlRmlsZVN5bmMoaSwiIix7bW9kZTpvLm1vZGV9KX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9cmV0dXJuIG99LHJlbmFtZTpmdW5jdGlvbihlLHQscil7dmFyIG49YmUucmVhbFBhdGgoZSksbz1nZS5qb2luMihiZS5yZWFsUGF0aCh0KSxyKTt0cnl7ZnMucmVuYW1lU3luYyhuLG8pfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LHVubGluazpmdW5jdGlvbihlLHQpe3ZhciByPWdlLmpvaW4yKGJlLnJlYWxQYXRoKGUpLHQpO3RyeXtmcy51bmxpbmtTeW5jKHIpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LHJtZGlyOmZ1bmN0aW9uKGUsdCl7dmFyIHI9Z2Uuam9pbjIoYmUucmVhbFBhdGgoZSksdCk7dHJ5e2ZzLnJtZGlyU3luYyhyKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSxyZWFkZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PWJlLnJlYWxQYXRoKGUpO3RyeXtyZXR1cm4gZnMucmVhZGRpclN5bmModCl9Y2F0Y2goZSl7aWYoIWUuY29kZSl0aHJvdyBlO3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lW2UuY29kZV0pfX0sc3ltbGluazpmdW5jdGlvbihlLHQscil7dmFyIG49Z2Uuam9pbjIoYmUucmVhbFBhdGgoZSksdCk7dHJ5e2ZzLnN5bWxpbmtTeW5jKHIsbil9Y2F0Y2goZSl7aWYoIWUuY29kZSl0aHJvdyBlO3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lW2UuY29kZV0pfX0scmVhZGxpbms6ZnVuY3Rpb24oZSl7dmFyIHQ9YmUucmVhbFBhdGgoZSk7dHJ5e3JldHVybiB0PWZzLnJlYWRsaW5rU3luYyh0KSx0PU5PREVKU19QQVRILnJlbGF0aXZlKE5PREVKU19QQVRILnJlc29sdmUoZS5tb3VudC5vcHRzLnJvb3QpLHQpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19fSxzdHJlYW1fb3BzOntvcGVuOmZ1bmN0aW9uKGUpe3ZhciB0PWJlLnJlYWxQYXRoKGUubm9kZSk7dHJ5e1RlLmlzRmlsZShlLm5vZGUubW9kZSkmJihlLm5mZD1mcy5vcGVuU3luYyh0LGJlLmZsYWdzRm9yTm9kZShlLmZsYWdzKSkpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGNsb3NlOmZ1bmN0aW9uKGUpe3RyeXtUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiZlLm5mZCYmZnMuY2xvc2VTeW5jKGUubmZkKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSxyZWFkOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoMD09PW4pcmV0dXJuIDA7dHJ5e3JldHVybiBmcy5yZWFkU3luYyhlLm5mZCxiZS5idWZmZXJGcm9tKHQuYnVmZmVyKSxyLG4sbyl9Y2F0Y2goZSl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8pe3RyeXtyZXR1cm4gZnMud3JpdGVTeW5jKGUubmZkLGJlLmJ1ZmZlckZyb20odC5idWZmZXIpLHIsbixvKX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09ciluKz1lLnBvc2l0aW9uO2Vsc2UgaWYoMj09PXImJlRlLmlzRmlsZShlLm5vZGUubW9kZSkpdHJ5e24rPWZzLmZzdGF0U3luYyhlLm5mZCkuc2l6ZX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX1pZihuPDApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtyZXR1cm4gbn19fSxBZT17RElSX01PREU6MTY4OTUsRklMRV9NT0RFOjMzMjc5LHJlYWRlcjpudWxsLG1vdW50OmZ1bmN0aW9uKGUpe3koYyksQWUucmVhZGVyfHwoQWUucmVhZGVyPW5ldyBGaWxlUmVhZGVyU3luYyk7dmFyIHQ9QWUuY3JlYXRlTm9kZShudWxsLCIvIixBZS5ESVJfTU9ERSwwKSxyPXt9O2Z1bmN0aW9uIG4oZSl7Zm9yKHZhciBuPWUuc3BsaXQoIi8iKSxvPXQsaT0wO2k8bi5sZW5ndGgtMTtpKyspe3ZhciBhPW4uc2xpY2UoMCxpKzEpLmpvaW4oIi8iKTtyW2FdfHwoclthXT1BZS5jcmVhdGVOb2RlKG8sbltpXSxBZS5ESVJfTU9ERSwwKSksbz1yW2FdfXJldHVybiBvfWZ1bmN0aW9uIG8oZSl7dmFyIHQ9ZS5zcGxpdCgiLyIpO3JldHVybiB0W3QubGVuZ3RoLTFdfXJldHVybiBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGUub3B0cy5maWxlc3x8W10sKGZ1bmN0aW9uKGUpe0FlLmNyZWF0ZU5vZGUobihlLm5hbWUpLG8oZS5uYW1lKSxBZS5GSUxFX01PREUsMCxlLGUubGFzdE1vZGlmaWVkRGF0ZSl9KSksKGUub3B0cy5ibG9ic3x8W10pLmZvckVhY2goKGZ1bmN0aW9uKGUpe0FlLmNyZWF0ZU5vZGUobihlLm5hbWUpLG8oZS5uYW1lKSxBZS5GSUxFX01PREUsMCxlLmRhdGEpfSkpLChlLm9wdHMucGFja2FnZXN8fFtdKS5mb3JFYWNoKChmdW5jdGlvbihlKXtlLm1ldGFkYXRhLmZpbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciByPXQuZmlsZW5hbWUuc3Vic3RyKDEpO0FlLmNyZWF0ZU5vZGUobihyKSxvKHIpLEFlLkZJTEVfTU9ERSwwLGUuYmxvYi5zbGljZSh0LnN0YXJ0LHQuZW5kKSl9KSl9KSksdH0sY3JlYXRlTm9kZTpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9VGUuY3JlYXRlTm9kZShlLHQscik7cmV0dXJuIGEubW9kZT1yLGEubm9kZV9vcHM9QWUubm9kZV9vcHMsYS5zdHJlYW1fb3BzPUFlLnN0cmVhbV9vcHMsYS50aW1lc3RhbXA9KGl8fG5ldyBEYXRlKS5nZXRUaW1lKCkseShBZS5GSUxFX01PREUhPT1BZS5ESVJfTU9ERSkscj09PUFlLkZJTEVfTU9ERT8oYS5zaXplPW8uc2l6ZSxhLmNvbnRlbnRzPW8pOihhLnNpemU9NDA5NixhLmNvbnRlbnRzPXt9KSxlJiYoZS5jb250ZW50c1t0XT1hKSxhfSxub2RlX29wczp7Z2V0YXR0cjpmdW5jdGlvbihlKXtyZXR1cm57ZGV2OjEsaW5vOnZvaWQgMCxtb2RlOmUubW9kZSxubGluazoxLHVpZDowLGdpZDowLHJkZXY6dm9pZCAwLHNpemU6ZS5zaXplLGF0aW1lOm5ldyBEYXRlKGUudGltZXN0YW1wKSxtdGltZTpuZXcgRGF0ZShlLnRpbWVzdGFtcCksY3RpbWU6bmV3IERhdGUoZS50aW1lc3RhbXApLGJsa3NpemU6NDA5NixibG9ja3M6TWF0aC5jZWlsKGUuc2l6ZS80MDk2KX19LHNldGF0dHI6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT10Lm1vZGUmJihlLm1vZGU9dC5tb2RlKSx2b2lkIDAhPT10LnRpbWVzdGFtcCYmKGUudGltZXN0YW1wPXQudGltZXN0YW1wKX0sbG9va3VwOmZ1bmN0aW9uKGUsdCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKX0sbWtub2Q6ZnVuY3Rpb24oZSx0LHIsbil7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxyZW5hbWU6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKX0sdW5saW5rOmZ1bmN0aW9uKGUsdCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxybWRpcjpmdW5jdGlvbihlLHQpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKX0scmVhZGRpcjpmdW5jdGlvbihlKXt2YXIgdD1bIi4iLCIuLiJdO2Zvcih2YXIgciBpbiBlLmNvbnRlbnRzKWUuY29udGVudHMuaGFzT3duUHJvcGVydHkocikmJnQucHVzaChyKTtyZXR1cm4gdH0sc3ltbGluazpmdW5jdGlvbihlLHQscil7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxyZWFkbGluazpmdW5jdGlvbihlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSl9fSxzdHJlYW1fb3BzOntyZWFkOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYobz49ZS5ub2RlLnNpemUpcmV0dXJuIDA7dmFyIGk9ZS5ub2RlLmNvbnRlbnRzLnNsaWNlKG8sbytuKSxhPUFlLnJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihpKTtyZXR1cm4gdC5zZXQobmV3IFVpbnQ4QXJyYXkoYSksciksaS5zaXplfSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8pe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09cj9uKz1lLnBvc2l0aW9uOjI9PT1yJiZUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiYobis9ZS5ub2RlLnNpemUpLG48MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiBufX19O0wrPTE2LEwrPTE2O3ZhciBUZT17cm9vdDpudWxsLG1vdW50czpbXSxkZXZpY2VzOnt9LHN0cmVhbXM6W10sbmV4dElub2RlOjEsbmFtZVRhYmxlOm51bGwsY3VycmVudFBhdGg6Ii8iLGluaXRpYWxpemVkOiExLGlnbm9yZVBlcm1pc3Npb25zOiEwLHRyYWNraW5nRGVsZWdhdGU6e30sdHJhY2tpbmc6e29wZW5GbGFnczp7UkVBRDoxLFdSSVRFOjJ9fSxFcnJub0Vycm9yOm51bGwsZ2VuZXJpY0Vycm9yczp7fSxmaWxlc3lzdGVtczpudWxsLHN5bmNGU1JlcXVlc3RzOjAsaGFuZGxlRlNFcnJvcjpmdW5jdGlvbihlKXtpZighKGUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yKSl0aHJvdyBlKyIgOiAiK1AoKTtyZXR1cm4geWUoZS5lcnJubyl9LGxvb2t1cFBhdGg6ZnVuY3Rpb24oZSx0KXtpZih0PXR8fHt9LCEoZT1nZS5yZXNvbHZlKFRlLmN3ZCgpLGUpKSlyZXR1cm57cGF0aDoiIixub2RlOm51bGx9O3ZhciByPXtmb2xsb3dfbW91bnQ6ITAscmVjdXJzZV9jb3VudDowfTtmb3IodmFyIG4gaW4gcil2b2lkIDA9PT10W25dJiYodFtuXT1yW25dKTtpZih0LnJlY3Vyc2VfY291bnQ+OCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTE9PUCk7Zm9yKHZhciBvPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhMSksaT1UZS5yb290LGE9Ii8iLHM9MDtzPG8ubGVuZ3RoO3MrKyl7dmFyIHU9cz09PW8ubGVuZ3RoLTE7aWYodSYmdC5wYXJlbnQpYnJlYWs7aWYoaT1UZS5sb29rdXBOb2RlKGksb1tzXSksYT1nZS5qb2luMihhLG9bc10pLFRlLmlzTW91bnRwb2ludChpKSYmKCF1fHx1JiZ0LmZvbGxvd19tb3VudCkmJihpPWkubW91bnRlZC5yb290KSwhdXx8dC5mb2xsb3cpZm9yKHZhciBjPTA7VGUuaXNMaW5rKGkubW9kZSk7KXt2YXIgbD1UZS5yZWFkbGluayhhKTtpZihhPWdlLnJlc29sdmUoZ2UuZGlybmFtZShhKSxsKSxpPVRlLmxvb2t1cFBhdGgoYSx7cmVjdXJzZV9jb3VudDp0LnJlY3Vyc2VfY291bnR9KS5ub2RlLGMrKz40MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTE9PUCl9fXJldHVybntwYXRoOmEsbm9kZTppfX0sZ2V0UGF0aDpmdW5jdGlvbihlKXtmb3IodmFyIHQ7Oyl7aWYoVGUuaXNSb290KGUpKXt2YXIgcj1lLm1vdW50Lm1vdW50cG9pbnQ7cmV0dXJuIHQ/Ii8iIT09cltyLmxlbmd0aC0xXT9yKyIvIit0OnIrdDpyfXQ9dD9lLm5hbWUrIi8iK3Q6ZS5uYW1lLGU9ZS5wYXJlbnR9fSxoYXNoTmFtZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj0wLG49MDtuPHQubGVuZ3RoO24rKylyPShyPDw1KS1yK3QuY2hhckNvZGVBdChuKXwwO3JldHVybihlK3I+Pj4wKSVUZS5uYW1lVGFibGUubGVuZ3RofSxoYXNoQWRkTm9kZTpmdW5jdGlvbihlKXt2YXIgdD1UZS5oYXNoTmFtZShlLnBhcmVudC5pZCxlLm5hbWUpO2UubmFtZV9uZXh0PVRlLm5hbWVUYWJsZVt0XSxUZS5uYW1lVGFibGVbdF09ZX0saGFzaFJlbW92ZU5vZGU6ZnVuY3Rpb24oZSl7dmFyIHQ9VGUuaGFzaE5hbWUoZS5wYXJlbnQuaWQsZS5uYW1lKTtpZihUZS5uYW1lVGFibGVbdF09PT1lKVRlLm5hbWVUYWJsZVt0XT1lLm5hbWVfbmV4dDtlbHNlIGZvcih2YXIgcj1UZS5uYW1lVGFibGVbdF07cjspe2lmKHIubmFtZV9uZXh0PT09ZSl7ci5uYW1lX25leHQ9ZS5uYW1lX25leHQ7YnJlYWt9cj1yLm5hbWVfbmV4dH19LGxvb2t1cE5vZGU6ZnVuY3Rpb24oZSx0KXt2YXIgcj1UZS5tYXlMb29rdXAoZSk7aWYocil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihyLGUpO2Zvcih2YXIgbj1UZS5oYXNoTmFtZShlLmlkLHQpLG89VGUubmFtZVRhYmxlW25dO287bz1vLm5hbWVfbmV4dCl7dmFyIGk9by5uYW1lO2lmKG8ucGFyZW50LmlkPT09ZS5pZCYmaT09PXQpcmV0dXJuIG99cmV0dXJuIFRlLmxvb2t1cChlLHQpfSxjcmVhdGVOb2RlOmZ1bmN0aW9uKGUsdCxyLG4pe2lmKCFUZS5GU05vZGUpe1RlLkZTTm9kZT1mdW5jdGlvbihlLHQscixuKXtlfHwoZT10aGlzKSx0aGlzLnBhcmVudD1lLHRoaXMubW91bnQ9ZS5tb3VudCx0aGlzLm1vdW50ZWQ9bnVsbCx0aGlzLmlkPVRlLm5leHRJbm9kZSsrLHRoaXMubmFtZT10LHRoaXMubW9kZT1yLHRoaXMubm9kZV9vcHM9e30sdGhpcy5zdHJlYW1fb3BzPXt9LHRoaXMucmRldj1ufSxUZS5GU05vZGUucHJvdG90eXBlPXt9O09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKFRlLkZTTm9kZS5wcm90b3R5cGUse3JlYWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiAzNjU9PSgzNjUmdGhpcy5tb2RlKX0sc2V0OmZ1bmN0aW9uKGUpe2U/dGhpcy5tb2RlfD0zNjU6dGhpcy5tb2RlJj0tMzY2fX0sd3JpdGU6e2dldDpmdW5jdGlvbigpe3JldHVybiAxNDY9PSgxNDYmdGhpcy5tb2RlKX0sc2V0OmZ1bmN0aW9uKGUpe2U/dGhpcy5tb2RlfD0xNDY6dGhpcy5tb2RlJj0tMTQ3fX0saXNGb2xkZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBUZS5pc0Rpcih0aGlzLm1vZGUpfX0saXNEZXZpY2U6e2dldDpmdW5jdGlvbigpe3JldHVybiBUZS5pc0NocmRldih0aGlzLm1vZGUpfX19KX12YXIgbz1uZXcgVGUuRlNOb2RlKGUsdCxyLG4pO3JldHVybiBUZS5oYXNoQWRkTm9kZShvKSxvfSxkZXN0cm95Tm9kZTpmdW5jdGlvbihlKXtUZS5oYXNoUmVtb3ZlTm9kZShlKX0saXNSb290OmZ1bmN0aW9uKGUpe3JldHVybiBlPT09ZS5wYXJlbnR9LGlzTW91bnRwb2ludDpmdW5jdGlvbihlKXtyZXR1cm4hIWUubW91bnRlZH0saXNGaWxlOmZ1bmN0aW9uKGUpe3JldHVybiAzMjc2OD09KDYxNDQwJmUpfSxpc0RpcjpmdW5jdGlvbihlKXtyZXR1cm4gMTYzODQ9PSg2MTQ0MCZlKX0saXNMaW5rOmZ1bmN0aW9uKGUpe3JldHVybiA0MDk2MD09KDYxNDQwJmUpfSxpc0NocmRldjpmdW5jdGlvbihlKXtyZXR1cm4gODE5Mj09KDYxNDQwJmUpfSxpc0Jsa2RldjpmdW5jdGlvbihlKXtyZXR1cm4gMjQ1NzY9PSg2MTQ0MCZlKX0saXNGSUZPOmZ1bmN0aW9uKGUpe3JldHVybiA0MDk2PT0oNjE0NDAmZSl9LGlzU29ja2V0OmZ1bmN0aW9uKGUpe3JldHVybiA0OTE1Mj09KDQ5MTUyJmUpfSxmbGFnTW9kZXM6e3I6MCxyczoxMDUyNjcyLCJyKyI6Mix3OjU3Nyx3eDo3MDUseHc6NzA1LCJ3KyI6NTc4LCJ3eCsiOjcwNiwieHcrIjo3MDYsYToxMDg5LGF4OjEyMTcseGE6MTIxNywiYSsiOjEwOTAsImF4KyI6MTIxOCwieGErIjoxMjE4fSxtb2RlU3RyaW5nVG9GbGFnczpmdW5jdGlvbihlKXt2YXIgdD1UZS5mbGFnTW9kZXNbZV07aWYodm9pZCAwPT09dCl0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gZmlsZSBvcGVuIG1vZGU6ICIrZSk7cmV0dXJuIHR9LGZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nOmZ1bmN0aW9uKGUpe3ZhciB0PVsiciIsInciLCJydyJdWzMmZV07cmV0dXJuIDUxMiZlJiYodCs9InciKSx0fSxub2RlUGVybWlzc2lvbnM6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gVGUuaWdub3JlUGVybWlzc2lvbnN8fCgtMT09PXQuaW5kZXhPZigiciIpfHwyOTImZS5tb2RlKSYmKC0xPT09dC5pbmRleE9mKCJ3Iil8fDE0NiZlLm1vZGUpJiYoLTE9PT10LmluZGV4T2YoIngiKXx8NzMmZS5tb2RlKT8wOm1lLkVBQ0NFU30sbWF5TG9va3VwOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLm5vZGVQZXJtaXNzaW9ucyhlLCJ4Iik7cmV0dXJuIHR8fChlLm5vZGVfb3BzLmxvb2t1cD8wOm1lLkVBQ0NFUyl9LG1heUNyZWF0ZTpmdW5jdGlvbihlLHQpe3RyeXtUZS5sb29rdXBOb2RlKGUsdCk7cmV0dXJuIG1lLkVFWElTVH1jYXRjaChlKXt9cmV0dXJuIFRlLm5vZGVQZXJtaXNzaW9ucyhlLCJ3eCIpfSxtYXlEZWxldGU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuO3RyeXtuPVRlLmxvb2t1cE5vZGUoZSx0KX1jYXRjaChlKXtyZXR1cm4gZS5lcnJub312YXIgbz1UZS5ub2RlUGVybWlzc2lvbnMoZSwid3giKTtpZihvKXJldHVybiBvO2lmKHIpe2lmKCFUZS5pc0RpcihuLm1vZGUpKXJldHVybiBtZS5FTk9URElSO2lmKFRlLmlzUm9vdChuKXx8VGUuZ2V0UGF0aChuKT09PVRlLmN3ZCgpKXJldHVybiBtZS5FQlVTWX1lbHNlIGlmKFRlLmlzRGlyKG4ubW9kZSkpcmV0dXJuIG1lLkVJU0RJUjtyZXR1cm4gMH0sbWF5T3BlbjpmdW5jdGlvbihlLHQpe3JldHVybiBlP1RlLmlzTGluayhlLm1vZGUpP21lLkVMT09QOlRlLmlzRGlyKGUubW9kZSkmJigiciIhPT1UZS5mbGFnc1RvUGVybWlzc2lvblN0cmluZyh0KXx8NTEyJnQpP21lLkVJU0RJUjpUZS5ub2RlUGVybWlzc2lvbnMoZSxUZS5mbGFnc1RvUGVybWlzc2lvblN0cmluZyh0KSk6bWUuRU5PRU5UfSxNQVhfT1BFTl9GRFM6NDA5NixuZXh0ZmQ6ZnVuY3Rpb24oZSx0KXtlPWV8fDAsdD10fHxUZS5NQVhfT1BFTl9GRFM7Zm9yKHZhciByPWU7cjw9dDtyKyspaWYoIVRlLnN0cmVhbXNbcl0pcmV0dXJuIHI7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU1GSUxFKX0sZ2V0U3RyZWFtOmZ1bmN0aW9uKGUpe3JldHVybiBUZS5zdHJlYW1zW2VdfSxjcmVhdGVTdHJlYW06ZnVuY3Rpb24oZSx0LHIpe1RlLkZTU3RyZWFtfHwoVGUuRlNTdHJlYW09ZnVuY3Rpb24oKXt9LFRlLkZTU3RyZWFtLnByb3RvdHlwZT17fSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyhUZS5GU1N0cmVhbS5wcm90b3R5cGUse29iamVjdDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubm9kZX0sc2V0OmZ1bmN0aW9uKGUpe3RoaXMubm9kZT1lfX0saXNSZWFkOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMSE9KDIwOTcxNTUmdGhpcy5mbGFncyl9fSxpc1dyaXRlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMCE9KDIwOTcxNTUmdGhpcy5mbGFncyl9fSxpc0FwcGVuZDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDEwMjQmdGhpcy5mbGFnc319fSkpO3ZhciBuPW5ldyBUZS5GU1N0cmVhbTtmb3IodmFyIG8gaW4gZSluW29dPWVbb107ZT1uO3ZhciBpPVRlLm5leHRmZCh0LHIpO3JldHVybiBlLmZkPWksVGUuc3RyZWFtc1tpXT1lLGV9LGNsb3NlU3RyZWFtOmZ1bmN0aW9uKGUpe1RlLnN0cmVhbXNbZV09bnVsbH0sY2hyZGV2X3N0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oZSl7dmFyIHQ9VGUuZ2V0RGV2aWNlKGUubm9kZS5yZGV2KTtlLnN0cmVhbV9vcHM9dC5zdHJlYW1fb3BzLGUuc3RyZWFtX29wcy5vcGVuJiZlLnN0cmVhbV9vcHMub3BlbihlKX0sbGxzZWVrOmZ1bmN0aW9uKCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVNQSVBFKX19LG1ham9yOmZ1bmN0aW9uKGUpe3JldHVybiBlPj44fSxtaW5vcjpmdW5jdGlvbihlKXtyZXR1cm4gMjU1JmV9LG1ha2VkZXY6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZTw8OHx0fSxyZWdpc3RlckRldmljZTpmdW5jdGlvbihlLHQpe1RlLmRldmljZXNbZV09e3N0cmVhbV9vcHM6dH19LGdldERldmljZTpmdW5jdGlvbihlKXtyZXR1cm4gVGUuZGV2aWNlc1tlXX0sZ2V0TW91bnRzOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxyPVtlXTtyLmxlbmd0aDspe3ZhciBuPXIucG9wKCk7dC5wdXNoKG4pLHIucHVzaC5hcHBseShyLG4ubW91bnRzKX1yZXR1cm4gdH0sc3luY2ZzOmZ1bmN0aW9uKGUsdCl7ImZ1bmN0aW9uIj09dHlwZW9mIGUmJih0PWUsZT0hMSksVGUuc3luY0ZTUmVxdWVzdHMrKyxUZS5zeW5jRlNSZXF1ZXN0cz4xJiZjb25zb2xlLmxvZygid2FybmluZzogIitUZS5zeW5jRlNSZXF1ZXN0cysiIEZTLnN5bmNmcyBvcGVyYXRpb25zIGluIGZsaWdodCBhdCBvbmNlLCBwcm9iYWJseSBqdXN0IGRvaW5nIGV4dHJhIHdvcmsiKTt2YXIgcj1UZS5nZXRNb3VudHMoVGUucm9vdC5tb3VudCksbj0wO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIHkoVGUuc3luY0ZTUmVxdWVzdHM+MCksVGUuc3luY0ZTUmVxdWVzdHMtLSx0KGUpfWZ1bmN0aW9uIGkoZSl7aWYoZSlyZXR1cm4gaS5lcnJvcmVkP3ZvaWQgMDooaS5lcnJvcmVkPSEwLG8oZSkpOysrbj49ci5sZW5ndGgmJm8obnVsbCl9ci5mb3JFYWNoKChmdW5jdGlvbih0KXtpZighdC50eXBlLnN5bmNmcylyZXR1cm4gaShudWxsKTt0LnR5cGUuc3luY2ZzKHQsZSxpKX0pKX0sbW91bnQ6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuLG89Ii8iPT09cixpPSFyO2lmKG8mJlRlLnJvb3QpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO2lmKCFvJiYhaSl7dmFyIGE9VGUubG9va3VwUGF0aChyLHtmb2xsb3dfbW91bnQ6ITF9KTtpZihyPWEucGF0aCxuPWEubm9kZSxUZS5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO2lmKCFUZS5pc0RpcihuLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RESVIpfXZhciBzPXt0eXBlOmUsb3B0czp0LG1vdW50cG9pbnQ6cixtb3VudHM6W119LHU9ZS5tb3VudChzKTtyZXR1cm4gdS5tb3VudD1zLHMucm9vdD11LG8/VGUucm9vdD11Om4mJihuLm1vdW50ZWQ9cyxuLm1vdW50JiZuLm1vdW50Lm1vdW50cy5wdXNoKHMpKSx1fSx1bm1vdW50OmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93X21vdW50OiExfSk7aWYoIVRlLmlzTW91bnRwb2ludCh0Lm5vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIHI9dC5ub2RlLG49ci5tb3VudGVkLG89VGUuZ2V0TW91bnRzKG4pO09iamVjdC5rZXlzKFRlLm5hbWVUYWJsZSkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVRlLm5hbWVUYWJsZVtlXTt0Oyl7dmFyIHI9dC5uYW1lX25leHQ7LTEhPT1vLmluZGV4T2YodC5tb3VudCkmJlRlLmRlc3Ryb3lOb2RlKHQpLHQ9cn19KSksci5tb3VudGVkPW51bGw7dmFyIGk9ci5tb3VudC5tb3VudHMuaW5kZXhPZihuKTt5KC0xIT09aSksci5tb3VudC5tb3VudHMuc3BsaWNlKGksMSl9LGxvb2t1cDpmdW5jdGlvbihlLHQpe3JldHVybiBlLm5vZGVfb3BzLmxvb2t1cChlLHQpfSxta25vZDpmdW5jdGlvbihlLHQscil7dmFyIG49VGUubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLG89Z2UuYmFzZW5hbWUoZSk7aWYoIW98fCIuIj09PW98fCIuLiI9PT1vKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIGk9VGUubWF5Q3JlYXRlKG4sbyk7aWYoaSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihpKTtpZighbi5ub2RlX29wcy5ta25vZCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIG4ubm9kZV9vcHMubWtub2QobixvLHQscil9LGNyZWF0ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0PXZvaWQgMCE9PXQ/dDo0MzgsdCY9NDA5NSx0fD0zMjc2OCxUZS5ta25vZChlLHQsMCl9LG1rZGlyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQ9dm9pZCAwIT09dD90OjUxMSx0Jj0xMDIzLHR8PTE2Mzg0LFRlLm1rbm9kKGUsdCwwKX0sbWtkaXJUcmVlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPWUuc3BsaXQoIi8iKSxuPSIiLG89MDtvPHIubGVuZ3RoOysrbylpZihyW29dKXtuKz0iLyIrcltvXTt0cnl7VGUubWtkaXIobix0KX1jYXRjaChlKXtpZihlLmVycm5vIT1tZS5FRVhJU1QpdGhyb3cgZX19fSxta2RldjpmdW5jdGlvbihlLHQscil7cmV0dXJuIHZvaWQgMD09PXImJihyPXQsdD00MzgpLHR8PTgxOTIsVGUubWtub2QoZSx0LHIpfSxzeW1saW5rOmZ1bmN0aW9uKGUsdCl7aWYoIWdlLnJlc29sdmUoZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTt2YXIgcj1UZS5sb29rdXBQYXRoKHQse3BhcmVudDohMH0pLm5vZGU7aWYoIXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTt2YXIgbj1nZS5iYXNlbmFtZSh0KSxvPVRlLm1heUNyZWF0ZShyLG4pO2lmKG8pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3Iobyk7aWYoIXIubm9kZV9vcHMuc3ltbGluayl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIHIubm9kZV9vcHMuc3ltbGluayhyLG4sZSl9LHJlbmFtZTpmdW5jdGlvbihlLHQpe3ZhciByLG4sbz1nZS5kaXJuYW1lKGUpLGk9Z2UuZGlybmFtZSh0KSxhPWdlLmJhc2VuYW1lKGUpLHM9Z2UuYmFzZW5hbWUodCk7dHJ5e3I9VGUubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLG49VGUubG9va3VwUGF0aCh0LHtwYXJlbnQ6ITB9KS5ub2RlfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKX1pZighcnx8IW4pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTtpZihyLm1vdW50IT09bi5tb3VudCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FWERFVik7dmFyIHUsYz1UZS5sb29rdXBOb2RlKHIsYSksbD1nZS5yZWxhdGl2ZShlLGkpO2lmKCIuIiE9PWwuY2hhckF0KDApKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7aWYoIi4iIT09KGw9Z2UucmVsYXRpdmUodCxvKSkuY2hhckF0KDApKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RFTVBUWSk7dHJ5e3U9VGUubG9va3VwTm9kZShuLHMpfWNhdGNoKGUpe31pZihjIT09dSl7dmFyIGY9VGUuaXNEaXIoYy5tb2RlKSxkPVRlLm1heURlbGV0ZShyLGEsZik7aWYoZCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihkKTtpZihkPXU/VGUubWF5RGVsZXRlKG4scyxmKTpUZS5tYXlDcmVhdGUobixzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihkKTtpZighci5ub2RlX29wcy5yZW5hbWUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pO2lmKFRlLmlzTW91bnRwb2ludChjKXx8dSYmVGUuaXNNb3VudHBvaW50KHUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKTtpZihuIT09ciYmKGQ9VGUubm9kZVBlcm1pc3Npb25zKHIsInciKSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IoZCk7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUud2lsbE1vdmVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLndpbGxNb3ZlUGF0aChlLHQpfWNhdGNoKHIpe2NvbnNvbGUubG9nKCJGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsTW92ZVBhdGgnXSgnIitlKyInLCAnIit0KyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrci5tZXNzYWdlKX1UZS5oYXNoUmVtb3ZlTm9kZShjKTt0cnl7ci5ub2RlX29wcy5yZW5hbWUoYyxuLHMpfWNhdGNoKGUpe3Rocm93IGV9ZmluYWxseXtUZS5oYXNoQWRkTm9kZShjKX10cnl7VGUudHJhY2tpbmdEZWxlZ2F0ZS5vbk1vdmVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uTW92ZVBhdGgoZSx0KX1jYXRjaChyKXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25Nb3ZlUGF0aCddKCciK2UrIicsICciK3QrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIityLm1lc3NhZ2UpfX19LHJtZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSkubm9kZSxyPWdlLmJhc2VuYW1lKGUpLG49VGUubG9va3VwTm9kZSh0LHIpLG89VGUubWF5RGVsZXRlKHQsciwhMCk7aWYobyl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihvKTtpZighdC5ub2RlX29wcy5ybWRpcil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7aWYoVGUuaXNNb3VudHBvaW50KG4pKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKTt0cnl7VGUudHJhY2tpbmdEZWxlZ2F0ZS53aWxsRGVsZXRlUGF0aCYmVGUudHJhY2tpbmdEZWxlZ2F0ZS53aWxsRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbERlbGV0ZVBhdGgnXSgnIitlKyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrdC5tZXNzYWdlKX10Lm5vZGVfb3BzLnJtZGlyKHQsciksVGUuZGVzdHJveU5vZGUobik7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUub25EZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIrZSsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9fSxyZWFkZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtpZighdC5ub2RlX29wcy5yZWFkZGlyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RESVIpO3JldHVybiB0Lm5vZGVfb3BzLnJlYWRkaXIodCl9LHVubGluazpmdW5jdGlvbihlKXt2YXIgdD1UZS5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pLm5vZGUscj1nZS5iYXNlbmFtZShlKSxuPVRlLmxvb2t1cE5vZGUodCxyKSxvPVRlLm1heURlbGV0ZSh0LHIsITEpO2lmKG8pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3Iobyk7aWYoIXQubm9kZV9vcHMudW5saW5rKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTtpZihUZS5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO3RyeXtUZS50cmFja2luZ0RlbGVnYXRlLndpbGxEZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLndpbGxEZWxldGVQYXRoKGUpfWNhdGNoKHQpe2NvbnNvbGUubG9nKCJGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsRGVsZXRlUGF0aCddKCciK2UrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIit0Lm1lc3NhZ2UpfXQubm9kZV9vcHMudW5saW5rKHQsciksVGUuZGVzdHJveU5vZGUobik7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUub25EZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIrZSsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9fSxyZWFkbGluazpmdW5jdGlvbihlKXt2YXIgdD1UZS5sb29rdXBQYXRoKGUpLm5vZGU7aWYoIXQpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTtpZighdC5ub2RlX29wcy5yZWFkbGluayl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiBnZS5yZXNvbHZlKFRlLmdldFBhdGgodC5wYXJlbnQpLHQubm9kZV9vcHMucmVhZGxpbmsodCkpfSxzdGF0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6IXR9KS5ub2RlO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT0VOVCk7aWYoIXIubm9kZV9vcHMuZ2V0YXR0cil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIHIubm9kZV9vcHMuZ2V0YXR0cihyKX0sbHN0YXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIFRlLnN0YXQoZSwhMCl9LGNobW9kOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbjsic3RyaW5nIj09dHlwZW9mIGU/bj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohcn0pLm5vZGU6bj1lO2lmKCFuLm5vZGVfb3BzLnNldGF0dHIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pO24ubm9kZV9vcHMuc2V0YXR0cihuLHttb2RlOjQwOTUmdHwtNDA5NiZuLm1vZGUsdGltZXN0YW1wOkRhdGUubm93KCl9KX0sbGNobW9kOmZ1bmN0aW9uKGUsdCl7VGUuY2htb2QoZSx0LCEwKX0sZmNobW9kOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUuZ2V0U3RyZWFtKGUpO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtUZS5jaG1vZChyLm5vZGUsdCl9LGNob3duOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvOyJzdHJpbmciPT10eXBlb2YgZT9vPVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiFufSkubm9kZTpvPWU7aWYoIW8ubm9kZV9vcHMuc2V0YXR0cil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7by5ub2RlX29wcy5zZXRhdHRyKG8se3RpbWVzdGFtcDpEYXRlLm5vdygpfSl9LGxjaG93bjpmdW5jdGlvbihlLHQscil7VGUuY2hvd24oZSx0LHIsITApfSxmY2hvd246ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmdldFN0cmVhbShlKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7VGUuY2hvd24obi5ub2RlLHQscil9LHRydW5jYXRlOmZ1bmN0aW9uKGUsdCl7aWYodDwwKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIHI7InN0cmluZyI9PXR5cGVvZiBlP3I9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KS5ub2RlOnI9ZTtpZighci5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTtpZihUZS5pc0RpcihyLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJU0RJUik7aWYoIVRlLmlzRmlsZShyLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIG49VGUubm9kZVBlcm1pc3Npb25zKHIsInciKTtpZihuKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG4pO3Iubm9kZV9vcHMuc2V0YXR0cihyLHtzaXplOnQsdGltZXN0YW1wOkRhdGUubm93KCl9KX0sZnRydW5jYXRlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUuZ2V0U3RyZWFtKGUpO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZigwPT0oMjA5NzE1NSZyLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO1RlLnRydW5jYXRlKHIubm9kZSx0KX0sdXRpbWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtuLm5vZGVfb3BzLnNldGF0dHIobix7dGltZXN0YW1wOk1hdGgubWF4KHQscil9KX0sb3BlbjpmdW5jdGlvbihlLHQscixuLGkpe2lmKCIiPT09ZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9FTlQpO3ZhciBhO2lmKHI9dm9pZCAwPT09cj80Mzg6cixyPTY0Jih0PSJzdHJpbmciPT10eXBlb2YgdD9UZS5tb2RlU3RyaW5nVG9GbGFncyh0KTp0KT80MDk1JnJ8MzI3Njg6MCwib2JqZWN0Ij09dHlwZW9mIGUpYT1lO2Vsc2V7ZT1nZS5ub3JtYWxpemUoZSk7dHJ5e2E9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ISgxMzEwNzImdCl9KS5ub2RlfWNhdGNoKGUpe319dmFyIHM9ITE7aWYoNjQmdClpZihhKXtpZigxMjgmdCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FRVhJU1QpfWVsc2UgYT1UZS5ta25vZChlLHIsMCkscz0hMDtpZighYSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9FTlQpO2lmKFRlLmlzQ2hyZGV2KGEubW9kZSkmJih0Jj0tNTEzKSw2NTUzNiZ0JiYhVGUuaXNEaXIoYS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9URElSKTtpZighcyl7dmFyIHU9VGUubWF5T3BlbihhLHQpO2lmKHUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IodSl9NTEyJnQmJlRlLnRydW5jYXRlKGEsMCksdCY9LTY0MTt2YXIgYz1UZS5jcmVhdGVTdHJlYW0oe25vZGU6YSxwYXRoOlRlLmdldFBhdGgoYSksZmxhZ3M6dCxzZWVrYWJsZTohMCxwb3NpdGlvbjowLHN0cmVhbV9vcHM6YS5zdHJlYW1fb3BzLHVuZ290dGVuOltdLGVycm9yOiExfSxuLGkpO2Muc3RyZWFtX29wcy5vcGVuJiZjLnN0cmVhbV9vcHMub3BlbihjKSwhby5sb2dSZWFkRmlsZXN8fDEmdHx8KFRlLnJlYWRGaWxlc3x8KFRlLnJlYWRGaWxlcz17fSksZSBpbiBUZS5yZWFkRmlsZXN8fChUZS5yZWFkRmlsZXNbZV09MSxvLnByaW50RXJyKCJyZWFkIGZpbGU6ICIrZSkpKTt0cnl7aWYoVGUudHJhY2tpbmdEZWxlZ2F0ZS5vbk9wZW5GaWxlKXt2YXIgbD0wOzEhPSgyMDk3MTU1JnQpJiYobHw9VGUudHJhY2tpbmcub3BlbkZsYWdzLlJFQUQpLDAhPSgyMDk3MTU1JnQpJiYobHw9VGUudHJhY2tpbmcub3BlbkZsYWdzLldSSVRFKSxUZS50cmFja2luZ0RlbGVnYXRlLm9uT3BlbkZpbGUoZSxsKX19Y2F0Y2godCl7Y29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uT3BlbkZpbGUnXSgnIitlKyInLCBmbGFncykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9cmV0dXJuIGN9LGNsb3NlOmZ1bmN0aW9uKGUpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtlLmdldGRlbnRzJiYoZS5nZXRkZW50cz1udWxsKTt0cnl7ZS5zdHJlYW1fb3BzLmNsb3NlJiZlLnN0cmVhbV9vcHMuY2xvc2UoZSl9Y2F0Y2goZSl7dGhyb3cgZX1maW5hbGx5e1RlLmNsb3NlU3RyZWFtKGUuZmQpfWUuZmQ9bnVsbH0saXNDbG9zZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGw9PT1lLmZkfSxsbHNlZWs6ZnVuY3Rpb24oZSx0LHIpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZighZS5zZWVrYWJsZXx8IWUuc3RyZWFtX29wcy5sbHNlZWspdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVNQSVBFKTtyZXR1cm4gZS5wb3NpdGlvbj1lLnN0cmVhbV9vcHMubGxzZWVrKGUsdCxyKSxlLnVuZ290dGVuPVtdLGUucG9zaXRpb259LHJlYWQ6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZihuPDB8fG88MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZigxPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoVGUuaXNEaXIoZS5ub2RlLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJU0RJUik7aWYoIWUuc3RyZWFtX29wcy5yZWFkKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIGk9dm9pZCAwIT09bztpZihpKXtpZighZS5zZWVrYWJsZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FU1BJUEUpfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBhPWUuc3RyZWFtX29wcy5yZWFkKGUsdCxyLG4sbyk7cmV0dXJuIGl8fChlLnBvc2l0aW9uKz1hKSxhfSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8saSl7aWYobjwwfHxvPDApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtpZihUZS5pc0Nsb3NlZChlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoMD09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJBREYpO2lmKFRlLmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSVNESVIpO2lmKCFlLnN0cmVhbV9vcHMud3JpdGUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTsxMDI0JmUuZmxhZ3MmJlRlLmxsc2VlayhlLDAsMik7dmFyIGE9dm9pZCAwIT09bztpZihhKXtpZighZS5zZWVrYWJsZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FU1BJUEUpfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBzPWUuc3RyZWFtX29wcy53cml0ZShlLHQscixuLG8saSk7YXx8KGUucG9zaXRpb24rPXMpO3RyeXtlLnBhdGgmJlRlLnRyYWNraW5nRGVsZWdhdGUub25Xcml0ZVRvRmlsZSYmVGUudHJhY2tpbmdEZWxlZ2F0ZS5vbldyaXRlVG9GaWxlKGUucGF0aCl9Y2F0Y2goZSl7Y29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uV3JpdGVUb0ZpbGUnXSgnIitwYXRoKyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrZS5tZXNzYWdlKX1yZXR1cm4gc30sYWxsb2NhdGU6ZnVuY3Rpb24oZSx0LHIpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZih0PDB8fHI8PTApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtpZigwPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoIVRlLmlzRmlsZShlLm5vZGUubW9kZSkmJiFUZS5pc0RpcihlLm5vZGUubW9kZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtpZighZS5zdHJlYW1fb3BzLmFsbG9jYXRlKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVPUE5PVFNVUFApO2Uuc3RyZWFtX29wcy5hbGxvY2F0ZShlLHQscil9LG1tYXA6ZnVuY3Rpb24oZSx0LHIsbixvLGksYSl7aWYoMT09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUFDQ0VTKTtpZighZS5zdHJlYW1fb3BzLm1tYXApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtyZXR1cm4gZS5zdHJlYW1fb3BzLm1tYXAoZSx0LHIsbixvLGksYSl9LG1zeW5jOmZ1bmN0aW9uKGUsdCxyLG4sbyl7cmV0dXJuIGUmJmUuc3RyZWFtX29wcy5tc3luYz9lLnN0cmVhbV9vcHMubXN5bmMoZSx0LHIsbixvKTowfSxtdW5tYXA6ZnVuY3Rpb24oZSl7cmV0dXJuIDB9LGlvY3RsOmZ1bmN0aW9uKGUsdCxyKXtpZighZS5zdHJlYW1fb3BzLmlvY3RsKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RUWSk7cmV0dXJuIGUuc3RyZWFtX29wcy5pb2N0bChlLHQscil9LHJlYWRGaWxlOmZ1bmN0aW9uKGUsdCl7aWYoKHQ9dHx8e30pLmZsYWdzPXQuZmxhZ3N8fCJyIix0LmVuY29kaW5nPXQuZW5jb2Rpbmd8fCJiaW5hcnkiLCJ1dGY4IiE9PXQuZW5jb2RpbmcmJiJiaW5hcnkiIT09dC5lbmNvZGluZyl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW5jb2RpbmcgdHlwZSAiJyt0LmVuY29kaW5nKyciJyk7dmFyIHIsbj1UZS5vcGVuKGUsdC5mbGFncyksbz1UZS5zdGF0KGUpLnNpemUsaT1uZXcgVWludDhBcnJheShvKTtyZXR1cm4gVGUucmVhZChuLGksMCxvLDApLCJ1dGY4Ij09PXQuZW5jb2Rpbmc/cj1fKGksMCk6ImJpbmFyeSI9PT10LmVuY29kaW5nJiYocj1pKSxUZS5jbG9zZShuKSxyfSx3cml0ZUZpbGU6ZnVuY3Rpb24oZSx0LHIpeyhyPXJ8fHt9KS5mbGFncz1yLmZsYWdzfHwidyI7dmFyIG49VGUub3BlbihlLHIuZmxhZ3Msci5tb2RlKTtpZigic3RyaW5nIj09dHlwZW9mIHQpe3ZhciBvPW5ldyBVaW50OEFycmF5KFModCkrMSksaT1BKHQsbywwLG8ubGVuZ3RoKTtUZS53cml0ZShuLG8sMCxpLHZvaWQgMCxyLmNhbk93bil9ZWxzZXtpZighQXJyYXlCdWZmZXIuaXNWaWV3KHQpKXRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgZGF0YSB0eXBlIik7VGUud3JpdGUobix0LDAsdC5ieXRlTGVuZ3RoLHZvaWQgMCxyLmNhbk93bil9VGUuY2xvc2Uobil9LGN3ZDpmdW5jdGlvbigpe3JldHVybiBUZS5jdXJyZW50UGF0aH0sY2hkaXI6ZnVuY3Rpb24oZSl7dmFyIHQ9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KTtpZihudWxsPT09dC5ub2RlKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT0VOVCk7aWYoIVRlLmlzRGlyKHQubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9URElSKTt2YXIgcj1UZS5ub2RlUGVybWlzc2lvbnModC5ub2RlLCJ4Iik7aWYocil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihyKTtUZS5jdXJyZW50UGF0aD10LnBhdGh9LGNyZWF0ZURlZmF1bHREaXJlY3RvcmllczpmdW5jdGlvbigpe1RlLm1rZGlyKCIvdG1wIiksVGUubWtkaXIoIi9ob21lIiksVGUubWtkaXIoIi9ob21lL3dlYl91c2VyIil9LGNyZWF0ZURlZmF1bHREZXZpY2VzOmZ1bmN0aW9uKCl7dmFyIGU7aWYoVGUubWtkaXIoIi9kZXYiKSxUZS5yZWdpc3RlckRldmljZShUZS5tYWtlZGV2KDEsMykse3JlYWQ6ZnVuY3Rpb24oKXtyZXR1cm4gMH0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvKXtyZXR1cm4gbn19KSxUZS5ta2RldigiL2Rldi9udWxsIixUZS5tYWtlZGV2KDEsMykpLHZlLnJlZ2lzdGVyKFRlLm1ha2VkZXYoNSwwKSx2ZS5kZWZhdWx0X3R0eV9vcHMpLHZlLnJlZ2lzdGVyKFRlLm1ha2VkZXYoNiwwKSx2ZS5kZWZhdWx0X3R0eTFfb3BzKSxUZS5ta2RldigiL2Rldi90dHkiLFRlLm1ha2VkZXYoNSwwKSksVGUubWtkZXYoIi9kZXYvdHR5MSIsVGUubWFrZWRldig2LDApKSwidW5kZWZpbmVkIiE9dHlwZW9mIGNyeXB0byl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoMSk7ZT1mdW5jdGlvbigpe3JldHVybiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHQpLHRbMF19fWVsc2UgZT1sP2Z1bmN0aW9uKCl7cmV0dXJuIHJlcXVpcmUoImNyeXB0byIpLnJhbmRvbUJ5dGVzKDEpWzBdfTpmdW5jdGlvbigpe3JldHVybiAyNTYqTWF0aC5yYW5kb20oKXwwfTtUZS5jcmVhdGVEZXZpY2UoIi9kZXYiLCJyYW5kb20iLGUpLFRlLmNyZWF0ZURldmljZSgiL2RldiIsInVyYW5kb20iLGUpLFRlLm1rZGlyKCIvZGV2L3NobSIpLFRlLm1rZGlyKCIvZGV2L3NobS90bXAiKX0sY3JlYXRlU3BlY2lhbERpcmVjdG9yaWVzOmZ1bmN0aW9uKCl7VGUubWtkaXIoIi9wcm9jIiksVGUubWtkaXIoIi9wcm9jL3NlbGYiKSxUZS5ta2RpcigiL3Byb2Mvc2VsZi9mZCIpLFRlLm1vdW50KHttb3VudDpmdW5jdGlvbigpe3ZhciBlPVRlLmNyZWF0ZU5vZGUoIi9wcm9jL3NlbGYiLCJmZCIsMTY4OTUsNzMpO3JldHVybiBlLm5vZGVfb3BzPXtsb29rdXA6ZnVuY3Rpb24oZSx0KXt2YXIgcj0rdCxuPVRlLmdldFN0cmVhbShyKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7dmFyIG89e3BhcmVudDpudWxsLG1vdW50Onttb3VudHBvaW50OiJmYWtlIn0sbm9kZV9vcHM6e3JlYWRsaW5rOmZ1bmN0aW9uKCl7cmV0dXJuIG4ucGF0aH19fTtyZXR1cm4gby5wYXJlbnQ9byxvfX0sZX19LHt9LCIvcHJvYy9zZWxmL2ZkIil9LGNyZWF0ZVN0YW5kYXJkU3RyZWFtczpmdW5jdGlvbigpe28uc3RkaW4/VGUuY3JlYXRlRGV2aWNlKCIvZGV2Iiwic3RkaW4iLG8uc3RkaW4pOlRlLnN5bWxpbmsoIi9kZXYvdHR5IiwiL2Rldi9zdGRpbiIpLG8uc3Rkb3V0P1RlLmNyZWF0ZURldmljZSgiL2RldiIsInN0ZG91dCIsbnVsbCxvLnN0ZG91dCk6VGUuc3ltbGluaygiL2Rldi90dHkiLCIvZGV2L3N0ZG91dCIpLG8uc3RkZXJyP1RlLmNyZWF0ZURldmljZSgiL2RldiIsInN0ZGVyciIsbnVsbCxvLnN0ZGVycik6VGUuc3ltbGluaygiL2Rldi90dHkxIiwiL2Rldi9zdGRlcnIiKTt2YXIgZT1UZS5vcGVuKCIvZGV2L3N0ZGluIiwiciIpO3koMD09PWUuZmQsImludmFsaWQgaGFuZGxlIGZvciBzdGRpbiAoIitlLmZkKyIpIik7dmFyIHQ9VGUub3BlbigiL2Rldi9zdGRvdXQiLCJ3Iik7eSgxPT09dC5mZCwiaW52YWxpZCBoYW5kbGUgZm9yIHN0ZG91dCAoIit0LmZkKyIpIik7dmFyIHI9VGUub3BlbigiL2Rldi9zdGRlcnIiLCJ3Iik7eSgyPT09ci5mZCwiaW52YWxpZCBoYW5kbGUgZm9yIHN0ZGVyciAoIityLmZkKyIpIil9LGVuc3VyZUVycm5vRXJyb3I6ZnVuY3Rpb24oKXtUZS5FcnJub0Vycm9yfHwoVGUuRXJybm9FcnJvcj1mdW5jdGlvbihlLHQpe3RoaXMubm9kZT10LHRoaXMuc2V0RXJybm89ZnVuY3Rpb24oZSl7Zm9yKHZhciB0IGluIHRoaXMuZXJybm89ZSxtZSlpZihtZVt0XT09PWUpe3RoaXMuY29kZT10O2JyZWFrfX0sdGhpcy5zZXRFcnJubyhlKSx0aGlzLm1lc3NhZ2U9RWVbZV0sdGhpcy5zdGFjayYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsInN0YWNrIix7dmFsdWU6KG5ldyBFcnJvcikuc3RhY2ssd3JpdGFibGU6ITB9KX0sVGUuRXJybm9FcnJvci5wcm90b3R5cGU9bmV3IEVycm9yLFRlLkVycm5vRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yPVRlLkVycm5vRXJyb3IsW21lLkVOT0VOVF0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7VGUuZ2VuZXJpY0Vycm9yc1tlXT1uZXcgVGUuRXJybm9FcnJvcihlKSxUZS5nZW5lcmljRXJyb3JzW2VdLnN0YWNrPSI8Z2VuZXJpYyBlcnJvciwgbm8gc3RhY2s+In0pKSl9LHN0YXRpY0luaXQ6ZnVuY3Rpb24oKXtUZS5lbnN1cmVFcnJub0Vycm9yKCksVGUubmFtZVRhYmxlPW5ldyBBcnJheSg0MDk2KSxUZS5tb3VudCh3ZSx7fSwiLyIpLFRlLmNyZWF0ZURlZmF1bHREaXJlY3RvcmllcygpLFRlLmNyZWF0ZURlZmF1bHREZXZpY2VzKCksVGUuY3JlYXRlU3BlY2lhbERpcmVjdG9yaWVzKCksVGUuZmlsZXN5c3RlbXM9e01FTUZTOndlLElEQkZTOl9lLE5PREVGUzpiZSxXT1JLRVJGUzpBZX19LGluaXQ6ZnVuY3Rpb24oZSx0LHIpe3koIVRlLmluaXQuaW5pdGlhbGl6ZWQsIkZTLmluaXQgd2FzIHByZXZpb3VzbHkgY2FsbGVkLiBJZiB5b3Ugd2FudCB0byBpbml0aWFsaXplIGxhdGVyIHdpdGggY3VzdG9tIHBhcmFtZXRlcnMsIHJlbW92ZSBhbnkgZWFybGllciBjYWxscyAobm90ZSB0aGF0IG9uZSBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBnZW5lcmF0ZWQgY29kZSkiKSxUZS5pbml0LmluaXRpYWxpemVkPSEwLFRlLmVuc3VyZUVycm5vRXJyb3IoKSxvLnN0ZGluPWV8fG8uc3RkaW4sby5zdGRvdXQ9dHx8by5zdGRvdXQsby5zdGRlcnI9cnx8by5zdGRlcnIsVGUuY3JlYXRlU3RhbmRhcmRTdHJlYW1zKCl9LHF1aXQ6ZnVuY3Rpb24oKXtUZS5pbml0LmluaXRpYWxpemVkPSExO3ZhciBlPW8uX2ZmbHVzaDtlJiZlKDApO2Zvcih2YXIgdD0wO3Q8VGUuc3RyZWFtcy5sZW5ndGg7dCsrKXt2YXIgcj1UZS5zdHJlYW1zW3RdO3ImJlRlLmNsb3NlKHIpfX0sZ2V0TW9kZTpmdW5jdGlvbihlLHQpe3ZhciByPTA7cmV0dXJuIGUmJihyfD0zNjUpLHQmJihyfD0xNDYpLHJ9LGpvaW5QYXRoOmZ1bmN0aW9uKGUsdCl7dmFyIHI9Z2Uuam9pbi5hcHBseShudWxsLGUpO3JldHVybiB0JiYiLyI9PXJbMF0mJihyPXIuc3Vic3RyKDEpKSxyfSxhYnNvbHV0ZVBhdGg6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZ2UucmVzb2x2ZSh0LGUpfSxzdGFuZGFyZGl6ZVBhdGg6ZnVuY3Rpb24oZSl7cmV0dXJuIGdlLm5vcm1hbGl6ZShlKX0sZmluZE9iamVjdDpmdW5jdGlvbihlLHQpe3ZhciByPVRlLmFuYWx5emVQYXRoKGUsdCk7cmV0dXJuIHIuZXhpc3RzP3Iub2JqZWN0Oih5ZShyLmVycm9yKSxudWxsKX0sYW5hbHl6ZVBhdGg6ZnVuY3Rpb24oZSx0KXt0cnl7ZT0obj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohdH0pKS5wYXRofWNhdGNoKGUpe312YXIgcj17aXNSb290OiExLGV4aXN0czohMSxlcnJvcjowLG5hbWU6bnVsbCxwYXRoOm51bGwsb2JqZWN0Om51bGwscGFyZW50RXhpc3RzOiExLHBhcmVudFBhdGg6bnVsbCxwYXJlbnRPYmplY3Q6bnVsbH07dHJ5e3ZhciBuPVRlLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSk7ci5wYXJlbnRFeGlzdHM9ITAsci5wYXJlbnRQYXRoPW4ucGF0aCxyLnBhcmVudE9iamVjdD1uLm5vZGUsci5uYW1lPWdlLmJhc2VuYW1lKGUpLG49VGUubG9va3VwUGF0aChlLHtmb2xsb3c6IXR9KSxyLmV4aXN0cz0hMCxyLnBhdGg9bi5wYXRoLHIub2JqZWN0PW4ubm9kZSxyLm5hbWU9bi5ub2RlLm5hbWUsci5pc1Jvb3Q9Ii8iPT09bi5wYXRofWNhdGNoKGUpe3IuZXJyb3I9ZS5lcnJub31yZXR1cm4gcn0sY3JlYXRlRm9sZGVyOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksaT1UZS5nZXRNb2RlKHIsbik7cmV0dXJuIFRlLm1rZGlyKG8saSl9LGNyZWF0ZVBhdGg6ZnVuY3Rpb24oZSx0LHIsbil7ZT0ic3RyaW5nIj09dHlwZW9mIGU/ZTpUZS5nZXRQYXRoKGUpO2Zvcih2YXIgbz10LnNwbGl0KCIvIikucmV2ZXJzZSgpO28ubGVuZ3RoOyl7dmFyIGk9by5wb3AoKTtpZihpKXt2YXIgYT1nZS5qb2luMihlLGkpO3RyeXtUZS5ta2RpcihhKX1jYXRjaChlKXt9ZT1hfX1yZXR1cm4gYX0sY3JlYXRlRmlsZTpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksYT1UZS5nZXRNb2RlKG4sbyk7cmV0dXJuIFRlLmNyZWF0ZShpLGEpfSxjcmVhdGVEYXRhRmlsZTpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9dD9nZS5qb2luMigic3RyaW5nIj09dHlwZW9mIGU/ZTpUZS5nZXRQYXRoKGUpLHQpOmUscz1UZS5nZXRNb2RlKG4sbyksdT1UZS5jcmVhdGUoYSxzKTtpZihyKXtpZigic3RyaW5nIj09dHlwZW9mIHIpe2Zvcih2YXIgYz1uZXcgQXJyYXkoci5sZW5ndGgpLGw9MCxmPXIubGVuZ3RoO2w8ZjsrK2wpY1tsXT1yLmNoYXJDb2RlQXQobCk7cj1jfVRlLmNobW9kKHUsMTQ2fHMpO3ZhciBkPVRlLm9wZW4odSwidyIpO1RlLndyaXRlKGQsciwwLHIubGVuZ3RoLDAsaSksVGUuY2xvc2UoZCksVGUuY2htb2QodSxzKX1yZXR1cm4gdX0sY3JlYXRlRGV2aWNlOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksaT1UZS5nZXRNb2RlKCEhciwhIW4pO1RlLmNyZWF0ZURldmljZS5tYWpvcnx8KFRlLmNyZWF0ZURldmljZS5tYWpvcj02NCk7dmFyIGE9VGUubWFrZWRldihUZS5jcmVhdGVEZXZpY2UubWFqb3IrKywwKTtyZXR1cm4gVGUucmVnaXN0ZXJEZXZpY2UoYSx7b3BlbjpmdW5jdGlvbihlKXtlLnNlZWthYmxlPSExfSxjbG9zZTpmdW5jdGlvbihlKXtuJiZuLmJ1ZmZlciYmbi5idWZmZXIubGVuZ3RoJiZuKDEwKX0scmVhZDpmdW5jdGlvbihlLHQsbixvLGkpe2Zvcih2YXIgYT0wLHM9MDtzPG87cysrKXt2YXIgdTt0cnl7dT1yKCl9Y2F0Y2goZSl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlPKX1pZih2b2lkIDA9PT11JiYwPT09YSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQUdBSU4pO2lmKG51bGw9PXUpYnJlYWs7YSsrLHRbbitzXT11fXJldHVybiBhJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfSx3cml0ZTpmdW5jdGlvbihlLHQscixvLGkpe2Zvcih2YXIgYT0wO2E8bzthKyspdHJ5e24odFtyK2FdKX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU8pfXJldHVybiBvJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfX0pLFRlLm1rZGV2KG8saSxhKX0sY3JlYXRlTGluazpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCk7cmV0dXJuIFRlLnN5bWxpbmsocixpKX0sZm9yY2VMb2FkRmlsZTpmdW5jdGlvbihlKXtpZihlLmlzRGV2aWNlfHxlLmlzRm9sZGVyfHxlLmxpbmt8fGUuY29udGVudHMpcmV0dXJuITA7dmFyIHQ9ITA7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCl0aHJvdyBuZXcgRXJyb3IoIkxhenkgbG9hZGluZyBzaG91bGQgaGF2ZSBiZWVuIHBlcmZvcm1lZCAoY29udGVudHMgc2V0KSBpbiBjcmVhdGVMYXp5RmlsZSwgYnV0IGl0IHdhcyBub3QuIExhenkgbG9hZGluZyBvbmx5IHdvcmtzIGluIHdlYiB3b3JrZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2Mgb24gdGhlIG1haW4gdGhyZWFkLiIpO2lmKCFvLnJlYWQpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgbG9hZCB3aXRob3V0IHJlYWQoKSBvciBYTUxIdHRwUmVxdWVzdC4iKTt0cnl7ZS5jb250ZW50cz0kdChvLnJlYWQoZS51cmwpLCEwKSxlLnVzZWRCeXRlcz1lLmNvbnRlbnRzLmxlbmd0aH1jYXRjaChlKXt0PSExfXJldHVybiB0fHx5ZShtZS5FSU8pLHR9LGNyZWF0ZUxhenlGaWxlOmZ1bmN0aW9uKGUsdCxyLG4sbyl7ZnVuY3Rpb24gaSgpe3RoaXMubGVuZ3RoS25vd249ITEsdGhpcy5jaHVua3M9W119aWYoaS5wcm90b3R5cGUuZ2V0PWZ1bmN0aW9uKGUpe2lmKCEoZT50aGlzLmxlbmd0aC0xfHxlPDApKXt2YXIgdD1lJXRoaXMuY2h1bmtTaXplLHI9ZS90aGlzLmNodW5rU2l6ZXwwO3JldHVybiB0aGlzLmdldHRlcihyKVt0XX19LGkucHJvdG90eXBlLnNldERhdGFHZXR0ZXI9ZnVuY3Rpb24oZSl7dGhpcy5nZXR0ZXI9ZX0saS5wcm90b3R5cGUuY2FjaGVMZW5ndGg9ZnVuY3Rpb24oKXt2YXIgZT1uZXcgWE1MSHR0cFJlcXVlc3Q7aWYoZS5vcGVuKCJIRUFEIixyLCExKSxlLnNlbmQobnVsbCksIShlLnN0YXR1cz49MjAwJiZlLnN0YXR1czwzMDB8fDMwND09PWUuc3RhdHVzKSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIityKyIuIFN0YXR1czogIitlLnN0YXR1cyk7dmFyIHQsbj1OdW1iZXIoZS5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1sZW5ndGgiKSksbz0odD1lLmdldFJlc3BvbnNlSGVhZGVyKCJBY2NlcHQtUmFuZ2VzIikpJiYiYnl0ZXMiPT09dCxpPSh0PWUuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtRW5jb2RpbmciKSkmJiJnemlwIj09PXQsYT0xMDQ4NTc2O298fChhPW4pO3ZhciBzPXRoaXM7cy5zZXREYXRhR2V0dGVyKChmdW5jdGlvbihlKXt2YXIgdD1lKmEsbz0oZSsxKSphLTE7aWYobz1NYXRoLm1pbihvLG4tMSksdm9pZCAwPT09cy5jaHVua3NbZV0mJihzLmNodW5rc1tlXT1mdW5jdGlvbihlLHQpe2lmKGU+dCl0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmFuZ2UgKCIrZSsiLCAiK3QrIikgb3Igbm8gYnl0ZXMgcmVxdWVzdGVkISIpO2lmKHQ+bi0xKXRocm93IG5ldyBFcnJvcigib25seSAiK24rIiBieXRlcyBhdmFpbGFibGUhIHByb2dyYW1tZXIgZXJyb3IhIik7dmFyIG89bmV3IFhNTEh0dHBSZXF1ZXN0O2lmKG8ub3BlbigiR0VUIixyLCExKSxuIT09YSYmby5zZXRSZXF1ZXN0SGVhZGVyKCJSYW5nZSIsImJ5dGVzPSIrZSsiLSIrdCksInVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OEFycmF5JiYoby5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIiksby5vdmVycmlkZU1pbWVUeXBlJiZvLm92ZXJyaWRlTWltZVR5cGUoInRleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQiKSxvLnNlbmQobnVsbCksIShvLnN0YXR1cz49MjAwJiZvLnN0YXR1czwzMDB8fDMwND09PW8uc3RhdHVzKSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIityKyIuIFN0YXR1czogIitvLnN0YXR1cyk7cmV0dXJuIHZvaWQgMCE9PW8ucmVzcG9uc2U/bmV3IFVpbnQ4QXJyYXkoby5yZXNwb25zZXx8W10pOiR0KG8ucmVzcG9uc2VUZXh0fHwiIiwhMCl9KHQsbykpLHZvaWQgMD09PXMuY2h1bmtzW2VdKXRocm93IG5ldyBFcnJvcigiZG9YSFIgZmFpbGVkISIpO3JldHVybiBzLmNodW5rc1tlXX0pKSwhaSYmbnx8KGE9bj0xLG49dGhpcy5nZXR0ZXIoMCkubGVuZ3RoLGE9bixjb25zb2xlLmxvZygiTGF6eUZpbGVzIG9uIGd6aXAgZm9yY2VzIGRvd25sb2FkIG9mIHRoZSB3aG9sZSBmaWxlIHdoZW4gbGVuZ3RoIGlzIGFjY2Vzc2VkIikpLHRoaXMuX2xlbmd0aD1uLHRoaXMuX2NodW5rU2l6ZT1hLHRoaXMubGVuZ3RoS25vd249ITB9LCJ1bmRlZmluZWQiIT10eXBlb2YgWE1MSHR0cFJlcXVlc3Qpe2lmKCFjKXRocm93IkNhbm5vdCBkbyBzeW5jaHJvbm91cyBiaW5hcnkgWEhScyBvdXRzaWRlIHdlYndvcmtlcnMgaW4gbW9kZXJuIGJyb3dzZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2MiO3ZhciBhPW5ldyBpO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGEse2xlbmd0aDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGVuZ3RoS25vd258fHRoaXMuY2FjaGVMZW5ndGgoKSx0aGlzLl9sZW5ndGh9fSxjaHVua1NpemU6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aEtub3dufHx0aGlzLmNhY2hlTGVuZ3RoKCksdGhpcy5fY2h1bmtTaXplfX19KTt2YXIgcz17aXNEZXZpY2U6ITEsY29udGVudHM6YX19ZWxzZSBzPXtpc0RldmljZTohMSx1cmw6cn07dmFyIHU9VGUuY3JlYXRlRmlsZShlLHQscyxuLG8pO3MuY29udGVudHM/dS5jb250ZW50cz1zLmNvbnRlbnRzOnMudXJsJiYodS5jb250ZW50cz1udWxsLHUudXJsPXMudXJsKSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh1LHt1c2VkQnl0ZXM6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aH19fSk7dmFyIGw9e307cmV0dXJuIE9iamVjdC5rZXlzKHUuc3RyZWFtX29wcykuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9dS5zdHJlYW1fb3BzW2VdO2xbZV09ZnVuY3Rpb24oKXtpZighVGUuZm9yY2VMb2FkRmlsZSh1KSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU8pO3JldHVybiB0LmFwcGx5KG51bGwsYXJndW1lbnRzKX19KSksbC5yZWFkPWZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoIVRlLmZvcmNlTG9hZEZpbGUodSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlPKTt2YXIgaT1lLm5vZGUuY29udGVudHM7aWYobz49aS5sZW5ndGgpcmV0dXJuIDA7dmFyIGE9TWF0aC5taW4oaS5sZW5ndGgtbyxuKTtpZih5KGE+PTApLGkuc2xpY2UpZm9yKHZhciBzPTA7czxhO3MrKyl0W3Irc109aVtvK3NdO2Vsc2UgZm9yKHM9MDtzPGE7cysrKXRbcitzXT1pLmdldChvK3MpO3JldHVybiBhfSx1LnN0cmVhbV9vcHM9bCx1fSxjcmVhdGVQcmVsb2FkZWRGaWxlOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMsdSxjLGwpe0Jyb3dzZXIuaW5pdCgpO3ZhciBmPXQ/Z2UucmVzb2x2ZShnZS5qb2luMihlLHQpKTplO2Z1bmN0aW9uIGQocil7ZnVuY3Rpb24gZChyKXtsJiZsKCksdXx8VGUuY3JlYXRlRGF0YUZpbGUoZSx0LHIsbixpLGMpLGEmJmEoKSxsZSgpfXZhciBoPSExO28ucHJlbG9hZFBsdWdpbnMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aHx8ZS5jYW5IYW5kbGUoZikmJihlLmhhbmRsZShyLGYsZCwoZnVuY3Rpb24oKXtzJiZzKCksbGUoKX0pKSxoPSEwKX0pKSxofHxkKHIpfWNlKCksInN0cmluZyI9PXR5cGVvZiByP0Jyb3dzZXIuYXN5bmNMb2FkKHIsKGZ1bmN0aW9uKGUpe2QoZSl9KSxzKTpkKHIpfSxpbmRleGVkREI6ZnVuY3Rpb24oKXtyZXR1cm4gd2luZG93LmluZGV4ZWREQnx8d2luZG93Lm1vekluZGV4ZWREQnx8d2luZG93LndlYmtpdEluZGV4ZWREQnx8d2luZG93Lm1zSW5kZXhlZERCfSxEQl9OQU1FOmZ1bmN0aW9uKCl7cmV0dXJuIkVNX0ZTXyIrd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lfSxEQl9WRVJTSU9OOjIwLERCX1NUT1JFX05BTUU6IkZJTEVfREFUQSIsc2F2ZUZpbGVzVG9EQjpmdW5jdGlvbihlLHQscil7dD10fHxmdW5jdGlvbigpe30scj1yfHxmdW5jdGlvbigpe307dmFyIG49VGUuaW5kZXhlZERCKCk7dHJ5e3ZhciBvPW4ub3BlbihUZS5EQl9OQU1FKCksVGUuREJfVkVSU0lPTil9Y2F0Y2goZSl7cmV0dXJuIHIoZSl9by5vbnVwZ3JhZGVuZWVkZWQ9ZnVuY3Rpb24oKXtjb25zb2xlLmxvZygiY3JlYXRpbmcgZGIiKSxvLnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZShUZS5EQl9TVE9SRV9OQU1FKX0sby5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt2YXIgbj1vLnJlc3VsdC50cmFuc2FjdGlvbihbVGUuREJfU1RPUkVfTkFNRV0sInJlYWR3cml0ZSIpLGk9bi5vYmplY3RTdG9yZShUZS5EQl9TVE9SRV9OQU1FKSxhPTAscz0wLHU9ZS5sZW5ndGg7ZnVuY3Rpb24gYygpezA9PXM/dCgpOnIoKX1lLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWkucHV0KFRlLmFuYWx5emVQYXRoKGUpLm9iamVjdC5jb250ZW50cyxlKTt0Lm9uc3VjY2Vzcz1mdW5jdGlvbigpeysrYStzPT11JiZjKCl9LHQub25lcnJvcj1mdW5jdGlvbigpe3MrKyxhK3M9PXUmJmMoKX19KSksbi5vbmVycm9yPXJ9LG8ub25lcnJvcj1yfSxsb2FkRmlsZXNGcm9tREI6ZnVuY3Rpb24oZSx0LHIpe3Q9dHx8ZnVuY3Rpb24oKXt9LHI9cnx8ZnVuY3Rpb24oKXt9O3ZhciBuPVRlLmluZGV4ZWREQigpO3RyeXt2YXIgbz1uLm9wZW4oVGUuREJfTkFNRSgpLFRlLkRCX1ZFUlNJT04pfWNhdGNoKGUpe3JldHVybiByKGUpfW8ub251cGdyYWRlbmVlZGVkPXIsby5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt2YXIgbj1vLnJlc3VsdDt0cnl7dmFyIGk9bi50cmFuc2FjdGlvbihbVGUuREJfU1RPUkVfTkFNRV0sInJlYWRvbmx5Iil9Y2F0Y2goZSl7cmV0dXJuIHZvaWQgcihlKX12YXIgYT1pLm9iamVjdFN0b3JlKFRlLkRCX1NUT1JFX05BTUUpLHM9MCx1PTAsYz1lLmxlbmd0aDtmdW5jdGlvbiBsKCl7MD09dT90KCk6cigpfWUuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9YS5nZXQoZSk7dC5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXtUZS5hbmFseXplUGF0aChlKS5leGlzdHMmJlRlLnVubGluayhlKSxUZS5jcmVhdGVEYXRhRmlsZShnZS5kaXJuYW1lKGUpLGdlLmJhc2VuYW1lKGUpLHQucmVzdWx0LCEwLCEwLCEwKSwrK3MrdT09YyYmbCgpfSx0Lm9uZXJyb3I9ZnVuY3Rpb24oKXt1Kysscyt1PT1jJiZsKCl9fSkpLGkub25lcnJvcj1yfSxvLm9uZXJyb3I9cn19LFNlPXtERUZBVUxUX1BPTExNQVNLOjUsbWFwcGluZ3M6e30sdW1hc2s6NTExLGNhbGN1bGF0ZUF0OmZ1bmN0aW9uKGUsdCl7aWYoIi8iIT09dFswXSl7dmFyIHI7aWYoLTEwMD09PWUpcj1UZS5jd2QoKTtlbHNle3ZhciBuPVRlLmdldFN0cmVhbShlKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7cj1uLnBhdGh9dD1nZS5qb2luMihyLHQpfXJldHVybiB0fSxkb1N0YXQ6ZnVuY3Rpb24oZSx0LHIpe3RyeXt2YXIgbj1lKHQpfWNhdGNoKGUpe2lmKGUmJmUubm9kZSYmZ2Uubm9ybWFsaXplKHQpIT09Z2Uubm9ybWFsaXplKFRlLmdldFBhdGgoZS5ub2RlKSkpcmV0dXJuLW1lLkVOT1RESVI7dGhyb3cgZX1yZXR1cm4gRltyPj4yXT1uLmRldixGW3IrND4+Ml09MCxGW3IrOD4+Ml09bi5pbm8sRltyKzEyPj4yXT1uLm1vZGUsRltyKzE2Pj4yXT1uLm5saW5rLEZbcisyMD4+Ml09bi51aWQsRltyKzI0Pj4yXT1uLmdpZCxGW3IrMjg+PjJdPW4ucmRldixGW3IrMzI+PjJdPTAsRltyKzM2Pj4yXT1uLnNpemUsRltyKzQwPj4yXT00MDk2LEZbcis0ND4+Ml09bi5ibG9ja3MsRltyKzQ4Pj4yXT1uLmF0aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNTI+PjJdPTAsRltyKzU2Pj4yXT1uLm10aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNjA+PjJdPTAsRltyKzY0Pj4yXT1uLmN0aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNjg+PjJdPTAsRltyKzcyPj4yXT1uLmlubywwfSxkb01zeW5jOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPW5ldyBVaW50OEFycmF5KE8uc3ViYXJyYXkoZSxlK3IpKTtUZS5tc3luYyh0LG8sMCxyLG4pfSxkb01rZGlyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIi8iPT09KGU9Z2Uubm9ybWFsaXplKGUpKVtlLmxlbmd0aC0xXSYmKGU9ZS5zdWJzdHIoMCxlLmxlbmd0aC0xKSksVGUubWtkaXIoZSx0LDApLDB9LGRvTWtub2Q6ZnVuY3Rpb24oZSx0LHIpe3N3aXRjaCg2MTQ0MCZ0KXtjYXNlIDMyNzY4OmNhc2UgODE5MjpjYXNlIDI0NTc2OmNhc2UgNDA5NjpjYXNlIDQ5MTUyOmJyZWFrO2RlZmF1bHQ6cmV0dXJuLW1lLkVJTlZBTH1yZXR1cm4gVGUubWtub2QoZSx0LHIpLDB9LGRvUmVhZGxpbms6ZnVuY3Rpb24oZSx0LHIpe2lmKHI8PTApcmV0dXJuLW1lLkVJTlZBTDt2YXIgbj1UZS5yZWFkbGluayhlKSxvPU1hdGgubWluKHIsUyhuKSksaT1SW3Qrb107cmV0dXJuIFQobix0LHIrMSksUlt0K29dPWksb30sZG9BY2Nlc3M6ZnVuY3Rpb24oZSx0KXtpZigtOCZ0KXJldHVybi1tZS5FSU5WQUw7dmFyIHI7cj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohMH0pLm5vZGU7dmFyIG49IiI7cmV0dXJuIDQmdCYmKG4rPSJyIiksMiZ0JiYobis9InciKSwxJnQmJihuKz0ieCIpLG4mJlRlLm5vZGVQZXJtaXNzaW9ucyhyLG4pPy1tZS5FQUNDRVM6MH0sZG9EdXA6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmdldFN0cmVhbShyKTtyZXR1cm4gbiYmVGUuY2xvc2UobiksVGUub3BlbihlLHQsMCxyLHIpLmZkfSxkb1JlYWR2OmZ1bmN0aW9uKGUsdCxyLG4pe2Zvcih2YXIgbz0wLGk9MDtpPHI7aSsrKXt2YXIgYT1GW3QrOCppPj4yXSxzPUZbdCsoOCppKzQpPj4yXSx1PVRlLnJlYWQoZSxSLGEscyxuKTtpZih1PDApcmV0dXJuLTE7aWYobys9dSx1PHMpYnJlYWt9cmV0dXJuIG99LGRvV3JpdGV2OmZ1bmN0aW9uKGUsdCxyLG4pe2Zvcih2YXIgbz0wLGk9MDtpPHI7aSsrKXt2YXIgYT1GW3QrOCppPj4yXSxzPUZbdCsoOCppKzQpPj4yXSx1PVRlLndyaXRlKGUsUixhLHMsbik7aWYodTwwKXJldHVybi0xO28rPXV9cmV0dXJuIG99LHZhcmFyZ3M6MCxnZXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIFNlLnZhcmFyZ3MrPTQsRltTZS52YXJhcmdzLTQ+PjJdfSxnZXRTdHI6ZnVuY3Rpb24oKXtyZXR1cm4gdihTZS5nZXQoKSl9LGdldFN0cmVhbUZyb21GRDpmdW5jdGlvbigpe3ZhciBlPVRlLmdldFN0cmVhbShTZS5nZXQoKSk7aWYoIWUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJBREYpO3JldHVybiBlfSxnZXRTb2NrZXRGcm9tRkQ6ZnVuY3Rpb24oKXt2YXIgZT1TT0NLRlMuZ2V0U29ja2V0KFNlLmdldCgpKTtpZighZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7cmV0dXJuIGV9LGdldFNvY2tldEFkZHJlc3M6ZnVuY3Rpb24oZSl7dmFyIHQ9U2UuZ2V0KCkscj1TZS5nZXQoKTtpZihlJiYwPT09dClyZXR1cm4gbnVsbDt2YXIgbj1fX3JlYWRfc29ja2FkZHIodCxyKTtpZihuLmVycm5vKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG4uZXJybm8pO3JldHVybiBuLmFkZHI9RE5TLmxvb2t1cF9hZGRyKG4uYWRkcil8fG4uYWRkcixufSxnZXQ2NDpmdW5jdGlvbigpe3ZhciBlPVNlLmdldCgpLHQ9U2UuZ2V0KCk7cmV0dXJuIHkoZT49MD8wPT09dDotMT09PXQpLGV9LGdldFplcm86ZnVuY3Rpb24oKXt5KDA9PT1TZS5nZXQoKSl9fTt2YXIga2U9NDI7dmFyIFBlPXt9O2Z1bmN0aW9uIERlKGUpe2Zvcig7ZS5sZW5ndGg7KXt2YXIgdD1lLnBvcCgpO2UucG9wKCkodCl9fWZ1bmN0aW9uIFJlKGUpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShNW2U+PjJdKX12YXIgT2U9e30sQ2U9e30sTmU9e307ZnVuY3Rpb24gRmUoZSl7aWYodm9pZCAwPT09ZSlyZXR1cm4iX3Vua25vd24iO3ZhciB0PShlPWUucmVwbGFjZSgvW15hLXpBLVowLTlfXS9nLCIkIikpLmNoYXJDb2RlQXQoMCk7cmV0dXJuIHQ+PTQ4JiZ0PD01Nz8iXyIrZTplfWZ1bmN0aW9uIE1lKGUsdCl7cmV0dXJuIGU9RmUoZSksbmV3IEZ1bmN0aW9uKCJib2R5IiwicmV0dXJuIGZ1bmN0aW9uICIrZSsnKCkge1xuICAgICJ1c2Ugc3RyaWN0IjsgICAgcmV0dXJuIGJvZHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG4nKSh0KX1mdW5jdGlvbiBJZShlLHQpe3ZhciByPU1lKHQsKGZ1bmN0aW9uKGUpe3RoaXMubmFtZT10LHRoaXMubWVzc2FnZT1lO3ZhciByPW5ldyBFcnJvcihlKS5zdGFjazt2b2lkIDAhPT1yJiYodGhpcy5zdGFjaz10aGlzLnRvU3RyaW5nKCkrIlxuIityLnJlcGxhY2UoL15FcnJvcig6W15cbl0qKT9cbi8sIiIpKX0pKTtyZXR1cm4gci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlLnByb3RvdHlwZSksci5wcm90b3R5cGUuY29uc3RydWN0b3I9cixyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB2b2lkIDA9PT10aGlzLm1lc3NhZ2U/dGhpcy5uYW1lOnRoaXMubmFtZSsiOiAiK3RoaXMubWVzc2FnZX0scn12YXIgQmU9dm9pZCAwO2Z1bmN0aW9uIExlKGUpe3Rocm93IG5ldyBCZShlKX1mdW5jdGlvbiB4ZShlLHQscil7ZnVuY3Rpb24gbih0KXt2YXIgbj1yKHQpO24ubGVuZ3RoIT09ZS5sZW5ndGgmJkxlKCJNaXNtYXRjaGVkIHR5cGUgY29udmVydGVyIGNvdW50Iik7Zm9yKHZhciBvPTA7bzxlLmxlbmd0aDsrK28pWWUoZVtvXSxuW29dKX1lLmZvckVhY2goKGZ1bmN0aW9uKGUpe05lW2VdPXR9KSk7dmFyIG89bmV3IEFycmF5KHQubGVuZ3RoKSxpPVtdLGE9MDt0LmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7Q2UuaGFzT3duUHJvcGVydHkoZSk/b1t0XT1DZVtlXTooaS5wdXNoKGUpLE9lLmhhc093blByb3BlcnR5KGUpfHwoT2VbZV09W10pLE9lW2VdLnB1c2goKGZ1bmN0aW9uKCl7b1t0XT1DZVtlXSwrK2E9PT1pLmxlbmd0aCYmbihvKX0pKSl9KSksMD09PWkubGVuZ3RoJiZuKG8pfWZ1bmN0aW9uIGplKGUpe3N3aXRjaChlKXtjYXNlIDE6cmV0dXJuIDA7Y2FzZSAyOnJldHVybiAxO2Nhc2UgNDpyZXR1cm4gMjtjYXNlIDg6cmV0dXJuIDM7ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIHR5cGUgc2l6ZTogIitlKX19dmFyIFVlPXZvaWQgMDtmdW5jdGlvbiB6ZShlKXtmb3IodmFyIHQ9IiIscj1lO09bcl07KXQrPVVlW09bcisrXV07cmV0dXJuIHR9dmFyICRlPXZvaWQgMDtmdW5jdGlvbiBXZShlKXt0aHJvdyBuZXcgJGUoZSl9ZnVuY3Rpb24gWWUoZSx0LHIpe2lmKHI9cnx8e30sISgiYXJnUGFja0FkdmFuY2UiaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigicmVnaXN0ZXJUeXBlIHJlZ2lzdGVyZWRJbnN0YW5jZSByZXF1aXJlcyBhcmdQYWNrQWR2YW5jZSIpO3ZhciBuPXQubmFtZTtpZihlfHxXZSgndHlwZSAiJytuKyciIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGludGVnZXIgdHlwZWlkIHBvaW50ZXInKSxDZS5oYXNPd25Qcm9wZXJ0eShlKSl7aWYoci5pZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zKXJldHVybjtXZSgiQ2Fubm90IHJlZ2lzdGVyIHR5cGUgJyIrbisiJyB0d2ljZSIpfWlmKENlW2VdPXQsZGVsZXRlIE5lW2VdLE9lLmhhc093blByb3BlcnR5KGUpKXt2YXIgbz1PZVtlXTtkZWxldGUgT2VbZV0sby5mb3JFYWNoKChmdW5jdGlvbihlKXtlKCl9KSl9fWZ1bmN0aW9uIFZlKGUpe2lmKCEodGhpcyBpbnN0YW5jZW9mIGV0KSlyZXR1cm4hMTtpZighKGUgaW5zdGFuY2VvZiBldCkpcmV0dXJuITE7Zm9yKHZhciB0PXRoaXMuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Mscj10aGlzLiQkLnB0cixuPWUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Msbz1lLiQkLnB0cjt0LmJhc2VDbGFzczspcj10LnVwY2FzdChyKSx0PXQuYmFzZUNsYXNzO2Zvcig7bi5iYXNlQ2xhc3M7KW89bi51cGNhc3Qobyksbj1uLmJhc2VDbGFzcztyZXR1cm4gdD09PW4mJnI9PT1vfWZ1bmN0aW9uIEhlKGUpe1dlKGUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MubmFtZSsiIGluc3RhbmNlIGFscmVhZHkgZGVsZXRlZCIpfWZ1bmN0aW9uIEdlKCl7aWYodGhpcy4kJC5wdHJ8fEhlKHRoaXMpLHRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUpcmV0dXJuIHRoaXMuJCQuY291bnQudmFsdWUrPTEsdGhpczt2YXIgZSx0PU9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLHskJDp7dmFsdWU6KGU9dGhpcy4kJCx7Y291bnQ6ZS5jb3VudCxkZWxldGVTY2hlZHVsZWQ6ZS5kZWxldGVTY2hlZHVsZWQscHJlc2VydmVQb2ludGVyT25EZWxldGU6ZS5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSxwdHI6ZS5wdHIscHRyVHlwZTplLnB0clR5cGUsc21hcnRQdHI6ZS5zbWFydFB0cixzbWFydFB0clR5cGU6ZS5zbWFydFB0clR5cGV9KX19KTtyZXR1cm4gdC4kJC5jb3VudC52YWx1ZSs9MSx0LiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSx0fWZ1bmN0aW9uIHFlKCl7dmFyIGU7dGhpcy4kJC5wdHJ8fEhlKHRoaXMpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSYmV2UoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKSx0aGlzLiQkLmNvdW50LnZhbHVlLT0xLDA9PT10aGlzLiQkLmNvdW50LnZhbHVlJiYoKGU9dGhpcy4kJCkuc21hcnRQdHI/ZS5zbWFydFB0clR5cGUucmF3RGVzdHJ1Y3RvcihlLnNtYXJ0UHRyKTplLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLnJhd0Rlc3RydWN0b3IoZS5wdHIpKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlfHwodGhpcy4kJC5zbWFydFB0cj12b2lkIDAsdGhpcy4kJC5wdHI9dm9pZCAwKX1mdW5jdGlvbiBYZSgpe3JldHVybiF0aGlzLiQkLnB0cn12YXIgS2U9dm9pZCAwLEplPVtdO2Z1bmN0aW9uIFplKCl7Zm9yKDtKZS5sZW5ndGg7KXt2YXIgZT1KZS5wb3AoKTtlLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSxlLmRlbGV0ZSgpfX1mdW5jdGlvbiBRZSgpe3JldHVybiB0aGlzLiQkLnB0cnx8SGUodGhpcyksdGhpcy4kJC5kZWxldGVTY2hlZHVsZWQmJiF0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlJiZXZSgiT2JqZWN0IGFscmVhZHkgc2NoZWR1bGVkIGZvciBkZWxldGlvbiIpLEplLnB1c2godGhpcyksMT09PUplLmxlbmd0aCYmS2UmJktlKFplKSx0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMCx0aGlzfWZ1bmN0aW9uIGV0KCl7fXZhciB0dD17fTtmdW5jdGlvbiBydChlLHQscil7aWYodm9pZCAwPT09ZVt0XS5vdmVybG9hZFRhYmxlKXt2YXIgbj1lW3RdO2VbdF09ZnVuY3Rpb24oKXtyZXR1cm4gZVt0XS5vdmVybG9hZFRhYmxlLmhhc093blByb3BlcnR5KGFyZ3VtZW50cy5sZW5ndGgpfHxXZSgiRnVuY3Rpb24gJyIrcisiJyBjYWxsZWQgd2l0aCBhbiBpbnZhbGlkIG51bWJlciBvZiBhcmd1bWVudHMgKCIrYXJndW1lbnRzLmxlbmd0aCsiKSAtIGV4cGVjdHMgb25lIG9mICgiK2VbdF0ub3ZlcmxvYWRUYWJsZSsiKSEiKSxlW3RdLm92ZXJsb2FkVGFibGVbYXJndW1lbnRzLmxlbmd0aF0uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxlW3RdLm92ZXJsb2FkVGFibGU9W10sZVt0XS5vdmVybG9hZFRhYmxlW24uYXJnQ291bnRdPW59fWZ1bmN0aW9uIG50KGUsdCxyLG4sbyxpLGEscyl7dGhpcy5uYW1lPWUsdGhpcy5jb25zdHJ1Y3Rvcj10LHRoaXMuaW5zdGFuY2VQcm90b3R5cGU9cix0aGlzLnJhd0Rlc3RydWN0b3I9bix0aGlzLmJhc2VDbGFzcz1vLHRoaXMuZ2V0QWN0dWFsVHlwZT1pLHRoaXMudXBjYXN0PWEsdGhpcy5kb3duY2FzdD1zLHRoaXMucHVyZVZpcnR1YWxGdW5jdGlvbnM9W119ZnVuY3Rpb24gb3QoZSx0LHIpe2Zvcig7dCE9PXI7KXQudXBjYXN0fHxXZSgiRXhwZWN0ZWQgbnVsbCBvciBpbnN0YW5jZSBvZiAiK3IubmFtZSsiLCBnb3QgYW4gaW5zdGFuY2Ugb2YgIit0Lm5hbWUpLGU9dC51cGNhc3QoZSksdD10LmJhc2VDbGFzcztyZXR1cm4gZX1mdW5jdGlvbiBpdChlLHQpe2lmKG51bGw9PT10KXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZXZSgibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksMDt0LiQkfHxXZSgnQ2Fubm90IHBhc3MgIicrT3QodCkrJyIgYXMgYSAnK3RoaXMubmFtZSksdC4kJC5wdHJ8fFdlKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSk7dmFyIHI9dC4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcztyZXR1cm4gb3QodC4kJC5wdHIscix0aGlzLnJlZ2lzdGVyZWRDbGFzcyl9ZnVuY3Rpb24gYXQoZSx0KXt2YXIgcjtpZihudWxsPT09dClyZXR1cm4gdGhpcy5pc1JlZmVyZW5jZSYmV2UoIm51bGwgaXMgbm90IGEgdmFsaWQgIit0aGlzLm5hbWUpLHRoaXMuaXNTbWFydFBvaW50ZXI/KHI9dGhpcy5yYXdDb25zdHJ1Y3RvcigpLG51bGwhPT1lJiZlLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHIpLHIpOjA7dC4kJHx8V2UoJ0Nhbm5vdCBwYXNzICInK090KHQpKyciIGFzIGEgJyt0aGlzLm5hbWUpLHQuJCQucHRyfHxXZSgiQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgIit0aGlzLm5hbWUpLCF0aGlzLmlzQ29uc3QmJnQuJCQucHRyVHlwZS5pc0NvbnN0JiZXZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiKyh0LiQkLnNtYXJ0UHRyVHlwZT90LiQkLnNtYXJ0UHRyVHlwZS5uYW1lOnQuJCQucHRyVHlwZS5uYW1lKSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTt2YXIgbj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO2lmKHI9b3QodC4kJC5wdHIsbix0aGlzLnJlZ2lzdGVyZWRDbGFzcyksdGhpcy5pc1NtYXJ0UG9pbnRlcilzd2l0Y2godm9pZCAwPT09dC4kJC5zbWFydFB0ciYmV2UoIlBhc3NpbmcgcmF3IHBvaW50ZXIgdG8gc21hcnQgcG9pbnRlciBpcyBpbGxlZ2FsIiksdGhpcy5zaGFyaW5nUG9saWN5KXtjYXNlIDA6dC4kJC5zbWFydFB0clR5cGU9PT10aGlzP3I9dC4kJC5zbWFydFB0cjpXZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiKyh0LiQkLnNtYXJ0UHRyVHlwZT90LiQkLnNtYXJ0UHRyVHlwZS5uYW1lOnQuJCQucHRyVHlwZS5uYW1lKSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTticmVhaztjYXNlIDE6cj10LiQkLnNtYXJ0UHRyO2JyZWFrO2Nhc2UgMjppZih0LiQkLnNtYXJ0UHRyVHlwZT09PXRoaXMpcj10LiQkLnNtYXJ0UHRyO2Vsc2V7dmFyIG89dC5jbG9uZSgpO3I9dGhpcy5yYXdTaGFyZShyLFJ0KChmdW5jdGlvbigpe28uZGVsZXRlKCl9KSkpLG51bGwhPT1lJiZlLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHIpfWJyZWFrO2RlZmF1bHQ6V2UoIlVuc3VwcG9ydGluZyBzaGFyaW5nIHBvbGljeSIpfXJldHVybiByfWZ1bmN0aW9uIHN0KGUsdCl7aWYobnVsbD09PXQpcmV0dXJuIHRoaXMuaXNSZWZlcmVuY2UmJldlKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKSwwO3QuJCR8fFdlKCdDYW5ub3QgcGFzcyAiJytPdCh0KSsnIiBhcyBhICcrdGhpcy5uYW1lKSx0LiQkLnB0cnx8V2UoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKSx0LiQkLnB0clR5cGUuaXNDb25zdCYmV2UoIkNhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgIit0LiQkLnB0clR5cGUubmFtZSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTt2YXIgcj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO3JldHVybiBvdCh0LiQkLnB0cixyLHRoaXMucmVnaXN0ZXJlZENsYXNzKX1mdW5jdGlvbiB1dChlKXtyZXR1cm4gdGhpcy5yYXdHZXRQb2ludGVlJiYoZT10aGlzLnJhd0dldFBvaW50ZWUoZSkpLGV9ZnVuY3Rpb24gY3QoZSl7dGhpcy5yYXdEZXN0cnVjdG9yJiZ0aGlzLnJhd0Rlc3RydWN0b3IoZSl9ZnVuY3Rpb24gbHQoZSl7bnVsbCE9PWUmJmUuZGVsZXRlKCl9ZnVuY3Rpb24gZnQoKXtyZXR1cm4gT2JqZWN0LmtleXMocHQpLmxlbmd0aH1mdW5jdGlvbiBkdCgpe3ZhciBlPVtdO2Zvcih2YXIgdCBpbiBwdClwdC5oYXNPd25Qcm9wZXJ0eSh0KSYmZS5wdXNoKHB0W3RdKTtyZXR1cm4gZX1mdW5jdGlvbiBodChlKXtLZT1lLEplLmxlbmd0aCYmS2UmJktlKFplKX12YXIgcHQ9e307ZnVuY3Rpb24gbXQoZSx0KXtyZXR1cm4gdD1mdW5jdGlvbihlLHQpe2Zvcih2b2lkIDA9PT10JiZXZSgicHRyIHNob3VsZCBub3QgYmUgdW5kZWZpbmVkIik7ZS5iYXNlQ2xhc3M7KXQ9ZS51cGNhc3QodCksZT1lLmJhc2VDbGFzcztyZXR1cm4gdH0oZSx0KSxwdFt0XX1mdW5jdGlvbiB5dChlLHQpe3JldHVybiB0LnB0clR5cGUmJnQucHRyfHxMZSgibWFrZUNsYXNzSGFuZGxlIHJlcXVpcmVzIHB0ciBhbmQgcHRyVHlwZSIpLCEhdC5zbWFydFB0clR5cGUhPT0hIXQuc21hcnRQdHImJkxlKCJCb3RoIHNtYXJ0UHRyVHlwZSBhbmQgc21hcnRQdHIgbXVzdCBiZSBzcGVjaWZpZWQiKSx0LmNvdW50PXt2YWx1ZToxfSxPYmplY3QuY3JlYXRlKGUseyQkOnt2YWx1ZTp0fX0pfWZ1bmN0aW9uIEV0KGUpe3ZhciB0PXRoaXMuZ2V0UG9pbnRlZShlKTtpZighdClyZXR1cm4gdGhpcy5kZXN0cnVjdG9yKGUpLG51bGw7dmFyIHI9bXQodGhpcy5yZWdpc3RlcmVkQ2xhc3MsdCk7aWYodm9pZCAwIT09cil7aWYoMD09PXIuJCQuY291bnQudmFsdWUpcmV0dXJuIHIuJCQucHRyPXQsci4kJC5zbWFydFB0cj1lLHIuY2xvbmUoKTt2YXIgbj1yLmNsb25lKCk7cmV0dXJuIHRoaXMuZGVzdHJ1Y3RvcihlKSxufWZ1bmN0aW9uIG8oKXtyZXR1cm4gdGhpcy5pc1NtYXJ0UG9pbnRlcj95dCh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLnBvaW50ZWVUeXBlLHB0cjp0LHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOmV9KTp5dCh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLHB0cjplfSl9dmFyIGksYT10aGlzLnJlZ2lzdGVyZWRDbGFzcy5nZXRBY3R1YWxUeXBlKHQpLHM9dHRbYV07aWYoIXMpcmV0dXJuIG8uY2FsbCh0aGlzKTtpPXRoaXMuaXNDb25zdD9zLmNvbnN0UG9pbnRlclR5cGU6cy5wb2ludGVyVHlwZTt2YXIgdT1mdW5jdGlvbiBlKHQscixuKXtpZihyPT09bilyZXR1cm4gdDtpZih2b2lkIDA9PT1uLmJhc2VDbGFzcylyZXR1cm4gbnVsbDt2YXIgbz1lKHQscixuLmJhc2VDbGFzcyk7cmV0dXJuIG51bGw9PT1vP251bGw6bi5kb3duY2FzdChvKX0odCx0aGlzLnJlZ2lzdGVyZWRDbGFzcyxpLnJlZ2lzdGVyZWRDbGFzcyk7cmV0dXJuIG51bGw9PT11P28uY2FsbCh0aGlzKTp0aGlzLmlzU21hcnRQb2ludGVyP3l0KGkucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOmkscHRyOnUsc21hcnRQdHJUeXBlOnRoaXMsc21hcnRQdHI6ZX0pOnl0KGkucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOmkscHRyOnV9KX1mdW5jdGlvbiBndChlLHQscixuLG8saSxhLHMsdSxjLGwpe3RoaXMubmFtZT1lLHRoaXMucmVnaXN0ZXJlZENsYXNzPXQsdGhpcy5pc1JlZmVyZW5jZT1yLHRoaXMuaXNDb25zdD1uLHRoaXMuaXNTbWFydFBvaW50ZXI9byx0aGlzLnBvaW50ZWVUeXBlPWksdGhpcy5zaGFyaW5nUG9saWN5PWEsdGhpcy5yYXdHZXRQb2ludGVlPXMsdGhpcy5yYXdDb25zdHJ1Y3Rvcj11LHRoaXMucmF3U2hhcmU9Yyx0aGlzLnJhd0Rlc3RydWN0b3I9bCxvfHx2b2lkIDAhPT10LmJhc2VDbGFzcz90aGlzLnRvV2lyZVR5cGU9YXQ6bj8odGhpcy50b1dpcmVUeXBlPWl0LHRoaXMuZGVzdHJ1Y3RvckZ1bmN0aW9uPW51bGwpOih0aGlzLnRvV2lyZVR5cGU9c3QsdGhpcy5kZXN0cnVjdG9yRnVuY3Rpb249bnVsbCl9ZnVuY3Rpb24gdnQoZSx0KXt2YXIgcjtpZihlPXplKGUpLHZvaWQgMCE9PW9bIkZVTkNUSU9OX1RBQkxFXyIrZV0pcj1vWyJGVU5DVElPTl9UQUJMRV8iK2VdW3RdO2Vsc2UgaWYoInVuZGVmaW5lZCIhPXR5cGVvZiBGVU5DVElPTl9UQUJMRSlyPUZVTkNUSU9OX1RBQkxFW3RdO2Vsc2V7dmFyIG49by5hc21bImR5bkNhbGxfIitlXTt2b2lkIDA9PT1uJiZ2b2lkIDA9PT0obj1vLmFzbVsiZHluQ2FsbF8iK2UucmVwbGFjZSgvZi9nLCJkIildKSYmV2UoIk5vIGR5bkNhbGwgaW52b2tlciBmb3Igc2lnbmF0dXJlOiAiK2UpLHI9ZnVuY3Rpb24ocil7Zm9yKHZhciBuPVtdLG89MTtvPGUubGVuZ3RoOysrbyluLnB1c2goImEiK28pO3ZhciBpPSJyZXR1cm4gZnVuY3Rpb24gIisoImR5bkNhbGxfIitlKyJfIit0KSsiKCIrbi5qb2luKCIsICIpKyIpIHtcbiI7cmV0dXJuIGkrPSIgICAgcmV0dXJuIGR5bkNhbGwocmF3RnVuY3Rpb24iKyhuLmxlbmd0aD8iLCAiOiIiKStuLmpvaW4oIiwgIikrIik7XG4iLGkrPSJ9O1xuIixuZXcgRnVuY3Rpb24oImR5bkNhbGwiLCJyYXdGdW5jdGlvbiIsaSkocix0KX0obil9cmV0dXJuImZ1bmN0aW9uIiE9dHlwZW9mIHImJldlKCJ1bmtub3duIGZ1bmN0aW9uIHBvaW50ZXIgd2l0aCBzaWduYXR1cmUgIitlKyI6ICIrdCkscn12YXIgd3Q9dm9pZCAwO2Z1bmN0aW9uIF90KGUpe3ZhciB0PXF0KGUpLHI9emUodCk7cmV0dXJuIEt0KHQpLHJ9ZnVuY3Rpb24gYnQoZSx0KXt2YXIgcj1bXSxuPXt9O3Rocm93IHQuZm9yRWFjaCgoZnVuY3Rpb24gZSh0KXtuW3RdfHxDZVt0XXx8KE5lW3RdP05lW3RdLmZvckVhY2goZSk6KHIucHVzaCh0KSxuW3RdPSEwKSl9KSksbmV3IHd0KGUrIjogIityLm1hcChfdCkuam9pbihbIiwgIl0pKX1mdW5jdGlvbiBBdChlLHQpe2Zvcih2YXIgcj1bXSxuPTA7bjxlO24rKylyLnB1c2goRlsodD4+Mikrbl0pO3JldHVybiByfWZ1bmN0aW9uIFR0KGUsdCxyLG4sbyl7dmFyIGk9dC5sZW5ndGg7aTwyJiZXZSgiYXJnVHlwZXMgYXJyYXkgc2l6ZSBtaXNtYXRjaCEgTXVzdCBhdCBsZWFzdCBnZXQgcmV0dXJuIHZhbHVlIGFuZCAndGhpcycgdHlwZXMhIik7Zm9yKHZhciBhPW51bGwhPT10WzFdJiZudWxsIT09cixzPSExLHU9MTt1PHQubGVuZ3RoOysrdSlpZihudWxsIT09dFt1XSYmdm9pZCAwPT09dFt1XS5kZXN0cnVjdG9yRnVuY3Rpb24pe3M9ITA7YnJlYWt9dmFyIGM9InZvaWQiIT09dFswXS5uYW1lLGw9IiIsZj0iIjtmb3IodT0wO3U8aS0yOysrdSlsKz0oMCE9PXU/IiwgIjoiIikrImFyZyIrdSxmKz0oMCE9PXU/IiwgIjoiIikrImFyZyIrdSsiV2lyZWQiO3ZhciBkPSJyZXR1cm4gZnVuY3Rpb24gIitGZShlKSsiKCIrbCsiKSB7XG5pZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gIisoaS0yKSsiKSB7XG50aHJvd0JpbmRpbmdFcnJvcignZnVuY3Rpb24gIitlKyIgY2FsbGVkIHdpdGggJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIGFyZ3VtZW50cywgZXhwZWN0ZWQgIisoaS0yKSsiIGFyZ3MhJyk7XG59XG4iO3MmJihkKz0idmFyIGRlc3RydWN0b3JzID0gW107XG4iKTt2YXIgaD1zPyJkZXN0cnVjdG9ycyI6Im51bGwiLHA9WyJ0aHJvd0JpbmRpbmdFcnJvciIsImludm9rZXIiLCJmbiIsInJ1bkRlc3RydWN0b3JzIiwicmV0VHlwZSIsImNsYXNzUGFyYW0iXSxtPVtXZSxuLG8sRGUsdFswXSx0WzFdXTthJiYoZCs9InZhciB0aGlzV2lyZWQgPSBjbGFzc1BhcmFtLnRvV2lyZVR5cGUoIitoKyIsIHRoaXMpO1xuIik7Zm9yKHU9MDt1PGktMjsrK3UpZCs9InZhciBhcmciK3UrIldpcmVkID0gYXJnVHlwZSIrdSsiLnRvV2lyZVR5cGUoIitoKyIsIGFyZyIrdSsiKTsgLy8gIit0W3UrMl0ubmFtZSsiXG4iLHAucHVzaCgiYXJnVHlwZSIrdSksbS5wdXNoKHRbdSsyXSk7aWYoYSYmKGY9InRoaXNXaXJlZCIrKGYubGVuZ3RoPjA/IiwgIjoiIikrZiksZCs9KGM/InZhciBydiA9ICI6IiIpKyJpbnZva2VyKGZuIisoZi5sZW5ndGg+MD8iLCAiOiIiKStmKyIpO1xuIixzKWQrPSJydW5EZXN0cnVjdG9ycyhkZXN0cnVjdG9ycyk7XG4iO2Vsc2UgZm9yKHU9YT8xOjI7dTx0Lmxlbmd0aDsrK3Upe3ZhciB5PTE9PT11PyJ0aGlzV2lyZWQiOiJhcmciKyh1LTIpKyJXaXJlZCI7bnVsbCE9PXRbdV0uZGVzdHJ1Y3RvckZ1bmN0aW9uJiYoZCs9eSsiX2R0b3IoIit5KyIpOyAvLyAiK3RbdV0ubmFtZSsiXG4iLHAucHVzaCh5KyJfZHRvciIpLG0ucHVzaCh0W3VdLmRlc3RydWN0b3JGdW5jdGlvbikpfXJldHVybiBjJiYoZCs9InZhciByZXQgPSByZXRUeXBlLmZyb21XaXJlVHlwZShydik7XG5yZXR1cm4gcmV0O1xuIiksZCs9In1cbiIscC5wdXNoKGQpLGZ1bmN0aW9uKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgRnVuY3Rpb24pKXRocm93IG5ldyBUeXBlRXJyb3IoIm5ld18gY2FsbGVkIHdpdGggY29uc3RydWN0b3IgdHlwZSAiK3R5cGVvZiBlKyIgd2hpY2ggaXMgbm90IGEgZnVuY3Rpb24iKTt2YXIgcj1NZShlLm5hbWV8fCJ1bmtub3duRnVuY3Rpb25OYW1lIiwoZnVuY3Rpb24oKXt9KSk7ci5wcm90b3R5cGU9ZS5wcm90b3R5cGU7dmFyIG49bmV3IHIsbz1lLmFwcGx5KG4sdCk7cmV0dXJuIG8gaW5zdGFuY2VvZiBPYmplY3Q/bzpufShGdW5jdGlvbixwKS5hcHBseShudWxsLG0pfXZhciBTdD1bXSxrdD1be30se3ZhbHVlOnZvaWQgMH0se3ZhbHVlOm51bGx9LHt2YWx1ZTohMH0se3ZhbHVlOiExfV07ZnVuY3Rpb24gUHQoKXtmb3IodmFyIGU9MCx0PTU7dDxrdC5sZW5ndGg7Kyt0KXZvaWQgMCE9PWt0W3RdJiYrK2U7cmV0dXJuIGV9ZnVuY3Rpb24gRHQoKXtmb3IodmFyIGU9NTtlPGt0Lmxlbmd0aDsrK2UpaWYodm9pZCAwIT09a3RbZV0pcmV0dXJuIGt0W2VdO3JldHVybiBudWxsfWZ1bmN0aW9uIFJ0KGUpe3N3aXRjaChlKXtjYXNlIHZvaWQgMDpyZXR1cm4gMTtjYXNlIG51bGw6cmV0dXJuIDI7Y2FzZSEwOnJldHVybiAzO2Nhc2UhMTpyZXR1cm4gNDtkZWZhdWx0OnZhciB0PVN0Lmxlbmd0aD9TdC5wb3AoKTprdC5sZW5ndGg7cmV0dXJuIGt0W3RdPXtyZWZjb3VudDoxLHZhbHVlOmV9LHR9fWZ1bmN0aW9uIE90KGUpe2lmKG51bGw9PT1lKXJldHVybiJudWxsIjt2YXIgdD10eXBlb2YgZTtyZXR1cm4ib2JqZWN0Ij09PXR8fCJhcnJheSI9PT10fHwiZnVuY3Rpb24iPT09dD9lLnRvU3RyaW5nKCk6IiIrZX1mdW5jdGlvbiBDdChlLHQpe3N3aXRjaCh0KXtjYXNlIDI6cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShJW2U+PjJdKX07Y2FzZSAzOnJldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoQltlPj4zXSl9O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBmbG9hdCB0eXBlOiAiK2UpfX1mdW5jdGlvbiBOdChlLHQscil7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gUltlXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE9bZV19O2Nhc2UgMTpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gQ1tlPj4xXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE5bZT4+MV19O2Nhc2UgMjpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gRltlPj4yXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE1bZT4+Ml19O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBpbnRlZ2VyIHR5cGU6ICIrZSl9fXZhciBGdD1MKz0xNjt2YXIgTXQ9e307dmFyIEl0PUwrPTE2O0wrPTQ4O2coJHQoIkdNVCIpLCJpOCIsMik7dmFyIEJ0PUwsTHQ9TCs9MTYseHQ9TCs9MTY7ZnVuY3Rpb24ganQoKXtpZighanQuY2FsbGVkKXtqdC5jYWxsZWQ9ITAsRlt4dD4+Ml09NjAqKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpO3ZhciBlPW5ldyBEYXRlKDJlMywwLDEpLHQ9bmV3IERhdGUoMmUzLDYsMSk7RltMdD4+Ml09TnVtYmVyKGUuZ2V0VGltZXpvbmVPZmZzZXQoKSE9dC5nZXRUaW1lem9uZU9mZnNldCgpKTt2YXIgcj1hKGUpLG49YSh0KSxvPWcoJHQociksImk4IiwwKSxpPWcoJHQobiksImk4IiwwKTt0LmdldFRpbWV6b25lT2Zmc2V0KCk8ZS5nZXRUaW1lem9uZU9mZnNldCgpPyhGW0J0Pj4yXT1vLEZbQnQrND4+Ml09aSk6KEZbQnQ+PjJdPWksRltCdCs0Pj4yXT1vKX1mdW5jdGlvbiBhKGUpe3ZhciB0PWUudG9UaW1lU3RyaW5nKCkubWF0Y2goL1woKFtBLVphLXogXSspXCkkLyk7cmV0dXJuIHQ/dFsxXToiR01UIn19TCs9MTY7dmFyIFV0PXt9O3ZhciB6dD0xO2Z1bmN0aW9uICR0KGUsdCxyKXt2YXIgbj1yPjA/cjpTKGUpKzEsbz1uZXcgQXJyYXkobiksaT1BKGUsbywwLG8ubGVuZ3RoKTtyZXR1cm4gdCYmKG8ubGVuZ3RoPWkpLG99VGUuc3RhdGljSW5pdCgpLEoudW5zaGlmdCgoZnVuY3Rpb24oKXtvLm5vRlNJbml0fHxUZS5pbml0LmluaXRpYWxpemVkfHxUZS5pbml0KCl9KSksWi5wdXNoKChmdW5jdGlvbigpe1RlLmlnbm9yZVBlcm1pc3Npb25zPSExfSkpLFEucHVzaCgoZnVuY3Rpb24oKXtUZS5xdWl0KCl9KSksSi51bnNoaWZ0KChmdW5jdGlvbigpe3ZlLmluaXQoKX0pKSxRLnB1c2goKGZ1bmN0aW9uKCl7dmUuc2h1dGRvd24oKX0pKSxCZT1vLkludGVybmFsRXJyb3I9SWUoRXJyb3IsIkludGVybmFsRXJyb3IiKSxmdW5jdGlvbigpe2Zvcih2YXIgZT1uZXcgQXJyYXkoMjU2KSx0PTA7dDwyNTY7Kyt0KWVbdF09U3RyaW5nLmZyb21DaGFyQ29kZSh0KTtVZT1lfSgpLCRlPW8uQmluZGluZ0Vycm9yPUllKEVycm9yLCJCaW5kaW5nRXJyb3IiKSxldC5wcm90b3R5cGUuaXNBbGlhc09mPVZlLGV0LnByb3RvdHlwZS5jbG9uZT1HZSxldC5wcm90b3R5cGUuZGVsZXRlPXFlLGV0LnByb3RvdHlwZS5pc0RlbGV0ZWQ9WGUsZXQucHJvdG90eXBlLmRlbGV0ZUxhdGVyPVFlLGd0LnByb3RvdHlwZS5nZXRQb2ludGVlPXV0LGd0LnByb3RvdHlwZS5kZXN0cnVjdG9yPWN0LGd0LnByb3RvdHlwZS5hcmdQYWNrQWR2YW5jZT04LGd0LnByb3RvdHlwZS5yZWFkVmFsdWVGcm9tUG9pbnRlcj1SZSxndC5wcm90b3R5cGUuZGVsZXRlT2JqZWN0PWx0LGd0LnByb3RvdHlwZS5mcm9tV2lyZVR5cGU9RXQsby5nZXRJbmhlcml0ZWRJbnN0YW5jZUNvdW50PWZ0LG8uZ2V0TGl2ZUluaGVyaXRlZEluc3RhbmNlcz1kdCxvLmZsdXNoUGVuZGluZ0RlbGV0ZXM9WmUsby5zZXREZWxheUZ1bmN0aW9uPWh0LHd0PW8uVW5ib3VuZFR5cGVFcnJvcj1JZShFcnJvciwiVW5ib3VuZFR5cGVFcnJvciIpLG8uY291bnRfZW12YWxfaGFuZGxlcz1QdCxvLmdldF9maXJzdF9lbXZhbD1EdCxmdW5jdGlvbiBlKHQpe3ZhciByLG47ZS5jYWxsZWQ/KG49RltGdD4+Ml0scj1GW24+PjJdKTooZS5jYWxsZWQ9ITAsTXQuVVNFUj1NdC5MT0dOQU1FPSJ3ZWJfdXNlciIsTXQuUEFUSD0iLyIsTXQuUFdEPSIvIixNdC5IT01FPSIvaG9tZS93ZWJfdXNlciIsTXQuTEFORz0iQy5VVEYtOCIsTXQuXz1vLnRoaXNQcm9ncmFtLHI9ZigxMDI0KSxuPWYoMjU2KSxGW24+PjJdPXIsRltGdD4+Ml09bik7dmFyIGk9W10sYT0wO2Zvcih2YXIgcyBpbiB0KWlmKCJzdHJpbmciPT10eXBlb2YgdFtzXSl7dmFyIHU9cysiPSIrdFtzXTtpLnB1c2godSksYSs9dS5sZW5ndGh9aWYoYT4xMDI0KXRocm93IG5ldyBFcnJvcigiRW52aXJvbm1lbnQgc2l6ZSBleGNlZWRlZCBUT1RBTF9FTlZfU0laRSEiKTtmb3IodmFyIGM9MDtjPGkubGVuZ3RoO2MrKyl7cmUodT1pW2NdLHIpLEZbbis0KmM+PjJdPXIscis9dS5sZW5ndGgrMX1GW24rNCppLmxlbmd0aD4+Ml09MH0oTXQpLCQ9Zig0KSxqPVU9aChMKSx6PWgoaitHKSxGWyQ+PjJdPXoseD0hMCxvLndhc21UYWJsZVNpemU9MzE2LG8ud2FzbU1heFRhYmxlU2l6ZT0zMTYsby5hc21HbG9iYWxBcmc9e30sby5hc21MaWJyYXJ5QXJnPXthYm9ydDpycixlbmxhcmdlTWVtb3J5OkgsZ2V0VG90YWxNZW1vcnk6ZnVuY3Rpb24oKXtyZXR1cm4gcX0sYWJvcnRPbkNhbm5vdEdyb3dNZW1vcnk6ZnVuY3Rpb24oKXtycigiQ2Fubm90IGVubGFyZ2UgbWVtb3J5IGFycmF5cy4gRWl0aGVyICgxKSBjb21waWxlIHdpdGggIC1zIFRPVEFMX01FTU9SWT1YICB3aXRoIFggaGlnaGVyIHRoYW4gdGhlIGN1cnJlbnQgdmFsdWUgIitxKyIsICgyKSBjb21waWxlIHdpdGggIC1zIEFMTE9XX01FTU9SWV9HUk9XVEg9MSAgd2hpY2ggYWxsb3dzIGluY3JlYXNpbmcgdGhlIHNpemUgYXQgcnVudGltZSwgb3IgKDMpIGlmIHlvdSB3YW50IG1hbGxvYyB0byByZXR1cm4gTlVMTCAoMCkgaW5zdGVhZCBvZiB0aGlzIGFib3J0LCBjb21waWxlIHdpdGggIC1zIEFCT1JUSU5HX01BTExPQz0wICIpfSxpbnZva2VfaTpmdW5jdGlvbihlKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9pKGUpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paTpmdW5jdGlvbihlLHQpe3RyeXtyZXR1cm4gby5keW5DYWxsX2lpKGUsdCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX2lpaTpmdW5jdGlvbihlLHQscil7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpKGUsdCxyKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfaWlpaTpmdW5jdGlvbihlLHQscixuKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9paWlpKGUsdCxyLG4pfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paWlpaTpmdW5jdGlvbihlLHQscixuLGkpe3RyeXtyZXR1cm4gby5keW5DYWxsX2lpaWlpKGUsdCxyLG4saSl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX2lpaWlpaWk6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyl7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpaWlpaShlLHQscixuLGksYSxzKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfaWlpaWlpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSxzLHUsYyxsKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9paWlpaWlpaWlpKGUsdCxyLG4saSxhLHMsdSxjLGwpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paWlpaWlqaWk6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyx1LGMsbCl7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpaWlpamlpKGUsdCxyLG4saSxhLHMsdSxjLGwpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9pamo6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9pamooZSx0LHIsbixpKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2Vfamk6ZnVuY3Rpb24oZSx0KXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9qaShlLHQpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92OmZ1bmN0aW9uKGUpe3RyeXtvLmR5bkNhbGxfdihlKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2Vfdmk6ZnVuY3Rpb24oZSx0KXt0cnl7by5keW5DYWxsX3ZpKGUsdCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaTpmdW5jdGlvbihlLHQscil7dHJ5e28uZHluQ2FsbF92aWkoZSx0LHIpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWlpOmZ1bmN0aW9uKGUsdCxyLG4pe3RyeXtvLmR5bkNhbGxfdmlpaShlLHQscixuKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfdmlpaWk6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7by5keW5DYWxsX3ZpaWlpKGUsdCxyLG4saSl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSl7dHJ5e28uZHluQ2FsbF92aWlpaWkoZSx0LHIsbixpLGEpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWlpaWlpOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMpe3RyeXtvLmR5bkNhbGxfdmlpaWlpaShlLHQscixuLGksYSxzKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfdmlpaWlpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSxzLHUsYyxsKXt0cnl7by5keW5DYWxsX3ZpaWlpaWlpaWkoZSx0LHIsbixpLGEscyx1LGMsbCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaWlpaWlpaWlpOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMsdSxjLGwsZil7dHJ5e28uZHluQ2FsbF92aWlpaWlpaWlpaShlLHQscixuLGksYSxzLHUsYyxsLGYpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWo6ZnVuY3Rpb24oZSx0LHIsbil7dHJ5e28uZHluQ2FsbF92aWooZSx0LHIsbil9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3Zpamk6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7by5keW5DYWxsX3ZpamkoZSx0LHIsbixpKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxfX19jeGFfYWxsb2NhdGVfZXhjZXB0aW9uOmZ1bmN0aW9uKGUpe3JldHVybiBKdChlKX0sX19fY3hhX2JlZ2luX2NhdGNoOmZ1bmN0aW9uKGUpe3ZhciB0PWRlLmluZm9zW2VdO3JldHVybiB0JiYhdC5jYXVnaHQmJih0LmNhdWdodD0hMCksdCYmKHQucmV0aHJvd249ITEpLGRlLmNhdWdodC5wdXNoKGUpLGRlLmFkZFJlZihkZS5kZUFkanVzdChlKSksZX0sX19fY3hhX2VuZF9jYXRjaDpmdW5jdGlvbigpe28uc2V0VGhyZXcoMCk7dmFyIGU9ZGUuY2F1Z2h0LnBvcCgpO2UmJihkZS5kZWNSZWYoZGUuZGVBZGp1c3QoZSkpLGRlLmxhc3Q9MCl9LF9fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoXzI6ZnVuY3Rpb24oKXtyZXR1cm4gcGUuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8zOmZ1bmN0aW9uKCl7cmV0dXJuIHBlLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2hfNDpmdW5jdGlvbigpe3JldHVybiBwZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9fX2N4YV9mcmVlX2V4Y2VwdGlvbjpoZSxfX19jeGFfdGhyb3c6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IGRlLmluZm9zW2VdPXtwdHI6ZSxhZGp1c3RlZDplLHR5cGU6dCxkZXN0cnVjdG9yOnIscmVmY291bnQ6MCxjYXVnaHQ6ITEscmV0aHJvd246ITF9LGRlLmxhc3Q9ZSxlfSxfX19sb2NrOmZ1bmN0aW9uKCl7fSxfX19tYXBfZmlsZTpmdW5jdGlvbihlLHQpe3JldHVybiB5ZShtZS5FUEVSTSksLTF9LF9fX3Jlc3VtZUV4Y2VwdGlvbjpmdW5jdGlvbihlKXt0aHJvdyBkZS5sYXN0fHwoZGUubGFzdD1lKSxlfSxfX19zZXRFcnJObzp5ZSxfX19zeXNjYWxsMTQwOmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHJlYW1Gcm9tRkQoKSxuPShTZS5nZXQoKSxTZS5nZXQoKSksbz1TZS5nZXQoKSxpPVNlLmdldCgpLGE9bjtyZXR1cm4gVGUubGxzZWVrKHIsYSxpKSxGW28+PjJdPXIucG9zaXRpb24sci5nZXRkZW50cyYmMD09PWEmJjA9PT1pJiYoci5nZXRkZW50cz1udWxsKSwwfWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDE0NTpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0U3RyZWFtRnJvbUZEKCksbj1TZS5nZXQoKSxvPVNlLmdldCgpO3JldHVybiBTZS5kb1JlYWR2KHIsbixvKX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGwxNDY6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3ZhciByPVNlLmdldFN0cmVhbUZyb21GRCgpLG49U2UuZ2V0KCksbz1TZS5nZXQoKTtyZXR1cm4gU2UuZG9Xcml0ZXYocixuLG8pfWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDE4MzpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS5nZXQoKTtpZigwPT09bilyZXR1cm4tbWUuRUlOVkFMO3ZhciBvPVRlLmN3ZCgpO3JldHVybiBuPFMobykrMT8tbWUuRVJBTkdFOihUKG8scixuKSxyKX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGwxOTg6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3ZhciByPVNlLmdldFN0cigpLG49U2UuZ2V0KCksbz1TZS5nZXQoKTtyZXR1cm4gVGUuY2hvd24ocixuLG8pLDB9Y2F0Y2goZSl7cmV0dXJuIHZvaWQgMCE9PVRlJiZlIGluc3RhbmNlb2YgVGUuRXJybm9FcnJvcnx8cnIoZSksLWUuZXJybm99fSxfX19zeXNjYWxsMjA6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3JldHVybiBrZX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw2OmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHJlYW1Gcm9tRkQoKTtyZXR1cm4gVGUuY2xvc2UociksMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw2MDpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS51bWFzaztyZXR1cm4gU2UudW1hc2s9cixufWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDgzOmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHIoKSxuPVNlLmdldFN0cigpO3JldHVybiBUZS5zeW1saW5rKHIsbiksMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw5MTpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS5nZXQoKSxvPVNlLm1hcHBpbmdzW3JdO2lmKCFvKXJldHVybiAwO2lmKG49PT1vLmxlbil7dmFyIGk9VGUuZ2V0U3RyZWFtKG8uZmQpO1NlLmRvTXN5bmMocixpLG4sby5mbGFncyksVGUubXVubWFwKGkpLFNlLm1hcHBpbmdzW3JdPW51bGwsby5hbGxvY2F0ZWQmJkt0KG8ubWFsbG9jKX1yZXR1cm4gMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3VubG9jazpmdW5jdGlvbigpe30sX19lbWJpbmRfZmluYWxpemVfdmFsdWVfb2JqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0PVBlW2VdO2RlbGV0ZSBQZVtlXTt2YXIgcj10LnJhd0NvbnN0cnVjdG9yLG49dC5yYXdEZXN0cnVjdG9yLG89dC5maWVsZHM7eGUoW2VdLG8ubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gZS5nZXR0ZXJSZXR1cm5UeXBlfSkpLmNvbmNhdChvLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUuc2V0dGVyQXJndW1lbnRUeXBlfSkpKSwoZnVuY3Rpb24oZSl7dmFyIGk9e307cmV0dXJuIG8uZm9yRWFjaCgoZnVuY3Rpb24odCxyKXt2YXIgbj10LmZpZWxkTmFtZSxhPWVbcl0scz10LmdldHRlcix1PXQuZ2V0dGVyQ29udGV4dCxjPWVbcitvLmxlbmd0aF0sbD10LnNldHRlcixmPXQuc2V0dGVyQ29udGV4dDtpW25dPXtyZWFkOmZ1bmN0aW9uKGUpe3JldHVybiBhLmZyb21XaXJlVHlwZShzKHUsZSkpfSx3cml0ZTpmdW5jdGlvbihlLHQpe3ZhciByPVtdO2woZixlLGMudG9XaXJlVHlwZShyLHQpKSxEZShyKX19fSkpLFt7bmFtZTp0Lm5hbWUsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3ZhciB0PXt9O2Zvcih2YXIgciBpbiBpKXRbcl09aVtyXS5yZWFkKGUpO3JldHVybiBuKGUpLHR9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG8gaW4gaSlpZighKG8gaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiTWlzc2luZyBmaWVsZCIpO3ZhciBhPXIoKTtmb3IobyBpbiBpKWlbb10ud3JpdGUoYSx0W29dKTtyZXR1cm4gbnVsbCE9PWUmJmUucHVzaChuLGEpLGF9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6UmUsZGVzdHJ1Y3RvckZ1bmN0aW9uOm59XX0pKX0sX19lbWJpbmRfcmVnaXN0ZXJfYm9vbDpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWplKHIpO1llKGUse25hbWU6dD16ZSh0KSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7cmV0dXJuISFlfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQ/bjpvfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOmZ1bmN0aW9uKGUpe3ZhciBuO2lmKDE9PT1yKW49UjtlbHNlIGlmKDI9PT1yKW49QztlbHNle2lmKDQhPT1yKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gYm9vbGVhbiB0eXBlIHNpemU6ICIrdCk7bj1GfXJldHVybiB0aGlzLmZyb21XaXJlVHlwZShuW2U+PmldKX0sZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX0sX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3M6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyx1LGMsbCxmLGQsaCl7Zj16ZShmKSxhPXZ0KGksYSksdSYmKHU9dnQocyx1KSksbCYmKGw9dnQoYyxsKSksaD12dChkLGgpO3ZhciBwPUZlKGYpOyFmdW5jdGlvbihlLHQscil7by5oYXNPd25Qcm9wZXJ0eShlKT8oKHZvaWQgMD09PXJ8fHZvaWQgMCE9PW9bZV0ub3ZlcmxvYWRUYWJsZSYmdm9pZCAwIT09b1tlXS5vdmVybG9hZFRhYmxlW3JdKSYmV2UoIkNhbm5vdCByZWdpc3RlciBwdWJsaWMgbmFtZSAnIitlKyInIHR3aWNlIikscnQobyxlLGUpLG8uaGFzT3duUHJvcGVydHkocikmJldlKCJDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgb3ZlcmxvYWRzIG9mIGEgZnVuY3Rpb24gd2l0aCB0aGUgc2FtZSBudW1iZXIgb2YgYXJndW1lbnRzICgiK3IrIikhIiksb1tlXS5vdmVybG9hZFRhYmxlW3JdPXQpOihvW2VdPXQsdm9pZCAwIT09ciYmKG9bZV0ubnVtQXJndW1lbnRzPXIpKX0ocCwoZnVuY3Rpb24oKXtidCgiQ2Fubm90IGNvbnN0cnVjdCAiK2YrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsW25dKX0pKSx4ZShbZSx0LHJdLG4/W25dOltdLChmdW5jdGlvbih0KXt2YXIgcixpO3Q9dFswXSxpPW4/KHI9dC5yZWdpc3RlcmVkQ2xhc3MpLmluc3RhbmNlUHJvdG90eXBlOmV0LnByb3RvdHlwZTt2YXIgcz1NZShwLChmdW5jdGlvbigpe2lmKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSE9PWMpdGhyb3cgbmV3ICRlKCJVc2UgJ25ldycgdG8gY29uc3RydWN0ICIrZik7aWYodm9pZCAwPT09ZC5jb25zdHJ1Y3Rvcl9ib2R5KXRocm93IG5ldyAkZShmKyIgaGFzIG5vIGFjY2Vzc2libGUgY29uc3RydWN0b3IiKTt2YXIgZT1kLmNvbnN0cnVjdG9yX2JvZHlbYXJndW1lbnRzLmxlbmd0aF07aWYodm9pZCAwPT09ZSl0aHJvdyBuZXcgJGUoIlRyaWVkIHRvIGludm9rZSBjdG9yIG9mICIrZisiIHdpdGggaW52YWxpZCBudW1iZXIgb2YgcGFyYW1ldGVycyAoIithcmd1bWVudHMubGVuZ3RoKyIpIC0gZXhwZWN0ZWQgKCIrT2JqZWN0LmtleXMoZC5jb25zdHJ1Y3Rvcl9ib2R5KS50b1N0cmluZygpKyIpIHBhcmFtZXRlcnMgaW5zdGVhZCEiKTtyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSksYz1PYmplY3QuY3JlYXRlKGkse2NvbnN0cnVjdG9yOnt2YWx1ZTpzfX0pO3MucHJvdG90eXBlPWM7dmFyIGQ9bmV3IG50KGYscyxjLGgscixhLHUsbCksbT1uZXcgZ3QoZixkLCEwLCExLCExKSx5PW5ldyBndChmKyIqIixkLCExLCExLCExKSxFPW5ldyBndChmKyIgY29uc3QqIixkLCExLCEwLCExKTtyZXR1cm4gdHRbZV09e3BvaW50ZXJUeXBlOnksY29uc3RQb2ludGVyVHlwZTpFfSxmdW5jdGlvbihlLHQscil7by5oYXNPd25Qcm9wZXJ0eShlKXx8TGUoIlJlcGxhY2luZyBub25leGlzdGFudCBwdWJsaWMgc3ltYm9sIiksdm9pZCAwIT09b1tlXS5vdmVybG9hZFRhYmxlJiZ2b2lkIDAhPT1yP29bZV0ub3ZlcmxvYWRUYWJsZVtyXT10OihvW2VdPXQsb1tlXS5hcmdDb3VudD1yKX0ocCxzKSxbbSx5LEVdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19jb25zdHJ1Y3RvcjpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9QXQodCxyKTtvPXZ0KG4sbykseGUoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgcj0iY29uc3RydWN0b3IgIisoZT1lWzBdKS5uYW1lO2lmKHZvaWQgMD09PWUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHkmJihlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5PVtdKSx2b2lkIDAhPT1lLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W3QtMV0pdGhyb3cgbmV3ICRlKCJDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgY29uc3RydWN0b3JzIHdpdGggaWRlbnRpY2FsIG51bWJlciBvZiBwYXJhbWV0ZXJzICgiKyh0LTEpKyIpIGZvciBjbGFzcyAnIitlLm5hbWUrIichIE92ZXJsb2FkIHJlc29sdXRpb24gaXMgY3VycmVudGx5IG9ubHkgcGVyZm9ybWVkIHVzaW5nIHRoZSBwYXJhbWV0ZXIgY291bnQsIG5vdCBhY3R1YWwgdHlwZSBpbmZvISIpO3JldHVybiBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W3QtMV09ZnVuY3Rpb24oKXtidCgiQ2Fubm90IGNvbnN0cnVjdCAiK2UubmFtZSsiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixhKX0seGUoW10sYSwoZnVuY3Rpb24obil7cmV0dXJuIGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXT1mdW5jdGlvbigpe2FyZ3VtZW50cy5sZW5ndGghPT10LTEmJldlKHIrIiBjYWxsZWQgd2l0aCAiK2FyZ3VtZW50cy5sZW5ndGgrIiBhcmd1bWVudHMsIGV4cGVjdGVkICIrKHQtMSkpO3ZhciBlPVtdLGE9bmV3IEFycmF5KHQpO2FbMF09aTtmb3IodmFyIHM9MTtzPHQ7KytzKWFbc109bltzXS50b1dpcmVUeXBlKGUsYXJndW1lbnRzW3MtMV0pO3ZhciB1PW8uYXBwbHkobnVsbCxhKTtyZXR1cm4gRGUoZSksblswXS5mcm9tV2lyZVR5cGUodSl9LFtdfSkpLFtdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19mdW5jdGlvbjpmdW5jdGlvbihlLHQscixuLG8saSxhLHMpe3ZhciB1PUF0KHIsbik7dD16ZSh0KSxpPXZ0KG8saSkseGUoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgbj0oZT1lWzBdKS5uYW1lKyIuIit0O2Z1bmN0aW9uIG8oKXtidCgiQ2Fubm90IGNhbGwgIituKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLHUpfXMmJmUucmVnaXN0ZXJlZENsYXNzLnB1cmVWaXJ0dWFsRnVuY3Rpb25zLnB1c2godCk7dmFyIGM9ZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsbD1jW3RdO3JldHVybiB2b2lkIDA9PT1sfHx2b2lkIDA9PT1sLm92ZXJsb2FkVGFibGUmJmwuY2xhc3NOYW1lIT09ZS5uYW1lJiZsLmFyZ0NvdW50PT09ci0yPyhvLmFyZ0NvdW50PXItMixvLmNsYXNzTmFtZT1lLm5hbWUsY1t0XT1vKToocnQoYyx0LG4pLGNbdF0ub3ZlcmxvYWRUYWJsZVtyLTJdPW8pLHhlKFtdLHUsKGZ1bmN0aW9uKG8pe3ZhciBzPVR0KG4sbyxlLGksYSk7cmV0dXJuIHZvaWQgMD09PWNbdF0ub3ZlcmxvYWRUYWJsZT8ocy5hcmdDb3VudD1yLTIsY1t0XT1zKTpjW3RdLm92ZXJsb2FkVGFibGVbci0yXT1zLFtdfSkpLFtdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9lbXZhbDpmdW5jdGlvbihlLHQpe1llKGUse25hbWU6dD16ZSh0KSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7dmFyIHQ9a3RbZV0udmFsdWU7cmV0dXJuIGZ1bmN0aW9uKGUpe2U+NCYmMD09LS1rdFtlXS5yZWZjb3VudCYmKGt0W2VdPXZvaWQgMCxTdC5wdXNoKGUpKX0oZSksdH0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe3JldHVybiBSdCh0KX0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpSZSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9mbG9hdDpmdW5jdGlvbihlLHQscil7dmFyIG49amUocik7WWUoZSx7bmFtZTp0PXplKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4gZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe2lmKCJudW1iZXIiIT10eXBlb2YgdCYmImJvb2xlYW4iIT10eXBlb2YgdCl0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCAiJytPdCh0KSsnIiB0byAnK3RoaXMubmFtZSk7cmV0dXJuIHR9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6Q3QodCxuKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9pbnRlZ2VyOmZ1bmN0aW9uKGUsdCxyLG4sbyl7dD16ZSh0KSwtMT09PW8mJihvPTQyOTQ5NjcyOTUpO3ZhciBpPWplKHIpLGE9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9O2lmKDA9PT1uKXt2YXIgcz0zMi04KnI7YT1mdW5jdGlvbihlKXtyZXR1cm4gZTw8cz4+PnN9fXZhciB1PS0xIT10LmluZGV4T2YoInVuc2lnbmVkIik7WWUoZSx7bmFtZTp0LGZyb21XaXJlVHlwZTphLHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSxyKXtpZigibnVtYmVyIiE9dHlwZW9mIHImJiJib29sZWFuIiE9dHlwZW9mIHIpdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgIicrT3QocikrJyIgdG8gJyt0aGlzLm5hbWUpO2lmKHI8bnx8cj5vKXRocm93IG5ldyBUeXBlRXJyb3IoJ1Bhc3NpbmcgYSBudW1iZXIgIicrT3QocikrJyIgZnJvbSBKUyBzaWRlIHRvIEMvQysrIHNpZGUgdG8gYW4gYXJndW1lbnQgb2YgdHlwZSAiJyt0KyciLCB3aGljaCBpcyBvdXRzaWRlIHRoZSB2YWxpZCByYW5nZSBbJytuKyIsICIrbysiXSEiKTtyZXR1cm4gdT9yPj4+MDowfHJ9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6TnQodCxpLDAhPT1uKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9tZW1vcnlfdmlldzpmdW5jdGlvbihlLHQscil7dmFyIG49W0ludDhBcnJheSxVaW50OEFycmF5LEludDE2QXJyYXksVWludDE2QXJyYXksSW50MzJBcnJheSxVaW50MzJBcnJheSxGbG9hdDMyQXJyYXksRmxvYXQ2NEFycmF5XVt0XTtmdW5jdGlvbiBvKGUpe3ZhciB0PU0scj10W2U+Pj0yXSxvPXRbZSsxXTtyZXR1cm4gbmV3IG4odC5idWZmZXIsbyxyKX1ZZShlLHtuYW1lOnI9emUociksZnJvbVdpcmVUeXBlOm8sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpvfSx7aWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9uczohMH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nOmZ1bmN0aW9uKGUsdCl7WWUoZSx7bmFtZTp0PXplKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9TVtlPj4yXSxyPW5ldyBBcnJheSh0KSxuPTA7bjx0OysrbilyW25dPVN0cmluZy5mcm9tQ2hhckNvZGUoT1tlKzQrbl0pO3JldHVybiBLdChlKSxyLmpvaW4oIiIpfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gcihlLHQpe3JldHVybiBlW3RdfXZhciBuO3QgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHQ9bmV3IFVpbnQ4QXJyYXkodCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5fHx0IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXk/bj1yOiJzdHJpbmciPT10eXBlb2YgdD9uPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuY2hhckNvZGVBdCh0KX06V2UoIkNhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gc3RkOjpzdHJpbmciKTt2YXIgbz10Lmxlbmd0aCxpPUp0KDQrbyk7TVtpPj4yXT1vO2Zvcih2YXIgYT0wO2E8bzsrK2Epe3ZhciBzPW4odCxhKTtzPjI1NSYmKEt0KGkpLFdlKCJTdHJpbmcgaGFzIFVURi0xNiBjb2RlIHVuaXRzIHRoYXQgZG8gbm90IGZpdCBpbiA4IGJpdHMiKSksT1tpKzQrYV09c31yZXR1cm4gbnVsbCE9PWUmJmUucHVzaChLdCxpKSxpfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOlJlLGRlc3RydWN0b3JGdW5jdGlvbjpmdW5jdGlvbihlKXtLdChlKX19KX0sX19lbWJpbmRfcmVnaXN0ZXJfc3RkX3dzdHJpbmc6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuLG87cj16ZShyKSwyPT09dD8obj1mdW5jdGlvbigpe3JldHVybiBOfSxvPTEpOjQ9PT10JiYobj1mdW5jdGlvbigpe3JldHVybiBNfSxvPTIpLFllKGUse25hbWU6cixmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW4oKSxyPU1bZT4+Ml0saT1uZXcgQXJyYXkociksYT1lKzQ+Pm8scz0wO3M8cjsrK3MpaVtzXT1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbYStzXSk7cmV0dXJuIEt0KGUpLGkuam9pbigiIil9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSxyKXt2YXIgaT1uKCksYT1yLmxlbmd0aCxzPUp0KDQrYSp0KTtNW3M+PjJdPWE7Zm9yKHZhciB1PXMrND4+byxjPTA7YzxhOysrYylpW3UrY109ci5jaGFyQ29kZUF0KGMpO3JldHVybiBudWxsIT09ZSYmZS5wdXNoKEt0LHMpLHN9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6UmUsZGVzdHJ1Y3RvckZ1bmN0aW9uOmZ1bmN0aW9uKGUpe0t0KGUpfX0pfSxfX2VtYmluZF9yZWdpc3Rlcl92YWx1ZV9vYmplY3Q6ZnVuY3Rpb24oZSx0LHIsbixvLGkpe1BlW2VdPXtuYW1lOnplKHQpLHJhd0NvbnN0cnVjdG9yOnZ0KHIsbikscmF3RGVzdHJ1Y3Rvcjp2dChvLGkpLGZpZWxkczpbXX19LF9fZW1iaW5kX3JlZ2lzdGVyX3ZhbHVlX29iamVjdF9maWVsZDpmdW5jdGlvbihlLHQscixuLG8saSxhLHMsdSxjKXtQZVtlXS5maWVsZHMucHVzaCh7ZmllbGROYW1lOnplKHQpLGdldHRlclJldHVyblR5cGU6cixnZXR0ZXI6dnQobixvKSxnZXR0ZXJDb250ZXh0Omksc2V0dGVyQXJndW1lbnRUeXBlOmEsc2V0dGVyOnZ0KHMsdSksc2V0dGVyQ29udGV4dDpjfSl9LF9fZW1iaW5kX3JlZ2lzdGVyX3ZvaWQ6ZnVuY3Rpb24oZSx0KXtZZShlLHtpc1ZvaWQ6ITAsbmFtZTp0PXplKHQpLGFyZ1BhY2tBZHZhbmNlOjAsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKCl7fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7fX0pfSxfYWJvcnQ6ZnVuY3Rpb24oKXtvLmFib3J0KCl9LF9lbXNjcmlwdGVuX21lbWNweV9iaWc6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBPLnNldChPLnN1YmFycmF5KHQsdCtyKSxlKSxlfSxfZ2V0ZW52OmZ1bmN0aW9uIGUodCl7cmV0dXJuIDA9PT10PzA6KHQ9dih0KSxNdC5oYXNPd25Qcm9wZXJ0eSh0KT8oZS5yZXQmJkt0KGUucmV0KSxlLnJldD0ocj1NdFt0XSxuPVMocikrMSwobz1KdChuKSkmJkEocixSLG8sbiksbykpOjApO3ZhciByLG4sb30sX2dldGdybmFtOmZ1bmN0aW9uKCl7by5wcmludEVycigibWlzc2luZyBmdW5jdGlvbjogZ2V0Z3JuYW0iKSxycigtMSl9LF9nZXRwd25hbTpmdW5jdGlvbigpe3Rocm93ImdldHB3bmFtOiBUT0RPIn0sX2pzQ2xvc2U6ZnVuY3Rpb24oKXtyZXR1cm4gYS5jbG9zZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9qc0NyZWF0ZTpmdW5jdGlvbihlKXtyZXR1cm4gYS5jcmVhdGUuY2FsbChudWxsLGsoZSkpfSxfanNPcGVuOmZ1bmN0aW9uKGUpe3JldHVybiBhLm9wZW4uY2FsbChudWxsLGsoZSkpfSxfanNSZWFkOmZ1bmN0aW9uKCl7cmV0dXJuIGEucmVhZC5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9qc1NlZWs6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBhLnNlZWsuY2FsbChudWxsLGUsdCxiKHIpKX0sX2pzVGVsbDpmdW5jdGlvbigpe3JldHVybiBhLnRlbGwuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxfanNXcml0ZTpmdW5jdGlvbigpe3JldHVybiBhLndyaXRlLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sX2xsdm1fZWhfdHlwZWlkX2ZvcjpmdW5jdGlvbihlKXtyZXR1cm4gZX0sX2xvY2FsdGltZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSx0KXtqdCgpO3ZhciByPW5ldyBEYXRlKDFlMypGW2U+PjJdKTtGW3Q+PjJdPXIuZ2V0U2Vjb25kcygpLEZbdCs0Pj4yXT1yLmdldE1pbnV0ZXMoKSxGW3QrOD4+Ml09ci5nZXRIb3VycygpLEZbdCsxMj4+Ml09ci5nZXREYXRlKCksRlt0KzE2Pj4yXT1yLmdldE1vbnRoKCksRlt0KzIwPj4yXT1yLmdldEZ1bGxZZWFyKCktMTkwMCxGW3QrMjQ+PjJdPXIuZ2V0RGF5KCk7dmFyIG49bmV3IERhdGUoci5nZXRGdWxsWWVhcigpLDAsMSksbz0oci5nZXRUaW1lKCktbi5nZXRUaW1lKCkpLzg2NGU1fDA7Rlt0KzI4Pj4yXT1vLEZbdCszNj4+Ml09LTYwKnIuZ2V0VGltZXpvbmVPZmZzZXQoKTt2YXIgaT1uZXcgRGF0ZSgyZTMsNiwxKS5nZXRUaW1lem9uZU9mZnNldCgpLGE9bi5nZXRUaW1lem9uZU9mZnNldCgpLHM9MHwoaSE9YSYmci5nZXRUaW1lem9uZU9mZnNldCgpPT1NYXRoLm1pbihhLGkpKTtGW3QrMzI+PjJdPXM7dmFyIHU9RltCdCsocz80OjApPj4yXTtyZXR1cm4gRlt0KzQwPj4yXT11LHR9KGUsSXQpfSxfbWt0aW1lOmZ1bmN0aW9uKGUpe2p0KCk7dmFyIHQ9bmV3IERhdGUoRltlKzIwPj4yXSsxOTAwLEZbZSsxNj4+Ml0sRltlKzEyPj4yXSxGW2UrOD4+Ml0sRltlKzQ+PjJdLEZbZT4+Ml0sMCkscj1GW2UrMzI+PjJdLG49dC5nZXRUaW1lem9uZU9mZnNldCgpLG89bmV3IERhdGUodC5nZXRGdWxsWWVhcigpLDAsMSksaT1uZXcgRGF0ZSgyZTMsNiwxKS5nZXRUaW1lem9uZU9mZnNldCgpLGE9by5nZXRUaW1lem9uZU9mZnNldCgpLHM9TWF0aC5taW4oYSxpKTtpZihyPDApRltlKzMyPj4yXT1OdW1iZXIoaSE9YSYmcz09bik7ZWxzZSBpZihyPjAhPShzPT1uKSl7dmFyIHU9TWF0aC5tYXgoYSxpKSxjPXI+MD9zOnU7dC5zZXRUaW1lKHQuZ2V0VGltZSgpKzZlNCooYy1uKSl9RltlKzI0Pj4yXT10LmdldERheSgpO3ZhciBsPSh0LmdldFRpbWUoKS1vLmdldFRpbWUoKSkvODY0ZTV8MDtyZXR1cm4gRltlKzI4Pj4yXT1sLHQuZ2V0VGltZSgpLzFlM3wwfSxfcHRocmVhZF9nZXRzcGVjaWZpYzpmdW5jdGlvbihlKXtyZXR1cm4gVXRbZV18fDB9LF9wdGhyZWFkX2tleV9jcmVhdGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gMD09ZT9tZS5FSU5WQUw6KEZbZT4+Ml09enQsVXRbenRdPTAsenQrKywwKX0sX3B0aHJlYWRfb25jZTpmdW5jdGlvbiBlKHQscil7ZS5zZWVufHwoZS5zZWVuPXt9KSx0IGluIGUuc2Vlbnx8KG8uZHluQ2FsbF92KHIpLGUuc2Vlblt0XT0xKX0sX3B0aHJlYWRfc2V0c3BlY2lmaWM6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZSBpbiBVdD8oVXRbZV09dCwwKTptZS5FSU5WQUx9LF90aW1lOmZ1bmN0aW9uKGUpe3ZhciB0PURhdGUubm93KCkvMWUzfDA7cmV0dXJuIGUmJihGW2U+PjJdPXQpLHR9LERZTkFNSUNUT1BfUFRSOiQsU1RBQ0tUT1A6VX07dmFyIFd0PW8uYXNtKG8uYXNtR2xvYmFsQXJnLG8uYXNtTGlicmFyeUFyZyxEKTtvLmFzbT1XdDt2YXIgWXQ9by5fX0dMT0JBTF9fc3ViX0lfYmluZF9jcHA9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uX19HTE9CQUxfX3N1Yl9JX2JpbmRfY3BwLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sVnQ9by5fX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcC5hcHBseShudWxsLGFyZ3VtZW50cyl9LEh0PW8uX19HTE9CQUxfX3N1Yl9JX2NyY19jcHA9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uX19HTE9CQUxfX3N1Yl9JX2NyY19jcHAuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxHdD1vLl9fR0xPQkFMX19zdWJfSV9nbG9iYWxfY3BwPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fR0xPQkFMX19zdWJfSV9nbG9iYWxfY3BwLmFwcGx5KG51bGwsYXJndW1lbnRzKX0scXQ9KG8uX19fY3hhX2Nhbl9jYXRjaD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX19jeGFfY2FuX2NhdGNoLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5fX19jeGFfaXNfcG9pbnRlcl90eXBlPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fX2N4YV9pc19wb2ludGVyX3R5cGUuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLl9fX2Vycm5vX2xvY2F0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fX2Vycm5vX2xvY2F0aW9uLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5fX19nZXRUeXBlTmFtZT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX19nZXRUeXBlTmFtZS5hcHBseShudWxsLGFyZ3VtZW50cyl9KSxYdD1vLl9lbXNjcmlwdGVuX3JlcGxhY2VfbWVtb3J5PWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9lbXNjcmlwdGVuX3JlcGxhY2VfbWVtb3J5LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sS3Q9by5fZnJlZT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fZnJlZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LEp0PW8uX21hbGxvYz1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fbWFsbG9jLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sWnQ9by5zZXRUZW1wUmV0MD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5zZXRUZW1wUmV0MC5hcHBseShudWxsLGFyZ3VtZW50cyl9LFF0PShvLnNldFRocmV3PWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLnNldFRocmV3LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5zdGFja0FsbG9jPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLnN0YWNrQWxsb2MuYXBwbHkobnVsbCxhcmd1bWVudHMpfSk7by5keW5DYWxsX2RpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2RpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9pPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2lpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaWlpLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2lpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlpaWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlqaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF9paWlpaWlqaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfaWpqPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWpqLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2ppPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfamkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdj1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3YuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpZD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWQuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWlpaWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaWlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWo9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWouYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlqaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpamkuYXBwbHkobnVsbCxhcmd1bWVudHMpfTtmdW5jdGlvbiBlcihlKXt0aGlzLm5hbWU9IkV4aXRTdGF0dXMiLHRoaXMubWVzc2FnZT0iUHJvZ3JhbSB0ZXJtaW5hdGVkIHdpdGggZXhpdCgiK2UrIikiLHRoaXMuc3RhdHVzPWV9ZnVuY3Rpb24gdHIoZSl7ZnVuY3Rpb24gdCgpe28uY2FsbGVkUnVufHwoby5jYWxsZWRSdW49ITAsbXx8KHRlfHwodGU9ITAsWChKKSksWChaKSxvLm9uUnVudGltZUluaXRpYWxpemVkJiZvLm9uUnVudGltZUluaXRpYWxpemVkKCksZnVuY3Rpb24oKXtpZihvLnBvc3RSdW4pZm9yKCJmdW5jdGlvbiI9PXR5cGVvZiBvLnBvc3RSdW4mJihvLnBvc3RSdW49W28ucG9zdFJ1bl0pO28ucG9zdFJ1bi5sZW5ndGg7KWU9by5wb3N0UnVuLnNoaWZ0KCksZWUudW5zaGlmdChlKTt2YXIgZTtYKGVlKX0oKSkpfXNlPjB8fCghZnVuY3Rpb24oKXtpZihvLnByZVJ1bilmb3IoImZ1bmN0aW9uIj09dHlwZW9mIG8ucHJlUnVuJiYoby5wcmVSdW49W28ucHJlUnVuXSk7by5wcmVSdW4ubGVuZ3RoOyllPW8ucHJlUnVuLnNoaWZ0KCksSy51bnNoaWZ0KGUpO3ZhciBlO1goSyl9KCksc2U+MHx8by5jYWxsZWRSdW58fChvLnNldFN0YXR1cz8oby5zZXRTdGF0dXMoIlJ1bm5pbmcuLi4iKSxzZXRUaW1lb3V0KChmdW5jdGlvbigpe3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7by5zZXRTdGF0dXMoIiIpfSksMSksdCgpfSksMSkpOnQoKSkpfWZ1bmN0aW9uIHJyKGUpe3Rocm93IG8ub25BYm9ydCYmby5vbkFib3J0KGUpLHZvaWQgMCE9PWU/KG8ucHJpbnQoZSksby5wcmludEVycihlKSxlPUpTT04uc3RyaW5naWZ5KGUpKTplPSIiLG09ITAsImFib3J0KCIrZSsiKS4gQnVpbGQgd2l0aCAtcyBBU1NFUlRJT05TPTEgZm9yIG1vcmUgaW5mby4ifWlmKG8uYXNtPVd0LGVyLnByb3RvdHlwZT1uZXcgRXJyb3IsZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yPWVyLHVlPWZ1bmN0aW9uIGUoKXtvLmNhbGxlZFJ1bnx8dHIoKSxvLmNhbGxlZFJ1bnx8KHVlPWUpfSxvLnJ1bj10cixvLmV4aXQ9ZnVuY3Rpb24oZSx0KXt0JiZvLm5vRXhpdFJ1bnRpbWUmJjA9PT1lfHwoby5ub0V4aXRSdW50aW1lfHwobT0hMCxVPXZvaWQgMCxYKFEpLG8ub25FeGl0JiZvLm9uRXhpdChlKSksbCYmcHJvY2Vzcy5leGl0KGUpLG8ucXVpdChlLG5ldyBlcihlKSkpfSxvLmFib3J0PXJyLG8ucHJlSW5pdClmb3IoImZ1bmN0aW9uIj09dHlwZW9mIG8ucHJlSW5pdCYmKG8ucHJlSW5pdD1bby5wcmVJbml0XSk7by5wcmVJbml0Lmxlbmd0aD4wOylvLnByZUluaXQucG9wKCkoKTtyZXR1cm4gby5ub0V4aXRSdW50aW1lPSEwLHRyKCksdH07ZnVuY3Rpb24gaSh7cmVzb3VyY2VJZDplLHVybDp0fSl7cmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbihlLG8pe2lmKCFyKXRocm93IG5ldyBFcnJvcigidW5wYWNrQnJpZGdlIG5vdCBkZXRlY3RlZCIpO2lmKCFuKXRocm93IG5ldyBFcnJvcigidW5wYWNrIG5vdCBkZXRlY3RlZCIpOyhmdW5jdGlvbihlKXtyZXR1cm4gZmV0Y2gobmV3IFJlcXVlc3QoZSkpLnRoZW4oZT0+e2lmKGUub2spcmV0dXJuIGUuYXJyYXlCdWZmZXIoKTt0aHJvdyBuZXcgRXJyb3IoIjQwNCBFcnJvcjogRmlsZSBub3QgZm91bmQuIil9KS50aGVuKGU9PnIuY3JlYXRlRXh0cmFjdG9yRnJvbURhdGEoZSkpfSkodCkudGhlbih0PT57ZSh0LmV4dHJhY3RBbGwoKSl9LGU9PntvKGUpfSl9KSl9ZnVuY3Rpb24gYShlLHQpe2NvbnN0W3Isbl09dDtpZigiRkFJTCI9PXIuc3RhdGUpe2NvbnN0IHQ9e3R5cGU6IkVSUk9SIixyZWFzb246ci5yZWFzb24sbXNnOnIubXNnLHJlc291cmNlSWQ6ZS5kYXRhLnJlc291cmNlSWQsdXJsOmUuZGF0YS51cmx9O3JldHVybiB2b2lkIHNlbGYucG9zdE1lc3NhZ2UodCl9Y29uc3Qgbz17dHlwZToiRklOSVNIRUQiLHJlc291cmNlSWQ6ZS5kYXRhLnJlc291cmNlSWQsZW50cmllczp7fX0saT1bXTtpZihuJiZuLmZpbGVzKWZvcihjb25zdCBlIG9mIG4uZmlsZXMpby5lbnRyaWVzW2UuZmlsZUhlYWRlci5uYW1lXT1lLmV4dHJhY3RbMV0saS5wdXNoKGUuZXh0cmFjdFsxXS5idWZmZXIpO3NlbGYucG9zdE1lc3NhZ2UobyxpKX1vbm1lc3NhZ2U9ZnVuY3Rpb24oZSl7aWYoImluaXQiPT1lLmRhdGEudHlwZSluPW8oZS5kYXRhLndhc21VcmwpLG4ub25SdW50aW1lSW5pdGlhbGl6ZWQ9KCk9PnBvc3RNZXNzYWdlKHt0eXBlOiJXQVNNX0xPQURFRCJ9KTtlbHNlIGlmKCJmZXRjaCI9PWUuZGF0YS50eXBlKWkoZS5kYXRhKS50aGVuKHQ9PnthKGUsdCl9LHQ9Pntjb25zdCByPXt0eXBlOiJFUlJPUiIscmVzb3VyY2VJZDplLmRhdGEucmVzb3VyY2VJZCx1cmw6ZS5kYXRhLnVybH07c2VsZi5wb3N0TWVzc2FnZShyKX0pO2Vsc2UgaWYoInVucGFjayI9PWUuZGF0YS50eXBlKXtjb25zdHtidWZmZXI6dH09ZS5kYXRhO2lmKCFyKXRocm93IG5ldyBFcnJvcigidW5wYWNrQnJpZGdlIG5vdCBkZXRlY3RlZCIpO2lmKCFuKXRocm93IG5ldyBFcnJvcigidW5wYWNrIG5vdCBkZXRlY3RlZCIpO2NvbnN0IG89ci5jcmVhdGVFeHRyYWN0b3JGcm9tRGF0YSh0KS5leHRyYWN0QWxsKCk7YShlLG8pfX07Cgo=", null, !1);
function me(e) { return e && "object" == typeof e && !Array.isArray(e); }
function ue(e) {
    var _b, _c;
    var t = [];
    for (var _d = 1; _d < arguments.length; _d++) {
        t[_d - 1] = arguments[_d];
    }
    if (!t.length)
        return e;
    var a = t.shift();
    if (me(e) && me(a))
        for (var t_18 in a)
            me(a[t_18]) ? (e[t_18] || Object.assign(e, (_b = {}, _b[t_18] = {}, _b)), ue(e[t_18], a[t_18])) : Object.assign(e, (_c = {}, _c[t_18] = a[t_18], _c));
    return ue.apply(void 0, __spreadArrays([e], t));
}
var be = new /** @class */ (function () {
    function class_3() {
        var e;
        this.loaded = new C, this.progressIncremented = new C, this.allResourcesLoaded = new C, this.fileUpdated = new C, this.__totalWork = 0, this.__totalWorkByCategory = {}, this.__doneWork = 0, this.__doneWorkByCategory = {}, this.__resourceRegisterCallbacks = {}, this.__callbacks = {}, this.__resources = {}, this.__resourcesTreeEntities = {}, this.__resourcesTree = { children: {} }, this.__workers = [], this.__nextWorker = 0;
        var t = document.getElementsByTagName("script");
        for (var a_19 = 0; a_19 < t.length; a_19++) {
            var i_16 = t[a_19];
            if (i_16.src.includes("zea-engine")) {
                var t_19 = i_16.src.split("/");
                t_19.pop(), t_19.pop(), e = t_19.join("/");
                break;
            }
        }
        e || (e = "https://unpkg.com/@zeainc/zea-engine@0.1.3"), this.wasmUrl = e + "/public-resources/unpack.wasm", this.addResourceURL("ZeaEngine/Vive.vla", e + "/public-resources/Vive.vla"), this.addResourceURL("ZeaEngine/Oculus.vla", e + "/public-resources/Oculus.vla");
    }
    class_3.prototype.getRootFolder = function () { return this.__resourcesTree; };
    class_3.prototype.registerResourceCallback = function (e, t) { this.__resourceRegisterCallbacks[e] = t; for (var a_20 in this.__resources) {
        var i_17 = this.__resources[a_20];
        i_17.name.includes(e) && t(i_17);
    } };
    class_3.prototype.__applyCallbacks = function (e) {
        var _this = this;
        var t = function (e) { for (var t_20 in _this.__resourceRegisterCallbacks)
            e.name.includes(t_20) && _this.__resourceRegisterCallbacks[t_20](e); };
        for (var a_21 in e) {
            var i_18 = e[a_21];
            i_18.url && t(i_18);
        }
    };
    class_3.prototype.__buildTree = function (e) {
        var _this = this;
        var t = function (a) { if (_this.__resourcesTreeEntities[a])
            return; var i = e[a]; i.id = a, "folder" !== i.type && "dependency" !== i.type || (i.children = {}), i.parent && (_this.__resourcesTreeEntities[i.parent] || t(i.parent)), (i.parent ? _this.__resourcesTreeEntities[i.parent] : _this.__resourcesTree).children[i.name] = i, _this.__resourcesTreeEntities[a] = i; };
        for (var a_22 in e)
            t(a_22);
    };
    class_3.prototype.setResources = function (e) { this.__resources = Object.assign(this.__resources, e), this.__buildTree(e), this.__applyCallbacks(e); };
    class_3.prototype.addResourceURL = function (e, t) { var a = e.split("/"), i = a.pop(); if (!t) {
        var i_19 = window.location.href.split("#")[0];
        i_19 = i_19.split("?")[0], (i_19.endsWith(".html") || i_19.endsWith(".html")) && (i_19 = i_19.substring(0, i_19.lastIndexOf("/")) + "/");
        var s_1 = i_19;
        if ("." == a[0])
            a.shift();
        else if (".." == a[0]) {
            item = item.substring(3);
            var e_14 = s_1.split("/");
            e_14.pop(), e_14.pop(), s_1 = e_14.join("/") + "/";
        }
        t = s_1 + e;
    } var s; var n = {}; for (var _b = 0, a_23 = a; _b < a_23.length; _b++) {
        var e_15 = a_23[_b];
        var t_21 = m(e_15);
        t_21 in this.__resources || (this.__resources[t_21] = { name: e_15, type: "folder", parent: s }, n[t_21] = this.__resources[t_21]), s = t_21;
    } var l = m(i), r = { name: i, url: t, parent: s, id: l }; this.__resources[l] = r, n[l] = r, this.__buildTree(n), this.__applyCallbacks(n); };
    class_3.prototype.updateFile = function (e) { var t = !(e.id in this.__resources); if (this.__resources[e.id] = e, t) {
        console.log("New file added");
        var t_22 = {};
        t_22[e.id] = e, this.__buildTree(t_22);
    } this.fileUpdated.emit(e.id); };
    class_3.prototype.freeData = function (e) { };
    class_3.prototype.__getWorker = function () {
        var _this = this;
        return this.__nextWorker = (this.__nextWorker + 1) % 3, null == this.__workers[this.__nextWorker] && (this.__workers[this.__nextWorker] = (function () { return new Promise(function (e) { var t = new ce; t.postMessage({ type: "init", wasmUrl: _this.wasmUrl }), t.onmessage = function (a) { if ("WASM_LOADED" === a.data.type)
            e(t);
        else if ("FINISHED" === a.data.type) {
            _this.addWorkDone(a.data.resourceId, 1), _this.__onFinishedReceiveFileData(a.data);
        }
        else if ("ERROR" === a.data.type) {
            var e_16 = a.data, t_23 = _this.__resources[e_16.resourceId];
            console.error("Unable to load Resource:", t_23 ? t_23.name : e_16.resourceId, " With url:", e_16.url);
        } }; }); })()), this.__workers[this.__nextWorker];
    };
    class_3.prototype.__terminateWorkers = function () { for (var _b = 0, _c = this.__workers; _b < _c.length; _b++) {
        var e_17 = _c[_b];
        e_17.terminate();
    } this.__workers = []; };
    class_3.prototype.getFilepath = function (e) { var t = this.__resources[e]; var a = [t.name]; for (; t.parent;)
        t = this.__resources[t.parent], a.splice(0, 0, t.name); return a.join("/"); };
    class_3.prototype.resourceAvailable = function (e) { return e.indexOf(".") > 0 ? (console.warn("Deprecation warning for resourceAvailable. Value should be a file id, not a path."), null != this.resolveFilepath(e)) : e in this.__resources; };
    class_3.prototype.getFile = function (e) { return this.__resources[e]; };
    class_3.prototype.resolveFilePathToId = function (e) { if (!e)
        return void console.warn("Invalid file path:", e); var t = this.resolveFilepath(e); return t ? t.id : void 0; };
    class_3.prototype.resolveFilepath = function (e) { var t = e.split("/"); "." != t[0] && "" != t[0] || t.shift(); var a = this.__resourcesTree; for (var _b = 0, t_24 = t; _b < t_24.length; _b++) {
        var i_20 = t_24[_b];
        if (!(i_20 in a.children))
            return console.warn("Unable to resolve key:" + i_20 + " of path:" + e), null;
        a = a.children[i_20];
    } return a; };
    class_3.prototype.resolveFile = function (e) { return console.warn("Deprecation warning for resolveFile. Use resolveFilepath."), this.resolveFilepath(e); };
    class_3.prototype.resolveURL = function (e) { console.warn("Deprecation warning for resolveURL. Use resolveFilepath."); var t = this.resolveFilepath(e); if (t)
        return t.url; };
    class_3.prototype.addWork = function (e, t) { this.__totalWork += t, this.progressIncremented.emit(this.__doneWork / this.__totalWork * 100); };
    class_3.prototype.addWorkDone = function (e, t) { if (this.__doneWork += t, this.progressIncremented.emit(this.__doneWork / this.__totalWork * 100), this.__doneWork > this.__totalWork)
        throw new Error("Mismatch between work loaded and work done."); this.__doneWork == this.__totalWork && this.allResourcesLoaded.emit(); };
    class_3.prototype.loadResource = function (e, t, a) {
        if (a === void 0) { a = !0; }
        var i = this.getFile(e);
        if (!i)
            throw new Error("Invalid resource Id:'" + e + "' not found in Resources:" + JSON.stringify(this.__resources, null, 2));
        this.loadUrl(e, i.url, t, a);
    };
    class_3.prototype.loadURL = function (e, t, a, i) {
        if (i === void 0) { i = !0; }
        return console.warn("Please call loadUrl instead,"), this.loadUrl(e, t, a, i);
    };
    class_3.prototype.loadUrl = function (e, t, a, i) {
        var _this = this;
        if (i === void 0) { i = !0; }
        i && this.addWork(e, 3), e in this.__callbacks || (this.__callbacks[e] = []), this.__callbacks[e].push(a), fetch(t).then(function (e) { return function (e) { if (!e.ok)
            throw new Error("HTTP " + e.status + " - " + e.statusText); return e; }(e) && e.arrayBuffer(); }).then(function (t) { _this.__getWorker().then(function (a) { a.postMessage({ type: "unpack", resourceId: e, buffer: t }); }); });
    };
    class_3.prototype.unpackBuffer = function (e, t, a, i) {
        var _this = this;
        if (i === void 0) { i = !0; }
        return new Promise(function (s, n) { i && _this.addWork(e, 3), e in _this.__callbacks || (_this.__callbacks[e] = []), a && _this.__callbacks[e].push(a), _this.__callbacks[e].push(function (e) { s(e); }), _this.__getWorker().then(function (a) { a.postMessage({ type: "unpack", resourceId: e, buffer: t }, [t]); }); });
    };
    class_3.prototype.__onFinishedReceiveFileData = function (e) { var t = e.resourceId; this.addWorkDone(t, 1); var a = this.__callbacks[t]; if (a) {
        for (var _b = 0, a_24 = a; _b < a_24.length; _b++) {
            var t_25 = a_24[_b];
            t_25(e.entries);
        }
        delete this.__callbacks[t];
    } this.loaded.emit(t), this.addWorkDone(t, 1); };
    class_3.prototype.suspend = function () { this.__terminateWorkers(); };
    class_3.prototype.traverse = function (e) { var t = function (e) { for (var t_26 in e.children)
        a(e.children[t_26]); }, a = function (a) { if (0 == e(a))
        return !1; a.children && t(a); }; t(this.__resourcesTree); };
    return class_3;
}());
var pe = /** @class */ (function () {
    function pe(e) {
        if (e) {
            var t_27 = e.split("-"), a_25 = t_27[0].split(".");
            this.major = parseInt(a_25[0]), this.minor = parseInt(a_25[1]), this.patch = parseInt(a_25[2]), 2 == t_27.length && (this.branch = t_27[1]);
        }
        else
            this.major = 0, this.minor = 0, this.patch = 0;
    }
    pe.prototype.equals = function (e) { return !(this.patch == e[2] && this.minor == e[1] && this.major == e[0]); };
    pe.prototype.lessThan = function (e) { return !(this.major >= e[0] || this.minor >= e[1] || this.patch >= e[2]); };
    pe.prototype.greaterThan = function (e) { return this.major > e[0] || this.minor > e[1] || this.patch > e[2]; };
    pe.prototype.greaterOrEqualThan = function (e) { return !(this.major < e[0]) && (this.major > e[0] || !(this.minor < e[1]) && (this.minor > e[1] || !(this.patch < e[2]))); };
    return pe;
}());
var ge = /** @class */ (function () {
    function ge(e, t, a) {
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = !0; }
        this.__data = e, this.__byteOffset = t, this.__dataView = new DataView(this.__data), this.__isMobileDevice = a, this.utf8decoder = new TextDecoder;
    }
    Object.defineProperty(ge.prototype, "isMobileDevice", {
        get: function () { return this.__isMobileDevice; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ge.prototype, "data", {
        get: function () { return this.__data; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ge.prototype, "byteLength", {
        get: function () { return this.__dataView.byteLength; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ge.prototype, "remainingByteLength", {
        get: function () { return this.__dataView.byteLength - this.__byteOffset; },
        enumerable: true,
        configurable: true
    });
    ge.prototype.pos = function () { return this.__byteOffset; };
    ge.prototype.seek = function (e) { this.__byteOffset = e; };
    ge.prototype.advance = function (e) { this.__byteOffset += e; };
    ge.prototype.loadUInt8 = function () { var e = this.__dataView.getUint8(this.__byteOffset); return this.__byteOffset += 1, e; };
    ge.prototype.loadUInt16 = function () { var e = this.__dataView.getUint16(this.__byteOffset, !0); return this.__byteOffset += 2, e; };
    ge.prototype.loadUInt32 = function () { var e = this.__dataView.getUint32(this.__byteOffset, !0); return this.__byteOffset += 4, e; };
    ge.prototype.loadSInt32 = function () { var e = this.__dataView.getInt32(this.__byteOffset, !0); return this.__byteOffset += 4, e; };
    ge.prototype.loadFloat16 = function () { var e = this.loadUInt16(); return Math.decode16BitFloat(e); };
    ge.prototype.loadUFloat16 = function () { var e = this.loadFloat16(); return e < 0 ? 2048 - e : e; };
    ge.prototype.loadFloat16From2xUInt8 = function () { var e = this.__dataView.getFloat16(this.__byteOffset, !0); return this.__byteOffset += 2, e; };
    ge.prototype.loadUInt32From2xUFloat16 = function () { return this.loadUFloat16() + 4096 * this.loadUFloat16(); };
    ge.prototype.loadSInt32From2xFloat16 = function () { return this.loadFloat16() + 2048 * this.loadFloat16(); };
    ge.prototype.loadFloat32 = function () { var e = this.__dataView.getFloat32(this.__byteOffset, !0); return this.__byteOffset += 4, e; };
    ge.prototype.loadUInt8Array = function (e, t) {
        if (t === void 0) { t = !1; }
        null == e && (e = this.loadUInt32());
        var a = new Uint8Array(this.__data, this.__byteOffset, e);
        this.__byteOffset += e;
        return a;
    };
    ge.prototype.loadUInt16Array = function (e, t) {
        if (t === void 0) { t = !1; }
        if (null == e && (e = this.loadUInt32()), 0 == e)
            return new Uint16Array;
        var a;
        if (this.readPadd(2), this.__isMobileDevice) {
            a = new Uint16Array(e);
            for (var t_28 = 0; t_28 < e; t_28++)
                a[t_28] = this.__dataView.getUint16(this.__byteOffset, !0), this.__byteOffset += 2;
        }
        else
            a = new Uint16Array(this.__data, this.__byteOffset, e), this.__byteOffset += 2 * e;
        return a;
    };
    ge.prototype.loadUInt32Array = function (e, t) {
        if (t === void 0) { t = !1; }
        if (null == e && (e = this.loadUInt32()), 0 == e)
            return new Uint32Array;
        var a;
        if (this.readPadd(4), this.__isMobileDevice) {
            a = new Uint32Array(e);
            for (var t_29 = 0; t_29 < e; t_29++)
                a[t_29] = this.__dataView.getUint32(this.__byteOffset, !0), this.__byteOffset += 4;
        }
        else
            a = new Uint32Array(this.__data, this.__byteOffset, e), this.__byteOffset += 4 * e;
        return a;
    };
    ge.prototype.loadFloat32Array = function (e, t) {
        if (t === void 0) { t = !1; }
        if (null == e && (e = this.loadUInt32()), 0 == e)
            return new Float32Array;
        var a;
        if (this.readPadd(4), this.__isMobileDevice) {
            a = new Float32Array(e);
            for (var t_30 = 0; t_30 < e; t_30++)
                a[t_30] = this.__dataView.getFloat32(this.__byteOffset, !0), this.__byteOffset += 4;
        }
        else
            a = new Float32Array(this.__data, this.__byteOffset, e), this.__byteOffset += 4 * e;
        return a;
    };
    ge.prototype.loadStr = function () { var e = this.loadUInt32(), t = new Uint8Array(this.__data, this.__byteOffset, e); return this.__byteOffset += e, this.utf8decoder.decode(t); };
    ge.prototype.loadStrArray = function () { var e = this.loadUInt32(), t = []; for (var a_26 = 0; a_26 < e; a_26++)
        t[a_26] = this.loadStr(); return t; };
    ge.prototype.loadSInt32Vec2 = function () { var e = this.loadSInt32(), t = this.loadSInt32(); return new _(e, t); };
    ge.prototype.loadUInt32Vec2 = function () { var e = this.loadUInt32(), t = this.loadUInt32(); return new _(e, t); };
    ge.prototype.loadFloat16Vec2 = function () { var e = this.loadFloat16(), t = this.loadFloat16(); return new _(e, t); };
    ge.prototype.loadFloat32Vec2 = function () { var e = this.loadFloat32(), t = this.loadFloat32(); return new _(e, t); };
    ge.prototype.loadFloat16Vec3 = function () { var e = this.loadFloat16(), t = this.loadFloat16(), a = this.loadFloat16(); return new Z(e, t, a); };
    ge.prototype.loadFloat32Vec3 = function () { var e = this.loadFloat32(), t = this.loadFloat32(), a = this.loadFloat32(); return new Z(e, t, a); };
    ge.prototype.loadFloat16Quat = function () { var e = this.loadFloat16(), t = this.loadFloat16(), a = this.loadFloat16(), i = this.loadFloat16(); return new R(e, t, a, i); };
    ge.prototype.loadFloat32Quat = function () { var e = this.loadFloat32(), t = this.loadFloat32(), a = this.loadFloat32(), i = this.loadFloat32(); return new R(e, t, a, i); };
    ge.prototype.loadRGBFloat32Color = function () { var e = this.loadFloat32(), t = this.loadFloat32(), a = this.loadFloat32(); return new y(e, t, a); };
    ge.prototype.loadRGBAFloat32Color = function () { var e = this.loadFloat32(), t = this.loadFloat32(), a = this.loadFloat32(), i = this.loadFloat32(); return new y(e, t, a, i); };
    ge.prototype.loadRGBUInt8Color = function () { var e = this.loadUInt8(), t = this.loadUInt8(), a = this.loadUInt8(); return new y(e / 255, t / 255, a / 255); };
    ge.prototype.loadRGBAUInt8Color = function () { var e = this.loadUInt8(), t = this.loadUInt8(), a = this.loadUInt8(), i = this.loadUInt8(); return new y(e / 255, t / 255, a / 255, i / 255); };
    ge.prototype.loadBox2 = function () { return new W(this.loadFloat32Vec2(), this.loadFloat32Vec2()); };
    ge.prototype.loadBox3 = function () { return new v(this.loadFloat32Vec3(), this.loadFloat32Vec3()); };
    ge.prototype.readPadd = function (e) { var t = this.__byteOffset % e; 0 != t && (this.__byteOffset += e - t); };
    return ge;
}());
var _e = /** @class */ (function () {
    function _e(e) {
        if (e === void 0) { e = 0; }
        this.__data = new ArrayBuffer(e), this.__byteOffset = 0, this.__reserved = e, this.__dataView = new DataView(this.__data);
    }
    _e.prototype.pos = function () { return this.__byteOffset; };
    _e.prototype.seek = function (e) { this.__byteOffset = e; };
    _e.prototype.seekEnd = function () { this.__byteOffset = this.__reserved; };
    _e.prototype.getBuffer = function () { if (this.__data.byteLength == this.__byteOffset)
        return this.__data; return new Uint8Array(this.__data).slice(0, this.__byteOffset).buffer; };
    _e.prototype.__grow = function () { var e = 2 * (this.__reserved > 0 ? this.__reserved : 1), t = new ArrayBuffer(e), a = new Uint8Array(t), i = new Uint8Array(this.__data); a.set(i), this.__data = t, this.__dataView = new DataView(this.__data), this.__reserved = e; };
    _e.prototype.__reserve = function (e) { this.__byteOffset + e > this.__reserved && this.__grow(); };
    _e.prototype.__offset = function (e) { this.__byteOffset += e, this.__byteOffset > this.__reserved && this.__grow(); };
    _e.prototype.writeUInt8 = function (e) { this.__reserve(1), this.__dataView.setUint8(this.__byteOffset, e), this.__offset(1); };
    _e.prototype.writeUInt16 = function (e) { this.__reserve(2), this.__dataView.setUint16(this.__byteOffset, e, !0), this.__offset(2); };
    _e.prototype.writeUInt32 = function (e) { this.__reserve(4), this.__dataView.setUint32(this.__byteOffset, e, !0), this.__offset(4); };
    _e.prototype.writeSInt32 = function (e) { this.__reserve(4), this.__dataView.setInt32(this.__byteOffset, e, !0), this.__offset(4); };
    _e.prototype.writeFloat16 = function (e) { var t = Math.encode16BitFloat(e); this.writeUInt16(t); };
    _e.prototype.writeFloat32 = function (e) { this.__reserve(4), this.__dataView.setFloat32(this.__byteOffset, e, !0), this.__offset(4); };
    _e.prototype.writeUInt8Array = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = e.size ? e.size : e.length;
        this.__reserve(a + (t ? 4 : 0)), t && this.writeUInt32(a);
        for (var t_31 = 0; t_31 < a; t_31++)
            this.writeUInt8(e[t_31]);
    };
    _e.prototype.writeUInt16Array = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = e.size ? e.size : e.length;
        this.__reserve(2 * a + (t ? 4 : 0)), t && this.writeUInt32(a);
        for (var t_32 = 0; t_32 < a; t_32++)
            this.writeUInt16(e[t_32]);
    };
    _e.prototype.writeUInt32Array = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = e.size ? e.size : e.length;
        this.__reserve(4 * a + (t ? 4 : 0)), t && this.writeUInt32(a);
        for (var t_33 = 0; t_33 < a; t_33++)
            this.writeUInt32(e[t_33]);
    };
    _e.prototype.writeFloat32Array = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = e.size ? e.size : e.length;
        this.__reserve(4 * a + (t ? 4 : 0)), t && this.writeUInt32(a);
        for (var t_34 = 0; t_34 < a; t_34++)
            this.writeFloat32(e[t_34]);
    };
    _e.prototype.writeStr = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = value.length;
        this.__reserve(4 * a + (t ? 4 : 0)), t && this.writeUInt32(a);
        for (var e_18 = 0; e_18 < a; e_18++)
            this.writeFloat32(value.charCodeAt(e_18));
    };
    _e.prototype.writeSInt32Vec2 = function (e) { this.writeSInt32(e.x), this.writeSInt32(e.y); };
    _e.prototype.writeUInt32Vec2 = function (e) { this.writeUInt32(e.x), this.writeUInt32(e.y); };
    _e.prototype.writeFloat16Vec2 = function (e) { this.writeFloat16(e.x), this.writeFloat16(e.y); };
    _e.prototype.writeFloat32Vec2 = function (e) { this.writeFloat32(e.x), this.writeFloat32(e.y); };
    _e.prototype.writeFloat16Vec3 = function (e) { this.writeFloat16(e.x), this.writeFloat16(e.y), this.writeFloat16(e.z); };
    _e.prototype.writeFloat32Vec3 = function (e) { this.writeFloat32(e.x), this.writeFloat32(e.y), this.writeFloat32(e.z); };
    _e.prototype.writeFloat16Quat = function (e) { this.writeFloat16(e.x), this.writeFloat16(e.y), this.writeFloat16(e.z), this.writeFloat16(e.w); };
    _e.prototype.writeFloat32Quat = function (e) { this.writeFloat32(e.x), this.writeFloat32(e.y), this.writeFloat32(e.z), this.writeFloat32(e.w); };
    _e.prototype.writeRGBFloat32Color = function (e) { this.writeFloat32(e.r), this.writeFloat32(e.g), this.writeFloat32(e.b); };
    _e.prototype.writeRGBAFloat32Color = function (e) { this.writeFloat32(e.r), this.writeFloat32(e.g), this.writeFloat32(e.b), this.writeFloat32(e.a); };
    _e.prototype.writeRGBUInt8Color = function (e) { this.writeUInt8(e.r), this.writeUInt8(e.g), this.writeUInt8(e.b); };
    _e.prototype.writeRGBAUInt8Color = function (e) { this.writeUInt8(e.r), this.writeUInt8(e.g), this.writeUInt8(e.b), this.writeUInt8(e.a); };
    _e.prototype.writeBox2 = function (e) { this.writeFloat32Vec2(e.p0), this.writeFloat32Vec2(e.p1); };
    _e.prototype.writeBox3 = function (e) { this.writeFloat32Vec3(e.p0), this.writeFloat32Vec3(e.p1); };
    _e.prototype.writePadd = function (e) { var t = e - this.__byteOffset; this.__reserve(t), this.__offset(t); };
    _e.prototype.writeAlignment = function (e) { var t = this.__byteOffset % e; 0 != t && (this.__reserve(e - t), this.__offset(e - t)); };
    return _e;
}());
var Ze = 4;
var Ge = /** @class */ (function () {
    function Ge(e, t) {
        this.__name = e, this.__cb = t, this.__flags = 0;
    }
    Ge.prototype.getName = function () { return this.__name; };
    Ge.prototype.getOwner = function () { return this.__ownerItem; };
    Ge.prototype.setOwner = function (e) { this.__ownerItem !== e && (this.__ownerItem = e); };
    Ge.prototype.getPath = function () { if (this.__ownerItem) {
        if (this.__ownerItem.getPath) {
            var e_19 = this.__ownerItem.getPath().slice();
            return e_19.push(this.__name), e_19;
        }
        return [this.__ownerItem.getName(), this.__name];
    } return [this.__name]; };
    Ge.prototype.setEnabled = function (e) { e ? this.__flags &= ~Ze : this.__flags |= ~Ze; };
    Ge.prototype.isEnabled = function () { };
    Ge.prototype.invoke = function () { this.__cb(); };
    return Ge;
}());
var Xe = /** @class */ (function (_super) {
    __extends(Xe, _super);
    function Xe(e, t, a, i) {
        if (t === void 0) { t = 0; }
        var _this = this;
        _this = _super.call(this, e, t, "Number") || this, a && !Array.isArray(a) && console.error("Range value must be an array of 2 numbers."), _this.__range = a, _this.__step = i;
        return _this;
    }
    Xe.prototype.setValue = function (e, t) { t == E.USER_SETVALUE && (this.__range && (e = Math.clamp(e, this.__range[0], this.__range[1])), this.__step && (e = Math.round(e / this.__step) * this.__step)), _super.prototype.setValue.call(this, e, t); };
    Xe.prototype.getValue = function (e) { return _super.prototype.getValue.call(this, e); };
    Xe.prototype.getRange = function () { return this.__range; };
    Xe.prototype.setRange = function (e) { return this.__range = e, this; };
    Xe.prototype.getStep = function () { return this.__step; };
    Xe.prototype.setStep = function (e) { return this.__step = e, this; };
    Xe.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return this.__range && (a.range = this.__range), this.__step && (a.step = this.__step), a; };
    Xe.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), e.range && (this.__range = e.range), e.step && (this.__step = e.step); };
    Xe.prototype.readBinary = function (e, t) { var a = e.loadFloat32(); this.setValue(a, E.DATA_LOAD); };
    Xe.prototype.clone = function (e) { var t = new Xe(this.__name, this.__value); return t.__range = this.__range, t.__step = this.__step, t; };
    return Xe;
}(Q));
J.registerClass("NumberParameter", Xe), J.registerClass("Property_SInt32", Xe), J.registerClass("Property_UInt32", Xe), J.registerClass("Property_Float32", Xe);
var ye = /** @class */ (function (_super) {
    __extends(ye, _super);
    function ye(e, t, a) {
        var _this = this;
        _this = _super.call(this, e, t, [0, a.length], 1) || this, _this.choices = a;
        return _this;
    }
    ye.prototype.getChoices = function () { return this.choices; };
    ye.prototype.setValue = function (e, t) { "string" == typeof e ? _super.prototype.setValue.call(this, this.choices.indexOf(e), t) : _super.prototype.setValue.call(this, e, t); };
    return ye;
}(Xe));
var fe = /** @class */ (function (_super) {
    __extends(fe, _super);
    function fe(e, t) {
        return _super.call(this, e, t, "Boolean") || this;
    }
    fe.prototype.clone = function (e) { return new fe(this.__name, this.__value); };
    return fe;
}(Q));
J.registerClass("BooleanParameter", fe);
var Ve = /** @class */ (function (_super) {
    __extends(Ve, _super);
    function Ve(e, t, a) {
        var _this = this;
        _this = _super.call(this, e, t || new _, "Vec2") || this, _this.__range = a;
        return _this;
    }
    Ve.prototype.getRange = function () { return this.__range; };
    Ve.prototype.__setRange = function (e) { this.__range = e, this.rangeChanged.emit(); };
    Ve.prototype.clone = function (e) { return new Ve(this.__name, this.__value.clone()); };
    return Ve;
}(Q));
var Ie = /** @class */ (function (_super) {
    __extends(Ie, _super);
    function Ie(e, t, a) {
        return _super.call(this, e, t || new Z, "Vec3") || this;
    }
    Ie.prototype.clone = function (e) { return new Ie(this.__name, this.__value.clone()); };
    return Ie;
}(Q));
var Re = /** @class */ (function (_super) {
    __extends(Re, _super);
    function Re(e, t) {
        return _super.call(this, e, t || new G, "Vec4") || this;
    }
    Re.prototype.clone = function (e) { return new Re(this.__name, this.__value.clone()); };
    return Re;
}(Q));
var xe = /** @class */ (function (_super) {
    __extends(xe, _super);
    function xe(e, t) {
        return _super.call(this, e, t || new y, "Color") || this;
    }
    xe.prototype.readBinary = function (e, t) { var a = e.loadRGBAFloat32Color(); a.applyGamma(2.2), this.setValue(a, E.DATA_LOAD); };
    xe.prototype.clone = function (e) { return new xe(this.__name, this.__value.clone()); };
    return xe;
}(Q));
J.registerClass("ColorParameter", xe);
var Se = /** @class */ (function (_super) {
    __extends(Se, _super);
    function Se(e, t) {
        return _super.call(this, e, t || new V, "Mat3") || this;
    }
    Se.prototype.clone = function (e) { return new Se(this.__name, this.__value.clone()); };
    return Se;
}(Q));
var We = /** @class */ (function (_super) {
    __extends(We, _super);
    function We(e, t) {
        return _super.call(this, e, t || new I, "Mat4") || this;
    }
    We.prototype.clone = function (e) { return new We(this.__name, this.__value.clone()); };
    return We;
}(Q));
var Le = /** @class */ (function (_super) {
    __extends(Le, _super);
    function Le(e, t) {
        return _super.call(this, e, t || new S, "Xfo") || this;
    }
    Le.prototype.clone = function (e) { return new Le(this.__name, this.__value.clone()); };
    return Le;
}(Q));
var ve = /** @class */ (function (_super) {
    __extends(ve, _super);
    function ve(e, t) {
        var _this = this;
        _this = _super.call(this, e, t, "BaseImage") || this, _this.valueParameterValueChanged = new C;
        return _this;
    }
    ve.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return this.__value && (a.imageType = this.__value.constructor.name), a; };
    ve.prototype.fromJSON = function (e, t, a) { return e.imageType && (this.__value = J.constructClass(e.imageType)), _super.prototype.fromJSON.call(this, e, t, a); };
    ve.prototype.clone = function (e) { return new ve(this.__name, this.__value); };
    return ve;
}(Q));
var Me = /** @class */ (function (_super) {
    __extends(Me, _super);
    function Me(e, t) {
        if (t === void 0) { t = ""; }
        var _this = this;
        _this = _super.call(this, e, t, "String") || this, _this.multiLine = !1;
        return _this;
    }
    Me.prototype.setMultiLine = function (e) { this.multiLine = e; };
    Me.prototype.getMultiLine = function () { return this.multiLine; };
    Me.prototype.readBinary = function (e, t) { var a = e.loadStr(); this.setValue(a, E.DATA_LOAD); };
    Me.prototype.clone = function (e) { return new Me(this.__name, this.__value); };
    return Me;
}(Q));
J.registerClass("StringParameter", Me), J.registerClass("Property_String", Me);
var Fe = /** @class */ (function (_super) {
    __extends(Fe, _super);
    function Fe(e, t) {
        if (t === void 0) { t = ""; }
        var _this = this;
        _this = _super.call(this, e, t, "String") || this, _this.lang = "js";
        return _this;
    }
    Fe.prototype.setLanguage = function (e) { this.lang = e; };
    Fe.prototype.getLanguage = function () { return this.lang; };
    Fe.prototype.clone = function (e) { return new Fe(this.__name, this.__value); };
    return Fe;
}(Me));
J.registerClass("CodeParameter", Fe);
var Te = /** @class */ (function (_super) {
    __extends(Te, _super);
    function Te(e, t) {
        var _this = this;
        _this = _super.call(this, e, "", "FilePath") || this, _this.fileUpdated = new C, t && _this.setSupportedExts(t);
        return _this;
    }
    Te.prototype.setSupportedExts = function (e) { this.__reextensions = new RegExp("\\.(" + e + ")$", "i"); };
    Te.prototype.getFilepath = function () { return this.__file ? be.getFilepath(this.__file.id) : ""; };
    Te.prototype.setFilepath = function (e, t) { var a = be.resolveFilePathToId(e); a ? this.setValue(a, t) : console.warn("Resource unavailable:" + e); };
    Te.prototype.getFilename = function () { if (this.__file)
        return this.__file.name; };
    Te.prototype.getExt = function () { var e = this.getFilename(), t = e.lastIndexOf("."); if (-1 != t)
        return e.substring(t).toLowerCase(); };
    Te.prototype.getStem = function () { var e = this.getFilename(); if (e) {
        var t_35 = e.split(".");
        return 2 == t_35.length ? t_35[0] : e;
    } };
    Te.prototype.getFileFolder = function () { if (this.__file)
        return this.__file.parent ? be.getFile(this.__file.parent) : be.getRootFolder(); };
    Te.prototype.getFileFolderPath = function () { var e = this.getFilepath(); if (e)
        return e.substring(0, e.lastIndexOf("/")) + "/"; };
    Te.prototype.getFile = function () { return this.__file; };
    Te.prototype.getFileDesc = function () { return this.__file; };
    Te.prototype.setUrl = function (e, t, a) {
        if (a === void 0) { a = E.USER_SETVALUE; }
        var i = e.split("/");
        t || (t = i[i.length - 1]), this.__value = t, this.__file = { id: e, name: t, url: e }, a != E.USER_SETVALUE && a != E.REMOTEUSER_SETVALUE || (this.__flags |= H.USER_EDITED), this.valueChanged.emit(a);
    };
    Te.prototype.getUrl = function () { return this.__file ? this.__file.url : void 0; };
    Te.prototype.setDirty = function (e) { throw new Error("Cannot drive a filepath param from an oporator"); };
    Te.prototype.setValue = function (e, t) {
        var _this = this;
        if (t === void 0) { t = E.USER_SETVALUE; }
        if (null == e)
            throw new Error("Invalid value for setValue.");
        if (e.indexOf(".") > 0)
            return console.warn("Deprecation warning for setValue. setValue should now only take a file id, not a path."), this.setFilepath(e, t);
        if (e == this.__value)
            return;
        var a = e;
        if (!be.resourceAvailable(a))
            return void console.warn("Resource unavailable:" + a);
        var i = be.getFile(a);
        if (this.__reextensions && !this.__reextensions.test(i.name))
            return console.warn("Unsupported file type:" + i.name), !1;
        this.__value = e, this.__file = i, be.fileUpdated.connect(function (e) { e == _this.__value && (_this.__file = be.getFile(_this.__value), _this.fileUpdated.emit()); }), t == E.USER_SETVALUE && (this.__flags |= H.USER_EDITED), this.valueChanged.emit(t);
    };
    Te.prototype.toJSON = function (e, t) { if (0 == (this.__flags & H.USER_EDITED))
        return; var a = {}; return this.__file && (a.value = this.__file.id, a.filepath = be.getFilepath(this.__file.id)), a; };
    Te.prototype.fromJSON = function (e, t, a) { if (e.value) {
        if (e.value.indexOf(".") > 0)
            return void this.setFilepath(e.value, E.DATA_LOAD);
        if (be.resourceAvailable(e.value))
            return this.setValue(e.value, E.DATA_LOAD), void (this.__flags |= H.USER_EDITED);
    } if (e.filepath) {
        var t_36 = be.resolveFilePathToId(e.filepath);
        if (t_36)
            return void this.setValue(t_36, E.DATA_LOAD);
        console.warn("Resource unavailable:" + e.filepath);
    } };
    Te.prototype.clone = function (e) { var t = new Te(this.__name); return t.__file = this.__file, t; };
    Te.prototype.destroy = function () { _super.prototype.destroy.call(this); };
    return Te;
}(Q));
var Ce = /** @class */ (function (_super) {
    __extends(Ce, _super);
    function Ce(e, t) {
        var _this = this;
        _this = _super.call(this, e, []) || this, _this.__dataType = t, _this.elementAdded = new C, _this.elementRemoved = new C;
        return _this;
    }
    Ce.prototype.__filter = function (e) { return !0; };
    Ce.prototype.getCount = function () { return this.__value.length; };
    Ce.prototype.getElement = function (e) { return this.__value[e]; };
    Ce.prototype.setElement = function (e, t) { this.__value[e] = t, this.valueChanged.emit(E.USER_SETVALUE); };
    Ce.prototype.addElement = function (e) { if (null == e)
        e = new this.__dataType;
    else if (!this.__filter(e))
        return; return this.__value.push(e), this.__flags |= H.USER_EDITED, this.elementAdded.emit(e, this.__value.length - 1), this.valueChanged.emit(E.USER_SETVALUE), e; };
    Ce.prototype.removeElement = function (e) { var t = this.__value[e]; this.__value.splice(e, 1), this.__flags |= H.USER_EDITED, this.elementRemoved.emit(t, e), this.valueChanged.emit(E.USER_SETVALUE); };
    Ce.prototype.insertElement = function (e, t) { this.__filter(t) && (this.__value.splice(e, 0, t), this.__flags |= H.USER_EDITED, this.elementAdded.emit(t, e), this.valueChanged.emit(E.USER_SETVALUE)); };
    Ce.prototype.toJSON = function (e, t) { if (0 == (this.__flags & H.USER_EDITED))
        return; var a = []; for (var _b = 0, _c = this.__value; _b < _c.length; _b++) {
        var i_21 = _c[_b];
        "string" == typeof this.__dataType ? a.push(i_21) : a.push(i_21.toJSON(e, t));
    } return { items: a }; };
    Ce.prototype.fromJSON = function (e, t, a) { if (null != e.items) {
        this.__flags |= H.USER_EDITED, this.__value = [];
        for (var a_27 = 0; a_27 < e.items.length; a_27++) {
            var i_22 = void 0;
            "string" == typeof this.__dataType ? i_22 = e.items[a_27] : (i_22 = new this.__dataType, i_22.fromJSON(e.items[a_27], t)), this.__value.push(i_22), this.elementAdded.emit(i_22, this.__value.length - 1);
        }
        this.valueChanged.emit(E.DATA_LOAD);
    }
    else
        console.warn("Invalid Parameter JSON"); };
    Ce.prototype.clone = function (e) { var t = this.__value.slice(0), a = new Ce(this.__name, this.__dataType); return a.setValue(t), a; };
    Ce.prototype.destroy = function () { for (var e_20 = 0; e_20 < this.__value.length; e_20++)
        this.__value[e_20] instanceof Q && this.__value[e_20].destroy(), this.removeElement(e_20); };
    return Ce;
}(Q));
var Ye = /** @class */ (function (_super) {
    __extends(Ye, _super);
    function Ye(e) {
        var _this = this;
        _this = _super.call(this, e, {}, "Struct") || this, _this.__members = [];
        return _this;
    }
    Ye.prototype._addMember = function (e) {
        var _this = this;
        return this.__value[e.getName()] = e.getValue(), e.valueChanged.connect(function () { _this.__value[e.getName()] = e.getValue(); }), this.__members.push(e), this.__flags |= H.USER_EDITED, this.valueChanged.emit(), e;
    };
    Ye.prototype.getParameter = function (e) { for (var _b = 0, _c = this.__members; _b < _c.length; _b++) {
        var t_37 = _c[_b];
        if (t_37.getName() == e)
            return t_37;
    } };
    Ye.prototype.getMember = function (e) { return this.getParameter(e); };
    Ye.prototype.getMemberNames = function () { var e = []; for (var t_38 = 0; t_38 < this.__members.length; t_38++) {
        var a_28 = this.__members[t_38];
        null != a_28 && (e[t_38] = a_28.getName());
    } return e; };
    Ye.prototype.toJSON = function (e, t) { if (0 == (this.__flags & H.USER_EDITED))
        return; var a = []; for (var _b = 0, _c = this.__members; _b < _c.length; _b++) {
        var i_23 = _c[_b];
        a.push(i_23.toJSON(e, t));
    } return { members: a }; };
    Ye.prototype.fromJSON = function (e, t, a) { if (null != e.members) {
        this.__flags |= H.USER_EDITED;
        for (var a_29 = 0; a_29 < e.members.length; a_29++)
            e.members[a_29] && this.__members[a_29].fromJSON(e.members[a_29], t);
    }
    else
        console.warn("Invalid Parameter JSON"); };
    Ye.prototype.destroy = function () { _super.prototype.destroy.call(this); for (var _b = 0, _c = this.__members; _b < _c.length; _b++) {
        var e_21 = _c[_b];
        e_21.destroy();
    } };
    return Ye;
}(Q));
var Ne = /** @class */ (function (_super) {
    __extends(Ne, _super);
    function Ne(e, t) {
        var _this = this;
        _this = _super.call(this, e, void 0, "TreeItem") || this, _this.__filterFn = t, _this.treeItemGlobalXfoChanged = new C;
        return _this;
    }
    Ne.prototype.setOwner = function (e) { this.__owner = e; };
    Ne.prototype.getOwner = function () { return this.__owner; };
    Ne.prototype.setFilterFn = function () { this.__filterFn = filterFn; };
    Ne.prototype.getFilterFn = function () { return this.__filterFn; };
    Ne.prototype.setValue = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        if (this.__filterFn && !this.__filterFn(e))
            return !1;
        this.__value !== e && (this.__value && this.__value.globalXfoChanged.disconnect(this.treeItemGlobalXfoChanged.emit), this.__value = e, this.__value && this.__value.globalXfoChanged.connect(this.treeItemGlobalXfoChanged.emit), t != E.USER_SETVALUE && t != E.REMOTEUSER_SETVALUE || (this.__flags |= H.USER_EDITED), this.valueChanged.emit(t));
    };
    Ne.prototype.toJSON = function (e, t) { if (0 != (this.__flags & H.USER_EDITED))
        return { value: e.makeRelative(this.__value.getPath()) }; };
    Ne.prototype.fromJSON = function (e, t, a) {
        var _this = this;
        null != e.value ? (t.resolvePath(e.value, function (e) { _this.setValue(e); }, function () { console.warn("Unable to resolve tree item parameter value:" + pj.paramPath); }), this.__flags |= H.USER_EDITED) : console.warn("Invalid Parameter JSON");
    };
    Ne.prototype.clone = function (e) { return new Ne(this.__name, this.__filterFn); };
    Ne.prototype.destroy = function () { this.__value && this.__value.parameterValueChanged.disconnect(this.valueParameterValueChanged.emit); };
    return Ne;
}(Q));
var Ke = /** @class */ (function (_super) {
    __extends(Ke, _super);
    function Ke(e, t) {
        var _this = this;
        _this = _super.call(this, e, void 0, "BaseItem") || this, _this.__items = new Set, _this.__filterFn = t, _this.itemAdded = new C, _this.itemRemoved = new C;
        return _this;
    }
    Ke.prototype.setFilterFn = function (e) { this.__filterFn = e; };
    Ke.prototype.getFilterFn = function () { return this.__filterFn; };
    Ke.prototype.getItem = function (e) { return Array.from(this.__items)[e]; };
    Ke.prototype.addItem = function (e, t) {
        if (t === void 0) { t = !0; }
        if (this.__filterFn && !this.__filterFn(e))
            return console.warn("ItemSet __filterFn rejecting item:", e.getPath()), !1;
        this.__items.add(e);
        var a = Array.from(this.__items).indexOf(e);
        return this.itemAdded.emit(e, a), t && this.valueChanged.emit(), a;
    };
    Ke.prototype.addItems = function (e, t) {
        var _this = this;
        if (t === void 0) { t = !0; }
        e.forEach(function (e) { return _this.addItem(e, !1); }), t && this.valueChanged.emit();
    };
    Ke.prototype.removeItem = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = Array.from(this.__items)[e];
        return this.__items.delete(a), this.itemRemoved.emit(a, e), t && this.valueChanged.emit(), a;
    };
    Ke.prototype.setItems = function (e, t) {
        if (t === void 0) { t = !0; }
        for (var t_39 = this.__items.length - 1; t_39 >= 0; t_39--) {
            var a_30 = this.__items[t_39];
            e.has(a_30) || this.removeItem(a_30, !1);
        }
        for (var _b = 0, e_22 = e; _b < e_22.length; _b++) {
            var t_40 = e_22[_b];
            this.__items.has(t_40) || this.addItem(t_40, !1);
        }
        t && this.valueChanged.emit();
    };
    Ke.prototype.clearItems = function (e) {
        if (e === void 0) { e = !0; }
        this.__items.clear(), e && this.valueChanged.emit();
    };
    Ke.prototype.getNumItems = function () { return Array.from(this.__items).length; };
    Ke.prototype.getValue = function () { return this.__items; };
    Ke.prototype.toJSON = function (e, t) { return {}; };
    Ke.prototype.fromJSON = function (e, t, a) { };
    Ke.prototype.clone = function (e) { return new Ke(this.__name, this.__filterFn); };
    return Ke;
}(Q));
var we = /** @class */ (function (_super) {
    __extends(we, _super);
    function we(e, t) {
        var _this = this;
        _this = _super.call(this, e, void 0, t.getDataType()) || this, _this.setSourceParameter(t);
        return _this;
    }
    we.prototype.setSourceParameter = function (e) { this.sourceParameter = e, this.sourceParameter.valueChanged.connect(this.__proxyValueChanged.bind(this)); };
    we.prototype.__proxyValueChanged = function (e) { this.valueChanged.emit(e); };
    we.prototype.getDataType = function () { return this.sourceParameter.getDataType(); };
    we.prototype.setValue = function (e, t) { };
    we.prototype.getValue = function (e) { return this.sourceParameter.getValue(e); };
    we.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return this.sourceParameter && (a.sourceParameter = this.sourceParameter.getPath()), a; };
    we.prototype.fromJSON = function (e, t, a) {
        var _this = this;
        _super.prototype.fromJSON.call(this, e, t, a), e.sourceParameter && t.resolvePath(e.sourceParameter, function (e) { _this.setSourceParameter(e); }, function (t) { console.warn("Error loading Proxy Param: '" + _this.getName() + "'. Unable to connect to:" + e.sourceParameter); }), e.range && (this.sourceParameter = e.range), e.step && (this.__step = e.step);
    };
    we.prototype.clone = function (e, t) { var a = new we(this.__name, this.__value); return this.sourceParameter && this.connectToClonedSourceParam(t), a; };
    we.prototype.connectToClonedSourceParam = function (e) {
        var _this = this;
        e.resolveClonedItem(this.sourceParameter, function (e) { clonedParam.setSourceParameter(e); }, function (e) { console.warn("Error cloning Proxy Param: '" + _this.getName() + "'. Unable to connect to:" + j.sourceParameter); });
    };
    return we;
}(Q));
J.registerClass("ProxyParameter", we);
var ze = /** @class */ (function (_super) {
    __extends(ze, _super);
    function ze(e, t) {
        var _this = this;
        _this = _super.call(this, e, void 0, "Geometry") || this, _this.boundingBoxDirtied = new C, _this.setValue(t);
        return _this;
    }
    ze.prototype.setValue = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        this.__value !== e && (this.__value && this.__value.boundingBoxDirtied.disconnect(this.boundingBoxDirtied.emit), this.__value = e, this.__value && this.__value.boundingBoxDirtied.connect(this.boundingBoxDirtied.emit), t != E.USER_SETVALUE && t != E.REMOTEUSER_SETVALUE || (this.__flags |= H.USER_EDITED), t != E.OPERATOR_SETVALUE && this.valueChanged.emit(t));
    };
    ze.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    ze.prototype.fromJSON = function (e, t, a) { return _super.prototype.fromJSON.call(this, e, t, a); };
    ze.prototype.clone = function (e) { return new ze(this.__name, this.__value); };
    ze.prototype.destroy = function () { this.__value && this.__value.boundingBoxDirtied.disconnect(this.boundingBoxDirtied.emit); };
    return ze;
}(Q));
var Ue = /** @class */ (function (_super) {
    __extends(Ue, _super);
    function Ue(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.width = 0, _this.height = 0, _this.format = "RGB", _this.type = "UNSIGNED_BYTE", _this.addParameter(new fe("AlphaFromLuminance", !1)), _this.addParameter(new fe("Invert", !1)), _this.addParameter(new fe("FlipY", !1)), _this.updated = _this.parameterValueChanged, _this.loaded = new C(!0);
        return _this;
    }
    Ue.prototype.isLoaded = function () { return !0; };
    Ue.prototype.getMapping = function () { return this.__mapping; };
    Ue.prototype.setMapping = function (e) { this.__mapping = e; };
    Ue.prototype.isStream = function () { return !1; };
    Ue.prototype.isStreamAtlas = function () { return this.__streamAtlas; };
    Ue.prototype.getParams = function () { return { type: this.type, format: this.format, width: this.width, height: this.height, flipY: this.getParameter("FlipY").getValue(), invert: this.getParameter("Invert").getValue(), alphaFromLuminance: this.getParameter("AlphaFromLuminance").getValue() }; };
    return Ue;
}(te));
var Je = /** @class */ (function (_super) {
    __extends(Je, _super);
    function Je(e, t, a) {
        var _this = this;
        _this = _super.call(this, e, t, a) || this, _this.textureConnected = new C, _this.textureDisconnected = new C;
        return _this;
    }
    Je.prototype.getImage = function () { return this.__image; };
    Je.prototype.setImage = function (e, t) {
        var _this = this;
        if (t === void 0) { t = 0; }
        var a = function () { _this.textureDisconnected.emit(); };
        e ? (null != this.__image && this.__image !== e && a(), this.__image = e, this.textureConnected.emit(), this.valueChanged.emit(t)) : null != this.__image && (a(), this.__image = void 0, this.textureDisconnected.emit());
    };
    Je.prototype.setValue = function (e) { e instanceof Ue ? this.setImage(e) : (null != this.__image && this.setImage(void 0), _super.prototype.setValue.call(this, e)); };
    Je.prototype.readBinary = function (e, t) { _super.prototype.readBinary.call(this, e, t); var a = e.loadStr(); "" != a && (console.log("Load Texture"), this.setImage(t.materialLibrary.getImage(a))); };
    Je.prototype.clone = function (e) { return new Je(this.__name, this.__value.clone()); };
    return Je;
}(Xe));
J.registerClass("MaterialFloatParam", Je);
var Pe = /** @class */ (function (_super) {
    __extends(Pe, _super);
    function Pe(e, t) {
        var _this = this;
        _this = _super.call(this, e, t) || this, _this.textureConnected = new C, _this.textureDisconnected = new C, _this.__imageUpdated = _this.__imageUpdated.bind(_this);
        return _this;
    }
    Pe.prototype.getImage = function () { return this.__image; };
    Pe.prototype.__imageUpdated = function () { this.valueChanged.emit(); };
    Pe.prototype.setImage = function (e, t) {
        var _this = this;
        if (t === void 0) { t = 0; }
        var a = function () { _this.__image.loaded.disconnect(_this.__imageUpdated), _this.__image.updated.disconnect(_this.__imageUpdated), _this.__image = null, _this.textureDisconnected.emit(); };
        e ? (null != this.__image && this.__image !== e && a(), this.__image = e, this.__image.updated.connect(this.__imageUpdated), this.textureConnected.emit(), this.valueChanged.emit(t)) : null != this.__image && (a(), this.__image = void 0, this.textureDisconnected.emit());
    };
    Pe.prototype.setValue = function (e) { e instanceof Ue ? this.setImage(e) : (null != this.__image && this.setImage(void 0), _super.prototype.setValue.call(this, e)); };
    Pe.prototype.readBinary = function (e, t) { _super.prototype.readBinary.call(this, e, t); var a = e.loadStr(); "" != a && this.setImage(t.materialLibrary.getImage(a)); };
    Pe.prototype.clone = function (e) { return new Pe(this.__name, this.__value.clone()); };
    return Pe;
}(xe));
J.registerClass("MaterialColorParam", Pe);
var Ee = function (e, t, a, i) { return "boolean" == typeof t || !1 === t || !0 === t ? new Q(e, t, "Boolean") : "string" == typeof t ? new Q(e, t, "String") : Number.isNumeric(t) ? i ? new Je(e, t, a) : new Xe(e, t, a) : t instanceof _ ? new Ve(e, t) : t instanceof Z ? new Ie(e, t) : t instanceof y ? i ? new Pe(e, t) : new xe(e, t) : new Q(e, t); };
var He = /** @class */ (function (_super) {
    __extends(He, _super);
    function He(e, t) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.shaderNameChanged = new C, _this.visibleInGeomDataBuffer = !0, t && _this.setShaderName(t);
        return _this;
    }
    He.prototype.getShaderName = function () { return this.__shaderName; };
    He.prototype.setShaderName = function (e) { if (this.__shaderName == e)
        return; var t = J.getClass(e); if (!t)
        throw new Error("Error setting Shader. Shader not found:" + e); var a = t.getParamDeclarations(), i = {}; for (var _b = 0, a_31 = a; _b < a_31.length; _b++) {
        var e_23 = a_31[_b];
        var t_41 = this.getParameter(e_23.name);
        t_41 || (t_41 = this.addParameter(Ee(e_23.name, e_23.defaultValue, e_23.range, 0 != e_23.texturable))), i[e_23.name] = !0;
    } for (var _c = 0, _d = this.__params; _c < _d.length; _c++) {
        var e_24 = _d[_c];
        i[e_24.getName()] || this.removeParameter(e_24.getName());
    } this.__shaderName = e, this.shaderNameChanged.emit(this.__shaderName); };
    He.prototype.removeAllTextures = function () { for (var _b = 0, _c = this.__params; _b < _c.length; _b++) {
        var e_25 = _c[_b];
        e_25.getImage && e_25.getImage() && e_25.setImage(void 0);
    } };
    He.prototype.getParamTextures = function () { var e = {}; for (var _b = 0, _c = this.__params; _b < _c.length; _b++) {
        var t_42 = _c[_b];
        t_42.getImage && t_42.getImage() && (e[t_42.getName()] = t_42.getImage());
    } return e; };
    He.prototype.__makeParameterTexturable = function (e) { makeParameterTexturable(e); };
    He.prototype.isTransparent = function () { var e = this.getParameter("Opacity"); if (e && (e.getValue() < .99 || e.getImage()))
        return !0; var t = this.getParameter("BaseColor"); return !(!t || !t.getImage() || "RGBA" != t.getImage().format); };
    He.prototype.getShaderClass = function () { return J.getClass(this.getShaderName()); };
    He.prototype.modifyParams = function (e, t) { t && this.setShaderName(t); for (var t_43 in e) {
        var a_32 = this.getParameter(t_43);
        a_32 && (e[t_43] instanceof Q ? this.replaceParameter(e[t_43]) : a_32.setValue(e[t_43]));
    } };
    He.prototype.toJSON = function (e, t) {
        if (t === void 0) { t = 0; }
        return _super.prototype.toJSON.call(this, e, t);
    };
    He.prototype.fromJSON = function (e, t, a) {
        if (t === void 0) { t = {}; }
        if (a === void 0) { a = 0; }
        e.shader ? (this.setShaderName(e.shader), _super.prototype.fromJSON.call(this, e, t, a)) : console.warn("Invalid Material JSON");
    };
    He.prototype.readBinary = function (e, t) { var a = e.loadStr(); if ("StandardMaterial" == a && (a = "StandardSurfaceShader"), "TransparentMaterial" == a && (a = "TransparentSurfaceShader"), this.setShaderName(a), t.versions["zea-engine"].lessThan([0, 0, 3])) {
        this.setName(e.loadStr());
        var a_33 = e.loadUInt32();
        for (var s = 0; s < a_33; s++) {
            var a_34 = (i = e.loadStr()).charAt(0).toUpperCase() + i.slice(1);
            var s_2 = void 0;
            "MaterialColorParam" == e.loadStr() ? (s_2 = e.loadRGBAFloat32Color(), s_2.applyGamma(2.2)) : s_2 = e.loadFloat32();
            var n = e.loadStr();
            var l = this.getParameter(a_34);
            l ? l.setValue(s_2) : l = this.addParameter(Ee(a_34, s_2)), "" != n && l.setImage && (t.materialLibrary.hasImage(n) ? l.setImage(t.materialLibrary.getImage(n)) : console.warn("Missing Texture:" + n));
        }
    }
    else
        _super.prototype.readBinary.call(this, e, t); var i; };
    He.prototype.clone = function (e) { var t = new He; return t.copyFrom(this, e), t; };
    He.prototype.copyFrom = function (e, t) { _super.prototype.copyFrom.call(this, e, t), this.setShaderName(e.getShaderName()); for (var _b = 0, _c = e.getParameters(); _b < _c.length; _b++) {
        var t_44 = _c[_b];
        var a_35 = e.getParameter(t_44.getName());
        t_44.getImage || this.__makeParameterTexturable(a_35);
    } };
    He.prototype.destroy = function () { this.removeAllTextures(), _super.prototype.destroy.call(this); };
    return He;
}(te));
var ke = /** @class */ (function (_super) {
    __extends(ke, _super);
    function ke(e) {
        var _this = this;
        _this = _super.call(this) || this, null == e && (e = _this.constructor.name), _this.__name = e, _this.format = "RGBA", _this.type = "UNSIGNED_BYTE", _this.__loaded = !1, _this.width = 1, _this.height = 1;
        return _this;
    }
    ke.prototype.isLoaded = function () { return this.__loaded; };
    ke.prototype.getName = function () { return this.__name; };
    ke.prototype.isStream = function () { return !1; };
    ke.prototype.setData = function (e, t, a) { this.width = e, this.height = t, this.__data = a, this.__loaded ? this.updated.emit() : (this.__loaded = !0, this.loaded.emit()); };
    ke.prototype.getParams = function () { var e = _super.prototype.getParams.call(this); return e.data = this.__data, e; };
    return ke;
}(Ue));
function Be(e) { this.data = e, this.pos = 0; }
function De(e) { this.stream = new Be(e), this.output = {}; }
J.registerClass("DataImage2D", ke), J.registerClass("DataImage", ke), Be.prototype.readByte = function () { return this.data[this.pos++]; }, Be.prototype.peekByte = function () { return this.data[this.pos]; }, Be.prototype.readBytes = function (e) { for (var t = new Array(e), a = 0; a < e; a++)
    t[a] = this.readByte(); return t; }, Be.prototype.peekBytes = function (e) { for (var t = new Array(e), a = 0; a < e; a++)
    t[a] = this.data[this.pos + a]; return t; }, Be.prototype.readString = function (e) { for (var t = "", a = 0; a < e; a++)
    t += String.fromCharCode(this.readByte()); return t; }, Be.prototype.readBitArray = function () { for (var e = [], t = this.readByte(), a = 7; a >= 0; a--)
    e.push(!!(t & 1 << a)); return e; }, Be.prototype.readUnsigned = function (e) { var t = this.readBytes(2); return e ? (t[1] << 8) + t[0] : (t[0] << 8) + t[1]; }, De.prototype.parse = function (e) { return this.parseParts(this.output, e), this.output; }, De.prototype.parseParts = function (e, t) { for (var a = 0; a < t.length; a++) {
    var i = t[a];
    this.parsePart(e, i);
} }, De.prototype.parsePart = function (e, t) { var a, i = t.label; if (!t.requires || t.requires(this.stream, this.output, e))
    if (t.loop) {
        for (var s = []; t.loop(this.stream);) {
            var n = {};
            this.parseParts(n, t.parts), s.push(n);
        }
        e[i] = s;
    }
    else
        t.parts ? (a = {}, this.parseParts(a, t.parts), e[i] = a) : t.parser ? (a = t.parser(this.stream, this.output, e), t.skip || (e[i] = a)) : t.bits && (e[i] = this.parseBits(t.bits)); }, De.prototype.parseBits = function (e) { var t = {}, a = this.stream.readBitArray(); for (var i in e) {
    var s = e[i];
    s.length ? t[i] = a.slice(s.index, s.index + s.length).reduce((function (e, t) { return 2 * e + t; }), 0) : t[i] = a[s.index];
} return t; };
var Oe = function () { return function (e) { return e.readByte(); }; }, Qe = function (e) { return function (t) { return t.readBytes(e); }; }, Ae = function (e) { return function (t) { return t.readString(e); }; }, je = function (e) { return function (t) { return t.readUnsigned(e); }; }, qe = function (e, t) { return function (a, i, s) { for (var n = t(a, i, s), l = new Array(n), r = 0; r < n; r++)
    l[r] = a.readBytes(e); return l; }; }, $e = { label: "blocks", parser: function (e) { for (var t = [], a = e.readByte(); 0 !== a; a = e.readByte())
        t = t.concat(e.readBytes(a)); return t; } }, et = { label: "gce", requires: function (e) { var t = e.peekBytes(2); return 33 === t[0] && 249 === t[1]; }, parts: [{ label: "codes", parser: Qe(2), skip: !0 }, { label: "byteSize", parser: Oe() }, { label: "extras", bits: { future: { index: 0, length: 3 }, disposal: { index: 3, length: 3 }, userInput: { index: 6 }, transparentColorGiven: { index: 7 } } }, { label: "delay", parser: je(!0) }, { label: "transparentColorIndex", parser: Oe() }, { label: "terminator", parser: Oe(), skip: !0 }] }, tt = { label: "image", requires: function (e) { return 44 === e.peekByte(); }, parts: [{ label: "code", parser: Oe(), skip: !0 }, { label: "descriptor", parts: [{ label: "left", parser: je(!0) }, { label: "top", parser: je(!0) }, { label: "width", parser: je(!0) }, { label: "height", parser: je(!0) }, { label: "lct", bits: { exists: { index: 0 }, interlaced: { index: 1 }, sort: { index: 2 }, future: { index: 3, length: 2 }, size: { index: 5, length: 3 } } }] }, { label: "lct", requires: function (e, t, a) { return a.descriptor.lct.exists; }, parser: qe(3, (function (e, t, a) { return Math.pow(2, a.descriptor.lct.size + 1); })) }, { label: "data", parts: [{ label: "minCodeSize", parser: Oe() }, $e] }] }, it = { label: "text", requires: function (e) { var t = e.peekBytes(2); return 33 === t[0] && 1 === t[1]; }, parts: [{ label: "codes", parser: Qe(2), skip: !0 }, { label: "blockSize", parser: Oe() }, { label: "preData", parser: function (e, t, a) { return e.readBytes(a.text.blockSize); } }, $e] }, st = { label: "frames", parts: [et, { label: "application", requires: function (e, t, a) { var i = e.peekBytes(2); return 33 === i[0] && 255 === i[1]; }, parts: [{ label: "codes", parser: Qe(2), skip: !0 }, { label: "blockSize", parser: Oe() }, { label: "id", parser: function (e, t, a) { return e.readString(a.blockSize); } }, $e] }, { label: "comment", requires: function (e, t, a) { var i = e.peekBytes(2); return 33 === i[0] && 254 === i[1]; }, parts: [{ label: "codes", parser: Qe(2), skip: !0 }, $e] }, tt, it], loop: function (e) { var t = e.peekByte(); return 33 === t || 44 === t; } }, nt = [{ label: "header", parts: [{ label: "signature", parser: Ae(3) }, { label: "version", parser: Ae(3) }] }, { label: "lsd", parts: [{ label: "width", parser: je(!0) }, { label: "height", parser: je(!0) }, { label: "gct", bits: { exists: { index: 0 }, resolution: { index: 1, length: 3 }, sort: { index: 4 }, size: { index: 5, length: 3 } } }, { label: "backgroundColorIndex", parser: Oe() }, { label: "pixelAspectRatio", parser: Oe() }] }, { label: "gct", requires: function (e, t) { return t.lsd.gct.exists; }, parser: qe(3, (function (e, t) { return Math.pow(2, t.lsd.gct.size + 1); })) }, st];
function lt(e) { var t = new De(new Uint8Array(e)); this.raw = t.parse(nt), this.raw.hasImages = !1; for (var a = 0; a < this.raw.frames.length; a++)
    if (this.raw.frames[a].image) {
        this.raw.hasImages = !0;
        break;
    } }
lt.prototype.decompressFrame = function (e, t) { if (e >= this.raw.frames.length)
    return null; var a = this.raw.frames[e]; if (a.image) {
    var i = a.image.descriptor.width * a.image.descriptor.height, s = function (e, t, a) { var i, s, n, l, r, o, d, h, c, m, u, b, p, g, _, Z, G = a, X = new Array(a), y = new Array(4096), f = new Array(4096), V = new Array(4097); for (r = (s = 1 << (b = e)) + 1, i = s + 2, d = -1, n = (1 << (l = b + 1)) - 1, c = 0; c < s; c++)
        y[c] = 0, f[c] = c; for (u = h = p = g = Z = _ = 0, m = 0; m < G;) {
        if (0 === g) {
            if (h < l) {
                u += t[_] << h, h += 8, _++;
                continue;
            }
            if (c = u & n, u >>= l, h -= l, c > i || c == r)
                break;
            if (c == s) {
                n = (1 << (l = b + 1)) - 1, i = s + 2, d = -1;
                continue;
            }
            if (-1 == d) {
                V[g++] = f[c], d = c, p = c;
                continue;
            }
            for (o = c, c == i && (V[g++] = p, c = d); c > s;)
                V[g++] = f[c], c = y[c];
            p = 255 & f[c], V[g++] = p, i < 4096 && (y[i] = d, f[i] = p, 0 == (++i & n) && i < 4096 && (l++, n += i)), d = o;
        }
        g--, X[Z++] = V[g], m++;
    } for (m = Z; m < G; m++)
        X[m] = 0; return X; }(a.image.data.minCodeSize, a.image.data.blocks, i);
    a.image.descriptor.lct.interlaced && (s = function (e, t) { for (var a = new Array(e.length), i = e.length / t, s = function (i, s) { var n = e.slice(s * t, (s + 1) * t); a.splice.apply(a, [i * t, t].concat(n)); }, n = [0, 4, 2, 1], l = [8, 8, 4, 2], r = 0, o = 0; o < 4; o++)
        for (var d = n[o]; d < i; d += l[o])
            s(d, r), r++; return a; }(s, a.image.descriptor.width));
    var n = { pixels: s, dims: { top: a.image.descriptor.top, left: a.image.descriptor.left, width: a.image.descriptor.width, height: a.image.descriptor.height } };
    return a.image.descriptor.lct && a.image.descriptor.lct.exists ? n.colorTable = a.image.lct : n.colorTable = this.raw.gct, a.gce && (n.delay = 10 * (a.gce.delay || 10), n.disposalType = a.gce.extras.disposal, a.gce.extras.transparentColorGiven && (n.transparentIndex = a.gce.transparentColorIndex)), t && (n.patch = function (e) { for (var t = e.pixels.length, a = new Uint8ClampedArray(4 * t), i = 0; i < t; i++) {
        var s = 4 * i, n = e.pixels[i], l = e.colorTable[n];
        a[s] = l[0], a[s + 1] = l[1], a[s + 2] = l[2], a[s + 3] = n !== e.transparentIndex ? 255 : 0;
    } return a; }(n)), n;
} return null; }, lt.prototype.decompressFrames = function (e) { for (var t = [], a = 0; a < this.raw.frames.length; a++) {
    this.raw.frames[a].image && t.push(this.decompressFrame(a, e));
} return t; };
var rt = {}, ot = {}, dt = -1 !== navigator.userAgent.indexOf("Chrome");
var ht = /** @class */ (function (_super) {
    __extends(ht, _super);
    function ht(e, t, a) {
        if (t === void 0) { t = ""; }
        if (a === void 0) { a = {}; }
        var _this = this;
        t.constructor == Object && (a = t), null != e && -1 != e.lastIndexOf(".") && (console.warn("Deprecated signature. Please provide a name and filepath to the image constructor"), e = e.substring(e.lastIndexOf("/") + 1, e.lastIndexOf("."))), _this = _super.call(this, e, a) || this, _this.__loaded = !1;
        var i = _this.addParameter(new Te("FilePath"));
        i.valueChanged.connect(function () { if (_this.loaded.untoggle(), _this.getName() == J.getClassName(_this)) {
            var e_26 = i.getStem(), t_45 = e_26.substring(e_26.length - 1);
            isNaN(t_45) ? _this.setName(e_26) : _this.setName(e_26.substring(0, e_26.length - 1));
        } var e = i.getFileDesc(); e && _this.__loadData(e); }), t && "" != t && i.setFilepath(t);
        return _this;
    }
    ht.__imageDataLibrary = function () { return rt; };
    ht.registerLoader = function (e, t) { ot[e] = t; };
    ht.constructLoader = function (e, t) { for (var _b = 0, ot_1 = ot; _b < ot_1.length; _b++) {
        var a_36 = ot_1[_b];
        if (new RegExp("\\.(" + a_36 + ")$", "i").test(e.name)) {
            var i_24 = new ot[a_36](t);
            if (i_24)
                return i_24.getParameter("FilePath").setValue(e.id), i_24;
        }
    } };
    ht.prototype.__loadData = function (e) { var t = this.getParameter("FilePath").getExt(); if (".jpg" == t || ".png" == t || ".webp" == t)
        this.__loadLDRImage(e, t);
    else if (".mp4" == t || ".ogg" == t)
        this.__loadLDRVideo(e);
    else if (".vlh" == t)
        this.__loadVLH(e);
    else if (".gif" == t)
        this.__loadGIF(e);
    else {
        if (".svg" != t)
            throw new Error("Unsupported file type. Check the ext:" + e);
        console.warn("SVG Image not yet supported");
    } };
    ht.prototype.__loadLDRImage = function (e, a) {
        var _this = this;
        var i;
        ".jpg" == a ? this.format = "RGB" : ".png" == a && (this.format = "RGBA"), this.type = "UNSIGNED_BYTE";
        var s = function () { _this.getDOMElement = function () { return i; }, _this.width = i.width, _this.height = i.height, _this.__data = i, _this.__loaded = !0, _this.loaded.emit(); };
        if (e.id in rt)
            i = rt[e.id], i.complete ? s() : i.addEventListener("load", s);
        else {
            be.addWork(e.id, 1);
            var a_37 = this.addParameter(new Xe("PreferredSize", -1));
            var n = e.url;
            if (e.assets && Object.keys(e.assets).length > 0) {
                var i_25 = { maxSize: t.gpuDesc.maxTextureSize }, s_3 = a_37.getValue();
                -1 == s_3 ? e.assets.reduce && (i_25.prefSize = e.assets.reduce.w) : i_25.prefSize = s_3;
                var l = function (e, t) { if (t = t.filter(function (e) { return null !== e; }), dt) {
                    var e_27 = t.filter(function (e) { return "webp" === e.format; });
                    e_27.length > 1 && (t = e_27);
                }
                else
                    t = t.filter(function (e) { return "webp" !== e.format; }); if (e.maxSize && (t = t.filter(function (t) { return t.w <= e.maxSize; })), e.filter) {
                    var a_38 = t.filter(function (t) { return -1 !== t.url.indexOf(e.filter); });
                    a_38.length > 1 && (t = a_38);
                } if (e.prefSize && (t = t.map(function (t) { return Object.assign({ score: Math.abs(e.prefSize - t.w) }, t); })).sort(function (e, t) { return e.score > t.score ? 1 : e.score < t.score ? -1 : 0; }), t.length > 0)
                    return t[0]; }(i_25, Object.values(e.assets));
                l && (console.log("Selected image:" + e.name + " format:" + l.format + " :" + l.w + "x" + l.h + " url:" + l.url), n = l.url);
            }
            else
                console.warn("Images not processed for this file:" + e.name);
            i = new Image, i.crossOrigin = "anonymous", i.src = n, i.addEventListener("load", s), i.addEventListener("load", function () { be.addWorkDone(e.id, 1); }), rt[e.id] = i;
        }
    };
    ht.prototype.__removeVideoParams = function () { this.getParameterIndex("spatializeAudio") && (this.removeParameter(this.getParameterIndex("Loop")), this.removeParameter(this.getParameterIndex("spatializeAudio")), this.removeParameter(this.getParameterIndex("Gain")), this.removeParameter(this.getParameterIndex("refDistance")), this.removeParameter(this.getParameterIndex("maxDistance")), this.removeParameter(this.getParameterIndex("rolloffFactor")), this.removeParameter(this.getParameterIndex("coneInnerAngle")), this.removeParameter(this.getParameterIndex("coneOuterAngle")), this.removeParameter(this.getParameterIndex("coneOuterGain"))); };
    ht.prototype.__loadLDRVideo = function (e) {
        var _this = this;
        this.format = "RGB", this.type = "UNSIGNED_BYTE", be.addWork(e.id, 1);
        var t = this.addParameter(new fe("Mute", !0)), a = this.addParameter(new fe("Loop", !0)), i = document.createElement("video");
        i.style.display = "none", i.preload = "auto", i.crossOrigin = "anonymous", this.getAudioSource = function () { return i; }, document.body.appendChild(i), i.addEventListener("loadedmetadata", function () { i.muted = t.getValue(), t.valueChanged.connect(function () { i.muted = t.getValue(); }), i.loop = a.getValue(), a.valueChanged.connect(function () { i.loop = a.getValue(); }), _this.width = i.videoHeight, _this.height = i.videoWidth, _this.__data = i, _this.__loaded = !0, be.addWorkDone(e.id, 1), _this.loaded.emit(i), i.play().then(function () { var e = 0; var t = function () { if (i.paused || i.ended)
            return; var a = Math.floor(29.97 * i.currentTime); e != a && (_this.updated.emit(), e = a), setTimeout(t, 20); }; t(); }, function (e) { console.log("Autoplay was prevented.", e, e.message); }); }, !1), i.src = e.url;
    };
    ht.prototype.__loadVLH = function (e) {
        var _this = this;
        this.type = "FLOAT";
        var t = new y(1, 1, 1, 1);
        this.setHDRTint = function (e) { t = e; }, this.getHDRTint = function () { return t; }, be.loadUrl(e.id, e.url, function (e) { var t, a; for (var i_26 in e)
            i_26.endsWith(".jpg") ? t = e[i_26] : i_26.endsWith(".bin") && (a = e[i_26]); var i = new Blob([t.buffer]), s = new Image; s.onload = function () { _this.width = s.width, _this.height = s.height, _this.__data = { ldr: s, cdm: a }, _this.__loaded ? _this.updated.emit() : (_this.__loaded = !0, _this.loaded.emit()); }, s.src = URL.createObjectURL(i); });
    };
    ht.prototype.__loadGIF = function (e) {
        var _this = this;
        var t, a, i;
        this.format = "RGBA", this.type = "UNSIGNED_BYTE", this.__streamAtlas = !0, this.addParameter(new Re("StreamAtlasDesc", new G)), this.addParameter(new Xe("StreamAtlasIndex", 0)), this.getParameter("StreamAtlasIndex").setRange([0, 1]), this.getFrameDelay = function () { return 20; }, this.play = function () { i.then(function () { t = !0, a && a(); }); }, this.stop = function () { t = !1; }, e.id in rt ? i = rt[e.id] : (i = new Promise(function (t, a) { if (be.addWork(e.id, 1), e.assets && e.assets.atlas) {
            var a_39 = new Image;
            return a_39.crossOrigin = "anonymous", a_39.src = e.assets.atlas.url, void a_39.addEventListener("load", function () { t({ width: e.assets.atlas.width, height: e.assets.atlas.height, atlasSize: e.assets.atlas.atlasSize, frameDelays: e.assets.atlas.frameDelays, frameRange: [0, e.assets.atlas.frameDelays.length], imageData: a_39 }), be.addWorkDone(e.id, 1); });
        } re(e.url, function (a) { console.warn("Unpacking Gif client side:" + e.name); var i = performance.now(), s = new lt(a).decompressFrames(!0), n = Math.sqrt(s.length), l = [n, n]; Math.fract(n) > 0 && (l[0] = Math.floor(l[0] + 1), Math.fract(n) > .5 ? l[1] = Math.floor(l[1] + 1) : l[1] = Math.floor(l[1])); var r = s[0].dims.width, o = s[0].dims.height, d = document.createElement("canvas"), h = d.getContext("2d"), c = document.createElement("canvas"), m = c.getContext("2d"); c.width = r, c.height = o; var u = document.createElement("canvas"), b = u.getContext("2d"); var p; u.width = l[0] * r, u.height = l[1] * o; var g = [], _ = function (e, t) { var a = e.dims; g.push(e.delay / 10), p && a.width == p.width && a.height == p.height || (d.width = a.width, d.height = a.height, p = h.createImageData(a.width, a.height)), p.data.set(e.patch), h.putImageData(p, 0, 0), 2 == e.disposalType && m.clearRect(0, 0, c.width, c.height), m.drawImage(d, a.left, a.top), b.drawImage(c, t % l[0] * r, Math.floor(t / l[0]) * o); }; for (var e_28 = 0; e_28 < s.length; e_28++)
            _(s[e_28], e_28); be.addWorkDone(e.id, 1); var Z = b.getImageData(0, 0, u.width, u.height), G = performance.now() - i; console.log("Decode GIF '" + e.name + "' time:" + G), t({ width: u.width, height: u.height, atlasSize: l, frameRange: [0, s.length], frameDelays: g, imageData: Z }); }, function (t) { console.warn("Unable to Load URL:" + t + ":" + e.url), a(); }); }), rt[e.id] = i), i.then(function (e) { _this.width = e.width, _this.height = e.height, _this.getParameter("StreamAtlasDesc").setValue(new G(e.atlasSize[0], e.atlasSize[1], 0, 0)), _this.getParameter("StreamAtlasIndex").setRange(e.frameRange), _this.__data = e.imageData, _this.getFrameDelay = function (t) { return 10 * e.frameDelays[t]; }; var i = _this.getParameter("StreamAtlasIndex"), s = i.getRange()[1]; var n = 0; a = function () { i.setValue(n), t && setTimeout(a, _this.getFrameDelay(n)), n = (n + 1) % s; }, t && a(), _this.__loaded = !0, _this.loaded.emit(); });
    };
    ht.prototype.getFilepath = function () { return this.getParameter("FilePath").getValue(); };
    ht.prototype.isStream = function () { return !1; };
    ht.prototype.isLoaded = function () { return this.__loaded; };
    ht.prototype.getParams = function () { var e = _super.prototype.getParams.call(this); return this.__loaded && (e.data = this.__data), e; };
    ht.prototype.toJSON = function (e, t) { };
    ht.prototype.fromJSON = function (e, t, a) { };
    ht.prototype.readBinary = function (e, t) { this.setName(e.loadStr()); var a = e.loadStr(); if ("string" == typeof a && "" != a) {
        if (t.lod >= 0) {
            var e_29 = a.lastIndexOf(".");
            if (-1 != e_29) {
                var i_27 = a.substring(0, e_29) + t.lod + a.substring(e_29);
                be.resolveFilepath(i_27) && (a = i_27);
            }
        }
        this.getParameter("FilePath").setFilepath(a);
    } };
    return ht;
}(Ue));
var ct = /** @class */ (function (_super) {
    __extends(ct, _super);
    function ct(e, t) {
        if (t === void 0) { t = {}; }
        var _this = this;
        console.warn("FileImage2D is becoming deprecated in favor of simple FileImage"), _this = _super.call(this, e, t) || this;
        return _this;
    }
    return ct;
}(ht));
J.registerClass("FileImage2D", ht), J.registerClass("FileImage", ht);
var mt = -1 !== navigator.userAgent.indexOf("Chrome");
var ut = /** @class */ (function (_super) {
    __extends(ut, _super);
    function ut(e, t, a) {
        var _this = this;
        _this = _super.call(this, e, t, a) || this, _this.type = "UNSIGNED_BYTE", _this.addParameter(new Xe("PreferredSize", -1)), _this.__crossOrigin = "anonymous";
        return _this;
    }
    ut.prototype.setCrossOrigin = function (e) { this.__crossOrigin = e; };
    ut.prototype.__loadData = function (e) { ".png" == this.getParameter("FilePath").getExt() && (this.format = "RGBA"); var a = e.url; if (e.assets && Object.keys(e.assets).length > 0) {
        var i_28 = { maxSize: t.gpuDesc.maxTextureSize }, s = this.getParameter("PreferredSize").getValue();
        -1 == s ? e.assets.reduce && (i_28.prefSize = e.assets.reduce.w) : i_28.prefSize = s;
        var n = function (e, t) { if (t = t.filter(function (e) { return null !== e; }), mt) {
            var e_30 = t.filter(function (e) { return "webp" === e.format; });
            e_30.length > 1 && (t = e_30);
        }
        else
            t = t.filter(function (e) { return "webp" !== e.format; }); if (e.maxSize && (t = t.filter(function (t) { return t.w <= e.maxSize; })), e.filter) {
            var a_40 = t.filter(function (t) { return -1 !== t.url.indexOf(e.filter); });
            a_40.length > 1 && (t = a_40);
        } if (e.prefSize && (t = t.map(function (t) { return Object.assign({ score: Math.abs(e.prefSize - t.w) }, t); })).sort(function (e, t) { return e.score > t.score ? 1 : e.score < t.score ? -1 : 0; }), t.length > 0)
            return t[0]; }(i_28, Object.values(e.assets));
        n && (console.log("Selected image:" + e.name + " format:" + n.format + " :" + n.w + "x" + n.h + " url:" + n.url), a = n.url);
    }
    else
        console.warn("Images not processed for this file:" + e.name); this.setImageURL(a, "RGB"); };
    ut.prototype.setImageURL = function (e, t) {
        var _this = this;
        if (t === void 0) { t = "RGB"; }
        if (!t) {
            var a_41 = e.lastIndexOf(".");
            if (-1 != a_41) {
                ".png" == e.substring(a_41).toLowerCase() && (t = "RGBA");
            }
        }
        var a;
        this.format = t, this.__loaded = !1;
        var i = function () { _this.getDOMElement = function () { return a; }, _this.width = a.width, _this.height = a.height, _this.__data = a, _this.__loaded = !0, _this.loaded.emit(); }, s = ht.__imageDataLibrary();
        e in s ? (a = s[e], a.complete ? i() : a.addEventListener("load", i)) : (a = new Image, a.crossOrigin = this.__crossOrigin, a.src = e, a.addEventListener("load", i), s[e] = a);
    };
    return ut;
}(ht));
ht.registerLoader("jpg|jpeg|png", ut), J.registerClass("LDRImage", ut);
var bt = /** @class */ (function (_super) {
    __extends(bt, _super);
    function bt(e, t, a) {
        var _this = this;
        _this = _super.call(this, e, t, a) || this, _this.format = "RGB", _this.type = "UNSIGNED_BYTE", _this.addParameter(new fe("Mute", !1)), _this.addParameter(new fe("Loop", !0)), _this.addParameter(new Xe("Gain", 2)).setRange([0, 5]), _this.addParameter(new fe("SpatializeAudio", !0)), _this.addParameter(new Xe("refDistance", 2)), _this.addParameter(new Xe("maxDistance", 1e4)), _this.addParameter(new Xe("rolloffFactor", 1)), _this.addParameter(new Xe("coneInnerAngle", 360)), _this.addParameter(new Xe("coneOuterAngle", 0)), _this.addParameter(new Xe("coneOuterGain", 1));
        return _this;
    }
    bt.prototype.__loadData = function (e) {
        var _this = this;
        be.addWork(e.id, 1);
        var t = document.createElement("video");
        t.style.display = "none", t.preload = "auto", t.crossOrigin = "anonymous", this.getAudioSource = function () { return t; }, document.body.appendChild(t), t.addEventListener("loadedmetadata", function () { var a = _this.getParameter("Mute"); t.muted = a.getValue(), a.valueChanged.connect(function () { t.muted = a.getValue(); }); var i = _this.getParameter("Loop"); t.loop = i.getValue(), i.valueChanged.connect(function () { t.loop = i.getValue(); }), _this.width = t.videoHeight, _this.height = t.videoWidth, _this.__data = t, _this.__loaded = !0, be.addWorkDone(e.id, 1), _this.loaded.emit(t); var s = 0; var n = function () { if (t.paused || t.ended)
            return; var e = Math.floor(29.97 * t.currentTime); s != e && (_this.updated.emit(), s = e), setTimeout(n, 20); }; n(); }, !1), t.src = e.url;
        var a = t.play();
        void 0 !== a && a.then(function (e) { console.log("Autoplay started!"); }).catch(function () { console.log("Autoplay was prevented."); });
    };
    return bt;
}(ht));
ht.registerLoader("mp4|ogg", bt), J.registerClass("LDRVideo", bt);
var pt = /** @class */ (function (_super) {
    __extends(pt, _super);
    function pt(e, t, a) {
        if (t === void 0) { t = ""; }
        if (a === void 0) { a = {}; }
        var _this = this;
        _this = _super.call(this, e, t, a) || this, _this.format = "RGBA", _this.type = "UNSIGNED_BYTE", _this.__streamAtlas = !0, _this.getParameter("FilePath").setSupportedExts("gif"), _this.addParameter(new Re("StreamAtlasDesc")), _this.addParameter(new Xe("StreamAtlasIndex", 0));
        var i = _this.getParameter("StreamAtlasIndex");
        var s;
        i.setRange([0, 1]);
        var n = 0;
        var l = function (e) { i.setValue(n), s && setTimeout(function () { return l(e); }, _this.getFrameDelay(n)), n = (n + 1) % e; };
        _this.play = function () { _this.__resourcePromise.then(function () { s = !0; var e = i.getRange()[1]; l(e); }); }, _this.stop = function () { s = !1; };
        return _this;
    }
    pt.prototype.getFrameDelay = function (e) { return 10 * this.__unpackedData.frameDelays[e]; };
    pt.prototype.__loadData = function (e) {
        var _this = this;
        var t = ht.__imageDataLibrary();
        e.id in t ? this.__resourcePromise = t[e.id] : (this.__resourcePromise = new Promise(function (t, a) { if (be.addWork(e.id, 1), e.assets && e.assets.atlas) {
            var a_42 = new Image;
            return a_42.crossOrigin = "anonymous", a_42.src = e.assets.atlas.url, void a_42.addEventListener("load", function () { t({ width: e.assets.atlas.width, height: e.assets.atlas.height, atlasSize: e.assets.atlas.atlasSize, frameDelays: e.assets.atlas.frameDelays, frameRange: [0, e.assets.atlas.frameDelays.length], imageData: a_42 }), be.addWorkDone(e.id, 1); });
        } re(e.url, function (a) { console.warn("Unpacking Gif client side:" + e.name); var i = performance.now(), s = new lt(a).decompressFrames(!0), n = Math.sqrt(s.length), l = [n, n]; Math.fract(n) > 0 && (l[0] = Math.floor(l[0] + 1), Math.fract(n) > .5 ? l[1] = Math.floor(l[1] + 1) : l[1] = Math.floor(l[1])); var r = s[0].dims.width, o = s[0].dims.height, d = document.createElement("canvas"), h = d.getContext("2d"), c = document.createElement("canvas"), m = c.getContext("2d"); c.width = r, c.height = o; var u = document.createElement("canvas"), b = u.getContext("2d"); var p; u.width = l[0] * r, u.height = l[1] * o; var g = [], _ = function (e, t) { var a = e.dims; g.push(e.delay / 10), p && a.width == p.width && a.height == p.height || (d.width = a.width, d.height = a.height, p = h.createImageData(a.width, a.height)), p.data.set(e.patch), h.putImageData(p, 0, 0), 2 == e.disposalType && m.clearRect(0, 0, c.width, c.height), m.drawImage(d, a.left, a.top), b.drawImage(c, t % l[0] * r, Math.floor(t / l[0]) * o); }; for (var e_31 = 0; e_31 < s.length; e_31++)
            _(s[e_31], e_31); be.addWorkDone(e.id, 1); var Z = b.getImageData(0, 0, u.width, u.height), G = performance.now() - i; console.log("Decode GIF '" + e.name + "' time:" + G), t({ width: u.width, height: u.height, atlasSize: l, frameRange: [0, s.length], frameDelays: g, imageData: Z }); }, function (t) { console.warn("Unable to Load URL:" + t + ":" + e.url), a(); }); }), t[e.id] = this.__resourcePromise), this.__resourcePromise.then(function (e) { _this.width = e.width, _this.height = e.height, _this.getParameter("StreamAtlasDesc").setValue(new G(e.atlasSize[0], e.atlasSize[1], 0, 0)), _this.getParameter("StreamAtlasIndex").setRange(e.frameRange), _this.__unpackedData = e, _this.__data = e.imageData, _this.__loaded = !0, _this.loaded.emit(); });
    };
    return pt;
}(ht));
ht.registerLoader("gif", pt), J.registerClass("GIFImage", pt);
var gt = /** @class */ (function (_super) {
    __extends(gt, _super);
    function gt(e, t) {
        if (t === void 0) { t = {}; }
        var _this = this;
        var a;
        null != e && -1 != e.lastIndexOf(".") && (a = e, e = e.substring(e.lastIndexOf("/") + 1, e.lastIndexOf("."))), _this = _super.call(this, e, t) || this, _this.__loaded = !1, _this.__exposure = 1, _this.__ambientLightFactor = 0, _this.__hdrtint = new y(1, 1, 1, 1), _this.__stream = "stream" in t && t.stream, _this.type = "FLOAT";
        var i = _this.addParameter(new Te("FilePath"));
        i.valueChanged.connect(function () { if (_this.loaded.untoggle(), _this.getName() == J.getClassName(_this)) {
            var e_32 = i.getStem(), t_46 = e_32.substring(e_32.length - 1);
            isNaN(t_46) ? _this.setName(e_32) : _this.setName(e_32.substring(0, e_32.length - 1));
        } var e = i.getValue(), t = i.getFile(); _this.__loadVLH(e, t); }), a && _this.getParameter("FilePath").setFilepath(a);
        return _this;
    }
    gt.prototype.getDOMElement = function () { return this.__domElement; };
    gt.prototype.getResourcePath = function () { return this.getParameter("FilePath").getValue(); };
    gt.prototype.__decodeData = function (e) {
        var _this = this;
        var t = e.ldr, a = e.cdm, i = new Blob([t.buffer]), s = new Image;
        s.onload = function () { _this.width = s.width, _this.height = s.height, _this.__data = { ldr: s, cdm: a }, _this.__loaded ? _this.updated.emit() : (_this.__loaded = !0, _this.loaded.emit()); }, s.src = URL.createObjectURL(i);
    };
    gt.prototype.__loadVLH = function (e, t) {
        var _this = this;
        this.type = "FLOAT", be.loadUrl(e, t.url, function (e) { if (!e.ldr || !e.cdm)
            for (var t_47 in e)
                t_47.endsWith(".jpg") ? (e.ldr = e[t_47], delete e[t_47]) : t_47.endsWith(".bin") && (e.cdm = e[t_47], delete e[t_47]); _this.__decodeData(e); });
    };
    gt.prototype.isStream = function () { return !1; };
    gt.prototype.isLoaded = function () { return this.__loaded; };
    gt.prototype.getParams = function () { var e = _super.prototype.getParams.call(this); return this.__loaded && (e.data = this.__data, e.exposure = this.__exposure), e; };
    gt.prototype.setHDRTint = function (e) { this.__hdrtint = e; };
    gt.prototype.getHDRTint = function () { return this.__hdrtint; };
    gt.prototype.toJSON = function (e, t) { };
    gt.prototype.fromJSON = function (e, t, a) { };
    gt.prototype.readBinary = function (e, t) { this.setName(e.loadStr()); var a = e.loadStr(); if ("string" == typeof a && "" != a) {
        if (t.lod >= 0) {
            var e_33 = a.lastIndexOf(".");
            if (-1 != e_33) {
                var i_29 = a.substring(0, e_33) + t.lod + a.substring(e_33);
                be.resourceAvailable(i_29) && (a = i_29);
            }
        }
        this.getParameter("FilePath").setValue(a);
    } };
    return gt;
}(Ue));
J.registerClass("VLHImage", gt);
var _t = 1, Zt = 2, Gt = function (e, t) { return t < e ? 0 : 1; };
function Xt(e) { return e.dot(new _(1, 1)); }
function yt(e) { return new _(Math.abs(e.x), Math.abs(e.y)); }
function ft(e, t) { return new _(Math.max(e.x, t), Math.max(e.y, t)); }
function Vt(e) { var t = function (e) { return new Z(Math.abs(e.x), Math.abs(e.y), Math.abs(e.z)); }(e), a = function (e) { return new Z(2 * Gt(0, e.x) - 1, 2 * Gt(0, e.y) - 1, 2 * Gt(0, e.z) - 1); }(e), i = new _(t.x, t.y); var s = ft(i, 1e-20); var n = Math.atan2(s.x, s.y) / Math.HALF_PI; s = ft(new _(t.z, i.length()), 1e-20); var l = Math.atan2(s.y, s.x) / Math.HALF_PI; var r = new _(a.x * n, a.y * (1 - n)); if (r.scaleInPlace(l), e.z < 0) {
    var e_34 = new _(r.y, r.x), t_48 = new _(a.x, a.y);
    r = t_48.subtract(yt(e_34).multiply(t_48));
} return r.scale(.5).add(new _(.5, .5)); }
function It(e) { var t = function (e) { return new _(2 * Gt(0, e.x) - 1, 2 * Gt(0, e.y) - 1); }(e = e.scale(2).subtract(new _(1, 1))), a = Xt(yt(e)), i = a * Math.PI * .5; if (i <= 0)
    return new Z(0, 0, 1); if (Math.abs(i - Math.PI) < 1e-6)
    return new Z(0, 0, -1); if (a > 1) {
    e = yt(_(e.y, e.x)).negate().add(new _(1, 1)).multiply(t), a = Xt(yt(e));
} var s = Math.abs(e.x) / a * Math.HALF_PI, n = Math.sin(s), l = Math.cos(s), r = Math.sin(i), o = Math.cos(i); return new Z(n * t.x * r, l * t.y * r, o); }
var Rt = /** @class */ (function (_super) {
    __extends(Rt, _super);
    function Rt(e, t) {
        if (t === void 0) { t = {}; }
        var _this = this;
        _this = _super.call(this, e, t) || this, _this.mapping = Zt;
        return _this;
    }
    Rt.prototype.__decodeData = function (e) { _super.prototype.__decodeData.call(this, e); var t = e.samples; t && (window.TextDecoder ? this.__sampleSets = JSON.parse(new TextDecoder("utf-8").decode(t)) : this.__sampleSets = JSON.parse(K(t)), this.__sampleSets.luminanceThumbnail && (this.__thumbSize = Math.sqrt(this.__sampleSets.luminanceThumbnail.length))); };
    Rt.prototype.getSampleSets = function () { return this.__sampleSets; };
    Rt.prototype.uvToDir = function (e) { switch (this.mapping) {
        case _t: return function (e, t) { var a = Math.PI * (2 * e - 1), i = Math.PI * t; return new Z(sin(i) * sin(a), -sin(i) * cos(a), cos(i)); }(e);
        case Zt: return It(e);
    } };
    Rt.prototype.dirToUv = function (e) { switch (this.mapping) {
        case _t: return function (e) { var t = Math.acos(e.z), a = Math.atan2(e.x, -e.y); return new _((1 + a / Math.PI) / 2, t / Math.PI); }(e);
        case Zt: return Vt(e);
    } };
    Rt.prototype.uvToLuminance = function (e) { var t = Math.floor(e.y * this.__thumbSize) * this.__thumbSize + Math.floor(e.x * this.__thumbSize); return this.__sampleSets.luminanceThumbnail[t]; };
    Rt.prototype.dirToLuminance = function (e) { return this.uvToLuminance(this.dirToUv(e)); };
    return Rt;
}(gt));
J.registerClass("EnvMap", Rt);
var xt = /** @class */ (function (_super) {
    __extends(xt, _super);
    function xt(e, t, a, i) {
        var _this = this;
        _this = _super.call(this) || this, _this.atlasSize = a, _this.image = new gt("Lightmap", { stream: i }), _this.image.getParameter("FilePath").setFilepath(e), _this.image.setHDRTint(t.getParameter("LightmapTint").getValue()), _this.__stream = i;
        return _this;
    }
    Object.defineProperty(xt.prototype, "width", {
        get: function () { return this.atlasSize[0]; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(xt.prototype, "height", {
        get: function () { return this.atlasSize[1]; },
        enumerable: true,
        configurable: true
    });
    xt.prototype.isStream = function () { return this.__stream; };
    xt.prototype.loadResource = function (e) { this.image.loadResource(e); };
    xt.prototype.fromJSON = function (e) { this.__atlasSize = e.atlasSize; };
    return xt;
}(U));
var St = /** @class */ (function (_super) {
    __extends(St, _super);
    function St(e) {
        var _this = this;
        _this = _super.call(this) || this, _this.atlasSize = e, _this.__images = [], _this.__weights = [], _this.__stream = !1, _this.lightmapAdded = new C, _this.lightmapResourceChanged = new C, _this.lightmapWeightChanged = new C;
        return _this;
    }
    Object.defineProperty(St.prototype, "width", {
        get: function () { return this.atlasSize[0]; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(St.prototype, "height", {
        get: function () { return this.atlasSize[1]; },
        enumerable: true,
        configurable: true
    });
    St.prototype.isStream = function () { return this.__stream; };
    St.prototype.loadResource = function (e, t, a, i) {
        if (i === void 0) { i = !1; }
        this.__images[e] ? (this.__images[e].loadResource(t), this.lightmapResourceChanged.emit(e, a), a && (this.__weights[e] = a, this.lightmapWeightChanged.emit(e, a))) : (this.__images[e] = new FileImage(t, { stream: i }), this.__weights[e] = a || 1, this.lightmapAdded.emit(e)), this.__stream |= i;
    };
    St.prototype.setWeight = function (e, t) { this.__weights[e] = t, this.lightmapWeightChanged.emit(e, t); };
    St.prototype.numSubImages = function () { return this.__images.length; };
    St.prototype.getSubImage = function (e) { return this.__images[e]; };
    St.prototype.getSubImageWeight = function (e) { return this.__weights[e]; };
    St.prototype.fromJSON = function (e) { this.__atlasSize = e.atlasSize; };
    return St;
}(U));
var Wt = new /** @class */ (function () {
    function class_4() {
        var _this = this;
        this.__labelLibraries = {}, this.labelLibraryLoaded = new C;
        var e = function () { var e = window.navigator, t = ["language", "browserLanguage", "systemLanguage", "userLanguage"]; var a, i; if (Array.isArray(e.languages))
            for (a = 0; a < e.languages.length; a++)
                if (i = e.languages[a], i && i.length)
                    return i; for (a = 0; a < t.length; a++)
            if (i = e[t[a]], i && i.length)
                return i; return null; }();
        e.startsWith("en") ? this.__language = "En" : e.startsWith("es") ? this.__language = "Es" : e.startsWith("fr") ? this.__language = "Fr" : (e.startsWith("gb") || e.startsWith("de")) && (this.__language = "Gb"), this.__foundLabelLibraries = {}, be.registerResourceCallback(".labels", function (e) { var t = e.name.split(".")[0]; _this.__foundLabelLibraries[t] = e, se(e.url, function (e) { _this.__labelLibraries[t] = JSON.parse(e), _this.labelLibraryLoaded.emit(t); }); }), window.XLSX && be.registerResourceCallback(".xlsx", function (e) { var t = e.name.split(".")[0]; _this.__foundLabelLibraries[t] = e, re(e.url, function (e) { var a = new Uint8Array(e), i = XLSX.read(a, { type: "array" }), s = {}; i.SheetNames.forEach((function (e) { XLSX.utils.sheet_to_row_object_array(i.Sheets[e]).forEach((function (e) { var t = e.Identifier; delete e.Identifier, s[t] = e; })); })), _this.__labelLibraries[t] = s, _this.labelLibraryLoaded.emit(t); }); });
    }
    class_4.prototype.isLibraryFound = function (e) { return e in this.__foundLabelLibraries; };
    class_4.prototype.isLibraryLoaded = function (e) { return e in this.__labelLibraries; };
    class_4.prototype.getLabelText = function (e, t) { var a = this.__labelLibraries[e]; if (!a)
        throw new Error("LabelLibrary: '" + e + "' not found in LabelManager. Found: [" + Object.keys(this.__labelLibraries) + "]"); var i = a[t]; if (!i)
        throw new Error("Label: '" + t + "' not found in LabelLibrary: '" + e + "'. Found: [" + Object.keys(a) + "]"); var s = i[this.__language]; if (!s) {
        if (i.En)
            return i.En;
        throw new Error("labelText: '" + language + "' not found in Label. Found: [" + Object.keys(i) + "]");
    } return s; };
    class_4.prototype.setLabelText = function (e, t, a) { var i = this.__labelLibraries[e]; i || (i = {}, this.__labelLibraries[e] = i); var s = i[t]; s || (s = {}, i[t] = s), s[this.__language] = a; };
    class_4.prototype.setLanguage = function (e) { this.__language = e; };
    return class_4;
}());
var Lt = /** @class */ (function (_super) {
    __extends(Lt, _super);
    function Lt(e, t) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__canvasElem = document.createElement("canvas");
        var a = _this.addParameter(new Me("library"));
        _this.addParameter(new Me("text", "")), _this.addParameter(new xe("fontColor", new y(0, 0, 0))), _this.addParameter(new Xe("margin", 11)), _this.addParameter(new Xe("borderWidth", 2)), _this.addParameter(new Xe("borderRadius", 11)), _this.addParameter(new fe("outline", !1)), _this.addParameter(new fe("outlineColor", new y(0, 0, 0))), _this.addParameter(new fe("background", !0)), _this.addParameter(new xe("backgroundColor", new y("#FBC02D"))), _this.addParameter(new fe("fillBackground", !0)), _this.addParameter(new fe("strokeBackgroundOutline", !0)), _this.addParameter(new Xe("fontSize", 22)), _this.addParameter(new Me("font", "Helvetica"));
        _this.nameChanged.connect(function () { _this.loadLabelData(); }), t && a.setValue(t), _this.__requestedRerender = !1, _this.__needsRender = !1, _this.labelRendered = new C, _this.loadLabelData();
        return _this;
    }
    Lt.prototype.__parameterValueChanged = function (e, t) { this.__requestedRerender || (this.__requestedRerender = !0, this.loadLabelData()); };
    Lt.prototype.loadLabelData = function () {
        var _this = this;
        Promise.all([(function () { return new Promise(function (e) { var t = _this.getParameter("library").getValue(); if ("" == t)
                return void e(); if (!Wt.isLibraryFound(t))
                return console.warn("Label Libary not found:", t), void e(); var a = function () { try {
                var e_35 = _this.getName(), a_43 = Wt.getLabelText(t, e_35);
                _this.getParameter("text").setValue(a_43);
            }
            catch (e) {
                console.warn(e);
            } e(); }; Wt.isLibraryLoaded(t) ? a() : Wt.labelLibraryLoaded.connect(function (e) { e == t && a(); }); }); })(), (function () { return new Promise(function (e) { if (null != document.fonts) {
                var t_49 = _this.getParameter("font").getValue(), a_44 = _this.getParameter("fontSize").getValue();
                document.fonts.load(a_44 + 'px "' + t_49 + '"').then(function () { e(); });
            }
            else
                e(); }); })()]).then(function () { _this.__requestedRerender = !1, _this.__needsRender = !0, _this.__loaded ? _this.updated.emit() : (_this.__loaded = !0, _this.loaded.emit()); });
    };
    Lt.prototype.renderLabelToImage = function () { var e = this.__canvasElem.getContext("2d", { alpha: !0 }); var t = this.getParameter("text").getValue(); "" == t && (t = this.getName()); var a = this.getParameter("font").getValue(), i = this.getParameter("fontColor").getValue(), s = this.getParameter("fontSize").getValue(), n = this.getParameter("margin").getValue(), l = this.getParameter("borderWidth").getValue(), r = this.getParameter("borderRadius").getValue(), o = this.getParameter("outline").getValue(), d = this.getParameter("outlineColor").getValue(), h = this.getParameter("background").getValue(), c = this.getParameter("backgroundColor").getValue(), m = this.getParameter("fillBackground").getValue(), u = this.getParameter("strokeBackgroundOutline").getValue(), b = n + l, p = t.split("\n"); e.font = s + 'px "' + a + '"'; var g = 0; p.forEach(function (t) { g = Math.max(e.measureText(t).width, g); }); var _ = s; this.width = Math.ceil(g + 2 * b), this.height = Math.ceil(_ * p.length + 2 * b), e.canvas.width = this.width, e.canvas.height = this.height, this.__canvasElem.width = this.width, this.__canvasElem.height = this.height, e.fillStyle = "rgba(0, 0, 0, 0.0)", e.fillRect(0, 0, this.width, this.height), h && (e.fillStyle = c.toHex(), e.strokeStyle = d.toHex(), function (e, t, a, i, s, n, l, r, o) { if (void 0 === r && (r = !0), void 0 === n && (n = 5), "number" == typeof n)
        n = { tl: n, tr: n, br: n, bl: n };
    else {
        var e_36 = { tl: 0, tr: 0, br: 0, bl: 0 };
        for (var t_50 in e_36)
            n[t_50] = n[t_50] || e_36[t_50];
    } e.beginPath(), e.moveTo(t + n.tl, a), e.lineTo(t + i - n.tr, a), e.quadraticCurveTo(t + i, a, t + i, a + n.tr), e.lineTo(t + i, a + s - n.br), e.quadraticCurveTo(t + i, a + s, t + i - n.br, a + s), e.lineTo(t + n.bl, a + s), e.quadraticCurveTo(t, a + s, t, a + s - n.bl), e.lineTo(t, a + n.tl), e.quadraticCurveTo(t, a, t + n.tl, a), e.closePath(), l && e.fill(), r && (e.lineWidth = o, e.stroke()); }(e, l, l, this.width - 2 * l, this.height - 2 * l, r, m, u, l)), e.font = s + 'px "' + a + '"', e.textAlign = "left", e.fillStyle = i.toHex(), e.textBaseline = "hanging", p.forEach(function (t, a) { e.fillText(t, b, b + a * _); }), o && (e.strokeStyle = d.toHex(), e.lineWidth = 1.5, e.strokeText(t, b, b)), this.__data = e.getImageData(0, 0, this.width, this.height), this.__needsRender = !1, this.labelRendered.emit({ width: this.width, height: this.height, data: this.__data }); };
    Lt.prototype.getParams = function () { return this.__needsRender && this.renderLabelToImage(), _super.prototype.getParams.call(this); };
    Lt.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    Lt.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), this.__getLabelText(); };
    return Lt;
}(ke));
J.registerClass("Label", Lt);
var vt = /** @class */ (function (_super) {
    __extends(vt, _super);
    function vt() {
        var _this = this;
        _this = _super.call(this) || this, _this.__loaded = !1;
        return _this;
    }
    vt.prototype.connectWebcam = function (e, t, a) {
        var _this = this;
        if (a === void 0) { a = !1; }
        var i = { width: e, height: t, frameRate: { ideal: 60, max: 60 } };
        i.facingMode = a ? { exact: "environment" } : { facingMode: "user" };
        var s = document.createElement("video");
        s.style.display = "none", s.preload = "auto", s.crossOrigin = "anonymous", document.body.appendChild(s), navigator.mediaDevices.getUserMedia({ audio: !1, video: i }).then(function (e) { s.srcObject = e, s.onloadedmetadata = function (e) { s.play(), _this.width = s.videoWidth, _this.height = s.videoHeight, console.log("Webcam:[" + _this.width + ", " + _this.height + "]"), _this.__data = s, _this.__loaded = !0, _this.loaded.emit(s); var t = 0; var a = function () { if (s.paused || s.ended)
            return; var e = Math.floor(60 * s.currentTime); t != e && (_this.updated.emit(), t = e), setTimeout(a, 20); }; a(); }; }).catch((function (e) { }));
    };
    vt.prototype.setVideoStream = function (e) { this.__loaded = !1, this.width = e.videoWidth, this.height = e.videoHeight, this.start(), this.__data = e, this.__loaded = !0, this.loaded.emit(e); };
    vt.prototype.stop = function () { clearInterval(this.__intervalId); };
    vt.prototype.start = function () {
        var _this = this;
        this.__intervalId = setInterval(function () { _this.updated.emit(); }, 20);
    };
    vt.prototype.isLoaded = function () { return this.__loaded; };
    vt.prototype.getParams = function () { return { type: this.type, format: this.format, width: this.width, height: this.height, data: this.__data, flipY: this.getParameter("FlipY").getValue() }; };
    return vt;
}(Ue));
J.registerClass("VideoStreamImage2D", vt);
var Mt = /** @class */ (function () {
    function Mt(e) {
        if (e === void 0) { e = "MaterialLibrary"; }
        this.__name = e, this.lod = 0, t.isMobileDevice && (this.lod = 1), this.loaded = new C, this.clear();
    }
    Mt.prototype.clear = function () { this.__images = {}, this.__materials = { Default: new He("Default", "SimpleSurfaceShader") }; };
    Mt.prototype.getPath = function () { return [this.__name]; };
    Mt.prototype.getNumMaterials = function () { return Object.keys(this.__materials).length; };
    Mt.prototype.getMaterials = function () { return Object.values(this.__materials); };
    Mt.prototype.getMaterialNames = function () { var e = []; for (var t_51 in this.__materials)
        e.push(t_51); return e; };
    Mt.prototype.hasMaterial = function (e) { return e in this.__materials; };
    Mt.prototype.addMaterial = function (e) { e.setOwner(this), this.__materials[e.getName()] = e; };
    Mt.prototype.getMaterial = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = this.__materials[e];
        if (!a && t)
            throw new Error("Material:" + e + " not found in library:" + this.getMaterialNames());
        return a;
    };
    Mt.prototype.hasImage = function (e) { return e in this.__images; };
    Mt.prototype.addImage = function (e) { e.setOwner(this), this.__images[e.getName()] = e; };
    Mt.prototype.getImage = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = this.__images[e];
        if (!a && t)
            throw new Error("Image:" + e + " not found in library:" + this.getImageNames());
        return a;
    };
    Mt.prototype.getImageNames = function () { var e = []; for (var t_52 in this.__images)
        e.push(t_52); return e; };
    Mt.prototype.load = function (e) {
        var _this = this;
        var t = new XMLHttpRequest;
        t.open("GET", e, !0), t.ontimeout = function () { throw new Error("The request for " + e + " timed out."); }, t.onload = function () { 4 === t.readyState && (200 === t.status ? _this.fromJSON(JSON.parse(t.responseText)) : console.warn(t.statusText)); }, t.send(null);
    };
    Mt.prototype.toJSON = function (e, t) {
        if (e === void 0) { e = {}; }
        if (t === void 0) { t = 0; }
        return { numMaterials: this.geoms.length() };
    };
    Mt.prototype.fromJSON = function (e, t, a) {
        if (t === void 0) { t = {}; }
        if (a === void 0) { a = 0; }
        t.lod = this.lod;
        for (var t_53 in e.textures) {
            new ht(t_53).fromJSON(e.textures[t_53]), this.__images[t_53] = texture;
        }
        for (var t_54 in e.materials) {
            var a_45 = new He(t_54);
            a_45.fromJSON(e.materials[t_54]), this.addMaterial(a_45);
        }
    };
    Mt.prototype.readBinary = function (e, t) {
        if (t === void 0) { t = {}; }
        this.name = e.loadStr(), t.lod = this.lod, t.materialLibrary = this;
        var a = e.loadUInt32();
        for (var i_30 = 0; i_30 < a; i_30++) {
            var a_46 = e.loadStr(), i_31 = J.constructClass(a_46, void 0);
            i_31.readBinary(e, t), this.__images[i_31.getName()] = i_31;
        }
        var i = e.loadUInt32();
        if (i > 0) {
            var a_47 = e.loadUInt32Array(i);
            for (var s = 0; s < i; s++) {
                var i_32 = new He("");
                e.seek(a_47[s]), i_32.readBinary(e, t, this.__images), this.addMaterial(i_32);
            }
        }
        this.loaded.emit();
    };
    Mt.prototype.toString = function () { return JSON.stringify(this.toJSON(), null, 2); };
    return Mt;
}());
var Ft = new /** @class */ (function () {
    function class_5() {
        var _this = this;
        this.__materialLibraries = {}, this.materialLibraryLoaded = new C, be.registerResourceCallback(".matlib", function (e) { se(e.url, function (t) { var a = e.name.split(".")[0], i = JSON.parse(t), s = new Mt(a); s.fromJSON(i), _this.__materialLibraries[a] = s, _this.materialLibraryLoaded.emit(s); }); });
    }
    class_5.prototype.getMaterialLibraryNames = function () { var e = []; for (var t_55 in this.__materialLibraries)
        e.push(t_55); return e; };
    class_5.prototype.hasMaterialLibrary = function (e) { return e in this.__materialLibraries; };
    class_5.prototype.getMaterialLibrary = function (e) { var t = this.__materialLibraries[e]; return t || console.warn("MaterialLibrary:" + e + " not found in MaterialLibraryManager. Found: [" + this.getMaterialLibraryNames() + "]"), t; };
    class_5.prototype.resolveMaterialFromPath = function (e) { var t = this.getMaterialLibrary(e[0]); if (t)
        return t.getMaterial(e[1]); };
    return class_5;
}());
var Tt = /** @class */ (function (_super) {
    __extends(Tt, _super);
    function Tt(e, t) {
        var _this = this;
        _this = _super.call(this, e, t, "Material") || this, _this.valueParameterValueChanged = new C;
        return _this;
    }
    Tt.prototype.setValue = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        this.__value !== e && (this.__value && this.__value.parameterValueChanged.disconnect(this.valueParameterValueChanged.emit), this.__value = e, this.__value && this.__value.parameterValueChanged.connect(this.valueParameterValueChanged.emit), t != E.USER_SETVALUE && t != E.REMOTEUSER_SETVALUE || (this.__flags |= H.USER_EDITED), t != E.OPERATOR_SETVALUE && this.valueChanged.emit(t));
    };
    Tt.prototype.toJSON = function (e, t) { if (0 != (this.__flags & H.USER_EDITED))
        return { value: this.__value.getPath() }; };
    Tt.prototype.fromJSON = function (e, t, a) { if (null == e.value)
        return void console.warn("Invalid Parameter JSON"); var i = e.value, s = Ft.resolveMaterialFromPath(i); s && this.setValue(s), this.__flags |= H.USER_EDITED; };
    Tt.prototype.clone = function (e) { return new Tt(this.__name, this.__value); };
    Tt.prototype.destroy = function () { this.__value && this.__value.parameterValueChanged.disconnect(this.valueParameterValueChanged.emit); };
    return Tt;
}(Q));
var Ct = /** @class */ (function () {
    function Ct(e, t, a) {
        if (this.__dataType = e, this.normalized = !1, null != e.numElements)
            this.__dimension = this.__dataType.numElements();
        else
            switch (e) {
                case 6:
                case 4:
                case 5:
                    this.__dimension = 1;
                    break;
                default: throw new Error("Invalid data type for attribute:" + e);
            }
        var i;
        this.__defaultElementValue = null != a ? a : Number.MAX_VALUE, (i = t) && void 0 !== i.byteLength ? this.__data = t : (this.__data = new Float32Array(t * this.__dimension), this.initRange(0));
    }
    Ct.prototype.resize = function (e) { var t = this.__data.length, a = e * this.__dimension, i = new Float32Array(a); for (var e_37 = 0; e_37 < Math.min(this.__data.length, a); e_37++)
        i[e_37] = this.__data[e_37]; this.__data.length < a && (this.__data = i), this.initRange(t); };
    Ct.prototype.initRange = function (e) { for (var t_56 = e; t_56 < this.__data.length; t_56++)
        this.__data[t_56] = this.__defaultElementValue; };
    Ct.prototype.getCount = function () { return this.__data.length / this.__dimension; };
    Object.defineProperty(Ct.prototype, "length", {
        get: function () { return this.__data.length / this.__dimension; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Ct.prototype, "dataType", {
        get: function () { return this.__dataType; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Ct.prototype, "data", {
        get: function () { return this.__data; },
        set: function (e) { this.__data = e; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Ct.prototype, "numElements", {
        get: function () { return this.__dimension; },
        enumerable: true,
        configurable: true
    });
    Ct.prototype.getFloat32Value = function (e) { return this.__data[e]; };
    Ct.prototype.setFloat32Value = function (e, t) { this.__data[e] = t; };
    Ct.prototype.getValueRef = function (e) { var t = this.__dimension; if (e >= this.__data.length / t)
        throw new Error("Invalid vertex index:" + e + ". Num Vertices:" + this.__data.length / 3); return this.__dataType.createFromFloat32Buffer(this.__data.buffer, e * t); };
    Ct.prototype.setValue = function (e, t) { var a = this.__dimension; if (e >= this.__data.length / a)
        throw new Error("Invalid vertex index:" + e + ". Num Vertices:" + this.__data.length / 3); this.__dataType.createFromFloat32Buffer(this.__data.buffer, e * a).setFromOther(t); };
    Ct.prototype.toJSON = function (e, t) { return { data: Array.from(this.__data), dataType: g.getTypeName(this.__dataType), defaultValue: this.__defaultElementValue, length: this.__data.length / this.__dimension }; };
    Ct.prototype.fromJSON = function (e) { this.__data = Float32Array.from(e.data); };
    Ct.prototype.toString = function () { return JSON.stringify(this.toJSON(), null, 2); };
    return Ct;
}());
var Nt = /** @class */ (function (_super) {
    __extends(Nt, _super);
    function Nt() {
        var _this = this;
        _this = _super.call(this) || this, _this.__boundingBox = new v, _this.__boundingBoxDirty = !0, _this.__vertexAttributes = new Map, _this.__metaData = new Map, _this.addVertexAttribute("positions", Z, 0), _this.boundingBoxDirtied = new C, _this.geomDataChanged = new C, _this.geomDataTopologyChanged = new C;
        return _this;
    }
    Nt.prototype.setDebugName = function (e) { this.__name = e; };
    Nt.prototype.addVertexAttribute = function (e, t, a) { var i; var s; return i = (s = a) && void 0 !== s.byteLength ? new Ct(t, a) : new Ct(t, null != this.vertices ? this.vertices.length : 0, a), this.__vertexAttributes.set(e, i), i; };
    Nt.prototype.hasVertexAttribute = function (e) { return this.__vertexAttributes.has(e); };
    Nt.prototype.getVertexAttribute = function (e) { return this.__vertexAttributes.get(e); };
    Nt.prototype.getVertexAttributes = function (e) { var t = {}; for (var _b = 0, _c = this.__vertexAttributes.entries(); _b < _c.length; _b++) {
        var _d = _c[_b], e_38 = _d[0], a_48 = _d[1];
        t[e_38] = a_48;
    } return t; };
    Object.defineProperty(Nt.prototype, "vertices", {
        get: function () { return this.__vertexAttributes.get("positions"); },
        enumerable: true,
        configurable: true
    });
    Nt.prototype.numVertices = function () { return this.vertices.length; };
    Nt.prototype.getNumVertices = function () { return this.vertices.length; };
    Nt.prototype.setNumVertices = function (e) { this.__vertexAttributes.forEach(function (t) { return t.resize(e); }); };
    Nt.prototype.getVertex = function (e) { return Z.createFromFloat32Buffer(this.vertices.data.buffer, 3 * e); };
    Nt.prototype.setVertex = function (e, t) { return Z.createFromFloat32Buffer(this.vertices.data.buffer, 3 * e).setFromOther(t); };
    Nt.prototype.moveVertices = function (e) { var t = this.vertices; for (var a_49 = 0; a_49 < t.length; a_49++)
        t.getValueRef(a_49).addInPlace(e); this.setBoundingBoxDirty(); };
    Nt.prototype.transformVertices = function (e) { var t = this.vertices; for (var a_50 = 0; a_50 < t.length; a_50++) {
        var i_33 = t.getValueRef(a_50), s = e.transformVec3(i_33);
        i_33.set(s.x, s.y, s.z);
    } this.setBoundingBoxDirty(); };
    Object.defineProperty(Nt.prototype, "boundingBox", {
        get: function () { return this.__boundingBoxDirty && this.updateBoundingBox(), this.__boundingBox; },
        enumerable: true,
        configurable: true
    });
    Nt.prototype.setBoundingBoxDirty = function () { this.__boundingBoxDirty = !0, this.boundingBoxDirtied.emit(); };
    Nt.prototype.updateBoundingBox = function () { var e = this.vertices, t = new v, a = e.length; for (var i_34 = 0; i_34 < a; i_34++)
        t.addPoint(e.getValueRef(i_34)); this.__boundingBox = t, this.__boundingBoxDirty = !1; };
    Nt.prototype.getMetadata = function (e) { return this.__metaData.get(e); };
    Nt.prototype.hasMetadata = function (e) { return this.__metaData.has(e); };
    Nt.prototype.setMetadata = function (e, t) { this.__metaData.set(e, t); };
    Nt.prototype.deleteMetadata = function (e) { this.__metaData.delete(e); };
    Nt.prototype.genBuffers = function (e) { var t = {}; for (var _b = 0, _c = this.__vertexAttributes; _b < _c.length; _b++) {
        var _d = _c[_b], e_39 = _d[0], a_51 = _d[1];
        t[e_39] = { values: a_51.data, count: a_51.size, dataType: a_51.dataType, normalized: a_51.normalized };
    } return { numVertices: this.numVertices(), attrBuffers: t }; };
    Nt.prototype.freeBuffers = function () { };
    Nt.prototype.loadBaseGeomBinary = function (e) { this.name = e.loadStr(); var t = e.loadUInt8(); this.debugColor = e.loadRGBFloat32Color(); var a = e.loadUInt32(); this.__boundingBox.set(e.loadFloat32Vec3(), e.loadFloat32Vec3()), this.setNumVertices(a); var i = this.vertices; var s, n; 2 & t && (s = this.getVertexAttribute("normals"), s || (s = this.addVertexAttribute("normals", Z, 0))), 4 & t && (n = this.getVertexAttribute("texCoords"), n || (n = this.addVertexAttribute("texCoords", _, 0))); var l = function (e, t, a, s) { for (var n_1 = e[0]; n_1 < e[1]; n_1++) {
        var e_40 = new Z(s[3 * n_1 + 0] / 255, s[3 * n_1 + 1] / 255, s[3 * n_1 + 2] / 255);
        e_40.multiplyInPlace(a), e_40.addInPlace(t), i.setValue(n_1, e_40);
    } }, r = function (e, t, a, i) { a.isNull() && a.set(1, 1, 1); for (var n_2 = e[0]; n_2 < e[1]; n_2++) {
        var e_41 = new Z(i[3 * n_2 + 0] / 255, i[3 * n_2 + 1] / 255, i[3 * n_2 + 2] / 255);
        e_41.multiplyInPlace(a), e_41.addInPlace(t), e_41.normalizeInPlace(), s.setValue(n_2, e_41);
    } }, o = function (e, t, a, i) { for (var s_4 = e[0]; s_4 < e[1]; s_4++) {
        var e_42 = new _(i[2 * s_4 + 0] / 255, i[2 * s_4 + 1] / 255);
        e_42.multiplyInPlace(a), e_42.addInPlace(t), n.setValue(s_4, e_42);
    } }, d = e.loadUInt32(); if (1 == d) {
        {
            var t_57 = this.__boundingBox, i_35 = e.loadUInt8Array(3 * a);
            l([0, a], t_57.p0, t_57.diagonal(), i_35);
        }
        if (s) {
            var t_58 = new v(e.loadFloat32Vec3(), e.loadFloat32Vec3()), i_36 = e.loadUInt8Array(3 * a);
            r([0, a], t_58.p0, t_58.diagonal(), i_36), s.loadSplitValues(e);
        }
        if (n) {
            var t_59 = new W(e.loadFloat32Vec2(), e.loadFloat32Vec2()), i_37 = e.loadUInt8Array(2 * a);
            o([0, a], t_59.p0, t_59.diagonal(), i_37), n.loadSplitValues(e);
        }
    }
    else {
        var t_60 = [];
        var i_38 = 0;
        for (var a_52 = 0; a_52 < d; a_52++) {
            var a_53 = e.loadUInt32(), l_1 = { range: [i_38, i_38 + a_53], bbox: new v(e.loadFloat32Vec3(), e.loadFloat32Vec3()) };
            s && (l_1.normalsRange = new v(e.loadFloat32Vec3(), e.loadFloat32Vec3())), n && (l_1.texCoordsRange = new W(e.loadFloat32Vec2(), e.loadFloat32Vec2())), t_60.push(l_1), i_38 += a_53;
        }
        var h = e.loadUInt8Array(3 * a);
        var c = void 0, m_1;
        s && (c = e.loadUInt8Array(3 * a)), n && (m_1 = e.loadUInt8Array(2 * a));
        for (var e_43 = 0; e_43 < d; e_43++) {
            {
                var a_54 = t_60[e_43].bbox;
                l(t_60[e_43].range, a_54.p0, a_54.diagonal(), h);
            }
            if (s) {
                var a_55 = t_60[e_43].normalsRange;
                r(t_60[e_43].range, a_55.p0, a_55.diagonal(), c);
            }
            if (n) {
                var a_56 = t_60[e_43].texCoordsRange;
                o(t_60[e_43].range, a_56.p0, a_56.diagonal(), m_1);
            }
        }
        s && s.loadSplitValues(e), n && n.loadSplitValues(e);
    } };
    Nt.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); if (a || (a = {}), a.type = J.getClassName(this), !(1024 & t)) {
        var i_39 = {};
        for (var _b = 0, _c = this.__vertexAttributes.entries(); _b < _c.length; _b++) {
            var _d = _c[_b], a_57 = _d[0], s = _d[1];
            i_39[a_57] = s.toJSON(e, t);
        }
        a.vertexAttributes = i_39;
    } return a; };
    Nt.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a); for (var t_61 in e.vertexAttributes) {
        var a_58 = this.__vertexAttributes.get(t_61);
        var i_40 = e.vertexAttributes[t_61];
        if (!a_58) {
            var e_44 = g.getType(i_40.dataType);
            a_58 = new VertexAttribute(this, e_44, 0, i_40.defaultScalarValue), this.__vertexAttributes.set(t_61, a_58);
        }
        a_58.fromJSON(i_40);
    } };
    Nt.prototype.toString = function () { return JSON.stringify(this.toJSON(), null, 2); };
    return Nt;
}(q));
var Kt = /** @class */ (function (_super) {
    __extends(Kt, _super);
    function Kt(e, t, a, i) {
        var _this = this;
        _this = _super.call(this, t, a, i) || this, _this.__geom = e, _this.__splits = {}, _this.__splitValues = [];
        return _this;
    }
    Kt.prototype.getFaceVertexValueRef = function (e, t) { var a = this.__geom.getFaceVertexIndex(e, t); return a in this.__splits && e in this.__splits[a] ? this.__splitValues[this.__splits[a][e]] : this.getValueRef(a); };
    Kt.prototype.setFaceVertexValue = function (e, t, a) { var i = this.__geom.getFaceVertexIndex(e, t); this.setFaceVertexValue_ByVertexIndex(e, i, a); };
    Kt.prototype.setFaceVertexValue_ByVertexIndex = function (e, t, a) { var i = this.getValueRef(t); if (i.isValid())
        if (i.approxEqual(a))
            ;
        else {
            if (t in this.__splits) {
                var i_41 = this.__splits[t];
                for (var t_62 in i_41) {
                    var s = i_41[t_62];
                    if (this.__splitValues[s].approxEqual(a))
                        return void (i_41[e] = s);
                }
                if (e in this.__splits[t]) {
                    return void this.__splitValues[this.__splits[t][e]].setFromOther(a);
                }
            }
            else
                this.__splits[t] = {};
            this.__splits[t][e] = this.__splitValues.length, this.__splitValues.push(a);
        }
    else
        i.setFromOther(a); };
    Kt.prototype.setSplitVertexValue = function (e, t, a) { if (e in this.__splits || (this.__splits[e] = {}), t in this.__splits[e]) {
        if (this.__splitValues[this.__splits[e][t]].approxEqual(a))
            return;
        console.warn("Face Vertex Already Split with different value");
    } this.__splits[e][t] = this.__splitValues.length, this.__splitValues.push(a); };
    Kt.prototype.setSplitVertexValues = function (e, t, a) { e in this.__splits || (this.__splits[e] = {}); var i = this.__splitValues.length; this.__splitValues.push(a); for (var _b = 0, t_63 = t; _b < t_63.length; _b++) {
        var a_59 = t_63[_b];
        this.__splits[e][a_59] = i;
    } };
    Kt.prototype.getSplits = function () { return this.__splits; };
    Kt.prototype.getSplitCount = function () { var e = 0; for (var t_64 in this.__splits)
        e += Object.keys(this.__splits[t_64]).length; return e; };
    Kt.prototype.generateSplitValues = function (e, t) { if (0 == t)
        return this.__data; var a = this.length, i = this.length + t, s = this.__dataType.numElements ? this.__dataType.numElements() : 1, n = new Float32Array(i * s); for (var e_45 = 0; e_45 < this.__data.length; e_45++)
        n[e_45] = this.__data[e_45]; for (var t_65 in e) {
        var i_42 = e[t_65];
        for (var e_46 in i_42) {
            var l = a + i_42[e_46];
            if (t_65 in this.__splits && e_46 in this.__splits[t_65]) {
                var a_60 = this.__splits[t_65][e_46];
                6 == this.__dataType ? n[l * s] = this.__splitValues[a_60] : this.__dataType.createFromFloat32Buffer(n.buffer, l * s).setFromOther(this.__splitValues[a_60]);
            }
            else {
                var e_47 = parseInt(t_65);
                for (var t_66 = 0; t_66 < s; t_66++)
                    e_47 * s + t_66 > this.__data.length && console.log("Error remapping src:" + e_47 * s + t_66), l * s + t_66 > n.length && console.log("Error remapping tgt:" + l * s + t_66), n[l * s + t_66] = this.__data[e_47 * s + t_66];
            }
        }
    } return n; };
    Kt.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return a.splits = this.__splits, a.splitValues = this.__splitValues, a; };
    Kt.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), this.__splits = e.splits, this.__splitValues = []; for (var _b = 0, _c = e.splitValues; _b < _c.length; _b++) {
        var t_67 = _c[_b];
        this.__splitValues.push(this.__dataType.createFromJSON(t_67));
    } };
    Kt.prototype.loadSplitValues = function (e) { var t = e.loadUInt32Array(); if (0 == t.length)
        return; var a = 0, i = 0; for (;;) {
        var e_48 = t[a++], s_5 = t[a++], n_3 = {};
        for (var e_49 = 0; e_49 < s_5; e_49++) {
            var e_50 = t[a++], s_6 = t[a++];
            n_3[e_50] = s_6, s_6 >= i && (i = s_6 + 1);
        }
        if (this.__splits[e_48] = n_3, a >= t.length)
            break;
    } var s = this.__numFloat32Elements, n = e.loadFloat32Array(i * s); this.__splitValues = []; for (var e_51 = 0; e_51 < i; e_51++) {
        var t_68 = this.__dataType.createFromFloat32Array(n.slice(e_51 * s, e_51 * s + s));
        this.__splitValues.push(t_68);
    } };
    return Kt;
}(Ct));
var wt = /** @class */ (function (_super) {
    __extends(wt, _super);
    function wt() {
        return _super.call(this) || this;
    }
    wt.prototype.loadBin = function (e) { this.name = e.loadStr(); var t = e.loadUInt32(); this.__boundingBox.set(e.loadFloat32Vec3(), e.loadFloat32Vec3()), this.setNumVertices(t); var a = this.vertices; if (t < 256) {
        var i_43 = this.__boundingBox.toMat4(), s = e.loadUInt8Array(3 * t);
        for (var e_52 = 0; e_52 < t; e_52++) {
            var t_69 = new Vec3(s[3 * e_52 + 0] / 255, s[3 * e_52 + 1] / 255, s[3 * e_52 + 2] / 255);
            a.setValue(e_52, i_43.transformVec3(t_69));
        }
    }
    else {
        var i_44 = e.loadUInt32(), s = [];
        for (var t_70 = 0; t_70 < i_44; t_70++) {
            var t_71 = e.loadUInt32Vec2(), a_61 = e.loadFloat32Vec3(), i_45 = e.loadFloat32Vec3();
            s.push({ range: t_71, bbox: new Box3(a_61, i_45) });
        }
        var n = e.loadUInt8Array(3 * t);
        for (var e_53 = 0; e_53 < i_44; e_53++) {
            var t_72 = s[e_53].bbox.toMat4();
            for (var i_46 = s[e_53].range.x; i_46 < s[e_53].range.y; i_46++) {
                var e_54 = new Vec3(n[3 * i_46 + 0] / 255, n[3 * i_46 + 1] / 255, n[3 * i_46 + 2] / 255);
                a.setValue(i_46, t_72.transformVec3(e_54));
            }
        }
    } };
    wt.prototype.readBinary = function (e, t) { _super.prototype.loadBaseGeomBinary.call(this, e), this.geomDataChanged.emit(); };
    return wt;
}(Nt));
var zt = /** @class */ (function (_super) {
    __extends(zt, _super);
    function zt() {
        var _this = this;
        _this = _super.call(this) || this, _this.__indices = new Uint32Array, _this.__segmentAttributes = new Map, _this.lineThickness = 0;
        return _this;
    }
    zt.prototype.getIndices = function () { return this.__indices; };
    zt.prototype.getNumSegments = function () { return this.__indices.length / 2; };
    zt.prototype.setNumSegments = function (e) { var t = new Uint32Array(2 * e); this.__indices = t; };
    zt.prototype.setSegment = function (e, t, a) { if (e >= this.__indices.length / 2)
        throw new Error("Invalid line index:" + e + ". Num Segments:" + this.__indices.length / 2); this.__indices[2 * e + 0] = t, this.__indices[2 * e + 1] = a; };
    zt.prototype.getSegmentVertexIndex = function (e, t) { if (e < this.numLines)
        return this.__indices[2 * e + t]; };
    zt.prototype.addSegmentAttribute = function (e, t, a) { var i = new Attribute(t, null != a ? a : this.polygonCount); return this.__segmentAttributes.set(e, i), i; };
    zt.prototype.hasSegmentAttribute = function (e) { return this.__segmentAttributes.has(e); };
    zt.prototype.getSegmentAttribute = function (e) { return this.__segmentAttributes.get(e); };
    zt.prototype.genBuffers = function () { var e = _super.prototype.genBuffers.call(this); var t; return e.numVertices < Math.pow(2, 8) ? (t = new Uint8Array(this.__indices.length), this.__indices.forEach(function (e, a) { t[a] = e; })) : e.numVertices < Math.pow(2, 16) ? (t = new Uint16Array(this.__indices.length), this.__indices.forEach(function (e, a) { t[a] = e; })) : t = this.__indices, e.indices = t, e; };
    zt.prototype.readBinary = function (e, t) { _super.prototype.loadBaseGeomBinary.call(this, e), this.setNumSegments(e.loadUInt32()); var a = e.loadUInt8(); 1 == a ? this.__indices = e.loadUInt8Array() : 2 == a ? this.__indices = e.loadUInt16Array() : 4 == a && (this.__indices = e.loadUInt32Array()), this.geomDataChanged.emit(); };
    zt.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return 1024 & t || (a.indices = Array.from(this.__indices)), a; };
    zt.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), this.__indices = Uint32Array.from(e.indices); };
    return zt;
}(Nt));
var Ut = /** @class */ (function (_super) {
    __extends(Ut, _super);
    function Ut() {
        var _this = this;
        _this = _super.call(this) || this, _this.init();
        return _this;
    }
    Ut.prototype.init = function () { this.__faceCounts = [], this.__faceVertexCounts = new Uint8Array, this.__faceOffsets = new Uint32Array, this.__faceVertexIndices = new Uint32Array, this.__numPopulatedFaceVertexIndices = 0, this.__faceAttributes = new Map, this.__edgeAttributes = new Map, this.__logTopologyWarnings = !1, this.edgeVerts = void 0, this.vertexEdges = void 0, this.numEdges = 0, this.edgeFlags = new Uint32Array, this.edgeAngles = new Float32Array; };
    Ut.prototype.getFaceVertexIndices = function () { return this.__faceVertexIndices; };
    Ut.prototype.getFaceCounts = function () { return this.__faceCounts; };
    Ut.prototype.clear = function () { this.__faceVertexIndices = void 0, this.__faceCounts = [], this.__numPopulatedFaceVertexIndices = 0; };
    Ut.prototype.setFaceCounts = function (e) { if (this.__numPopulatedFaceVertexIndices)
        throw new Error("Cannot set face counts on a mesh that is already populated. Please call 'clear' before re-building the mesh."); this.__faceCounts = e; var t = 0, a = 0, i = 3; for (var _b = 0, _c = this.__faceCounts; _b < _c.length; _b++) {
        var e_55 = _c[_b];
        t += e_55, a += e_55 * i, i++;
    } this.__faceVertexCounts = new Uint8Array(t), this.__faceOffsets = new Uint32Array(t), this.__faceVertexIndices = new Uint32Array(a); for (var _d = 0, _f = this.__faceAttributes; _d < _f.length; _d++) {
        var e_56 = _f[_d];
        e_56.resize(t);
    } };
    Ut.prototype.setFaceVertexIndices = function (e) { var t = Array.prototype.slice.call(arguments, 1), a = this.__numPopulatedFaceVertexIndices; for (var e_57 = 0; e_57 < t.length; e_57++)
        this.__faceVertexIndices[a + e_57] = t[e_57]; this.__faceVertexCounts[e] = t.length - 3, this.__faceOffsets[e] = a, this.__numPopulatedFaceVertexIndices += t.length; };
    Ut.prototype.getFaceVertexIndices = function (e) { var t = [], a = this.__faceOffsets[e], i = this.__faceVertexCounts[e] + 3; for (var e_58 = 0; e_58 < i; e_58++)
        t.push(this.__faceVertexIndices[a + e_58]); return t; };
    Ut.prototype.getFaceVertexIndex = function (e, t) { var a = this.__faceOffsets[e]; return this.__faceVertexIndices[a + t]; };
    Ut.prototype.getNumFaces = function () { return this.__faceVertexCounts.length; };
    Ut.prototype.addVertexAttribute = function (e, t, a) { var i = new Kt(this, t, null != this.vertices ? this.vertices.length : 0, a); return this.__vertexAttributes.set(e, i), i; };
    Ut.prototype.addFaceAttribute = function (e, t, a) { var i = new Ct(t, null != a ? a : this.getNumFaces()); return this.__faceAttributes.set(e, i), i; };
    Ut.prototype.hasFaceAttribute = function (e) { return this.__faceAttributes.has(e); };
    Ut.prototype.getFaceAttribute = function (e) { return this.__faceAttributes.get(e); };
    Ut.prototype.addEdgeAttribute = function (e, t, a) { var i = new Ct(t, null != a ? a : this.getNumEdges()); return this.__edgeAttributes.set(e, i), i; };
    Ut.prototype.hasEdgeAttribute = function (e) { return this.__edgeAttributes.has(e); };
    Ut.prototype.getEdgeAttribute = function (e) { return this.__edgeAttributes.get(e); };
    Ut.prototype.genTopologyInfo = function () {
        var _this = this;
        var e = {};
        this.vertexEdges = [], this.edgeFaces = [], this.edgeVerts = [], this.faceEdges = [], this.numEdges = 0;
        var t = function (t, a) { var i = t, s = a; if (s < i) {
            var e_59 = i;
            i = s, s = e_59;
        } var n = i + ">" + s; if (n in e)
            return e[n]; var l = _this.vertices.getValueRef(i), r = _this.vertices.getValueRef(s).subtract(l), o = { edgeIndex: _this.edgeFaces.length / 2, edgeVec: r }; return e[n] = o, _this.edgeFaces.push(-1), _this.edgeFaces.push(-1), _this.edgeVerts.push(i), _this.edgeVerts.push(s), _this.numEdges++, o; }, a = function (e, a, i) { var s = t(e, a).edgeIndex; if (a < e) {
            var e_60 = 2 * s + 0;
            _this.__logTopologyWarnings && -1 != _this.edgeFaces[e_60] && console.warn("Edge poly 0 already set. Mesh is non-manifold."), _this.edgeFaces[e_60] = i;
        }
        else {
            var e_61 = 2 * s + 1;
            _this.__logTopologyWarnings && -1 != _this.edgeFaces[e_61] && console.warn("Edge poly 1 already set. Mesh is non-manifold."), _this.edgeFaces[e_61] = i;
        } i in _this.faceEdges || (_this.faceEdges[i] = []), _this.faceEdges[i].push(s), null == _this.vertexEdges[e] && (_this.vertexEdges[e] = new Set), null == _this.vertexEdges[a] && (_this.vertexEdges[a] = new Set), _this.vertexEdges[e].add(s), _this.vertexEdges[a].add(s); }, i = this.getNumFaces();
        for (var e_62 = 0; e_62 < i; e_62++) {
            var t_73 = this.getFaceVertexIndices(e_62);
            for (var i_47 = 0; i_47 < t_73.length; i_47++) {
                a(t_73[i_47], t_73[(i_47 + 1) % t_73.length], e_62);
            }
        }
    };
    Ut.prototype.computeFaceNormals = function () { var e = this.vertices, t = this.addFaceAttribute("normals", Z), a = this.getNumFaces(); for (var i_48 = 0; i_48 < a; i_48++) {
        var a_62 = this.getFaceVertexIndices(i_48), s = e.getValueRef(a_62[0]);
        var n = e.getValueRef(a_62[1]);
        var l = new Z;
        for (var t_74 = 2; t_74 < a_62.length; t_74++) {
            var i_49 = e.getValueRef(a_62[t_74]), r = n.subtract(s), o = i_49.subtract(s);
            l.addInPlace(r.cross(o).normalize()), n = i_49;
        }
        l.lengthSquared(), t.setValue(i_48, l.normalize());
    } };
    Ut.prototype.generateEdgeFlags = function () { null == this.vertexEdges && this.genTopologyInfo(), this.hasFaceAttribute("normals") || this.computeFaceNormals(); var e = this.vertices, t = this.getFaceAttribute("normals"); this.edgeVecs = [], this.edgeAngles = new Float32Array(this.numEdges); for (var a_63 = 0; a_63 < this.edgeFaces.length; a_63 += 2) {
        var i_50 = this.edgeVerts[a_63], s = this.edgeVerts[a_63 + 1], n = e.getValueRef(s).subtract(e.getValueRef(i_50));
        n.normalizeInPlace(), this.edgeVecs.push(n);
        var l = this.edgeFaces[a_63], r = this.edgeFaces[a_63 + 1];
        if (-1 == l || -1 == r) {
            this.edgeAngles[a_63 / 2] = 2 * Math.PI;
            continue;
        }
        var o = t.getValueRef(l), d = t.getValueRef(r);
        this.edgeAngles[a_63 / 2] = o.angleTo(d);
    } };
    Ut.prototype.computeVertexNormals = function (e) {
        var _this = this;
        if (e === void 0) { e = 1; }
        this.generateEdgeFlags();
        var t = this.getFaceAttribute("normals"), a = this.addVertexAttribute("normals", Z), i = t.data.buffer, s = function (e) { return new Z(i, 12 * e); }, n = a.data, l = function (e, t) { n[3 * e + 0] = t.x, n[3 * e + 1] = t.y, n[3 * e + 2] = t.z; }, r = function (e, t) { var a, i; var s = _this.faceEdges[e]; for (var _b = 0, s_7 = s; _b < s_7.length; _b++) {
            var e_63 = s_7[_b];
            (_this.edgeVerts[2 * e_63] == t || _this.edgeVerts[2 * e_63 + 1] == t) && (a ? i = _this.edgeVecs[e_63] : a = _this.edgeVecs[e_63]);
        } return [a, i]; };
        var _loop_2 = function (t_75) {
            if (null == this_2.vertexEdges[t_75])
                return "continue";
            var i_52 = this_2.vertexEdges[t_75], n_5 = [], o = function (e) { var t = !1; for (var _b = 0, n_6 = n_5; _b < n_6.length; _b++) {
                var a_64 = n_6[_b];
                if (t = -1 != a_64.indexOf(e), t)
                    break;
            } t || n_5.push([e]); };
            for (var _b = 0, i_51 = i_52; _b < i_51.length; _b++) {
                var t_76 = i_51[_b];
                var a_65 = this_2.edgeFaces[2 * t_76], i_53 = this_2.edgeFaces[2 * t_76 + 1];
                if (-1 != a_65 && -1 == i_53 && this_2.edgeAngles[t_76] < e) {
                    var e_65 = -1, t_77 = -1;
                    for (var s_8 = 0; s_8 < n_5.length; s_8++)
                        -1 == e_65 && -1 != n_5[s_8].indexOf(a_65) && (e_65 = s_8), -1 == t_77 && -1 != n_5[s_8].indexOf(i_53) && (t_77 = s_8);
                    -1 == e_65 && -1 == t_77 ? n_5.push([a_65, i_53]) : -1 != e_65 && -1 != t_77 ? e_65 != t_77 && (n_5[e_65] = n_5[e_65].concat(n_5[t_77]), n_5.splice(t_77, 1)) : (-1 == e_65 && n_5[t_77].push(a_65), -1 == t_77 && n_5[e_65].push(i_53));
                }
                else
                    -1 != a_65 && o(a_65), -1 != i_53 && o(i_53);
            }
            n_5.sort(function (e, t) { return e.length < t.length ? 1 : e.length > t.length ? -1 : 0; });
            var d = !0;
            for (var _c = 0, n_4 = n_5; _c < n_4.length; _c++) {
                var e_66 = n_4[_c];
                var i_54 = new Z;
                for (var _d = 0, e_64 = e_66; _d < e_64.length; _d++) {
                    var a_66 = e_64[_d];
                    var e_67 = r(a_66, t_75), n_7 = e_67[0].angleTo(e_67[1]);
                    i_54.addInPlace(s(a_66).scale(n_7));
                }
                i_54.normalizeInPlace(), d ? (l(t_75, i_54), d = !1) : a.setSplitVertexValues(t_75, e_66, i_54);
            }
        };
        var this_2 = this;
        for (var t_75 = 0; t_75 < this.vertexEdges.length; t_75++) {
            _loop_2(t_75);
        }
        return a;
    };
    Ut.prototype.computeNumTriangles = function () { var e = 3, t = 0; for (var _b = 0, _c = this.__faceCounts; _b < _c.length; _b++) {
        var a_67 = _c[_b];
        t += a_67 * (e - 2), e++;
    } return t; };
    Ut.prototype.generateTriangulatedIndices = function (e, t, a) { var i = this.computeNumTriangles(); var s; s = e < Math.pow(2, 8) ? new Uint8Array(3 * i) : e < Math.pow(2, 16) ? new Uint16Array(3 * i) : new Uint32Array(3 * i); var n = 0; var l = function (e, i) { e in a && i in a[e] && (e = t + a[e][i]), s[n] = e, n++; }, r = this.getNumFaces(); for (var e_68 = 0; e_68 < r; e_68++) {
        var t_78 = this.getFaceVertexIndices(e_68);
        for (var a_68 = 0; a_68 < t_78.length; a_68++)
            a_68 >= 3 && (l(t_78[0], e_68), l(t_78[a_68 - 1], e_68)), l(t_78[a_68], e_68);
    } return s; };
    Ut.prototype.computeHardEdgesIndices = function (e) {
        var _this = this;
        if (e === void 0) { e = 1; }
        var t = [], a = function (e) { t.push(_this.edgeVerts[e]), t.push(_this.edgeVerts[e + 1]); };
        for (var t_79 = 0; t_79 < this.edgeFlags.length; t_79 += 2)
            this.edgeAngles[t_79 / 2] > e && a(t_79);
        return t;
    };
    Ut.prototype.getWireframeIndices = function () { return indices; };
    Ut.prototype.genBuffers = function (e) { var t = {}; var a = 0; for (var _b = 0, _c = this.__vertexAttributes; _b < _c.length; _b++) {
        var _d = _c[_b], e_69 = _d[1];
        var i_55 = e_69.getSplits();
        for (var e_70 in i_55) {
            e_70 in t || (t[e_70] = {});
            var s_9 = i_55[e_70];
            for (var i_56 in s_9) {
                var s_10 = parseInt(i_56);
                s_10 in t[e_70] || (t[e_70][s_10] = a, a++);
            }
        }
    } var i = this.vertices.length, s = i + a; var n; e && 0 == e.includeIndices || (n = this.generateTriangulatedIndices(s, i, t)); var l = {}; for (var _f = 0, _g = this.__vertexAttributes; _f < _g.length; _f++) {
        var _h = _g[_f], e_71 = _h[0], i_57 = _h[1];
        var s_11 = void 0;
        s_11 = 0 == a ? i_57.data : i_57.generateSplitValues(t, a);
        var n_9 = i_57.numElements, r_1 = s_11.length / n_9;
        l[e_71] = { values: s_11, count: r_1, dimension: n_9, normalized: "normals" == e_71, dataType: i_57.dataType };
    } var r = { numVertices: this.numVertices(), numRenderVerts: s, indices: n, attrBuffers: l }; if (e && e.includeVertexNeighbors) {
        null == this.vertexEdges && this.genTopologyInfo();
        var e_72 = 0;
        for (var t_80 = 0; t_80 < this.vertexEdges.length; t_80++)
            this.vertexEdges[t_80] && (e_72 += this.vertexEdges[t_80].size);
        var t_81 = new Uint32Array(2 * this.vertexEdges.length + e_72), a_69 = function (e) { for (var t_82 = 0; t_82 < e.length; t_82++) {
            var a_70 = e[t_82];
            for (var i_58 = 0; i_58 < t_82; i_58++) {
                var s_12 = e[i_58];
                if (-1 != a_70[0] && a_70[0] == s_12[1]) {
                    t_82 != i_58 + 1 && (e.splice(t_82, 1), e.splice(i_58 + 1, 0, a_70));
                    break;
                }
                if (-1 != a_70[1] && a_70[1] == s_12[0]) {
                    e.splice(t_82, 1), e.splice(i_58, 0, a_70);
                    break;
                }
            }
        } }, i_59 = function (e) { if (!(-1 != e[0][0] && -1 != e[e.length - 1][1] || -1 == e[0][0] && -1 == e[e.length - 1][1]))
            throw new Error("If fan starts with -1, it must also end with -1"); for (var t_83 = 0; t_83 < e.length; t_83++) {
            var a_71 = e[t_83];
            if ((-1 == a_71[0] || -1 == a_71[1]) && 0 != t_83 && t_83 != e.length - 1)
                throw new Error("-1 only allowed at the beginning and end of a fan.");
            if (-1 != a_71[0]) {
                var i_60 = t_83 - 1;
                if (i_60 < 0 && (i_60 += e.length), a_71[0] != e[i_60][1])
                    throw new Error("Faces are not sequential");
            }
            if (-1 != a_71[1]) {
                var i_61 = (t_83 + 1) % e.length;
                if (a_71[1] != e[i_61][0])
                    throw new Error("Faces are not sequential");
            }
        } };
        var s_13 = 2 * this.vertexEdges.length;
        for (var e_73 = 0; e_73 < this.vertexEdges.length; e_73++) {
            if (null == this.vertexEdges[e_73])
                continue;
            var n_10 = this.vertexEdges[e_73], l_3 = [];
            for (var _j = 0, n_8 = n_10; _j < n_8.length; _j++) {
                var t_84 = n_8[_j];
                var a_72 = this.edgeVerts[2 * t_84], i_62 = this.edgeVerts[2 * t_84 + 1];
                var s_14 = void 0, n_11 = this.edgeFaces[2 * t_84], r_2 = this.edgeFaces[2 * t_84 + 1];
                if (a_72 == e_73)
                    s_14 = i_62;
                else {
                    if (i_62 != e_73)
                        throw new Error("Invalid topology");
                    {
                        s_14 = a_72;
                        var e_74 = n_11;
                        n_11 = r_2, r_2 = e_74;
                    }
                }
                l_3.push([n_11, r_2, s_14]);
            }
            a_69(l_3), i_59(l_3);
            var r_3 = 0;
            (-1 != l_3[0][0] || -1 != l_3[l_3.length - 1][1]) && (r_3 += 1), t_81[2 * e_73] = s_13, t_81[2 * e_73 + 1] = n_10.size + (r_3 << 8);
            for (var _k = 0, l_2 = l_3; _k < l_2.length; _k++) {
                var e_75 = l_2[_k];
                t_81[s_13] = e_75[2], s_13++;
            }
        }
        r.vertexNeighbors = t_81;
    } return r; };
    Ut.prototype.freeBuffers = function () { _super.prototype.freeBuffers.call(this), this.init(); };
    Ut.prototype.readBinary = function (e, t) { _super.prototype.loadBaseGeomBinary.call(this, e), this.setFaceCounts(e.loadUInt32Array()), this.__faceVertexCounts = e.loadUInt8Array(this.__faceVertexCounts.length); var a = e.loadSInt32Vec2(), i = e.loadUInt8(); var s; 1 == i ? s = e.loadUInt8Array() : 2 == i ? s = e.loadUInt16Array() : 4 == i && (s = e.loadUInt32Array()); var n = this.getNumFaces(); var l = 0, r = 0; for (var e_76 = 0; e_76 < n; e_76++) {
        var t_85 = this.__faceVertexCounts[e_76] + 3;
        this.__faceOffsets[e_76] = l;
        for (var i_63 = 0; i_63 < t_85; i_63++) {
            var t_86 = l + i_63, n_12 = s[t_86] + a.x;
            if (0 == e_76)
                this.__faceVertexIndices[t_86] = n_12;
            else {
                var a_73 = this.__faceOffsets[e_76 - 1];
                a_73 += i_63 < r ? i_63 : r - 1, this.__faceVertexIndices[t_86] = this.__faceVertexIndices[a_73] + n_12;
            }
        }
        l += t_85, r = t_85;
    } this.__numPopulatedFaceVertexIndices = l; var o = e.loadUInt32(); if (o > 0) {
        var t_87 = this.vertices, a_74 = this.addVertexAttribute("lightmapCoords", _);
        for (var i_64 = 0; i_64 < o; i_64++) {
            var i_65 = new S(e.loadFloat32Vec3(), e.loadFloat32Quat()), s_15 = e.loadFloat32(), n_13 = e.loadFloat32Vec2(), l_4 = e.loadSInt32Vec2(), r_4 = e.loadUInt8();
            var o_3 = void 0;
            o_3 = 1 == r_4 ? e.loadUInt8Array() : 2 == r_4 ? e.loadUInt16Array() : e.loadUInt32Array();
            var d = 0;
            for (var _b = 0, o_1 = o_3; _b < o_1.length; _b++) {
                var e_77 = o_1[_b];
                var r_5 = e_77 + l_4.x;
                r_5 += d, d = r_5;
                var o_4 = this.getFaceVertexIndices(r_5);
                for (var _c = 0, o_2 = o_4; _c < o_2.length; _c++) {
                    var e_78 = o_2[_c];
                    var l_5 = t_87.getValueRef(e_78), o_5 = i_65.transformVec3(l_5), d_1 = new _(o_5.x, o_5.z);
                    d_1.scaleInPlace(s_15), d_1.addInPlace(n_13), a_74.setFaceVertexValue_ByVertexIndex(r_5, e_78, d_1);
                }
            }
        }
    } this.hasVertexAttribute("normals") || this.computeVertexNormals(), this.geomDataChanged.emit(); };
    Ut.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return 1024 & t || (a.faceCounts = Array.from(this.__faceCounts), a.faceVertexIndices = Array.from(this.__faceVertexIndices)), a; };
    Ut.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), e.faceCounts && (this.__faceCounts = Uint32Array.from(e.faceCounts)), e.faceVertexIndices && (this.__faceVertexIndices = Uint32Array.from(e.faceVertexIndices)); };
    return Ut;
}(Nt));
var Jt = /** @class */ (function (_super) {
    __extends(Jt, _super);
    function Jt(e) {
        var _this = this;
        if (_this = _super.call(this) || this, _this.name = e.name, _this.__buffers = e.geomBuffers, _this.__buffers.attrBuffers)
            for (var e_79 in _this.__buffers.attrBuffers) {
                var t_88 = _this.__buffers.attrBuffers[e_79], a_75 = g.getType(t_88.dataType);
                t_88.dataType = a_75;
            }
        _this.boundingBox = new v, _this.boundingBox.p0.__data = e.bbox.p0.__data, _this.boundingBox.p1.__data = e.bbox.p1.__data, _this.__metaData = new Map, _this.boundingBoxDirtied = new C, _this.geomDataChanged = new C, _this.geomDataTopologyChanged = new C;
        return _this;
    }
    Jt.prototype.genBuffers = function () { return this.__buffers; };
    Jt.prototype.freeBuffers = function () { if (this.__buffers.indices && (delete this.__buffers.indices), this.__buffers.attrBuffers) {
        for (var a_76 in this.__buffers.attrBuffers) {
            delete this.__buffers.attrBuffers[a_76];
        }
        delete this.__buffers.attrBuffers;
    } };
    Jt.prototype.getMetadata = function (e) { return this.__metaData.get(e); };
    Jt.prototype.hasMetadata = function (e) { return this.__metaData.has(e); };
    Jt.prototype.setMetadata = function (e, t) { this.__metaData.set(e, t); };
    return Jt;
}(U));
var Pt = /** @class */ (function (_super) {
    __extends(Pt, _super);
    function Pt(e) {
        return _super.call(this, e) || this;
    }
    return Pt;
}(Jt));
var Et = /** @class */ (function (_super) {
    __extends(Et, _super);
    function Et(e) {
        return _super.call(this, e) || this;
    }
    return Et;
}(Jt));
var Ht = /** @class */ (function (_super) {
    __extends(Ht, _super);
    function Ht(e) {
        return _super.call(this, e) || this;
    }
    return Ht;
}(Jt));
var kt = /** @class */ (function (_super) {
    __extends(kt, _super);
    function kt(e, t, a, i, s) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 1; }
        if (i === void 0) { i = 1; }
        if (s === void 0) { s = !1; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a) || isNaN(i))
            throw new Error("Invalid geom args");
        _this.__x = e, _this.__y = t, _this.__xDivisions = a, _this.__yDivisions = i, s && _this.addVertexAttribute("texCoords", _), _this.__rebuild();
        return _this;
    }
    Object.defineProperty(kt.prototype, "x", {
        get: function () { return console.warn("getter is deprectated. Please use 'getX'"), this.getX(); },
        set: function (e) { console.warn("getter is deprectated. Please use 'setX'"), this.setX(e); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(kt.prototype, "y", {
        get: function () { return console.warn("getter is deprectated. Please use 'getY'"), this.getY(); },
        set: function (e) { console.warn("getter is deprectated. Please use 'setY'"), this.setY(e); },
        enumerable: true,
        configurable: true
    });
    kt.prototype.getX = function () { return this.__x; };
    kt.prototype.setX = function (e) { this.__x = e, this.__resize(); };
    kt.prototype.getY = function () { return this.__y; };
    kt.prototype.setY = function (e) { this.__y = e, this.__resize(); };
    kt.prototype.setSize = function (e, t) { this.__x = e, this.__y = t, this.__resize(); };
    kt.prototype.__rebuild = function () { this.setNumVertices(this.__xDivisions * this.__yDivisions); var e = this.getVertexAttribute("texCoords"); if (e)
        for (var t_89 = 0; t_89 < this.__yDivisions; t_89++) {
            var a_77 = t_89 / (this.__yDivisions - 1);
            for (var i_66 = 0; i_66 < this.__xDivisions; i_66++) {
                var s = i_66 / (this.__xDivisions - 1);
                e.getValueRef(t_89 * this.__xDivisions + i_66).set(s, a_77);
            }
        } this.__resize(); };
    kt.prototype.__resize = function () { for (var e_80 = 0; e_80 < this.__yDivisions; e_80++) {
        var t_90 = (e_80 / (this.__yDivisions - 1) - .5) * this.__y;
        for (var a_78 = 0; a_78 < this.__xDivisions; a_78++) {
            var i_67 = (a_78 / (this.__xDivisions - 1) - .5) * this.__x;
            this.getVertex(e_80 * this.__xDivisions + a_78).set(i_67, t_90, 0);
        }
    } this.setBoundingBoxDirty(); };
    kt.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.x = this.__x, e.y = this.__y, e.xDivisions = this.__xDivisions, e.yDivisions = this.__yDivisions, e; };
    return kt;
}(wt));
var Bt = /** @class */ (function (_super) {
    __extends(Bt, _super);
    function Bt(e, t) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 1; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t))
            throw new Error("Invalid geom args");
        _this.__x = _this.addParameter(new Xe("x", e)), _this.__x.valueChanged.connect(_this.__resize.bind(_this)), _this.__y = _this.addParameter(new Xe("y", t)), _this.__y.valueChanged.connect(_this.__resize.bind(_this)), _this.__rebuild();
        return _this;
    }
    Object.defineProperty(Bt.prototype, "x", {
        get: function () { return this.__x.getValue(); },
        set: function (e) { this.__x.setValue(e); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Bt.prototype, "y", {
        get: function () { return this.__y.getValue(); },
        set: function (e) { this.__y.setValue(e); },
        enumerable: true,
        configurable: true
    });
    Bt.prototype.setSize = function (e, t) { this.__x.setValue(e, -1), this.__y.setValue(t, -1), this.__resize(); };
    Bt.prototype.__rebuild = function () { this.setNumVertices(4), this.setNumSegments(4), this.setSegment(0, 0, 1), this.setSegment(1, 1, 2), this.setSegment(2, 2, 3), this.setSegment(3, 3, 0), this.__resize(-1), this.geomDataTopologyChanged.emit(); };
    Bt.prototype.__resize = function (e) { var t = this.__x.getValue(), a = this.__y.getValue(); this.getVertex(0).set(-.5 * t, -.5 * a, 0), this.getVertex(1).set(.5 * t, -.5 * a, 0), this.getVertex(2).set(.5 * t, .5 * a, 0), this.getVertex(3).set(-.5 * t, .5 * a, 0), this.setBoundingBoxDirty(), -1 != e && this.geomDataChanged.emit(); };
    Bt.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.x = this.__x, e.y = this.__y, e; };
    return Bt;
}(zt));
J.registerClass("Rect", Bt);
var Dt = /** @class */ (function (_super) {
    __extends(Dt, _super);
    function Dt(e, t, a) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 2 * Math.PI; }
        if (a === void 0) { a = 32; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(a))
            throw new Error("Invalid geom args");
        _this.__radius = _this.addParameter(new Xe("Radius", e)), _this.__angle = _this.addParameter(new Xe("Angle", t)), _this.__numSegments = _this.addParameter(new Xe("NumSegments", a >= 3 ? a : 3, [3, 200], 1)), _this.__radius.valueChanged.connect(_this.__resize.bind(_this)), _this.__angle.valueChanged.connect(_this.__rebuild.bind(_this)), _this.__numSegments.valueChanged.connect(_this.__rebuild.bind(_this)), _this.__rebuild();
        return _this;
    }
    Dt.prototype.__rebuild = function () { var e = this.__numSegments.getValue(); this.setNumVertices(e); var t = this.__angle.getValue() < 2 * Math.PI; t ? this.setNumSegments(e - 1) : this.setNumSegments(e); for (var a_79 = 0; a_79 < (t ? e - 1 : e); a_79++)
        this.setSegment(a_79, a_79, (a_79 + 1) % e); this.__resize(-1), this.geomDataTopologyChanged.emit(); };
    Dt.prototype.__resize = function (e) { var t = this.__radius.getValue(), a = this.__numSegments.getValue(), i = this.__angle.getValue() / a; for (var e_81 = 0; e_81 < a; e_81++)
        this.getVertex(e_81).set(Math.cos(i * e_81) * t, Math.sin(i * e_81) * t, 0); this.setBoundingBoxDirty(), -1 != e && this.geomDataChanged.emit(); };
    return Dt;
}(zt));
J.registerClass("Circle", Dt);
var Ot = /** @class */ (function (_super) {
    __extends(Ot, _super);
    function Ot(e) {
        if (e === void 0) { e = 1; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e))
            throw new Error("Invalid geom args");
        _this.__sizeParam = _this.addParameter(new Xe("size", e)), _this.__rebuild();
        _this.__sizeParam.valueChanged.connect(function () { _this.__resize(); });
        return _this;
    }
    Object.defineProperty(Ot.prototype, "size", {
        get: function () { return this.__size; },
        set: function (e) { this.__size = e, this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Ot.prototype.__rebuild = function () { this.setNumVertices(6), this.setNumSegments(3), this.setSegment(0, 0, 1), this.setSegment(1, 2, 3), this.setSegment(2, 4, 5), this.__resize(); };
    Ot.prototype.__resize = function () { var e = this.__sizeParam.getValue(); this.getVertex(0).set(-.5 * e, 0, 0), this.getVertex(1).set(.5 * e, 0, 0), this.getVertex(2).set(0, .5 * e, 0), this.getVertex(3).set(0, -.5 * e, 0), this.getVertex(4).set(0, 0, .5 * e), this.getVertex(5).set(0, 0, -.5 * e), this.setBoundingBoxDirty(); };
    return Ot;
}(zt));
J.registerClass("Cross", Ot);
var Qt = /** @class */ (function (_super) {
    __extends(Qt, _super);
    function Qt(e, t, a, i) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 1; }
        if (i === void 0) { i = !1; }
        var _this = this;
        _this = _super.call(this) || this, _this.__x = _this.addParameter(new Xe("x", e)), _this.__x.valueChanged.connect(_this.__resize.bind(_this)), _this.__y = _this.addParameter(new Xe("y", t)), _this.__y.valueChanged.connect(_this.__resize.bind(_this)), _this.__z = _this.addParameter(new Xe("z", a)), _this.__z.valueChanged.connect(_this.__resize.bind(_this)), _this.__baseZAtZero = _this.addParameter(new Xe("BaseZAtZero", i)), _this.__baseZAtZero.valueChanged.connect(_this.__rebuild.bind(_this)), _this.__rebuild();
        return _this;
    }
    Qt.prototype.__rebuild = function () { this.setNumVertices(8), this.setNumSegments(12), this.setSegment(0, 0, 1), this.setSegment(1, 1, 2), this.setSegment(2, 2, 3), this.setSegment(3, 3, 0), this.setSegment(4, 4, 5), this.setSegment(5, 5, 6), this.setSegment(6, 6, 7), this.setSegment(7, 7, 4), this.setSegment(8, 0, 4), this.setSegment(9, 1, 5), this.setSegment(10, 2, 6), this.setSegment(11, 3, 7), this.__resize(-1), this.geomDataTopologyChanged.emit(); };
    Qt.prototype.__resize = function (e) { var t = this.__x.getValue(), a = this.__y.getValue(), i = this.__z.getValue(), s = this.__baseZAtZero.getValue(); var n = .5; s && (n = 1), this.getVertex(0).set(.5 * t, -.5 * a, n * i), this.getVertex(1).set(.5 * t, .5 * a, n * i), this.getVertex(2).set(-.5 * t, .5 * a, n * i), this.getVertex(3).set(-.5 * t, -.5 * a, n * i), n = -.5, s && (n = 0), this.getVertex(4).set(.5 * t, -.5 * a, n * i), this.getVertex(5).set(.5 * t, .5 * a, n * i), this.getVertex(6).set(-.5 * t, .5 * a, n * i), this.getVertex(7).set(-.5 * t, -.5 * a, n * i), this.setBoundingBoxDirty(), -1 != e && this.geomDataChanged.emit(); };
    Qt.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.size = this.__size, e; };
    return Qt;
}(zt));
J.registerClass("LinesCuboid", Qt);
var At = /** @class */ (function (_super) {
    __extends(At, _super);
    function At(e, t, a, i, s) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 10; }
        if (i === void 0) { i = 10; }
        if (s === void 0) { s = !1; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a) || isNaN(i))
            throw new Error("Invalid geom args");
        _this.__xParam = _this.addParameter(new Xe("x", e)), _this.__yParam = _this.addParameter(new Xe("y", t)), _this.__xDivisionsParam = _this.addParameter(new Xe("xDivisions", a)), _this.__yDivisionsParam = _this.addParameter(new Xe("yDivisions", i)), _this.__skipCenterLinesParam = _this.addParameter(new fe("skipCenterLines", s)), _this.__rebuild();
        return _this;
    }
    Object.defineProperty(At.prototype, "sizeX", {
        get: function () { return this.__x; },
        set: function (e) { this.__x = e, this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(At.prototype, "sizeY", {
        get: function () { return this.__y; },
        set: function (e) { this.__y = e, this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(At.prototype, "divisionsX", {
        get: function () { return this.__xDivisions; },
        set: function (e) { this.__xDivisions = e, this.__rebuild(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(At.prototype, "divisionsY", {
        get: function () { return this.__yDivisions; },
        set: function (e) { this.__yDivisions = e, this.__rebuild(); },
        enumerable: true,
        configurable: true
    });
    At.prototype.setSize = function (e, t) { this.__x = e, this.__y = t, this.__resize(); };
    At.prototype.__rebuild = function () { var e = this.__xDivisionsParam.getValue(), t = this.__yDivisionsParam.getValue(), a = this.__skipCenterLinesParam.getValue() && e % 2 == 0 && t % 2 == 0; this.setNumVertices(2 * (e + t + 2 - (a ? 1 : 0))), this.setNumSegments(e + t + 2 - (a ? 1 : 0)); var i = 0; for (var t_91 = 0; t_91 <= e; t_91++) {
        if (a && t_91 == e / 2)
            continue;
        var s = 2 * i, n = 2 * i + 1;
        this.setSegment(i, s, n), i++;
    } for (var s = 0; s <= t; s++) {
        if (a && s == e / 2)
            continue;
        var t_92 = 2 * i, n = 2 * i + 1;
        this.setSegment(i, t_92, n), i++;
    } this.__resize(); };
    At.prototype.__resize = function () { var e = this.__xDivisionsParam.getValue(), t = this.__yDivisionsParam.getValue(), a = this.__xParam.getValue(), i = this.__yParam.getValue(), s = this.__skipCenterLinesParam.getValue() && e % 2 == 0 && t % 2 == 0; var n = 0; for (var t_93 = 0; t_93 <= e; t_93++) {
        if (s && t_93 == e / 2)
            continue;
        var l = 2 * n, r = 2 * n + 1, o = (t_93 / e - .5) * a;
        this.getVertex(l).set(o, -.5 * i, 0), this.getVertex(r).set(o, .5 * i, 0), n++;
    } for (var l = 0; l <= t; l++) {
        if (s && l == e / 2)
            continue;
        var r = 2 * n, o = 2 * n + 1, d = (l / t - .5) * i;
        this.getVertex(r).set(-.5 * a, d, 0), this.getVertex(o).set(.5 * a, d, 0), n++;
    } this.setBoundingBoxDirty(); };
    At.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.x = this.__x, e.z = this.__y, e.xDivisions = this.__xDivisions, e.yDivisions = this.__yDivisions, e; };
    return At;
}(zt));
J.registerClass("Grid", At);
var jt = /** @class */ (function (_super) {
    __extends(jt, _super);
    function jt(e, t, a, i) {
        if (e === void 0) { e = .5; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 32; }
        if (i === void 0) { i = !0; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a))
            throw new Error("Invalid geom args");
        _this.__radiusParam = _this.addParameter(new Xe("radius", e)), _this.__heightParam = _this.addParameter(new Xe("height", t)), _this.__detailParam = _this.addParameter(new Xe("detail", a >= 3 ? a : 3, [3, 200], 1)), _this.__capParam = _this.addParameter(new fe("cap", i)), _this.addVertexAttribute("texCoords", _), _this.addVertexAttribute("normals", Z), _this.__rebuild();
        var s = function () { _this.__resize(); }, n = function () { _this.__rebuild(); };
        _this.__radiusParam.valueChanged.connect(s), _this.__heightParam.valueChanged.connect(s), _this.__detailParam.valueChanged.connect(n), _this.__capParam.valueChanged.connect(n);
        return _this;
    }
    Object.defineProperty(jt.prototype, "radius", {
        get: function () { return this.__radiusParam.getValue(); },
        set: function (e) { this.__radiusParam.setValue(e), this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(jt.prototype, "height", {
        get: function () { return this.__heightParam.getValue(); },
        set: function (e) { this.__heightParam.setValue(e), this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(jt.prototype, "detail", {
        get: function () { return this.__detailParam.getValue(); },
        set: function (e) { this.__detailParam.setValue(e), this.__rebuild(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(jt.prototype, "cap", {
        get: function () { return this.__capParam.getValue(); },
        set: function (e) { this.__capParam.setValue(e), this.__rebuild(); },
        enumerable: true,
        configurable: true
    });
    jt.prototype.__rebuild = function () { this.clear(); var e = this.__detailParam.getValue(), t = this.__radiusParam.getValue(), a = this.__heightParam.getValue(), i = this.__capParam.getValue(); var s = e + 1; i && (s += 1), this.setNumVertices(s); var n = e, l = e + 1; this.getVertex(n).set(0, 0, a); for (var a_80 = 0; a_80 < e; a_80++) {
        var i_68 = a_80 / e * 2 * Math.PI;
        this.getVertex(a_80).set(t * Math.cos(i_68), t * Math.sin(i_68), 0);
    } i && this.getVertex(l).set(0, 0, 0), this.setFaceCounts([e + (i ? e : 0)]); for (var t_94 = 0; t_94 < e; t_94++) {
        var a_81 = (t_94 + 1) % e;
        this.setFaceVertexIndices(t_94, a_81, t_94, n);
    } if (i)
        for (var t_95 = 0; t_95 < e; t_95++) {
            var a_82 = (t_95 + 1) % e;
            this.setFaceVertexIndices(e + t_95, t_95, a_82, l);
        } var r = this.getVertexAttribute("normals"); var o; var d = a; Math.abs(a) < 1e-12 && (o = a < 0 ? -1e-12 : 1e-12), o = t / d; var h = 0; for (var t_96 = 0; t_96 < e; t_96++) {
        var a_83 = (t_96 + 1) / e * 2 * Math.PI, i_69 = t_96 / e * 2 * Math.PI, s_16 = .5 * (a_83 + i_69);
        r.setFaceVertexValue(h, 0, new Z(Math.cos(a_83), o, Math.sin(a_83)).normalize()), r.setFaceVertexValue(h, 1, new Z(Math.cos(i_69), o, Math.sin(i_69)).normalize()), r.setFaceVertexValue(h, 2, new Z(Math.cos(s_16), o, Math.sin(s_16)).normalize()), h++;
    } if (i) {
        var t_97 = new Z(0, -1, 0);
        for (var a_84 = 0; a_84 < e; a_84++)
            r.setFaceVertexValue(h, 0, t_97), r.setFaceVertexValue(h, 1, t_97), r.setFaceVertexValue(h, 2, t_97), h++;
    } var c = this.getVertexAttribute("texCoords"); h = 0; for (var t_98 = 0; t_98 < e; t_98++)
        c.setFaceVertexValue(h, 0, new _((t_98 + 1) / e, 0)), c.setFaceVertexValue(h, 1, new _(t_98 / e, 0)), c.setFaceVertexValue(h, 2, new _((t_98 + .5) / e, 1)); if (i)
        for (var t_99 = 0; t_99 < e; t_99++)
            c.setFaceVertexValue(h, 0, new _(t_99 / e, 0)), c.setFaceVertexValue(h, 1, new _((t_99 + 1) / e, 0)), c.setFaceVertexValue(h, 2, new _((t_99 + .5) / e, 1)), h++; this.setBoundingBoxDirty(); };
    jt.prototype.__resize = function () { var e = this.__detailParam.getValue(), t = this.__radiusParam.getValue(), a = this.__heightParam.getValue(), i = (this.__capParam.getValue(), e), s = e + 1; this.getVertex(i).set(0, 0, a); for (var a_85 = 0; a_85 < e; a_85++) {
        var i_70 = a_85 / e * 2 * Math.PI;
        this.getVertex(a_85).set(t * Math.cos(i_70), t * Math.sin(i_70), 0);
    } this.__cap && this.getVertex(s).set(0, 0, 0), this.setBoundingBoxDirty(); };
    return jt;
}(Ut));
J.registerClass("Cone", jt);
var qt = /** @class */ (function (_super) {
    __extends(qt, _super);
    function qt(e, t, a, i) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 1; }
        if (i === void 0) { i = !1; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a))
            throw new Error("Invalid geom args");
        _this.__xParam = _this.addParameter(new Xe("x", e)), _this.__yParam = _this.addParameter(new Xe("y", t)), _this.__zParam = _this.addParameter(new Xe("z", a)), _this.__baseZAtZeroParam = _this.addParameter(new fe("baseZAtZero", i)), _this.setFaceCounts([0, 6]), _this.setFaceVertexIndices(0, 0, 1, 2, 3), _this.setFaceVertexIndices(1, 7, 6, 5, 4), _this.setFaceVertexIndices(2, 1, 0, 4, 5), _this.setFaceVertexIndices(3, 3, 2, 6, 7), _this.setFaceVertexIndices(4, 0, 3, 7, 4), _this.setFaceVertexIndices(5, 2, 1, 5, 6), _this.setNumVertices(8), _this.addVertexAttribute("texCoords", _), _this.addVertexAttribute("normals", Z), _this.__rebuild();
        var s = function () { _this.__resize(); };
        _this.__xParam.valueChanged.connect(s), _this.__yParam.valueChanged.connect(s), _this.__zParam.valueChanged.connect(s), _this.__baseZAtZeroParam.valueChanged.connect(s);
        return _this;
    }
    qt.prototype.setSize = function (e, t, a) { this.__xParam.setValue(e), this.__yParam.setValue(t), this.__zParam.setValue(a); };
    qt.prototype.setBaseSize = function (e, t) { this.__xParam.setValue(e), this.__yParam.setValue(t); };
    qt.prototype.__rebuild = function () { var e = this.getVertexAttribute("normals"); for (var t_100 = 0; t_100 < 6; t_100++) {
        var a_86 = void 0;
        switch (t_100) {
            case 0:
                a_86 = new Z(0, 0, 1);
                break;
            case 1:
                a_86 = new Z(0, 0, -1);
                break;
            case 2:
                a_86 = new Z(1, 0, 0);
                break;
            case 3:
                a_86 = new Z(-1, 0, 0);
                break;
            case 4:
                a_86 = new Z(0, 1, 0);
                break;
            case 5: a_86 = new Z(0, -1, 0);
        }
        e.setFaceVertexValue(t_100, 0, a_86), e.setFaceVertexValue(t_100, 1, a_86), e.setFaceVertexValue(t_100, 2, a_86), e.setFaceVertexValue(t_100, 3, a_86);
    } var t = this.getVertexAttribute("texCoords"); for (var e_82 = 0; e_82 < 6; e_82++)
        t.setFaceVertexValue(e_82, 0, new _(0, 0)), t.setFaceVertexValue(e_82, 1, new _(1, 0)), t.setFaceVertexValue(e_82, 2, new _(1, 1)), t.setFaceVertexValue(e_82, 3, new _(0, 1)); this.__resize(); };
    qt.prototype.__resize = function (e) { var t = this.__xParam.getValue(), a = this.__yParam.getValue(), i = this.__zParam.getValue(), s = this.__baseZAtZeroParam.getValue(); var n = .5; s && (n = 1), this.getVertex(0).set(.5 * t, -.5 * a, n * i), this.getVertex(1).set(.5 * t, .5 * a, n * i), this.getVertex(2).set(-.5 * t, .5 * a, n * i), this.getVertex(3).set(-.5 * t, -.5 * a, n * i), n = -.5, s && (n = 0), this.getVertex(4).set(.5 * t, -.5 * a, n * i), this.getVertex(5).set(.5 * t, .5 * a, n * i), this.getVertex(6).set(-.5 * t, .5 * a, n * i), this.getVertex(7).set(-.5 * t, -.5 * a, n * i), this.setBoundingBoxDirty(), this.geomDataChanged.emit(); };
    qt.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.x = this.__x, e.y = this.__y, e.z = this.__z, e; };
    return qt;
}(Ut));
J.registerClass("Cuboid", qt);
var $t = /** @class */ (function (_super) {
    __extends($t, _super);
    function $t(e, t, a, i, s, n) {
        if (e === void 0) { e = .5; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 32; }
        if (i === void 0) { i = 2; }
        if (s === void 0) { s = !0; }
        if (n === void 0) { n = !1; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a) || isNaN(i))
            throw new Error("Invalid geom args");
        _this.__radiusParam = _this.addParameter(new Xe("radius", e)), _this.__heightParam = _this.addParameter(new Xe("height", t)), _this.__sidesParam = _this.addParameter(new Xe("sides", a >= 3 ? a : 3, [3, 200], 1)), _this.__loopsParam = _this.addParameter(new Xe("loops", i >= 2 ? i : 2, [1, 200], 1)), _this.__capsParam = _this.addParameter(new fe("caps", s)), _this.__baseZAtZeroParam = _this.addParameter(new fe("baseZAtZero", n)), _this.addVertexAttribute("texCoords", _), _this.addVertexAttribute("normals", Z), _this.__rebuild();
        var l = function () { _this.__resize(); }, r = function () { _this.__rebuild(); };
        _this.__radiusParam.valueChanged.connect(l), _this.__heightParam.valueChanged.connect(l), _this.__sidesParam.valueChanged.connect(r), _this.__loopsParam.valueChanged.connect(r), _this.__capsParam.valueChanged.connect(r), _this.__baseZAtZeroParam.valueChanged.connect(l);
        return _this;
    }
    $t.prototype.__rebuild = function () { this.clear(); this.__radiusParam.getValue(); var e = this.__sidesParam.getValue(), t = this.__loopsParam.getValue(), a = (this.__heightParam.getValue(), this.__capsParam.getValue()); this.__baseZAtZeroParam.getValue(); var i = e * t; a && (i += 2), this.setNumVertices(i), a ? this.setFaceCounts([2 * e, e]) : this.setFaceCounts([0, e]); var s = 0; for (var a_87 = 0; a_87 < t - 1; a_87++)
        for (var t_101 = 0; t_101 < e; t_101++) {
            var i_71 = e * a_87 + (t_101 + 1) % e, n_14 = e * a_87 + t_101, l_6 = e * (a_87 + 1) + t_101, r = e * (a_87 + 1) + (t_101 + 1) % e;
            this.setFaceVertexIndices(s++, i_71, n_14, l_6, r);
        } if (a) {
        for (var t_102 = 0; t_102 < e; t_102++) {
            var a_88 = i - 1, n_15 = t_102, l_7 = (t_102 + 1) % e;
            this.setFaceVertexIndices(s++, a_88, n_15, l_7);
        }
        for (var a_89 = 0; a_89 < e; a_89++) {
            var n_16 = e * (t - 1) + a_89, l_8 = i - 2, r = e * (t - 1) + (a_89 + 1) % e;
            this.setFaceVertexIndices(s++, n_16, l_8, r);
        }
    } var n = this.getVertexAttribute("normals"); s = 0; for (var a_90 = 0; a_90 < t - 1; a_90++)
        for (var t_103 = 0; t_103 < e; t_103++) {
            var a_91 = t_103 / e * 2 * Math.PI;
            var i_72 = new Z(Math.sin(a_91), Math.cos(a_91), 0);
            n.setFaceVertexValue(s, 0, i_72), n.setFaceVertexValue(s, 1, i_72), a_91 = (t_103 + 1) / e * 2 * Math.PI;
            var l_9 = new Z(Math.sin(a_91), Math.cos(a_91), 0);
            n.setFaceVertexValue(s, 2, l_9), n.setFaceVertexValue(s, 3, l_9), s++;
        } if (a) {
        var t_104 = new Z(0, 0, -1);
        for (var a_92 = 0; a_92 < e; a_92++)
            n.setFaceVertexValue(s, 0, t_104), n.setFaceVertexValue(s, 1, t_104), n.setFaceVertexValue(s, 2, t_104), s++;
        t_104.set(0, 0, 1);
        for (var a_93 = 0; a_93 < e; a_93++)
            n.setFaceVertexValue(s, 0, t_104), n.setFaceVertexValue(s, 1, t_104), n.setFaceVertexValue(s, 2, t_104), s++;
    } var l = this.getVertexAttribute("texCoords"); s = 0; for (var t_105 = 0; t_105 < e; t_105++)
        l.setFaceVertexValue(s, 0, new _((t_105 + 1) / e, 0)), l.setFaceVertexValue(s, 2, new _((t_105 + 1) / e, 1)), l.setFaceVertexValue(s, 1, new _(t_105 / e, 0)), l.setFaceVertexValue(s, 3, new _(t_105 / e, 1)), s++; if (a) {
        for (var t_106 = 0; t_106 < e; t_106++)
            l.setFaceVertexValue(s, 0, new _(t_106 / e, 0)), l.setFaceVertexValue(s, 1, new _((t_106 + 1) / e, 0)), l.setFaceVertexValue(s, 2, new _((t_106 + .5) / e, 1)), s++;
        for (var t_107 = 0; t_107 < e; t_107++)
            l.setFaceVertexValue(s, 0, new _(t_107 / e, 0)), l.setFaceVertexValue(s, 1, new _((t_107 + 1) / e, 0)), l.setFaceVertexValue(s, 2, new _((t_107 + .5) / e, 1)), s++;
    } this.geomDataTopologyChanged.emit(), this.__resize(); };
    $t.prototype.__resize = function () { var e = this.__sidesParam.getValue(), t = this.__loopsParam.getValue(), a = this.__radiusParam.getValue(), i = this.__heightParam.getValue(), s = this.__capsParam.getValue(), n = this.__baseZAtZeroParam.getValue(); var l = e * t; s && (l += 2); var r = 0, o = .5; n && (o = 0); for (var s_17 = 0; s_17 < t; s_17++) {
        var n_17 = s_17 / (t - 1) * i - i * o;
        for (var t_108 = 0; t_108 < e; t_108++) {
            var i_73 = t_108 / e * 2 * Math.PI;
            this.getVertex(r).set(Math.sin(i_73) * a, Math.cos(i_73) * a, n_17), r++;
        }
    } s && (this.getVertex(l - 1).set(0, 0, i * (n ? 0 : -.5)), this.getVertex(l - 2).set(0, 0, i * (n ? 1 : .5))), this.setBoundingBoxDirty(), this.geomDataChanged.emit(); };
    return $t;
}(Ut));
J.registerClass("Cylinder", $t);
var ea = /** @class */ (function (_super) {
    __extends(ea, _super);
    function ea(e, t) {
        if (e === void 0) { e = .5; }
        if (t === void 0) { t = 32; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t))
            throw new Error("Invalid geom args");
        _this.__radiusParam = _this.addParameter(new Xe("radius", e)), _this.__sidesParam = _this.addParameter(new Xe("sides", t >= 3 ? t : 3, [3, 200], 1)), _this.addVertexAttribute("texCoords", _), _this.addVertexAttribute("normals", Z), _this.__rebuild();
        return _this;
    }
    Object.defineProperty(ea.prototype, "radius", {
        get: function () { return this.__radius; },
        set: function (e) { this.__radius = e, this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ea.prototype, "sides", {
        set: function (e) { this.__sides = e >= 3 ? e : 3, this.__rebuild(); },
        enumerable: true,
        configurable: true
    });
    ea.prototype.__rebuild = function () { var e = this.__sidesParam.getValue(); this.setNumVertices(e + 1), this.setFaceCounts([e]), this.getVertex(0).set(0, 0, 0); for (var t_109 = 0; t_109 < e; t_109++) {
        var a_94 = t_109 % e + 1, i_74 = (t_109 + 1) % e + 1;
        this.setFaceVertexIndices(t_109, 0, a_94, i_74);
    } var t = this.getVertexAttribute("normals"), a = new Z(0, 0, 1); t.setValue(0, a); for (var i_75 = 0; i_75 < e; i_75++)
        t.setValue(i_75 + 1, a); var i = this.getVertexAttribute("texCoords"); i.getValueRef(0).set(.5, .5); for (var t_110 = 0; t_110 < e; t_110++) {
        var a_95 = t_110 / e * 2 * Math.PI;
        i.getValueRef(t_110 + 1).set(.5 * Math.sin(a_95) + .5, .5 * Math.cos(a_95) + .5);
    } this.setBoundingBoxDirty(), this.__resize(); };
    ea.prototype.__resize = function () { var e = this.__sidesParam.getValue(), t = this.__radiusParam.getValue(); for (var a_96 = 0; a_96 < e; a_96++) {
        var i_76 = a_96 / e * 2 * Math.PI;
        this.getVertex(a_96 + 1).set(Math.sin(i_76) * t, Math.cos(i_76) * t, 0);
    } this.setBoundingBoxDirty(); };
    ea.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.radius = this.__radius, e; };
    return ea;
}(Ut));
J.registerClass("Disc", ea);
var ta = /** @class */ (function (_super) {
    __extends(ta, _super);
    function ta(e, t, a, i, s, n) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 1; }
        if (i === void 0) { i = 1; }
        if (s === void 0) { s = !0; }
        if (n === void 0) { n = !0; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a) || isNaN(i))
            throw new Error("Invalid geom args");
        _this.__sizeXParam = _this.addParameter(new Xe("SizeX", e)), _this.__sizeYParam = _this.addParameter(new Xe("SizeY", t)), _this.__detailXParam = _this.addParameter(new Xe("DetailX", a)), _this.__detailYParam = _this.addParameter(new Xe("DetailY", i)), s && _this.addVertexAttribute("normals", Z), n && _this.addVertexAttribute("texCoords", _), _this.__rebuild(), _this.__sizeXParam.valueChanged.connect(_this.__resize.bind(_this)), _this.__sizeYParam.valueChanged.connect(_this.__resize.bind(_this)), _this.__detailXParam.valueChanged.connect(_this.__rebuild.bind(_this)), _this.__detailYParam.valueChanged.connect(_this.__rebuild.bind(_this));
        return _this;
    }
    ta.prototype.__rebuild = function () { var e = this.__detailXParam.getValue(), t = this.__detailYParam.getValue(); this.setNumVertices((e + 1) * (t + 1)), this.setFaceCounts([0, e * t]); var a = 0; for (var i_77 = 0; i_77 < t; i_77++)
        for (var t_111 = 0; t_111 < e; t_111++) {
            var s_18 = (e + 1) * (i_77 + 1) + t_111, n_18 = (e + 1) * (i_77 + 1) + (t_111 + 1), l = (e + 1) * i_77 + (t_111 + 1), r = (e + 1) * i_77 + t_111;
            this.setFaceVertexIndices(a, s_18, n_18, l, r), a += 1;
        } var i = 0; var s = this.getVertexAttribute("normals"); if (s)
        for (var a_97 = 0; a_97 <= t; a_97++)
            for (var t_112 = 0; t_112 <= e; t_112++)
                s.getValueRef(i).set(0, 0, 1), i++; i = 0; var n = this.getVertexAttribute("texCoords"); if (n)
        for (var a_98 = 0; a_98 <= t; a_98++) {
            var s_19 = a_98 / t;
            for (var t_113 = 0; t_113 <= e; t_113++) {
                var a_99 = t_113 / e;
                n.getValueRef(i).set(a_99, s_19), i++;
            }
        } this.__resize(!1), this.geomDataTopologyChanged.emit(); };
    ta.prototype.__resize = function (e) {
        if (e === void 0) { e = !0; }
        var t = this.__sizeXParam.getValue(), a = this.__sizeYParam.getValue(), i = this.__detailXParam.getValue(), s = this.__detailYParam.getValue();
        var n = 0;
        for (var e_83 = 0; e_83 <= s; e_83++) {
            var l = (e_83 / s - .5) * a;
            for (var e_84 = 0; e_84 <= i; e_84++) {
                var a_100 = (e_84 / i - .5) * t;
                this.getVertex(n).set(a_100, l, 0), n++;
            }
        }
        this.setBoundingBoxDirty(), e && this.geomDataChanged.emit();
    };
    return ta;
}(Ut));
var aa = /** @class */ (function (_super) {
    __extends(aa, _super);
    function aa(e, t, a) {
        if (e === void 0) { e = 1; }
        if (t === void 0) { t = 12; }
        if (a === void 0) { a = 12; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a))
            throw new Error("Invalid geom args");
        _this.__radiusParam = _this.addParameter(new Xe("radius", e)), _this.__sidesParam = _this.addParameter(new Xe("sides", t >= 3 ? t : 3, [3, 200], 1)), _this.__loopsParam = _this.addParameter(new Xe("loops", a >= 3 ? a : 3, [3, 200], 1)), _this.addVertexAttribute("texCoords", _), _this.addVertexAttribute("normals", Z), _this.__rebuild();
        var i = function () { _this.__rebuild(); };
        _this.__radiusParam.valueChanged.connect(function () { _this.__resize(); }), _this.__sidesParam.valueChanged.connect(i), _this.__loopsParam.valueChanged.connect(i);
        return _this;
    }
    aa.prototype.__rebuild = function () { var e = this.__radiusParam.getValue(), t = this.__sidesParam.getValue(), a = this.__loopsParam.getValue(), i = 2 + t * a, s = 2 * t, n = t * a; this.setNumVertices(i), this.setFaceCounts([s, n]); var l = this.getVertexAttribute("normals"), r = new Z(0, 0, 1); var o = 0; this.getVertex(o).set(0, 0, e), l.getValueRef(o).set(0, 0, 1), o++; for (var i_78 = 0; i_78 < a; i_78++) {
        var s_20 = (i_78 + 1) / (a + 1) * Math.PI;
        for (var a_101 = 0; a_101 < t; a_101++) {
            var i_79 = a_101 / t * 2 * Math.PI;
            r.set(Math.sin(s_20) * Math.cos(i_79), Math.sin(s_20) * Math.sin(i_79), Math.cos(s_20)), this.getVertex(o).setFromOther(r.scale(e)), l.getValueRef(o).setFromOther(r), o++;
        }
    } this.getVertex(o).set(0, 0, -e), l.getValueRef(o).set(0, 0, -1), o++; var d = this.getVertexAttribute("texCoords"); var h = 0; for (var e_85 = 0; e_85 < t; e_85++) {
        var i_80 = 0, s_21 = (e_85 + 1) % t + 1, n_19 = e_85 + 1;
        this.setFaceVertexIndices(h, i_80, s_21, n_19);
        var l_10 = new _(.5, 0), r_6 = new _(1 - (e_85 + 1) / t, 0), o_6 = new _(1 - e_85 / t, 1 / (a + 1));
        d.setFaceVertexValue(h, 0, l_10), d.setFaceVertexValue(h, 1, r_6), d.setFaceVertexValue(h, 2, o_6), h++;
    } for (var e_86 = 0; e_86 < t; e_86++) {
        var s_22 = i - 1, n_20 = t * (a - 1) + e_86 + 1, l_11 = t * (a - 1) + (e_86 + 1) % t + 1;
        this.setFaceVertexIndices(h, s_22, n_20, l_11);
        var r_7 = new _(1 - e_86 / t, a / (a + 1)), o_7 = new _(1 - (e_86 + 1) / t, a / (a + 1)), c = new _(.5, 1);
        d.setFaceVertexValue(h, 0, r_7), d.setFaceVertexValue(h, 1, o_7), d.setFaceVertexValue(h, 2, c), h++;
    } for (var e_87 = 0; e_87 < a - 1; e_87++)
        for (var i_81 = 0; i_81 < t; i_81++) {
            var s_23 = t * e_87 + i_81 + 1, n_21 = t * e_87 + (i_81 + 1) % t + 1, l_12 = t * (e_87 + 1) + (i_81 + 1) % t + 1, r_8 = t * (e_87 + 1) + i_81 + 1;
            this.setFaceVertexIndices(h, s_23, n_21, l_12, r_8), d.setFaceVertexValue(h, 0, new _(e_87 / a, i_81 / a)), d.setFaceVertexValue(h, 1, new _(e_87 / a, (i_81 + 1) / a)), d.setFaceVertexValue(h, 2, new _((e_87 + 1) / a, (i_81 + 1) / a)), d.setFaceVertexValue(h, 3, new _((e_87 + 1) / a, i_81 / a)), h++;
        } this.setBoundingBoxDirty(), this.geomDataTopologyChanged.emit(); };
    aa.prototype.__resize = function () { var e = this.__radiusParam.getValue(), t = this.__sidesParam.getValue(), a = this.__loopsParam.getValue(); var i = 0; var s = new Z(0, 0, 1); this.getVertex(i).set(0, 0, e), i++; for (var n = 0; n < a; n++) {
        var l = (n + 1) / (a + 1) * Math.PI;
        for (var a_102 = 0; a_102 < t; a_102++) {
            var n_22 = a_102 / t * 2 * Math.PI;
            s.set(Math.sin(l) * Math.cos(n_22), Math.sin(l) * Math.sin(n_22), Math.cos(l)), this.getVertex(i).setFromOther(s.scale(e)), i++;
        }
    } this.getVertex(i).set(0, 0, -e), i++, this.setBoundingBoxDirty(), this.geomDataChanged.emit(); };
    return aa;
}(Ut));
J.registerClass("Sphere", aa);
var ia = /** @class */ (function (_super) {
    __extends(ia, _super);
    function ia(e, t, a) {
        if (e === void 0) { e = .5; }
        if (t === void 0) { t = 1; }
        if (a === void 0) { a = 32; }
        var _this = this;
        if (_this = _super.call(this) || this, isNaN(e) || isNaN(t) || isNaN(a))
            throw new Error("Invalid geom args");
        _this.__innerRadius = e, _this.__outerRadius = t, _this.__detail = a >= 3 ? a : 3, _this.addVertexAttribute("texCoords", _), _this.addVertexAttribute("normals", Z), _this.__rebuild();
        return _this;
    }
    Object.defineProperty(ia.prototype, "innerRadius", {
        get: function () { return this.__innerRadius; },
        set: function (e) { this.__innerRadius = e, this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ia.prototype, "outerRadius", {
        get: function () { return this.__outerRadius; },
        set: function (e) { this.__outerRadius = e, this.__resize(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ia.prototype, "detail", {
        get: function () { return this.__detail; },
        set: function (e) { this.__detail = e >= 3 ? e : 3, this.__rebuild(); },
        enumerable: true,
        configurable: true
    });
    ia.prototype.__rebuild = function () { var e = this.__detail, t = 2 * this.__detail, a = e * t; this.setNumVertices(a), this.setFaceCounts([0, e * t]); var i = this.getVertexAttribute("normals"); var s = 0; for (var a_103 = 0; a_103 < t; a_103++) {
        var n_23 = a_103 / t * 2 * Math.PI, l_13 = Math.cos(n_23), r = Math.sin(n_23);
        for (var t_114 = 0; t_114 < e; t_114++) {
            var a_104 = t_114 / e * 2 * Math.PI, n_24 = Math.sin(a_104), o = Math.cos(a_104), d = this.__outerRadius + o * this.__innerRadius;
            this.getVertex(s).set(l_13 * d, r * d, this.__innerRadius * n_24), i.getValueRef(s).set(l_13 * o, r * o, n_24), s++;
        }
    } var n = this.getVertexAttribute("texCoords"); var l = 0; for (var a_105 = 0; a_105 < t; a_105++)
        for (var i_82 = 0; i_82 < e; i_82++) {
            var s_24 = (a_105 + 1) % t, r = (i_82 + 1) % e, o = e * a_105 + i_82, d = e * a_105 + r, h = e * s_24 + r, c = e * s_24 + i_82;
            this.setFaceVertexIndices(l, o, d, h, c), n.setFaceVertexValue(l, 0, new _(a_105 / t, i_82 / t)), n.setFaceVertexValue(l, 1, new _(a_105 / t, (i_82 + 1) / t)), n.setFaceVertexValue(l, 2, new _((a_105 + 1) / t, (i_82 + 1) / t)), n.setFaceVertexValue(l, 3, new _((a_105 + 1) / t, i_82 / t)), l++;
        } this.setBoundingBoxDirty(); };
    ia.prototype.__resize = function () { var e = this.__detail, t = 2 * this.__detail; for (var a_106 = 0; a_106 < t; a_106++) {
        var i_83 = a_106 / t * 2 * Math.PI, s = Math.cos(i_83), n = Math.sin(i_83);
        for (var t_115 = 0; t_115 < e; t_115++) {
            var a_107 = t_115 / e * 2 * Math.PI, i_84 = Math.sin(a_107), l = Math.cos(a_107), r = this.__outerRadius + l * this.__innerRadius;
            this.getVertex(0).set(s * r, n * r, this.__innerRadius * i_84), index++;
        }
    } this.setBoundingBoxDirty(); };
    ia.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.x = this.__x, e.y = this.__y, e.z = this.__z, e; };
    return ia;
}(Ut));
var sa = { SAVE_FLAG_SKIP_CHILDREN: 1 }, na = { LOAD_FLAG_LOADING_BIN_TREE_VALUES: 16 }, la = { CLONE_FLAG_INSTANCED_TREE: 1 };
var ra = /** @class */ (function (_super) {
    __extends(ra, _super);
    function ra(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__visibleCounter = 1, _this.__visible = !0, _this.__highlightMapping = {}, _this.__highlights = [], _this.__childItems = [], _this.__childItemsSignalIds = [], _this.__childItemsMapping = {}, _this.__components = [], _this.__componentMapping = {}, _this.mouseDown = new C, _this.mouseUp = new C, _this.mouseMove = new C, _this.mouseEnter = new C, _this.mouseLeave = new C, _this.__visibleParam = _this.addParameter(new fe("Visible", !0)), _this.__localXfoParam = _this.addParameter(new Le("LocalXfo", new S)), _this.__globalXfoParam = _this.addParameter(new Le("GlobalXfo", new S)), _this.__boundingBoxParam = _this.addParameter(new Q("BoundingBox", new v)), _this.parentChanged = _this.ownerChanged, _this.childAdded = new C, _this.childRemoved = new C, _this.highlightChanged = new C, _this.visibilityChanged = new C, _this.localXfoChanged = _this.__localXfoParam.valueChanged, _this.globalXfoChanged = _this.__globalXfoParam.valueChanged, _this.boundingChanged = _this.__boundingBoxParam.valueChanged, _this._cleanGlobalXfo = _this._cleanGlobalXfo.bind(_this), _this._setGlobalXfoDirty = _this._setGlobalXfoDirty.bind(_this), _this._setBoundingBoxDirty = _this._setBoundingBoxDirty.bind(_this), _this._cleanBoundingBox = _this._cleanBoundingBox.bind(_this), _this.__localXfoParam.valueChanged.connect(_this._setGlobalXfoDirty);
        var t = function (e) { var t = _this.__globalXfoParam.getValue(); return void 0 !== _this.__ownerItem ? _this.__ownerItem.getGlobalXfo().inverse().multiply(t) : t; };
        _this.__globalXfoParam.valueChanged.connect(function (e) { e != E.OPERATOR_DIRTIED && _this.__localXfoParam.setDirty(t), _this._setBoundingBoxDirty(); }), _this.__visibleParam.valueChanged.connect(function (e) { _this.__visibleCounter += _this.__visibleParam.getValue() ? 1 : -1, _this.__updateVisiblity(); });
        return _this;
    }
    Object.defineProperty(ra, "SaveFlags", {
        get: function () { return sa; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ra, "LoadFlags", {
        get: function () { return na; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ra, "CloneFlags", {
        get: function () { return la; },
        enumerable: true,
        configurable: true
    });
    ra.getSelectionOutlineColor = function () { return selectionOutlineColor; };
    ra.setSelectionOutlineColor = function (e) { selectionOutlineColor = e; };
    ra.getBranchSelectionOutlineColor = function () { return branchSelectionOutlineColor; };
    ra.setBranchSelectionOutlineColor = function (e) { branchSelectionOutlineColor = e; };
    ra.prototype._childFlagsChanged = function (e) { 0 != (e & H.USER_EDITED) && this.setFlag($.USER_EDITED); };
    ra.prototype.setFlag = function (e) { _super.prototype.setFlag.call(this, e), this.__ownerItem && this.__ownerItem._childFlagsChanged(e); };
    ra.prototype.setOwner = function (e) { if (this.__ownerItem) {
        this.__ownerItem.globalXfoChanged.disconnect(this._setGlobalXfoDirty), this.__ownerItem.getVisible() || this.__visibleCounter++;
        var e_88 = this.__ownerItem.getChildIndex(this);
        e_88 >= 0 && this.__ownerItem.__unbindChild(e_88, this);
    } _super.prototype.setOwner.call(this, e), this._setGlobalXfoDirty(), this.__ownerItem && (this.setSelectable(this.__ownerItem.getSelectable(), !0), this.__ownerItem.getVisible() || this.__visibleCounter--, this.__ownerItem.globalXfoChanged.connect(this._setGlobalXfoDirty)), this.__updateVisiblity(); };
    ra.prototype.__updatePath = function () { _super.prototype.__updatePath.call(this); for (var _b = 0, _c = this.__childItems; _b < _c.length; _b++) {
        var e_89 = _c[_b];
        e_89 && e_89.__updatePath();
    } for (var _d = 0, _f = this.__components; _d < _f.length; _d++) {
        var e_90 = _f[_d];
        e_90 && e_90.__updatePath();
    } };
    ra.prototype.getParentItem = function () { return this.getOwner(); };
    ra.prototype.setParentItem = function (e) { this.setOwner(e); };
    ra.prototype.getLocalXfo = function () { return this.__localXfoParam.getValue(); };
    ra.prototype.setLocalXfo = function (e, t) { this.__localXfoParam.setValue(e, t); };
    ra.prototype.getGlobalXfo = function (e) { return this.__globalXfoParam.getValue(e); };
    ra.prototype.setGlobalXfo = function (e, t) { var a = this.getOwner(); if (a) {
        var i_85 = a.getGlobalXfo().inverse().multiply(e);
        this.__localXfoParam.setValue(i_85, t);
    }
    else
        this.__globalXfoParam.setValue(e, t); };
    ra.prototype._cleanGlobalXfo = function (e) { var t = this.getParentItem(), a = this.__localXfoParam.getValue(); if (void 0 !== t) {
        return t.getGlobalXfo().multiply(a);
    } return a; };
    ra.prototype._setGlobalXfoDirty = function () { this.__globalXfoParam.setDirty(this._cleanGlobalXfo); };
    ra.prototype.getVisible = function () { return this.__visibleCounter > 0; };
    ra.prototype.setVisible = function (e) { this.__visibleParam.setValue(e); };
    ra.prototype.propagateVisiblity = function (e) { this.__visibleCounter += e, this.__updateVisiblity(); };
    ra.prototype.__updateVisiblity = function () { var e = this.__visibleCounter > 0; if (e != this.__visible) {
        this.__visible = e;
        for (var _b = 0, _c = this.__childItems; _b < _c.length; _b++) {
            var e_91 = _c[_b];
            e_91 instanceof ra && e_91.propagateVisiblity(this.__visible ? 1 : -1);
        }
        return this.visibilityChanged.emit(e), !0;
    } return !1; };
    ra.prototype.addHighlight = function (e, t, a) {
        if (a === void 0) { a = !1; }
        if (e in this.__highlightMapping) {
            var t_116 = this.__highlights.indexOf(e);
            this.__highlights.splice(t_116, 1);
        }
        this.__highlights.push(e), this.__highlightMapping[e] = t, this.highlightChanged.emit(), a && this.__childItems.forEach(function (i) { i instanceof ra && i.addHighlight(e, t, a); });
    };
    ra.prototype.removeHighlight = function (e, t) {
        if (t === void 0) { t = !1; }
        if (e in this.__highlightMapping) {
            var t_117 = this.__highlights.indexOf(e);
            this.__highlights.splice(t_117, 1), delete this.__highlightMapping[e], this.highlightChanged.emit();
        }
        t && this.__childItems.forEach(function (a) { a instanceof ra && a.removeHighlight(e, t); });
    };
    ra.prototype.getHighlight = function () { if (this.__highlights.length > 0)
        return this.__highlightMapping[this.__highlights[this.__highlights.length - 1]]; };
    ra.prototype.isHighlighted = function () { return this.__highlights.length > 0; };
    Object.defineProperty(ra.prototype, "boundingBox", {
        get: function () { return console.warn("getter is deprectated. Please use 'getBoundingBox'"), this.getBoundingBox(); },
        enumerable: true,
        configurable: true
    });
    ra.prototype.getBoundingBox = function () { return this.__boundingBoxParam.getValue(); };
    ra.prototype._cleanBoundingBox = function (e) { return e.reset(), this.__childItems.forEach(function (t) { t instanceof ra && t.getVisible() && !t.testFlag($.IGNORE_BBOX) && e.addBox3(t.getBoundingBox()); }), e; };
    ra.prototype._childBBoxChanged = function () { this._setBoundingBoxDirty(); };
    ra.prototype._setBoundingBoxDirty = function () { this.__boundingBoxParam && this.__boundingBoxParam.setDirty(this._cleanBoundingBox); };
    ra.prototype.getChildren = function () { return this.__childItems; };
    ra.prototype.numChildren = function () { return console.warn("Deprecated method. Please use getNumChildren"), this.__childItems.length; };
    ra.prototype.getNumChildren = function () { return this.__childItems.length; };
    ra.prototype.generateUniqueName = function (e) { if (!(e in this.__childItemsMapping))
        return e; var t = 1; e.length > 4 && !Number.isNaN(parseInt(e.substring(e.length - 4))) ? t = parseInt(e.substr(e.length - 4)) : e.length > 3 && !Number.isNaN(parseInt(e.substring(e.length - 3))) ? t = parseInt(e.substr(e.length - 3)) : e.length > 2 && !Number.isNaN(parseInt(e.substring(e.length - 2))) && (t = parseInt(e.substr(e.length - 2))); var a = []; for (var _b = 0, _c = this.__childItems; _b < _c.length; _b++) {
        var e_92 = _c[_b];
        e_92 && a.push(e_92.getName());
    } var i = e; for (;;) {
        var s = "" + t;
        for (; s.length < 2;)
            s = "0" + s;
        if (i = e + s, -1 == a.indexOf(i))
            break;
        t++;
    } return i; };
    ra.prototype.__updateMapping = function (e) { for (var t_118 = e; t_118 < this.__childItems.length; t_118++)
        this.__childItemsMapping[this.__childItems[t_118].getName()] = t_118; };
    ra.prototype.insertChild = function (e, t, a, i) {
        var _this = this;
        if (a === void 0) { a = !1; }
        if (i === void 0) { i = !0; }
        if (e.getName() in this.__childItemsMapping) {
            if (!i)
                throw new Error("Item '" + e.getName() + "' is already a child of :" + this.getPath());
            e.setName(this.generateUniqueName(e.getName()));
        }
        if (!(e instanceof te))
            throw new Error("Object is is not a tree item :" + e.constructor.name);
        var s = {};
        var n;
        return s.nameChangedId = e.nameChanged.connect(function (e, t) { var a = _this.__childItemsMapping[t]; delete _this.__childItemsMapping[t], _this.__childItemsMapping[e] = a; }), e instanceof ra && (a && (n = this.getGlobalXfo().inverse().multiply(e.getGlobalXfo())), s.bboxChangedId = e.boundingChanged.connect(function () { _this._setBoundingBoxDirty(); }), s.visChangedId = e.visibilityChanged.connect(this._setBoundingBoxDirty)), this.__childItems.splice(t, 0, e), this.__childItemsSignalIds.splice(t, 0, s), this.__childItemsMapping[e.getName()] = t, this.__updateMapping(t), e.setOwner(this), e instanceof ra && (a && e.setLocalXfo(n), this._setBoundingBoxDirty()), e.testFlag($.USER_EDITED) && this.setFlag($.USER_EDITED), this.childAdded.emit(e, t), e;
    };
    ra.prototype.addChild = function (e, t, a) {
        if (t === void 0) { t = !0; }
        if (a === void 0) { a = !0; }
        var i = this.__childItems.length;
        return this.insertChild(e, i, t, a), i;
    };
    ra.prototype.getChild = function (e) { return this.__childItems[e]; };
    ra.prototype.getChildByName = function (e) { var t = this.__childItemsMapping[e]; return null != t ? this.__childItems[t] : null; };
    ra.prototype.getChildNames = function () { var e = []; for (var t_119 = 0; t_119 < this.__childItems.length; t_119++) {
        var a_108 = this.__childItems[t_119];
        null != a_108 && (e[t_119] = a_108.getName());
    } return e; };
    ra.prototype.__unbindChild = function (e, t) { var a = this.__childItemsSignalIds[e]; t.nameChanged.disconnectId(a.nameChangedId), t instanceof ra && (t.boundingChanged.disconnectId(a.bboxChangedId), t.visibilityChanged.disconnectId(a.visChangedId)), this.__childItems.splice(e, 1), this.__childItemsSignalIds.splice(e, 1), delete this.__childItemsMapping[t.getName()], this.__updateMapping(e), t instanceof ra && this._setBoundingBoxDirty(), this.childRemoved.emit(t, e); };
    ra.prototype.removeChild = function (e) { var t = this.__childItems[e]; t && (this.__unbindChild(e, t), t.setOwner(void 0)); };
    ra.prototype.removeChildByName = function (e) { var t = this.__childItemsMapping[e]; return null != t ? this.removeChild(t) : null; };
    ra.prototype.removeChildByHandle = function (e) { console.warn("Deprecated method. Please use removeChild"); var t = this.__childItems.indexOf(e); if (-1 == t)
        throw new Error("Error in removeChildByHandle. Child not found:" + e.getName()); this.removeChild(t); };
    ra.prototype.removeAllChildren = function () { var e = this.__childItems.length; for (; e--;)
        this.removeChild(e); this._setBoundingBoxDirty(); };
    ra.prototype.getChildIndex = function (e) { return this.__childItems.indexOf(e); };
    ra.prototype.indexOfChild = function (e) { return console.warn("Deprecated method. Please use getChildIndex"), this.getChildIndex(e); };
    ra.prototype.addComponent = function (e) { this.__components.push(e), this.__componentMapping[e.getName()] = this.__components.length - 1, e.setOwner(this); };
    ra.prototype.removeComponent = function (e) { var t = this.__componentMapping[e]; if (null == t)
        throw new Error("Component not found:" + e); var a = this.__components[t]; a.setOwner(void 0), this.__components.splice(t, 1); var i = {}; for (var e_93 = 0; e_93 < this.__components.length; e_93++)
        i[this.__components[e_93].getName()] = e_93; return this.__componentMapping = i, a; };
    ra.prototype.hasComponent = function (e) { return e in this.__componentMapping; };
    ra.prototype.getComponent = function (e) { if (e in this.__componentMapping)
        return this.__components[this.__componentMapping[e]]; console.log("No component named '" + e + "' found."); };
    ra.prototype.resolvePath = function (e, t) {
        if (t === void 0) { t = 0; }
        if ("string" == typeof e && (e = e.split("/")), 0 == t)
            if ("." == e[0] || e[0] == this.__name)
                t++;
            else if (".." == e[0])
                return this.__ownerItem.resolvePath(e, t + 1);
        if (t == e.length)
            return this;
        if (">" == e[t] && t == e.length - 2 && this.hasComponent(e[t + 1])) {
            return this.getComponent(e[t + 1]).resolvePath(e, t + 2);
        }
        var a = e[t], i = this.getChildByName(a);
        if (null == i) {
            if (this.hasComponent(e[t])) {
                var a_109 = this.getComponent(e[t]);
                return t == e.length ? a_109 : a_109.resolvePath(e, t + 1);
            }
            var a_110 = this.getParameter(e[t]);
            return a_110 || null;
        }
        return i.resolvePath(e, t + 1);
    };
    ra.prototype.traverse = function (e, t) {
        if (t === void 0) { t = !0; }
        var a = function (e, t) { var a = e.getChildren(); for (var _b = 0, a_111 = a; _b < a_111.length; _b++) {
            var e_94 = a_111[_b];
            e_94 && i(e_94, t + 1);
        } }, i = function (t, i) { if (0 == e(t, i))
            return !1; a(t, i); };
        t ? i(this, 1) : a(this, 0);
    };
    ra.prototype.onMouseDown = function (e) { this.mouseDown.emit(e), e.propagating && this.__ownerItem && this.__ownerItem.onMouseDown(e); };
    ra.prototype.onMouseUp = function (e) { this.mouseUp.emit(e), e.propagating && this.__ownerItem && this.__ownerItem.onMouseUp(e); };
    ra.prototype.onMouseMove = function (e) { this.mouseMove.emit(e), e.propagating && this.__ownerItem && this.__ownerItem.onMouseMove(e); };
    ra.prototype.onMouseEnter = function (e) { this.mouseEnter.emit(e), e.propagating && this.__ownerItem && this.__ownerItem.onMouseEnter(e); };
    ra.prototype.onMouseLeave = function (e) { this.mouseLeave.emit(e), e.propagating && this.__ownerItem && this.__ownerItem.onMouseLeave(e); };
    ra.prototype.onWheel = function (e) { e.propagating && this.__ownerItem && this.__ownerItem.onWheel(e); };
    ra.prototype.toJSON = function (e, t) { if (!this.testFlag($.USER_EDITED))
        return; var a = _super.prototype.toJSON.call(this, e, t), i = []; for (var _b = 0, _c = this.__components; _b < _c.length; _b++) {
        var a_112 = _c[_b];
        i.push(a_112.toJSON(e, t));
    } if (i.length > 0 && (a.components = i), !(t & sa.SAVE_FLAG_SKIP_CHILDREN)) {
        var i_86 = {};
        for (var _d = 0, _f = this.__childItems; _d < _f.length; _d++) {
            var a_113 = _f[_d];
            if (a_113) {
                var s = a_113.toJSON(e, t);
                s && (i_86[a_113.getName()] = s);
            }
        }
        Object.keys(i_86).length > 0 && (a ? a.children = i_86 : a = { name: this.__name, children: i_86 });
    } return a; };
    ra.prototype.fromJSON = function (e, t, a) { if (_super.prototype.fromJSON.call(this, e, t, a), t.numTreeItems++, this.setFlag($.USER_EDITED), null != e.children) {
        var i_88 = e.children;
        if (Array.isArray(i_88))
            for (var _b = 0, i_87 = i_88; _b < i_87.length; _b++) {
                var e_95 = i_87[_b];
                var i_89 = this.getChildByName(e_95.name);
                i_89 ? i_89.fromJSON(e_95, t, a) : e_95.type && (i_89 = J.constructClass(e_95.type), i_89 && (i_89.fromJSON(e_95, t, a), this.addChild(i_89, !1, !1)));
            }
        else
            for (var e_96 in i_88) {
                var s = i_88[e_96];
                var n = this.getChildByName(e_96);
                n ? n.fromJSON(s, t, a) : s.type && (n = J.constructClass(s.type), n && (n.fromJSON(s, t, a), this.addChild(n, !1, !1)));
            }
    } if (e.components)
        for (var _c = 0, _d = e.components; _c < _d.length; _c++) {
            var a_114 = _d[_c];
            var e_97 = J.constructClass(a_114.type ? a_114.type : a_114.name);
            e_97 && (e_97.fromJSON(a_114, t), this.addComponent(e_97));
        } };
    ra.prototype.readBinary = function (e, t) { _super.prototype.readBinary.call(this, e, t), t.numTreeItems++; var a = e.loadUInt8(); if (4 & a) {
        var t_120 = new S;
        t_120.tr = e.loadFloat32Vec3(), t_120.ori = e.loadFloat32Quat(), t_120.sc.set(e.loadFloat32()), this.__localXfoParam.setValue(t_120, E.DATA_LOAD);
    } 8 & a && this.__boundingBoxParam.setValue(new v(e.loadFloat32Vec3(), e.loadFloat32Vec3()), E.DATA_LOAD); var i = e.loadUInt32(); if (i > 0) {
        var a_115 = e.loadUInt32Array(i);
        for (var s = 0; s < i; s++) {
            e.seek(a_115[s]);
            var i_90 = e.loadStr();
            if (i_90.startsWith("N") && i_90.endsWith("E")) {
                var e_98 = i_90.indexOf("podium");
                -1 != e_98 && (i_90 = parseInt(i_90[e_98 + 7]) ? i_90.substring(e_98 + 8, i_90.length - 1) : i_90.substring(e_98 + 7, i_90.length - 1)), -1 != i_90.indexOf("livenurbs") && (i_90 = i_90.substring(i_90.indexOf("CAD"), i_90.length - 1));
            }
            var n = J.constructClass(i_90);
            if (n)
                e.seek(a_115[s]), n.readBinary(e, t), n.setFlag($.BIN_NODE), this.addChild(n, !1, !1);
            else {
                var t_121 = e.loadStr();
                console.warn("Unable to construct child:" + t_121 + " of type:" + i_90);
            }
        }
    } };
    ra.prototype.clone = function (e) { var t = new ra; return t.copyFrom(this, e), t; };
    ra.prototype.copyFrom = function (e, t) {
        var _this = this;
        _super.prototype.copyFrom.call(this, e, t), e.getChildren().forEach(function (e) { e && _this.addChild(e.clone(t), !1, !1); });
    };
    ra.prototype.destroy = function () { this.removeAllChildren(), _super.prototype.destroy.call(this); };
    return ra;
}(te));
J.registerClass("TreeItem", ra);
var oa = /** @class */ (function (_super) {
    __extends(oa, _super);
    function oa(e) {
        return _super.call(this, e) || this;
    }
    oa.prototype.setSrcTree = function (e, t) {
        var _this = this;
        if (this.__srcTree = e, 0 == this.__srcTree.getNumChildren()) {
            var e_99 = this.__srcTree.clone(t);
            e_99.setLocalXfo(new S, E.DATA_LOAD), this.addChild(e_99, !1);
        }
        else {
            this.__srcTree.getChildren().forEach(function (e) { var a = e.clone(t); _this.addChild(a, !1); });
        }
    };
    oa.prototype.getSrcTree = function () { return this.__srcTree; };
    oa.prototype.readBinary = function (e, t) {
        var _this = this;
        if (t === void 0) { t = {}; }
        _super.prototype.readBinary.call(this, e, t);
        var a = e.loadStrArray();
        t.resolvePath(a, function (e) { _this.setSrcTree(e, t); });
    };
    oa.prototype.toJSON = function (e, t) {
        if (e === void 0) { e = {}; }
        if (t === void 0) { t = 0; }
        return _super.prototype.toJSON.call(this, e, t);
    };
    oa.prototype.fromJSON = function (e, t, a, i) {
        if (t === void 0) { t = {}; }
        if (a === void 0) { a = 0; }
    };
    return oa;
}(ra));
J.registerClass("InstanceItem", oa);
var da = /** @class */ (function (_super) {
    __extends(da, _super);
    function da(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__loaded = !1, _this.audioSourceCreated = new C;
        var t = _this.addParameter(new Te("FilePath"));
        var a, i;
        var s = function () { a = window.ZeaAudioaudioCtx.createBufferSource(), a.buffer = i, a.loop = o.getValue(), a.muted = r.getValue(), a.start(0), _this.audioSourceCreated.emit(a); };
        t.valueChanged.connect(function () { var e = new XMLHttpRequest; e.open("GET", t.getURL(), !0), e.responseType = "arraybuffer", e.onload = function () { var t = e.response; window.ZeaAudioaudioCtx.decodeAudioData(t, function (e) { i = e, _this.__loaded = !0, _this.loaded.emit(!0), n.getValue() && s(); }, function (e) { console.log("Error with decoding audio data" + e.err); }); }, e.send(); });
        var n = _this.addParameter(new fe("Autoplay", !1)), l = _this.addParameter(new Xe("PlayState", 0));
        l.valueChanged.connect(function (e) { if (e != E.CUSTOM)
            switch (l.getValue()) {
                case 0:
                    _this.__loaded && a && (a.stop(0), a = void 0);
                    break;
                case 1: _this.__loaded && s();
            } }), _this.isPlaying = function () { return 0 != l.getValue(); }, _this.play = function () { l.setValue(1, E.CUSTOM); }, _this.stop = function () { l.setValue(0, E.CUSTOM); }, _this.pause = function () { l.setValue(0, E.CUSTOM); }, _this.getAudioSource = function () { return a; };
        var r = _this.addParameter(new fe("Mute", !1));
        _this.addParameter(new Xe("Gain", 1)).setRange([0, 5]);
        var o = _this.addParameter(new fe("Loop", !1));
        _this.addParameter(new fe("SpatializeAudio", !0)), _this.addParameter(new Xe("refDistance", 2)), _this.addParameter(new Xe("maxDistance", 1e4)), _this.addParameter(new Xe("rolloffFactor", 1)), _this.addParameter(new Xe("coneInnerAngle", 360)), _this.addParameter(new Xe("coneOuterAngle", 0)), _this.addParameter(new Xe("coneOuterGain", 1)), r.valueChanged.connect(function () { a && (a.muted = r.getValue()); }), o.valueChanged.connect(function () { a && (a.loop = o.getValue()); }), _this.mute = function (e) { r.setValue(e, E.CUSTOM); }, _this.loaded = new C(!0), _this.loaded.setToggled(!1);
        return _this;
    }
    da.prototype.isLoaded = function () { return this.__loaded; };
    da.prototype.setAudioStream = function () { this.__loaded = !0, this.loaded.emit(), this.audioSourceCreated.emit(audioSource); };
    return da;
}(ra));
var ha = /** @class */ (function (_super) {
    __extends(ha, _super);
    function ha(e) {
        var _this = this;
        return _this;
    }
    return ha;
}(da));
var ca = /** @class */ (function (_super) {
    __extends(ca, _super);
    function ca(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.overlay = !1, _this.__cutAway = !1, _this.__cutAwayVector = !1, _this.__cutAwayDist = !1, _this.cutAwayChanged = new C, _this.__layers = [];
        return _this;
    }
    ca.prototype.setOverlay = function (e) { this.overlay = e; };
    ca.prototype.isOverlay = function () { return this.overlay; };
    ca.prototype.addLayer = function (e) { this.__layers.push(e); };
    ca.prototype.getLayers = function () { return this.__layers; };
    ca.prototype.isCutawayEnabled = function () { return this.__cutAway; };
    ca.prototype.setCutawayEnabled = function (e) { this.__cutAway = e, this.cutAwayChanged.emit(); };
    ca.prototype.getCutVector = function () { return this.__cutAwayVector; };
    ca.prototype.setCutVector = function (e) { this.__cutAwayVector = e, this.cutAwayChanged.emit(); };
    ca.prototype.getCutDist = function () { return this.__cutAwayDist; };
    ca.prototype.setCutDist = function (e) { this.__cutAwayDist = e, this.cutAwayChanged.emit(); };
    ca.prototype.readBinary = function (e, t) { if (_super.prototype.readBinary.call(this, e, t), t.versions["zea-engine"].greaterOrEqualThan([0, 0, 4])) {
        var a_116 = e.loadStr();
        var i_91 = t.assetItem.getMaterialLibrary().getMaterial(a_116, !1);
        if (i_91 || (i_91 = new He(a_116, "SimpleSurfaceShader"), i_91.getParameter("BaseColor").setValue(y.random(.25), E.DATA_LOAD), t.assetItem.getMaterialLibrary().addMaterial(i_91)), this.setMaterial(i_91, E.DATA_LOAD), this.__layers = e.loadStrArray(), this.__layers.length > 0)
            for (var _b = 0, _c = this.__layers; _b < _c.length; _b++) {
                var e_100 = _c[_b];
                t.addGeomToLayer(this, e_100);
            }
    } };
    return ca;
}(ra));
var ma = /** @class */ (function (_super) {
    __extends(ma, _super);
    function ma(e, t, a) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__geomParam = _this.insertParameter(new ze("geometry"), 0), _this.__geomParam.valueChanged.connect(_this._setBoundingBoxDirty.bind(_this)), _this.__geomParam.boundingBoxDirtied.connect(_this._setBoundingBoxDirty.bind(_this)), _this.__materialParam = _this.insertParameter(new Tt("Material"), 1), _this.__paramMapping.material = _this.getParameterIndex(_this.__materialParam), _this.__lightmapCoordOffset = new _, _this.__geomOffsetXfoParam = _this.addParameter(new Le("GeomOffsetXfo")), _this.__geomMatParam = _this.addParameter(new We("GeomMat")), _this.__cleanGeomMat = _this.__cleanGeomMat.bind(_this), _this.__globalXfoParam.valueChanged.connect(function (e) { _this.__geomMatParam.setDirty(_this.__cleanGeomMat); }), _this.__geomOffsetXfoParam.valueChanged.connect(function (e) { _this.__geomMatParam.setDirty(_this.__cleanGeomMat); }), _this.geomXfoChanged = _this.__geomMatParam.valueChanged, _this.materialAssigned = _this.__materialParam.valueChanged, _this.geomAssigned = _this.__geomParam.valueChanged, t && _this.setGeometry(t, E.DATA_LOAD), a && _this.setMaterial(a, E.DATA_LOAD);
        return _this;
    }
    ma.prototype.__cleanGeomMat = function () { var e = this.__globalXfoParam.getValue().toMat4(), t = this.__geomOffsetXfoParam.getValue().toMat4(); return e.multiply(t); };
    ma.prototype.getGeometry = function () { return this.__geomParam.getValue(); };
    ma.prototype.setGeometry = function (e, t) { this.__geomParam.setValue(e, t); };
    ma.prototype.getGeom = function () { return console.warn("getGeom is deprectated. Please use 'getGeometry'"), this.getGeometry(); };
    ma.prototype.setGeom = function (e) { return console.warn("setGeom is deprectated. Please use 'setGeometry'"), this.setGeometry(e); };
    ma.prototype.getMaterial = function () { return this.__materialParam.getValue(); };
    ma.prototype.setMaterial = function (e, t) { this.__materialParam.setValue(e, t); };
    ma.prototype._cleanBoundingBox = function (e) { e = _super.prototype._cleanBoundingBox.call(this, e); var t = this.getGeometry(); return t && e.addBox3(t.boundingBox, this.getGeomMat4()), e; };
    ma.prototype.getGeomOffsetXfo = function () { return this.__geomOffsetXfoParam.getValue(); };
    ma.prototype.setGeomOffsetXfo = function (e) { this.__geomOffsetXfoParam.setValue(e); };
    ma.prototype.getGeomMat4 = function () { return this.__geomMatParam.getValue(); };
    ma.prototype.getLightmapName = function () { return this.__lightmapName; };
    ma.prototype.getLightmapCoordsOffset = function () { return this.__lightmapCoordOffset; };
    ma.prototype.applyAssetLightmapSettings = function (e, t) { this.__lightmap = e, this.__lightmapCoordOffset.addInPlace(t); };
    ma.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    ma.prototype.fromJSON = function (e, t) { _super.prototype.fromJSON.call(this, e, t), t.numGeomItems++; };
    ma.prototype.readBinary = function (e, t) {
        var _this = this;
        _super.prototype.readBinary.call(this, e, t), t.numGeomItems++, this.__lightmapName = t.assetItem.getName();
        var a = e.loadUInt8(), i = e.loadUInt32(), s = t.assetItem.getGeometryLibrary(), n = s.getGeom(i);
        if (n)
            this.setGeometry(n, E.DATA_LOAD);
        else {
            this.geomIndex = i;
            var e_101 = function (e) { if (i >= e[0] && i < e[1]) {
                var e_102 = s.getGeom(i);
                e_102 ? _this.setGeometry(e_102, E.DATA_LOAD) : console.warn("Geom not loaded:", _this.getName()), s.rangeLoaded.disconnectId(t_122);
            } }, t_122 = s.rangeLoaded.connect(e_101);
        }
        if (4 & a && this.__geomOffsetXfoParam.setValue(new S(e.loadFloat32Vec3(), e.loadFloat32Quat(), e.loadFloat32Vec3())), t.versions["zea-engine"].lessThan([0, 0, 4])) {
            if (a & 8) {
                var a_117 = t.assetItem.getMaterialLibrary(), i_92 = e.loadStr();
                var s_25 = a_117.getMaterial(i_92);
                s_25 || (console.warn("Geom :'" + this.name + "' Material not found:" + i_92), s_25 = a_117.getMaterial("Default")), this.setMaterial(s_25, E.DATA_LOAD);
            }
            else
                this.setMaterial(t.assetItem.getMaterialLibrary().getMaterial("Default"), E.DATA_LOAD);
        }
        this.__lightmapCoordOffset = e.loadFloat32Vec2();
    };
    ma.prototype.toString = function () { return JSON.stringify(this.toJSON(), null, 2); };
    ma.prototype.clone = function (e) { var t = new ma; return t.copyFrom(this, e), t; };
    ma.prototype.copyFrom = function (e, t) {
        var _this = this;
        if (_super.prototype.copyFrom.call(this, e, t), this.__lightmapCoordOffset = e.__lightmapCoordOffset, !e.getGeometry() && -1 != e.geomIndex) {
            var a_118 = t.assetItem.getGeometryLibrary(), i_93 = e.geomIndex, s = function (e) { if (i_93 >= e[0] && i_93 < e[1]) {
                var e_103 = a_118.getGeom(i_93);
                e_103 ? _this.setGeometry(e_103, E.DATA_LOAD) : console.warn("Geom not loaded:", _this.getName()), a_118.rangeLoaded.disconnectId(n_25);
            } }, n_25 = a_118.rangeLoaded.connect(s);
        }
        this.__geomMatParam.setDirty(this.__cleanGeomMat);
    };
    ma.prototype.destroy = function () { _super.prototype.destroy.call(this); };
    return ma;
}(ca));
J.registerClass("GeomItem", ma);
var ua = { manual: 0, first: 1, average: 2, globalOri: 3 };
var ba = /** @class */ (function (_super) {
    __extends(ba, _super);
    function ba(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.setFlag($.USER_EDITED), _this.calculatingGroupXfo = !1, _this.dirty = !1, _this.invGroupXfo = void 0, _this.__initialXfos = [], _this.__signalIndices = [];
        var t = 0;
        _this.__itemsParam = _this.insertParameter(new Ke("Items", function (e) { return e instanceof ra; }), t++), _this.__itemsParam.itemAdded.connect(function (e, t) { _this.__bindItem(e, t); }), _this.__itemsParam.itemRemoved.connect(function (e, t) { _this.__unbindItem(e, t); }), _this.__itemsParam.valueChanged.connect(function () { _this.calcGroupXfo(), _this._setBoundingBoxDirty(); }), _this.__initialXfoModeParam = _this.insertParameter(new ye("InitialXfoMode", ua.average, ["manual", "first", "average", "global"]), t++), _this.__initialXfoModeParam.valueChanged.connect(function () { _this.calcGroupXfo(); }), _this.__highlightedParam = _this.insertParameter(new fe("Highlighted", !1), t++), _this.__highlightedParam.valueChanged.connect(function () { _this.__updateHighlight(); }), _this.__updateHighlight = _this.__updateHighlight.bind(_this), _this.insertParameter(new xe("HighlightColor", new y(.5, .5, 1)), t++).valueChanged.connect(_this.__updateHighlight), _this.insertParameter(new Xe("HighlightFill", 0, [0, 1]), t++).valueChanged.connect(_this.__updateHighlight), _this.__materialParam = _this.insertParameter(new Tt("Material"), t++), _this.__materialParam.valueChanged.connect(function () { _this.__updateMaterial(); }), _this.__updateCutaway = _this.__updateCutaway.bind(_this), _this.insertParameter(new fe("CutAwayEnabled", !1), t++).valueChanged.connect(_this.__updateCutaway), _this.insertParameter(new Ie("CutVector", new Z(1, 0, 0)), t++).valueChanged.connect(_this.__updateCutaway), _this.insertParameter(new Xe("CutDist", 0), t++).valueChanged.connect(_this.__updateCutaway), _this.__globalXfoParam.valueChanged.connect(function (e) { _this.calculatingGroupXfo || _this._propagateDirtyXfoToItems(); });
        return _this;
    }
    Object.defineProperty(ba, "INITIAL_XFO_MODES", {
        get: function () { return ua; },
        enumerable: true,
        configurable: true
    });
    ba.prototype.__updateVisiblity = function () { if (_super.prototype.__updateVisiblity.call(this)) {
        var e_104 = this.getVisible();
        return Array.from(this.__itemsParam.getValue()).forEach(function (t) { t instanceof ra && t.propagateVisiblity(e_104 ? 1 : -1); }), !0;
    } return !1; };
    ba.prototype.__updateHighlight = function () { var e, t = !1; (this.getParameter("Highlighted").getValue() || this.isSelected()) && (t = !0, e = this.getParameter("HighlightColor").getValue(), e.a = this.getParameter("HighlightFill").getValue()); var a = "groupItemHighlight" + this.getId(); Array.from(this.__itemsParam.getValue()).forEach(function (i) { i instanceof ra && (t ? i.addHighlight(a, e, !0) : i.removeHighlight(a, !0)); }); };
    ba.prototype.setSelected = function (e) { _super.prototype.setSelected.call(this, e), this.__updateHighlight(); };
    ba.prototype._setGlobalXfoDirty = function () { _super.prototype._setGlobalXfoDirty.call(this); };
    ba.prototype.calcGroupXfo = function () {
        var _this = this;
        var e = Array.from(this.__itemsParam.getValue());
        if (0 == e.length)
            return new S;
        this.calculatingGroupXfo = !0;
        var t = this.__initialXfoModeParam.getValue();
        var a;
        if (t == ua.manual)
            return this.invGroupXfo = this.getGlobalXfo().inverse(), void (this.calculatingGroupXfo = !1);
        if (t == ua.first)
            a = this.__initialXfos[0];
        else if (t == ua.average) {
            a = new S, a.ori.set(0, 0, 0, 0);
            var t_123 = 0;
            e.forEach(function (e, i) { e instanceof ra && (a.tr.addInPlace(_this.__initialXfos[i].tr), a.ori.addInPlace(_this.__initialXfos[i].ori), t_123++); }), a.tr.scaleInPlace(1 / t_123), a.ori.normalizeInPlace();
        }
        else {
            if (t != ua.globalOri)
                throw new Error("Invalid mode.");
            {
                a = new S;
                var t_124 = 0;
                e.forEach(function (e, i) { e instanceof ra && (a.tr.addInPlace(_this.__initialXfos[i].tr), t_124++); }), a.tr.scaleInPlace(1 / t_124);
            }
        }
        this.setGlobalXfo(a, E.GENERATED_VALUE);
        var i = this.getGlobalXfo();
        this.invGroupXfo = i.inverse(), this.calculatingGroupXfo = !1;
    };
    ba.prototype._propagateDirtyXfoToItems = function () {
        var _this = this;
        if (this.calculatingGroupXfo)
            return;
        var e = Array.from(this.__itemsParam.getValue());
        if (!this.calculatingGroupXfo && e.length > 0 && this.invGroupXfo && !this.dirty) {
            var t_125;
            this.dirty = !0, this.propagatingXfoToItems = !0;
            var a_119 = function (e, a) { var i = e.getParameter("GlobalXfo"); i.setDirty(function () { if (!t_125) {
                var e_105 = _this.__globalXfoParam.getValue();
                t_125 = e_105.multiply(_this.invGroupXfo), _this.dirty = !1;
            } var e = t_125.multiply(a); i.setClean(e); }); };
            e.forEach(function (e, t) { e instanceof ra && a_119(e, _this.__initialXfos[t]); }), this.propagatingXfoToItems = !1;
        }
    };
    ba.prototype.__updateMaterial = function () { var e = this.getParameter("Material").getValue(); Array.from(this.__itemsParam.getValue()).forEach(function (t) { t.traverse(function (t) { if (t instanceof ra && t.hasParameter("Material")) {
        var a_120 = t.getParameter("Material");
        if (e) {
            var t_126 = a_120.getValue();
            t_126 != e && (a_120.__backupMaterial = t_126, a_120.setValue(e, E.GENERATED_VALUE));
        }
        else
            a_120.__backupMaterial && a_120.setValue(a_120.__backupMaterial, E.GENERATED_VALUE);
    } }, !1); }); };
    ba.prototype.__updateCutaway = function () { var e = this.getParameter("CutAwayEnabled").getValue(), t = this.getParameter("CutVector").getValue(), a = this.getParameter("CutDist").getValue(); Array.from(this.__itemsParam.getValue()).forEach(function (i) { i.traverse(function (i) { i instanceof ca && (i.setCutawayEnabled(e), i.setCutVector(t), i.setCutDist(a)); }, !0); }); };
    ba.prototype.setPaths = function (e) {
        var _this = this;
        this.clearItems(!1);
        var t = this.getOwner();
        if (null == t)
            return void console.warn("Group does not have an owner and so cannot resolve paths:", this.getName());
        var a = [];
        e.forEach(function (e) { var i = t.resolvePath(e); i ? a.push(i) : console.warn("Path does not resolve to an Item:", e, " group:", _this.getName()); }), this.setItems(a);
    };
    ba.prototype.resolveItems = function (e) { this.setPaths(e); };
    ba.prototype.__bindItem = function (e, t) {
        var _this = this;
        if (!(e instanceof ra))
            return;
        var a = {};
        a.mouseDownIndex = e.mouseDown.connect(function (e) { _this.onMouseDown(e); }), a.mouseUpIndex = e.mouseUp.connect(function (e) { _this.onMouseUp(e); }), a.mouseMoveIndex = e.mouseMove.connect(function (e) { _this.onMouseMove(e); }), a.mouseEnterIndex = e.mouseEnter.connect(function (e) { _this.onMouseEnter(e); }), a.mouseLeaveIndex = e.mouseLeave.connect(function (e) { _this.onMouseLeave(e); });
        var i = this.getParameter("Material").getValue();
        if (i && e.traverse(function (e) { if (e instanceof ra && e.hasParameter("Material")) {
            var t_127 = e.getParameter("Material");
            if (i) {
                var e_106 = t_127.getValue();
                e_106 != i && (t_127.__backupMaterial = e_106, t_127.setValue(i, E.GENERATED_VALUE));
            }
        } }, !0), e instanceof ra && this.getParameter("Highlighted").getValue()) {
            var t_128 = this.getParameter("HighlightColor").getValue();
            t_128.a = this.getParameter("HighlightFill").getValue(), e.addHighlight("groupItemHighlight" + this.getId(), t_128, !0);
        }
        var s = this.getParameter("CutAwayEnabled").getValue();
        if (s) {
            var t_129 = this.getParameter("CutVector").getValue(), a_121 = this.getParameter("CutDist").getValue();
            e.traverse(function (e) { e instanceof ca && (e.setCutawayEnabled(s), e.setCutVector(t_129), e.setCutDist(a_121)); }, !0);
        }
        this.getVisible() || e.propagateVisiblity(-1);
        var n = function () { var e = _this.__initialXfoModeParam.getValue(); e == ua.first && 0 == t ? _this.calcGroupXfo() : e != ua.average && e != ua.globalOri || _this.calcGroupXfo(); };
        a.globalXfoChangedIndex = e.globalXfoChanged.connect(function (a) { _this.propagatingXfoToItems || (_this.__initialXfos[t] = e.getGlobalXfo(), n()); }), this.__initialXfos[t] = e.getGlobalXfo(), a.bboxChangedIndex = e.boundingChanged.connect(this._setBoundingBoxDirty), this.__signalIndices[t] = a, n();
    };
    ba.prototype.__unbindItem = function (e, t) { if (!(e instanceof ra))
        return; e.removeHighlight("branchselected" + this.getId(), !0), this.getParameter("Highlighted").getValue() && e.removeHighlight("groupItemHighlight" + this.getId(), !0), this.getVisible() || e.propagateVisiblity(1), e.traverse(function (e) { e instanceof ca && e.setCutawayEnabled(!1); }, !0); var a = this.__signalIndices[t]; e.mouseDown.disconnectId(a.mouseDownIndex), e.mouseUp.disconnectId(a.mouseUpIndex), e.mouseMove.disconnectId(a.mouseMoveIndex), e.mouseEnter.disconnectId(a.mouseEnterIndex), e.mouseLeave.disconnectId(a.mouseLeaveIndex), e.globalXfoChanged.disconnectId(a.globalXfoChangedIndex), e.boundingChanged.disconnectId(a.bboxChangedIndex), this.__signalIndices.splice(t, 1), this.__initialXfos.splice(t, 1); };
    ba.prototype.addItem = function (e, t) {
        if (t === void 0) { t = !0; }
        e ? this.__itemsParam.addItem(e, t) : console.warn("Error adding item to group. Item is null");
    };
    ba.prototype.removeItem = function (e, t) {
        if (t === void 0) { t = !0; }
        this.__itemsParam.removeItem(e, t);
    };
    ba.prototype.clearItems = function (e) {
        if (e === void 0) { e = !0; }
        var t = Array.from(this.__itemsParam.getValue());
        for (var e_107 = t.length - 1; e_107 >= 0; e_107--)
            this.__unbindItem(t[e_107], e_107);
        this.__signalIndices = [], this.__initialXfos = [], this.__itemsParam.clearItems(e);
    };
    ba.prototype.getItems = function () { return this.__itemsParam.getValue(); };
    ba.prototype.setItems = function (e) { this.clearItems(!1), this.__itemsParam.setItems(e); };
    ba.prototype._cleanBoundingBox = function (e) { var t = _super.prototype._cleanBoundingBox.call(this, e); return Array.from(this.__itemsParam.getValue()).forEach(function (e) { e instanceof ra && e.getVisible() && !e.testFlag($.IGNORE_BBOX) && t.addBox3(e.getBoundingBox()); }), t; };
    ba.prototype.onMouseDown = function (e) { _super.prototype.onMouseDown.call(this, e); };
    ba.prototype.onMouseUp = function (e) { _super.prototype.onMouseUp.call(this, e); };
    ba.prototype.onMouseMove = function (e) { _super.prototype.onMouseMove.call(this, e); };
    ba.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t), i = Array.from(this.__itemsParam.getValue()), s = []; return i.forEach(function (t) { var a = t.getPath(); s.push(e ? e.makeRelative(a) : a); }), a.treeItems = s, a; };
    ba.prototype.fromJSON = function (e, t, a) {
        var _this = this;
        if (_super.prototype.fromJSON.call(this, e, t, a), this.setFlag($.USER_EDITED), !e.treeItems)
            return void console.warn("Invalid Parameter JSON");
        var i = e.treeItems.length;
        var s = function (e) { t.resolvePath(e, function (e) { _this.addItem(e), i--, 0 == i && (_this.calculatingGroupXfo = !0, _this.calcGroupXfo(), _this.calculatingGroupXfo = !1); }, function (t) { console.warn("Group: '" + _this.getName() + "'. Unable to load item:" + e); }); };
        for (var _b = 0, _c = e.treeItems; _b < _c.length; _b++) {
            var t_130 = _c[_b];
            s(t_130);
        }
    };
    ba.prototype.clone = function (e) { var t = new ba; return t.copyFrom(this, e), t; };
    ba.prototype.copyFrom = function (e, t) { _super.prototype.copyFrom.call(this, e, t); };
    ba.prototype.destroy = function () { _super.prototype.destroy.call(this); };
    return ba;
}(ra));
J.registerClass("Group", ba);
var pa = he("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwpjb25zdCB0PU1hdGguUEkvMTgwO01hdGguSEFMRl9QST0uNSpNYXRoLlBJLE1hdGguVFdPX1BJPTIqTWF0aC5QSTtNYXRoLnJhZFRvRGVnPWZ1bmN0aW9uKGUpe3JldHVybiBlL3R9LE1hdGguZGVnVG9SYWQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUqdH0sTnVtYmVyLmlzTnVtZXJpYz10PT4haXNOYU4ocGFyc2VGbG9hdCh0KSkmJmlzRmluaXRlKHQpLFN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbD1mdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnJlcGxhY2UobmV3IFJlZ0V4cCh0LCJnIiksZSl9O2Z1bmN0aW9uIGUodCxlPTAscz01KXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkodCwoZnVuY3Rpb24odCxlKXtyZXR1cm4gZSYmZS50b0ZpeGVkP051bWJlcihlLnRvRml4ZWQocykpOmV9KSxlKX1TdHJpbmcucHJvdG90eXBlLmhhc2g9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24odCl7bGV0IGUscyxhLGk9MDtpZigwPT09dC5sZW5ndGgpcmV0dXJuIGk7Zm9yKGU9MCxhPXQubGVuZ3RoO2U8YTtlKyspcz10LmNoYXJDb2RlQXQoZSksaT0oaTw8NSktaStzLGl8PTA7cmV0dXJuIE1hdGguYWJzKGkpfSh0aGlzKX0sU3RyaW5nLnByb3RvdHlwZS50cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzK3xccyskL2csIiIpfSxTdHJpbmcucHJvdG90eXBlLmx0cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzKy8sIiIpfSxTdHJpbmcucHJvdG90eXBlLnJ0cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXHMrJC8sIiIpfSxTdHJpbmcucHJvdG90eXBlLmxwYWQ9ZnVuY3Rpb24odCxlKXtsZXQgcz10aGlzO2Zvcig7cy5sZW5ndGg8ZTspcz10K3M7cmV0dXJuIHN9LFN0cmluZy5wcm90b3R5cGUucnBhZD1mdW5jdGlvbih0LGUpe2xldCBzPXRoaXM7Zm9yKDtzLmxlbmd0aDxlOylzKz10O3JldHVybiBzfSxNYXRoLnJhbmRvbUludD1mdW5jdGlvbih0LGUpe3JldHVybiB0PU1hdGguY2VpbCh0KSxlPU1hdGguZmxvb3IoZSksTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihlLXQpKSt0fSxNYXRoLmxlcnA9KHQsZSxzKT0+dCtzKihlLXQpLE1hdGguY2xhbXA9ZnVuY3Rpb24odCxlLHMpe3JldHVybiBNYXRoLm1pbihNYXRoLm1heCh0LGUpLHMpfSxNYXRoLm5lYXJlc3RQb3cyPWZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdygyLE1hdGgucm91bmQoTWF0aC5sb2codCkvTWF0aC5sb2coMikpKX0sTWF0aC5uZWFyZXN0UG93MTA9ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGgucG93KDEwLE1hdGgucm91bmQoTWF0aC5sb2cxMCh0KS9NYXRoLmxvZzEwKDEwKSkpfSxNYXRoLm5leHRQb3cyPWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKDt0PjA7KWUrKyx0Pj49MTtyZXR1cm4gMTw8ZX0sTWF0aC5mcmFjdD1mdW5jdGlvbih0KXtyZXR1cm4gMD09dD8wOnQ8MD90Pi0xPy10Oi10JU1hdGguZmxvb3IoLXQpOnQ8MT90OnQlTWF0aC5mbG9vcih0KX0sTWF0aC5yZW1hcD1mdW5jdGlvbih0LGUscyxhLGkpe3JldHVybiBhKyh0LWUpLyhzLWUpKihpLWEpfSxNYXRoLmNvbnZlcnRGbG9hdDMyQXJyYXlUb1VJbnQxNkFycmF5PWZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IFVpbnQxNkFycmF5KHQubGVuZ3RoKSxzPW5ldyBJbnQzMkFycmF5KHQuYnVmZmVyKSxhPXQ9PntsZXQgZT10Pj4xNiYzMjc2OCxzPXQ+PjEyJjIwNDc7Y29uc3QgYT10Pj4yMyYyNTU7cmV0dXJuIGE8MTAzP2U6YT4xNDI/KGV8PTMxNzQ0LGV8PSgyNTU9PWE/MDoxKSYmODM4ODYwNyZ0LGUpOmE8MTEzPyhzfD0yMDQ4LGV8PShzPj4xMTQtYSkrKHM+PjExMy1hJjEpLGUpOihlfD1hLTExMjw8MTB8cz4+MSxlKz0xJnMsZSl9O2ZvcihsZXQgaT0wO2k8dC5sZW5ndGg7aSsrKWVbaV09YShzW2ldKTtyZXR1cm4gZX0sTWF0aC5kZWNvZGUxNkJpdEZsb2F0RnJvbTJ4VUludDg9dD0+e2NvbnN0IGU9dFswXSxzPSgxMjAmZSk+PjM7bGV0IGE9MD09cz8wOjIwNDg7Y29uc3QgaT1hKygoNyZlKTw8OCkrdFsxXTtyZXR1cm4gYT0wPT1zPzE6MCwoMTI4JmU/MTotMSkqaSpNYXRoLnBvdygyLHMrYS0xNil9LE1hdGguZW5jb2RlMTZCaXRGbG9hdEludG8yeFVJbnQ4PXQ9PntjfHwoYz1uZXcgVWludDhBcnJheSgyKSk7Y29uc3QgZT10Pj0wPzEyODowO3Q9TWF0aC5hYnModCk7bGV0IHMsYT0xNSxpPTEwMjQ7Zm9yKGxldCBlPTE1O2U+MDtlLS0pdDxpJiYoaS89MixhLS0pO3M9MD09YT90L2kvMjoodC1pKS9pO2NvbnN0IHI9TWF0aC5yb3VuZCgyMDQ4KnMpLG49ci8yNTYsaD1yLTI1NipuO3JldHVybiBjWzBdPWUrOCphK24sY1sxXT1oLHQ+PTIwNDgmJihjWzBdPTI1NSksY30sTWF0aC5lbmNvZGUxNkJpdEZsb2F0PXQ9Pntjb25zdCBlPW5ldyBGbG9hdDMyQXJyYXkoMSk7ZVswXT10O3JldHVybih0PT57bGV0IGU9dD4+MTYmMzI3Njgscz10Pj4xMiYyMDQ3O2NvbnN0IGE9dD4+MjMmMjU1O3JldHVybiBhPDEwMz9lOmE+MTQyPyhlfD0zMTc0NCxlfD0oMjU1PT1hPzA6MSkmJjgzODg2MDcmdCxlKTphPDExMz8oc3w9MjA0OCxlfD0ocz4+MTE0LWEpKyhzPj4xMTMtYSYxKSxlKTooZXw9YS0xMTI8PDEwfHM+PjEsZSs9MSZzLGUpfSkobmV3IEludDMyQXJyYXkoZS5idWZmZXIpWzBdKX0sTWF0aC5kZWNvZGUxNkJpdEZsb2F0PXQ9Pntjb25zdCBlPSgzMjc2OCZ0KT4+MTUscz0oMzE3NDQmdCk+PjEwLGE9MTAyMyZ0O3JldHVybiAwPT1zPyhlPy0xOjEpKk1hdGgucG93KDIsLTE0KSooYS9NYXRoLnBvdygyLDEwKSk6MzE9PXM/YT9OYU46MS8wKihlPy0xOjEpOihlPy0xOjEpKk1hdGgucG93KDIscy0xNSkqKDErYS9NYXRoLnBvdygyLDEwKSl9LE1hdGguc21vb3RoU3RlcD0odCxlLHMpPT57Y29uc3QgYT1NYXRoLmNsYW1wKChzLXQpLyhlLXQpLDAsMSk7cmV0dXJuIGEqYSooMy0yKmEpfSxNYXRoLmxpblN0ZXA9KHQsZSxzKT0+TWF0aC5jbGFtcCgocy10KS8oZS10KSwwLDEpO2NsYXNzIHN7aXNWYWxpZCgpe2Zvcihjb25zdCB0IG9mIHRoaXMuX19kYXRhKWlmKHQ9PTEvMHx8aXNOYU4odCkpcmV0dXJuITE7cmV0dXJuITB9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZSl7dGhyb3cgbmV3IEVycm9yKCJOb3QgeWV0IGltcGxlbWVudGVkIGZvciB0aGlzIHR5cGU6Iit0aGlzLmNvbnN0cnVjdG9yLm5hbWUpfXN0YXRpYyBudW1FbGVtZW50cygpe3Rocm93IG5ldyBFcnJvcigiTm90IHlldCBpbXBsZW1lbnRlZCBmb3IgdGhpcyB0eXBlOiIrdGhpcy5jb25zdHJ1Y3Rvci5uYW1lKX1hc0FycmF5KCl7cmV0dXJuIHRoaXMuX19kYXRhfXRvU3RyaW5nKCl7cmV0dXJuIGUodGhpcy50b0pTT04oKSl9fWNvbnN0IGE9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5fX3R5cGVzPXt9LHRoaXMuX19uYW1lcz17fSx0aGlzLnJlZ2lzdGVyVHlwZSgiU0ludDMyIiw1KSx0aGlzLnJlZ2lzdGVyVHlwZSgiVUludDMyIiw0KSx0aGlzLnJlZ2lzdGVyVHlwZSgiRmxvYXQzMiIsNil9cmVnaXN0ZXJUeXBlKHQsZSl7dGhpcy5fX3R5cGVzW3RdPWUsZS5uYW1lP3RoaXMuX19uYW1lc1tlLm5hbWVdPXQ6dGhpcy5fX25hbWVzW2VdPXR9Z2V0VHlwZSh0KXtyZXR1cm4gdGhpcy5fX3R5cGVzW3RdfWdldFR5cGVOYW1lKHQpe2lmKHRoaXMuX19uYW1lc1t0XSlyZXR1cm4gdGhpcy5fX25hbWVzW3RdO2lmKHRoaXMuX19uYW1lc1t0Lm5hbWVdKXJldHVybiB0aGlzLl9fbmFtZXNbdC5uYW1lXTt0aHJvdyB0fX07Y2xhc3MgaSBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgVWludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsMil9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMiksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMiksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lKX1nZXQgeCgpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgeCh0KXt0aGlzLl9fZGF0YVswXT10fWdldCB5KCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCB5KHQpe3RoaXMuX19kYXRhWzFdPXR9c2V0KHQsZSl7dGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lfXNldEZyb21PdGhlcih0KXt0aGlzLng9dC54LHRoaXMueT10Lnl9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueX1ub3RFcXVhbHModCl7cmV0dXJuIHRoaXMueCE9dC54JiZ0aGlzLnkhPXQueX1hcHByb3hFcXVhbCh0LGU9TnVtYmVyLkVQU0lMT04pe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KTxlJiZNYXRoLmFicyh0aGlzLnktdC55KTxlfWFkZCh0KXtyZXR1cm4gbmV3IGkodGhpcy54K3QueCx0aGlzLnkrdC55KX1hZGRJblBsYWNlKHQpe3RoaXMueCs9dC54LHRoaXMueSs9dC55fXN1YnRyYWN0KHQpe3JldHVybiBuZXcgaSh0aGlzLngtdC54LHRoaXMueS10LnkpfXN1YnRyYWN0SW5QbGFjZSh0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpc31zY2FsZSh0KXtyZXR1cm4gbmV3IGkodGhpcy54KnQsdGhpcy55KnQpfXNjYWxlSW5QbGFjZSh0KXt0aGlzLngqPXQsdGhpcy55Kj10fWludmVydCgpe3JldHVybiBuZXcgaSgxL3RoaXMueCwxL3RoaXMueSl9aW52ZXJ0SW5QbGFjZSgpe3JldHVybiB0aGlzLng9MS90aGlzLngsdGhpcy55PTEvdGhpcy55LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIG5ldyBpKHRoaXMueCp0LngsdGhpcy55KnQueSl9bXVsdGlwbHlJblBsYWNlKHQpe3RoaXMueCo9dC54LHRoaXMueSo9dC55fWxlbmd0aFNxdWFyZWQoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV07cmV0dXJuIHQqdCtlKmV9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLmxlbmd0aFNxdWFyZWQoKSl9ZGlzdGFuY2VUbyh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdLXQueCxzPXRoaXMuX19kYXRhWzFdLXQueTtyZXR1cm4gTWF0aC5zcXJ0KGUqZStzKnMpfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXTtsZXQgcz10KnQrZSplO3JldHVybiBzPE51bWJlci5FUFNJTE9OP25ldyBpOihzPTEvTWF0aC5zcXJ0KHMpLG5ldyBpKHQqcyxlKnMpKX1ub3JtYWxpemVJblBsYWNlKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdO2xldCBzPXQqdCtlKmU7czxOdW1iZXIuRVBTSUxPTnx8KHM9MS9NYXRoLnNxcnQocyksdGhpcy5zZXQodCpzLGUqcykpfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55fWNyb3NzKHQpe3JldHVybiB0aGlzLngqdC55LXRoaXMueSp0Lnh9YW5nbGVUbyh0KXtjb25zdCBlPXRoaXMubm9ybWFsaXplKCkuZG90KHQubm9ybWFsaXplKCkpO3JldHVybiBlPjE/MDplPC0xP01hdGguUEk6TWF0aC5hY29zKGUpfXNpZ25lZEFuZ2xlVG8odCl7Y29uc3QgZT10aGlzLmFuZ2xlVG8odCk7cmV0dXJuIHRoaXMuY3Jvc3ModCk8MD8tZTplfXJvdGF0ZSh0KXtjb25zdCBlPU1hdGguY29zKHQpLHM9TWF0aC5zaW4odCk7cmV0dXJuIG5ldyBpKHRoaXMueCplLXRoaXMueSpzLHRoaXMueCpzK3RoaXMueSplKX1sZXJwKHQsZSl7Y29uc3Qgcz10aGlzLngsYT10aGlzLnk7cmV0dXJuIG5ldyBpKHMrZSoodC54LXMpLGErZSoodC55LWEpKX1zZXRSYW5kb21EaXIodD0xKXtjb25zdCBlPTIqTWF0aC5yYW5kb20oKSpNYXRoLlBJO3JldHVybiB0aGlzLl9fZGF0YVswXT1NYXRoLmNvcyhlKSp6U2NhbGUsdGhpcy5fX2RhdGFbMV09TWF0aC5zaW4oZSkqelNjYWxlLHRoaXN9c2V0UmFuZG9tKHQ9MSl7cmV0dXJuIHRoaXMuX19kYXRhWzBdPU1hdGgucmFuZG9tKCkqdCx0aGlzLl9fZGF0YVsxXT1NYXRoLnJhbmRvbSgpKnQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgaSh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgaSguLi50KX1zdGF0aWMgY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodCxlPTApe3JldHVybiBuZXcgaSh0LDQqZSl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQXJyYXkodCl7cmV0dXJuIG5ldyBpKHQpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiAyfXRvSlNPTigpe3JldHVybnt4OnRoaXMueCx5OnRoaXMueX19ZnJvbUpTT04odCl7dGhpcy54PXQueCx0aGlzLnk9dC55fX1hLnJlZ2lzdGVyVHlwZSgiVmVjMiIsaSk7Y2xhc3MgciBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCxzPTApe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsMyl9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMyksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMyksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXMpfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCB4eSgpe3JldHVybiBuZXcgaSh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSl9Z2V0IHl6KCl7cmV0dXJuIG5ldyBpKHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdKX1zZXQodCxlLHMpe3RoaXMueD10LHRoaXMueT12b2lkIDAhPT1lP2U6dCx0aGlzLno9dm9pZCAwIT09cz9zOnR9c2V0RGF0YUFycmF5KHQpe3RoaXMuX19kYXRhPXR9c2V0RnJvbU90aGVyKHQpe3RoaXMueD10LngsdGhpcy55PXQueSx0aGlzLno9dC56fWlzTnVsbCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicyh0aGlzLnkpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicyh0aGlzLnopPE51bWJlci5FUFNJTE9OfWlzMTExKCl7cmV0dXJuIE1hdGguYWJzKDEtdGhpcy54KTxOdW1iZXIuRVBTSUxPTiYmTWF0aC5hYnMoMS10aGlzLnkpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicygxLXRoaXMueik8TnVtYmVyLkVQU0lMT059ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10Lnp9bm90RXF1YWxzKHQpe3JldHVybiB0aGlzLnghPXQueCYmdGhpcy55IT10LnkmJnRoaXMueiE9dC56fWFwcHJveEVxdWFsKHQsZT1OdW1iZXIuRVBTSUxPTil7cmV0dXJuIE1hdGguYWJzKHRoaXMueC10LngpPGUmJk1hdGguYWJzKHRoaXMueS10LnkpPGUmJk1hdGguYWJzKHRoaXMuei10LnopPGV9YWRkKHQpe3JldHVybiBuZXcgcih0aGlzLngrdC54LHRoaXMueSt0LnksdGhpcy56K3Queil9YWRkSW5QbGFjZSh0KXt0aGlzLngrPXQueCx0aGlzLnkrPXQueSx0aGlzLnorPXQuen1zdWJ0cmFjdCh0KXtyZXR1cm4gbmV3IHIodGhpcy54LXQueCx0aGlzLnktdC55LHRoaXMuei10LnopfXN1YnRyYWN0SW5QbGFjZSh0KXt0aGlzLngtPXQueCx0aGlzLnktPXQueSx0aGlzLnotPXQuen1tdWx0aXBseSh0KXtyZXR1cm4gbmV3IHIodGhpcy54KnQueCx0aGlzLnkqdC55LHRoaXMueip0LnopfW11bHRpcGx5SW5QbGFjZSh0KXt0aGlzLngqPXQueCx0aGlzLnkqPXQueSx0aGlzLnoqPXQuen1kaXZpZGUodCl7cmV0dXJuIG5ldyByKHRoaXMueC90LngsdGhpcy55L3QueSx0aGlzLnovdC56KX1kaXZpZGVJblBsYWNlKHQpe3RoaXMueC89dC54LHRoaXMueS89dC55LHRoaXMuei89dC56fXNjYWxlKHQpe3JldHVybiBuZXcgcih0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10fW5lZ2F0ZSgpe3JldHVybiBuZXcgcigtdGhpcy54LC10aGlzLnksLXRoaXMueil9aW52ZXJzZSgpe3JldHVybiBuZXcgcigxL3RoaXMueCwxL3RoaXMueSwxL3RoaXMueil9bGVuZ3RoU3F1YXJlZCgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdO3JldHVybiB0KnQrZSplK3Mqc31sZW5ndGgoKXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3F1YXJlZCgpKX1kaXN0YW5jZVRvKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0tdC54LHM9dGhpcy5fX2RhdGFbMV0tdC55LGE9dGhpcy5fX2RhdGFbMl0tdC56O3JldHVybiBNYXRoLnNxcnQoZSplK3MqcythKmEpfW5vcm1hbGl6ZSgpe2xldCB0PXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO3JldHVybiB0PE51bWJlci5FUFNJTE9OP25ldyByOih0PTEvTWF0aC5zcXJ0KHQpLG5ldyByKHRoaXMuX19kYXRhWzBdKnQsdGhpcy5fX2RhdGFbMV0qdCx0aGlzLl9fZGF0YVsyXSp0KSl9bm9ybWFsaXplSW5QbGFjZSgpe2xldCB0PXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO2lmKHQ8TnVtYmVyLkVQU0lMT04pcmV0dXJuO3Q9TWF0aC5zcXJ0KHQpO2NvbnN0IGU9MS90O3JldHVybiB0aGlzLl9fZGF0YVswXSo9ZSx0aGlzLl9fZGF0YVsxXSo9ZSx0aGlzLl9fZGF0YVsyXSo9ZSx0fXJlc2l6ZSh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO2lmKGU8TnVtYmVyLkVQU0lMT04pcmV0dXJuO2NvbnN0IHM9dC9NYXRoLnNxcnQoZSk7cmV0dXJuIG5ldyByKHRoaXMuX19kYXRhWzBdKnMsdGhpcy5fX2RhdGFbMV0qcyx0aGlzLl9fZGF0YVsyXSpzKX1yZXNpemVJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0qdGhpcy5fX2RhdGFbMF0rdGhpcy5fX2RhdGFbMV0qdGhpcy5fX2RhdGFbMV0rdGhpcy5fX2RhdGFbMl0qdGhpcy5fX2RhdGFbMl07aWYoZTxOdW1iZXIuRVBTSUxPTilyZXR1cm47Y29uc3Qgcz10L01hdGguc3FydChlKTt0aGlzLl9fZGF0YVswXSo9cyx0aGlzLl9fZGF0YVsxXSo9cyx0aGlzLl9fZGF0YVsyXSo9c31kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56fWNyb3NzKHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dC54LG49dC55LGg9dC56O3JldHVybiBuZXcgcihzKmgtYSpuLGEqaS1lKmgsZSpuLXMqaSl9YW5nbGVUbyh0KXtjb25zdCBlPXRoaXMuZG90KHQpO3JldHVybiBlPjE/MDpNYXRoLmFjb3MoZSl9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy54LGE9dGhpcy55LGk9dGhpcy56O3JldHVybiBuZXcgcihzK2UqKHQueC1zKSxhK2UqKHQueS1hKSxpK2UqKHQuei1pKSl9YWJzKCl7cmV0dXJuIG5ldyByKE1hdGguYWJzKHRoaXMueCksTWF0aC5hYnModGhpcy55KSxNYXRoLmFicyh0aGlzLnopKX1zZXRSYW5kb21EaXIodD0xKXtjb25zdCBlPTIqTWF0aC5yYW5kb20oKSpNYXRoLlBJLHM9MipNYXRoLnJhbmRvbSgpLTEsYT1NYXRoLnNxcnQoMS1zKnMpKnQ7cmV0dXJuIHRoaXMuX19kYXRhWzBdPU1hdGguY29zKGUpKmEsdGhpcy5fX2RhdGFbMV09TWF0aC5zaW4oZSkqYSx0aGlzLl9fZGF0YVsyXT1zKnQsdGhpc31zZXRSYW5kb20odD0xKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpcy5fX2RhdGFbMV09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpcy5fX2RhdGFbMl09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgcih0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgciguLi50KX1zdGF0aWMgY3JlYXRlRnJvbUpTT04odCl7Y29uc3QgZT1uZXcgcjtyZXR1cm4gZS5mcm9tSlNPTih0KSxlfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyByKHQsNCplKX1zdGF0aWMgY3JlYXRlRnJvbUZsb2F0MzJBcnJheSh0KXtyZXR1cm4gbmV3IHIodCl9c3RhdGljIG51bUVsZW1lbnRzKCl7cmV0dXJuIDN9dG9KU09OKCl7cmV0dXJue3g6dGhpcy54LHk6dGhpcy55LHo6dGhpcy56fX1mcm9tSlNPTih0KXt0aGlzLng9dC54LHRoaXMueT10LnksdGhpcy56PXQuen19YS5yZWdpc3RlclR5cGUoIlZlYzMiLHIpO2NsYXNzIG4gZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MCl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoNCksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoNCksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXMsdGhpcy5fX2RhdGFbM109YSl9Z2V0IHgoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF19c2V0IHgodCl7dGhpcy5fX2RhdGFbMF09dH1nZXQgeSgpe3JldHVybiB0aGlzLl9fZGF0YVsxXX1zZXQgeSh0KXt0aGlzLl9fZGF0YVsxXT10fWdldCB6KCl7cmV0dXJuIHRoaXMuX19kYXRhWzJdfXNldCB6KHQpe3RoaXMuX19kYXRhWzJdPXR9Z2V0IHQoKXtyZXR1cm4gdGhpcy5fX2RhdGFbM119c2V0IHQodCl7dGhpcy5fX2RhdGFbM109dH1nZXQgeHl6KCl7cmV0dXJuIG5ldyByKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdKX1zZXQodCxlLHMsYSl7dGhpcy54PXQsdGhpcy55PWUsdGhpcy56PXMsdGhpcy50PWF9c2V0RnJvbU90aGVyKHQpe3RoaXMueD10LngsdGhpcy55PXQueSx0aGlzLno9dC56LHRoaXMudD10LnR9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10LnomJnRoaXMudD09dC50fW5vdEVxdWFscyh0KXtyZXR1cm4gdGhpcy54IT10LngmJnRoaXMueSE9dC55JiZ0aGlzLnohPXQueiYmdGhpcy50IT10LnR9YXBwcm94RXF1YWwodCxlPU51bWJlci5FUFNJTE9OKXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCk8ZSYmTWF0aC5hYnModGhpcy55LXQueSk8ZSYmTWF0aC5hYnModGhpcy56LXQueik8ZSYmTWF0aC5hYnModGhpcy50LXQudCk8ZX1hZGQodCl7cmV0dXJuIG5ldyBuKHRoaXMueCt0LngsdGhpcy55K3QueSx0aGlzLnordC56LHRoaXMudCt0LnQpfWFkZEluUGxhY2UodCl7dGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy50Kz10LnR9c3VidHJhY3QodCl7cmV0dXJuIG5ldyBuKHRoaXMueC10LngsdGhpcy55LXQueSx0aGlzLnotdC56LHRoaXMudC10LnQpfXN1YnRyYWN0SW5QbGFjZSh0KXt0aGlzLngtPXQueCx0aGlzLnktPXQueSx0aGlzLnotPXQueix0aGlzLnQtPXQudH1tdWx0aXBseSh0KXtyZXR1cm4gbmV3IG4odGhpcy54KnQueCx0aGlzLnkqdC55LHRoaXMueip0LnosdGhpcy50KnQudCl9bXVsdGlwbHlJblBsYWNlKHQpe3RoaXMueCo9dC54LHRoaXMueSo9dC55LHRoaXMueio9dC56LHRoaXMudCo9dC50fWRpdmlkZSh0KXtyZXR1cm4gbmV3IG4odGhpcy54L3QueCx0aGlzLnkvdC55LHRoaXMuei90LnosdGhpcy50L3QudCl9ZGl2aWRlSW5QbGFjZSh0KXt0aGlzLngvPXQueCx0aGlzLnkvPXQueSx0aGlzLnovPXQueix0aGlzLnQvPXQudH1zY2FsZSh0KXtyZXR1cm4gbmV3IG4odGhpcy54KnQsdGhpcy55KnQsdGhpcy56KnQsdGhpcy50KnQpfXNjYWxlSW5QbGFjZSh0KXt0aGlzLnNldCh0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCx0aGlzLnQqdCl9bGVuZ3RoKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVsyXTtyZXR1cm4gTWF0aC5zcXJ0KHQqdCtlKmUrcypzK2EqYSl9bGVuZ3RoU3F1YXJlZCgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107cmV0dXJuIHQqdCtlKmUrcypzK2EqYX1ub3JtYWxpemUoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO2xldCBpPXQqdCtlKmUrcypzK2EqYTtyZXR1cm4gaTxOdW1iZXIuRVBTSUxPTj9uZXcgbjooaT0xL01hdGguc3FydChpKSxuZXcgbih0KmksZSppLHMqaSkpfW5vcm1hbGl6ZUluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO2xldCBpPXQqdCtlKmUrcypzK2EqYTtpPE51bWJlci5FUFNJTE9OfHwoaT0xL01hdGguc3FydChpKSx0aGlzLnNldCh0KmksZSppLHMqaSxhKmkpKX1kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56K3RoaXMudCpiLnR9Y3Jvc3ModCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksYT10aGlzLnosaT10aGlzLnQscj10LngsaD10Lnksbz10LnosXz10LnQ7cmV0dXJuIG5ldyBuKHMqby1hKmgsYSpfLWkqbyxpKnItZSpfLGUqaC1zKnIpfWFuZ2xlVG8odCl7Y29uc3QgZT10aGlzLm5vcm1hbGl6ZSgpLHM9dC5ub3JtYWxpemUoKSxhPWUuZG90KHMpO3JldHVybiBhPjE/MDpNYXRoLmFjb3MoYSl9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy54LGE9dGhpcy55LGk9dGhpcy56O3JldHVybiBhdD10aGlzLnQsbmV3IG4ocytlKih0LngtcyksYStlKih0LnktYSksaStlKih0LnotaSksYXQrZSoodC50LWF0KSl9cmFuZG9tKHQ9MSl7Y29uc3QgZT0yKmdsTWF0cml4LlJBTkRPTSgpKk1hdGguUEkscz0yKmdsTWF0cml4LlJBTkRPTSgpLTEsYT1NYXRoLnNxcnQoMS1zKnMpKnQ7cmV0dXJuIG91dFswXT1NYXRoLmNvcyhlKSphLG91dFsxXT1NYXRoLnNpbihlKSphLG91dFsyXT1zKnQsb3V0fWNsb25lKCl7cmV0dXJuIG5ldyBuKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdKX10b1ZlYzMoKXtyZXR1cm4gbmV3IHIodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0pfWFzQXJyYXkoKXtyZXR1cm4gdGhpcy5fX2RhdGF9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IHIoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IG4odCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fXRvSlNPTigpe3JldHVybnt4OnRoaXMueCx5OnRoaXMueSx6OnRoaXMueix0OnRoaXMudH19fWEucmVnaXN0ZXJUeXBlKCJWZWM0IixuKTtjbGFzcyBoIGV4dGVuZHMgc3tjb25zdHJ1Y3Rvcih0PTAsZT0wLHM9MCxhPTI1NSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl0aGlzLl9fZGF0YT10O2Vsc2UgaWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBVaW50OEFycmF5KHMsYSw0KX1lbHNlIHRoaXMuX19kYXRhPW5ldyBVaW50OEFycmF5KDQpLCJzdHJpbmciPT10eXBlb2YgdD90LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tQ1NTQ29sb3JOYW1lKHQpOih0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hKX1nZXQgcigpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgcih0KXt0aGlzLl9fZGF0YVswXT10fWdldCBnKCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCBnKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IGIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IGIodCl7dGhpcy5fX2RhdGFbMl09dH1nZXQgYSgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgYSh0KXt0aGlzLl9fZGF0YVszXT10fXNldCh0LGUscyxhPTI1NSl7dGhpcy5yPXQsdGhpcy5nPWUsdGhpcy5iPXMsdGhpcy5hPWF9c2V0RnJvbU90aGVyKHQpe3RoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXMuYT10LmF9c2V0RnJvbUFycmF5KHQpe3RoaXMucj10WzBdLHRoaXMuZz10WzFdLHRoaXMuYj10WzJdLHRoaXMuYT00PT10Lmxlbmd0aD90WzNdOjF9c2V0RnJvbUhleCh0KXtjb25zdCBlPWZ1bmN0aW9uKHQpe2NvbnN0IGU9L14jPyhbYS1mXGRdezJ9KShbYS1mXGRdezJ9KShbYS1mXGRdezJ9KSQvaS5leGVjKHQpO3JldHVybiBlP3tyOnBhcnNlSW50KGVbMV0sMTYpLGc6cGFyc2VJbnQoZVsyXSwxNiksYjpwYXJzZUludChlWzNdLDE2KX06bnVsbH0odCk7ZT90aGlzLnNldChlLnIsZS5nLGUuYik6Y29uc29sZS53YXJuKCJJbnZhbGlkIGhleCBjb2RlOiIrdCl9c2V0RnJvbUNTU0NvbG9yTmFtZSh0KXt0LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tSGV4KCh0PT57Y29uc3QgZT17YWxpY2VibHVlOiIjZjBmOGZmIixhbnRpcXVld2hpdGU6IiNmYWViZDciLGFxdWE6IiMwMGZmZmYiLGFxdWFtYXJpbmU6IiM3ZmZmZDQiLGF6dXJlOiIjZjBmZmZmIixiZWlnZToiI2Y1ZjVkYyIsYmlzcXVlOiIjZmZlNGM0IixibGFjazoiIzAwMDAwMCIsYmxhbmNoZWRhbG1vbmQ6IiNmZmViY2QiLGJsdWU6IiMwMDAwZmYiLGJsdWV2aW9sZXQ6IiM4YTJiZTIiLGJyb3duOiIjYTUyYTJhIixidXJseXdvb2Q6IiNkZWI4ODciLGNhZGV0Ymx1ZToiIzVmOWVhMCIsY2hhcnRyZXVzZToiIzdmZmYwMCIsY2hvY29sYXRlOiIjZDI2OTFlIixjb3JhbDoiI2ZmN2Y1MCIsY29ybmZsb3dlcmJsdWU6IiM2NDk1ZWQiLGNvcm5zaWxrOiIjZmZmOGRjIixjcmltc29uOiIjZGMxNDNjIixjeWFuOiIjMDBmZmZmIixkYXJrYmx1ZToiIzAwMDA4YiIsZGFya2N5YW46IiMwMDhiOGIiLGRhcmtnb2xkZW5yb2Q6IiNiODg2MGIiLGRhcmtncmF5OiIjYTlhOWE5IixkYXJrZ3JlZW46IiMwMDY0MDAiLGRhcmtraGFraToiI2JkYjc2YiIsZGFya21hZ2VudGE6IiM4YjAwOGIiLGRhcmtvbGl2ZWdyZWVuOiIjNTU2YjJmIixkYXJrb3JhbmdlOiIjZmY4YzAwIixkYXJrb3JjaGlkOiIjOTkzMmNjIixkYXJrcmVkOiIjOGIwMDAwIixkYXJrc2FsbW9uOiIjZTk5NjdhIixkYXJrc2VhZ3JlZW46IiM4ZmJjOGYiLGRhcmtzbGF0ZWJsdWU6IiM0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IiMyZjRmNGYiLGRhcmt0dXJxdW9pc2U6IiMwMGNlZDEiLGRhcmt2aW9sZXQ6IiM5NDAwZDMiLGRlZXBwaW5rOiIjZmYxNDkzIixkZWVwc2t5Ymx1ZToiIzAwYmZmZiIsZGltZ3JheToiIzY5Njk2OSIsZG9kZ2VyYmx1ZToiIzFlOTBmZiIsZmlyZWJyaWNrOiIjYjIyMjIyIixmbG9yYWx3aGl0ZToiI2ZmZmFmMCIsZm9yZXN0Z3JlZW46IiMyMjhiMjIiLGZ1Y2hzaWE6IiNmZjAwZmYiLGdhaW5zYm9ybzoiI2RjZGNkYyIsZ2hvc3R3aGl0ZToiI2Y4ZjhmZiIsZ29sZDoiI2ZmZDcwMCIsZ29sZGVucm9kOiIjZGFhNTIwIixncmF5OiIjODA4MDgwIixncmVlbjoiIzAwODAwMCIsZ3JlZW55ZWxsb3c6IiNhZGZmMmYiLGhvbmV5ZGV3OiIjZjBmZmYwIixob3RwaW5rOiIjZmY2OWI0IiwiaW5kaWFucmVkICI6IiNjZDVjNWMiLGluZGlnbzoiIzRiMDA4MiIsaXZvcnk6IiNmZmZmZjAiLGtoYWtpOiIjZjBlNjhjIixsYXZlbmRlcjoiI2U2ZTZmYSIsbGF2ZW5kZXJibHVzaDoiI2ZmZjBmNSIsbGF3bmdyZWVuOiIjN2NmYzAwIixsZW1vbmNoaWZmb246IiNmZmZhY2QiLGxpZ2h0Ymx1ZToiI2FkZDhlNiIsbGlnaHRjb3JhbDoiI2YwODA4MCIsbGlnaHRjeWFuOiIjZTBmZmZmIixsaWdodGdvbGRlbnJvZHllbGxvdzoiI2ZhZmFkMiIsbGlnaHRncmV5OiIjZDNkM2QzIixsaWdodGdyZWVuOiIjOTBlZTkwIixsaWdodHBpbms6IiNmZmI2YzEiLGxpZ2h0c2FsbW9uOiIjZmZhMDdhIixsaWdodHNlYWdyZWVuOiIjMjBiMmFhIixsaWdodHNreWJsdWU6IiM4N2NlZmEiLGxpZ2h0c2xhdGVncmF5OiIjNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiI2IwYzRkZSIsbGlnaHR5ZWxsb3c6IiNmZmZmZTAiLGxpbWU6IiMwMGZmMDAiLGxpbWVncmVlbjoiIzMyY2QzMiIsbGluZW46IiNmYWYwZTYiLG1hZ2VudGE6IiNmZjAwZmYiLG1hcm9vbjoiIzgwMDAwMCIsbWVkaXVtYXF1YW1hcmluZToiIzY2Y2RhYSIsbWVkaXVtYmx1ZToiIzAwMDBjZCIsbWVkaXVtb3JjaGlkOiIjYmE1NWQzIixtZWRpdW1wdXJwbGU6IiM5MzcwZDgiLG1lZGl1bXNlYWdyZWVuOiIjM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IiM3YjY4ZWUiLG1lZGl1bXNwcmluZ2dyZWVuOiIjMDBmYTlhIixtZWRpdW10dXJxdW9pc2U6IiM0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiI2M3MTU4NSIsbWlkbmlnaHRibHVlOiIjMTkxOTcwIixtaW50Y3JlYW06IiNmNWZmZmEiLG1pc3R5cm9zZToiI2ZmZTRlMSIsbW9jY2FzaW46IiNmZmU0YjUiLG5hdmFqb3doaXRlOiIjZmZkZWFkIixuYXZ5OiIjMDAwMDgwIixvbGRsYWNlOiIjZmRmNWU2IixvbGl2ZToiIzgwODAwMCIsb2xpdmVkcmFiOiIjNmI4ZTIzIixvcmFuZ2U6IiNmZmE1MDAiLG9yYW5nZXJlZDoiI2ZmNDUwMCIsb3JjaGlkOiIjZGE3MGQ2IixwYWxlZ29sZGVucm9kOiIjZWVlOGFhIixwYWxlZ3JlZW46IiM5OGZiOTgiLHBhbGV0dXJxdW9pc2U6IiNhZmVlZWUiLHBhbGV2aW9sZXRyZWQ6IiNkODcwOTMiLHBhcGF5YXdoaXA6IiNmZmVmZDUiLHBlYWNocHVmZjoiI2ZmZGFiOSIscGVydToiI2NkODUzZiIscGluazoiI2ZmYzBjYiIscGx1bToiI2RkYTBkZCIscG93ZGVyYmx1ZToiI2IwZTBlNiIscHVycGxlOiIjODAwMDgwIixyZWJlY2NhcHVycGxlOiIjNjYzMzk5IixyZWQ6IiNmZjAwMDAiLHJvc3licm93bjoiI2JjOGY4ZiIscm95YWxibHVlOiIjNDE2OWUxIixzYWRkbGVicm93bjoiIzhiNDUxMyIsc2FsbW9uOiIjZmE4MDcyIixzYW5keWJyb3duOiIjZjRhNDYwIixzZWFncmVlbjoiIzJlOGI1NyIsc2Vhc2hlbGw6IiNmZmY1ZWUiLHNpZW5uYToiI2EwNTIyZCIsc2lsdmVyOiIjYzBjMGMwIixza3libHVlOiIjODdjZWViIixzbGF0ZWJsdWU6IiM2YTVhY2QiLHNsYXRlZ3JheToiIzcwODA5MCIsc25vdzoiI2ZmZmFmYSIsc3ByaW5nZ3JlZW46IiMwMGZmN2YiLHN0ZWVsYmx1ZToiIzQ2ODJiNCIsdGFuOiIjZDJiNDhjIix0ZWFsOiIjMDA4MDgwIix0aGlzdGxlOiIjZDhiZmQ4Iix0b21hdG86IiNmZjYzNDciLHR1cnF1b2lzZToiIzQwZTBkMCIsdmlvbGV0OiIjZWU4MmVlIix3aGVhdDoiI2Y1ZGViMyIsd2hpdGU6IiNmZmZmZmYiLHdoaXRlc21va2U6IiNmNWY1ZjUiLHllbGxvdzoiI2ZmZmYwMCIseWVsbG93Z3JlZW46IiM5YWNkMzIifTtyZXR1cm4gdm9pZCAwIT09ZVt0LnRvTG93ZXJDYXNlKCldJiZlW3QudG9Mb3dlckNhc2UoKV19KSh0KSl9dG9IZXgoKXtmdW5jdGlvbiB0KHQpe2NvbnN0IGU9dC50b1N0cmluZygxNik7cmV0dXJuIDE9PWUubGVuZ3RoPyIwIitlOmV9cmV0dXJuIiMiK3QodGhpcy5yKSt0KHRoaXMuZykrdCh0aGlzLmIpfWVxdWFsKHQpe3JldHVybiB0aGlzLnI9PXQuciYmdGhpcy5nPT10LmcmJnRoaXMuYj09dC5iJiZ0aGlzLmE9PXQuYX1ub3RlcXVhbHModCl7cmV0dXJuIHRoaXMuciE9dC5yJiZ0aGlzLmchPXQuZyYmdGhpcy5iIT10LmImJnRoaXMuYSE9dC5hfWFwcHJveEVxdWFsKHQsZT1OdW1iZXIuRVBTSUxPTil7cmV0dXJuIE1hdGguYWJzKHRoaXMuci10LnIpPGUmJk1hdGguYWJzKHRoaXMuZy10LmcpPGUmJk1hdGguYWJzKHRoaXMuYi10LmIpPGUmJk1hdGguYWJzKHRoaXMuYS10LmEpPGV9YWRkKHQpe3JldHVybiBuZXcgaCh0aGlzLnIrdC5yLHRoaXMuZyt0LmcsdGhpcy5iK3QuYix0aGlzLmErdC5hKX1zdWJ0cmFjdCh0KXtyZXR1cm4gbmV3IGgodGhpcy5yLXQucix0aGlzLmctdC5nLHRoaXMuYi10LmIsdGhpcy5hLXQuYSl9c2NhbGUodCl7cmV0dXJuIG5ldyBoKHRoaXMucip0LHRoaXMuZyp0LHRoaXMuYip0LHRoaXMuYSp0KX1zY2FsZUluUGxhY2UodCl7dGhpcy5yKj10LHRoaXMuZyo9dCx0aGlzLmIqPXQsdGhpcy5hKj10fWFwcGx5R2FtbWEodCl7dGhpcy5zZXQoTWF0aC5wb3codGhpcy5yLHQpLE1hdGgucG93KHRoaXMuZyx0KSxNYXRoLnBvdyh0aGlzLmIsdCksdGhpcy5hKX10b0xpbmVhcih0PTIuMil7cmV0dXJuIG5ldyBoKE1hdGgucG93KHRoaXMucix0KSxNYXRoLnBvdyh0aGlzLmcsdCksTWF0aC5wb3codGhpcy5iLHQpLHRoaXMuYSl9dG9HYW1tYSh0PTIuMil7cmV0dXJuIG5ldyBoKE1hdGgucG93KHRoaXMuciwxL3QpLE1hdGgucG93KHRoaXMuZywxL3QpLE1hdGgucG93KHRoaXMuYiwxL3QpLHRoaXMuYSl9bHVtaW5hbmNlKCl7cmV0dXJuLjIxMjYqdGhpcy5yKy43MTUyKnRoaXMuZysuMDcyMip0aGlzLmJ9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy5yLGE9dGhpcy5nLGk9dGhpcy5iLHI9dGhpcy5hO3JldHVybiBuZXcgaChzK2UqKHQuci1zKSxhK2UqKHQuZy1hKSxpK2UqKHQuYi1pKSxyK2UqKHQuYS1yKSl9c3RhdGljIHJhbmRvbSh0PTAsZT0hMSl7cmV0dXJuIHQ+MD9uZXcgaCh0K01hdGgucmFuZG9tKCkqKDEtdCksdCtNYXRoLnJhbmRvbSgpKigxLXQpLHQrTWF0aC5yYW5kb20oKSooMS10KSxlP3QrTWF0aC5yYW5kb20oKSooMS10KToxKTp0PDA/bmV3IGgoTWF0aC5yYW5kb20oKSooMSt0KSxNYXRoLnJhbmRvbSgpKigxK3QpLE1hdGgucmFuZG9tKCkqKDErdCksZT9NYXRoLnJhbmRvbSgpKigxK3QpOjEpOm5ldyBoKE1hdGgucmFuZG9tKCksTWF0aC5yYW5kb20oKSxNYXRoLnJhbmRvbSgpLGU/TWF0aC5yYW5kb20oKToxKX1jbG9uZSgpe3JldHVybiBuZXcgaCh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXSx0aGlzLl9fZGF0YVszXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1hczNDb21wb25lbnRBcnJheSgpe3JldHVyblt0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXV19c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IGgoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IGgodCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fXRvSlNPTigpe3JldHVybntyOnRoaXMucixnOnRoaXMuZyxiOnRoaXMuYixhOnRoaXMuYX19ZnJvbUpTT04odCl7dGhpcy5yPXQucix0aGlzLmc9dC5nLHRoaXMuYj10LmIsdGhpcy5hPXQuYX10b0NTU1N0cmluZygpe3JldHVybiJyZ2JhKCIrTWF0aC5yb3VuZCgyNTUqdGhpcy5yKSsiLCAiK01hdGgucm91bmQoMjU1KnRoaXMuZykrIiwgIitNYXRoLnJvdW5kKDI1NSp0aGlzLmIpKyIsICIrdGhpcy5hKyIpIn19YS5yZWdpc3RlclR5cGUoIlJHQkEiLGgpO2NsYXNzIG8gZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSB0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDQpLCJzdHJpbmciPT10eXBlb2YgdD90LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tQ1NTQ29sb3JOYW1lKHQpOih0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hKX1nZXQgcigpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgcih0KXt0aGlzLl9fZGF0YVswXT10fWdldCBnKCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCBnKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IGIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IGIodCl7dGhpcy5fX2RhdGFbMl09dH1nZXQgYSgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgYSh0KXt0aGlzLl9fZGF0YVszXT10fXNldCh0LGUscyxhPTEpe3RoaXMucj10LHRoaXMuZz1lLHRoaXMuYj1zLHRoaXMuYT1hfXNldEZyb21PdGhlcih0KXt0aGlzLnI9dC5yLHRoaXMuZz10LmcsdGhpcy5iPXQuYix0aGlzLmE9dC5hfXNldEZyb21TY2FsYXJBcnJheSh0KXt0aGlzLnI9dFswXSx0aGlzLmc9dFsxXSx0aGlzLmI9dFsyXSx0aGlzLmE9ND09dC5sZW5ndGg/dFszXToxfWdldEFzUkdCQXJyYXkoKXtyZXR1cm5bMjU1KnRoaXMuciwyNTUqdGhpcy5nLDI1NSp0aGlzLmJdfWdldEFzUkdCRGljdCgpe3JldHVybntyOjI1NSp0aGlzLnIsZzoyNTUqdGhpcy5nLGI6MjU1KnRoaXMuYn19c2V0RnJvbVJHQih0LGUscyxhKXt0aGlzLnI9dC8yNTUsdGhpcy5nPWUvMjU1LHRoaXMuYj1zLzI1NSx0aGlzLmE9YT9hLzI1NToxfXNldEZyb21SR0JBcnJheSh0KXt0aGlzLnI9dFswXS8yNTUsdGhpcy5nPXRbMV0vMjU1LHRoaXMuYj10WzJdLzI1NSx0aGlzLmE9ND09dC5sZW5ndGg/dFszXS8yNTU6MX1zZXRGcm9tUkdCRGljdCh0KXt0aGlzLnI9dC5yLzI1NSx0aGlzLmc9dC5nLzI1NSx0aGlzLmI9dC5iLzI1NSx0aGlzLmE9ND09dC5hP3QuYS8yNTU6MX1zZXRGcm9tSGV4KHQpe2NvbnN0IGU9ZnVuY3Rpb24odCl7Y29uc3QgZT0vXiM/KFthLWZcZF17Mn0pKFthLWZcZF17Mn0pKFthLWZcZF17Mn0pJC9pLmV4ZWModCk7cmV0dXJuIGU/e3I6cGFyc2VJbnQoZVsxXSwxNiksZzpwYXJzZUludChlWzJdLDE2KSxiOnBhcnNlSW50KGVbM10sMTYpfTpudWxsfSh0KTtlP3RoaXMuc2V0RnJvbVJHQihlLnIsZS5nLGUuYik6Y29uc29sZS53YXJuKCJJbnZhbGlkIGhleCBjb2RlOiIrdCl9c2V0RnJvbUNTU0NvbG9yTmFtZSh0KXt0LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tSGV4KCh0PT57Y29uc3QgZT17YWxpY2VibHVlOiIjZjBmOGZmIixhbnRpcXVld2hpdGU6IiNmYWViZDciLGFxdWE6IiMwMGZmZmYiLGFxdWFtYXJpbmU6IiM3ZmZmZDQiLGF6dXJlOiIjZjBmZmZmIixiZWlnZToiI2Y1ZjVkYyIsYmlzcXVlOiIjZmZlNGM0IixibGFjazoiIzAwMDAwMCIsYmxhbmNoZWRhbG1vbmQ6IiNmZmViY2QiLGJsdWU6IiMwMDAwZmYiLGJsdWV2aW9sZXQ6IiM4YTJiZTIiLGJyb3duOiIjYTUyYTJhIixidXJseXdvb2Q6IiNkZWI4ODciLGNhZGV0Ymx1ZToiIzVmOWVhMCIsY2hhcnRyZXVzZToiIzdmZmYwMCIsY2hvY29sYXRlOiIjZDI2OTFlIixjb3JhbDoiI2ZmN2Y1MCIsY29ybmZsb3dlcmJsdWU6IiM2NDk1ZWQiLGNvcm5zaWxrOiIjZmZmOGRjIixjcmltc29uOiIjZGMxNDNjIixjeWFuOiIjMDBmZmZmIixkYXJrYmx1ZToiIzAwMDA4YiIsZGFya2N5YW46IiMwMDhiOGIiLGRhcmtnb2xkZW5yb2Q6IiNiODg2MGIiLGRhcmtncmF5OiIjYTlhOWE5IixkYXJrZ3JlZW46IiMwMDY0MDAiLGRhcmtraGFraToiI2JkYjc2YiIsZGFya21hZ2VudGE6IiM4YjAwOGIiLGRhcmtvbGl2ZWdyZWVuOiIjNTU2YjJmIixkYXJrb3JhbmdlOiIjZmY4YzAwIixkYXJrb3JjaGlkOiIjOTkzMmNjIixkYXJrcmVkOiIjOGIwMDAwIixkYXJrc2FsbW9uOiIjZTk5NjdhIixkYXJrc2VhZ3JlZW46IiM4ZmJjOGYiLGRhcmtzbGF0ZWJsdWU6IiM0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IiMyZjRmNGYiLGRhcmt0dXJxdW9pc2U6IiMwMGNlZDEiLGRhcmt2aW9sZXQ6IiM5NDAwZDMiLGRlZXBwaW5rOiIjZmYxNDkzIixkZWVwc2t5Ymx1ZToiIzAwYmZmZiIsZGltZ3JheToiIzY5Njk2OSIsZG9kZ2VyYmx1ZToiIzFlOTBmZiIsZmlyZWJyaWNrOiIjYjIyMjIyIixmbG9yYWx3aGl0ZToiI2ZmZmFmMCIsZm9yZXN0Z3JlZW46IiMyMjhiMjIiLGZ1Y2hzaWE6IiNmZjAwZmYiLGdhaW5zYm9ybzoiI2RjZGNkYyIsZ2hvc3R3aGl0ZToiI2Y4ZjhmZiIsZ29sZDoiI2ZmZDcwMCIsZ29sZGVucm9kOiIjZGFhNTIwIixncmF5OiIjODA4MDgwIixncmVlbjoiIzAwODAwMCIsZ3JlZW55ZWxsb3c6IiNhZGZmMmYiLGhvbmV5ZGV3OiIjZjBmZmYwIixob3RwaW5rOiIjZmY2OWI0IiwiaW5kaWFucmVkICI6IiNjZDVjNWMiLGluZGlnbzoiIzRiMDA4MiIsaXZvcnk6IiNmZmZmZjAiLGtoYWtpOiIjZjBlNjhjIixsYXZlbmRlcjoiI2U2ZTZmYSIsbGF2ZW5kZXJibHVzaDoiI2ZmZjBmNSIsbGF3bmdyZWVuOiIjN2NmYzAwIixsZW1vbmNoaWZmb246IiNmZmZhY2QiLGxpZ2h0Ymx1ZToiI2FkZDhlNiIsbGlnaHRjb3JhbDoiI2YwODA4MCIsbGlnaHRjeWFuOiIjZTBmZmZmIixsaWdodGdvbGRlbnJvZHllbGxvdzoiI2ZhZmFkMiIsbGlnaHRncmV5OiIjZDNkM2QzIixsaWdodGdyZWVuOiIjOTBlZTkwIixsaWdodHBpbms6IiNmZmI2YzEiLGxpZ2h0c2FsbW9uOiIjZmZhMDdhIixsaWdodHNlYWdyZWVuOiIjMjBiMmFhIixsaWdodHNreWJsdWU6IiM4N2NlZmEiLGxpZ2h0c2xhdGVncmF5OiIjNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiI2IwYzRkZSIsbGlnaHR5ZWxsb3c6IiNmZmZmZTAiLGxpbWU6IiMwMGZmMDAiLGxpbWVncmVlbjoiIzMyY2QzMiIsbGluZW46IiNmYWYwZTYiLG1hZ2VudGE6IiNmZjAwZmYiLG1hcm9vbjoiIzgwMDAwMCIsbWVkaXVtYXF1YW1hcmluZToiIzY2Y2RhYSIsbWVkaXVtYmx1ZToiIzAwMDBjZCIsbWVkaXVtb3JjaGlkOiIjYmE1NWQzIixtZWRpdW1wdXJwbGU6IiM5MzcwZDgiLG1lZGl1bXNlYWdyZWVuOiIjM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IiM3YjY4ZWUiLG1lZGl1bXNwcmluZ2dyZWVuOiIjMDBmYTlhIixtZWRpdW10dXJxdW9pc2U6IiM0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiI2M3MTU4NSIsbWlkbmlnaHRibHVlOiIjMTkxOTcwIixtaW50Y3JlYW06IiNmNWZmZmEiLG1pc3R5cm9zZToiI2ZmZTRlMSIsbW9jY2FzaW46IiNmZmU0YjUiLG5hdmFqb3doaXRlOiIjZmZkZWFkIixuYXZ5OiIjMDAwMDgwIixvbGRsYWNlOiIjZmRmNWU2IixvbGl2ZToiIzgwODAwMCIsb2xpdmVkcmFiOiIjNmI4ZTIzIixvcmFuZ2U6IiNmZmE1MDAiLG9yYW5nZXJlZDoiI2ZmNDUwMCIsb3JjaGlkOiIjZGE3MGQ2IixwYWxlZ29sZGVucm9kOiIjZWVlOGFhIixwYWxlZ3JlZW46IiM5OGZiOTgiLHBhbGV0dXJxdW9pc2U6IiNhZmVlZWUiLHBhbGV2aW9sZXRyZWQ6IiNkODcwOTMiLHBhcGF5YXdoaXA6IiNmZmVmZDUiLHBlYWNocHVmZjoiI2ZmZGFiOSIscGVydToiI2NkODUzZiIscGluazoiI2ZmYzBjYiIscGx1bToiI2RkYTBkZCIscG93ZGVyYmx1ZToiI2IwZTBlNiIscHVycGxlOiIjODAwMDgwIixyZWJlY2NhcHVycGxlOiIjNjYzMzk5IixyZWQ6IiNmZjAwMDAiLHJvc3licm93bjoiI2JjOGY4ZiIscm95YWxibHVlOiIjNDE2OWUxIixzYWRkbGVicm93bjoiIzhiNDUxMyIsc2FsbW9uOiIjZmE4MDcyIixzYW5keWJyb3duOiIjZjRhNDYwIixzZWFncmVlbjoiIzJlOGI1NyIsc2Vhc2hlbGw6IiNmZmY1ZWUiLHNpZW5uYToiI2EwNTIyZCIsc2lsdmVyOiIjYzBjMGMwIixza3libHVlOiIjODdjZWViIixzbGF0ZWJsdWU6IiM2YTVhY2QiLHNsYXRlZ3JheToiIzcwODA5MCIsc25vdzoiI2ZmZmFmYSIsc3ByaW5nZ3JlZW46IiMwMGZmN2YiLHN0ZWVsYmx1ZToiIzQ2ODJiNCIsdGFuOiIjZDJiNDhjIix0ZWFsOiIjMDA4MDgwIix0aGlzdGxlOiIjZDhiZmQ4Iix0b21hdG86IiNmZjYzNDciLHR1cnF1b2lzZToiIzQwZTBkMCIsdmlvbGV0OiIjZWU4MmVlIix3aGVhdDoiI2Y1ZGViMyIsd2hpdGU6IiNmZmZmZmYiLHdoaXRlc21va2U6IiNmNWY1ZjUiLHllbGxvdzoiI2ZmZmYwMCIseWVsbG93Z3JlZW46IiM5YWNkMzIifTtyZXR1cm4gdm9pZCAwIT09ZVt0LnRvTG93ZXJDYXNlKCldJiZlW3QudG9Mb3dlckNhc2UoKV19KSh0KSl9dG9IZXgoKXtmdW5jdGlvbiB0KHQpe2NvbnN0IGU9TWF0aC5yb3VuZCgyNTUqdCkudG9TdHJpbmcoMTYpO3JldHVybiAxPT1lLmxlbmd0aD8iMCIrZTplfXJldHVybiIjIit0KHRoaXMucikrdCh0aGlzLmcpK3QodGhpcy5iKX1lcXVhbCh0KXtyZXR1cm4gdGhpcy5yPT10LnImJnRoaXMuZz09dC5nJiZ0aGlzLmI9PXQuYiYmdGhpcy5hPT10LmF9bm90ZXF1YWxzKHQpe3JldHVybiB0aGlzLnIhPXQuciYmdGhpcy5nIT10LmcmJnRoaXMuYiE9dC5iJiZ0aGlzLmEhPXQuYX1hcHByb3hFcXVhbCh0LGU9TnVtYmVyLkVQU0lMT04pe3JldHVybiBNYXRoLmFicyh0aGlzLnItdC5yKTxlJiZNYXRoLmFicyh0aGlzLmctdC5nKTxlJiZNYXRoLmFicyh0aGlzLmItdC5iKTxlJiZNYXRoLmFicyh0aGlzLmEtdC5hKTxlfWFkZCh0KXtyZXR1cm4gbmV3IG8odGhpcy5yK3Qucix0aGlzLmcrdC5nLHRoaXMuYit0LmIsdGhpcy5hK3QuYSl9c3VidHJhY3QodCl7cmV0dXJuIG5ldyBvKHRoaXMuci10LnIsdGhpcy5nLXQuZyx0aGlzLmItdC5iLHRoaXMuYS10LmEpfXNjYWxlKHQpe3JldHVybiBuZXcgbyh0aGlzLnIqdCx0aGlzLmcqdCx0aGlzLmIqdCx0aGlzLmEqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMucio9dCx0aGlzLmcqPXQsdGhpcy5iKj10LHRoaXMuYSo9dH1hcHBseUdhbW1hKHQpe3RoaXMuc2V0KE1hdGgucG93KHRoaXMucix0KSxNYXRoLnBvdyh0aGlzLmcsdCksTWF0aC5wb3codGhpcy5iLHQpLHRoaXMuYSl9dG9MaW5lYXIodD0yLjIpe3JldHVybiBuZXcgbyhNYXRoLnBvdyh0aGlzLnIsdCksTWF0aC5wb3codGhpcy5nLHQpLE1hdGgucG93KHRoaXMuYix0KSx0aGlzLmEpfXRvR2FtbWEodD0yLjIpe3JldHVybiBuZXcgbyhNYXRoLnBvdyh0aGlzLnIsMS90KSxNYXRoLnBvdyh0aGlzLmcsMS90KSxNYXRoLnBvdyh0aGlzLmIsMS90KSx0aGlzLmEpfWx1bWluYW5jZSgpe3JldHVybi4yMTI2KnRoaXMucisuNzE1Mip0aGlzLmcrLjA3MjIqdGhpcy5ifWxlcnAodCxlKXtjb25zdCBzPXRoaXMucixhPXRoaXMuZyxpPXRoaXMuYixyPXRoaXMuYTtyZXR1cm4gbmV3IG8ocytlKih0LnItcyksYStlKih0LmctYSksaStlKih0LmItaSkscitlKih0LmEtcikpfXN0YXRpYyByYW5kb20odD0wLGU9ITEpe3JldHVybiB0PjA/bmV3IG8odCtNYXRoLnJhbmRvbSgpKigxLXQpLHQrTWF0aC5yYW5kb20oKSooMS10KSx0K01hdGgucmFuZG9tKCkqKDEtdCksZT90K01hdGgucmFuZG9tKCkqKDEtdCk6MSk6dDwwP25ldyBvKE1hdGgucmFuZG9tKCkqKDErdCksTWF0aC5yYW5kb20oKSooMSt0KSxNYXRoLnJhbmRvbSgpKigxK3QpLGU/TWF0aC5yYW5kb20oKSooMSt0KToxKTpuZXcgbyhNYXRoLnJhbmRvbSgpLE1hdGgucmFuZG9tKCksTWF0aC5yYW5kb20oKSxlP01hdGgucmFuZG9tKCk6MSl9Y2xvbmUoKXtyZXR1cm4gbmV3IG8odGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbM10pfWFzQXJyYXkoKXtyZXR1cm4gdGhpcy5fX2RhdGF9YXMzQ29tcG9uZW50QXJyYXkoKXtyZXR1cm5bdGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl1dfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBvKC4uLnQpfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyBvKHQsNCplKX1zdGF0aWMgbnVtRWxlbWVudHMoKXtyZXR1cm4gNH10b0pTT04oKXtyZXR1cm57cjp0aGlzLnIsZzp0aGlzLmcsYjp0aGlzLmIsYTp0aGlzLmF9fWZyb21KU09OKHQpe3RoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXMuYT10LmF9dG9DU1NTdHJpbmcoKXtyZXR1cm4icmdiYSgiK01hdGgucm91bmQoMjU1KnRoaXMucikrIiwgIitNYXRoLnJvdW5kKDI1NSp0aGlzLmcpKyIsICIrTWF0aC5yb3VuZCgyNTUqdGhpcy5iKSsiLCAiK3RoaXMuYSsiKSJ9fWEucmVnaXN0ZXJUeXBlKCJDb2xvciIsbyk7Y2xhc3MgXyBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCxzPTAsYT0wKXtpZihzdXBlcigpLGlzTmFOKGEpKXN3aXRjaChhKXtjYXNlIlhZWiI6dGhpcy5vcmRlcj0wO2JyZWFrO2Nhc2UiWVpYIjp0aGlzLm9yZGVyPTE7YnJlYWs7Y2FzZSJaWFkiOnRoaXMub3JkZXI9MjticmVhaztjYXNlIlhaWSI6dGhpcy5vcmRlcj0zO2JyZWFrO2Nhc2UiWllYIjp0aGlzLm9yZGVyPTQ7YnJlYWs7Y2FzZSJZWFoiOnRoaXMub3JkZXI9NTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBFdWxlciBBbmdsZXMgT3JkZXI6IithKX1lbHNlIHRoaXMub3JkZXI9YTtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSB0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDMpLHRoaXMuX19kYXRhWzBdPXQsdGhpcy5fX2RhdGFbMV09ZSx0aGlzLl9fZGF0YVsyXT1zfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fXNldCh0LGUscyl7dGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXN9fWEucmVnaXN0ZXJUeXBlKCJFdWxlckFuZ2xlcyIsXyk7Y2xhc3MgZCBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0xLGU9MCxzPTAsYT0wLGk9MSxyPTAsbj0wLGg9MCxvPTEpe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkocyxhLDkpfWVsc2UgdGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSg5KSx0aGlzLnNldCh0LGUscyxhLGkscixuLGgsbyl9Z2V0IG0wMCgpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgbTAwKHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IG0wMSgpe3JldHVybiB0aGlzLl9fZGF0YVsxXX1zZXQgbTAxKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IG0wMigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgbTAyKHQpe3RoaXMuX19kYXRhWzJdPXR9Z2V0IG0xMCgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgbTEwKHQpe3RoaXMuX19kYXRhWzNdPXR9Z2V0IG0xMSgpe3JldHVybiB0aGlzLl9fZGF0YVs0XX1zZXQgbTExKHQpe3RoaXMuX19kYXRhWzRdPXR9Z2V0IG0xMigpe3JldHVybiB0aGlzLl9fZGF0YVs1XX1zZXQgbTEyKHQpe3RoaXMuX19kYXRhWzVdPXR9Z2V0IG0yMCgpe3JldHVybiB0aGlzLl9fZGF0YVs2XX1zZXQgbTIwKHQpe3RoaXMuX19kYXRhWzZdPXR9Z2V0IG0yMSgpe3JldHVybiB0aGlzLl9fZGF0YVs3XX1zZXQgbTIxKHQpe3RoaXMuX19kYXRhWzddPXR9Z2V0IG0yMigpe3JldHVybiB0aGlzLl9fZGF0YVs4XX1zZXQgbTIyKHQpe3RoaXMuX19kYXRhWzhdPXR9Z2V0IHhBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDApfXNldCB4QXhpcyh0KXt0aGlzLnhBeGlzLnNldCh0LngsdC55LHQueil9Z2V0IHlBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDMpfXNldCB5QXhpcyh0KXt0aGlzLnlBeGlzLnNldCh0LngsdC55LHQueil9Z2V0IHpBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDYpfXNldCB6QXhpcyh0KXt0aGlzLnpBeGlzLnNldCh0LngsdC55LHQueil9c2V0KHQ9MSxlPTAscz0wLGE9MCxpPTEscj0wLG49MCxoPTAsbz0xKXt0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hLHRoaXMuX19kYXRhWzRdPWksdGhpcy5fX2RhdGFbNV09cix0aGlzLl9fZGF0YVs2XT1uLHRoaXMuX19kYXRhWzddPWgsdGhpcy5fX2RhdGFbOF09b31zZXRJZGVudGl0eSgpe3RoaXMuc2V0KCl9c2V0RnJvbU1hdCh0KXt0aGlzLl9fZGF0YVswXT10Lm0wMCx0aGlzLl9fZGF0YVsxXT10Lm0wMSx0aGlzLl9fZGF0YVsyXT10Lm0wMix0aGlzLl9fZGF0YVszXT10Lm0xMCx0aGlzLl9fZGF0YVs0XT10Lm0xMSx0aGlzLl9fZGF0YVs1XT10Lm0xMix0aGlzLl9fZGF0YVs2XT10Lm0yMCx0aGlzLl9fZGF0YVs3XT10Lm0yMSx0aGlzLl9fZGF0YVs4XT10Lm0yMn1zZXRGcm9tRGlyZWN0aW9uQW5kVXB2ZWN0b3IodCxlKXtjb25zdCBzPXQsYT1zLmxlbmd0aCgpO2lmKGE8TnVtYmVyLkVQU0lMT04pcmV0dXJuIHZvaWQgdGhpcy5zZXRJZGVudGl0eSgpO3Muc2NhbGVJblBsYWNlKDEvYSk7Y29uc3QgaT1lLmNyb3NzKHMpLHI9aS5sZW5ndGgoKTtyPk51bWJlci5FUFNJTE9OJiZpLnNjYWxlSW5QbGFjZSgxL3IpO2NvbnN0IG49cy5jcm9zcyhpKSxoPW4ubGVuZ3RoKCk7aD5OdW1iZXIuRVBTSUxPTiYmbi5zY2FsZUluUGxhY2UoMS9oKSx0aGlzLnNldChpLngsaS55LGkueixuLngsbi55LG4ueixzLngscy55LHMueil9aW52ZXJzZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM10saT10aGlzLl9fZGF0YVs0XSxyPXRoaXMuX19kYXRhWzVdLG49dGhpcy5fX2RhdGFbNl0saD10aGlzLl9fZGF0YVs3XSxvPXRoaXMuX19kYXRhWzhdLF89byppLXIqaCxsPS1vKmErcipuLGM9aCphLWkqbix1PXQqXytlKmwrcypjO3JldHVybiB1Pyh1PTEvdSxuZXcgZChfKnUsKC1vKmUrcypoKSp1LChyKmUtcyppKSp1LGwqdSwobyp0LXMqbikqdSwoLXIqdCtzKmEpKnUsYyp1LCgtaCp0K2UqbikqdSwoaSp0LWUqYSkqdSkpOihjb25zb2xlLndhcm4oIlVuYWJsZSB0byBpbnZlcnQgTWF0MyIpLG51bGwpfWludmVydEluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdLGk9dGhpcy5fX2RhdGFbNF0scj10aGlzLl9fZGF0YVs1XSxuPXRoaXMuX19kYXRhWzZdLGg9dGhpcy5fX2RhdGFbN10sbz10aGlzLl9fZGF0YVs4XSxfPW8qaS1yKmgsZD0tbyphK3IqbixsPWgqYS1pKm4sYz10Kl8rZSpkK3MqbDtyZXR1cm4gYz8oYz0xL2MsdGhpcy5zZXQoXypjLCgtbyplK3MqaCkqYywociplLXMqaSkqYyxkKmMsKG8qdC1zKm4pKmMsKC1yKnQrcyphKSpjLGwqYywoLWgqdCtlKm4pKmMsKGkqdC1lKmEpKmMpLCEwKTooY29uc29sZS53YXJuKCJVbmFibGUgdG8gaW52ZXJ0IE1hdDMiKSwhMSl9dHJhbnNwb3NlKCl7cmV0dXJuIGQodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbM10sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbNF0sdGhpcy5fX2RhdGFbN10sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbNV0sdGhpcy5fX2RhdGFbOF0pfXRyYW5zcG9zZUluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzFdLGU9dGhpcy5fX2RhdGFbMl0scz10aGlzLl9fZGF0YVs1XTt0aGlzLl9fZGF0YVsxXT10aGlzLl9fZGF0YVszXSx0aGlzLl9fZGF0YVsyXT10aGlzLl9fZGF0YVs2XSx0aGlzLl9fZGF0YVszXT10LHRoaXMuX19kYXRhWzVdPXRoaXMuX19kYXRhWzddLHRoaXMuX19kYXRhWzZdPWUsdGhpcy5fX2RhdGFbN109c310cmFuc2Zvcm1WZWMzKHQpe3JldHVybiBuZXcgcih0aGlzLl9fZGF0YVswXSp0LngrdGhpcy5fX2RhdGFbMV0qdC55K3RoaXMuX19kYXRhWzJdKnQueix0aGlzLl9fZGF0YVszXSp0LngrdGhpcy5fX2RhdGFbNF0qdC55K3RoaXMuX19kYXRhWzVdKnQueix0aGlzLl9fZGF0YVs2XSp0LngrdGhpcy5fX2RhdGFbN10qdC55K3RoaXMuX19kYXRhWzhdKnQueil9Y2xvbmUoKXtyZXR1cm4gbmV3IGQodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbM10sdGhpcy5fX2RhdGFbNF0sdGhpcy5fX2RhdGFbNV0sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbN10sdGhpcy5fX2RhdGFbOF0sdGhpcy5fX2RhdGFbOV0pfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBkKC4uLnQpfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyBkKHQsNCplKX10b0pTT04oKXtyZXR1cm4gdGhpcy5fX2RhdGF9ZnJvbUpTT04odCl7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSh0KX10b1N0cmluZygpe3JldHVybiB0aGlzLnRvSlNPTigpLnRvU3RyaW5nKCl9fWEucmVnaXN0ZXJUeXBlKCJNYXQzIixkKTtjbGFzcyBsIGV4dGVuZHMgc3tjb25zdHJ1Y3Rvcih0PTEsZT0wLHM9MCxhPTAsaT0wLHI9MSxuPTAsaD0wLG89MCxfPTAsZD0xLGw9MCxjPTAsdT0wLGY9MCxtPTEpe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSl0aGlzLl9fZGF0YT10O2Vsc2UgaWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkocyxhLDE2KX1lbHNlIHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMTYpLHRoaXMuc2V0KHQsZSxzLGEsaSxyLG4saCxvLF8sZCxsLGMsdSxmLG0pfWdldCBtMDAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF19c2V0IG0wMCh0KXt0aGlzLl9fZGF0YVswXT10fWdldCBtMDEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IG0wMSh0KXt0aGlzLl9fZGF0YVsxXT10fWdldCBtMDIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IG0wMih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCBtMDMoKXtyZXR1cm4gdGhpcy5fX2RhdGFbM119c2V0IG0wMyh0KXt0aGlzLl9fZGF0YVszXT10fWdldCBtMTAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNF19c2V0IG0xMCh0KXt0aGlzLl9fZGF0YVs0XT10fWdldCBtMTEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNV19c2V0IG0xMSh0KXt0aGlzLl9fZGF0YVs1XT10fWdldCBtMTIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNl19c2V0IG0xMih0KXt0aGlzLl9fZGF0YVs2XT10fWdldCBtMTMoKXtyZXR1cm4gdGhpcy5fX2RhdGFbN119c2V0IG0xMyh0KXt0aGlzLl9fZGF0YVs3XT10fWdldCBtMjAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbOF19c2V0IG0yMCh0KXt0aGlzLl9fZGF0YVs4XT10fWdldCBtMjEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbOV19c2V0IG0yMSh0KXt0aGlzLl9fZGF0YVs5XT10fWdldCBtMjIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMTBdfXNldCBtMjIodCl7dGhpcy5fX2RhdGFbMTBdPXR9Z2V0IG0yMygpe3JldHVybiB0aGlzLl9fZGF0YVsxMV19c2V0IG0yMyh0KXt0aGlzLl9fZGF0YVsxMV09dH1nZXQgbTMwKCl7cmV0dXJuIHRoaXMuX19kYXRhWzEyXX1zZXQgbTMwKHQpe3RoaXMuX19kYXRhWzEyXT10fWdldCBtMzEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMTNdfXNldCBtMzEodCl7dGhpcy5fX2RhdGFbMTNdPXR9Z2V0IG0zMigpe3JldHVybiB0aGlzLl9fZGF0YVsxNF19c2V0IG0zMih0KXt0aGlzLl9fZGF0YVsxNF09dH1nZXQgbTMzKCl7cmV0dXJuIHRoaXMuX19kYXRhWzE1XX1zZXQgbTMzKHQpe3RoaXMuX19kYXRhWzE1XT10fWdldCB4QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciwwKX1zZXQgeEF4aXModCl7dGhpcy54QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB5QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciw0KX1zZXQgeUF4aXModCl7dGhpcy55QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB6QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciw4KX1zZXQgekF4aXModCl7dGhpcy56QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB0cmFuc2xhdGlvbigpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciwxMil9c2V0IHRyYW5zbGF0aW9uKHQpe3RoaXMudHJhbnNsYXRpb24uc2V0KHQueCx0LnksdC56KX1zZXQodD0xLGU9MCxzPTAsYT0wLGk9MCxyPTEsbj0wLGg9MCxvPTAsXz0wLGQ9MSxsPTAsYz0wLHU9MCxmPTAsbT0xKXt0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hLHRoaXMuX19kYXRhWzRdPWksdGhpcy5fX2RhdGFbNV09cix0aGlzLl9fZGF0YVs2XT1uLHRoaXMuX19kYXRhWzddPWgsdGhpcy5fX2RhdGFbOF09byx0aGlzLl9fZGF0YVs5XT1fLHRoaXMuX19kYXRhWzEwXT1kLHRoaXMuX19kYXRhWzExXT1sLHRoaXMuX19kYXRhWzEyXT1jLHRoaXMuX19kYXRhWzEzXT11LHRoaXMuX19kYXRhWzE0XT1mLHRoaXMuX19kYXRhWzE1XT1tfXNldElkZW50aXR5KCl7dGhpcy5zZXQoKX1zZXREYXRhQXJyYXkodCl7dGhpcy5fX2RhdGE9dH1zZXRGcm9tTWF0NCh0KXt0aGlzLl9fZGF0YVswXT10Lm0wMCx0aGlzLl9fZGF0YVsxXT10Lm0wMSx0aGlzLl9fZGF0YVsyXT10Lm0wMix0aGlzLl9fZGF0YVszXT10Lm0wMyx0aGlzLl9fZGF0YVs0XT10Lm0xMCx0aGlzLl9fZGF0YVs1XT10Lm0xMSx0aGlzLl9fZGF0YVs2XT10Lm0xMix0aGlzLl9fZGF0YVs3XT10Lm0xMyx0aGlzLl9fZGF0YVs4XT10Lm0yMCx0aGlzLl9fZGF0YVs5XT10Lm0yMSx0aGlzLl9fZGF0YVsxMF09dC5tMjIsdGhpcy5fX2RhdGFbMTFdPXQubTIzLHRoaXMuX19kYXRhWzEyXT10Lm0zMCx0aGlzLl9fZGF0YVsxM109dC5tMzEsdGhpcy5fX2RhdGFbMTRdPXQubTMyLHRoaXMuX19kYXRhWzE1XT10Lm0zM310b01hdDModCl7cmV0dXJuIG5ldyBkKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzVdLHRoaXMuX19kYXRhWzZdLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzldLHRoaXMuX19kYXRhWzEwXSl9dHJhbnNwb3NlSW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMV0sZT10aGlzLl9fZGF0YVsyXSxzPXRoaXMuX19kYXRhWzNdLGE9dGhpcy5fX2RhdGFbNl0saT10aGlzLl9fZGF0YVs3XSxyPXRoaXMuX19kYXRhWzExXTt0aGlzLl9fZGF0YVsxXT10aGlzLl9fZGF0YVs0XSx0aGlzLl9fZGF0YVsyXT10aGlzLl9fZGF0YVs4XSx0aGlzLl9fZGF0YVszXT10aGlzLl9fZGF0YVsxMl0sdGhpcy5fX2RhdGFbNF09dCx0aGlzLl9fZGF0YVs2XT10aGlzLl9fZGF0YVs5XSx0aGlzLl9fZGF0YVs3XT10aGlzLl9fZGF0YVsxM10sdGhpcy5fX2RhdGFbOF09ZSx0aGlzLl9fZGF0YVs5XT1hLHRoaXMuX19kYXRhWzExXT10aGlzLl9fZGF0YVsxNF0sdGhpcy5fX2RhdGFbMTJdPXMsdGhpcy5fX2RhdGFbMTNdPWksdGhpcy5fX2RhdGFbMTRdPXJ9dHJhbnNwb3NlKCl7cmV0dXJuIG5ldyBsKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzEyXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVs1XSx0aGlzLl9fZGF0YVs5XSx0aGlzLl9fZGF0YVsxM10sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbMTBdLHRoaXMuX19kYXRhWzE0XSx0aGlzLl9fZGF0YVszXSx0aGlzLl9fZGF0YVs3XSx0aGlzLl9fZGF0YVsxMV0sdGhpcy5fX2RhdGFbMTVdKX1pbnZlcnNlKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVszXSxpPXRoaXMuX19kYXRhWzRdLHI9dGhpcy5fX2RhdGFbNV0sbj10aGlzLl9fZGF0YVs2XSxoPXRoaXMuX19kYXRhWzddLG89dGhpcy5fX2RhdGFbOF0sXz10aGlzLl9fZGF0YVs5XSxkPXRoaXMuX19kYXRhWzEwXSxjPXRoaXMuX19kYXRhWzExXSx1PXRoaXMuX19kYXRhWzEyXSxmPXRoaXMuX19kYXRhWzEzXSxtPXRoaXMuX19kYXRhWzE0XSxnPXRoaXMuX19kYXRhWzE1XSx5PXQqci1lKmkscD10Km4tcyppLGI9dCpoLWEqaSx4PWUqbi1zKnIsdz1lKmgtYSpyLEk9cypoLWEqbixOPW8qZi1fKnUsRj1vKm0tZCp1LHo9bypnLWMqdSxWPV8qbS1kKmYsTT1fKmctYypmLEE9ZCpnLWMqbTtsZXQgUz15KkEtcCpNK2IqVit4KnotdypGK0kqTjtyZXR1cm4gUz8oUz0xL1MsbmV3IGwoKHIqQS1uKk0raCpWKSpTLChzKk0tZSpBLWEqVikqUywoZipJLW0qdytnKngpKlMsKGQqdy1fKkktYyp4KSpTLChuKnotaSpBLWgqRikqUywodCpBLXMqeithKkYpKlMsKG0qYi11KkktZypwKSpTLChvKkktZCpiK2MqcCkqUywoaSpNLXIqeitoKk4pKlMsKGUqei10Kk0tYSpOKSpTLCh1KnctZipiK2cqeSkqUywoXypiLW8qdy1jKnkpKlMsKHIqRi1pKlYtbipOKSpTLCh0KlYtZSpGK3MqTikqUywoZipwLXUqeC1tKnkpKlMsKG8qeC1fKnArZCp5KSpTKSk6KGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGludmVydCBNYXQ0IiksbnVsbCl9aW52ZXJ0SW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM10saT10aGlzLl9fZGF0YVs0XSxyPXRoaXMuX19kYXRhWzVdLG49dGhpcy5fX2RhdGFbNl0saD10aGlzLl9fZGF0YVs3XSxvPXRoaXMuX19kYXRhWzhdLF89dGhpcy5fX2RhdGFbOV0sZD10aGlzLl9fZGF0YVsxMF0sbD10aGlzLl9fZGF0YVsxMV0sYz10aGlzLl9fZGF0YVsxMl0sdT10aGlzLl9fZGF0YVsxM10sZj10aGlzLl9fZGF0YVsxNF0sbT10aGlzLl9fZGF0YVsxNV0sZz10KnItZSppLHk9dCpuLXMqaSxwPXQqaC1hKmksYj1lKm4tcypyLHg9ZSpoLWEqcix3PXMqaC1hKm4sST1vKnUtXypjLE49bypmLWQqYyxGPW8qbS1sKmMsej1fKmYtZCp1LFY9XyptLWwqdSxNPWQqbS1sKmY7bGV0IEE9ZypNLXkqVitwKnorYipGLXgqTit3Kkk7cmV0dXJuIEE/KEE9MS9BLHRoaXMuc2V0KChyKk0tbipWK2gqeikqQSwocypWLWUqTS1hKnopKkEsKHUqdy1mKngrbSpiKSpBLChkKngtXyp3LWwqYikqQSwobipGLWkqTS1oKk4pKkEsKHQqTS1zKkYrYSpOKSpBLChmKnAtYyp3LW0qeSkqQSwobyp3LWQqcCtsKnkpKkEsKGkqVi1yKkYraCpJKSpBLChlKkYtdCpWLWEqSSkqQSwoYyp4LXUqcCttKmcpKkEsKF8qcC1vKngtbCpnKSpBLChyKk4taSp6LW4qSSkqQSwodCp6LWUqTitzKkkpKkEsKHUqeS1jKmItZipnKSpBLChvKmItXyp5K2QqZykqQSksITApOihjb25zb2xlLndhcm4oIlVuYWJsZSB0byBpbnZlcnQgTWF0NCIpLCExKX1zZXRJbnZlcnNlKHQpe2NvbnN0IGU9dC5fX2RhdGFbMF0scz10Ll9fZGF0YVsxXSxhPXQuX19kYXRhWzJdLGk9dC5fX2RhdGFbM10scj10Ll9fZGF0YVs0XSxuPXQuX19kYXRhWzVdLGg9dC5fX2RhdGFbNl0sbz10Ll9fZGF0YVs3XSxfPXQuX19kYXRhWzhdLGQ9dC5fX2RhdGFbOV0sbD10Ll9fZGF0YVsxMF0sYz10Ll9fZGF0YVsxMV0sdT10Ll9fZGF0YVsxMl0sZj10Ll9fZGF0YVsxM10sbT10Ll9fZGF0YVsxNF0sZz10Ll9fZGF0YVsxNV0seT1lKm4tcypyLHA9ZSpoLWEqcixiPWUqby1pKnIseD1zKmgtYSpuLHc9cypvLWkqbixJPWEqby1pKmgsTj1fKmYtZCp1LEY9XyptLWwqdSx6PV8qZy1jKnUsVj1kKm0tbCpmLE09ZCpnLWMqZixBPWwqZy1jKm07bGV0IFM9eSpBLXAqTStiKlYreCp6LXcqRitJKk47aWYoIVMpdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gaW52ZXJ0IE1hdDQiKTtTPTEvUyx0aGlzLnNldCgobipBLWgqTStvKlYpKlMsKGEqTS1zKkEtaSpWKSpTLChmKkktbSp3K2cqeCkqUywobCp3LWQqSS1jKngpKlMsKGgqei1yKkEtbypGKSpTLChlKkEtYSp6K2kqRikqUywobSpiLXUqSS1nKnApKlMsKF8qSS1sKmIrYypwKSpTLChyKk0tbip6K28qTikqUywocyp6LWUqTS1pKk4pKlMsKHUqdy1mKmIrZyp5KSpTLChkKmItXyp3LWMqeSkqUywobipGLXIqVi1oKk4pKlMsKGUqVi1zKkYrYSpOKSpTLChmKnAtdSp4LW0qeSkqUywoXyp4LWQqcCtsKnkpKlMpfW11bHRpcGx5KHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0scz10aGlzLl9fZGF0YVsxXSxhPXRoaXMuX19kYXRhWzJdLGk9dGhpcy5fX2RhdGFbM10scj10aGlzLl9fZGF0YVs0XSxuPXRoaXMuX19kYXRhWzVdLGg9dGhpcy5fX2RhdGFbNl0sbz10aGlzLl9fZGF0YVs3XSxfPXRoaXMuX19kYXRhWzhdLGQ9dGhpcy5fX2RhdGFbOV0sYz10aGlzLl9fZGF0YVsxMF0sdT10aGlzLl9fZGF0YVsxMV0sZj10aGlzLl9fZGF0YVsxMl0sbT10aGlzLl9fZGF0YVsxM10sZz10aGlzLl9fZGF0YVsxNF0seT10aGlzLl9fZGF0YVsxNV0scD10LmFzQXJyYXkoKTtsZXQgYj1wWzBdLHg9cFsxXSx3PXBbMl0sST1wWzNdO2NvbnN0IE49bmV3IGw7cmV0dXJuIE4ubTAwPWIqZSt4KnIrdypfK0kqZixOLm0wMT1iKnMreCpuK3cqZCtJKm0sTi5tMDI9YiphK3gqaCt3KmMrSSpnLE4ubTAzPWIqaSt4Km8rdyp1K0kqeSxiPXBbNF0seD1wWzVdLHc9cFs2XSxJPXBbN10sTi5tMTA9YiplK3gqcit3Kl8rSSpmLE4ubTExPWIqcyt4Km4rdypkK0kqbSxOLm0xMj1iKmEreCpoK3cqYytJKmcsTi5tMTM9YippK3gqbyt3KnUrSSp5LGI9cFs4XSx4PXBbOV0sdz1wWzEwXSxJPXBbMTFdLE4ubTIwPWIqZSt4KnIrdypfK0kqZixOLm0yMT1iKnMreCpuK3cqZCtJKm0sTi5tMjI9YiphK3gqaCt3KmMrSSpnLE4ubTIzPWIqaSt4Km8rdyp1K0kqeSxiPXBbMTJdLHg9cFsxM10sdz1wWzE0XSxJPXBbMTVdLE4ubTMwPWIqZSt4KnIrdypfK0kqZixOLm0zMT1iKnMreCpuK3cqZCtJKm0sTi5tMzI9YiphK3gqaCt3KmMrSSpnLE4ubTMzPWIqaSt4Km8rdyp1K0kqeSxOfW11bHRpcGx5SW5QbGFjZSh0KXtjb25zdCBlPXRoaXMuYXNBcnJheSgpLHM9ZVswXSxhPWVbMV0saT1lWzJdLHI9ZVszXSxuPWVbNF0saD1lWzVdLG89ZVs2XSxfPWVbN10sZD1lWzhdLGw9ZVs5XSxjPWVbMTBdLHU9ZVsxMV0sZj1lWzEyXSxtPWVbMTNdLGc9ZVsxNF0seT1lWzE1XSxwPXQuYXNBcnJheSgpO2xldCBiPXBbMF0seD1wWzFdLHc9cFsyXSxJPXBbM107cmV0dXJuIHRoaXMubTAwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0wMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMDI9YippK3gqbyt3KmMrSSpnLHRoaXMubTAzPWIqcit4Kl8rdyp1K0kqeSxiPXBbNF0seD1wWzVdLHc9cFs2XSxJPXBbN10sdGhpcy5tMTA9YipzK3gqbit3KmQrSSpmLHRoaXMubTExPWIqYSt4KmgrdypsK0kqbSx0aGlzLm0xMj1iKmkreCpvK3cqYytJKmcsdGhpcy5tMTM9YipyK3gqXyt3KnUrSSp5LGI9cFs4XSx4PXBbOV0sdz1wWzEwXSxJPXBbMTFdLHRoaXMubTIwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0yMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMjI9YippK3gqbyt3KmMrSSpnLHRoaXMubTIzPWIqcit4Kl8rdyp1K0kqeSxiPXBbMTJdLHg9cFsxM10sdz1wWzE0XSxJPXBbMTVdLHRoaXMubTMwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0zMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMzI9YippK3gqbyt3KmMrSSpnLHRoaXMubTMzPWIqcit4Kl8rdyp1K0kqeSx0aGlzfXBvc3RtdWx0aXBseUluUGxhY2UodCl7Y29uc3QgZT10LmFzQXJyYXkoKSxzPWVbMF0sYT1lWzFdLGk9ZVsyXSxyPWVbM10sbj1lWzRdLGg9ZVs1XSxvPWVbNl0sXz1lWzddLGQ9ZVs4XSxsPWVbOV0sYz1lWzEwXSx1PWVbMTFdLGY9ZVsxMl0sbT1lWzEzXSxnPWVbMTRdLHk9ZVsxNV0scD10aGlzLmFzQXJyYXkoKTtsZXQgYj1wWzBdLHg9cFsxXSx3PXBbMl0sST1wWzNdO3JldHVybiB0aGlzLm0wMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMDE9YiphK3gqaCt3KmwrSSptLHRoaXMubTAyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0wMz1iKnIreCpfK3cqdStJKnksYj1wWzRdLHg9cFs1XSx3PXBbNl0sST1wWzddLHRoaXMubTEwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0xMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMTI9YippK3gqbyt3KmMrSSpnLHRoaXMubTEzPWIqcit4Kl8rdyp1K0kqeSxiPXBbOF0seD1wWzldLHc9cFsxMF0sST1wWzExXSx0aGlzLm0yMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMjE9YiphK3gqaCt3KmwrSSptLHRoaXMubTIyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0yMz1iKnIreCpfK3cqdStJKnksYj1wWzEyXSx4PXBbMTNdLHc9cFsxNF0sST1wWzE1XSx0aGlzLm0zMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMzE9YiphK3gqaCt3KmwrSSptLHRoaXMubTMyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0zMz1iKnIreCpfK3cqdStJKnksdGhpc310cmFuc2xhdGVJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGEscz10LngsYT10LnksaT10Lno7cmV0dXJuIGVbMTJdPWVbMF0qcytlWzRdKmErZVs4XSppK2VbMTJdLGVbMTNdPWVbMV0qcytlWzVdKmErZVs5XSppK2VbMTNdLGVbMTRdPWVbMl0qcytlWzZdKmErZVsxMF0qaStlWzE0XSxlWzE1XT1lWzNdKnMrZVs3XSphK2VbMTFdKmkrZVsxNV0sdGhpc31zZXRMb29rQXQodCxlLHMpe2NvbnN0IGE9dC5zdWJ0cmFjdChlKSxpPWEubGVuZ3RoKCk7aWYoaTxOdW1iZXIuRVBTSUxPTilyZXR1cm4gdm9pZCB0aGlzLnNldElkZW50aXR5KCk7YS5zY2FsZUluUGxhY2UoMS9pKTtjb25zdCByPXMuY3Jvc3MoYSksbj1yLmxlbmd0aCgpO24+TnVtYmVyLkVQU0lMT04mJnIuc2NhbGVJblBsYWNlKDEvbik7Y29uc3QgaD1hLmNyb3NzKHIpLG89aC5sZW5ndGgoKTtvPk51bWJlci5FUFNJTE9OJiZoLnNjYWxlSW5QbGFjZSgxL28pLHRoaXMuc2V0KHIueCxyLnksci56LDAsaC54LGgueSxoLnosMCxhLngsYS55LGEueiwwLHQueCx0LnksdC56LDEpfXNldFJvdGF0aW9uKHQsZSl7Y29uc3Qgcz10Lmxlbmd0aCgpO2lmKE1hdGguYWJzKHMpPE51bWJlci5FUFNJTE9OKXJldHVybiBudWxsO2NvbnN0IGE9dC54L3MsaT10LnkvcyxyPXQuei9zLG49TWF0aC5zaW4oZSksaD1NYXRoLmNvcyhlKSxvPTEtaCxfPXRoaXMuX19kYXRhO3JldHVybiBfWzBdPWEqYSpvK2gsX1sxXT1pKmEqbytyKm4sX1syXT1yKmEqby1pKm4sX1szXT0wLF9bNF09YSppKm8tcipuLF9bNV09aSppKm8raCxfWzZdPXIqaSpvK2EqbixfWzddPTAsX1s4XT1hKnIqbytpKm4sX1s5XT1pKnIqby1hKm4sX1sxMF09cipyKm8raCxfWzExXT0wLF9bMTJdPTAsX1sxM109MCxfWzE0XT0wLF9bMTVdPTEsdGhpc31zZXRYUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09MSxhWzFdPTAsYVsyXT0wLGFbM109MCxhWzRdPTAsYVs1XT1zLGFbNl09ZSxhWzddPTAsYVs4XT0wLGFbOV09LWUsYVsxMF09cyxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc31zZXRZUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09cyxhWzFdPTAsYVsyXT0tZSxhWzNdPTAsYVs0XT0wLGFbNV09MSxhWzZdPTAsYVs3XT0wLGFbOF09ZSxhWzldPTAsYVsxMF09cyxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc31zZXRaUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09cyxhWzFdPWUsYVsyXT0wLGFbM109MCxhWzRdPS1lLGFbNV09cyxhWzZdPTAsYVs3XT0wLGFbOF09MCxhWzldPTAsYVsxMF09MSxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc310cmFuc2Zvcm1WZWM0KHQpe2NvbnN0IGU9dGhpcy5fX2RhdGEscz10LngsYT10LnksaT10Lnoscj10LnQ7cmV0dXJuIG5ldyBWZWM0KGVbMF0qcytlWzRdKmErZVs4XSppK2VbMTJdKnIsZVsxXSpzK2VbNV0qYStlWzldKmkrZVsxM10qcixlWzJdKnMrZVs2XSphK2VbMTBdKmkrZVsxNF0qcixlWzNdKnMrZVs3XSphK2VbMTFdKmkrZVsxNV0qcil9dHJhbnNmb3JtVmVjMyh0KXtjb25zdCBlPXRoaXMuX19kYXRhLHM9dC54LGE9dC55LGk9dC56O3JldHVybiBuZXcgcihlWzBdKnMrZVs0XSphK2VbOF0qaStlWzEyXSxlWzFdKnMrZVs1XSphK2VbOV0qaStlWzEzXSxlWzJdKnMrZVs2XSphK2VbMTBdKmkrZVsxNF0pfXJvdGF0ZVZlYzModCl7Y29uc3QgZT10aGlzLl9fZGF0YSxzPXQueCxhPXQueSxpPXQuejtyZXR1cm4gbmV3IHIoZVswXSpzK2VbNF0qYStlWzhdKmksZVsxXSpzK2VbNV0qYStlWzldKmksZVsyXSpzK2VbNl0qYStlWzEwXSppKX1zZXRQZXJzcGVjdGl2ZU1hdHJpeCh0LGUscyxhKXtjb25zdCBpPU1hdGgudGFuKC41Kk1hdGguUEktLjUqdCkscj0xLyhzLWEpO3RoaXMuc2V0KGkvZSwwLDAsMCwwLGksMCwwLDAsMCwocythKSpyLC0xLDAsMCxzKmEqcioyLDApfXNldE9ydGhvZ3JhcGhpY01hdHJpeCh0LGUscyxhLGkscil7Y29uc3Qgbj0xLyh0LWUpLGg9MS8ocy1hKSxvPTEvKGktcik7dGhpcy5zZXQoLTIqbiwwLDAsMCwwLC0yKmgsMCwwLDAsMCwyKm8sMCwodCtlKSpuLChhK3MpKmgsKHIraSkqbywxKX1zZXRTY2FsZSh0LGUscyl7dCBpbnN0YW5jZW9mIHI/dGhpcy5zZXQodC54LDAsMCwwLDAsdC55LDAsMCwwLDAsdC56LDAsMCwwLDAsMSk6dGhpcy5zZXQodCwwLDAsMCwwLGUsMCwwLDAsMCxzLDAsMCwwLDAsMSl9c2V0RnJvbU1hdDN4NEFycmF5KHQpe3RoaXMuc2V0KHRbMF0sdFsxXSx0WzJdLDAsdFszXSx0WzRdLHRbNV0sMCx0WzZdLHRbN10sdFs4XSwwLHRbOV0sdFsxMF0sdFsxMV0sMSl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IGwodCw0KmUpfWNsb25lKCl7cmV0dXJuIG5ldyBsKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzVdLHRoaXMuX19kYXRhWzZdLHRoaXMuX19kYXRhWzddLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzldLHRoaXMuX19kYXRhWzEwXSx0aGlzLl9fZGF0YVsxMV0sdGhpcy5fX2RhdGFbMTJdLHRoaXMuX19kYXRhWzEzXSx0aGlzLl9fZGF0YVsxNF0sdGhpcy5fX2RhdGFbMTVdKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgbCguLi50KX10b0pTT04oKXtyZXR1cm4gdGhpcy5fX2RhdGF9ZnJvbUpTT04odCl7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSh0KX19YS5yZWdpc3RlclR5cGUoIk1hdDQiLGwpO2NsYXNzIHUgZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSBpZih0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDQpLCJvYmplY3QiPT10eXBlb2YgdCl7dGhpcy5fX2RhdGFbMF09MCx0aGlzLl9fZGF0YVsxXT0wLHRoaXMuX19kYXRhWzJdPTAsdGhpcy5fX2RhdGFbM109MTtmb3IoY29uc3QgZSBpbiB0KUFycmF5LmlzQXJyYXkodFtlXSk/dGhpc1tlXS5jYWxsKHRoaXMsLi4udFtlXSk6dGhpc1tlXS5jYWxsKHRoaXMsdFtlXSl9ZWxzZSB0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCB3KCl7cmV0dXJuIHRoaXMuX19kYXRhWzNdfXNldCB3KHQpe3RoaXMuX19kYXRhWzNdPXR9c2V0KHQsZSxzLGEpe3RoaXMuX19kYXRhWzBdPXQsdGhpcy5fX2RhdGFbMV09ZSx0aGlzLl9fZGF0YVsyXT1zLHRoaXMuX19kYXRhWzNdPWF9c2V0RGF0YUFycmF5KHQpe3RoaXMuX19kYXRhPXR9c2V0RnJvbU90aGVyKHQpe3RoaXMuX19kYXRhWzBdPXQueCx0aGlzLl9fZGF0YVsxXT10LnksdGhpcy5fX2RhdGFbMl09dC56LHRoaXMuX19kYXRhWzNdPXQud31zZXRGcm9tRXVsZXJBbmdsZXModCl7Y29uc3QgZT1uZXcgcjtzd2l0Y2godC5vcmRlcil7Y2FzZSAwOmUuc2V0KHQueCwtdC55LHQueik7YnJlYWs7Y2FzZSAxOmUuc2V0KHQueSwtdC56LHQueCk7YnJlYWs7Y2FzZSAyOmUuc2V0KHQueiwtdC54LHQueSk7YnJlYWs7Y2FzZSAzOmUuc2V0KHQueCx0LnosdC55KTticmVhaztjYXNlIDQ6ZS5zZXQodC56LHQueSx0LngpO2JyZWFrO2Nhc2UgNTplLnNldCh0LnksdC54LHQueik7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoInNkcnR5Iil9Y29uc3Qgcz0uNSplLngsYT0uNSplLnksaT0uNSplLnosbj1NYXRoLmNvcyhzKSxoPU1hdGguY29zKGEpLG89TWF0aC5jb3MoaSksXz1NYXRoLnNpbihzKSxkPU1hdGguc2luKGEpLGw9TWF0aC5zaW4oaSksYz1uKm8sdT1uKmwsZj1fKm8sbT1fKmwsZz1oKmYtZCp1LHk9aCptK2QqYyxwPWgqdS1kKmY7c3dpdGNoKHRoaXMudz1oKmMrZCptLHQub3JkZXIpe2Nhc2UgMDp0aGlzLng9Zyx0aGlzLnk9LXksdGhpcy56PXA7YnJlYWs7Y2FzZSAxOnRoaXMueD1wLHRoaXMueT1nLHRoaXMuej0teTticmVhaztjYXNlIDI6dGhpcy54PS15LHRoaXMueT1wLHRoaXMuej1nO2JyZWFrO2Nhc2UgMzp0aGlzLng9Zyx0aGlzLnk9cCx0aGlzLno9eTticmVhaztjYXNlIDQ6dGhpcy54PXAsdGhpcy55PXksdGhpcy56PWc7YnJlYWs7Y2FzZSA1OnRoaXMueD15LHRoaXMueT1nLHRoaXMuej1wO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJzZHJ0eSIpfX10b0V1bGVyQW5nbGVzKHQpe2NvbnN0IGU9bmV3IHI7c3dpdGNoKHQpe2Nhc2UgMDplLnNldCh0aGlzLnosdGhpcy54LHRoaXMueSk7YnJlYWs7Y2FzZSAxOmUuc2V0KHRoaXMueCx0aGlzLnksdGhpcy56KTticmVhaztjYXNlIDI6ZS5zZXQodGhpcy55LHRoaXMueix0aGlzLngpO2JyZWFrO2Nhc2UgMzplLnNldCh0aGlzLnksLXRoaXMueCx0aGlzLnopO2JyZWFrO2Nhc2UgNDplLnNldCh0aGlzLngsLXRoaXMueix0aGlzLnkpO2JyZWFrO2Nhc2UgNTplLnNldCh0aGlzLnosLXRoaXMueSx0aGlzLngpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJvdGF0aW9uIG9yZGVyOiIrdCl9Y29uc3Qgcz1uZXcgcixhPWUueCplLnkrZS56KnRoaXMudztpZihhPi40OTk5OSlzLnk9MipNYXRoLmF0YW4yKGUueCx0aGlzLncpLHMuej0uNSpNYXRoLlBJLHMueD0wO2Vsc2UgaWYoYTwtLjQ5OTk5KXMueT0tMipNYXRoLmF0YW4yKGUueCx0aGlzLncpLHMuej0tLjUqTWF0aC5QSSxzLng9MDtlbHNle2NvbnN0IHQ9ZS54KmUueCxpPWUueSplLnkscj1lLnoqZS56O3MueT1NYXRoLmF0YW4yKDIqZS55KnRoaXMudy0yKmUueCplLnosMS0yKmktMipyKSxzLno9TWF0aC5hc2luKDIqYSkscy54PU1hdGguYXRhbjIoMiplLngqdGhpcy53LTIqZS55KmUueiwxLTIqdC0yKnIpfXN3aXRjaCh0KXtjYXNlIDA6cmV0dXJuIG5ldyBfKHMueSxzLnoscy54LHQpO2Nhc2UgMTpyZXR1cm4gbmV3IF8ocy54LHMueSxzLnosdCk7Y2FzZSAyOnJldHVybiBuZXcgXyhzLnoscy54LHMueSx0KTtjYXNlIDM6cmV0dXJuIG5ldyBfKC1zLnkscy54LHMueix0KTtjYXNlIDQ6cmV0dXJuIG5ldyBfKHMueCxzLnosLXMueSx0KTtjYXNlIDU6cmV0dXJuIG5ldyBfKHMueiwtcy55LHMueCx0KX19c2V0RnJvbUF4aXNBbmRBbmdsZSh0LGUpe2NvbnN0IHM9ZS8yLGE9dC5ub3JtYWxpemUoKS5zY2FsZShNYXRoLnNpbihzKSk7dGhpcy5zZXQoYS54LGEueSxhLnosTWF0aC5jb3MocykpfXNldEZyb21EaXJlY3Rpb25BbmRVcHZlY3Rvcih0LGUpe2NvbnN0IHM9bmV3IGQ7cy5zZXRGcm9tRGlyZWN0aW9uQW5kVXB2ZWN0b3IodCxlKSx0aGlzLnNldEZyb21NYXQzKHMpfXNldEZyb20yVmVjdG9ycyh0LGUpe3Qubm9ybWFsaXplKCksZS5ub3JtYWxpemUoKTtjb25zdCBzPXQuY3Jvc3MoZSksYT10LmRvdChlKSxpPU1hdGguc3FydCgyKigxK2EpKTt0aGlzLnNldChzLngvaSxzLnkvaSxzLnovaSxpLzIpLHRoaXMubm9ybWFsaXplSW5QbGFjZSgpfXNldEZyb21NYXQzKHQpe2NvbnN0IGU9dC5fX2RhdGFbMF0rdC5fX2RhdGFbNF0rdC5fX2RhdGFbOF07bGV0IHM7aWYoZT4wKXM9TWF0aC5zcXJ0KGUrMSksdGhpcy5fX2RhdGFbM109LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbMF09KHQuX19kYXRhWzVdLXQuX19kYXRhWzddKSpzLHRoaXMuX19kYXRhWzFdPSh0Ll9fZGF0YVs2XS10Ll9fZGF0YVsyXSkqcyx0aGlzLl9fZGF0YVsyXT0odC5fX2RhdGFbMV0tdC5fX2RhdGFbM10pKnM7ZWxzZXtsZXQgZT0wO3QuX19kYXRhWzRdPnQuX19kYXRhWzBdJiYoZT0xKSx0Ll9fZGF0YVs4XT50Ll9fZGF0YVszKmUrZV0mJihlPTIpO2NvbnN0IGE9KGUrMSklMyxpPShlKzIpJTM7cz1NYXRoLnNxcnQodC5fX2RhdGFbMyplK2VdLXQuX19kYXRhWzMqYSthXS10Ll9fZGF0YVszKmkraV0rMSksdGhpcy5fX2RhdGFbZV09LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbM109KHQuX19kYXRhWzMqYStpXS10Ll9fZGF0YVszKmkrYV0pKnMsdGhpcy5fX2RhdGFbYV09KHQuX19kYXRhWzMqYStlXSt0Ll9fZGF0YVszKmUrYV0pKnMsdGhpcy5fX2RhdGFbaV09KHQuX19kYXRhWzMqaStlXSt0Ll9fZGF0YVszKmUraV0pKnN9dGhpcy5ub3JtYWxpemVJblBsYWNlKCl9c2V0RnJvbU1hdDQodCl7Y29uc3QgZT10Ll9fZGF0YVswXSt0Ll9fZGF0YVs1XSt0Ll9fZGF0YVsxMF07bGV0IHM7aWYoZT4wKXM9TWF0aC5zcXJ0KGUrMSksdGhpcy5fX2RhdGFbM109LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbMF09KHQuX19kYXRhWzZdLXQuX19kYXRhWzldKSpzLHRoaXMuX19kYXRhWzFdPSh0Ll9fZGF0YVs4XS10Ll9fZGF0YVsyXSkqcyx0aGlzLl9fZGF0YVsyXT0odC5fX2RhdGFbMV0tdC5fX2RhdGFbNF0pKnM7ZWxzZXtsZXQgZT0wO3QuX19kYXRhWzVdPnQuX19kYXRhWzBdJiYoZT0xKSx0Ll9fZGF0YVsxMF0+dC5fX2RhdGFbNCplK2VdJiYoZT0yKTtjb25zdCBhPShlKzEpJTMsaT0oZSsyKSUzO3M9TWF0aC5zcXJ0KHQuX19kYXRhWzQqZStlXS10Ll9fZGF0YVs0KmErYV0tdC5fX2RhdGFbNCppK2ldKzEpLHRoaXMuX19kYXRhW2VdPS41KnMscz0uNS9zLHRoaXMuX19kYXRhWzNdPSh0Ll9fZGF0YVs0KmEraV0tdC5fX2RhdGFbNCppK2FdKSpzLHRoaXMuX19kYXRhW2FdPSh0Ll9fZGF0YVs0KmErZV0rdC5fX2RhdGFbNCplK2FdKSpzLHRoaXMuX19kYXRhW2ldPSh0Ll9fZGF0YVs0KmkrZV0rdC5fX2RhdGFbNCplK2ldKSpzfXRoaXMubm9ybWFsaXplSW5QbGFjZSgpfWlzSWRlbnRpdHkoKXtyZXR1cm4gdGhpcy5nZXRBbmdsZSgpPE51bWJlci5FUFNJTE9OfWdldEFuZ2xlKCl7cmV0dXJuIDIqTWF0aC5hY29zKHRoaXMudyl9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10LnomJnRoaXMudz09dC53fW5vdGVxdWFscyh0KXtyZXR1cm4gdGhpcy54IT10LngmJnRoaXMueSE9dC55JiZ0aGlzLnohPXQueiYmdGhpcy53IT10Lnd9YXBwcm94RXF1YWwodCxlPU51bWJlci5FUFNJTE9OKXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCk8ZSYmTWF0aC5hYnModGhpcy55LXQueSk8ZSYmTWF0aC5hYnModGhpcy56LXQueik8ZSYmTWF0aC5hYnModGhpcy53LXQudyk8ZX1hZGQodCl7cmV0dXJuIG5ldyB1KHRoaXMueCt0LngsdGhpcy55K3QueSx0aGlzLnordC56LHRoaXMudyt0LncpfWFkZEluUGxhY2UodCl7dGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy53Kz10Lnd9c3VidHJhY3QodCl7cmV0dXJuIG5ldyB1KHRoaXMueC10LngsdGhpcy55LXQueSx0aGlzLnotdC56LHRoaXMudy10LncpfXNjYWxlKHQpe3JldHVybiBuZXcgdSh0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCx0aGlzLncqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10LHRoaXMudyo9dH1sZW5ndGgoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO3JldHVybiBNYXRoLnNxcnQodCp0K2UqZStzKnMrYSphKX1sZW5ndGhTcXVhcmVkKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVszXTtyZXR1cm4gdCp0K2UqZStzKnMrYSphfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107bGV0IGk9dCp0K2UqZStzKnMrYSphO3JldHVybiBpPE51bWJlci5FUFNJTE9OP25ldyB1OihpPTEvTWF0aC5zcXJ0KGkpLG5ldyB1KHQqaSxlKmkscyppKSl9bm9ybWFsaXplSW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107bGV0IGk9dCp0K2UqZStzKnMrYSphO2k8TnVtYmVyLkVQU0lMT058fChpPTEvTWF0aC5zcXJ0KGkpLHRoaXMuc2V0KHQqaSxlKmkscyppLGEqaSkpfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55K3RoaXMueip0LnordGhpcy53KnQud31jcm9zcyh0KXtjb25zdCBlPXRoaXMueCxzPXRoaXMueSxhPXRoaXMueixpPXRoaXMudyxyPXQueCxuPXQueSxoPXQueixvPXQudztyZXR1cm4gbmV3IHUocypoLWEqbixhKm8taSpoLGkqci1lKm8sZSpuLXMqcil9Y29uanVnYXRlKCl7cmV0dXJuIG5ldyB1KC10aGlzLngsLXRoaXMueSwtdGhpcy56LHRoaXMudyl9aW52ZXJzZSgpe3JldHVybiB0aGlzLmNvbmp1Z2F0ZSgpfWFsaWduV2l0aCh0KXt0aGlzLmRvdCh0KTwwJiZ0aGlzLnNldCgtdGhpcy54LC10aGlzLnksLXRoaXMueiwtdGhpcy53KX1tdWx0aXBseSh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdLHM9dGhpcy5fX2RhdGFbMV0sYT10aGlzLl9fZGF0YVsyXSxpPXRoaXMuX19kYXRhWzNdLHI9dC5fX2RhdGFbMF0sbj10Ll9fZGF0YVsxXSxoPXQuX19kYXRhWzJdLG89dC5fX2RhdGFbM107cmV0dXJuIG5ldyB1KGUqbytpKnIrcypoLWEqbixzKm8raSpuK2Eqci1lKmgsYSpvK2kqaCtlKm4tcypyLGkqby1lKnItcypuLWEqaCl9bXVsdGlwbHlJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0scz10aGlzLl9fZGF0YVsxXSxhPXRoaXMuX19kYXRhWzJdLGk9dGhpcy5fX2RhdGFbM10scj10Ll9fZGF0YVswXSxuPXQuX19kYXRhWzFdLGg9dC5fX2RhdGFbMl0sbz10Ll9fZGF0YVszXTt0aGlzLnNldChlKm8raSpyK3MqaC1hKm4scypvK2kqbithKnItZSpoLGEqbytpKmgrZSpuLXMqcixpKm8tZSpyLXMqbi1hKmgpfXJvdGF0ZVZlYzModCl7Y29uc3QgZT1uZXcgdSh0LngsdC55LHQueiwwKSxzPXRoaXMubXVsdGlwbHkoZSkubXVsdGlwbHkodGhpcy5jb25qdWdhdGUoKSk7cmV0dXJuIG5ldyByKHMueCxzLnkscy56KX1yb3RhdGVYKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuK2kqcix0aGlzLnk9cypuK2Eqcix0aGlzLno9YSpuLXMqcix0aGlzLnc9aSpuLWUqcn1yb3RhdGVZKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuLWEqcix0aGlzLnk9cypuK2kqcix0aGlzLno9YSpuK2Uqcix0aGlzLnc9aSpuLXMqcn1yb3RhdGVaKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuK3Mqcix0aGlzLnk9cypuLWUqcix0aGlzLno9YSpuK2kqcix0aGlzLnc9aSpuLWEqcn10b01hdDMoKXtjb25zdCB0PXRoaXMueCxlPXRoaXMueSxzPXRoaXMueixhPXRoaXMudyxpPXQrdCxyPWUrZSxuPXMrcyxoPXQqaSxvPWUqaSxfPWUqcixsPXMqaSxjPXMqcix1PXMqbixmPWEqaSxtPWEqcixnPWEqbix5PW5ldyBkO3JldHVybiB5Ll9fZGF0YVswXT0xLV8tdSx5Ll9fZGF0YVszXT1vLWcseS5fX2RhdGFbNl09bCttLHkuX19kYXRhWzFdPW8rZyx5Ll9fZGF0YVs0XT0xLWgtdSx5Ll9fZGF0YVs3XT1jLWYseS5fX2RhdGFbMl09bC1tLHkuX19kYXRhWzVdPWMrZix5Ll9fZGF0YVs4XT0xLWgtXyx5fWdldFhheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy55LGU9dGhpcy54KnRoaXMueixzPXRoaXMueSp0aGlzLnksYT10aGlzLnkqdGhpcy53LGk9dGhpcy56KnRoaXMueixuPXRoaXMueip0aGlzLnc7cmV0dXJuIG5ldyByKDEtMiooaStzKSwyKih0K24pLDIqKGUtYSkpfWdldFlheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy54LGU9dGhpcy54KnRoaXMueSxzPXRoaXMueCp0aGlzLncsYT10aGlzLnkqdGhpcy56LGk9dGhpcy56KnRoaXMueixuPXRoaXMueip0aGlzLnc7cmV0dXJuIG5ldyByKDIqKGUtbiksMS0yKihpK3QpLDIqKGErcykpfWdldFpheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy54LGU9dGhpcy54KnRoaXMueixzPXRoaXMueCp0aGlzLncsYT10aGlzLnkqdGhpcy55LGk9dGhpcy55KnRoaXMueixuPXRoaXMueSp0aGlzLnc7bmV3IHI7cmV0dXJuIG5ldyByKDIqKG4rZSksMiooaS1zKSwxLTIqKGErdCkpfW1pcnJvcih0KXtzd2l0Y2godCl7Y2FzZSAwOnJldHVybiBuZXcgdSh0aGlzLnosdGhpcy53LHRoaXMueCx0aGlzLnkpO2Nhc2UgMTpyZXR1cm4gbmV3IHUoLXRoaXMudyx0aGlzLnosdGhpcy55LC10aGlzLngpO2Nhc2UgMjpyZXR1cm4gbmV3IHUodGhpcy54LHRoaXMueSx0aGlzLnosLXRoaXMudyl9fXRvTWF0NCgpe2NvbnN0IHQ9dGhpcy54LGU9dGhpcy55LHM9dGhpcy56LGE9dGhpcy53LGk9dCt0LHI9ZStlLG49cytzLGg9dCppLG89ZSppLF89ZSpyLGQ9cyppLGM9cypyLHU9cypuLGY9YSppLG09YSpyLGc9YSpuLHk9bmV3IGw7cmV0dXJuIHkuX19kYXRhWzBdPTEtXy11LHkuX19kYXRhWzRdPW8tZyx5Ll9fZGF0YVs4XT1kK20seS5fX2RhdGFbMV09bytnLHkuX19kYXRhWzVdPTEtaC11LHkuX19kYXRhWzldPWMtZix5Ll9fZGF0YVsyXT1kLW0seS5fX2RhdGFbNl09YytmLHkuX19kYXRhWzEwXT0xLWgtXyx5fWxlcnAodCxlKXtjb25zdCBzPW5ldyB1KHRoaXMueCtlKih0LngtdGhpcy54KSx0aGlzLnkrZSoodC55LXRoaXMueSksdGhpcy56K2UqKHQuei10aGlzLnopLHRoaXMudytlKih0LnctdGhpcy53KSk7cmV0dXJuIHMubm9ybWFsaXplSW5QbGFjZSgpLHN9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IHUoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IHUodCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fWNsb25lKCl7cmV0dXJuIG5ldyB1KHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdKX10b0pTT04oKXtyZXR1cm57eDp0aGlzLngseTp0aGlzLnksejp0aGlzLnosdzp0aGlzLnd9fWZyb21KU09OKHQpe3RoaXMuX19kYXRhWzBdPXQueCx0aGlzLl9fZGF0YVsxXT10LnksdGhpcy5fX2RhdGFbMl09dC56LHRoaXMuX19kYXRhWzNdPXQudyx0aGlzLm5vcm1hbGl6ZUluUGxhY2UoKX19YS5yZWdpc3RlclR5cGUoIlF1YXQiLHUpO2NsYXNzIGZ7Y29uc3RydWN0b3IodCxlKXt0aGlzLnN0YXJ0PXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIsdGhpcy5kaXI9ZSBpbnN0YW5jZW9mIHI/ZTpuZXcgcn1jbG9zZXN0UG9pbnQodCl7Y29uc3QgZT10LnN1YnRyYWN0KHRoaXMuc3RhcnQpLmRvdCh0aGlzLmRpcik7aWYoZTxOdW1iZXIuRVBTSUxPTilyZXR1cm4gdGhpcy5zdGFydDtjb25zdCBzPWUvdGhpcy5kaXIuZG90KHRoaXMuZGlyKTtyZXR1cm4gdGhpcy5zdGFydC5hZGQodGhpcy5kaXIuc2NhbGUocykpfXBvaW50QXREaXN0KHQpe3JldHVybiB0aGlzLnN0YXJ0LmFkZCh0aGlzLmRpci5zY2FsZSh0KSl9aW50ZXJzZWN0UmF5VmVjdG9yKHQpe2NvbnN0IGU9dGhpcy5kaXIscz10LmRpcixhPXRoaXMuc3RhcnQuc3VidHJhY3QodC5zdGFydCksaT1lLmRvdChlKSxyPWUuZG90KHMpLG49cy5kb3QocyksaD1lLmRvdChhKSxvPXMuZG90KGEpO2lmKDA9PWkmJjA9PW4pcmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUbyh0LnN0YXJ0KTtpZigwPT1pKXJldHVybiB0LmNsb3Nlc3RQb2ludCh0aGlzLnN0YXJ0KTtpZigwPT1uKXJldHVybiB0aGlzLmNsb3Nlc3RQb2ludCh0LnN0YXJ0KTtjb25zdCBfPWkqbi1yKnI7bGV0IGQsbDtyZXR1cm4gXzwuMDAxPyhkPTAsbD1yPm4/aC9yOm8vbik6KGQ9KHIqby1uKmgpL18sbD0oaSpvLXIqaCkvXyksW2QsbF19aW50ZXJzZWN0UmF5UGxhbmUodCl7Y29uc3QgZT10aGlzLnN0YXJ0LnN1YnRyYWN0KHQuc3RhcnQpLHM9dC5kaXIuZG90KHRoaXMuZGlyKSxhPS10LmRpci5kb3QoZSk7aWYoTWF0aC5hYnMocyk8TnVtYmVyLlBSRUNJU0lPTilyZXR1cm4tMTtjb25zdCBpPWEvcztyZXR1cm4gaTwtTnVtYmVyLlBSRUNJU0lPTj8tMTppfWNsb25lKCl7cmV0dXJuIG5ldyBmKHRoaXMuc3RhcnQuY2xvbmUoKSx0aGlzLmRpci5jbG9uZSgpKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgZiguLi50KX10b0pTT04oKXtyZXR1cm57c3RhcnQ6dGhpcy5zdGFydCxkaXI6dGhpcy5kaXJ9fWZyb21KU09OKHQpe3RoaXMuc3RhcnQuZnJvbUpTT04odC5zdGFydCksdGhpcy5kaXIuZnJvbUpTT04odC5kaXIpfXRvU3RyaW5nKCl7cmV0dXJuIGUodGhpcy50b0pTT04oKSl9fWEucmVnaXN0ZXJUeXBlKCJSYXkiLGYpO25ldyByKDEsMSwxKTtjbGFzcyBte2NvbnN0cnVjdG9yKHQsZSxzKXtpZih0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KXRoaXMuc2V0RnJvbUZsb2F0MzJBcnJheSh0KTtlbHNle2lmKHQgaW5zdGFuY2VvZiByKXRoaXMudHI9dDtlbHNle2lmKHQgaW5zdGFuY2VvZiB1JiZudWxsPT1lJiZudWxsPT1zKXJldHVybiB0aGlzLnRyPW5ldyByLHRoaXMub3JpPXQsdm9pZCh0aGlzLnNjPW5ldyByKDEsMSwxKSk7dGhpcy50cj1uZXcgcn10aGlzLm9yaT1lIGluc3RhbmNlb2YgdT9lOm5ldyB1LHRoaXMuc2M9cyBpbnN0YW5jZW9mIHI/czpuZXcgcigxLDEsMSl9fXNldCh0LGUscyl7dGhpcy50cj10LHRoaXMub3JpPWUscyBpbnN0YW5jZW9mIHImJih0aGlzLnNjPXMpfXNldEZyb21PdGhlcih0KXt0aGlzLnRyPXQudHIsdGhpcy5vcmk9dC5vcmksdGhpcy5zYz10LnNjfWlzSWRlbnRpdHkoKXtyZXR1cm4gdGhpcy50ci5pc051bGwoKSYmdGhpcy5vcmkuaXNJZGVudGl0eSgpJiZ0aGlzLnNjLmlzMTExKCl9c2V0TG9va0F0KHQsZSxzKXtjb25zdCBhPXQuc3VidHJhY3QoZSk7aWYoYS5sZW5ndGgoKTxOdW1iZXIuRVBTSUxPTil0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZGlyIik7dGhpcy5vcmkuc2V0RnJvbURpcmVjdGlvbkFuZFVwdmVjdG9yKGEscyksdGhpcy50cj10fW11bHRpcGx5KHQpe2xldCBlPXRoaXMuc2M7cmV0dXJuIHRoaXMuc2MueD09dGhpcy5zYy55JiZ0aGlzLnNjLng9PXRoaXMuc2Muenx8KGU9dC5vcmkucm90YXRlVmVjMyh0aGlzLnNjKSxNYXRoLnNpZ24oZS54KSE9TWF0aC5zaWduKHRoaXMuc2MueCkmJihlLng9LWUueCksTWF0aC5zaWduKGUueSkhPU1hdGguc2lnbih0aGlzLnNjLnkpJiYoZS55PS1lLnkpLE1hdGguc2lnbihlLnopIT1NYXRoLnNpZ24odGhpcy5zYy56KSYmKGUuej0tZS56KSksbmV3IG0odGhpcy50ci5hZGQodGhpcy5vcmkucm90YXRlVmVjMyhlLm11bHRpcGx5KHQudHIpKSksdGhpcy5vcmkubXVsdGlwbHkodC5vcmkpLGUubXVsdGlwbHkodC5zYykpfWludmVyc2UoKXtjb25zdCB0PW5ldyBtO3JldHVybiB0Lm9yaT10aGlzLm9yaS5pbnZlcnNlKCksdGhpcy5zYy54IT10aGlzLnNjLnl8fHRoaXMuc2MueCE9dGhpcy5zYy56Pyh0LnNjPXQub3JpLnJvdGF0ZVZlYzModGhpcy5zYyksTWF0aC5zaWduKHQuc2MueCkhPU1hdGguc2lnbih0aGlzLnNjLngpJiYodC5zYy54PS10LnNjLngpLE1hdGguc2lnbih0LnNjLnkpIT1NYXRoLnNpZ24odGhpcy5zYy55KSYmKHQuc2MueT0tdC5zYy55KSxNYXRoLnNpZ24odC5zYy56KSE9TWF0aC5zaWduKHRoaXMuc2MueikmJih0LnNjLno9LXQuc2MueikpOnQuc2M9dGhpcy5zYy5pbnZlcnNlKCksdC50cj10Lm9yaS5yb3RhdGVWZWMzKHRoaXMudHIubmVnYXRlKCkubXVsdGlwbHkodC5zYykpLHR9dHJhbnNmb3JtVmVjMyh0KXtyZXR1cm4gdGhpcy50ci5hZGQodGhpcy5vcmkucm90YXRlVmVjMyh0aGlzLnNjLm11bHRpcGx5KHQpKSl9dG9NYXQ0KCl7Y29uc3QgdD1uZXcgbCh0aGlzLnNjLngsMCwwLDAsMCx0aGlzLnNjLnksMCwwLDAsMCx0aGlzLnNjLnosMCwwLDAsMCwxKSxlPXRoaXMub3JpLnRvTWF0NCgpLHM9bmV3IGw7cmV0dXJuIHMudHJhbnNsYXRpb249dGhpcy50cixzLm11bHRpcGx5KGUpLm11bHRpcGx5KHQpfWZyb21NYXQ0KHQpe3RoaXMudHI9dC50cmFuc2xhdGlvbix0aGlzLm9yaS5zZXRGcm9tTWF0NCh0KX1zZXRGcm9tRmxvYXQzMkFycmF5KHQpe2lmKDc9PXQubGVuZ3RoKXJldHVybiB0aGlzLnRyPW5ldyByKHQuYnVmZmVyLHQuYnl0ZU9mZnNldCksdGhpcy5vcmk9bmV3IHUodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKSx2b2lkKHRoaXMuc2M9bmV3IHIoMSwxLDEpKTtpZig4IT10Lmxlbmd0aClyZXR1cm4gMTA9PXQubGVuZ3RoPyh0aGlzLnRyPW5ldyByKHQuYnVmZmVyLHQuYnl0ZU9mZnNldCksdGhpcy5vcmk9bmV3IHUodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKSx2b2lkKHRoaXMuc2M9bmV3IHIodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzIxKSkpOnZvaWQgMDt7dGhpcy50cj1uZXcgcih0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQpLHRoaXMub3JpPW5ldyB1KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCsxMik7Y29uc3QgZT10WzddO3RoaXMuc2M9bmV3IHIoZSxlLGUpfX1jbG9uZSgpe3JldHVybiBuZXcgbSh0aGlzLnRyLmNsb25lKCksdGhpcy5vcmkuY2xvbmUoKSx0aGlzLnNjLmNsb25lKCkpfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBtKC4uLnQpfXRvSlNPTigpe2NvbnN0IHQ9e3RyOnRoaXMudHIudG9KU09OKCksb3JpOnRoaXMub3JpLnRvSlNPTigpfTtyZXR1cm4gdGhpcy5zYy5pczExMSgpfHwodC5zYz10aGlzLnNjLnRvSlNPTigpKSx0fWZyb21KU09OKHQpe3RoaXMudHIuZnJvbUpTT04odC50ciksdGhpcy5vcmkuZnJvbUpTT04odC5vcmkpLHQuc2MmJnRoaXMuc2MuZnJvbUpTT04odC5zYyl9dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIlhmbyIsbSk7Y2xhc3MgZ3tjb25zdHJ1Y3Rvcih0LGUpe3RoaXMucDA9dCBpbnN0YW5jZW9mIGk/dDpuZXcgaShOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSx0aGlzLnAxPWUgaW5zdGFuY2VvZiBpP2U6bmV3IGkoTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLE51bWJlci5ORUdBVElWRV9JTkZJTklUWSl9c2V0KHQsZSl7dGhpcy5wMD10LHRoaXMucDE9ZX1yZXNldCgpe3RoaXMucDAueD1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksdGhpcy5wMS54PU51bWJlci5ORUdBVElWRV9JTkZJTklUWSx0aGlzLnAwLnk9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLHRoaXMucDEueT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFl9aXNWYWxpZCgpe3JldHVybiB0aGlzLnAwLnghPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdGhpcy5wMS54IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJnRoaXMucDAueSE9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZJiZ0aGlzLnAxLnkhPU51bWJlci5ORUdBVElWRV9JTkZJTklUWX1hZGRQb2ludCh0KXsodGhpcy5wMC54PT1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl8fHQueDx0aGlzLnAwLngpJiYodGhpcy5wMC54PXQueCksKHRoaXMucDAueT09TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfHx0Lnk8dGhpcy5wMC55KSYmKHRoaXMucDAueT10LnkpLCh0aGlzLnAxLnk9PU51bWJlci5ORUdBVElWRV9JTkZJTklUWXx8dC54PnRoaXMucDEueCkmJih0aGlzLnAxLng9dC54KSwodGhpcy5wMS55PT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFl8fHQueT50aGlzLnAxLnkpJiYodGhpcy5wMS55PXQueSl9c2l6ZSgpe3JldHVybiB0aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApfWRpYWdvbmFsKCl7cmV0dXJuIHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCl9Y2VudGVyKCl7Y29uc3QgdD10aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApO3JldHVybiB0LnNjYWxlSW5QbGFjZSguNSksdC5hZGRJblBsYWNlKHRoaXMucDApLHR9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IGcoLi4udCl9dG9KU09OKCl7cmV0dXJue3AwOnRoaXMucDAudG9KU09OKCkscDE6dGhpcy5wMS50b0pTT04oKX19dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIkJveDIiLGcpO2NsYXNzIHkgZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQsZT0wKXtzdXBlcigpLHRoaXMucG9zPXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIsdGhpcy5yYWRpdXM9ZX1jbG9uZSgpe3JldHVybiBuZXcgU3BoZXJlKHRoaXMucG9zLmNsb25lKCksdGhpcy5yYWRpdXMpfWludGVyc2VjdHNCb3godCl7cmV0dXJuIHQuaW50ZXJzZWN0c1NwaGVyZSh0aGlzKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgU3BoZXJlKC4uLnQpfXRvSlNPTigpe3JldHVybntwb3M6dGhpcy5wb3MudG9KU09OKCkscmFkaXVzOnRoaXMucmFkaXVzfX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX1hLnJlZ2lzdGVyVHlwZSgiU3BoZXJlVHlwZSIseSk7Y2xhc3MgcHtjb25zdHJ1Y3Rvcih0LGUpe3QgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXk/dGhpcy5zZXRGcm9tRmxvYXQzMkFycmF5KHQpOih0aGlzLnAwPXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIoTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLHRoaXMucDE9ZSBpbnN0YW5jZW9mIHI/ZTpuZXcgcihOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkpfWdldCBtaW4oKXtyZXR1cm4gdGhpcy5wMH1nZXQgbWF4KCl7cmV0dXJuIHRoaXMucDF9c2V0KHQsZSl7dGhpcy5wMD10LHRoaXMucDE9ZX1yZXNldCgpe3RoaXMucDAueD1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksdGhpcy5wMS54PU51bWJlci5ORUdBVElWRV9JTkZJTklUWSx0aGlzLnAwLnk9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLHRoaXMucDEueT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksdGhpcy5wMC56PU51bWJlci5QT1NJVElWRV9JTkZJTklUWSx0aGlzLnAxLno9TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZfWlzVmFsaWQoKXtyZXR1cm4gdGhpcy5wMC54IT1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkmJnRoaXMucDEueCE9TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZJiZ0aGlzLnAwLnkhPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdGhpcy5wMS55IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJnRoaXMucDAueiE9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZJiZ0aGlzLnAxLnohPU51bWJlci5ORUdBVElWRV9JTkZJTklUWX1hZGRQb2ludCh0KXt0LnghPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC54IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lng8dGhpcy5wMC54JiYodGhpcy5wMC54PXQueCksdC54PnRoaXMucDEueCYmKHRoaXMucDEueD10LngpKSx0LnkhPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC55IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lnk8dGhpcy5wMC55JiYodGhpcy5wMC55PXQueSksdC55PnRoaXMucDEueSYmKHRoaXMucDEueT10LnkpKSx0LnohPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC56IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lno8dGhpcy5wMC56JiYodGhpcy5wMC56PXQueiksdC56PnRoaXMucDEueiYmKHRoaXMucDEuej10LnopKX1hZGRCb3gzKHQsZSl7ZT8odGhpcy5hZGRQb2ludChlLnRyYW5zZm9ybVZlYzModC5wMCkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAwLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAxLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAwLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAxLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAwLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAxLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKHQucDEpKSk6KHRoaXMuYWRkUG9pbnQodC5wMCksdGhpcy5hZGRQb2ludCh0LnAxKSl9c2l6ZSgpe3JldHVybiB0aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApfWRpYWdvbmFsKCl7cmV0dXJuIHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCl9Y2VudGVyKCl7Y29uc3QgdD10aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApO3JldHVybiB0LnNjYWxlSW5QbGFjZSguNSksdC5hZGRJblBsYWNlKHRoaXMucDApLHR9dG9NYXQ0KCl7Y29uc3QgdD10aGlzLnAxLngtdGhpcy5wMC54LGU9dGhpcy5wMS55LXRoaXMucDAueSxzPXRoaXMucDEuei10aGlzLnAwLno7cmV0dXJuIG5ldyBsKHQsMCwwLDAsMCxlLDAsMCwwLDAscywwLHRoaXMucDAueCx0aGlzLnAwLnksdGhpcy5wMC56LDEpfWdldEJvdW5kaW5nU3BoZXJlKCl7cmV0dXJuIG5ldyB5KHRoaXMuY2VudGVyKCksLjUqdGhpcy5kaWFnb25hbCgpLmxlbmd0aCgpKX1pbnRlcnNlY3RzQm94KHQpe3JldHVybiEodC5tYXgueDx0aGlzLm1pbi54fHx0Lm1pbi54PnRoaXMubWF4Lnh8fHQubWF4Lnk8dGhpcy5taW4ueXx8dC5taW4ueT50aGlzLm1heC55fHx0Lm1heC56PHRoaXMubWluLnp8fHQubWluLno+dGhpcy5tYXgueil9aW50ZXJzZWN0c1NwaGVyZSh0KXtyZXR1cm4gY2xvc2VzdFBvaW50LmRpc3RhbmNlVG9TcXVhcmVkKHQuY2VudGVyKTw9dC5yYWRpdXMqdC5yYWRpdXN9aW50ZXJzZWN0c1BsYW5lKHQpe2xldCBlLHM7cmV0dXJuIHQubm9ybWFsLng+MD8oZT10Lm5vcm1hbC54KnRoaXMubWluLngscz10Lm5vcm1hbC54KnRoaXMubWF4LngpOihlPXQubm9ybWFsLngqdGhpcy5tYXgueCxzPXQubm9ybWFsLngqdGhpcy5taW4ueCksdC5ub3JtYWwueT4wPyhlKz10Lm5vcm1hbC55KnRoaXMubWluLnkscys9dC5ub3JtYWwueSp0aGlzLm1heC55KTooZSs9dC5ub3JtYWwueSp0aGlzLm1heC55LHMrPXQubm9ybWFsLnkqdGhpcy5taW4ueSksdC5ub3JtYWwuej4wPyhlKz10Lm5vcm1hbC56KnRoaXMubWluLnoscys9dC5ub3JtYWwueip0aGlzLm1heC56KTooZSs9dC5ub3JtYWwueip0aGlzLm1heC56LHMrPXQubm9ybWFsLnoqdGhpcy5taW4ueiksZTw9LXQuY29uc3RhbnQmJnM+PS10LmNvbnN0YW50fWNsb25lKCl7cmV0dXJuIG5ldyBwKHRoaXMucDAuY2xvbmUoKSx0aGlzLnAxLmNsb25lKCkpfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBwKC4uLnQpfXN0YXRpYyBzaXplSW5CeXRlcygpe3JldHVybiAyNH10b0pTT04oKXtyZXR1cm57cDA6dGhpcy5wMC50b0pTT04oKSxwMTp0aGlzLnAxLnRvSlNPTigpfX1mcm9tSlNPTih0KXt0aGlzLnAwLmZyb21KU09OKHQucDApLHRoaXMucDEuZnJvbUpTT04odC5wMSl9bG9hZEJpbih0LGUpe3RoaXMucDAubG9hZEJpbih0LGUpLHRoaXMucDAubG9hZEJpbih0LGUrMTIpfXNldEZyb21GbG9hdDMyQXJyYXkodCl7dGhpcy5wMD1uZXcgcih0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQpLHRoaXMucDE9bmV3IHIodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX1hLnJlZ2lzdGVyVHlwZSgiQm94MyIscCk7Y2xhc3MgeCBleHRlbmRzIHN7Y29uc3RydWN0b3IodCxlPTApe3N1cGVyKCksdGhpcy5ub3JtYWw9dCBpbnN0YW5jZW9mIHI/dDpuZXcgcix0aGlzLnc9ZX1zZXQodCxlLHMsYSl7dGhpcy5ub3JtYWwuc2V0KHQsZSxzKSx0aGlzLnc9YX1kaXZpZGVTY2FsYXIodCl7dGhpcy5ub3JtYWwuc2NhbGVJblBsYWNlKDEvdCksdGhpcy53Lz10fWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdC5kb3QodGhpcy5ub3JtYWwpK3RoaXMud31ub3JtYWxpemVJblBsYWNlKCl7Y29uc3QgdD0xL3RoaXMubm9ybWFsLmxlbmd0aCgpO3RoaXMubm9ybWFsLnNjYWxlSW5QbGFjZSh0KSx0aGlzLncqPXR9Y2xvbmUoKXtyZXR1cm4gbmV3IFBsYW5lKHRoaXMubm9ybWFsLmNsb25lKCksdGhpcy53KX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgUGxhbmUoLi4udCl9dG9KU09OKCl7cmV0dXJue25vcm1hbDp0aGlzLm5vcm1hbC50b0pTT04oKSx3OnRoaXMud319dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIlBsYW5lVHlwZSIseCk7YS5yZWdpc3RlclR5cGUoIkZydXN0dW0iLGNsYXNze2NvbnN0cnVjdG9yKHQsZSxzLGEsaSxyKXt0aGlzLnBsYW5lcz1bdHx8bmV3IHgsZXx8bmV3IHgsc3x8bmV3IHgsYXx8bmV3IHgsaXx8bmV3IHgscnx8bmV3IHhdfXNldEZyb21NYXRyaXgodCl7Y29uc3QgZT10LHM9dGhpcy5wbGFuZXM7c1swXS5zZXQoZS5tMDMtZS5tMDAsZS5tMTMtZS5tMTAsZS5tMjMtZS5tMjAsZS5tMzMtZS5tMzApLHNbMV0uc2V0KGUubTAzK2UubTAwLGUubTEzK2UubTEwLGUubTIzK2UubTIwLGUubTMzK2UubTMwKSxzWzJdLnNldChlLm0wMytlLm0wMSxlLm0xMytlLm0xMSxlLm0yMytlLm0yMSxlLm0zMytlLm0zMSksc1szXS5zZXQoZS5tMDMtZS5tMDEsZS5tMTMtZS5tMTEsZS5tMjMtZS5tMjEsZS5tMzMtZS5tMzEpLHNbNF0uc2V0KGUubTAzLWUubTAyLGUubTEzLWUubTEyLGUubTIzLWUubTIyLGUubTMzLWUubTMyKSxzWzVdLnNldChlLm0wMytlLm0wMixlLm0xMytlLm0xMixlLm0yMytlLm0yMixlLm0zMytlLm0zMikscy5mb3JFYWNoKHQ9PnQubm9ybWFsaXplSW5QbGFjZSgpKX1pbnRlcnNlY3RzQm94KHQpe2NvbnN0IGU9bmV3IHIscz10aGlzLnBsYW5lcyx7bWluOmEsbWF4Oml9PXQ7Zm9yKGxldCB0PTA7dDw2O3QrKyl7Y29uc3Qgcj1zW3RdO2lmKGUueD1yLm5vcm1hbC54PjA/aS54OmEueCxlLnk9ci5ub3JtYWwueT4wP2kueTphLnksZS56PXIubm9ybWFsLno+MD9pLno6YS56LHIuZGlzdGFuY2VUb1BvaW50KGUpPDApcmV0dXJuITF9cmV0dXJuITB9dG9KU09OKCl7cmV0dXJue3AwOnRoaXMucDAudG9KU09OKCkscDE6dGhpcy5wMS50b0pTT04oKSxwMjp0aGlzLnAyLnRvSlNPTigpLHAzOnRoaXMucDMudG9KU09OKCkscDQ6dGhpcy5wNC50b0pTT04oKSxwNTp0aGlzLnA1LnRvSlNPTigpfX1mcm9tSlNPTih0KXt0aGlzLnAwLmZyb21KU09OKHQucDApLHRoaXMucDEuZnJvbUpTT04odC5wMSksdGhpcy5wMi5mcm9tSlNPTih0LnAyKSx0aGlzLnAzLmZyb21KU09OKHQucDMpLHRoaXMucDQuZnJvbUpTT04odC5wNCksdGhpcy5wNS5mcm9tSlNPTih0LnA1KX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX0pO2NsYXNzIHd7Y29uc3RydWN0b3IodD0hMSl7dGhpcy5fX3Nsb3RzPVtdLHRoaXMuX190b2dnbGVkU2lnbmFsPXQsdGhpcy5fX3RvZ2dsZWQ9ITEsdGhpcy5fX2RhdGE9bnVsbCx0aGlzLmNvbm5lY3Q9dGhpcy5jb25uZWN0LmJpbmQodGhpcyksdGhpcy5kaXNjb25uZWN0PXRoaXMuZGlzY29ubmVjdC5iaW5kKHRoaXMpLHRoaXMuZW1pdD10aGlzLmVtaXQuYmluZCh0aGlzKX1jb25uZWN0KHQpe2lmKG51bGw9PXQpdGhyb3cgbmV3IEVycm9yKCJhIGZ1bmN0aW9uIGNhbGxiYWNrIG11c3QgYmUgcGFzc2VkIHRvIFNpZ25hbC5jb25uZWN0Iik7aWYoLTEhPXRoaXMuX19zbG90cy5pbmRleE9mKHQpKXJldHVybiB2b2lkIGNvbnNvbGUud2FybigiZm4gJyIrdC5uYW1lKyInIGFscmVhZHkgY29ubmVjdGVkIHRvIFNpZ25hbC4iKTtjb25zdCBlPXRoaXMuX19zbG90cy5sZW5ndGg7cmV0dXJuIHRoaXMuX19zbG90c1tlXT10LHRoaXMuX190b2dnbGVkU2lnbmFsJiZ0aGlzLl9fdG9nZ2xlZCYmKHRoaXMuX19kYXRhP3QoLi4udGhpcy5fX2RhdGEpOnQoKSksZX1kaXNjb25uZWN0KHQpe2lmKG51bGw9PXQpdGhyb3cgbmV3IEVycm9yKCJhIGZ1bmN0aW9uIGNhbGxiYWNrIG11c3QgYmUgcGFzc2VkIHRvIFNpZ25hbC5kaXNjb25uZWN0Iik7Y29uc3QgZT1bXTtpZih0aGlzLl9fc2xvdHMuZm9yRWFjaCgoZnVuY3Rpb24ocyxhKXtzPT09dCYmZS5wdXNoKGEpfSkpLDAhPWUubGVuZ3RoKWZvcihjb25zdCB0IG9mIGUpdGhpcy5fX3Nsb3RzW3RdPXZvaWQgMDtlbHNlIGNvbnNvbGUud2FybigiY2FsbGJhY2sgOiIrdC5uYW1lKyIgd2FzIG5vdCBjb25uZWN0ZWQgdG8gdGhpcyBzaWduYWw6Iit0aGlzLl9fbmFtZSl9ZGlzY29ubmVjdElkKHQpe2lmKCF0aGlzLl9fc2xvdHNbdF0pdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIElEIik7dGhpcy5fX3Nsb3RzW3RdPXZvaWQgMH1lbWl0KC4uLnQpe3RoaXMuX190b2dnbGVkU2lnbmFsJiYodGhpcy5fX3RvZ2dsZWQ/Y29uc29sZS53YXJuKCJUb2dnbGVkIHNpZ25hbHMgc2hvdWxkIG9ubHkgYmUgZmlyZWQgb25jZSwgb3IgdW50b2dnbGVkIGJlZm9yZSByZS1maXJpbmcuLiIpOih0aGlzLl9fdG9nZ2xlZD0hMCx0aGlzLl9fZGF0YT10KSk7Y29uc3QgZT10aGlzLl9fc2xvdHMubGVuZ3RoO2ZvcihsZXQgcz0wO3M8ZTtzKyspe2NvbnN0IGU9dGhpcy5fX3Nsb3RzW3NdO2UmJmUoLi4udCl9fWlzVG9nZ2xlZCgpe3JldHVybiB0aGlzLl9fdG9nZ2xlZH1zZXRUb2dnbGVkKHQpe3RoaXMuX190b2dnbGVkPXQsdGhpcy5fX2RhdGE9dm9pZCAwfWdldE51bUNvbm5lY3Rpb25zKCl7cmV0dXJuIHRoaXMuX19zbG90cy5sZW5ndGh9dW50b2dnbGUoKXt0aGlzLl9fdG9nZ2xlZD0hMSx0aGlzLl9fZGF0YT12b2lkIDB9fWNvbnN0IEk9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzPXt9LHRoaXMuX19jbGFzc05hbWVzPXt9fXJlZ2lzdGVyQ2xhc3ModCxlKXt0aGlzLl9fcmVnaXN0ZXJlZENsYXNzZXNbdF09e2NsczplLGNhbGxiYWNrczpbXX0sdGhpcy5fX2NsYXNzTmFtZXNbZS5uYW1lXT10fXJlZ2lzdGVyQ2FsbGJhY2sodCxlKXtjb25zdCBzPXRoaXMuX19yZWdpc3RlcmVkQ2xhc3Nlc1t0XTtzP3MuY2FsbGJhY2tzLnB1c2goZSk6Y29uc29sZS53YXJuKCJGYWN0b3J5IG5vdCByZWdpc3RlcmVkOiIrdCl9Z2V0Q2xhc3ModCl7aWYodGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzW3RdKXJldHVybiB0aGlzLl9fcmVnaXN0ZXJlZENsYXNzZXNbdF0uY2xzfWdldENsYXNzTmFtZSh0KXtyZXR1cm4gdGhpcy5fX2NsYXNzTmFtZXNbdC5jb25zdHJ1Y3Rvci5uYW1lXT90aGlzLl9fY2xhc3NOYW1lc1t0LmNvbnN0cnVjdG9yLm5hbWVdOnQuY29uc3RydWN0b3IubmFtZX1pc0NvbnN0cnVjdGluZygpe3JldHVybiB0aGlzLl9fY29uc3RydWN0aW5nfWNvbnN0cnVjdENsYXNzKHQpe2NvbnN0IGU9dGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzW3RdO2lmKCFlKXJldHVybiBjb25zb2xlLndhcm4oIkZhY3Rvcnkgbm90IHJlZ2lzdGVyZWQ6Iit0KSxudWxsO3RoaXMuX19jb25zdHJ1Y3Rpbmc9ITA7Y29uc3Qgcz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksYT1uZXcgZS5jbHMoLi4ucyk7cmV0dXJuIHRoaXMuX19jb25zdHJ1Y3Rpbmc9ITEsdGhpcy5pbnZva2VDYWxsYmFja3MoYSksYX1pbnZva2VDYWxsYmFja3ModCl7aWYodGhpcy5fX2NsYXNzTmFtZXNbdC5jb25zdHJ1Y3Rvci5uYW1lXSl7Y29uc3QgZT10aGlzLl9fcmVnaXN0ZXJlZENsYXNzZXNbdGhpcy5fX2NsYXNzTmFtZXNbdC5jb25zdHJ1Y3Rvci5uYW1lXV07Zm9yKGNvbnN0IHMgb2YgZS5jYWxsYmFja3Mpcyh0KX19fSxOPTMsRj0yO2xldCB6PTA7Y2xhc3MgVntjb25zdHJ1Y3Rvcih0LGUscyl7aWYodGhpcy5fX2RhdGFUeXBlPXQsdGhpcy5ub3JtYWxpemVkPSExLG51bGwhPXQubnVtRWxlbWVudHMpdGhpcy5fX2RpbWVuc2lvbj10aGlzLl9fZGF0YVR5cGUubnVtRWxlbWVudHMoKTtlbHNlIHN3aXRjaCh0KXtjYXNlIDY6Y2FzZSA0OmNhc2UgNTp0aGlzLl9fZGltZW5zaW9uPTE7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZGF0YSB0eXBlIGZvciBhdHRyaWJ1dGU6Iit0KX12YXIgYTt0aGlzLl9fZGVmYXVsdEVsZW1lbnRWYWx1ZT1udWxsIT1zP3M6TnVtYmVyLk1BWF9WQUxVRSwoYT1lKSYmdm9pZCAwIT09YS5ieXRlTGVuZ3RoP3RoaXMuX19kYXRhPWU6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoZSp0aGlzLl9fZGltZW5zaW9uKSx0aGlzLmluaXRSYW5nZSgwKSl9cmVzaXplKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGEubGVuZ3RoLHM9dCp0aGlzLl9fZGltZW5zaW9uLGE9bmV3IEZsb2F0MzJBcnJheShzKTtmb3IobGV0IHQ9MDt0PE1hdGgubWluKHRoaXMuX19kYXRhLmxlbmd0aCxzKTt0KyspYVt0XT10aGlzLl9fZGF0YVt0XTt0aGlzLl9fZGF0YS5sZW5ndGg8cyYmKHRoaXMuX19kYXRhPWEpLHRoaXMuaW5pdFJhbmdlKGUpfWluaXRSYW5nZSh0KXtmb3IobGV0IGU9dDtlPHRoaXMuX19kYXRhLmxlbmd0aDtlKyspdGhpcy5fX2RhdGFbZV09dGhpcy5fX2RlZmF1bHRFbGVtZW50VmFsdWV9Z2V0Q291bnQoKXtyZXR1cm4gdGhpcy5fX2RhdGEubGVuZ3RoL3RoaXMuX19kaW1lbnNpb259Z2V0IGxlbmd0aCgpe3JldHVybiB0aGlzLl9fZGF0YS5sZW5ndGgvdGhpcy5fX2RpbWVuc2lvbn1nZXQgZGF0YVR5cGUoKXtyZXR1cm4gdGhpcy5fX2RhdGFUeXBlfWdldCBkYXRhKCl7cmV0dXJuIHRoaXMuX19kYXRhfXNldCBkYXRhKHQpe3RoaXMuX19kYXRhPXR9Z2V0IG51bUVsZW1lbnRzKCl7cmV0dXJuIHRoaXMuX19kaW1lbnNpb259Z2V0RmxvYXQzMlZhbHVlKHQpe3JldHVybiB0aGlzLl9fZGF0YVt0XX1zZXRGbG9hdDMyVmFsdWUodCxlKXt0aGlzLl9fZGF0YVt0XT1lfWdldFZhbHVlUmVmKHQpe2NvbnN0IGU9dGhpcy5fX2RpbWVuc2lvbjtpZih0Pj10aGlzLl9fZGF0YS5sZW5ndGgvZSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdmVydGV4IGluZGV4OiIrdCsiLiBOdW0gVmVydGljZXM6Iit0aGlzLl9fZGF0YS5sZW5ndGgvMyk7cmV0dXJuIHRoaXMuX19kYXRhVHlwZS5jcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0aGlzLl9fZGF0YS5idWZmZXIsdCplKX1zZXRWYWx1ZSh0LGUpe2NvbnN0IHM9dGhpcy5fX2RpbWVuc2lvbjtpZih0Pj10aGlzLl9fZGF0YS5sZW5ndGgvcyl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdmVydGV4IGluZGV4OiIrdCsiLiBOdW0gVmVydGljZXM6Iit0aGlzLl9fZGF0YS5sZW5ndGgvMyk7dGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlcix0KnMpLnNldEZyb21PdGhlcihlKX10b0pTT04odCxlKXtyZXR1cm57ZGF0YTpBcnJheS5mcm9tKHRoaXMuX19kYXRhKSxkYXRhVHlwZTphLmdldFR5cGVOYW1lKHRoaXMuX19kYXRhVHlwZSksZGVmYXVsdFZhbHVlOnRoaXMuX19kZWZhdWx0RWxlbWVudFZhbHVlLGxlbmd0aDp0aGlzLl9fZGF0YS5sZW5ndGgvdGhpcy5fX2RpbWVuc2lvbn19ZnJvbUpTT04odCl7dGhpcy5fX2RhdGE9RmxvYXQzMkFycmF5LmZyb20odC5kYXRhKX10b1N0cmluZygpe3JldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpLG51bGwsMil9fWNsYXNzIE0gZXh0ZW5kcyBjbGFzc3tjb25zdHJ1Y3Rvcigpe3RoaXMuX19pZD0rK3osdGhpcy5fX3BhcmFtcz1bXSx0aGlzLl9fcGFyYW1NYXBwaW5nPXt9LHRoaXMuX19wYXJhbVNpZ25hbElkcz17fSx0aGlzLnBhcmFtZXRlckFkZGVkPW5ldyB3LHRoaXMucGFyYW1ldGVyUmVtb3ZlZD1uZXcgdyx0aGlzLnBhcmFtZXRlclZhbHVlQ2hhbmdlZD1uZXcgd31nZXRJZCgpe3JldHVybiB0aGlzLl9faWR9bnVtUGFyYW1ldGVycygpe3JldHVybiB0aGlzLl9fcGFyYW1zLmxlbmd0aH1nZXRQYXJhbWV0ZXJzKCl7cmV0dXJuIHRoaXMuX19wYXJhbXN9Z2V0UGFyYW1ldGVySW5kZXgodCl7cmV0dXJuIHRoaXMuX19wYXJhbU1hcHBpbmdbdF19Z2V0UGFyYW1ldGVyQnlJbmRleCh0KXtyZXR1cm4gdGhpcy5fX3BhcmFtc1t0XX1oYXNQYXJhbWV0ZXIodCl7cmV0dXJuIHQgaW4gdGhpcy5fX3BhcmFtTWFwcGluZ31nZXRQYXJhbWV0ZXIodCl7Y29uc3QgZT10aGlzLl9fcGFyYW1NYXBwaW5nW3RdO3JldHVybi0xPT1lP251bGw6dGhpcy5fX3BhcmFtc1tlXX1fX3BhcmFtZXRlclZhbHVlQ2hhbmdlZCh0LGUpe3RoaXMucGFyYW1ldGVyVmFsdWVDaGFuZ2VkLmVtaXQodCxlKX1hZGRQYXJhbWV0ZXIodCl7Y29uc3QgZT10LmdldE5hbWUoKTtyZXR1cm4gbnVsbCE9dGhpcy5fX3BhcmFtTWFwcGluZ1tlXSYmKGNvbnNvbGUud2FybigiUmVwbGFjaW5nIFBhcmFtZXRlcjoiK2UpLHRoaXMucmVtb3ZlUGFyYW1ldGVyKGUpKSx0aGlzLl9fcGFyYW1TaWduYWxJZHNbZV09dC52YWx1ZUNoYW5nZWQuY29ubmVjdChlPT50aGlzLl9fcGFyYW1ldGVyVmFsdWVDaGFuZ2VkKHQsZSkpLHRoaXMuX19wYXJhbXMucHVzaCh0KSx0aGlzLl9fcGFyYW1NYXBwaW5nW2VdPXRoaXMuX19wYXJhbXMubGVuZ3RoLTEsdGhpcy5wYXJhbWV0ZXJBZGRlZC5lbWl0KGUpLHR9aW5zZXJ0UGFyYW1ldGVyKHQsZSl7Y29uc3Qgcz10LmdldE5hbWUoKTtudWxsIT10aGlzLl9fcGFyYW1NYXBwaW5nW3NdJiYoY29uc29sZS53YXJuKCJSZXBsYWNpbmcgUGFyYW1ldGVyOiIrcyksdGhpcy5yZW1vdmVQYXJhbWV0ZXIocykpLHRoaXMuX19wYXJhbVNpZ25hbElkc1tzXT10LnZhbHVlQ2hhbmdlZC5jb25uZWN0KGU9PnRoaXMuX19wYXJhbWV0ZXJWYWx1ZUNoYW5nZWQodCxlKSksdGhpcy5fX3BhcmFtcy5zcGxpY2UoZSwwLHQpO2NvbnN0IGE9e307Zm9yKGxldCB0PTA7dDx0aGlzLl9fcGFyYW1zLmxlbmd0aDt0KyspYVt0aGlzLl9fcGFyYW1zW3RdLmdldE5hbWUoKV09dDtyZXR1cm4gdGhpcy5fX3BhcmFtTWFwcGluZz1hLHRoaXMucGFyYW1ldGVyQWRkZWQuZW1pdChzKSx0fXJlbW92ZVBhcmFtZXRlcih0KXtudWxsPT10aGlzLl9fcGFyYW1NYXBwaW5nW3RdJiZjb25zb2xlLnRocm93KCJVbmFibGUgdG8gUmVtb3ZlIFBhcmFtZXRlcjoiK3QpO2NvbnN0IGU9dGhpcy5fX3BhcmFtTWFwcGluZ1t0XTt0aGlzLl9fcGFyYW1zW3RoaXMuX19wYXJhbU1hcHBpbmdbdF1dLnZhbHVlQ2hhbmdlZC5kaXNjb25uZWN0SWQodGhpcy5fX3BhcmFtU2lnbmFsSWRzW3RdKSx0aGlzLl9fcGFyYW1zLnNwbGljZShlLDEpO2NvbnN0IHM9e307Zm9yKGxldCB0PTA7dDx0aGlzLl9fcGFyYW1zLmxlbmd0aDt0Kyspc1t0aGlzLl9fcGFyYW1zW3RdLmdldE5hbWUoKV09dDt0aGlzLl9fcGFyYW1NYXBwaW5nPXMsdGhpcy5wYXJhbWV0ZXJSZW1vdmVkLmVtaXQodCl9cmVwbGFjZVBhcmFtZXRlcih0KXtjb25zdCBlPXQuZ2V0TmFtZSgpLHM9dGhpcy5fX3BhcmFtTWFwcGluZ1tlXTtyZXR1cm4gdGhpcy5fX3BhcmFtc1t0aGlzLl9fcGFyYW1NYXBwaW5nW2VdXS52YWx1ZUNoYW5nZWQuZGlzY29ubmVjdElkKHRoaXMuX19wYXJhbVNpZ25hbElkc1tlXSksdGhpcy5fX3BhcmFtU2lnbmFsSWRzW2VdPXQudmFsdWVDaGFuZ2VkLmNvbm5lY3QoZT0+dGhpcy5fX3BhcmFtZXRlclZhbHVlQ2hhbmdlZCh0LGUpKSx0aGlzLl9fcGFyYW1zW3NdPXQsdH10b0pTT04odCxlKXtjb25zdCBzPXt9O2xldCBhPTA7Zm9yKGNvbnN0IGkgb2YgdGhpcy5fX3BhcmFtcylpZihpLnRlc3RGbGFnKEYpKWlmKGkubnVtUmVmcygpPjEmJjAhPWkuZ2V0UmVmSW5kZXgodGhpcykpc1tpLmdldE5hbWUoKV09e3BhcmFtUGF0aDp0Lm1ha2VSZWxhdGl2ZShpLmdldFBhdGgoKSl9LGErKztlbHNle2NvbnN0IHI9aS50b0pTT04odCxlKTtyJiYoc1tpLmdldE5hbWUoKV09cixhKyspfWlmKGE+MClyZXR1cm57cGFyYW1zOnN9fWZyb21KU09OKHQsZSxzKXtpZih0LnBhcmFtcylmb3IoY29uc3QgcyBpbiB0LnBhcmFtcyl7Y29uc3QgYT10LnBhcmFtc1tzXSxpPXRoaXMuZ2V0UGFyYW1ldGVyKHMpO2k/YS5wYXJhbVBhdGg/ZS5yZXNvbHZlUGF0aChhLnBhcmFtUGF0aCx0PT57dGhpcy5yZXBsYWNlUGFyYW1ldGVyKHQpfSx0PT57Y29uc29sZS53YXJuKCJVbmFibGUgdG8gcmVzb2x2ZSBzaGFyZWQgcGFyYW1ldGVyOiIrYS5wYXJhbVBhdGgpfSk6aS5mcm9tSlNPTihhLGUpOmNvbnNvbGUud2FybigiUGFyYW0gbm90IGZvdW5kOiIrcyl9fXJlYWRCaW5hcnkodCxlKXtpZihlLnZlcnNpb25zWyJ6ZWEtZW5naW5lIl0uZ3JlYXRlck9yRXF1YWxUaGFuKFswLDAsM10pKXtjb25zdCBzPXQubG9hZFVJbnQzMigpO2ZvcihsZXQgYT0wO2E8czthKyspe2NvbnN0IHM9dC5sb2FkU3RyKCksYT10LmxvYWRTdHIoKTtsZXQgaT10aGlzLmdldFBhcmFtZXRlcihhKTtpZighaSl7aWYoaT1JLmNvbnN0cnVjdENsYXNzKHMsYSksIWkpe2NvbnNvbGUuZXJyb3IoIlVuYWJsZSB0byBjb25zdHJ1Y3QgcHJvcDoiK2ErIiBvZiB0eXBlOiIrcyk7Y29udGludWV9dGhpcy5hZGRQYXJhbWV0ZXIoaSl9aS5yZWFkQmluYXJ5KHQsZSl9fX10b1N0cmluZygpe3JldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpLG51bGwsMil9Y29weUZyb20odCxlKXtsZXQgcz10Lm51bVBhcmFtZXRlcnMoKTtmb3IoO3MtLTspe2NvbnN0IGU9dC5nZXRQYXJhbWV0ZXJCeUluZGV4KHMpLGE9dGhpcy5nZXRQYXJhbWV0ZXIoZS5nZXROYW1lKCkpO2E/YS5zZXRWYWx1ZShlLmdldFZhbHVlKCksTik6dGhpcy5hZGRQYXJhbWV0ZXIoZS5jbG9uZSgpKX19ZGVzdHJveSgpe2Zvcihjb25zdCB0IG9mIHRoaXMuX19wYXJhbXMpdC5kZXN0cm95KCk7c3VwZXIuZGVzdHJveSgpfX17Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuX19ib3VuZGluZ0JveD1uZXcgcCx0aGlzLl9fYm91bmRpbmdCb3hEaXJ0eT0hMCx0aGlzLl9fdmVydGV4QXR0cmlidXRlcz1uZXcgTWFwLHRoaXMuX19tZXRhRGF0YT1uZXcgTWFwLHRoaXMuYWRkVmVydGV4QXR0cmlidXRlKCJwb3NpdGlvbnMiLHIsMCksdGhpcy5ib3VuZGluZ0JveERpcnRpZWQ9bmV3IHcsdGhpcy5nZW9tRGF0YUNoYW5nZWQ9bmV3IHcsdGhpcy5nZW9tRGF0YVRvcG9sb2d5Q2hhbmdlZD1uZXcgd31zZXREZWJ1Z05hbWUodCl7dGhpcy5fX25hbWU9dH1hZGRWZXJ0ZXhBdHRyaWJ1dGUodCxlLHMpe2xldCBhO3ZhciBpO3JldHVybiBhPShpPXMpJiZ2b2lkIDAhPT1pLmJ5dGVMZW5ndGg/bmV3IFYoZSxzKTpuZXcgVihlLG51bGwhPXRoaXMudmVydGljZXM/dGhpcy52ZXJ0aWNlcy5sZW5ndGg6MCxzKSx0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5zZXQodCxhKSxhfWhhc1ZlcnRleEF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuaGFzKHQpfWdldFZlcnRleEF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZ2V0KHQpfWdldFZlcnRleEF0dHJpYnV0ZXModCl7Y29uc3QgZT17fTtmb3IoY29uc3RbdCxzXW9mIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLmVudHJpZXMoKSllW3RdPXM7cmV0dXJuIGV9Z2V0IHZlcnRpY2VzKCl7cmV0dXJuIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLmdldCgicG9zaXRpb25zIil9bnVtVmVydGljZXMoKXtyZXR1cm4gdGhpcy52ZXJ0aWNlcy5sZW5ndGh9Z2V0TnVtVmVydGljZXMoKXtyZXR1cm4gdGhpcy52ZXJ0aWNlcy5sZW5ndGh9c2V0TnVtVmVydGljZXModCl7dGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZm9yRWFjaChlPT5lLnJlc2l6ZSh0KSl9Z2V0VmVydGV4KHQpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMudmVydGljZXMuZGF0YS5idWZmZXIsMyp0KX1zZXRWZXJ0ZXgodCxlKXtyZXR1cm4gci5jcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0aGlzLnZlcnRpY2VzLmRhdGEuYnVmZmVyLDMqdCkuc2V0RnJvbU90aGVyKGUpfW1vdmVWZXJ0aWNlcyh0KXtjb25zdCBlPXRoaXMudmVydGljZXM7Zm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKyspZS5nZXRWYWx1ZVJlZihzKS5hZGRJblBsYWNlKHQpO3RoaXMuc2V0Qm91bmRpbmdCb3hEaXJ0eSgpfXRyYW5zZm9ybVZlcnRpY2VzKHQpe2NvbnN0IGU9dGhpcy52ZXJ0aWNlcztmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl7Y29uc3QgYT1lLmdldFZhbHVlUmVmKHMpLGk9dC50cmFuc2Zvcm1WZWMzKGEpO2Euc2V0KGkueCxpLnksaS56KX10aGlzLnNldEJvdW5kaW5nQm94RGlydHkoKX1nZXQgYm91bmRpbmdCb3goKXtyZXR1cm4gdGhpcy5fX2JvdW5kaW5nQm94RGlydHkmJnRoaXMudXBkYXRlQm91bmRpbmdCb3goKSx0aGlzLl9fYm91bmRpbmdCb3h9c2V0Qm91bmRpbmdCb3hEaXJ0eSgpe3RoaXMuX19ib3VuZGluZ0JveERpcnR5PSEwLHRoaXMuYm91bmRpbmdCb3hEaXJ0aWVkLmVtaXQoKX11cGRhdGVCb3VuZGluZ0JveCgpe2NvbnN0IHQ9dGhpcy52ZXJ0aWNlcyxlPW5ldyBwLHM9dC5sZW5ndGg7Zm9yKGxldCBhPTA7YTxzO2ErKyllLmFkZFBvaW50KHQuZ2V0VmFsdWVSZWYoYSkpO3RoaXMuX19ib3VuZGluZ0JveD1lLHRoaXMuX19ib3VuZGluZ0JveERpcnR5PSExfWdldE1ldGFkYXRhKHQpe3JldHVybiB0aGlzLl9fbWV0YURhdGEuZ2V0KHQpfWhhc01ldGFkYXRhKHQpe3JldHVybiB0aGlzLl9fbWV0YURhdGEuaGFzKHQpfXNldE1ldGFkYXRhKHQsZSl7dGhpcy5fX21ldGFEYXRhLnNldCh0LGUpfWRlbGV0ZU1ldGFkYXRhKHQpe3RoaXMuX19tZXRhRGF0YS5kZWxldGUodCl9Z2VuQnVmZmVycyh0KXtjb25zdCBlPXt9O2Zvcihjb25zdFt0LHNdb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMpZVt0XT17dmFsdWVzOnMuZGF0YSxjb3VudDpzLnNpemUsZGF0YVR5cGU6cy5kYXRhVHlwZSxub3JtYWxpemVkOnMubm9ybWFsaXplZH07cmV0dXJue251bVZlcnRpY2VzOnRoaXMubnVtVmVydGljZXMoKSxhdHRyQnVmZmVyczplfX1mcmVlQnVmZmVycygpe31sb2FkQmFzZUdlb21CaW5hcnkodCl7dGhpcy5uYW1lPXQubG9hZFN0cigpO2NvbnN0IGU9dC5sb2FkVUludDgoKTt0aGlzLmRlYnVnQ29sb3I9dC5sb2FkUkdCRmxvYXQzMkNvbG9yKCk7Y29uc3Qgcz10LmxvYWRVSW50MzIoKTt0aGlzLl9fYm91bmRpbmdCb3guc2V0KHQubG9hZEZsb2F0MzJWZWMzKCksdC5sb2FkRmxvYXQzMlZlYzMoKSksdGhpcy5zZXROdW1WZXJ0aWNlcyhzKTtjb25zdCBhPXRoaXMudmVydGljZXM7bGV0IG4saDsyJmUmJihuPXRoaXMuZ2V0VmVydGV4QXR0cmlidXRlKCJub3JtYWxzIiksbnx8KG49dGhpcy5hZGRWZXJ0ZXhBdHRyaWJ1dGUoIm5vcm1hbHMiLHIsMCkpKSw0JmUmJihoPXRoaXMuZ2V0VmVydGV4QXR0cmlidXRlKCJ0ZXhDb29yZHMiKSxofHwoaD10aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgidGV4Q29vcmRzIixpLDApKSk7Y29uc3Qgbz0odCxlLHMsaSk9Pntmb3IobGV0IG49dFswXTtuPHRbMV07bisrKXtjb25zdCB0PW5ldyByKGlbMypuKzBdLzI1NSxpWzMqbisxXS8yNTUsaVszKm4rMl0vMjU1KTt0Lm11bHRpcGx5SW5QbGFjZShzKSx0LmFkZEluUGxhY2UoZSksYS5zZXRWYWx1ZShuLHQpfX0sXz0odCxlLHMsYSk9PntzLmlzTnVsbCgpJiZzLnNldCgxLDEsMSk7Zm9yKGxldCBpPXRbMF07aTx0WzFdO2krKyl7Y29uc3QgdD1uZXcgcihhWzMqaSswXS8yNTUsYVszKmkrMV0vMjU1LGFbMyppKzJdLzI1NSk7dC5tdWx0aXBseUluUGxhY2UocyksdC5hZGRJblBsYWNlKGUpLHQubm9ybWFsaXplSW5QbGFjZSgpLG4uc2V0VmFsdWUoaSx0KX19LGQ9KHQsZSxzLGEpPT57Zm9yKGxldCByPXRbMF07cjx0WzFdO3IrKyl7Y29uc3QgdD1uZXcgaShhWzIqciswXS8yNTUsYVsyKnIrMV0vMjU1KTt0Lm11bHRpcGx5SW5QbGFjZShzKSx0LmFkZEluUGxhY2UoZSksaC5zZXRWYWx1ZShyLHQpfX0sbD10LmxvYWRVSW50MzIoKTtpZigxPT1sKXt7Y29uc3QgZT10aGlzLl9fYm91bmRpbmdCb3gsYT10LmxvYWRVSW50OEFycmF5KDMqcyk7byhbMCxzXSxlLnAwLGUuZGlhZ29uYWwoKSxhKX1pZihuKXtjb25zdCBlPW5ldyBwKHQubG9hZEZsb2F0MzJWZWMzKCksdC5sb2FkRmxvYXQzMlZlYzMoKSksYT10LmxvYWRVSW50OEFycmF5KDMqcyk7XyhbMCxzXSxlLnAwLGUuZGlhZ29uYWwoKSxhKSxuLmxvYWRTcGxpdFZhbHVlcyh0KX1pZihoKXtjb25zdCBlPW5ldyBnKHQubG9hZEZsb2F0MzJWZWMyKCksdC5sb2FkRmxvYXQzMlZlYzIoKSksYT10LmxvYWRVSW50OEFycmF5KDIqcyk7ZChbMCxzXSxlLnAwLGUuZGlhZ29uYWwoKSxhKSxoLmxvYWRTcGxpdFZhbHVlcyh0KX19ZWxzZXtjb25zdCBlPVtdO2xldCBhPTA7Zm9yKGxldCBzPTA7czxsO3MrKyl7Y29uc3Qgcz10LmxvYWRVSW50MzIoKSxpPXtyYW5nZTpbYSxhK3NdLGJib3g6bmV3IHAodC5sb2FkRmxvYXQzMlZlYzMoKSx0LmxvYWRGbG9hdDMyVmVjMygpKX07biYmKGkubm9ybWFsc1JhbmdlPW5ldyBwKHQubG9hZEZsb2F0MzJWZWMzKCksdC5sb2FkRmxvYXQzMlZlYzMoKSkpLGgmJihpLnRleENvb3Jkc1JhbmdlPW5ldyBnKHQubG9hZEZsb2F0MzJWZWMyKCksdC5sb2FkRmxvYXQzMlZlYzIoKSkpLGUucHVzaChpKSxhKz1zfWNvbnN0IGk9dC5sb2FkVUludDhBcnJheSgzKnMpO2xldCByLGM7biYmKHI9dC5sb2FkVUludDhBcnJheSgzKnMpKSxoJiYoYz10LmxvYWRVSW50OEFycmF5KDIqcykpO2ZvcihsZXQgdD0wO3Q8bDt0Kyspe3tjb25zdCBzPWVbdF0uYmJveDtvKGVbdF0ucmFuZ2Uscy5wMCxzLmRpYWdvbmFsKCksaSl9aWYobil7Y29uc3Qgcz1lW3RdLm5vcm1hbHNSYW5nZTtfKGVbdF0ucmFuZ2Uscy5wMCxzLmRpYWdvbmFsKCkscil9aWYoaCl7Y29uc3Qgcz1lW3RdLnRleENvb3Jkc1JhbmdlO2QoZVt0XS5yYW5nZSxzLnAwLHMuZGlhZ29uYWwoKSxjKX19biYmbi5sb2FkU3BsaXRWYWx1ZXModCksaCYmaC5sb2FkU3BsaXRWYWx1ZXModCl9fXRvSlNPTih0LGUpe2xldCBzPXN1cGVyLnRvSlNPTih0LGUpO2lmKHN8fChzPXt9KSxzLnR5cGU9SS5nZXRDbGFzc05hbWUodGhpcyksISgxMDI0JmUpKXtjb25zdCBhPXt9O2Zvcihjb25zdFtzLGldb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZW50cmllcygpKWFbc109aS50b0pTT04odCxlKTtzLnZlcnRleEF0dHJpYnV0ZXM9YX1yZXR1cm4gc31mcm9tSlNPTih0LGUscyl7c3VwZXIuZnJvbUpTT04odCxlLHMpO2Zvcihjb25zdCBlIGluIHQudmVydGV4QXR0cmlidXRlcyl7bGV0IHM9dGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZ2V0KGUpO2NvbnN0IGk9dC52ZXJ0ZXhBdHRyaWJ1dGVzW2VdO2lmKCFzKXtjb25zdCB0PWEuZ2V0VHlwZShpLmRhdGFUeXBlKTtzPW5ldyBWZXJ0ZXhBdHRyaWJ1dGUodGhpcyx0LDAsaS5kZWZhdWx0U2NhbGFyVmFsdWUpLHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLnNldChlLHMpfXMuZnJvbUpTT04oaSl9fXRvU3RyaW5nKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCksbnVsbCwyKX19Y2xhc3MgQSBleHRlbmRzIE17Y29uc3RydWN0b3IoKXtzdXBlcigpfWxvYWRCaW4odCl7dGhpcy5uYW1lPXQubG9hZFN0cigpO2NvbnN0IGU9dC5sb2FkVUludDMyKCk7dGhpcy5fX2JvdW5kaW5nQm94LnNldCh0LmxvYWRGbG9hdDMyVmVjMygpLHQubG9hZEZsb2F0MzJWZWMzKCkpLHRoaXMuc2V0TnVtVmVydGljZXMoZSk7Y29uc3Qgcz10aGlzLnZlcnRpY2VzO2lmKGU8MjU2KXtjb25zdCBhPXRoaXMuX19ib3VuZGluZ0JveC50b01hdDQoKSxpPXQubG9hZFVJbnQ4QXJyYXkoMyplKTtmb3IobGV0IHQ9MDt0PGU7dCsrKXtjb25zdCBlPW5ldyBWZWMzKGlbMyp0KzBdLzI1NSxpWzMqdCsxXS8yNTUsaVszKnQrMl0vMjU1KTtzLnNldFZhbHVlKHQsYS50cmFuc2Zvcm1WZWMzKGUpKX19ZWxzZXtjb25zdCBhPXQubG9hZFVJbnQzMigpLGk9W107Zm9yKGxldCBlPTA7ZTxhO2UrKyl7Y29uc3QgZT10LmxvYWRVSW50MzJWZWMyKCkscz10LmxvYWRGbG9hdDMyVmVjMygpLGE9dC5sb2FkRmxvYXQzMlZlYzMoKTtpLnB1c2goe3JhbmdlOmUsYmJveDpuZXcgQm94MyhzLGEpfSl9Y29uc3Qgcj10LmxvYWRVSW50OEFycmF5KDMqZSk7Zm9yKGxldCB0PTA7dDxhO3QrKyl7Y29uc3QgZT1pW3RdLmJib3gudG9NYXQ0KCk7Zm9yKGxldCBhPWlbdF0ucmFuZ2UueDthPGlbdF0ucmFuZ2UueTthKyspe2NvbnN0IHQ9bmV3IFZlYzMoclszKmErMF0vMjU1LHJbMyphKzFdLzI1NSxyWzMqYSsyXS8yNTUpO3Muc2V0VmFsdWUoYSxlLnRyYW5zZm9ybVZlYzModCkpfX19fXJlYWRCaW5hcnkodCxlKXtzdXBlci5sb2FkQmFzZUdlb21CaW5hcnkodCksdGhpcy5nZW9tRGF0YUNoYW5nZWQuZW1pdCgpfX1jbGFzcyBTIGV4dGVuZHMgTXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5fX2luZGljZXM9bmV3IFVpbnQzMkFycmF5LHRoaXMuX19zZWdtZW50QXR0cmlidXRlcz1uZXcgTWFwLHRoaXMubGluZVRoaWNrbmVzcz0wfWdldEluZGljZXMoKXtyZXR1cm4gdGhpcy5fX2luZGljZXN9Z2V0TnVtU2VnbWVudHMoKXtyZXR1cm4gdGhpcy5fX2luZGljZXMubGVuZ3RoLzJ9c2V0TnVtU2VnbWVudHModCl7Y29uc3QgZT1uZXcgVWludDMyQXJyYXkoMip0KTt0aGlzLl9faW5kaWNlcz1lfXNldFNlZ21lbnQodCxlLHMpe2lmKHQ+PXRoaXMuX19pbmRpY2VzLmxlbmd0aC8yKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBsaW5lIGluZGV4OiIrdCsiLiBOdW0gU2VnbWVudHM6Iit0aGlzLl9faW5kaWNlcy5sZW5ndGgvMik7dGhpcy5fX2luZGljZXNbMip0KzBdPWUsdGhpcy5fX2luZGljZXNbMip0KzFdPXN9Z2V0U2VnbWVudFZlcnRleEluZGV4KHQsZSl7aWYodDx0aGlzLm51bUxpbmVzKXJldHVybiB0aGlzLl9faW5kaWNlc1syKnQrZV19YWRkU2VnbWVudEF0dHJpYnV0ZSh0LGUscyl7Y29uc3QgYT1uZXcgQXR0cmlidXRlKGUsbnVsbCE9cz9zOnRoaXMucG9seWdvbkNvdW50KTtyZXR1cm4gdGhpcy5fX3NlZ21lbnRBdHRyaWJ1dGVzLnNldCh0LGEpLGF9aGFzU2VnbWVudEF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX3NlZ21lbnRBdHRyaWJ1dGVzLmhhcyh0KX1nZXRTZWdtZW50QXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fc2VnbWVudEF0dHJpYnV0ZXMuZ2V0KHQpfWdlbkJ1ZmZlcnMoKXtjb25zdCB0PXN1cGVyLmdlbkJ1ZmZlcnMoKTtsZXQgZTtyZXR1cm4gdC5udW1WZXJ0aWNlczxNYXRoLnBvdygyLDgpPyhlPW5ldyBVaW50OEFycmF5KHRoaXMuX19pbmRpY2VzLmxlbmd0aCksdGhpcy5fX2luZGljZXMuZm9yRWFjaCgodCxzKT0+e2Vbc109dH0pKTp0Lm51bVZlcnRpY2VzPE1hdGgucG93KDIsMTYpPyhlPW5ldyBVaW50MTZBcnJheSh0aGlzLl9faW5kaWNlcy5sZW5ndGgpLHRoaXMuX19pbmRpY2VzLmZvckVhY2goKHQscyk9PntlW3NdPXR9KSk6ZT10aGlzLl9faW5kaWNlcyx0LmluZGljZXM9ZSx0fXJlYWRCaW5hcnkodCxlKXtzdXBlci5sb2FkQmFzZUdlb21CaW5hcnkodCksdGhpcy5zZXROdW1TZWdtZW50cyh0LmxvYWRVSW50MzIoKSk7Y29uc3Qgcz10LmxvYWRVSW50OCgpOzE9PXM/dGhpcy5fX2luZGljZXM9dC5sb2FkVUludDhBcnJheSgpOjI9PXM/dGhpcy5fX2luZGljZXM9dC5sb2FkVUludDE2QXJyYXkoKTo0PT1zJiYodGhpcy5fX2luZGljZXM9dC5sb2FkVUludDMyQXJyYXkoKSksdGhpcy5nZW9tRGF0YUNoYW5nZWQuZW1pdCgpfXRvSlNPTih0LGUpe2NvbnN0IHM9c3VwZXIudG9KU09OKHQsZSk7cmV0dXJuIDEwMjQmZXx8KHMuaW5kaWNlcz1BcnJheS5mcm9tKHRoaXMuX19pbmRpY2VzKSksc31mcm9tSlNPTih0LGUscyl7c3VwZXIuZnJvbUpTT04odCxlLHMpLHRoaXMuX19pbmRpY2VzPVVpbnQzMkFycmF5LmZyb20odC5pbmRpY2VzKX19Y2xhc3MgTyBleHRlbmRzIFZ7Y29uc3RydWN0b3IodCxlLHMsYSl7c3VwZXIoZSxzLGEpLHRoaXMuX19nZW9tPXQsdGhpcy5fX3NwbGl0cz17fSx0aGlzLl9fc3BsaXRWYWx1ZXM9W119Z2V0RmFjZVZlcnRleFZhbHVlUmVmKHQsZSl7Y29uc3Qgcz10aGlzLl9fZ2VvbS5nZXRGYWNlVmVydGV4SW5kZXgodCxlKTtyZXR1cm4gcyBpbiB0aGlzLl9fc3BsaXRzJiZ0IGluIHRoaXMuX19zcGxpdHNbc10/dGhpcy5fX3NwbGl0VmFsdWVzW3RoaXMuX19zcGxpdHNbc11bdF1dOnRoaXMuZ2V0VmFsdWVSZWYocyl9c2V0RmFjZVZlcnRleFZhbHVlKHQsZSxzKXtjb25zdCBhPXRoaXMuX19nZW9tLmdldEZhY2VWZXJ0ZXhJbmRleCh0LGUpO3RoaXMuc2V0RmFjZVZlcnRleFZhbHVlX0J5VmVydGV4SW5kZXgodCxhLHMpfXNldEZhY2VWZXJ0ZXhWYWx1ZV9CeVZlcnRleEluZGV4KHQsZSxzKXtjb25zdCBhPXRoaXMuZ2V0VmFsdWVSZWYoZSk7aWYoYS5pc1ZhbGlkKCkpaWYoYS5hcHByb3hFcXVhbChzKSk7ZWxzZXtpZihlIGluIHRoaXMuX19zcGxpdHMpe2NvbnN0IGE9dGhpcy5fX3NwbGl0c1tlXTtmb3IoY29uc3QgZSBpbiBhKXtjb25zdCBpPWFbZV07aWYodGhpcy5fX3NwbGl0VmFsdWVzW2ldLmFwcHJveEVxdWFsKHMpKXJldHVybiB2b2lkKGFbdF09aSl9aWYodCBpbiB0aGlzLl9fc3BsaXRzW2VdKXtyZXR1cm4gdm9pZCB0aGlzLl9fc3BsaXRWYWx1ZXNbdGhpcy5fX3NwbGl0c1tlXVt0XV0uc2V0RnJvbU90aGVyKHMpfX1lbHNlIHRoaXMuX19zcGxpdHNbZV09e307dGhpcy5fX3NwbGl0c1tlXVt0XT10aGlzLl9fc3BsaXRWYWx1ZXMubGVuZ3RoLHRoaXMuX19zcGxpdFZhbHVlcy5wdXNoKHMpfWVsc2UgYS5zZXRGcm9tT3RoZXIocyl9c2V0U3BsaXRWZXJ0ZXhWYWx1ZSh0LGUscyl7aWYodCBpbiB0aGlzLl9fc3BsaXRzfHwodGhpcy5fX3NwbGl0c1t0XT17fSksZSBpbiB0aGlzLl9fc3BsaXRzW3RdKXtpZih0aGlzLl9fc3BsaXRWYWx1ZXNbdGhpcy5fX3NwbGl0c1t0XVtlXV0uYXBwcm94RXF1YWwocykpcmV0dXJuO2NvbnNvbGUud2FybigiRmFjZSBWZXJ0ZXggQWxyZWFkeSBTcGxpdCB3aXRoIGRpZmZlcmVudCB2YWx1ZSIpfXRoaXMuX19zcGxpdHNbdF1bZV09dGhpcy5fX3NwbGl0VmFsdWVzLmxlbmd0aCx0aGlzLl9fc3BsaXRWYWx1ZXMucHVzaChzKX1zZXRTcGxpdFZlcnRleFZhbHVlcyh0LGUscyl7dCBpbiB0aGlzLl9fc3BsaXRzfHwodGhpcy5fX3NwbGl0c1t0XT17fSk7Y29uc3QgYT10aGlzLl9fc3BsaXRWYWx1ZXMubGVuZ3RoO3RoaXMuX19zcGxpdFZhbHVlcy5wdXNoKHMpO2Zvcihjb25zdCBzIG9mIGUpdGhpcy5fX3NwbGl0c1t0XVtzXT1hfWdldFNwbGl0cygpe3JldHVybiB0aGlzLl9fc3BsaXRzfWdldFNwbGl0Q291bnQoKXtsZXQgdD0wO2Zvcihjb25zdCBlIGluIHRoaXMuX19zcGxpdHMpdCs9T2JqZWN0LmtleXModGhpcy5fX3NwbGl0c1tlXSkubGVuZ3RoO3JldHVybiB0fWdlbmVyYXRlU3BsaXRWYWx1ZXModCxlKXtpZigwPT1lKXJldHVybiB0aGlzLl9fZGF0YTtjb25zdCBzPXRoaXMubGVuZ3RoLGE9dGhpcy5sZW5ndGgrZSxpPXRoaXMuX19kYXRhVHlwZS5udW1FbGVtZW50cz90aGlzLl9fZGF0YVR5cGUubnVtRWxlbWVudHMoKToxLHI9bmV3IEZsb2F0MzJBcnJheShhKmkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5fX2RhdGEubGVuZ3RoO3QrKylyW3RdPXRoaXMuX19kYXRhW3RdO2Zvcihjb25zdCBlIGluIHQpe2NvbnN0IGE9dFtlXTtmb3IoY29uc3QgdCBpbiBhKXtjb25zdCBuPXMrYVt0XTtpZihlIGluIHRoaXMuX19zcGxpdHMmJnQgaW4gdGhpcy5fX3NwbGl0c1tlXSl7Y29uc3Qgcz10aGlzLl9fc3BsaXRzW2VdW3RdOzY9PXRoaXMuX19kYXRhVHlwZT9yW24qaV09dGhpcy5fX3NwbGl0VmFsdWVzW3NdOnRoaXMuX19kYXRhVHlwZS5jcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcihyLmJ1ZmZlcixuKmkpLnNldEZyb21PdGhlcih0aGlzLl9fc3BsaXRWYWx1ZXNbc10pfWVsc2V7Y29uc3QgdD1wYXJzZUludChlKTtmb3IobGV0IGU9MDtlPGk7ZSsrKXQqaStlPnRoaXMuX19kYXRhLmxlbmd0aCYmY29uc29sZS5sb2coIkVycm9yIHJlbWFwcGluZyBzcmM6Iit0KmkrZSksbippK2U+ci5sZW5ndGgmJmNvbnNvbGUubG9nKCJFcnJvciByZW1hcHBpbmcgdGd0OiIrbippK2UpLHJbbippK2VdPXRoaXMuX19kYXRhW3QqaStlXX19fXJldHVybiByfXRvSlNPTih0LGUpe2NvbnN0IHM9c3VwZXIudG9KU09OKHQsZSk7cmV0dXJuIHMuc3BsaXRzPXRoaXMuX19zcGxpdHMscy5zcGxpdFZhbHVlcz10aGlzLl9fc3BsaXRWYWx1ZXMsc31mcm9tSlNPTih0LGUscyl7c3VwZXIuZnJvbUpTT04odCxlLHMpLHRoaXMuX19zcGxpdHM9dC5zcGxpdHMsdGhpcy5fX3NwbGl0VmFsdWVzPVtdO2Zvcihjb25zdCBlIG9mIHQuc3BsaXRWYWx1ZXMpdGhpcy5fX3NwbGl0VmFsdWVzLnB1c2godGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21KU09OKGUpKX1sb2FkU3BsaXRWYWx1ZXModCl7Y29uc3QgZT10LmxvYWRVSW50MzJBcnJheSgpO2lmKDA9PWUubGVuZ3RoKXJldHVybjtsZXQgcz0wLGE9MDtmb3IoOzspe2NvbnN0IHQ9ZVtzKytdLGk9ZVtzKytdLHI9e307Zm9yKGxldCB0PTA7dDxpO3QrKyl7Y29uc3QgdD1lW3MrK10saT1lW3MrK107clt0XT1pLGk+PWEmJihhPWkrMSl9aWYodGhpcy5fX3NwbGl0c1t0XT1yLHM+PWUubGVuZ3RoKWJyZWFrfWNvbnN0IGk9dGhpcy5fX251bUZsb2F0MzJFbGVtZW50cyxyPXQubG9hZEZsb2F0MzJBcnJheShhKmkpO3RoaXMuX19zcGxpdFZhbHVlcz1bXTtmb3IobGV0IHQ9MDt0PGE7dCsrKXtjb25zdCBlPXRoaXMuX19kYXRhVHlwZS5jcmVhdGVGcm9tRmxvYXQzMkFycmF5KHIuc2xpY2UodCppLHQqaStpKSk7dGhpcy5fX3NwbGl0VmFsdWVzLnB1c2goZSl9fX1jbGFzcyBQIGV4dGVuZHMgTXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5pbml0KCl9aW5pdCgpe3RoaXMuX19mYWNlQ291bnRzPVtdLHRoaXMuX19mYWNlVmVydGV4Q291bnRzPW5ldyBVaW50OEFycmF5LHRoaXMuX19mYWNlT2Zmc2V0cz1uZXcgVWludDMyQXJyYXksdGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzPW5ldyBVaW50MzJBcnJheSx0aGlzLl9fbnVtUG9wdWxhdGVkRmFjZVZlcnRleEluZGljZXM9MCx0aGlzLl9fZmFjZUF0dHJpYnV0ZXM9bmV3IE1hcCx0aGlzLl9fZWRnZUF0dHJpYnV0ZXM9bmV3IE1hcCx0aGlzLl9fbG9nVG9wb2xvZ3lXYXJuaW5ncz0hMSx0aGlzLmVkZ2VWZXJ0cz12b2lkIDAsdGhpcy52ZXJ0ZXhFZGdlcz12b2lkIDAsdGhpcy5udW1FZGdlcz0wLHRoaXMuZWRnZUZsYWdzPW5ldyBVaW50MzJBcnJheSx0aGlzLmVkZ2VBbmdsZXM9bmV3IEZsb2F0MzJBcnJheX1nZXRGYWNlVmVydGV4SW5kaWNlcygpe3JldHVybiB0aGlzLl9fZmFjZVZlcnRleEluZGljZXN9Z2V0RmFjZUNvdW50cygpe3JldHVybiB0aGlzLl9fZmFjZUNvdW50c31jbGVhcigpe3RoaXMuX19mYWNlVmVydGV4SW5kaWNlcz12b2lkIDAsdGhpcy5fX2ZhY2VDb3VudHM9W10sdGhpcy5fX251bVBvcHVsYXRlZEZhY2VWZXJ0ZXhJbmRpY2VzPTB9c2V0RmFjZUNvdW50cyh0KXtpZih0aGlzLl9fbnVtUG9wdWxhdGVkRmFjZVZlcnRleEluZGljZXMpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IGZhY2UgY291bnRzIG9uIGEgbWVzaCB0aGF0IGlzIGFscmVhZHkgcG9wdWxhdGVkLiBQbGVhc2UgY2FsbCAnY2xlYXInIGJlZm9yZSByZS1idWlsZGluZyB0aGUgbWVzaC4iKTt0aGlzLl9fZmFjZUNvdW50cz10O2xldCBlPTAscz0wLGE9Mztmb3IoY29uc3QgdCBvZiB0aGlzLl9fZmFjZUNvdW50cyllKz10LHMrPXQqYSxhKys7dGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHM9bmV3IFVpbnQ4QXJyYXkoZSksdGhpcy5fX2ZhY2VPZmZzZXRzPW5ldyBVaW50MzJBcnJheShlKSx0aGlzLl9fZmFjZVZlcnRleEluZGljZXM9bmV3IFVpbnQzMkFycmF5KHMpO2Zvcihjb25zdCB0IG9mIHRoaXMuX19mYWNlQXR0cmlidXRlcyl0LnJlc2l6ZShlKX1zZXRGYWNlVmVydGV4SW5kaWNlcyh0KXtjb25zdCBlPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxzPXRoaXMuX19udW1Qb3B1bGF0ZWRGYWNlVmVydGV4SW5kaWNlcztmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyl0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbcyt0XT1lW3RdO3RoaXMuX19mYWNlVmVydGV4Q291bnRzW3RdPWUubGVuZ3RoLTMsdGhpcy5fX2ZhY2VPZmZzZXRzW3RdPXMsdGhpcy5fX251bVBvcHVsYXRlZEZhY2VWZXJ0ZXhJbmRpY2VzKz1lLmxlbmd0aH1nZXRGYWNlVmVydGV4SW5kaWNlcyh0KXtjb25zdCBlPVtdLHM9dGhpcy5fX2ZhY2VPZmZzZXRzW3RdLGE9dGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHNbdF0rMztmb3IobGV0IHQ9MDt0PGE7dCsrKWUucHVzaCh0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbcyt0XSk7cmV0dXJuIGV9Z2V0RmFjZVZlcnRleEluZGV4KHQsZSl7Y29uc3Qgcz10aGlzLl9fZmFjZU9mZnNldHNbdF07cmV0dXJuIHRoaXMuX19mYWNlVmVydGV4SW5kaWNlc1tzK2VdfWdldE51bUZhY2VzKCl7cmV0dXJuIHRoaXMuX19mYWNlVmVydGV4Q291bnRzLmxlbmd0aH1hZGRWZXJ0ZXhBdHRyaWJ1dGUodCxlLHMpe2NvbnN0IGE9bmV3IE8odGhpcyxlLG51bGwhPXRoaXMudmVydGljZXM/dGhpcy52ZXJ0aWNlcy5sZW5ndGg6MCxzKTtyZXR1cm4gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuc2V0KHQsYSksYX1hZGRGYWNlQXR0cmlidXRlKHQsZSxzKXtjb25zdCBhPW5ldyBWKGUsbnVsbCE9cz9zOnRoaXMuZ2V0TnVtRmFjZXMoKSk7cmV0dXJuIHRoaXMuX19mYWNlQXR0cmlidXRlcy5zZXQodCxhKSxhfWhhc0ZhY2VBdHRyaWJ1dGUodCl7cmV0dXJuIHRoaXMuX19mYWNlQXR0cmlidXRlcy5oYXModCl9Z2V0RmFjZUF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX2ZhY2VBdHRyaWJ1dGVzLmdldCh0KX1hZGRFZGdlQXR0cmlidXRlKHQsZSxzKXtjb25zdCBhPW5ldyBWKGUsbnVsbCE9cz9zOnRoaXMuZ2V0TnVtRWRnZXMoKSk7cmV0dXJuIHRoaXMuX19lZGdlQXR0cmlidXRlcy5zZXQodCxhKSxhfWhhc0VkZ2VBdHRyaWJ1dGUodCl7cmV0dXJuIHRoaXMuX19lZGdlQXR0cmlidXRlcy5oYXModCl9Z2V0RWRnZUF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX2VkZ2VBdHRyaWJ1dGVzLmdldCh0KX1nZW5Ub3BvbG9neUluZm8oKXtjb25zdCB0PXt9O3RoaXMudmVydGV4RWRnZXM9W10sdGhpcy5lZGdlRmFjZXM9W10sdGhpcy5lZGdlVmVydHM9W10sdGhpcy5mYWNlRWRnZXM9W10sdGhpcy5udW1FZGdlcz0wO2NvbnN0IGU9KGUscyk9PntsZXQgYT1lLGk9cztpZihpPGEpe2NvbnN0IHQ9YTthPWksaT10fWNvbnN0IHI9YSsiPiIraTtpZihyIGluIHQpcmV0dXJuIHRbcl07Y29uc3Qgbj10aGlzLnZlcnRpY2VzLmdldFZhbHVlUmVmKGEpLGg9dGhpcy52ZXJ0aWNlcy5nZXRWYWx1ZVJlZihpKS5zdWJ0cmFjdChuKSxvPXtlZGdlSW5kZXg6dGhpcy5lZGdlRmFjZXMubGVuZ3RoLzIsZWRnZVZlYzpofTtyZXR1cm4gdFtyXT1vLHRoaXMuZWRnZUZhY2VzLnB1c2goLTEpLHRoaXMuZWRnZUZhY2VzLnB1c2goLTEpLHRoaXMuZWRnZVZlcnRzLnB1c2goYSksdGhpcy5lZGdlVmVydHMucHVzaChpKSx0aGlzLm51bUVkZ2VzKyssb30scz0odCxzLGEpPT57Y29uc3QgaT1lKHQscykuZWRnZUluZGV4O2lmKHM8dCl7Y29uc3QgdD0yKmkrMDt0aGlzLl9fbG9nVG9wb2xvZ3lXYXJuaW5ncyYmLTEhPXRoaXMuZWRnZUZhY2VzW3RdJiZjb25zb2xlLndhcm4oIkVkZ2UgcG9seSAwIGFscmVhZHkgc2V0LiBNZXNoIGlzIG5vbi1tYW5pZm9sZC4iKSx0aGlzLmVkZ2VGYWNlc1t0XT1hfWVsc2V7Y29uc3QgdD0yKmkrMTt0aGlzLl9fbG9nVG9wb2xvZ3lXYXJuaW5ncyYmLTEhPXRoaXMuZWRnZUZhY2VzW3RdJiZjb25zb2xlLndhcm4oIkVkZ2UgcG9seSAxIGFscmVhZHkgc2V0LiBNZXNoIGlzIG5vbi1tYW5pZm9sZC4iKSx0aGlzLmVkZ2VGYWNlc1t0XT1hfWEgaW4gdGhpcy5mYWNlRWRnZXN8fCh0aGlzLmZhY2VFZGdlc1thXT1bXSksdGhpcy5mYWNlRWRnZXNbYV0ucHVzaChpKSxudWxsPT10aGlzLnZlcnRleEVkZ2VzW3RdJiYodGhpcy52ZXJ0ZXhFZGdlc1t0XT1uZXcgU2V0KSxudWxsPT10aGlzLnZlcnRleEVkZ2VzW3NdJiYodGhpcy52ZXJ0ZXhFZGdlc1tzXT1uZXcgU2V0KSx0aGlzLnZlcnRleEVkZ2VzW3RdLmFkZChpKSx0aGlzLnZlcnRleEVkZ2VzW3NdLmFkZChpKX0sYT10aGlzLmdldE51bUZhY2VzKCk7Zm9yKGxldCB0PTA7dDxhO3QrKyl7Y29uc3QgZT10aGlzLmdldEZhY2VWZXJ0ZXhJbmRpY2VzKHQpO2ZvcihsZXQgYT0wO2E8ZS5sZW5ndGg7YSsrKXtzKGVbYV0sZVsoYSsxKSVlLmxlbmd0aF0sdCl9fX1jb21wdXRlRmFjZU5vcm1hbHMoKXtjb25zdCB0PXRoaXMudmVydGljZXMsZT10aGlzLmFkZEZhY2VBdHRyaWJ1dGUoIm5vcm1hbHMiLHIpLHM9dGhpcy5nZXROdW1GYWNlcygpO2ZvcihsZXQgYT0wO2E8czthKyspe2NvbnN0IHM9dGhpcy5nZXRGYWNlVmVydGV4SW5kaWNlcyhhKSxpPXQuZ2V0VmFsdWVSZWYoc1swXSk7bGV0IG49dC5nZXRWYWx1ZVJlZihzWzFdKTtjb25zdCBoPW5ldyByO2ZvcihsZXQgZT0yO2U8cy5sZW5ndGg7ZSsrKXtjb25zdCBhPXQuZ2V0VmFsdWVSZWYoc1tlXSkscj1uLnN1YnRyYWN0KGkpLG89YS5zdWJ0cmFjdChpKTtoLmFkZEluUGxhY2Uoci5jcm9zcyhvKS5ub3JtYWxpemUoKSksbj1hfWgubGVuZ3RoU3F1YXJlZCgpLE51bWJlci5FUFNJTE9OLGUuc2V0VmFsdWUoYSxoLm5vcm1hbGl6ZSgpKX19Z2VuZXJhdGVFZGdlRmxhZ3MoKXtudWxsPT10aGlzLnZlcnRleEVkZ2VzJiZ0aGlzLmdlblRvcG9sb2d5SW5mbygpLHRoaXMuaGFzRmFjZUF0dHJpYnV0ZSgibm9ybWFscyIpfHx0aGlzLmNvbXB1dGVGYWNlTm9ybWFscygpO2NvbnN0IHQ9dGhpcy52ZXJ0aWNlcyxlPXRoaXMuZ2V0RmFjZUF0dHJpYnV0ZSgibm9ybWFscyIpO3RoaXMuZWRnZVZlY3M9W10sdGhpcy5lZGdlQW5nbGVzPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5udW1FZGdlcyk7Zm9yKGxldCBzPTA7czx0aGlzLmVkZ2VGYWNlcy5sZW5ndGg7cys9Mil7Y29uc3QgYT10aGlzLmVkZ2VWZXJ0c1tzXSxpPXRoaXMuZWRnZVZlcnRzW3MrMV0scj10LmdldFZhbHVlUmVmKGkpLnN1YnRyYWN0KHQuZ2V0VmFsdWVSZWYoYSkpO3Iubm9ybWFsaXplSW5QbGFjZSgpLHRoaXMuZWRnZVZlY3MucHVzaChyKTtjb25zdCBuPXRoaXMuZWRnZUZhY2VzW3NdLGg9dGhpcy5lZGdlRmFjZXNbcysxXTtpZigtMT09bnx8LTE9PWgpe3RoaXMuZWRnZUFuZ2xlc1tzLzJdPTIqTWF0aC5QSTtjb250aW51ZX1jb25zdCBvPWUuZ2V0VmFsdWVSZWYobiksXz1lLmdldFZhbHVlUmVmKGgpO3RoaXMuZWRnZUFuZ2xlc1tzLzJdPW8uYW5nbGVUbyhfKX19Y29tcHV0ZVZlcnRleE5vcm1hbHModD0xKXt0aGlzLmdlbmVyYXRlRWRnZUZsYWdzKCk7dGhpcy52ZXJ0aWNlcztjb25zdCBlPXRoaXMuZ2V0RmFjZUF0dHJpYnV0ZSgibm9ybWFscyIpLHM9dGhpcy5hZGRWZXJ0ZXhBdHRyaWJ1dGUoIm5vcm1hbHMiLHIpLGE9ZS5kYXRhLmJ1ZmZlcixpPXMuZGF0YSxuPSh0LGUpPT57aVszKnQrMF09ZS54LGlbMyp0KzFdPWUueSxpWzMqdCsyXT1lLnp9LGg9KHQsZSk9PntsZXQgcyxhO2NvbnN0IGk9dGhpcy5mYWNlRWRnZXNbdF07Zm9yKGNvbnN0IHQgb2YgaSkodGhpcy5lZGdlVmVydHNbMip0XT09ZXx8dGhpcy5lZGdlVmVydHNbMip0KzFdPT1lKSYmKHM/YT10aGlzLmVkZ2VWZWNzW3RdOnM9dGhpcy5lZGdlVmVjc1t0XSk7cmV0dXJuW3MsYV19O2ZvcihsZXQgZT0wO2U8dGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGg7ZSsrKXtpZihudWxsPT10aGlzLnZlcnRleEVkZ2VzW2VdKWNvbnRpbnVlO2NvbnN0IGk9dGhpcy52ZXJ0ZXhFZGdlc1tlXSxfPVtdLGQ9dD0+e2xldCBlPSExO2Zvcihjb25zdCBzIG9mIF8paWYoZT0tMSE9cy5pbmRleE9mKHQpLGUpYnJlYWs7ZXx8Xy5wdXNoKFt0XSl9O2Zvcihjb25zdCBlIG9mIGkpe2NvbnN0IHM9dGhpcy5lZGdlRmFjZXNbMiplXSxhPXRoaXMuZWRnZUZhY2VzWzIqZSsxXTtpZigtMSE9cyYmLTE9PWEmJnRoaXMuZWRnZUFuZ2xlc1tlXTx0KXtsZXQgdD0tMSxlPS0xO2ZvcihsZXQgaT0wO2k8Xy5sZW5ndGg7aSsrKS0xPT10JiYtMSE9X1tpXS5pbmRleE9mKHMpJiYodD1pKSwtMT09ZSYmLTEhPV9baV0uaW5kZXhPZihhKSYmKGU9aSk7LTE9PXQmJi0xPT1lP18ucHVzaChbcyxhXSk6LTEhPXQmJi0xIT1lP3QhPWUmJihfW3RdPV9bdF0uY29uY2F0KF9bZV0pLF8uc3BsaWNlKGUsMSkpOigtMT09dCYmX1tlXS5wdXNoKHMpLC0xPT1lJiZfW3RdLnB1c2goYSkpfWVsc2UtMSE9cyYmZChzKSwtMSE9YSYmZChhKX1fLnNvcnQoKHQsZSk9PnQubGVuZ3RoPGUubGVuZ3RoPzE6dC5sZW5ndGg+ZS5sZW5ndGg/LTE6MCk7bGV0IGw9ITA7Zm9yKGNvbnN0IHQgb2YgXyl7Y29uc3QgaT1uZXcgcjtmb3IoY29uc3QgcyBvZiB0KXtjb25zdCB0PWgocyxlKSxuPXRbMF0uYW5nbGVUbyh0WzFdKTtpLmFkZEluUGxhY2UoKG89cyxuZXcgcihhLDEyKm8pKS5zY2FsZShuKSl9aS5ub3JtYWxpemVJblBsYWNlKCksbD8obihlLGkpLGw9ITEpOnMuc2V0U3BsaXRWZXJ0ZXhWYWx1ZXMoZSx0LGkpfX12YXIgbztyZXR1cm4gc31jb21wdXRlTnVtVHJpYW5nbGVzKCl7bGV0IHQ9MyxlPTA7Zm9yKGNvbnN0IHMgb2YgdGhpcy5fX2ZhY2VDb3VudHMpZSs9cyoodC0yKSx0Kys7cmV0dXJuIGV9Z2VuZXJhdGVUcmlhbmd1bGF0ZWRJbmRpY2VzKHQsZSxzKXtjb25zdCBhPXRoaXMuY29tcHV0ZU51bVRyaWFuZ2xlcygpO2xldCBpO2k9dDxNYXRoLnBvdygyLDgpP25ldyBVaW50OEFycmF5KDMqYSk6dDxNYXRoLnBvdygyLDE2KT9uZXcgVWludDE2QXJyYXkoMyphKTpuZXcgVWludDMyQXJyYXkoMyphKTtsZXQgcj0wO2NvbnN0IG49ZnVuY3Rpb24odCxhKXt0IGluIHMmJmEgaW4gc1t0XSYmKHQ9ZStzW3RdW2FdKSxpW3JdPXQscisrfSxoPXRoaXMuZ2V0TnVtRmFjZXMoKTtmb3IobGV0IHQ9MDt0PGg7dCsrKXtjb25zdCBlPXRoaXMuZ2V0RmFjZVZlcnRleEluZGljZXModCk7Zm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKyspcz49MyYmKG4oZVswXSx0KSxuKGVbcy0xXSx0KSksbihlW3NdLHQpfXJldHVybiBpfWNvbXB1dGVIYXJkRWRnZXNJbmRpY2VzKHQ9MSl7Y29uc3QgZT1bXSxzPXQ9PntlLnB1c2godGhpcy5lZGdlVmVydHNbdF0pLGUucHVzaCh0aGlzLmVkZ2VWZXJ0c1t0KzFdKX07Zm9yKGxldCBlPTA7ZTx0aGlzLmVkZ2VGbGFncy5sZW5ndGg7ZSs9Mil0aGlzLmVkZ2VBbmdsZXNbZS8yXT50JiZzKGUpO3JldHVybiBlfWdldFdpcmVmcmFtZUluZGljZXMoKXtyZXR1cm4gaW5kaWNlc31nZW5CdWZmZXJzKHQpe2NvbnN0IGU9e307bGV0IHM9MDtmb3IoY29uc3RbLHRdb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMpe2NvbnN0IGE9dC5nZXRTcGxpdHMoKTtmb3IoY29uc3QgdCBpbiBhKXt0IGluIGV8fChlW3RdPXt9KTtjb25zdCBpPWFbdF07Zm9yKGNvbnN0IGEgaW4gaSl7Y29uc3QgaT1wYXJzZUludChhKTtpIGluIGVbdF18fChlW3RdW2ldPXMscysrKX19fWNvbnN0IGE9dGhpcy52ZXJ0aWNlcy5sZW5ndGgsaT1hK3M7bGV0IHI7dCYmMD09dC5pbmNsdWRlSW5kaWNlc3x8KHI9dGhpcy5nZW5lcmF0ZVRyaWFuZ3VsYXRlZEluZGljZXMoaSxhLGUpKTtjb25zdCBuPXt9O2Zvcihjb25zdFt0LGFdb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMpe2xldCBpO2k9MD09cz9hLmRhdGE6YS5nZW5lcmF0ZVNwbGl0VmFsdWVzKGUscyk7Y29uc3Qgcj1hLm51bUVsZW1lbnRzLGg9aS5sZW5ndGgvcjtuW3RdPXt2YWx1ZXM6aSxjb3VudDpoLGRpbWVuc2lvbjpyLG5vcm1hbGl6ZWQ6Im5vcm1hbHMiPT10LGRhdGFUeXBlOmEuZGF0YVR5cGV9fWNvbnN0IGg9e251bVZlcnRpY2VzOnRoaXMubnVtVmVydGljZXMoKSxudW1SZW5kZXJWZXJ0czppLGluZGljZXM6cixhdHRyQnVmZmVyczpufTtpZih0JiZ0LmluY2x1ZGVWZXJ0ZXhOZWlnaGJvcnMpe251bGw9PXRoaXMudmVydGV4RWRnZXMmJnRoaXMuZ2VuVG9wb2xvZ3lJbmZvKCk7bGV0IHQ9MDtmb3IobGV0IGU9MDtlPHRoaXMudmVydGV4RWRnZXMubGVuZ3RoO2UrKyl0aGlzLnZlcnRleEVkZ2VzW2VdJiYodCs9dGhpcy52ZXJ0ZXhFZGdlc1tlXS5zaXplKTtjb25zdCBlPW5ldyBVaW50MzJBcnJheSgyKnRoaXMudmVydGV4RWRnZXMubGVuZ3RoK3QpLHM9dD0+e2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKXtjb25zdCBzPXRbZV07Zm9yKGxldCBhPTA7YTxlO2ErKyl7Y29uc3QgaT10W2FdO2lmKC0xIT1zWzBdJiZzWzBdPT1pWzFdKXtlIT1hKzEmJih0LnNwbGljZShlLDEpLHQuc3BsaWNlKGErMSwwLHMpKTticmVha31pZigtMSE9c1sxXSYmc1sxXT09aVswXSl7dC5zcGxpY2UoZSwxKSx0LnNwbGljZShhLDAscyk7YnJlYWt9fX19LGE9dD0+e2lmKCEoLTEhPXRbMF1bMF0mJi0xIT10W3QubGVuZ3RoLTFdWzFdfHwtMT09dFswXVswXSYmLTE9PXRbdC5sZW5ndGgtMV1bMV0pKXRocm93IG5ldyBFcnJvcigiSWYgZmFuIHN0YXJ0cyB3aXRoIC0xLCBpdCBtdXN0IGFsc28gZW5kIHdpdGggLTEiKTtmb3IobGV0IGU9MDtlPHQubGVuZ3RoO2UrKyl7Y29uc3Qgcz10W2VdO2lmKCgtMT09c1swXXx8LTE9PXNbMV0pJiYwIT1lJiZlIT10Lmxlbmd0aC0xKXRocm93IG5ldyBFcnJvcigiLTEgb25seSBhbGxvd2VkIGF0IHRoZSBiZWdpbm5pbmcgYW5kIGVuZCBvZiBhIGZhbi4iKTtpZigtMSE9c1swXSl7bGV0IGE9ZS0xO2lmKGE8MCYmKGErPXQubGVuZ3RoKSxzWzBdIT10W2FdWzFdKXRocm93IG5ldyBFcnJvcigiRmFjZXMgYXJlIG5vdCBzZXF1ZW50aWFsIil9aWYoLTEhPXNbMV0pe2NvbnN0IGE9KGUrMSkldC5sZW5ndGg7aWYoc1sxXSE9dFthXVswXSl0aHJvdyBuZXcgRXJyb3IoIkZhY2VzIGFyZSBub3Qgc2VxdWVudGlhbCIpfX19O2xldCBpPTIqdGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGg7Zm9yKGxldCB0PTA7dDx0aGlzLnZlcnRleEVkZ2VzLmxlbmd0aDt0Kyspe2lmKG51bGw9PXRoaXMudmVydGV4RWRnZXNbdF0pY29udGludWU7Y29uc3Qgcj10aGlzLnZlcnRleEVkZ2VzW3RdLG49W107Zm9yKGNvbnN0IGUgb2Ygcil7Y29uc3Qgcz10aGlzLmVkZ2VWZXJ0c1syKmVdLGE9dGhpcy5lZGdlVmVydHNbMiplKzFdO2xldCBpLHI9dGhpcy5lZGdlRmFjZXNbMiplXSxoPXRoaXMuZWRnZUZhY2VzWzIqZSsxXTtpZihzPT10KWk9YTtlbHNle2lmKGEhPXQpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRvcG9sb2d5Iik7e2k9cztjb25zdCB0PXI7cj1oLGg9dH19bi5wdXNoKFtyLGgsaV0pfXMobiksYShuKTtsZXQgaD0wOygtMSE9blswXVswXXx8LTEhPW5bbi5sZW5ndGgtMV1bMV0pJiYoaCs9MSksZVsyKnRdPWksZVsyKnQrMV09ci5zaXplKyhoPDw4KTtmb3IoY29uc3QgdCBvZiBuKWVbaV09dFsyXSxpKyt9aC52ZXJ0ZXhOZWlnaGJvcnM9ZX1yZXR1cm4gaH1mcmVlQnVmZmVycygpe3N1cGVyLmZyZWVCdWZmZXJzKCksdGhpcy5pbml0KCl9cmVhZEJpbmFyeSh0LGUpe3N1cGVyLmxvYWRCYXNlR2VvbUJpbmFyeSh0KSx0aGlzLnNldEZhY2VDb3VudHModC5sb2FkVUludDMyQXJyYXkoKSksdGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHM9dC5sb2FkVUludDhBcnJheSh0aGlzLl9fZmFjZVZlcnRleENvdW50cy5sZW5ndGgpO2NvbnN0IHM9dC5sb2FkU0ludDMyVmVjMigpLGE9dC5sb2FkVUludDgoKTtsZXQgcjsxPT1hP3I9dC5sb2FkVUludDhBcnJheSgpOjI9PWE/cj10LmxvYWRVSW50MTZBcnJheSgpOjQ9PWEmJihyPXQubG9hZFVJbnQzMkFycmF5KCkpO2NvbnN0IG49dGhpcy5nZXROdW1GYWNlcygpO2xldCBoPTAsbz0wO2ZvcihsZXQgdD0wO3Q8bjt0Kyspe2NvbnN0IGU9dGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHNbdF0rMzt0aGlzLl9fZmFjZU9mZnNldHNbdF09aDtmb3IobGV0IGE9MDthPGU7YSsrKXtjb25zdCBlPWgrYSxpPXJbZV0rcy54O2lmKDA9PXQpdGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzW2VdPWk7ZWxzZXtsZXQgcz10aGlzLl9fZmFjZU9mZnNldHNbdC0xXTtzKz1hPG8/YTpvLTEsdGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzW2VdPXRoaXMuX19mYWNlVmVydGV4SW5kaWNlc1tzXStpfX1oKz1lLG89ZX10aGlzLl9fbnVtUG9wdWxhdGVkRmFjZVZlcnRleEluZGljZXM9aDtjb25zdCBfPXQubG9hZFVJbnQzMigpO2lmKF8+MCl7Y29uc3QgZT10aGlzLnZlcnRpY2VzLHM9dGhpcy5hZGRWZXJ0ZXhBdHRyaWJ1dGUoImxpZ2h0bWFwQ29vcmRzIixpKTtmb3IobGV0IGE9MDthPF87YSsrKXtjb25zdCBhPW5ldyBtKHQubG9hZEZsb2F0MzJWZWMzKCksdC5sb2FkRmxvYXQzMlF1YXQoKSkscj10LmxvYWRGbG9hdDMyKCksbj10LmxvYWRGbG9hdDMyVmVjMigpLGg9dC5sb2FkU0ludDMyVmVjMigpLG89dC5sb2FkVUludDgoKTtsZXQgXztfPTE9PW8/dC5sb2FkVUludDhBcnJheSgpOjI9PW8/dC5sb2FkVUludDE2QXJyYXkoKTp0LmxvYWRVSW50MzJBcnJheSgpO2xldCBkPTA7Zm9yKGNvbnN0IHQgb2YgXyl7bGV0IG89dCtoLng7bys9ZCxkPW87Y29uc3QgXz10aGlzLmdldEZhY2VWZXJ0ZXhJbmRpY2VzKG8pO2Zvcihjb25zdCB0IG9mIF8pe2NvbnN0IGg9ZS5nZXRWYWx1ZVJlZih0KSxfPWEudHJhbnNmb3JtVmVjMyhoKSxkPW5ldyBpKF8ueCxfLnopO2Quc2NhbGVJblBsYWNlKHIpLGQuYWRkSW5QbGFjZShuKSxzLnNldEZhY2VWZXJ0ZXhWYWx1ZV9CeVZlcnRleEluZGV4KG8sdCxkKX19fX10aGlzLmhhc1ZlcnRleEF0dHJpYnV0ZSgibm9ybWFscyIpfHx0aGlzLmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCksdGhpcy5nZW9tRGF0YUNoYW5nZWQuZW1pdCgpfXRvSlNPTih0LGUpe2NvbnN0IHM9c3VwZXIudG9KU09OKHQsZSk7cmV0dXJuIDEwMjQmZXx8KHMuZmFjZUNvdW50cz1BcnJheS5mcm9tKHRoaXMuX19mYWNlQ291bnRzKSxzLmZhY2VWZXJ0ZXhJbmRpY2VzPUFycmF5LmZyb20odGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzKSksc31mcm9tSlNPTih0LGUscyl7c3VwZXIuZnJvbUpTT04odCxlLHMpLHQuZmFjZUNvdW50cyYmKHRoaXMuX19mYWNlQ291bnRzPVVpbnQzMkFycmF5LmZyb20odC5mYWNlQ291bnRzKSksdC5mYWNlVmVydGV4SW5kaWNlcyYmKHRoaXMuX19mYWNlVmVydGV4SW5kaWNlcz1VaW50MzJBcnJheS5mcm9tKHQuZmFjZVZlcnRleEluZGljZXMpKX19Y2xhc3MgRXtjb25zdHJ1Y3Rvcih0LGU9MCxzPSEwKXt0aGlzLl9fZGF0YT10LHRoaXMuX19ieXRlT2Zmc2V0PWUsdGhpcy5fX2RhdGFWaWV3PW5ldyBEYXRhVmlldyh0aGlzLl9fZGF0YSksdGhpcy5fX2lzTW9iaWxlRGV2aWNlPXMsdGhpcy51dGY4ZGVjb2Rlcj1uZXcgVGV4dERlY29kZXJ9Z2V0IGlzTW9iaWxlRGV2aWNlKCl7cmV0dXJuIHRoaXMuX19pc01vYmlsZURldmljZX1nZXQgZGF0YSgpe3JldHVybiB0aGlzLl9fZGF0YX1nZXQgYnl0ZUxlbmd0aCgpe3JldHVybiB0aGlzLl9fZGF0YVZpZXcuYnl0ZUxlbmd0aH1nZXQgcmVtYWluaW5nQnl0ZUxlbmd0aCgpe3JldHVybiB0aGlzLl9fZGF0YVZpZXcuYnl0ZUxlbmd0aC10aGlzLl9fYnl0ZU9mZnNldH1wb3MoKXtyZXR1cm4gdGhpcy5fX2J5dGVPZmZzZXR9c2Vlayh0KXt0aGlzLl9fYnl0ZU9mZnNldD10fWFkdmFuY2UodCl7dGhpcy5fX2J5dGVPZmZzZXQrPXR9bG9hZFVJbnQ4KCl7Y29uc3QgdD10aGlzLl9fZGF0YVZpZXcuZ2V0VWludDgodGhpcy5fX2J5dGVPZmZzZXQpO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9MSx0fWxvYWRVSW50MTYoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRVaW50MTYodGhpcy5fX2J5dGVPZmZzZXQsITApO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9Mix0fWxvYWRVSW50MzIoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRVaW50MzIodGhpcy5fX2J5dGVPZmZzZXQsITApO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9NCx0fWxvYWRTSW50MzIoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRJbnQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz00LHR9bG9hZEZsb2F0MTYoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQxNigpO3JldHVybiBNYXRoLmRlY29kZTE2Qml0RmxvYXQodCl9bG9hZFVGbG9hdDE2KCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDE2KCk7cmV0dXJuIHQ8MD8yMDQ4LXQ6dH1sb2FkRmxvYXQxNkZyb20yeFVJbnQ4KCl7Y29uc3QgdD10aGlzLl9fZGF0YVZpZXcuZ2V0RmxvYXQxNih0aGlzLl9fYnl0ZU9mZnNldCwhMCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz0yLHR9bG9hZFVJbnQzMkZyb20yeFVGbG9hdDE2KCl7cmV0dXJuIHRoaXMubG9hZFVGbG9hdDE2KCkrNDA5Nip0aGlzLmxvYWRVRmxvYXQxNigpfWxvYWRTSW50MzJGcm9tMnhGbG9hdDE2KCl7cmV0dXJuIHRoaXMubG9hZEZsb2F0MTYoKSsyMDQ4KnRoaXMubG9hZEZsb2F0MTYoKX1sb2FkRmxvYXQzMigpe2NvbnN0IHQ9dGhpcy5fX2RhdGFWaWV3LmdldEZsb2F0MzIodGhpcy5fX2J5dGVPZmZzZXQsITApO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9NCx0fWxvYWRVSW50OEFycmF5KHQsZT0hMSl7bnVsbD09dCYmKHQ9dGhpcy5sb2FkVUludDMyKCkpO2NvbnN0IHM9bmV3IFVpbnQ4QXJyYXkodGhpcy5fX2RhdGEsdGhpcy5fX2J5dGVPZmZzZXQsdCk7dGhpcy5fX2J5dGVPZmZzZXQrPXQ7dGhpcy5fX2J5dGVPZmZzZXQ7cmV0dXJuIHN9bG9hZFVJbnQxNkFycmF5KHQsZT0hMSl7aWYobnVsbD09dCYmKHQ9dGhpcy5sb2FkVUludDMyKCkpLDA9PXQpcmV0dXJuIG5ldyBVaW50MTZBcnJheTtsZXQgcztpZih0aGlzLnJlYWRQYWRkKDIpLHRoaXMuX19pc01vYmlsZURldmljZSl7cz1uZXcgVWludDE2QXJyYXkodCk7Zm9yKGxldCBlPTA7ZTx0O2UrKylzW2VdPXRoaXMuX19kYXRhVmlldy5nZXRVaW50MTYodGhpcy5fX2J5dGVPZmZzZXQsITApLHRoaXMuX19ieXRlT2Zmc2V0Kz0yfWVsc2Ugcz1uZXcgVWludDE2QXJyYXkodGhpcy5fX2RhdGEsdGhpcy5fX2J5dGVPZmZzZXQsdCksdGhpcy5fX2J5dGVPZmZzZXQrPTIqdDtyZXR1cm4gc31sb2FkVUludDMyQXJyYXkodCxlPSExKXtpZihudWxsPT10JiYodD10aGlzLmxvYWRVSW50MzIoKSksMD09dClyZXR1cm4gbmV3IFVpbnQzMkFycmF5O2xldCBzO2lmKHRoaXMucmVhZFBhZGQoNCksdGhpcy5fX2lzTW9iaWxlRGV2aWNlKXtzPW5ldyBVaW50MzJBcnJheSh0KTtmb3IobGV0IGU9MDtlPHQ7ZSsrKXNbZV09dGhpcy5fX2RhdGFWaWV3LmdldFVpbnQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCksdGhpcy5fX2J5dGVPZmZzZXQrPTR9ZWxzZSBzPW5ldyBVaW50MzJBcnJheSh0aGlzLl9fZGF0YSx0aGlzLl9fYnl0ZU9mZnNldCx0KSx0aGlzLl9fYnl0ZU9mZnNldCs9NCp0O3JldHVybiBzfWxvYWRGbG9hdDMyQXJyYXkodCxlPSExKXtpZihudWxsPT10JiYodD10aGlzLmxvYWRVSW50MzIoKSksMD09dClyZXR1cm4gbmV3IEZsb2F0MzJBcnJheTtsZXQgcztpZih0aGlzLnJlYWRQYWRkKDQpLHRoaXMuX19pc01vYmlsZURldmljZSl7cz1uZXcgRmxvYXQzMkFycmF5KHQpO2ZvcihsZXQgZT0wO2U8dDtlKyspc1tlXT10aGlzLl9fZGF0YVZpZXcuZ2V0RmxvYXQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCksdGhpcy5fX2J5dGVPZmZzZXQrPTR9ZWxzZSBzPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5fX2RhdGEsdGhpcy5fX2J5dGVPZmZzZXQsdCksdGhpcy5fX2J5dGVPZmZzZXQrPTQqdDtyZXR1cm4gc31sb2FkU3RyKCl7Y29uc3QgdD10aGlzLmxvYWRVSW50MzIoKSxlPW5ldyBVaW50OEFycmF5KHRoaXMuX19kYXRhLHRoaXMuX19ieXRlT2Zmc2V0LHQpO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9dCx0aGlzLnV0ZjhkZWNvZGVyLmRlY29kZShlKX1sb2FkU3RyQXJyYXkoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQzMigpLGU9W107Zm9yKGxldCBzPTA7czx0O3MrKyllW3NdPXRoaXMubG9hZFN0cigpO3JldHVybiBlfWxvYWRTSW50MzJWZWMyKCl7Y29uc3QgdD10aGlzLmxvYWRTSW50MzIoKSxlPXRoaXMubG9hZFNJbnQzMigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRVSW50MzJWZWMyKCl7Y29uc3QgdD10aGlzLmxvYWRVSW50MzIoKSxlPXRoaXMubG9hZFVJbnQzMigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRGbG9hdDE2VmVjMigpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQxNigpLGU9dGhpcy5sb2FkRmxvYXQxNigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRGbG9hdDMyVmVjMigpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQzMigpLGU9dGhpcy5sb2FkRmxvYXQzMigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRGbG9hdDE2VmVjMygpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQxNigpLGU9dGhpcy5sb2FkRmxvYXQxNigpLHM9dGhpcy5sb2FkRmxvYXQxNigpO3JldHVybiBuZXcgcih0LGUscyl9bG9hZEZsb2F0MzJWZWMzKCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDMyKCksZT10aGlzLmxvYWRGbG9hdDMyKCkscz10aGlzLmxvYWRGbG9hdDMyKCk7cmV0dXJuIG5ldyByKHQsZSxzKX1sb2FkRmxvYXQxNlF1YXQoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MTYoKSxlPXRoaXMubG9hZEZsb2F0MTYoKSxzPXRoaXMubG9hZEZsb2F0MTYoKSxhPXRoaXMubG9hZEZsb2F0MTYoKTtyZXR1cm4gbmV3IHUodCxlLHMsYSl9bG9hZEZsb2F0MzJRdWF0KCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDMyKCksZT10aGlzLmxvYWRGbG9hdDMyKCkscz10aGlzLmxvYWRGbG9hdDMyKCksYT10aGlzLmxvYWRGbG9hdDMyKCk7cmV0dXJuIG5ldyB1KHQsZSxzLGEpfWxvYWRSR0JGbG9hdDMyQ29sb3IoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MzIoKSxlPXRoaXMubG9hZEZsb2F0MzIoKSxzPXRoaXMubG9hZEZsb2F0MzIoKTtyZXR1cm4gbmV3IG8odCxlLHMpfWxvYWRSR0JBRmxvYXQzMkNvbG9yKCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDMyKCksZT10aGlzLmxvYWRGbG9hdDMyKCkscz10aGlzLmxvYWRGbG9hdDMyKCksYT10aGlzLmxvYWRGbG9hdDMyKCk7cmV0dXJuIG5ldyBvKHQsZSxzLGEpfWxvYWRSR0JVSW50OENvbG9yKCl7Y29uc3QgdD10aGlzLmxvYWRVSW50OCgpLGU9dGhpcy5sb2FkVUludDgoKSxzPXRoaXMubG9hZFVJbnQ4KCk7cmV0dXJuIG5ldyBvKHQvMjU1LGUvMjU1LHMvMjU1KX1sb2FkUkdCQVVJbnQ4Q29sb3IoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQ4KCksZT10aGlzLmxvYWRVSW50OCgpLHM9dGhpcy5sb2FkVUludDgoKSxhPXRoaXMubG9hZFVJbnQ4KCk7cmV0dXJuIG5ldyBvKHQvMjU1LGUvMjU1LHMvMjU1LGEvMjU1KX1sb2FkQm94Migpe3JldHVybiBuZXcgZyh0aGlzLmxvYWRGbG9hdDMyVmVjMigpLHRoaXMubG9hZEZsb2F0MzJWZWMyKCkpfWxvYWRCb3gzKCl7cmV0dXJuIG5ldyBwKHRoaXMubG9hZEZsb2F0MzJWZWMzKCksdGhpcy5sb2FkRmxvYXQzMlZlYzMoKSl9cmVhZFBhZGQodCl7Y29uc3QgZT10aGlzLl9fYnl0ZU9mZnNldCV0OzAhPWUmJih0aGlzLl9fYnl0ZU9mZnNldCs9dC1lKX19Y2xhc3Mgdntjb25zdHJ1Y3Rvcih0KXtpZih0KXtjb25zdCBlPXQuc3BsaXQoIi0iKSxzPWVbMF0uc3BsaXQoIi4iKTt0aGlzLm1ham9yPXBhcnNlSW50KHNbMF0pLHRoaXMubWlub3I9cGFyc2VJbnQoc1sxXSksdGhpcy5wYXRjaD1wYXJzZUludChzWzJdKSwyPT1lLmxlbmd0aCYmKHRoaXMuYnJhbmNoPWVbMV0pfWVsc2UgdGhpcy5tYWpvcj0wLHRoaXMubWlub3I9MCx0aGlzLnBhdGNoPTB9ZXF1YWxzKHQpe3JldHVybiEodGhpcy5wYXRjaD09dFsyXSYmdGhpcy5taW5vcj09dFsxXSYmdGhpcy5tYWpvcj09dFswXSl9bGVzc1RoYW4odCl7cmV0dXJuISh0aGlzLm1ham9yPj10WzBdfHx0aGlzLm1pbm9yPj10WzFdfHx0aGlzLnBhdGNoPj10WzJdKX1ncmVhdGVyVGhhbih0KXtyZXR1cm4gdGhpcy5tYWpvcj50WzBdfHx0aGlzLm1pbm9yPnRbMV18fHRoaXMucGF0Y2g+dFsyXX1ncmVhdGVyT3JFcXVhbFRoYW4odCl7cmV0dXJuISh0aGlzLm1ham9yPHRbMF0pJiYodGhpcy5tYWpvcj50WzBdfHwhKHRoaXMubWlub3I8dFsxXSkmJih0aGlzLm1pbm9yPnRbMV18fCEodGhpcy5wYXRjaDx0WzJdKSkpfX1zZWxmLm9ubWVzc2FnZT1mdW5jdGlvbih0KXsoKHQsZSk9Pntmb3IobGV0IGUgaW4gdC5jb250ZXh0LnZlcnNpb25zKXtjb25zdCBzPXQuY29udGV4dC52ZXJzaW9uc1tlXSxhPW5ldyB2O2EubWFqb3I9cy5tYWpvcixhLm1pbm9yPXMubWlub3IsYS5wYXRjaD1zLnBhdGNoLGEuYnJhbmNoPXMuYnJhbmNoLHQuY29udGV4dC52ZXJzaW9uc1tlXT1hfWNvbnN0IHM9W10saT10LnRvY1t0Lmdlb21zUmFuZ2VbMF1dLHI9W107Zm9yKGxldCBlPXQuZ2VvbXNSYW5nZVswXTtlPHQuZ2VvbXNSYW5nZVsxXTtlKyspe2NvbnN0IG49bmV3IEUodC5idWZmZXJTbGljZSx0LnRvY1tlXS1pLHQuaXNNb2JpbGVEZXZpY2UpLGg9bi5sb2FkU3RyKCksbz1uLnBvcygpO2xldCBfO3N3aXRjaChoKXtjYXNlIlBvaW50cyI6Xz1uZXcgQTticmVhaztjYXNlIkxpbmVzIjpfPW5ldyBTO2JyZWFrO2Nhc2UiTWVzaCI6Xz1uZXcgUDticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgR2VvbSB0eXBlOiIraCl9dHJ5e24uc2VlayhvKSxfLnJlYWRCaW5hcnkobix0LmNvbnRleHQpfWNhdGNoKHQpe2NvbnNvbGUud2FybigiRXJyb3IgbG9hZGluZzoiK18ubmFtZSsiXG46Iit0KSxzLnB1c2goe30pO2NvbnRpbnVlfWNvbnN0IGQ9Xy5nZW5CdWZmZXJzKHQuZ2VuQnVmZmVyc09wdHMpO2QuaW5kaWNlcyYmci5wdXNoKGQuaW5kaWNlcy5idWZmZXIpO2Zvcihjb25zdCB0IGluIGQuYXR0ckJ1ZmZlcnMpe2NvbnN0IGU9ZC5hdHRyQnVmZmVyc1t0XSxzPWEuZ2V0VHlwZU5hbWUoZS5kYXRhVHlwZSk7ZS5kYXRhVHlwZT1zLHIucHVzaChlLnZhbHVlcy5idWZmZXIpfWQudmVydGV4TmVpZ2hib3JzJiZyLnB1c2goZC52ZXJ0ZXhOZWlnaGJvcnMuYnVmZmVyKSxyLnB1c2goXy5ib3VuZGluZ0JveC5wMC5fX2RhdGEuYnVmZmVyKSxyLnB1c2goXy5ib3VuZGluZ0JveC5wMS5fX2RhdGEuYnVmZmVyKSxzLnB1c2goe25hbWU6Xy5uYW1lLHR5cGU6aCxnZW9tQnVmZmVyczpkLGJib3g6Xy5ib3VuZGluZ0JveH0pfWUoe2tleTp0LmtleSxnZW9tSW5kZXhPZmZzZXQ6dC5nZW9tSW5kZXhPZmZzZXQsZ2VvbXNSYW5nZTp0Lmdlb21zUmFuZ2UsZ2VvbURhdGFzOnN9LHIpfSkodC5kYXRhLCh0LGUpPT57c2VsZi5wb3N0TWVzc2FnZSh0LGUpfSl9OwoK", null, !1);
var ga = /** @class */ (function () {
    function ga() {
        this.rangeLoaded = new C, this.streamFileParsed = new C, this.loaded = new C(!0), this.__streamInfos = {}, this.__genBuffersOpts = {}, this.__workers = [], this.__nextWorker = 0;
        for (var e_108 = 0; e_108 < 3; e_108++)
            this.__workers.push(this.__constructWorker());
        this.clear();
    }
    ga.prototype.clear = function () { this.__loaded = 0, this.__numGeoms = 0, this.geoms = []; };
    ga.prototype.__constructWorker = function () {
        var _this = this;
        var e = new pa;
        return e.onmessage = function (e) { _this.__recieveGeomDatas(e.data.key, e.data.geomDatas, e.data.geomIndexOffset, e.data.geomsRange); }, e;
    };
    ga.prototype.__terminateWorkers = function () { for (var _b = 0, _c = this.__workers; _b < _c.length; _b++) {
        var e_109 = _c[_b];
        e_109.terminate();
    } this.__workers = []; };
    ga.prototype.setGenBufferOption = function (e, t) { this.__genBuffersOpts[e] = t; };
    ga.prototype.setNumGeoms = function (e) { this.__numGeoms = e; };
    ga.prototype.getGeom = function (e) { return e >= this.geoms.length ? null : this.geoms[e]; };
    ga.prototype.loadUrl = function (e) {
        var _this = this;
        re(e, function (e) { _this.loadBin(e); }, function (e) { console.warn(e); });
    };
    ga.prototype.readBinaryBuffer = function (e, a, i) { var s = t.isMobileDevice, n = new ge(a, 0, s), l = n.loadUInt32(), r = n.loadUInt32(); if (this.__streamInfos[e] = { total: l, done: 0 }, 0 == l)
        return this.streamFileParsed.emit(1), l; 0 == this.__numGeoms && (this.__numGeoms = l); var o = n.loadUInt32Array(l); var d = window.navigator.hardwareConcurrency; d || (d = s ? 2 : 4); var h = Math.max(1, Math.floor(l / d + 1)); var c = 0; for (; c < l;) {
        var t_131 = o[c];
        var s_26 = void 0, d_2 = void 0;
        c + h >= l ? (d_2 = [c, l], s_26 = a.byteLength) : (d_2 = [c, c + h], s_26 = o[d_2[1]]);
        var m_2 = a.slice(t_131, s_26);
        c += h, this.__workers[this.__nextWorker].postMessage({ key: e, toc: o, geomIndexOffset: r, geomsRange: d_2, isMobileDevice: n.isMobileDevice, bufferSlice: m_2, genBuffersOpts: this.__genBuffersOpts, context: i }, [m_2]), this.__nextWorker = (this.__nextWorker + 1) % this.__workers.length;
    } return l; };
    ga.prototype.__recieveGeomDatas = function (e, t, a, i) { var s = a + i[0], n = [s, a + i[1]]; for (var e_110 = 0; e_110 < t.length; e_110++) {
        var a_122 = t[e_110];
        if (!a_122.type)
            continue;
        var i_94 = void 0;
        switch (a_122.type) {
            case "Points":
                i_94 = new Pt(a_122);
                break;
            case "Lines":
                i_94 = new Et(a_122);
                break;
            case "Mesh":
            case "Plane":
            case "Sphere":
            case "Cone":
                i_94 = new Ht(a_122);
                break;
            default: throw new Error("Unsupported Geom type:" + className);
        }
        this.geoms[s + e_110] = i_94;
    } this.rangeLoaded.emit(n); var l = n[1] - n[0], r = this.__streamInfos[e]; r.done += l, r.done == r.total && this.streamFileParsed.emit(1), this.__loaded += l, this.__loaded == this.__numGeoms && (this.__terminateWorkers(), this.loaded.emit()); };
    ga.prototype.toJSON = function () { return { numGeoms: this.geoms.length() }; };
    ga.prototype.toString = function () { return JSON.stringify(this.toJSON(), null, 2); };
    return ga;
}());
var _a = /** @class */ (function (_super) {
    __extends(_a, _super);
    function _a(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__geomLibrary = new ga, _this.__materials = new Mt, _this.loaded = new C(!0), _this.loaded.setToggled(!0);
        return _this;
    }
    _a.prototype.isLoaded = function () { return this.loaded.isToggled(); };
    _a.prototype.getEngineDataVersion = function () { return this.__engineDataVersion; };
    _a.prototype.getGeometryLibrary = function () { return this.__geomLibrary; };
    _a.prototype.getMaterialLibrary = function () { return this.__materials; };
    _a.prototype.getUnitsConversion = function () { return this.__unitsScale; };
    _a.prototype.readBinary = function (e, t) {
        var _this = this;
        if (t === void 0) { t = {}; }
        var a;
        t.assetItem = this, t.numTreeItems = 0, t.numGeomItems = 0, t.versions["zea-engine"] || (t.versions["zea-engine"] = new pe(e.loadStr())), this.__engineDataVersion = t.versions["zea-engine"], console.log("Loading Engine File version:", t.versions["zea-engine"]);
        var i = {};
        t.addGeomToLayer = function (e, t) { if (!i[t]) {
            a || (a = new ra("Layers"), _this.addChild(a, !1));
            var e_111 = new ba(t);
            e_111.propagateXfoToItems = !1, a.addChild(e_111, !1), i[t] = e_111;
        } i[t].addItem(e); };
        var s = function () { _this.__units = e.loadStr(); var t = 1; switch (_this.__units) {
            case "Millimeters":
                t = .001;
                break;
            case "Centimeters":
                t = .01;
                break;
            case "Meters":
                t = 1;
                break;
            case "Kilometers":
                t = 1e3;
                break;
            case "Inches":
                t = .0254;
                break;
            case "Feet":
                t = .3048;
                break;
            case "Miles": t = 1609.34;
        } _this.__unitsScale = t; var a = _this.getLocalXfo().clone(); a.sc.scaleInPlace(t), _this.setLocalXfo(a); };
        t.versions["zea-engine"].greaterThan([0, 0, 6]) && s(), this.__materials.readBinary(e, t), _super.prototype.readBinary.call(this, e, t), t.versions["zea-engine"].greaterOrEqualThan([0, 0, 5]) && t.versions["zea-engine"].lessThan([0, 0, 7]) && s();
    };
    _a.prototype.toJSON = function (e, t) {
        var _this = this;
        if (e === void 0) { e = {}; }
        if (t === void 0) { t = 0; }
        return e.makeRelative = function (e) { var t = _this.getPath(), a = e.slice(0, t.length); for (var i_95 = 0; i_95 < a.length - 1; i_95++)
            if (a[i_95] != t[i_95])
                return console.warn("Param Path is not relative to the asset. May not be able to be resolved at load time:" + e), e; var i = e.slice(t.length - 1); return i[0] = ".", i; }, e.assetItem = this, _super.prototype.toJSON.call(this, e, t);
    };
    _a.prototype.fromJSON = function (e, t, a, i) {
        var _this = this;
        if (t === void 0) { t = {}; }
        if (a === void 0) { a = 0; }
        t || (t = {}), t.assetItem = this, t.numTreeItems = 0, t.numGeomItems = 0, null == t.version && (t.version = 0), t.assetItem = this;
        var s = [];
        t.resolvePath = function (e, t) { if (!e)
            throw new Error("Path not spcecified"); var a = _this.resolvePath(e); a ? t(a) : s.push(function () { var a = _this.resolvePath(e); a ? t(a) : console.warn("Path unable to be resolved:" + e); }); }, t.addPLCB = function (e) { return s.push(e); }, _super.prototype.fromJSON.call(this, e, t, a);
        for (var _b = 0, s_27 = s; _b < s_27.length; _b++) {
            var e_112 = s_27[_b];
            e_112();
        }
        i && i();
    };
    return _a;
}(ra));
J.registerClass("AssetItem", _a);
var Za = /** @class */ (function (_super) {
    __extends(Za, _super);
    function Za(e, t) {
        var _this = _super.call(this, e) || this;
        var a = _this.addParameter(new ve("image"));
        t && a.setValue(t), _this.addParameter(new Xe("scale", .01)), _this.addParameter(new Xe("alpha", 1)), _this.addParameter(new xe("color", new y(1, 1, 1))), _this.addParameter(new fe("alignedToCamera", !1));
        var i = _this.addParameter(new Ie("lineStartOffset")), s = _this.addParameter(new Ce("lineEnd", Z)), n = [], l = new He("LabelLinesMaterial", "LinesShader");
        l.getParameter("Color").setValue(new y(0, 0, 0), E.OPERATOR_SETVALUE), l.getParameter("Opacity").setValue(1, E.OPERATOR_SETVALUE), s.elementAdded.connect(function (e, t) { var a = new zt; a.setNumVertices(2), a.setNumSegments(1), a.setSegment(0, 0, 1); var i = new ma("line" + t); i.setGeometry(a, E.OPERATOR_SETVALUE), i.setMaterial(l, E.OPERATOR_SETVALUE), n[t] = i, r(t), _this.addChild(i, !1); }), s.elementRemoved.connect(function () { });
        var r = function (e) { var t = _this.__globalXfoParam.getValue().inverse(), a = i.getValue(), l = s.getValue()[e], r = n[e].getGeometry(); r.setVertex(0, a), r.setVertex(1, t.transformVec3(l)); }, o = function () { for (var e_113 = 0; e_113 < n.length; e_113++)
            r(e_113); };
        i.valueChanged.connect(o), s.valueChanged.connect(o), _this.__globalXfoParam.valueChanged.connect(o);
        return _this;
    }
    Za.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    Za.prototype.fromJSON = function (e, t, a) { return _super.prototype.fromJSON.call(this, e, t, a); };
    return Za;
}(ra));
J.registerClass("BillboardItem", Za);
var Ga = /** @class */ (function (_super) {
    __extends(Ga, _super);
    function Ga(e) {
        var _this = this;
        null == e && (e = "Camera"), _this = _super.call(this, e) || this, _this.__isOrthographicParam = _this.addParameter(new fe("isOrthographic", !1)), _this.__fovParam = _this.addParameter(new Xe("fov", 1)), _this.__nearParam = _this.addParameter(new Xe("near", .1)), _this.__farParam = _this.addParameter(new Xe("far", 1e3)), _this.__focalDistanceParam = _this.addParameter(new Xe("focalDistance", 5)), _this.projectionParamChanged = new C, _this.movementFinished = new C, _this.__isOrthographicParam.valueChanged.connect(_this.projectionParamChanged.emit), _this.__fovParam.valueChanged.connect(_this.projectionParamChanged.emit), _this.__nearParam.valueChanged.connect(_this.projectionParamChanged.emit), _this.__farParam.valueChanged.connect(_this.projectionParamChanged.emit), _this.setPositionAndTarget(new Z(3, 3, 1.75), new Z(0, 0, 1), E.GENERATED_VALUE), _this.setLensFocalLength("28mm", E.GENERATED_VALUE);
        return _this;
    }
    Ga.prototype.getNear = function () { return this.__nearParam.getValue(); };
    Ga.prototype.setNear = function (e) { this.__nearParam.setValue(e); };
    Ga.prototype.getFar = function () { return this.__farParam.getValue(); };
    Ga.prototype.setFar = function (e) { this.__farParam.setValue(e); };
    Ga.prototype.getFov = function () { return this.__fovParam.getValue(); };
    Ga.prototype.setFov = function (e) { this.__fovParam.setValue(e); };
    Ga.prototype.setLensFocalLength = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        var a = { "10mm": 100.4, "11mm": 95, "12mm": 90, "14mm": 81.2, "15mm": 77.3, "17mm": 70.4, "18mm": 67.4, "19mm": 64.6, "20mm": 61.9, "24mm": 53.1, "28mm": 46.4, "30mm": 43.6, "35mm": 37.8, "45mm": 29.9, "50mm": 27, "55mm": 24.6, "60mm": 22.6, "70mm": 19.5, "75mm": 18.2, "80mm": 17.1, "85mm": 16.1, "90mm": 15.2, "100mm": 13.7, "105mm": 13, "120mm": 11.4, "125mm": 11, "135mm": 10.2, "150mm": 9.1, "170mm": 8.1, "180mm": 7.6, "210mm": 6.5, "300mm": 4.6, "400mm": 3.4, "500mm": 2.7, "600mm": 2.3, "800mm": 1.7 };
        !e in a ? console.warn("Camera lense focal length not suported:" + e) : this.__fovParam.setValue(Math.degToRad(a[e]), t);
    };
    Ga.prototype.getFocalDistance = function () { return this.__focalDistanceParam.getValue(); };
    Ga.prototype.setFocalDistance = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        e < 1e-4 && console.error("Never set focal distance to zero"), this.__focalDistanceParam.setValue(e, t), this.__nearParam.setValue(.01 * e, t), this.__farParam.setValue(200 * e, t);
    };
    Ga.prototype.getIsOrthographic = function () { return this.__isOrthographicParam.getValue(); };
    Ga.prototype.setIsOrthographic = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        this.__isOrthographicParam.setValue(e, t);
    };
    Ga.prototype.setPositionAndTarget = function (e, t, a) {
        if (a === void 0) { a = E.USER_SETVALUE; }
        this.setFocalDistance(e.distanceTo(t), a);
        var i = new S;
        i.setLookAt(e, t, new Z(0, 0, 1)), this.setGlobalXfo(i, a);
    };
    Ga.prototype.getTargetPostion = function () { var e = this.__focalDistanceParam.getValue(), t = this.getGlobalXfo(), a = t.ori.getZaxis(); return a.scaleInPlace(-e), a.addInPlace(t.tr), a; };
    Ga.prototype.frameView = function (e, t, a) {
        if (a === void 0) { a = E.USER_SETVALUE; }
        var i = new v;
        for (var _b = 0, t_132 = t; _b < t_132.length; _b++) {
            var e_114 = t_132[_b];
            i.addBox3(e_114.getBoundingBox());
        }
        if (!i.isValid())
            return void console.warn("Bounding box not valid.");
        var s = this.__focalDistanceParam.getValue(), n = this.__fovParam.getValue(), l = this.getGlobalXfo().clone(), r = l.ori.getZaxis(), o = r.scale(-s), d = l.tr.add(o), h = i.center().subtract(d);
        l.tr.addInPlace(h);
        var c = new v;
        c.addBox3(i, l.inverse());
        c.center();
        var m = n * (e.getWidth() / e.getHeight()), u = c.p1, b = Math.abs(u.x) / Math.tan(.5 * m) * 1.2, p = Math.abs(u.y) / Math.tan(.5 * n) * 1.2, g = -.5 * (c.p0.z - c.p1.z), _ = Math.max(b, p) + g, Z = _ - s;
        l.tr.addInPlace(r.scale(Z)), this.setFocalDistance(_, a), this.setGlobalXfo(l, a), this.movementFinished.emit();
    };
    Ga.prototype.updateProjectionMatrix = function (e, t) { this.__isOrthographicParam.getValue(); var a = this.__fovParam.getValue(), i = this.__nearParam.getValue(), s = this.__farParam.getValue(); e.setPerspectiveMatrix(a, t, i, s); };
    return Ga;
}(ra));
J.registerClass("Camera", Ga);
var Xa = /** @class */ (function (_super) {
    __extends(Xa, _super);
    function Xa(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.addParameter(new xe("BackgroundColor", new y("#808080"))), _this.addParameter(new ve("EnvMap")), _this.addParameter(new fe("Display EnvMap", !1)), _this.addParameter(new Xe("EnvMapLOD", 0));
        return _this;
    }
    return Xa;
}(te));
var ya = /** @class */ (function (_super) {
    __extends(ya, _super);
    function ya(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.loaded.setToggled(!1), _this.lightmap = null, _this.geomsLoaded = new C(!0), _this.geomsLoaded.setToggled(!1), _this.loaded.setToggled(!1), _this.__geomLibrary.loaded.connect(function () { _this.geomsLoaded.emit(); }), _this.__datafileParam = _this.addParameter(new Te("DataFilePath")), _this.__datafileParam.valueChanged.connect(function () { var e = _this.__datafileParam.getFileDesc(); if (e) {
            if (console.log(e), _this.getName() == J.getClassName(_this)) {
                var e_115 = _this.__datafileParam.getStem();
                _this.setName(e_115);
            }
            _this.geomsLoaded.setToggled(!1), _this.loadDataFile(function () { _this.loaded.isToggled() || _this.loaded.emit(); }, function () { });
        } }), _this.addParameter(new xe("LightmapTint", new y(1, 1, 1, 1)));
        return _this;
    }
    ya.prototype.getLightmap = function () { return this.lightmap; };
    ya.prototype.readBinary = function (e, t) { if (-1 != t.version) {
        var e_116 = new pe;
        e_116.patch = t.version, t.versions = { "zea-mesh": e_116, "zea-engine": e_116 }, t.meshSdk = "FBX";
    }
    else {
        var a_123 = e.loadUInt8();
        if (e.seek(0), 10 != a_123) {
            var a_124 = new pe;
            a_124.patch = e.loadUInt32(), t.versions = { "zea-mesh": a_124, "zea-engine": a_124 }, t.meshSdk = "FBX";
        }
        else {
            var a_125 = new pe(e.loadStr());
            t.versions = { "zea-mesh": a_125 }, t.meshSdk = "FBX";
        }
    } this.meshfileversion = t.versions["zea-mesh"], this.meshSdk = t.meshSdk, console.log("Loading CAD File version:", t.versions["zea-mesh"], " exported using SDK:", t.meshSdk); var a = e.loadUInt32(); return _super.prototype.readBinary.call(this, e, t), t.versions["zea-engine"].lessThan([0, 0, 5]) && e.seek(e.byteLength - 4), this.__geomLibrary.setNumGeoms(e.loadUInt32()), a; };
    ya.prototype.loadDataFile = function (e, a) {
        var _this = this;
        var i = this.__datafileParam.getFileDesc();
        if (!i)
            return void console.warn("VLAAsset data file not found.");
        var s = this.__datafileParam.getFileFolderPath(), n = this.__datafileParam.getValue(), l = this.__datafileParam.getStem();
        var r = 0;
        var o = new RegExp("\\.(vla)$", "i").test(i.name), d = [], h = function (i) { var s, l = -1; if (i.tree2)
            s = new ge(i.tree2.buffer, 0, t.isMobileDevice);
        else {
            var e_117 = i.tree ? i.tree : i[Object.keys(i)[0]];
            s = new ge(e_117.buffer, 0, t.isMobileDevice), l = 0;
        } r = _this.readBinary(s, { assetItem: _this, version: l }), o || r != d.length && console.error("The number of GeomFiles does not match the count given by the VLA file."), e(), 0 == r && i.geoms0 ? (be.addWork(n + "geoms", 1), _this.__geomLibrary.readBinaryBuffer(n, i.geoms0.buffer, { version: l }), a()) : (be.addWork(n + "geoms", 4 * r), c()); }, c = function () { var e = []; for (var t_133 = 0; t_133 < r; t_133++)
            if (o) {
                var a_126 = s + l + t_133 + ".vlageoms", i_96 = be.resolveFilepath(a_126);
                if (!i_96)
                    throw new Error("VLA Geoms file not found:" + a_126);
                e.push(m(t_133, i_96.url));
            }
            else
                e.push(m(t_133, d[t_133].url)); Promise.all(e).then(function () { a && a(); }); }, m = function (e, t) { return new Promise(function (a) { be.loadUrl(n + e, t, function (e) { var t = e[Object.keys(e)[0]]; _this.__geomLibrary.readBinaryBuffer(n, t.buffer), a(); }, !1); }); };
        if (o)
            be.loadResource(n, h);
        else if (i.metadata.ConvertFile) {
            var e_118;
            i.metadata.ConvertFile.map(function (t) { t.filename.endsWith(".vla") ? e_118 = t : t.filename.endsWith(".vlageoms") && d.push(t); }), e_118 ? be.loadUrl(n, e_118.url, h) : console.warn("ConvertFile metadata contains no vla file.");
        }
        this.__geomLibrary.streamFileParsed.connect(function (e) { be.addWorkDone(n + "geoms", e); });
    };
    ya.prototype.fromJSON = function (e, t, a) {
        var _this = this;
        t || (t = {}), t.assetItem = this;
        var i = function () { _super.prototype.fromJSON.call(_this, e, t, a), a && a(); };
        if (e.params && e.params.DataFilePath) {
            this.__datafileLoaded = i;
            var a_127 = e.params.DataFilePath;
            delete e.params.DataFilePath, this.__datafileParam.fromJSON(a_127, t);
        }
        else
            i();
    };
    return ya;
}(_a));
J.registerClass("VLAAsset", ya);
var fa = new y("#DCDCDC");
var Va = /** @class */ (function () {
    function Va(e) {
        e && be.setResources(e), this.settings = new Xa("Scene Settings"), this.root = new ra("root"), this.root.addChild(this.settings), this.__commonResources = {};
    }
    Va.prototype.getSettings = function () { return this.settings; };
    Va.prototype.getRoot = function () { return this.root; };
    Va.prototype.getResourceLoader = function () { return be; };
    Va.prototype.setEnvMap = function (e) { console.warn("Deprecated Function. Please access the Scene Settings object."), this.settings.getParameter("EnvMap").setValue(e); };
    Va.prototype.addAsset = function (e) { console.warn("Deprecated Function. Please access the Scene Root object."), this.root.addChild(e, !1); };
    Va.prototype.setupGrid = function (e, t, a) {
        if (e === void 0) { e = 5; }
        if (t === void 0) { t = 50; }
        if (a === void 0) { a = fa; }
        var i = new ra("Grid"), s = new He("gridMaterial", "LinesShader");
        s.getParameter("BaseColor").setValue(a);
        var n = new At(e, e, t, t, !0);
        i.addChild(new ma("GridItem", n, s), !1);
        var l = new zt;
        l.setNumVertices(2), l.setNumSegments(1), l.setSegment(0, 0, 1), l.getVertex(0).set(-.5 * e, 0, 0), l.getVertex(1).set(.5 * e, 0, 0);
        var r = new He("gridXAxisMaterial", "LinesShader");
        r.getParameter("BaseColor").setValue(new y(a.luminance(), 0, 0)), i.addChild(new ma("xAxisLine", l, r), !1);
        var o = new He("gridZAxisMaterial", "LinesShader");
        o.getParameter("BaseColor").setValue(new y(0, a.luminance(), 0));
        var d = new S;
        d.ori.setFromAxisAndAngle(new Z(0, 0, 1), .5 * Math.PI);
        var h = new ma("yAxisLine", l, o);
        return h.setGeomOffsetXfo(d), i.addChild(h, !1), i.setSelectable(!1, !0), i.setFlag($.IGNORE_BBOX), i.clearFlag($.USER_EDITED), i.setFlag($.INVISIBLE), this.root.addChild(i, !1), i;
    };
    Va.prototype.loadCommonAssetResource = function (e) { if (e in this.__commonResources)
        return this.__commonResources[e]; var t = new ya; return t.getParameter("DataFilePath").setValue(e), this.__commonResources[e] = t, t; };
    Va.prototype.toJSON = function (e, t) {
        if (e === void 0) { e = {}; }
        if (t === void 0) { t = 0; }
        return e.makeRelative = function (e) { return e; }, { root: this.root.toJSON(e, t) };
    };
    Va.prototype.fromJSON = function (e, t) {
        var _this = this;
        if (t === void 0) { t = {}; }
        var a = [];
        t.resolvePath = function (e, t) { if (!e)
            throw new Error("Path not spcecified"); var i = _this.root.resolvePath(e); i ? t(i) : a.push(function () { var a = _this.resolvePath(e); a ? t(a) : console.warn("Path unable to be resolved:" + e); }); }, t.addPLCB = function (e) { return a.push(e); }, t.settings = this.settings, e.root && this.root.fromJSON(e.root, t);
        for (var _b = 0, a_128 = a; _b < a_128.length; _b++) {
            var e_119 = a_128[_b];
            e_119();
        }
    };
    return Va;
}());
var Ia = /** @class */ (function (_super) {
    __extends(Ia, _super);
    function Ia(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.geomsLoaded = new C(!0), _this.geomsLoaded.setToggled(!1), _this.loaded.setToggled(!1), _this.addParameter(new fe("splitObjects", !1)), _this.addParameter(new fe("splitGroupsIntoObjects", !1)), _this.addParameter(new fe("loadMtlFile", !0)), _this.addParameter(new Xe("unitsConversion", 1)), _this.addParameter(new Me("defaultShader", "")), _this.objfileParam = _this.addParameter(new Te("ObjFilePath")), _this.objfileParam.valueChanged.connect(function () { _this.loaded.untoggle(), _this.__loadObj(function () { _this.loaded.emit(); }, function () { _this.geomsLoaded.emit(); }); }), _this.geomLibrary = new ga, _this.materials = new Mt;
        return _this;
    }
    Ia.prototype.getGeometryLibrary = function () { return this.geomLibrary; };
    Ia.prototype.getMaterialLibrary = function () { return this.materials; };
    Ia.prototype.__loadObj = function (e, t) {
        var _this = this;
        var a = this.objfileParam.getStem(), i = function (e) { var t = e.split("\n"), a = /\s+/; var i; var s = function (e) { if (3 == e.length)
            return new y(parseFloat(e[0]), parseFloat(e[1]), parseFloat(e[2])); throw new Error("Unable to parse a color from the following parts:" + e.join("_")); }, n = function (e) { var t = _this.objfileParam.getFileFolder(); return new FileImage(e[0], t + e[0]); }; for (var e_120 = 0; e_120 < t.length; e_120++) {
            var l_14 = t[e_120].trim();
            if (l_14.startsWith("#"))
                continue;
            -1 != l_14.indexOf("#") && (l_14 = l_14.substring(0, l_14.indexOf("#")).trim());
            var r_9 = l_14.split(a), o_8 = r_9.shift(), d_3 = r_9.join(" ");
            switch (o_8) {
                case "newmtl":
                    i = new He(d_3), i.setShaderName("StandardSurfaceShader"), _this.materials.addMaterial(i);
                    break;
                case "Kd":
                    i.getParameter("BaseColor").setValue(s(r_9));
                    break;
                case "map_Kd":
                    i.getParameter("BaseColor").setValue(n(r_9));
                    break;
                case "Ks":
                    var e_121 = (parseFloat(r_9[0]) + parseFloat(r_9[1]) + parseFloat(r_9[2])) / 3;
                    i.roughness = 1 - e_121, i.getParameter("Roughness").setValue(1 - e_121), i.getParameter("Reflectance").setValue(e_121);
                    break;
                case "map_Ks":
                    i.getParameter("Roughness").setValue(n(r_9)), i.getParameter("Reflectance").setValue(.2);
                    break;
                case "d":
                    var t_134 = parseFloat(d_3);
                    t_134 < 1 && (i.setShaderName("TransparentSurfaceShader"), i.getParameter("Opacity").setValue(t_134));
                    break;
                case "map_d":
                    i.getParameter("alpha").setValue(parseFloat(r_9));
                    break;
                case "map_bump": i.getParameter("normal").setValue(n(r_9));
            }
        } }, s = new N;
        s.incAsyncCount(), s.ready.connect(function () { c(); });
        var n = function (e) { return new Promise(function (t) { se(e.url, function (e) { be.addWorkDone(a, 1), i(e), s.decAsyncCount(), be.addWorkDone(a, 1), t(); }); }); }, l = new Array, r = new Array, o = new Array, d = {}, h = function (e) { return __awaiter(_this, void 0, void 0, function () { var t, i, h, c, m, u, e_122, b, p_1, g_1, _1, _b, e_123, t_135, _c, e_124, t_136, a_129, i_97, s_28, s_29, n_26, l_15, e_125, e_126; return __generator(this, function (_d) {
            switch (_d.label) {
                case 0:
                    t = e.split("\n"), i = /\s+/;
                    h = void 0, c = void 0;
                    m = function (e) { var t = 0; for (; e in d;)
                        t++, e += String(t); h = { verticesRemapping: {}, texCoordsRemapping: {}, normalsRemapping: {}, vertexIndices: [], texCoordIndices: [], normalIndices: [], numVertices: 0, numTexCoords: 0, numNormals: 0, numTris: 0, numQuads: 0, material: c }, d[e] = h; };
                    m(a);
                    u = this.getParameter("splitGroupsIntoObjects").getValue();
                    e_122 = 0;
                    _d.label = 1;
                case 1:
                    if (!(e_122 < t.length)) return [3 /*break*/, 15];
                    b = t[e_122].trim();
                    if (b.startsWith("#"))
                        return [3 /*break*/, 14];
                    -1 != b.indexOf("#") && (b = b.substring(0, b.indexOf("#")).trim());
                    p_1 = b.split(i), g_1 = p_1.shift(), _1 = p_1.join(" ");
                    _b = g_1;
                    switch (_b) {
                        case "": return [3 /*break*/, 2];
                        case "s": return [3 /*break*/, 2];
                        case "mtllib": return [3 /*break*/, 3];
                        case "o": return [3 /*break*/, 6];
                        case "usemtl": return [3 /*break*/, 7];
                        case "g": return [3 /*break*/, 8];
                        case "v": return [3 /*break*/, 9];
                        case "vt": return [3 /*break*/, 10];
                        case "vn": return [3 /*break*/, 11];
                        case "f": return [3 /*break*/, 12];
                    }
                    return [3 /*break*/, 13];
                case 2: return [3 /*break*/, 14];
                case 3:
                    if (!this.getParameter("loadMtlFile").getValue())
                        return [3 /*break*/, 14];
                    s.incAsyncCount(), be.addWork(a, 2);
                    e_123 = this.objfileParam.getFileFolderPath(), t_135 = be.resolveFilepath(e_123 + _1);
                    _c = t_135;
                    if (!_c) return [3 /*break*/, 5];
                    return [4 /*yield*/, n(t_135)];
                case 4:
                    _c = (_d.sent());
                    _d.label = 5;
                case 5:
                    _c;
                    return [3 /*break*/, 14];
                case 6:
                    m(_1);
                    return [3 /*break*/, 14];
                case 7:
                    c = _1, m(_1 + Object.keys(d).length);
                    return [3 /*break*/, 14];
                case 8:
                    u && m(p_1.join("_"));
                    return [3 /*break*/, 14];
                case 9:
                    l.push(p_1.map(function (e) { return parseFloat(e); }));
                    return [3 /*break*/, 14];
                case 10:
                    o.push(p_1.map(function (e) { return parseFloat(e); }));
                    return [3 /*break*/, 14];
                case 11:
                    r.push(p_1.map(function (e) { return parseFloat(e); }));
                    return [3 /*break*/, 14];
                case 12:
                    {
                        e_124 = [], t_136 = [], a_129 = [];
                        for (i_97 = 0, s_28 = p_1.length; i_97 < s_28; i_97++) {
                            s_29 = p_1[i_97].split("/").map(function (e) { return parseInt(e) - 1; }), n_26 = s_29[0];
                            l_15 = h.verticesRemapping[n_26];
                            if (null == l_15 && (l_15 = h.numVertices, h.verticesRemapping[n_26] = l_15, h.numVertices++), e_124.push(l_15), s_29.length > 1 && !isNaN(s_29[1])) {
                                e_125 = s_29[1];
                                t_136.push(e_125);
                            }
                            if (s_29.length > 2 && !isNaN(s_29[2])) {
                                e_126 = s_29[2];
                                a_129.push(e_126);
                            }
                        }
                        h.vertexIndices.push(e_124), a_129.length > 0 && h.normalIndices.push(a_129), t_136.length > 0 && h.texCoordIndices.push(t_136), 3 == e_124.length ? h.numTris++ : h.numQuads++;
                        return [3 /*break*/, 14];
                    }
                    _d.label = 13;
                case 13:
                    console.warn("Unhandled line:" + b);
                    _d.label = 14;
                case 14:
                    e_122++;
                    return [3 /*break*/, 1];
                case 15:
                    s.decAsyncCount();
                    return [2 /*return*/];
            }
        }); }); }, c = function () { for (var e_127 in d)
            0 != d[e_127].numVertices && m(e_127, d[e_127]); e(), t(); }, m = function (e, t) { var a = t.numVertices, i = new Ut(e); i.setFaceCounts([t.numTris, t.numQuads]), i.setNumVertices(a); var s = i.getVertexAttribute("positions"), n = _this.getParameter("unitsConversion").getValue(); for (var e_128 in t.verticesRemapping) {
            var a_130 = t.verticesRemapping[e_128];
            s.getValueRef(a_130).set(l[e_128][0] * n, l[e_128][1] * n, l[e_128][2] * n);
        } var d, h; t.normalIndices.length > 0 && (d = i.addVertexAttribute("normals", Z)), t.texCoordIndices.length > 0 && (h = i.addVertexAttribute("texCoords", _)); for (var e_129 = 0; e_129 < t.vertexIndices.length; e_129++) {
            var a_131 = t.vertexIndices[e_129];
            if (i.setFaceVertexIndices.apply(i, __spreadArrays([e_129], a_131)), d) {
                var a_132 = t.normalIndices[e_129];
                for (var t_137 = 0; t_137 < a_132.length; t_137++) {
                    var i_98 = new Z(r[a_132[t_137]][0], r[a_132[t_137]][1], r[a_132[t_137]][2]);
                    d.setFaceVertexValue(e_129, t_137, i_98);
                }
            }
            if (h && t.texCoordIndices.length == t.vertexIndices.length) {
                var a_133 = t.texCoordIndices[e_129];
                for (var t_138 = 0; t_138 < a_133.length; t_138++) {
                    var i_99 = new _(o[a_133[t_138]][0], o[a_133[t_138]][1]);
                    h.setFaceVertexValue(e_129, t_138, i_99);
                }
            }
        } var c = new ma(e, i); c.selectable = !0; var m = i.boundingBox.center(); if (i.moveVertices(m.negate()), c.setLocalXfo(new S(m)), null != t.material && _this.materials.hasMaterial(t.material))
            c.setMaterial(_this.materials.getMaterial(t.material));
        else {
            var t_139 = _this.getParameter("defaultShader").getValue(), a_134 = new He(e + "mat");
            a_134.setShaderName("" != t_139 ? t_139 : "StandardSurfaceShader");
            var i_100 = a_134.getParameter("BaseColor");
            if (i_100)
                i_100.setValue(y.random(.5));
            else {
                var e_130 = a_134.getParameter("Color");
                e_130 && e_130.setValue(y.random(.5));
            }
            var s_30 = a_134.getParameter("Roughness");
            s_30 && s_30.setValue(.6);
            var n_27 = a_134.getParameter("Reflectance");
            n_27 && n_27.setValue(.2), _this.materials.addMaterial(a_134), c.setMaterial(a_134);
        } _this.addChild(c, !1); };
        (function () { var e = _this.objfileParam.getFileDesc(), t = _this.objfileParam.getStem(); be.addWork(t, 2), se(e.url, function (e) { be.addWorkDone(t, 1), h(e), be.addWorkDone(t, 1); }); })();
    };
    return Ia;
}(_a));
var Ra = /** @class */ (function (_super) {
    __extends(Ra, _super);
    function Ra(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.setFlag($.USER_EDITED), _this.__outputs = [], _this.__evalOutput = _this.__evalOutput.bind(_this), _this.postEval = new C;
        return _this;
    }
    Ra.prototype.setDirty = function () { for (var _b = 0, _c = this.__outputs; _b < _c.length; _b++) {
        var e_131 = _c[_b];
        e_131.setDirtyFromOp();
    } };
    Ra.prototype.__parameterValueChanged = function (e, t) { this.setDirty(); };
    Ra.prototype.addOutput = function (e) {
        var _this = this;
        return this.__outputs.push(e), e.paramSet.connect(function (e) { e.bindOperator(_this); }), e;
    };
    Ra.prototype.removeOutput = function (e) { e.getParam() && e.getParam().unbindOperator(this), this.__outputs.splice(this.__outputs.indexOf(e), 1); };
    Ra.prototype.getNumOutputs = function () { return this.__outputs.length; };
    Ra.prototype.getOutputByIndex = function (e) { return this.__outputs[e]; };
    Ra.prototype.getOutput = function (e) { for (var _b = 0, _c = this.__outputs; _b < _c.length; _b++) {
        var t_140 = _c[_b];
        if (t_140.getName() == e)
            return t_140;
    } };
    Ra.prototype.__evalOutput = function (e) { for (var _b = 0, _c = this.__outputs; _b < _c.length; _b++) {
        var e_132 = _c[_b];
        e_132.removeCleanerFn(this.__evalOutput);
    } this.evaluate(); };
    Ra.prototype.__opInputChanged = function () { this.setDirty(); };
    Ra.prototype.evaluate = function () { throw new Error("Not yet implemented"); };
    Ra.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); a.type = J.getClassName(this); var i = []; for (var _b = 0, _c = this.__outputs; _b < _c.length; _b++) {
        var a_135 = _c[_b];
        i.push(a_135.toJSON(e, t));
    } return a.outputs = i, a; };
    Ra.prototype.fromJSON = function (e, t, a) {
        var _this = this;
        if (_super.prototype.fromJSON.call(this, e, t, a), e.outputs) {
            for (var a_136 = 0; a_136 < this.__outputs.length; a_136++) {
                this.__outputs[a_136].fromJSON(e.outputs[a_136], t);
            }
            t.addPLCB(function () { _this.__opInputChanged(); });
        }
    };
    Ra.prototype.detach = function () { this.__outputs.forEach(function (e) { return e.detach(); }); };
    Ra.prototype.reattach = function () { this.__outputs.forEach(function (e) { return e.reattach(); }); };
    Ra.prototype.destroy = function () { _super.prototype.destroy.call(this), this.__outputs = []; };
    return Ra;
}(te));
var xa = /** @class */ (function () {
    function xa(e, t) {
        this.__name = e, this.__filterFn = t, this._param = void 0, this.detached = !1, this.paramSet = new C;
    }
    xa.prototype.getName = function () { return this.__name; };
    xa.prototype.getFilterFn = function () { return this.__filterFn; };
    xa.prototype.isConnected = function () { return null != this._param; };
    xa.prototype.getParam = function () { return this._param; };
    xa.prototype.setParam = function (e) { this._param = e, this.paramSet.emit(); };
    xa.prototype.getValue = function (e) {
        if (e === void 0) { e = P.OPERATOR_GETVALUE; }
        if (this._param)
            return this._param.getValue(e);
    };
    xa.prototype.setValue = function (e, t) {
        if (t === void 0) { t = E.OPERATOR_SETVALUE; }
        this._param && this._param.setValue(e, t);
    };
    xa.prototype.setClean = function (e) { this._param && this._param.setClean(e); };
    xa.prototype.setDirty = function (e) { this._param && this._param.setDirty(e); };
    xa.prototype.setDirtyFromOp = function () { this._param && this._param.setDirtyFromOp(); };
    xa.prototype.removeCleanerFn = function (e) { this._param && this._param.removeCleanerFn(e); };
    xa.prototype.toJSON = function (e, t) { var a = this._param ? this._param.getPath() : ""; return { type: this.constructor.name, paramPath: e && e.makeRelative ? e.makeRelative(a) : a }; };
    xa.prototype.fromJSON = function (e, t, a) {
        var _this = this;
        e.paramPath && t.resolvePath(e.paramPath, function (e) { _this.setParam(e); }, function (t) { console.warn("Operator Output: '" + _this.getName() + "'. Unable to load item:" + e.paramPath); });
    };
    xa.prototype.detach = function () { this.detached = !0; };
    xa.prototype.reattach = function () { this.detached = !1; };
    return xa;
}());
J.registerClass("OperatorOutput", xa);
var Sa = /** @class */ (function (_super) {
    __extends(Sa, _super);
    function Sa(e) {
        return _super.call(this, e, function (e) { return "Xfo" == e.getDataType(); }) || this;
    }
    Sa.prototype.getInitialValue = function () { return this._initialParamValue; };
    Sa.prototype.setParam = function (e) {
        var _this = this;
        (function () { if (_this._initialParamValue = e.getValue(), _this._initialParamValue.clone && (_this._initialParamValue = _this._initialParamValue.clone()), null == _this._initialParamValue)
            throw new Error("WTF?"); })(), this._param = e, this.paramSet.emit(e);
    };
    return Sa;
}(xa));
J.registerClass("XfoOperatorOutput", Sa);
var Wa = /** @class */ (function (_super) {
    __extends(Wa, _super);
    function Wa(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.addParameter(new Le("ParentGlobal")), _this.addParameter(new Le("LocalXfo")), _this.addOutput(new Sa("GlobalXfo"));
        return _this;
    }
    Wa.prototype.evaluate = function () { var e = this.getParameter("ParentGlobal").getValue(), t = this.getParameter("LocalXfo").getValue(); this.getOutputByIndex(0).setClean(e.multiply(t)); };
    return Wa;
}(Ra));
J.registerClass("CalcGlobalXfoOperator", Wa);
var La = /** @class */ (function (_super) {
    __extends(La, _super);
    function La(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__stageParam = _this._addMember(new Xe("Stage", 0)), _this.__axisParam = _this._addMember(new Ie("Axis", new Z(1, 0, 0))), _this.__movementParam = _this._addMember(new Ve("MovementTiming", new _(0, 1), [new _(0, 0), new _(1, 1)])), _this.__multiplierParam = _this._addMember(new Xe("Multiplier", 1)), _this.__output = new Sa("Part");
        return _this;
    }
    La.prototype.getStage = function (e) {
        if (e === void 0) { e = E.USER_GETVALUE; }
        return this.__stageParam.getValue(e);
    };
    La.prototype.setStage = function (e, t) {
        if (t === void 0) { t = E.USER_SETVALUE; }
        this.__stageParam.setValue(e, t);
    };
    La.prototype.getOutput = function () { return this.__output; };
    La.prototype.evaluate = function (e, t, a, i, s, n, l, r) { if (!this.__output.isConnected())
        return; var o = this.__stageParam.getValue(), d = this.__movementParam.getValue(); var h; if (s) {
        var a_137 = o / i;
        n && (a_137 -= .5), h = t * Math.linStep(d.x, d.y, Math.max(0, e - a_137));
    }
    else {
        var a_138 = 1 - o / i;
        n && (a_138 -= .5), h = t * Math.linStep(d.x, d.y, e) * a_138;
    } h += a; var c = this.__axisParam.getValue(); var m = this.__multiplierParam.getValue(), u = this.__output.getInitialValue(); var b; l ? (b = r.multiply(u), c = l.ori.rotateVec3(c), b.tr.addInPlace(c.scale(h * m))) : (b = this.__output.getValue(), b.tr = u.tr.add(c.scale(h * m))), this.__output.setClean(b); };
    La.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return a && (a.output = this.__output.toJSON(e, t)), a; };
    La.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), e.output && this.__output.fromJSON(e.output, t); };
    return La;
}(Ye));
var va = /** @class */ (function (_super) {
    __extends(va, _super);
    function va(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__stagesParam = _this.addParameter(new Xe("Stages", 0)), _this._explodeParam = _this.addParameter(new Xe("Explode", 0, [0, 1])), _this._distParam = _this.addParameter(new Xe("Dist", 1)), _this._offsetParam = _this.addParameter(new Xe("Offset", 0)), _this._cascadeParam = _this.addParameter(new fe("Cascade", !1)), _this._centeredParam = _this.addParameter(new fe("Centered", !1)), _this.__parentItemParam = _this.addParameter(new Ne("RelativeTo")), _this.__parentItemParam.valueChanged.connect(function () { var e = _this.__parentItemParam.getValue(); _this.__invParentSpace = e ? e.getGlobalXfo().inverse() : void 0; }), _this.__parentItemParam.treeItemGlobalXfoChanged.connect(function () { _this.setDirty(); }), _this.__itemsParam = _this.addParameter(new Ce("Parts", La)), _this.__itemsParam.elementAdded.connect(function (e, t) { if (t > 0) {
            var a_139 = _this.__itemsParam.getElement(t - 1).getStage();
            e.setStage(a_139 + 1), _this.__stagesParam.setClean(a_139 + 2);
        }
        else
            _this.__stagesParam.setClean(1); _this.addOutput(e.getOutput()), _this.setDirty(); }), _this.__itemsParam.elementRemoved.connect(function (e, t) { _this.removeOutput(e.getOutput()); }), _this.__localXfos = [], _this.__parts = [], _this.__stages = 2;
        return _this;
    }
    va.prototype.evaluate = function () { var e = this.__stagesParam.getValue(), t = this._explodeParam.getValue(), a = this._distParam.getValue(), i = this._offsetParam.getValue(), s = this._cascadeParam.getValue(), n = this._centeredParam.getValue(), l = this.__parentItemParam.getValue(); var r, o; l && (r = l.getGlobalXfo(), o = this.__invParentSpace.multiply(r)); var d = this.__itemsParam.getValue(); for (var l_16 = 0; l_16 < d.length; l_16++) {
        d[l_16].evaluate(t, a, i, e, s, n, r, o);
    } };
    va.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    va.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a); };
    va.prototype.destroy = function () { clearTimeout(this.__timeoutId), _super.prototype.destroy.call(this); };
    return va;
}(Ra));
J.registerClass("ExplodePartsOperator", va);
var Ma = /** @class */ (function (_super) {
    __extends(Ma, _super);
    function Ma(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__ratioParam = _this._addMember(new Xe("Ratio", 1)), _this.__offsetParam = _this._addMember(new Xe("Offset", 0)), _this.__axisParam = _this._addMember(new Ie("Axis", new Z(1, 0, 0))), _this.__output = new Sa("Gear");
        return _this;
    }
    Ma.prototype.getOutput = function () { return this.__output; };
    Ma.prototype.getRatio = function () { return this.__ratioParam.getValue(); };
    Ma.prototype.getOffset = function () { return this.__offsetParam.getValue(); };
    Ma.prototype.getAxis = function () { return this.__axisParam.getValue(); };
    Ma.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return a && (a.output = this.__output.toJSON(e, t)), a; };
    Ma.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), e.output && this.__output.fromJSON(e.output, t); };
    return Ma;
}(Ye));
var Fa = /** @class */ (function (_super) {
    __extends(Fa, _super);
    function Fa(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__revolutionsParam = _this.addParameter(new Xe("Revolutions", 0));
        var t = _this.addParameter(new Xe("RPM", 0));
        t.valueChanged.connect(function () { var e = t.getValue(); if (Math.abs(e) > 0) {
            if (!_this.__timeoutId) {
                var e_133 = function () { var a = t.getValue(), i = _this.__revolutionsParam.getValue(); _this.__revolutionsParam.setValue(i + a * (1 / 3e3)), _this.__timeoutId = setTimeout(e_133, 20); };
                e_133();
            }
        }
        else
            clearTimeout(_this.__timeoutId), _this.__timeoutId = void 0; }), _this.__gearsParam = _this.addParameter(new Ce("Gears", Ma)), _this.__gearsParam.elementAdded.connect(function (e, t) { _this.addOutput(e.getOutput()); }), _this.__gearsParam.elementRemoved.connect(function (e, t) { _this.removeOutput(t); }), _this.__gears = [];
        return _this;
    }
    Fa.prototype.evaluate = function () { var e = this.__revolutionsParam.getValue(), t = this.__gearsParam.getValue(); for (var _b = 0, t_141 = t; _b < t_141.length; _b++) {
        var a_140 = t_141[_b];
        var t_142 = a_140.getOutput(), i_101 = t_142.getInitialValue();
        if (!i_101)
            return;
        var s = e * a_140.getRatio() + a_140.getOffset(), n = new R;
        n.setFromAxisAndAngle(a_140.getAxis(), s * Math.PI * 2);
        var l = t_142.getValue();
        l.ori = n.multiply(i_101.ori), t_142.setClean(l);
    } };
    Fa.prototype.detach = function () { _super.prototype.detach.call(this), this.__timeoutId && (clearTimeout(this.__timeoutId), this.__timeoutId = null); };
    Fa.prototype.reattach = function () { _super.prototype.reattach.call(this), this.getParameter("RPM").valueChanged.emit(); };
    Fa.prototype.destroy = function () { this.__timeoutId && (clearTimeout(this.__timeoutId), this.__timeoutId = null), _super.prototype.destroy.call(this); };
    return Fa;
}(Ra));
J.registerClass("GearsOperator", Fa);
var Ta = /** @class */ (function (_super) {
    __extends(Ta, _super);
    function Ta() {
        var _this = this;
        _this = _super.call(this, "Piston") || this, _this.__pistonAngleParam = _this._addMember(new Xe("PistonAngle", 0)), _this.__camPhaseParam = _this._addMember(new Xe("CamPhase", 0)), _this.__camLengthParam = _this._addMember(new Xe("CamLength", 3)), _this.__rodLengthParam = _this._addMember(new Xe("RodLength", 3)), _this.__rodoutput = new Sa("Rod"), _this.__capoutput = new Sa("Cap"), _this.__pistonAngleParam.valueChanged.connect(_this.init.bind(_this)), _this.__camPhaseParam.valueChanged.connect(_this.init.bind(_this)), _this.__camLengthParam.valueChanged.connect(_this.init.bind(_this)), _this.__rodLengthParam.valueChanged.connect(_this.init.bind(_this)), _this.__bindXfos = {};
        return _this;
    }
    Ta.prototype.getRodOutput = function () { return this.__rodoutput; };
    Ta.prototype.getCapOutput = function () { return this.__capoutput; };
    Ta.prototype.setCrankXfo = function (e) { this.__baseCrankXfo = e, this.init(); };
    Ta.prototype.init = function () { if (!this.__baseCrankXfo)
        return; var e = this.__camPhaseParam.getValue(), t = this.__camLengthParam.getValue(), a = this.__rodLengthParam.getValue(), i = this.__pistonAngleParam.getValue(), s = new Z(Math.sin(Math.degToRad(i)), Math.cos(Math.degToRad(i)), 0); this.__pistonAxis = this.__baseCrankXfo.ori.rotateVec3(s), this.__camVec = this.__baseCrankXfo.ori.rotateVec3(new Z(Math.sin(2 * e * Math.PI) * t, Math.cos(2 * e * Math.PI) * t, 0)); var n = 2 * e * Math.PI, l = Math.sin(n) * t, r = Math.sqrt(a * a - l * l) + Math.cos(n) * t; this.__pistonOffset = r; };
    Ta.prototype.evaluate = function (e, t, a) { var i = this.__camPhaseParam.getValue(), s = this.__camLengthParam.getValue(), n = this.__rodLengthParam.getValue(), l = 2 * (i + a) * Math.PI, r = Math.sin(l) * s, o = Math.asin(r / n), d = Math.sqrt(n * n - r * r) + Math.cos(l) * s; if (this.__rodoutput.isConnected()) {
        var a_141 = this.__rodoutput.getInitialValue().clone(), i_102 = this.__rodoutput.getValue(), s_31 = i_102.tr.subtract(this.__baseCrankXfo.tr).dot(t), n_28 = new R;
        n_28.setFromAxisAndAngle(t, -o), i_102.tr = this.__baseCrankXfo.tr.add(e.rotateVec3(this.__camVec)), i_102.tr.addInPlace(t.scale(s_31)), i_102.ori = n_28.multiply(a_141.ori), this.__rodoutput.setValue(i_102);
    } if (this.__capoutput.isConnected()) {
        var e_134 = this.__capoutput.getInitialValue().clone(), t_143 = this.__capoutput.getValue();
        t_143.tr = e_134.tr.add(this.__pistonAxis.scale(d - this.__pistonOffset)), this.__capoutput.setValue(t_143);
    } };
    Ta.prototype.setOwner = function (e) { this.__owner = e; };
    Ta.prototype.getOwner = function () { return this.__owner; };
    Ta.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    Ta.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a); };
    Ta.prototype.clone = function (e) { return new Ta(this.__name, this.__value); };
    return Ta;
}(Ye));
var Ca = /** @class */ (function (_super) {
    __extends(Ca, _super);
    function Ca(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__revolutionsParam = _this.addParameter(new Xe("Revolutions", 0, [0, 1]));
        var t = _this.addParameter(new Xe("RPM", 0));
        t.valueChanged.connect(function () { var e = t.getValue(); if (e > 0) {
            if (!_this.__timeoutId) {
                var a_142 = function () { e = t.getValue(); var i = _this.__revolutionsParam.getValue(); _this.__revolutionsParam.setValue(i + e * (1 / 3e3)), _this.__timeoutId = setTimeout(a_142, 20); };
                a_142();
            }
        }
        else
            clearTimeout(_this.__timeoutId), _this.__timeoutId = void 0; }), _this.__crankOutput = _this.addOutput(new Sa("Crank")), _this.__crankOutput.paramSet.connect(_this.init.bind(_this)), _this.__crankAxisParam = _this.addParameter(new Ie("CrankAxis", new Z(1, 0, 0))), _this.__crankAxisParam.valueChanged.connect(function () { _this.__baseCrankXfo.ori.setFromDirectionAndUpvector(_this.__crankAxisParam.getValue(), new Z(0, 0, 1)), _this.init(); }), _this.__pistonsParam = _this.addParameter(new Ce("Pistons", Ta)), _this.__pistonsParam.elementAdded.connect(function (e) { e.setCrankXfo(_this.__baseCrankXfo), _this.addOutput(e.getRodOutput()), _this.addOutput(e.getCapOutput()); }), _this.__pistonsParam.elementRemoved.connect(function (e) { _this.removeOutput(e.getRodOutput()), _this.removeOutput(e.getCapOutput()); }), _this.__baseCrankXfo = new S, _this.__pistons = [];
        return _this;
    }
    Ca.prototype.setOwner = function (e) { _super.prototype.setOwner.call(this, e); };
    Ca.prototype.getCrankOutput = function () { return this.__crankOutput; };
    Ca.prototype.init = function () { var e = this.__pistonsParam.getValue(); for (var _b = 0, e_135 = e; _b < e_135.length; _b++) {
        var t_144 = e_135[_b];
        t_144.setCrankXfo(this.__baseCrankXfo);
    } this.__crankOutput.isConnected() && (this.__crankOffset = this.__baseCrankXfo.inverse().multiply(this.__crankOutput.getInitialValue())); };
    Ca.prototype.evaluate = function () { var e = this.__revolutionsParam.getValue(P.OPERATOR_GETVALUE), t = this.__crankAxisParam.getValue(P.OPERATOR_GETVALUE), a = new R; if (a.setFromAxisAndAngle(t, e * Math.PI * 2), this.__crankOutput.isConnected()) {
        var e_136 = this.__crankOutput.getValue();
        e_136.ori = a.multiply(this.__crankOutput.getInitialValue().ori), this.__crankOutput.setValue(e_136);
    } var i = this.__pistonsParam.getValue(), s = i.length; for (var n = 0; n < s; n++) {
        i[n].evaluate(a, t, e);
    } this.postEval.emit(e); };
    Ca.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    Ca.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), e.crankOutput && this.__crankOutput.fromJSON(e.crankOutput, t), this.init(); };
    Ca.prototype.destroy = function () { clearTimeout(this.__timeoutId), _super.prototype.destroy.call(this); };
    return Ca;
}(Ra));
J.registerClass("PistonOperator", Ca);
var Ya = /** @class */ (function (_super) {
    __extends(Ya, _super);
    function Ya(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__inputParam = _this.addParameter(new Xe("Input")), _this.__routesParam = _this.addParameter(new Ce("Routes", Xe)), _this.__routesParam.elementAdded.connect(function (e) { e.setValue(1), _this.addOutput(new xa("Output")); }), _this.__routesParam.elementRemoved.connect(function (e, t) { _this.removeOutput(_this.getOutputByIndex(t)); });
        return _this;
    }
    Ya.prototype.evaluate = function () { var e = this.__inputParam.getValue(P.OPERATOR_GETVALUE), t = this.__routesParam.getValue(); var a = this.__outputs.length; for (; a--;) {
        this.__outputs[a].setValue(e * t[a].getValue(P.OPERATOR_GETVALUE));
    } this.postEval.emit(e); };
    Ya.prototype.toJSON = function (e, t) { return _super.prototype.toJSON.call(this, e, t); };
    Ya.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a); };
    Ya.prototype.destroy = function () { _super.prototype.destroy.call(this); };
    return Ya;
}(Ra));
J.registerClass("RouterOperator", Ya);
var Na = /** @class */ (function (_super) {
    __extends(Na, _super);
    function Na(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.addParameter(new Xe("Weight", 1)), _this.addParameter(new ye("Axis", 0, ["+X Axis", "-X Axis", "+Y Axis", "-Y Axis", "+Z Axis", "-Z Axis"])), _this.addParameter(new Xe("Stretch", 0)), _this.addParameter(new Xe("Initial Dist", 1)), _this.addParameter(new Le("Target")), _this.addOutput(new Sa("InputOutput"));
        return _this;
    }
    Na.prototype.resetStretchRefDist = function () { var e = this.getParameter("Target").getValue(), t = this.getOutputByIndex(0).getValue(), a = e.tr.subtract(t.tr).length(); this.getParameter("Initial Dist").setValue(a); };
    Na.prototype.evaluate = function () { var e = this.getParameter("Weight").getValue(), t = this.getParameter("Target").getValue(), a = this.getParameter("Axis").getValue(), i = this.getOutputByIndex(0), s = i.getValue(), n = t.tr.subtract(s.tr), l = n.length(); if (l < 1e-6)
        return; var r; switch (n.scaleInPlace(1 / l), a) {
        case 0:
            r = s.ori.getXaxis();
            break;
        case 1:
            r = s.ori.getXaxis().negate();
            break;
        case 2:
            r = s.ori.getYaxis();
            break;
        case 3:
            r = s.ori.getYaxis().negate();
            break;
        case 4:
            r = s.ori.getZaxis();
            break;
        case 5: r = s.ori.getZaxis().negate();
    } var o = new R; o.setFrom2Vectors(r, n), o.alignWith(new R), e < 1 && (o = (new R).lerp(o, e)), s.ori = o.multiply(s.ori); var d = this.getParameter("Stretch").getValue(); if (d > 0) {
        var e_137 = 1 + (l / this.getParameter("Initial Dist").getValue() - 1) * d;
        switch (a) {
            case 0:
            case 1:
                s.sc.x = e_137;
                break;
            case 2:
            case 3:
                s.sc.y = e_137;
                break;
            case 4:
            case 5: s.sc.z = e_137;
        }
    } i.setClean(s); };
    return Na;
}(Ra));
J.registerClass("AimOperator", Na);
var Ka = /** @class */ (function (_super) {
    __extends(Ka, _super);
    function Ka(e) {
        var _this = this;
        null == e && (e = "Camera"), _this = _super.call(this, e) || this, _this.__defaultManipulationState = "orbit", _this.__manipulationState = _this.__defaultManipulationState, _this.__mouseDown = !1, _this.__dragging = !1, _this.__mouseDragDelta = new _, _this.__keyboardMovement = !1, _this.__keysPressed = [], _this.__maxVel = .002, _this.__velocity = new Z, _this.__ongoingTouches = {}, _this.__orbitRateParam = _this.addParameter(new Xe("orbitRate", t.isMobileDevice ? -.3 : 1)), _this.__dollySpeedParam = _this.addParameter(new Xe("dollySpeed", .02)), _this.__mouseWheelDollySpeedParam = _this.addParameter(new Xe("mouseWheelDollySpeed", 5e-4)), _this.movementFinished = new C;
        return _this;
    }
    Ka.prototype.setDefaultManipulationMode = function (e) { this.__defaultManipulationState = e; };
    Ka.prototype.look = function (e, t) { var a = e.viewport, i = a.getCamera(), s = i.getFocalDistance(), n = this.__orbitRateParam.getValue(); if (this.__keyboardMovement) {
        var e_138 = i.getGlobalXfo();
        this.__mouseDownCameraXfo = e_138.clone(), this.__mouseDownZaxis = e_138.ori.getZaxis();
        var t_145 = this.__mouseDownZaxis.scale(-s);
        this.__mouseDownCameraTarget = e_138.tr.add(t_145);
    } var l = this.__mouseDownCameraXfo.clone(), r = new R; r.rotateZ(t.x / a.getWidth() * Math.PI * n), l.ori = r.multiply(l.ori); var o = new R; o.rotateX(t.y / a.getHeight() * Math.PI * n), l.ori.multiplyInPlace(o), i.setGlobalXfo(l); };
    Ka.prototype.orbit = function (e, t) { var a = e.viewport, i = a.getCamera(), s = i.getFocalDistance(), n = this.__orbitRateParam.getValue(); if (this.__keyboardMovement) {
        var e_139 = i.getGlobalXfo();
        this.__mouseDownCameraXfo = e_139.clone(), this.__mouseDownZaxis = e_139.ori.getZaxis();
        var t_146 = this.__mouseDownZaxis.scale(-s);
        this.__mouseDownCameraTarget = e_139.tr.add(t_146);
    } var l = this.__mouseDownCameraXfo.clone(), r = new R; r.rotateZ(t.x / a.getWidth() * 2 * Math.PI * -n), l.ori = r.multiply(l.ori); var o = new R; o.rotateX(t.y / a.getHeight() * Math.PI * -n), l.ori.multiplyInPlace(o), l.tr = this.__mouseDownCameraTarget.add(l.ori.getZaxis().scale(s)), i.setGlobalXfo(l); };
    Ka.prototype.pan = function (e, t) { var a = e.viewport, i = a.getCamera(), s = i.getFocalDistance(), n = i.getFov(), l = new Z(1, 0, 0), r = new Z(0, 1, 0), o = 2 * s * Math.tan(.5 * n), d = o * (a.getWidth() / a.getHeight()), h = new S; h.tr = l.scale(-t.x / a.getWidth() * d), h.tr.addInPlace(r.scale(t.y / a.getHeight() * o)), i.setGlobalXfo(this.__mouseDownCameraXfo.multiply(h)); };
    Ka.prototype.dolly = function (e, t) { var a = e.viewport, i = a.getCamera(), s = t.x * this.__dollySpeedParam.getValue(), n = new S; n.tr.set(0, 0, s), i.setGlobalXfo(this.__mouseDownCameraXfo.multiply(n)); };
    Ka.prototype.panAndZoom = function (e, t, a) { var i = e.viewport, s = i.getCamera(), n = s.getFocalDistance(), l = s.getFov(), r = new Z(1, 0, 0), o = new Z(0, 1, 0), d = 2 * n * Math.tan(.5 * l), h = d * (i.getWidth() / i.getHeight()), c = new S; c.tr = r.scale(-t.x / i.getWidth() * h), c.tr.addInPlace(o.scale(t.y / i.getHeight() * d)); var m = a * n; s.setFocalDistance(this.__mouseDownFocalDist + m), c.tr.z += m, s.setGlobalXfo(this.__mouseDownCameraXfo.multiply(c)); };
    Ka.prototype.initDrag = function (e) { var t = e.viewport, a = t.getCamera(), i = a.getFocalDistance(); this.__mouseDown = !0, this.__calculatingDragAction = !1, this.__mouseDownPos = e.mousePos, this.__mouseDownViewport = t, this.__mouseDragDelta.set(0, 0), this.__mouseDownCameraXfo = a.getGlobalXfo().clone(), this.__mouseDownZaxis = this.__mouseDownCameraXfo.ori.getZaxis(); var s = this.__mouseDownZaxis.scale(-i); this.__mouseDownCameraTarget = a.getGlobalXfo().tr.add(s), this.__mouseDownFocalDist = i, this.__dragListenerId = a.getParameter("GlobalXfo").valueChanged.connect(this.__globalXfoChangedDuringDrag.bind(this)); };
    Ka.prototype.__globalXfoChangedDuringDrag = function (e) { if (!this.__calculatingDragAction) {
        this.__mouseDownViewport.getCamera().getParameter("GlobalXfo").valueChanged.disconnectId(this.__dragListenerId), this.initDrag({ viewport: this.__mouseDownViewport, mousePos: this.__mouseDownPos });
    } };
    Ka.prototype.endDrag = function (e) { if (this.__dragListenerId) {
        var t_147 = e.viewport;
        t_147.getCamera().getParameter("GlobalXfo").valueChanged.disconnectId(this.__dragListenerId), this.__dragListenerId = null;
    } this.__mouseDown = !1, this.__dragging = !1; };
    Ka.prototype.aimFocus = function (e, t) {
        var _this = this;
        var a = e.viewport, i = a.getCamera();
        this.__focusIntervalId && clearInterval(this.__focusIntervalId);
        var s = 0;
        var n = function () { var e = i.getGlobalXfo(), a = i.getFocalDistance(), l = t.subtract(e.tr), r = l.normalizeInPlace(), o = new R, d = new R; {
            var t_148 = e.ori.getZaxis().clone();
            t_148.z = 0;
            var a_143 = l.negate();
            a_143.z = 0, o.setFrom2Vectors(t_148, a_143);
        } {
            var t_149 = e.ori.getZaxis().clone(), a_144 = l.negate();
            t_149.x = a_144.x, t_149.y = a_144.y, t_149.normalizeInPlace(), t_149.cross(a_144).dot(e.ori.getXaxis()) > 0 ? d.rotateX(t_149.angleTo(a_144)) : d.rotateX(-t_149.angleTo(a_144));
        } var h = e.clone(); h.ori = o.multiply(h.ori), h.ori.multiplyInPlace(d); var c = Math.pow(s / 20, 2), m = e.clone(); m.ori = e.ori.lerp(h.ori, c), i.setFocalDistance(a + (r - a) * c), i.setGlobalXfo(m), s++, s <= 20 ? _this.__focusIntervalId = setTimeout(n, 20) : (_this.__focusIntervalId = void 0, _this.movementFinished.emit()); };
        n(), this.__manipulationState = "focussing";
    };
    Ka.prototype.onMouseMove = function (e) { };
    Ka.prototype.onDoubleClick = function (e) { if (e.intersectionData) {
        var t_150 = e.viewport.getCamera().getGlobalXfo().tr.add(e.mouseRay.dir.scale(e.intersectionData.dist));
        this.aimFocus(e, t_150);
    } };
    Ka.prototype.onMouseDown = function (e) { this.initDrag(e), 2 == e.button ? this.__manipulationState = "pan" : e.ctrlKey && e.altKey ? this.__manipulationState = "dolly" : e.ctrlKey || 2 == e.button ? this.__manipulationState = "look" : this.__manipulationState = this.__defaultManipulationState; };
    Ka.prototype.onMouseMove = function (e) { if (!this.__mouseDown)
        return; var t = e.mousePos; switch (this.__calculatingDragAction = !0, this.__keyboardMovement ? this.__mouseDragDelta = t : this.__mouseDragDelta = t.subtract(this.__mouseDownPos), this.__manipulationState) {
        case "orbit":
            this.orbit(e, this.__mouseDragDelta);
            break;
        case "look":
            this.look(e, this.__mouseDragDelta);
            break;
        case "pan":
            this.pan(e, this.__mouseDragDelta);
            break;
        case "dolly": this.dolly(e, this.__mouseDragDelta);
    } this.__dragging = !0, this.__calculatingDragAction = !1, e.stopPropagation(); };
    Ka.prototype.onMouseUp = function (e) { this.__dragging && (this.movementFinished.emit(), e.stopPropagation()), this.endDrag(e); };
    Ka.prototype.onWheel = function (e) {
        var _this = this;
        var t = e.viewport, a = t.getCamera(), i = this.__mouseWheelDollySpeedParam.getValue(), s = e.shiftKey ? .1 : .5, n = a.getGlobalXfo(), l = n.ori.getZaxis();
        this.__mouseWheelZoomIntervalId && clearInterval(this.__mouseWheelZoomIntervalId);
        var r = 0;
        var o = function () { var t = a.getFocalDistance(), d = e.deltaY * i * t * s; n.tr.addInPlace(l.scale(d)), "orbit" == _this.__defaultManipulationState && a.setFocalDistance(a.getFocalDistance() + d), a.setGlobalXfo(n), r++, r < 10 ? _this.__mouseWheelZoomIntervalId = setTimeout(o, 10) : (_this.__mouseWheelZoomIntervalId = void 0, _this.movementFinished.emit()); };
        o();
    };
    Ka.prototype.__integrateVelocityChange = function (e) { var t = e.viewport, a = t.getCamera(), i = new S; i.tr = this.__velocity.normalize().scale(this.__maxVel), a.setGlobalXfo(a.getGlobalXfo().multiply(i)); };
    Ka.prototype.onKeyPressed = function (e, t) { return !1; };
    Ka.prototype.onKeyDown = function (e, t) { };
    Ka.prototype.onKeyUp = function (e, t) { };
    Ka.prototype.__startTouch = function (e) { this.__ongoingTouches[e.identifier] = { identifier: e.identifier, pos: new _(e.pageX, e.pageY) }; };
    Ka.prototype.__endTouch = function (e) { delete this.__ongoingTouches[e.identifier]; };
    Ka.prototype.onTouchStart = function (e) { console.log("onTouchStart"), e.preventDefault(), e.stopPropagation(), 0 == Object.keys(this.__ongoingTouches).length && (this.__manipMode = void 0); var t = e.changedTouches; for (var e_140 = 0; e_140 < t.length; e_140++)
        this.__startTouch(t[e_140]); 1 == Object.keys(this.__ongoingTouches).length && (this.initDrag(e), this.__dragging = !0); };
    Ka.prototype.onTouchMove = function (e) { e.preventDefault(), e.stopPropagation(), this.__calculatingDragAction = !0; var t = e.touches; if (1 == t.length && "panAndZoom" != this.__manipMode) {
        var a_145 = t[0], i_103 = new _(a_145.pageX, a_145.pageY), s = this.__ongoingTouches[a_145.identifier].pos.subtract(i_103);
        "look" == this.__defaultManipulationState ? (s.scaleInPlace(6), this.look(e, s)) : this.orbit(e, s);
    }
    else if (2 == t.length) {
        var a_146 = t[0], i_104 = this.__ongoingTouches[a_146.identifier], s = t[1], n = this.__ongoingTouches[s.identifier], l = new _(a_146.pageX, a_146.pageY), r = new _(s.pageX, s.pageY), o = n.pos.subtract(i_104.pos).length() - r.subtract(l).length(), d = l.subtract(i_104.pos), h = r.subtract(n.pos), c = d.add(h);
        c.scaleInPlace(.5), this.panAndZoom(e, c, .002 * o), this.__manipMode = "panAndZoom";
    } this.__calculatingDragAction = !1; };
    Ka.prototype.onTouchEnd = function (e) { e.preventDefault(), e.stopPropagation(); var t = e.changedTouches; for (var e_141 = 0; e_141 < t.length; e_141++)
        this.__endTouch(t[e_141]); 0 == Object.keys(this.__ongoingTouches).length && this.endDrag(e); };
    Ka.prototype.onTouchCancel = function (e) { e.preventDefault(); var t = e.touches; for (var e_142 = 0; e_142 < t.length; e_142++)
        this.__endTouch(t[e_142]); 0 == Object.keys(this.__ongoingTouches).length && this.endDrag(e); };
    Ka.prototype.onDoubleTap = function (e) { if (e.intersectionData) {
        var t_151 = e.viewport, a_147 = t_151.getCamera().getGlobalXfo().tr.add(e.touchRay.dir.scale(e.intersectionData.dist));
        this.aimFocus(e, a_147);
    } e.preventDefault(); };
    return Ka;
}(q));
var wa = Object.freeze({ __proto__: null, RefCounted: U, ParameterOwner: q, ItemFlags: $, BaseItem: te, getFileFolder: ae, loadTextfile: se, loadJSONfile: ne, loadXMLfile: le, loadBinfile: re, sgFactory: J, isObject: me, mergeDeep: ue, resourceLoader: be, Version: pe, BinReader: ge, BinWriter: _e, Command: Ge, ParamFlags: H, ValueGetMode: P, ValueSetMode: E, BaseParameter: O, Parameter: Q, MultiChoiceParameter: ye, BooleanParameter: fe, NumberParameter: Xe, Vec2Parameter: Ve, Vec3Parameter: Ie, Vec4Parameter: Re, ColorParameter: xe, Mat3Parameter: Se, Mat4Parameter: We, XfoParameter: Le, ImageParameter: ve, StringParameter: Me, CodeParameter: Fe, FilePathParameter: Te, ListParameter: Ce, StructParameter: Ye, TreeItemParameter: Ne, ItemSetParameter: Ke, ProxyParameter: we, GeometryParameter: ze, MaterialParameter: Tt, MaterialFloatParam: Je, MaterialColorParam: Pe, Attribute: Ct, BaseGeom: Nt, SAVE_FLAG_SKIP_GEOMDATA: 1024, VertexAttribute: Kt, Points: wt, Lines: zt, Mesh: Ut, PointsProxy: Pt, LinesProxy: Et, MeshProxy: Ht, PointGrid: kt, Rect: Bt, Circle: Dt, Cross: Ot, LinesCuboid: Qt, Grid: At, Cone: jt, Cuboid: qt, Cylinder: $t, Disc: ea, Plane: ta, Sphere: aa, Torus: ia, DataImage: ke, FileImage: ht, FileImage2D: ct, LDRImage: ut, LDRVideo: bt, GIFImage: pt, EnvMap: Rt, Lightmap: xt, LightmapMixer: St, Label: Lt, VideoStreamImage2D: vt, labelManager: Wt, SaveFlags: sa, LoadFlags: na, CloneFlags: la, TreeItem: ra, InstanceItem: oa, AudioItem: da, FileAudioItem: ha, BaseGeomItem: ca, GeomItem: ma, AssetItem: _a, BillboardItem: Za, Camera: Ga, Group: ba, GeomLibrary: ga, Material: He, BaseImage: Ue, MaterialLibrary: Mt, materialLibraryManager: Ft, Scene: Va, VLAAsset: ya, ObjAsset: Ia, Operator: Ra, OperatorOutput: xa, XfoOperatorOutput: Sa, CalcGlobalXfoOperator: Wa, ExplodePartsOperator: va, GearsOperator: Fa, PistonOperator: Ca, RouterOperator: Ya, AimOperator: Na, CameraMouseAndKeyboard: Ka });
var za = function (e, a) { console.log(t); var i = null; if (null != a.webglContextType)
    try {
        i = e.getContext(a.webglContextType, a), i.name = a.webglContextType;
    }
    catch (e) { }
else {
    ["webgl2", "webgl"].some(function (t) { try {
        i = e.getContext(t, a), i.name = t;
    }
    catch (e) { } if (i)
        return !0; });
} if (i)
    return i.sizeInBytes = function (e) { switch (e) {
        case this.BYTE:
        case this.UNSIGNED_BYTE: return 1;
        case this.SHORT:
        case this.UNSIGNED_SHORT: return 2;
        case this.INT:
        case this.UNSIGNED_INT:
        case this.FLOAT: return 4;
        default: throw new Error("unknown type");
    } }, "webgl2" == i.name ? (i.floatTexturesSupported = !0, i.__ext_float_linear = i.getExtension("OES_texture_float_linear"), i.__ext_texture_half_float_linear = i.getExtension("OES_texture_half_float_linear"), i.__ext_color_buffer_float = i.getExtension("EXT_color_buffer_float")) : (i.__ext_float = i.getExtension("OES_texture_float"), i.__ext_float ? (i.floatTexturesSupported = !0, i.__ext_float_linear = i.getExtension("OES_texture_float_linear")) : console.warn("OES_texture_float is not available"), i.__ext_half_float = i.getExtension("OES_texture_half_float"), i.__ext_half_float && (i.HALF_FLOAT = i.__ext_half_float.HALF_FLOAT_OES, i.floatTexturesSupported = !0, i.__ext_texture_half_float_linear = i.getExtension("OES_texture_half_float_linear")), i.__ext_color_buffer_float = i.getExtension("EXT_color_buffer_float"), i.__ext_std_derivatives = i.getExtension("OES_standard_derivatives"), i.__ext_Inst = i.getExtension("ANGLE_instanced_arrays"), i.__ext_Inst && (i.vertexAttribDivisor = i.__ext_Inst.vertexAttribDivisorANGLE.bind(i.__ext_Inst), i.drawArraysInstanced = i.__ext_Inst.drawArraysInstancedANGLE.bind(i.__ext_Inst), i.drawElementsInstanced = i.__ext_Inst.drawElementsInstancedANGLE.bind(i.__ext_Inst)), i.__ext_VAO = i.getExtension("OES_vertex_array_object"), i.__ext_VAO && (i.createVertexArray = i.__ext_VAO.createVertexArrayOES.bind(i.__ext_VAO), i.deleteVertexArray = i.__ext_VAO.deleteVertexArrayOES.bind(i.__ext_VAO), i.bindVertexArray = i.__ext_VAO.bindVertexArrayOES.bind(i.__ext_VAO)), i.__ext_element_index_uint = i.getExtension("OES_element_index_uint"), i.__ext_WEBGL_depth_texture = i.getExtension("WEBGL_depth_texture"), i.__ext_WEBGL_depth_texture && (i.UNSIGNED_INT_24_8 = i.__ext_WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL), i.DRAW_FRAMEBUFFER = i.FRAMEBUFFER), i.__ext_frag_depth = i.getExtension("EXT_frag_depth"), i.setupInstancedQuad = function () { var e = new Float32Array([0, 1, 2, 3]), t = new Uint16Array([0, 1, 2, 2, 1, 3]); this.__quadVertexIdsBuffer = this.createBuffer(), this.bindBuffer(this.ARRAY_BUFFER, this.__quadVertexIdsBuffer), this.bufferData(this.ARRAY_BUFFER, e, this.STATIC_DRAW), this.__quadIndexBuffer = this.createBuffer(), this.bindBuffer(this.ELEMENT_ARRAY_BUFFER, this.__quadIndexBuffer), this.bufferData(this.ELEMENT_ARRAY_BUFFER, t, this.STATIC_DRAW), this.__quadattrbuffers = { vertexIDs: { buffer: this.__quadVertexIdsBuffer, dataType: 6, dimension: 1, count: e.length, shared: !0 } }; }, i.drawQuad = function () { this.drawElements(this.TRIANGLES, 6, this.UNSIGNED_SHORT, 0); }, i.setupLineSegAttrBuffers = function () { var e = new Float32Array([0, 1]), t = i.createBuffer(); i.bindBuffer(i.ARRAY_BUFFER, t), i.bufferData(i.ARRAY_BUFFER, e, i.STATIC_DRAW), i.__linesegattrbuffers = { vertexIDs: { buffer: t, dimension: 1, count: e.length, shared: !0 } }; }, i; };
var Ua = /** @class */ (function (_super) {
    __extends(Ua, _super);
    function Ua(e, t) {
        var _this = this;
        if (_this = _super.call(this) || this, _this.__gl = e, _this.ready = new C(!0), _this.updated = new C, _this.resized = new C, _this.width = 0, _this.height = 0, _this.textureType = 1, _this.textureDesc = [0, 0, 0, 0], _this.__loaded = !1, _this.__bound = !1, null != t)
            if (t instanceof Ue) {
                _this.__texture = t, _this.__texture.setMetadata("gltexture", _this);
                var e_143 = function () { var e = _this.__texture.getParams(), t = e.width, a = e.height, i = e.data; _this.bufferData(i, t, a); };
                _this.__texture.isLoaded() ? (_this.configure(_this.__texture.getParams()), _this.__texture.updated.connect(e_143)) : _this.__texture.loaded.connect(function () { _this.configure(_this.__texture.getParams()), _this.__texture.updated.connect(e_143); });
            }
            else
                _this.configure(t);
        return _this;
    }
    Ua.prototype.isLoaded = function () { return this.__loaded; };
    Ua.prototype.getTexture = function () { return this.__texture; };
    Ua.prototype.getInternalFormat = function () { return this.__internalFormat; };
    Ua.prototype.getType = function () { return this.__typeParam; };
    Ua.prototype.getTypeID = function () { return this.__type; };
    Ua.prototype.getFormat = function () { return this.__formatParam; };
    Ua.prototype.getFormatID = function () { return this.__format; };
    Ua.prototype.getFilter = function () { return this.__filterParam; };
    Ua.prototype.getWrap = function () { return this.__wrapParam; };
    Ua.prototype.getMipMapped = function () { return this.__mipMapped; };
    Ua.prototype.configure = function (e, t) {
        if (t === void 0) { t = !0; }
        if (!("type" in e && "format" in e && "width" in e && "height" in e))
            throw new Error("Invalid texture params");
        var a = this.__gl, i = e.width, s = e.height, n = e.data, l = a.getParameter(a.MAX_TEXTURE_SIZE);
        if (i <= 0 || i > l || s <= 0 || s > l)
            throw new Error("gl-texture2d: Invalid texture size. width:" + i + " height:" + s + " maxSize:" + l);
        var r = e.format, o = e.type;
        var d = "minFilter" in e ? e.minFilter : "filter" in e ? e.filter : "LINEAR", h = "magFilter" in e ? e.magFilter : "filter" in e ? e.filter : "LINEAR";
        var c = "wrap" in e ? e.wrap : "CLAMP_TO_EDGE";
        if ("FLOAT" == o)
            if (this.textureType = 3, "webgl2" == a.name)
                "LINEAR" != d || a.__ext_float_linear || (console.warn("Floating point texture filtering not supported on this device"), d = "NEAREST"), "LINEAR" != h || a.__ext_float_linear || (console.warn("Floating point texture filtering not supported on this device"), h = "NEAREST");
            else if (a.__ext_float)
                "LINEAR" != d || a.__ext_float_linear || (console.warn("Floating point texture filtering not supported on this device"), d = "NEAREST"), "LINEAR" != h || a.__ext_float_linear || (console.warn("Floating point texture filtering not supported on this device"), h = "NEAREST");
            else {
                if (!a.__ext_half_float)
                    throw new Error("OES_texture_half_float is not available");
                o = "HALF_FLOAT", "LINEAR" != d || a.__ext_texture_half_float_linear || (console.warn("Half Float texture filtering not supported on this device"), d = "NEAREST"), "LINEAR" != h || a.__ext_texture_half_float_linear || (console.warn("Half Float texture filtering not supported on this device"), h = "NEAREST");
            }
        else if ("HALF_FLOAT" == o)
            if ("webgl2" == a.name)
                ;
            else {
                if (!a.supportUploadingHalfFloat && null != n)
                    throw new Error("Safari does not support uploading HALF_FLOAT texture data.");
                if (!a.__ext_half_float)
                    throw new Error("OES_texture_half_float is not available");
                if ("LINEAR" != d || a.__ext_texture_half_float_linear || (console.warn("Half Float texture filtering not supported on this device"), d = "NEAREST"), "LINEAR" != h || a.__ext_texture_half_float_linear || (console.warn("Half Float texture filtering not supported on this device"), h = "NEAREST"), "RGB" == r)
                    throw new Error("OES_texture_half_float onlysupports RGBA textures");
            }
        else if ("sRGB" == o && !a.__ext_sRGB)
            throw new Error("EXT_sRGB is not available");
        this.__formatParam = r, this.__typeParam = o, this.__minFilterParam = d, this.__magFilterParam = h, this.__wrapParam = c, this.__format = a[r], this.__internalFormat = "internalFormat" in e ? a[e.internalFormat] : this.__format, this.__type = a[o], "webgl2" == a.name && ("internalFormat" in e || (this.__type == a.FLOAT ? this.__format == a.RED ? this.__internalFormat = a.R32F : this.__format == a.RG ? this.__internalFormat = a.RG32F : this.__format == a.RGB ? this.__internalFormat = a.RGB32F : this.__format == a.RGBA && (this.__internalFormat = a.RGBA32F) : this.__type == a.HALF_FLOAT ? this.__format == a.RED ? this.__internalFormat = a.R16F : this.__format == a.RG ? this.__internalFormat = a.RG16F : this.__format == a.RGB ? this.__internalFormat = a.RGB16F : this.__format == a.RGBA && (this.__internalFormat = a.RGBA16F) : this.__type == a.UNSIGNED_BYTE && (this.__format == a.RED && (this.__internalFormat = a.R8), this.__format == a.RG && (this.__internalFormat = a.RG8), this.__format == a.RGB ? this.__internalFormat = a.RGB8 : this.__format == a.RGBA && (this.__internalFormat = a.RGBA8)))), this.__minFilter = a[d], this.__magFilter = a[h], this.__wrap = a[c], this.__flipY = "flipY" in e && e.flipY, this.__mipMapped = "mipMapped" in e && e.mipMapped, this.invert = "invert" in e && e.invert, this.alphaFromLuminance = "alphaFromLuminance" in e && e.alphaFromLuminance, this.textureDesc = [i, s, 0, 0], this.__gltex && a.deleteTexture(this.__gltex), this.__gltex = a.createTexture(), this.__updateGLTexParams(), n ? this.bufferData(n, i, s, !1, !1) : this.resize(i, s, !1, !1), this.__loaded || (this.ready.emit(), this.__loaded = !0);
    };
    Ua.prototype.__updateGLTexParams = function () { var e = this.__gl; e.bindTexture(e.TEXTURE_2D, this.__gltex), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, this.__minFilter), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, this.__magFilter), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, this.__wrap), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, this.__wrap); };
    Ua.prototype.bufferData = function (e, t, a, i, s) {
        if (t === void 0) { t = -1; }
        if (a === void 0) { a = -1; }
        if (i === void 0) { i = !0; }
        if (s === void 0) { s = !0; }
        var n = this.__gl;
        if (i && n.bindTexture(n.TEXTURE_2D, this.__gltex), null != e) {
            if (e instanceof Image || e instanceof ImageData || e instanceof HTMLCanvasElement || e instanceof HTMLImageElement || e instanceof HTMLVideoElement)
                n.texImage2D(n.TEXTURE_2D, 0, this.__internalFormat, this.__format, this.__type, e), this.width = e.width, this.height = e.height;
            else {
                -1 == t && (t = this.width), -1 == a && (a = this.height);
                var i_105 = t * a;
                var s_32;
                switch (this.__format) {
                    case n.RED:
                    case n.RED_INTEGER:
                    case n.ALPHA:
                    case n.LUMINANCE:
                    case n.LUMINANCE_ALPHA:
                        s_32 = 1;
                        break;
                    case n.RG:
                        s_32 = 2;
                        break;
                    case n.RGB:
                        s_32 = 3;
                        break;
                    case n.RGBA: s_32 = 4;
                }
                e.length != i_105 * s_32 && console.warn("Invalid data for Image width:" + t + " height:" + a + " format:" + this.__formatParam + " type:" + this.__typeParam + " Data Length:" + e.length + " Expected:" + i_105 * s_32), this.__type == n.HALF_FLOAT && e instanceof Float32Array && (e = Math.convertFloat32ArrayToUInt16Array(e)), "webgl2" == n.name ? n.texImage2D(n.TEXTURE_2D, 0, this.__internalFormat, t, a, 0, this.__format, this.__type, e, 0) : n.texImage2D(n.TEXTURE_2D, 0, this.__internalFormat, t, a, 0, this.__format, this.__type, e), this.width = t, this.height = a;
            }
            this.__mipMapped && n.generateMipmap(n.TEXTURE_2D);
        }
        else
            n.texImage2D(n.TEXTURE_2D, 0, this.__internalFormat, this.width, this.height, 0, this.__format, this.__type, null), this.width = t, this.height = a;
        s && this.updated.emit();
    };
    Ua.prototype.clear = function () { var e = this.__gl, t = this.width * this.height; var a, i; switch (this.__format) {
        case e.RED:
        case e.RED_INTEGER:
        case e.ALPHA:
        case e.LUMINANCE:
        case e.LUMINANCE_ALPHA:
            a = 1;
            break;
        case e.RG:
            a = 2;
            break;
        case e.RGB:
            a = 3;
            break;
        case e.RGBA:
            a = 4;
            break;
        default: throw new Error("Invalid Format");
    } switch (this.__type) {
        case e.UNSIGNED_BYTE:
            i = new UInt8Array(t * a);
            break;
        case e.HALF_FLOAT:
            i = new UInt16Array(t * a);
            break;
        case e.FLOAT:
            i = new Float32Array(t * a);
            break;
        default: throw new Error("Invalid Type");
    } "webgl2" == e.name ? e.texImage2D(e.TEXTURE_2D, 0, this.__internalFormat, this.width, this.height, 0, this.__format, this.__type, i, 0) : e.texImage2D(e.TEXTURE_2D, 0, this.__internalFormat, this.width, this.height, 0, this.__format, this.__type, i); };
    Ua.prototype.resize = function (e, t, a, i) {
        if (a === void 0) { a = !1; }
        if (i === void 0) { i = !0; }
        var s = this.__gl;
        if (this.width != e || this.height != t) {
            var n = s.getParameter(s.MAX_TEXTURE_SIZE);
            if (e < 0 || e > n || t < 0 || t > n)
                throw new Error("gl-texture2d: Invalid texture size. width:" + e + " height:" + t + " maxSize:" + n);
            if (a) {
                var a_148 = s.createTexture();
                s.bindTexture(s.TEXTURE_2D, a_148), s.texImage2D(s.TEXTURE_2D, 0, this.__internalFormat, e, t, 0, this.__format, this.__type, null);
                var i_106 = s.createFramebuffer();
                s.bindFramebuffer(s.FRAMEBUFFER, i_106), s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_2D, this.__gltex, 0), s.bindTexture(s.TEXTURE_2D, a_148), s.copyTexImage2D(s.TEXTURE_2D, 0, this.__internalFormat, 0, 0, this.width, this.height, 0), s.bindFramebuffer(s.FRAMEBUFFER, null), s.deleteFramebuffer(i_106), this.__gl.deleteTexture(this.__gltex), this.__gltex = a_148, this.__updateGLTexParams();
            }
            else
                s.bindTexture(s.TEXTURE_2D, this.__gltex), s.texImage2D(s.TEXTURE_2D, 0, this.__internalFormat, e, t, 0, this.__format, this.__type, null);
            this.width = e, this.height = t, i && this.resized.emit(e, t);
        }
    };
    Ua.prototype.populate = function (e, t, a, i, s, n) {
        if (i === void 0) { i = 0; }
        if (s === void 0) { s = 0; }
        if (n === void 0) { n = !0; }
        var l = this.__gl;
        n && l.bindTexture(l.TEXTURE_2D, this.__gltex), l.texSubImage2D(l.TEXTURE_2D, 0, i, s, t, a, this.__format, this.__type, e);
    };
    Ua.prototype.getSize = function () { return [this.width, this.height]; };
    Object.defineProperty(Ua.prototype, "glTex", {
        get: function () { return this.__gltex; },
        enumerable: true,
        configurable: true
    });
    Ua.prototype.getTexHdl = function () { return this.__gltex; };
    Ua.prototype.bind = function (e, t) { return console.warn("'bind' is deprecated. Please use 'bindToUniform'"), this.bindToUniform(e, t); };
    Ua.prototype.preBind = function (e, t) { return { textureTypeUnif: t[e.name + "Type"], textureDescUnif: t[e.name + "Desc"] }; };
    Ua.prototype.bindToUniform = function (e, t, a) { if (!this.__loaded)
        return !1; if (!this.__gltex)
        throw new Error("Unable to bind non-initialized or deleted texture."); var i = e.boundTextures++, s = this.__gl.TEXTURE0 + i, n = this.__gl; return n.activeTexture(s), n.bindTexture(n.TEXTURE_2D, this.__gltex), n.uniform1i(t.location, i), a && (a.textureTypeUnif && n.uniform1i(a.textureTypeUnif.location, this.textureType), a.textureDescUnif && this.__gl.uniform4fv(a.textureDescUnif.location, this.textureDesc)), !0; };
    Ua.prototype.destroy = function () { _super.prototype.destroy.call(this), this.__texture && this.__texture.setMetadata("gltexture", void 0), this.__gl.deleteTexture(this.__gltex), this.__gltex = void 0; };
    return Ua;
}(U));
var Ja = /** @class */ (function () {
    function Ja(e, t, a, i) {
        this.__gl = e, this.__shaderAttrs = t, this.__glattrbuffers = a, this.__indexBuffer = i;
    }
    Ja.prototype.bind = function (e) { var t = this.__gl; for (var e_144 in this.__shaderAttrs) {
        if ("instancedIds" == e_144)
            continue;
        var a_149 = this.__shaderAttrs[e_144], i_107 = a_149.location;
        if (-1 == i_107)
            continue;
        var s = this.__glattrbuffers[e_144];
        if (!s) {
            t.disableVertexAttribArray(i_107);
            continue;
        }
        var n = void 0, l = void 0, r = void 0;
        switch (s.dataType) {
            case 0:
                n = 1, l = 4, r = t.UNSIGNED_BYTE;
                break;
            case 1:
                n = 1, l = 4, r = t.BYTE;
                break;
            case 2:
                n = 1, l = 4, r = t.UNSIGNED_SHORT;
                break;
            case 3:
                n = 1, l = 4, r = t.SHORT;
                break;
            case 4:
                n = 1, l = 4, r = t.UNSIGNED_INT;
                break;
            case 5:
                n = 1, l = 4, r = t.INT;
                break;
            case 6:
                n = 1, l = 4, r = t.FLOAT;
                break;
            case _:
                n = 2, l = 4, r = t.FLOAT;
                break;
            case Z:
                n = 3, l = 4, r = t.FLOAT;
                break;
            case G:
            case y:
                n = 4, l = 4, r = t.FLOAT;
                break;
            case X:
                n = 4, l = 1, r = t.UNSIGNED_BYTE;
                break;
            default: throw "Unhandled Type";
        }
        var o = n * l, d = null != s.offset ? s.offset * n * l : 0, h = 1 == s.normalized, c = a_149.instanced;
        t.enableVertexAttribArray(i_107), t.bindBuffer(t.ARRAY_BUFFER, s.buffer), t.vertexAttribPointer(i_107, n, r, h, o, d), t.vertexAttribDivisor && (1 == c ? t.vertexAttribDivisor(i_107, 1) : t.vertexAttribDivisor(i_107, 0));
    } return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, this.__indexBuffer), !0; };
    Ja.prototype.unbind = function () { var e = this.__gl; for (var t_152 in this.__shaderAttrs) {
        var a_150 = this.__shaderAttrs[t_152].location;
        -1 != a_150 && (e.disableVertexAttribArray(a_150), e.vertexAttribDivisor(a_150, 0));
    } e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, null); };
    Ja.prototype.destroy = function () { };
    return Ja;
}());
var Pa = /** @class */ (function () {
    function Pa(e, t, a, i) {
        this.__gl = e, this.__vao = e.createVertexArray(), e.bindVertexArray(this.__vao);
        for (var i_108 in t) {
            if ("instancedIds" == i_108)
                continue;
            var s = t[i_108], n = s.location;
            if (-1 == n)
                continue;
            var l = a[i_108];
            if (!l) {
                e.disableVertexAttribArray(n);
                continue;
            }
            var r = void 0, o = void 0, d = void 0;
            switch (l.dataType) {
                case 0:
                    r = 1, o = 4, d = e.UNSIGNED_BYTE;
                    break;
                case 1:
                    r = 1, o = 4, d = e.BYTE;
                    break;
                case 2:
                    r = 1, o = 4, d = e.UNSIGNED_SHORT;
                    break;
                case 3:
                    r = 1, o = 4, d = e.SHORT;
                    break;
                case 4:
                    r = 1, o = 4, d = e.UNSIGNED_INT;
                    break;
                case 5:
                    r = 1, o = 4, d = e.INT;
                    break;
                case 6:
                    r = 1, o = 4, d = e.FLOAT;
                    break;
                case _:
                    r = 2, o = 4, d = e.FLOAT;
                    break;
                case Z:
                    r = 3, o = 4, d = e.FLOAT;
                    break;
                case G:
                case y:
                    r = 4, o = 4, d = e.FLOAT;
                    break;
                case X:
                    r = 4, o = 1, d = e.UNSIGNED_BYTE;
                    break;
                default: throw "Unhandled Type";
            }
            var h = r * o, c = null != l.offset ? l.offset * r * o : 0, m_3 = 1 == l.normalized, u_1 = s.instanced;
            e.enableVertexAttribArray(n), e.bindBuffer(e.ARRAY_BUFFER, l.buffer), e.vertexAttribPointer(n, r, d, m_3, h, c), u_1 ? e.vertexAttribDivisor(n, 1) : e.vertexAttribDivisor(n, 0);
        }
        this.__indexBuffer = i;
    }
    Pa.prototype.bind = function (e) { return this.__gl.bindVertexArray(this.__vao), this.__indexBuffer && this.__gl.bindBuffer(this.__gl.ELEMENT_ARRAY_BUFFER, this.__indexBuffer), !0; };
    Pa.prototype.unbind = function () { var e = this.__gl; for (var t_153 in this.__shaderAttrs) {
        var a_151 = this.__shaderAttrs[t_153].location;
        -1 != a_151 && (e.disableVertexAttribArray(a_151), e.vertexAttribDivisor(a_151, 0));
    } this.__gl.bindVertexArray(null), this.__indexBuffer && e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, null); };
    Pa.prototype.destroy = function () { this.__gl.deleteVertexArray(this.__vao); };
    return Pa;
}());
function Ea(e, t, a, i) { return null == e.createVertexArray ? new Ja(e, t, a, i) : new Pa(e, t, a, i); }
var Ha = /** @class */ (function (_super) {
    __extends(Ha, _super);
    function Ha(e, t) {
        var _this = this;
        _this = _super.call(this) || this, _this.__gl = e, _this.__geom = t, _this.__glattrs = {}, _this.__glattrbuffers = {}, _this.__shaderBindings = {}, _this.destructing = new C, _this.updated = new C;
        _this.__geom.geomDataChanged.connect(function (e) { _this.updateBuffers(e), _this.updated.emit(); });
        _this.__geom.geomDataTopologyChanged.connect(function (e) { _this.clearShaderBindings(), _this.updateBuffers(e), _this.updated.emit(); });
        return _this;
    }
    Ha.prototype.getGeom = function () { return this.__geom; };
    Ha.prototype.genBuffers = function () { };
    Ha.prototype.updateBuffers = function (e) { };
    Ha.prototype.bind = function (e) { if (this.__destroyed)
        throw new Error("Error binding a destroyed geom"); var t = this.__shaderBindings[e.shaderkey]; if (!t) {
        t = Ea(this.__gl, e.attrs, this.__glattrbuffers, this.__indexBuffer), this.__shaderBindings[e.shaderkey] = t;
    } return t.bind(e), !0; };
    Ha.prototype.unbind = function (e) { var t = this.__shaderBindings[e.shaderkey]; t && t.unbind(e); };
    Ha.prototype.draw = function () { throw new Error("Not implemented. Implement this method in a derived class."); };
    Ha.prototype.drawInstanced = function (e) { throw new Error("Not implemented. Implement this method in a derived class."); };
    Ha.prototype.bindAndDraw = function (e) { this.bind(e), this.draw(e); };
    Ha.prototype.clearShaderBindings = function () { for (var e_145 in this.__shaderBindings) {
        this.__shaderBindings[e_145].destroy();
    } this.__shaderBindings = {}; };
    Ha.prototype.destroy = function () { this.__geom.deleteMetadata("glgeom"), this.clearShaderBindings(); var e = this.__gl; for (var t_154 in this.__glattrbuffers) {
        var a_152 = this.__glattrbuffers[t_154];
        a_152.shared || e.deleteBuffer(a_152.buffer);
    } this.__glattrs = {}, this.__shaderBindings = {}, this.__destroyed = !0, this.destructing.emit(this); };
    return Ha;
}(U));
var ka = /** @class */ (function (_super) {
    __extends(ka, _super);
    function ka(e, t) {
        var _this = this;
        _this = _super.call(this, e, t) || this, _this.genBuffers();
        return _this;
    }
    ka.prototype.getNumTriangles = function () { return this.__numTriangles; };
    ka.prototype.genBuffers = function () { _super.prototype.genBuffers.call(this); var e = this.__gl, t = this.__geom.genBuffers(), a = t.indices; this.__numTriIndices = t.indices.length, a instanceof Uint8Array && (this.__indexDataType = this.__gl.UNSIGNED_BYTE), a instanceof Uint16Array && (this.__indexDataType = this.__gl.UNSIGNED_SHORT), a instanceof Uint32Array && (this.__indexDataType = this.__gl.UNSIGNED_INT), this.__numTriangles = a.length / 3, this.__numRenderVerts = t.numRenderVerts, this.__indexBuffer = e.createBuffer(), e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, this.__indexBuffer), e.bufferData(e.ELEMENT_ARRAY_BUFFER, t.indices, e.STATIC_DRAW); for (var a_153 in t.attrBuffers) {
        var i_109 = t.attrBuffers[a_153], s = e.createBuffer();
        e.bindBuffer(e.ARRAY_BUFFER, s), e.bufferData(e.ARRAY_BUFFER, i_109.values, e.STATIC_DRAW), this.__glattrbuffers[a_153] = { buffer: s, dataType: i_109.dataType, normalized: i_109.normalized }, "textureCoords" == a_153 && (this.__glattrbuffers.texCoords = this.__glattrbuffers.textureCoords);
    } };
    ka.prototype.updateBuffers = function (e) { var t = this.__gl, a = this.__geom.genBuffers({ includeIndices: !1 }); for (var e_146 in a.attrBuffers) {
        var i_110 = a.attrBuffers[e_146], s = this.__glattrbuffers[e_146];
        t.bindBuffer(t.ARRAY_BUFFER, s.buffer), t.bufferData(t.ARRAY_BUFFER, i_110.values, t.STATIC_DRAW);
    } };
    ka.prototype.getNumUnSplitVerts = function () { return this.__geom.vertices.length; };
    ka.prototype.getNumSplitVerts = function () { return this.__numRenderVerts; };
    ka.prototype.generateWireframesVAO = function () { if (!this.__vao)
        return !1; this.__geom.edgeVerts || this.__geom.genTopologyInfo(), this.__wireframesVao && this.__ext.deleteVertexArrayOES(this.__wireframesVao), this.__wireframesVao = this.__ext.createVertexArrayOES(), this.__ext.bindVertexArrayOES(this.__wireframesVao); var e = this.__gl, t = e.createBuffer(), a = Uint32Array.from(this.__geom.edgeVerts); e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, t), e.bufferData(e.ELEMENT_ARRAY_BUFFER, a, e.STATIC_DRAW); var i = this.__glattrbuffers.positions.buffer; e.enableVertexAttribArray(0), e.bindBuffer(e.ARRAY_BUFFER, i), e.vertexAttribPointer(0, 3, e.FLOAT, !1, 12, 0), this.__numWireIndices = a.length, this.__ext.bindVertexArrayOES(null); };
    ka.prototype.bindWireframeVAO = function (e) { return null != this.__wireframesVao && (this.__ext.bindVertexArrayOES(this.__wireframesVao), !0); };
    ka.prototype.unbindWireframeVAO = function () { this.__ext.bindVertexArrayOES(null); };
    ka.prototype.drawWireframe = function () { this.__wireframesVao && this.__gl.drawElements(this.__gl.LINES, this.__numWireIndices, this.__gl.UNSIGNED_INT, 0); };
    ka.prototype.generateHardEdgesVAO = function () { if (!this.__vao)
        return !1; this.__geom.edgeVerts || this.__geom.generateHardEdgesFlags(), this.__hardEdgesVao && this.__ext.deleteVertexArrayOES(this.__hardEdgesVao), this.__hardEdgesVao = this.__ext.createVertexArrayOES(), this.__ext.bindVertexArrayOES(this.__hardEdgesVao); var e = this.__gl, t = e.createBuffer(), a = Uint32Array.from(this.__geom.computeHardEdgesIndices()); e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, t), e.bufferData(e.ELEMENT_ARRAY_BUFFER, a, e.STATIC_DRAW); var i = this.__glattrbuffers.positions.buffer; e.enableVertexAttribArray(0), e.bindBuffer(e.ARRAY_BUFFER, i), e.vertexAttribPointer(0, 3, e.FLOAT, !1, 12, 0), this.__numEdgeIndices = a.length, this.__ext.bindVertexArrayOES(null); };
    ka.prototype.bindHardEdgesVAO = function (e) { return null != this.__hardEdgesVao && (this.__ext.bindVertexArrayOES(this.__hardEdgesVao), !0); };
    ka.prototype.unbindHardEdgesVAO = function () { this.__ext.bindVertexArrayOES(null); };
    ka.prototype.drawHardEdges = function () { this.__hardEdgesVao && this.__gl.drawElements(this.__gl.LINES, this.__numEdgeIndices, this.__gl.UNSIGNED_INT, 0); };
    ka.prototype.drawPoints = function () { this.__gl.drawArrays(this.__gl.POINTS, 0, this.__geom.numVertices()); };
    ka.prototype.draw = function () { this.__gl.drawElements(this.__gl.TRIANGLES, this.__numTriIndices, this.__indexDataType, 0); };
    ka.prototype.drawInstanced = function (e) { this.__gl.drawElementsInstanced(this.__gl.TRIANGLES, this.__numTriIndices, this.__indexDataType, 0, e); };
    ka.prototype.destroy = function () { _super.prototype.destroy.call(this), this.__gl.deleteBuffer(this.__indexBuffer), this.__indexBuffer = void 0; };
    return ka;
}(Ha));
var Ba = /** @class */ (function (_super) {
    __extends(Ba, _super);
    function Ba(e, t) {
        var _this = this;
        _this = _super.call(this, e, t) || this, _this.genBuffers();
        return _this;
    }
    Ba.prototype.genBuffers = function () { _super.prototype.genBuffers.call(this); var e = this.__gl, t = this.__geom.genBuffers(), a = t.indices; if (this.fatLines = (this.__geom.lineThickness > 0 || t.attrBuffers.lineThickness) && e.floatTexturesSupported, this.fatLines) {
        e.__quadVertexIdsBuffer || e.setupInstancedQuad(), this.__glattrbuffers.vertexIDs = e.__quadattrbuffers.vertexIDs, this.__drawCount = a.length / 2;
        var t_155 = this.__geom.getVertexAttributes(), i_111 = t_155.positions, s = t_155.lineThickness, n = 4, l = new Float32Array(i_111.length * n);
        for (var e_147 = 0; e_147 < i_111.length; e_147++) {
            Z.createFromFloat32Buffer(l.buffer, 4 * e_147).setFromOther(i_111.getValueRef(e_147)), l[4 * e_147 + 3] = s ? s.getFloat32Value(e_147) : this.__geom.lineThickness;
        }
        this.__positionsTexture = new Ua(e, { format: "RGBA", type: "FLOAT", width: i_111.length, height: 1, filter: "NEAREST", wrap: "CLAMP_TO_EDGE", data: l, mipMapped: !1 });
        var r = new Float32Array(a.length);
        for (var e_148 = 0; e_148 < a.length; e_148++) {
            var t_156 = void 0;
            t_156 = e_148 % 2 == 0 ? e_148 > 0 ? a[e_148] == a[e_148 - 1] : a[e_148] == a[a.length - 1] : e_148 < a.length - 1 ? a[e_148] == a[e_148 + 1] : a[e_148] == a[0], r[e_148] = (t_156 ? 1 : 0) + 2 * a[e_148];
        }
        var o = e.createBuffer();
        e.bindBuffer(e.ARRAY_BUFFER, o), e.bufferData(e.ARRAY_BUFFER, r, e.STATIC_DRAW), this.__glattrbuffers.segmentIndices = { buffer: o, dimension: 2 };
    }
    else {
        this.__indexBuffer = e.createBuffer(), e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, this.__indexBuffer), e.bufferData(e.ELEMENT_ARRAY_BUFFER, a, e.STATIC_DRAW);
        for (var a_154 in t.attrBuffers) {
            var i_112 = t.attrBuffers[a_154], s = e.createBuffer();
            e.bindBuffer(e.ARRAY_BUFFER, s), e.bufferData(e.ARRAY_BUFFER, i_112.values, e.STATIC_DRAW), this.__glattrbuffers[a_154] = { buffer: s, dataType: i_112.dataType, normalized: i_112.normalized };
        }
        this.__numSegIndices = a.length, this.__numVertices = t.numVertices;
    } a instanceof Uint8Array && (this.__indexDataType = this.__gl.UNSIGNED_BYTE), a instanceof Uint16Array && (this.__indexDataType = this.__gl.UNSIGNED_SHORT), a instanceof Uint32Array && (this.__indexDataType = this.__gl.UNSIGNED_INT); };
    Ba.prototype.updateBuffers = function (e) { var t = this.__gl, a = this.__geom.genBuffers(), i = a.indices; if (this.fatLines) {
        this.__drawCount = i.length / 2;
        var e_149 = this.__geom.getVertexAttributes(), a_155 = e_149.positions, s = e_149.lineThickness, n = 4, l = new Float32Array(a_155.length * n);
        for (var e_150 = 0; e_150 < a_155.length; e_150++) {
            Z.createFromFloat32Buffer(l.buffer, 4 * e_150).setFromOther(a_155.getValueRef(e_150)), l[4 * e_150 + 3] = s ? s.getFloat32Value(e_150) : this.__geom.lineThickness;
        }
        this.__positionsTexture.bufferData(l, a_155.length, 1);
        var r = new Float32Array(i.length);
        for (var e_151 = 0; e_151 < i.length; e_151++) {
            var t_157 = void 0;
            t_157 = e_151 % 2 == 0 ? e_151 > 0 && i[e_151] == i[e_151 - 1] : e_151 < i.length - 1 && i[e_151] == i[e_151 + 1], r[e_151] = (t_157 ? 1 : 0) + 2 * i[e_151];
        }
        t.bindBuffer(t.ARRAY_BUFFER, this.__glattrbuffers.segmentIndices.buffer), t.bufferData(t.ARRAY_BUFFER, r, t.STATIC_DRAW);
    }
    else {
        this.__geom.getVertexAttributes();
        if (e && e.indicesChanged) {
            var e_152 = this.__geom.getIndices();
            this.__numSegIndices != e_152.length && (t.deleteBuffer(this.__indexBuffer), this.__indexBuffer = t.createBuffer()), t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, this.__indexBuffer), t.bufferData(t.ELEMENT_ARRAY_BUFFER, e_152, t.STATIC_DRAW), this.__numSegIndices = e_152.length;
        }
        var s = a.numVertices != this.__numVertices;
        for (var e_153 in a.attrBuffers) {
            var i_113 = a.attrBuffers[e_153], n = this.__glattrbuffers[e_153];
            s && (t.deleteBuffer(n.buffer), n.buffer = t.createBuffer()), t.bindBuffer(t.ARRAY_BUFFER, n.buffer), t.bufferData(t.ARRAY_BUFFER, i_113.values, t.STATIC_DRAW);
        }
        this.__numVertices = a.numVertices, this.__numSegIndices = i.length;
    } i instanceof Uint8Array && (this.__indexDataType = this.__gl.UNSIGNED_BYTE), i instanceof Uint16Array && (this.__indexDataType = this.__gl.UNSIGNED_SHORT), i instanceof Uint32Array && (this.__indexDataType = this.__gl.UNSIGNED_INT); };
    Ba.prototype.bind = function (e) { if (this.fatLines && "LineThickness" in e.unifs) {
        var t_158 = this.__gl;
        var a_156 = this.__shaderBindings[e.shaderkey];
        a_156 || (a_156 = Ea(t_158, e.attrs, this.__glattrbuffers, t_158.__quadIndexBuffer), this.__shaderBindings[e.shaderkey] = a_156), a_156.bind(e);
        {
            var a_157 = e.unifs;
            a_157.positionsTexture && (this.__positionsTexture.bindToUniform(e, a_157.positionsTexture), t_158.uniform1i(a_157.positionsTextureSize.location, this.__positionsTexture.width));
        }
        var i_114 = e.unifs;
        return t_158.uniform1f(i_114.LineThickness.location, (this.__geom.lineThickness ? this.__geom.lineThickness : 1) * e.viewScale), !0;
    } return _super.prototype.bind.call(this, e); };
    Ba.prototype.drawPoints = function () { this.__gl.drawArrays(this.__gl.POINTS, 0, this.__geom.numVertices()); };
    Ba.prototype.draw = function (e) { var t = this.__gl; this.fatLines ? e.unifs.LineThickness && t.drawElementsInstanced(t.TRIANGLES, 6, t.UNSIGNED_SHORT, 0, this.__drawCount) : t.drawElements(this.__gl.LINES, this.__numSegIndices, this.__indexDataType, 0); };
    Ba.prototype.drawInstanced = function (e) { this.__gl.drawElementsInstanced(this.__gl.LINES, this.__numSegIndices, this.__indexDataType, 0, e); };
    return Ba;
}(Ha));
var Da = /** @class */ (function (_super) {
    __extends(Da, _super);
    function Da(e, t) {
        var _this = this;
        _this = _super.call(this, e, t) || this, _this.genBuffers();
        return _this;
    }
    Da.prototype.genBuffers = function () { _super.prototype.genBuffers.call(this); var e = this.__gl, t = this.__geom.genBuffers(); for (var a_158 in t.attrBuffers) {
        var i_115 = t.attrBuffers[a_158], s = e.createBuffer();
        e.bindBuffer(e.ARRAY_BUFFER, s), e.bufferData(e.ARRAY_BUFFER, i_115.values, e.STATIC_DRAW), this.__glattrbuffers[a_158] = { buffer: s, dataType: i_115.dataType, normalized: i_115.normalized };
    } this.__numVerts = t.numVertices, this.__vboState = 2; };
    Da.prototype.bind = function (e) { if (e.unifs.PointSize) {
        var t_159 = this.__gl;
        var a_159 = this.__shaderBindings[e.shaderkey];
        if (!a_159) {
            t_159.__quadVertexIdsBuffer || t_159.setupInstancedQuad();
            var i_116 = Object.assign(this.__glattrbuffers, t_159.__quadattrbuffers);
            a_159 = Ea(t_159, e.attrs, i_116, t_159.__quadIndexBuffer), this.__shaderBindings[e.shaderkey] = a_159;
        }
        return a_159.bind(e), !0;
    } return _super.prototype.bind.call(this, e); };
    Da.prototype.draw = function (e) { var t = this.__gl; e.unifs.PointSize ? t.drawElementsInstanced(t.TRIANGLES, 6, t.UNSIGNED_SHORT, 0, this.__numVerts) : t.drawArrays(t.POINTS, 0, this.__numVerts); };
    Da.prototype.drawInstanced = function (e) { this.__gl.drawArraysInstanced(this.__gl.POINTS, 0, this.__numVerts, e); };
    return Da;
}(Ha));
var Oa = { bool: Boolean, int: 5, uint: 4, float: 6, ivec2: _, ivec3: Z, ivec4: G, vec2: _, vec3: Z, vec4: G, color: y, mat3: V, mat4: I, sampler2D: Ue };
var Qa = new /** @class */ (function () {
    function class_6() {
        this.__shaderModules = {};
    }
    class_6.prototype.hasShaderModule = function (e) { return e in this.__shaderModules; };
    class_6.prototype.setShaderModule = function (e, t) { return this.parseShader(e, t); };
    class_6.prototype.getShaderModule = function (e) { return this.__shaderModules[e]; };
    class_6.prototype.getShaderModuleNames = function () { var e = []; for (var t_160 in this.__shaderModules)
        e.push(t_160); return e; };
    class_6.prototype.parseShader = function (e, t) { var a = function (e) { if (e.startsWith("..")) {
        return i.substring(0, i.lastIndexOf("/")) + e.substring(2);
    } return e.startsWith(".") ? i + e.substring(1) : e.startsWith("/") ? e.substring(1) : e; }, i = (m(e), e.substring(0, e.lastIndexOf("/"))), s = t.split("\n"), n = { glsl: " //starting:" + e + "\n", lines: s, numLines: 0, includeMetaData: [], uniforms: {}, attributes: {} }, l = /\s+/; var _loop_3 = function (t_161) {
        var i_117 = s[t_161], r = i_117.trim();
        if (r.startsWith("//") || r.startsWith("*"))
            n.glsl = n.glsl + i_117 + "\n", n.numLines++;
        else if (-1 != r.indexOf("//") && (r = r.slice(0, r.indexOf("//")).trim()), r.startsWith("<%") || r.startsWith("</%")) {
            var r_10 = function (e) { var t = (e = (e = e.startsWith("</%") ? e.slice(3) : e.slice(2)).endsWith("/>") ? e.slice(0, e.length - 2) : e.slice(0, e.length - 1)).split(l), a = { tag: t.shift(), attributes: {} }; for (var _b = 0, t_162 = t; _b < t_162.length; _b++) {
                var e_154 = t_162[_b];
                var t_163 = e_154.split("=");
                a.attributes[t_163[0]] = t_163[1].replace(/['"]+/g, "");
            } return a; }(s[t_161].trim());
            switch (r_10.tag) {
                case "include": {
                    var i_118 = a(r_10.attributes.file);
                    if (!this_3.hasShaderModule(i_118))
                        throw new Error("Error while parsing :" + e + " \nShader module not found:" + i_118 + "\n in:" + this_3.getShaderModuleNames());
                    var s_33 = this_3.getShaderModule(i_118);
                    m(r_10.attributes.file);
                    var l_17 = s_33.glsl;
                    l_17 = l_17.substring(l_17.indexOf("\n") + 1), n.glsl = n.glsl + " //including:" + r_10.attributes.file + "\n";
                    var o = {};
                    for (var e_155 in r_10.attributes) {
                        if ("file" == e_155)
                            continue;
                        var t_164 = r_10.attributes[e_155];
                        l_17 = l_17.replaceAll(e_155, t_164), o[e_155] = t_164;
                    }
                    n.glsl = n.glsl + l_17, n.includeMetaData.push({ src: n.numLines, tgt: t_161, length: s_33.numLines, key: i_118 }), n.glsl = n.glsl + " //continuing:" + e + "\n", n.numLines += s_33.numLines + 1;
                    for (var e_156 in s_33.attributes) {
                        var t_165 = e_156;
                        for (var e_157 in o)
                            t_165 = t_165.replaceAll(e_157, o[e_157]);
                        n.attributes[t_165] = s_33.attributes[e_156];
                    }
                    for (var e_158 in s_33.uniforms) {
                        var t_166 = e_158;
                        for (var e_159 in o)
                            t_166 = t_166.replaceAll(e_159, o[e_159]);
                        n.uniforms[t_166] = s_33.uniforms[e_158];
                    }
                    break;
                }
                default:
                    console.warn("Error while parsing :" + e + " \nUnhandled line:" + i_117);
                    return out_t_1 = t_161, "continue";
            }
        }
        else {
            var a_161 = function (t, a) { if (!(t[1] in Oa))
                throw new Error("Error while parsing :" + e + " \nType not recognized:" + t[1]); var s = t[2].slice(0, t[2].length - 1); n.attributes[s] = { type: Oa[t[1]], instanced: a }, "color" == t[1] && (t[1] = "vec4", i_117 = t.join(" ")); };
            if (r.startsWith("struct")) {
                var e_160 = "";
                if (-1 != r.indexOf("}"))
                    e_160 = r.substring(r.indexOf("{") + 1, r.indexOf("}") - 1);
                else
                    for (t_161++; i_117 += s[t_161] + "\n", e_160 += i_117.trim(), t_161++, -1 == e_160.indexOf("}");)
                        ;
                var a_162 = e_160.substring(e_160.indexOf("{") + 1, e_160.indexOf("}") - 1).split(";"), n_29 = [];
                for (var _b = 0, a_160 = a_162; _b < a_160.length; _b++) {
                    var e_161 = a_160[_b];
                    if (0 == e_161.length)
                        continue;
                    var t_167 = e_161.trim().split(l);
                    n_29.push({ name: t_167[1], type: Oa[t_167[0]] });
                }
                var o = r.split(l);
                Oa[o[1]] = n_29;
            }
            if (r.startsWith("attribute")) {
                a_161(r.split(l), !1);
            }
            if (r.startsWith("instancedattribute")) {
                var e_162 = r.split(l);
                a_161(e_162, !0), e_162[0] = "attribute", i_117 = e_162.join(" ");
            }
            else if (r.startsWith("uniform")) {
                var t_168 = r.split(l);
                var a_163 = 1;
                4 == t_168.length && (a_163 = 2);
                var s_34 = t_168[a_163];
                if (!(s_34 in Oa))
                    throw new Error("Error while parsing :" + e + " \nType not recognized:" + t_168[1]);
                var o = t_168[a_163 + 1].slice(0, t_168[a_163 + 1].length - 1);
                n.uniforms[o] = Oa[s_34], "struct" == n.uniforms[o] && console.log(t_168), "color" == t_168[1] && (t_168[1] = "vec4", i_117 = t_168.join(" "));
            }
            n.glsl = n.glsl + i_117 + "\n", n.numLines++;
        }
        out_t_1 = t_161;
    }; var this_3 = this, out_t_1; for (var t_161 = 0; t_161 < s.length; t_161++) {
        _loop_3(t_161);
        t_161 = out_t_1;
    } return this.__shaderModules[e] = n, n; };
    return class_6;
}());
var Aa = /** @class */ (function (_super) {
    __extends(Aa, _super);
    function Aa(e) {
        var _this = this;
        if (_this = _super.call(this) || this, !e)
            throw new Error("gl context must be passed to shader constructor");
        _this.__gl = e, _this.__shaderStages = { VERTEX_SHADER: { glsl: "", lines: 0, uniforms: {}, attributes: {} }, FRAGMENT_SHADER: { glsl: "", lines: 0, uniforms: {}, attributes: {} } }, _this.__shaderProgramHdls = {}, _this.__gltextures = {}, _this.updated = new C, _this.invisibleToGeomBuffer = !1;
        return _this;
    }
    Aa.isTransparent = function () { return !1; };
    Aa.isOverlay = function () { return !1; };
    Aa.prototype.__compileShaderStage = function (e, t, a, i) { var s = this.__gl; if (i || (i = s.shaderopts), i) {
        if (i.repl)
            for (var t_170 in i.repl)
                e = e.replaceAll(t_170, i.repl[t_170]);
        i.defines && (e = i.defines + e);
    } "webgl2" == s.name && (e = e.replaceAll("attribute", "in"), e = "#version 300 es\n" + (e = (e = "vertexShader" == a ? e.replaceAll("varying", "out") : e.replaceAll("varying", "in")).replaceAll("texture2D", "texture"))); var l = s.createShader(t); if (s.shaderSource(l, e), s.compileShader(l), !s.getShaderParameter(l, s.COMPILE_STATUS)) {
        console.log("Errors in :" + this.constructor.name);
        var t_171 = s.getShaderInfoLog(l).split("\n"), i_119 = {};
        for (var e_163 in t_171) {
            if (t_171[e_163].startsWith("'")) {
                t_171[e_163 - 1] = t_171[e_163 - 1] + t_171[e_163], delete t_171[e_163], e_163--;
                continue;
            }
            var a_164 = t_171[e_163].split(":");
            if (a_164.length >= 2) {
                var s_35 = parseInt(a_164[2]);
                isNaN(s_35) || (i_119[s_35] ? i_119[s_35].push(t_171[e_163]) : i_119[s_35] = [t_171[e_163]]);
            }
        }
        var n = [], r = e.split("\n");
        for (var e_164 = 0; e_164 < r.length; e_164++)
            if (n.push((e_164 + 1 + ":").lpad(" ", 3) + r[e_164]), e_164 + 1 in i_119) {
                var t_172 = i_119[e_164 + 1];
                for (var _b = 0, t_169 = t_172; _b < t_169.length; _b++) {
                    var e_165 = t_169[_b];
                    n.push(e_165), n.push("-".lpad("-", e_165.length));
                }
            }
        throw new Error("An error occurred compiling the shader \n=================\n" + this.constructor.name + "." + a + ": \n\n" + t_171.join("\n") + "\n" + n.join("\n"));
    } return l; };
    Aa.prototype.__createProgram = function (e) { var t = this.__gl; this.__shaderCompilationAttempted = !0; var a = t.createProgram(), i = this.__shaderStages.VERTEX_SHADER.glsl, s = {}; if (null != i) {
        var n_30 = this.__compileShaderStage(i, t.VERTEX_SHADER, "vertexShader", e);
        if (!n_30)
            return !1;
        t.attachShader(a, n_30), s[t.VERTEX_SHADER] = n_30;
    } var n = this.__shaderStages.FRAGMENT_SHADER.glsl; if (null != n) {
        var i_120 = Object.assign({}, t.shaderopts, e);
        i_120.frag && (i_120.defines = i_120.frag.defines + i_120.defines);
        var l_18 = this.__compileShaderStage(n, t.FRAGMENT_SHADER, "fragmentShader", i_120);
        if (!l_18)
            return !1;
        t.attachShader(a, l_18), s[t.FRAGMENT_SHADER] = l_18;
    } if (t.linkProgram(a), !t.getProgramParameter(a, t.LINK_STATUS)) {
        var e_166 = t.getProgramInfoLog(a);
        if (e_166.includes("D3D shader compilation failed")) {
            var e_167 = t.getExtension("WEBGL_debug_shaders");
            if (e_167) {
                var a_165 = e_167.getTranslatedShaderSource(s[t.VERTEX_SHADER]);
                console.log(a_165);
            }
        }
        throw console.log("vertexShaderGLSL:" + i), console.log("fragmentShaderGLSL:" + n), new Error("Unable to link the shader program:" + this.constructor.name + "\n==================\n" + e_166);
    } var l = this.__extractAttributeAndUniformLocations(a, e); return l.shaderProgramHdl = a, l; };
    Aa.prototype.__extractAttributeAndUniformLocations = function (e, t) { var a = this.__gl, i = this.getAttributes(), s = { attrs: {}, unifs: {} }; for (var t_173 in i) {
        var n_31 = a.getAttribLocation(e, t_173);
        if (null == n_31) {
            console.warn("Shader attribute not found:" + t_173);
            continue;
        }
        var l = i[t_173];
        s.attrs[t_173] = { name: t_173, location: n_31, type: l.type, instanced: l.instanced };
    } var n = this.getUniforms(); for (var i_121 in n) {
        var l = n[i_121];
        if (l instanceof Array)
            for (var _b = 0, l_19 = l; _b < l_19.length; _b++) {
                var t_174 = l_19[_b];
                var n_32 = i_121 + "." + t_174.name, l_20 = a.getUniformLocation(e, n_32);
                null != l_20 && (s.unifs[n_32] = { name: n_32, location: l_20, type: t_174.type });
            }
        if (t && t.repl)
            for (var e_168 in t.repl)
                i_121 = i_121.replace(e_168, t.repl[e_168]);
        var r = a.getUniformLocation(e, i_121);
        null != r && (s.unifs[i_121] = { name: i_121, location: r, type: l });
    } return s; };
    Aa.prototype.getAttributes = function () { var e = {}; for (var t_175 in this.__shaderStages) {
        var a_166 = this.__shaderStages[t_175];
        for (var t_176 in a_166.attributes)
            e[t_176] = a_166.attributes[t_176];
    } return e; };
    Aa.prototype.getUniforms = function () { var e = {}; for (var t_177 in this.__shaderStages) {
        var a_167 = this.__shaderStages[t_177];
        for (var t_178 in a_167.uniforms)
            e[t_178] = a_167.uniforms[t_178];
    } return e; };
    Aa.prototype.finalize = function () { };
    Aa.prototype.compileForTarget = function (e, t) { e || (e = this.constructor.name); var a = this.__shaderProgramHdls[e]; return a || !1 !== a && (a = this.__createProgram(t), this.__shaderProgramHdls[e] = a), a; };
    Aa.prototype.compile = function () { this.compileForTarget(); };
    Aa.prototype.bind = function (e, t) { var a = this.__gl; if (e.glshader != this) {
        var i_122 = this.compileForTarget(t, e.shaderopts);
        if (!1 === i_122)
            return console.warn(this.constructor.name + " is not compiled for " + t), !1;
        var s = i_122.shaderProgramHdl;
        a.useProgram(s), e.shaderkey = this.constructor.name, e.glshader = this, e.boundTextures = 0, e.boundLightmap = void 0, e.glgeom = void 0, e.unifs = i_122.unifs, e.attrs = i_122.attrs, e.bindRendererUnifs && e.bindRendererUnifs(i_122.unifs);
    } return e.supportsInstancing = !0, !0; };
    Aa.prototype.unbind = function (e) { return !0; };
    Aa.getParamDeclarations = function () { return []; };
    Aa.getGeomDataShaderName = function () { };
    Aa.getSelectedShaderName = function () { };
    Aa.prototype.destroy = function () { var e = this.__gl; for (var t_179 in this.__shaderProgramHdls) {
        var a_168 = this.__shaderProgramHdls[t_179];
        e.deleteProgram(a_168.shaderProgramHdl);
    } this.__shaderProgramHdls = {}; };
    return Aa;
}(te));
Qa.setShaderModule("utils/quadVertexFromID.glsl", "\n\nattribute float vertexIDs;\n\nvec2 getQuadVertexPositionFromID(){\n    int vertexID = int(vertexIDs);\n    if(vertexID == 0)\n        return vec2(-0.5, -0.5);\n    else if(vertexID == 1)\n        return vec2(0.5, -0.5);\n    else if(vertexID == 2)\n        return vec2(-0.5, 0.5);\n    else if(vertexID == 3)\n        return vec2(0.5, 0.5);\n    return vec2(0,0);\n}\n"), Qa.setShaderModule("utils/unpackHDR.glsl", "\n\nvec3 decodeHDR(const in vec3 ldrPixel, const in float cdmAlpha) {\n    float avg = (cdmAlpha * 16.0 - 8.0);\n    float scl = 1.0;\n    vec3 color;\n    color.x = (tan((ldrPixel.x-0.5)*1.5)/scl)+avg;\n    color.y = (tan((ldrPixel.y-0.5)*1.5)/scl)+avg;\n    color.z = (tan((ldrPixel.z-0.5)*1.5)/scl)+avg;\n\n    // convert from logarithmic curve to linear curve.\n    // subtract the epsilon that was added during encoding.\n    const float eps = 0.001;\n    color.x = pow(10.0, color.x) - eps;\n    color.y = pow(10.0, color.y) - eps;\n    color.z = pow(10.0, color.z) - eps;\n    return color;\n}\n\nvec3 decodeHDR(sampler2D ldrSampler, sampler2D cdmSampler, vec2 texCoord) {\n#ifdef ENABLE_ES3\n    float cdm = texture2D(cdmSampler, texCoord).r;\n#else\n    float cdm = texture2D(cdmSampler, texCoord).a;\n#endif\n    return decodeHDR(texture2D(ldrSampler, texCoord).rgb, cdm);\n}\n\n");
var ja = /** @class */ (function (_super) {
    __extends(ja, _super);
    function ja(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("UnpackHDRShader.vertexShader", '\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("UnpackHDRShader.fragmentShader", '\nprecision highp float;\n\nvarying vec2 v_texCoord;\nuniform sampler2D ldrSampler;\nuniform sampler2D cdmSampler;\nuniform float exposure;\nuniform vec4 tint;\n\n<%include file="utils/unpackHDR.glsl"/>\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(decodeHDR(ldrSampler, cdmSampler, v_texCoord) * tint.rgb * exposure, 1.0);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n\n');
        return _this;
    }
    return ja;
}(Aa));
var qa = /** @class */ (function () {
    function qa(e, a, i) {
        if (i === void 0) { i = !1; }
        !t.isIOSDevice || "FLOAT" != a.getType() && "HALF_FLOAT" != a.getType() || console.error("IOS devices are unable to render to float textures."), this.__gl = e, this.__colorTexture = a, this.__createDepthTexture = i, this.__clearColor = [0, 0, 0, 0], this.__depthTexture = void 0, this.setup = this.setup.bind(this), this.resize = this.resize.bind(this), this.__colorTexture && this.__colorTexture.resized.connect(this.resize), this.setup();
    }
    qa.prototype.setClearColor = function (e) { this.__clearColor = e; };
    qa.prototype.getWidth = function () { return this.__colorTexture.width; };
    qa.prototype.getHeight = function () { return this.__colorTexture.height; };
    qa.prototype.getSize = function () { return [this.__colorTexture.width, this.__colorTexture.height]; };
    qa.prototype.getColorTexture = function () { return this.__colorTexture; };
    qa.prototype.getDepthTextureGL = function () { return this.__depthTexture; };
    Object.defineProperty(qa.prototype, "width", {
        get: function () { return this.__colorTexture.width; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(qa.prototype, "height", {
        get: function () { return this.__colorTexture.height; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(qa.prototype, "size", {
        get: function () { return [this.__colorTexture.width, this.__colorTexture.height]; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(qa.prototype, "colorTexture", {
        get: function () { return this.__colorTexture; },
        enumerable: true,
        configurable: true
    });
    qa.prototype.setColorTexture = function (e) { this.__colorTexture = e, gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.__colorTexture.glTex, 0); };
    Object.defineProperty(qa.prototype, "depthTextureGL", {
        get: function () { return this.__depthTexture; },
        enumerable: true,
        configurable: true
    });
    qa.prototype.setup = function () { var e = this.__gl; if (this.__fbo = e.createFramebuffer(), "webgl2" == e.name ? e.bindFramebuffer(e.DRAW_FRAMEBUFFER, this.__fbo) : e.bindFramebuffer(e.FRAMEBUFFER, this.__fbo), this.__colorTexture && ("webgl2" == e.name ? e.framebufferTexture2D(e.DRAW_FRAMEBUFFER, e.COLOR_ATTACHMENT0, e.TEXTURE_2D, this.__colorTexture.glTex, 0) : e.framebufferTexture2D(e.FRAMEBUFFER, e.COLOR_ATTACHMENT0, e.TEXTURE_2D, this.__colorTexture.glTex, 0)), this.__createDepthTexture)
        if ("webgl2" == e.name || e.__ext_WEBGL_depth_texture)
            e.activeTexture(e.TEXTURE0), this.__depthTexture = e.createTexture(), e.bindTexture(e.TEXTURE_2D, this.__depthTexture), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, e.LINEAR), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.LINEAR), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, e.CLAMP_TO_EDGE), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, e.CLAMP_TO_EDGE), "webgl2" == e.name ? (e.texImage2D(e.TEXTURE_2D, 0, e.DEPTH_COMPONENT24, this.width, this.height, 0, e.DEPTH_COMPONENT, e.UNSIGNED_INT, null), e.framebufferTexture2D(e.DRAW_FRAMEBUFFER, e.DEPTH_ATTACHMENT, e.TEXTURE_2D, this.__depthTexture, 0)) : (e.texImage2D(e.TEXTURE_2D, 0, e.DEPTH_COMPONENT, this.width, this.height, 0, e.DEPTH_COMPONENT, e.UNSIGNED_INT, null), e.framebufferTexture2D(e.FRAMEBUFFER, e.DEPTH_ATTACHMENT, e.TEXTURE_2D, this.__depthTexture, 0));
        else {
            var t_180 = e.createRenderbuffer();
            e.bindRenderbuffer(e.RENDERBUFFER, t_180), e.renderbufferStorage(e.RENDERBUFFER, e.DEPTH_COMPONENT16, this.width, this.height), e.framebufferRenderbuffer(e.FRAMEBUFFER, e.DEPTH_ATTACHMENT, e.RENDERBUFFER, t_180);
        } this.__checkFramebuffer(), "webgl2" == e.name ? e.bindFramebuffer(e.DRAW_FRAMEBUFFER, null) : e.bindFramebuffer(e.FRAMEBUFFER, null); };
    qa.prototype.resize = function () { var e = this.__gl; "webgl2" == e.name ? e.bindFramebuffer(e.DRAW_FRAMEBUFFER, this.__fbo) : e.bindFramebuffer(e.FRAMEBUFFER, this.__fbo), e.framebufferTexture2D(e.FRAMEBUFFER, e.COLOR_ATTACHMENT0, e.TEXTURE_2D, this.__colorTexture.glTex, 0), this.__depthTexture && (e.activeTexture(e.TEXTURE0), e.bindTexture(e.TEXTURE_2D, this.__depthTexture), "webgl2" == e.name ? e.texImage2D(e.TEXTURE_2D, 0, e.DEPTH_COMPONENT24, this.width, this.height, 0, e.DEPTH_COMPONENT, e.UNSIGNED_INT, null) : e.texImage2D(e.TEXTURE_2D, 0, e.DEPTH_COMPONENT, this.width, this.height, 0, e.DEPTH_COMPONENT, e.UNSIGNED_INT, null)), this.__checkFramebuffer(); };
    qa.prototype.__checkFramebuffer = function () { var e = this.__gl; var t; if (t = "webgl2" == e.name ? e.checkFramebufferStatus(e.DRAW_FRAMEBUFFER) : e.checkFramebufferStatus(e.FRAMEBUFFER), t !== e.FRAMEBUFFER_COMPLETE)
        switch (e.bindTexture(e.TEXTURE_2D, null), "webgl2" == e.name ? e.bindFramebuffer(e.DRAW_FRAMEBUFFER, null) : e.bindFramebuffer(e.FRAMEBUFFER, null), console.warn("Error creating Fbo width:", this.width, ", height:", this.height, " Texture Type:", this.__colorTexture.getType()), t) {
            case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT: throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");
            case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT: throw new Error("There is no attachment.");
            case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS: throw new Error("Height and width of the attachment are not the same.");
            case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS: throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");
            case 36061: throw new Error("The framebuffer is unsupported");
            default: throw new Error("Incomplete Frambuffer");
        } };
    qa.prototype.bindForWriting = function (e) { e && (this.__prevBoundFbo = e.boundRendertarget, e.boundRendertarget = this.__fbo); var t = this.__gl; "webgl2" == t.name ? t.bindFramebuffer(t.DRAW_FRAMEBUFFER, this.__fbo) : t.bindFramebuffer(t.FRAMEBUFFER, this.__fbo), t.viewport(0, 0, this.width, this.height); };
    qa.prototype.unbindForWriting = function (e) { e && (e.boundRendertarget = this.__prevBoundFbo); var t = this.__gl; "webgl2" == t.name ? t.bindFramebuffer(t.DRAW_FRAMEBUFFER, this.__prevBoundFbo) : t.bindFramebuffer(t.FRAMEBUFFER, this.__prevBoundFbo); };
    qa.prototype.bind = function (e) { this.bindForWriting(e); };
    qa.prototype.unbind = function (e) { this.unbindForWriting(e); };
    qa.prototype.bindForReading = function () { var e = this.__gl; "webgl2" == e.name ? e.bindFramebuffer(e.READ_FRAMEBUFFER, this.__fbo) : e.bindFramebuffer(e.FRAMEBUFFER, this.__fbo); };
    qa.prototype.unbindForReading = function () { var e = this.__gl; "webgl2" == e.name ? e.bindFramebuffer(e.READ_FRAMEBUFFER, null) : e.bindFramebuffer(e.FRAMEBUFFER, null); };
    qa.prototype.clear = function () { var e = this.__gl; e.colorMask(!0, !0, !0, !0), e.clearColor.apply(e, this.__clearColor), this.__createDepthTexture ? e.clear(e.COLOR_BUFFER_BIT | e.DEPTH_BUFFER_BIT) : e.clear(e.COLOR_BUFFER_BIT); };
    qa.prototype.bindAndClear = function (e) { this.bind(e), this.clear(e); };
    qa.prototype.unbind = function () { var e = this.__gl; e.bindFramebuffer(e.FRAMEBUFFER, null); };
    qa.prototype.destroy = function () { var e = this.__gl; e.bindFramebuffer(e.FRAMEBUFFER, null), e.deleteFramebuffer(this.__fbo), this.__fbo = null, this.__colorTexture.resized.disconnect(this.resize); };
    return qa;
}());
var $a = /** @class */ (function (_super) {
    __extends($a, _super);
    function $a(e, t) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__hdrImage = t, _this.__hdrImage.setMetadata("gltexture", _this), _this.__hdrImage.updated.connect(function () { _this.__unpackHDRImage(_this.__hdrImage.getParams()); }), _this.__hdrImage.isLoaded() ? _this.__unpackHDRImage(_this.__hdrImage.getParams()) : _this.__hdrImage.loaded.connect(function () { _this.__unpackHDRImage(_this.__hdrImage.getParams()); });
        return _this;
    }
    $a.prototype.__unpackHDRImage = function (e) { var t = this.__gl, a = e.data.ldr, i = e.data.cdm; if (this.__fbo)
        this.__srcLDRTex.bufferData(a), this.__srcCDMTex.bufferData(i);
    else {
        this.configure({ format: "RGBA", type: "FLOAT", width: a.width, height: a.height, filter: "LINEAR", wrap: "CLAMP_TO_EDGE" }), this.__fbo = new qa(t, this), this.__fbo.setClearColor([0, 0, 0, 0]), this.__srcLDRTex = new Ua(t, { format: "RGB", type: "UNSIGNED_BYTE", width: a.width, height: a.height, filter: "NEAREST", mipMapped: !1, wrap: "CLAMP_TO_EDGE", data: a }), this.__srcCDMTex = new Ua(t, { format: "webgl2" == t.name ? "RED" : "ALPHA", type: "UNSIGNED_BYTE", width: a.width, height: a.height, filter: "NEAREST", mipMapped: !1, wrap: "CLAMP_TO_EDGE", data: i }), this.__unpackHDRShader = new ja(t);
        var e_169 = this.__unpackHDRShader.compileForTarget("GLHDRImage");
        this.__shaderBinding = Ea(t, e_169.attrs, t.__quadattrbuffers, t.__quadIndexBuffer);
    } this.__fbo.bindAndClear(); var s = {}; this.__unpackHDRShader.bind(s, "GLHDRImage"), this.__shaderBinding.bind(s); var n = s.unifs; this.__srcLDRTex.bindToUniform(s, n.ldrSampler), this.__srcCDMTex.bindToUniform(s, n.cdmSampler), t.uniform1f(n.exposure.location, 1), t.uniform4fv(n.tint.location, this.__hdrImage.getHDRTint().asArray()), t.drawQuad(), this.__fbo.unbind(), this.updated.emit(); };
    $a.prototype.bindToUniform = function (e, t, a) { return _super.prototype.bindToUniform.call(this, e, t, a); };
    $a.prototype.destroy = function () { _super.prototype.destroy.call(this), this.__fbo && (this.__fbo.destroy(), this.__srcLDRTex.destroy(), this.__srcCDMTex.destroy()), this.__unpackHDRShader && this.__unpackHDRShader.destroy(), this.__shaderBinding && this.__shaderBinding.destroy(), this.__hdrImage.loaded.disconnectScope(this), this.__hdrImage.updated.disconnectScope(this); };
    return $a;
}(Ua));
Qa.setShaderModule("GLSLUtils.glsl", "\n\n\nint ftoi(float val){\n    return int(floor(val + 0.5));\n}\n\n#ifdef ENABLE_ES3\n\nint imod(int x, int y) {\n    return x % y;\n}\n\nvoid setFlag(inout int flags, int flag) {\n    flags |= flag;\n}\n\nvoid clearFlag(inout int flags, int flag) {\n    flags &= ~flag;\n}\n\nbool testFlag(int flags, int flag) {\n    return (flags & flag) != 0;\n}\n\n// private function: Mangle me...\nivec2 _pixelIndexToUV(int index, int textureWidth){\n    return ivec2(index % textureWidth, index / textureWidth);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureWidth, int index) {\n    return texelFetch(texture, _pixelIndexToUV(index, textureWidth), 0);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n    return texelFetch(texture, texCoord, 0);\n}\n\n#else\n\n// TODO: integrate: https://gist.github.com/mattatz/70b96f8c57d4ba1ad2cd\n\nint max(int a, int b) {\n    return a > b ? a : b;\n}\nint min(int a, int b) {\n    return a < b ? a : b;\n}\n\n\nfloat round(float val){\n    return floor(val + 0.4);\n}\n\nint imod(int x, int y) {\n    return x-y*(x/y);\n}\n\nvoid setFlag(inout int flags, int flag) {\n    flags += flag;\n}\nvoid clearFlag(inout int flags, int flag) {\n    flags -= flag;\n}\n\nbool testFlag(int flags, int flag) {\n    return imod(flags / flag, 2) != 0;\n}\n\n// private function: Mangle me...\nvec2 _pixelIndexToUV(int index, int textureSize){\n    float flTexSize = float(textureSize);\n    float x = (float(imod(index, textureSize))+0.5)/flTexSize;\n    float y = (floor(float(index / textureSize))+0.5)/flTexSize;\n    return vec2(x, y);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureSize, int index) {\n    vec2 texCoord = _pixelIndexToUV(index, textureSize);\n    return texture2D(texture, texCoord);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n    vec2 ftextureSize = vec2(textureSize);\n    return texture2D(texture, (vec2(texCoord) + 0.5) / ftextureSize);\n}\n\n\n#endif\n\nint uvToPixelIndex(vec2 uv, int textureSize){\n    return int(uv.x * float(textureSize)) + (int(floor(uv.y * float(textureSize))) * textureSize);\n}\n\n\n\n"), Qa.setShaderModule("utils/ImageStream.glsl", "\n\n// Stream Desc looks like the following\n// x : atlas Width in images\n// y : atlas height in images\n// z : image Width\n// w : image Height\n\nvec2 calcFrameImageTexCoords(vec2 texCoord, int index, in vec4 streamDesc){\n\tfloat index_x = floor(mod(float(index), streamDesc.x));\n\tfloat index_y = floor(float(index) / streamDesc.x);\n    return vec2( \n    \t(index_x + texCoord.x) / streamDesc.x, \n    \t(index_y + texCoord.y) / streamDesc.y\n    \t);\n}\n\nvec4 sampleStreamFrame(vec2 texCoord, int index, in sampler2D streamImage, in vec4 streamDesc){\n    return texture2D(streamImage, calcFrameImageTexCoords(texCoord, index, streamDesc));\n}\n\n");
var ei = /** @class */ (function () {
    function ei(e, t) {
        var _this = this;
        this.__gl = e, this.__streamImage = t, this.ready = new C(!0), this.updated = new C, this.resized = new C, this.__descParam = this.__streamImage.getParameter("StreamAtlasDesc"), this.__indexParam = this.__streamImage.getParameter("StreamAtlasIndex"), this.__indexParam.valueChanged.connect(this.updated.emit);
        var a = function () { var t = _this.__streamImage.getParams(); t.data.__atlasTexture || (t.data.__atlasTexture = new Ua(e, t)), _this.__atlasTexture = t.data.__atlasTexture, _this.__atlasTexture.textureType = 2, _this.__atlasTexture.textureDesc = _this.__descParam.getValue().asArray(); };
        this.__streamImage.isLoaded() ? a() : this.__streamImage.loaded.connect(function () { a(); });
    }
    ei.prototype.preBind = function (e, t) { var a = this.__atlasTexture.preBind(e, t); return a.textureDescUnif = t[e.name + "Desc"], a.textureIndexUnif = t[e.name + "Index"], a; };
    ei.prototype.bindToUniform = function (e, t, a) { return !!this.__atlasTexture.bindToUniform(e, t, a) && (a && a.textureIndexUnif && this.__gl.uniform1i(a.textureIndexUnif.location, this.__indexParam.getValue()), !0); };
    return ei;
}());
var ti = /** @class */ (function () {
    function ti(e, t, a, i) {
        var _this = this;
        switch (this.__unif = i, i.type) {
            case Boolean:
                this.uniformXX = e.uniform1i.bind(e);
                break;
            case 4:
                "webgl2" == e.name ? this.uniformXX = e.uniform1ui.bind(e) : this.uniformXX = e.uniform1i.bind(e);
                break;
            case 5:
                this.uniformXX = e.uniform1i.bind(e);
                break;
            case 6: this.uniformXX = e.uniform1f.bind(e);
        }
        this.__val = a.getValue(), a.valueChanged.connect(function () { _this.__val = a.getValue(), t.updated.emit(); });
    }
    ti.prototype.bind = function (e) { this.uniformXX(this.__unif.location, this.__val); };
    ti.prototype.unbind = function () { };
    ti.prototype.destroy = function () { };
    return ti;
}());
var ai = /** @class */ (function () {
    function ai(e, t, a, i) {
        var _this = this;
        switch (this.__unif = i, i.type) {
            case _:
                this.uniformXX = e.uniform2fv.bind(e);
                break;
            case Z:
                this.uniformXX = e.uniform3fv.bind(e);
                break;
            case G: this.uniformXX = e.uniform4fv.bind(e);
        }
        this.__vals = a.getValue().asArray(), a.valueChanged.connect(function () { _this.__vals = a.getValue().asArray(), t.updated.emit(); });
    }
    ai.prototype.bind = function (e) { this.uniformXX(this.__unif.location, this.__vals); };
    ai.prototype.unbind = function () { };
    ai.prototype.destroy = function () { };
    return ai;
}());
var ii = /** @class */ (function () {
    function ii(e, t, a, i) {
        var _this = this;
        switch (this.__unif = i, i.type) {
            case Mat3:
                this.uniformMatrixXXX = e.uniformMatrix3fv.bind(e);
                break;
            case I: this.uniformMatrixXXX = e.uniformMatrix4fv.bind(e);
        }
        this.__vals = a.getValue().asArray(), a.valueChanged.connect(function () { _this.__val = a.getValue().asArray(), t.updated.emit(); });
    }
    ii.prototype.bind = function (e) { this.uniformMatrixXXX(this.__unif.location, !1, this.__val); };
    ii.prototype.unbind = function () { };
    ii.prototype.destroy = function () { };
    return ii;
}());
var si = /** @class */ (function () {
    function si(e, t, a, i, s) {
        var _this = this;
        this.__gl = e, this.__unif = i, this.__textureUnif = s[i.name + "Tex"], this.__textureTypeUnif = s[i.name + "TexType"], this.__vals = [0, 0, 0, 0], this.bind = this.bindValue;
        var n = function (e) { var a = e.getMetadata("gltexture"); a || (a = "FLOAT" === e.type ? new $a(_this.__gl, e) : e.isStreamAtlas() ? new ei(_this.__gl, e) : new Ua(_this.__gl, e)), _this.texBinding = a.preBind(_this.__textureUnif, s), a.updated.connect(function () { t.updated.emit(); }), _this.gltexture = a, _this.gltexture.addRef(_this), _this.textureType = 1, _this.bind = _this.bindTexture, t.updated.emit(); };
        var l, r;
        var o = function () { n(l); }, d = function (e) { e.isLoaded() ? n(e) : e.loaded.connect(o), l = e; }, h = function () { l.getMetadata("gltexture").removeRef(_this), _this.texBinding = null, _this.gltexture = null, _this.textureType = null, _this.bind = _this.bindValue, r && l.loaded.disconnectId(r), l = null, r = null, t.updated.emit(); }, c = function () { var e = a.getValue(!1); if (_this.__vals = e.asArray(), _this.__textureUnif) {
            var e_170;
            a.getImage && (e_170 = a.getImage()), e_170 && e_170 != l ? d(e_170) : !e_170 && l && h();
        } t.updated.emit(); };
        c(), a.textureConnected && a.textureConnected.connect(function () { d(a.getImage()); }), a.valueChanged.connect(c), this.uniform1i = e.uniform1i.bind(e), this.uniform4fv = e.uniform4fv.bind(e);
    }
    si.prototype.bindValue = function (e) { this.uniform4fv(this.__unif.location, this.__vals), this.__textureTypeUnif && this.uniform1i(this.__textureTypeUnif.location, 0); };
    si.prototype.bindTexture = function (e) { this.gltexture.bindToUniform(e, this.__textureUnif, this.texBinding); };
    return si;
}());
var ni = {};
var li = /** @class */ (function () {
    function li(e, t, a, i) {
        var _this = this;
        this.__uniformBindings = [];
        var s = function (s) { var n = s.getName(), l = a[n]; if (null != l)
            switch (l.type) {
                case Boolean:
                case 4:
                case 5:
                case 6:
                    _this.__uniformBindings.push(new ti(e, t, s, l));
                    break;
                case _:
                case Z:
                case G:
                    _this.__uniformBindings.push(new ai(e, t, s, l));
                    break;
                case y:
                    _this.__uniformBindings.push(new si(e, t, s, l, a));
                    break;
                case I:
                    _this.__uniformBindings.push(new ii(e, t, s, l));
                    break;
                default: return void console.warn("Param :" + n + " has unhandled data type:" + l.type);
            }
        else if (i) {
            var e_171 = t.getMaterial().getShaderName();
            ni[e_171] || (ni[e_171] = {}), ni[e_171][n] || (console.warn("Material:" + t.getMaterial().getName(), "with Shader ", e_171, "Param has no unif", n), ni[e_171][n] = !0);
        } }, n = t.getMaterial().getParameters();
        for (var _b = 0, n_33 = n; _b < n_33.length; _b++) {
            var e_172 = n_33[_b];
            s(e_172);
        }
    }
    li.prototype.bind = function (e) { for (var _b = 0, _c = this.__uniformBindings; _b < _c.length; _b++) {
        var t_181 = _c[_b];
        t_181.bind(e);
    } return !0; };
    li.prototype.unbind = function () { for (var _b = 0, _c = this.__uniformBindings; _b < _c.length; _b++) {
        var e_173 = _c[_b];
        e_173.unbind(renderstate);
    } };
    li.prototype.destroy = function () { for (var _b = 0, _c = this.__uniformBindings; _b < _c.length; _b++) {
        var e_174 = _c[_b];
        e_174.destroy(renderstate);
    } };
    return li;
}());
var ri = /** @class */ (function () {
    function ri(e, t, a) {
        this.__gl = e, this.__material = t, this.__glshader = a, this.updated = new C, this.__shaderBindings = {};
    }
    ri.prototype.getMaterial = function () { return this.__material; };
    ri.prototype.getGLShader = function () { return this.__glshader; };
    ri.prototype.generateShaderBinding = function () { var e = this.__material.getParameters(); for (var _b = 0, e_175 = e; _b < e_175.length; _b++) {
        var t_182 = e_175[_b];
        bindParam(gl, t_182);
    } };
    ri.prototype.bind = function (e, t) { this.__boundTexturesBeforeMaterial = e.boundTextures; var a = this.__shaderBindings[e.shaderkey]; if (!a) {
        var i_123 = this.__gl;
        a = new li(i_123, this, e.unifs, t), this.__shaderBindings[e.shaderkey] = a;
    } return a.bind(e); };
    ri.prototype.unbind = function (e) { e.boundTextures = this.__boundTexturesBeforeMaterial; };
    return ri;
}());
var oi = /** @class */ (function () {
    function oi(e, t) {
        this.resized = new C, this.updated = new C, this.__gl = e, this.textureTargets = [], this.depthTexture = null, t && this.configure(t);
    }
    oi.prototype.configure = function (e) { var t = this.__gl, a = function (e, t) { if (!t.width || !t.height)
        throw new Error("Invalid texture params"); var a = e.getParameter(e.MAX_TEXTURE_SIZE); if (t.width <= 0 || t.width > a || t.height <= 0 || t.height > a)
        throw new Error("GLTextureParams: Invalid texture size. width:" + t.width + " height:" + t.height + " maxSize:" + a); var i = { width: t.width, height: t.height }, s = function (a, s) { a in t ? i[a] = isNaN(t[a]) ? e[t[a]] : t[a] : s && (i[a] = s); }; if (s("format"), s("internalFormat", i.format), s("type", e.UNSIGNED_BYTE), s("minFilter", e.LINEAR), s("magFilter", e.LINEAR), s("wrapS", e.CLAMP_TO_EDGE), s("wrapT", e.CLAMP_TO_EDGE), s("flipY", !1), s("mipMapped", !1), s("depthFormat"), s("depthType"), i.format == e.FLOAT)
        if ("webgl2" == e.name)
            i.filter != e.LINEAR || e.__ext_float_linear || (console.warn("Floating point texture filtering not supported on result device"), i.filter = e.NEAREST);
        else if (e.__ext_float)
            i.filter != e.LINEAR || e.__ext_float_linear || (console.warn("Floating point texture filtering not supported on result device"), i.filter = e.NEAREST);
        else {
            if (!e.__ext_half_float)
                throw new Error("OES_texture_half_float is not available");
            i.format = e.HALF_FLOAT, i.filter != e.LINEAR || e.__ext_texture_half_float_linear || (console.warn("Half Float texture filtering not supported on result device"), i.filter = e.NEAREST);
        }
    else if (i.format == e.HALF_FLOAT)
        if ("webgl2" == e.name)
            ;
        else {
            if (!e.__ext_half_float)
                throw new Error("OES_texture_half_float is not available");
            if (i.filter != e.LINEAR || e.__ext_texture_half_float_linear || (console.warn("Half Float texture filtering not supported on result device"), i.filter = e.NEAREST), i.channels == e.RGB)
                throw new Error("OES_texture_half_float onlysupports RGBA textures");
        }
    else if ("sRGB" == i.format && !e.__ext_sRGB)
        throw new Error("EXT_sRGB is not available"); return null != i.format && "webgl2" == e.name && i.internalFormat == i.format && (i.type == e.FLOAT ? i.format == e.RED || i.format == e.RED ? i.internalFormat = e.R32F : i.format == e.RG ? i.internalFormat = e.RG32F : i.format == e.RGBA && (i.internalFormat = e.RGBA32F) : i.type == e.HALF_FLOAT ? i.format == e.RED ? i.internalFormat = e.R16F : i.format == e.RGB ? i.internalFormat = e.RGB16F : i.format == e.RGBA && (i.internalFormat = e.RGBA16F) : i.type == e.UNSIGNED_BYTE && (i.format == e.RED && (i.internalFormat = e.R8), i.format == e.RGB ? i.internalFormat = e.RGB8 : i.format == e.RGBA && (i.internalFormat = e.RGBA8))), null != i.depthFormat && ("webgl2" == e.name ? i.depthType == e.UNSIGNED_SHORT ? i.depthInternalFormat = e.DEPTH_COMPONENT16 : i.depthType == e.UNSIGNED_INT && (i.depthInternalFormat = e.UNSIGNED_INT) : i.depthInternalFormat = i.depthFormat), i; }(t, e); this.textureTargets.forEach(function (e) { t.deleteTexture(e); }), this.textureTargets = [], this.depthTexture && (t.deleteTexture(this.depthTexture), this.depthTexture = null), this.frameBuffer && t.deleteFramebuffer(this.frameBuffer), this.type = a.type, this.format = a.format, this.internalFormat = a.internalFormat, this.filter = a.filter, this.wrap = a.wrap, this.flipY = a.flipY, this.width = a.width, this.height = a.height, this.clearColor = new y(0, 0, 0, 0), this.colorMask = [!0, !0, !0, !0], this.textureType = 1, this.textureDesc = [this.width, this.height, 0, 0]; var i = null != e.numColorChannels ? e.numColorChannels : null != a.format ? 1 : 0; for (var e_176 = 0; e_176 < i; e_176++) {
        t.activeTexture(t.TEXTURE0 + 1);
        var e_177 = t.createTexture();
        t.bindTexture(t.TEXTURE_2D, e_177), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, a.wrapS), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, a.wrapT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, a.minFilter), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, a.magFilter), t.texImage2D(t.TEXTURE_2D, 0, this.internalFormat, a.width, a.height, 0, this.format, this.type, null), this.textureTargets.push(e_177);
    } if (a.depthFormat) {
        if ("webgl" == t.name && !t.__ext_WEBGL_depth_texture)
            throw new Error("Depth textures not support on this device");
        t.activeTexture(t.TEXTURE0), this.depthTexture = t.createTexture(), t.bindTexture(t.TEXTURE_2D, this.depthTexture), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, a.wrapS), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, a.wrapT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, a.minFilter), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, a.magFilter), t.texImage2D(t.TEXTURE_2D, 0, a.depthInternalFormat, a.width, a.height, 0, a.depthFormat, a.depthType, null);
    } if (this.frameBuffer = t.createFramebuffer(), "webgl2" == t.name ? t.bindFramebuffer(t.DRAW_FRAMEBUFFER, this.frameBuffer) : t.bindFramebuffer(t.FRAMEBUFFER, this.frameBuffer), this.textureTargets.length > 0) {
        if (this.textureTargets.length > 1 && "webgl" == t.name && !t.drawBuffers) {
            t.__ext_draw_buffers = t.getExtension("WEBGL_draw_buffers"), t.drawBuffers = t.__ext_draw_buffers.drawBuffersWEBGL.bind(t.__ext_draw_buffers);
            for (var e_178 = 1; e_178 < 14; e_178++)
                t["COLOR_ATTACHMENT" + e_178] = t.__ext_draw_buffers["COLOR_ATTACHMENT" + e_178 + "_WEBGL"];
            t.MAX_COLOR_ATTACHMENTS = t.__ext_draw_buffers.MAX_COLOR_ATTACHMENTS_WEBGL, t.MAX_DRAW_BUFFERS = t.__ext_draw_buffers.MAX_DRAW_BUFFERS_WEBGL;
        }
        var e_179 = [];
        for (var a_169 = 0; a_169 < this.textureTargets.length; a_169++)
            t.framebufferTexture2D(t.DRAW_FRAMEBUFFER, t.COLOR_ATTACHMENT0 + a_169, t.TEXTURE_2D, this.textureTargets[a_169], 0), e_179.push(t.COLOR_ATTACHMENT0 + a_169);
        this.textureTargets.length > 1 && t.drawBuffers(e_179);
    } this.depthTexture && t.framebufferTexture2D(t.DRAW_FRAMEBUFFER, t.DEPTH_ATTACHMENT, t.TEXTURE_2D, this.depthTexture, 0); var s = t.checkFramebufferStatus(t.DRAW_FRAMEBUFFER); if (s != t.FRAMEBUFFER_COMPLETE)
        switch (s) {
            case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT: throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");
            case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT: throw new Error("There is no attachment.");
            case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS: throw new Error("Height and width of the attachment are not the same.");
            case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS: throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");
            case 36061: throw new Error("The framebuffer is unsupported");
            default: throw new Error("Incomplete Frambuffer");
        } this.unbind(); };
    oi.prototype.bindForWriting = function (e, t) {
        if (t === void 0) { t = !1; }
        e && (this.__prevBoundFbo = e.boundRendertarget, e.boundRendertarget = this.frameBuffer);
        var a = this.__gl;
        "webgl2" == a.name ? a.bindFramebuffer(a.DRAW_FRAMEBUFFER, this.frameBuffer) : a.bindFramebuffer(a.FRAMEBUFFER, this.frameBuffer), a.viewport(0, 0, this.width, this.height), t && this.clear();
    };
    oi.prototype.unbindForWriting = function (e) { e && (e.boundRendertarget = this.__prevBoundFbo); var t = this.__gl; "webgl2" == t.name ? t.bindFramebuffer(t.DRAW_FRAMEBUFFER, this.__prevBoundFbo) : t.bindFramebuffer(t.FRAMEBUFFER, this.__prevBoundFbo); };
    oi.prototype.clear = function (e) {
        if (e === void 0) { e = !0; }
        var t = this.__gl;
        t.colorMask.apply(t, this.colorMask), t.clearColor.apply(t, this.clearColor.asArray());
        var a = 0;
        this.textureTargets.length > 0 && (a |= t.COLOR_BUFFER_BIT), this.depthTexture && (a |= t.DEPTH_BUFFER_BIT), t.clear(a);
    };
    oi.prototype.bindForReading = function () { var e = this.__gl; "webgl2" == e.name ? e.bindFramebuffer(e.READ_FRAMEBUFFER, this.frameBuffer) : e.bindFramebuffer(e.FRAMEBUFFER, this.frameBuffer); };
    oi.prototype.unbindForReading = function () { var e = this.__gl; "webgl2" == e.name ? e.bindFramebuffer(e.READ_FRAMEBUFFER, null) : e.bindFramebuffer(e.FRAMEBUFFER, null); };
    oi.prototype.bindColorTexture = function (e, t, a) {
        if (a === void 0) { a = 0; }
        var i = this.__gl, s = e.boundTextures++;
        return i.uniform1i(t.location, s), i.activeTexture(i.TEXTURE0 + s), i.bindTexture(i.TEXTURE_2D, this.textureTargets[a]), !0;
    };
    oi.prototype.bindDepthTexture = function (e, t) { var a = this.__gl, i = e.boundTextures++; return a.uniform1i(t.location, i), a.activeTexture(a.TEXTURE0 + i), a.bindTexture(a.TEXTURE_2D, this.depthTexture), !0; };
    oi.prototype.unbind = function () { var e = this.__gl; e.bindFramebuffer(e.DRAW_FRAMEBUFFER, null); };
    oi.prototype.resize = function (e, t, a) {
        if (a === void 0) { a = !1; }
    };
    oi.prototype.bindToUniform = function (e, t, a) { var i = e.boundTextures++, s = this.__gl.TEXTURE0 + i, n = this.__gl; return n.activeTexture(s), n.bindTexture(n.TEXTURE_2D, this.textureTargets[0]), n.uniform1i(t.location, i), a && (a.textureTypeUnif && n.uniform1i(a.textureTypeUnif.location, this.textureType), a.textureDescUnif && this.__gl.uniform4fv(a.textureDescUnif.location, this.textureDesc)), !0; };
    oi.prototype.destroy = function () { var e = this.__gl; this.textureTargets.forEach(function (t) { e.deleteTexture(t); }), this.textureTargets = [], this.depthTexture && (e.deleteTexture(this.depthTexture), this.depthTexture = null), this.frameBuffer && e.deleteFramebuffer(this.frameBuffer); };
    return oi;
}());
var di = new Uint32Array(1);
function hi(e) { return di[0] = e, di[0] = (di[0] << 16 | di[0] >> 16) >>> 0, di[0] = (1431655765 & di[0]) << 1 | (2863311530 & di[0]) >>> 1 >>> 0, di[0] = (858993459 & di[0]) << 2 | (3435973836 & di[0]) >>> 2 >>> 0, di[0] = (252645135 & di[0]) << 4 | (4042322160 & di[0]) >>> 4 >>> 0, di[0] = (16711935 & di[0]) << 8 | (4278255360 & di[0]) >>> 8 >>> 0, 2.3283064365386963e-10 * di[0]; }
function ci(e, t) { return [e / t, hi(e)]; }
Qa.setShaderModule("utils/imageAtlas.glsl", "\n\n// Note: On mobile, I can't seem to pass around a stuct containing sampler2D.\n// I have to unpack the struct and pass its members. :(\n// struct ImageAtlas {\n//     sampler2D layout;\n//     sampler2D image;\n//     vec4 desc;\n// };\n\n\n\nvec4 getSubImageLayout(int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    return fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n}\n\nvec2 calcSubImageTexCoords(vec2 texCoord, int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    // The following line is a hack to fix artifacts in our PBR lighting\n    // We were seeing loads of lighting garbage on some sufaces that were orthogonal\n    // to the world. The UV coordinates would have been landing right on the edges\n    // of our subimages and were often sampling outside the image. This couuld\n    // have been because of filtering, or an error in the uv coords. \n    texCoord = clamp(texCoord, vec2(0.01, 0.01), vec2(0.99, 0.99));\n    vec2 subimageTexel = texCoord * layoutData.zw;\n    // subimageTexel = clamp(subimageTexel, vec2(0.0, 0.0), vec2(1.0, 1.0));\n    return subimageTexel + layoutData.xy;\n}\n\nvec4 sampleSubImage(vec2 texCoord, int index, in sampler2D atlasLayout, in sampler2D atlasImage, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    vec2 atlasCoords = calcSubImageTexCoords(texCoord, index, atlasLayout, atlasDesc);\n    return texture2D(atlasImage, atlasCoords);\n}\n\n");
var mi = /** @class */ (function (_super) {
    __extends(mi, _super);
    function mi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("AtlasLayoutShader.vertexShader", '\n\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform vec2 pos;\nuniform vec2 size;\nuniform vec2 srctextureDim;\nconst int border = 2;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * size * 2.0), 0.0, 1.0);\n\n  vec2 borderVec2 = vec2(float(border), float(border));\n  v_texCoord *= (srctextureDim + (borderVec2 * 2.0)) / srctextureDim;\n  v_texCoord -= borderVec2 / srctextureDim;\n}\n\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("AtlasLayoutShader.fragmentShader", "\nprecision highp float;\n\nuniform sampler2D srctexture;\nuniform vec2 srctextureDim;\nuniform bool alphaFromLuminance;\nuniform bool invert;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\nfloat luminanceFromRGB(vec3 rgb) {\n  return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n  vec2 pixelCoord = v_texCoord*srctextureDim;\n  vec2 uv = v_texCoord;\n\n  // Wrap X coords\n  if(pixelCoord.x < 0.0){\n    uv.x += 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n  else if(pixelCoord.x > srctextureDim.x){\n    uv.x -= 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n\n  // Wrap Y coords\n  if(pixelCoord.y < 0.0){\n    uv.y += 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n  else if(pixelCoord.y > srctextureDim.y){\n    uv.y -= 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n\n  vec4 texel = texture2D(srctexture, uv);\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  // TODO: check why we pre-multiply alphas here.\n  // fragColor = vec4(texel.rgb/texel.a, texel.a);\n\n  if(alphaFromLuminance) {\n    fragColor = vec4(texel.rgb, luminanceFromRGB(texel.rgb));\n  }\n  else {\n    fragColor = texel;\n  }\n  \n  if(invert) {\n    fragColor = vec4(1.0) - fragColor;\n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n");
        return _this;
    }
    return mi;
}(Aa));
var ui = /** @class */ (function (_super) {
    __extends(ui, _super);
    function ui(e, t, a, i) {
        if (a === void 0) { a = "RGBA"; }
        if (i === void 0) { i = "FLOAT"; }
        var _this = this;
        _this = _super.call(this, e) || this, _this.__name = t, _this.__formatParam = a, _this.__typeParam = i, _this.clearColor = new y(0, 0, 0, 0), _this.__subImages = [], _this.__layoutNeedsRegeneration = !1, _this.__async = new N, _this.loaded = _this.__async.ready;
        return _this;
    }
    ui.prototype.isLoaded = function () { return 0 == this.__async.count; };
    ui.prototype.getMainImage = function () { return this.super; };
    ui.prototype.addSubImage = function (e) {
        var _this = this;
        if (e instanceof Ue) {
            var t_183 = new Ua(this.__gl, e);
            e.isLoaded() || (this.__async.incAsyncCount(), e.loaded.connect(function () { _this.__async.decAsyncCount(); })), e.setMetadata("ImageAtlas_gltex", t_183), t_183.addRef(this), e.updated.connect(function () { _this.__layoutNeedsRegeneration = !0, _this.renderAtlas(); }), this.__subImages.push(t_183);
        }
        else
            e.addRef(this), this.__subImages.push(e);
        return this.__layoutNeedsRegeneration = !0, this.__subImages.length - 1;
    };
    ui.prototype.removeSubImage = function (e) { var t; if (e instanceof Ue) {
        var a_170 = e.getMetadata("ImageAtlas_gltex");
        t = this.__subImages.indexOf(a_170), e.deleteMetadata("ImageAtlas_gltex");
    }
    else
        t = this.__subImages.indexOf(e); this.__subImages[t].removeRef(this), this.__subImages.splice(t, 1), this.__layoutNeedsRegeneration = !0; };
    ui.prototype.getSubImage = function (e) { return this.__subImages[e]; };
    ui.prototype.numSubImages = function () { return this.__layout ? this.__layout.length : this.__subImages.length; };
    ui.prototype.generateAtlasLayout = function () {
        var _this = this;
        if (0 == this.__subImages.length)
            return void (this.__layoutNeedsRegeneration = !1);
        var e = [];
        this.__subImages.forEach(function (t, a) { e.push({ w: t.width + 4, h: t.height + 4, area: t.width * t.height, index: a }); }), e.sort(function (e, t) { return e.area > t.area ? -1 : e.area < t.area ? 1 : 0; });
        var t = new Y;
        t.fit(e), this.__layout = [], e.forEach(function (e, t) { e.fit ? _this.__layout[e.index] = { pos: new _(e.fit.x + 2, e.fit.y + 2), size: new _(e.w, e.h) } : console.warn("Unable to fit image"); });
        var a = t.root.w, i = t.root.h;
        this.configure({ width: a, height: i, format: "FLOAT" == this.__typeParam && "RGB" == this.__formatParam ? "RGBA" : this.__formatParam, type: this.__typeParam, filter: "LINEAR" });
        var s = this.__gl;
        if (s.__quadVertexIdsBuffer || s.setupInstancedQuad(), !s.__atlasLayoutShader) {
            s.__atlasLayoutShader = new mi(s);
            var e_180 = s.__atlasLayoutShader.compileForTarget("GLImageAtlas");
            s.__atlasLayoutShaderBinding = Ea(s, e_180.attrs, s.__quadattrbuffers, s.__quadIndexBuffer);
        }
        var n = Math.round(Math.sqrt(1 * this.__layout.length) + .5);
        if (n = Math.nextPow2(n), n % 1 != 0 && (n += 1 - n % 1), s.floatTexturesSupported) {
            var e_181 = new Float32Array(n * n * 4);
            for (var t_184 = 0; t_184 < this.__layout.length; t_184++) {
                var s_36 = this.__layout[t_184];
                G.createFromFloat32Buffer(e_181.buffer, 4 * t_184).set(s_36.pos.x / a, s_36.pos.y / i, s_36.size.x / a, s_36.size.y / i);
            }
            this.__atlasLayoutTexture && this.__atlasLayoutTexture.width == n && this.__atlasLayoutTexture.height == n ? this.__atlasLayoutTexture.bufferData(e_181, n, n) : (this.__atlasLayoutTexture && this.__atlasLayoutTexture.destroy(), this.__atlasLayoutTexture = new Ua(s, { format: "RGBA", type: "FLOAT", filter: "NEAREST", wrap: "CLAMP_TO_EDGE", mipMapped: !1, width: n, height: n, data: e_181 }));
        }
        else
            this.__layoutVec4s = [], this.__layout.forEach(function (e, t) { _this.__layoutVec4s[t] = [e.pos.x / a, e.pos.y / i, e.size.x / a, e.size.y / i]; });
        this.__layoutNeedsRegeneration = !1;
    };
    ui.prototype.getLayoutData = function (e) { return this.__layoutVec4s[e]; };
    ui.prototype.renderAtlas = function (e, t) {
        if (e === void 0) { e = !1; }
        if (t === void 0) { t = 0; }
        if (0 == this.__subImages.length)
            return;
        this.__layoutNeedsRegeneration && this.generateAtlasLayout();
        var a = this.__gl, i = {};
        this.bindForWriting(i, !0), a.__atlasLayoutShader.bind(i, "GLImageAtlas"), a.__atlasLayoutShaderBinding.bind(i);
        var s = new _(1 / this.width, 1 / this.height), n = i.unifs;
        for (var e_182 = t; e_182 < this.__subImages.length; e_182++) {
            var t_185 = this.__subImages[e_182], l = this.__layout[e_182];
            t_185.bindToUniform(i, n.srctexture), a.uniform2fv(n.pos.location, l.pos.multiply(s).asArray()), a.uniform2fv(n.size.location, l.size.multiply(s).asArray()), a.uniform2f(n.srctextureDim.location, t_185.width, t_185.height), a.uniform1i(n.alphaFromLuminance.location, t_185.alphaFromLuminance), a.uniform1i(n.invert.location, t_185.invert), a.drawQuad(), i.boundTextures--;
        }
        e && this.cleanup(), this.unbind(i), this.updated.emit();
    };
    ui.prototype.isReady = function () { return null != this.__atlasLayoutTexture; };
    ui.prototype.bindToUniform = function (e, t) { if (!this.__atlasLayoutTexture)
        return !1; _super.prototype.bindToUniform.call(this, e, t); var a = e.unifs, i = a[t.name + "_layout"]; i && this.__atlasLayoutTexture.bindToUniform(e, i); var s = a[t.name + "_desc"]; return s && this.__gl.uniform4f(s.location, this.width, this.height, this.__atlasLayoutTexture.width, 0), !0; };
    ui.prototype.cleanup = function () { for (var _b = 0, _c = this.__subImages; _b < _c.length; _b++) {
        var e_183 = _c[_b];
        e_183.removeRef(this);
    } this.__subImages = [], this.destroy(); };
    ui.prototype.destroy = function () { this.cleanup(), _super.prototype.destroy.call(this); };
    return ui;
}(oi));
var bi = /** @class */ (function (_super) {
    __extends(bi, _super);
    function bi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("ConvolverShader.vertexShader", '\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("ConvolverShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n\nuniform float roughness;\nvarying vec2 v_texCoord;\n\nuniform sampler2D hammersleyMap;\nvec2 Hammersley(int i, int N) {\n  vec4 rgba =  texture2D(hammersleyMap, vec2((float(i) + 0.5)/float(N)), 0.5);\n  return rgba.rg;\n}\n\nmat3 matrixFromVector(vec3 n) { // frisvad\n  float a = 1.0 / (1.0 + n.z);\n  float b = -n.x * n.y * a;\n  vec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n  vec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n  return mat3(b1, b2, n);\n}\n\nvec3 ImportanceSampleGGX(vec2 Xi, float a) {\n  float phi = 2.0 * PI * Xi.x;\n  float cos_theta = sqrt((1.0 - Xi.y)/(1.0 + (a*a - 1.0) * Xi.y));\n  float sin_theta = sqrt(1.0 - cos_theta * cos_theta);\n\n  // float phi = Xi.y * 2.0 * PI;\n  // float cos_theta = sqrt(1.0 - Xi.x);\n  // float sin_theta = sqrt(1.0 - cos_theta * cos_theta);\n\n  vec3 H;\n  H.x = sin_theta * cos(phi);\n  H.y = sin_theta * sin(phi);\n  H.z = cos_theta;\n  return H;\n}\n\n// TODO: use tobias\'s code. The guy clearly knows what he\'s doing...\n// https://github.com/thefranke/dirtchamber/blob/master/shader/importance.hlsl\n// Compute a LOD level for filtered importance sampling.\n// From GPU Gems 3: GPU-Based Importance Sampling.\n\n\n#define M_PI       3.14159265358979323846   // pi\n#define M_HALF_PI  1.57079632679489661923   // pi/2\nfloat sqr(float val){ return val*val; }\nfloat saturate(float val) { return clamp(val, 0.0, 1.0); }\nvec3 saturate(vec3 val) { return clamp(val, 0.0, 1.0); }\n\n// Microfacet Models for Refraction through Rough Surfaces\n// Walter et al.\n// http://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.html\n// aka Towbridge-Reitz\nfloat D_ggx(in float alpha, in float NoH)\n{\n  float a2 = alpha*alpha;\n  float cos2 = NoH*NoH;\n\n  return (1.0/M_PI) * sqr(alpha/(cos2 * (a2 - 1.0) + 1.0));\n\n  /*\n  // version from the paper, eq 33\n  float CosSquared = NoH*NoH;\n  float TanSquared = (1.0 - CosSquared)/CosSquared;\n  return (1.0/M_PI) * sqr(alpha/(CosSquared * (alpha*alpha + TanSquared)));\n  */\n}\nfloat compute_lod(in vec3 H, in float pdf, in int num_samples, in int ww, in int hh)\n{\n  return max(0.0, 0.5*log2(float(ww*hh)/float(num_samples)) - 0.5*log2(pdf));\n}\n\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec3 N = sphOctUvToDir(v_texCoord);\n\n  if(false){\n    vec2 uv = dirToSphOctUv(N);\n    // fragColor = vec4(uv.x, uv.y, 0.0, 1.0);\n    fragColor = sampleImagePyramid(uv, 0.5, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc);\n    // fragColor = sampleSubImage(uv, 0, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc);\n    // fragColor = texture2D(envMapPyramid, uv);\n  }\n  else{\n    const int numSamples = NUM_SAMPLES;\n    int w = int(floor(envMapPyramid_desc.x + 0.5));\n    int h = int(floor(envMapPyramid_desc.y + 0.5));\n\n    vec4 color = vec4(0.0,0.0,0.0,0.0);\n    float weight = 0.0;\n    mat3 vecSpace = matrixFromVector(N);\n    float a = roughness*roughness;\n    for(int i=0; i<numSamples; i++) {\n      vec2 Xi = Hammersley(i, numSamples);\n      vec3 H = ImportanceSampleGGX(Xi, a);\n      vec3 V = normalize(vecSpace * H);\n      float VdotN = dot(V, N);\n      float NoH = saturate( dot( N, H ) );\n      float VoH = saturate( dot( V, H ) );\n\n      vec2 uv = dirToSphOctUv(V);\n      // float pdf = D_ggx(a, NoH) * NoH / (4.0 * VoH);\n      // float lod = compute_lod(H, pdf, numSamples, w, h);\n\n      color += sampleImagePyramid(uv, a, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc) * VdotN;\n      weight += VdotN;\n    }\n    color /= float(weight);\n    fragColor = vec4(color.rgb, 1.0);\n  }\n  \n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n');
        return _this;
    }
    return bi;
}(Aa));
Qa.setShaderModule("utils/imagePyramid.glsl", '\n\n<%include file="utils/imageAtlas.glsl"/>\n\nvec4 sampleImagePyramid(vec2 uv, float lod, in sampler2D atlasLayout, in sampler2D atlasImage, in vec4 atlasDesc){\n  if (lod < 0.00001 || lod > 0.9999) {\n    float imageIndex = lod * (atlasDesc.z-1.0);\n    int imageId0 = int(imageIndex);\n    return sampleSubImage(uv, imageId0, atlasLayout, atlasImage, atlasDesc);\n  } else {\n    float imageIndex = lod * (atlasDesc.z-1.0);\n    int imageId0 = int(floor(imageIndex));\n    int imageId1 = imageId0+1;\n    float blend = fract(imageIndex);\n    vec4 c0 = sampleSubImage(uv, imageId0, atlasLayout, atlasImage, atlasDesc);\n    vec4 c1 = sampleSubImage(uv, imageId1, atlasLayout, atlasImage, atlasDesc);\n    return mix(c0, c1, blend);\n  } \n}\n\n\n');
var pi = /** @class */ (function (_super) {
    __extends(pi, _super);
    function pi(e, t, a, i, s) {
        if (i === void 0) { i = !0; }
        if (s === void 0) { s = 16; }
        var _this = this;
        _this = _super.call(this, e, t) || this, _this.__srcGLTex = a, _this.__fbos = [], a.updated.connect(function () { _this.renderAtlas(i); }), _this.__srcGLTex.isLoaded() ? (_this.generateAtlasLayout(s), _this.renderAtlas(i)) : _this.__srcGLTex.updated.connect(function () { _this.generateAtlasLayout(s), _this.renderAtlas(i); });
        return _this;
    }
    pi.prototype.generateAtlasLayout = function (e) { var t = this.__gl; this.size = this.__srcGLTex.height; var a = this.__srcGLTex.width / this.__srcGLTex.height; this.addSubImage(this.__srcGLTex); for (var i_124 = Math.round(function (e) { return Math.log2(e); }(this.size)) - 1; i_124 >= 0; --i_124) {
        var s = Math.pow(2, i_124);
        if (s < e)
            break;
        var n = new Ua(t, { format: this.__srcGLTex.getFormat(), type: this.__srcGLTex.getType(), width: s * a, height: s, filter: "LINEAR", wrap: "CLAMP_TO_EDGE" });
        this.addSubImage(n), this.__fbos.push(new qa(t, n));
    } _super.prototype.generateAtlasLayout.call(this); };
    pi.prototype.renderAtlas = function (e) {
        if (e === void 0) { e = !0; }
        var t = this.__gl, a = {};
        t.screenQuad.bindShader(a);
        for (var e_184 = 0; e_184 < this.__fbos.length; e_184++)
            this.__fbos[e_184].bindAndClear(), t.screenQuad.draw(a, this.getSubImage(e_184));
        _super.prototype.renderAtlas.call(this, e);
    };
    pi.prototype.destroy = function () { _super.prototype.destroy.call(this); for (var _b = 0, _c = this.__fbos; _b < _c.length; _b++) {
        var e_185 = _c[_b];
        e_185.destroy();
    } };
    return pi;
}(ui));
var gi = /** @class */ (function (_super) {
    __extends(gi, _super);
    function gi(e, t) {
        var _this = this;
        _this = _super.call(this, e, t) || this, _this.__gl = e, e.__quadVertexIdsBuffer || e.setupInstancedQuad(), _this.__convolved = !1, _this.__fbos = [];
        return _this;
    }
    gi.prototype.generateHammersleySamples = function (e) { var t = this.__gl; if (!t["Hammersley" + e]) {
        var a_171 = new Float32Array(3 * e);
        for (var t_186 = 0; t_186 < e; t_186++) {
            var i_125 = ci(t_186, e), s = 3 * t_186;
            a_171[s + 0] = i_125[0], a_171[s + 1] = i_125[1];
        }
        t["Hammersley" + e] = new Ua(t, { format: "RGB", type: "FLOAT", filter: "NEAREST", wrap: "CLAMP_TO_EDGE", width: e, height: 1, data: a_171, mipMapped: !1 });
    } return t["Hammersley" + e]; };
    gi.prototype.convolveProbe = function (e) {
        var _this = this;
        var t = this.__gl, a = this.generateHammersleySamples(1024);
        if (!this.__convolved) {
            this.__lodPyramid || (this.__lodPyramid = new pi(t, "Probe Lods", e, !1), this.__lodPyramid.updated.connect(function () { _this.convolveProbe(e); })), this.addSubImage(e);
            var a_172 = [e.width / 2, e.height / 2];
            var i_126 = 6;
            for (var e_186 = 0; e_186 < i_126; e_186++) {
                var e_187 = new Ua(t, { format: "RGBA", type: "FLOAT", filter: "LINEAR", wrap: "CLAMP_TO_EDGE", width: a_172[0], height: a_172[1] });
                this.addSubImage(e_187);
                var i_127 = new qa(t, e_187);
                i_127.setClearColor([0, 1, 0, 0]), this.__fbos.push(i_127), a_172 = [a_172[0] / 2, a_172[1] / 2];
            }
            this.generateAtlasLayout(), this.__convolverShader = new bi(t);
            var s_37 = this.__convolverShader.compileForTarget("GLProbe", Object.assign({ repl: { NUM_SAMPLES: 1024 } }, t.shaderopts));
            this.__covolverShaderBinding = Ea(t, s_37.attrs, t.__quadattrbuffers, t.__quadIndexBuffer);
        }
        var i = {};
        this.__convolverShader.bind(i, "GLProbe"), this.__covolverShaderBinding.bind(i);
        var s = i.unifs;
        for (var e_188 = 0; e_188 < this.__fbos.length; e_188++) {
            if (this.__fbos[e_188].bindAndClear(), this.__lodPyramid.bindToUniform(i, s.envMapPyramid), "hammersleyMap" in s && a.bindToUniform(i, s.hammersleyMap), "roughness" in s) {
                var a_173 = (e_188 + 1) / this.__fbos.length;
                t.uniform1f(s.roughness.location, a_173);
            }
            t.drawQuad();
        }
        this.__convolved = !0, this.renderAtlas(!1);
    };
    gi.prototype.bindProbeToUniform = function (e, t) { this.__convolved && _super.prototype.bindToUniform.call(this, e, t); };
    gi.prototype.destroy = function () { _super.prototype.destroy.call(this), this.__convolverShader.destroy(); for (var _b = 0, _c = this.__fbos; _b < _c.length; _b++) {
        var e_189 = _c[_b];
        e_189.destroy();
    } };
    return gi;
}(ui));
Qa.setShaderModule("stack-gl/inverse.glsl", "\n\n\n#ifndef ENABLE_ES3\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n#endif\n\n"), Qa.setShaderModule("stack-gl/transpose.glsl", "\n\n\n#ifndef ENABLE_ES3\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\n#endif\n\n"), Qa.setShaderModule("pragmatic-pbr/envmap-octahedral.glsl", "\n\n#define sectorize(value) step(0.0, (value))*2.0-1.0\n#define sum(value) dot(clamp((value), 1.0, 1.0), (value))\n\n\nvec2 dirToSphOctUv(vec3 normal){\n    normal = normalize(normal);\n    vec3 aNorm = abs(normal);\n    vec3 sNorm = sectorize(normal);\n\n    vec2 dir = max(aNorm.xy, 1e-20);\n    float orient = atan(dir.x, dir.y)/HalfPI;\n\n    dir = max(vec2(aNorm.z, length(aNorm.xy)), 1e-20);\n    float pitch = atan(dir.y, dir.x)/HalfPI;\n\n    vec2 uv = vec2(sNorm.x*orient, sNorm.y*(1.0-orient))*pitch;\n\n    if(normal.z < 0.0){\n        uv = sNorm.xy - abs(uv.ts)*sNorm.xy;\n    }\n    return uv*0.5+0.5;\n}\n\n\nvec3 sphOctUvToDir(vec2 uv){\n    uv = uv*2.0-1.0;\n    vec2 suv = sectorize(uv);\n    float sabsuv =  sum(abs(uv));\n    float pitch = sabsuv*HalfPI;\n\n    if (pitch <= 0.0) {\n        return vec3(0.0, 0.0, 1.0);\n    }\n    if (abs(pitch - PI) < 0.000001) {\n        return vec3(0.0, 0.0, -1.0);\n    }\n    if(sabsuv > 1.0){\n        uv = (1.0-abs(uv.ts))*suv;\n    }\n\n    float orient = (abs(uv.s)/sabsuv)*HalfPI;\n    float sOrient = sin(orient);\n    float cOrient = cos(orient);\n    float sPitch = sin(pitch);\n    float cPitch = cos(pitch);\n\n    return vec3(\n        sOrient*suv.s*sPitch,\n        cOrient*suv.t*sPitch,\n        cPitch\n    );\n}\n\n"), Qa.setShaderModule("pragmatic-pbr/envmap-equirect.glsl", "\n\n\nvec2 latLongUVsFromDir(vec3 dir) {\n  // Math function taken from...\n  // http://gl.ict.usc.edu/Data/HighResProbes/\n  // Note: Scaling from u=[0,2], v=[0,1] to u=[0,1], v=[0,1]\n  float phi = acos(dir.z);\n  float theta = atan(dir.x, dir.y);\n  return vec2((1.0 + theta / PI) / 2.0, phi / PI);\n}\n\n// Note: when u == 0.5 z = 1.0\nvec3 dirFromLatLongUVs(float u, float v) {\n    // http://gl.ict.usc.edu/Data/HighResProbes/\n    float theta = PI*((u * 2.0) - 1.0);\n    float phi = PI*v;\n    return vec3(sin(phi)*sin(theta), sin(phi)*cos(theta), cos(phi));\n}\n\nvec3 dirFromPolar(vec2 polar) {\n    float u = polar.x / (PI * 2.0);\n    float v = polar.y / PI;\n    return dirFromLatLongUVs(u, v);\n}\n\n"), Qa.setShaderModule("pragmatic-pbr/envmap-dualfisheye.glsl", "\n\n\n\nvec2 dualfisheyeUVsFromDir(vec3 dir) {\n  vec2 result;\n  float angle = 0.465;\n    if(dir.x < 0.0) {\n        result = vec2(((dir.z * -angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n    }\n    else {\n        result = vec2( 0.5 + ((dir.z * angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n    }\n    return result;\n}\n\n\n");
var _i = /** @class */ (function (_super) {
    __extends(_i, _super);
    function _i(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("EnvMapShader.vertexShader", '\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\n\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID() * 2.0;\n  v_texCoord = position * 0.5 + 0.5;\n\n  mat4 inverseProjection = inverse(projectionMatrix);\n  mat3 inverseModelview = transpose(mat3(viewMatrix));\n\n  // transform from the normalized device coordinates back to the view space\n  vec3 unprojected = (inverseProjection * vec4(position, 0, 1)).xyz;\n\n  // transfrom from the view space back to the world space\n  // and use it as a sampling vector\n  v_worldDir = inverseModelview * unprojected;\n\n  gl_Position = vec4(position, 0, 1);\n}\n\n');
        return _this;
    }
    return _i;
}(Aa));
var Zi = /** @class */ (function (_super) {
    __extends(Zi, _super);
    function Zi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("LatLongEnvMapShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec4 texel = texture2D(backgroundImage, v_texCoord);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    return Zi;
}(_i));
var Gi = /** @class */ (function (_super) {
    __extends(Gi, _super);
    function Gi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("OctahedralEnvMapShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n\nuniform float focus;\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\n// uniform ImageAtlas envMap;\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dirToSphOctUv(normalize(v_worldDir));\n  if(false){\n    // Use these lines to debug the src GL image.\n    vec4 texel = texture2D(envMapPyramid, uv);\n    fragColor = vec4(texel.rgb/texel.a, 1.0);\n  }\n  else{\n    fragColor = vec4(sampleImagePyramid(uv, focus, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc).rgb, 1.0);\n  }\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    return Gi;
}(_i));
var Xi = /** @class */ (function (_super) {
    __extends(Xi, _super);
    function Xi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("LatLongEnvMapShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = latLongUVsFromDir(normalize(v_worldDir));\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    Xi.getParamDeclarations = function () { return _super.getParamDeclarations.call(this); };
    return Xi;
}(_i));
var yi = /** @class */ (function (_super) {
    __extends(yi, _super);
    function yi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("SterioLatLongEnvMapShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform int eye;// L = 0, R = 1;\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = latLongUVsFromDir(normalize(v_worldDir));\n  uv.y *= 0.5;\n  if(eye == 1){\n    uv.y += 0.5;\n  }\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    return yi;
}(_i));
var fi = /** @class */ (function (_super) {
    __extends(fi, _super);
    function fi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("DualFishEyeEnvMapShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-dualfisheye.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dualfisheyeUVsFromDir(normalize(v_worldDir));\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    return fi;
}(_i));
var Vi = /** @class */ (function (_super) {
    __extends(Vi, _super);
    function Vi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("DualFishEyeEnvMapShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n<%include file="pragmatic-pbr/envmap-dualfisheye.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dualfisheyeUVsFromDir(dirFromLatLongUVs(v_texCoord.x, v_texCoord.y));\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  // fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    return Vi;
}(_i));
var Ii = /** @class */ (function (_super) {
    __extends(Ii, _super);
    function Ii(e, t, a) {
        var _this = this;
        _this = _super.call(this, e.gl, "EnvMap") || this, _this.__renderer = e, _this.__envMap = t, _this.__backgroundFocus = 0;
        var i = e.gl;
        i.__quadVertexIdsBuffer || i.setupInstancedQuad();
        var s = _this.__envMap.getMetadata("gltexture");
        s || (s = new $a(i, _this.__envMap)), _this.__srcGLTex = s, _this.__envMapShader = new Gi(i);
        var n = _this.__envMapShader.compileForTarget("GLEnvMap", a);
        _this.__envMapShaderBinding = Ea(i, n.attrs, i.__quadattrbuffers, i.__quadIndexBuffer), _this.__envMap.isLoaded() ? _this.convolveProbe(s) : _this.__envMap.loaded.connect(function () { _this.convolveProbe(s), _this.loaded.emit(); });
        return _this;
    }
    Ii.prototype.getEnvMap = function () { return this.__envMap; };
    Ii.prototype.getBackgroundFocus = function () { return this.__backgroundFocus; };
    Ii.prototype.setBackgroundFocus = function (e) { this.__backgroundFocus = e, this.__renderer.requestRedraw(); };
    Ii.prototype.draw = function (e) { if (this.__envMap.isLoaded()) {
        var t_187 = this.__gl;
        {
            this.__envMapShader.bind(e, "GLEnvMap");
            var a_174 = e.unifs;
            this.bindProbeToUniform(e, a_174.envMapPyramid);
            {
                var e_190 = a_174.focus;
                e_190 && t_187.uniform1f(e_190.location, this.__backgroundFocus);
            }
            {
                var i_128 = a_174.exposure;
                i_128 && t_187.uniform1f(i_128.location, e.exposure);
            }
            this.__envMapShaderBinding.bind(e), t_187.depthMask(!1), e.bindViewports(a_174, function () { t_187.drawQuad(); });
        }
    } };
    Ii.prototype.bindToUniform = function (e, t, a) { return this.__srcGLTex.bindToUniform(e, t, a); };
    Ii.prototype.destroy = function () { _super.prototype.destroy.call(this), this.__srcGLTex.loaded.disconnectScope(this), this.__srcGLTex.updated.disconnectScope(this), this.__srcGLTex.destroy(); };
    return Ii;
}(gi));
var Ri = /** @class */ (function (_super) {
    __extends(Ri, _super);
    function Ri(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("ScreenQuadShader.vertexShader", '\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform vec2 pos;\nuniform vec2 size;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * abs(size) * 2.0), 0.0, 1.0);\n    if(size.x < 0.0)\n        v_texCoord.x = 1.0 - v_texCoord.x;\n    if(size.y < 0.0)\n        v_texCoord.y = 1.0 - v_texCoord.y;\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("ScreenQuadShader.fragmentShader", "\nprecision highp float;\n\nuniform sampler2D image;\n\nvarying vec2 v_texCoord;\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = texture2D(image, v_texCoord);\n    fragColor = vec4(fragColor.rgb/fragColor.a, 1.0);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n"), _this.finalize();
        return _this;
    }
    return Ri;
}(Aa));
var xi = /** @class */ (function () {
    function xi(e, t) {
        this.__gl = e, this.__pos = [0, 0], this.__size = [1, 1], this.flipY = !0, this.__glshader = new Ri(e), e.__quadVertexIdsBuffer || e.setupInstancedQuad();
        var a = this.__glshader.compileForTarget("GLScreenQuad", t);
        this.__quadBinding = Ea(e, a.attrs, e.__quadattrbuffers, e.__quadIndexBuffer), this.ready = !0;
    }
    xi.prototype.bind = function (e, t, a, i) { var s = e.unifs; t.bindToUniform(e, e.unifs.image); var n = this.__gl; {
        var e_191 = s.pos;
        e_191 && n.uniform2fv(e_191.location, a ? a instanceof p ? a.asArray() : a : this.__pos);
    } {
        var e_192 = s.size;
        e_192 && n.uniform2fv(e_192.location, i ? i instanceof p ? i.asArray() : i : this.__size);
    } this.__quadBinding.bind(e); };
    xi.prototype.bindShader = function (e) { return this.__glshader.bind(e, "GLScreenQuad"); };
    xi.prototype.draw = function (e, t, a, i) { this.bind(e, t, a, i), this.__gl.drawQuad(); };
    xi.prototype.destroy = function () { };
    return xi;
}());
var Si = /** @class */ (function (_super) {
    __extends(Si, _super);
    function Si(e) {
        var _this = this;
        _this = _super.call(this) || this, _this.__renderer = e, _this.__doubleClickTimeMSParam = _this.addParameter(new Xe("DoubleClickTimeMS", 200)), _this.__fbo = void 0, _this.updated = new C, _this.resized = new C, _this.__renderer.sceneSet.connect(function () { var t = e.getScene().settings.getParameter("BackgroundColor"), a = function (e) { var a = t.getValue(); var i = _this.__renderer.gl; a instanceof Ue ? "FLOAT" === a.type ? (_this.__backgroundTexture = a, _this.__backgroundGLTexture = new $a(i, a)) : (_this.__backgroundTexture = a, _this.__backgroundGLTexture = new Ua(i, a)) : a instanceof y ? (_this.__backgroundGLTexture && (_this.__backgroundGLTexture.destroy(), _this.__backgroundGLTexture = void 0, _this.__backgroundTexture = void 0), _this.__backgroundColor = a) : console.warn("Invalid background:" + a), _this.updated.emit(); }; a(t.getValue()), t.valueChanged.connect(a); });
        return _this;
    }
    Si.prototype.getRenderer = function () { return this.__renderer; };
    Si.prototype.getName = function () { return this.__name; };
    Si.prototype.getBl = function () { return this.__bl; };
    Si.prototype.setBl = function (e) { this.__bl = e, this.resize(this.__canvasWidth, this.__canvasHeight); };
    Si.prototype.getTr = function () { return this.__tr; };
    Si.prototype.setTr = function (e) { this.__tr = e, this.resize(this.__canvasWidth, this.__canvasHeight); };
    Si.prototype.getPosX = function () { return this.__x; };
    Si.prototype.getPosY = function () { return this.__y; };
    Si.prototype.getWidth = function () { return this.__width; };
    Si.prototype.getHeight = function () { return this.__height; };
    Si.prototype.getBackground = function () { return console.warn("Deprecated Function. Please access the Scene Settings object."), this.__renderer.getScene().settings.getParameter("BackgroundColor").getValue(); };
    Si.prototype.setBackground = function (e) { console.warn("Deprecated Function. Please access the Scene Settings object."), this.__renderer.getScene().settings.getParameter("BackgroundColor").setValue(e), this.updated.emit(); };
    Si.prototype.resize = function (e, t) { this.__canvasWidth = e, this.__canvasHeight = t, this.__width = e, this.__height = t, this.resized.emit(); };
    Si.prototype.onMouseDown = function (e) { return !1; };
    Si.prototype.onMouseUp = function (e) { return !1; };
    Si.prototype.onMouseMove = function (e) { return !1; };
    Si.prototype.onMouseLeave = function (e) { return !1; };
    Si.prototype.onKeyPressed = function (e, t) { return !1; };
    Si.prototype.onKeyDown = function (e, t) { return !1; };
    Si.prototype.onKeyUp = function (e, t) { return !1; };
    return Si;
}(q));
var Wi = /** @class */ (function (_super) {
    __extends(Wi, _super);
    function Wi(e, t, a, i) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__name = t, _this.__projectionMatrix = new I, _this.__frustumDim = new _, _this.__bl = new _(0, 0), _this.__tr = new _(1, 1), _this.__exposure = 0, _this.__exposureRange = [-5, 10], _this.__tonemap = !0, _this.__gamma = 2.2, _this.__prevDownTime = 0, _this.__geomDataBuffer = void 0, _this.__geomDataBufferFbo = void 0, _this.viewChanged = new C, _this.capturedItem = null, _this.keyDown = new C, _this.keyPressed = new C, _this.keyUp = new C, _this.mouseDown = new C, _this.mouseDoubleClicked = new C, _this.mouseMove = new C, _this.mouseUp = new C, _this.mouseLeave = new C, _this.mouseDownOnGeom = new C, _this.mouseWheel = new C, _this.touchStart = new C, _this.touchMove = new C, _this.touchEnd = new C, _this.touchCancel = new C, _this.doubleTapped = new C, _this.setCamera(new Ga("Default")), _this.setManipulator(new Ka), _this.resize(a, i);
        return _this;
    }
    Wi.prototype.resize = function (e, t) { this.__canvasWidth = e, this.__canvasHeight = t, this.__x = e * this.__bl.x, this.__y = e * this.__bl.y, this.__width = e * this.__tr.x - e * this.__bl.x, this.__height = t * this.__tr.y - t * this.__bl.y, this.region = [this.__x, this.__y, this.__width, this.__height], this.__camera && this.__updateProjectionMatrix(), this.__geomDataBufferFbo && (this.__geomDataBuffer.resize(this.__width, this.__height), this.__geomDataBufferFbo.resize()), this.resized.emit(); };
    Wi.prototype.getCamera = function () { return this.__camera; };
    Wi.prototype.setCamera = function (e) {
        var _this = this;
        this.__camera = e;
        var t = e.getParameter("GlobalXfo"), a = function () { _this.__cameraXfo = t.getValue(), _this.__cameraMat = _this.__cameraXfo.toMat4(), _this.__viewMat = _this.__cameraMat.inverse(); };
        a(), t.valueChanged.connect(function () { a(), _this.invalidateGeomDataBuffer(), _this.updated.emit(), _this.viewChanged.emit({ interfaceType: "CameraAndPointer", viewXfo: _this.__cameraXfo, focalDistance: _this.__camera.getFocalDistance() }); }), this.__camera.projectionParamChanged.connect(function () { _this.__updateProjectionMatrix(), _this.updated.emit(); }), this.__updateProjectionMatrix();
    };
    Wi.prototype.getManipulator = function () { return this.__cameraManipulator; };
    Wi.prototype.setManipulator = function (e) { this.__cameraManipulator = e; };
    Wi.prototype.__updateProjectionMatrix = function () { var e = this.__width / this.__height; this.__camera.updateProjectionMatrix(this.__projectionMatrix, e); var t = Math.tan(this.__camera.getFov() / 2) * this.__camera.getNear() * 2, a = t * e; this.__frustumDim.set(a, t); };
    Wi.prototype.getProjectionMatrix = function () { return this.__projectionMatrix; };
    Wi.prototype.getViewMatrix = function () { return this.__viewMat; };
    Wi.prototype.setActive = function (e) { activeViewport = e ? this : void 0; };
    Wi.prototype.frameView = function (e) { this.__camera.frameView(this, e); };
    Wi.prototype.calcRayFromScreenPos = function (e) { var t = this.__canvasHeight * (1 - this.__tr.y); var a = (e.x - this.__x) / this.__width, i = (e.y - t) / this.__height; a = 2 * a - 1, i = 2 * i - 1; var s = this.__cameraMat, n = this.__projectionMatrix.inverse(); if (null == n)
        return null; var l, r; return this.__camera.getIsOrthographic() ? (l = s.transformVec3(n.transformVec3(new Z(a, -i, -1))), r = new Z(0, 0, -1)) : (l = s.translation, r = n.transformVec3(new Z(a, -i, -1))), r = s.rotateVec3(r).normalize(), new x(l, r); };
    Wi.prototype.createGeomDataFbo = function (e) { var t = this.__renderer.gl; this.__floatGeomBuffer = e, this.__floatGeomBuffer ? this.__geomDataBuffer = new Ua(t, { type: "FLOAT", format: "RGBA", filter: "NEAREST", width: this.__width <= 1 ? 1 : this.__width, height: this.__height <= 1 ? 1 : this.__height }) : this.__geomDataBuffer = new Ua(t, { type: "UNSIGNED_BYTE", format: "RGBA", filter: "NEAREST", width: this.__width <= 1 ? 1 : this.__width, height: this.__height <= 1 ? 1 : this.__height }), this.__geomDataBufferFbo = new qa(t, this.__geomDataBuffer, !0), this.__geomDataBufferFbo.setClearColor([0, 0, 0, 0]); };
    Wi.prototype.getGeomDataFbo = function () { return this.__geomDataBufferFbo; };
    Wi.prototype.renderGeomDataFbo = function () { if (this.__geomDataBufferFbo) {
        this.__geomDataBufferFbo.bindAndClear();
        var e_193 = {};
        this.__initRenderState(e_193), this.__renderer.drawSceneGeomData(e_193), this.__geomDataBufferInvalid = !1;
    } };
    Wi.prototype.invalidateGeomDataBuffer = function () { this.__geomDataBufferInvalid = !0; };
    Wi.prototype.getGeomDataAtPos = function (e, t) { if (this.__geomDataBufferFbo) {
        if (this.__geomDataBufferInvalid && (this.renderGeomDataFbo(), this.__screenPos = null), e === this.__screenPos)
            return this.__intersectionData;
        this.__screenPos = e, this.__intersectionData = null;
        var a_175 = this.__renderer.gl;
        var i_129, s = void 0;
        if (a_175.finish(), this.__geomDataBufferFbo.bindForReading(), a_175.floatGeomBuffer) {
            if (s = new Float32Array(4), a_175.readPixels(e.x, this.__height - e.y, 1, 1, a_175.RGBA, a_175.FLOAT, s), 0 == s[3])
                return;
            i_129 = 63 & Math.round(s[0]);
        }
        else {
            if (s = new Uint8Array(4), a_175.readPixels(e.x, this.__height - e.y, 1, 1, a_175.RGBA, a_175.UNSIGNED_BYTE, s), a_175.bindFramebuffer(a_175.FRAMEBUFFER, null), 0 == s[0] && 0 == s[1])
                return;
            i_129 = 0;
        }
        this.__geomDataBufferFbo.unbind();
        var n = this.__renderer.getPass(i_129);
        if (!n)
            return void console.warn("Geom data buffer returns invalid pass id:", i_129);
        var l = n.getGeomItemAndDist(s);
        if (l) {
            t || (t = this.calcRayFromScreenPos(e));
            var a_176 = t.start.add(t.dir.scale(l.dist));
            this.__intersectionData = { screenPos: e, mouseRay: t, intersectionPos: a_176, geomItem: l.geomItem, dist: l.dist, geomData: s };
        }
        return this.__intersectionData;
    } };
    Wi.prototype.getGeomItemsInRect = function (e, t) { if (this.__geomDataBufferFbo) {
        var a_177 = this.__renderer.gl;
        a_177.finish();
        var i_130 = Math.round(this.__height - t.y), s = Math.round(e.x), n = Math.round(t.x - e.x), l = Math.round(t.y - e.y), r = n * l;
        var o = void 0;
        this.__geomDataBufferFbo.bindForReading(), a_177.floatGeomBuffer ? (o = new Float32Array(4 * r), a_177.readPixels(s, i_130, n, l, a_177.RGBA, a_177.FLOAT, o)) : (o = new Uint8Array(4 * r), a_177.readPixels(s, i_130, n, l, a_177.RGBA, a_177.UNSIGNED_BYTE, o)), a_177.bindFramebuffer(a_177.FRAMEBUFFER, null);
        var d = new Set;
        for (var e_194 = 0; e_194 < r; e_194++) {
            var t_188 = void 0;
            var i_131 = o.subarray(4 * e_194, 4 * (e_194 + 1));
            t_188 = a_177.floatGeomBuffer ? Math.round(i_131[0]) : 0;
            var s_38 = this.__renderer.getPass(t_188).getGeomItemAndDist(i_131);
            s_38 && d.add(s_38.geomItem);
        }
        return d;
    } };
    Wi.prototype.__eventMousePos = function (e) { return new _(e.rendererX - this.getPosX(), e.rendererY - this.getPosY()); };
    Wi.prototype.__prepareEvent = function (e) {
        var _this = this;
        if (e.viewport = this, e.propagating = !0, e.stopPropagation(), e.stopPropagation = function () { e.propagating = !1; }, e.setCapture = function (e) { _this.capturedItem = e; }, e.getCapture = function (e) { return _this.capturedItem; }, e.releaseCapture = function () { _this.capturedItem = null, _this.renderGeomDataFbo(); }, e instanceof MouseEvent) {
            var t_189 = this.__eventMousePos(e);
            e.mousePos = t_189, e.mouseRay = this.calcRayFromScreenPos(t_189);
            var a_178 = this.getGeomDataAtPos(e.mousePos, e.mouseRay);
            null != a_178 && (e.intersectionData = a_178);
        }
    };
    Wi.prototype.setCapture = function (e) { this.capturedItem = e; };
    Wi.prototype.getCapture = function () { return this.capturedItem; };
    Wi.prototype.releaseCapture = function () { this.capturedItem = null, this.renderGeomDataFbo(); };
    Wi.prototype.onMouseDown = function (e) { if (this.__prepareEvent(e), this.capturedItem)
        return void this.capturedItem.onMouseDown(e); if (null != e.intersectionData) {
        if (e.intersectionData.geomItem.onMouseDown(e), !e.propagating || this.capturedItem)
            return;
        if (this.mouseDownOnGeom.emit(e), !e.propagating)
            return;
    } var t = Date.now(); if (t - this.__prevDownTime < this.__doubleClickTimeMSParam.getValue()) {
        if (this.__cameraManipulator && (this.__cameraManipulator.onDoubleClick(e), !e.propagating))
            return;
        this.mouseDoubleClicked.emit(e);
    }
    else {
        if (this.__prevDownTime = t, this.__cameraManipulator && (this.__cameraManipulator.onMouseDown(e), !e.propagating))
            return;
        this.mouseDown.emit(e);
    } return !1; };
    Wi.prototype.onMouseMove = function (e) { if (this.__prepareEvent(e), this.capturedItem)
        this.capturedItem.onMouseMove(e);
    else {
        if (null != e.intersectionData) {
            if (e.intersectionData.geomItem != this.mouseOverItem && (this.mouseOverItem && this.mouseOverItem.onMouseLeave(e), this.mouseOverItem = e.intersectionData.geomItem, this.mouseOverItem.onMouseEnter(e)), e.intersectionData.geomItem.onMouseMove(e), !e.propagating || this.capturedItem)
                return;
        }
        else
            this.mouseOverItem && (this.mouseOverItem.onMouseLeave(e), this.mouseOverItem = null);
        this.__cameraManipulator && (this.__cameraManipulator.onMouseMove(e), !e.propagating) || this.mouseMove.emit(e);
    } };
    Wi.prototype.onMouseUp = function (e) { this.__prepareEvent(e), this.capturedItem ? this.capturedItem.onMouseUp(e) : (null == e.intersectionData || (e.intersectionData.geomItem.onMouseUp(e), e.propagating)) && (this.__cameraManipulator && (this.__cameraManipulator.onMouseUp(e), !e.propagating) || this.mouseUp.emit(e)); };
    Wi.prototype.onMouseLeave = function (e) { this.__prepareEvent(e), this.mouseLeave.emit(e); };
    Wi.prototype.onKeyPressed = function (e, t) { this.__prepareEvent(t), this.__cameraManipulator && this.__cameraManipulator.onKeyPressed(e, t) || this.keyPressed.emit(e, t); };
    Wi.prototype.onKeyDown = function (e, t) { this.__prepareEvent(t), this.__cameraManipulator && this.__cameraManipulator.onKeyDown(e, t) || this.keyDown.emit(e, t); };
    Wi.prototype.onKeyUp = function (e, t) { this.__prepareEvent(t), this.__cameraManipulator && this.__cameraManipulator.onKeyUp(e, t) || this.keyUp.emit(e, t); };
    Wi.prototype.onWheel = function (e) { this.__prepareEvent(e), (null == e.intersectionData || (e.intersectionData.geomItem.onWheel(e), e.propagating)) && (this.__cameraManipulator ? this.__cameraManipulator.onWheel(e) : this.mouseWheel.emit(e)); };
    Wi.prototype.__eventTouchPos = function (e) { return new _(e.rendererX - this.getPosX(), e.rendererY - this.getPosY()); };
    Wi.prototype.onTouchStart = function (e) { if (this.__prepareEvent(e), 1 == e.touches.length) {
        var t_190 = e.touches[0], a_179 = this.__eventTouchPos(t_190);
        e.touchPos = a_179, e.touchRay = this.calcRayFromScreenPos(a_179);
        var i_132 = this.getGeomDataAtPos(a_179, e.touchRay);
        if (null != i_132) {
            if (e.intersectionData = i_132, i_132.geomItem.onMouseDown(e, i_132), !e.propagating)
                return;
            if (this.capturedItem)
                return;
            if (this.mouseDownOnGeom.emit(e), !e.propagating)
                return;
        }
        var s = Date.now();
        if (s - this.__prevDownTime < this.__doubleClickTimeMSParam.getValue()) {
            if (this.__cameraManipulator && (this.__cameraManipulator.onDoubleTap(e), !e.propagating))
                return;
            return void this.doubleTapped.emit(e);
        }
        this.__prevDownTime = s;
    } this.__cameraManipulator ? this.__cameraManipulator.onTouchStart(e) : this.touchStart.emit(e); };
    Wi.prototype.onTouchMove = function (e) { if (this.__prepareEvent(e), this.capturedItem) {
        e.touchPos = [], e.touchRay = [];
        for (var t_191 = 0; t_191 < e.touches.length; t_191++) {
            var a_180 = e.touches[t_191], i_133 = this.__eventTouchPos(a_180);
            e.touchPos[t_191] = i_133, e.touchRay[t_191] = this.calcRayFromScreenPos(i_133);
        }
        return e.mousePos = e.touchPos[0], e.mouseRay = e.touchRay[0], void this.capturedItem.onMouseMove(e);
    } this.__cameraManipulator ? this.__cameraManipulator.onTouchMove(e) : this.touchMove.emit(e); };
    Wi.prototype.onTouchEnd = function (e) { this.__prepareEvent(e), this.capturedItem ? this.capturedItem.onMouseUp(e) : this.__cameraManipulator ? this.__cameraManipulator.onTouchEnd(e) : this.touchEnd.emit(e); };
    Wi.prototype.onTouchCancel = function (e) { this.__prepareEvent(e), this.capturedItem ? this.capturedItem.onTouchCancel(e) : this.__cameraManipulator ? this.__cameraManipulator.onTouchCancel(e) : this.touchCancel.emit(e); };
    Wi.prototype.__initRenderState = function (e) { e.viewXfo = this.__cameraXfo, e.viewScale = 1, e.region = this.region, e.cameraMatrix = this.__cameraMat, e.viewports = [{ region: this.region, viewMatrix: this.__viewMat, projectionMatrix: this.__projectionMatrix, viewportFrustumSize: this.__frustumDim, isOrthographic: this.__camera.getIsOrthographic(), fovY: this.__camera.getFov() }]; };
    Wi.prototype.draw = function () { var e = this.__renderer.gl; e.bindFramebuffer(e.FRAMEBUFFER, null), e.viewport.apply(e, this.region), this.__backgroundColor && e.clearColor.apply(e, this.__backgroundColor.asArray()), e.colorMask(!0, !0, !0, !0), e.clear(e.COLOR_BUFFER_BIT | e.DEPTH_BUFFER_BIT); var t = {}; this.__initRenderState(t), this.__renderer.drawScene(t); };
    return Wi;
}(Si));
var Li = /** @class */ (function () {
    function Li(e, t) {
        this.__vrviewport = e, this.__treeItem = new ra("VRHead"), t.addChild(this.__treeItem), this.__mat4 = new I, this.__localXfo = new S;
    }
    Li.prototype.update = function (e) { this.__mat4.setDataArray(e.transform.matrix), this.__localXfo.fromMat4(this.__mat4), this.__treeItem.setLocalXfo(this.__localXfo); };
    Li.prototype.getTreeItem = function () { return this.__treeItem; };
    Li.prototype.getXfo = function () { return this.__localXfo; };
    return Li;
}());
var vi = /** @class */ (function () {
    function vi(e, a, i) {
        var _this = this;
        if (this.__vrviewport = e, this.__inputSource = a, this.__id = i, this.__isDaydramController = t.isMobileDevice, this.touchpadTouched = new C, this.buttonPressed = new C, this.buttonReleased = new C, this.__pressedButtons = [], this.__mat4 = new I, this.__xfo = new S, this.__treeItem = new ra("VRController:" + a.handedness + i), !this.__isDaydramController) {
            this.__tip = new ra("Tip");
            var t_192 = new S;
            t_192.tr.set(0, -.05, -.13), this.__tip.setLocalXfo(t_192), this.__treeItem.addChild(this.__tip, !1), e.getTreeItem().addChild(this.__treeItem), this.__activeVolumeSize = .04, e.loadHMDResources().then(function (e) { e.loaded.connect(function () { var t; 0 == i ? t = e.getChildByName("LeftController") : 1 == i && (t = e.getChildByName("RightController")), t || (t = e.getChildByName("Controller")); var a = t.clone(); a.setLocalXfo(new S(new Z(0, -.035, -.085), new R({ setFromAxisAndAngle: [new Z(0, 1, 0), Math.PI] }), new Z(.001, .001, .001))), _this.__treeItem.addChild(a, !1); }); });
        }
    }
    vi.prototype.getHandedness = function () { return this.__inputSource.handedness; };
    vi.prototype.getId = function () { return this.__id; };
    vi.prototype.getTreeItem = function () { return this.__treeItem; };
    vi.prototype.getTipItem = function () { return this.__tip; };
    vi.prototype.getTipXfo = function () { return this.__tip.getGlobalXfo(); };
    vi.prototype.getTouchPadValue = function () { return this.__touchpadValue; };
    vi.prototype.isButtonPressed = function () { return this.__buttonPressed; };
    vi.prototype.getControllerStageLocalXfo = function () { return this.__xfo; };
    vi.prototype.getControllerTipStageLocalXfo = function () { return this.__xfo.multiply(this.__tip.getLocalXfo()); };
    vi.prototype.updatePose = function (e, t, a) { var i = t.getPose(a.gripSpace, e); i && i.transform && (this.__mat4.setDataArray(i.transform.matrix), this.__xfo.fromMat4(this.__mat4), this.__treeItem.setLocalXfo(this.__xfo), this.__geomAtTip = void 0, this.__hitTested = !1); };
    vi.prototype.getGeomItemAtTip = function () { if (this.__hitTested)
        return this.__intersectionData; this.__hitTested = !0; var e = this.__vrviewport.getRenderer(), t = this.__tip.getGlobalXfo(), a = this.__activeVolumeSize; return this.__intersectionData = e.raycastWithXfo(t, a, a), this.__intersectionData; };
    return vi;
}());
var Mi = /** @class */ (function (_super) {
    __extends(Mi, _super);
    function Mi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.getParameter("DoubleClickTimeMS").setValue(300), _this.__projectionMatriciesUpdated = !1, _this.__far = 1024, _this.__near = .1, _this.__stageTreeItem = new ra("VRStage"), _this.__stageTreeItem.setSelectable(!1), _this.__stageTreeItem.setVisible(!1), _this.__renderer.addTreeItem(_this.__stageTreeItem), _this.__vrhead = new Li(_this.__renderer.gl, _this.__stageTreeItem), _this.__vrControllersMap = {}, _this.__vrControllers = [];
        var t = new S;
        t.ori.setFromAxisAndAngle(new Z(1, 0, 0), .5 * Math.PI), _this.setXfo(t), _this.__leftViewMatrix = new I, _this.__leftProjectionMatrix = new I, _this.__rightViewMatrix = new I, _this.__rightProjectionMatrix = new I, _this.resized = new C, _this.viewChanged = new C, _this.presentingChanged = new C, _this.controllerAdded = new C, _this.controllerButtonDown = new C, _this.controllerButtonUp = new C, _this.controllerDoubleClicked = new C, _this.controllerTouchpadTouched = new C;
        return _this;
    }
    Mi.prototype.getVRDisplay = function () { return this.__vrDisplay; };
    Mi.prototype.getAsset = function () { return this.__vrAsset; };
    Mi.prototype.getTreeItem = function () { return this.__stageTreeItem; };
    Mi.prototype.getVRHead = function () { return this.__vrhead; };
    Mi.prototype.getXfo = function () { return this.__stageXfo; };
    Mi.prototype.setXfo = function (e) { this.__stageXfo = e, this.__stageTreeItem.setGlobalXfo(e), this.__stageMatrix = e.inverse().toMat4(), this.__stageScale = e.sc.x; };
    Mi.prototype.getControllers = function () { return this.__vrControllers; };
    Mi.prototype.canPresent = function () { return this.__canPresent; };
    Mi.prototype.isPresenting = function () { return this.__session; };
    Mi.prototype.__startSession = function () {
        var _this = this;
        var e = function (t, a) { _this.__session && (_this.__session.requestAnimationFrame(e), _this.draw(a)); };
        this.__session.requestAnimationFrame(e);
    };
    Mi.prototype.loadHMDResources = function () {
        var _this = this;
        var e = localStorage.getItem("hmd");
        return this.__hmd != e && (this.__hmdAssetPromise = void 0), this.__hmdAssetPromise || (this.__hmd = e, this.__hmdAssetPromise = new Promise(function (a, i) { _this.__renderer.sceneSet.connect(function (s) { var n = s.getResourceLoader(); var l; switch (e) {
            case "Vive":
                l = "ZeaEngine/Vive.vla";
                break;
            case "Oculus":
            default: l = "ZeaEngine/Oculus.vla";
        } var r = n.resolveFilePathToId(l); r && !t.isMobileDevice ? (_this.__vrAsset = _this.__renderer.getScene().loadCommonAssetResource(r), _this.__vrAsset.loaded.connect(function () { var e = _this.__vrAsset.getMaterialLibrary(), t = e.getMaterialNames(); for (var _b = 0, t_193 = t; _b < t_193.length; _b++) {
            var a_181 = t_193[_b];
            var t_194 = e.getMaterial(a_181, !1);
            t_194 && (t_194.visibleInGeomDataBuffer = !1, t_194.setShaderName("SimpleSurfaceShader"));
        } a(_this.__vrAsset); })) : i(); }); })), this.__hmdAssetPromise;
    };
    Mi.prototype.startPresenting = function () {
        var _this = this;
        var e = this.__renderer.gl;
        this.loadHMDResources().then(function () { navigator.xr.requestSession("immersive-vr", { requiredFeatures: ["local-floor"], optionalFeatures: ["bounded-floor"] }).then(function (t) { _this.__renderer.__xrViewportPresenting = !0; var a = document.createElement("canvas"); a.style.position = "relative", a.style.left = "0px", a.style.top = "0px", a.style.width = "100%", a.style.height = "100%", _this.__renderer.getDiv().replaceChild(a, _this.__renderer.getGLCanvas()), t.addEventListener("end", function (e) { _this.__stageTreeItem.setVisible(!1), _this.__renderer.getDiv().replaceChild(_this.__renderer.getGLCanvas(), a), _this.__session = null, _this.presentingChanged.emit(!1); }); t.addEventListener("selectstart", function (e) { var t = _this.__vrControllersMap[e.inputSource.handedness]; if (t) {
            var a_182 = Date.now();
            console.log("controller:", e.inputSource.handedness, " down", a_182 - t.__prevDownTime), a_182 - t.__prevDownTime < _this.__doubleClickTimeMSParam.getValue() ? _this.controllerDoubleClicked.emit({ button: 1, controller: t, vleStopPropagation: !1, vrviewport: _this }, _this) : (t.__prevDownTime = a_182, _this.controllerButtonDown.emit({ button: 1, controller: t, vleStopPropagation: !1, vrviewport: _this }, _this));
        } }), t.addEventListener("selectend", function (e) { var t = _this.__vrControllersMap[e.inputSource.handedness]; t && (console.log("controller:", e.inputSource.handedness, " up"), _this.controllerButtonUp.emit({ button: 1, controller: t, vleStopPropagation: !1, vrviewport: _this }, _this)); }), _this.__session = t, t.updateRenderState({ baseLayer: new XRWebGLLayer(t, e, { compositionDisabled: "inline" == t.mode }), outputContext: a.getContext("xrpresent") }), t.requestReferenceSpace("local-floor").catch(function (e) { return (console.log("Falling back to identity reference space"), t.requestReferenceSpace("viewer").then(function (e) { return e.getOffsetReferenceSpace(new XRRigidTransform({ y: -1.6 })); })); }).then(function (e) { _this.__refSpace = e, _this.__stageTreeItem.setVisible(!0), _this.presentingChanged.emit(!0), _this.__startSession(); }).catch(function (e) { console.warn(e.message); }); }).catch(function (e) { console.warn(e.message); }); });
    };
    Mi.prototype.stopPresenting = function () { this.__session && this.__session.end(); };
    Mi.prototype.togglePresenting = function () { this.__session ? this.stopPresenting() : this.startPresenting(); };
    Mi.prototype.getHMDCanvasSize = function () { return this.__hmdCanvasSize; };
    Mi.prototype.__createController = function (e, t) { console.log("creating controller:", t.handedness); var a = new vi(this, t, e); return this.__vrControllersMap[t.handedness] = a, this.__vrControllers[e] = a, this.controllerAdded.emit(a), a; };
    Mi.prototype.updateControllers = function (e) { var t = this.__session.inputSources; for (var a_183 = 0; a_183 < t.length; a_183++) {
        var i_134 = t[a_183];
        if ("" == i_134.handedness || "none" == i_134.handedness)
            return;
        this.__vrControllers[a_183] || this.__createController(a_183, i_134), this.__vrControllers[a_183].updatePose(this.__refSpace, e, i_134);
    } };
    Mi.prototype.draw = function (e) { var t = e.session.renderState.baseLayer, a = e.getViewerPose(this.__refSpace), i = a.views; if (!this.__projectionMatriciesUpdated) {
        this.__projectionMatrices = [], this.__viewMatrices = [], this.__cameraMatrices = [], this.__region = [0, 0, 0, 0];
        for (var e_195 = 0; e_195 < i.length; e_195++) {
            var a_184 = i[e_195], s_39 = new I;
            s_39.setDataArray(a_184.projectionMatrix), this.__projectionMatrices[e_195] = s_39, this.__viewMatrices[e_195] = new I, this.__cameraMatrices[e_195] = new I;
            var n_34 = t.getViewport(a_184);
            this.__region[2] = Math.max(this.__region[2], n_34.x + n_34.width), this.__region[3] = Math.max(this.__region[3], n_34.y + n_34.height);
        }
        this.__renderer.resizeFbos(this.__region[2], this.__region[3]), this.__projectionMatriciesUpdated = !0;
    } var s = this.__renderer.gl; s.bindFramebuffer(s.FRAMEBUFFER, t.framebuffer), this.__backgroundColor && s.clearColor.apply(s, this.__backgroundColor.asArray()), s.colorMask(!0, !0, !0, !0), s.clear(s.COLOR_BUFFER_BIT | s.DEPTH_BUFFER_BIT); var n = { boundRendertarget: t.framebuffer, region: this.__region, viewports: [] }; for (var e_196 = 0; e_196 < i.length; e_196++) {
        var a_185 = i[e_196];
        this.__viewMatrices[e_196].setDataArray(a_185.transform.inverse.matrix), this.__viewMatrices[e_196].multiplyInPlace(this.__stageMatrix);
        var s_40 = t.getViewport(a_185);
        n.viewports.push({ viewMatrix: this.__viewMatrices[e_196], projectionMatrix: this.__projectionMatrices[e_196], region: [s_40.x, s_40.y, s_40.width, s_40.height] });
    } if (this.__vrhead.update(a), this.updateControllers(e), n.viewXfo = this.__vrhead.getTreeItem().getGlobalXfo(), n.viewScale = 1 / this.__stageScale, n.cameraMatrix = n.viewXfo.toMat4(), n.region = this.__region, this.__renderer.drawScene(n), this.capturedElement) {
        var e_197 = { viewport: this };
        this.capturedElement.onMouseMove(e_197);
    } var l = { interfaceType: "VR", hmd: this.__hmd, viewXfo: n.viewXfo, controllers: this.__vrControllers, vrviewport: this }; this.viewChanged.emit(l, this); };
    Mi.prototype.setCapture = function (e) { this.capturedElement = e; };
    Mi.prototype.getCapture = function () { return this.capturedElement; };
    Mi.prototype.releaseCapture = function () { this.capturedElement = null, this.renderGeomDataFbo(); };
    return Mi;
}(Si));
var Fi = void 0, Ti = !1, Ci = !1;
var Yi = {};
var Ni = { OPAQUE: 1, TRANSPARENT: 2, OVERLAY: 4 };
var Ki = /** @class */ (function (_super) {
    __extends(Ki, _super);
    function Ki() {
        var _this = this;
        _this = _super.call(this) || this, _this.updated = new C, _this.enabled = !0, _this.__passIndex = 0;
        var e = _this.addParameter(new fe("Enabled", !0));
        e.valueChanged.connect(function (t) { return _this.enabled = e.getValue(); });
        return _this;
    }
    Ki.prototype.__parameterValueChanged = function (e, t) { _super.prototype.__parameterValueChanged.call(this, e, t), this.__renderer && this.__renderer.requestRedraw(); };
    Ki.prototype.init = function (e, t) { if (null == t)
        throw new Error("Missing constructor argument."); this.__gl = e.gl, this.__renderer = e, this.__passIndex = t; };
    Ki.prototype.setPassIndex = function (e) { this.__passIndex = e; };
    Ki.prototype.startPresenting = function () { };
    Ki.prototype.stopPresenting = function () { };
    Ki.prototype.draw = function (e) { };
    Ki.prototype.drawHighlightedGeoms = function (e) { };
    Ki.prototype.drawGeomData = function (e) { };
    Ki.prototype.getGeomItemAndDist = function (e) { };
    return Ki;
}(q));
var wi = /** @class */ (function (_super) {
    __extends(wi, _super);
    function wi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("OutlinesShader.vertexShader", "\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    v_texCoord = positions.xy+0.5;\n    gl_Position = vec4(positions.xy*2.0, 0.0, 1.0);\n}\n\n"), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("OutlinesShader.fragmentShader", "\nprecision highp float;\n\nuniform sampler2D highlightDataTexture;\nuniform vec2 highlightDataTextureSize;\n\nvarying vec2 v_texCoord;\n\n\nbool isFilledPixel(vec4 p) {\n    return p.r > 0.01 || p.g > 0.01 || p.b > 0.01;\n}\nvoid accumOutlinePixel(vec2 fragCoord, inout vec4 res) {\n    vec3 p = texture2D(highlightDataTexture, fragCoord/highlightDataTextureSize).rgb;\n    if(p.r > 0.01 || p.g > 0.01 || p.b > 0.01) {\n        res.r += p.r;\n        res.g += p.g;\n        res.b += p.b;\n        res.a += 1.0;\n    }\n}\nvec4 getOutlinePixelColor(vec2 fragCoord) {\n    vec4 M = texture2D(highlightDataTexture, fragCoord/highlightDataTextureSize);\n    \n    /// To display a fill instead of an outline.\n    // return M;\n\n    if( isFilledPixel(M) ) {\n        // Note: the filled pixel has an alpha value\n        // that determines how much fill is applied\n        // The outline is a solid color. \n        return M;\n    }\n    // Search surrounding pixels for selected geoms.\n    vec4 res;\n    accumOutlinePixel(fragCoord+vec2( 1, 1), res); // NW\n    accumOutlinePixel(fragCoord+vec2(-1, 1), res); // NE\n    accumOutlinePixel(fragCoord+vec2( 1,-1), res); // SW\n    accumOutlinePixel(fragCoord+vec2(-1,-1), res); // SE\n    accumOutlinePixel(fragCoord+vec2( 0, 2), res); // NN\n    accumOutlinePixel(fragCoord+vec2(-2, 0), res); // EE\n    accumOutlinePixel(fragCoord+vec2( 2, 0), res); // WW\n    accumOutlinePixel(fragCoord+vec2( 0,-2), res); // SS\n    accumOutlinePixel(fragCoord+vec2( 1, 2), res); // NNW\n    accumOutlinePixel(fragCoord+vec2(-1, 2), res); // NNE\n    accumOutlinePixel(fragCoord+vec2(-2, 1), res); // EEN\n    accumOutlinePixel(fragCoord+vec2(-2,-1), res); // EES\n    accumOutlinePixel(fragCoord+vec2( 2, 1), res); // WWN\n    accumOutlinePixel(fragCoord+vec2( 2,-1), res); // WWS\n    accumOutlinePixel(fragCoord+vec2( 1,-2), res); // SSW\n    accumOutlinePixel(fragCoord+vec2(-1,-2), res); // SSE\n\n    if(isFilledPixel(res))\n        return vec4(res.rgb / res.a, 1.0);\n    else\n        return vec4(0.0, 0.0, 0.0, 0.0);\n}\n\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n    // fragColor = texture2D(highlightDataTexture, v_texCoord);;\n    //can also use gl_FragCoord.xy\n    mediump vec2 fragCoord = v_texCoord * highlightDataTextureSize; \n    /////////////////\n    // Selection Outlines\n    vec4 outlineColor = getOutlinePixelColor(fragCoord);\n    if(outlineColor.a > 0.0001){\n#ifndef ENABLE_ES3\n        gl_FragColor = outlineColor;\n#else\n        fragColor = outlineColor;\n#endif\n    }\n    else {\n        discard;\n    }\n}\n\n");
        return _this;
    }
    return wi;
}(Aa));
var zi = Ni.OPAQUE | Ni.TRANSPARENT | Ni.OVERLAY;
var Ui = /** @class */ (function (_super) {
    __extends(Ui, _super);
    function Ui(e, a) {
        if (a === void 0) { a = {}; }
        var _this = this;
        _this = _super.call(this, e, a, { antialias: !0, depth: !0 }) || this, _this.__exposure = 1, _this.__tonemap = !0, _this.__gamma = 2.2, _this.__glEnvMap = void 0, _this.__glBackgroundMap = void 0, _this.envMapAssigned = new C(!0), _this.__glLightmaps = {}, _this.__displayEnvironment = !0, _this.__debugMode = 0, _this.__debugLightmaps = !1, _this._planeDist = 0, _this.__cutPlaneNormal = new Z(1, 0, 0);
        var i = _this.__gl;
        _this.__debugTextures = [void 0], _this.addShaderPreprocessorDirective("ENABLE_INLINE_GAMMACORRECTION"), a.disableLightmaps || _this.addShaderPreprocessorDirective("ENABLE_LIGHTMAPS"), a.disableTextures || _this.addShaderPreprocessorDirective("ENABLE_TEXTURES"), t.isMobileDevice || a.disableSpecular || _this.addShaderPreprocessorDirective("ENABLE_SPECULAR"), _this.__outlineShader = new wi(i), _this.quad = new ka(i, new ta(1, 1)), _this.createSelectedGeomsFbo(), _this.createRayCastRenderTarget();
        return _this;
    }
    Ui.prototype.__bindEnvMap = function (e) { if (e instanceof Rt)
        this.__glEnvMap = e.getMetadata("gltexture"), this.__glEnvMap || ("FLOAT" === e.type ? (this.addShaderPreprocessorDirective("ENABLE_SPECULAR"), this.__glEnvMap = new Ii(this, e, this.__preproc)) : e.isStreamAtlas() ? this.__glEnvMap = new GLImageStream(this.__gl, e) : this.__glEnvMap = new Ua(this.__gl, e)), this.__glEnvMap.loaded.connect(this.requestRedraw), this.__glEnvMap.updated.connect(this.requestRedraw), this.envMapAssigned.emit(this.__glEnvMap);
    else {
        var t_195 = e;
        if (this.__glBackgroundMap = t_195.getMetadata("gltexture"), this.__glBackgroundMap || ("FLOAT" === t_195.type ? this.__glBackgroundMap = new $a(gl, t_195) : this.__glBackgroundMap = new Ua(gl, t_195)), this.__glBackgroundMap.loaded.connect(this.requestRedraw), this.__glBackgroundMap.updated.connect(this.requestRedraw), !this.__backgroundMapShader) {
            switch (gl.__quadVertexIdsBuffer || gl.setupInstancedQuad(), t_195.getMapping()) {
                case "octahedral":
                    this.__backgroundMapShader = new Gi(gl);
                    break;
                case "latlong":
                    this.__backgroundMapShader = new Xi(gl);
                    break;
                case "steriolatlong":
                    this.__backgroundMapShader = new yi(gl);
                    break;
                case "dualfisheye":
                    this.__backgroundMapShader = new Vi(gl);
                    break;
                case "uv":
                default: this.__backgroundMapShader = new Zi(gl);
            }
            var e_198 = this.__backgroundMapShader.compileForTarget();
            this.__backgroundMapShaderBinding = Ea(gl, e_198.attrs, gl.__quadattrbuffers, gl.__quadIndexBuffer);
        }
    } };
    Ui.prototype.getGLEnvMap = function () { return this.__glEnvMap; };
    Ui.prototype.getEnvMapTex = function () { return console.warn("Deprecated Function"), this.__glEnvMap; };
    Ui.prototype.setScene = function (e) {
        var _this = this;
        var t = e.settings.getParameter("EnvMap");
        null != t.getValue() && this.__bindEnvMap(t.getValue()), t.valueChanged.connect(function () { _this.__bindEnvMap(t.getValue()); });
        var a = e.settings.getParameter("Display EnvMap");
        this.__displayEnvironment = a.getValue(), a.valueChanged.connect(function () { _this.__displayEnvironment = a.getValue(), _this.requestRedraw(); }), _super.prototype.setScene.call(this, e);
    };
    Ui.prototype.addTreeItem = function (e) {
        var _this = this;
        if (_super.prototype.addTreeItem.call(this, e), e instanceof ya) {
            var t_196 = function (e, t) { var a = t.image.getMetadata("gltexture"); a || (a = new $a(_this.__gl, t.image)), a.updated.connect(function (e) { _this.requestRedraw(); }), _this.__glLightmaps[e] = { atlasSize: t.atlasSize, glimage: a }; }, a_186 = e;
            a_186.loaded.connect(function () { _this.__glEnvMap && a_186.getLightmap() && t_196(a_186.getName(), a_186.getLightmap()); });
        }
    };
    Ui.prototype.removeTreeItem = function (e) { _super.prototype.removeTreeItem.call(this, e); };
    Ui.prototype.addViewport = function (e) { return _super.prototype.addViewport.call(this, e); };
    Ui.prototype.onKeyPressed = function (e, t) { switch (e) {
        case "b":
            this.__displayEnvironment = !this.__displayEnvironment, this.requestRedraw();
            break;
        default: _super.prototype.onKeyPressed.call(this, e, t);
    } };
    Object.defineProperty(Ui.prototype, "exposure", {
        get: function () { return this.__exposure; },
        set: function (e) { this.__exposure = e, this.requestRedraw(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Ui.prototype, "gamma", {
        get: function () { return this.__gamma; },
        set: function (e) { this.__gamma = e, this.requestRedraw(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Ui.prototype, "displayEnvironment", {
        get: function () { return this.__displayEnvironment; },
        set: function (e) { this.__displayEnvironment = e, this.requestRedraw(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Ui.prototype, "planeDist", {
        get: function () { return this._planeDist; },
        set: function (e) { this._planeDist = e, this.requestRedraw(); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Ui.prototype, "cutPlaneNormal", {
        get: function () { return this.__cutPlaneNormal; },
        set: function (e) { this.__cutPlaneNormal = e, this.requestRedraw(); },
        enumerable: true,
        configurable: true
    });
    Ui.prototype.resizeFbos = function (e, t) { _super.prototype.resizeFbos.call(this), this.__fbo && this.__fbo.colorTexture.resize(e, t), this.__highlightedGeomsBufferFbo && this.__highlightedGeomsBuffer.resize(e, t); };
    Ui.prototype.createSelectedGeomsFbo = function () { var e = this.__gl; this.__highlightedGeomsBuffer = new Ua(e, { type: "UNSIGNED_BYTE", format: "RGBA", filter: "NEAREST", width: this.__glcanvas.width <= 1 ? 1 : this.__glcanvas.width, height: this.__glcanvas.height <= 1 ? 1 : this.__glcanvas.height }), this.__highlightedGeomsBufferFbo = new qa(e, this.__highlightedGeomsBuffer, !0), this.__highlightedGeomsBufferFbo.setClearColor([0, 0, 0, 0]); };
    Ui.prototype.getFbo = function () { return this.__fbo; };
    Ui.prototype.createOffscreenFbo = function (e) {
        if (e === void 0) { e = "RGB"; }
        var t = this.__glcanvas.width, a = this.__glcanvas.height, i = this.__gl;
        this.__fwBuffer = new Ua(i, { type: "FLOAT", format: e, filter: "NEAREST", width: t, height: a }), this.__fbo = new qa(i, this.__fwBuffer, !0), this.__fbo.setClearColor(this.__backgroundColor.asArray());
    };
    Ui.prototype.createRayCastRenderTarget = function () { var e = this.__gl; this.__rayCastRenderTarget = new oi(e, { type: "FLOAT", format: "RGBA", filter: "NEAREST", width: 3, height: 3, numColorChannels: 1 }), this.__rayCastRenderTargetProjMatrix = new I, this.rayCastDist = 0, this.rayCastArea = 0; };
    Ui.prototype.raycastWithRay = function (e, t, a, i) {
        if (a === void 0) { a = .01; }
        if (i === void 0) { i = zi; }
        var s = new S;
        return s.setLookAt(e.start, e.start.add(e.dir)), this.raycast(s, e, t, a, i);
    };
    Ui.prototype.raycastWithXfo = function (e, t, a, i) {
        if (a === void 0) { a = .01; }
        if (i === void 0) { i = zi; }
        var s = new x(e.tr, e.ori.getZaxis().negate());
        return this.raycast(e, s, t, a, i);
    };
    Ui.prototype.raycast = function (e, t, a, i, s) {
        if (i === void 0) { i = .01; }
        if (s === void 0) { s = zi; }
        this.rayCastDist == a && this.rayCastArea == i || (this.__rayCastRenderTargetProjMatrix.setOrthographicMatrix(-.5 * i, .5 * i, -.5 * i, .5 * i, 0, a), this.rayCastDist = a, this.rayCastArea = i);
        var n = this.__gl, l = { cameraMatrix: e.toMat4(), viewports: [{ region: [0, 0, 3, 3], viewMatrix: e.inverse().toMat4(), projectionMatrix: this.__rayCastRenderTargetProjMatrix, isOrthographic: !0 }] };
        this.__rayCastRenderTarget.bindForWriting(l, !0), n.enable(n.CULL_FACE), n.enable(n.DEPTH_TEST), n.depthFunc(n.LEQUAL), n.depthMask(!0), this.drawSceneGeomData(l, s), n.finish(), this.__rayCastRenderTarget.unbindForWriting(), this.__rayCastRenderTarget.bindForReading();
        var r = new Float32Array(36);
        n.readPixels(0, 0, 3, 3, n.RGBA, n.FLOAT, r), this.__rayCastRenderTarget.unbindForReading();
        var o = [4, 3, 5, 1, 7];
        var d;
        for (var _b = 0, o_9 = o; _b < o_9.length; _b++) {
            var e_199 = o_9[_b];
            if (0 != r[4 * e_199 + 3]) {
                d = r.subarray(4 * e_199, 4 * e_199 + 4);
                break;
            }
        }
        if (!d)
            return;
        var h = 63 & Math.round(d[0]), c = this.getPass(h).getGeomItemAndDist(d);
        if (c) {
            var e_200 = t.start.add(t.dir.scale(c.dist));
            return { ray: t, intersectionPos: e_200, geomItem: c.geomItem, dist: c.dist, geomData: d };
        }
    };
    Ui.prototype.drawBackground = function (e) { if (this.__glBackgroundMap) {
        if (!this.__glBackgroundMap.isLoaded())
            return;
        var t_197 = this.__gl;
        t_197.depthMask(!1), this.__backgroundMapShader.bind(e);
        var a_187 = e.unifs;
        this.__glBackgroundMap.bindToUniform(e, a_187.backgroundImage), this.__backgroundMapShaderBinding.bind(e), t_197.drawQuad();
    }
    else
        this.__glEnvMap && this.__glEnvMap.draw && this.__glEnvMap.draw(e); };
    Ui.prototype.bindGLRenderer = function (e) {
        var _this = this;
        _super.prototype.bindGLBaseRenderer.call(this, e), e.envMap = this.__glEnvMap, e.exposure = this.__exposure, e.gamma = this.__gamma, e.lightmaps = this.__glLightmaps, e.boundLightmap = void 0;
        var t = this.__gl, a = e.bindRendererUnifs;
        e.bindRendererUnifs = function (i) { if (a(i), _this.__glEnvMap) {
            var t_198 = i.envMapPyramid;
            if (t_198 && _this.__glEnvMap.bindProbeToUniform)
                _this.__glEnvMap.bindProbeToUniform(e, t_198);
            else {
                var t_199 = i.envMapTex, a_188 = i.envMapTexType;
                t_199 && _this.__glEnvMap.bindToUniform(e, t_199, { textureTypeUnif: a_188 });
            }
        } {
            var e_201 = i.exposure;
            e_201 && t.uniform1f(e_201.location, _this.__exposure);
        } {
            var e_202 = i.gamma;
            e_202 && t.uniform1f(e_202.location, _this.__gamma);
        } };
    };
    Ui.prototype.drawScene = function (e) { if (this.bindGLRenderer(e), this.__displayEnvironment && this.drawBackground(e), _super.prototype.drawScene.call(this, e), this.__highlightedGeomsBufferFbo) {
        var t_200 = this.__gl;
        this.__highlightedGeomsBufferFbo.bindForWriting(e), this.__highlightedGeomsBufferFbo.clear(), t_200.disable(t_200.BLEND), t_200.enable(t_200.DEPTH_TEST), t_200.depthFunc(t_200.LESS), t_200.depthMask(!0), this.drawHighlightedGeoms(e), this.__highlightedGeomsBufferFbo.unbindForWriting(e), t_200.viewport.apply(t_200, e.region), this.__outlineShader.bind(e), t_200.enable(t_200.BLEND), t_200.blendEquation(t_200.FUNC_ADD), t_200.blendFunc(t_200.SRC_ALPHA, t_200.ONE_MINUS_SRC_ALPHA);
        var a_189 = e.unifs;
        this.__highlightedGeomsBuffer.bindToUniform(e, a_189.highlightDataTexture), t_200.uniform2f(a_189.highlightDataTextureSize.location, e.region[2], e.region[3]), this.quad.bindAndDraw(e), t_200.disable(t_200.BLEND);
    } this.redrawOccured.emit(); };
    return Ui;
}(/** @class */ (function () {
    function class_7(e, a) {
        var _this = this;
        if (a === void 0) { a = {}; }
        if (t.gpuDesc) {
            this.__shaders = {}, this.__passes = {}, this.__passCallbacks = [], this.addTreeItem = this.addTreeItem.bind(this), this.removeTreeItem = this.removeTreeItem.bind(this), this.__viewports = [], this.__activeViewport = void 0, this.__continuousDrawing = !1, this.__redrawRequested = !1, this.__isMobile = t.isMobileDevice, this.__drawSuspensionLevel = 1, this.__shaderDirectives = {}, this.__preproc = {}, this.__xrViewportPresenting = !1, this.renderGeomDataFbos = this.renderGeomDataFbos.bind(this), this.requestRedraw = this.requestRedraw.bind(this), this.resized = new C, this.keyPressed = new C, this.sceneSet = new C(!0), this.vrViewportSetup = new C(!0), this.sessionClientSetup = new C(!0), this.viewChanged = new C, this.redrawOccured = new C, this.setupWebGL(e, a.webglOptions ? a.webglOptions : {}), this.bindEventHandlers();
            for (var e_203 in Yi)
                for (var _b = 0, _c = Yi[e_203]; _b < _c.length; _b++) {
                    var t_201 = _c[_b];
                    this.addPass(new t_201, e_203, !1);
                }
            this.addViewport("main"), this.__supportXR = void 0 === a.supportXR || a.supportXR, this.__xrViewport = void 0, this.__xrViewportPromise = new Promise(function (e, t) { if (_this.__supportXR && navigator.xr) {
                var t_202 = function () { _this.__gl.makeXRCompatible().then(function () { _this.__xrViewport = _this.__setupXRViewport(), _this.vrViewportSetup.emit(_this.__xrViewport), e(_this.__xrViewport); }); };
                navigator.xr.supportsSessionMode ? navigator.xr.supportsSessionMode("immersive-vr").then(t_202).catch(function (e) { console.warn("Unable to setup XR:" + e); }) : navigator.xr.isSessionSupported("immersive-vr").then(function (e) { e && t_202(); }).catch(function (e) { console.warn("Unable to setup XR:" + e); });
            } });
        }
        else
            console.warn("Unable to create renderer");
    }
    class_7.prototype.addShaderPreprocessorDirective = function (e, t) { this.__shaderDirectives[e] = t ? "#define " + e + " = " + t : "#define " + e; var a = []; for (var e_204 in this.__shaderDirectives)
        a.push(this.__shaderDirectives[e_204]); this.__preproc.defines = a.join("\n") + "\n", this.__gl.shaderopts = this.__preproc; };
    class_7.prototype.getShaderPreproc = function () { return this.__preproc; };
    class_7.prototype.getWidth = function () { return this.__glcanvas.width; };
    class_7.prototype.getHeight = function () { return this.__glcanvas.height; };
    class_7.prototype.addViewport = function (e) {
        var _this = this;
        var t = new Wi(this, e, this.getWidth(), this.getHeight());
        return t.updated.connect(function () { _this.requestRedraw(); }), t.createGeomDataFbo(this.__floatGeomBuffer), t.viewChanged.connect(function (e) { _this.__xrViewportPresenting || _this.viewChanged.emit(e); }), this.__viewports.push(t), t;
    };
    class_7.prototype.getViewport = function (e) {
        if (e === void 0) { e = 0; }
        return this.__viewports[e];
    };
    class_7.prototype.getViewportAtPos = function (e, t) { for (var _b = 0, _c = this.__viewports; _b < _c.length; _b++) {
        var a_190 = _c[_b];
        var i_135 = a_190.getPosX(), s = a_190.getPosY(), n = a_190.getWidth(), l = a_190.getHeight();
        if (e >= i_135 && t >= s && e <= n + i_135 && t <= l + s)
            return a_190;
    } };
    class_7.prototype.activateViewport = function (e) { this.__activeViewport != e && (this.__activeViewport = e); };
    class_7.prototype.activateViewportAtPos = function (e, t) { if (this.__xrViewportPresenting)
        return; var a = this.getViewportAtPos(e, t); a && a != this.__activeViewport && this.activateViewport(a); };
    class_7.prototype.getActiveViewport = function () { return this.__xrViewportPresenting ? this.__xrViewport : this.__activeViewport; };
    class_7.prototype.suspendDrawing = function () { this.__drawSuspensionLevel++; };
    class_7.prototype.resumeDrawing = function () { this.__drawSuspensionLevel--, 0 == this.__drawSuspensionLevel && (this.__loadingImg && this.__glcanvasDiv.removeChild(this.__loadingImg), this.renderGeomDataFbos(), this.requestRedraw()); };
    class_7.prototype.renderGeomDataFbos = function () {
        var _this = this;
        if (1 == this.__renderGeomDataFbosRequested)
            return;
        this.__renderGeomDataFbosRequested = !0;
        window.requestAnimationFrame(function () { for (var _b = 0, _c = _this.__viewports; _b < _c.length; _b++) {
            var e_205 = _c[_b];
            e_205.renderGeomDataFbo();
        } _this.__renderGeomDataFbosRequested = !1; });
    };
    class_7.prototype.setupGrid = function (e, t, a, i) { return console.warn("Deprecated Method. Please use scene.setupGrid"), this.__scene.setupGrid(e, a, t); };
    class_7.prototype.getScene = function () { return this.__scene; };
    class_7.prototype.setScene = function (e) { this.__scene = e, this.addTreeItem(this.__scene.getRoot()), this.__gizmoContext && this.__gizmoContext.setSelectionManager(e.getSelectionManager()), this.sceneSet.emit(this.__scene); };
    class_7.prototype.addTreeItem = function (e) { if (e instanceof ra) {
        for (var _b = 0, _c = this.__passCallbacks; _b < _c.length; _b++) {
            var t_203 = _c[_b];
            var a_191 = { continueInSubTree: !0 };
            if (t_203.itemAddedFn(e, a_191)) {
                if (!a_191.continueInSubTree)
                    return;
                break;
            }
        }
        for (var _d = 0, _f = e.getChildren(); _d < _f.length; _d++) {
            var t_204 = _f[_d];
            t_204 && this.addTreeItem(t_204);
        }
        e.childAdded.connect(this.addTreeItem), e.childRemoved.connect(this.removeTreeItem), this.renderGeomDataFbos();
    } };
    class_7.prototype.removeTreeItem = function (e) { if (e instanceof ra) {
        e.childAdded.disconnect(this.addTreeItem), e.childRemoved.disconnect(this.removeTreeItem);
        for (var _b = 0, _c = this.__passCallbacks; _b < _c.length; _b++) {
            var t_205 = _c[_b];
            if (!t_205.itemRemovedFn)
                continue;
            var a_192 = { continueInSubTree: !0 };
            if (t_205.itemRemovedFn(e, a_192)) {
                if (!a_192.continueInSubTree)
                    return;
                break;
            }
        }
        for (var _d = 0, _f = e.getChildren(); _d < _f.length; _d++) {
            var t_206 = _f[_d];
            t_206 && this.removeTreeItem(t_206);
        }
        this.renderGeomDataFbos();
    } };
    Object.defineProperty(class_7.prototype, "gl", {
        get: function () { return this.__gl; },
        enumerable: true,
        configurable: true
    });
    class_7.prototype.getGL = function () { return this.__gl; };
    class_7.prototype.resizeFbos = function (e, t) { };
    class_7.prototype.__onResize = function () { if (!this.__xrViewportPresenting) {
        var e_206 = 1;
        this.__glcanvas.width = this.__glcanvas.clientWidth * e_206, this.__glcanvas.height = this.__glcanvas.clientHeight * e_206;
        for (var _b = 0, _c = this.__viewports; _b < _c.length; _b++) {
            var e_207 = _c[_b];
            e_207.resize(this.__glcanvas.width, this.__glcanvas.height);
        }
        this.resizeFbos(this.__glcanvas.width, this.__glcanvas.height), this.resized.emit(this.__glcanvas.width, this.__glcanvas.height), this.requestRedraw();
    } };
    class_7.prototype.getDiv = function () { return this.__glcanvasDiv; };
    class_7.prototype.setupWebGL = function (a, i) {
        var _this = this;
        this.__glcanvas = document.createElement("canvas"), this.__glcanvas.style.position = i.canvasPosition ? i.canvasPosition : "absolute", this.__glcanvas.style.left = "0px", this.__glcanvas.style.top = "0px", this.__glcanvas.style.width = "100%", this.__glcanvas.style.height = "100%", this.__glcanvasDiv = a, this.__glcanvasDiv.appendChild(this.__glcanvas), e(this.__glcanvas, function (e) { _this.__onResize(); }), this.__onResize(), i.preserveDrawingBuffer = !0, i.stencil = !!i.stencil && i.stencil, i.alpha = !!i.alpha && i.alpha, i.xrCompatible = !0, this.__gl = za(this.__glcanvas, i), this.__gl || alert("Unable to create WebGL context. WebGL not supported."), this.__gl.renderer = this, "webgl2" == this.__gl.name && this.addShaderPreprocessorDirective("ENABLE_ES3"), this.__gl.floatTexturesSupported && this.addShaderPreprocessorDirective("ENABLE_FLOAT_TEXTURES"), this.__gl.screenQuad = new xi(this.__gl), this.__screenQuad = this.__gl.screenQuad, this.__floatGeomBuffer = this.__gl.floatTexturesSupported && "Safari" != t.browserName, this.__gl.floatGeomBuffer = this.__floatGeomBuffer;
    };
    class_7.prototype.bindEventHandlers = function () {
        var _this = this;
        var e = function () { return _this.__glcanvas.width > 0 && _this.__glcanvas.height; }, t = function (e) { var t = _this.__glcanvas.getBoundingClientRect(); e.rendererX = 1 * (e.clientX - t.left), e.rendererY = 1 * (e.clientY - t.top); };
        this.__glcanvas.addEventListener("mouseenter", function (e) { e.stopPropagation(), e.undoRedoManager = _this.undoRedoManager, Ti || (Fi = _this, t(e), Fi.activateViewportAtPos(e.rendererX, e.rendererY), Ci = !1); }), this.__glcanvas.addEventListener("mouseleave", function (t) { if (Fi == _this && e())
            if (t.stopPropagation(), t.undoRedoManager = _this.undoRedoManager, Ti)
                Ci = !0;
            else {
                var e_208 = Fi.getActiveViewport();
                e_208 && (e_208.onMouseLeave(t), t.preventDefault()), Fi = void 0;
            } }), this.__glcanvas.addEventListener("mousedown", function (e) { e.stopPropagation(), e.undoRedoManager = _this.undoRedoManager, t(e), Ti = !0, Fi = _this, Fi.activateViewportAtPos(e.rendererX, e.rendererY); var a = Fi.getActiveViewport(); return a && a.onMouseDown(e), Ci = !1, !1; }), document.addEventListener("mouseup", function (a) { if (Fi != _this || !e())
            return; a.stopPropagation(), a.undoRedoManager = _this.undoRedoManager, t(a), Ti = !1; var i = Fi.getActiveViewport(); if (i && i.onMouseUp(a), Ci) {
            var e_209 = Fi.getActiveViewport();
            e_209 && (e_209.onMouseLeave(a), a.preventDefault()), Fi = void 0;
        } return !1; }), document.addEventListener("mousemove", function (a) { if (Fi != _this || !e())
            return; a.preventDefault(), a.stopPropagation(), a.undoRedoManager = _this.undoRedoManager, t(a), Ti || Fi.activateViewportAtPos(a.rendererX, a.rendererY); var i = Fi.getActiveViewport(); return i && i.onMouseMove(a), !1; });
        var a = function (t) { if (Fi == _this && e())
            return Fi && (t.stopPropagation(), t.undoRedoManager = _this.undoRedoManager, window.addEventListener || t.preventDefault(), _this.onWheel(t)), !1; };
        window.addEventListener ? window.addEventListener("wheel", a, { passive: !0 }) : window.onmousewheel = document.onmousewheel = a, window.oncontextmenu = function () { return !1; }, document.addEventListener("keypress", function (t) { if (Fi != _this || !e())
            return; var a = String.fromCharCode(t.keyCode).toLowerCase(), i = Fi.getActiveViewport(); i && i.onKeyPressed(a, t); }), document.addEventListener("keydown", function (t) { if (Fi != _this || !e())
            return; var a = String.fromCharCode(t.keyCode).toLowerCase(), i = Fi.getActiveViewport(); i && i.onKeyDown(a, t); }), document.addEventListener("keyup", function (t) { if (Fi != _this || !e())
            return; var a = String.fromCharCode(t.keyCode).toLowerCase(), i = Fi.getActiveViewport(); i && i.onKeyUp(a, t); }), this.__glcanvas.addEventListener("touchstart", function (e) { e.stopPropagation(), e.undoRedoManager = _this.undoRedoManager; for (var a_193 = 0; a_193 < e.touches.length; a_193++)
            t(e.touches[a_193]); _this.getViewport().onTouchStart(e); }, !1), this.__glcanvas.addEventListener("touchmove", function (e) { e.stopPropagation(), e.undoRedoManager = _this.undoRedoManager; for (var a_194 = 0; a_194 < e.touches.length; a_194++)
            t(e.touches[a_194]); _this.getViewport().onTouchMove(e); }, !1), this.__glcanvas.addEventListener("touchend", function (e) { e.stopPropagation(), e.undoRedoManager = _this.undoRedoManager; for (var a_195 = 0; a_195 < e.touches.length; a_195++)
            t(e.touches[a_195]); _this.getViewport().onTouchEnd(e); }, !1), this.__glcanvas.addEventListener("touchcancel", function (e) { e.stopPropagation(), e.undoRedoManager = _this.undoRedoManager, _this.getViewport().onTouchCancel(e); }, !1);
    };
    class_7.prototype.setUndoRedoManager = function (e) { this.undoRedoManager = e; };
    class_7.prototype.getGLCanvas = function () { return this.__glcanvas; };
    class_7.prototype.getScreenQuad = function () { return this.__screenQuad; };
    class_7.prototype.onWheel = function (e) { this.__viewports[0].onWheel(e); };
    class_7.prototype.frameAll = function (e) {
        if (e === void 0) { e = 0; }
        this.__viewports[e].frameView([this.__scene.getRoot()]);
    };
    class_7.prototype.getOrCreateShader = function (e) { var t = this.__shaders[e]; return t || (t = J.constructClass(e, this.__gl), t || console.error("Shader not registered with the SGFactory:", e), this.__shaders[e] = t), t; };
    class_7.prototype.addPass = function (e, t, a) {
        if (t === void 0) { t = 0; }
        if (a === void 0) { a = !0; }
        this.__passes[t] || (this.__passes[t] = []);
        var i = 0;
        for (var e_210 in this.__passes) {
            if (e_210 == t)
                break;
            i += this.__passes[e_210].length;
        }
        if (i += this.__passes[t].length, e.updated.connect(this.requestRedraw.bind(this)), e.init(this, i), this.__passes[t].push(e), a) {
            var e_211 = 0;
            for (var t_207 in this.__passes) {
                var a_196 = this.__passes[t_207];
                a_196.forEach(function (t, a) { t.setPassIndex(e_211 + a); }), e_211 += a_196.length;
            }
        }
        return this.requestRedraw(), i;
    };
    class_7.prototype.registerPass = function (e, t) { this.__passCallbacks.splice(0, 0, { itemAddedFn: e, itemRemovedFn: t }); };
    class_7.prototype.getPass = function (e) { var t = 0; for (var a_197 in this.__passes) {
        var i_136 = this.__passes[a_197];
        if (e - t < i_136.length)
            return i_136[e - t];
        t += i_136.length;
    } };
    class_7.prototype.findPass = function (e) { for (var t_208 in this.__passes) {
        var a_199 = this.__passes[t_208];
        for (var _b = 0, a_198 = a_199; _b < a_198.length; _b++) {
            var t_209 = a_198[_b];
            if (t_209.constructor == e)
                return t_209;
        }
    } };
    class_7.prototype.getGizmoPass = function () { return this.__gizmoPass; };
    class_7.prototype.supportsVR = function () { return console.warn("Deprecated Method. Please instead connect to the vrViewportSetup signal."), this.__supportXR && null != navigator.xr; };
    class_7.prototype.__setupXRViewport = function () {
        var _this = this;
        var e = new Mi(this);
        return e.presentingChanged.connect(function (t) { if (_this.__xrViewportPresenting = t, t) {
            for (var e_212 in _this.__passes) {
                var t_212 = _this.__passes[e_212];
                for (var _b = 0, t_210 = t_212; _b < t_210.length; _b++) {
                    var e_213 = t_210[_b];
                    e_213.startPresenting();
                }
            }
            e.viewChanged.connect(_this.viewChanged.emit);
        }
        else {
            e.viewChanged.disconnect(_this.viewChanged.emit);
            for (var e_214 in _this.__passes) {
                var t_213 = _this.__passes[e_214];
                for (var _c = 0, t_211 = t_213; _c < t_211.length; _c++) {
                    var e_215 = t_211[_c];
                    e_215.stopPresenting();
                }
            }
            _this.viewChanged.emit({ interfaceType: "CameraAndPointer", viewXfo: _this.getViewport().getCamera().getGlobalXfo() }), _this.resizeFbos(_this.__glcanvas.width, _this.__glcanvas.height), _this.requestRedraw();
        } }), e;
    };
    class_7.prototype.getVRViewport = function () { return this.__xrViewport; };
    class_7.prototype.getXRViewport = function () { return this.__xrViewportPromise; };
    class_7.prototype.isXRViewportPresenting = function () { return this.__xrViewportPresenting; };
    class_7.prototype.isContinuouslyDrawing = function () { return this.__continuousDrawing; };
    class_7.prototype.startContinuousDrawing = function () {
        var _this = this;
        if (this.isContinuouslyDrawing() || this.__xrViewportPresenting)
            return;
        var e = function () { _this.__continuousDrawing && !_this.__xrViewportPresenting && window.requestAnimationFrame(e); for (var _b = 0, _c = _this.__viewports; _b < _c.length; _b++) {
            var e_216 = _c[_b];
            e_216.draw();
        } };
        this.__continuousDrawing = !0, window.requestAnimationFrame(e);
    };
    class_7.prototype.stopContinuousDrawing = function () { this.__continuousDrawing = !1; };
    class_7.prototype.toggleContinuousDrawing = function () { this.__continuousDrawing ? this.stopContinuousDrawing() : this.startContinuousDrawing(); };
    class_7.prototype.drawItemChanged = function () { for (var _b = 0, _c = this.__viewports; _b < _c.length; _b++) {
        var e_217 = _c[_b];
        e_217.invalidateGeomDataBuffer();
    } this.requestRedraw(); };
    class_7.prototype.requestRedraw = function () {
        var _this = this;
        if (this.__redrawRequested || this.__continuousDrawing || this.__xrViewportPresenting)
            return !1;
        return window.requestAnimationFrame(function () { _this.__redrawRequested = !1; for (var _b = 0, _c = _this.__viewports; _b < _c.length; _b++) {
            var e_218 = _c[_b];
            e_218.draw();
        } }), this.__redrawRequested = !0, !0;
    };
    class_7.prototype.bindGLBaseRenderer = function (e) { e.shaderopts = this.__preproc; var t = this.__gl; e.viewports && 1 != e.viewports.length ? (e.bindRendererUnifs = function (a) { var i = a.cameraMatrix; i && t.uniformMatrix4fv(i.location, !1, e.cameraMatrix.asArray()); }, e.bindViewports = function (a, i) { e.viewports.forEach(function (e, s) { t.viewport.apply(t, e.region); var n = a.viewMatrix, l = a.projectionMatrix, r = a.eye; n && t.uniformMatrix4fv(n.location, !1, e.viewMatrix.asArray()), l && t.uniformMatrix4fv(l.location, !1, e.projectionMatrix.asArray()), r && t.uniform1i(r.location, s), i(); }); }) : (e.bindRendererUnifs = function (a) { var i = a.cameraMatrix, s = a.viewMatrix, n = a.projectionMatrix, l = a.eye; i && t.uniformMatrix4fv(i.location, !1, e.cameraMatrix.asArray()); var r = e.viewports[0]; s && t.uniformMatrix4fv(s.location, !1, r.viewMatrix.asArray()), n && t.uniformMatrix4fv(n.location, !1, r.projectionMatrix.asArray()), l && t.uniform1i(l.location, index); }, e.bindViewports = function (e, t) { return t(); }); };
    class_7.prototype.drawScene = function (e) { for (var t_214 in this.__passes) {
        var a_201 = this.__passes[t_214];
        for (var _b = 0, a_200 = a_201; _b < a_200.length; _b++) {
            var t_215 = a_200[_b];
            t_215.enabled && t_215.draw(e);
        }
    } };
    class_7.prototype.drawHighlightedGeoms = function (e) { this.bindGLBaseRenderer(e); for (var t_216 in this.__passes) {
        var a_203 = this.__passes[t_216];
        for (var _b = 0, a_202 = a_203; _b < a_202.length; _b++) {
            var t_217 = a_202[_b];
            t_217.enabled && t_217.drawHighlightedGeoms(e);
        }
    } };
    class_7.prototype.drawSceneGeomData = function (e, t) {
        if (t === void 0) { t = 255; }
        this.bindGLBaseRenderer(e);
        for (var a_204 in this.__passes) {
            if (0 == (Number.parseInt(a_204) & t))
                continue;
            var i_138 = this.__passes[a_204];
            for (var _b = 0, i_137 = i_138; _b < i_137.length; _b++) {
                var t_218 = i_137[_b];
                t_218.enabled && t_218.drawGeomData(e);
            }
        }
    };
    class_7.registerPass = function (e, t) { Yi[t] || (Yi[t] = []), Yi[t].push(e); };
    return class_7;
}())));
Qa.setShaderModule("drawItemId.glsl", "\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nattribute float instancedIds;    // instanced attribute..\nuniform int instancedDraw;\nuniform int transformIndex;\n\nint getDrawItemId() {\n    if(instancedDraw == 0){\n       return transformIndex;\n    }\n    else{\n       return int(instancedIds);\n    }\n}\n\n\n#else\n\nuniform int transformIndex;\n\nint getDrawItemId() {\n    return transformIndex;\n}\n\n#endif\n\n"), Qa.setShaderModule("drawItemTexture.glsl", '\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nuniform sampler2D instancesTexture;\nuniform highp int instancesTextureSize;\n\n<%include file="GLSLUtils.glsl"/>\n\nconst int pixelsPerItem = 6;\n\nvec4 getInstanceData(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 0);\n}\n\n#else\n\nuniform vec4 drawItemData;\n\nvec4 getInstanceData(int id) {\n    return drawItemData;\n}\n\n#endif\n\n\n'), Qa.setShaderModule("modelMatrix.glsl", "\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n    // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\n    vec4 col0 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 1);\n    vec4 col1 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 2);\n    vec4 col2 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 3);\n    mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\n    return transpose(result);\n    // return mat4(1.0);\n}\n\nmat4 getModelMatrix(int id) {\n    return getMatrix(instancesTexture, instancesTextureSize, id);\n}\n\n#else\n\nuniform mat4 modelMatrix;\n\nmat4 getModelMatrix(int id) {\n    return modelMatrix;\n}\n\n#endif\n\n\n"), Qa.setShaderModule("materialparams.glsl", "\n\n////////////////////////\n// Material Param Helpers.\n\nvec4 getColorParamValue(vec4 value, sampler2D tex, int texType, vec2 texCoord) {\n    if(texType == 0){\n        return toLinear(value);\n    }\n    else if(texType == 1 || texType == 2){\n        // TODO: Use SRGB textures.\n        return toLinear(texture2D(tex, texCoord));\n    }\n    else if(texType == 3){\n        // Float HDR Texture\n        return texture2D(tex, texCoord);\n    }\n    else\n        return value;\n}\n\n\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\nfloat getLuminanceParamValue(float value, sampler2D tex, int texType, vec2 texCoord) {\n    if(texType == 0)\n        return value;\n    else\n        return luminanceFromRGB(texture2D(tex, texCoord).rgb);\n}\n"), Qa.setShaderModule("debugColors.glsl", "\n\nfloat modI(float a, float b) {\n    float m=a-floor((a+0.5)/b)*b;\n    return floor(m+0.5);\n}\n\nvec3 getDebugColor(float id) {\n#ifdef GLSL_ES3\n    const vec3 clusterColors[4] = vec3[4]( vec3(0.0, 0.25, 0.25), vec3(0.0, 0.85, 0.25), vec3(0.0, 0.25, 0.85), vec3(0.0, 0.85, 0.85) );\n#else\n    vec3 clusterColors[8];\n    clusterColors[0] = vec3(0.0, 0.15, 0.15);\n    clusterColors[1] = vec3(0.0, 0.85, 0.15);\n    clusterColors[2] = vec3(0.0, 0.15, 0.85);\n    clusterColors[3] = vec3(0.0, 0.85, 0.85);\n    clusterColors[4] = vec3(0.75, 0.15, 0.15);\n    clusterColors[5] = vec3(0.75, 0.85, 0.15);\n    clusterColors[6] = vec3(0.75, 0.15, 0.85);\n    clusterColors[7] = vec3(0.75, 0.85, 0.85);\n#endif\n\n    if(modI(id, 8.0) == 0.0)\n        return clusterColors[0];\n    else if(modI(id, 8.0) == 1.0)\n        return clusterColors[1];\n    else if(modI(id, 8.0) == 2.0)\n        return clusterColors[2];\n    else if(modI(id, 8.0) == 3.0)\n        return clusterColors[3];\n    else if(modI(id, 8.0) == 4.0)\n        return clusterColors[4];\n    else if(modI(id, 8.0) == 5.0)\n        return clusterColors[5];\n    else if(modI(id, 8.0) == 6.0)\n        return clusterColors[6];\n    else if(modI(id, 8.0) == 7.0)\n        return clusterColors[7];\n\n    return vec3(1,0,0);\n}\n\n\n");
var Ji = /** @class */ (function (_super) {
    __extends(Ji, _super);
    function Ji(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("BillboardShader.vertexShader", '\nprecision highp float;\n\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 cameraMatrix;\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\ninstancedattribute float instanceIds;\n\n<%include file="GLSLUtils.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="utils/imageAtlas.glsl"/>\n\nuniform sampler2D atlasBillboards_layout;\nuniform vec4 atlasBillboards_desc;\n\nuniform sampler2D instancesTexture;\nuniform int instancesTextureSize;\n\n\nconst int cols_per_instance = 5;\n\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n  // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\n  vec4 col0 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 0);\n  vec4 col1 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 1);\n  vec4 col2 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 2);\n  mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\n  return transpose(result);\n  // return mat4(1.0);\n}\n\nmat4 getModelMatrix(int id) {\n  return getMatrix(instancesTexture, instancesTextureSize, id);\n}\nvec4 getInstanceData(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 3);\n}\nvec4 getTintColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 4);\n}\n\n\n#else\n\nuniform vec4 atlasBillboards_desc;\n\nuniform mat4 modelMatrix;\nuniform vec4 billboardData;\nuniform vec4 tintColor;\nuniform vec4 layoutData;\n\n\n#endif\n\nmat4 calcLookAtMatrix(vec3 origin, vec3 target, float roll) {\n  // vec3 rr = vec3(sin(roll), 0.0, cos(roll));\n  vec3 rr = vec3(0.0, 0.0, 1.0);\n  vec3 ww = normalize(target - origin);\n  vec3 uu = normalize(cross(rr, ww));\n  vec3 vv = normalize(cross(ww, uu));\n\n  return mat4(vec4(uu, 0.0), vec4(vv, 0.0), vec4(ww, 0.0), vec4(origin, 1.0));\n}\n\nfloat map(float value, float inMin, float inMax, float outMin, float outMax) {\n  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);\n}\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\n\nvoid main(void) {\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\n  int instanceID = int(instanceIds);\n\n  mat4 modelMatrix = getModelMatrix(instanceID);\n  vec4 billboardData = getInstanceData(instanceID);\n  vec4 layoutData = fetchTexel(atlasBillboards_layout, int(atlasBillboards_desc.z), int(billboardData.z));\n  v_tint = getTintColor(instanceID);\n\n#else\n\n  v_tint = tintColor;\n\n#endif\n\n  vec2 quadVertex = getQuadVertexPositionFromID();\n\n\n  v_texCoord = vec2(quadVertex.x, -quadVertex.y) + 0.5;\n  v_alpha = billboardData.w;\n  v_texCoord *= layoutData.zw;\n  v_texCoord += layoutData.xy;\n\n  float scl = billboardData.x;\n  float width = layoutData.z * atlasBillboards_desc.x * scl * 0.002;\n  float height = layoutData.w * atlasBillboards_desc.y * scl * 0.002;\n  int flags = int(billboardData.y);\n  bool alignedToCamera = flags > 0;\n  if(alignedToCamera){\n    vec3 cameraPos = vec3(cameraMatrix[3][0], cameraMatrix[3][1], cameraMatrix[3][2]);\n    vec3 billboardPos = vec3(modelMatrix[3][0], modelMatrix[3][1], modelMatrix[3][2]);\n    mat4 lookAt = calcLookAtMatrix(billboardPos, cameraPos, 0.0);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * lookAt;\n    gl_Position = modelViewProjectionMatrix * vec4(quadVertex.x * width, (quadVertex.y + 0.5) * height, 0.0, 1.0);\n  }\n  else{\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(quadVertex.x * width, (quadVertex.y + 0.5) * height, 0.0, 1.0);\n  }\n\n  bool overlay = flags > 0;\n  if(overlay){\n    gl_Position.z -= 0.05;\n  }\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("BillboardShader.fragmentShader", '\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="materialparams.glsl"/>\n<%include file="utils/imageAtlas.glsl"/>\n\nuniform sampler2D atlasBillboards;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\n\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = texture2D(atlasBillboards, v_texCoord) * v_tint;\n  fragColor.a *= v_alpha;\n\n  // fragColor.r = 1.0;\n  // fragColor.a = 1.0;\n  \n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');
        return _this;
    }
    return Ji;
}(Aa));
var Pi = /** @class */ (function (_super) {
    __extends(Pi, _super);
    function Pi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("DepthMapShader.vertexShader", "\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 modelMatrix;\nuniform mat4 lightViewMatrix;\nuniform mat4 lightProjectionMatrix;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n\nvoid main(void) {\n  mat4 modelViewMatrix = lightViewMatrix * modelMatrix;\n  v_viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = lightProjectionMatrix * v_viewPos;\n}\n\n"), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("DepthMapShader.fragmentShader", "\n#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\nuniform float near;\nuniform float far;\n\nvarying vec3 v_viewPos;\n\nfloat linstep(float edge0, float edge1, float value){\n  return clamp((value-edge0)/(edge1-edge0), 0.0, 1.0);\n}\n\nvoid main(void) {\n  float depth = linstep(near, far, -v_viewPos.z);\n  //gl_FragColor = vec4(depth, depth, depth,  1.0);\n\n  float dx = dFdx(depth);\n  float dy = dFdy(depth);\n  gl_FragColor = vec4(depth, pow(depth, 2.0) + 0.25*(dx*dx + dy*dy), 0.0, 1.0);\n}\n");
        return _this;
    }
    return Pi;
}(Aa));
var Ei = /** @class */ (function (_super) {
    __extends(Ei, _super);
    function Ei(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("EnvProjectionShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 projectionCenter;\n\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n \nvoid main()\n{\n  int drawItemId = getDrawItemId();\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n\n  gl_Position = modelViewProjectionMatrix * pos;\n\n  vec4 worldPos = modelMatrix * pos;\n  v_worldDir = worldPos.xyz - projectionCenter;\n}\n\n'), _this.finalize();
        return _this;
    }
    Ei.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "projectionCenter", defaultValue: new Z(0, 0, 1.7) }), e; };
    return Ei;
}(Aa));
var Hi = /** @class */ (function (_super) {
    __extends(Hi, _super);
    function Hi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("OctahedralEnvProjectionShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = dirToSphOctUv(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    return Hi;
}(Ei));
J.registerClass("OctahedralEnvProjectionShader", Hi);
var ki = /** @class */ (function (_super) {
    __extends(ki, _super);
    function ki(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("LatLongEnvProjectionShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = latLongUVsFromDir(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    return ki;
}(Ei));
J.registerClass("LatLongEnvProjectionShader", ki);
var Bi = /** @class */ (function (_super) {
    __extends(Bi, _super);
    function Bi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("FatLinesShader.vertexShader", '\nprecision highp float;\n\ninstancedattribute vec2 segmentIndices;\nattribute float vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nuniform sampler2D positionsTexture;\nuniform int positionsTextureSize;\n\nuniform float LineThickness;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  int vertexID = int(vertexIDs);\n\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  int seqentialIndex_0 = int(mod(segmentIndices.x, 2.));\n  int seqentialIndex_1 = int(mod(segmentIndices.y, 2.));\n  int index_0 = int(segmentIndices.x) / 2;\n  int index_1 = int(segmentIndices.y) / 2;\n\n  vec3 viewPos;\n  vec4 data_0 = fetchTexel(positionsTexture, positionsTextureSize, index_0);\n  vec4 data_1 = fetchTexel(positionsTexture, positionsTextureSize, index_1);\n\n  vec4 pos_0 = modelViewMatrix * vec4(data_0.xyz, 1.0);\n  vec4 pos_1 = modelViewMatrix * vec4(data_1.xyz, 1.0);\n  // Note: multiply the per-vertex line thickness with the line thickness uniform value;\n  float lineThickness_0 = LineThickness * data_0.w;\n  float lineThickness_1 = LineThickness * data_1.w;\n\n  if(vertexID < 2){\n    viewPos = pos_0.xyz;\n  }\n  else{\n    viewPos = pos_1.xyz;\n  }\n  if(pos_1 != pos_0){\n    vec3 segmentDir = normalize(pos_1.xyz - pos_0.xyz);\n    vec3 viewVector = normalize(viewPos);\n\n    if(vertexID < 2){\n      vec3 segmentStartDir = segmentDir;\n      if(seqentialIndex_0 != 0){\n        //if index_0 == 0, get the last index in the line as previous\n        int index_prev = (index_0 > 0) ? (index_0-1) : (positionsTextureSize-1);\n        vec4 data_prev = fetchTexel(positionsTexture, positionsTextureSize, index_prev);\n        vec4 pos_prev = modelViewMatrix * vec4(data_prev.xyz, 1.0);\n        segmentStartDir = normalize(segmentDir + normalize(pos_0.xyz - pos_prev.xyz));\n      }\n      vec3 startBiTangent = normalize(cross(segmentStartDir, viewVector));\n      v_viewNormal = normalize(cross(segmentStartDir, startBiTangent));\n      // Move the endpoints to overlap a bit more.\n      //viewPos -= vec3(segmentStartDir * lineThickness_0 * 0.25);\n      if(mod(vertexIDs, 2.0) == 0.0){\n        viewPos += vec3(startBiTangent * lineThickness_0);\n        v_texCoord.x = 1.0;\n      }\n      else{\n        viewPos -= vec3(startBiTangent * lineThickness_0);\n        v_texCoord.x = 0.0;\n      }\n      v_texCoord.y = 0.0;\n    }\n    else{\n      vec3 segmentEndDir = segmentDir;\n      if(seqentialIndex_1 != 0){\n        //if index_1 == numPoints-1, get the first index in the line as next\n        int index_next = (index_1 < (positionsTextureSize-1)) ? (index_1+1) : 0;\n        vec4 data_next = fetchTexel(positionsTexture, positionsTextureSize, index_next);\n        vec4 pos_next = modelViewMatrix * vec4(data_next.xyz, 1.0);\n        segmentEndDir = normalize(segmentDir + normalize(pos_next.xyz - pos_1.xyz));\n      }\n      vec3 endBiTangent = normalize(cross(segmentEndDir, viewVector));\n      v_viewNormal = normalize(cross(segmentEndDir, endBiTangent));\n      // Move the endpoints to overlap a bit more.\n      //viewPos += vec3(segmentEndDir * lineThickness_1 * 0.25);\n      if(mod(vertexIDs, 2.0) == 0.0){\n        viewPos += vec3(endBiTangent * lineThickness_1);\n        v_texCoord.x = 1.0;\n      }\n      else{\n        viewPos -= vec3(endBiTangent * lineThickness_1);\n        v_texCoord.x = 0.0;\n      }\n      v_texCoord.y = 1.0;\n    }\n\n    // Move the line towards the viewer by the line thickness.\n    // this is to avoid depth issues when lines are rendered over meshes. \n    viewPos.z -= (lineThickness_0 + lineThickness_1) * 0.25;\n  }\n\n  v_viewPos       = viewPos;\n  gl_Position     = projectionMatrix * vec4(viewPos, 1.0);\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("FatLinesShader.fragmentShader", "\nprecision highp float;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\n\nuniform color BaseColor;\nuniform mat4 cameraMatrix;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int debugLevel = 0;\n  if(debugLevel == 0){\n\n    vec3 viewVector = mat3(cameraMatrix) * normalize(-v_viewPos);\n    vec3 normal = mat3(cameraMatrix) * v_viewNormal;\n    float NdotV = dot(normalize(normal), normalize(viewVector));\n\n    // Modulate the lighting using the texture coord so the line looks round.\n    NdotV *= cos((v_texCoord.x - 0.5) * 2.0);\n\n    vec4 color = BaseColor * NdotV;\n    fragColor = vec4(color.rgb, BaseColor.a);\n  }\n  else{\n    fragColor = vec4(v_texCoord.x, 0.0, 0.0, 1.0);\n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n"), _this.finalize();
        return _this;
    }
    Bi.prototype.bind = function (e) { return !!_super.prototype.bind.call(this, e) && (e.supportsInstancing = !1, !0); };
    Bi.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e.push({ name: "Opacity", defaultValue: 1 }), e; };
    return Bi;
}(Aa));
J.registerClass("FatLinesShader", Bi), Qa.setShaderModule("stack-gl/gamma.glsl", "\n\nconst float gamma_const = 2.2;\n\nfloat toLinear(float v) {\n  return pow(v, gamma_const);\n}\n\nvec2 toLinear(vec2 v) {\n  return pow(v, vec2(gamma_const));\n}\n\nvec3 toLinear(vec3 v) {\n  return pow(v, vec3(gamma_const));\n}\n\nvec4 toLinear(vec4 v) {\n  return vec4(toLinear(v.rgb), v.a);\n}\n\n\nfloat toGamma(float v) {\n  return pow(v, 1.0 / gamma_const);\n}\n\nvec2 toGamma(vec2 v) {\n  return pow(v, vec2(1.0 / gamma_const));\n}\n\nvec3 toGamma(vec3 v) {\n  return pow(v, vec3(1.0 / gamma_const));\n}\n\nvec4 toGamma(vec4 v) {\n  return vec4(toGamma(v.rgb), v.a);\n}\n\nfloat toGamma(float v, float gamma) {\n  return pow(v, 1.0 / gamma);\n}\n\nvec2 toGamma(vec2 v, float gamma) {\n  return pow(v, vec2(1.0 / gamma));\n}\n\nvec3 toGamma(vec3 v, float gamma) {\n  return pow(v, vec3(1.0 / gamma));\n}\n\nvec4 toGamma(vec4 v, float gamma) {\n  return vec4(toGamma(v.rgb, gamma), v.a);\n}\n\n\n");
var Di = /** @class */ (function (_super) {
    __extends(Di, _super);
    function Di(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("FlatSurfaceShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n    vec4 viewPos = (modelViewMatrix * vec4(positions, 1.0));\n    gl_Position = projectionMatrix * viewPos;\n\n    v_viewPos = viewPos.xyz;\n    v_textureCoord = texCoords;\n    v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("FlatSurfaceShader.fragmentShader", '\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    Di.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e; };
    Di.getGeomDataShaderName = function () { return "StandardSurfaceGeomDataShader"; };
    Di.getSelectedShaderName = function () { return "StandardSurfaceSelectedGeomsShader"; };
    return Di;
}(Aa));
J.registerClass("FlatSurfaceShader", Di);
var Oi = /** @class */ (function (_super) {
    __extends(Oi, _super);
    function Oi() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Oi.isTransparent = function () { return !0; };
    Oi.prototype.bind = function (e, t) { return "ADD" == e.pass && _super.prototype.bind.call(this, e, t); };
    return Oi;
}(Di));
J.registerClass("FlatAlphaSurfaceShader", Oi), Qa.setShaderModule("math/constants.glsl", "\n\n#define PI 3.141592653589793\n#define TwoPI (2.0 * PI)\n#define HalfPI (0.5 * PI)\n\n"), Qa.setShaderModule("GGX_Specular.glsl", '\n\n\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n\n// uniform ImageAtlas envMap;\n// see: GLImageAtlas.js: line 460.\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n\nvec3 sampleEnvMap(vec3 dir, float roughness) {\n    return sampleImagePyramid(dirToSphOctUv(dir), roughness, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc).rgb;\n}\n\n\n// Borrowed heavily from here: http://www.codinglabs.net/article_physically_based_rendering_cook_torrance.aspx\n\nvec3 Fresnel_Schlick(float cosT, vec3 F0)\n{\n    return F0 + (vec3(1.0)-F0) * vec3(pow( 1.0 - cosT, 5.0));\n\n    // for now we calculate this in the suface shader\n    // float schlick = reflectance + pow((1.0-reflectance)*(1.0-dot(N,V)), 5.0);\n}\n\nfloat chiGGX(float v)\n{\n    return v > 0.0 ? 1.0 : 0.0;\n}\n\nfloat saturate(float v)\n{\n    return clamp(v, 0.0, 1.0);\n}\n\nvec3 saturate(vec3 v)\n{\n    return clamp(v, vec3(0.0), vec3(1.0));\n}\n\nfloat saturatedDot( in vec3 a, in vec3 b )\n{\n    return max( dot( a, b ), 0.0 );   \n}\n\nfloat GGX_PartialGeometryTerm(vec3 v, vec3 n, vec3 h, float alpha)\n{\n    float VoH2 = saturate(dot(v,h));\n    float chi = chiGGX( VoH2 / saturate(dot(v,n)) );\n    VoH2 = VoH2 * VoH2;\n    float tan2 = ( 1.0 - VoH2 ) / VoH2;\n    return (chi * 2.0) / ( 1.0 + sqrt( 1.0 + alpha * alpha * tan2 ) );\n}\n\nvec3 GGX_Specular_PrefilteredEnv(vec3 normal, vec3 viewVector, float roughness, float fresnel)\n{\n    vec3 reflectionVector = reflect(-viewVector, normal);\n    vec3 radiance = vec3(0.0);\n    float NoV = saturate(dot(normal, viewVector));\n\n    vec3 sampleVector = reflectionVector;\n\n    // Calculate the half vector\n    vec3 halfVector = normalize(sampleVector + viewVector);\n    float cosT = saturatedDot(reflectionVector, normal);\n    float sinT = sqrt( 1.0 - cosT * cosT);\n\n    // Calculate fresnel\n    // vec3 fresnel = Fresnel_Schlick( saturate(dot( halfVector, viewVector ) ), F0 );\n    // Geometry term\n    float geometry = GGX_PartialGeometryTerm(viewVector, normal, halfVector, clamp(roughness, 0.01, 1.0)) * GGX_PartialGeometryTerm(reflectionVector, normal, halfVector, clamp(roughness, 0.01, 1.0));\n\n    // Calculate the Cook-Torrance denominator\n    float denominator = clamp( 4.0 * (NoV * saturate(dot(halfVector, normal)) + 0.05), 0.0, 1.0 );\n    // kS += fresnel;\n\n    // Accumulate the radiance\n    vec3 envColor = sampleEnvMap(reflectionVector, roughness);\n    radiance += envColor * geometry * fresnel * sinT / denominator;\n    //radiance += envColor * fresnel; // Removing "geometry" for now until we construct a better geometric shading term\n\n    return radiance;        \n}\n'), Qa.setShaderModule("PBRSurfaceRadiance.glsl", "\n\nstruct MaterialParams {\n    vec3 baseColor;\n    float metallic;\n    float roughness;\n    float reflectance;\n};\n\nvec4 pbrSpecularReflectance(in MaterialParams materialParams, vec3 normal, in vec3 viewVector) {\n\n    float NdotV = dot(normal, viewVector);\n    \n    // -------------------------- Specular Reflectance --------------------------\n    // vec3 ks = vec3(0.0);\n    // vec3 specular = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, F0, ks );\n    // vec3 kd = (vec3(1.0) - ks) * vec3(1.0 - metallic);    \n\n    float schlickFresnel = materialParams.reflectance + pow((1.0-materialParams.reflectance)*(1.0-NdotV), 5.0);\n\n    vec3 specularReflectance = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, schlickFresnel);\n\n\n    // -------------------------- Specular Occlusion --------------------------\n    // Fast and quick way of reducing specular reflection in areas that are less exposed to the environment\n    // A better approch is to try screen space specular occlusion but need to check performance and feasibility in webGL\n    //float specularOcclusion = clamp(length(irradiance), 0.01, 1.0);    \n    //specularReflectance = (specularReflectance * specularOcclusion); \n\n    return vec4(specularReflectance, schlickFresnel);\n}\n\n\nvec3 pbrSurfaceRadiance(in MaterialParams materialParams, vec3 irradiance, vec3 normal, in vec3 viewVector) {\n\n    float NdotV = dot(normal, viewVector);\n    vec3 specularReflectance;\n\n    // -------------------------- Diffuse Reflectance --------------------------\n\n    vec3 diffuseReflectance = materialParams.baseColor * irradiance;\n\n    // From the Disney dielectric BRDF    \n    // Need to check if this is useful for us but the implementation works based on their paper\n    //diffuseReflectance = (diffuseReflectance / PI); // << [PT 18-08-2018] What did this line do??? (makes everything 3.1x darker.)\n    // diffuseReflectance = vec3(mix(diffuseReflectance, diffuseReflectance * mix(0.5, 2.5, materialParams.roughness), pow(1.0 - NdotV, 5.0)));\n    diffuseReflectance = vec3(mix(diffuseReflectance, diffuseReflectance * mix(0.5, 1.0, materialParams.roughness), pow(1.0 - NdotV, 5.0)));\n\n\n    // -------------------------- Color at normal incidence --------------------------\n    \n    // Need to use 'Reflectance' here instead of 'ior'\n    //vec3 F0 = vec3(abs((1.0 - ior) / (1.0 + ior)));    \n    //F0 = F0 * F0;\n    //F0 = mix(F0, materialParams.baseColor, materialParams.metallic);      \n\n\n    // -------------------------- Specular Reflectance --------------------------\n    // vec3 ks = vec3(0.0);\n    // vec3 specular = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, F0, ks );\n    // vec3 kd = (vec3(1.0) - ks) * vec3(1.0 - metallic);    \n\n    float schlickFresnel = materialParams.reflectance + pow((1.0-materialParams.reflectance)*(1.0-NdotV), 5.0);\n\n    specularReflectance = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, schlickFresnel);\n\n\n    // -------------------------- Specular Occlusion --------------------------\n    // Fast and quick way of reducing specular reflection in areas that are less exposed to the environment\n    // A better approch is to try screen space specular occlusion but need to check performance and feasibility in webGL\n    //float specularOcclusion = clamp(length(irradiance), 0.01, 1.0);    \n    //specularReflectance = (specularReflectance * specularOcclusion);  \n      \n\n    // -------------------------- Metallic --------------------------\n    // We need to do few things given a higher > 0 metallic value\n    //      1. tint specular reflectance by the albedo color (not at grazing angles)\n    //      2. almost elliminate all diffuse reflectance (in reality metals have some diffuse due to layering (i.e. dust, prints, etc.))\n    //      3. set \"specular\" artistic value to metallic range (0.6 - 0.85)\n\n    specularReflectance = mix(specularReflectance, specularReflectance * materialParams.baseColor, materialParams.metallic);\n    diffuseReflectance = mix(diffuseReflectance, vec3(0.0,0.0,0.0), materialParams.metallic); // Leaveing at pure black for now but always need some %3 diffuse left for imperfection of pulished pure metal\n    // Would be best to compute reflectace internally and set here to 0.6-0.85 for metals\n    \n\n    // -------------------------- Final color --------------------------\n    // Energy conservation already taken into account in both the diffuse and specular reflectance\n    vec3 radiance = diffuseReflectance + specularReflectance;\n\n    // radiance = vec4( kd * diffuse + /*ks */ specular, 1);\n    return radiance;\n}\n");
var Qi = /** @class */ (function (_super) {
    __extends(Qi, _super);
    function Qi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("LayeredCarPaintShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nattribute float clusterIDs;\nuniform vec2 lightmapSize;\n\n/* VS Outputs */\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    v_geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n#endif\n    // v_lightmapCoord = (lightmapCoords + geomItemData.zw) / lightmapSize;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + geomItemData.xy), 0., 1.);\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n//     v_clusterID = clusterIDs;\n// #endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("LayeredCarPaintShader.fragmentShader", '\n#ifndef ENABLE_ES3\n    #extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n<%include file="materialparams.glsl"/>\n\n/* VS Outputs */\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\nuniform sampler2D lightmap;\nuniform vec2 lightmapSize;\n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n<%include file="debugColors.glsl"/>\nuniform bool debugLightmapTexelSize;\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform color MidColorTint;\nuniform float MidColorTintReflectance;\n\nuniform float MicroflakePerturbation;\nuniform sampler2D FlakesNormalTex;\nuniform float FlakesScale;\n\n#ifdef ENABLE_SPECULAR\n\nuniform float BaseRoughness;\nuniform float BaseMetallic;\nuniform float BaseReflectance;\nuniform float GlossRoughness;\nuniform float GlossMetallic;\nuniform float GlossReflectance;\n\n#endif\n\n#ifdef ENABLE_TEXTURES\n\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n\n#endif\n\n// Followup: Normal Mapping Without Precomputed Tangents\n// http://www.thetenthplanet.de/archives/1180\nmat3 cotangent_frame( vec3 normal, vec3 position, vec2 uv )\n{\n    // get edge vectors of the pixel triangle\n    vec3 dp1 = dFdx( position );\n    vec3 dp2 = dFdy( position );\n    vec2 duv1 = dFdx( uv );\n    vec2 duv2 = dFdy( uv );\n \n    // solve the linear system\n    vec3 dp2perp = cross( dp2, normal );\n    vec3 dp1perp = cross( normal, dp1 );\n    vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 bitangent = dp2perp * duv1.y + dp1perp * duv2.y;\n \n    // construct a scale-invariant frame \n    float invmax = inversesqrt( max( dot(tangent,tangent), dot(bitangent,bitangent) ) );\n    return mat3( tangent * invmax, bitangent * invmax, normal );\n}\n\n#define WITH_NORMALMAP_UNSIGNED 1\n\nvec3 sampleNormalMap( sampler2D normalMap, vec2 texcoord )\n{\n    // assume normal, the interpolated vertex normal and \n    // viewVec, the view vector (vertex to eye)\n    vec3 map = texture2D( normalMap, texcoord ).xyz;\n#ifdef WITH_NORMALMAP_UNSIGNED\n    map = map * 255./127. - 128./127.;\n#endif\n#ifdef WITH_NORMALMAP_2CHANNEL\n    map.z = sqrt( 1. - dot( map.xy, map.xy ) );\n#endif\n#ifdef WITH_NORMALMAP_GREEN_UP\n    map.y = -map.y;\n#endif\n    return map;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n    MaterialParams material;\n\n#ifndef ENABLE_TEXTURES\n    material.baseColor      = BaseColor.rgb;\n#else\n    vec2 texCoord           = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n#endif\n\n#ifdef ENABLE_SPECULAR\n    material.roughness      = BaseRoughness;\n    material.metallic       = BaseMetallic;\n    material.reflectance    = BaseReflectance;\n#endif\n\n    vec3 irradiance = texture2D(lightmap, v_lightmapCoord).rgb;\n \n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n    if(debugLightmapTexelSize)\n    {\n        vec2 coord_texelSpace = (v_lightmapCoord * lightmapSize) - v_geomItemData.zw;\n        //vec2 coord_texelSpace = (v_textureCoord * lightmapSize);\n        float total = floor(coord_texelSpace.x) +\n                      floor(coord_texelSpace.y);\n                      \n        vec3 clustercolor = getDebugColor(v_clusterID);\n\n        if(mod(total,2.0)==0.0){\n            material.baseColor = clustercolor;\n            irradiance = vec3(1.0);\n        }\n        else{\n            material.baseColor = material.baseColor * 1.5;\n        }\n    }\n#endif\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    vec3 surfacePos = -v_viewPos;\n\n    // The vector from the camera to the surface point.\n    vec3 viewVector = mat3(cameraMatrix) * normalize(v_viewPos);\n    vec3 viewDir = normalize(viewVector);\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n\n    float NdotV = dot(normal, viewDir);\n    if(NdotV < 0.0){\n        normal = -normal;\n        NdotV = dot(normal, viewDir);\n    }\n\n#ifndef ENABLE_SPECULAR\n    vec3 radiance = material.baseColor * irradiance;\n#else\n    \n    // Mix the base color to give a multi-layered paint look.\n    material.baseColor      = mix(material.baseColor, material.baseColor * MidColorTint.rgb, (1.0-NdotV));\n\n    mat3 TBN = cotangent_frame( normal, surfacePos, v_lightmapCoord );\n    vec3 flakesNormal = TBN * -sampleNormalMap( FlakesNormalTex, (v_lightmapCoord * lightmapSize) / FlakesScale );\n    flakesNormal = normalize(mix(normal, flakesNormal, MicroflakePerturbation));\n\n    vec3 baseRadiance = pbrSurfaceRadiance(material, irradiance, flakesNormal, viewVector);\n\n    material.roughness      = GlossRoughness;\n    material.reflectance    = GlossReflectance;\n    vec4 gloss = pbrSpecularReflectance(material, normal, viewVector);\n    vec3 radiance = mix(baseRadiance, gloss.rgb, gloss.a);\n    //vec3 radiance = baseRadiance;\n\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(radiance, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    Qi.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); e.push({ name: "BaseColor", defaultValue: new y(1, 0, 0) }), e.push({ name: "BaseMetallic", defaultValue: 0 }), e.push({ name: "BaseRoughness", defaultValue: .35 }), e.push({ name: "BaseReflectance", defaultValue: .03 }), e.push({ name: "MidColorTint", defaultValue: new y(1, 1, 1) }), e.push({ name: "MidColorTintReflectance", defaultValue: .03 }), e.push({ name: "GlossMetallic", defaultValue: 0 }), e.push({ name: "GlossRoughness", defaultValue: .35 }), e.push({ name: "GlossReflectance", defaultValue: .03 }); var t = new ht("flakes", "ZeaEngine/FlakesNormalMap.png"); return t.wrap = "REPEAT", t.mipMapped = !0, e.push({ name: "FlakesNormal", defaultValue: t }), e.push({ name: "FlakesScale", defaultValue: .1 }), e.push({ name: "MicroflakePerturbation", defaultValue: .1 }), e; };
    Qi.getGeomDataShaderName = function () { return "StandardSurfaceGeomDataShader"; };
    Qi.getSelectedShaderName = function () { return "StandardSurfaceSelectedGeomsShader"; };
    return Qi;
}(Aa));
J.registerClass("LayeredCarPaintShader", Qi);
var Ai = /** @class */ (function (_super) {
    __extends(Ai, _super);
    function Ai(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("FlatShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 ProjectionCenter;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nattribute float clusterIDs;\nuniform vec2 lightmapSize;\n\n/* VS Outputs */\n// varying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    vec4 geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position     = modelViewProjectionMatrix * pos;\n\n    vec4 worldPos = modelMatrix * pos;\n    v_worldDir = worldPos.xyz - ProjectionCenter;\n\n    v_lightmapCoord = (lightmapCoords + geomItemData.zw) / lightmapSize;\n}\n');
        return _this;
    }
    return Ai;
}(Aa));
J.registerClass("ShadowCatcherShader", /** @class */ (function (_super) {
    __extends(class_8, _super);
    function class_8(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("ShadowCatcherShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n\n/* VS Outputs */\nvarying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nuniform sampler2D lightmap;\nuniform float ShadowMultiplier;\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n    vec4 env = envMap;\n    if(envMapTexType != 0) {\n        vec2 texCoord = dirToSphOctUv(normalize(v_worldDir));\n        env = texture2D(envMapTex, texCoord);\n    }\n\n    vec3 irradiance = texture2D(lightmap, v_lightmapCoord).rgb * ShadowMultiplier;\n    float irradianceLum = clamp(luminanceFromRGB(irradiance), 0.0, 1.0);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(env.rgb/env.a, 1.0);\n    fragColor.rgb = mix(fragColor.rgb * irradiance, fragColor.rgb, irradianceLum);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    class_8.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "ProjectionCenter", defaultValue: new Z(0, 0, 1.7) }), e.push({ name: "ShadowMultiplier", defaultValue: 1 }), e; };
    class_8.isTransparent = function () { return !0; };
    class_8.prototype.bind = function (e, t) { return "ADD" == e.pass && _super.prototype.bind.call(this, e, t); };
    return class_8;
}(Ai)));
J.registerClass("FloatingShadowCatcherShader", /** @class */ (function (_super) {
    __extends(class_9, _super);
    function class_9(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("FloatingShadowCatcherShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nuniform sampler2D lightmap;\n\nuniform float ShadowMultiplier;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    \n    float shadow = luminanceFromRGB(texture2D(lightmap, v_lightmapCoord).rgb) * ShadowMultiplier;\n\n    // This material works by multiplying the image buffer values by the luminance in the lightmap.\n    fragColor.rgb = vec3(pow(shadow, 1.0/ShadowMultiplier));\n    fragColor.a = 1.0;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');
        return _this;
    }
    class_9.prototype.bind = function (e, t) { return "MULTIPLY" == e.pass && _super.prototype.bind.call(this, e, t); };
    class_9.isTransparent = function () { return !0; };
    class_9.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "ShadowMultiplier", defaultValue: 1 }), e; };
    return class_9;
}(Ai)));
var ji = /** @class */ (function (_super) {
    __extends(ji, _super);
    function ji(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("LinesShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("LinesShader.fragmentShader", "\nprecision highp float;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = BaseColor;\n    fragColor.a *= Opacity;\n    \n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n"), _this.finalize();
        return _this;
    }
    ji.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e.push({ name: "Opacity", defaultValue: 1 }), e; };
    ji.getGeomDataShaderName = function () { return "StandardSurfaceGeomDataShader"; };
    ji.getSelectedShaderName = function () { return "StandardSurfaceSelectedGeomsShader"; };
    ji.isTransparent = function () { return !0; };
    ji.prototype.bind = function (e, t) { return "ADD" == e.pass && _super.prototype.bind.call(this, e, t); };
    return ji;
}(Aa));
J.registerClass("LinesShader", ji);
var qi = /** @class */ (function (_super) {
    __extends(qi, _super);
    function qi(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("NormalsShader.vertexShader", '\nprecision highp float;\n\ninstancedattribute vec3 positions;\ninstancedattribute vec3 normals;\nattribute vec2 vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nuniform float normalLength;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\n/* VS Outputs */\nvarying float v_weight;\n\nvoid main(void) {\n  mat4 modelMatrix = getModelMatrix(transformIndex);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n  if(vertexIDs.x == 0.0){\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n    v_weight = 1.0;\n  }\n  else{\n    gl_Position = modelViewProjectionMatrix * vec4(positions+(normals*normalLength), 1.0);\n    v_weight = 0.0;\n  }\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("NormalsShader.fragmentShader", "\nprecision highp float;\n\nuniform color normalColor;\n\n/* VS Outputs */\nvarying float v_weight;\n\n\nvoid main(void) {\n  gl_FragColor = normalColor;\n  gl_FragColor.a = v_weight;\n}\n");
        return _this;
    }
    return qi;
}(Aa));
var $i = /** @class */ (function (_super) {
    __extends($i, _super);
    function $i(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("PointsShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n  gl_Position = modelViewProjectionMatrix * vec4(positions, 1.);\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("PointsShader.fragmentShader", "\nprecision highp float;\n\nuniform color BaseColor;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = BaseColor;\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n");
        return _this;
    }
    $i.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e; };
    return $i;
}(Aa));
J.registerClass("PointsShader", $i);
var es = /** @class */ (function (_super) {
    __extends(es, _super);
    function es(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("FatPointsShader.vertexShader", '\nprecision highp float;\n\ninstancedattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform float PointSize;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  vec2 quadPointPos = getQuadVertexPositionFromID();\n  v_texCoord = quadPointPos + 0.5;\n\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.);\n\n  viewPos += vec4(vec3(quadPointPos, 0.0) * PointSize, 0.);\n\n  // Generate a quad which is 0.5 * PointSize closer towards\n  // us. This allows points to be visualized even if snug on \n  // a surface. (else they get fully clipped)\n  viewPos.z += 0.5 * PointSize;\n\n  v_drawItemId = float(getDrawItemId());\n  v_viewPos = -viewPos.xyz;\n  \n  gl_Position = projectionMatrix * viewPos;\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("FatPointsShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n\nuniform color BaseColor;\nuniform float Rounded;\nuniform float BorderWidth;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n  if(dist > 0.5 - (BorderWidth * 0.5))\n    fragColor = vec4(0.,0.,0.,1.);\n  else {\n    // Modulate the lighting using the texture coord so the point looks round.\n    float NdotV = cos(dist * PI);\n\n    fragColor = BaseColor * mix(1.0, NdotV, Rounded);\n  }\n  \n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');
        return _this;
    }
    es.prototype.bind = function (e) { return !!_super.prototype.bind.call(this, e) && (e.supportsInstancing = !1, !0); };
    es.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e.push({ name: "PointSize", defaultValue: .05 }), e.push({ name: "Rounded", defaultValue: 1 }), e.push({ name: "BorderWidth", defaultValue: .2 }), e; };
    es.getGeomDataShaderName = function () { return "FatPointsGeomDataShader"; };
    es.getSelectedShaderName = function () { return "FatPointsSelectedShader"; };
    return es;
}(Aa));
var ts = /** @class */ (function (_super) {
    __extends(ts, _super);
    function ts(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("FatPointsGeomDataShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n    \n\n  float viewDist = length(v_viewPos);\n\n  if(floatGeomBuffer != 0) {\n    fragColor.r = float(passId); \n    fragColor.g = float(v_drawItemId);\n    fragColor.b = 0.0;// TODO: store poly-id or something.\n    fragColor.a = viewDist;\n  }\n  else {\n    ///////////////////////////////////\n    // UInt8 buffer\n    fragColor.r = (mod(v_drawItemId, 256.) + 0.5) / 255.;\n    fragColor.g = (floor(v_drawItemId / 256.) + 0.5) / 255.;\n\n    // encode the dist as a 16 bit float\n    vec2 float16bits = encode16BitFloatInto2xUInt8(viewDist);\n    fragColor.b = float16bits.x;\n    fragColor.a = float16bits.y;\n  }\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');
        return _this;
    }
    return ts;
}(es));
var as = /** @class */ (function (_super) {
    __extends(as, _super);
    function as(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("FatPointsSelectedShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n\n<%include file="drawItemTexture.glsl"/>\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n    return highlightColor;\n}\n\n#endif\n\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n  \n  int drawItemId = int(v_drawItemId + 0.5);\n  fragColor = getHighlightColor(drawItemId);\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');
        return _this;
    }
    return as;
}(es));
J.registerClass("FatPointsShader", es), J.registerClass("FatPointsGeomDataShader", ts), J.registerClass("FatPointsSelectedShader", as), Qa.setShaderModule("pragmatic-pbr/exposure.glsl", "\n\n/*\n* Get an exposure using the Saturation-based Speed method.\n*/\nfloat getSaturationBasedExposure(float aperture,\n                                 float shutterSpeed,\n                                 float iso)\n{\n    float l_max = (7800.0 / 65.0) * sqrt(aperture) / (iso * shutterSpeed);\n    return 1.0 / l_max;\n}\n\n//White balance middle grey we are targetting for a good scene exposure\n//https://en.wikipedia.org/wiki/Middle_gray\nconst float MIDDLE_GREY = 0.18;\n\n/*\n* Get an exposure using the Standard Output Sensitivity method.\n* Accepts an additional parameter of the target middle grey.\n*/\nfloat getStandardOutputBasedExposure(float aperture,\n                                     float shutterSpeed,\n                                     float iso)\n{\n    //https://placeholderart.wordpress.com/2014/11/21/implementing-a-physically-based-camera-manual-exposure/\n    //https://en.wikipedia.org/wiki/Film_speed#Standard_output_sensitivity_.28SOS.29\n    //photometric exposure magic\n    //represents the properties of lens\n    float q = 0.65;\n\n    //float l_avg = (1000.0f / 65.0f) * sqrt(aperture) / (iso * shutterSpeed);\n    float l_avg = (1.0 / q) * sqrt(aperture) / (iso * shutterSpeed);\n    //float l_avg = sqrt(aperture) / (iso * shutterSpeed);\n    return MIDDLE_GREY / l_avg;\n}\n\n"), Qa.setShaderModule("pragmatic-pbr/tonemap-filmic.glsl", "\n\n//Based on Filmic Tonemapping Operators http://filmicgames.com/archives/75\nvec3 tonemapFilmic(vec3 color) {\n    vec3 x = max(vec3(0.0), color - 0.004);\n    return (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);\n}\n\n"), Qa.setShaderModule("mattdesl/fxaa-texcoords.glsl", "\n//To save 9 dependent texture reads, you can compute\n//these in the vertex shader and use the optimized\n//frag.glsl function in your frag shader. \n\n//This is best suited for mobile devices, like iOS.\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\n"), Qa.setShaderModule("mattdesl/fxaa.glsl", '\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n--\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\nCopyright (c) 2011 by Armin Ronacher.\nSome rights reserved.\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent \n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE, \n            vec2 v_rgbSW, vec2 v_rgbSE, \n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n'), Qa.setShaderModule("mattdesl/fxaa-apply.glsl", '\n\n<%include file="mattdesl/fxaa.glsl"/>\n\nvec4 apply(sampler2D tex, vec2 fragCoord, vec2 resolution) {\n    mediump vec2 v_rgbNW;\n    mediump vec2 v_rgbNE;\n    mediump vec2 v_rgbSW;\n    mediump vec2 v_rgbSE;\n    mediump vec2 v_rgbM;\n\n    //compute the texture coords\n    texcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n    \n    //compute FXAA\n    return fxaa(tex, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\n');
var is = /** @class */ (function (_super) {
    __extends(is, _super);
    function is(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("PostProcessing.vertexShader", '\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n<%include file="mattdesl/fxaa-texcoords.glsl"/>\n\nuniform vec2 textureSize;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n\n    vec2 fragCoord = v_texCoord * textureSize;\n    texcoords(fragCoord, textureSize, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("PostProcessing.fragmentShader", '\nprecision highp float;\n\n<%include file="pragmatic-pbr/exposure.glsl"/>\n<%include file="pragmatic-pbr/tonemap-filmic.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n\n<%include file="mattdesl/fxaa.glsl"/>\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D texture;\nuniform vec2 textureSize;\n\nuniform bool antialiase;\nuniform bool tonemap;\nuniform float exposure;\nuniform float gamma;\n\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n    //can also use gl_FragCoord.xy\n    mediump vec2 fragCoord = v_texCoord * textureSize; \n\n    if (antialiase) {\n        fragColor = fxaa(texture, fragCoord, textureSize, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n    } else {\n        fragColor = texture2D(texture, v_texCoord);\n    }\n    \n    //fragColor.rgb *= getStandardOutputBasedExposure(aperture, shutterSpeed, iso);\n    fragColor.rgb *= exposure;\n    \n    if (tonemap) \n        fragColor.rgb = tonemapFilmic(fragColor.rgb);\n    else\n        fragColor.rgb = toGamma(fragColor.rgb, gamma);\n\n    \n    //fragColor.rgb = toGamma(fragColor.rgb, gamma);\n    \n    fragColor.a = 1.0;\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}'), _this.finalize();
        return _this;
    }
    return is;
}(Aa));
var ss = /** @class */ (function (_super) {
    __extends(ss, _super);
    function ss(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("SimpleSurfaceShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    v_geomItemData  = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n    // v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n#endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("SimpleSurfaceShader.fragmentShader", '\nprecision highp float;\n\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_TEXTURES\n\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\nuniform sampler2D OpacityTex;\nuniform int OpacityTexType;\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\n\nvoid main(void) {\n    int drawItemId = int(v_drawItemId + 0.5);\n\n    int flags = int(v_geomItemData.r + 0.5);\n    // Cutaways\n    if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) \n    {\n        vec4 cutAwayData   = getCutaway(drawItemId);\n        vec3 planeNormal = cutAwayData.xyz;\n        float planeDist = cutAwayData.w;\n        if(cutaway(v_worldPos, planeNormal, planeDist)){\n            discard;\n            return;\n        }\n        else if(!gl_FrontFacing){\n            fragColor = cutColor;\n#ifndef ENABLE_ES3\n            gl_FragColor = fragColor;\n#endif\n            return;\n        }\n    }\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor      = BaseColor;\n    float opacity       = baseColor.a * Opacity;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n    float opacity       = baseColor.a * getLuminanceParamValue(Opacity, OpacityTex, OpacityTexType, v_textureCoord);\n#endif\n\n    // Hacky simple irradiance. \n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * v_viewNormal);\n    float ndotv = dot(normal, viewVector);\n    if(ndotv < 0.0){\n        normal = -normal;\n        ndotv = dot(normal, viewVector);\n\n        // Note: these 2 lines can be used to debug inverted meshes.\n        //baseColor = vec4(1.0, 0.0, 0.0, 1.0);\n        //ndotv = 1.0;\n    }\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = vec4(ndotv * baseColor.rgb, opacity);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    ss.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e.push({ name: "Opacity", defaultValue: 1, range: [0, 1] }), e; };
    ss.getGeomDataShaderName = function () { return "StandardSurfaceGeomDataShader"; };
    ss.getSelectedShaderName = function () { return "StandardSurfaceSelectedGeomsShader"; };
    return ss;
}(Aa));
J.registerClass("SimpleSurfaceShader", ss), Qa.setShaderModule("cutaways.glsl", "\n\n\nconst int GEOMITEM_FLAG_CUTAWAY =  1; // 1<<0;\n\n#define RAY_EPS 0.0000001\nstruct Ray {\n    vec3 start;\n    vec3 dir;\n};\n\nfloat intersectRayPlane(Ray ray, Ray plane) {\n    vec3 w = ray.start - plane.start;\n    float D = dot(plane.dir, ray.dir);\n    float N = dot(-plane.dir, w);\n\n    if (abs(D) < RAY_EPS) {\n        // segment is parallel to plane\n        if (N == 0.0)\n            return -1.0; // segment lies in plane\n        else\n            return -1.0; // no intersection\n    }\n    // they are not parallel\n    // compute intersect param\n    float sI = N / D;\n    if (sI < -RAY_EPS) {\n        return -1.0; // no intersection\n    }\n    return sI;\n}\n\n\nbool cutaway(vec3 worldPos, vec3 planeNormal, float planeDist) {\n\n    vec3 planePos = planeNormal * planeDist;\n    vec3 planeDir = worldPos + planePos;\n    float planeOffset = dot(planeDir, planeNormal);\n    if(planeOffset > 0.0){\n        return true;\n    }\n    return  false;\n}\n");
var ns = /** @class */ (function (_super) {
    __extends(ns, _super);
    function ns(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("StandardSurfaceShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n// attribute float clusterIDs;\n// uniform vec2 lightmapSize;\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    v_geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n#endif\n\n    // v_lightmapCoord = (lightmapCoords + v_geomItemData.zw) / lightmapSize;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + v_geomItemData.zw), 0., 1.);\n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n    v_clusterID = clusterIDs;\n#endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("StandardSurfaceShader.fragmentShader", '\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\n// uniform sampler2D lightmap;\n// uniform bool lightmapConnected;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// <%include file="debugColors.glsl"/>\n// uniform vec2 lightmapSize;\n// uniform bool debugLightmapTexelSize;\n// #endif\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform float EmissiveStrength;\n\n\n#ifdef ENABLE_SPECULAR\nuniform float Roughness;\nuniform float Metallic;\nuniform float Reflectance;\n#endif\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n\n#ifdef ENABLE_SPECULAR\nuniform sampler2D RoughnessTex;\nuniform int RoughnessTexType;\n\nuniform sampler2D MetallicTex;\nuniform int MetallicTexType;\n\nuniform sampler2D ReflectanceTex;\nuniform int ReflectanceTexType;\n\nuniform sampler2D NormalTex;\nuniform int NormalTexType;\n// uniform float NormalScale;\n#endif\n\nuniform sampler2D EmissiveStrengthTex;\nuniform int EmissiveStrengthTexType;\n\n\n#endif\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n\n#endif\n\nvoid main(void) {\n    int drawItemId = int(v_drawItemId + 0.5);\n\n    int flags = int(v_geomItemData.r + 0.5);\n    // Cutaways\n    if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n        vec4 cutAwayData   = getCutaway(drawItemId);\n        vec3 planeNormal = cutAwayData.xyz;\n        float planeDist = cutAwayData.w;\n        if(cutaway(v_worldPos, planeNormal, planeDist)){\n            discard;\n            return;\n        }\n        else if(!gl_FrontFacing){\n            fragColor = cutColor;\n#ifndef ENABLE_ES3\n            gl_FragColor = fragColor;\n#endif\n            return;\n        }\n    }\n\n\n    MaterialParams material;\n\n#ifndef ENABLE_TEXTURES\n    material.BaseColor     = BaseColor.rgb;\n    float emission         = EmissiveStrength;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness     = Roughness;\n    material.metallic      = Metallic;\n    material.reflectance   = Reflectance;\n#endif\n\n#else\n    // Planar YZ projection for texturing, repeating every meter.\n    // vec2 texCoord       = v_worldPos.xz * 0.2;\n    vec2 texCoord          = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor     = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness     = getLuminanceParamValue(Roughness, RoughnessTex, RoughnessTexType, texCoord);\n    material.metallic      = getLuminanceParamValue(Metallic, MetallicTex, MetallicTexType, texCoord);\n    material.reflectance   = getLuminanceParamValue(Reflectance, ReflectanceTex, ReflectanceTexType, texCoord);\n#endif\n    float emission         = getLuminanceParamValue(EmissiveStrength, EmissiveStrengthTex, EmissiveStrengthTexType, texCoord);\n#endif\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    //vec3 surfacePos = -v_viewPos;\n\n#ifdef ENABLE_TEXTURES\n#ifdef ENABLE_SPECULAR\n    if(NormalTexType != 0){\n        vec3 textureNormal_tangentspace = normalize(texture2D(NormalTex, texCoord).rgb * 2.0 - 1.0);\n        viewNormal = normalize(mix(viewNormal, textureNormal_tangentspace, 0.3));\n    }\n#endif\n#endif\n\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n    if(dot(normal, viewVector) < 0.0){\n        normal = -normal;\n        // Note: this line can be used to debug inverted meshes.\n        //material.baseColor = vec3(1.0, 0.0, 0.0);\n    }\n\n    vec3 irradiance;\n    // if(lightmapConnected){\n    //     irradiance = texture2D(lightmap, v_lightmapCoord).rgb;\n    // }\n    // else{\n#ifndef ENABLE_SPECULAR\n        irradiance = sampleEnvMap(normal, 1.0);\n#else\n        irradiance = vec3(dot(normal, viewVector));\n#endif\n        \n    // }\n\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n//     if(debugLightmapTexelSize)\n//     {\n//         vec2 coord_texelSpace = (v_lightmapCoord * lightmapSize) - v_geomItemData.zw;\n//         //vec2 coord_texelSpace = (v_textureCoord * lightmapSize);\n//         float total = floor(coord_texelSpace.x) +\n//                       floor(coord_texelSpace.y);\n                      \n//         vec3 clustercolor = getDebugColor(v_clusterID);\n\n//         material.metallic = 0.0;\n//         material.reflectance = 0.0;\n//         if(mod(total,2.0)==0.0){\n//             material.baseColor = clustercolor;\n//             irradiance = vec3(1.0);\n//         }\n//         else{\n//             material.baseColor = material.baseColor * 1.5;\n//         }\n//     }\n// #endif\n\n#ifndef ENABLE_SPECULAR\n    vec3 radiance = material.baseColor * irradiance;\n#else\n    vec3 radiance = pbrSurfaceRadiance(material, irradiance, normal, viewVector);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    // fragColor = vec4(material.baseColor, 1.0);\n    // fragColor = vec4(material.baseColor * irradiance, 1.0);\n    fragColor = vec4(radiance + (emission * material.baseColor), 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    ns.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e.push({ name: "Metallic", defaultValue: 0, range: [0, 1] }), e.push({ name: "Roughness", defaultValue: .85, range: [0, 1] }), e.push({ name: "Reflectance", defaultValue: .1, range: [0, 1] }), e.push({ name: "EmissiveStrength", defaultValue: 0, range: [0, 1] }), e; };
    ns.getGeomDataShaderName = function () { return "StandardSurfaceGeomDataShader"; };
    ns.getSelectedShaderName = function () { return "StandardSurfaceSelectedGeomsShader"; };
    return ns;
}(Aa));
J.registerClass("StandardSurfaceShader", ns), Qa.setShaderModule("GLSLBits.glsl", '\n    \n/////////////////////////////////////////////////////////////////\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\nfloat shift_right(float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\n  return floor(v * exp2(amt) + 0.5);\n}\n\nfloat mask_last(float v, float bits) {\n  return mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\n  from = floor(from + 0.5);\n  to = floor(to + 0.5);\n  return mask_last(shift_right(num, from), to - from);\n}\n\n/////////////////////////////////////////////////////////////////\n// https://stackoverflow.com/questions/18453302/how-do-you-pack-one-32bit-int-into-4-8bit-ints-in-glsl-webgl\n\nconst vec4 bitEnc = vec4(1.,255.,65025.,16581375.);\nconst vec4 bitDec = 1./bitEnc;\nvec4 EncodeFloatRGBA (float v) {\n    vec4 enc = bitEnc * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec2(1./255., 0.).xxxy;\n    return enc;\n}\nfloat DecodeFloatRGBA (vec4 v) {\n    return dot(v, bitDec);\n}\n\n\n\n/////////////////////////////////////////////////////////////////\n// https://gist.github.com/Flexi23/1713774\n// \nvec2 encode16BitFloatInto2xUInt8(float v){\n    vec2 c = vec2(0.);\n\n    int signum = (v >= 0.) ? 128 : 0;\n    v = abs(v);\n    int exponent = 15;\n    float limit = 1024.; // considering the bias from 2^-5 to 2^10 (==1024)\n    for(int exp = 15; exp > 0; exp--){\n        if( v < limit){\n            limit /= 2.;\n            exponent--;\n        }\n    }\n\n    float rest;\n    if(exponent == 0){\n        rest = v / limit / 2.;      // "subnormalize" implicite preceding 0. \n    }else{\n        rest = (v - limit)/limit;   // normalize accordingly to implicite preceding 1.\n    }\n\n    int mantissa = int(rest * 2048.);   // 2048 = 2^11 for the (split) 11 bit mantissa\n    int msb = mantissa / 256;           // the most significant 3 bits go into the lower part of the first byte\n    int lsb = mantissa - msb * 256;     // there go the other 8 bit of the lower significance\n\n    c.x = float(signum + exponent * 8 + msb) / 255.;    // color normalization for texture2D\n    c.y = float(lsb) / 255.;\n\n    if(v >= 2048.){\n        c.y = 1.;\n    }\n\n    return c;\n}\n\nfloat decode16BitFloatFrom2xUInt8(vec2 c){\n    float v = 0.;\n\n    int ix = int(c.x*255.); // 1st byte: 1 bit signum, 4 bits exponent, 3 bits mantissa (MSB)\n    int iy = int(c.y*255.); // 2nd byte: 8 bit mantissa (LSB)\n\n    int s = (c.x >= 0.5) ? 1 : -1;\n    ix = (s > 0) ? ix - 128 : ix;   // remove the signum bit from exponent\n    int iexp = ix / 8;              // cut off the last 3 bits of the mantissa to select the 4 exponent bits\n    int msb = ix - iexp * 8;        // subtract the exponent bits to select the 3 most significant bits of the mantissa\n\n    int norm = (iexp == 0) ? 0 : 2048;          // distinguish between normalized and subnormalized numbers\n    int mantissa = norm + msb * 256 + iy;       // implicite preceding 1 or 0 added here\n    norm = (iexp == 0) ? 1 : 0;                 // normalization toggle\n    float exponent = pow( 2., float(iexp + norm) - 16.); // -5 for the the exponent bias from 2^-5 to 2^10 plus another -11 for the normalized 12 bit mantissa \n    v = float( s * mantissa ) * exponent;\n\n    return v;\n}\n\n\n// TODO : Encoding Float32 to 4x UInt8\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\n// http://ultraist.hatenablog.com/entry/20110608/1307539319\n\n');
var ls = /** @class */ (function (_super) {
    __extends(ls, _super);
    function ls(e, t) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("StandardSurfaceGeomDataShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  v_drawItemId = float(drawItemId);\n  v_geomItemData = getInstanceData(drawItemId);\n\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  vec4 viewPos = modelViewMatrix * pos;\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = -viewPos.xyz;\n\n  v_drawItemID = float(getDrawItemId());\n  \n  v_worldPos      = (modelMatrix * pos).xyz;\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("StandardSurfaceGeomDataShader.fragmentShader", '\nprecision highp float;\n\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n  int drawItemId = int(v_drawItemId + 0.5);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n  int flags = int(v_geomItemData.r + 0.5);\n  // Cutaways\n  if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n      vec4 cutAwayData   = getCutaway(drawItemId);\n      vec3 planeNormal = cutAwayData.xyz;\n      float planeDist = cutAwayData.w;\n      if(cutaway(v_worldPos, planeNormal, planeDist)){\n          discard;\n          return;\n      }\n      else if(!gl_FrontFacing){\n          fragColor = cutColor;\n  #ifndef ENABLE_ES3\n          gl_FragColor = fragColor;\n  #endif\n          return;\n      }\n  }\n\n    float dist = length(v_viewPos);\n\n    if(floatGeomBuffer != 0) {\n        fragColor.r = float(passId); \n        fragColor.g = float(v_drawItemID);\n        fragColor.b = 0.0;// TODO: store poly-id or something.\n        fragColor.a = dist;\n    }\n    else {\n        ///////////////////////////////////\n        // UInt8 buffer\n        fragColor.r = (mod(v_drawItemID, 256.) + 0.5) / 255.;\n        fragColor.g = (floor(v_drawItemID / 256.) + 0.5) / 255.;\n\n\n        // encode the dist as a 16 bit float\n        vec2 float16bits = encode16BitFloatInto2xUInt8(dist);\n        fragColor.b = float16bits.x;\n        fragColor.a = float16bits.y;\n    }\n\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');
        return _this;
    }
    return ls;
}(Aa));
J.registerClass("StandardSurfaceGeomDataShader", ls);
var rs = /** @class */ (function (_super) {
    __extends(rs, _super);
    function rs(e, t) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("StandardSurfaceSelectedGeomsShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nvarying float v_drawItemId;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n    gl_Position = projectionMatrix * viewPos;\n\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("StandardSurfaceSelectedGeomsShader.fragmentShader", '\nprecision highp float;\n\nvarying float v_drawItemId;\n\n\n<%include file="drawItemTexture.glsl"/>\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n    return highlightColor;\n}\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    int drawItemId = int(v_drawItemId + 0.5);\n    fragColor = getHighlightColor(drawItemId);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');
        return _this;
    }
    return rs;
}(Aa));
J.registerClass("StandardSurfaceSelectedGeomsShader", rs);
var os = /** @class */ (function (_super) {
    __extends(os, _super);
    function os(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("HandleShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int maintainScreenSize;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  if(maintainScreenSize != 0) {\n    float dist = modelViewMatrix[3][2];\n    float sc = dist;\n    mat4 scmat = mat4(\n      sc, 0.0, 0.0, 0.0,\n      0.0, sc, 0.0, 0.0,\n      0.0, 0.0, sc, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n    modelViewMatrix = modelViewMatrix * scmat;\n  }\n\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = viewPos.xyz;\n  v_textureCoord = texCoords;\n  v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("HandleShader.fragmentShader", '\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    os.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e.push({ name: "maintainScreenSize", defaultValue: 0 }), e; };
    os.isOverlay = function () { return !0; };
    os.getGeomDataShaderName = function () { return "HandleGeomDataShader"; };
    return os;
}(Aa));
J.registerClass("HandleShader", os);
var ds = /** @class */ (function (_super) {
    __extends(ds, _super);
    function ds(e, t) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("HandleGeomDataShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int maintainScreenSize;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  if(maintainScreenSize != 0) {\n    float dist = modelViewMatrix[3][2];\n    float sc = dist;\n    mat4 scmat = mat4(\n      sc, 0.0, 0.0, 0.0,\n      0.0, sc, 0.0, 0.0,\n      0.0, 0.0, sc, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n    modelViewMatrix = modelViewMatrix * scmat;\n  }\n\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = -viewPos.xyz;\n\n  v_drawItemID = float(getDrawItemId());\n}\n');
        return _this;
    }
    return ds;
}(ls));
J.registerClass("HandleGeomDataShader", ds);
var hs = /** @class */ (function (_super) {
    __extends(hs, _super);
    function hs(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("TransparentSurfaceShader.vertexShader", '\nprecision highp float;\n\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    vec4 geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + geomItemData.xy), 0., 1.);\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("TransparentSurfaceShader.fragmentShader", '\nprecision highp float;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n<%include file="GLSLUtils.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\nuniform float planeDist;\nuniform float planeAngle;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_SPECULAR\n<%include file="math/constants.glsl"/>\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\nuniform float Roughness;\nuniform float Metallic;\nuniform float Reflectance;\n#endif\n\n#ifdef __ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform bool BaseColorTexType;\n\nuniform sampler2D OpacityTex;\nuniform bool OpacityTexType;\n\nuniform sampler2D RoughnessTex;\nuniform bool RoughnessTexType;\n\nuniform sampler2D ReflectanceTex;\nuniform bool ReflectanceTexType;\n\nuniform sampler2D NormalTex;\nuniform bool NormalTexType;\nuniform float NormalScale;\n\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n    MaterialParams material;\n\n#ifndef __ENABLE_TEXTURES\n    material.baseColor      = BaseColor.rgb;\n    float opacity           = Opacity;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness      = Roughness;\n    material.metallic       = Metallic;\n    material.reflectance    = Reflectance;\n#endif\n\n#else\n    // Planar YZ projection for texturing, repeating every meter.\n    // vec2 texCoord        = v_worldPos.xz * 0.2;\n    vec2 texCoord           = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n    material.roughness      = getLuminanceParamValue(Roughness, RoughnessTex, RoughnessTexType, texCoord);\n    material.metallic       = getLuminanceParamValue(Metallic, MetallicTex, MetallicTexType, texCoord);\n    material.reflectance    = Reflectance;//getLuminanceParamValue(Reflectance, ReflectanceTex, ReflectanceTexType, texCoord);\n\n    float opacity           = getLuminanceParamValue(Opacity, OpacityTex, OpacityTexType, texCoords);\n#endif\n\n#ifndef ENABLE_SPECULAR\n    gl_FragColor = vec4(material.baseColor.rgb, opacity);\n#else\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    //vec3 surfacePos = -v_viewPos;\n\n#ifdef __ENABLE_TEXTURES\n    if(NormalTexType != 0){\n        vec3 textureNormal_tangentspace = normalize(texture2D(NormalTex, texCoord).rgb * 2.0 - 1.0);\n        viewNormal = normalize(mix(viewNormal, textureNormal_tangentspace, 0.3));\n    }\n#endif\n\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n    if(dot(normal, viewVector) < 0.0){\n        normal = -normal;\n        // Note: this line can be used to debug inverted meshes.\n        //material.baseColor = vec3(1.0, 0.0, 0.0);\n    }\n\n    vec4 specularReflectance = pbrSpecularReflectance(material, normal, viewVector);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(specularReflectance.rgb, mix(opacity, 1.0, specularReflectance.a));\n\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    hs.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e.push({ name: "Opacity", defaultValue: 1, range: [0, 1] }), e.push({ name: "Roughness", defaultValue: .85 }), e.push({ name: "Reflectance", defaultValue: 1e-4 }), e; };
    hs.getGeomDataShaderName = function () { return "StandardSurfaceGeomDataShader"; };
    hs.getSelectedShaderName = function () { return "StandardSurfaceSelectedGeomsShader"; };
    hs.isTransparent = function () { return !0; };
    hs.prototype.bind = function (e, t) { return "ADD" == e.pass && _super.prototype.bind.call(this, e, t); };
    return hs;
}(Aa));
J.registerClass("TransparentSurfaceShader", hs);
var cs = /** @class */ (function (_super) {
    __extends(cs, _super);
    function cs(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("ScreenSpaceShader.vertexShader", '\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n\n    gl_Position = (modelMatrix * vec4(positions, 1.0));\n\n    v_textureCoord = texCoords;\n    v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("ScreenSpaceShader.fragmentShader", '\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'), _this.finalize();
        return _this;
    }
    cs.isOverlay = function () { return !0; };
    cs.getParamDeclarations = function () { var e = _super.getParamDeclarations.call(this); return e.push({ name: "BaseColor", defaultValue: new y(1, 1, .5) }), e; };
    cs.getGeomDataShaderName = function () { return null; };
    cs.getSelectedShaderName = function () { return null; };
    return cs;
}(Aa));
J.registerClass("ScreenSpaceShader", cs);
var ms = /** @class */ (function (_super) {
    __extends(ms, _super);
    function ms(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.invisibleToGeomBuffer = !0;
        return _this;
    }
    return ms;
}(Di));
J.registerClass("ToolIconShader", ms);
var us = /** @class */ (function (_super) {
    __extends(us, _super);
    function us(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("UnpackLDRAlphaImageShader.vertexShader", '\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("UnpackLDRAlphaImageShader.fragmentShader", "\nprecision highp float;\n\nvarying vec2 v_texCoord;\nuniform sampler2D ldrSampler;\nuniform sampler2D alphaSampler;\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(texture2D(ldrSampler, v_texCoord).rgb, luminanceFromRGB(texture2D(alphaSampler, v_texCoord).rgb));\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n\n");
        return _this;
    }
    return us;
}(Aa));
var bs = /** @class */ (function (_super) {
    __extends(bs, _super);
    function bs(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__shaderStages.VERTEX_SHADER = Qa.parseShader("WireShader.vertexShader", "\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n/* VS Outputs */\n\nvoid main(void) {\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n\n    // Apply the perspective transform, and then move the vertices\n    //  towards the camera by a tiny little bit...\n    gl_Position.z -= 0.001 / gl_Position.w;\n    //gl_Position.z *= 0.999;\n}\n"), _this.__shaderStages.FRAGMENT_SHADER = Qa.parseShader("WireShader.fragmentShader", "\nprecision highp float;\n\nuniform color wireColor;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifdef ENABLE_ES3\n    gl_FragColor = color;\n#else\n    fragColor = color;\n#endif  \n}\n");
        return _this;
    }
    return bs;
}(Aa));
var ps = 0, gs = 1, _s = 2, Zs = 3;
var Gs = /** @class */ (function () {
    function Gs(e, t, a, i, s) {
        var _this = this;
        if (s === void 0) { s = null; }
        this.gl = e, this.geomItem = t, this.glGeom = a, this.id = i, this.flags = s, this.visible = this.geomItem.getVisible(), this.culled = !1, this.lightmapName = t.getLightmapName(), this.updated = new C, this.visibilityChanged = new C, this.highlightChanged = t.highlightChanged, this.updateVisibility = this.updateVisibility.bind(this), this.updateVisibility = this.updateVisibility.bind(this), this.destroy = this.destroy.bind(this), e.floatTexturesSupported ? this.updateXfo = function (e) { _this.updated.emit(ps); } : this.updateXfo = function (e) { _this.updateGeomMatrix(); }, this.geomItem.geomXfoChanged.connect(this.updateXfo), this.geomItem.visibilityChanged.connect(this.updateVisibility), this.geomItem.cutAwayChanged.connect(function () { _this.updated.emit(ps); }), this.highlightChangedId = this.geomItem.highlightChanged.connect(function () { _this.updated.emit(Zs); }), this.glGeom.updated.connect(function () { _this.updated.emit(gs); });
        var n = this.geomItem.getLightmapCoordsOffset();
        this.geomData = [n.x, n.y, 0, 0];
    }
    Gs.prototype.getGeomItem = function () { return this.geomItem; };
    Gs.prototype.getGLGeom = function () { return this.glGeom; };
    Gs.prototype.getVisible = function () { return this.geomItem.getVisible(); };
    Gs.prototype.getId = function () { return this.id; };
    Gs.prototype.getFlags = function () { return this.flags; };
    Gs.prototype.updateVisibility = function () { var e = this.geomItem.getVisible() && !this.culled; this.visible != e && (this.visible = e, this.visibilityChanged.emit(e), this.updated.emit()); };
    Gs.prototype.setCullState = function (e) { this.culled = e, this.updateVisibility(); };
    Gs.prototype.updateGeomMatrix = function () { this.modelMatrixArray = this.geomItem.getGeomMat4().asArray(); };
    Gs.prototype.getGeomMatrixArray = function () { return this.modelMatrixArray; };
    Gs.prototype.bind = function (e) { var t = this.gl, a = e.unifs; if (!t.floatTexturesSupported) {
        var e_219 = a.modelMatrix;
        e_219 && t.uniformMatrix4fv(e_219.location, !1, this.modelMatrixArray);
        var i_139 = a.drawItemData;
        i_139 && t.uniform4f(i_139.location, this.geomData);
    } var i = a.transformIndex; if (i && t.uniform1i(i.location, this.id), e.lightmaps && a.lightmap && e.boundLightmap != this.lightmapName) {
        var i_140 = e.lightmaps[this.lightmapName];
        i_140 && i_140.glimage.isLoaded() ? (i_140.glimage.bindToUniform(e, a.lightmap), t.uniform2fv(a.lightmapSize.location, i_140.atlasSize.asArray()), a.lightmapConnected && t.uniform1i(a.lightmapConnected.location, !0), e.boundLightmap = this.lightmapName) : a.lightmapConnected && t.uniform1i(a.lightmapConnected.location, !1);
    } return !0; };
    Gs.prototype.destroy = function () { this.geomItem.visibilityChanged.disconnect(this.updateVisibility), this.geomItem.geomXfoChanged.disconnect(this.updateXfo), this.geomItem.highlightChanged.disconnectId(this.highlightChangedId); };
    return Gs;
}());
var Xs = /** @class */ (function (_super) {
    __extends(Xs, _super);
    function Xs() {
        var _this = this;
        _this = _super.call(this) || this, _this.__drawItems = [void 0], _this.__drawItemsIndexFreeList = [], _this.__dirtyItemIndices = [];
        return _this;
    }
    Xs.prototype.init = function (e, t) {
        var _this = this;
        _super.prototype.init.call(this, e, t), this.__renderer.registerPass(function (e) { if (e instanceof ma) {
            if (e.getMetadata("glgeomItem"))
                return !1;
            {
                var t_219 = function (t) { return !!_this.filterGeomItem(t) && (null == e.getGeometry() ? e.geomAssigned.connect(function () { _this.addGeomItem(t); }) : _this.addGeomItem(t), !0); };
                return null == e.getMaterial() ? (console.warn("Scene item :" + e.getPath() + " has no material"), !1) : t_219(e);
            }
        } return !1; }, function (e) { return !!(e instanceof ma && e.getMetadata("glgeomItem")) && _this.removeGeomItem(e); });
    };
    Xs.prototype.filterGeomItem = function (e) { return !0; };
    Xs.prototype.addShader = function (e) { return this.__renderer.getOrCreateShader(e.getShaderName()); };
    Xs.prototype.constructShaders = function (e) { var t, a; var i = this.__renderer.getOrCreateShader(e); return i.constructor.getGeomDataShaderName() && (t = this.__renderer.getOrCreateShader(i.constructor.getGeomDataShaderName())), i.constructor.getSelectedShaderName() && (a = this.__renderer.getOrCreateShader(i.constructor.getSelectedShaderName())), { glshader: i, glgeomdatashader: t, glselectedshader: a }; };
    Xs.prototype.addMaterial = function (e) {
        var _this = this;
        var t = e.getMetadata("glmaterial");
        if (t)
            return t;
        var a = this.__renderer.getOrCreateShader(e.getShaderName());
        return t = new ri(this.__gl, e, a), t.updated.connect(function () { _this.__renderer.requestRedraw(); }), e.setMetadata("glmaterial", t), t;
    };
    Xs.prototype.addGeom = function (e) { var t = e.getMetadata("glgeom"); if (t)
        return t.addRef(this), t; var a = this.__gl; if (e instanceof Ut || e instanceof Ht)
        t = new ka(a, e);
    else if (e instanceof zt || e instanceof Et)
        t = new Ba(a, e);
    else {
        if (!(e instanceof wt || e instanceof Pt))
            throw new Error("Unsupported geom type:" + e.constructor.name);
        t = new Da(a, e);
    } return e.setMetadata("glgeom", t), t.addRef(this), t; };
    Xs.prototype.removeGeom = function (e) { var t = e.getMetadata("glgeom"); if (t)
        return t.removeRef(this), t; };
    Xs.prototype.addGeomItem = function (e) {
        var _this = this;
        var t = this.addGeom(e.getGeometry());
        var a;
        this.__drawItemsIndexFreeList.length > 0 ? a = this.__drawItemsIndexFreeList.pop() : (a = this.__drawItems.length, this.__drawItems.push(null)), this.__dirtyItemIndices.push(a);
        var i = this.__gl, s = new Gs(i, e, t, a, 1);
        e.setMetadata("glgeomItem", s);
        s.updated.connect(function (e) { switch (e) {
            case ps:
                if (-1 != _this.__dirtyItemIndices.indexOf(a))
                    return;
                _this.__dirtyItemIndices.push(a);
                break;
            case gs:
            case _s: break;
            case Zs:
                if (-1 != _this.__dirtyItemIndices.indexOf(a))
                    return;
                return _this.__dirtyItemIndices.push(a), void _this.__renderer.requestRedraw();
        } _this.__renderer.drawItemChanged(); });
        return this.__drawItems[a] = s, this.__renderer.requestRedraw(), e.setMetadata("glpass", this), s;
    };
    Xs.prototype.removeGeomItem = function (e) { if (e.getMetadata("glpass") != this)
        return; var t = e.getMetadata("glgeomItem"), a = t.getId(); return this.__drawItems[a] = null, this.__drawItemsIndexFreeList.push(a), this.__renderer.requestRedraw(), e.getMetadata("glpass"), e.deleteMetadata("glgeomItem"), t; };
    Xs.prototype.removeGLGeom = function (e, t) { var a = t.geomItemMappings.indexOf(e); t.geomItemMappings.splice(a, 1); };
    Xs.prototype.getGeomItem = function (e) { if (!(e >= this.__drawItems.length))
        return this.__drawItems[e]; console.warn("Invalid Draw Item id:" + e + " NumItems:" + (this.__drawItems.length - 1)); };
    Xs.prototype.__populateDrawItemDataArray = function (e, t, a) { var i = 24 * t; var s = 0; if (e.isCutawayEnabled()) {
        s |= 1;
    } var n = e.getLightmapCoordsOffset(); G.createFromFloat32Buffer(a.buffer, i + 0).set(s, 0, n.x, n.y); var l = e.getGeomMat4(), r = G.createFromFloat32Buffer(a.buffer, i + 4), o = G.createFromFloat32Buffer(a.buffer, i + 8), d = G.createFromFloat32Buffer(a.buffer, i + 12); r.set(l.xAxis.x, l.yAxis.x, l.zAxis.x, l.translation.x), o.set(l.xAxis.y, l.yAxis.y, l.zAxis.y, l.translation.y), d.set(l.xAxis.z, l.yAxis.z, l.zAxis.z, l.translation.z); var h = G.createFromFloat32Buffer(a.buffer, i + 16); if (e.isHighlighted()) {
        var t_220 = e.getHighlight();
        h.set(t_220.r, t_220.g, t_220.b, t_220.a);
    } var c = G.createFromFloat32Buffer(a.buffer, i + 20); if (e.isCutawayEnabled()) {
        var t_221 = e.getCutVector(), a_205 = e.getCutDist();
        c.set(t_221.x, t_221.y, t_221.z, a_205);
    } };
    Xs.prototype.newItemsReadyForLoading = function () { return this.__dirtyItemIndices.length > 0; };
    Xs.prototype.uploadGeomItems = function () { var e = this.__gl; if (!e.floatTexturesSupported) {
        var e_220 = this.__dirtyItemIndices.length;
        for (var t_222 = 0; t_222 < e_220; t_222++) {
            var e_221 = this.__drawItems[this.__dirtyItemIndices[t_222]];
            e_221 && e_221.updateGeomMatrix();
        }
        return void (this.__dirtyItemIndices = []);
    } var t = Math.round(Math.sqrt(6 * this.__drawItems.length) + .5); t = Math.nextPow2(t), t % 6 != 0 && (t += 6 - t % 6), this.__drawItemsTexture ? this.__drawItemsTexture.width != t && (this.__drawItemsTexture.resize(t, t), this.__dirtyItemIndices = Array(t * t / 6).fill().map(function (e, t) { return t; })) : (this.__drawItemsTexture = new Ua(e, { format: "RGBA", type: "FLOAT", width: t, height: t, filter: "NEAREST", wrap: "CLAMP_TO_EDGE", mipMapped: !1 }), this.__drawItemsTexture.clear()), e.bindTexture(e.TEXTURE_2D, this.__drawItemsTexture.glTex); var a = this.__drawItemsTexture.getTypeID(); for (var i_141 = 0; i_141 < this.__dirtyItemIndices.length; i_141++) {
        var s = this.__dirtyItemIndices[i_141], n = Math.floor(6 * s / t);
        var l = s + 1;
        for (var e_222 = i_141 + 1; e_222 < this.__dirtyItemIndices.length; e_222++) {
            var a_206 = this.__dirtyItemIndices[e_222];
            if (Math.floor(6 * a_206 / t) != n)
                break;
            if (a_206 != l)
                break;
            l++;
        }
        var r = l - s, o = 6 * s % t, d = 6 * r, h = 1, c = new Float32Array(24 * r);
        for (var e_223 = s; e_223 < l; e_223++) {
            var t_223 = this.__drawItems[e_223];
            t_223 && this.__populateDrawItemDataArray(t_223.getGeomItem(), e_223 - s, c);
        }
        if (a == e.FLOAT)
            this.__drawItemsTexture.populate(c, d, h, o, n, !1);
        else {
            var e_224 = Math.convertFloat32ArrayToUInt16Array(c);
            this.__drawItemsTexture.populate(e_224, d, h, o, n, !1);
        }
        i_141 += r - 1;
    } this.__dirtyItemIndices = []; };
    Xs.prototype.finalize = function () { 0 != this.__dirtyItemIndices.length && this.uploadGeomItems(); };
    Xs.prototype.bind = function (e) { var t = this.__gl, a = e.unifs; return this.__drawItemsTexture && a.instancesTexture && (this.__drawItemsTexture.bindToUniform(e, a.instancesTexture), t.uniform1i(a.instancesTextureSize.location, this.__drawItemsTexture.width)), !0; };
    Xs.prototype.bindShader = function (e, t) { return !!t.bind(e, this.constructor.name) && !!this.bind(e); };
    Xs.prototype.bindMaterial = function (e, t, a) { return t.bind(e, a); };
    return Xs;
}(Ki));
var ys = /** @class */ (function () {
    function ys(e, t) {
        this.gl = e, this.glgeom = t, this.glgeomItems = [], this.glgeomItems_freeIndices = [], this.glgeomItemSignalIds = [], this.drawIdsArray = null, this.drawIdsBuffer = null, this.drawIdsBufferDirty = !0, this.highlightedIdsArray = null, this.highlightedIdsBuffer = null, this.highlightedIdsBufferDirty = !0, this.lightmapName = void 0, this.drawCountChanged = new C, this.visibleItems = [], this.highlightedItems = [];
    }
    ys.prototype.getGLGeom = function () { return this.glgeom; };
    ys.prototype.getLightmapName = function () { return this.lightmapName; };
    ys.prototype.getDrawCount = function () { return this.visibleItems.length; };
    ys.prototype.addGeomItem = function (e) {
        var _this = this;
        var t;
        this.glgeomItems_freeIndices.length > 0 ? t = this.glgeomItems_freeIndices.pop() : (t = this.glgeomItems.length, this.glgeomItems.push(null)), e.visible && (this.visibleItems.push(t), this.drawCountChanged.emit(1)), e.getGeomItem().isHighlighted() && (this.highlightedItems.push(t), this.highlightedIdsBufferDirty = !0), 1 == this.glgeomItems.length && (this.lightmapName = e.getGeomItem().getLightmapName());
        var a = {};
        a.sel = e.highlightChanged.connect(function () { if (e.getGeomItem().isHighlighted()) {
            if (-1 != _this.highlightedItems.indexOf(t))
                return;
            _this.highlightedItems.push(t);
        }
        else
            _this.highlightedItems.splice(_this.highlightedItems.indexOf(t), 1); _this.highlightedIdsBufferDirty = !0; }), a.vis = e.visibilityChanged.connect(function (e) { e ? (_this.visibleItems.push(t), _this.drawCountChanged.emit(1)) : (_this.visibleItems.splice(_this.visibleItems.indexOf(t), 1), _this.drawCountChanged.emit(-1)), _this.drawIdsBufferDirty = !0; }), this.glgeomItems[t] = e, this.glgeomItemSignalIds[t] = a, this.drawIdsBufferDirty = !0;
    };
    ys.prototype.removeGeomItem = function (e) { var t = this.glgeomItems.indexOf(e), a = this.glgeomItemSignalIds[t]; e.highlightChanged.disconnectId(a.sel), e.visibilityChanged.disconnectId(a.vis), this.glgeomItems[t] = null, this.glgeomItemSignalIds[t] = null, this.glgeomItems_freeIndices.push(t), e.visible && (this.visibleItems.splice(this.visibleItems.indexOf(t), 1), this.drawCountChanged.emit(-1)), e.getGeomItem().isHighlighted() && this.highlightedItems.splice(this.highlightedItems.indexOf(t), 1), this.drawIdsBufferDirty = !0, 0 == this.glgeomItems.length && this.destroy(); };
    ys.prototype.updateDrawIDsBuffer = function () {
        var _this = this;
        var e = this.gl;
        e.floatTexturesSupported ? (this.drawIdsBuffer && this.glgeomItems.length != this.drawIdsArray.length && (this.gl.deleteBuffer(this.drawIdsBuffer), this.drawIdsBuffer = null), this.drawIdsBuffer || (this.drawIdsArray = new Float32Array(this.glgeomItems.length), this.drawIdsBuffer = e.createBuffer(), e.bindBuffer(e.ARRAY_BUFFER, this.drawIdsBuffer)), this.visibleItems.forEach(function (e, t) { _this.drawIdsArray[t] = _this.glgeomItems[e].getId(); }), e.bindBuffer(e.ARRAY_BUFFER, this.drawIdsBuffer), e.bufferData(e.ARRAY_BUFFER, this.drawIdsArray, e.STATIC_DRAW), this.drawIdsBufferDirty = !1) : this.drawIdsBufferDirty = !1;
    };
    ys.prototype.updateHighlightedIDsBuffer = function () {
        var _this = this;
        var e = this.gl;
        e.floatTexturesSupported ? (this.highlightedIdsBuffer && this.glgeomItems.length != this.highlightedIdsArray.length && (this.gl.deleteBuffer(this.highlightedIdsBuffer), this.highlightedIdsBuffer = null), (!this.highlightedIdsArray || this.highlightedItems.length > this.highlightedIdsArray.length) && (this.highlightedIdsArray = new Float32Array(this.highlightedItems.length), this.highlightedIdsBuffer && (e.deleteBuffer(this.highlightedIdsBuffer), this.highlightedIdsBuffer = null)), this.highlightedItems.forEach(function (e, t) { _this.highlightedIdsArray[t] = _this.glgeomItems[e].getId(); }), this.highlightedIdsBuffer || (this.highlightedIdsBuffer = e.createBuffer()), e.bindBuffer(e.ARRAY_BUFFER, this.highlightedIdsBuffer), e.bufferData(e.ARRAY_BUFFER, this.highlightedIdsArray, e.STATIC_DRAW), this.highlightedIdsBufferDirty = !1) : this.highlightedIdsBufferDirty = !1;
    };
    ys.prototype.draw = function (e) { if (0 == this.visibleItems.length)
        return; this.drawIdsBufferDirty && this.updateDrawIDsBuffer(); var t = this.gl, a = e.unifs; if (e.lightmaps && a.lightmap && e.boundLightmap != this.lightmapName) {
        var i_142 = e.lightmaps[this.lightmapName];
        i_142 && i_142.glimage.isLoaded() ? (i_142.glimage.bindToUniform(e, a.lightmap), t.uniform2fv(a.lightmapSize.location, i_142.atlasSize.asArray()), a.lightmapConnected && t.uniform1i(a.lightmapConnected.location, !0), e.boundLightmap = this.lightmapName) : a.lightmapConnected && t.uniform1i(a.lightmapConnected.location, !1);
    } this.__bindAndRender(e, this.visibleItems, this.drawIdsBuffer); };
    ys.prototype.drawHighlighted = function (e) { 0 != this.highlightedItems.length && (this.highlightedIdsBufferDirty && this.updateHighlightedIDsBuffer(), this.__bindAndRender(e, this.highlightedItems, this.highlightedIdsBuffer)); };
    ys.prototype.__bindAndRender = function (e, t, a) {
        var _this = this;
        var i = this.gl, s = e.unifs;
        if (e.glgeom != this.glgeom && (this.glgeom.bind(e), e.glgeom = this.glgeom), i.floatTexturesSupported && i.drawElementsInstanced && e.supportsInstancing) {
            i.uniform1i(e.unifs.instancedDraw.location, 1);
            var n = e.attrs.instancedIds.location;
            i.enableVertexAttribArray(n), i.bindBuffer(i.ARRAY_BUFFER, a), i.vertexAttribPointer(n, 1, i.FLOAT, !1, 4, 0), i.vertexAttribDivisor(n, 1), e.bindViewports(s, function () { _this.glgeom.drawInstanced(t.length); });
        }
        else
            e.unifs.instancedDraw && i.uniform1i(e.unifs.instancedDraw.location, 0), t.forEach(function (t) { _this.glgeomItems[t].bind(e), e.bindViewports(s, function () { _this.glgeom.draw(e); }); });
    };
    ys.prototype.destroy = function () { };
    return ys;
}());
var fs = /** @class */ (function () {
    function fs(e) {
        this.glshader = e.glshader, this.glgeomdatashader = e.glgeomdatashader, this.glselectedshader = e.glselectedshader, this.glmaterialGeomItemSets = [];
    }
    fs.prototype.findMaterialGeomItemSets = function (e) { for (var _b = 0, _c = this.glmaterialGeomItemSets; _b < _c.length; _b++) {
        var t_224 = _c[_b];
        if (t_224.glmaterial == e)
            return t_224;
    } };
    fs.prototype.addMaterialGeomItemSets = function (e) { this.glmaterialGeomItemSets.push(e); };
    fs.prototype.removeMaterialGeomItemSets = function (e) { var t = this.glmaterialGeomItemSets.indexOf(e); this.glmaterialGeomItemSets.splice(t, 1); };
    fs.prototype.getMaterialGeomItemSets = function () { return this.glmaterialGeomItemSets; };
    return fs;
}());
var Vs = /** @class */ (function () {
    function Vs(e) {
        this.glmaterial = e, this.geomItemSets = [], this.drawCount = 0, this.visibleInGeomDataBuffer = e.getMaterial().visibleInGeomDataBuffer, this.__drawCountChanged = this.__drawCountChanged.bind(this);
    }
    Vs.prototype.getGLMaterial = function () { return this.glmaterial; };
    Vs.prototype.__drawCountChanged = function (e) { this.drawCount += e; };
    Vs.prototype.addGeomItemSet = function (e) { -1 == this.geomItemSets.indexOf(e) ? (this.geomItemSets.push(e), this.drawCount += e.drawCount, e.drawCountChanged.connect(this.__drawCountChanged)) : console.warn("geomItemSet already added to GLMaterialGeomItemSets"); };
    Vs.prototype.removeGeomItemSet = function (e) { var t = this.geomItemSets.indexOf(e); this.geomItemSets.splice(t, 1), e.drawCountChanged.disconnect(this.__drawCountChanged), e.destroy(); };
    Vs.prototype.findGeomItemSet = function (e) { for (var _b = 0, _c = this.geomItemSets; _b < _c.length; _b++) {
        var t_225 = _c[_b];
        if (t_225.getGLGeom() == e)
            return t_225;
    } return null; };
    Vs.prototype.getGeomItemSets = function () { return this.geomItemSets; };
    return Vs;
}());
var Is = /** @class */ (function (_super) {
    __extends(Is, _super);
    function Is() {
        var _this = this;
        _this = _super.call(this) || this, _this.__glshadermaterials = {};
        return _this;
    }
    Is.prototype.init = function (e, t) { _super.prototype.init.call(this, e, t); };
    Is.prototype.filterGeomItem = function (e) { var t = e.getMaterial().getShaderClass(); if (t) {
        if (t.isTransparent())
            return !1;
        if (t.isOverlay())
            return !1;
        var a_207 = e.getMaterial().getParameter("BaseColor");
        return !(a_207 && a_207.getValue().a < 1);
    } return !1; };
    Is.prototype.addGeomItem = function (e) { var t = e.getMaterial(), a = t.getShaderName(), i = this.constructShaders(a); var s = this.addMaterial(t), n = _super.prototype.addGeomItem.call(this, e); var l = this.__glshadermaterials[a]; l || (l = new fs(i), this.__glshadermaterials[a] = l); var r = l.findMaterialGeomItemSets(s); r || (r = new Vs(s), l.addMaterialGeomItemSets(r)); var o = r.findGeomItemSet(n.glGeom); return o || (o = new ys(this.__gl, n.glGeom), r.addGeomItemSet(o)), e.setMetadata("geomItemSet", o), o.addGeomItem(n), !0; };
    Is.prototype.removeGeomItem = function (e) { var t = _super.prototype.removeGeomItem.call(this, e); if (!t)
        return !1; var a = e.getMetadata("geomItemSet"); return a && (a.removeGeomItem(t), e.deleteMetadata("geomItemSet")), !0; };
    Is.prototype.removeMaterial = function (e) { var t = this.__glshadermaterials[e.hash]; if (!t || t != e.getMetadata("glshaderMaterials"))
        return void console.warn("Material not found in pass"); var a = e.getMetadata("glmaterialGeomItemSets"); t.removeMaterialGeomItemSets(a); };
    Is.prototype.__traverseTreeAndDraw = function (e) { for (var t_228 in this.__glshadermaterials) {
        var a_208 = this.__glshadermaterials[t_228], i_143 = a_208.glshader;
        if (this.bindShader(e, i_143)) {
            var t_229 = a_208.getMaterialGeomItemSets();
            for (var _b = 0, t_226 = t_229; _b < t_226.length; _b++) {
                var a_209 = t_226[_b];
                if (0 != a_209.drawCount && this.bindMaterial(e, a_209.getGLMaterial(), !0)) {
                    var t_230 = a_209.getGeomItemSets();
                    for (var _c = 0, t_227 = t_230; _c < t_227.length; _c++) {
                        var a_210 = t_227[_c];
                        a_210.draw(e);
                    }
                }
            }
        }
        i_143.unbind(e);
    } e.glgeom && e.glgeom.unbind(e); };
    Is.prototype.draw = function (e) { this.newItemsReadyForLoading() && this.finalize(); var t = this.__gl; t.disable(t.BLEND), t.disable(t.CULL_FACE), t.enable(t.DEPTH_TEST), t.depthFunc(t.LESS), t.depthMask(!0), this.__traverseTreeAndDraw(e); };
    Is.prototype.drawHighlightedGeoms = function (e) { var t = this.__gl; t.disable(t.CULL_FACE); for (var t_231 in this.__glshadermaterials) {
        var a_212 = this.__glshadermaterials[t_231];
        if (!a_212.glselectedshader)
            continue;
        if (!this.bindShader(e, a_212.glselectedshader))
            continue;
        var i_145 = a_212.getMaterialGeomItemSets();
        for (var _b = 0, i_144 = i_145; _b < i_144.length; _b++) {
            var t_232 = i_144[_b];
            var a_213 = t_232.getGeomItemSets();
            for (var _c = 0, a_211 = a_213; _c < a_211.length; _c++) {
                var t_233 = a_211[_c];
                t_233.drawHighlighted(e);
            }
        }
    } e.glgeom && e.glgeom.unbind(e); };
    Is.prototype.getGeomItemAndDist = function (e) { var t, a; this.__gl.floatGeomBuffer ? (t = Math.round(e[1]), a = e[3]) : (t = e[0] + (e[1] << 8), a = Math.decode16BitFloatFrom2xUInt8([e[2], e[3]])); var i = this.__drawItems[t]; if (i)
        return { geomItem: i.getGeomItem(), dist: a }; };
    Is.prototype.drawGeomData = function (e) { this.newItemsReadyForLoading() && this.finalize(); var t = this.__gl; t.disable(t.BLEND), t.disable(t.CULL_FACE), t.enable(t.DEPTH_TEST), t.depthFunc(t.LESS), t.depthMask(!0); for (var a_215 in this.__glshadermaterials) {
        var i_146 = this.__glshadermaterials[a_215];
        if (!i_146.glgeomdatashader)
            continue;
        if (!this.bindShader(e, i_146.glgeomdatashader))
            continue;
        {
            var a_216 = e.unifs.floatGeomBuffer;
            a_216 && t.uniform1i(a_216.location, t.floatGeomBuffer ? 1 : 0);
        }
        {
            var a_217 = e.unifs.passId;
            a_217 && t.uniform1i(a_217.location, this.__passIndex);
        }
        var s = i_146.getMaterialGeomItemSets();
        for (var _b = 0, s_41 = s; _b < s_41.length; _b++) {
            var t_234 = s_41[_b];
            if (0 != t_234.drawCount && t_234.visibleInGeomDataBuffer && this.bindMaterial(e, t_234.getGLMaterial(), !1)) {
                var a_218 = t_234.getGeomItemSets();
                for (var _c = 0, a_214 = a_218; _c < a_214.length; _c++) {
                    var t_235 = a_214[_c];
                    t_235.draw(e);
                }
            }
        }
    } e.glgeom && e.glgeom.unbind(e); };
    return Is;
}(Xs));
Ui.registerPass(Is, Ni.OPAQUE);
var Rs = /** @class */ (function (_super) {
    __extends(Rs, _super);
    function Rs() {
        return _super.call(this) || this;
    }
    Rs.prototype.init = function (e, t) { _super.prototype.init.call(this, e, t), this.transparentItems = [], this.freeList = [], this.visibleItems = [], this.prevSortCameraPos = new Z(999, 999, 999), this.resort = !1; };
    Rs.prototype.filterGeomItem = function (e) { var t = e.getMaterial().getShaderClass(); if (t) {
        if (t.isTransparent())
            return !0;
        if (t.isOverlay())
            return !1;
        var a_219 = e.getMaterial().getParameter("BaseColor");
        if (a_219 && a_219.getValue().a < .999)
            return !0;
    } return !1; };
    Rs.prototype.addGeomItem = function (e) {
        var _this = this;
        var t = e.getMaterial(), a = t.getShaderName(), i = this.constructShaders(a), s = this.addMaterial(t), n = _super.prototype.addGeomItem.call(this, e), l = e.visibilityChanged.connect(function (e) { if (e)
            _this.visibleItems.push(o);
        else {
            var e_225 = _this.visibleItems.indexOf(o);
            _this.visibleItems.splice(e_225, 1);
        } }), r = e.geomXfoChanged.connect(function () { _this.resort = !0; }), o = { geomItem: e, shaders: i, glmaterial: s, glgeomitem: n, visibilityChangedId: l, geomXfoChangedId: r };
        var d;
        d = this.freeList.length > 0 ? this.freeList.pop() : this.transparentItems.length, this.transparentItems[d] = o, e.setMetadata("itemIndex", d), e.getVisible() && this.visibleItems.push(o), this.resort = !0;
    };
    Rs.prototype.removeGeomItem = function (e) { if (!_super.prototype.removeGeomItem.call(this, e))
        return; var t = e.getMetadata("itemIndex"), a = this.transparentItems[t]; this.transparentItems[t] = null, this.freeList.push(t); var i = this.visibleItems.indexOf(a); -1 != i && this.visibleItems.splice(i, 1); };
    Rs.prototype.sortItems = function (e) { for (var _b = 0, _c = this.visibleItems; _b < _c.length; _b++) {
        var t_236 = _c[_b];
        var a_220 = t_236.glgeomitem.geomItem.getGeomMat4();
        t_236.dist = a_220.translation.distanceTo(e);
    } this.visibleItems.sort(function (e, t) { return e.dist > t.dist ? -1 : e.dist < t.dist ? 1 : 0; }), this.prevSortCameraPos = e, this.resort = !1; };
    Rs.prototype._drawItem = function (e, t, a) { if (a.currentglMaterial != t.glmaterial && (a.currentglMaterial = t.glmaterial, !a.currentglMaterial.bind(e)))
        return; var i = t.glgeomitem; if ((a.currentglGeom == i.glGeom || (a.currentglGeom = i.glGeom, a.currentglGeom.bind(e))) && i.bind(e)) {
        if (e.unifs.instancedDraw) {
            var t_237 = this.__gl;
            t_237.uniform1i(e.unifs.instancedDraw.location, 0), t_237.disableVertexAttribArray(e.attrs.instancedIds.location);
        }
        e.bindViewports(e.unifs, function () { a.currentglGeom.draw(e); });
    } };
    Rs.prototype._drawItems = function (e) { var t = { currentglShader: null, currentglMaterial: null, currentglGeom: null }; for (var _b = 0, _c = this.visibleItems; _b < _c.length; _b++) {
        var a_221 = _c[_b];
        if (t.currentglShader != a_221.shaders.glshader) {
            if (!this.bindShader(e, a_221.shaders.glshader))
                continue;
            t.currentglShader = a_221.shaders.glshader;
        }
        this._drawItem(e, a_221, t);
    } t.currentglGeom && t.currentglGeom.unbind(e); };
    Rs.prototype.draw = function (e) { if (0 == this.visibleItems.length)
        return; this.newItemsReadyForLoading() && this.finalize(); var t = this.__gl, a = e.viewXfo.tr; (this.resort || a.distanceTo(this.prevSortCameraPos) > .3) && this.sortItems(a), t.enable(t.DEPTH_TEST), t.depthFunc(t.LESS), t.depthMask(!0), t.enable(t.BLEND), t.blendEquation(t.FUNC_ADD), e.pass = "MULTIPLY", t.blendFunc(t.DST_COLOR, t.ZERO), this._drawItems(e), e.pass = "ADD", t.blendFunc(t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA), this._drawItems(e), t.disable(t.BLEND); };
    Rs.prototype.drawHighlightedGeoms = function (e) { var t = this.__gl; t.disable(t.CULL_FACE); var a = { currentglShader: null, currentglMaterial: null, currentglGeom: null }; for (var _b = 0, _c = this.visibleItems; _b < _c.length; _b++) {
        var t_238 = _c[_b];
        if (!t_238.geomItem.isHighlighted())
            continue;
        if (!t_238.shaders.glselectedshader)
            continue;
        var i_147 = t_238.shaders;
        if (a.currentglShader != i_147.glselectedshader) {
            if (!this.bindShader(e, i_147.glselectedshader))
                continue;
            a.currentglShader = i_147.glselectedshader;
        }
        this._drawItem(e, t_238, a);
    } a.currentglGeom && a.currentglGeom.unbind(e); };
    Rs.prototype.getGeomItemAndDist = function (e) { var t, a; this.__gl.floatGeomBuffer ? (t = Math.round(e[1]), a = e[3]) : (t = e[0] + (e[1] << 8), a = Math.decode16BitFloatFrom2xUInt8([e[2], e[3]])); var i = this.__drawItems[t]; if (i)
        return { geomItem: i.getGeomItem(), dist: a }; };
    Rs.prototype.drawGeomData = function (e) { this.newItemsReadyForLoading() && this.finalize(); var t = this.__gl; t.disable(t.BLEND), t.disable(t.CULL_FACE), t.enable(t.DEPTH_TEST), t.depthFunc(t.LESS), t.depthMask(!0); var a = { currentglShader: null, currentglMaterial: null, currentglGeom: null }; for (var _b = 0, _c = this.visibleItems; _b < _c.length; _b++) {
        var i_148 = _c[_b];
        var s = i_148.shaders;
        if (a.currentglShader != s.glgeomdatashader) {
            if (!this.bindShader(e, s.glgeomdatashader))
                continue;
            a.currentglShader = s.glgeomdatashader;
        }
        {
            var a_222 = e.unifs.floatGeomBuffer;
            a_222 && t.uniform1i(a_222.location, t.floatGeomBuffer ? 1 : 0);
        }
        {
            var a_223 = e.unifs.passId;
            a_223 && t.uniform1i(a_223.location, this.__passIndex);
        }
        this._drawItem(e, i_148, a);
    } a.currentglGeom && a.currentglGeom.unbind(e); };
    return Rs;
}(Xs));
Ui.registerPass(Rs, Ni.TRANSPARENT);
var xs = /** @class */ (function (_super) {
    __extends(xs, _super);
    function xs() {
        return _super.call(this) || this;
    }
    xs.prototype.init = function (e, t) {
        var _this = this;
        _super.prototype.init.call(this, e, t), this.__billboards = [], this.__freeIndices = [], this.__drawCount = 0, this.__threshold = 0, this.__updateRequested = !1, this.__prevSortCameraPos = new Z, this.__atlas = new ui(this.__renderer.gl, "Billboards", "RGBA", "UNSIGNED_BYTE", [1, 1, 1, 0]), this.__atlas.loaded.connect(this.updated.emit), this.__atlas.updated.connect(this.updated.emit), this.__renderer.registerPass(function (e) { return e instanceof Za && (_this.addBillboard(e), !0); }, function (e) { return e instanceof Za && (_this.removeBillboard(e), !0); });
    };
    xs.prototype.filterRenderTree = function () { };
    xs.prototype.addBillboard = function (e) {
        var _this = this;
        var t = e.getParameter("image"), a = t.getValue();
        if (!a)
            return void t.valueChanged.connect(function () { return _this.addBillboard(e); });
        var i;
        i = this.__freeIndices.length > 0 ? this.__freeIndices.pop() : this.__billboards.length;
        var s = this.__atlas.addSubImage(a);
        e.setMetadata("GLBillboardsPass_Index", i);
        var n = e.visibilityChanged.connect(function () { e.getVisible() ? (_this.__drawCount++, _this.__updateBillboard(i)) : _this.__drawCount--, _this.__reqUpdateIndexArray(); }), l = e.getParameter("GlobalXfo").valueChanged.connect(function () { e.getVisible() && (_this.__updateBillboard(i), _this.updated.emit()); }), r = e.getParameter("alpha").valueChanged.connect(function () { e.getVisible() && (_this.__updateBillboard(i), _this.updated.emit()); });
        e.getVisible() && this.__drawCount++, this.__billboards[i] = { billboard: e, imageIndex: s, visibilityChangedId: n, xfoChangedId: l, alphaChangedId: r }, this.indexArrayUpdateNeeded = !0, this.__requestUpdate();
    };
    xs.prototype.removeBillboard = function (e) { var t = e.getMetadata("GLBillboardsPass_Index"); if (-1 == t)
        return void console.warn("Billboard already removed."); var a = this.__billboards[t], i = a.billboard.getParameter("image").getValue(); this.__atlas.removeSubImage(i), e.visibilityChanged.disconnectId(a.visibilityChangedId), e.getParameter("GlobalXfo").valueChanged.disconnectId(a.xfoChangedId), e.getParameter("alpha").valueChanged.disconnectId(a.alphaChangedId), this.__billboards[t] = null, this.__freeIndices.push(t), e.getVisible() && this.__drawCount--, this.indexArrayUpdateNeeded = !0, this.__requestUpdate(); };
    xs.prototype.__populateBillboardDataArray = function (e, t, a) { var i = e.billboard, s = i.getGlobalXfo().toMat4(), n = i.getParameter("scale").getValue(); var l = 0; i.getParameter("alignedToCamera").getValue() && (l |= 4); var r = i.getParameter("alpha").getValue(), o = i.getParameter("color").getValue(), d = 5 * t * 4, h = G.createFromFloat32Buffer(a.buffer, d), c = G.createFromFloat32Buffer(a.buffer, d + 4), m = G.createFromFloat32Buffer(a.buffer, d + 8), u = G.createFromFloat32Buffer(a.buffer, d + 12); h.set(s.xAxis.x, s.yAxis.x, s.zAxis.x, s.translation.x), c.set(s.xAxis.y, s.yAxis.y, s.zAxis.y, s.translation.y), m.set(s.xAxis.z, s.yAxis.z, s.zAxis.z, s.translation.z), u.set(n, l, e.imageIndex, r), G.createFromFloat32Buffer(a.buffer, d + 16).set(o.r, o.g, o.b, o.a); };
    xs.prototype.__requestUpdate = function () {
        var _this = this;
        this.__updateRequested || (this.__updateRequested = !0, setTimeout(function () { _this.__updateBillboards(); }, 100));
    };
    xs.prototype.__reqUpdateIndexArray = function () {
        var _this = this;
        this.indexArrayUpdateNeeded || (this.indexArrayUpdateNeeded = !0, this.updateIndexArrayId = setTimeout(function () { _this.indexArrayUpdateNeeded && (_this.__updateIndexArray(), _this.updated.emit()); }, 1));
    };
    xs.prototype.__updateIndexArray = function () { var e = this.__gl; this.__indexArray && this.__indexArray.length != this.__drawCount && (e.deleteBuffer(this.__instanceIdsBuffer), this.__instanceIdsBuffer = null), this.__indexArray = new Float32Array(this.__drawCount); var t = 0; for (var e_226 = 0; e_226 < this.__billboards.length; e_226++)
        this.__billboards[e_226] && this.__billboards[e_226].billboard.getVisible() && (this.__indexArray[t] = e_226, t++); this.__instanceIdsBuffer || (this.__instanceIdsBuffer = e.createBuffer()), e.bindBuffer(e.ARRAY_BUFFER, this.__instanceIdsBuffer), e.bufferData(e.ARRAY_BUFFER, this.__indexArray, e.STATIC_DRAW), this.indexArrayUpdateNeeded = !1; };
    xs.prototype.__updateBillboards = function () {
        var _this = this;
        this.indexArrayUpdateNeeded && this.__updateIndexArray();
        var e = this.__gl;
        if (!this.__glshader) {
            e.__quadVertexIdsBuffer || e.setupInstancedQuad(), this.__glshader = new Ji(e);
            var t_239 = this.__glshader.compileForTarget("GLBillboardsPass", this.__renderer.getShaderPreproc());
            this.__shaderBinding = Ea(e, t_239.attrs, e.__quadattrbuffers, e.__quadIndexBuffer);
        }
        var t = function () { if (_this.__atlas.renderAtlas(), !e.floatTexturesSupported || !e.drawElementsInstanced)
            return _this.__modelMatrixArray = [], _this.__billboardDataArray = [], _this.__tintColorArray = [], _this.__indexArray.forEach(function (e) { var t = _this.__billboards[e], a = t.billboard, i = a.getGlobalXfo().toMat4(), s = a.getParameter("scale").getValue(), n = a.getParameter("flags").getValue(), l = a.getParameter("alpha").getValue(), r = a.getParameter("color").getValue(); _this.__modelMatrixArray[e] = i.asArray(), _this.__billboardDataArray[e] = [s, n, t.imageIndex, l], _this.__tintColorArray[e] = [r.r, r.g, r.b, r.a]; }), void (_this.__updateRequested = !1); var t = Math.round(Math.sqrt(5 * (_this.__billboards.length - _this.__freeIndices.length)) + .5); t % 5 != 0 && (t += 5 - t % 5), _this.__width = t, _this.__drawItemsTexture ? _this.__drawItemsTexture.resize(t, t) : (_this.__drawItemsTexture = new Ua(e, { format: "RGBA", type: "FLOAT", width: t, height: t, filter: "NEAREST", wrap: "CLAMP_TO_EDGE", mipMapped: !1 }), _this.__drawItemsTexture.clear()), _this.__indexArray.forEach(function (e) { -1 != e && _this.__updateBillboard(e); }), _this.__updateRequested = !1; };
        this.__atlas.isLoaded() ? t() : this.__atlas.loaded.connect(t);
    };
    xs.prototype.__updateBillboard = function (e) { if (0 == this.__drawCount || !this.__drawItemsTexture)
        return; var t = this.__billboards[e]; if (!t.billboard.getVisible())
        return; var a = this.__gl, i = new Float32Array(20); this.__populateBillboardDataArray(t, 0, i), a.bindTexture(a.TEXTURE_2D, this.__drawItemsTexture.glTex); var s = 5 * e % this.__width, n = Math.floor(5 * e / this.__width), l = this.__drawItemsTexture.getType(), r = this.__drawItemsTexture.getFormat(); if ("FLOAT" == l)
        a.texSubImage2D(a.TEXTURE_2D, 0, s, n, 5, 1, a[r], a[l], i);
    else {
        var e_227 = Math.convertFloat32ArrayToUInt16Array(i);
        a.texSubImage2D(a.TEXTURE_2D, 0, s, n, 5, 1, a[r], a[l], e_227);
    } };
    xs.prototype.sort = function (e) {
        var _this = this;
        for (var _b = 0, _c = this.__billboards; _b < _c.length; _b++) {
            var t_240 = _c[_b];
            t_240 && t_240.billboard.getVisible() && (t_240.dist = t_240.billboard.getGlobalXfo().tr.distanceTo(e));
        }
        this.__indexArray.sort(function (e, t) { return -1 == e ? 1 : -1 == t || _this.__billboards[e].dist > _this.__billboards[t].dist ? -1 : _this.__billboards[e].dist < _this.__billboards[t].dist ? 1 : 0; });
        var t = this.__gl;
        t.floatTexturesSupported && this.__instanceIdsBuffer && (t.bindBuffer(t.ARRAY_BUFFER, this.__instanceIdsBuffer), t.bufferData(t.ARRAY_BUFFER, this.__indexArray, t.STATIC_DRAW));
    };
    xs.prototype.draw = function (e) {
        var _this = this;
        if (0 == this.__drawCount || !this.__atlas.isReady() || this.__updateRequested)
            return;
        this.indexArrayUpdateNeeded && this.__updateIndexArray();
        var t = this.__gl;
        t.disable(t.CULL_FACE), t.enable(t.BLEND), t.blendEquation(t.FUNC_ADD), t.blendFunc(t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA);
        var a = e.viewXfo.tr;
        if (a.distanceTo(this.__prevSortCameraPos) > this.__threshold)
            if (this.sort(a), this.__prevSortCameraPos = a.clone(), this.__drawCount > 1) {
                var e_228 = this.__billboards[this.__indexArray[0]].billboard.getGlobalXfo().tr, t_241 = this.__billboards[this.__indexArray[1]].billboard.getGlobalXfo().tr;
                this.__threshold = e_228.distanceTo(t_241);
            }
            else
                this.__threshold = 9999;
        this.__glshader.bind(e), this.__shaderBinding.bind(e);
        var i = e.unifs;
        if (this.__atlas.bindToUniform(e, i.atlasBillboards), t.floatTexturesSupported && t.drawElementsInstanced) {
            this.__drawItemsTexture.bindToUniform(e, i.instancesTexture), t.uniform1i(i.instancesTextureSize.location, this.__width);
            {
                var a_224 = e.attrs.instanceIds.location;
                t.enableVertexAttribArray(a_224), t.bindBuffer(t.ARRAY_BUFFER, this.__instanceIdsBuffer), t.vertexAttribPointer(a_224, 1, t.FLOAT, !1, 4, 0), t.vertexAttribDivisor(a_224, 1);
            }
            e.bindViewports(i, function () { t.drawElementsInstanced(t.TRIANGLES, 6, t.UNSIGNED_SHORT, 0, _this.__drawCount); });
        }
        else {
            var a_225 = this.__indexArray.length;
            for (var s = 0; s < a_225; s++)
                t.uniformMatrix4fv(i.modelMatrix.location, !1, this.__modelMatrixArray[s]), t.uniform4fv(i.billboardData.location, this.__billboardDataArray[s]), t.uniform4fv(i.tintColor.location, this.__tintColorArray[s]), t.uniform4fv(i.layoutData.location, this.__atlas.getLayoutData(this.__billboards[s].imageIndex)), e.bindViewports(i, function () { t.drawQuad(); });
        }
        t.disable(t.BLEND);
    };
    return xs;
}(Ki));
Ui.registerPass(xs, Ni.TRANSPARENT);
var Ss = /** @class */ (function (_super) {
    __extends(Ss, _super);
    function Ss() {
        return _super.call(this) || this;
    }
    Ss.prototype.init = function (e, t) { _super.prototype.init.call(this, e, t); };
    Ss.prototype.filterGeomItem = function (e) { if (e.isOverlay())
        return !0; var t = e.getMaterial().getShaderClass(); return !(!t || !t.isOverlay()); };
    Ss.prototype.draw = function (e) { this.newItemsReadyForLoading() && this.finalize(); var t = this.__gl; t.clear(t.DEPTH_BUFFER_BIT), t.enable(t.CULL_FACE), t.cullFace(t.BACK), t.enable(t.BLEND), t.blendEquation(t.FUNC_ADD), e.pass = "ADD", t.blendFunc(t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA), this.__traverseTreeAndDraw(e), t.disable(t.BLEND); };
    Ss.prototype.drawGeomData = function (e) { var t = this.__gl; t.clear(t.DEPTH_BUFFER_BIT), t.enable(t.BLEND), t.blendEquation(t.FUNC_ADD), e.pass = "ADD", t.blendFunc(t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA), _super.prototype.drawGeomData.call(this, e), t.disable(t.BLEND), t.enable(t.DEPTH_TEST); };
    return Ss;
}(Is));
Ui.registerPass(Ss, Ni.OVERLAY);
var Ws = window.AudioContext || window.webkitAudioContext || !1;
var Ls;
Ws ? Ls = new Ws : alert("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox");
var vs = /** @class */ (function (_super) {
    __extends(vs, _super);
    function vs() {
        var _this = this;
        _this = _super.call(this) || this, _this.__audioItems = [];
        return _this;
    }
    vs.prototype.init = function (e, t) {
        var _this = this;
        _super.prototype.init.call(this, e, t), Ls && this.__renderer.registerPass(function (e) { if (e instanceof da)
            return e.audioSourceCreated.connect(function (t) { _this.addAudioSource(e, t, e); }), !0; if (e instanceof ma) {
            var t_242 = e.getMaterial();
            if (t_242) {
                var a_226 = t_242.getParameter("BaseColor");
                if (a_226 && a_226.getImage && a_226.getImage()) {
                    var t_243 = a_226.getImage();
                    t_243.loaded.connect(function () { if (t_243.getAudioSource) {
                        var a_227 = t_243.getAudioSource();
                        (a_227 instanceof HTMLMediaElement || a_227 instanceof AudioBufferSourceNode) && _this.addAudioSource(e, a_227, t_243);
                    } });
                }
            }
            return !1;
        } }, function (e) { });
    };
    vs.prototype.addAudioSource = function (e, t, a) { if (t.addedToCollector)
        return; var i; i = t instanceof HTMLMediaElement ? Ls.createMediaElementSource(t) : t instanceof AudioBufferSourceNode ? t : Ls.createMediaStreamSource(t); var s = Ls.createGain(), n = a.getParameter("Gain"); var l, r; n && (l = n, r = s.gain, l && (r.setValueAtTime(l.getValue(), 0), r.setValueAtTime(l.getValue(), 5), l.valueChanged.connect(function () { r.value = l.getValue(); }))), i.connect(s); var o = a.getParameter("SpatializeAudio"); if (o && 0 == o.getValue())
        i.connect(Ls.destination);
    else {
        var t_244 = Ls.createPanner();
        t_244.panningModel = "HRTF", t_244.distanceModel = "inverse", i.connect(t_244), t_244.connect(Ls.destination);
        var s_42 = function (e) { var i = a.getParameter(e); i && (t_244[e] = i.getValue(), i.valueChanged.connect(function () { t_244[e] = i.getValue(); })); };
        s_42("coneInnerAngle"), s_42("coneOuterAngle"), s_42("coneOuterGain");
        var n_35 = function () { var a; a = e instanceof ma ? e.getGeomMat4() : e.getGlobalXfo().toMat4(); var i = a.translation; t_244.setPosition(i.x, i.y, i.z); var s = a.zAxis; t_244.setOrientation(s.x, s.y, s.z); };
        n_35(), e.globalXfoChanged.connect(function (e) { n_35(); });
    } t.addedToCollector = !0, this.__audioItems.push({ treeItem: e, audioSource: t, parameterOwner: a }), this.updated.emit(); };
    vs.prototype.__updateListenerPosition = function (e) { if (!Ls)
        return; var t = Ls.listener; t.setPosition(e.tr.x, e.tr.y, e.tr.z); var a = e.ori.getYaxis(), i = e.ori.getZaxis().negate(); t.setOrientation(i.x, i.y, i.z, a.x, a.y, a.z); };
    vs.prototype.draw = function (e) { 0 != this.__audioItems.length && this.__updateListenerPosition(e.viewXfo); };
    return vs;
}(Ki));
Ui.registerPass(vs, Ni.OVERLAY), window && (window.ZeaAudioaudioCtx = Ls);
var Ms = Object.freeze({ __proto__: null, create3DContext: za, GLTexture2D: Ua, GLMesh: ka, GLLines: Ba, GLPoints: Da, GLMaterial: ri, GLShader: Aa, GLFbo: qa, GLRenderTarget: oi, GLRenderer: Ui, GLBaseViewport: Si, GLViewport: Wi, shaderLibrary: Qa, generateShaderGeomBinding: Ea, BillboardShader: Ji, ConvolverShader: bi, DepthMapShader: Pi, EnvMapShader: _i, BackgroundImageShader: Zi, OctahedralEnvMapShader: Gi, LatLongEnvMapShader: Xi, SterioLatLongEnvMapShader: yi, DualFishEyeEnvMapShader: fi, DualFishEyeToLatLongBackgroundShader: Vi, EnvProjectionShader: Ei, OctahedralEnvProjectionShader: Hi, LatLongEnvProjectionShader: ki, FatLinesShader: Bi, FlatSurfaceShader: Di, FlatAlphaSurfaceShader: Oi, LayeredCarPaintShader: Qi, LinesShader: ji, NormalsShader: qi, PointsShader: $i, FatPointsShader: es, FatPointsGeomDataShader: ts, FatPointsSelectedShader: as, PostProcessing: is, ScreenQuadShader: Ri, SimpleSurfaceShader: ss, StandardSurfaceShader: ns, StandardSurfaceGeomDataShader: ls, StandardSurfaceSelectedGeomsShader: rs, HandleShader: os, HandleGeomDataShader: ds, TransparentSurfaceShader: hs, ScreenSpaceShader: cs, ToolIconShader: ms, UnpackHDRShader: ja, UnpackLDRAlphaImageShader: us, WireShader: bs, GLPass: Ki, PassType: Ni, GLStandardGeomsPass: Xs, GLOpaqueGeomsPass: Is, GLTransparentGeomsPass: Rs, GLBillboardsPass: xs, GLOverlayPass: Ss, GLAudioItemsPass: vs, get audioCtx() { return Ls; }, VRViewport: Mi });
var Fs = /** @class */ (function () {
    function Fs(e) {
        this.__name = e || this.constructor.name, this.__stateEvents = [], this.__activationActions = [], this.__deactivationActions = [];
    }
    Fs.prototype.getName = function () { return this.__name; };
    Fs.prototype.setName = function (e) { this.__name = e; };
    Fs.prototype.setStateMachine = function (e) { this.__stateMachine = e; };
    Fs.prototype.getStateMachine = function () { return this.__stateMachine; };
    Fs.prototype.activate = function () { this.__stateEvents.forEach(function (e) { e.activate(); }), this.__activationActions.forEach(function (e) { e.activate(); }); };
    Fs.prototype.deactivate = function () { this.__stateEvents.forEach(function (e) { e.deactivate(); }), this.__deactivationActions.forEach(function (e) { e.activate(); }); };
    Fs.prototype.addStateEvent = function (e) { e.setState(this), this.__stateEvents.push(e); };
    Fs.prototype.getStateEvent = function (e) { return this.__stateEvents[e]; };
    Fs.prototype.addActivationAction = function (e) { e.setState(this), this.__activationActions.push(e); };
    Fs.prototype.getActivationAction = function (e) { return this.__activationActions[e]; };
    Fs.prototype.addDeactivationAction = function (e) { e.setState(this), this.__deactivationActions.push(e); };
    Fs.prototype.toJSON = function (e, t) { var a = { name: this.__name, type: this.constructor.name }, i = []; for (var _b = 0, _c = this.__stateEvents; _b < _c.length; _b++) {
        var a_228 = _c[_b];
        i.push(a_228.toJSON(e, t));
    } a.stateEvents = i; var s = []; for (var _d = 0, _f = this.__activationActions; _d < _f.length; _d++) {
        var a_229 = _f[_d];
        s.push(a_229.toJSON(e, t));
    } a.activationActions = s; var n = []; for (var _g = 0, _h = this.__deactivationActions; _g < _h.length; _g++) {
        var a_230 = _h[_g];
        n.push(a_230.toJSON(e, t));
    } return a.deactivationActions = n, a; };
    Fs.prototype.fromJSON = function (e, t, a) { this.__name = e.name; for (var _b = 0, _c = e.stateEvents; _b < _c.length; _b++) {
        var a_231 = _c[_b];
        var e_229 = J.constructClass(a_231.type);
        e_229.fromJSON(a_231, t), this.addStateEvent(e_229);
    } for (var _d = 0, _f = e.activationActions; _d < _f.length; _d++) {
        var a_232 = _f[_d];
        var e_230 = J.constructClass(a_232.type);
        e_230.fromJSON(a_232, t), this.addActivationAction(e_230);
    } for (var _g = 0, _h = e.deactivationActions; _g < _h.length; _g++) {
        var a_233 = _h[_g];
        var e_231 = J.constructClass(a_233.type);
        e_231.fromJSON(a_233, t), this.addDeactivationAction(e_231);
    } };
    return Fs;
}());
J.registerClass("State", Fs);
var Ts = /** @class */ (function (_super) {
    __extends(Ts, _super);
    function Ts(e) {
        var _this = this;
        _this = _super.call(this) || this, _this.__name = e, _this.__childActions = [], _this.__outputs = {};
        return _this;
    }
    Ts.prototype.addOutput = function (e) { return this.__outputs[e.getName()] = e, e; };
    Ts.prototype.getOutput = function (e) { return this.__outputs[e]; };
    Ts.prototype.setState = function (e) { this.__state = e, this.__childActions.forEach(function (t) { t.setState(e); }); };
    Ts.prototype.addChild = function (e) { this.__childActions.push(e), e.setState(this.__state); };
    Ts.prototype.getChild = function (e) { return this.__childActions[e]; };
    Ts.prototype.activate = function () { console.warn("activate must be implmented by each action. this:" + this.constructor.name); };
    Ts.prototype.addChild = function (e) { this.__childActions.push(e), e.setState(this.__state); };
    Ts.prototype.deactivate = function () { };
    Ts.prototype.__onDone = function () { this.__childActions.forEach(function (e) { e.activate(); }); };
    Ts.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); a || (a = {}), a.type = J.getClassName(this); var i = []; for (var _b = 0, _c = this.__childActions; _b < _c.length; _b++) {
        var a_234 = _c[_b];
        i.push(a_234.toJSON(e, t));
    } a.childActions = i; var s = {}; for (var a_235 in this.__outputs)
        s[a_235] = this.__outputs[a_235].toJSON(e, t); return a.outputs = s, a; };
    Ts.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a); for (var _b = 0, _c = e.childActions; _b < _c.length; _b++) {
        var a_236 = _c[_b];
        var e_232 = J.constructClass(a_236.type);
        if (!e_232)
            throw new Error("Invalid type:" + a_236.type);
        e_232.fromJSON(a_236, t), this.addChild(e_232);
    } for (var a_237 in e.outputs)
        this.__outputs[a_237].fromJSON(e.outputs[a_237], t); };
    Ts.prototype.destroy = function () { _super.prototype.destroy.call(this), this.__outputs = []; };
    return Ts;
}(q));
var Cs = /** @class */ (function (_super) {
    __extends(Cs, _super);
    function Cs(e) {
        var _this = this;
        _this = _super.call(this) || this, _this.__name = e, _this.__onEvent = _this.__onEvent.bind(_this);
        return _this;
    }
    Cs.prototype.__onEvent = function () { this.__childActions.forEach(function (e) { e.activate(); }); };
    return Cs;
}(Ts));
var Ys = /** @class */ (function (_super) {
    __extends(Ys, _super);
    function Ys(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__states = {}, _this.stateChanged = new C, _this.setFlag($.USER_EDITED), J.isConstructing() || J.invokeCallbacks(_this);
        return _this;
    }
    Ys.prototype.addState = function (e) { e.setStateMachine(this), this.__states[e.getName()] = e, 1 == Object.keys(this.__states).length && null == this.__initialStateName && (this.__initialStateName = e.getName()); };
    Ys.prototype.getState = function (e) { return this.__states[e]; };
    Ys.prototype.activateState = function (e) { if (!this.__states[e])
        throw new Error("Invalid state transtion:" + e); this.__currentState != this.__states[e] && (this.__currentState && this.__currentState.deactivate(), this.__currentState = this.__states[e], this.__currentState.activate(), this.stateChanged.emit(e)); };
    Ys.prototype.getActiveState = function () { return this.__currentState; };
    Ys.prototype.getActiveStateName = function () { return this.__currentState.constructor.name; };
    Ys.prototype.getInitialState = function () { return this.__initialStateName; };
    Ys.prototype.setInitialState = function (e) { this.__initialStateName = e; };
    Ys.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); a.initialStateName = this.__initialStateName; var i = {}; for (var a_238 in this.__states)
        i[a_238] = this.__states[a_238].toJSON(e, t); return a.states = i, a; };
    Ys.prototype.fromJSON = function (e, t, a) { _super.prototype.fromJSON.call(this, e, t, a), this.__initialStateName = e.initialStateName, t.stateMachine = this; for (var a_239 in e.states) {
        var i_149 = e.states[a_239], s = J.constructClass(i_149.type);
        if (!s)
            throw new Error("Invalid type:" + i_149.type);
        s.fromJSON(i_149, t), this.addState(s);
    } t.addPLCB(function () { }); };
    return Ys;
}(te));
J.registerClass("StateMachine", Ys);
var Ns = /** @class */ (function (_super) {
    __extends(Ns, _super);
    function Ns() {
        var _this = this;
        _this = _super.call(this) || this, _this.__targetStateParam = _this.addParameter(new Me("TargetState", ""));
        return _this;
    }
    Ns.prototype.activate = function () { this.__state.getStateMachine().activateState(this.__targetStateParam.getValue()); };
    return Ns;
}(Ts));
J.registerClass("SwitchState", Ns);
var Ks = /** @class */ (function (_super) {
    __extends(Ks, _super);
    function Ks() {
        var _this = this;
        _this = _super.call(this) || this, _this.addParameter(new Ne("Camera", function (e) { return e instanceof Ga; })), _this.addParameter(new Ie("cameraPos")), _this.addParameter(new Ie("cameraTarget")), _this.addParameter(new Xe("interpTime", 1)), _this.addParameter(new Xe("updateFrequency", 30));
        return _this;
    }
    Ks.prototype.SetCameraPositionAndTarget = function (e, t) { this.getParameter("cameraPos").setValue(e), this.getParameter("cameraTarget").setValue(t); };
    Ks.prototype.activate = function () {
        var _this = this;
        var e = this.getParameter("Camera").getValue();
        if (!e)
            return void console.warn("Camera not assigned to SetCameraPositionAndTarget state action");
        var t = this.getParameter("cameraPos").getValue(), a = this.getParameter("cameraTarget").getValue(), i = this.getParameter("interpTime").getValue();
        if (i > 0) {
            var s = e.getGlobalXfo().tr, n = e.getTargetPostion(), l_21 = (s.subtract(n).length(), this.getParameter("updateFrequency").getValue()), r_11 = t.subtract(a).length();
            var o_10 = !0, d_4 = 0, h_1 = 0;
            var c_1 = Math.round(i * l_21);
            var m_4 = !1;
            var u_2 = function () { m_4 || (o_10 = !1); };
            e.globalXfoChanged.connect(u_2);
            var b_1 = function () { if (h_1++, h_1 < c_1) {
                var i_150 = h_1 / c_1, s_43 = Math.smoothStep(0, 1, i_150), n_36 = (s_43 - d_4) / (1 - i_150);
                d_4 = s_43;
                var u_3 = e.getGlobalXfo().tr, p_2 = e.getTargetPostion(), g_2 = u_3.subtract(p_2).length();
                var _2 = u_3;
                var Z_1 = p_2.lerp(a, n_36);
                o_10 && (_2 = u_3.lerp(t, n_36));
                var G_1 = _2.subtract(Z_1), X_1 = (G_1.length(), Math.lerp(g_2, r_11, n_36));
                G_1.scaleInPlace(X_1 / G_1.length()), m_4 = !0, e.setPositionAndTarget(Z_1.add(G_1), Z_1), m_4 = !1, _this.__timeoutId = window.setTimeout(b_1, 1e3 / l_21);
            }
            else
                e.globalXfoChanged.disconnect(u_2), e.movementFinished.emit(), _this.__timeoutId = void 0, _this.__onDone(); };
            b_1();
        }
        else
            e.setPositionAndTarget(t, a);
    };
    Ks.prototype.cancel = function () { this.__timeoutId && (clearTimeout(this.__timeoutId), this.__timeoutId = void 0); };
    return Ks;
}(Ts));
J.registerClass("SetCameraPositionAndTarget", Ks);
var ws = /** @class */ (function (_super) {
    __extends(ws, _super);
    function ws() {
        var _this = this;
        _this = _super.call(this) || this, _this.__interpTimeParam = _this.addParameter(new Xe("InterpTime", 1)), _this.__updateFrequencyParam = _this.addParameter(new Xe("UpdateFrequency", 30)), _this.__outParam = _this.addOutput(new xa("Param")), _this.__outParam.paramSet.connect(function () { if (!_this.__valueParam || _this.__outParam.getParam().getDataType() != _this.__valueParam.getDataType()) {
            var e_233 = _this.__outParam.getParam().clone();
            e_233.setName("Value"), _this.__outParam.getInitialValue ? e_233.setValue(_this.__outParam.getInitialValue()) : e_233.setValue(_this.__outParam.getParam().getValue()), _this.__valueParam = _this.addParameter(e_233);
        } });
        return _this;
    }
    ws.prototype.activate = function () {
        var _this = this;
        if (this.__outParam.isConnected()) {
            var e_234 = this.__interpTimeParam.getValue();
            if (e_234 > 0) {
                var t_245 = this.__updateFrequencyParam.getValue(), a_240 = this.__outParam.getValue(), i_151 = this.__valueParam.getValue();
                var s_44 = 0;
                var n_37 = Math.round(e_234 / (1 / t_245)), l_22 = function () { if (s_44++, s_44 < n_37) {
                    var e_235 = s_44 / n_37, r = Math.smoothStep(0, 1, e_235), o = Math.lerp(a_240, i_151, r);
                    _this.__outParam.setValue(o, E.GENERATED_VALUE), _this.__timeoutId = window.setTimeout(l_22, 1e3 / t_245);
                }
                else
                    _this.__outParam.setValue(_this.__valueParam.getValue(), E.GENERATED_VALUE), _this.__timeoutId = void 0, _this.__onDone(); };
                l_22();
            }
            else
                this.__outParam.setValue(this.__valueParam.getValue(), E.GENERATED_VALUE), this.__onDone();
        }
    };
    ws.prototype.cancel = function () { this.__timeoutId && (clearTimeout(this.__timeoutId), this.__timeoutId = void 0); };
    ws.prototype.toJSON = function (e, t) { var a = _super.prototype.toJSON.call(this, e, t); return this.__valueParam && (a.valueParamType = this.__valueParam.constructor.name), a; };
    ws.prototype.fromJSON = function (e, t, a) { if (e.valueParamType) {
        var t_246 = J.constructClass(e.valueParamType, "Value");
        t_246 && (this.__valueParam = this.addParameter(t_246));
    } _super.prototype.fromJSON.call(this, e, t, a); };
    return ws;
}(Ts));
J.registerClass("SetParameterValue", ws);
var zs = /** @class */ (function (_super) {
    __extends(zs, _super);
    function zs(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__geomParam = _this.addParameter(new Ne("TreeItem")), _this.__geomParam.valueChanged.connect(function () { _this.__geom = _this.__geomParam.getValue(); });
        return _this;
    }
    zs.prototype.__geomClicked = function (e) { e.stopPropagation(), this.__onEvent(); };
    zs.prototype.activate = function () { this.__geom && this.__geom.mouseDown.connect(this.__geomClicked.bind(this)); };
    zs.prototype.deactivate = function () { this.__geom && this.__geom.mouseDown.disconnect(this.__geomClicked.bind(this)); };
    return zs;
}(Cs));
J.registerClass("GeomClicked", zs);
var Us = /** @class */ (function (_super) {
    __extends(Us, _super);
    function Us(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.onKeyPressed = _this.onKeyPressed.bind(_this), _this.__keyParam = _this.addParameter(new Me("Key", ""));
        return _this;
    }
    Us.prototype.onKeyPressed = function (e) { console.log(e.key), e.key == this.__keyParam.getValue() && this.__onEvent(); };
    Us.prototype.activate = function () { document.addEventListener("keydown", this.onKeyPressed); };
    Us.prototype.deactivate = function () { document.removeEventListener("keydown", this.onKeyPressed); };
    return Us;
}(Cs));
J.registerClass("KeyPressedEvent", Us);
var Js = /** @class */ (function (_super) {
    __extends(Js, _super);
    function Js(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.__waitTimeParam = _this.addParameter(new Xe("WaitTime", 1));
        return _this;
    }
    Js.prototype.activate = function () {
        var _this = this;
        this.__timeoutId = window.setTimeout(function () { delete _this.__timeoutId, _this.__onEvent(); }, 1e3 * this.__waitTimeParam.getValue());
    };
    Js.prototype.deactivate = function () { this.__timeoutId && window.clearTimeout(this.__timeoutId); };
    return Js;
}(Cs));
J.registerClass("TimedWait", Js);
var Ps = __assign(__assign(__assign(__assign(__assign(__assign({ onResize: e }, a), T), w), wa), Ms), Object.freeze({ __proto__: null, State: Fs, StateAction: Ts, StateEvent: Cs, StateMachine: Ys, SwitchState: Ns, SetCameraPositionAndTarget: Ks, SetParameterValue: ws, GeomClicked: zs, KeyPressedEvent: Us, TimedWait: Js }));
var ie$1 = {}, ne$1 = {}, oe$1 = [];
var ae$1 = /** @class */ (function () {
    function ae$1() {
        this.__undoStack = [], this.__redoStack = [], this.changeAdded = new C, this.changeUpdated = new C, this.changeUndone = new C, this.changeRedone = new C, this.__currChangeUpdated = this.__currChangeUpdated.bind(this);
    }
    ae$1.prototype.flush = function () { for (var _b = 0, _c = this.__undoStack; _b < _c.length; _b++) {
        var e_236 = _c[_b];
        e_236.destroy();
    } this.__undoStack = []; for (var _d = 0, _f = this.__redoStack; _d < _f.length; _d++) {
        var e_237 = _f[_d];
        e_237.destroy();
    } this.__redoStack = []; };
    ae$1.prototype.addChange = function (e) { this.getCurrentChange() && this.getCurrentChange().updated.disconnect(this.__currChangeUpdated), this.__undoStack.push(e), e.updated.connect(this.__currChangeUpdated); for (var _b = 0, _c = this.__redoStack; _b < _c.length; _b++) {
        var e_238 = _c[_b];
        e_238.destroy();
    } this.__redoStack = [], this.changeAdded.emit(e); };
    ae$1.prototype.getCurrentChange = function () { return this.__undoStack[this.__undoStack.length - 1]; };
    ae$1.prototype.__currChangeUpdated = function (e) { this.changeUpdated.emit(e); };
    ae$1.prototype.undo = function (e) {
        if (e === void 0) { e = !0; }
        if (this.__undoStack.length > 0) {
            var t_247 = this.__undoStack.pop();
            t_247.undo(), e && (this.__redoStack.push(t_247), this.changeUndone.emit());
        }
    };
    ae$1.prototype.redo = function () { if (this.__redoStack.length > 0) {
        var e_239 = this.__redoStack.pop();
        e_239.redo(), this.__undoStack.push(e_239), this.changeRedone.emit();
    } };
    ae$1.prototype.constructChange = function (e) { return new ie$1[e]; };
    ae$1.getChangeClassName = function (e) { var t = oe$1.indexOf(e.constructor); return ne$1[t] ? ne$1[t] : (console.warn("Change not registered:", e.constructor.name), e.constructor.name); };
    ae$1.registerChange = function (e, t) { -1 != oe$1.indexOf(t) && console.warn("Class already registered:", e); var s = oe$1.length; oe$1.push(t), ie$1[e] = t, ne$1[s] = e; };
    return ae$1;
}());
var re$1 = /** @class */ (function () {
    function re$1(t) {
        this.name = t || ae$1.getChangeClassName(this), this.updated = new C;
    }
    re$1.prototype.undo = function () { throw new Error("Implement me"); };
    re$1.prototype.redo = function () { throw new Error("Implement me"); };
    re$1.prototype.update = function (e) { throw new Error("Implement me"); };
    re$1.prototype.toJSON = function (e) { return {}; };
    re$1.prototype.fromJSON = function (e, t) { };
    re$1.prototype.changeFromJSON = function (e) { this.update(e); };
    re$1.prototype.destroy = function () { };
    return re$1;
}());
var le$1 = /** @class */ (function (_super) {
    __extends(le$1, _super);
    function le$1(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.captured = !1;
        return _this;
    }
    le$1.prototype.highlight = function () { };
    le$1.prototype.unhighlight = function () { };
    le$1.prototype.getManipulationPlane = function () { var e = this.getGlobalXfo(); return new x(e.tr, e.ori.getZaxis()); };
    le$1.prototype.onMouseEnter = function (e) { this.highlight(); };
    le$1.prototype.onMouseLeave = function (e) { this.unhighlight(); };
    le$1.prototype.onMouseDown = function (e) { e.setCapture(this), e.stopPropagation(), this.captured = !0, e.viewport ? this.handleMouseDown(e) : e.vrviewport && this.onVRControllerButtonDown(e); };
    le$1.prototype.onMouseMove = function (e) { this.captured && (e.stopPropagation(), e.viewport ? this.handleMouseMove(e) : e.vrviewport && this.onVRPoseChanged(e)); };
    le$1.prototype.onMouseUp = function (e) { this.captured && (e.releaseCapture(), e.stopPropagation(), this.captured = !1, e.viewport ? this.handleMouseUp(e) : e.vrviewport && this.onVRControllerButtonUp(e)); };
    le$1.prototype.onWheel = function (e) { };
    le$1.prototype.handleMouseDown = function (e) { this.gizmoRay = this.getManipulationPlane(); var t = e.mouseRay.intersectRayPlane(this.gizmoRay); return e.grabPos = e.mouseRay.pointAtDist(t), this.onDragStart(e), !0; };
    le$1.prototype.handleMouseMove = function (e) { var t = e.mouseRay.intersectRayPlane(this.gizmoRay); return e.holdPos = e.mouseRay.pointAtDist(t), this.onDrag(e), !0; };
    le$1.prototype.handleMouseUp = function (e) { var t = e.mouseRay.intersectRayPlane(this.gizmoRay); return e.releasePos = e.mouseRay.pointAtDist(t), this.onDragEnd(e), !0; };
    le$1.prototype.onVRControllerButtonDown = function (e) { this.activeController = e.controller; var t = this.activeController.getTipXfo().clone(), s = this.getManipulationPlane(), i = t.tr.subtract(s.start), n = t.tr.subtract(s.dir.scale(i.dot(s.dir))); return e.grabPos = n, this.onDragStart(e), !0; };
    le$1.prototype.onVRPoseChanged = function (e) { if (this.activeController) {
        var t_248 = this.activeController.getTipXfo(), s = this.getManipulationPlane(), i_152 = t_248.tr.subtract(s.start), n = t_248.tr.subtract(s.dir.scale(i_152.dot(s.dir)));
        return e.holdPos = n, this.onDrag(e), !0;
    } };
    le$1.prototype.onVRControllerButtonUp = function (e) { if (this.activeController == e.controller) {
        var t_249 = this.activeController.getTipXfo();
        return this.onDragEnd(e, t_249.tr), this.activeController = void 0, !0;
    } };
    le$1.prototype.onDragStart = function (e) { console.log("onDragStart", e); };
    le$1.prototype.onDrag = function (e) { console.log("onDrag", e); };
    le$1.prototype.onDragEnd = function (e) { console.log("onDragEnd", e); };
    return le$1;
}(ra));
var he$1 = /** @class */ (function (_super) {
    __extends(he$1, _super);
    function he$1(e) {
        return _super.call(this, e) || this;
    }
    he$1.prototype.handleMouseDown = function (e) { this.gizmoRay = this.getManipulationPlane(), this.grabDist = e.mouseRay.intersectRayVector(this.gizmoRay)[1]; var t = this.gizmoRay.pointAtDist(this.grabDist); return e.grabDist = this.grabDist, e.grabPos = t, this.onDragStart(e), !0; };
    he$1.prototype.handleMouseMove = function (e) { var t = e.mouseRay.intersectRayVector(this.gizmoRay)[1], s = this.gizmoRay.pointAtDist(t); e.holdDist = t, e.holdPos = s, e.value = t, e.delta = t - this.grabDist, this.onDrag(e); };
    he$1.prototype.handleMouseUp = function (e) { var t = e.mouseRay.intersectRayVector(this.gizmoRay)[1], s = this.gizmoRay.pointAtDist(t); return e.releasePos = s, this.onDragEnd(e), !0; };
    he$1.prototype.onVRControllerButtonDown = function (e) { this.gizmoRay = this.getManipulationPlane(), this.activeController = e.controller; var t = this.activeController.getTipXfo(); this.grabDist = t.tr.subtract(this.gizmoRay.start).dot(this.gizmoRay.dir); var s = this.gizmoRay.start.add(this.gizmoRay.dir.scale(this.grabDist)); return e.grabPos = s, this.onDragStart(e), !0; };
    he$1.prototype.onVRPoseChanged = function (e) { var t = this.activeController.getTipXfo().tr.subtract(this.gizmoRay.start).dot(this.gizmoRay.dir), s = this.gizmoRay.start.add(this.gizmoRay.dir.scale(t)); return e.value = t, e.holdPos = s, e.delta = t - this.grabDist, this.onDrag(e), !0; };
    he$1.prototype.onVRControllerButtonUp = function (e) { if (this.activeController == e.controller)
        return this.onDragEnd(), this.activeController = void 0, !0; };
    return he$1;
}(le$1));
var de$1 = /** @class */ (function (_super) {
    __extends(de$1, _super);
    function de$1(e, t, s) {
        if (s === void 0) { s = E.USER_SETVALUE; }
        var _this = this;
        e ? (_this = _super.call(this, e ? e.getName() + " Changed" : "ParameterValueChange") || this, _this.__prevValue = e.getValue(), _this.__param = e, _this.__mode = s, null != t && (_this.__nextValue = t, _this.__param.setValue(_this.__nextValue, s))) : _this = _super.call(this) || this;
        return _this;
    }
    de$1.prototype.undo = function () { this.__param && this.__param.setValue(this.__prevValue, this.__mode); };
    de$1.prototype.redo = function () { this.__param && this.__param.setValue(this.__nextValue, this.__mode); };
    de$1.prototype.update = function (e) { if (!this.__param)
        return; this.__nextValue = e.value; var t = e.mode ? e.mode : this.__mode; this.__param.setValue(this.__nextValue, t), this.updated.emit(e); };
    de$1.prototype.toJSON = function (e) { var t = { name: this.name, paramPath: this.__param.getPath() }; return null != this.__nextValue && (this.__nextValue.toJSON ? t.value = this.__nextValue.toJSON() : t.value = this.__nextValue), t; };
    de$1.prototype.fromJSON = function (e, t) { var s = t.appData.scene.getRoot().resolvePath(e.paramPath, 1); s && s instanceof Q ? (this.__param = s, this.__prevValue = this.__param.getValue(), this.__prevValue.clone ? this.__nextValue = this.__prevValue.clone() : this.__nextValue = this.__prevValue, this.name = e.name, null != e.value && this.changeFromJSON(e)) : console.warn("resolvePath is unable to resolve", e.paramPath); };
    de$1.prototype.changeFromJSON = function (e) { this.__param && (this.__nextValue.fromJSON ? this.__nextValue.fromJSON(e.value) : this.__nextValue = e.value, this.__param.setValue(this.__nextValue, E.REMOTEUSER_SETVALUE)); };
    return de$1;
}(re$1));
ae$1.registerChange("ParameterValueChange", de$1);
var ue$1 = /** @class */ (function (_super) {
    __extends(ue$1, _super);
    function ue$1(e) {
        return _super.call(this, e) || this;
    }
    ue$1.prototype.setTargetParam = function (e, t) {
        var _this = this;
        if (t === void 0) { t = !0; }
        if (this.param = e, t) {
            var t_250 = function () { _this.setGlobalXfo(e.getValue()); };
            t_250(), e.valueChanged.connect(t_250);
        }
    };
    ue$1.prototype.getTargetParam = function () { return this.param ? this.param : this.getParameter("GlobalXfo"); };
    ue$1.prototype.onDragStart = function (e) { this.baseXfo = this.getGlobalXfo().clone(), this.baseXfo.sc.set(1, 1, 1), this.deltaXfo = new S; var t = this.getTargetParam(), s = t.getValue(); this.offsetXfo = this.baseXfo.inverse().multiply(s), this.vec0 = e.grabPos.subtract(this.baseXfo.tr), this.grabCircleRadius = this.vec0.length(), this.vec0.normalizeInPlace(), e.undoRedoManager && (this.change = new de$1(t), e.undoRedoManager.addChange(this.change)); };
    ue$1.prototype.onDrag = function (e) { var t = e.holdPos.subtract(this.baseXfo.tr), s = t.length(); t.normalizeInPlace(); var i = s / this.grabCircleRadius; var n = this.vec0.angleTo(t) * i; if (this.vec0.cross(t).dot(this.baseXfo.ori.getZaxis()) < 0 && (n = -n), this.range && (n = Math.clamp(n, this.range[0], this.range[1])), e.shiftKey) {
        var e_240 = Math.degToRad(22.5);
        n = Math.floor(n / e_240) * e_240;
    } this.deltaXfo.ori.setFromAxisAndAngle(new Z(0, 0, 1), n); var o = this.baseXfo.multiply(this.deltaXfo).multiply(this.offsetXfo); if (this.change)
        this.change.update({ value: o });
    else {
        this.getTargetParam().setValue(o);
    } };
    ue$1.prototype.onDragEnd = function (e) { this.change = null; };
    return ue$1;
}(le$1));
var be$1 = /** @class */ (function (_super) {
    __extends(be$1, _super);
    function be$1(e, t, s) {
        var _this = this;
        _this = _super.call(this, "SelectionChange") || this, _this.__selectionManager = e, _this.__prevSelection = t, _this.__newSelection = s;
        return _this;
    }
    be$1.prototype.undo = function () { this.__selectionManager.setSelection(this.__prevSelection, !1); };
    be$1.prototype.redo = function () { this.__selectionManager.setSelection(this.__newSelection, !1); };
    be$1.prototype.toJSON = function (e) { var t = _super.prototype.toJSON.call(this, e), s = []; for (var _b = 0, _c = this.__newSelection; _b < _c.length; _b++) {
        var e_241 = _c[_b];
        s.push(e_241.getPath());
    } return t.itemPaths = s, t; };
    be$1.prototype.fromJSON = function (e, t) { _super.prototype.fromJSON.call(this, e, t), this.__selectionManager = t.appData.selectionManager, this.__prevSelection = new Set(this.__selectionManager.getSelection()); var s = t.appData.scene.getRoot(), i = new Set; for (var _b = 0, _c = e.itemPaths; _b < _c.length; _b++) {
        var t_251 = _c[_b];
        i.add(s.resolvePath(t_251, 1));
    } this.__newSelection = i, this.__selectionManager.setSelection(this.__newSelection, !1); };
    return be$1;
}(re$1));
ae$1.registerChange("SelectionChange", be$1);
var we$1 = /** @class */ (function (_super) {
    __extends(we$1, _super);
    function we$1(e, t) {
        var _this = this;
        _this = _super.call(this, "Selection Visibility Change") || this, _this.selection = e, _this.state = t, _this.do(_this.state);
        return _this;
    }
    we$1.prototype.undo = function () { this.do(!this.state); };
    we$1.prototype.redo = function () { this.do(this.state); };
    we$1.prototype.do = function (e) { for (var _b = 0, _c = this.selection; _b < _c.length; _b++) {
        var t_252 = _c[_b];
        t_252.getParameter("Visible").setValue(e);
    } };
    return we$1;
}(re$1));
ae$1.registerChange("ToggleSelectionVisibility", we$1);
var Pe$1 = new Z(0, 0, 1);
var Se$1 = /** @class */ (function (_super) {
    __extends(Se$1, _super);
    function Se$1(e, t, s) {
        var _this = this;
        e ? (_this = _super.call(this, e.getName() + " Added") || this, _this.treeItem = e, _this.owner = t, _this.selectionManager = s, _this.prevSelection = new Set(_this.selectionManager.getSelection()), _this.treeItemIndex = _this.owner.addChild(_this.treeItem), _this.selectionManager.setSelection(new Set([_this.treeItem]), !1), _this.treeItem.addRef(_this)) : _this = _super.call(this) || this;
        return _this;
    }
    Se$1.prototype.undo = function () { if (this.treeItem instanceof Ra) {
        this.treeItem.detach();
    }
    else
        this.treeItem instanceof ra && this.treeItem.traverse(function (e) { if (e instanceof Ra) {
            e.detach();
        } }, !1); this.owner.removeChild(this.treeItemIndex), this.selectionManager && this.selectionManager.setSelection(this.prevSelection, !1); };
    Se$1.prototype.redo = function () { if (this.treeItem instanceof Ra) {
        this.treeItem.reattach();
    }
    else
        subTreeItem instanceof ra && this.treeItem.traverse(function (e) { if (e instanceof Ra) {
            e.reattach();
        } }, !1); this.owner.addChild(this.treeItem), this.selectionManager && this.selectionManager.setSelection(new Set([this.treeItem]), !1); };
    Se$1.prototype.toJSON = function (e) { return { name: this.name, treeItem: this.treeItem.toJSON(e), treeItemPath: this.treeItem.getPath(), treeItemIndex: this.treeItemIndex }; };
    Se$1.prototype.fromJSON = function (e, t) { var s = J.constructClass(e.treeItem.type); s ? (this.name = e.name, this.treeItem = s, this.treeItem.addRef(this), this.treeItem.fromJSON(e.treeItem, t), this.treeItemIndex = this.owner.addChild(this.treeItem, !1, !1)) : console.warn("resolvePath is unable to conostruct", e.treeItem); };
    Se$1.prototype.destroy = function () { this.treeItem.removeRef(this); };
    return Se$1;
}(re$1));
ae$1.registerChange("TreeItemAddChange", Se$1);
var Re$1 = /** @class */ (function (_super) {
    __extends(Re$1, _super);
    function Re$1(e, s) {
        var _this = this;
        if (_this = _super.call(this) || this, _this.items = [], _this.itemOwners = [], _this.itemPaths = [], _this.itemIndices = [], e) {
            _this.selectionManager = s.selectionManager, _this.prevSelection = new Set(_this.selectionManager.getSelection()), _this.items = e, _this.newSelection = new Set(_this.prevSelection);
            var i_153 = [];
            _this.items.forEach(function (e) { var s = e.getOwner(), n = s.getChildIndex(e); if (i_153.push(e.getName()), e.addRef(_this), _this.itemOwners.push(s), _this.itemPaths.push(e.getPath()), _this.itemIndices.push(n), _this.selectionManager && _this.newSelection.has(e) && _this.newSelection.delete(e), e instanceof Ra) {
                e.detach();
            }
            else
                e instanceof ra && e.traverse(function (e) { if (e instanceof Ra) {
                    e.detach();
                } _this.selectionManager && _this.newSelection.has(e) && _this.newSelection.delete(e); }, !1); s.removeChild(n); }), _this.selectionManager.setSelection(_this.newSelection, !1), _this.name = i_153 + " Deleted";
        }
        return _this;
    }
    Re$1.prototype.undo = function () {
        var _this = this;
        this.items.forEach(function (e, s) { if (_this.itemOwners[s].insertChild(e, _this.itemIndices[s], !1, !1), e instanceof Ra) {
            e.reattach();
        }
        else
            subTreeItem instanceof ra && e.traverse(function (e) { if (e instanceof Ra) {
                e.reattach();
            } }, !1); }), this.selectionManager && this.selectionManager.setSelection(this.prevSelection, !1);
    };
    Re$1.prototype.redo = function () {
        var _this = this;
        this.selectionManager && this.selectionManager.setSelection(this.newSelection, !1), this.items.forEach(function (e, s) { if (_this.itemOwners[s].removeChild(_this.itemIndices[s]), e instanceof Ra) {
            e.detach();
        }
        else
            subTreeItem instanceof ra && e.traverse(function (e) { if (e instanceof Ra) {
                e.detach();
            } }, !1); });
    };
    Re$1.prototype.toJSON = function (e) { var t = { name: this.name, items: [], itemPaths: this.itemPaths, itemIndices: this.itemIndices }; return this.items.forEach(function (e) { t.items.push(e.toJSON()); }), t; };
    Re$1.prototype.fromJSON = function (e, t) {
        var _this = this;
        this.name = e.name, e.itemPaths.forEach(function (e) { var s = t.scene.getRoot().resolvePath(e, 1); if (!s)
            return void console.warn("resolvePath is unable to resolve", e); var i = s.getOwner(); _this.itemOwners.push(i), _this.itemPaths.push(s.getPath()), _this.itemIndices.push(i.getChildIndex(s)); });
    };
    Re$1.prototype.destroy = function () {
        var _this = this;
        this.items.forEach(function (e) { return e.removeRef(_this); });
    };
    return Re$1;
}(re$1));
ae$1.registerChange("TreeItemsRemoveChange", Re$1);
var xe$1 = /** @class */ (function (_super) {
    __extends(xe$1, _super);
    function xe$1(e, t) {
        var _this = this;
        e ? (console.log("TreeItemMoveChange"), _this = _super.call(this, e.getName() + " Added") || this, _this.treeItem = e, _this.oldOwner = _this.treeItem.getOwner(), _this.oldOwnerIndex = _this.oldOwner.getChildIndex(_this.treeItem), _this.newOwner = t, _this.newOwner.addChild(_this.treeItem, !0)) : _this = _super.call(this) || this;
        return _this;
    }
    xe$1.prototype.undo = function () { this.oldOwner.insertChild(this.treeItem, this.oldOwnerIndex, !0); };
    xe$1.prototype.redo = function () { this.newOwner.addChild(this.treeItem, !0); };
    xe$1.prototype.toJSON = function (e) { return { name: this.name, treeItemPath: this.treeItem.getPath(), newOwnerPath: this.newOwner.getPath() }; };
    xe$1.prototype.fromJSON = function (e, t) { var s = appData.scene.getRoot().resolvePath(e.treeItemPath, 1); if (!s)
        return void console.warn("resolvePath is unable to resolve", e.treeItemPath); var i = appData.scene.getRoot().resolvePath(e.newOwnerPath, 1); i ? (this.name = e.name, this.treeItem = s, this.newOwner = i, this.oldOwner = this.treeItem.getOwner(), this.oldOwnerIndex = this.oldOwner.getChildIndex(this.treeItem), this.newOwner.addChild(this.treeItem, !0)) : console.warn("resolvePath is unable to resolve", e.newOwnerPath); };
    return xe$1;
}(re$1));
ae$1.registerChange("TreeItemMoveChange", xe$1);
var Ve$1 = /** @class */ (function () {
    function Ve$1(e) {
    }
    return Ve$1;
}());
var Ae$1 = new /** @class */ (function () {
    function class_10() {
        this.treeItemFactories = [], this.widgetFactories = [], this.inspectorFactories = [];
    }
    class_10.prototype.registerInpector = function (e, t) { this.inspectorFactories.push({ inspector: e, rule: t }); };
    class_10.prototype.constructInspector = function () {
        var _b;
        var e = [];
        for (var _c = 0; _c < arguments.length; _c++) {
            e[_c] = arguments[_c];
        }
        var t = e[0];
        for (var s = this.inspectorFactories.length; s-- > 0;) {
            var i_154 = this.inspectorFactories[s];
            if (i_154.rule(t))
                return new ((_b = i_154.inspector).bind.apply(_b, __spreadArrays([void 0], e)))();
        }
        console.warn("Inspector factory not found for parameter '" + t.getName() + "' of class '" + t.constructor.name + "'");
    };
    class_10.prototype.registerTreeItemElement = function (e, t) { this.treeItemFactories.push({ treeItemElement: e, rule: t }); };
    class_10.prototype.constructTreeItemElement = function () {
        var _b;
        var e = [];
        for (var _c = 0; _c < arguments.length; _c++) {
            e[_c] = arguments[_c];
        }
        var t = e[0];
        for (var s = this.treeItemFactories.length; s-- > 0;) {
            var i_155 = this.treeItemFactories[s];
            if (i_155.rule(t))
                return new ((_b = i_155.treeItemElement).bind.apply(_b, __spreadArrays([void 0], e)))();
        }
        console.warn("Tree item factory not found for parameter '" + t.getName() + "' of class '" + t.constructor.name + "'");
    };
    class_10.prototype.registerWidget = function (e, t) { this.widgetFactories.push({ widget: e, rule: t }); };
    class_10.prototype.findWidgetReg = function (e) { for (var t_253 = this.widgetFactories.length; t_253-- > 0;) {
        var s = this.widgetFactories[t_253];
        if (s.rule(e))
            return s;
    } };
    class_10.prototype.constructWidget = function () {
        var _b;
        var e = [];
        for (var _c = 0; _c < arguments.length; _c++) {
            e[_c] = arguments[_c];
        }
        var t = e[0];
        for (var s = this.widgetFactories.length; s-- > 0;) {
            var i_156 = this.widgetFactories[s];
            if (i_156.rule(t))
                return new ((_b = i_156.widget).bind.apply(_b, __spreadArrays([void 0], e)))();
        }
        console.warn("Widget factory not found for parameter '" + t.getName() + "' of class '" + t.constructor.name + "'");
    };
    return class_10;
}());
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_11, _super);
    function class_11(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("input");
        var o, a;
        n.setAttribute("id", e.getName()), n.setAttribute("type", "checkbox"), n.setAttribute("tabindex", 0), n.checked = e.getValue(), t.appendChild(n), e.valueChanged.connect(function (t) { o || (n.checked = e.getValue(), t == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), a && clearTimeout(a), a = setTimeout(function () { n.classList.remove("user-edited"), a = null; }, 1500))); }), n.addEventListener("input", function () { o = new de$1(e, n.checked), s.undoRedoManager.addChange(o), o = void 0; });
        return _this;
    }
    return class_11;
}(Ve$1)), function (e) { return e instanceof fe; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_12, _super);
    function class_12(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = new iro.ColorPicker(t, { width: 200, height: 200, color: e.getValue().getAsRGBDict(), anticlockwise: !0, borderWidth: 1, borderColor: "#fff" });
        var a, r = void 0, l = !1;
        e.valueChanged.connect(function (t) { r || (l = !0, n.color.rgb = e.getValue().getAsRGBDict(), l = !1, t == E.REMOTEUSER_SETVALUE && (n.el.classList.add("user-edited"), a && clearTimeout(a), a = setTimeout(function () { n.el.classList.remove("user-edited"), a = null; }, 1500))); }), n.on("input:start", function () { console.log("input:start", e.getValue().getAsRGBDict()), r = new de$1(e), s.undoRedoManager.addChange(r); }), n.on("input:end", function () { console.log("input:end"), r = void 0; }), n.on("color:change", function (t, i) { if (l)
            return; var a = new y; a.setFromRGBDict(n.color.rgb), r ? r.update({ value: a }) : (r = new de$1(e, a), s.undoRedoManager.addChange(r)); });
        return _this;
    }
    class_12.prototype.setParentDomElem = function (e) { };
    return class_12;
}(Ve$1)), function (e) { return e instanceof xe; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_13, _super);
    function class_13(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = e.getRange(), o = document.createElement("input"), a = [];
        if (n) {
            a.push("mdl-slider"), a.push("mdl-js-slider"), o.className = a.join(" "), o.setAttribute("id", e.getName()), o.setAttribute("type", "range"), o.setAttribute("min", 0), o.setAttribute("max", 200);
            var t_254 = (e.getValue() - n[0]) / (n[1] - n[0]) * 200;
            o.setAttribute("value", t_254);
            var s_45 = e.getStep();
            s_45 ? o.setAttribute("step", s_45) : o.setAttribute("step", 1), o.setAttribute("tabindex", 0);
        }
        else
            o.className = a.join(" "), o.setAttribute("id", e.getName()), o.setAttribute("type", "number"), o.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), o.setAttribute("value", e.getValue()), o.setAttribute("tabindex", 0);
        t.appendChild(o);
        var r, l = void 0;
        function h(e, t) {
            if (t === void 0) { t = 6; }
            return Number(Math.round(e + "e" + t) + "e-" + t);
        }
        e.valueChanged.connect(function (t) { l || (o.value = n ? (e.getValue() - n[0]) / (n[1] - n[0]) * 200 : e.getValue(), t == E.REMOTEUSER_SETVALUE && (o.classList.add("user-edited"), r && clearTimeout(r), r = setTimeout(function () { o.classList.remove("user-edited"), r = null; }, 1500))); });
        var d = function () { var t = h(o.valueAsNumber); n && (t = n[0] + t / 200 * (n[1] - n[0]), t = Math.clamp(t, n[0], n[1])), l ? l.update({ value: t }) : (l = new de$1(e, t), s.undoRedoManager.addChange(l)); }, c = function () { l && (e.setValueDone(), l = void 0); };
        o.addEventListener("input", function () { d(); }), o.addEventListener("change", c), o.addEventListener("keydown", (function (e) { 38 !== e.which && 40 !== e.which || (38 === e.which && (o.valueAsNumber = h(o.valueAsNumber + .1)), 40 === e.which && (o.valueAsNumber = h(o.valueAsNumber - .1)), d(), e.preventDefault()); })), o.addEventListener("focusout", c);
        return _this;
    }
    return class_13;
}(Ve$1)), function (e) { return e instanceof Xe; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_14, _super);
    function class_14(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("input");
        var o, a;
        n.className = "mdl-textfield__input", n.setAttribute("id", e.getName()), n.setAttribute("type", "text"), n.setAttribute("value", e.getValue()), n.setAttribute("tabindex", 0), t.appendChild(n), e.valueChanged.connect(function (t) { o || (n.value = e.getValue(), t == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), a && clearTimeout(a), a = setTimeout(function () { n.classList.remove("user-edited"), a = null; }, 1500))); });
        var r = function () { var t = n.value; o ? o.update({ value: t }) : (o = new de$1(e, t), s.undoRedoManager.addChange(o)); };
        n.addEventListener("input", r), n.addEventListener("change", function () { r(), o = void 0; });
        return _this;
    }
    return class_14;
}(Ve$1)), function (e) { return e instanceof Me; });
function Xe$1(e, t) {
    if (t === void 0) { t = 6; }
    return Math.abs(e) < Number("1e-6") ? 0 : Number(Math.round(e + "e" + t) + "e-" + t);
}
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_15, _super);
    function class_15(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("div");
        n.setAttribute("id", e.getName()), n.textContent = e.getValue(), n.style.width = "100%";
        var o = Math.min(50, e.getValue().split("\n").length);
        n.style.height = 14 * Math.max(8, o + 2) + "px", t.appendChild(n);
        var a = ace.edit(n);
        var r, l;
        a.setTheme("ace/theme/chrome"), a.session.setMode("ace/mode/javascript"), e.valueChanged.connect(function (t) { r || (a.session.setValue(e.getValue()), t == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), l && clearTimeout(l), l = setTimeout(function () { n.classList.remove("user-edited"), l = null; }, 1500))); });
        var h = function () { (function () { var t = a.getValue(); r ? r.update({ value: t }) : (r = new de$1(e, t), s.undoRedoManager.addChange(r)); })(), e.setValueDone(), r = void 0; };
        n.addEventListener("keydown", function (e) { e.ctrlKey && "s" == e.key && (h(), e.preventDefault()), e.stopPropagation(); });
        return _this;
    }
    return class_15;
}(Ve$1)), function (e) { return e instanceof Fe; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_16, _super);
    function class_16(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("div");
        n.className = "container";
        var o = document.createElement("ul");
        o.className = "flex-editvalues", n.appendChild(o);
        var a = document.createElement("input");
        a.setAttribute("id", e.getName()), a.setAttribute("type", "number"), a.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), a.setAttribute("value", e.getValue().x), a.setAttribute("tabindex", 0), a.style.width = "100%";
        var r = document.createElement("li");
        r.appendChild(a), o.appendChild(r);
        var l = document.createElement("input");
        l.setAttribute("id", e.getName()), l.setAttribute("type", "number"), l.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), l.setAttribute("value", e.getValue().y), l.setAttribute("tabindex", 0), l.style.width = "100%";
        var h = document.createElement("li");
        h.appendChild(l), o.appendChild(h), t.appendChild(n);
        var d, c = void 0;
        e.valueChanged.connect(function () { if (!c) {
            var t_255 = e.getValue();
            a.value = Xe$1(t_255.x), l.value = Xe$1(t_255.y), mode == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), d && clearTimeout(d), d = setTimeout(function () { n.classList.remove("user-edited"), d = null; }, 1500));
        } });
        var m = function () { var t = new _(a.valueAsNumber, l.valueAsNumber); c ? c.update({ value: t }) : (c = new de$1(e, t), s.undoRedoManager.addChange(c)); }, u = function () { m(), c = void 0; };
        a.addEventListener("input", m), l.addEventListener("input", m), a.addEventListener("change", u), l.addEventListener("change", u);
        return _this;
    }
    return class_16;
}(Ve$1)), function (e) { return e instanceof Ve; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_17, _super);
    function class_17(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("div");
        n.className = "container";
        var o = document.createElement("ul");
        o.className = "flex-editvalues", n.appendChild(o);
        var a = document.createElement("input");
        a.setAttribute("id", e.getName()), a.setAttribute("type", "number"), a.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), a.setAttribute("value", e.getValue().x), a.setAttribute("tabindex", 0), a.style.width = "100%";
        var r = document.createElement("li");
        r.appendChild(a), o.appendChild(r);
        var l = document.createElement("input");
        l.setAttribute("id", e.getName()), l.setAttribute("type", "number"), l.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), l.setAttribute("value", e.getValue().y), l.setAttribute("tabindex", 0), l.style.width = "100%";
        var h = document.createElement("li");
        h.appendChild(l), o.appendChild(h);
        var d = document.createElement("input");
        d.setAttribute("id", e.getName()), d.setAttribute("type", "number"), d.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), d.setAttribute("value", e.getValue().z), d.setAttribute("tabindex", 0), d.style.width = "100%";
        var c = document.createElement("li");
        c.appendChild(d), o.appendChild(c), t.appendChild(n);
        var u, g = void 0;
        e.valueChanged.connect(function () { if (!g) {
            var t_256 = e.getValue();
            a.value = Xe$1(t_256.x), l.value = Xe$1(t_256.y), d.value = Xe$1(t_256.z), mode == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), u && clearTimeout(u), u = setTimeout(function () { n.classList.remove("user-edited"), u = null; }, 1500));
        } });
        var p = function () { var t = new Z(a.valueAsNumber, l.valueAsNumber, d.valueAsNumber); g ? g.update({ value: t }) : (g = new de$1(e, t), s.undoRedoManager.addChange(g)); }, _ = function () { p(), g = void 0; };
        a.addEventListener("input", p), l.addEventListener("input", p), d.addEventListener("input", p), a.addEventListener("change", _), l.addEventListener("change", _), d.addEventListener("change", _);
        return _this;
    }
    return class_17;
}(Ve$1)), function (e) { return e instanceof Ie; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_18, _super);
    function class_18(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("div");
        n.className = "container";
        var o = document.createElement("ul");
        o.className = "flex-editvalues", n.appendChild(o);
        var a = document.createElement("input");
        a.setAttribute("id", e.getName()), a.setAttribute("type", "number"), a.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), a.setAttribute("value", e.getValue().x), a.setAttribute("tabindex", 0), a.style.width = "100%";
        var r = document.createElement("li");
        r.appendChild(a), o.appendChild(r);
        var l = document.createElement("input");
        l.setAttribute("id", e.getName()), l.setAttribute("type", "number"), l.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), l.setAttribute("value", e.getValue().y), l.setAttribute("tabindex", 0), l.style.width = "100%";
        var h = document.createElement("li");
        h.appendChild(l), o.appendChild(h);
        var d = document.createElement("input");
        d.setAttribute("id", e.getName()), d.setAttribute("type", "number"), d.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), d.setAttribute("value", e.getValue().z), d.setAttribute("tabindex", 0), d.style.width = "100%";
        var c = document.createElement("li");
        c.appendChild(d), o.appendChild(c);
        var m = document.createElement("input");
        m.setAttribute("id", e.getName()), m.setAttribute("type", "number"), m.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), m.setAttribute("value", e.getValue().t), m.setAttribute("tabindex", 0), m.style.width = "100%";
        var u = document.createElement("li");
        u.appendChild(m), o.appendChild(u), t.appendChild(n);
        var g, p = void 0;
        e.valueChanged.connect(function () { if (!p) {
            var t_257 = e.getValue();
            a.value = Xe$1(t_257.x), l.value = Xe$1(t_257.y), d.value = Xe$1(t_257.z), m.value = Xe$1(t_257.t), mode == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), g && clearTimeout(g), g = setTimeout(function () { n.classList.remove("user-edited"), g = null; }, 1500));
        } });
        var _ = function () { var t = new G(a.valueAsNumber, l.valueAsNumber, d.valueAsNumber, m.valueAsNumber); p ? p.update({ value: t }) : (p = new de$1(e, t), s.undoRedoManager.addChange(p)); }, f = function () { _(), p = void 0; };
        a.addEventListener("input", _), l.addEventListener("input", _), d.addEventListener("input", _), m.addEventListener("input", _), a.addEventListener("change", f), l.addEventListener("change", f), d.addEventListener("change", f), m.addEventListener("change", f);
        return _this;
    }
    return class_18;
}(Ve$1)), function (e) { return e instanceof Re; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_19, _super);
    function class_19(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("div");
        n.className = "container";
        var o = document.createElement("ul");
        o.className = "flex-editvalues", n.appendChild(o);
        var a, r = void 0, l = !1;
        var h = function (t) { if (!l) {
            function s(e, t) {
                if (t === void 0) { t = 6; }
                return Number(Math.round(e + "e" + t) + "e-" + t);
            }
            var o_11 = e.getValue();
            g.value = s(o_11.m00), p.value = s(o_11.m01), _.value = s(o_11.m02), f.value = s(o_11.m03), v.value = s(o_11.m10), C.value = s(o_11.m11), b.value = s(o_11.m12), w.value = s(o_11.m13), I$1.value = s(o_11.m20), P.value = s(o_11.m21), E$1.value = s(o_11.m22), T.value = s(o_11.m23), y.value = s(o_11.m30), M.value = s(o_11.m31), D.value = s(o_11.m32), S.value = s(o_11.m33), t == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), a && clearTimeout(a), a = setTimeout(function () { n.classList.remove("user-edited"), a = null; }, 1500));
        } };
        e.valueChanged.connect(h);
        var d = function () { l = !0; var t = new I; t.set(g.valueAsNumber, p.valueAsNumber, _.valueAsNumber, f.valueAsNumber, v.valueAsNumber, C.valueAsNumber, b.valueAsNumber, w.valueAsNumber, I$1.valueAsNumber, P.valueAsNumber, E$1.valueAsNumber, T.valueAsNumber, y.valueAsNumber, M.valueAsNumber, D.valueAsNumber, S.valueAsNumber), r ? r.update({ value: t }) : (r = new de$1(e, xfo), s.undoRedoManager.addChange(r)); }, c = function () { d(), r = void 0, l = !1, h(); };
        function m(t, s, i, n) { var o = document.createElement("li"), a = document.createElement("input"); return a.setAttribute("id", e.getName()), a.setAttribute("type", "number"), a.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), a.setAttribute("value", i), a.setAttribute("tabindex", n), a.style.width = "100%", o.appendChild(a), s.appendChild(o), a.addEventListener("input", d), a.addEventListener("change", c), a; }
        var u = e.getValue(), g = m(0, o, u.m00, 0), p = m(0, o, u.m01, 1), _ = m(0, o, u.m02, 2), f = m(0, o, u.m03, 3), v = m(0, o, u.m10, 4), C = m(0, o, u.m11, 5), b = m(0, o, u.m12, 6), w = m(0, o, u.m13, 7), I$1 = m(0, o, u.m20, 8), P = m(0, o, u.m21, 9), E$1 = m(0, o, u.m22, 10), T = m(0, o, u.m23, 11), y = m(0, o, u.m30, 12), M = m(0, o, u.m31, 13), D = m(0, o, u.m32, 14), S = m(0, o, u.m33, 15);
        t.appendChild(n);
        return _this;
    }
    return class_19;
}(Ve$1)), function (e) { return e instanceof We; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_20, _super);
    function class_20(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = document.createElement("div");
        n.className = "container";
        var o = document.createElement("ul");
        o.className = "flex-editvalues", n.appendChild(o);
        var a = e.getValue();
        var r, l = void 0, h = !1;
        var d = function (t) { if (!h) {
            var s_46 = e.getValue();
            p.value = Xe$1(s_46.tr.x), _.value = Xe$1(s_46.tr.y), f.value = Xe$1(s_46.tr.z), v.value = Xe$1(s_46.ori.x), C.value = Xe$1(s_46.ori.y), b.value = Xe$1(s_46.ori.z), w.value = Xe$1(s_46.ori.w), I.value = Xe$1(s_46.sc.x), P.value = Xe$1(s_46.sc.y), E$1.value = Xe$1(s_46.sc.z), t == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), r && clearTimeout(r), r = setTimeout(function () { n.classList.remove("user-edited"), r = null; }, 1500));
        } };
        e.valueChanged.connect(d);
        var m = function () { h = !0; var t = new S; t.tr.set(p.valueAsNumber, _.valueAsNumber, f.valueAsNumber), t.ori.set(v.valueAsNumber, C.valueAsNumber, b.valueAsNumber, w.valueAsNumber), t.ori.normalizeInPlace(), t.sc.set(I.valueAsNumber, P.valueAsNumber, E$1.valueAsNumber), l ? l.update({ value: t }) : (l = new de$1(e, t), s.undoRedoManager.addChange(l)); }, u = function () { m(), l = void 0, h = !1, d(); };
        function g(t, s, i, n) { var o = document.createElement("li"), a = document.createElement("input"); return a.setAttribute("id", e.getName()), a.setAttribute("type", "number"), a.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), a.setAttribute("value", i), a.setAttribute("tabindex", n), a.style.width = "100%", o.appendChild(a), s.appendChild(o), a.addEventListener("input", m), a.addEventListener("change", u), a; }
        var p = g(0, o, a.tr.x, 0), _ = g(0, o, a.tr.y, 1), f = g(0, o, a.tr.z, 2), v = g(0, o, a.ori.x, 3), C = g(0, o, a.ori.y, 4), b = g(0, o, a.ori.z, 5), w = g(0, o, a.ori.w, 6), I = g(0, o, a.sc.x, 7), P = g(0, o, a.sc.y, 8), E$1 = g(0, o, a.sc.z, 9);
        t.appendChild(n);
        return _this;
    }
    return class_20;
}(Ve$1)), function (e) { return e instanceof Le; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_21, _super);
    function class_21(e, t, s) {
        var _this = _super.call(this, e) || this;
        var i = document.createElement("div");
        i.className = "container";
        var n = document.createElement("ul");
        n.className = "flex-editvalues", i.appendChild(n);
        var o = e.getValue();
        var a = void 0;
        var r = function () { if (!a) {
            var t_258 = e.getValue();
            t_258.isValid() && (c.value = t_258.p0.x, m.value = t_258.p0.y, u.value = t_258.p0.z, g.value = t_258.p1.x, p.value = t_258.p1.y, _.value = t_258.p1.z);
        } };
        e.valueChanged.connect(r);
        var l = function () { var t = new v; t.p0.set(c.valueAsNumber, m.valueAsNumber, u.valueAsNumber), t.p1.set(g.valueAsNumber, p.valueAsNumber, _.valueAsNumber), a ? a.update({ value: t }) : (a = new de$1(e, t), s.undoRedoManager.addChange(a)), r(); }, h = function () { l(), a = void 0; };
        function d(t, s, i, n) { var o = document.createElement("li"), a = document.createElement("input"); return a.setAttribute("id", e.getName()), a.setAttribute("type", "number"), a.setAttribute("pattern", "-?[0-9]*(.[0-9]+)?"), a.setAttribute("value", i), a.setAttribute("tabindex", n), a.style.width = "100%", o.appendChild(a), s.appendChild(o), a.addEventListener("input", l), a.addEventListener("change", h), a; }
        var c = d(0, n, o.p0.x, 0), m = d(0, n, o.p0.y, 1), u = d(0, n, o.p0.z, 2), g = d(0, n, o.p1.x, 3), p = d(0, n, o.p1.y, 4), _ = d(0, n, o.p1.z, 5);
        t.appendChild(i);
        return _this;
    }
    return class_21;
}(Ve$1)), function (e) { return e.getValue() instanceof v; });
var Ne$1 = /** @class */ (function (_super) {
    __extends(Ne$1, _super);
    function Ne$1(e, t) {
        var _this = this;
        e ? (_this = _super.call(this, e ? e.getName() + " Name Changed" : "NameValueChange") || this, _this.__prevName = e.getName(), _this.__item = e, null != t && (_this.__nextName = t, _this.__item.setName(_this.__nextName))) : _this = _super.call(this) || this;
        return _this;
    }
    Ne$1.prototype.undo = function () { this.__item && this.__item.setName(this.__prevName); };
    Ne$1.prototype.redo = function () { this.__item && this.__item.setName(this.__nextName); };
    Ne$1.prototype.update = function (e) { this.__item && (this.__nextName = e.value, this.__item.setName(this.__nextName), this.updated.emit(e)); };
    Ne$1.prototype.toJSON = function (e) { var t = this.__item.getPath().slice(); return t.pop(), t.push(this.__prevName), { name: this.name, nextName: this.__nextName, itemPath: t }; };
    Ne$1.prototype.fromJSON = function (e, t) { var s = t.appData.scene.getRoot().resolvePath(e.itemPath, 1); s && s instanceof te ? (this.__item = s, this.__prevName = this.__item.getName(), this.__nextName = e.nextName, this.__item.setName(this.__nextName, E.REMOTEUSER_SETVALUE), this.name = this.__item.getName() + " Changed") : console.warn("resolvePath is unable to resolve", e.itemPath); };
    Ne$1.prototype.changeFromJSON = function (e) { this.__item && (this.__nextName = e.value, this.__item.setName(this.__nextName, E.REMOTEUSER_SETVALUE)); };
    return Ne$1;
}(re$1));
ae$1.registerChange("NameValueChange", Ne$1);
var Le$1 = /** @class */ (function () {
    function Le$1(e, t, s) {
        var n = document.createElement("input");
        var o, a;
        n.className = "mdl-textfield__input", n.setAttribute("type", "text"), n.setAttribute("value", e.getName()), n.setAttribute("tabindex", 0), t.appendChild(n), e.nameChanged.connect(function (t, s, r) { o || (n.value = e.getName(), r == E.REMOTEUSER_SETVALUE && (n.classList.add("user-edited"), a && clearTimeout(a), a = setTimeout(function () { n.classList.remove("user-edited"), a = null; }, 1500))); });
        var r = function () { var t = n.value; o ? o.update({ value: t }) : (o = new Ne$1(e, t), s.undoRedoManager.addChange(o)); };
        n.addEventListener("input", r), n.addEventListener("change", function () { r(), o = void 0; });
    }
    return Le$1;
}());
var ke$1 = /** @class */ (function () {
    function ke$1(e, t, s) {
        this.domElement = t, this.clean(), this.appData = s, this.container = document.createElement("div"), this.container.className = "container", this.domElement.appendChild(this.container), this.ul = document.createElement("ul"), this.ul.className = "flex-outer", this.container.appendChild(this.ul), e && this.setParameterOwner(e);
    }
    ke$1.prototype.clean = function () { for (; this.domElement.firstChild;)
        this.domElement.removeChild(this.domElement.firstChild); };
    ke$1.prototype.destroy = function () { this.clean(); };
    ke$1.prototype.getDomElement = function () { return this.container; };
    ke$1.prototype.setParameterOwner = function (e) { if (this.parameterOwner = e, this.widgets = [], e)
        for (var _b = 0, _c = e.getParameters(); _b < _c.length; _b++) {
            var t_259 = _c[_b];
            this.addParameterWidget(t_259);
        } };
    ke$1.prototype.addParameterWidget = function (e) { var t = e.getName(), s = Ae$1.findWidgetReg(e); if (!s)
        return void console.warn("Unable to display parameter '" + t + "', value:" + e.getValue()); var i = document.createElement("li"); this.ul.appendChild(i); var n = document.createElement("label"); n.setAttribute("for", t), n.appendChild(document.createTextNode(t)), i.appendChild(n); var o = new s.widget(e, i, this.appData); this.widgets.push(o); };
    return ke$1;
}());
var Ge$1 = /** @class */ (function (_super) {
    __extends(Ge$1, _super);
    function Ge$1(e, t, s) {
        var _this = _super.call(this, e) || this;
        var i = document.createElement("ul");
        i.className = "list pa0";
        var n = document.createElement("li"), o = document.createElement("li");
        t.appendChild(i), i.appendChild(n), i.appendChild(o);
        var a = function (e) { e instanceof te && (_this.nameWidget = new Le$1(e, n, s)), _this.parameterContainer = new ke$1(e, o, s); }, r = e.getValue();
        r && a(r), e.valueChanged.connect(function () { for (; n.firstChild;)
            n.removeChild(n.firstChild); for (; o.firstChild;)
            o.removeChild(o.firstChild); a(e.getValue()); });
        return _this;
    }
    return Ge$1;
}(Ve$1));
Ae$1.registerWidget(Ge$1, function (e) { return e.getValue() instanceof q; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_22, _super);
    function class_22(e, t, s) {
        var _this = this;
        var i = e.getValue();
        {
            var s_47 = document.createElement("ul");
            s_47.style.width = "100%", s_47.style["padding-inline-start"] = "0px";
            {
                var t_260 = document.createElement("input");
                t_260.className = "mdl-textfield__input", t_260.setAttribute("id", e.getName()), t_260.setAttribute("type", "text"), t_260.setAttribute("value", i ? i.getPath() : "<NONE>"), t_260.setAttribute("tabindex", 0);
                var n = document.createElement("li");
                n.style.display = "block", n.appendChild(t_260), s_47.appendChild(n);
            }
            t.appendChild(s_47);
        }
        _this = _super.call(this, e, t, s) || this, e.valueChanged.connect(function () { i || t.removeChild(void 0); });
        return _this;
    }
    class_22.prototype.setParentDomElem = function (e) { };
    return class_22;
}(Ge$1)), function (e) { return e instanceof ve; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_23, _super);
    function class_23(e, t, s) {
        var _this = _super.call(this, e) || this;
        var i = new iro.ColorPicker(t, { width: 200, height: 200, color: e.getValue().getAsRGBDict(), anticlockwise: !0, borderWidth: 1, borderColor: "#fff" });
        var n = void 0, a = !1;
        e.valueChanged.connect(function () { n || (a = !0, i.color.rgb = e.getValue().getAsRGBDict(), a = !1); }), i.on("input:start", function () { n = new de$1(e), s.undoRedoManager.addChange(n); }), i.on("input:end", function () { n = void 0; }), i.on("color:change", function (t, r) { if (a)
            return; var l = new y; l.setFromRGBDict(i.color.rgb), n ? n.update({ value: l }) : (n = new de$1(e, l), s.undoRedoManager.addChange(n)); });
        return _this;
    }
    class_23.prototype.setParentDomElem = function (e) { };
    return class_23;
}(Ve$1)), function (e) { return e instanceof Pe; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_24, _super);
    function class_24(e, t, s) {
        var _this = _super.call(this, e) || this;
        var n = e.getChoices(), o = document.createElement("select");
        for (var e_242 = 0; e_242 < n.length; e_242++) {
            var t_261 = n[e_242], s_48 = document.createElement("option");
            s_48.appendChild(document.createTextNode(t_261)), o.appendChild(s_48);
        }
        o.selectedIndex = e.getValue(), t.appendChild(o);
        var a, r = !1;
        e.valueChanged.connect(function (t) { r || (o.selectedIndex = e.getValue(), t == E.REMOTEUSER_SETVALUE && (o.classList.add("user-edited"), a && clearTimeout(a), a = setTimeout(function () { o.classList.remove("user-edited"), a = null; }, 1500))); });
        o.addEventListener("change", function (t) { r = !0; var i = new de$1(e, o.selectedIndex); s.undoRedoManager.addChange(i), e.setValueDone(), r = !1; });
        return _this;
    }
    return class_24;
}(Ve$1)), function (e) { return e instanceof ye; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_25, _super);
    function class_25(e, t, s) {
        var _this = _super.call(this, e) || this;
        var i = e.getValue(), n = document.createElement("input");
        n.className = "mdl-textfield__input", n.setAttribute("id", e.getName()), n.setAttribute("type", "text"), n.setAttribute("value", i ? i.getPath().join("/") : "<none>"), n.style["outline-color"] = "grey", n.style["outline-width"] = "1px", n.style["outline-style"] = "solid";
        var o = document.createElement("button");
        o.appendChild(document.createTextNode("Pick")), o.addEventListener("click", function (t) { s.selectionManager.startPickingMode("Pick " + e.getName() + " item.", function (t) { var i = new de$1(e, t[0]); s.undoRedoManager.addChange(i); }, e.getFilterFn(), 1); }), o.style.margin = "2px", t.appendChild(n), t.appendChild(o), e.valueChanged.connect(function () { {
            var t_262 = e.getValue();
            n.setAttribute("value", t_262 ? t_262.getPath().join("/") : "<none>");
        } });
        return _this;
    }
    return class_25;
}(Ve$1)), function (e) { return e instanceof Ne; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_26, _super);
    function class_26(t, s, i) {
        var _this = _super.call(this, t) || this;
        var n = document.createElement("select");
        n.classList.add("itemset-items");
        var o = function () { var e = Array.from(t.getValue()); n.setAttribute("size", e.length + 1); for (var t_263 = 0; t_263 < e.length; t_263++) {
            var s_49 = e[t_263], i_157 = document.createElement("option");
            i_157.appendChild(document.createTextNode(s_49.getPath())), n.appendChild(i_157);
        } };
        t.valueChanged.connect(function () { for (; n.firstChild;)
            n.removeChild(n.firstChild); o(); }), o(), n.selectedIndex = -1, n.style.width = "100%";
        var a = document.createElement("ul");
        a.style.width = "100%", a.style["padding-inline-start"] = "0px";
        var r = document.createElement("li");
        r.style.display = "block", a.appendChild(r), r.appendChild(n), s.appendChild(a), _this.selectionChanged = new C, _this.selectionDoubleClicked = new C;
        var l = -1;
        if (n.addEventListener("change", function (e) { console.log("valueChange", n.selectedIndex), _this.selectionChanged.emit(n.selectedIndex, l), l = n.selectedIndex; }), n.addEventListener("dblclick", function (e) { console.log("dblclick", n.selectedIndex); var s = t.getItem(n.selectedIndex); i.selectionManager.setSelection(new Set([s])), _this.selectionDoubleClicked.emit(n.selectedIndex); }), null != t.getFilterFn()) {
            var e_243 = document.createElement("button");
            e_243.appendChild(document.createTextNode("Add")), e_243.addEventListener("click", function (e) { i.selectionManager.startPickingMode("Pick a new item.", function (e) { t.addItems(e); }, t.getFilterFn(), 1); });
            var s_50 = document.createElement("button");
            s_50.appendChild(document.createTextNode("Remove")), s_50.addEventListener("click", function (e) { t.removeItem(n.selectedIndex); });
            var o_12 = document.createElement("li");
            o_12.style.display = "block", e_243.style.margin = "2px", s_50.style.margin = "2px", o_12.appendChild(e_243), o_12.appendChild(s_50), a.appendChild(o_12);
        }
        return _this;
    }
    return class_26;
}(Ve$1)), function (e) { return e instanceof Ke; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_27, _super);
    function class_27(e, t, s) {
        var _this = _super.call(this, e) || this;
        var i = [], n = function () { e.getMemberNames().forEach(function (t, n) { var o = e.getMember(t), a = Ae$1.findWidgetReg(o); if (!a)
            return void console.warn("StructWidget Unable to display item '" + o.getNam() + "'"); var l = document.createElement("li"), h = document.createElement("label"); h.setAttribute("for", t), h.appendChild(document.createTextNode(t)), l.appendChild(h); var d = new a.widget(o, l, s); i[n] = d, r.appendChild(l); }); };
        e.valueChanged.connect(function () { for (; r.firstChild;)
            r.removeChild(r.firstChild); n(); });
        var o = document.createElement("ul");
        o.style.width = "100%", o.style["padding-inline-start"] = "0px";
        var a = document.createElement("li");
        a.style.display = "block", o.appendChild(a);
        var r = document.createElement("ul");
        r.style.display = "block", o.appendChild(r), n(), t.appendChild(o);
        return _this;
    }
    return class_27;
}(Ve$1)), function (e) { return e instanceof Ye; });
Ae$1.registerWidget(/** @class */ (function (_super) {
    __extends(class_28, _super);
    function class_28(e, t, s) {
        var _this = _super.call(this, e) || this;
        var i = [], n = function () { Array.from(e.getValue()).forEach(function (t, n) { var o = Ae$1.findWidgetReg(t); if (!o)
            return void console.warn("ListWidget Unable to display list item '" + t.getNam() + "'"); var a = document.createElement("li"), l = new o.widget(t, a, s); i[n] = l; var h = document.createElement("button"); h.appendChild(document.createTextNode("Remove")), h.addEventListener("click", function (t) { e.removeElement(n); }), h.style.margin = "2px", a.appendChild(h), r.appendChild(a); }); };
        e.valueChanged.connect(function () { for (; r.firstChild;)
            r.removeChild(r.firstChild); n(); });
        var o = document.createElement("ul");
        o.style.width = "100%", o.style["padding-inline-start"] = "0px";
        var a = document.createElement("li");
        a.style.display = "block", o.appendChild(a);
        var r = document.createElement("ul");
        r.style.display = "block", o.appendChild(r), n(), t.appendChild(o);
        {
            var t_264 = document.createElement("li");
            t_264.style.display = "block";
            var s_51 = document.createElement("button");
            s_51.appendChild(document.createTextNode("Add")), s_51.addEventListener("click", function (t) { e.addElement(); }), s_51.style.margin = "2px", t_264.appendChild(s_51), o.appendChild(t_264);
        }
        return _this;
    }
    return class_28;
}(Ve$1)), function (e) { return e instanceof Ce; });
Ae$1.registerTreeItemElement(/** @class */ (function () {
    function class_29(e, s, i, n) {
        var _this = this;
        if (n === void 0) { n = !1; }
        this.treeItem = e, this.appData = s, this.options = i, this.li = document.createElement("li"), this.li.className = "TreeNodesListItem", this.li.treeItem = e, this.expandBtn = document.createElement("button"), this.expandBtn.className = "TreeNodesListItem__ToggleExpanded", this.li.appendChild(this.expandBtn), e instanceof ra && (this.toggleVisibilityBtn = document.createElement("button"), this.toggleVisibilityBtn.className = "TreeNodesListItem__ToggleVisibility", this.li.appendChild(this.toggleVisibilityBtn), this.toggleVisibilityBtn.innerHTML = '<i class="material-icons md-15">visibility</i>', this.toggleVisibilityBtn.addEventListener("click", function () { var e = _this.treeItem.getParameter("Visible"), t = new de$1(e, !e.getValue()); _this.appData.undoRedoManager && _this.appData.undoRedoManager.addChange(t); }), this.updateVisibilityId = this.treeItem.visibilityChanged.connect(this.updateVisibility.bind(this)), this.updateVisibility()), this.titleElement = document.createElement("span"), this.titleElement.className = "TreeNodesListItem__Title", this.titleElement.textContent = e.getName();
        if (this.treeItem.nameChanged.connect(function () { _this.titleElement.textContent = e.getName(); }), this.li.appendChild(this.titleElement), this.titleElement.addEventListener("click", function (e) { s.selectionManager && (s.selectionManager.pickingModeActive() ? s.selectionManager.pick(_this.treeItem) : s.selectionManager.toggleItemSelection(_this.treeItem, !e.ctrlKey)); }), this.updateSelectedId = this.treeItem.selectedChanged.connect(this.updateSelected.bind(this)), this.updateSelected(), e instanceof ra && (this.updateHighlightId = this.treeItem.highlightChanged.connect(this.updateHighlight.bind(this)), this.updateHighlight()), this.ul = document.createElement("ul"), this.ul.className = "TreeNodesList", this.li.appendChild(this.ul), this.childElements = [], this.expanded = !1, e instanceof ra) {
            if (n)
                this.expand();
            else {
                this.treeItem.getChildren().length > 0 && this.collapse();
            }
            this.expandBtn.addEventListener("click", function () { _this.treeItem.getNumChildren() > 0 && (_this.expanded ? _this.collapse() : _this.expand()); }), this.childAddedId = this.treeItem.childAdded.connect(this.childAdded.bind(this)), this.childRemovedId = this.treeItem.childRemoved.connect(this.childRemoved.bind(this)), this.titleElement.onmousedown = function (e) { if (i.allowDragNDrop) {
                e.stopPropagation(), e.preventDefault();
                var s_52 = e.clientX, i_158 = e.clientY;
                var n_38, o_13, a_241 = s_52 - _this.li.getBoundingClientRect().left, r_12 = i_158 - _this.li.getBoundingClientRect().top, l_23 = !1;
                var h_2 = function (e) { if (!l_23) {
                    var t_265 = e.clientX - s_52, o_14 = e.clientY - i_158;
                    Math.abs(t_265) > 10 && Math.abs(o_14) > 10 && (n_38 = document.createElement("li"), n_38.className = "TreeNodesListItem", n_38.classList.add("TreeNodesListItem--isHighlighted"), n_38.classList.add("TreeNodesListItem--isSelected"), n_38.classList.add("TreeNodesListItem__Dragging"), n_38.appendChild(_this.titleElement.cloneNode(!0)), n_38.style.position = "absolute", n_38.style.zIndex = 1e3, document.body.append(n_38), l_23 = !0);
                } if (l_23) {
                    n_38.style.left = e.pageX - a_241 + "px", n_38.style.top = e.pageY - r_12 + "px", n_38.hidden = !0;
                    var s_53 = document.elementFromPoint(e.clientX, e.clientY);
                    if ("TreeNodesListItem__Title" == s_53.className && s_53.parentElement.treeItem instanceof ra) {
                        var e_244 = s_53.parentElement;
                        o_13 && o_13 != e_244 && o_13.classList.remove("TreeNodesListItem--isHighlighted"), e_244 == _this.li ? o_13 = null : e_244 && o_13 != e_244 && (o_13 = e_244, o_13.classList.add("TreeNodesListItem--isHighlighted"));
                    }
                    n_38.hidden = !1;
                } }, d_5 = function (e) { if (n_38 && document.body.removeChild(n_38), o_13) {
                    var e_245 = new xe$1(_this.treeItem, o_13.treeItem);
                    _this.appData.undoRedoManager && _this.appData.undoRedoManager.addChange(e_245);
                } document.removeEventListener("mousemove", h_2), document.removeEventListener("mouseup", d_5); };
                document.addEventListener("mousemove", h_2), document.addEventListener("mouseup", d_5);
            } };
        }
        this.li.ondragstart = function () { return !1; };
    }
    class_29.prototype.updateVisibility = function () { this.treeItem.getVisible() ? this.li.classList.remove("TreeNodesListItem--isHidden") : this.li.classList.add("TreeNodesListItem--isHidden"); };
    class_29.prototype.updateSelected = function () { this.treeItem.getSelected() ? this.li.classList.add("TreeNodesListItem--isSelected") : this.li.classList.remove("TreeNodesListItem--isSelected"); };
    class_29.prototype.updateHighlight = function () { var e = this.treeItem.isHighlighted(); e ? this.li.classList.add("TreeNodesListItem--isHighlighted") : this.li.classList.remove("TreeNodesListItem--isHighlighted"), e && (this.titleElement.style["border-color"] = this.treeItem.getHighlight().toHex()); };
    class_29.prototype.childAdded = function (e, t) { this.addChild(e, t); };
    class_29.prototype.childRemoved = function (e, t) { this.expanded && (this.li.removeChild(this.childElements[t].li), this.childElements[t].destroy(), this.childElements.splice(t, 1)); };
    class_29.prototype.addComponent = function (e) { this.subul || (this.subul = document.createElement("ul"), this.titleElement.appendChild(this.subul)); var t = document.createElement("li"); t.className = "TreeNodesListItem"; var s = document.createElement("span"); s.className = "TreeNodesListItem__Title", s.textContent = e, t.appendChild(s), this.subul.appendChild(t); };
    class_29.prototype.addChild = function (e, t) { if (this.expanded) {
        var s = Ae$1.constructTreeItemElement(e, this.appData, this.options);
        t == this.childElements.length ? this.ul.appendChild(s.li) : this.ul.insertBefore(s.li, this.childElements[t].li), this.childElements.splice(t, 0, s);
    }
    else
        this.collapse(); };
    class_29.prototype.getChild = function (e) { return this.childElements[e]; };
    class_29.prototype.expand = function () {
        var _this = this;
        if (this.expanded = !0, this.ul.classList.remove("TreeNodesList--collapsed"), this.expandBtn.innerHTML = '<i class="material-icons md-24">arrow_drop_down</i>', !this.childrenAlreadyCreated) {
            this.treeItem.getChildren().forEach(function (e, t) { _this.addChild(e, t); }), this.childrenAlreadyCreated = !0;
        }
    };
    class_29.prototype.collapse = function () { this.ul.classList.add("TreeNodesList--collapsed"), this.expandBtn.innerHTML = '<i class="material-icons md-24">arrow_right</i>', this.expanded = !1; };
    class_29.prototype.destroy = function () { this.treeItem.selectedChanged.disconnectId(this.updateSelectedId), this.treeItem instanceof ra && (this.treeItem.highlightChanged.disconnectId(this.updateHighlightId), this.treeItem.visibilityChanged.disconnectId(this.updateVisibilityId), this.treeItem.childAdded.disconnectId(this.childAddedId), this.treeItem.childRemoved.disconnectId(this.childRemovedId)); };
    return class_29;
}()), function (e) { return e instanceof te; });
Ae$1.registerInpector(/** @class */ (function () {
    function class_30(e, t, s) {
        var i = document.createElement("ul");
        i.className = "list pa0 pr3";
        var n = document.createElement("li"), o = document.createElement("li");
        t.appendChild(i), i.appendChild(n), i.appendChild(o), this.nameWidget = new Le$1(e, n, s), this.parameterContainer = new ke$1(e, o, s);
    }
    class_30.prototype.destroy = function () { this.parameterContainer.destroy(); };
    return class_30;
}()), function (e) { return e instanceof te; });
var je$1 = /** @class */ (function (_super) {
    __extends(je$1, _super);
    function je$1(t) {
        var _this = this;
        _this = _super.call(this) || this, t || console.error("App data not provided to tool"), _this.appData = t, _this.installChanged = new C, _this.activatedChanged = new C, _this.actionFinished = new C, _this.__params = [], _this.__installed = !1, _this.__activated = !1;
        return _this;
    }
    je$1.prototype.getName = function () { return this.constructor.name; };
    je$1.prototype.isPrimaryTool = function () { return !1; };
    je$1.prototype.installed = function () { return this.__installed; };
    je$1.prototype.install = function (e) { if (this.__installed)
        throw new Error("Tool already installed"); this.index = e, this.__installed = !0, this.installChanged.emit(!0); };
    je$1.prototype.uninstall = function () { this.__installed = !1, this.installChanged.emit(!1); };
    je$1.prototype.activateTool = function () { if (this.__activated)
        throw new Error("Tool already activate"); this.__activated = !0, this.activatedChanged.emit(!0); };
    je$1.prototype.deactivateTool = function () { this.__activated = !1, this.activatedChanged.emit(!1); };
    je$1.prototype.onMouseDown = function (e) { };
    je$1.prototype.onMouseMove = function (e) { };
    je$1.prototype.onMouseUp = function (e) { };
    je$1.prototype.onDoubleClick = function (e) { };
    je$1.prototype.onWheel = function (e) { };
    je$1.prototype.onKeyPressed = function (e, t) { };
    je$1.prototype.onKeyDown = function (e, t) { };
    je$1.prototype.onKeyUp = function (e, t) { };
    je$1.prototype.onTouchStart = function (e) { };
    je$1.prototype.onTouchMove = function (e) { };
    je$1.prototype.onTouchEnd = function (e) { };
    je$1.prototype.onTouchCancel = function (e) { };
    je$1.prototype.onDoubleTap = function (e) { };
    je$1.prototype.onVRControllerButtonDown = function (e) { };
    je$1.prototype.onVRControllerButtonUp = function (e) { };
    je$1.prototype.onVRControllerDoubleClicked = function (e) { };
    je$1.prototype.onVRPoseChanged = function (e) { };
    return je$1;
}(q));
var qe$1 = /** @class */ (function (_super) {
    __extends(qe$1, _super);
    function qe$1(e) {
        var _this = this;
        _this = _super.call(this, e) || this, _this.dragging = !1, _this.selectionRect = new Bt(1, 1), _this.selectionRectMat = new He("marker", "ScreenSpaceShader"), _this.selectionRectMat.getParameter("BaseColor").setValue(new y("#03E3AC")), _this.selectionRectXfo = new S, _this.selectionRectXfo.tr.set(.5, .5, 0), _this.selectionRectXfo.sc.set(0, 0, 0);
        return _this;
    }
    qe$1.prototype.activateTool = function () { _super.prototype.activateTool.call(this), this.rectItem || (this.rectItem = new ma("selectionRect", this.selectionRect, this.selectionRectMat), this.rectItem.getParameter("Visible").setValue(!1), this.appData.renderer.addTreeItem(this.rectItem)); };
    qe$1.prototype.deactivateTool = function () { _super.prototype.deactivateTool.call(this), this.selectionRectXfo.sc.set(0, 0, 0), this.rectItem.setGlobalXfo(this.selectionRectXfo); };
    qe$1.prototype.onMouseDown = function (e) { return 0 == e.button && !e.altKey && (console.log("onMouseDown"), this.mouseDownPos = e.mousePos, this.dragging = !1, !0); };
    qe$1.prototype.__resizeRect = function (e, t) { var s = new _(1 / e.getWidth() * 2, 1 / e.getHeight() * 2), i = t.multiply(s); this.selectionRectXfo.sc.set(Math.abs(i.x), Math.abs(i.y), 1); var n = this.mouseDownPos.subtract(t.scale(.5)).multiply(s).subtract(new _(1, 1)); this.selectionRectXfo.tr.x = n.x, this.selectionRectXfo.tr.y = -n.y, this.rectItem.setGlobalXfo(this.selectionRectXfo); };
    qe$1.prototype.onMouseMove = function (e) { if (this.mouseDownPos) {
        var t_266 = this.mouseDownPos.subtract(e.mousePos);
        this.dragging && this.__resizeRect(e.viewport, t_266), t_266.length() > 4 && (this.dragging = !0, this.rectItem.getParameter("Visible").setValue(!0), this.__resizeRect(e.viewport, t_266));
    } return !0; };
    qe$1.prototype.onMouseUp = function (e) { if (this.mouseDownPos) {
        if (this.dragging) {
            this.rectItem.getParameter("Visible").setValue(!1);
            var t_267 = e.mousePos, s = new _(Math.min(this.mouseDownPos.x, t_267.x), Math.min(this.mouseDownPos.y, t_267.y)), i_159 = new _(Math.max(this.mouseDownPos.x, t_267.x), Math.max(this.mouseDownPos.y, t_267.y)), n = e.viewport.getGeomItemsInRect(s, i_159);
            if (this.appData.selectionManager.pickingModeActive())
                this.appData.selectionManager.pick(n);
            else {
                var t_268 = new Set(__spreadArrays(n).filter(function (e) { return !(e.getOwner() instanceof le$1); }));
                e.shiftKey ? this.appData.selectionManager.deselectItems(t_268) : this.appData.selectionManager.selectItems(t_268, !e.ctrlKey), this.selectionRectXfo.sc.set(0, 0, 0), this.rectItem.setGlobalXfo(this.selectionRectXfo);
            }
        }
        else {
            var t_269 = e.viewport.getGeomDataAtPos(e.mousePos);
            if (null == t_269 || t_269.geomItem.getOwner() instanceof le$1)
                this.appData.selectionManager.clearSelection();
            else if (this.appData.selectionManager.pickingModeActive())
                this.appData.selectionManager.pick(t_269.geomItem);
            else if (e.shiftKey) {
                var e_246 = new Set;
                e_246.add(t_269.geomItem), this.appData.selectionManager.deselectItems(e_246);
            }
            else
                this.appData.selectionManager.toggleItemSelection(t_269.geomItem, !e.ctrlKey);
        }
        return this.mouseDownPos = void 0, !0;
    } };
    qe$1.prototype.onVRControllerButtonDown = function (e) { if (1 == e.button) {
        var t_270 = e.controller.getGeomItemAtTip();
        if (null != t_270 && !(t_270.geomItem.getOwner() instanceof le$1))
            return this.appData.selectionManager.toggleItemSelection(t_270.geomItem), !0;
    } };
    return qe$1;
}(je$1));
ae$1.registerChange("SelectionTool", qe$1);
var mt$1 = /** @class */ (function (_super) {
    __extends(mt$1, _super);
    function mt$1(e) {
        var _this = this;
        _this = _super.call(this, "HoldObjectsChange") || this, _this.__selection = [], _this.__prevXfos = [], _this.__newXfos = [], e && _this.update(e);
        return _this;
    }
    mt$1.prototype.undo = function () { for (var e_247 = 0; e_247 < this.__selection.length; e_247++)
        this.__selection[e_247] && this.__selection[e_247].setGlobalXfo(this.__prevXfos[e_247]); };
    mt$1.prototype.redo = function () { for (var e_248 = 0; e_248 < this.__selection.length; e_248++)
        this.__selection[e_248] && this.__selection[e_248].setGlobalXfo(this.__newXfos[e_248]); };
    mt$1.prototype.update = function (e) { if (e.newItem)
        this.__selection[e.newItemId] = e.newItem, this.__prevXfos[e.newItemId] = e.newItem.getGlobalXfo();
    else if (e.changeXfos)
        for (var t_271 = 0; t_271 < e.changeXfoIds.length; t_271++) {
            var s = e.changeXfoIds[t_271];
            this.__selection[s] && (this.__selection[s].setGlobalXfo(e.changeXfos[t_271]), this.__newXfos[s] = e.changeXfos[t_271]);
        } this.updated.emit(e); };
    mt$1.prototype.toJSON = function (e) { var t = _super.prototype.toJSON.call(this, e), s = []; for (var e_249 = 0; e_249 < this.__selection.length; e_249++)
        this.__selection[e_249] ? s[e_249] = this.__selection[e_249].getPath() : s.push(null); return t.itemPaths = s, t; };
    mt$1.prototype.fromJSON = function (e, t) { _super.prototype.fromJSON.call(this, e, t); var s = t.appData.scene.getRoot(), i = []; for (var t_272 = 0; t_272 < e.itemPaths.length; t_272++) {
        var n = e.itemPaths[t_272];
        n && (i[t_272] = s.resolvePath(n, 1));
    } this.__selection = i; };
    return mt$1;
}(re$1));
ae$1.registerChange("HoldObjectsChange", mt$1);
var pt$1 = /** @class */ (function (_super) {
    __extends(pt$1, _super);
    function pt$1(e) {
        return _super.call(this, e) || this;
    }
    pt$1.prototype.setParentAndXfo = function (e, t) { this.parentItem = e; var s = this.parentItem.generateUniqueName(this.geomItem.getName()); this.geomItem.setName(s), this.geomItem.setGlobalXfo(t), this.childIndex = this.parentItem.addChild(this.geomItem, !0), this.geomItem.addRef(this); };
    pt$1.prototype.undo = function () { this.parentItem.removeChild(this.childIndex); };
    pt$1.prototype.redo = function () { this.parentItem.addChild(this.geomItem, !1, !1); };
    pt$1.prototype.toJSON = function (e) { var t = _super.prototype.toJSON.call(this, e); return t.parentItemPath = this.parentItem.getPath(), t.geomItemName = this.geomItem.getName(), t.geomItemXfo = this.geomItem.getParameter("LocalXfo").getValue(), t; };
    pt$1.prototype.fromJSON = function (e, t) { var s = t.appData.scene.getRoot(); this.parentItem = s.resolvePath(e.parentItemPath, 1), this.geomItem.setName(this.parentItem.generateUniqueName(e.geomItemName)); var i = new S; i.fromJSON(e.geomItemXfo), this.geomItem.setLocalXfo(i), this.childIndex = this.parentItem.addChild(this.geomItem, !1); };
    pt$1.prototype.destroy = function () { this.geomItem.removeRef(this); };
    return pt$1;
}(re$1));
var ft$1 = /** @class */ (function (_super) {
    __extends(ft$1, _super);
    function ft$1(e, t, s, i) {
        var _this = this;
        _this = _super.call(this, "Create Line") || this, _this.line = new zt(0), _this.line.setNumVertices(2), _this.line.setNumSegments(1), _this.line.setSegment(0, 0, 1);
        var n = new He("Line", "LinesShader");
        n.getParameter("Color").setValue(new y(.7, .2, .2)), _this.geomItem = new ma("Line"), _this.geomItem.setGeometry(_this.line), _this.geomItem.setMaterial(n), s && n.getParameter("Color").setValue(s), i && (_this.line.lineThickness = i), e && t && _this.setParentAndXfo(e, t);
        return _this;
    }
    ft$1.prototype.update = function (e) { e.p1 && (this.line.getVertex(1).setFromOther(e.p1), this.line.geomDataChanged.emit()), this.updated.emit(e); };
    ft$1.prototype.fromJSON = function (e, t) { if (_super.prototype.fromJSON.call(this, e, t), e.color) {
        var t_273 = new y;
        t_273.fromJSON(e.color), material.getParameter("Color").setValue(t_273);
    } e.thickness && (this.line.lineThickness = e.thickness); };
    return ft$1;
}(pt$1));
ae$1.registerChange("CreateLineChange", ft$1);
var Ct$1 = /** @class */ (function (_super) {
    __extends(Ct$1, _super);
    function Ct$1(e, t) {
        var _this = this;
        _this = _super.call(this, "Create Circle", e) || this, _this.circle = new Dt(0, 64), _this.circle.lineThickness = .05;
        var s = new He("circle", "FatLinesShader");
        s.getParameter("Color").setValue(new y(.7, .2, .2)), _this.geomItem = new ma("Circle"), _this.geomItem.setGeometry(_this.circle), _this.geomItem.setMaterial(s), e && t && _this.setParentAndXfo(e, t);
        return _this;
    }
    Ct$1.prototype.update = function (e) { this.circle.getParameter("Radius").setValue(e.radius), this.updated.emit(e); };
    Ct$1.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.radius = this.circle.getParameter("Radius").getValue(), e; };
    Ct$1.prototype.changeFromJSON = function (e) { console.log("CreateCircleChange:", e), e.radius && this.circle.getParameter("Radius").setValue(e.radius); };
    return Ct$1;
}(pt$1));
ae$1.registerChange("CreateCircleChange", Ct$1);
var wt$1 = /** @class */ (function (_super) {
    __extends(wt$1, _super);
    function wt$1(e, t) {
        var _this = this;
        _this = _super.call(this, "Create Rect") || this, _this.rect = new Bt(0, 0), _this.rect.lineThickness = .05;
        var s = new He("circle", "FatLinesShader");
        s.getParameter("Color").setValue(new y(.7, .2, .2)), _this.geomItem = new ma("Rect"), _this.geomItem.setGeometry(_this.rect), _this.geomItem.setMaterial(s), e && t && _this.setParentAndXfo(e, t);
        return _this;
    }
    wt$1.prototype.update = function (e) { if (e.baseSize && this.rect.setSize(e.baseSize[0], e.baseSize[1]), e.tr) {
        var t_274 = this.geomItem.getParameter("LocalXfo").getValue();
        t_274.tr.fromJSON(e.tr), this.geomItem.getParameter("LocalXfo").setValue(t_274);
    } this.updated.emit(e); };
    return wt$1;
}(pt$1));
ae$1.registerChange("CreateRectChange", wt$1);
var Pt$1 = /** @class */ (function (_super) {
    __extends(Pt$1, _super);
    function Pt$1(e, t, s, i) {
        var _this = this;
        _this = _super.call(this, "Create Freehand Line") || this, _this.used = 0, _this.vertexCount = 100, _this.line = new zt, _this.line.setNumVertices(_this.vertexCount), _this.line.setNumSegments(_this.vertexCount - 1), _this.line.vertices.setValue(0, new Z);
        var n = new He("freeHandLine", "FatLinesShader");
        _this.geomItem = new ma("freeHandLine"), _this.geomItem.setGeometry(_this.line), _this.geomItem.setMaterial(n), s && n.getParameter("Color").setValue(s), i && (_this.line.lineThickness = i), e && t && _this.setParentAndXfo(e, t);
        return _this;
    }
    Pt$1.prototype.update = function (e) { this.used++; var t = !1; this.used >= this.line.getNumSegments() && (this.vertexCount = this.vertexCount + 100, this.line.setNumVertices(this.vertexCount), this.line.setNumSegments(this.vertexCount - 1), t = !0), this.line.vertices.setValue(this.used, e.point), this.line.setSegment(this.used - 1, this.used - 1, this.used), t ? this.line.geomDataTopologyChanged.emit({ indicesChanged: !0 }) : this.line.geomDataChanged.emit({ indicesChanged: !0 }), this.updated.emit(e); };
    Pt$1.prototype.toJSON = function (e) { var t = _super.prototype.toJSON.call(this, e); return t.lineThickness = this.line.lineThickness, t.color = this.geomItem.getMaterial().getParameter("Color").getValue(), t; };
    Pt$1.prototype.fromJSON = function (e, t) { e.lineThickness && (this.line.lineThickness = e.lineThickness); var s = new y(.7, .2, .2); e.color && s.fromJSON(e.color), this.geomItem.getMaterial().getParameter("Color").setValue(s), _super.prototype.fromJSON.call(this, e, t); };
    return Pt$1;
}(pt$1));
ae$1.registerChange("CreateFreehandLineChange", Pt$1);
var Tt$1 = /** @class */ (function (_super) {
    __extends(Tt$1, _super);
    function Tt$1(e, t) {
        var _this = this;
        _this = _super.call(this, "Create Sphere", e) || this, _this.sphere = new aa(0, 64, 32);
        var s = new He("Sphere", "SimpleSurfaceShader");
        _this.geomItem = new ma("Sphere"), _this.geomItem.setGeometry(_this.sphere), _this.geomItem.setMaterial(s), e && t && _this.setParentAndXfo(e, t);
        return _this;
    }
    Tt$1.prototype.update = function (e) { this.sphere.radius = e.radius, this.updated.emit(e); };
    Tt$1.prototype.toJSON = function () { var e = _super.prototype.toJSON.call(this); return e.radius = this.geomItem.getGeometry().radius, e; };
    Tt$1.prototype.changeFromJSON = function (e) { e.radius && (this.geomItem.getGeometry().radius = e.radius); };
    return Tt$1;
}(pt$1));
ae$1.registerChange("CreateSphereChange", Tt$1);
var Mt$1 = /** @class */ (function (_super) {
    __extends(Mt$1, _super);
    function Mt$1(e, t) {
        var _this = this;
        _this = _super.call(this, "Create Cuboid") || this, _this.cuboid = new qt(0, 0, 0, !0);
        var s = new He("Cuboid", "SimpleSurfaceShader");
        _this.geomItem = new ma("Cuboid"), _this.geomItem.setGeometry(_this.cuboid), _this.geomItem.setMaterial(s), e && t && _this.setParentAndXfo(e, t);
        return _this;
    }
    Mt$1.prototype.update = function (e) { if (e.baseSize && this.cuboid.setBaseSize(e.baseSize[0], e.baseSize[1]), e.tr) {
        var t_275 = this.geomItem.getParameter("LocalXfo").getValue();
        t_275.tr.fromJSON(e.tr), this.geomItem.getParameter("LocalXfo").setValue(t_275);
    } e.height && (this.cuboid.z = e.height), this.updated.emit(e); };
    return Mt$1;
}(pt$1));
ae$1.registerChange("CreateCuboidChange", Mt$1);
var Rt$1 = /** @class */ (function (_super) {
    __extends(Rt$1, _super);
    function Rt$1(e, t, s, i) {
        if (t === void 0) { t = .5; }
        if (s === void 0) { s = .02; }
        if (i === void 0) { i = new y(1, 1, 0); }
        var _this = this;
        _this = _super.call(this, e) || this, _this.lengthParam = _this.addParameter(new Xe("Length", t)), _this.handleRadiusParam = _this.addParameter(new Xe("Handle Radius", s)), _this.barRadiusParam = _this.addParameter(new Xe("Bar Radius", .25 * s)), _this.colorParam = _this.addParameter(new xe("Color", i)), _this.hilghlightColorParam = _this.addParameter(new xe("Highlight Color", new y(1, 1, 1))), _this.handleMat = new He("handle", "FlatSurfaceShader"), _this.handleMat.getParameter("BaseColor").setValue(_this.colorParam.getValue());
        var n = new He("topBar", "FlatSurfaceShader");
        n.getParameter("BaseColor").setValue(new y(.5, .5, .5));
        var h = new $t(.25 * s, 1, 64, 2, !0, !0), m = new aa(s, 64);
        _this.handle = new ma("handle", m, _this.handleMat), _this.baseBar = new ma("baseBar", h, _this.handleMat), _this.topBar = new ma("topBar", h, n), _this.handleXfo = new S, _this.baseBarXfo = new S, _this.topBarXfo = new S, _this.barRadiusParam.valueChanged.connect(function () { h.getParameter("radius").setValue(_this.barRadiusParam.getValue()); }), _this.handleRadiusParam.valueChanged.connect(function () { m.getParameter("radius").setValue(_this.handleRadiusParam.getValue()); }), _this.lengthParam.valueChanged.connect(function () { _this.__updateSlider(_this.value); }), _this.colorParam.valueChanged.connect(function () { _this.handleMat.getParameter("BaseColor").setValue(_this.colorParam.getValue()); }), _this.addChild(_this.handle), _this.addChild(_this.baseBar), _this.addChild(_this.topBar), _this.__updateSlider(0);
        return _this;
    }
    Rt$1.prototype.highlight = function () { this.handleMat.getParameter("BaseColor").setValue(this.hilghlightColorParam.getValue()); };
    Rt$1.prototype.unhighlight = function () { this.handleMat.getParameter("BaseColor").setValue(this.colorParam.getValue()); };
    Rt$1.prototype.setTargetParam = function (e) {
        var _this = this;
        this.param = e;
        var t = function () { _this.__updateSlider(e.getValue()); };
        t(), e.valueChanged.connect(t);
    };
    Rt$1.prototype.__updateSlider = function (e) { this.value = e; var t = this.param && this.param.getRange() ? this.param.getRange() : [0, 1], s = Math.remap(e, t[0], t[1], 0, 1), n = this.lengthParam.getValue(); this.baseBarXfo.sc.z = s * n, this.handleXfo.tr.z = s * n, this.topBarXfo.tr.z = s * n, this.topBarXfo.sc.z = (1 - s) * n, this.handle.setLocalXfo(this.handleXfo, E.GENERATED_VALUE), this.baseBar.setLocalXfo(this.baseBarXfo, E.GENERATED_VALUE), this.topBar.setLocalXfo(this.topBarXfo, E.GENERATED_VALUE); };
    Rt$1.prototype.onDragStart = function (e) { this.handleXfo.sc.x = this.handleXfo.sc.y = this.handleXfo.sc.z = 1.2, this.handle.setLocalXfo(this.handleXfo, E.GENERATED_VALUE), this.param && e.undoRedoManager && (this.change = new de$1(this.param), e.undoRedoManager.addChange(this.change)); };
    Rt$1.prototype.onDrag = function (e) { var t = this.lengthParam.getValue(), s = this.param && this.param.getRange() ? this.param.getRange() : [0, 1], i = Math.clamp(Math.remap(e.value, 0, t, s[0], s[1]), s[0], s[1]); if (!this.param)
        return this.__updateSlider(i), void (this.value = i); this.change ? this.change.update({ value: i }) : this.param.setValue(i); };
    Rt$1.prototype.onDragEnd = function (e) { this.change = null, this.handleXfo.sc.x = this.handleXfo.sc.y = this.handleXfo.sc.z = 1, this.handle.setLocalXfo(this.handleXfo, E.GENERATED_VALUE); };
    Rt$1.prototype.toJSON = function (e, t) {
        if (t === void 0) { t = 0; }
        var s = _super.prototype.toJSON.call(this, e, t | SAVE_FLAG_SKIP_CHILDREN);
        return this.param && (s.targetParam = this.param.getPath()), s;
    };
    Rt$1.prototype.fromJSON = function (e, t, s) {
        var _this = this;
        _super.prototype.fromJSON.call(this, e, t, s), e.targetParam && t.resolvePath(e.targetParam).then(function (e) { _this.setTargetParam(e); });
    };
    return Rt$1;
}(he$1));
J.registerClass("SliderHandle", Rt$1);
var xt$1 = /** @class */ (function (_super) {
    __extends(xt$1, _super);
    function xt$1(t, s, i, n, l) {
        if (s === void 0) { s = 1; }
        if (i === void 0) { i = 1; }
        if (n === void 0) { n = .02; }
        if (l === void 0) { l = new y(1, 1, 0); }
        var _this = this;
        _this = _super.call(this, t) || this, _this.arcRadiusParam = _this.addParameter(new Xe("Arc Radius", s)), _this.arcAngleParam = _this.addParameter(new Xe("Arc Angle", i)), _this.handleRadiusParam = _this.addParameter(new Xe("Handle Radius", n)), _this.colorParam = _this.addParameter(new xe("Color", l)), _this.hilghlightColorParam = _this.addParameter(new xe("Highlight Color", new y(1, 1, 1))), _this.handleMat = new He("handleMat", "HandleShader");
        var h = new Dt(s, i, 64), m = new aa(n, 64);
        _this.handle = new ma("handle", m, _this.handleMat), _this.arc = new ma("arc", h, _this.handleMat), _this.handleXfo = new S, _this.handleGeomOffsetXfo = new S, _this.handleGeomOffsetXfo.tr.x = s, _this.handle.getParameter("GeomOffsetXfo").setValue(_this.handleGeomOffsetXfo), _this.range = [0, i], _this.arcAngleParam.valueChanged.connect(function () { var e = _this.arcAngleParam.getValue(); h.getParameter("Angle").setValue(e), _this.range = [0, e]; }), _this.arcRadiusParam.valueChanged.connect(function () { var e = _this.arcRadiusParam.getValue(); h.getParameter("Radius").setValue(e), _this.handleGeomOffsetXfo.tr.x = e, _this.handle.getParameter("GeomOffsetXfo").setValue(_this.handleGeomOffsetXfo); }), _this.handleRadiusParam.valueChanged.connect(function () { m.getParameter("radius").setValue(_this.handleRadiusParam.getValue()); }), _this.colorParam.valueChanged.connect(function () { _this.handleMat.getParameter("BaseColor").setValue(_this.colorParam.getValue()); }), _this.addChild(_this.handle), _this.addChild(_this.arc), _this.setTargetParam(_this.handle.getParameter("GlobalXfo"), !1), _this.dragStart = new C, _this.dragEnd = new C;
        return _this;
    }
    xt$1.prototype.onMouseEnter = function (e) { e.intersectionData && e.intersectionData.geomItem == this.handle && this.highlight(); };
    xt$1.prototype.onMouseLeave = function (e) { this.unhighlight(); };
    xt$1.prototype.onMouseDown = function (e) { e.intersectionData && e.intersectionData.geomItem == this.handle && _super.prototype.onMouseDown.call(this, e); };
    xt$1.prototype.highlight = function () { this.handleMat.getParameter("BaseColor").setValue(this.hilghlightColorParam.getValue()); };
    xt$1.prototype.unhighlight = function () { this.handleMat.getParameter("BaseColor").setValue(this.colorParam.getValue()); };
    xt$1.prototype.getBaseXfo = function () { return this.handle.getParameter("GlobalXfo").getValue(); };
    xt$1.prototype.onDragStart = function (e) { this.baseXfo = this.getGlobalXfo().clone(), this.baseXfo.sc.set(1, 1, 1), this.deltaXfo = new S, this.vec0 = this.getGlobalXfo().ori.getXaxis(), this.vec0.normalizeInPlace(), e.undoRedoManager && (this.change = new de$1(this.param), e.undoRedoManager.addChange(this.change)), this.handleGeomOffsetXfo.sc.x = this.handleGeomOffsetXfo.sc.y = this.handleGeomOffsetXfo.sc.z = 1.2, this.handle.getParameter("GeomOffsetXfo").setValue(this.handleGeomOffsetXfo), this.dragStart.emit(); };
    xt$1.prototype.onDrag = function (e) { var t = e.holdPos.subtract(this.baseXfo.tr); t.normalizeInPlace(); var s = this.vec0.angleTo(t); if (this.vec0.cross(t).dot(this.baseXfo.ori.getZaxis()) < 0 && (s = -s), this.range && (s = Math.clamp(s, this.range[0], this.range[1])), e.shiftKey) {
        var e_250 = Math.degToRad(22.5);
        s = Math.floor(s / e_250) * e_250;
    } this.deltaXfo.ori.setFromAxisAndAngle(new Vec3(0, 0, 1), s); var i = this.baseXfo.multiply(this.deltaXfo); if (this.change)
        this.change.update({ value: i });
    else {
        (this.param ? this.param : this.getParameter("GlobalXfo")).setValue(i);
    } };
    xt$1.prototype.onDragEnd = function (e) { this.change = null, this.handleGeomOffsetXfo.sc.x = this.handleGeomOffsetXfo.sc.y = this.handleGeomOffsetXfo.sc.z = 1, this.handle.getParameter("GeomOffsetXfo").setValue(this.handleGeomOffsetXfo), this.dragEnd.emit(); };
    xt$1.prototype.toJSON = function (e, t) {
        if (t === void 0) { t = 0; }
        var s = _super.prototype.toJSON.call(this, e, t | SAVE_FLAG_SKIP_CHILDREN);
        return this.param && (s.targetParam = this.param.getPath()), s;
    };
    xt$1.prototype.fromJSON = function (e, t, s) {
        var _this = this;
        _super.prototype.fromJSON.call(this, e, t, s), e.targetParam && t.resolvePath(e.targetParam).then(function (e) { _this.setTargetParam(e); });
    };
    return xt$1;
}(ue$1));
J.registerClass("ArcSlider", xt$1);
var At$1 = /** @class */ (function (_super) {
    __extends(At$1, _super);
    function At$1() {
        var _this = _super.call(this) || this;
        var e = _this.attachShadow({ mode: "open" }), t = document.createElement("style");
        t.appendChild(document.createTextNode(At$1.css)), e.appendChild(t), _this.itemContainer = document.createElement("div"), _this.itemHeader = document.createElement("div"), _this.itemHeader.className = "TreeNodeHeader", _this.itemContainer.appendChild(_this.itemHeader), _this.itemChildren = document.createElement("div"), _this.itemChildren.className = "TreeNodesList", _this.itemContainer.appendChild(_this.itemChildren), _this.expandBtn = document.createElement("button"), _this.expandBtn.className = "TreeNodesListItem__ToggleExpanded", _this.itemHeader.appendChild(_this.expandBtn), _this.expanded = !1, _this.childrenAlreadyCreated = !1, _this.expandBtn.addEventListener("click", function () { _this.treeItem.getNumChildren() > 0 && (_this.expanded ? _this.collapse() : _this.expand()); }), _this.titleElement = document.createElement("span"), _this.titleElement.className = "TreeNodesListItem__Title", _this.titleElement.addEventListener("click", function (e) { _this.appData && _this.appData.selectionManager ? _this.appData.selectionManager.pickingModeActive() ? _this.appData.selectionManager.pick(_this.treeItem) : _this.appData.selectionManager.toggleItemSelection(_this.treeItem, !e.ctrlKey) : _this.treeItem.setSelected(!_this.treeItem.getSelected()); }), _this.itemHeader.appendChild(_this.titleElement), e.appendChild(_this.itemContainer);
        return _this;
    }
    At$1.prototype.setTreeItem = function (e, s) {
        var _this = this;
        this.treeItem = e, this.appData = s, this.titleElement.textContent = e.getName();
        this.treeItem.nameChanged.connect(function () { _this.titleElement.textContent = e.getName(); }), this.updateSelectedId = this.treeItem.selectedChanged.connect(this.updateSelected.bind(this)), this.updateSelected(), e instanceof ra && (this.toggleVisibilityBtn = document.createElement("button"), this.toggleVisibilityBtn.className = "TreeNodesListItem__ToggleVisibility", this.itemHeader.insertBefore(this.toggleVisibilityBtn, this.titleElement), this.toggleVisibilityBtn.innerHTML = '<i class="material-icons-outlined md-15">visibility</i>', this.toggleVisibilityBtn.addEventListener("click", function () { var e = _this.treeItem.getParameter("Visible"); if (_this.appData && _this.appData.undoRedoManager) {
            var t_276 = new ParameterValueChange(e, !e.getValue());
            _this.appData.undoRedoManager.addChange(t_276);
        }
        else
            e.setValue(!e.getValue()); }), this.updateVisibilityId = this.treeItem.visibilityChanged.connect(this.updateVisibility.bind(this)), this.updateVisibility(), this.updateHighlightId = this.treeItem.highlightChanged.connect(this.updateHighlight.bind(this)), this.updateHighlight(), this.treeItem.getChildren().length && this.collapse(), this.childAddedId = this.treeItem.childAdded.connect(this.childAdded.bind(this)), this.childRemovedId = this.treeItem.childRemoved.connect(this.childRemoved.bind(this)));
    };
    At$1.prototype.updateVisibility = function () { var e = this.treeItem.getVisible(); e ? this.itemContainer.classList.remove("TreeNodesListItem--isHidden") : this.itemContainer.classList.add("TreeNodesListItem--isHidden"), this.toggleVisibilityBtn.innerHTML = e ? '<i class="material-icons-outlined md-15">visibility</i>' : '<i class="material-icons-outlined md-15">visibility_off</i>'; };
    At$1.prototype.updateSelected = function () { this.treeItem.getSelected() ? this.itemContainer.classList.add("TreeNodesListItem--isSelected") : this.itemContainer.classList.remove("TreeNodesListItem--isSelected"); };
    At$1.prototype.updateHighlight = function () { var e = this.treeItem.isHighlighted(); if (e ? this.itemContainer.classList.add("TreeNodesListItem--isHighlighted") : this.itemContainer.classList.remove("TreeNodesListItem--isHighlighted"), e) {
        var e_251 = this.treeItem.getHighlight(), t_277 = e_251.lerp(new y(.75, .75, .75, 0), .5);
        this.titleElement.style.setProperty("border-color", e_251.toHex()), this.titleElement.style.setProperty("background-color", t_277.toHex());
    }
    else
        this.titleElement.style.removeProperty("border-color"), this.titleElement.style.removeProperty("background-color"); };
    At$1.prototype.expand = function () {
        var _this = this;
        if (this.expanded = !0, this.itemChildren.classList.remove("TreeNodesList--collapsed"), this.expandBtn.innerHTML = '<i class="material-icons md-24">arrow_drop_down</i>', !this.childrenAlreadyCreated) {
            this.treeItem.getChildren().forEach(function (e, t) { _this.addChild(e, t); }), this.childrenAlreadyCreated = !0;
        }
    };
    At$1.prototype.collapse = function () { this.itemChildren.classList.add("TreeNodesList--collapsed"), this.expandBtn.innerHTML = '<i class="material-icons md-24">arrow_right</i>', this.expanded = !1; };
    At$1.prototype.addChild = function (e, t) { if (this.expanded) {
        var s = document.createElement("tree-item-view");
        s.setTreeItem(e, this.appData), t == this.itemChildren.childElementCount ? this.itemChildren.appendChild(s) : this.itemChildren.insertBefore(s, this.itemChildren.children[t]);
    }
    else
        this.collapse(); };
    At$1.prototype.childAdded = function (e, t) { this.addChild(e, t); };
    At$1.prototype.childRemoved = function (e, t) { this.expanded && (this.itemChildren.children[t].destroy(), this.itemChildren.removeChild(this.itemChildren.children[t])); };
    At$1.prototype.destroy = function () { this.treeItem.selectedChanged.disconnectId(this.updateSelectedId), this.treeItem instanceof ra && (this.treeItem.highlightChanged.disconnectId(this.updateHighlightId), this.treeItem.visibilityChanged.disconnectId(this.updateVisibilityId), this.treeItem.childAdded.disconnectId(this.childAddedId), this.treeItem.childRemoved.disconnectId(this.childRemovedId)); };
    return At$1;
}(HTMLElement));
At$1.css = "\n  /* tree-view.css */\n\n  ////\n  /// From https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined\n\n  /* fallback */\n  @font-face {\n    font-family: 'Material Icons';\n    font-style: normal;\n    font-weight: 400;\n    src: url(https://fonts.gstatic.com/s/materialicons/v48/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2');\n  }\n  /* fallback */\n  @font-face {\n    font-family: 'Material Icons Outlined';\n    font-style: normal;\n    font-weight: 400;\n    src: url(https://fonts.gstatic.com/s/materialiconsoutlined/v14/gok-H7zzDkdnRel8-DQ6KAXJ69wP1tGnf4ZGhUce.woff2) format('woff2');\n  }\n\n  .material-icons {\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: 1;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n\n  .material-icons-outlined {\n    font-family: 'Material Icons Outlined';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: 1;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n  .TreeNodesList {\n    border-left: 1px dotted;\n    list-style-type: none;\n    padding: 0 0 0 15px;\n    margin: 0 0 0 10px;\n  }\n\n  .TreeNodesList--collapsed {\n    display: none;\n  }\n\n  .TreeNodesList--root {\n    border: none;\n    margin: 0;\n    padding: 0;\n    width: max-content;\n  }\n\n  .TreeNodesListItem{\n    display: flex;\n  }\n\n  .TreeNodesListItem__ToggleVisibility {\n    border: none;\n    color: #333;\n    height: 24px;\n    padding: 0;\n    width: 25px;\n  }\n\n  .TreeNodesListItem__ToggleVisibility:focus {\n    outline: none;\n  }\n\n  .TreeNodesListItem__ToggleExpanded {\n    border: none;\n    height: 24px;\n    width: 24px;\n    padding: 0;\n    background-color: #0000;\n    outline: none;\n  }\n\n  .TreeNodesListItem::before {\n    border-bottom: 1px dotted;\n    content: '';\n    display: inline-block;\n    left: -15px;\n    position: relative;\n    top: -5px;\n    width: 10px;\n  }\n\n  .TreeNodesListItem__Toggle:focus {\n    outline: none;\n  }\n\n  .TreeNodeHeader{\n    display: flex;\n    margin: 0.4em auto;\n  }\n\n  .TreeNodesListItem__Title {\n    cursor: default;\n    padding: 2px 4px;\n    border-radius: 5px;\n  }\n\n  .TreeNodesListItem__Title:hover {\n    background-color: #e1f5fe;\n  }\n  .TreeNodesListItem__Hover {\n    background-color: #e1f5fe;\n  }\n\n  .TreeNodesListItem__Dragging {\n    background-color: #e1f5fe;\n  }\n\n  .TreeNodesListItem--isSelected > .TreeNodeHeader > .TreeNodesListItem__Title {\n    background-color: #76d2bb;\n    color: #3B3B3B;\n  }\n\n  .TreeNodesListItem--isHidden > .TreeNodeHeader >  .TreeNodesListItem__Title {\n    color: #9e9e9e;\n  }\n\n  .TreeNodesListItem--isHighlighted > .TreeNodeHeader >  .TreeNodesListItem__Title {\n    border-style: solid;\n    border-width: thin;\n  }\n\n  /* Rules for sizing the icon. */\n  .material-icons-outlined.md-15,\n  .material-icons.md-15 {\n    font-size: 15px;\n  }\n  .material-icons.md-18 {\n    font-size: 18px;\n  }\n  .material-icons.md-24 {\n    font-size: 24px;\n  }\n  .material-icons.md-36 {\n    font-size: 36px;\n  }\n  .material-icons.md-48 {\n    font-size: 48px;\n  }\n\n  /* Rules for using icons as black on a light background. */\n  .material-icons.md-dark {\n    color: rgba(0, 0, 0, 0.54);\n  }\n  .material-icons.md-dark.md-inactive {\n    color: rgba(0, 0, 0, 0.26);\n  }\n\n  /* Rules for using icons as white on a dark background. */\n  .material-icons.md-light {\n    color: rgba(255, 255, 255, 1);\n  }\n  .material-icons.md-light.md-inactive {\n    color: rgba(255, 255, 255, 0.3);\n  }\n\n  ";
customElements.get("tree-item-view") || customElements.define("tree-item-view", At$1);
var Xt$1 = /** @class */ (function (_super) {
    __extends(Xt$1, _super);
    function Xt$1() {
        var _this = _super.call(this) || this;
        var e = _this.attachShadow({ mode: "open" });
        _this.treeContainer = document.createElement("div"), e.appendChild(_this.treeContainer), _this.treeItemView = document.createElement("tree-item-view");
        var t = new CSSStyleSheet;
        t.replaceSync("@font-face {\n      font-family: \"Material Icons\";\n      font-style: normal;\n      font-weight: 400;\n      src: url('https://fonts.gstatic.com/s/materialicons/v48/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2') format('woff');\n    }");
        var s = new CSSStyleSheet;
        s.replaceSync("@font-face {\n      font-family: \"Material Icons Outlined\";\n      font-style: normal;\n      font-weight: 400;\n      src: url('https://fonts.gstatic.com/s/materialiconsoutlined/v14/gok-H7zzDkdnRel8-DQ6KAXJ69wP1tGnf4ZGhUce.woff2') format('woff');\n    }"), document.adoptedStyleSheets = __spreadArrays(document.adoptedStyleSheets, [t, s]);
        return _this;
    }
    Xt$1.prototype.setTreeItem = function (e, t) { this.treeItemView.setTreeItem(e, t), this.treeContainer.appendChild(this.treeItemView); };
    return Xt$1;
}(HTMLElement));
customElements.get("scene-tree-view") || customElements.define("scene-tree-view", Xt$1);
export { E, Fe as F, G, Ie as I, Le as L, Me as M, Pe as P, Re as R, S, Ve as V, Xe as X, Z, _, de$1 as d, fe as f, v, xe as x, y };
