var __extends=this&&this.__extends||function(){var t=function(e,a){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)if(e.hasOwnProperty(a))t[a]=e[a]};return t(e,a)};return function(e,a){t(e,a);function i(){this.constructor=e}e.prototype=a===null?Object.create(a):(i.prototype=a.prototype,new i)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var e,a=1,i=arguments.length;a<i;a++){e=arguments[a];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n))t[n]=e[n]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(t,e,a,i){function n(t){return t instanceof a?t:new a((function(e){e(t)}))}return new(a||(a=Promise))((function(a,r){function o(t){try{s(i.next(t))}catch(e){r(e)}}function l(t){try{s(i["throw"](t))}catch(e){r(e)}}function s(t){t.done?a(t.value):n(t.value).then(o,l)}s((i=i.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var a={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(t){return function(e){return s([t,e])}}function s(o){if(i)throw new TypeError("Generator is already executing.");while(a)try{if(i=1,n&&(r=o[0]&2?n["return"]:o[0]?n["throw"]||((r=n["return"])&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;if(n=0,r)o=[o[0]&2,r.value];switch(o[0]){case 0:case 1:r=o;break;case 4:a.label++;return{value:o[1],done:false};case 5:a.label++;n=o[1];o=[0];continue;case 7:o=a.ops.pop();a.trys.pop();continue;default:if(!(r=a.trys,r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){a=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(o[0]===6&&a.label<r[1]){a.label=r[1];r=o;break}if(r&&a.label<r[2]){a.label=r[2];a.ops.push(o);break}if(r[2])a.ops.pop();a.trys.pop();continue}o=e.call(t,a)}catch(l){o=[6,l];n=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,a=arguments.length;e<a;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<a;e++)for(var r=arguments[e],o=0,l=r.length;o<l;o++,n++)i[n]=r[o];return i};System.register(["./p-29030769.system.js","./p-bd53c535.system.js"],(function(t){"use strict";var e,a;return{setters:[function(t){e=t.p},function(t){a=t.B}],execute:function(){function i(t,e){if(!i.watchedElementData){i.watchedElementData=[];var a=function(){i.watchedElementData.forEach((function(t){t.element.offsetWidth===t.offsetWidth&&t.element.offsetHeight===t.offsetHeight||(t.offsetWidth=t.element.offsetWidth,t.offsetHeight=t.element.offsetHeight,t.callback())}))};window.addEventListener("resize",a);new MutationObserver(a).observe(document.body,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}i.watchedElementData.push({element:t,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,callback:e})}var n=function(){var t=null!=(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Pixel/i)||navigator.userAgent.match(/Windows Phone/i)),e=function(){var t=navigator.userAgent;var e,a,i,n=navigator.appName,r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10);return-1!=(a=t.indexOf("Opera"))?(n="Opera",r=t.substring(a+6),-1!=(a=t.indexOf("Version"))&&(r=t.substring(a+8))):-1!=(a=t.indexOf("MSIE"))?(n="Microsoft Internet Explorer",r=t.substring(a+5)):-1!=(a=t.indexOf("Edge"))?(n="Edge",r=t.substring(a+4)):-1!=(a=t.indexOf("Chrome"))?(n="Chrome",r=t.substring(a+7)):-1!=(a=t.indexOf("Safari"))?(n="Safari",r=t.substring(a+7),-1!=(a=t.indexOf("Version"))&&(r=t.substring(a+8))):-1!=(a=t.indexOf("Firefox"))?(n="Firefox",r=t.substring(a+8)):(e=t.lastIndexOf(" ")+1)<(a=t.lastIndexOf("/"))&&(n=t.substring(e,a),r=t.substring(a+1),n.toLowerCase()==n.toUpperCase()&&(n=navigator.appName)),-1!=(i=r.indexOf(";"))&&(r=r.substring(0,i)),-1!=(i=r.indexOf(" "))&&(r=r.substring(0,i)),o=parseInt(""+r,10),isNaN(o)&&(r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10)),{browserName:n,fullVersion:r,majorVersion:o,appName:navigator.appName,userAgent:navigator.userAgent}}(),a=function(){var t,e;try{t=document.createElement("canvas").getContext("webgl")}catch(t){}if(!t)return;try{e=document.createElement("canvas").getContext("webgl2")}catch(t){}var a=t.getExtension("WEBGL_debug_renderer_info");if(!a)return console.warn("Unable to determine GPU Info:"),{vendor:"Unknown",renderer:"Unknown",gpuVendor:"Unknown",maxTextureSize:"Unknown",supportsWebGL2:null!=e};var i=t.getParameter(a.UNMASKED_VENDOR_WEBGL),n=t.getParameter(a.UNMASKED_RENDERER_WEBGL),r=t.getParameter(t.MAX_TEXTURE_SIZE);var o;return n.match(/NVIDIA/i)?o="NVidia":n.match(/AMD/i)||n.match(/Radeon/i)?o="AMD":n.match(/Intel/i)?o="Intel":n.match(/Mali/i)?o="ARM":n.match(/Adreno/i)?o="Adreno":console.warn("Unable to determine GPU vendor:",n),{vendor:i,renderer:n,gpuVendor:o,maxTextureSize:r,supportsWebGL2:null!=e}}();var i="Low";if(a)if(t)i="Low";else{var n=a.renderer.replace(/[()]/g,"").split(" ");if("NVidia"==a.gpuVendor){var r=n.indexOf("GTX");if(-1!=r){var o=n[r+1];if(o.endsWith("M")){i=parseInt(o.substring(0,o.length-2))>=900?"Medium":"Low"}else{i=parseInt(o)>=1030?"High":"Medium"}}else i=-1!=n.indexOf("TITAN")||-1!=n.indexOf("Quadro")?"High":"Low"}else if("AMD"==a.gpuVendor){var l=n.indexOf("Radeon");if(-1!=l){var s=n.indexOf("RX");if(-1!=s)if("Vega"==n[s+1])i="High";else{var d=n[s+1];var c=void 0;d.endsWith("X")?(c=parseInt(d.substring(0,d.length-2)),i="High"):c=parseInt(d),i=c>=480?"High":"Medium"}else if("Pro"==n[l+1]){i=parseInt(n[s+1])>=450?"Medium":"Low"}else if("Sky"==n[l+1]){i=parseInt(n[s+1])>=700?"Medium":"Low"}else i="Low"}else i=-1!=n.indexOf("FirePro")||-1!=n.indexOf("Quadro")?"High":"Low"}else("Adreno"==a.gpuVendor||"Intel"==a.gpuVendor)&&(i="Low")}return{isMobileDevice:t,isIOSDevice:null!=(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)),browserName:e.browserName,fullVersion:e.fullVersion,majorVersion:e.majorVersion,appName:e.appName,userAgent:e.userAgent,webGLSupported:null!=a,gpuDesc:a,deviceCategory:i}}();var r=Object.freeze({__proto__:null,SystemDesc:n});var o=Math.PI/180;Math.HALF_PI=.5*Math.PI,Math.TWO_PI=2*Math.PI;Math.radToDeg=function(t){return t/o},Math.degToRad=function(t){return t*o},Number.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)};var l=function(t){var e,a,i,n=0;if(0===t.length)return n;for(e=0,i=t.length;e<i;e++)a=t.charCodeAt(e),n=(n<<5)-n+a,n|=0;return Math.abs(n)};function s(t,e,a){if(e===void 0){e=0}if(a===void 0){a=5}return JSON.stringify(t,(function(t,e){return e&&e.toFixed?Number(e.toFixed(a)):e}),e)}String.prototype.hash=function(){return l(this)},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.lpad=function(t,e){var a=this;for(;a.length<e;)a=t+a;return a},String.prototype.rpad=function(t,e){var a=this;for(;a.length<e;)a+=t;return a},Math.randomInt=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t},Math.lerp=function(t,e,a){return t+a*(e-t)},Math.clamp=function(t,e,a){return Math.min(Math.max(t,e),a)},Math.nearestPow2=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))},Math.nearestPow10=function(t){return Math.pow(10,Math.round(Math.log10(t)/Math.log10(10)))},Math.nextPow2=function(t){var e=0;for(;t>0;)e++,t>>=1;return 1<<e},Math.fract=function(t){return 0==t?0:t<0?t>-1?-t:-t%Math.floor(-t):t<1?t:t%Math.floor(t)},Math.remap=function(t,e,a,i,n){return i+(t-e)/(a-e)*(n-i)},Math.convertFloat32ArrayToUInt16Array=function(t){var e=new Uint16Array(t.length),a=new Int32Array(t.buffer),i=function(t){var e=t>>16&32768,a=t>>12&2047;var i=t>>23&255;return i<103?e:i>142?(e|=31744,e|=(255==i?0:1)&&8388607&t,e):i<113?(a|=2048,e|=(a>>114-i)+(a>>113-i&1),e):(e|=i-112<<10|a>>1,e+=1&a,e)};for(var n=0;n<t.length;n++)e[n]=i(a[n]);return e},Math.decode16BitFloatFrom2xUInt8=function(t){var e=t[0],a=(120&e)>>3;var i=0==a?0:2048;var n=i+((7&e)<<8)+t[1];i=0==a?1:0;return(128&e?1:-1)*n*Math.pow(2,a+i-16)},Math.encode16BitFloatInto2xUInt8=function(t){c||(c=new Uint8Array(2));var e=t>=0?128:0;t=Math.abs(t);var a,i=15,n=1024;for(var r=15;r>0;r--)t<n&&(n/=2,i--);a=0==i?t/n/2:(t-n)/n;var o=Math.round(2048*a),l=o/256,s=o-256*l;return c[0]=e+8*i+l,c[1]=s,t>=2048&&(c[0]=255),c},Math.encode16BitFloat=function(t){var e=new Float32Array(1);e[0]=t;return function(t){var e=t>>16&32768,a=t>>12&2047;var i=t>>23&255;return i<103?e:i>142?(e|=31744,e|=(255==i?0:1)&&8388607&t,e):i<113?(a|=2048,e|=(a>>114-i)+(a>>113-i&1),e):(e|=i-112<<10|a>>1,e+=1&a,e)}(new Int32Array(e.buffer)[0])},Math.decode16BitFloat=function(t){var e=(32768&t)>>15,a=(31744&t)>>10,i=1023&t;return 0==a?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==a?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,a-15)*(1+i/Math.pow(2,10))},Math.smoothStep=function(t,e,a){var i=Math.clamp((a-t)/(e-t),0,1);return i*i*(3-2*i)},Math.linStep=function(t,e,a){return Math.clamp((a-t)/(e-t),0,1)};var d=function(){function t(){}t.prototype.isValid=function(){for(var t=0,e=this.__data;t<e.length;t++){var a=e[t];if(a==1/0||isNaN(a))return!1}return!0};t.createFromFloat32Buffer=function(t,e){throw new Error("Not yet implemented for this type:"+this.constructor.name)};t.numElements=function(){throw new Error("Not yet implemented for this type:"+this.constructor.name)};t.prototype.asArray=function(){return this.__data};t.prototype.toString=function(){return s(this.toJSON())};t.prototype.toJSON=function(){throw new Error("Not yet implemented for this type:"+this.constructor.name)};return t}();var u=new(function(){function t(){this.__types={},this.__names={},this.registerType("SInt32",5),this.registerType("UInt32",4),this.registerType("Float32",6)}t.prototype.registerType=function(t,e){this.__types[t]=e,e.name?this.__names[e.name]=t:this.__names[e]=t};t.prototype.getType=function(t){return this.__types[t]};t.prototype.getTypeName=function(t){if(this.__names[t])return this.__names[t];if(this.__names[t.name])return this.__names[t.name];throw t};return t}());var h=function(t){__extends(e,t);function e(e,a){if(e===void 0){e=0}if(a===void 0){a=0}var i=this;if(i=t.call(this)||this,e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)i.__data=e;else if(e instanceof ArrayBuffer){var n=e,r=a;i.__data=new Float32Array(n,r,2)}else null!=e&&"object"==typeof e?(i.__data=new Float32Array(2),i.fromJSON(e)):(i.__data=new Float32Array(2),i.__data[0]=e,i.__data[1]=a);return i}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e){this.__data[0]=t,this.__data[1]=e};e.prototype.setFromOther=function(t){this.x=t.x,this.y=t.y};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y};e.prototype.notEquals=function(t){return this.x!=t.x&&this.y!=t.y};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)};e.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this};e.prototype.scale=function(t){return new e(this.x*t,this.y*t)};e.prototype.scaleInPlace=function(t){this.x*=t,this.y*=t};e.prototype.invert=function(){return new e(1/this.x,1/this.y)};e.prototype.invertInPlace=function(){return this.x=1/this.x,this.y=1/this.y,this};e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)};e.prototype.multiplyInPlace=function(t){this.x*=t.x,this.y*=t.y};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1];return t*t+e*e};e.prototype.length=function(){return Math.sqrt(this.lengthSquared())};e.prototype.distanceTo=function(t){var e=this.__data[0]-t.x,a=this.__data[1]-t.y;return Math.sqrt(e*e+a*a)};e.prototype.normalize=function(){var t=this.__data[0],a=this.__data[1];var i=t*t+a*a;return i<Number.EPSILON?new e:(i=1/Math.sqrt(i),new e(t*i,a*i))};e.prototype.normalizeInPlace=function(){var t=this.__data[0],e=this.__data[1];var a=t*t+e*e;a<Number.EPSILON||(a=1/Math.sqrt(a),this.set(t*a,e*a))};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y};e.prototype.cross=function(t){return this.x*t.y-this.y*t.x};e.prototype.angleTo=function(t){var e=this.normalize().dot(t.normalize());return e>1?0:e<-1?Math.PI:Math.acos(e)};e.prototype.signedAngleTo=function(t){var e=this.angleTo(t);return this.cross(t)<0?-e:e};e.prototype.rotate=function(t){var a=Math.cos(t),i=Math.sin(t);return new e(this.x*a-this.y*i,this.x*i+this.y*a)};e.prototype.lerp=function(t,a){var i=this.x,n=this.y;return new e(i+a*(t.x-i),n+a*(t.y-n))};e.prototype.setRandomDir=function(t){if(t===void 0){t=1}var e=2*Math.random()*Math.PI;return this.__data[0]=Math.cos(e)*zScale,this.__data[1]=Math.sin(e)*zScale,this};e.prototype.setRandom=function(t){if(t===void 0){t=1}return this.__data[0]=Math.random()*t,this.__data[1]=Math.random()*t,this};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1])};e.prototype.asArray=function(){return this.__data};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.createFromFloat32Array=function(t){return new e(t)};e.numElements=function(){return 2};e.prototype.toJSON=function(){return{x:this.x,y:this.y}};e.prototype.fromJSON=function(t){this.x=t.x,this.y=t.y};return e}(d);t("_",h);u.registerType("Vec2",h);var m=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}var n=this;if(n=t.call(this)||this,e instanceof Float32Array||e instanceof Uint32Array)n.__data=e;else if(e instanceof ArrayBuffer){var r=e,o=a;n.__data=new Float32Array(r,o,3)}else null!=e&&"object"==typeof e?(n.__data=new Float32Array(3),n.fromJSON(e)):(n.__data=new Float32Array(3),n.__data[0]=e,n.__data[1]=a,n.__data[2]=i);return n}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xy",{get:function(){return new h(this.__data[0],this.__data[1])},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yz",{get:function(){return new h(this.__data[1],this.__data[2])},enumerable:true,configurable:true});e.prototype.set=function(t,e,a){this.x=t,this.y=void 0!==e?e:t,this.z=void 0!==a?a:t};e.prototype.setDataArray=function(t){this.__data=t};e.prototype.setFromOther=function(t){this.x=t.x,this.y=t.y,this.z=t.z};e.prototype.isNull=function(){return Math.abs(this.x)<Number.EPSILON&&Math.abs(this.y)<Number.EPSILON&&Math.abs(this.z)<Number.EPSILON};e.prototype.is111=function(){return Math.abs(1-this.x)<Number.EPSILON&&Math.abs(1-this.y)<Number.EPSILON&&Math.abs(1-this.z)<Number.EPSILON};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z};e.prototype.notEquals=function(t){return this.x!=t.x&&this.y!=t.y&&this.z!=t.z};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)};e.prototype.subtractInPlace=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z};e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z)};e.prototype.multiplyInPlace=function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z};e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z)};e.prototype.divideInPlace=function(t){this.x/=t.x,this.y/=t.y,this.z/=t.z};e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t)};e.prototype.scaleInPlace=function(t){this.x*=t,this.y*=t,this.z*=t};e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z)};e.prototype.inverse=function(){return new e(1/this.x,1/this.y,1/this.z)};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2];return t*t+e*e+a*a};e.prototype.length=function(){return Math.sqrt(this.lengthSquared())};e.prototype.distanceTo=function(t){var e=this.__data[0]-t.x,a=this.__data[1]-t.y,i=this.__data[2]-t.z;return Math.sqrt(e*e+a*a+i*i)};e.prototype.normalize=function(){var t=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];return t<Number.EPSILON?new e:(t=1/Math.sqrt(t),new e(this.__data[0]*t,this.__data[1]*t,this.__data[2]*t))};e.prototype.normalizeInPlace=function(){var t=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(t<Number.EPSILON)return;t=Math.sqrt(t);var e=1/t;return this.__data[0]*=e,this.__data[1]*=e,this.__data[2]*=e,t};e.prototype.resize=function(t){var a=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(a<Number.EPSILON)return;var i=t/Math.sqrt(a);return new e(this.__data[0]*i,this.__data[1]*i,this.__data[2]*i)};e.prototype.resizeInPlace=function(t){var e=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(e<Number.EPSILON)return;var a=t/Math.sqrt(e);this.__data[0]*=a,this.__data[1]*=a,this.__data[2]*=a};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z};e.prototype.cross=function(t){var a=this.x,i=this.y,n=this.z,r=t.x,o=t.y,l=t.z;return new e(i*l-n*o,n*r-a*l,a*o-i*r)};e.prototype.angleTo=function(t){var e=this.dot(t);return e>1?0:Math.acos(e)};e.prototype.lerp=function(t,a){var i=this.x,n=this.y,r=this.z;return new e(i+a*(t.x-i),n+a*(t.y-n),r+a*(t.z-r))};e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))};e.prototype.setRandomDir=function(t){if(t===void 0){t=1}var e=2*Math.random()*Math.PI,a=2*Math.random()-1,i=Math.sqrt(1-a*a)*t;return this.__data[0]=Math.cos(e)*i,this.__data[1]=Math.sin(e)*i,this.__data[2]=a*t,this};e.prototype.setRandom=function(t){if(t===void 0){t=1}return this.__data[0]=(Math.random()-.5)*t,this.__data[1]=(Math.random()-.5)*t,this.__data[2]=(Math.random()-.5)*t,this};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2])};e.prototype.asArray=function(){return this.__data};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromJSON=function(t){var a=new e;return a.fromJSON(t),a};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.createFromFloat32Array=function(t){return new e(t)};e.numElements=function(){return 3};e.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z}};e.prototype.fromJSON=function(t){this.x=t.x,this.y=t.y,this.z=t.z};return e}(d);t("c",m);u.registerType("Vec3",m);var p=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}var r=this;if(r=t.call(this)||this,e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Float32Array(o,l,4)}else null!=e&&"object"==typeof e?(r.__data=new Float32Array(4),r.fromJSON(e)):(r.__data=new Float32Array(4),r.__data[0]=e,r.__data[1]=a,r.__data[2]=i,r.__data[3]=n);return r}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"t",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xyz",{get:function(){return new m(this.__data[0],this.__data[1],this.__data[2])},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){this.x=t,this.y=e,this.z=a,this.t=i};e.prototype.setFromOther=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.t=t.t};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.t==t.t};e.prototype.notEquals=function(t){return this.x!=t.x&&this.y!=t.y&&this.z!=t.z&&this.t!=t.t};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&Math.abs(this.t-t.t)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.t+t.t)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.t+=t.t};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.t-t.t)};e.prototype.subtractInPlace=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.t-=t.t};e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.t*t.t)};e.prototype.multiplyInPlace=function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z,this.t*=t.t};e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.t/t.t)};e.prototype.divideInPlace=function(t){this.x/=t.x,this.y/=t.y,this.z/=t.z,this.t/=t.t};e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.t*t)};e.prototype.scaleInPlace=function(t){this.set(this.x*t,this.y*t,this.z*t,this.t*t)};e.prototype.length=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[2];return Math.sqrt(t*t+e*e+a*a+i*i)};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];return t*t+e*e+a*a+i*i};e.prototype.normalize=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3];var r=t*t+a*a+i*i+n*n;return r<Number.EPSILON?new e:(r=1/Math.sqrt(r),new e(t*r,a*r,i*r))};e.prototype.normalizeInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];var n=t*t+e*e+a*a+i*i;n<Number.EPSILON||(n=1/Math.sqrt(n),this.set(t*n,e*n,a*n,i*n))};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.t*b.t};e.prototype.cross=function(t){var a=this.x,i=this.y,n=this.z,r=this.t,o=t.x,l=t.y,s=t.z,d=t.t;return new e(i*s-n*l,n*d-r*s,r*o-a*d,a*l-i*o)};e.prototype.angleTo=function(t){var e=this.normalize(),a=t.normalize(),i=e.dot(a);return i>1?0:Math.acos(i)};e.prototype.lerp=function(t,a){var i=this.x,n=this.y,r=this.z;return at=this.t,new e(i+a*(t.x-i),n+a*(t.y-n),r+a*(t.z-r),at+a*(t.t-at))};e.prototype.random=function(t){if(t===void 0){t=1}var e=2*glMatrix.RANDOM()*Math.PI,a=2*glMatrix.RANDOM()-1,i=Math.sqrt(1-a*a)*t;return out[0]=Math.cos(e)*i,out[1]=Math.sin(e)*i,out[2]=a*t,out};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.toVec3=function(){return new m(this.__data[0],this.__data[1],this.__data[2])};e.prototype.asArray=function(){return this.__data};e.create=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return new(m.bind.apply(m,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z,t:this.t}};return e}(d);t("G",p);u.registerType("Vec4",p);var f=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=255}var r=this;if(r=t.call(this)||this,e instanceof Uint8Array)r.__data=e;else if(e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Uint8Array(o,l,4)}else r.__data=new Uint8Array(4),"string"==typeof e?e.startsWith("#")?r.setFromHex(e):r.setFromCSSColorName(e):(r.__data[0]=e,r.__data[1]=a,r.__data[2]=i,r.__data[3]=n);return r}Object.defineProperty(e.prototype,"r",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"g",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"b",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"a",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){if(i===void 0){i=255}this.r=t,this.g=e,this.b=a,this.a=i};e.prototype.setFromOther=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.setFromArray=function(t){this.r=t[0],this.g=t[1],this.b=t[2],this.a=4==t.length?t[3]:1};e.prototype.setFromHex=function(t){var e=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}(t);e?this.set(e.r,e.g,e.b):console.warn("Invalid hex code:"+t)};e.prototype.setFromCSSColorName=function(t){t.startsWith("#")?this.setFromHex(t):this.setFromHex(function(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==e[t.toLowerCase()]&&e[t.toLowerCase()]}(t))};e.prototype.toHex=function(){function t(t){var e=t.toString(16);return 1==e.length?"0"+e:e}return"#"+t(this.r)+t(this.g)+t(this.b)};e.prototype.equal=function(t){return this.r==t.r&&this.g==t.g&&this.b==t.b&&this.a==t.a};e.prototype.notequals=function(t){return this.r!=t.r&&this.g!=t.g&&this.b!=t.b&&this.a!=t.a};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.r-t.r)<e&&Math.abs(this.g-t.g)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.a-t.a)<e};e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)};e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)};e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)};e.prototype.scaleInPlace=function(t){this.r*=t,this.g*=t,this.b*=t,this.a*=t};e.prototype.applyGamma=function(t){this.set(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toLinear=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toGamma=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,1/t),Math.pow(this.g,1/t),Math.pow(this.b,1/t),this.a)};e.prototype.luminance=function(){return.2126*this.r+.7152*this.g+.0722*this.b};e.prototype.lerp=function(t,a){var i=this.r,n=this.g,r=this.b,o=this.a;return new e(i+a*(t.r-i),n+a*(t.g-n),r+a*(t.b-r),o+a*(t.a-o))};e.random=function(t,a){if(t===void 0){t=0}if(a===void 0){a=!1}return t>0?new e(t+Math.random()*(1-t),t+Math.random()*(1-t),t+Math.random()*(1-t),a?t+Math.random()*(1-t):1):t<0?new e(Math.random()*(1+t),Math.random()*(1+t),Math.random()*(1+t),a?Math.random()*(1+t):1):new e(Math.random(),Math.random(),Math.random(),a?Math.random():1)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.asArray=function(){return this.__data};e.prototype.as3ComponentArray=function(){return[this.__data[0],this.__data[1],this.__data[2]]};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b,a:this.a}};e.prototype.fromJSON=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.toCSSString=function(){return"rgba("+Math.round(255*this.r)+", "+Math.round(255*this.g)+", "+Math.round(255*this.b)+", "+this.a+")"};return e}(d);u.registerType("RGBA",f);var y=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=1}var r=this;if(r=t.call(this)||this,e instanceof Float32Array)r.__data=e;else if(e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Float32Array(o,l,4)}else r.__data=new Float32Array(4),"string"==typeof e?e.startsWith("#")?r.setFromHex(e):r.setFromCSSColorName(e):(r.__data[0]=e,r.__data[1]=a,r.__data[2]=i,r.__data[3]=n);return r}Object.defineProperty(e.prototype,"r",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"g",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"b",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"a",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){if(i===void 0){i=1}this.r=t,this.g=e,this.b=a,this.a=i};e.prototype.setFromOther=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.setFromScalarArray=function(t){this.r=t[0],this.g=t[1],this.b=t[2],this.a=4==t.length?t[3]:1};e.prototype.getAsRGBArray=function(){return[255*this.r,255*this.g,255*this.b]};e.prototype.getAsRGBDict=function(){return{r:255*this.r,g:255*this.g,b:255*this.b}};e.prototype.setFromRGB=function(t,e,a,i){this.r=t/255,this.g=e/255,this.b=a/255,this.a=i?i/255:1};e.prototype.setFromRGBArray=function(t){this.r=t[0]/255,this.g=t[1]/255,this.b=t[2]/255,this.a=4==t.length?t[3]/255:1};e.prototype.setFromRGBDict=function(t){this.r=t.r/255,this.g=t.g/255,this.b=t.b/255,this.a=4==t.a?t.a/255:1};e.prototype.setFromHex=function(t){var e=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}(t);e?this.setFromRGB(e.r,e.g,e.b):console.warn("Invalid hex code:"+t)};e.prototype.setFromCSSColorName=function(t){t.startsWith("#")?this.setFromHex(t):this.setFromHex(function(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==e[t.toLowerCase()]&&e[t.toLowerCase()]}(t))};e.prototype.toHex=function(){function t(t){var e=Math.round(255*t).toString(16);return 1==e.length?"0"+e:e}return"#"+t(this.r)+t(this.g)+t(this.b)};e.prototype.equal=function(t){return this.r==t.r&&this.g==t.g&&this.b==t.b&&this.a==t.a};e.prototype.notequals=function(t){return this.r!=t.r&&this.g!=t.g&&this.b!=t.b&&this.a!=t.a};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.r-t.r)<e&&Math.abs(this.g-t.g)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.a-t.a)<e};e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)};e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)};e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)};e.prototype.scaleInPlace=function(t){this.r*=t,this.g*=t,this.b*=t,this.a*=t};e.prototype.applyGamma=function(t){this.set(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toLinear=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toGamma=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,1/t),Math.pow(this.g,1/t),Math.pow(this.b,1/t),this.a)};e.prototype.luminance=function(){return.2126*this.r+.7152*this.g+.0722*this.b};e.prototype.lerp=function(t,a){var i=this.r,n=this.g,r=this.b,o=this.a;return new e(i+a*(t.r-i),n+a*(t.g-n),r+a*(t.b-r),o+a*(t.a-o))};e.random=function(t,a){if(t===void 0){t=0}if(a===void 0){a=!1}return t>0?new e(t+Math.random()*(1-t),t+Math.random()*(1-t),t+Math.random()*(1-t),a?t+Math.random()*(1-t):1):t<0?new e(Math.random()*(1+t),Math.random()*(1+t),Math.random()*(1+t),a?Math.random()*(1+t):1):new e(Math.random(),Math.random(),Math.random(),a?Math.random():1)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.asArray=function(){return this.__data};e.prototype.as3ComponentArray=function(){return[this.__data[0],this.__data[1],this.__data[2]]};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b,a:this.a}};e.prototype.fromJSON=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.toCSSString=function(){return"rgba("+Math.round(255*this.r)+", "+Math.round(255*this.g)+", "+Math.round(255*this.b)+", "+this.a+")"};return e}(d);t("y",y);u.registerType("Color",y);var g=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}var r=this;if(r=t.call(this)||this,isNaN(n))switch(n){case"XYZ":r.order=0;break;case"YZX":r.order=1;break;case"ZXY":r.order=2;break;case"XZY":r.order=3;break;case"ZYX":r.order=4;break;case"YXZ":r.order=5;break;default:throw new Error("Invalid Euler Angles Order:"+n)}else r.order=n;if(e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Float32Array(o,l,4)}else r.__data=new Float32Array(3),r.__data[0]=e,r.__data[1]=a,r.__data[2]=i;return r}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a){this.__data[0]=t,this.__data[1]=e,this.__data[2]=a};return e}(d);u.registerType("EulerAngles",g);var _=function(t){__extends(e,t);function e(e,a,i,n,r,o,l,s,d){if(e===void 0){e=1}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=1}if(o===void 0){o=0}if(l===void 0){l=0}if(s===void 0){s=0}if(d===void 0){d=1}var c=this;if(c=t.call(this)||this,e instanceof ArrayBuffer){var u=e,h=a;c.__data=new Float32Array(u,h,9)}else c.__data=new Float32Array(9),c.set(e,a,i,n,r,o,l,s,d);return c}Object.defineProperty(e.prototype,"m00",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m01",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m02",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m10",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m11",{get:function(){return this.__data[4]},set:function(t){this.__data[4]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m12",{get:function(){return this.__data[5]},set:function(t){this.__data[5]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m20",{get:function(){return this.__data[6]},set:function(t){this.__data[6]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m21",{get:function(){return this.__data[7]},set:function(t){this.__data[7]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m22",{get:function(){return this.__data[8]},set:function(t){this.__data[8]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xAxis",{get:function(){return m.createFromFloat32Buffer(this.__data.buffer,0)},set:function(t){this.xAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yAxis",{get:function(){return m.createFromFloat32Buffer(this.__data.buffer,3)},set:function(t){this.yAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"zAxis",{get:function(){return m.createFromFloat32Buffer(this.__data.buffer,6)},set:function(t){this.zAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i,n,r,o,l,s){if(t===void 0){t=1}if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=1}if(r===void 0){r=0}if(o===void 0){o=0}if(l===void 0){l=0}if(s===void 0){s=1}this.__data[0]=t,this.__data[1]=e,this.__data[2]=a,this.__data[3]=i,this.__data[4]=n,this.__data[5]=r,this.__data[6]=o,this.__data[7]=l,this.__data[8]=s};e.prototype.setIdentity=function(){this.set()};e.prototype.setFromMat=function(t){this.__data[0]=t.m00,this.__data[1]=t.m01,this.__data[2]=t.m02,this.__data[3]=t.m10,this.__data[4]=t.m11,this.__data[5]=t.m12,this.__data[6]=t.m20,this.__data[7]=t.m21,this.__data[8]=t.m22};e.prototype.setFromDirectionAndUpvector=function(t,e){var a=t,i=a.length();if(i<Number.EPSILON)return void this.setIdentity();a.scaleInPlace(1/i);var n=e.cross(a),r=n.length();r>Number.EPSILON&&n.scaleInPlace(1/r);var o=a.cross(n),l=o.length();l>Number.EPSILON&&o.scaleInPlace(1/l),this.set(n.x,n.y,n.z,o.x,o.y,o.z,a.x,a.y,a.z)};e.prototype.inverse=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3],r=this.__data[4],o=this.__data[5],l=this.__data[6],s=this.__data[7],d=this.__data[8],c=d*r-o*s,u=-d*n+o*l,h=s*n-r*l,m=t*c+a*u+i*h;return m?(m=1/m,new e(c*m,(-d*a+i*s)*m,(o*a-i*r)*m,u*m,(d*t-i*l)*m,(-o*t+i*n)*m,h*m,(-s*t+a*l)*m,(r*t-a*n)*m)):(console.warn("Unable to invert Mat3"),null)};e.prototype.invertInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3],n=this.__data[4],r=this.__data[5],o=this.__data[6],l=this.__data[7],s=this.__data[8],d=s*n-r*l,c=-s*i+r*o,u=l*i-n*o,h=t*d+e*c+a*u;return h?(h=1/h,this.set(d*h,(-s*e+a*l)*h,(r*e-a*n)*h,c*h,(s*t-a*o)*h,(-r*t+a*i)*h,u*h,(-l*t+e*o)*h,(n*t-e*i)*h),!0):(console.warn("Unable to invert Mat3"),!1)};e.prototype.transpose=function(){return e(this.__data[0],this.__data[3],this.__data[6],this.__data[1],this.__data[4],this.__data[7],this.__data[2],this.__data[5],this.__data[8])};e.prototype.transposeInPlace=function(){var t=this.__data[1],e=this.__data[2],a=this.__data[5];this.__data[1]=this.__data[3],this.__data[2]=this.__data[6],this.__data[3]=t,this.__data[5]=this.__data[7],this.__data[6]=e,this.__data[7]=a};e.prototype.transformVec3=function(t){return new m(this.__data[0]*t.x+this.__data[1]*t.y+this.__data[2]*t.z,this.__data[3]*t.x+this.__data[4]*t.y+this.__data[5]*t.z,this.__data[6]*t.x+this.__data[7]*t.y+this.__data[8]*t.z)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3],this.__data[4],this.__data[5],this.__data[6],this.__data[7],this.__data[8],this.__data[9])};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.prototype.toJSON=function(){return this.__data};e.prototype.fromJSON=function(t){this.__data=new Float32Array(t)};e.prototype.toString=function(){return this.toJSON().toString()};return e}(d);u.registerType("Mat3",_);var Z=function(t){__extends(e,t);function e(e,a,i,n,r,o,l,s,d,c,u,h,m,p,f,b){if(e===void 0){e=1}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}if(o===void 0){o=1}if(l===void 0){l=0}if(s===void 0){s=0}if(d===void 0){d=0}if(c===void 0){c=0}if(u===void 0){u=1}if(h===void 0){h=0}if(m===void 0){m=0}if(p===void 0){p=0}if(f===void 0){f=0}if(b===void 0){b=1}var y=this;if(y=t.call(this)||this,e instanceof Float32Array)y.__data=e;else if(e instanceof ArrayBuffer){var g=e,_=a;y.__data=new Float32Array(g,_,16)}else y.__data=new Float32Array(16),y.set(e,a,i,n,r,o,l,s,d,c,u,h,m,p,f,b);return y}Object.defineProperty(e.prototype,"m00",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m01",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m02",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m03",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m10",{get:function(){return this.__data[4]},set:function(t){this.__data[4]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m11",{get:function(){return this.__data[5]},set:function(t){this.__data[5]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m12",{get:function(){return this.__data[6]},set:function(t){this.__data[6]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m13",{get:function(){return this.__data[7]},set:function(t){this.__data[7]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m20",{get:function(){return this.__data[8]},set:function(t){this.__data[8]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m21",{get:function(){return this.__data[9]},set:function(t){this.__data[9]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m22",{get:function(){return this.__data[10]},set:function(t){this.__data[10]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m23",{get:function(){return this.__data[11]},set:function(t){this.__data[11]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m30",{get:function(){return this.__data[12]},set:function(t){this.__data[12]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m31",{get:function(){return this.__data[13]},set:function(t){this.__data[13]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m32",{get:function(){return this.__data[14]},set:function(t){this.__data[14]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m33",{get:function(){return this.__data[15]},set:function(t){this.__data[15]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xAxis",{get:function(){return m.createFromFloat32Buffer(this.__data.buffer,0)},set:function(t){this.xAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yAxis",{get:function(){return m.createFromFloat32Buffer(this.__data.buffer,4)},set:function(t){this.yAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"zAxis",{get:function(){return m.createFromFloat32Buffer(this.__data.buffer,8)},set:function(t){this.zAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"translation",{get:function(){return m.createFromFloat32Buffer(this.__data.buffer,12)},set:function(t){this.translation.set(t.x,t.y,t.z)},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i,n,r,o,l,s,d,c,u,h,m,p,f){if(t===void 0){t=1}if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=1}if(o===void 0){o=0}if(l===void 0){l=0}if(s===void 0){s=0}if(d===void 0){d=0}if(c===void 0){c=1}if(u===void 0){u=0}if(h===void 0){h=0}if(m===void 0){m=0}if(p===void 0){p=0}if(f===void 0){f=1}this.__data[0]=t,this.__data[1]=e,this.__data[2]=a,this.__data[3]=i,this.__data[4]=n,this.__data[5]=r,this.__data[6]=o,this.__data[7]=l,this.__data[8]=s,this.__data[9]=d,this.__data[10]=c,this.__data[11]=u,this.__data[12]=h,this.__data[13]=m,this.__data[14]=p,this.__data[15]=f};e.prototype.setIdentity=function(){this.set()};e.prototype.setDataArray=function(t){this.__data=t};e.prototype.setFromMat4=function(t){this.__data[0]=t.m00,this.__data[1]=t.m01,this.__data[2]=t.m02,this.__data[3]=t.m03,this.__data[4]=t.m10,this.__data[5]=t.m11,this.__data[6]=t.m12,this.__data[7]=t.m13,this.__data[8]=t.m20,this.__data[9]=t.m21,this.__data[10]=t.m22,this.__data[11]=t.m23,this.__data[12]=t.m30,this.__data[13]=t.m31,this.__data[14]=t.m32,this.__data[15]=t.m33};e.prototype.toMat3=function(t){return new _(this.__data[0],this.__data[1],this.__data[2],this.__data[4],this.__data[5],this.__data[6],this.__data[8],this.__data[9],this.__data[10])};e.prototype.transposeInPlace=function(){var t=this.__data[1],e=this.__data[2],a=this.__data[3],i=this.__data[6],n=this.__data[7],r=this.__data[11];this.__data[1]=this.__data[4],this.__data[2]=this.__data[8],this.__data[3]=this.__data[12],this.__data[4]=t,this.__data[6]=this.__data[9],this.__data[7]=this.__data[13],this.__data[8]=e,this.__data[9]=i,this.__data[11]=this.__data[14],this.__data[12]=a,this.__data[13]=n,this.__data[14]=r};e.prototype.transpose=function(){return new e(this.__data[0],this.__data[4],this.__data[8],this.__data[12],this.__data[1],this.__data[5],this.__data[9],this.__data[13],this.__data[2],this.__data[6],this.__data[10],this.__data[14],this.__data[3],this.__data[7],this.__data[11],this.__data[15])};e.prototype.inverse=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3],r=this.__data[4],o=this.__data[5],l=this.__data[6],s=this.__data[7],d=this.__data[8],c=this.__data[9],u=this.__data[10],h=this.__data[11],m=this.__data[12],p=this.__data[13],f=this.__data[14],b=this.__data[15],y=t*o-a*r,g=t*l-i*r,_=t*s-n*r,Z=a*l-i*o,G=a*s-n*o,X=i*s-n*l,v=d*p-c*m,V=d*f-u*m,I=d*b-h*m,R=c*f-u*p,x=c*b-h*p,S=u*b-h*f;var W=y*S-g*x+_*R+Z*I-G*V+X*v;return W?(W=1/W,new e((o*S-l*x+s*R)*W,(i*x-a*S-n*R)*W,(p*X-f*G+b*Z)*W,(u*G-c*X-h*Z)*W,(l*I-r*S-s*V)*W,(t*S-i*I+n*V)*W,(f*_-m*X-b*g)*W,(d*X-u*_+h*g)*W,(r*x-o*I+s*v)*W,(a*I-t*x-n*v)*W,(m*G-p*_+b*y)*W,(c*_-d*G-h*y)*W,(o*V-r*R-l*v)*W,(t*R-a*V+i*v)*W,(p*g-m*Z-f*y)*W,(d*Z-c*g+u*y)*W)):(console.warn("Unable to invert Mat4"),null)};e.prototype.invertInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3],n=this.__data[4],r=this.__data[5],o=this.__data[6],l=this.__data[7],s=this.__data[8],d=this.__data[9],c=this.__data[10],u=this.__data[11],h=this.__data[12],m=this.__data[13],p=this.__data[14],f=this.__data[15],b=t*r-e*n,y=t*o-a*n,g=t*l-i*n,_=e*o-a*r,Z=e*l-i*r,G=a*l-i*o,X=s*m-d*h,v=s*p-c*h,V=s*f-u*h,I=d*p-c*m,R=d*f-u*m,x=c*f-u*p;var S=b*x-y*R+g*I+_*V-Z*v+G*X;return S?(S=1/S,this.set((r*x-o*R+l*I)*S,(a*R-e*x-i*I)*S,(m*G-p*Z+f*_)*S,(c*Z-d*G-u*_)*S,(o*V-n*x-l*v)*S,(t*x-a*V+i*v)*S,(p*g-h*G-f*y)*S,(s*G-c*g+u*y)*S,(n*R-r*V+l*X)*S,(e*V-t*R-i*X)*S,(h*Z-m*g+f*b)*S,(d*g-s*Z-u*b)*S,(r*v-n*I-o*X)*S,(t*I-e*v+a*X)*S,(m*y-h*_-p*b)*S,(s*_-d*y+c*b)*S),!0):(console.warn("Unable to invert Mat4"),!1)};e.prototype.setInverse=function(t){var e=t.__data[0],a=t.__data[1],i=t.__data[2],n=t.__data[3],r=t.__data[4],o=t.__data[5],l=t.__data[6],s=t.__data[7],d=t.__data[8],c=t.__data[9],u=t.__data[10],h=t.__data[11],m=t.__data[12],p=t.__data[13],f=t.__data[14],b=t.__data[15],y=e*o-a*r,g=e*l-i*r,_=e*s-n*r,Z=a*l-i*o,G=a*s-n*o,X=i*s-n*l,v=d*p-c*m,V=d*f-u*m,I=d*b-h*m,R=c*f-u*p,x=c*b-h*p,S=u*b-h*f;var W=y*S-g*x+_*R+Z*I-G*V+X*v;if(!W)throw new Error("Unable to invert Mat4");W=1/W,this.set((o*S-l*x+s*R)*W,(i*x-a*S-n*R)*W,(p*X-f*G+b*Z)*W,(u*G-c*X-h*Z)*W,(l*I-r*S-s*V)*W,(e*S-i*I+n*V)*W,(f*_-m*X-b*g)*W,(d*X-u*_+h*g)*W,(r*x-o*I+s*v)*W,(a*I-e*x-n*v)*W,(m*G-p*_+b*y)*W,(c*_-d*G-h*y)*W,(o*V-r*R-l*v)*W,(e*R-a*V+i*v)*W,(p*g-m*Z-f*y)*W,(d*Z-c*g+u*y)*W)};e.prototype.multiply=function(t){var a=this.__data[0],i=this.__data[1],n=this.__data[2],r=this.__data[3],o=this.__data[4],l=this.__data[5],s=this.__data[6],d=this.__data[7],c=this.__data[8],u=this.__data[9],h=this.__data[10],m=this.__data[11],p=this.__data[12],f=this.__data[13],b=this.__data[14],y=this.__data[15],g=t.asArray();var _=g[0],Z=g[1],G=g[2],X=g[3];var v=new e;return v.m00=_*a+Z*o+G*c+X*p,v.m01=_*i+Z*l+G*u+X*f,v.m02=_*n+Z*s+G*h+X*b,v.m03=_*r+Z*d+G*m+X*y,_=g[4],Z=g[5],G=g[6],X=g[7],v.m10=_*a+Z*o+G*c+X*p,v.m11=_*i+Z*l+G*u+X*f,v.m12=_*n+Z*s+G*h+X*b,v.m13=_*r+Z*d+G*m+X*y,_=g[8],Z=g[9],G=g[10],X=g[11],v.m20=_*a+Z*o+G*c+X*p,v.m21=_*i+Z*l+G*u+X*f,v.m22=_*n+Z*s+G*h+X*b,v.m23=_*r+Z*d+G*m+X*y,_=g[12],Z=g[13],G=g[14],X=g[15],v.m30=_*a+Z*o+G*c+X*p,v.m31=_*i+Z*l+G*u+X*f,v.m32=_*n+Z*s+G*h+X*b,v.m33=_*r+Z*d+G*m+X*y,v};e.prototype.multiplyInPlace=function(t){var e=this.asArray(),a=e[0],i=e[1],n=e[2],r=e[3],o=e[4],l=e[5],s=e[6],d=e[7],c=e[8],u=e[9],h=e[10],m=e[11],p=e[12],f=e[13],b=e[14],y=e[15],g=t.asArray();var _=g[0],Z=g[1],G=g[2],X=g[3];return this.m00=_*a+Z*o+G*c+X*p,this.m01=_*i+Z*l+G*u+X*f,this.m02=_*n+Z*s+G*h+X*b,this.m03=_*r+Z*d+G*m+X*y,_=g[4],Z=g[5],G=g[6],X=g[7],this.m10=_*a+Z*o+G*c+X*p,this.m11=_*i+Z*l+G*u+X*f,this.m12=_*n+Z*s+G*h+X*b,this.m13=_*r+Z*d+G*m+X*y,_=g[8],Z=g[9],G=g[10],X=g[11],this.m20=_*a+Z*o+G*c+X*p,this.m21=_*i+Z*l+G*u+X*f,this.m22=_*n+Z*s+G*h+X*b,this.m23=_*r+Z*d+G*m+X*y,_=g[12],Z=g[13],G=g[14],X=g[15],this.m30=_*a+Z*o+G*c+X*p,this.m31=_*i+Z*l+G*u+X*f,this.m32=_*n+Z*s+G*h+X*b,this.m33=_*r+Z*d+G*m+X*y,this};e.prototype.postmultiplyInPlace=function(t){var e=t.asArray(),a=e[0],i=e[1],n=e[2],r=e[3],o=e[4],l=e[5],s=e[6],d=e[7],c=e[8],u=e[9],h=e[10],m=e[11],p=e[12],f=e[13],b=e[14],y=e[15],g=this.asArray();var _=g[0],Z=g[1],G=g[2],X=g[3];return this.m00=_*a+Z*o+G*c+X*p,this.m01=_*i+Z*l+G*u+X*f,this.m02=_*n+Z*s+G*h+X*b,this.m03=_*r+Z*d+G*m+X*y,_=g[4],Z=g[5],G=g[6],X=g[7],this.m10=_*a+Z*o+G*c+X*p,this.m11=_*i+Z*l+G*u+X*f,this.m12=_*n+Z*s+G*h+X*b,this.m13=_*r+Z*d+G*m+X*y,_=g[8],Z=g[9],G=g[10],X=g[11],this.m20=_*a+Z*o+G*c+X*p,this.m21=_*i+Z*l+G*u+X*f,this.m22=_*n+Z*s+G*h+X*b,this.m23=_*r+Z*d+G*m+X*y,_=g[12],Z=g[13],G=g[14],X=g[15],this.m30=_*a+Z*o+G*c+X*p,this.m31=_*i+Z*l+G*u+X*f,this.m32=_*n+Z*s+G*h+X*b,this.m33=_*r+Z*d+G*m+X*y,this};e.prototype.translateInPlace=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z;return e[12]=e[0]*a+e[4]*i+e[8]*n+e[12],e[13]=e[1]*a+e[5]*i+e[9]*n+e[13],e[14]=e[2]*a+e[6]*i+e[10]*n+e[14],e[15]=e[3]*a+e[7]*i+e[11]*n+e[15],this};e.prototype.setLookAt=function(t,e,a){var i=t.subtract(e),n=i.length();if(n<Number.EPSILON)return void this.setIdentity();i.scaleInPlace(1/n);var r=a.cross(i),o=r.length();o>Number.EPSILON&&r.scaleInPlace(1/o);var l=i.cross(r),s=l.length();s>Number.EPSILON&&l.scaleInPlace(1/s),this.set(r.x,r.y,r.z,0,l.x,l.y,l.z,0,i.x,i.y,i.z,0,t.x,t.y,t.z,1)};e.prototype.setRotation=function(t,e){var a=t.length();if(Math.abs(a)<Number.EPSILON)return null;var i=t.x/a,n=t.y/a,r=t.z/a,o=Math.sin(e),l=Math.cos(e),s=1-l,d=this.__data;return d[0]=i*i*s+l,d[1]=n*i*s+r*o,d[2]=r*i*s-n*o,d[3]=0,d[4]=i*n*s-r*o,d[5]=n*n*s+l,d[6]=r*n*s+i*o,d[7]=0,d[8]=i*r*s+n*o,d[9]=n*r*s-i*o,d[10]=r*r*s+l,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this};e.prototype.setXRotation=function(t){var e=Math.sin(t),a=Math.cos(t),i=this.__data;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=e,i[7]=0,i[8]=0,i[9]=-e,i[10]=a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this};e.prototype.setYRotation=function(t){var e=Math.sin(t),a=Math.cos(t),i=this.__data;return i[0]=a,i[1]=0,i[2]=-e,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=e,i[9]=0,i[10]=a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this};e.prototype.setZRotation=function(t){var e=Math.sin(t),a=Math.cos(t),i=this.__data;return i[0]=a,i[1]=e,i[2]=0,i[3]=0,i[4]=-e,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this};e.prototype.transformVec4=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z,r=t.t;return new Vec4(e[0]*a+e[4]*i+e[8]*n+e[12]*r,e[1]*a+e[5]*i+e[9]*n+e[13]*r,e[2]*a+e[6]*i+e[10]*n+e[14]*r,e[3]*a+e[7]*i+e[11]*n+e[15]*r)};e.prototype.transformVec3=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z;return new m(e[0]*a+e[4]*i+e[8]*n+e[12],e[1]*a+e[5]*i+e[9]*n+e[13],e[2]*a+e[6]*i+e[10]*n+e[14])};e.prototype.rotateVec3=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z;return new m(e[0]*a+e[4]*i+e[8]*n,e[1]*a+e[5]*i+e[9]*n,e[2]*a+e[6]*i+e[10]*n)};e.prototype.setPerspectiveMatrix=function(t,e,a,i){var n=Math.tan(.5*Math.PI-.5*t),r=1/(a-i);this.set(n/e,0,0,0,0,n,0,0,0,0,(a+i)*r,-1,0,0,a*i*r*2,0)};e.prototype.setOrthographicMatrix=function(t,e,a,i,n,r){var o=1/(t-e),l=1/(a-i),s=1/(n-r);this.set(-2*o,0,0,0,0,-2*l,0,0,0,0,2*s,0,(t+e)*o,(i+a)*l,(r+n)*s,1)};e.prototype.setScale=function(t,e,a){t instanceof m?this.set(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1):this.set(t,0,0,0,0,e,0,0,0,0,a,0,0,0,0,1)};e.prototype.setFromMat3x4Array=function(t){this.set(t[0],t[1],t[2],0,t[3],t[4],t[5],0,t[6],t[7],t[8],0,t[9],t[10],t[11],1)};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3],this.__data[4],this.__data[5],this.__data[6],this.__data[7],this.__data[8],this.__data[9],this.__data[10],this.__data[11],this.__data[12],this.__data[13],this.__data[14],this.__data[15])};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.prototype.toJSON=function(){return this.__data};e.prototype.fromJSON=function(t){this.__data=new Float32Array(t)};return e}(d);u.registerType("Mat4",Z);var G=function(t){__extends(e,t);function e(e,a,i,n){var r;if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=1}var o=this;if(o=t.call(this)||this,e instanceof ArrayBuffer){var l=e,s=a;o.__data=new Float32Array(l,s,4)}else if(o.__data=new Float32Array(4),"object"==typeof e){o.__data[0]=0,o.__data[1]=0,o.__data[2]=0,o.__data[3]=1;for(var d in e)Array.isArray(e[d])?(r=o[d]).call.apply(r,__spreadArrays([o],e[d])):o[d].call(o,e[d])}else o.__data[0]=e,o.__data[1]=a,o.__data[2]=i,o.__data[3]=n;return o}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"w",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){this.__data[0]=t,this.__data[1]=e,this.__data[2]=a,this.__data[3]=i};e.prototype.setDataArray=function(t){this.__data=t};e.prototype.setFromOther=function(t){this.__data[0]=t.x,this.__data[1]=t.y,this.__data[2]=t.z,this.__data[3]=t.w};e.prototype.setFromEulerAngles=function(t){var e=new m;switch(t.order){case 0:e.set(t.x,-t.y,t.z);break;case 1:e.set(t.y,-t.z,t.x);break;case 2:e.set(t.z,-t.x,t.y);break;case 3:e.set(t.x,t.z,t.y);break;case 4:e.set(t.z,t.y,t.x);break;case 5:e.set(t.y,t.x,t.z);break;default:throw new Error("sdrty")}var a=.5*e.x,i=.5*e.y,n=.5*e.z,r=Math.cos(a),o=Math.cos(i),l=Math.cos(n),s=Math.sin(a),d=Math.sin(i),c=Math.sin(n),u=r*l,h=r*c,p=s*l,f=s*c,b=o*p-d*h,y=o*f+d*u,g=o*h-d*p;switch(this.w=o*u+d*f,t.order){case 0:this.x=b,this.y=-y,this.z=g;break;case 1:this.x=g,this.y=b,this.z=-y;break;case 2:this.x=-y,this.y=g,this.z=b;break;case 3:this.x=b,this.y=g,this.z=y;break;case 4:this.x=g,this.y=y,this.z=b;break;case 5:this.x=y,this.y=b,this.z=g;break;default:throw new Error("sdrty")}};e.prototype.toEulerAngles=function(t){var e=new m;switch(t){case 0:e.set(this.z,this.x,this.y);break;case 1:e.set(this.x,this.y,this.z);break;case 2:e.set(this.y,this.z,this.x);break;case 3:e.set(this.y,-this.x,this.z);break;case 4:e.set(this.x,-this.z,this.y);break;case 5:e.set(this.z,-this.y,this.x);break;default:throw new Error("Invalid rotation order:"+t)}var a=new m,i=e.x*e.y+e.z*this.w;if(i>.49999)a.y=2*Math.atan2(e.x,this.w),a.z=.5*Math.PI,a.x=0;else if(i<-.49999)a.y=-2*Math.atan2(e.x,this.w),a.z=-.5*Math.PI,a.x=0;else{var n=e.x*e.x,r=e.y*e.y,o=e.z*e.z;a.y=Math.atan2(2*e.y*this.w-2*e.x*e.z,1-2*r-2*o),a.z=Math.asin(2*i),a.x=Math.atan2(2*e.x*this.w-2*e.y*e.z,1-2*n-2*o)}switch(t){case 0:return new g(a.y,a.z,a.x,t);case 1:return new g(a.x,a.y,a.z,t);case 2:return new g(a.z,a.x,a.y,t);case 3:return new g(-a.y,a.x,a.z,t);case 4:return new g(a.x,a.z,-a.y,t);case 5:return new g(a.z,-a.y,a.x,t)}};e.prototype.setFromAxisAndAngle=function(t,e){var a=e/2,i=t.normalize().scale(Math.sin(a));this.set(i.x,i.y,i.z,Math.cos(a))};e.prototype.setFromDirectionAndUpvector=function(t,e){var a=new _;a.setFromDirectionAndUpvector(t,e),this.setFromMat3(a)};e.prototype.setFrom2Vectors=function(t,e){t.normalize(),e.normalize();var a=t.cross(e),i=t.dot(e),n=Math.sqrt(2*(1+i));this.set(a.x/n,a.y/n,a.z/n,n/2),this.normalizeInPlace()};e.prototype.setFromMat3=function(t){var e=t.__data[0]+t.__data[4]+t.__data[8];var a;if(e>0)a=Math.sqrt(e+1),this.__data[3]=.5*a,a=.5/a,this.__data[0]=(t.__data[5]-t.__data[7])*a,this.__data[1]=(t.__data[6]-t.__data[2])*a,this.__data[2]=(t.__data[1]-t.__data[3])*a;else{var i=0;t.__data[4]>t.__data[0]&&(i=1),t.__data[8]>t.__data[3*i+i]&&(i=2);var n=(i+1)%3,r=(i+2)%3;a=Math.sqrt(t.__data[3*i+i]-t.__data[3*n+n]-t.__data[3*r+r]+1),this.__data[i]=.5*a,a=.5/a,this.__data[3]=(t.__data[3*n+r]-t.__data[3*r+n])*a,this.__data[n]=(t.__data[3*n+i]+t.__data[3*i+n])*a,this.__data[r]=(t.__data[3*r+i]+t.__data[3*i+r])*a}this.normalizeInPlace()};e.prototype.setFromMat4=function(t){var e=t.__data[0]+t.__data[5]+t.__data[10];var a;if(e>0)a=Math.sqrt(e+1),this.__data[3]=.5*a,a=.5/a,this.__data[0]=(t.__data[6]-t.__data[9])*a,this.__data[1]=(t.__data[8]-t.__data[2])*a,this.__data[2]=(t.__data[1]-t.__data[4])*a;else{var i=0;t.__data[5]>t.__data[0]&&(i=1),t.__data[10]>t.__data[4*i+i]&&(i=2);var n=(i+1)%3,r=(i+2)%3;a=Math.sqrt(t.__data[4*i+i]-t.__data[4*n+n]-t.__data[4*r+r]+1),this.__data[i]=.5*a,a=.5/a,this.__data[3]=(t.__data[4*n+r]-t.__data[4*r+n])*a,this.__data[n]=(t.__data[4*n+i]+t.__data[4*i+n])*a,this.__data[r]=(t.__data[4*r+i]+t.__data[4*i+r])*a}this.normalizeInPlace()};e.prototype.isIdentity=function(){return this.getAngle()<Number.EPSILON};e.prototype.getAngle=function(){return 2*Math.acos(this.w)};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.w==t.w};e.prototype.notequals=function(t){return this.x!=t.x&&this.y!=t.y&&this.z!=t.z&&this.w!=t.w};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&Math.abs(this.w-t.w)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)};e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)};e.prototype.scaleInPlace=function(t){this.x*=t,this.y*=t,this.z*=t,this.w*=t};e.prototype.length=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];return Math.sqrt(t*t+e*e+a*a+i*i)};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];return t*t+e*e+a*a+i*i};e.prototype.normalize=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3];var r=t*t+a*a+i*i+n*n;return r<Number.EPSILON?new e:(r=1/Math.sqrt(r),new e(t*r,a*r,i*r))};e.prototype.normalizeInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];var n=t*t+e*e+a*a+i*i;n<Number.EPSILON||(n=1/Math.sqrt(n),this.set(t*n,e*n,a*n,i*n))};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w};e.prototype.cross=function(t){var a=this.x,i=this.y,n=this.z,r=this.w,o=t.x,l=t.y,s=t.z,d=t.w;return new e(i*s-n*l,n*d-r*s,r*o-a*d,a*l-i*o)};e.prototype.conjugate=function(){return new e(-this.x,-this.y,-this.z,this.w)};e.prototype.inverse=function(){return this.conjugate()};e.prototype.alignWith=function(t){this.dot(t)<0&&this.set(-this.x,-this.y,-this.z,-this.w)};e.prototype.multiply=function(t){var a=this.__data[0],i=this.__data[1],n=this.__data[2],r=this.__data[3],o=t.__data[0],l=t.__data[1],s=t.__data[2],d=t.__data[3];return new e(a*d+r*o+i*s-n*l,i*d+r*l+n*o-a*s,n*d+r*s+a*l-i*o,r*d-a*o-i*l-n*s)};e.prototype.multiplyInPlace=function(t){var e=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3],r=t.__data[0],o=t.__data[1],l=t.__data[2],s=t.__data[3];this.set(e*s+n*r+a*l-i*o,a*s+n*o+i*r-e*l,i*s+n*l+e*o-a*r,n*s-e*r-a*o-i*l)};e.prototype.rotateVec3=function(t){var a=new e(t.x,t.y,t.z,0),i=this.multiply(a).multiply(this.conjugate());return new m(i.x,i.y,i.z)};e.prototype.rotateX=function(t){t*=.5;var e=this.x,a=this.y,i=this.z,n=this.w,r=Math.sin(t),o=Math.cos(t);this.x=e*o+n*r,this.y=a*o+i*r,this.z=i*o-a*r,this.w=n*o-e*r};e.prototype.rotateY=function(t){t*=.5;var e=this.x,a=this.y,i=this.z,n=this.w,r=Math.sin(t),o=Math.cos(t);this.x=e*o-i*r,this.y=a*o+n*r,this.z=i*o+e*r,this.w=n*o-a*r};e.prototype.rotateZ=function(t){t*=.5;var e=this.x,a=this.y,i=this.z,n=this.w,r=Math.sin(t),o=Math.cos(t);this.x=e*o+a*r,this.y=a*o-e*r,this.z=i*o+n*r,this.w=n*o-i*r};e.prototype.toMat3=function(){var t=this.x,e=this.y,a=this.z,i=this.w,n=t+t,r=e+e,o=a+a,l=t*n,s=e*n,d=e*r,c=a*n,u=a*r,h=a*o,m=i*n,p=i*r,f=i*o,b=new _;return b.__data[0]=1-d-h,b.__data[3]=s-f,b.__data[6]=c+p,b.__data[1]=s+f,b.__data[4]=1-l-h,b.__data[7]=u-m,b.__data[2]=c-p,b.__data[5]=u+m,b.__data[8]=1-l-d,b};e.prototype.getXaxis=function(){var t=this.x*this.y,e=this.x*this.z,a=this.y*this.y,i=this.y*this.w,n=this.z*this.z,r=this.z*this.w;return new m(1-2*(n+a),2*(t+r),2*(e-i))};e.prototype.getYaxis=function(){var t=this.x*this.x,e=this.x*this.y,a=this.x*this.w,i=this.y*this.z,n=this.z*this.z,r=this.z*this.w;return new m(2*(e-r),1-2*(n+t),2*(i+a))};e.prototype.getZaxis=function(){var t=this.x*this.x,e=this.x*this.z,a=this.x*this.w,i=this.y*this.y,n=this.y*this.z,r=this.y*this.w;new m;return new m(2*(r+e),2*(n-a),1-2*(i+t))};e.prototype.mirror=function(t){switch(t){case 0:return new e(this.z,this.w,this.x,this.y);case 1:return new e(-this.w,this.z,this.y,-this.x);case 2:return new e(this.x,this.y,this.z,-this.w)}};e.prototype.toMat4=function(){var t=this.x,e=this.y,a=this.z,i=this.w,n=t+t,r=e+e,o=a+a,l=t*n,s=e*n,d=e*r,c=a*n,u=a*r,h=a*o,m=i*n,p=i*r,f=i*o,b=new Z;return b.__data[0]=1-d-h,b.__data[4]=s-f,b.__data[8]=c+p,b.__data[1]=s+f,b.__data[5]=1-l-h,b.__data[9]=u-m,b.__data[2]=c-p,b.__data[6]=u+m,b.__data[10]=1-l-d,b};e.prototype.lerp=function(t,a){var i=new e(this.x+a*(t.x-this.x),this.y+a*(t.y-this.y),this.z+a*(t.z-this.z),this.w+a*(t.w-this.w));return i.normalizeInPlace(),i};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}};e.prototype.fromJSON=function(t){this.__data[0]=t.x,this.__data[1]=t.y,this.__data[2]=t.z,this.__data[3]=t.w,this.normalizeInPlace()};return e}(d);u.registerType("Quat",G);var X=function(){function t(t,e){this.start=t instanceof m?t:new m,this.dir=e instanceof m?e:new m}t.prototype.closestPoint=function(t){var e=t.subtract(this.start).dot(this.dir);if(e<Number.EPSILON)return this.start;var a=e/this.dir.dot(this.dir);return this.start.add(this.dir.scale(a))};t.prototype.pointAtDist=function(t){return this.start.add(this.dir.scale(t))};t.prototype.intersectRayVector=function(t){var e=this.dir,a=t.dir,i=this.start.subtract(t.start),n=e.dot(e),r=e.dot(a),o=a.dot(a),l=e.dot(i),s=a.dot(i);if(0==n&&0==o)return this.start.distanceTo(t.start);if(0==n)return t.closestPoint(this.start);if(0==o)return this.closestPoint(t.start);var d=n*o-r*r;var c,u;return d<.001?(c=0,u=r>o?l/r:s/o):(c=(r*s-o*l)/d,u=(n*s-r*l)/d),[c,u]};t.prototype.intersectRayPlane=function(t){var e=this.start.subtract(t.start),a=t.dir.dot(this.dir),i=-t.dir.dot(e);if(Math.abs(a)<Number.PRECISION)return-1;var n=i/a;return n<-Number.PRECISION?-1:n};t.prototype.clone=function(){return new t(this.start.clone(),this.dir.clone())};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.prototype.toJSON=function(){return{start:this.start,dir:this.dir}};t.prototype.fromJSON=function(t){this.start.fromJSON(t.start),this.dir.fromJSON(t.dir)};t.prototype.toString=function(){return s(this.toJSON())};return t}();u.registerType("Ray",X);new m(1,1,1);var v=function(){function t(t,e,a){if(t instanceof Float32Array)this.setFromFloat32Array(t);else{if(t instanceof m)this.tr=t;else{if(t instanceof G&&null==e&&null==a)return this.tr=new m,this.ori=t,void(this.sc=new m(1,1,1));this.tr=new m}this.ori=e instanceof G?e:new G,this.sc=a instanceof m?a:new m(1,1,1)}}t.prototype.set=function(t,e,a){this.tr=t,this.ori=e,a instanceof m&&(this.sc=a)};t.prototype.setFromOther=function(t){this.tr=t.tr,this.ori=t.ori,this.sc=t.sc};t.prototype.isIdentity=function(){return this.tr.isNull()&&this.ori.isIdentity()&&this.sc.is111()};t.prototype.setLookAt=function(t,e,a){var i=t.subtract(e);if(i.length()<Number.EPSILON)throw new Error("Invalid dir");this.ori.setFromDirectionAndUpvector(i,a),this.tr=t};t.prototype.multiply=function(e){var a=this.sc;this.sc.x==this.sc.y&&this.sc.x==this.sc.z||(a=e.ori.rotateVec3(this.sc),Math.sign(a.x)!=Math.sign(this.sc.x)&&(a.x=-a.x),Math.sign(a.y)!=Math.sign(this.sc.y)&&(a.y=-a.y),Math.sign(a.z)!=Math.sign(this.sc.z)&&(a.z=-a.z));return new t(this.tr.add(this.ori.rotateVec3(a.multiply(e.tr))),this.ori.multiply(e.ori),a.multiply(e.sc))};t.prototype.inverse=function(){var e=new t;return e.ori=this.ori.inverse(),this.sc.x!=this.sc.y||this.sc.x!=this.sc.z?(e.sc=e.ori.rotateVec3(this.sc),Math.sign(e.sc.x)!=Math.sign(this.sc.x)&&(e.sc.x=-e.sc.x),Math.sign(e.sc.y)!=Math.sign(this.sc.y)&&(e.sc.y=-e.sc.y),Math.sign(e.sc.z)!=Math.sign(this.sc.z)&&(e.sc.z=-e.sc.z)):e.sc=this.sc.inverse(),e.tr=e.ori.rotateVec3(this.tr.negate().multiply(e.sc)),e};t.prototype.transformVec3=function(t){return this.tr.add(this.ori.rotateVec3(this.sc.multiply(t)))};t.prototype.toMat4=function(){var t=new Z(this.sc.x,0,0,0,0,this.sc.y,0,0,0,0,this.sc.z,0,0,0,0,1),e=this.ori.toMat4(),a=new Z;return a.translation=this.tr,a.multiply(e).multiply(t)};t.prototype.fromMat4=function(t){this.tr=t.translation,this.ori.setFromMat4(t)};t.prototype.setFromFloat32Array=function(t){if(7==t.length)return this.tr=new m(t.buffer,t.byteOffset),this.ori=new G(t.buffer,t.byteOffset+12),void(this.sc=new m(1,1,1));if(8!=t.length)return 10==t.length?(this.tr=new m(t.buffer,t.byteOffset),this.ori=new G(t.buffer,t.byteOffset+12),void(this.sc=new m(t.buffer,t.byteOffset+21))):void 0;{this.tr=new m(t.buffer,t.byteOffset),this.ori=new G(t.buffer,t.byteOffset+12);var e=t[7];this.sc=new m(e,e,e)}};t.prototype.clone=function(){return new t(this.tr.clone(),this.ori.clone(),this.sc.clone())};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.prototype.toJSON=function(){var t={tr:this.tr.toJSON(),ori:this.ori.toJSON()};return this.sc.is111()||(t.sc=this.sc.toJSON()),t};t.prototype.fromJSON=function(t){this.tr.fromJSON(t.tr),this.ori.fromJSON(t.ori),t.sc&&this.sc.fromJSON(t.sc)};t.prototype.toString=function(){return s(this.toJSON())};return t}();t("S",v);u.registerType("Xfo",v);var V=function(){function t(t,e){this.p0=t instanceof h?t:new h(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.p1=e instanceof h?e:new h(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)}t.prototype.set=function(t,e){this.p0=t,this.p1=e};t.prototype.reset=function(){this.p0.x=Number.POSITIVE_INFINITY,this.p1.x=Number.NEGATIVE_INFINITY,this.p0.y=Number.POSITIVE_INFINITY,this.p1.y=Number.NEGATIVE_INFINITY};t.prototype.isValid=function(){return this.p0.x!=Number.POSITIVE_INFINITY&&this.p1.x!=Number.NEGATIVE_INFINITY&&this.p0.y!=Number.POSITIVE_INFINITY&&this.p1.y!=Number.NEGATIVE_INFINITY};t.prototype.addPoint=function(t){(this.p0.x==Number.POSITIVE_INFINITY||t.x<this.p0.x)&&(this.p0.x=t.x),(this.p0.y==Number.POSITIVE_INFINITY||t.y<this.p0.y)&&(this.p0.y=t.y),(this.p1.y==Number.NEGATIVE_INFINITY||t.x>this.p1.x)&&(this.p1.x=t.x),(this.p1.y==Number.NEGATIVE_INFINITY||t.y>this.p1.y)&&(this.p1.y=t.y)};t.prototype.size=function(){return this.p1.subtract(this.p0)};t.prototype.diagonal=function(){return this.p1.subtract(this.p0)};t.prototype.center=function(){var t=this.p1.subtract(this.p0);return t.scaleInPlace(.5),t.addInPlace(this.p0),t};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.prototype.toJSON=function(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON()}};t.prototype.toString=function(){return s(this.toJSON())};return t}();u.registerType("Box2",V);var I=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=0}var i=this;i=t.call(this)||this,i.pos=e instanceof m?e:new m,i.radius=a;return i}e.prototype.clone=function(){return new Sphere(this.pos.clone(),this.radius)};e.prototype.intersectsBox=function(t){return t.intersectsSphere(this)};e.create=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return new(Sphere.bind.apply(Sphere,__spreadArrays([void 0],t)))};e.prototype.toJSON=function(){return{pos:this.pos.toJSON(),radius:this.radius}};e.prototype.toString=function(){return s(this.toJSON())};return e}(d);u.registerType("SphereType",I);var R=function(){function t(t,e){t instanceof Float32Array?this.setFromFloat32Array(t):(this.p0=t instanceof m?t:new m(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.p1=e instanceof m?e:new m(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))}Object.defineProperty(t.prototype,"min",{get:function(){return this.p0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"max",{get:function(){return this.p1},enumerable:true,configurable:true});t.prototype.set=function(t,e){this.p0=t,this.p1=e};t.prototype.reset=function(){this.p0.x=Number.POSITIVE_INFINITY,this.p1.x=Number.NEGATIVE_INFINITY,this.p0.y=Number.POSITIVE_INFINITY,this.p1.y=Number.NEGATIVE_INFINITY,this.p0.z=Number.POSITIVE_INFINITY,this.p1.z=Number.NEGATIVE_INFINITY};t.prototype.isValid=function(){return this.p0.x!=Number.POSITIVE_INFINITY&&this.p1.x!=Number.NEGATIVE_INFINITY&&this.p0.y!=Number.POSITIVE_INFINITY&&this.p1.y!=Number.NEGATIVE_INFINITY&&this.p0.z!=Number.POSITIVE_INFINITY&&this.p1.z!=Number.NEGATIVE_INFINITY};t.prototype.addPoint=function(t){t.x!=Number.POSITIVE_INFINITY&&t.x!=Number.NEGATIVE_INFINITY&&(t.x<this.p0.x&&(this.p0.x=t.x),t.x>this.p1.x&&(this.p1.x=t.x)),t.y!=Number.POSITIVE_INFINITY&&t.y!=Number.NEGATIVE_INFINITY&&(t.y<this.p0.y&&(this.p0.y=t.y),t.y>this.p1.y&&(this.p1.y=t.y)),t.z!=Number.POSITIVE_INFINITY&&t.z!=Number.NEGATIVE_INFINITY&&(t.z<this.p0.z&&(this.p0.z=t.z),t.z>this.p1.z&&(this.p1.z=t.z))};t.prototype.addBox3=function(t,e){e?(this.addPoint(e.transformVec3(t.p0)),this.addPoint(e.transformVec3(new m(t.p0.x,t.p0.y,t.p1.z))),this.addPoint(e.transformVec3(new m(t.p0.x,t.p1.y,t.p0.z))),this.addPoint(e.transformVec3(new m(t.p1.x,t.p0.y,t.p0.z))),this.addPoint(e.transformVec3(new m(t.p0.x,t.p1.y,t.p1.z))),this.addPoint(e.transformVec3(new m(t.p1.x,t.p0.y,t.p1.z))),this.addPoint(e.transformVec3(new m(t.p1.x,t.p1.y,t.p0.z))),this.addPoint(e.transformVec3(t.p1))):(this.addPoint(t.p0),this.addPoint(t.p1))};t.prototype.size=function(){return this.p1.subtract(this.p0)};t.prototype.diagonal=function(){return this.p1.subtract(this.p0)};t.prototype.center=function(){var t=this.p1.subtract(this.p0);return t.scaleInPlace(.5),t.addInPlace(this.p0),t};t.prototype.toMat4=function(){var t=this.p1.x-this.p0.x,e=this.p1.y-this.p0.y,a=this.p1.z-this.p0.z;return new Z(t,0,0,0,0,e,0,0,0,0,a,0,this.p0.x,this.p0.y,this.p0.z,1)};t.prototype.getBoundingSphere=function(){return new I(this.center(),.5*this.diagonal().length())};t.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)};t.prototype.intersectsSphere=function(t){return closestPoint.distanceToSquared(t.center)<=t.radius*t.radius};t.prototype.intersectsPlane=function(t){var e,a;return t.normal.x>0?(e=t.normal.x*this.min.x,a=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,a=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,a+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,a+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,a+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,a+=t.normal.z*this.min.z),e<=-t.constant&&a>=-t.constant};t.prototype.clone=function(){return new t(this.p0.clone(),this.p1.clone())};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.sizeInBytes=function(){return 24};t.prototype.toJSON=function(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON()}};t.prototype.fromJSON=function(t){this.p0.fromJSON(t.p0),this.p1.fromJSON(t.p1)};t.prototype.loadBin=function(t,e){this.p0.loadBin(t,e),this.p0.loadBin(t,e+12)};t.prototype.setFromFloat32Array=function(t){this.p0=new m(t.buffer,t.byteOffset),this.p1=new m(t.buffer,t.byteOffset+12)};t.prototype.toString=function(){return s(this.toJSON())};return t}();t("v",R);u.registerType("Box3",R);var x=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=0}var i=this;i=t.call(this)||this,i.normal=e instanceof m?e:new m,i.w=a;return i}e.prototype.set=function(t,e,a,i){this.normal.set(t,e,a),this.w=i};e.prototype.divideScalar=function(t){this.normal.scaleInPlace(1/t),this.w/=t};e.prototype.distanceToPoint=function(t){return t.dot(this.normal)+this.w};e.prototype.normalizeInPlace=function(){var t=1/this.normal.length();this.normal.scaleInPlace(t),this.w*=t};e.prototype.clone=function(){return new Plane(this.normal.clone(),this.w)};e.create=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return new(Plane.bind.apply(Plane,__spreadArrays([void 0],t)))};e.prototype.toJSON=function(){return{normal:this.normal.toJSON(),w:this.w}};e.prototype.toString=function(){return s(this.toJSON())};return e}(d);u.registerType("PlaneType",x);var S=function(){function t(t,e,a,i,n,r){this.planes=[t||new x,e||new x,a||new x,i||new x,n||new x,r||new x]}t.prototype.setFromMatrix=function(t){var e=t,a=this.planes;a[0].set(e.m03-e.m00,e.m13-e.m10,e.m23-e.m20,e.m33-e.m30),a[1].set(e.m03+e.m00,e.m13+e.m10,e.m23+e.m20,e.m33+e.m30),a[2].set(e.m03+e.m01,e.m13+e.m11,e.m23+e.m21,e.m33+e.m31),a[3].set(e.m03-e.m01,e.m13-e.m11,e.m23-e.m21,e.m33-e.m31),a[4].set(e.m03-e.m02,e.m13-e.m12,e.m23-e.m22,e.m33-e.m32),a[5].set(e.m03+e.m02,e.m13+e.m12,e.m23+e.m22,e.m33+e.m32),a.forEach((function(t){return t.normalizeInPlace()}))};t.prototype.intersectsBox=function(t){var e=new m,a=this.planes,i=t.min,n=t.max;for(var r=0;r<6;r++){var o=a[r];if(e.x=o.normal.x>0?n.x:i.x,e.y=o.normal.y>0?n.y:i.y,e.z=o.normal.z>0?n.z:i.z,o.distanceToPoint(e)<0)return!1}return!0};t.prototype.toJSON=function(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON(),p2:this.p2.toJSON(),p3:this.p3.toJSON(),p4:this.p4.toJSON(),p5:this.p5.toJSON()}};t.prototype.fromJSON=function(t){this.p0.fromJSON(t.p0),this.p1.fromJSON(t.p1),this.p2.fromJSON(t.p2),this.p3.fromJSON(t.p3),this.p4.fromJSON(t.p4),this.p5.fromJSON(t.p5)};t.prototype.toString=function(){return s(this.toJSON())};return t}();u.registerType("Frustum",S);var W=Object.freeze({__proto__:null,UInt8:0,SInt8:1,SInt16:3,UInt16:2,SInt32:5,UInt32:4,Float32:6,hashStr:l,JSON_stringify_fixedPrecision:s,AttrValue:d,Vec2:h,Vec3:m,Vec4:p,RGBA:f,Color:y,EulerAngles:g,Quat:G,Ray:X,Mat3:_,Mat4:Z,Xfo:v,Box2:V,Box3:R,Frustum:S,PlaneType:x,SphereType:I,typeRegistry:u});var L=function(){function t(){this.__slots={}}t.prototype.addListener=function(t,e){if(null==e)throw new Error("a function callback must be passed to EventEmitter.addListener");this.__slots[t]||(this.__slots[t]=[]);var a=this.__slots[t];if(-1!=a.indexOf(e))return void console.warn("listener '"+e.name+"' already connected to EventEmitter with eventName:"+t);var i=a.length;return a[i]=e,i};t.prototype.removeListener=function(t,e){if(null==e)throw new Error("a function callback must be passed to EventEmitter.disconnect");var a=this.__slots[t],i=[];if(a&&a.forEach((function(t,a){t===e&&i.push(a)})),0==i.length){var n=this.getName?this.getName():this.constructor.name;console.warn("Error in removeListener. listener :"+e.name+" was not connected to this event emitter:"+n)}else for(var r=0,o=i;r<o.length;r++){var l=o[r];a[l]=void 0}};t.prototype.removeListenerById=function(t,e){var a=this.__slots[t];if(a){if(!a[e])throw new Error("Invalid ID");a[e]=void 0}else{var i="callback :"+e+" was not connected to this signal:"+t;console.warn(i)}};t.prototype.on=function(t,e){return this.addListener(t,e)};t.prototype.once=function(t,e){var a=this;var i=this.addListener(t,(function(n){e(n),a.removeListenerById(t,i)}))};t.prototype.off=function(t,e){"number"==typeof e?this.removeListenerById(t,e):this.removeListener(t,e)};t.prototype.emit=function(t,e){var a=this.__slots[t];if(!a)return;var i=a.length;for(var n=0;n<i;n++){var r=a[n];r&&r(e)}};return t}();var T=function(t){__extends(e,t);function e(e,a){if(e===void 0){e=0}if(a===void 0){a=0}var i=this;i=t.call(this)||this,i.root={x:0,y:0,w:e,h:a};return i}e.prototype.fit=function(t){var e=this;if(0==t.length)return;var a=!1;this.root.w<t[0].w&&(this.root.w=t[0].w,a=!0),this.root.h<t[0].h&&(this.root.h=t[0].h,a=!0),a&&this.emit("resized",{width:this.root.w,height:this.root.h});t.forEach((function(t){t.fit=e.__addBlock(t)}))};e.prototype.__addBlock=function(t){var e=this.findNode(this.root,t.w,t.h);return e?this.splitNode(e,t.w,t.h):this.growNode(t.w,t.h)};e.prototype.addBlock=function(t){var e=!1;this.root.w<t.w&&(this.root.w=t.w,e=!0),this.root.h<t.h&&(this.root.h=t.h,e=!0),e&&this.emit("resized",{width:this.root.w,height:this.root.h});var a=this.findNode(this.root,t.w,t.h);return a?this.splitNode(a,t.w,t.h):this.growNode(t.w,t.h)};e.prototype.findNode=function(t,e,a){return t.used?this.findNode(t.right,e,a)||this.findNode(t.down,e,a):e<=t.w&&a<=t.h?t:null};e.prototype.splitNode=function(t,e,a){return t.used=!0,t.down={x:t.x,y:t.y+a,w:t.w,h:t.h-a},t.right={x:t.x+e,y:t.y,w:t.w-e,h:a},t};e.prototype.growNode=function(t,e){var a=t<=this.root.w,i=e<=this.root.h,n=i&&this.root.h>=this.root.w+t,r=a&&this.root.w>=this.root.h+e;return n?this.growRight(t,e):r?this.growDown(t,e):i?this.growRight(t,e):a?this.growDown(t,e):null};e.prototype.growRight=function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w+t,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:t,h:this.root.h}};var a=this.findNode(this.root,t,e);var i;return a&&(i=this.splitNode(a,t,e)),this.emit("resized",{width:this.root.w,height:this.root.h}),i};e.prototype.growDown=function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+e,down:{x:0,y:this.root.h,w:this.root.w,h:e},right:this.root};var a=this.findNode(this.root,t,e);var i;return a&&(i=this.splitNode(a,t,e)),this.emit("resized",{width:this.root.w,height:this.root.h}),i};return e}(L);var M=function(t){__extends(e,t);function e(e){if(e===void 0){e=0}var a=this;a=t.call(this)||this,a.__asyncCount=e,a.ready=!1,a.incAsyncCount=function(t){if(t===void 0){t=1}a.__asyncCount+=t,a.ready=!1},a.decAsyncCount=function(){a.__asyncCount>0&&(a.__asyncCount--,0==a.__asyncCount&&a.__asyncsCompleted())},a.__asyncsCompleted=function(){a.emit("ready",{})};return a}Object.defineProperty(e.prototype,"count",{get:function(){return this.__asyncCount},enumerable:true,configurable:true});return e}(L);var F=function(t){if(window.TextDecoder)return new TextDecoder("utf-8").decode(t);{var e="";for(var a=0;a<t.length;a++)e+=String.fromCharCode(t[a]);return e}};var C=Object.freeze({__proto__:null,GrowingPacker:T,Async:M,EventEmitter:L,decodeText:F});var N=0;var Y=function(t){__extends(e,t);function e(){var e=this;if(e=t.call(this)||this,"RefCounted"==e.constructor.name)throw new Error("RefCounted should not be instantiated directly.");e.__id=++N,e.__refs=[],e.__destroyed=!1;return e}e.prototype.getId=function(){return this.__id};e.prototype.numRefs=function(){return this.__refs.length};e.prototype.addRef=function(t){if(!t)throw new Error("Error in RefCounted.addRef: Must provide a referer");return this.__refs.push(t),!0};e.prototype.removeRef=function(t){if(!t)throw new Error("Error in RefCounted.removeRef: Must provide a referer");var e=this.__refs.indexOf(t);if(-1==e)throw new Error("Error in RefCounted.removeRef: referer not found in refs list.");this.__refs.splice(e,1),0==this.__refs.length&&this.destroy()};e.prototype.getRefer=function(t){return this.__refs[t]};e.prototype.getRefIndex=function(t){return this.__refs.indexOf(t)};e.prototype.isDestroyed=function(){return this.__destroyed};e.prototype.destroy=function(){this.__destroyed=!0,this.emit("destructing",{})};return e}(L);var K=new(function(){function t(){this.__registeredClasses={},this.__classNames={},this.__classList=[]}t.prototype.registerClass=function(t,e){this.__registeredClasses[t]={cls:e,callbacks:[]};var a=this.__classList.length;this.__classList.push(e),this.__classNames[a]=t};t.prototype.getClass=function(t){if(this.__registeredClasses[t])return this.__registeredClasses[t].cls};t.prototype.getClassName=function(t){var e=this.__classList.indexOf(t.constructor);return this.__classNames[e]?this.__classNames[e]:(console.warn("Class not registered:",t.constructor.name),t.constructor.name)};t.prototype.constructClass=function(t){var e;var a=this.__registeredClasses[t];if(!a)return console.warn("Factory not registered:"+t),null;this.__constructing=!0;var i=Array.prototype.slice.call(arguments,1),n=new((e=a.cls).bind.apply(e,__spreadArrays([void 0],i)));return this.__constructing=!1,n};return t}()),w={NORMAL:0,OPERATOR_GETVALUE:1},z=t("E",{USER_SETVALUE:0,REMOTEUSER_SETVALUE:1,USER_SETVALUE_DONE:2,OPERATOR_SETVALUE:3,OPERATOR_DIRTIED:4,COMPUTED_VALUE:4,GENERATED_VALUE:4,DATA_LOAD:4}),U={USER_EDITED:2,DISABLED:4},J=0,P=1,E=2;var H=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__name=e,a.__cleanerFns=[],a.__boundOps=[],a.__state=J,a.__flags=0,a.getName=a.getName.bind(a),a.setName=a.setName.bind(a),a.getValue=a.getValue.bind(a),a.setValue=a.setValue.bind(a);return a}e.prototype.getName=function(){return this.__name};e.prototype.setName=function(t){if(t!=this.__name){var e=this.__name;this.__name=t,this.emit("nameChanged",{mode:this.__name},e)}};e.prototype.getOwner=function(){return this.ownerItem};e.prototype.setOwner=function(t){this.ownerItem=t};e.prototype.getPath=function(){var t=this.getOwner();if(t&&t.getName){if(t.getPath){var e=t.getPath().slice();return e.push(this.__name),e}return[t.getName(),this.__name]}return[this.__name]};e.prototype.setFlag=function(t){this.__flags|=t};e.prototype.clearFlag=function(t){this.__flags&=~t};e.prototype.testFlag=function(t){return 0!=(this.__flags&t)};e.prototype.getValue=function(){};e.prototype.setValue=function(t){};e.prototype.setEnabled=function(t){console.warn("Deprecated Method: This method will be removed soon."),t?this.setFlag(U.DISABLED):this.clearFlag(U.DISABLED)};e.prototype.isEnabled=function(){console.warn("Deprecated Method: This method will be removed soon."),this.testFlag(U.DISABLED)};e.prototype.bindOperator=function(t){this.__boundOps.push(t),this.__state=P,this.emit("valueChanged",{mode:z.OPERATOR_DIRTIED})};e.prototype.unbindOperator=function(t){var e=this.__boundOps.indexOf(t);if(-1==e)return!1;this.__boundOps.splice(e,1),this.__state=P,this.emit("valueChanged",{mode:z.OPERATOR_DIRTIED})};e.prototype.setDirty=function(t){return-1==this.__cleanerFns.indexOf(t)&&(this.__cleanerFns.push(t),this.__state=P,this.emit("valueChanged",{mode:z.OPERATOR_DIRTIED}),!0)};e.prototype.setDirtyFromOp=function(){return this.__state==J&&(this.__state=P,this.emit("valueChanged",{mode:z.OPERATOR_DIRTIED})),!0};e.prototype.isDirty=function(){return this.__state==P};e.prototype._clean=function(){this.__state=E;var t=this.__cleanerFns;this.__cleanerFns=[];for(var e=0,a=t;e<a.length;e++){var i=a[e];var n=i(this.__value);null!=n&&(this.__value=n)}for(var r=0,o=this.__boundOps;r<o.length;r++){var l=o[r];l.evaluate()}this.__state=J};e.prototype.removeCleanerFn=function(t){var e=this.__cleanerFns.indexOf(t);if(-1==e)return 0;this.__cleanerFns.splice(e,1)};e.prototype.clone=function(t){console.error("TOOD: implment me")};e.prototype.destroy=function(){};return e}(L);var k=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e)||this,n.__value=a,n.__dataType=i||a.constructor.name;return n}e.prototype.getDataType=function(){return this.__dataType};e.prototype.getValue=function(t){if(t===void 0){t=w.NORMAL}return this.__state==P&&this._clean(),this.__value};e.prototype.setClean=function(t){this.__value=t};e.prototype.setValue=function(t,e){if(e===void 0){e=z.USER_SETVALUE}if(this.__cleanerFns.length>0&&(this.__cleanerFns=[]),null==t)throw"undefined was passed into the setvalue for param:"+this.getName();(t.fromJSON||this.__value!=t)&&(this.__value=t,e!=z.USER_SETVALUE&&e!=z.REMOTEUSER_SETVALUE||this.setFlag(U.USER_EDITED),e!=z.OPERATOR_SETVALUE&&this.emit("valueChanged",{mode:e}))};e.prototype.setValueDone=function(){this.emit("valueChanged",{mode:z.USER_SETVALUE_DONE})};e.prototype.toJSON=function(t,e){return this.__value.toJSON?{value:this.__value.toJSON(t,e)}:{value:this.__value}};e.prototype.fromJSON=function(t,e,a){null!=t.value?(this.setFlag(U.USER_EDITED),t.value.type&&null==this.__value&&(this.__value=K.constructClass(t.value.type)),null!=this.__value&&this.__value.fromJSON?(this.__value.fromJSON(t.value,e),this.emit("valueChanged",{mode:z.DATA_LOAD})):this.setValue(t.value,z.DATA_LOAD)):console.warn("Invalid Parameter JSON")};e.prototype.readBinary=function(t,e){console.error("TODO")};e.prototype.clone=function(t){var a=this.__value;a.clone&&(a=a.clone());return new e(this.__name,a,this.__dataType)};return e}(H);var B=0;var D=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__id=++B,e.__params=[],e.__paramMapping={},e.__paramSignalIds={};return e}e.prototype.getId=function(){return this.__id};e.prototype.numParameters=function(){return this.__params.length};e.prototype.getParameters=function(){return this.__params};e.prototype.getParameterIndex=function(t){return this.__paramMapping[t]};e.prototype.getParameterByIndex=function(t){return this.__params[t]};e.prototype.hasParameter=function(t){return t in this.__paramMapping};e.prototype.getParameter=function(t){var e=this.__paramMapping[t];return-1==e?null:this.__params[e]};e.prototype.__parameterValueChanged=function(t){this.emit("parameterValueChanged",t)};e.prototype.addParameter=function(t){var e=this;var a=t.getName();return null!=this.__paramMapping[a]&&(console.warn("Replacing Parameter:"+a),this.removeParameter(a)),this.__paramSignalIds[a]=t.addListener("valueChanged",(function(a){return e.__parameterValueChanged(__assign(__assign({},a),{param:t}))})),this.__params.push(t),this.__paramMapping[a]=this.__params.length-1,t.setOwner(this),this.emit("parameterAdded",{name:a}),t};e.prototype.insertParameter=function(t,e){var a=this;var i=t.getName();null!=this.__paramMapping[i]&&(console.warn("Replacing Parameter:"+i),this.removeParameter(i)),this.__paramSignalIds[i]=t.addListener("valueChanged",(function(e){return a.__parameterValueChanged(__assign(__assign({},e),{param:t}))})),this.__params.splice(e,0,t);var n={};for(var r=0;r<this.__params.length;r++)n[this.__params[r].getName()]=r;return this.__paramMapping=n,this.emit("parameterAdded",{name:i}),t};e.prototype.removeParameter=function(t){null==this.__paramMapping[t]&&console.throw("Unable to Remove Parameter:"+t);var e=this.__paramMapping[t];this.__params[this.__paramMapping[t]].removeListenerById("valueChanged",this.__paramSignalIds[t]),this.__params.splice(e,1);var a={};for(var i=0;i<this.__params.length;i++)a[this.__params[i].getName()]=i;this.__paramMapping=a,this.emit("parameterRemoved",{name:name})};e.prototype.replaceParameter=function(t){var e=this;var a=t.getName(),i=this.__paramMapping[a];return this.__params[this.__paramMapping[a]].removeListenerById("valueChanged",this.__paramSignalIds[a]),this.__paramSignalIds[a]=t.addListener("valueChanged",(function(a){return e.__parameterValueChanged(__assign(__assign({},a),{param:t}))})),this.__params[i]=t,t};e.prototype.toJSON=function(t,e){var a={};var i=0;for(var n=0,r=this.__params;n<r.length;n++){var o=r[n];if(!o.testFlag(U.USER_EDITED))continue;var l=o.toJSON(t,e);l&&(a[o.getName()]=l,i++)}if(i>0)return{params:a}};e.prototype.fromJSON=function(t,e,a){var i=this;if(t.params){var n=function(a){var n=t.params[a],o=r.getParameter(a);o?n.paramPath?e.resolvePath(n.paramPath,(function(t){i.replaceParameter(t)}),(function(t){console.warn("Unable to resolve shared parameter:"+n.paramPath)})):o.fromJSON(n,e):console.warn("Param not found:"+a)};var r=this;for(var o in t.params){n(o)}}};e.prototype.readBinary=function(t,e){if(e.versions["zea-engine"].greaterOrEqualThan([0,0,3])){var a=t.loadUInt32();for(var i=0;i<a;i++){var n=t.loadStr(),r=t.loadStr();var o=this.getParameter(r);if(!o){if(o=K.constructClass(n,r),!o){console.error("Unable to construct prop:"+r+" of type:"+n);continue}this.addParameter(o)}o.readBinary(t,e)}}};e.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};e.prototype.copyFrom=function(t,e){var a=t.numParameters();for(;a--;){var i=t.getParameterByIndex(a),n=this.getParameter(i.getName());n?n.setValue(i.getValue(),z.OPERATOR_SETVALUE):this.addParameter(i.clone())}};return e}(L);var O={USER_EDITED:2,IGNORE_BBOX:4,BIN_NODE:8,INVISIBLE:16};var Q=0;var A=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__name=e||"",a.__path=[a.__name],a.__ownerItem=void 0,a.__flags=0,a.__selectable=!0,a.__selected=!1,a.__metaData={},Q++;return a}e.getNumBaseItems=function(){return Q};e.prototype.__parameterValueChanged=function(e){t.prototype.__parameterValueChanged.call(this,e),e.mode!=z.USER_SETVALUE&&e.mode!=z.REMOTEUSER_SETVALUE||this.setFlag(O.USER_EDITED)};e.prototype.getName=function(){return this.__name};e.prototype.setName=function(t,e){if(e===void 0){e=z.USER_SETVALUE}if(this.__name!=t){var a=this.__name;this.__name=t,this.__updatePath(),this.emit("nameChanged",{newName:t,oldName:a,mode:e})}};e.prototype.__updatePath=function(){null==this.__ownerItem?this.__path=[this.__name]:(this.__path=this.__ownerItem.getPath().slice(),this.__path.push(this.__name))};e.prototype.getPath=function(){return this.__path};e.prototype.setFlag=function(t){this.__flags|=t};e.prototype.clearFlag=function(t){this.__flags&=~t};e.prototype.testFlag=function(t){return 0!=(this.__flags&t)};e.prototype.resolvePath=function(t,e){if(e==t.length)return this;if(">"==t[e]&&e==t.length-1)return this.getParameter(t[e+1]);var a=this.getParameter(t[e]);if(a)return a;throw new Error("Invalid path:"+t+" member not found")};e.prototype.getOwner=function(){return this.__ownerItem};e.prototype.setOwner=function(t){this.__ownerItem!==t&&(this.__ownerItem=t,this.__updatePath())};e.prototype.getSelectable=function(){return this.__selectable};e.prototype.setSelectable=function(t){return this.__selectable!=t&&(this.__selectable=t,!0)};e.prototype.isSelected=function(){return this.__selected};e.prototype.getSelected=function(){return this.__selected};e.prototype.setSelected=function(t){this.__selected=t,this.emit("selectedChanged",{selected:this.__selected})};e.prototype.getMetadata=function(t){return this.__metaData[t]};e.prototype.hasMetadata=function(t){return t in this.__metaData};e.prototype.setMetadata=function(t,e){this.__metaData[t]=e};e.prototype.deleteMetadata=function(t){delete this.__metaData[t]};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return!i&&this.testFlag(O.USER_EDITED)&&(i={}),i&&(i.name=this.__name,this.testFlag(O.BIN_NODE)||(i.type=K.getClassName(this))),i};e.prototype.fromJSON=function(e,a,i){e.name&&(this.__name=e.name),t.prototype.fromJSON.call(this,e,a,i),this.__flags|=O.USER_EDITED};e.prototype.readBinary=function(e,a){e.loadStr();this.setName(e.loadStr()),t.prototype.readBinary.call(this,e,a)};e.prototype.clone=function(t){throw new Error(this.constructor.name+" does not implment its clone method")};e.prototype.copyFrom=function(e,a){t.prototype.copyFrom.call(this,e,a),this.setName(e.getName())};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(D);var q=function(t){return t.substring(0,t.lastIndexOf("/"))+"/"},$=function(t,e,a,i,n){var r=new XMLHttpRequest;r.responseType=e;try{r.addListener("timeout",(function(e){throw new Error("The request for "+t+" timed out.")})),r.addListener("error",(function(e){throw new Error("The request for "+t+": xhr.readyState:"+r.readyState)})),r.addListener("abort",(function(e){throw new Error("The request for "+t+": xhr.readyState:"+r.readyState)})),r.addListener("loadend",(function(t){200==r.status?a(r):i(r.statusText)})),r.open("GET",t,!0),r.send()}catch(t){i(t)}},tt=function(t,e,a,i){$(t,"text",(function(t){e(t.responseText)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},et=function(t,e,a,i){$(t,"json",(function(t){e(t.response,t)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},it=function(t,e,a,i){$(t,"document",(function(t){e(t.responseXML)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},nt=function(t,e,a,i){$(t,"arraybuffer",(function(t){e(t.response)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},rt="[object process]"===Object.prototype.toString.call("undefined"!=typeof e?e:0),ot=rt&&"function"==typeof module.require?module.require:null;function lt(t,e,i){if(e===void 0){e=null}if(i===void 0){i=!1}var n=rt?function(t,e){return a.from(t,"base64").toString(e?"utf16":"utf8")}(t,i):function(t,e){var a=atob(t);if(e){var i=new Uint8Array(a.length);return Array.prototype.forEach.call(i,(function(t,e,i){i[e]=a.charCodeAt(e)})),String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return a}(t,i),r=n.indexOf("\n",10)+1,o=n.substring(r)+(e?"//# sourceMappingURL="+e:"");if(ot){var l=ot("worker_threads").Worker;return function(t){return new l(o,Object.assign({},t,{eval:!0}))}}var s=new Blob([o],{type:"application/javascript"}),d=URL.createObjectURL(s);return function(t){return new Worker(d,t)}}var st=lt("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwpNb2R1bGU9e0VOVklST05NRU5UOiJXT1JLRVIifTtjb25zdCBlPXt9O3ZhciB0Oyh0PWUpLnVucGFja0JyaWRnZT1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHQ9e307ZnVuY3Rpb24gcihuKXtpZih0W25dKXJldHVybiB0W25dLmV4cG9ydHM7dmFyIG89dFtuXT17aTpuLGw6ITEsZXhwb3J0czp7fX07cmV0dXJuIGVbbl0uY2FsbChvLmV4cG9ydHMsbyxvLmV4cG9ydHMsciksby5sPSEwLG8uZXhwb3J0c31yZXR1cm4gci5tPWUsci5jPXQsci5kPWZ1bmN0aW9uKGUsdCxuKXtyLm8oZSx0KXx8T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7ZW51bWVyYWJsZTohMCxnZXQ6bn0pfSxyLnI9ZnVuY3Rpb24oZSl7InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJlN5bWJvbC50b1N0cmluZ1RhZyYmT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsU3ltYm9sLnRvU3RyaW5nVGFnLHt2YWx1ZToiTW9kdWxlIn0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0sci50PWZ1bmN0aW9uKGUsdCl7aWYoMSZ0JiYoZT1yKGUpKSw4JnQpcmV0dXJuIGU7aWYoNCZ0JiYib2JqZWN0Ij09dHlwZW9mIGUmJmUmJmUuX19lc01vZHVsZSlyZXR1cm4gZTt2YXIgbj1PYmplY3QuY3JlYXRlKG51bGwpO2lmKHIucihuKSxPYmplY3QuZGVmaW5lUHJvcGVydHkobiwiZGVmYXVsdCIse2VudW1lcmFibGU6ITAsdmFsdWU6ZX0pLDImdCYmInN0cmluZyIhPXR5cGVvZiBlKWZvcih2YXIgbyBpbiBlKXIuZChuLG8sZnVuY3Rpb24odCl7cmV0dXJuIGVbdF19LmJpbmQobnVsbCxvKSk7cmV0dXJuIG59LHIubj1mdW5jdGlvbihlKXt2YXIgdD1lJiZlLl9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gZS5kZWZhdWx0fTpmdW5jdGlvbigpe3JldHVybiBlfTtyZXR1cm4gci5kKHQsImEiLHQpLHR9LHIubz1mdW5jdGlvbihlLHQpe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KX0sci5wPSIiLHIoci5zPTIpfShbZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTtjb25zdCBvPXIoMSksaT17MDoiRVJBUl9TVUNDRVNTIiwxMDoiRVJBUl9FTkRfQVJDSElWRSIsMTE6IkVSQVJfTk9fTUVNT1JZIiwxMjoiRVJBUl9CQURfREFUQSIsMTM6IkVSQVJfQkFEX0FSQ0hJVkUiLDE0OiJFUkFSX1VOS05PV05fRk9STUFUIiwxNToiRVJBUl9FT1BFTiIsMTY6IkVSQVJfRUNSRUFURSIsMTc6IkVSQVJfRUNMT1NFIiwxODoiRVJBUl9FUkVBRCIsMTk6IkVSQVJfRVdSSVRFIiwyMDoiRVJBUl9TTUFMTF9CVUYiLDIxOiJFUkFSX1VOS05PV04iLDIyOiJFUkFSX01JU1NJTkdfUEFTU1dPUkQiLDIzOiJFUkFSX0VSRUZFUkVOQ0UiLDI0OiJFUkFSX0JBRF9QQVNTV09SRCJ9LGE9ezA6IlN1Y2Nlc3MiLDExOiJOb3QgZW5vdWdoIG1lbW9yeSIsMTI6IkFyY2hpdmUgaGVhZGVyIG9yIGRhdGEgYXJlIGRhbWFnZWQiLDEzOiJGaWxlIGlzIG5vdCBSQVIgYXJjaGl2ZSIsMTQ6IlVua25vd24gYXJjaGl2ZSBmb3JtYXQiLDE1OiJGaWxlIG9wZW4gZXJyb3IiLDE2OiJGaWxlIGNyZWF0ZSBlcnJvciIsMTc6IkZpbGUgY2xvc2UgZXJyb3IiLDE4OiJGaWxlIHJlYWQgZXJyb3IiLDE5OiJGaWxlIHdyaXRlIGVycm9yIiwyMDoiQnVmZmVyIGZvciBhcmNoaXZlIGNvbW1lbnQgaXMgdG9vIHNtYWxsLCBjb21tZW50IHRydW5jYXRlZCIsMjE6IlVua25vd24gZXJyb3IiLDIyOiJQYXNzd29yZCBmb3IgZW5jcnlwdGVkIGZpbGUgb3IgaGVhZGVyIGlzIG5vdCBzcGVjaWZpZWQiLDIzOiJDYW5ub3Qgb3BlbiBmaWxlIHNvdXJjZSBmb3IgcmVmZXJlbmNlIHJlY29yZCIsMjQ6Ildyb25nIHBhc3N3b3JkIGlzIHNwZWNpZmllZCJ9O2NsYXNzIHN7Y29uc3RydWN0b3IoZT0iIil7dGhpcy5fcGFzc3dvcmQ9ZSx0aGlzLl9hcmNoaXZlPW51bGx9Z2V0RmlsZUxpc3QoKXtsZXQgZSxbdCxyXT10aGlzLm9wZW5BcmMoITApO2lmKCJTVUNDRVNTIiE9PXQuc3RhdGUpZT1bdCxudWxsXTtlbHNle2xldCB0LG4sbz1bXTtmb3IoO1t0LG5dPXRoaXMucHJvY2Vzc05leHRGaWxlKCgpPT4hMCksIlNVQ0NFU1MiPT09dC5zdGF0ZTspby5wdXNoKG4uZmlsZUhlYWRlcik7ZT0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpyLGZpbGVIZWFkZXJzOm99XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLGV9ZXh0cmFjdEFsbCgpe2xldCBlLFt0LHJdPXRoaXMub3BlbkFyYyghMSk7aWYoIlNVQ0NFU1MiIT09dC5zdGF0ZSllPVt0LG51bGxdO2Vsc2V7bGV0IHQsbixvPVtdO2Zvcig7W3Qsbl09dGhpcy5wcm9jZXNzTmV4dEZpbGUoKCk9PiExKSwiU1VDQ0VTUyI9PT10LnN0YXRlOylvLnB1c2gobik7ZT0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpyLGZpbGVzOm99XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLGV9ZXh0cmFjdEZpbGVzKGUsdCl7bGV0IHIsW24sb109dGhpcy5vcGVuQXJjKCExLHQpLGk9e307Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDsrK3QpaVtlW3RdXT10O2lmKCJTVUNDRVNTIiE9PW4uc3RhdGUpcj1bbixudWxsXTtlbHNle2xldCB0LG4sYT1BcnJheShlLmxlbmd0aCkuZmlsbChudWxsKSxzPTA7Zm9yKDs7KXtsZXQgcj0hMSxvPW51bGw7aWYoW3Qsbl09dGhpcy5wcm9jZXNzTmV4dEZpbGUoZT0+ZSBpbiBpPyhvPWlbZV0sITEpOihyPSEwLCEwKSksIlNVQ0NFU1MiIT09dC5zdGF0ZSlicmVhaztpZighciYmKGFbb109biwrK3M9PT1lLmxlbmd0aCkpe3QucmVhc29uPSJFUkFSX0VORF9BUkNISVZFIjticmVha319cj0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpvLGZpbGVzOmF9XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLHJ9ZmlsZUNyZWF0ZWQoZSl7fWNsb3NlKGUpe3RoaXMuX2xhc3RGaWxlQ29udGVudD10aGlzLmNsb3NlRmlsZShlKX1vcGVuQXJjKGUsdCl7by5FeHQuY3VycmVudD10aGlzLHRoaXMuX2FyY2hpdmU9bmV3IG4uUmFyQXJjaGl2ZTtsZXQgcixpPXRoaXMuX2FyY2hpdmUub3Blbih0aGlzLl9maWxlUGF0aCx0fHx0aGlzLl9wYXNzd29yZCxlKTtyZXR1cm4gcj0wIT09aS5zdGF0ZS5lcnJDb2RlP1t0aGlzLmdldEZhaWxJbmZvKGkuc3RhdGUuZXJyQ29kZSxpLnN0YXRlLmVyclR5cGUpLG51bGxdOlt7c3RhdGU6IlNVQ0NFU1MifSx7Y29tbWVudDppLmNvbW1lbnQsZmxhZ3M6e3ZvbHVtZTowIT0oMSZpLmZsYWdzKSxsb2NrOjAhPSg0JmkuZmxhZ3MpLHNvbGlkOjAhPSg4JmkuZmxhZ3MpLGF1dGhJbmZvOjAhPSgzMiZpLmZsYWdzKSxyZWNvdmVyeVJlY29yZDowIT0oNjQmaS5mbGFncyksaGVhZGVyRW5jcnlwdGVkOjAhPSgxMjgmaS5mbGFncyl9fV0sby5FeHQuY3VycmVudD1udWxsLHJ9cHJvY2Vzc05leHRGaWxlKGUpe2xldCB0O28uRXh0LmN1cnJlbnQ9dGhpcztsZXQgcj10aGlzLl9hcmNoaXZlLmdldEZpbGVIZWFkZXIoKSxuPVt7c3RhdGU6IlNVQ0NFU1MifSxudWxsXTtpZigwPT09ci5zdGF0ZS5lcnJDb2RlKXtsZXQgdD1lKHIubmFtZSk7dGhpcy5fbGFzdEZpbGVDb250ZW50PW51bGw7bGV0IG89dGhpcy5fYXJjaGl2ZS5yZWFkRmlsZSh0KTswPT09by5lcnJDb2RlfHx0fHwoblswXT10aGlzLmdldEZhaWxJbmZvKG8uZXJyQ29kZSxvLmVyclR5cGUpLDIyPT09by5lcnJDb2RlP289dGhpcy5fYXJjaGl2ZS5yZWFkRmlsZSghMCk6by5lcnJDb2RlPTApLDA9PT1vLmVyckNvZGU/blsxXT10aGlzLl9sYXN0RmlsZUNvbnRlbnQ6KHIuc3RhdGUuZXJyQ29kZT1vLmVyckNvZGUsci5zdGF0ZS5lcnJUeXBlPW8uZXJyVHlwZSksdGhpcy5fbGFzdEZpbGVDb250ZW50PW51bGx9cmV0dXJuIHQ9MCE9PXIuc3RhdGUuZXJyQ29kZT9bdGhpcy5nZXRGYWlsSW5mbyhyLnN0YXRlLmVyckNvZGUsci5zdGF0ZS5lcnJUeXBlKSxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2ZpbGVIZWFkZXI6e25hbWU6ci5uYW1lLGZsYWdzOntlbmNyeXB0ZWQ6MCE9KDQmci5mbGFncyksc29saWQ6MCE9KDE2JnIuZmxhZ3MpLGRpcmVjdG9yeTowIT0oMzImci5mbGFncyl9LHBhY2tTaXplOnIucGFja1NpemUsdW5wU2l6ZTpyLnVucFNpemUsY3JjOnIuY3JjLHRpbWU6ZnVuY3Rpb24oZSl7Y29uc3QgdD1bNSw2LDUsNSw0LDddO2xldCByPVtdO2ZvcihsZXQgbiBvZiB0KXIucHVzaChlJigxPDxuKS0xKSxlPj49bjtsZXQgbj1lPT5lPDEwPyIwIitlOiIiK2U7cmV0dXJuYCR7MTk4MCsocj1yLnJldmVyc2UoKSlbMF19LSR7bihyWzFdKX0tJHtuKHJbMl0pfVQke24oclszXSl9OiR7bihyWzRdKX06JHtuKDIqcls1XSl9LjAwMGB9KHIudGltZSksdW5wVmVyOmAke01hdGguZmxvb3Ioci51bnBWZXIvMTApfS4ke3IudW5wVmVyJTEwfWAsbWV0aG9kOmZ1bmN0aW9uKGUpe3JldHVybns0ODoiU3RvcmluZyIsNDk6IkZhc3Rlc3QiLDUwOiJGYXN0Iiw1MToiTm9ybWFsIiw1MjoiR29vZCIsNTM6IkJlc3QifVtlXXx8IlVua25vd24ifShyLm1ldGhvZCl9LGV4dHJhY3Q6bn1dLG8uRXh0LmN1cnJlbnQ9bnVsbCx0fWNsb3NlQXJjKCl7by5FeHQuY3VycmVudD10aGlzLHRoaXMuX2FyY2hpdmUuZGVsZXRlKCksby5FeHQuY3VycmVudD1udWxsLHRoaXMuX2FyY2hpdmU9bnVsbH1nZXRGYWlsSW5mbyhlLHQpe3JldHVybntzdGF0ZToiRkFJTCIscmVhc29uOmlbZV0sbXNnOmFbZV19fX1zLl9jdXJyZW50PW51bGwsdC5FeHRyYWN0b3I9c30sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSx0LkV4dD17Y3VycmVudDpudWxsfX0sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxmdW5jdGlvbihlKXtmb3IodmFyIHIgaW4gZSl0Lmhhc093blByb3BlcnR5KHIpfHwodFtyXT1lW3JdKX0ocigzKSk7dmFyIG49cigxKTt0LkV4dD1uLkV4dH0sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTtjb25zdCBuPXIoNCksbz1yKDYpO3QuY3JlYXRlRXh0cmFjdG9yRnJvbURhdGE9ZnVuY3Rpb24oZSx0PSIiKXtyZXR1cm4gbmV3IG4uRGF0YUV4dHJhY3RvcihlLHQpfSx0LmNyZWF0ZUV4dHJhY3RvckZyb21GaWxlPWZ1bmN0aW9uKGUsdD0iIixyPSIiKXtyZXR1cm4gbmV3IG8uRmlsZUV4dHJhY3RvcihlLHQscil9fSxmdW5jdGlvbihlLHQscil7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO2NvbnN0IG89cig1KSxpPXIoMCk7dC5EYXRhRXh0cmFjdG9yPWNsYXNzIGV4dGVuZHMgaS5FeHRyYWN0b3J7Y29uc3RydWN0b3IoZSx0KXtzdXBlcih0KSx0aGlzLmRhdGFGaWxlcz17fSx0aGlzLmRhdGFGaWxlTWFwPXt9LHRoaXMuY3VycmVudEZkPTE7bGV0IHI9e2ZpbGU6bmV3IG8uRGF0YUZpbGUobmV3IFVpbnQ4QXJyYXkoZSkpLGZkOnRoaXMuY3VycmVudEZkKyt9O3RoaXMuX2ZpbGVQYXRoPSJfZGVmYXVsdFVucmFySlNfLnJhciIsdGhpcy5kYXRhRmlsZXNbdGhpcy5fZmlsZVBhdGhdPXIsdGhpcy5kYXRhRmlsZU1hcFtyLmZkXT10aGlzLl9maWxlUGF0aH1vcGVuKGUpe2xldCB0PXRoaXMuZGF0YUZpbGVzW2VdO3JldHVybiB0P3QuZmQ6MH1jcmVhdGUoZSl7bGV0IHQ9dGhpcy5jdXJyZW50RmQrKztyZXR1cm4gdGhpcy5kYXRhRmlsZXNbZV09e2ZpbGU6bmV3IG8uRGF0YUZpbGUsZmQ6dGhpcy5jdXJyZW50RmQrK30sdGhpcy5kYXRhRmlsZU1hcFt0XT1lLHR9Y2xvc2VGaWxlKGUpe2xldCB0PXRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbZV1dO2lmKCF0KXJldHVybiBudWxsO2xldCByPXQuZmlsZS5yZWFkQWxsKCk7cmV0dXJuIDEhPT1lPyhkZWxldGUgdGhpcy5kYXRhRmlsZXNbdGhpcy5kYXRhRmlsZU1hcFtlXV0sZGVsZXRlIHRoaXMuZGF0YUZpbGVNYXBbZV0pOnQuZmlsZS5zZWVrKDAsIlNFVCIpLHJ9cmVhZChlLHQscil7bGV0IG89dGhpcy5kYXRhRmlsZXNbdGhpcy5kYXRhRmlsZU1hcFtlXV07aWYoIW8pcmV0dXJuLTE7bGV0IGk9by5maWxlLnJlYWQocik7cmV0dXJuIG51bGw9PT1pPy0xOihuLkhFQVBVOC5zZXQoaSx0KSxpLmJ5dGVMZW5ndGgpfXdyaXRlKGUsdCxyKXtsZXQgbz10aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW2VdXTtyZXR1cm4hIW8mJihvLmZpbGUud3JpdGUobi5IRUFQVTguc2xpY2UodCx0K3IpKSwhMCl9dGVsbChlKXtsZXQgdD10aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW2VdXTtyZXR1cm4gdD90LmZpbGUudGVsbCgpOi0xfXNlZWsoZSx0LHIpe2xldCBuPXRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbZV1dO3JldHVybiEhbiYmbi5maWxlLnNlZWsodCxyKX19fSxmdW5jdGlvbihlLHQscil7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLHQuRGF0YUZpbGU9Y2xhc3N7Y29uc3RydWN0b3IoZSl7dGhpcy5idWZmZXJzPVtdLHRoaXMucG9zPTAsdGhpcy5zaXplPTAsZSYmKHRoaXMuYnVmZmVycy5wdXNoKGUpLHRoaXMuc2l6ZT1lLmJ5dGVMZW5ndGgsdGhpcy5wb3M9MCl9cmVhZChlKXtpZih0aGlzLmZsYXR0ZW4oKSxlK3RoaXMucG9zPnRoaXMuc2l6ZSlyZXR1cm4gbnVsbDtsZXQgdD10aGlzLnBvcztyZXR1cm4gdGhpcy5wb3MrPWUsdGhpcy5idWZmZXJzWzBdLnNsaWNlKHQsdGhpcy5wb3MpfXJlYWRBbGwoKXtyZXR1cm4gdGhpcy5mbGF0dGVuKCksdGhpcy5idWZmZXJzWzBdfXdyaXRlKGUpe3JldHVybiB0aGlzLmJ1ZmZlcnMucHVzaChlKSx0aGlzLnNpemUrPWUuYnl0ZUxlbmd0aCx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RoLCEwfXRlbGwoKXtyZXR1cm4gdGhpcy5wb3N9c2VlayhlLHQpe2xldCByPXRoaXMucG9zO3JldHVybiJTRVQiPT09dD9yPWU6IkNVUiI9PT10P3IrPWU6cj10aGlzLnNpemUtZSwhKHI8MHx8cj50aGlzLnNpemV8fCh0aGlzLnBvcz1yLDApKX1mbGF0dGVuKCl7aWYodGhpcy5idWZmZXJzLmxlbmd0aDw9MSlyZXR1cm47bGV0IGU9bmV3IFVpbnQ4QXJyYXkodGhpcy5zaXplKSx0PTA7Zm9yKGxldCByIG9mIHRoaXMuYnVmZmVycyllLnNldChyLHQpLHQrPXIuYnl0ZUxlbmd0aDt0aGlzLmJ1ZmZlcnM9W2VdfX19LGZ1bmN0aW9uKGUsdCxyKXsoZnVuY3Rpb24oZSl7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO2NvbnN0IG89cigxMiksaT1yKDEzKSxhPXIoMCk7dC5GaWxlRXh0cmFjdG9yPWNsYXNzIGV4dGVuZHMgYS5FeHRyYWN0b3J7Y29uc3RydWN0b3IoZSx0LHIpe3N1cGVyKHIpLHRoaXMuX2ZpbGVQYXRoPWUsdGhpcy5maWxlTWFwPXt9LHRoaXMuX3RhcmdldD10fW9wZW4oZSl7bGV0IHQ9by5vcGVuU3luYyhlLCJyIik7cmV0dXJuIHRoaXMuZmlsZU1hcFt0XT17c2l6ZTpvLmZzdGF0U3luYyh0KS5zaXplLHBvczowLG5hbWU6ZX0sdH1jcmVhdGUoZSl7bGV0IHQ9aS5qb2luKHRoaXMuX3RhcmdldCxlKTtpLnBhcnNlKHQpLmRpci5zcGxpdCgiLyIpLnJlZHVjZSgoZSx0KT0+KGUrPXQrIi8iLG8uZXhpc3RzU3luYyhlKXx8by5ta2RpclN5bmMoZSksZSksIiIpO2xldCByPW8ub3BlblN5bmModCwidyIpO3JldHVybiB0aGlzLmZpbGVNYXBbcl09e3NpemU6MCxwb3M6MCxuYW1lOmV9LHJ9Y2xvc2VGaWxlKGUpe3JldHVybiBkZWxldGUgdGhpcy5maWxlTWFwW2VdLG8uY2xvc2VTeW5jKGUpLG51bGx9cmVhZCh0LHIsaSl7bGV0IGE9dGhpcy5maWxlTWFwW3RdLHM9bmV3IGUoaSksdT1vLnJlYWRTeW5jKHQscywwLGksYS5wb3MpO3JldHVybiBuLkhFQVBVOC5zZXQocyxyKSxhLnBvcys9dSx1fXdyaXRlKHQscixpKXtsZXQgYT10aGlzLmZpbGVNYXBbdF0scz1vLndyaXRlU3luYyh0LG5ldyBlKG4uSEVBUFU4LnN1YmFycmF5KHIscitpKSksMCxpKTtyZXR1cm4gYS5wb3MrPXMsYS5zaXplKz1zLHM9PT1pfXRlbGwoZSl7cmV0dXJuIHRoaXMuZmlsZU1hcFtlXS5wb3N9c2VlayhlLHQscil7bGV0IG49dGhpcy5maWxlTWFwW2VdLG89bi5wb3M7cmV0dXJuIlNFVCI9PT1yP289MDoiRU5EIj09PXImJihvPW4uc2l6ZSksISgobys9dCk8MHx8bz5uLnNpemV8fChuLnBvcz1vLDApKX19fSkuY2FsbCh0aGlzLHIoNykuQnVmZmVyKX0sZnVuY3Rpb24oZSx0LHIpeyhmdW5jdGlvbihlKXsKLyohCiAqIFRoZSBidWZmZXIgbW9kdWxlIGZyb20gbm9kZS5qcywgZm9yIHRoZSBicm93c2VyLgogKgogKiBAYXV0aG9yICAgRmVyb3NzIEFib3VraGFkaWplaCA8ZmVyb3NzQGZlcm9zcy5vcmc+IDxodHRwOi8vZmVyb3NzLm9yZz4KICogQGxpY2Vuc2UgIE1JVAogKi8KdmFyIG49cig5KSxvPXIoMTApLGk9cigxMSk7ZnVuY3Rpb24gYSgpe3JldHVybiB1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/MjE0NzQ4MzY0NzoxMDczNzQxODIzfWZ1bmN0aW9uIHMoZSx0KXtpZihhKCk8dCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW52YWxpZCB0eXBlZCBhcnJheSBsZW5ndGgiKTtyZXR1cm4gdS5UWVBFRF9BUlJBWV9TVVBQT1JUPyhlPW5ldyBVaW50OEFycmF5KHQpKS5fX3Byb3RvX189dS5wcm90b3R5cGU6KG51bGw9PT1lJiYoZT1uZXcgdSh0KSksZS5sZW5ndGg9dCksZX1mdW5jdGlvbiB1KGUsdCxyKXtpZighKHUuVFlQRURfQVJSQVlfU1VQUE9SVHx8dGhpcyBpbnN0YW5jZW9mIHUpKXJldHVybiBuZXcgdShlLHQscik7aWYoIm51bWJlciI9PXR5cGVvZiBlKXtpZigic3RyaW5nIj09dHlwZW9mIHQpdGhyb3cgbmV3IEVycm9yKCJJZiBlbmNvZGluZyBpcyBzcGVjaWZpZWQgdGhlbiB0aGUgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZyIpO3JldHVybiBmKHRoaXMsZSl9cmV0dXJuIGModGhpcyxlLHQscil9ZnVuY3Rpb24gYyhlLHQscixuKXtpZigibnVtYmVyIj09dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcignInZhbHVlIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlcicpO3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgQXJyYXlCdWZmZXImJnQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcj9mdW5jdGlvbihlLHQscixuKXtpZih0LmJ5dGVMZW5ndGgscjwwfHx0LmJ5dGVMZW5ndGg8cil0aHJvdyBuZXcgUmFuZ2VFcnJvcigiJ29mZnNldCcgaXMgb3V0IG9mIGJvdW5kcyIpO2lmKHQuYnl0ZUxlbmd0aDxyKyhufHwwKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiJ2xlbmd0aCcgaXMgb3V0IG9mIGJvdW5kcyIpO3JldHVybiB0PXZvaWQgMD09PXImJnZvaWQgMD09PW4/bmV3IFVpbnQ4QXJyYXkodCk6dm9pZCAwPT09bj9uZXcgVWludDhBcnJheSh0LHIpOm5ldyBVaW50OEFycmF5KHQscixuKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KGU9dCkuX19wcm90b19fPXUucHJvdG90eXBlOmU9ZChlLHQpLGV9KGUsdCxyLG4pOiJzdHJpbmciPT10eXBlb2YgdD9mdW5jdGlvbihlLHQscil7aWYoInN0cmluZyI9PXR5cGVvZiByJiYiIiE9PXJ8fChyPSJ1dGY4IiksIXUuaXNFbmNvZGluZyhyKSl0aHJvdyBuZXcgVHlwZUVycm9yKCciZW5jb2RpbmciIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTt2YXIgbj0wfHAodCxyKSxvPShlPXMoZSxuKSkud3JpdGUodCxyKTtyZXR1cm4gbyE9PW4mJihlPWUuc2xpY2UoMCxvKSksZX0oZSx0LHIpOmZ1bmN0aW9uKGUsdCl7aWYodS5pc0J1ZmZlcih0KSl7dmFyIHI9MHxoKHQubGVuZ3RoKTtyZXR1cm4gMD09PShlPXMoZSxyKSkubGVuZ3RofHx0LmNvcHkoZSwwLDAsciksZX1pZih0KXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIEFycmF5QnVmZmVyJiZ0LmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyfHwibGVuZ3RoImluIHQpcmV0dXJuIm51bWJlciIhPXR5cGVvZiB0Lmxlbmd0aHx8ZnVuY3Rpb24oZSl7cmV0dXJuIGUhPWV9KHQubGVuZ3RoKT9zKGUsMCk6ZChlLHQpO2lmKCJCdWZmZXIiPT09dC50eXBlJiZpKHQuZGF0YSkpcmV0dXJuIGQoZSx0LmRhdGEpfXRocm93IG5ldyBUeXBlRXJyb3IoIkZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBhcnJheS1saWtlIG9iamVjdC4iKX0oZSx0KX1mdW5jdGlvbiBsKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCcic2l6ZSIgYXJndW1lbnQgbXVzdCBiZSBhIG51bWJlcicpO2lmKGU8MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcignInNpemUiIGFyZ3VtZW50IG11c3Qgbm90IGJlIG5lZ2F0aXZlJyl9ZnVuY3Rpb24gZihlLHQpe2lmKGwodCksZT1zKGUsdDwwPzA6MHxoKHQpKSwhdS5UWVBFRF9BUlJBWV9TVVBQT1JUKWZvcih2YXIgcj0wO3I8dDsrK3IpZVtyXT0wO3JldHVybiBlfWZ1bmN0aW9uIGQoZSx0KXt2YXIgcj10Lmxlbmd0aDwwPzA6MHxoKHQubGVuZ3RoKTtlPXMoZSxyKTtmb3IodmFyIG49MDtuPHI7bis9MSllW25dPTI1NSZ0W25dO3JldHVybiBlfWZ1bmN0aW9uIGgoZSl7aWYoZT49YSgpKXRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4IithKCkudG9TdHJpbmcoMTYpKyIgYnl0ZXMiKTtyZXR1cm4gMHxlfWZ1bmN0aW9uIHAoZSx0KXtpZih1LmlzQnVmZmVyKGUpKXJldHVybiBlLmxlbmd0aDtpZigidW5kZWZpbmVkIiE9dHlwZW9mIEFycmF5QnVmZmVyJiYiZnVuY3Rpb24iPT10eXBlb2YgQXJyYXlCdWZmZXIuaXNWaWV3JiYoQXJyYXlCdWZmZXIuaXNWaWV3KGUpfHxlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKXJldHVybiBlLmJ5dGVMZW5ndGg7InN0cmluZyIhPXR5cGVvZiBlJiYoZT0iIitlKTt2YXIgcj1lLmxlbmd0aDtpZigwPT09cilyZXR1cm4gMDtmb3IodmFyIG49ITE7Oylzd2l0Y2godCl7Y2FzZSJhc2NpaSI6Y2FzZSJsYXRpbjEiOmNhc2UiYmluYXJ5IjpyZXR1cm4gcjtjYXNlInV0ZjgiOmNhc2UidXRmLTgiOmNhc2Ugdm9pZCAwOnJldHVybiBVKGUpLmxlbmd0aDtjYXNlInVjczIiOmNhc2UidWNzLTIiOmNhc2UidXRmMTZsZSI6Y2FzZSJ1dGYtMTZsZSI6cmV0dXJuIDIqcjtjYXNlImhleCI6cmV0dXJuIHI+Pj4xO2Nhc2UiYmFzZTY0IjpyZXR1cm4geihlKS5sZW5ndGg7ZGVmYXVsdDppZihuKXJldHVybiBVKGUpLmxlbmd0aDt0PSgiIit0KS50b0xvd2VyQ2FzZSgpLG49ITB9fWZ1bmN0aW9uIG0oZSx0LHIpe3ZhciBuPWVbdF07ZVt0XT1lW3JdLGVbcl09bn1mdW5jdGlvbiB5KGUsdCxyLG4sbyl7aWYoMD09PWUubGVuZ3RoKXJldHVybi0xO2lmKCJzdHJpbmciPT10eXBlb2Ygcj8obj1yLHI9MCk6cj4yMTQ3NDgzNjQ3P3I9MjE0NzQ4MzY0NzpyPC0yMTQ3NDgzNjQ4JiYocj0tMjE0NzQ4MzY0OCkscj0rcixpc05hTihyKSYmKHI9bz8wOmUubGVuZ3RoLTEpLHI8MCYmKHI9ZS5sZW5ndGgrcikscj49ZS5sZW5ndGgpe2lmKG8pcmV0dXJuLTE7cj1lLmxlbmd0aC0xfWVsc2UgaWYocjwwKXtpZighbylyZXR1cm4tMTtyPTB9aWYoInN0cmluZyI9PXR5cGVvZiB0JiYodD11LmZyb20odCxuKSksdS5pc0J1ZmZlcih0KSlyZXR1cm4gMD09PXQubGVuZ3RoPy0xOkUoZSx0LHIsbixvKTtpZigibnVtYmVyIj09dHlwZW9mIHQpcmV0dXJuIHQmPTI1NSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQmJiJmdW5jdGlvbiI9PXR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mP28/VWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGUsdCxyKTpVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGUsdCxyKTpFKGUsW3RdLHIsbixvKTt0aHJvdyBuZXcgVHlwZUVycm9yKCJ2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXIiKX1mdW5jdGlvbiBFKGUsdCxyLG4sbyl7dmFyIGksYT0xLHM9ZS5sZW5ndGgsdT10Lmxlbmd0aDtpZih2b2lkIDAhPT1uJiYoInVjczIiPT09KG49U3RyaW5nKG4pLnRvTG93ZXJDYXNlKCkpfHwidWNzLTIiPT09bnx8InV0ZjE2bGUiPT09bnx8InV0Zi0xNmxlIj09PW4pKXtpZihlLmxlbmd0aDwyfHx0Lmxlbmd0aDwyKXJldHVybi0xO2E9MixzLz0yLHUvPTIsci89Mn1mdW5jdGlvbiBjKGUsdCl7cmV0dXJuIDE9PT1hP2VbdF06ZS5yZWFkVUludDE2QkUodCphKX1pZihvKXt2YXIgbD0tMTtmb3IoaT1yO2k8cztpKyspaWYoYyhlLGkpPT09Yyh0LC0xPT09bD8wOmktbCkpe2lmKC0xPT09bCYmKGw9aSksaS1sKzE9PT11KXJldHVybiBsKmF9ZWxzZS0xIT09bCYmKGktPWktbCksbD0tMX1lbHNlIGZvcihyK3U+cyYmKHI9cy11KSxpPXI7aT49MDtpLS0pe2Zvcih2YXIgZj0hMCxkPTA7ZDx1O2QrKylpZihjKGUsaStkKSE9PWModCxkKSl7Zj0hMTticmVha31pZihmKXJldHVybiBpfXJldHVybi0xfWZ1bmN0aW9uIGcoZSx0LHIsbil7cj1OdW1iZXIocil8fDA7dmFyIG89ZS5sZW5ndGgtcjtuPyhuPU51bWJlcihuKSk+byYmKG49byk6bj1vO3ZhciBpPXQubGVuZ3RoO2lmKGklMiE9MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGhleCBzdHJpbmciKTtuPmkvMiYmKG49aS8yKTtmb3IodmFyIGE9MDthPG47KythKXt2YXIgcz1wYXJzZUludCh0LnN1YnN0cigyKmEsMiksMTYpO2lmKGlzTmFOKHMpKXJldHVybiBhO2VbcithXT1zfXJldHVybiBhfWZ1bmN0aW9uIHYoZSx0LHIsbil7cmV0dXJuICQoVSh0LGUubGVuZ3RoLXIpLGUscixuKX1mdW5jdGlvbiB3KGUsdCxyLG4pe3JldHVybiAkKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxyPTA7cjxlLmxlbmd0aDsrK3IpdC5wdXNoKDI1NSZlLmNoYXJDb2RlQXQocikpO3JldHVybiB0fSh0KSxlLHIsbil9ZnVuY3Rpb24gXyhlLHQscixuKXtyZXR1cm4gdyhlLHQscixuKX1mdW5jdGlvbiBiKGUsdCxyLG4pe3JldHVybiAkKHoodCksZSxyLG4pfWZ1bmN0aW9uIEEoZSx0LHIsbil7cmV0dXJuICQoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHIsbixvLGk9W10sYT0wO2E8ZS5sZW5ndGgmJiEoKHQtPTIpPDApOysrYSluPShyPWUuY2hhckNvZGVBdChhKSk+Pjgsbz1yJTI1NixpLnB1c2gobyksaS5wdXNoKG4pO3JldHVybiBpfSh0LGUubGVuZ3RoLXIpLGUscixuKX1mdW5jdGlvbiBUKGUsdCxyKXtyZXR1cm4gMD09PXQmJnI9PT1lLmxlbmd0aD9uLmZyb21CeXRlQXJyYXkoZSk6bi5mcm9tQnl0ZUFycmF5KGUuc2xpY2UodCxyKSl9ZnVuY3Rpb24gUyhlLHQscil7cj1NYXRoLm1pbihlLmxlbmd0aCxyKTtmb3IodmFyIG49W10sbz10O288cjspe3ZhciBpLGEscyx1LGM9ZVtvXSxsPW51bGwsZj1jPjIzOT80OmM+MjIzPzM6Yz4xOTE/MjoxO2lmKG8rZjw9cilzd2l0Y2goZil7Y2FzZSAxOmM8MTI4JiYobD1jKTticmVhaztjYXNlIDI6MTI4PT0oMTkyJihpPWVbbysxXSkpJiYodT0oMzEmYyk8PDZ8NjMmaSk+MTI3JiYobD11KTticmVhaztjYXNlIDM6aT1lW28rMV0sYT1lW28rMl0sMTI4PT0oMTkyJmkpJiYxMjg9PSgxOTImYSkmJih1PSgxNSZjKTw8MTJ8KDYzJmkpPDw2fDYzJmEpPjIwNDcmJih1PDU1Mjk2fHx1PjU3MzQzKSYmKGw9dSk7YnJlYWs7Y2FzZSA0Omk9ZVtvKzFdLGE9ZVtvKzJdLHM9ZVtvKzNdLDEyOD09KDE5MiZpKSYmMTI4PT0oMTkyJmEpJiYxMjg9PSgxOTImcykmJih1PSgxNSZjKTw8MTh8KDYzJmkpPDwxMnwoNjMmYSk8PDZ8NjMmcyk+NjU1MzUmJnU8MTExNDExMiYmKGw9dSl9bnVsbD09PWw/KGw9NjU1MzMsZj0xKTpsPjY1NTM1JiYobC09NjU1MzYsbi5wdXNoKGw+Pj4xMCYxMDIzfDU1Mjk2KSxsPTU2MzIwfDEwMjMmbCksbi5wdXNoKGwpLG8rPWZ9cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciB0PWUubGVuZ3RoO2lmKHQ8PWspcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLGUpO2Zvcih2YXIgcj0iIixuPTA7bjx0OylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZyxlLnNsaWNlKG4sbis9aykpO3JldHVybiByfShuKX10LkJ1ZmZlcj11LHQuU2xvd0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4rZSE9ZSYmKGU9MCksdS5hbGxvYygrZSl9LHQuSU5TUEVDVF9NQVhfQllURVM9NTAsdS5UWVBFRF9BUlJBWV9TVVBQT1JUPXZvaWQgMCE9PWUuVFlQRURfQVJSQVlfU1VQUE9SVD9lLlRZUEVEX0FSUkFZX1NVUFBPUlQ6ZnVuY3Rpb24oKXt0cnl7dmFyIGU9bmV3IFVpbnQ4QXJyYXkoMSk7cmV0dXJuIGUuX19wcm90b19fPXtfX3Byb3RvX186VWludDhBcnJheS5wcm90b3R5cGUsZm9vOmZ1bmN0aW9uKCl7cmV0dXJuIDQyfX0sNDI9PT1lLmZvbygpJiYiZnVuY3Rpb24iPT10eXBlb2YgZS5zdWJhcnJheSYmMD09PWUuc3ViYXJyYXkoMSwxKS5ieXRlTGVuZ3RofWNhdGNoKGUpe3JldHVybiExfX0oKSx0LmtNYXhMZW5ndGg9YSgpLHUucG9vbFNpemU9ODE5Mix1Ll9hdWdtZW50PWZ1bmN0aW9uKGUpe3JldHVybiBlLl9fcHJvdG9fXz11LnByb3RvdHlwZSxlfSx1LmZyb209ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBjKG51bGwsZSx0LHIpfSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQmJih1LnByb3RvdHlwZS5fX3Byb3RvX189VWludDhBcnJheS5wcm90b3R5cGUsdS5fX3Byb3RvX189VWludDhBcnJheSwidW5kZWZpbmVkIiE9dHlwZW9mIFN5bWJvbCYmU3ltYm9sLnNwZWNpZXMmJnVbU3ltYm9sLnNwZWNpZXNdPT09dSYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHUsU3ltYm9sLnNwZWNpZXMse3ZhbHVlOm51bGwsY29uZmlndXJhYmxlOiEwfSkpLHUuYWxsb2M9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBmdW5jdGlvbihlLHQscixuKXtyZXR1cm4gbCh0KSx0PD0wP3MoZSx0KTp2b2lkIDAhPT1yPyJzdHJpbmciPT10eXBlb2Ygbj9zKGUsdCkuZmlsbChyLG4pOnMoZSx0KS5maWxsKHIpOnMoZSx0KX0obnVsbCxlLHQscil9LHUuYWxsb2NVbnNhZmU9ZnVuY3Rpb24oZSl7cmV0dXJuIGYobnVsbCxlKX0sdS5hbGxvY1Vuc2FmZVNsb3c9ZnVuY3Rpb24oZSl7cmV0dXJuIGYobnVsbCxlKX0sdS5pc0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4hKG51bGw9PWV8fCFlLl9pc0J1ZmZlcil9LHUuY29tcGFyZT1mdW5jdGlvbihlLHQpe2lmKCF1LmlzQnVmZmVyKGUpfHwhdS5pc0J1ZmZlcih0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzIik7aWYoZT09PXQpcmV0dXJuIDA7Zm9yKHZhciByPWUubGVuZ3RoLG49dC5sZW5ndGgsbz0wLGk9TWF0aC5taW4ocixuKTtvPGk7KytvKWlmKGVbb10hPT10W29dKXtyPWVbb10sbj10W29dO2JyZWFrfXJldHVybiByPG4/LTE6bjxyPzE6MH0sdS5pc0VuY29kaW5nPWZ1bmN0aW9uKGUpe3N3aXRjaChTdHJpbmcoZSkudG9Mb3dlckNhc2UoKSl7Y2FzZSJoZXgiOmNhc2UidXRmOCI6Y2FzZSJ1dGYtOCI6Y2FzZSJhc2NpaSI6Y2FzZSJsYXRpbjEiOmNhc2UiYmluYXJ5IjpjYXNlImJhc2U2NCI6Y2FzZSJ1Y3MyIjpjYXNlInVjcy0yIjpjYXNlInV0ZjE2bGUiOmNhc2UidXRmLTE2bGUiOnJldHVybiEwO2RlZmF1bHQ6cmV0dXJuITF9fSx1LmNvbmNhdD1mdW5jdGlvbihlLHQpe2lmKCFpKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTtpZigwPT09ZS5sZW5ndGgpcmV0dXJuIHUuYWxsb2MoMCk7dmFyIHI7aWYodm9pZCAwPT09dClmb3IodD0wLHI9MDtyPGUubGVuZ3RoOysrcil0Kz1lW3JdLmxlbmd0aDt2YXIgbj11LmFsbG9jVW5zYWZlKHQpLG89MDtmb3Iocj0wO3I8ZS5sZW5ndGg7KytyKXt2YXIgYT1lW3JdO2lmKCF1LmlzQnVmZmVyKGEpKXRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTthLmNvcHkobixvKSxvKz1hLmxlbmd0aH1yZXR1cm4gbn0sdS5ieXRlTGVuZ3RoPXAsdS5wcm90b3R5cGUuX2lzQnVmZmVyPSEwLHUucHJvdG90eXBlLnN3YXAxNj1mdW5jdGlvbigpe3ZhciBlPXRoaXMubGVuZ3RoO2lmKGUlMiE9MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDE2LWJpdHMiKTtmb3IodmFyIHQ9MDt0PGU7dCs9MiltKHRoaXMsdCx0KzEpO3JldHVybiB0aGlzfSx1LnByb3RvdHlwZS5zd2FwMzI9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmxlbmd0aDtpZihlJTQhPTApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAzMi1iaXRzIik7Zm9yKHZhciB0PTA7dDxlO3QrPTQpbSh0aGlzLHQsdCszKSxtKHRoaXMsdCsxLHQrMik7cmV0dXJuIHRoaXN9LHUucHJvdG90eXBlLnN3YXA2ND1mdW5jdGlvbigpe3ZhciBlPXRoaXMubGVuZ3RoO2lmKGUlOCE9MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHMiKTtmb3IodmFyIHQ9MDt0PGU7dCs9OCltKHRoaXMsdCx0KzcpLG0odGhpcyx0KzEsdCs2KSxtKHRoaXMsdCsyLHQrNSksbSh0aGlzLHQrMyx0KzQpO3JldHVybiB0aGlzfSx1LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3ZhciBlPTB8dGhpcy5sZW5ndGg7cmV0dXJuIDA9PT1lPyIiOjA9PT1hcmd1bWVudHMubGVuZ3RoP1ModGhpcywwLGUpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj0hMTtpZigodm9pZCAwPT09dHx8dDwwKSYmKHQ9MCksdD50aGlzLmxlbmd0aClyZXR1cm4iIjtpZigodm9pZCAwPT09cnx8cj50aGlzLmxlbmd0aCkmJihyPXRoaXMubGVuZ3RoKSxyPD0wKXJldHVybiIiO2lmKChyPj4+PTApPD0odD4+Pj0wKSlyZXR1cm4iIjtmb3IoZXx8KGU9InV0ZjgiKTs7KXN3aXRjaChlKXtjYXNlImhleCI6cmV0dXJuIFIodGhpcyx0LHIpO2Nhc2UidXRmOCI6Y2FzZSJ1dGYtOCI6cmV0dXJuIFModGhpcyx0LHIpO2Nhc2UiYXNjaWkiOnJldHVybiBQKHRoaXMsdCxyKTtjYXNlImxhdGluMSI6Y2FzZSJiaW5hcnkiOnJldHVybiBEKHRoaXMsdCxyKTtjYXNlImJhc2U2NCI6cmV0dXJuIFQodGhpcyx0LHIpO2Nhc2UidWNzMiI6Y2FzZSJ1Y3MtMiI6Y2FzZSJ1dGYxNmxlIjpjYXNlInV0Zi0xNmxlIjpyZXR1cm4gTyh0aGlzLHQscik7ZGVmYXVsdDppZihuKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIrZSk7ZT0oZSsiIikudG9Mb3dlckNhc2UoKSxuPSEwfX0uYXBwbHkodGhpcyxhcmd1bWVudHMpfSx1LnByb3RvdHlwZS5lcXVhbHM9ZnVuY3Rpb24oZSl7aWYoIXUuaXNCdWZmZXIoZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciIpO3JldHVybiB0aGlzPT09ZXx8MD09PXUuY29tcGFyZSh0aGlzLGUpfSx1LnByb3RvdHlwZS5pbnNwZWN0PWZ1bmN0aW9uKCl7dmFyIGU9IiIscj10LklOU1BFQ1RfTUFYX0JZVEVTO3JldHVybiB0aGlzLmxlbmd0aD4wJiYoZT10aGlzLnRvU3RyaW5nKCJoZXgiLDAscikubWF0Y2goLy57Mn0vZykuam9pbigiICIpLHRoaXMubGVuZ3RoPnImJihlKz0iIC4uLiAiKSksIjxCdWZmZXIgIitlKyI+In0sdS5wcm90b3R5cGUuY29tcGFyZT1mdW5jdGlvbihlLHQscixuLG8pe2lmKCF1LmlzQnVmZmVyKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIiKTtpZih2b2lkIDA9PT10JiYodD0wKSx2b2lkIDA9PT1yJiYocj1lP2UubGVuZ3RoOjApLHZvaWQgMD09PW4mJihuPTApLHZvaWQgMD09PW8mJihvPXRoaXMubGVuZ3RoKSx0PDB8fHI+ZS5sZW5ndGh8fG48MHx8bz50aGlzLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigib3V0IG9mIHJhbmdlIGluZGV4Iik7aWYobj49byYmdD49cilyZXR1cm4gMDtpZihuPj1vKXJldHVybi0xO2lmKHQ+PXIpcmV0dXJuIDE7aWYodGhpcz09PWUpcmV0dXJuIDA7Zm9yKHZhciBpPShvPj4+PTApLShuPj4+PTApLGE9KHI+Pj49MCktKHQ+Pj49MCkscz1NYXRoLm1pbihpLGEpLGM9dGhpcy5zbGljZShuLG8pLGw9ZS5zbGljZSh0LHIpLGY9MDtmPHM7KytmKWlmKGNbZl0hPT1sW2ZdKXtpPWNbZl0sYT1sW2ZdO2JyZWFrfXJldHVybiBpPGE/LTE6YTxpPzE6MH0sdS5wcm90b3R5cGUuaW5jbHVkZXM9ZnVuY3Rpb24oZSx0LHIpe3JldHVybi0xIT09dGhpcy5pbmRleE9mKGUsdCxyKX0sdS5wcm90b3R5cGUuaW5kZXhPZj1mdW5jdGlvbihlLHQscil7cmV0dXJuIHkodGhpcyxlLHQsciwhMCl9LHUucHJvdG90eXBlLmxhc3RJbmRleE9mPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4geSh0aGlzLGUsdCxyLCExKX0sdS5wcm90b3R5cGUud3JpdGU9ZnVuY3Rpb24oZSx0LHIsbil7aWYodm9pZCAwPT09dCluPSJ1dGY4IixyPXRoaXMubGVuZ3RoLHQ9MDtlbHNlIGlmKHZvaWQgMD09PXImJiJzdHJpbmciPT10eXBlb2YgdCluPXQscj10aGlzLmxlbmd0aCx0PTA7ZWxzZXtpZighaXNGaW5pdGUodCkpdGhyb3cgbmV3IEVycm9yKCJCdWZmZXIud3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0WywgbGVuZ3RoXSkgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCIpO3R8PTAsaXNGaW5pdGUocik/KHJ8PTAsdm9pZCAwPT09biYmKG49InV0ZjgiKSk6KG49cixyPXZvaWQgMCl9dmFyIG89dGhpcy5sZW5ndGgtdDtpZigodm9pZCAwPT09cnx8cj5vKSYmKHI9byksZS5sZW5ndGg+MCYmKHI8MHx8dDwwKXx8dD50aGlzLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMiKTtufHwobj0idXRmOCIpO2Zvcih2YXIgaT0hMTs7KXN3aXRjaChuKXtjYXNlImhleCI6cmV0dXJuIGcodGhpcyxlLHQscik7Y2FzZSJ1dGY4IjpjYXNlInV0Zi04IjpyZXR1cm4gdih0aGlzLGUsdCxyKTtjYXNlImFzY2lpIjpyZXR1cm4gdyh0aGlzLGUsdCxyKTtjYXNlImxhdGluMSI6Y2FzZSJiaW5hcnkiOnJldHVybiBfKHRoaXMsZSx0LHIpO2Nhc2UiYmFzZTY0IjpyZXR1cm4gYih0aGlzLGUsdCxyKTtjYXNlInVjczIiOmNhc2UidWNzLTIiOmNhc2UidXRmMTZsZSI6Y2FzZSJ1dGYtMTZsZSI6cmV0dXJuIEEodGhpcyxlLHQscik7ZGVmYXVsdDppZihpKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIrbik7bj0oIiIrbikudG9Mb3dlckNhc2UoKSxpPSEwfX0sdS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJue3R5cGU6IkJ1ZmZlciIsZGF0YTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzLl9hcnJ8fHRoaXMsMCl9fTt2YXIgaz00MDk2O2Z1bmN0aW9uIFAoZSx0LHIpe3ZhciBuPSIiO3I9TWF0aC5taW4oZS5sZW5ndGgscik7Zm9yKHZhciBvPXQ7bzxyOysrbyluKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDEyNyZlW29dKTtyZXR1cm4gbn1mdW5jdGlvbiBEKGUsdCxyKXt2YXIgbj0iIjtyPU1hdGgubWluKGUubGVuZ3RoLHIpO2Zvcih2YXIgbz10O288cjsrK28pbis9U3RyaW5nLmZyb21DaGFyQ29kZShlW29dKTtyZXR1cm4gbn1mdW5jdGlvbiBSKGUsdCxyKXt2YXIgbj1lLmxlbmd0aDsoIXR8fHQ8MCkmJih0PTApLCghcnx8cjwwfHxyPm4pJiYocj1uKTtmb3IodmFyIG89IiIsaT10O2k8cjsrK2kpbys9aihlW2ldKTtyZXR1cm4gb31mdW5jdGlvbiBPKGUsdCxyKXtmb3IodmFyIG49ZS5zbGljZSh0LHIpLG89IiIsaT0wO2k8bi5sZW5ndGg7aSs9MilvKz1TdHJpbmcuZnJvbUNoYXJDb2RlKG5baV0rMjU2Km5baSsxXSk7cmV0dXJuIG99ZnVuY3Rpb24gQyhlLHQscil7aWYoZSUxIT0wfHxlPDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm9mZnNldCBpcyBub3QgdWludCIpO2lmKGUrdD5yKXRocm93IG5ldyBSYW5nZUVycm9yKCJUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoIil9ZnVuY3Rpb24gTihlLHQscixuLG8saSl7aWYoIXUuaXNCdWZmZXIoZSkpdGhyb3cgbmV3IFR5cGVFcnJvcignImJ1ZmZlciIgYXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciBpbnN0YW5jZScpO2lmKHQ+b3x8dDxpKXRocm93IG5ldyBSYW5nZUVycm9yKCcidmFsdWUiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKTtpZihyK24+ZS5sZW5ndGgpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIEYoZSx0LHIsbil7dDwwJiYodD02NTUzNSt0KzEpO2Zvcih2YXIgbz0wLGk9TWF0aC5taW4oZS5sZW5ndGgtciwyKTtvPGk7KytvKWVbcitvXT0odCYyNTU8PDgqKG4/bzoxLW8pKT4+PjgqKG4/bzoxLW8pfWZ1bmN0aW9uIE0oZSx0LHIsbil7dDwwJiYodD00Mjk0OTY3Mjk1K3QrMSk7Zm9yKHZhciBvPTAsaT1NYXRoLm1pbihlLmxlbmd0aC1yLDQpO288aTsrK28pZVtyK29dPXQ+Pj44KihuP286My1vKSYyNTV9ZnVuY3Rpb24gSShlLHQscixuLG8saSl7aWYocituPmUubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmRleCBvdXQgb2YgcmFuZ2UiKTtpZihyPDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIEIoZSx0LHIsbixpKXtyZXR1cm4gaXx8SShlLDAsciw0KSxvLndyaXRlKGUsdCxyLG4sMjMsNCkscis0fWZ1bmN0aW9uIEwoZSx0LHIsbixpKXtyZXR1cm4gaXx8SShlLDAsciw4KSxvLndyaXRlKGUsdCxyLG4sNTIsOCkscis4fXUucHJvdG90eXBlLnNsaWNlPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbj10aGlzLmxlbmd0aDtpZigoZT1+fmUpPDA/KGUrPW4pPDAmJihlPTApOmU+biYmKGU9biksKHQ9dm9pZCAwPT09dD9uOn5+dCk8MD8odCs9bik8MCYmKHQ9MCk6dD5uJiYodD1uKSx0PGUmJih0PWUpLHUuVFlQRURfQVJSQVlfU1VQUE9SVCkocj10aGlzLnN1YmFycmF5KGUsdCkpLl9fcHJvdG9fXz11LnByb3RvdHlwZTtlbHNle3ZhciBvPXQtZTtyPW5ldyB1KG8sdm9pZCAwKTtmb3IodmFyIGk9MDtpPG87KytpKXJbaV09dGhpc1tpK2VdfXJldHVybiByfSx1LnByb3RvdHlwZS5yZWFkVUludExFPWZ1bmN0aW9uKGUsdCxyKXtlfD0wLHR8PTAscnx8QyhlLHQsdGhpcy5sZW5ndGgpO2Zvcih2YXIgbj10aGlzW2VdLG89MSxpPTA7KytpPHQmJihvKj0yNTYpOyluKz10aGlzW2UraV0qbztyZXR1cm4gbn0sdS5wcm90b3R5cGUucmVhZFVJbnRCRT1mdW5jdGlvbihlLHQscil7ZXw9MCx0fD0wLHJ8fEMoZSx0LHRoaXMubGVuZ3RoKTtmb3IodmFyIG49dGhpc1tlKy0tdF0sbz0xO3Q+MCYmKG8qPTI1Nik7KW4rPXRoaXNbZSstLXRdKm87cmV0dXJuIG59LHUucHJvdG90eXBlLnJlYWRVSW50OD1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsMSx0aGlzLmxlbmd0aCksdGhpc1tlXX0sdS5wcm90b3R5cGUucmVhZFVJbnQxNkxFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwyLHRoaXMubGVuZ3RoKSx0aGlzW2VdfHRoaXNbZSsxXTw8OH0sdS5wcm90b3R5cGUucmVhZFVJbnQxNkJFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwyLHRoaXMubGVuZ3RoKSx0aGlzW2VdPDw4fHRoaXNbZSsxXX0sdS5wcm90b3R5cGUucmVhZFVJbnQzMkxFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSw0LHRoaXMubGVuZ3RoKSwodGhpc1tlXXx0aGlzW2UrMV08PDh8dGhpc1tlKzJdPDwxNikrMTY3NzcyMTYqdGhpc1tlKzNdfSx1LnByb3RvdHlwZS5yZWFkVUludDMyQkU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8QyhlLDQsdGhpcy5sZW5ndGgpLDE2Nzc3MjE2KnRoaXNbZV0rKHRoaXNbZSsxXTw8MTZ8dGhpc1tlKzJdPDw4fHRoaXNbZSszXSl9LHUucHJvdG90eXBlLnJlYWRJbnRMRT1mdW5jdGlvbihlLHQscil7ZXw9MCx0fD0wLHJ8fEMoZSx0LHRoaXMubGVuZ3RoKTtmb3IodmFyIG49dGhpc1tlXSxvPTEsaT0wOysraTx0JiYobyo9MjU2KTspbis9dGhpc1tlK2ldKm87cmV0dXJuIG4+PShvKj0xMjgpJiYobi09TWF0aC5wb3coMiw4KnQpKSxufSx1LnByb3RvdHlwZS5yZWFkSW50QkU9ZnVuY3Rpb24oZSx0LHIpe2V8PTAsdHw9MCxyfHxDKGUsdCx0aGlzLmxlbmd0aCk7Zm9yKHZhciBuPXQsbz0xLGk9dGhpc1tlKy0tbl07bj4wJiYobyo9MjU2KTspaSs9dGhpc1tlKy0tbl0qbztyZXR1cm4gaT49KG8qPTEyOCkmJihpLT1NYXRoLnBvdygyLDgqdCkpLGl9LHUucHJvdG90eXBlLnJlYWRJbnQ4PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwxLHRoaXMubGVuZ3RoKSwxMjgmdGhpc1tlXT8tMSooMjU1LXRoaXNbZV0rMSk6dGhpc1tlXX0sdS5wcm90b3R5cGUucmVhZEludDE2TEU9ZnVuY3Rpb24oZSx0KXt0fHxDKGUsMix0aGlzLmxlbmd0aCk7dmFyIHI9dGhpc1tlXXx0aGlzW2UrMV08PDg7cmV0dXJuIDMyNzY4JnI/NDI5NDkwMTc2MHxyOnJ9LHUucHJvdG90eXBlLnJlYWRJbnQxNkJFPWZ1bmN0aW9uKGUsdCl7dHx8QyhlLDIsdGhpcy5sZW5ndGgpO3ZhciByPXRoaXNbZSsxXXx0aGlzW2VdPDw4O3JldHVybiAzMjc2OCZyPzQyOTQ5MDE3NjB8cjpyfSx1LnByb3RvdHlwZS5yZWFkSW50MzJMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksdGhpc1tlXXx0aGlzW2UrMV08PDh8dGhpc1tlKzJdPDwxNnx0aGlzW2UrM108PDI0fSx1LnByb3RvdHlwZS5yZWFkSW50MzJCRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksdGhpc1tlXTw8MjR8dGhpc1tlKzFdPDwxNnx0aGlzW2UrMl08PDh8dGhpc1tlKzNdfSx1LnByb3RvdHlwZS5yZWFkRmxvYXRMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksby5yZWFkKHRoaXMsZSwhMCwyMyw0KX0sdS5wcm90b3R5cGUucmVhZEZsb2F0QkU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8QyhlLDQsdGhpcy5sZW5ndGgpLG8ucmVhZCh0aGlzLGUsITEsMjMsNCl9LHUucHJvdG90eXBlLnJlYWREb3VibGVMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsOCx0aGlzLmxlbmd0aCksby5yZWFkKHRoaXMsZSwhMCw1Miw4KX0sdS5wcm90b3R5cGUucmVhZERvdWJsZUJFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSw4LHRoaXMubGVuZ3RoKSxvLnJlYWQodGhpcyxlLCExLDUyLDgpfSx1LnByb3RvdHlwZS53cml0ZVVJbnRMRT1mdW5jdGlvbihlLHQscixuKXtlPStlLHR8PTAscnw9MCxufHxOKHRoaXMsZSx0LHIsTWF0aC5wb3coMiw4KnIpLTEsMCk7dmFyIG89MSxpPTA7Zm9yKHRoaXNbdF09MjU1JmU7KytpPHImJihvKj0yNTYpOyl0aGlzW3QraV09ZS9vJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZVVJbnRCRT1mdW5jdGlvbihlLHQscixuKXtlPStlLHR8PTAscnw9MCxufHxOKHRoaXMsZSx0LHIsTWF0aC5wb3coMiw4KnIpLTEsMCk7dmFyIG89ci0xLGk9MTtmb3IodGhpc1t0K29dPTI1NSZlOy0tbz49MCYmKGkqPTI1Nik7KXRoaXNbdCtvXT1lL2kmMjU1O3JldHVybiB0K3J9LHUucHJvdG90eXBlLndyaXRlVUludDg9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwxLDI1NSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlR8fChlPU1hdGguZmxvb3IoZSkpLHRoaXNbdF09MjU1JmUsdCsxfSx1LnByb3RvdHlwZS53cml0ZVVJbnQxNkxFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsMiw2NTUzNSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09MjU1JmUsdGhpc1t0KzFdPWU+Pj44KTpGKHRoaXMsZSx0LCEwKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlVUludDE2QkU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwyLDY1NTM1LDApLHUuVFlQRURfQVJSQVlfU1VQUE9SVD8odGhpc1t0XT1lPj4+OCx0aGlzW3QrMV09MjU1JmUpOkYodGhpcyxlLHQsITEpLHQrMn0sdS5wcm90b3R5cGUud3JpdGVVSW50MzJMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDQsNDI5NDk2NzI5NSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdCszXT1lPj4+MjQsdGhpc1t0KzJdPWU+Pj4xNix0aGlzW3QrMV09ZT4+PjgsdGhpc1t0XT0yNTUmZSk6TSh0aGlzLGUsdCwhMCksdCs0fSx1LnByb3RvdHlwZS53cml0ZVVJbnQzMkJFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsNCw0Mjk0OTY3Mjk1LDApLHUuVFlQRURfQVJSQVlfU1VQUE9SVD8odGhpc1t0XT1lPj4+MjQsdGhpc1t0KzFdPWU+Pj4xNix0aGlzW3QrMl09ZT4+PjgsdGhpc1t0KzNdPTI1NSZlKTpNKHRoaXMsZSx0LCExKSx0KzR9LHUucHJvdG90eXBlLndyaXRlSW50TEU9ZnVuY3Rpb24oZSx0LHIsbil7aWYoZT0rZSx0fD0wLCFuKXt2YXIgbz1NYXRoLnBvdygyLDgqci0xKTtOKHRoaXMsZSx0LHIsby0xLC1vKX12YXIgaT0wLGE9MSxzPTA7Zm9yKHRoaXNbdF09MjU1JmU7KytpPHImJihhKj0yNTYpOyllPDAmJjA9PT1zJiYwIT09dGhpc1t0K2ktMV0mJihzPTEpLHRoaXNbdCtpXT0oZS9hPj4wKS1zJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZUludEJFPWZ1bmN0aW9uKGUsdCxyLG4pe2lmKGU9K2UsdHw9MCwhbil7dmFyIG89TWF0aC5wb3coMiw4KnItMSk7Tih0aGlzLGUsdCxyLG8tMSwtbyl9dmFyIGk9ci0xLGE9MSxzPTA7Zm9yKHRoaXNbdCtpXT0yNTUmZTstLWk+PTAmJihhKj0yNTYpOyllPDAmJjA9PT1zJiYwIT09dGhpc1t0K2krMV0mJihzPTEpLHRoaXNbdCtpXT0oZS9hPj4wKS1zJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZUludDg9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwxLDEyNywtMTI4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlR8fChlPU1hdGguZmxvb3IoZSkpLGU8MCYmKGU9MjU1K2UrMSksdGhpc1t0XT0yNTUmZSx0KzF9LHUucHJvdG90eXBlLndyaXRlSW50MTZMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDIsMzI3NjcsLTMyNzY4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09MjU1JmUsdGhpc1t0KzFdPWU+Pj44KTpGKHRoaXMsZSx0LCEwKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlSW50MTZCRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDIsMzI3NjcsLTMyNzY4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09ZT4+PjgsdGhpc1t0KzFdPTI1NSZlKTpGKHRoaXMsZSx0LCExKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlSW50MzJMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDQsMjE0NzQ4MzY0NywtMjE0NzQ4MzY0OCksdS5UWVBFRF9BUlJBWV9TVVBQT1JUPyh0aGlzW3RdPTI1NSZlLHRoaXNbdCsxXT1lPj4+OCx0aGlzW3QrMl09ZT4+PjE2LHRoaXNbdCszXT1lPj4+MjQpOk0odGhpcyxlLHQsITApLHQrNH0sdS5wcm90b3R5cGUud3JpdGVJbnQzMkJFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsNCwyMTQ3NDgzNjQ3LC0yMTQ3NDgzNjQ4KSxlPDAmJihlPTQyOTQ5NjcyOTUrZSsxKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09ZT4+PjI0LHRoaXNbdCsxXT1lPj4+MTYsdGhpc1t0KzJdPWU+Pj44LHRoaXNbdCszXT0yNTUmZSk6TSh0aGlzLGUsdCwhMSksdCs0fSx1LnByb3RvdHlwZS53cml0ZUZsb2F0TEU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBCKHRoaXMsZSx0LCEwLHIpfSx1LnByb3RvdHlwZS53cml0ZUZsb2F0QkU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBCKHRoaXMsZSx0LCExLHIpfSx1LnByb3RvdHlwZS53cml0ZURvdWJsZUxFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gTCh0aGlzLGUsdCwhMCxyKX0sdS5wcm90b3R5cGUud3JpdGVEb3VibGVCRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIEwodGhpcyxlLHQsITEscil9LHUucHJvdG90eXBlLmNvcHk9ZnVuY3Rpb24oZSx0LHIsbil7aWYocnx8KHI9MCksbnx8MD09PW58fChuPXRoaXMubGVuZ3RoKSx0Pj1lLmxlbmd0aCYmKHQ9ZS5sZW5ndGgpLHR8fCh0PTApLG4+MCYmbjxyJiYobj1yKSxuPT09cilyZXR1cm4gMDtpZigwPT09ZS5sZW5ndGh8fDA9PT10aGlzLmxlbmd0aClyZXR1cm4gMDtpZih0PDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoInRhcmdldFN0YXJ0IG91dCBvZiBib3VuZHMiKTtpZihyPDB8fHI+PXRoaXMubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VTdGFydCBvdXQgb2YgYm91bmRzIik7aWYobjwwKXRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VFbmQgb3V0IG9mIGJvdW5kcyIpO24+dGhpcy5sZW5ndGgmJihuPXRoaXMubGVuZ3RoKSxlLmxlbmd0aC10PG4tciYmKG49ZS5sZW5ndGgtdCtyKTt2YXIgbyxpPW4tcjtpZih0aGlzPT09ZSYmcjx0JiZ0PG4pZm9yKG89aS0xO28+PTA7LS1vKWVbbyt0XT10aGlzW28rcl07ZWxzZSBpZihpPDFlM3x8IXUuVFlQRURfQVJSQVlfU1VQUE9SVClmb3Iobz0wO288aTsrK28pZVtvK3RdPXRoaXNbbytyXTtlbHNlIFVpbnQ4QXJyYXkucHJvdG90eXBlLnNldC5jYWxsKGUsdGhpcy5zdWJhcnJheShyLHIraSksdCk7cmV0dXJuIGl9LHUucHJvdG90eXBlLmZpbGw9ZnVuY3Rpb24oZSx0LHIsbil7aWYoInN0cmluZyI9PXR5cGVvZiBlKXtpZigic3RyaW5nIj09dHlwZW9mIHQ/KG49dCx0PTAscj10aGlzLmxlbmd0aCk6InN0cmluZyI9PXR5cGVvZiByJiYobj1yLHI9dGhpcy5sZW5ndGgpLDE9PT1lLmxlbmd0aCl7dmFyIG89ZS5jaGFyQ29kZUF0KDApO288MjU2JiYoZT1vKX1pZih2b2lkIDAhPT1uJiYic3RyaW5nIiE9dHlwZW9mIG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZyIpO2lmKCJzdHJpbmciPT10eXBlb2YgbiYmIXUuaXNFbmNvZGluZyhuKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGVuY29kaW5nOiAiK24pfWVsc2UibnVtYmVyIj09dHlwZW9mIGUmJihlJj0yNTUpO2lmKHQ8MHx8dGhpcy5sZW5ndGg8dHx8dGhpcy5sZW5ndGg8cil0aHJvdyBuZXcgUmFuZ2VFcnJvcigiT3V0IG9mIHJhbmdlIGluZGV4Iik7aWYocjw9dClyZXR1cm4gdGhpczt2YXIgaTtpZih0Pj4+PTAscj12b2lkIDA9PT1yP3RoaXMubGVuZ3RoOnI+Pj4wLGV8fChlPTApLCJudW1iZXIiPT10eXBlb2YgZSlmb3IoaT10O2k8cjsrK2kpdGhpc1tpXT1lO2Vsc2V7dmFyIGE9dS5pc0J1ZmZlcihlKT9lOlUobmV3IHUoZSxuKS50b1N0cmluZygpKSxzPWEubGVuZ3RoO2ZvcihpPTA7aTxyLXQ7KytpKXRoaXNbaSt0XT1hW2klc119cmV0dXJuIHRoaXN9O3ZhciB4PS9bXitcLzAtOUEtWmEtei1fXS9nO2Z1bmN0aW9uIGooZSl7cmV0dXJuIGU8MTY/IjAiK2UudG9TdHJpbmcoMTYpOmUudG9TdHJpbmcoMTYpfWZ1bmN0aW9uIFUoZSx0KXt2YXIgcjt0PXR8fDEvMDtmb3IodmFyIG49ZS5sZW5ndGgsbz1udWxsLGk9W10sYT0wO2E8bjsrK2Epe2lmKChyPWUuY2hhckNvZGVBdChhKSk+NTUyOTUmJnI8NTczNDQpe2lmKCFvKXtpZihyPjU2MzE5KXsodC09Myk+LTEmJmkucHVzaCgyMzksMTkxLDE4OSk7Y29udGludWV9aWYoYSsxPT09bil7KHQtPTMpPi0xJiZpLnB1c2goMjM5LDE5MSwxODkpO2NvbnRpbnVlfW89cjtjb250aW51ZX1pZihyPDU2MzIwKXsodC09Myk+LTEmJmkucHVzaCgyMzksMTkxLDE4OSksbz1yO2NvbnRpbnVlfXI9NjU1MzYrKG8tNTUyOTY8PDEwfHItNTYzMjApfWVsc2UgbyYmKHQtPTMpPi0xJiZpLnB1c2goMjM5LDE5MSwxODkpO2lmKG89bnVsbCxyPDEyOCl7aWYoKHQtPTEpPDApYnJlYWs7aS5wdXNoKHIpfWVsc2UgaWYocjwyMDQ4KXtpZigodC09Mik8MClicmVhaztpLnB1c2gocj4+NnwxOTIsNjMmcnwxMjgpfWVsc2UgaWYocjw2NTUzNil7aWYoKHQtPTMpPDApYnJlYWs7aS5wdXNoKHI+PjEyfDIyNCxyPj42JjYzfDEyOCw2MyZyfDEyOCl9ZWxzZXtpZighKHI8MTExNDExMikpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvZGUgcG9pbnQiKTtpZigodC09NCk8MClicmVhaztpLnB1c2gocj4+MTh8MjQwLHI+PjEyJjYzfDEyOCxyPj42JjYzfDEyOCw2MyZyfDEyOCl9fXJldHVybiBpfWZ1bmN0aW9uIHooZSl7cmV0dXJuIG4udG9CeXRlQXJyYXkoZnVuY3Rpb24oZSl7aWYoKGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGUudHJpbT9lLnRyaW0oKTplLnJlcGxhY2UoL15ccyt8XHMrJC9nLCIiKX0oZSkucmVwbGFjZSh4LCIiKSkubGVuZ3RoPDIpcmV0dXJuIiI7Zm9yKDtlLmxlbmd0aCU0IT0wOyllKz0iPSI7cmV0dXJuIGV9KGUpKX1mdW5jdGlvbiAkKGUsdCxyLG4pe2Zvcih2YXIgbz0wO288biYmIShvK3I+PXQubGVuZ3RofHxvPj1lLmxlbmd0aCk7KytvKXRbbytyXT1lW29dO3JldHVybiBvfX0pLmNhbGwodGhpcyxyKDgpKX0sZnVuY3Rpb24oZSx0KXt2YXIgcjtyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCk7dHJ5e3I9cnx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKXx8KDAsZXZhbCkoInRoaXMiKX1jYXRjaChlKXsib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmKHI9d2luZG93KX1lLmV4cG9ydHM9cn0sZnVuY3Rpb24oZSx0LHIpe3QuYnl0ZUxlbmd0aD1mdW5jdGlvbihlKXt2YXIgdD1jKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIDMqKHIrbikvNC1ufSx0LnRvQnl0ZUFycmF5PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxyPWMoZSksbj1yWzBdLGE9clsxXSxzPW5ldyBpKGZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gMyoodCtyKS80LXJ9KDAsbixhKSksdT0wLGw9YT4wP24tNDpuLGY9MDtmPGw7Zis9NCl0PW9bZS5jaGFyQ29kZUF0KGYpXTw8MTh8b1tlLmNoYXJDb2RlQXQoZisxKV08PDEyfG9bZS5jaGFyQ29kZUF0KGYrMildPDw2fG9bZS5jaGFyQ29kZUF0KGYrMyldLHNbdSsrXT10Pj4xNiYyNTUsc1t1KytdPXQ+PjgmMjU1LHNbdSsrXT0yNTUmdDtyZXR1cm4gMj09PWEmJih0PW9bZS5jaGFyQ29kZUF0KGYpXTw8MnxvW2UuY2hhckNvZGVBdChmKzEpXT4+NCxzW3UrK109MjU1JnQpLDE9PT1hJiYodD1vW2UuY2hhckNvZGVBdChmKV08PDEwfG9bZS5jaGFyQ29kZUF0KGYrMSldPDw0fG9bZS5jaGFyQ29kZUF0KGYrMildPj4yLHNbdSsrXT10Pj44JjI1NSxzW3UrK109MjU1JnQpLHN9LHQuZnJvbUJ5dGVBcnJheT1mdW5jdGlvbihlKXtmb3IodmFyIHQscj1lLmxlbmd0aCxvPXIlMyxpPVtdLGE9MCxzPXItbzthPHM7YSs9MTYzODMpaS5wdXNoKGYoZSxhLGErMTYzODM+cz9zOmErMTYzODMpKTtyZXR1cm4gMT09PW8/KHQ9ZVtyLTFdLGkucHVzaChuW3Q+PjJdK25bdDw8NCY2M10rIj09IikpOjI9PT1vJiYodD0oZVtyLTJdPDw4KStlW3ItMV0saS5wdXNoKG5bdD4+MTBdK25bdD4+NCY2M10rblt0PDwyJjYzXSsiPSIpKSxpLmpvaW4oIiIpfTtmb3IodmFyIG49W10sbz1bXSxpPSJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhBcnJheT9VaW50OEFycmF5OkFycmF5LGE9IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iLHM9MCx1PWEubGVuZ3RoO3M8dTsrK3MpbltzXT1hW3NdLG9bYS5jaGFyQ29kZUF0KHMpXT1zO2Z1bmN0aW9uIGMoZSl7dmFyIHQ9ZS5sZW5ndGg7aWYodCU0PjApdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0Iik7dmFyIHI9ZS5pbmRleE9mKCI9Iik7cmV0dXJuLTE9PT1yJiYocj10KSxbcixyPT09dD8wOjQtciU0XX1mdW5jdGlvbiBsKGUpe3JldHVybiBuW2U+PjE4JjYzXStuW2U+PjEyJjYzXStuW2U+PjYmNjNdK25bNjMmZV19ZnVuY3Rpb24gZihlLHQscil7Zm9yKHZhciBuLG89W10saT10O2k8cjtpKz0zKW49KGVbaV08PDE2JjE2NzExNjgwKSsoZVtpKzFdPDw4JjY1MjgwKSsoMjU1JmVbaSsyXSksby5wdXNoKGwobikpO3JldHVybiBvLmpvaW4oIiIpfW9bIi0iLmNoYXJDb2RlQXQoMCldPTYyLG9bIl8iLmNoYXJDb2RlQXQoMCldPTYzfSxmdW5jdGlvbihlLHQpe3QucmVhZD1mdW5jdGlvbihlLHQscixuLG8pe3ZhciBpLGEscz04Km8tbi0xLHU9KDE8PHMpLTEsYz11Pj4xLGw9LTcsZj1yP28tMTowLGQ9cj8tMToxLGg9ZVt0K2ZdO2ZvcihmKz1kLGk9aCYoMTw8LWwpLTEsaD4+PS1sLGwrPXM7bD4wO2k9MjU2KmkrZVt0K2ZdLGYrPWQsbC09OCk7Zm9yKGE9aSYoMTw8LWwpLTEsaT4+PS1sLGwrPW47bD4wO2E9MjU2KmErZVt0K2ZdLGYrPWQsbC09OCk7aWYoMD09PWkpaT0xLWM7ZWxzZXtpZihpPT09dSlyZXR1cm4gYT9OYU46MS8wKihoPy0xOjEpO2ErPU1hdGgucG93KDIsbiksaS09Y31yZXR1cm4oaD8tMToxKSphKk1hdGgucG93KDIsaS1uKX0sdC53cml0ZT1mdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGEscyx1LGM9OCppLW8tMSxsPSgxPDxjKS0xLGY9bD4+MSxkPTIzPT09bz9NYXRoLnBvdygyLC0yNCktTWF0aC5wb3coMiwtNzcpOjAsaD1uPzA6aS0xLHA9bj8xOi0xLG09dDwwfHwwPT09dCYmMS90PDA/MTowO2Zvcih0PU1hdGguYWJzKHQpLGlzTmFOKHQpfHx0PT09MS8wPyhzPWlzTmFOKHQpPzE6MCxhPWwpOihhPU1hdGguZmxvb3IoTWF0aC5sb2codCkvTWF0aC5MTjIpLHQqKHU9TWF0aC5wb3coMiwtYSkpPDEmJihhLS0sdSo9MiksKHQrPWErZj49MT9kL3U6ZCpNYXRoLnBvdygyLDEtZikpKnU+PTImJihhKyssdS89MiksYStmPj1sPyhzPTAsYT1sKTphK2Y+PTE/KHM9KHQqdS0xKSpNYXRoLnBvdygyLG8pLGErPWYpOihzPXQqTWF0aC5wb3coMixmLTEpKk1hdGgucG93KDIsbyksYT0wKSk7bz49ODtlW3IraF09MjU1JnMsaCs9cCxzLz0yNTYsby09OCk7Zm9yKGE9YTw8b3xzLGMrPW87Yz4wO2VbcitoXT0yNTUmYSxoKz1wLGEvPTI1NixjLT04KTtlW3IraC1wXXw9MTI4Km19fSxmdW5jdGlvbihlLHQpe3ZhciByPXt9LnRvU3RyaW5nO2UuZXhwb3J0cz1BcnJheS5pc0FycmF5fHxmdW5jdGlvbihlKXtyZXR1cm4iW29iamVjdCBBcnJheV0iPT1yLmNhbGwoZSl9fSxmdW5jdGlvbih0LHIpe3QuZXhwb3J0cz1lfSxmdW5jdGlvbihlLHQscil7KGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHIoZSx0KXtmb3IodmFyIHI9MCxuPWUubGVuZ3RoLTE7bj49MDtuLS0pe3ZhciBvPWVbbl07Ii4iPT09bz9lLnNwbGljZShuLDEpOiIuLiI9PT1vPyhlLnNwbGljZShuLDEpLHIrKyk6ciYmKGUuc3BsaWNlKG4sMSksci0tKX1pZih0KWZvcig7ci0tO3IpZS51bnNoaWZ0KCIuLiIpO3JldHVybiBlfXZhciBuPS9eKFwvP3wpKFtcc1xTXSo/KSgoPzpcLnsxLDJ9fFteXC9dKz98KShcLlteLlwvXSp8KSkoPzpbXC9dKikkLyxvPWZ1bmN0aW9uKGUpe3JldHVybiBuLmV4ZWMoZSkuc2xpY2UoMSl9O2Z1bmN0aW9uIGkoZSx0KXtpZihlLmZpbHRlcilyZXR1cm4gZS5maWx0ZXIodCk7Zm9yKHZhciByPVtdLG49MDtuPGUubGVuZ3RoO24rKyl0KGVbbl0sbixlKSYmci5wdXNoKGVbbl0pO3JldHVybiByfXQucmVzb2x2ZT1mdW5jdGlvbigpe2Zvcih2YXIgdD0iIixuPSExLG89YXJndW1lbnRzLmxlbmd0aC0xO28+PS0xJiYhbjtvLS0pe3ZhciBhPW8+PTA/YXJndW1lbnRzW29dOmUuY3dkKCk7aWYoInN0cmluZyIhPXR5cGVvZiBhKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLnJlc29sdmUgbXVzdCBiZSBzdHJpbmdzIik7YSYmKHQ9YSsiLyIrdCxuPSIvIj09PWEuY2hhckF0KDApKX1yZXR1cm4obj8iLyI6IiIpKyh0PXIoaSh0LnNwbGl0KCIvIiksKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhbikuam9pbigiLyIpKXx8Ii4ifSx0Lm5vcm1hbGl6ZT1mdW5jdGlvbihlKXt2YXIgbj10LmlzQWJzb2x1dGUoZSksbz0iLyI9PT1hKGUsLTEpO3JldHVybihlPXIoaShlLnNwbGl0KCIvIiksKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhbikuam9pbigiLyIpKXx8bnx8KGU9Ii4iKSxlJiZvJiYoZSs9Ii8iKSwobj8iLyI6IiIpK2V9LHQuaXNBYnNvbHV0ZT1mdW5jdGlvbihlKXtyZXR1cm4iLyI9PT1lLmNoYXJBdCgwKX0sdC5qb2luPWZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO3JldHVybiB0Lm5vcm1hbGl6ZShpKGUsKGZ1bmN0aW9uKGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLmpvaW4gbXVzdCBiZSBzdHJpbmdzIik7cmV0dXJuIGV9KSkuam9pbigiLyIpKX0sdC5yZWxhdGl2ZT1mdW5jdGlvbihlLHIpe2Z1bmN0aW9uIG4oZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aCYmIiI9PT1lW3RdO3QrKyk7Zm9yKHZhciByPWUubGVuZ3RoLTE7cj49MCYmIiI9PT1lW3JdO3ItLSk7cmV0dXJuIHQ+cj9bXTplLnNsaWNlKHQsci10KzEpfWU9dC5yZXNvbHZlKGUpLnN1YnN0cigxKSxyPXQucmVzb2x2ZShyKS5zdWJzdHIoMSk7Zm9yKHZhciBvPW4oZS5zcGxpdCgiLyIpKSxpPW4oci5zcGxpdCgiLyIpKSxhPU1hdGgubWluKG8ubGVuZ3RoLGkubGVuZ3RoKSxzPWEsdT0wO3U8YTt1KyspaWYob1t1XSE9PWlbdV0pe3M9dTticmVha312YXIgYz1bXTtmb3IodT1zO3U8by5sZW5ndGg7dSsrKWMucHVzaCgiLi4iKTtyZXR1cm4oYz1jLmNvbmNhdChpLnNsaWNlKHMpKSkuam9pbigiLyIpfSx0LnNlcD0iLyIsdC5kZWxpbWl0ZXI9IjoiLHQuZGlybmFtZT1mdW5jdGlvbihlKXt2YXIgdD1vKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIHJ8fG4/KG4mJihuPW4uc3Vic3RyKDAsbi5sZW5ndGgtMSkpLHIrbik6Ii4ifSx0LmJhc2VuYW1lPWZ1bmN0aW9uKGUsdCl7dmFyIHI9byhlKVsyXTtyZXR1cm4gdCYmci5zdWJzdHIoLTEqdC5sZW5ndGgpPT09dCYmKHI9ci5zdWJzdHIoMCxyLmxlbmd0aC10Lmxlbmd0aCkpLHJ9LHQuZXh0bmFtZT1mdW5jdGlvbihlKXtyZXR1cm4gbyhlKVszXX07dmFyIGE9ImIiPT09ImFiIi5zdWJzdHIoLTEpP2Z1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZS5zdWJzdHIodCxyKX06ZnVuY3Rpb24oZSx0LHIpe3JldHVybiB0PDAmJih0PWUubGVuZ3RoK3QpLGUuc3Vic3RyKHQscil9fSkuY2FsbCh0aGlzLHIoMTQpKX0sZnVuY3Rpb24oZSx0KXt2YXIgcixuLG89ZS5leHBvcnRzPXt9O2Z1bmN0aW9uIGkoKXt0aHJvdyBuZXcgRXJyb3IoInNldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBhKCl7dGhyb3cgbmV3IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBzKGUpe2lmKHI9PT1zZXRUaW1lb3V0KXJldHVybiBzZXRUaW1lb3V0KGUsMCk7aWYoKHI9PT1pfHwhcikmJnNldFRpbWVvdXQpcmV0dXJuIHI9c2V0VGltZW91dCxzZXRUaW1lb3V0KGUsMCk7dHJ5e3JldHVybiByKGUsMCl9Y2F0Y2godCl7dHJ5e3JldHVybiByLmNhbGwobnVsbCxlLDApfWNhdGNoKHQpe3JldHVybiByLmNhbGwodGhpcyxlLDApfX19IWZ1bmN0aW9uKCl7dHJ5e3I9ImZ1bmN0aW9uIj09dHlwZW9mIHNldFRpbWVvdXQ/c2V0VGltZW91dDppfWNhdGNoKGUpe3I9aX10cnl7bj0iZnVuY3Rpb24iPT10eXBlb2YgY2xlYXJUaW1lb3V0P2NsZWFyVGltZW91dDphfWNhdGNoKGUpe249YX19KCk7dmFyIHUsYz1bXSxsPSExLGY9LTE7ZnVuY3Rpb24gZCgpe2wmJnUmJihsPSExLHUubGVuZ3RoP2M9dS5jb25jYXQoYyk6Zj0tMSxjLmxlbmd0aCYmaCgpKX1mdW5jdGlvbiBoKCl7aWYoIWwpe3ZhciBlPXMoZCk7bD0hMDtmb3IodmFyIHQ9Yy5sZW5ndGg7dDspe2Zvcih1PWMsYz1bXTsrK2Y8dDspdSYmdVtmXS5ydW4oKTtmPS0xLHQ9Yy5sZW5ndGh9dT1udWxsLGw9ITEsZnVuY3Rpb24oZSl7aWYobj09PWNsZWFyVGltZW91dClyZXR1cm4gY2xlYXJUaW1lb3V0KGUpO2lmKChuPT09YXx8IW4pJiZjbGVhclRpbWVvdXQpcmV0dXJuIG49Y2xlYXJUaW1lb3V0LGNsZWFyVGltZW91dChlKTt0cnl7bihlKX1jYXRjaCh0KXt0cnl7cmV0dXJuIG4uY2FsbChudWxsLGUpfWNhdGNoKHQpe3JldHVybiBuLmNhbGwodGhpcyxlKX19fShlKX19ZnVuY3Rpb24gcChlLHQpe3RoaXMuZnVuPWUsdGhpcy5hcnJheT10fWZ1bmN0aW9uIG0oKXt9by5uZXh0VGljaz1mdW5jdGlvbihlKXt2YXIgdD1uZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aC0xKTtpZihhcmd1bWVudHMubGVuZ3RoPjEpZm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyl0W3ItMV09YXJndW1lbnRzW3JdO2MucHVzaChuZXcgcChlLHQpKSwxIT09Yy5sZW5ndGh8fGx8fHMoaCl9LHAucHJvdG90eXBlLnJ1bj1mdW5jdGlvbigpe3RoaXMuZnVuLmFwcGx5KG51bGwsdGhpcy5hcnJheSl9LG8udGl0bGU9ImJyb3dzZXIiLG8uYnJvd3Nlcj0hMCxvLmVudj17fSxvLmFyZ3Y9W10sby52ZXJzaW9uPSIiLG8udmVyc2lvbnM9e30sby5vbj1tLG8uYWRkTGlzdGVuZXI9bSxvLm9uY2U9bSxvLm9mZj1tLG8ucmVtb3ZlTGlzdGVuZXI9bSxvLnJlbW92ZUFsbExpc3RlbmVycz1tLG8uZW1pdD1tLG8ucHJlcGVuZExpc3RlbmVyPW0sby5wcmVwZW5kT25jZUxpc3RlbmVyPW0sby5saXN0ZW5lcnM9ZnVuY3Rpb24oZSl7cmV0dXJuW119LG8uYmluZGluZz1mdW5jdGlvbihlKXt0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIil9LG8uY3dkPWZ1bmN0aW9uKCl7cmV0dXJuIi8ifSxvLmNoZGlyPWZ1bmN0aW9uKGUpe3Rocm93IG5ldyBFcnJvcigicHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkIil9LG8udW1hc2s9ZnVuY3Rpb24oKXtyZXR1cm4gMH19XSl9KHQuZnMpO2NvbnN0IHI9ZS51bnBhY2tCcmlkZ2U7bGV0IG47dmFyIG89ZnVuY3Rpb24oZSl7Y29uc3QgdD17fTtjcmVkZW50aWFscz0ib21pdCI7dmFyIG4sbz12b2lkIDAhPT10P3Q6e30saT1yLkV4dCxhPXtvcGVuOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC5vcGVuLmFwcGx5KGkuY3VycmVudCxhcmd1bWVudHMpfSxjbG9zZTpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQuY2xvc2UuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9LHJlYWQ6ZnVuY3Rpb24oKXtyZXR1cm4gaS5jdXJyZW50LnJlYWQuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9LHdyaXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC53cml0ZS5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sdGVsbDpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQudGVsbC5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sc2VlazpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQuc2Vlay5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sY3JlYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC5jcmVhdGUuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9fSxzPXt9O2ZvcihuIGluIG8pby5oYXNPd25Qcm9wZXJ0eShuKSYmKHNbbl09b1tuXSk7by5hcmd1bWVudHM9W10sby50aGlzUHJvZ3JhbT0iLi90aGlzLnByb2dyYW0iLG8ucXVpdD1mdW5jdGlvbihlLHQpe3Rocm93IHR9LG8ucHJlUnVuPVtdLG8ucG9zdFJ1bj1bXTt2YXIgdT0hMSxjPSExLGw9ITE7aWYoby5FTlZJUk9OTUVOVCl7aWYoIldFQiI9PT1vLkVOVklST05NRU5UKXU9ITA7ZWxzZSBpZigiV09SS0VSIj09PW8uRU5WSVJPTk1FTlQpYz0hMDtlbHNlIGlmKCJOT0RFIj09PW8uRU5WSVJPTk1FTlQpbD0hMDtlbHNlIGlmKCJTSEVMTCIhPT1vLkVOVklST05NRU5UKXRocm93IG5ldyBFcnJvcigiTW9kdWxlWydFTlZJUk9OTUVOVCddIHZhbHVlIGlzIG5vdCB2YWxpZC4gbXVzdCBiZSBvbmUgb2Y6IFdFQnxXT1JLRVJ8Tk9ERXxTSEVMTC4iKX1lbHNlIHU9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3csYz0iZnVuY3Rpb24iPT10eXBlb2YgaW1wb3J0U2NyaXB0cyxsPSJvYmplY3QiPT10eXBlb2YgcHJvY2VzcyYmImZ1bmN0aW9uIj09dHlwZW9mIHJlcXVpcmUmJiF1JiYhYztmb3IobiBpbih1fHxjKSYmKG8ucmVhZD1mdW5jdGlvbihlKXt2YXIgdD1uZXcgWE1MSHR0cFJlcXVlc3Q7cmV0dXJuIHQub3BlbigiR0VUIixlLCExKSx0LnNlbmQobnVsbCksdC5yZXNwb25zZVRleHR9LGMmJihvLnJlYWRCaW5hcnk9ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IFhNTEh0dHBSZXF1ZXN0O3JldHVybiB0Lm9wZW4oIkdFVCIsZSwhMSksdC5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIix0LnNlbmQobnVsbCksbmV3IFVpbnQ4QXJyYXkodC5yZXNwb25zZSl9KSxvLnJlYWRBc3luYz1mdW5jdGlvbihlLHQscil7dmFyIG49bmV3IFhNTEh0dHBSZXF1ZXN0O24ub3BlbigiR0VUIixlLCEwKSxuLnJlc3BvbnNlVHlwZT0iYXJyYXlidWZmZXIiLG4ub25sb2FkPWZ1bmN0aW9uKCl7MjAwPT1uLnN0YXR1c3x8MD09bi5zdGF0dXMmJm4ucmVzcG9uc2U/dChuLnJlc3BvbnNlKTpyKCl9LG4ub25lcnJvcj1yLG4uc2VuZChudWxsKX0sby5zZXRXaW5kb3dUaXRsZT1mdW5jdGlvbihlKXtkb2N1bWVudC50aXRsZT1lfSksby5wcmludD0idW5kZWZpbmVkIiE9dHlwZW9mIGNvbnNvbGU/Y29uc29sZS5sb2cuYmluZChjb25zb2xlKToidW5kZWZpbmVkIiE9dHlwZW9mIHByaW50P3ByaW50Om51bGwsby5wcmludEVycj0idW5kZWZpbmVkIiE9dHlwZW9mIHByaW50RXJyP3ByaW50RXJyOiJ1bmRlZmluZWQiIT10eXBlb2YgY29uc29sZSYmY29uc29sZS53YXJuLmJpbmQoY29uc29sZSl8fG8ucHJpbnQsby5wcmludD1vLnByaW50LG8ucHJpbnRFcnI9by5wcmludEVycixzKXMuaGFzT3duUHJvcGVydHkobikmJihvW25dPXNbbl0pO3M9dm9pZCAwO2Z1bmN0aW9uIGYoZSl7eSgheCk7dmFyIHQ9TDtyZXR1cm4gTD1MK2UrMTUmLTE2LHR9ZnVuY3Rpb24gZChlKXt5KCQpO3ZhciB0PUZbJD4+Ml0scj10K2UrMTUmLTE2O2lmKChGWyQ+PjJdPXIscj49cSkmJiFIKCkpcmV0dXJuIEZbJD4+Ml09dCwwO3JldHVybiB0fWZ1bmN0aW9uIGgoZSx0KXtyZXR1cm4gdHx8KHQ9MTYpLGU9TWF0aC5jZWlsKGUvdCkqdH1mdW5jdGlvbiBwKGUpe3N3aXRjaChlKXtjYXNlImkxIjpjYXNlImk4IjpyZXR1cm4gMTtjYXNlImkxNiI6cmV0dXJuIDI7Y2FzZSJpMzIiOnJldHVybiA0O2Nhc2UiaTY0IjpyZXR1cm4gODtjYXNlImZsb2F0IjpyZXR1cm4gNDtjYXNlImRvdWJsZSI6cmV0dXJuIDg7ZGVmYXVsdDppZigiKiI9PT1lW2UubGVuZ3RoLTFdKXJldHVybiA0O2lmKCJpIj09PWVbMF0pe3ZhciB0PXBhcnNlSW50KGUuc3Vic3RyKDEpKTtyZXR1cm4geSh0JTg9PTApLHQvOH1yZXR1cm4gMH19bmV3IEFycmF5KDApO3ZhciBtPTA7ZnVuY3Rpb24geShlLHQpe2V8fHJyKCJBc3NlcnRpb24gZmFpbGVkOiAiK3QpfWZ1bmN0aW9uIEUoZSx0LHIsbil7c3dpdGNoKCIqIj09PShyPXJ8fCJpOCIpLmNoYXJBdChyLmxlbmd0aC0xKSYmKHI9ImkzMiIpLHIpe2Nhc2UiaTEiOmNhc2UiaTgiOlJbZT4+MF09dDticmVhaztjYXNlImkxNiI6Q1tlPj4xXT10O2JyZWFrO2Nhc2UiaTMyIjpGW2U+PjJdPXQ7YnJlYWs7Y2FzZSJpNjQiOnRlbXBJNjQ9W3Q+Pj4wLCh0ZW1wRG91YmxlPXQsK25lKHRlbXBEb3VibGUpPj0xP3RlbXBEb3VibGU+MD8oMHxhZSgraWUodGVtcERvdWJsZS80Mjk0OTY3Mjk2KSw0Mjk0OTY3Mjk1KSk+Pj4wOn5+K29lKCh0ZW1wRG91YmxlLSsofn50ZW1wRG91YmxlPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRltlPj4yXT10ZW1wSTY0WzBdLEZbZSs0Pj4yXT10ZW1wSTY0WzFdO2JyZWFrO2Nhc2UiZmxvYXQiOklbZT4+Ml09dDticmVhaztjYXNlImRvdWJsZSI6QltlPj4zXT10O2JyZWFrO2RlZmF1bHQ6cnIoImludmFsaWQgdHlwZSBmb3Igc2V0VmFsdWU6ICIrcil9fWZ1bmN0aW9uIGcoZSx0LHIsbil7dmFyIG8saTsibnVtYmVyIj09dHlwZW9mIGU/KG89ITAsaT1lKToobz0hMSxpPWUubGVuZ3RoKTt2YXIgYSxzPSJzdHJpbmciPT10eXBlb2YgdD90Om51bGw7aWYoYT00PT1yP246WyJmdW5jdGlvbiI9PXR5cGVvZiBKdD9KdDpmLFF0LGYsZF1bdm9pZCAwPT09cj8yOnJdKE1hdGgubWF4KGkscz8xOnQubGVuZ3RoKSksbyl7dmFyIHU7Zm9yKG49YSx5KDA9PSgzJmEpKSx1PWErKC00JmkpO248dTtuKz00KUZbbj4+Ml09MDtmb3IodT1hK2k7bjx1OylSW24rKz4+MF09MDtyZXR1cm4gYX1pZigiaTgiPT09cylyZXR1cm4gZS5zdWJhcnJheXx8ZS5zbGljZT9PLnNldChlLGEpOk8uc2V0KG5ldyBVaW50OEFycmF5KGUpLGEpLGE7Zm9yKHZhciBjLGwsaCxtPTA7bTxpOyl7dmFyIGc9ZVttXTswIT09KGM9c3x8dFttXSk/KCJpNjQiPT1jJiYoYz0iaTMyIiksRShhK20sZyxjKSxoIT09YyYmKGw9cChjKSxoPWMpLG0rPWwpOm0rK31yZXR1cm4gYX1mdW5jdGlvbiB2KGUsdCl7aWYoMD09PXR8fCFlKXJldHVybiIiO2Zvcih2YXIgcixuPTAsbz0wO258PXI9T1tlK28+PjBdLCgwIT1yfHx0KSYmKG8rKywhdHx8byE9dCk7KTt0fHwodD1vKTt2YXIgaT0iIjtpZihuPDEyOCl7Zm9yKHZhciBhO3Q+MDspYT1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZyxPLnN1YmFycmF5KGUsZStNYXRoLm1pbih0LDEwMjQpKSksaT1pP2krYTphLGUrPTEwMjQsdC09MTAyNDtyZXR1cm4gaX1yZXR1cm4gYihlKX12YXIgdz0idW5kZWZpbmVkIiE9dHlwZW9mIFRleHREZWNvZGVyP25ldyBUZXh0RGVjb2RlcigidXRmOCIpOnZvaWQgMDtmdW5jdGlvbiBfKGUsdCl7Zm9yKHZhciByPXQ7ZVtyXTspKytyO2lmKHItdD4xNiYmZS5zdWJhcnJheSYmdylyZXR1cm4gdy5kZWNvZGUoZS5zdWJhcnJheSh0LHIpKTtmb3IodmFyIG4sbyxpLGEscyx1PSIiOzspe2lmKCEobj1lW3QrK10pKXJldHVybiB1O2lmKDEyOCZuKWlmKG89NjMmZVt0KytdLDE5MiE9KDIyNCZuKSlpZihpPTYzJmVbdCsrXSwyMjQ9PSgyNDAmbik/bj0oMTUmbik8PDEyfG88PDZ8aTooYT02MyZlW3QrK10sMjQwPT0oMjQ4Jm4pP249KDcmbik8PDE4fG88PDEyfGk8PDZ8YToocz02MyZlW3QrK10sbj0yNDg9PSgyNTImbik/KDMmbik8PDI0fG88PDE4fGk8PDEyfGE8PDZ8czooMSZuKTw8MzB8bzw8MjR8aTw8MTh8YTw8MTJ8czw8Nnw2MyZlW3QrK10pKSxuPDY1NTM2KXUrPVN0cmluZy5mcm9tQ2hhckNvZGUobik7ZWxzZXt2YXIgYz1uLTY1NTM2O3UrPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8Yz4+MTAsNTYzMjB8MTAyMyZjKX1lbHNlIHUrPVN0cmluZy5mcm9tQ2hhckNvZGUoKDMxJm4pPDw2fG8pO2Vsc2UgdSs9U3RyaW5nLmZyb21DaGFyQ29kZShuKX19ZnVuY3Rpb24gYihlKXtyZXR1cm4gXyhPLGUpfWZ1bmN0aW9uIEEoZSx0LHIsbil7aWYoIShuPjApKXJldHVybiAwO2Zvcih2YXIgbz1yLGk9cituLTEsYT0wO2E8ZS5sZW5ndGg7KythKXt2YXIgcz1lLmNoYXJDb2RlQXQoYSk7aWYocz49NTUyOTYmJnM8PTU3MzQzJiYocz02NTUzNisoKDEwMjMmcyk8PDEwKXwxMDIzJmUuY2hhckNvZGVBdCgrK2EpKSxzPD0xMjcpe2lmKHI+PWkpYnJlYWs7dFtyKytdPXN9ZWxzZSBpZihzPD0yMDQ3KXtpZihyKzE+PWkpYnJlYWs7dFtyKytdPTE5MnxzPj42LHRbcisrXT0xMjh8NjMmc31lbHNlIGlmKHM8PTY1NTM1KXtpZihyKzI+PWkpYnJlYWs7dFtyKytdPTIyNHxzPj4xMix0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2UgaWYoczw9MjA5NzE1MSl7aWYociszPj1pKWJyZWFrO3RbcisrXT0yNDB8cz4+MTgsdFtyKytdPTEyOHxzPj4xMiY2Myx0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2UgaWYoczw9NjcxMDg4NjMpe2lmKHIrND49aSlicmVhazt0W3IrK109MjQ4fHM+PjI0LHRbcisrXT0xMjh8cz4+MTgmNjMsdFtyKytdPTEyOHxzPj4xMiY2Myx0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2V7aWYocis1Pj1pKWJyZWFrO3RbcisrXT0yNTJ8cz4+MzAsdFtyKytdPTEyOHxzPj4yNCY2Myx0W3IrK109MTI4fHM+PjE4JjYzLHRbcisrXT0xMjh8cz4+MTImNjMsdFtyKytdPTEyOHxzPj42JjYzLHRbcisrXT0xMjh8NjMmc319cmV0dXJuIHRbcl09MCxyLW99ZnVuY3Rpb24gVChlLHQscil7cmV0dXJuIEEoZSxPLHQscil9ZnVuY3Rpb24gUyhlKXtmb3IodmFyIHQ9MCxyPTA7cjxlLmxlbmd0aDsrK3Ipe3ZhciBuPWUuY2hhckNvZGVBdChyKTtuPj01NTI5NiYmbjw9NTczNDMmJihuPTY1NTM2KygoMTAyMyZuKTw8MTApfDEwMjMmZS5jaGFyQ29kZUF0KCsrcikpLG48PTEyNz8rK3Q6dCs9bjw9MjA0Nz8yOm48PTY1NTM1PzM6bjw9MjA5NzE1MT80Om48PTY3MTA4ODYzPzU6Nn1yZXR1cm4gdH0idW5kZWZpbmVkIiE9dHlwZW9mIFRleHREZWNvZGVyJiZuZXcgVGV4dERlY29kZXIoInV0Zi0xNmxlIik7ZnVuY3Rpb24gayhlKXtmb3IodmFyIHQ9MCxyPSIiOzspe3ZhciBuPUZbZSs0KnQ+PjJdO2lmKDA9PW4pcmV0dXJuIHI7aWYoKyt0LG4+PTY1NTM2KXt2YXIgbz1uLTY1NTM2O3IrPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8bz4+MTAsNTYzMjB8MTAyMyZvKX1lbHNlIHIrPVN0cmluZy5mcm9tQ2hhckNvZGUobil9fWZ1bmN0aW9uIFAoKXt2YXIgZT1mdW5jdGlvbigpe3ZhciBlPW5ldyBFcnJvcjtpZighZS5zdGFjayl7dHJ5e3Rocm93IG5ldyBFcnJvcigwKX1jYXRjaCh0KXtlPXR9aWYoIWUuc3RhY2spcmV0dXJuIihubyBzdGFjayB0cmFjZSBhdmFpbGFibGUpIn1yZXR1cm4gZS5zdGFjay50b1N0cmluZygpfSgpO3JldHVybiBvLmV4dHJhU3RhY2tUcmFjZSYmKGUrPSJcbiIrby5leHRyYVN0YWNrVHJhY2UoKSksZS5yZXBsYWNlKC9fX1pbXHdcZF9dKy9nLChmdW5jdGlvbihlKXtyZXR1cm4gZT09ZT9lOmUrIiBbIitlKyJdIn0pKX12YXIgRCxSLE8sQyxOLEYsTSxJLEIsTCx4LGosVSx6LCQ7ZnVuY3Rpb24gVyhlLHQpe3JldHVybiBlJXQ+MCYmKGUrPXQtZSV0KSxlfWZ1bmN0aW9uIFkoZSl7by5idWZmZXI9RD1lfWZ1bmN0aW9uIFYoKXtvLkhFQVA4PVI9bmV3IEludDhBcnJheShEKSxvLkhFQVAxNj1DPW5ldyBJbnQxNkFycmF5KEQpLG8uSEVBUDMyPUY9bmV3IEludDMyQXJyYXkoRCksby5IRUFQVTg9Tz1uZXcgVWludDhBcnJheShEKSxvLkhFQVBVMTY9Tj1uZXcgVWludDE2QXJyYXkoRCksby5IRUFQVTMyPU09bmV3IFVpbnQzMkFycmF5KEQpLG8uSEVBUEYzMj1JPW5ldyBGbG9hdDMyQXJyYXkoRCksby5IRUFQRjY0PUI9bmV3IEZsb2F0NjRBcnJheShEKX1mdW5jdGlvbiBIKCl7dmFyIGU9by51c2luZ1dhc20/NjU1MzY6MTY3NzcyMTYsdD0yMTQ3NDgzNjQ4LWU7aWYoRlskPj4yXT50KXJldHVybiExO3ZhciByPXE7Zm9yKHE9TWF0aC5tYXgocSwxNjc3NzIxNik7cTxGWyQ+PjJdOylxPXE8PTUzNjg3MDkxMj9XKDIqcSxlKTpNYXRoLm1pbihXKCgzKnErMjE0NzQ4MzY0OCkvNCxlKSx0KTt2YXIgbj1vLnJlYWxsb2NCdWZmZXIocSk7cmV0dXJuIG4mJm4uYnl0ZUxlbmd0aD09cT8oWShuKSxWKCksITApOihxPXIsITEpfUw9VT0kPTAseD0hMSxvLnJlYWxsb2NCdWZmZXJ8fChvLnJlYWxsb2NCdWZmZXI9ZnVuY3Rpb24oZSl7dmFyIHQ7dHJ5e2lmKEFycmF5QnVmZmVyLnRyYW5zZmVyKXQ9QXJyYXlCdWZmZXIudHJhbnNmZXIoRCxlKTtlbHNle3ZhciByPVI7dD1uZXcgQXJyYXlCdWZmZXIoZSksbmV3IEludDhBcnJheSh0KS5zZXQocil9fWNhdGNoKGUpe3JldHVybiExfXJldHVybiEhWHQodCkmJnR9KTt0cnl7RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKEFycmF5QnVmZmVyLnByb3RvdHlwZSwiYnl0ZUxlbmd0aCIpLmdldCkobmV3IEFycmF5QnVmZmVyKDQpKX1jYXRjaChlKXsoZnVuY3Rpb24oZSl7cmV0dXJuIGUuYnl0ZUxlbmd0aH0pfXZhciBHPW8uVE9UQUxfU1RBQ0t8fDUyNDI4ODAscT1vLlRPVEFMX01FTU9SWXx8MTY3NzcyMTY7aWYocTxHJiZvLnByaW50RXJyKCJUT1RBTF9NRU1PUlkgc2hvdWxkIGJlIGxhcmdlciB0aGFuIFRPVEFMX1NUQUNLLCB3YXMgIitxKyIhIChUT1RBTF9TVEFDSz0iK0crIikiKSxvLmJ1ZmZlcj9EPW8uYnVmZmVyOigib2JqZWN0Ij09dHlwZW9mIFdlYkFzc2VtYmx5JiYiZnVuY3Rpb24iPT10eXBlb2YgV2ViQXNzZW1ibHkuTWVtb3J5PyhvLndhc21NZW1vcnk9bmV3IFdlYkFzc2VtYmx5Lk1lbW9yeSh7aW5pdGlhbDpxLzY1NTM2fSksRD1vLndhc21NZW1vcnkuYnVmZmVyKTpEPW5ldyBBcnJheUJ1ZmZlcihxKSxvLmJ1ZmZlcj1EKSxWKCksRlswXT0xNjY4NTA5MDI5LENbMV09MjU0NTksMTE1IT09T1syXXx8OTkhPT1PWzNdKXRocm93IlJ1bnRpbWUgZXJyb3I6IGV4cGVjdGVkIHRoZSBzeXN0ZW0gdG8gYmUgbGl0dGxlLWVuZGlhbiEiO2Z1bmN0aW9uIFgoZSl7Zm9yKDtlLmxlbmd0aD4wOyl7dmFyIHQ9ZS5zaGlmdCgpO2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0KXt2YXIgcj10LmZ1bmM7Im51bWJlciI9PXR5cGVvZiByP3ZvaWQgMD09PXQuYXJnP28uZHluQ2FsbF92KHIpOm8uZHluQ2FsbF92aShyLHQuYXJnKTpyKHZvaWQgMD09PXQuYXJnP251bGw6dC5hcmcpfWVsc2UgdCgpfX12YXIgSz1bXSxKPVtdLFo9W10sUT1bXSxlZT1bXSx0ZT0hMTtmdW5jdGlvbiByZShlLHQscil7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDsrK24pUlt0Kys+PjBdPWUuY2hhckNvZGVBdChuKTtyfHwoUlt0Pj4wXT0wKX12YXIgbmU9TWF0aC5hYnMsb2U9TWF0aC5jZWlsLGllPU1hdGguZmxvb3IsYWU9TWF0aC5taW4sc2U9MCx1ZT1udWxsO2Z1bmN0aW9uIGNlKGUpe3NlKyssby5tb25pdG9yUnVuRGVwZW5kZW5jaWVzJiZvLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMoc2UpfWZ1bmN0aW9uIGxlKGUpe2lmKHNlLS0sby5tb25pdG9yUnVuRGVwZW5kZW5jaWVzJiZvLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMoc2UpLDA9PXNlJiZ1ZSl7dmFyIHQ9dWU7dWU9bnVsbCx0KCl9fW8ucHJlbG9hZGVkSW1hZ2VzPXt9LG8ucHJlbG9hZGVkQXVkaW9zPXt9O2Z1bmN0aW9uIGZlKGUpe3JldHVybiBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGg/ZS5zdGFydHNXaXRoKCJkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsIik6MD09PWUuaW5kZXhPZigiZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCIpfSFmdW5jdGlvbigpe3ZhciB0PSJ1bnBhY2sud2FzdCIscj0idW5wYWNrLnRlbXAuYXNtLmpzIjsiZnVuY3Rpb24iPT10eXBlb2Ygby5sb2NhdGVGaWxlJiYoZmUodCl8fCh0PW8ubG9jYXRlRmlsZSh0KSksZmUoZSl8fChlPW8ubG9jYXRlRmlsZShlKSksZmUocil8fChyPW8ubG9jYXRlRmlsZShyKSkpO3ZhciBuPXtnbG9iYWw6bnVsbCxlbnY6bnVsbCxhc20yd2FzbTp7ImY2NC1yZW0iOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUldH0sZGVidWdnZXI6ZnVuY3Rpb24oKXt9fSxwYXJlbnQ6b30saT1udWxsO2Z1bmN0aW9uIGEoKXt0cnl7aWYoby53YXNtQmluYXJ5KXJldHVybiBuZXcgVWludDhBcnJheShvLndhc21CaW5hcnkpO2lmKG8ucmVhZEJpbmFyeSlyZXR1cm4gby5yZWFkQmluYXJ5KGUpO3Rocm93Im9uIHRoZSB3ZWIsIHdlIG5lZWQgdGhlIHdhc20gYmluYXJ5IHRvIGJlIHByZWxvYWRlZCBhbmQgc2V0IG9uIE1vZHVsZVsnd2FzbUJpbmFyeSddLiBlbWNjLnB5IHdpbGwgZG8gdGhhdCBmb3IgeW91IHdoZW4gZ2VuZXJhdGluZyBIVE1MIChidXQgbm90IEpTKSJ9Y2F0Y2goZSl7cnIoZSl9fWZ1bmN0aW9uIHModCxyLHMpe2lmKCJvYmplY3QiIT10eXBlb2YgV2ViQXNzZW1ibHkpcmV0dXJuIG8ucHJpbnRFcnIoIm5vIG5hdGl2ZSB3YXNtIHN1cHBvcnQgZGV0ZWN0ZWQiKSwhMTtpZighKG8ud2FzbU1lbW9yeSBpbnN0YW5jZW9mIFdlYkFzc2VtYmx5Lk1lbW9yeSkpcmV0dXJuIG8ucHJpbnRFcnIoIm5vIG5hdGl2ZSB3YXNtIE1lbW9yeSBpbiB1c2UiKSwhMTtmdW5jdGlvbiBsKGUsdCl7KGk9ZS5leHBvcnRzKS5tZW1vcnkmJmZ1bmN0aW9uKGUpe3ZhciB0PW8uYnVmZmVyO2UuYnl0ZUxlbmd0aDx0LmJ5dGVMZW5ndGgmJm8ucHJpbnRFcnIoInRoZSBuZXcgYnVmZmVyIGluIG1lcmdlTWVtb3J5IGlzIHNtYWxsZXIgdGhhbiB0aGUgcHJldmlvdXMgb25lLiBpbiBuYXRpdmUgd2FzbSwgd2Ugc2hvdWxkIGdyb3cgbWVtb3J5IGhlcmUiKTt2YXIgcj1uZXcgSW50OEFycmF5KHQpO25ldyBJbnQ4QXJyYXkoZSkuc2V0KHIpLFkoZSksVigpfShpLm1lbW9yeSksby5hc209aSxvLnVzaW5nV2FzbT0hMCxsZSgpfWlmKHIubWVtb3J5PW8ud2FzbU1lbW9yeSxuLmdsb2JhbD17TmFOOk5hTixJbmZpbml0eToxLzB9LG5bImdsb2JhbC5NYXRoIl09TWF0aCxuLmVudj1yLGNlKCksby5pbnN0YW50aWF0ZVdhc20pdHJ5e3JldHVybiBvLmluc3RhbnRpYXRlV2FzbShuLGwpfWNhdGNoKGUpe3JldHVybiBvLnByaW50RXJyKCJNb2R1bGUuaW5zdGFudGlhdGVXYXNtIGNhbGxiYWNrIGZhaWxlZCB3aXRoIGVycm9yOiAiK2UpLCExfWZ1bmN0aW9uIGYoZSl7bChlLmluc3RhbmNlLGUubW9kdWxlKX1mdW5jdGlvbiBkKHQpeyhvLndhc21CaW5hcnl8fCF1JiYhY3x8ImZ1bmN0aW9uIiE9dHlwZW9mIGZldGNoP25ldyBQcm9taXNlKChmdW5jdGlvbihlLHQpe2UoYSgpKX0pKTpmZXRjaChlLHtjcmVkZW50aWFsczoib21pdCJ9KS50aGVuKChmdW5jdGlvbih0KXtpZighdC5vayl0aHJvdyJmYWlsZWQgdG8gbG9hZCB3YXNtIGJpbmFyeSBmaWxlIGF0ICciK2UrIiciO3JldHVybiB0LmFycmF5QnVmZmVyKCl9KSkuY2F0Y2goKGZ1bmN0aW9uKCl7cmV0dXJuIGEoKX0pKSkudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGUsbil9KSkudGhlbih0KS5jYXRjaCgoZnVuY3Rpb24oZSl7by5wcmludEVycigiZmFpbGVkIHRvIGFzeW5jaHJvbm91c2x5IHByZXBhcmUgd2FzbTogIitlKSxycihlKX0pKX1yZXR1cm4gby53YXNtQmluYXJ5fHwiZnVuY3Rpb24iIT10eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmd8fGZlKGUpfHwiZnVuY3Rpb24iIT10eXBlb2YgZmV0Y2g/ZChmKTpXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyhmZXRjaChlLHtjcmVkZW50aWFsczoib21pdCJ9KSxuKS50aGVuKGYpLmNhdGNoKChmdW5jdGlvbihlKXtvLnByaW50RXJyKCJ3YXNtIHN0cmVhbWluZyBjb21waWxlIGZhaWxlZDogIitlKSxvLnByaW50RXJyKCJmYWxsaW5nIGJhY2sgdG8gQXJyYXlCdWZmZXIgaW5zdGFudGlhdGlvbiIpLGQoZil9KSkse319by5hc21QcmVsb2FkPW8uYXNtLG8ucmVhbGxvY0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSl7ZT1XKGUsby51c2luZ1dhc20/NjU1MzY6MTY3NzcyMTYpO3ZhciB0PW8uYnVmZmVyLmJ5dGVMZW5ndGg7aWYoby51c2luZ1dhc20pdHJ5e3JldHVybi0xIT09by53YXNtTWVtb3J5Lmdyb3coKGUtdCkvNjU1MzYpP28uYnVmZmVyPW8ud2FzbU1lbW9yeS5idWZmZXI6bnVsbH1jYXRjaChlKXtyZXR1cm4gbnVsbH19KGUpfSxvLmFzbT1mdW5jdGlvbihlLHQscil7aWYoISh0PXQpLnRhYmxlKXt2YXIgbj1vLndhc21UYWJsZVNpemU7dm9pZCAwPT09biYmKG49MTAyNCk7dmFyIGk9by53YXNtTWF4VGFibGVTaXplOyJvYmplY3QiPT10eXBlb2YgV2ViQXNzZW1ibHkmJiJmdW5jdGlvbiI9PXR5cGVvZiBXZWJBc3NlbWJseS5UYWJsZT90LnRhYmxlPXZvaWQgMCE9PWk/bmV3IFdlYkFzc2VtYmx5LlRhYmxlKHtpbml0aWFsOm4sbWF4aW11bTppLGVsZW1lbnQ6ImFueWZ1bmMifSk6bmV3IFdlYkFzc2VtYmx5LlRhYmxlKHtpbml0aWFsOm4sZWxlbWVudDoiYW55ZnVuYyJ9KTp0LnRhYmxlPW5ldyBBcnJheShuKSxvLndhc21UYWJsZT10LnRhYmxlfXZhciBhO3JldHVybiB0Lm1lbW9yeUJhc2V8fCh0Lm1lbW9yeUJhc2U9by5TVEFUSUNfQkFTRSksdC50YWJsZUJhc2V8fCh0LnRhYmxlQmFzZT0wKSwoYT1zKDAsdCkpfHxycigibm8gYmluYXJ5ZW4gbWV0aG9kIHN1Y2NlZWRlZC4gY29uc2lkZXIgZW5hYmxpbmcgbW9yZSBvcHRpb25zLCBsaWtlIGludGVycHJldGluZywgaWYgeW91IHdhbnQgdGhhdDogaHR0cHM6Ly9naXRodWIuY29tL2tyaXBrZW4vZW1zY3JpcHRlbi93aWtpL1dlYkFzc2VtYmx5I2JpbmFyeWVuLW1ldGhvZHMiKSxhfX0oKSxMPTY3OTg0LEoucHVzaCh7ZnVuYzpmdW5jdGlvbigpe0d0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe0h0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe1Z0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe1l0KCl9fSk7by5TVEFUSUNfQkFTRT0xMDI0LG8uU1RBVElDX0JVTVA9NjY5NjAsTCs9MTY7dmFyIGRlPXtsYXN0OjAsY2F1Z2h0OltdLGluZm9zOnt9LGRlQWRqdXN0OmZ1bmN0aW9uKGUpe2lmKCFlfHxkZS5pbmZvc1tlXSlyZXR1cm4gZTtmb3IodmFyIHQgaW4gZGUuaW5mb3Mpe3ZhciByPSt0O2lmKGRlLmluZm9zW3JdLmFkanVzdGVkPT09ZSlyZXR1cm4gcn1yZXR1cm4gZX0sYWRkUmVmOmZ1bmN0aW9uKGUpe2UmJmRlLmluZm9zW2VdLnJlZmNvdW50Kyt9LGRlY1JlZjpmdW5jdGlvbihlKXtpZihlKXt2YXIgdD1kZS5pbmZvc1tlXTt5KHQucmVmY291bnQ+MCksdC5yZWZjb3VudC0tLDAhPT10LnJlZmNvdW50fHx0LnJldGhyb3dufHwodC5kZXN0cnVjdG9yJiZvLmR5bkNhbGxfdmkodC5kZXN0cnVjdG9yLGUpLGRlbGV0ZSBkZS5pbmZvc1tlXSxoZShlKSl9fSxjbGVhclJlZjpmdW5jdGlvbihlKXtlJiYoZGUuaW5mb3NbZV0ucmVmY291bnQ9MCl9fTtmdW5jdGlvbiBoZShlKXt0cnl7cmV0dXJuIEt0KGUpfWNhdGNoKGUpe319ZnVuY3Rpb24gcGUoKXt2YXIgZT1kZS5sYXN0O2lmKCFlKXJldHVybiAwfChadCgwKSwwKTt2YXIgdD1kZS5pbmZvc1tlXSxyPXQudHlwZTtpZighcilyZXR1cm4gMHwoWnQoMCksZSk7dmFyIG49QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtvLl9fX2N4YV9pc19wb2ludGVyX3R5cGUocik7cGUuYnVmZmVyfHwocGUuYnVmZmVyPUp0KDQpKSxGW3BlLmJ1ZmZlcj4+Ml09ZSxlPXBlLmJ1ZmZlcjtmb3IodmFyIGk9MDtpPG4ubGVuZ3RoO2krKylpZihuW2ldJiZvLl9fX2N4YV9jYW5fY2F0Y2gobltpXSxyLGUpKXJldHVybiBlPUZbZT4+Ml0sdC5hZGp1c3RlZD1lLDB8KFp0KG5baV0pLGUpO3JldHVybiBlPUZbZT4+Ml0sMHwoWnQociksZSl9dmFyIG1lPXtFUEVSTToxLEVOT0VOVDoyLEVTUkNIOjMsRUlOVFI6NCxFSU86NSxFTlhJTzo2LEUyQklHOjcsRU5PRVhFQzo4LEVCQURGOjksRUNISUxEOjEwLEVBR0FJTjoxMSxFV09VTERCTE9DSzoxMSxFTk9NRU06MTIsRUFDQ0VTOjEzLEVGQVVMVDoxNCxFTk9UQkxLOjE1LEVCVVNZOjE2LEVFWElTVDoxNyxFWERFVjoxOCxFTk9ERVY6MTksRU5PVERJUjoyMCxFSVNESVI6MjEsRUlOVkFMOjIyLEVORklMRToyMyxFTUZJTEU6MjQsRU5PVFRZOjI1LEVUWFRCU1k6MjYsRUZCSUc6MjcsRU5PU1BDOjI4LEVTUElQRToyOSxFUk9GUzozMCxFTUxJTks6MzEsRVBJUEU6MzIsRURPTTozMyxFUkFOR0U6MzQsRU5PTVNHOjQyLEVJRFJNOjQzLEVDSFJORzo0NCxFTDJOU1lOQzo0NSxFTDNITFQ6NDYsRUwzUlNUOjQ3LEVMTlJORzo0OCxFVU5BVENIOjQ5LEVOT0NTSTo1MCxFTDJITFQ6NTEsRURFQURMSzozNSxFTk9MQ0s6MzcsRUJBREU6NTIsRUJBRFI6NTMsRVhGVUxMOjU0LEVOT0FOTzo1NSxFQkFEUlFDOjU2LEVCQURTTFQ6NTcsRURFQURMT0NLOjM1LEVCRk9OVDo1OSxFTk9TVFI6NjAsRU5PREFUQTo2MSxFVElNRTo2MixFTk9TUjo2MyxFTk9ORVQ6NjQsRU5PUEtHOjY1LEVSRU1PVEU6NjYsRU5PTElOSzo2NyxFQURWOjY4LEVTUk1OVDo2OSxFQ09NTTo3MCxFUFJPVE86NzEsRU1VTFRJSE9QOjcyLEVET1RET1Q6NzMsRUJBRE1TRzo3NCxFTk9UVU5JUTo3NixFQkFERkQ6NzcsRVJFTUNIRzo3OCxFTElCQUNDOjc5LEVMSUJCQUQ6ODAsRUxJQlNDTjo4MSxFTElCTUFYOjgyLEVMSUJFWEVDOjgzLEVOT1NZUzozOCxFTk9URU1QVFk6MzksRU5BTUVUT09MT05HOjM2LEVMT09QOjQwLEVPUE5PVFNVUFA6OTUsRVBGTk9TVVBQT1JUOjk2LEVDT05OUkVTRVQ6MTA0LEVOT0JVRlM6MTA1LEVBRk5PU1VQUE9SVDo5NyxFUFJPVE9UWVBFOjkxLEVOT1RTT0NLOjg4LEVOT1BST1RPT1BUOjkyLEVTSFVURE9XTjoxMDgsRUNPTk5SRUZVU0VEOjExMSxFQUREUklOVVNFOjk4LEVDT05OQUJPUlRFRDoxMDMsRU5FVFVOUkVBQ0g6MTAxLEVORVRET1dOOjEwMCxFVElNRURPVVQ6MTEwLEVIT1NURE9XTjoxMTIsRUhPU1RVTlJFQUNIOjExMyxFSU5QUk9HUkVTUzoxMTUsRUFMUkVBRFk6MTE0LEVERVNUQUREUlJFUTo4OSxFTVNHU0laRTo5MCxFUFJPVE9OT1NVUFBPUlQ6OTMsRVNPQ0tUTk9TVVBQT1JUOjk0LEVBRERSTk9UQVZBSUw6OTksRU5FVFJFU0VUOjEwMixFSVNDT05OOjEwNixFTk9UQ09OTjoxMDcsRVRPT01BTllSRUZTOjEwOSxFVVNFUlM6ODcsRURRVU9UOjEyMixFU1RBTEU6MTE2LEVOT1RTVVA6OTUsRU5PTUVESVVNOjEyMyxFSUxTRVE6ODQsRU9WRVJGTE9XOjc1LEVDQU5DRUxFRDoxMjUsRU5PVFJFQ09WRVJBQkxFOjEzMSxFT1dORVJERUFEOjEzMCxFU1RSUElQRTo4Nn07ZnVuY3Rpb24geWUoZSl7cmV0dXJuIG8uX19fZXJybm9fbG9jYXRpb24mJihGW28uX19fZXJybm9fbG9jYXRpb24oKT4+Ml09ZSksZX12YXIgRWU9ezA6IlN1Y2Nlc3MiLDE6Ik5vdCBzdXBlci11c2VyIiwyOiJObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5IiwzOiJObyBzdWNoIHByb2Nlc3MiLDQ6IkludGVycnVwdGVkIHN5c3RlbSBjYWxsIiw1OiJJL08gZXJyb3IiLDY6Ik5vIHN1Y2ggZGV2aWNlIG9yIGFkZHJlc3MiLDc6IkFyZyBsaXN0IHRvbyBsb25nIiw4OiJFeGVjIGZvcm1hdCBlcnJvciIsOToiQmFkIGZpbGUgbnVtYmVyIiwxMDoiTm8gY2hpbGRyZW4iLDExOiJObyBtb3JlIHByb2Nlc3NlcyIsMTI6Ik5vdCBlbm91Z2ggY29yZSIsMTM6IlBlcm1pc3Npb24gZGVuaWVkIiwxNDoiQmFkIGFkZHJlc3MiLDE1OiJCbG9jayBkZXZpY2UgcmVxdWlyZWQiLDE2OiJNb3VudCBkZXZpY2UgYnVzeSIsMTc6IkZpbGUgZXhpc3RzIiwxODoiQ3Jvc3MtZGV2aWNlIGxpbmsiLDE5OiJObyBzdWNoIGRldmljZSIsMjA6Ik5vdCBhIGRpcmVjdG9yeSIsMjE6IklzIGEgZGlyZWN0b3J5IiwyMjoiSW52YWxpZCBhcmd1bWVudCIsMjM6IlRvbyBtYW55IG9wZW4gZmlsZXMgaW4gc3lzdGVtIiwyNDoiVG9vIG1hbnkgb3BlbiBmaWxlcyIsMjU6Ik5vdCBhIHR5cGV3cml0ZXIiLDI2OiJUZXh0IGZpbGUgYnVzeSIsMjc6IkZpbGUgdG9vIGxhcmdlIiwyODoiTm8gc3BhY2UgbGVmdCBvbiBkZXZpY2UiLDI5OiJJbGxlZ2FsIHNlZWsiLDMwOiJSZWFkIG9ubHkgZmlsZSBzeXN0ZW0iLDMxOiJUb28gbWFueSBsaW5rcyIsMzI6IkJyb2tlbiBwaXBlIiwzMzoiTWF0aCBhcmcgb3V0IG9mIGRvbWFpbiBvZiBmdW5jIiwzNDoiTWF0aCByZXN1bHQgbm90IHJlcHJlc2VudGFibGUiLDM1OiJGaWxlIGxvY2tpbmcgZGVhZGxvY2sgZXJyb3IiLDM2OiJGaWxlIG9yIHBhdGggbmFtZSB0b28gbG9uZyIsMzc6Ik5vIHJlY29yZCBsb2NrcyBhdmFpbGFibGUiLDM4OiJGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQiLDM5OiJEaXJlY3Rvcnkgbm90IGVtcHR5Iiw0MDoiVG9vIG1hbnkgc3ltYm9saWMgbGlua3MiLDQyOiJObyBtZXNzYWdlIG9mIGRlc2lyZWQgdHlwZSIsNDM6IklkZW50aWZpZXIgcmVtb3ZlZCIsNDQ6IkNoYW5uZWwgbnVtYmVyIG91dCBvZiByYW5nZSIsNDU6IkxldmVsIDIgbm90IHN5bmNocm9uaXplZCIsNDY6IkxldmVsIDMgaGFsdGVkIiw0NzoiTGV2ZWwgMyByZXNldCIsNDg6IkxpbmsgbnVtYmVyIG91dCBvZiByYW5nZSIsNDk6IlByb3RvY29sIGRyaXZlciBub3QgYXR0YWNoZWQiLDUwOiJObyBDU0kgc3RydWN0dXJlIGF2YWlsYWJsZSIsNTE6IkxldmVsIDIgaGFsdGVkIiw1MjoiSW52YWxpZCBleGNoYW5nZSIsNTM6IkludmFsaWQgcmVxdWVzdCBkZXNjcmlwdG9yIiw1NDoiRXhjaGFuZ2UgZnVsbCIsNTU6Ik5vIGFub2RlIiw1NjoiSW52YWxpZCByZXF1ZXN0IGNvZGUiLDU3OiJJbnZhbGlkIHNsb3QiLDU5OiJCYWQgZm9udCBmaWxlIGZtdCIsNjA6IkRldmljZSBub3QgYSBzdHJlYW0iLDYxOiJObyBkYXRhIChmb3Igbm8gZGVsYXkgaW8pIiw2MjoiVGltZXIgZXhwaXJlZCIsNjM6Ik91dCBvZiBzdHJlYW1zIHJlc291cmNlcyIsNjQ6Ik1hY2hpbmUgaXMgbm90IG9uIHRoZSBuZXR3b3JrIiw2NToiUGFja2FnZSBub3QgaW5zdGFsbGVkIiw2NjoiVGhlIG9iamVjdCBpcyByZW1vdGUiLDY3OiJUaGUgbGluayBoYXMgYmVlbiBzZXZlcmVkIiw2ODoiQWR2ZXJ0aXNlIGVycm9yIiw2OToiU3Jtb3VudCBlcnJvciIsNzA6IkNvbW11bmljYXRpb24gZXJyb3Igb24gc2VuZCIsNzE6IlByb3RvY29sIGVycm9yIiw3MjoiTXVsdGlob3AgYXR0ZW1wdGVkIiw3MzoiQ3Jvc3MgbW91bnQgcG9pbnQgKG5vdCByZWFsbHkgZXJyb3IpIiw3NDoiVHJ5aW5nIHRvIHJlYWQgdW5yZWFkYWJsZSBtZXNzYWdlIiw3NToiVmFsdWUgdG9vIGxhcmdlIGZvciBkZWZpbmVkIGRhdGEgdHlwZSIsNzY6IkdpdmVuIGxvZy4gbmFtZSBub3QgdW5pcXVlIiw3NzoiZi5kLiBpbnZhbGlkIGZvciB0aGlzIG9wZXJhdGlvbiIsNzg6IlJlbW90ZSBhZGRyZXNzIGNoYW5nZWQiLDc5OiJDYW4gICBhY2Nlc3MgYSBuZWVkZWQgc2hhcmVkIGxpYiIsODA6IkFjY2Vzc2luZyBhIGNvcnJ1cHRlZCBzaGFyZWQgbGliIiw4MToiLmxpYiBzZWN0aW9uIGluIGEub3V0IGNvcnJ1cHRlZCIsODI6IkF0dGVtcHRpbmcgdG8gbGluayBpbiB0b28gbWFueSBsaWJzIiw4MzoiQXR0ZW1wdGluZyB0byBleGVjIGEgc2hhcmVkIGxpYnJhcnkiLDg0OiJJbGxlZ2FsIGJ5dGUgc2VxdWVuY2UiLDg2OiJTdHJlYW1zIHBpcGUgZXJyb3IiLDg3OiJUb28gbWFueSB1c2VycyIsODg6IlNvY2tldCBvcGVyYXRpb24gb24gbm9uLXNvY2tldCIsODk6IkRlc3RpbmF0aW9uIGFkZHJlc3MgcmVxdWlyZWQiLDkwOiJNZXNzYWdlIHRvbyBsb25nIiw5MToiUHJvdG9jb2wgd3JvbmcgdHlwZSBmb3Igc29ja2V0Iiw5MjoiUHJvdG9jb2wgbm90IGF2YWlsYWJsZSIsOTM6IlVua25vd24gcHJvdG9jb2wiLDk0OiJTb2NrZXQgdHlwZSBub3Qgc3VwcG9ydGVkIiw5NToiTm90IHN1cHBvcnRlZCIsOTY6IlByb3RvY29sIGZhbWlseSBub3Qgc3VwcG9ydGVkIiw5NzoiQWRkcmVzcyBmYW1pbHkgbm90IHN1cHBvcnRlZCBieSBwcm90b2NvbCBmYW1pbHkiLDk4OiJBZGRyZXNzIGFscmVhZHkgaW4gdXNlIiw5OToiQWRkcmVzcyBub3QgYXZhaWxhYmxlIiwxMDA6Ik5ldHdvcmsgaW50ZXJmYWNlIGlzIG5vdCBjb25maWd1cmVkIiwxMDE6Ik5ldHdvcmsgaXMgdW5yZWFjaGFibGUiLDEwMjoiQ29ubmVjdGlvbiByZXNldCBieSBuZXR3b3JrIiwxMDM6IkNvbm5lY3Rpb24gYWJvcnRlZCIsMTA0OiJDb25uZWN0aW9uIHJlc2V0IGJ5IHBlZXIiLDEwNToiTm8gYnVmZmVyIHNwYWNlIGF2YWlsYWJsZSIsMTA2OiJTb2NrZXQgaXMgYWxyZWFkeSBjb25uZWN0ZWQiLDEwNzoiU29ja2V0IGlzIG5vdCBjb25uZWN0ZWQiLDEwODoiQ2FuJ3Qgc2VuZCBhZnRlciBzb2NrZXQgc2h1dGRvd24iLDEwOToiVG9vIG1hbnkgcmVmZXJlbmNlcyIsMTEwOiJDb25uZWN0aW9uIHRpbWVkIG91dCIsMTExOiJDb25uZWN0aW9uIHJlZnVzZWQiLDExMjoiSG9zdCBpcyBkb3duIiwxMTM6Ikhvc3QgaXMgdW5yZWFjaGFibGUiLDExNDoiU29ja2V0IGFscmVhZHkgY29ubmVjdGVkIiwxMTU6IkNvbm5lY3Rpb24gYWxyZWFkeSBpbiBwcm9ncmVzcyIsMTE2OiJTdGFsZSBmaWxlIGhhbmRsZSIsMTIyOiJRdW90YSBleGNlZWRlZCIsMTIzOiJObyBtZWRpdW0gKGluIHRhcGUgZHJpdmUpIiwxMjU6Ik9wZXJhdGlvbiBjYW5jZWxlZCIsMTMwOiJQcmV2aW91cyBvd25lciBkaWVkIiwxMzE6IlN0YXRlIG5vdCByZWNvdmVyYWJsZSJ9LGdlPXtzcGxpdFBhdGg6ZnVuY3Rpb24oZSl7cmV0dXJuL14oXC8/fCkoW1xzXFNdKj8pKCg/OlwuezEsMn18W15cL10rP3wpKFwuW14uXC9dKnwpKSg/OltcL10qKSQvLmV4ZWMoZSkuc2xpY2UoMSl9LG5vcm1hbGl6ZUFycmF5OmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPTAsbj1lLmxlbmd0aC0xO24+PTA7bi0tKXt2YXIgbz1lW25dOyIuIj09PW8/ZS5zcGxpY2UobiwxKToiLi4iPT09bz8oZS5zcGxpY2UobiwxKSxyKyspOnImJihlLnNwbGljZShuLDEpLHItLSl9aWYodClmb3IoO3I7ci0tKWUudW5zaGlmdCgiLi4iKTtyZXR1cm4gZX0sbm9ybWFsaXplOmZ1bmN0aW9uKGUpe3ZhciB0PSIvIj09PWUuY2hhckF0KDApLHI9Ii8iPT09ZS5zdWJzdHIoLTEpO3JldHVybihlPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhdCkuam9pbigiLyIpKXx8dHx8KGU9Ii4iKSxlJiZyJiYoZSs9Ii8iKSwodD8iLyI6IiIpK2V9LGRpcm5hbWU6ZnVuY3Rpb24oZSl7dmFyIHQ9Z2Uuc3BsaXRQYXRoKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIHJ8fG4/KG4mJihuPW4uc3Vic3RyKDAsbi5sZW5ndGgtMSkpLHIrbik6Ii4ifSxiYXNlbmFtZTpmdW5jdGlvbihlKXtpZigiLyI9PT1lKXJldHVybiIvIjt2YXIgdD1lLmxhc3RJbmRleE9mKCIvIik7cmV0dXJuLTE9PT10P2U6ZS5zdWJzdHIodCsxKX0sZXh0bmFtZTpmdW5jdGlvbihlKXtyZXR1cm4gZ2Uuc3BsaXRQYXRoKGUpWzNdfSxqb2luOmZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO3JldHVybiBnZS5ub3JtYWxpemUoZS5qb2luKCIvIikpfSxqb2luMjpmdW5jdGlvbihlLHQpe3JldHVybiBnZS5ub3JtYWxpemUoZSsiLyIrdCl9LHJlc29sdmU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9IiIsdD0hMSxyPWFyZ3VtZW50cy5sZW5ndGgtMTtyPj0tMSYmIXQ7ci0tKXt2YXIgbj1yPj0wP2FyZ3VtZW50c1tyXTpUZS5jd2QoKTtpZigic3RyaW5nIiE9dHlwZW9mIG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnRzIHRvIHBhdGgucmVzb2x2ZSBtdXN0IGJlIHN0cmluZ3MiKTtpZighbilyZXR1cm4iIjtlPW4rIi8iK2UsdD0iLyI9PT1uLmNoYXJBdCgwKX1yZXR1cm4odD8iLyI6IiIpKyhlPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhdCkuam9pbigiLyIpKXx8Ii4ifSxyZWxhdGl2ZTpmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIHIoZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aCYmIiI9PT1lW3RdO3QrKyk7Zm9yKHZhciByPWUubGVuZ3RoLTE7cj49MCYmIiI9PT1lW3JdO3ItLSk7cmV0dXJuIHQ+cj9bXTplLnNsaWNlKHQsci10KzEpfWU9Z2UucmVzb2x2ZShlKS5zdWJzdHIoMSksdD1nZS5yZXNvbHZlKHQpLnN1YnN0cigxKTtmb3IodmFyIG49cihlLnNwbGl0KCIvIikpLG89cih0LnNwbGl0KCIvIikpLGk9TWF0aC5taW4obi5sZW5ndGgsby5sZW5ndGgpLGE9aSxzPTA7czxpO3MrKylpZihuW3NdIT09b1tzXSl7YT1zO2JyZWFrfXZhciB1PVtdO2ZvcihzPWE7czxuLmxlbmd0aDtzKyspdS5wdXNoKCIuLiIpO3JldHVybih1PXUuY29uY2F0KG8uc2xpY2UoYSkpKS5qb2luKCIvIil9fSx2ZT17dHR5czpbXSxpbml0OmZ1bmN0aW9uKCl7fSxzaHV0ZG93bjpmdW5jdGlvbigpe30scmVnaXN0ZXI6ZnVuY3Rpb24oZSx0KXt2ZS50dHlzW2VdPXtpbnB1dDpbXSxvdXRwdXQ6W10sb3BzOnR9LFRlLnJlZ2lzdGVyRGV2aWNlKGUsdmUuc3RyZWFtX29wcyl9LHN0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oZSl7dmFyIHQ9dmUudHR5c1tlLm5vZGUucmRldl07aWYoIXQpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtlLnR0eT10LGUuc2Vla2FibGU9ITF9LGNsb3NlOmZ1bmN0aW9uKGUpe2UudHR5Lm9wcy5mbHVzaChlLnR0eSl9LGZsdXNoOmZ1bmN0aW9uKGUpe2UudHR5Lm9wcy5mbHVzaChlLnR0eSl9LHJlYWQ6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighZS50dHl8fCFlLnR0eS5vcHMuZ2V0X2NoYXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5YSU8pO2Zvcih2YXIgaT0wLGE9MDthPG47YSsrKXt2YXIgczt0cnl7cz1lLnR0eS5vcHMuZ2V0X2NoYXIoZS50dHkpfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9aWYodm9pZCAwPT09cyYmMD09PWkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUFHQUlOKTtpZihudWxsPT1zKWJyZWFrO2krKyx0W3IrYV09c31yZXR1cm4gaSYmKGUubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksaX0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighZS50dHl8fCFlLnR0eS5vcHMucHV0X2NoYXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5YSU8pO2Zvcih2YXIgaT0wO2k8bjtpKyspdHJ5e2UudHR5Lm9wcy5wdXRfY2hhcihlLnR0eSx0W3IraV0pfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9cmV0dXJuIG4mJihlLm5vZGUudGltZXN0YW1wPURhdGUubm93KCkpLGl9fSxkZWZhdWx0X3R0eV9vcHM6e2dldF9jaGFyOmZ1bmN0aW9uKGUpe2lmKCFlLmlucHV0Lmxlbmd0aCl7dmFyIHQ9bnVsbDtpZihsKXt2YXIgcj1uZXcgQnVmZmVyKDI1Niksbj0wLG89IndpbjMyIiE9cHJvY2Vzcy5wbGF0Zm9ybSxpPXByb2Nlc3Muc3RkaW4uZmQ7aWYobyl7dmFyIGE9ITE7dHJ5e2k9ZnMub3BlblN5bmMoIi9kZXYvc3RkaW4iLCJyIiksYT0hMH1jYXRjaChlKXt9fXRyeXtuPWZzLnJlYWRTeW5jKGksciwwLDI1NixudWxsKX1jYXRjaChlKXtpZigtMT09ZS50b1N0cmluZygpLmluZGV4T2YoIkVPRiIpKXRocm93IGU7bj0wfWEmJmZzLmNsb3NlU3luYyhpKSx0PW4+MD9yLnNsaWNlKDAsbikudG9TdHJpbmcoInV0Zi04Iik6bnVsbH1lbHNlInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJiJmdW5jdGlvbiI9PXR5cGVvZiB3aW5kb3cucHJvbXB0P251bGwhPT0odD13aW5kb3cucHJvbXB0KCJJbnB1dDogIikpJiYodCs9IlxuIik6ImZ1bmN0aW9uIj09dHlwZW9mIHJlYWRsaW5lJiZudWxsIT09KHQ9cmVhZGxpbmUoKSkmJih0Kz0iXG4iKTtpZighdClyZXR1cm4gbnVsbDtlLmlucHV0PSR0KHQsITApfXJldHVybiBlLmlucHV0LnNoaWZ0KCl9LHB1dF9jaGFyOmZ1bmN0aW9uKGUsdCl7bnVsbD09PXR8fDEwPT09dD8oby5wcmludChfKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSk6MCE9dCYmZS5vdXRwdXQucHVzaCh0KX0sZmx1c2g6ZnVuY3Rpb24oZSl7ZS5vdXRwdXQmJmUub3V0cHV0Lmxlbmd0aD4wJiYoby5wcmludChfKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSl9fSxkZWZhdWx0X3R0eTFfb3BzOntwdXRfY2hhcjpmdW5jdGlvbihlLHQpe251bGw9PT10fHwxMD09PXQ/KG8ucHJpbnRFcnIoXyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pOjAhPXQmJmUub3V0cHV0LnB1c2godCl9LGZsdXNoOmZ1bmN0aW9uKGUpe2Uub3V0cHV0JiZlLm91dHB1dC5sZW5ndGg+MCYmKG8ucHJpbnRFcnIoXyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pfX19LHdlPXtvcHNfdGFibGU6bnVsbCxtb3VudDpmdW5jdGlvbihlKXtyZXR1cm4gd2UuY3JlYXRlTm9kZShudWxsLCIvIiwxNjg5NSwwKX0sY3JlYXRlTm9kZTpmdW5jdGlvbihlLHQscixuKXtpZihUZS5pc0Jsa2RldihyKXx8VGUuaXNGSUZPKHIpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTt3ZS5vcHNfdGFibGV8fCh3ZS5vcHNfdGFibGU9e2Rpcjp7bm9kZTp7Z2V0YXR0cjp3ZS5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6d2Uubm9kZV9vcHMuc2V0YXR0cixsb29rdXA6d2Uubm9kZV9vcHMubG9va3VwLG1rbm9kOndlLm5vZGVfb3BzLm1rbm9kLHJlbmFtZTp3ZS5ub2RlX29wcy5yZW5hbWUsdW5saW5rOndlLm5vZGVfb3BzLnVubGluayxybWRpcjp3ZS5ub2RlX29wcy5ybWRpcixyZWFkZGlyOndlLm5vZGVfb3BzLnJlYWRkaXIsc3ltbGluazp3ZS5ub2RlX29wcy5zeW1saW5rfSxzdHJlYW06e2xsc2Vlazp3ZS5zdHJlYW1fb3BzLmxsc2Vla319LGZpbGU6e25vZGU6e2dldGF0dHI6d2Uubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOndlLm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTp7bGxzZWVrOndlLnN0cmVhbV9vcHMubGxzZWVrLHJlYWQ6d2Uuc3RyZWFtX29wcy5yZWFkLHdyaXRlOndlLnN0cmVhbV9vcHMud3JpdGUsYWxsb2NhdGU6d2Uuc3RyZWFtX29wcy5hbGxvY2F0ZSxtbWFwOndlLnN0cmVhbV9vcHMubW1hcCxtc3luYzp3ZS5zdHJlYW1fb3BzLm1zeW5jfX0sbGluazp7bm9kZTp7Z2V0YXR0cjp3ZS5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6d2Uubm9kZV9vcHMuc2V0YXR0cixyZWFkbGluazp3ZS5ub2RlX29wcy5yZWFkbGlua30sc3RyZWFtOnt9fSxjaHJkZXY6e25vZGU6e2dldGF0dHI6d2Uubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOndlLm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTpUZS5jaHJkZXZfc3RyZWFtX29wc319KTt2YXIgbz1UZS5jcmVhdGVOb2RlKGUsdCxyLG4pO3JldHVybiBUZS5pc0RpcihvLm1vZGUpPyhvLm5vZGVfb3BzPXdlLm9wc190YWJsZS5kaXIubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmRpci5zdHJlYW0sby5jb250ZW50cz17fSk6VGUuaXNGaWxlKG8ubW9kZSk/KG8ubm9kZV9vcHM9d2Uub3BzX3RhYmxlLmZpbGUubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmZpbGUuc3RyZWFtLG8udXNlZEJ5dGVzPTAsby5jb250ZW50cz1udWxsKTpUZS5pc0xpbmsoby5tb2RlKT8oby5ub2RlX29wcz13ZS5vcHNfdGFibGUubGluay5ub2RlLG8uc3RyZWFtX29wcz13ZS5vcHNfdGFibGUubGluay5zdHJlYW0pOlRlLmlzQ2hyZGV2KG8ubW9kZSkmJihvLm5vZGVfb3BzPXdlLm9wc190YWJsZS5jaHJkZXYubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmNocmRldi5zdHJlYW0pLG8udGltZXN0YW1wPURhdGUubm93KCksZSYmKGUuY29udGVudHNbdF09byksb30sZ2V0RmlsZURhdGFBc1JlZ3VsYXJBcnJheTpmdW5jdGlvbihlKXtpZihlLmNvbnRlbnRzJiZlLmNvbnRlbnRzLnN1YmFycmF5KXtmb3IodmFyIHQ9W10scj0wO3I8ZS51c2VkQnl0ZXM7KytyKXQucHVzaChlLmNvbnRlbnRzW3JdKTtyZXR1cm4gdH1yZXR1cm4gZS5jb250ZW50c30sZ2V0RmlsZURhdGFBc1R5cGVkQXJyYXk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuY29udGVudHM/ZS5jb250ZW50cy5zdWJhcnJheT9lLmNvbnRlbnRzLnN1YmFycmF5KDAsZS51c2VkQnl0ZXMpOm5ldyBVaW50OEFycmF5KGUuY29udGVudHMpOm5ldyBVaW50OEFycmF5fSxleHBhbmRGaWxlU3RvcmFnZTpmdW5jdGlvbihlLHQpe2lmKGUuY29udGVudHMmJmUuY29udGVudHMuc3ViYXJyYXkmJnQ+ZS5jb250ZW50cy5sZW5ndGgmJihlLmNvbnRlbnRzPXdlLmdldEZpbGVEYXRhQXNSZWd1bGFyQXJyYXkoZSksZS51c2VkQnl0ZXM9ZS5jb250ZW50cy5sZW5ndGgpLCFlLmNvbnRlbnRzfHxlLmNvbnRlbnRzLnN1YmFycmF5KXt2YXIgcj1lLmNvbnRlbnRzP2UuY29udGVudHMubGVuZ3RoOjA7aWYocj49dClyZXR1cm47dD1NYXRoLm1heCh0LHIqKHI8MTA0ODU3Nj8yOjEuMTI1KXwwKSwwIT1yJiYodD1NYXRoLm1heCh0LDI1NikpO3ZhciBuPWUuY29udGVudHM7cmV0dXJuIGUuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkodCksdm9pZChlLnVzZWRCeXRlcz4wJiZlLmNvbnRlbnRzLnNldChuLnN1YmFycmF5KDAsZS51c2VkQnl0ZXMpLDApKX1mb3IoIWUuY29udGVudHMmJnQ+MCYmKGUuY29udGVudHM9W10pO2UuY29udGVudHMubGVuZ3RoPHQ7KWUuY29udGVudHMucHVzaCgwKX0scmVzaXplRmlsZVN0b3JhZ2U6ZnVuY3Rpb24oZSx0KXtpZihlLnVzZWRCeXRlcyE9dCl7aWYoMD09dClyZXR1cm4gZS5jb250ZW50cz1udWxsLHZvaWQoZS51c2VkQnl0ZXM9MCk7aWYoIWUuY29udGVudHN8fGUuY29udGVudHMuc3ViYXJyYXkpe3ZhciByPWUuY29udGVudHM7cmV0dXJuIGUuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkobmV3IEFycmF5QnVmZmVyKHQpKSxyJiZlLmNvbnRlbnRzLnNldChyLnN1YmFycmF5KDAsTWF0aC5taW4odCxlLnVzZWRCeXRlcykpKSx2b2lkKGUudXNlZEJ5dGVzPXQpfWlmKGUuY29udGVudHN8fChlLmNvbnRlbnRzPVtdKSxlLmNvbnRlbnRzLmxlbmd0aD50KWUuY29udGVudHMubGVuZ3RoPXQ7ZWxzZSBmb3IoO2UuY29udGVudHMubGVuZ3RoPHQ7KWUuY29udGVudHMucHVzaCgwKTtlLnVzZWRCeXRlcz10fX0sbm9kZV9vcHM6e2dldGF0dHI6ZnVuY3Rpb24oZSl7dmFyIHQ9e307cmV0dXJuIHQuZGV2PVRlLmlzQ2hyZGV2KGUubW9kZSk/ZS5pZDoxLHQuaW5vPWUuaWQsdC5tb2RlPWUubW9kZSx0Lm5saW5rPTEsdC51aWQ9MCx0LmdpZD0wLHQucmRldj1lLnJkZXYsVGUuaXNEaXIoZS5tb2RlKT90LnNpemU9NDA5NjpUZS5pc0ZpbGUoZS5tb2RlKT90LnNpemU9ZS51c2VkQnl0ZXM6VGUuaXNMaW5rKGUubW9kZSk/dC5zaXplPWUubGluay5sZW5ndGg6dC5zaXplPTAsdC5hdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5tdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5jdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5ibGtzaXplPTQwOTYsdC5ibG9ja3M9TWF0aC5jZWlsKHQuc2l6ZS90LmJsa3NpemUpLHR9LHNldGF0dHI6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT10Lm1vZGUmJihlLm1vZGU9dC5tb2RlKSx2b2lkIDAhPT10LnRpbWVzdGFtcCYmKGUudGltZXN0YW1wPXQudGltZXN0YW1wKSx2b2lkIDAhPT10LnNpemUmJndlLnJlc2l6ZUZpbGVTdG9yYWdlKGUsdC5zaXplKX0sbG9va3VwOmZ1bmN0aW9uKGUsdCl7dGhyb3cgVGUuZ2VuZXJpY0Vycm9yc1ttZS5FTk9FTlRdfSxta25vZDpmdW5jdGlvbihlLHQscixuKXtyZXR1cm4gd2UuY3JlYXRlTm9kZShlLHQscixuKX0scmVuYW1lOmZ1bmN0aW9uKGUsdCxyKXtpZihUZS5pc0RpcihlLm1vZGUpKXt2YXIgbjt0cnl7bj1UZS5sb29rdXBOb2RlKHQscil9Y2F0Y2goZSl7fWlmKG4pZm9yKHZhciBvIGluIG4uY29udGVudHMpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PVEVNUFRZKX1kZWxldGUgZS5wYXJlbnQuY29udGVudHNbZS5uYW1lXSxlLm5hbWU9cix0LmNvbnRlbnRzW3JdPWUsZS5wYXJlbnQ9dH0sdW5saW5rOmZ1bmN0aW9uKGUsdCl7ZGVsZXRlIGUuY29udGVudHNbdF19LHJtZGlyOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUubG9va3VwTm9kZShlLHQpO2Zvcih2YXIgbiBpbiByLmNvbnRlbnRzKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RFTVBUWSk7ZGVsZXRlIGUuY29udGVudHNbdF19LHJlYWRkaXI6ZnVuY3Rpb24oZSl7dmFyIHQ9WyIuIiwiLi4iXTtmb3IodmFyIHIgaW4gZS5jb250ZW50cyllLmNvbnRlbnRzLmhhc093blByb3BlcnR5KHIpJiZ0LnB1c2gocik7cmV0dXJuIHR9LHN5bWxpbms6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPXdlLmNyZWF0ZU5vZGUoZSx0LDQxNDcxLDApO3JldHVybiBuLmxpbms9cixufSxyZWFkbGluazpmdW5jdGlvbihlKXtpZighVGUuaXNMaW5rKGUubW9kZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtyZXR1cm4gZS5saW5rfX0sc3RyZWFtX29wczp7cmVhZDpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWUubm9kZS5jb250ZW50cztpZihvPj1lLm5vZGUudXNlZEJ5dGVzKXJldHVybiAwO3ZhciBhPU1hdGgubWluKGUubm9kZS51c2VkQnl0ZXMtbyxuKTtpZih5KGE+PTApLGE+OCYmaS5zdWJhcnJheSl0LnNldChpLnN1YmFycmF5KG8sbythKSxyKTtlbHNlIGZvcih2YXIgcz0wO3M8YTtzKyspdFtyK3NdPWlbbytzXTtyZXR1cm4gYX0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvLGkpe2lmKCFuKXJldHVybiAwO3ZhciBhPWUubm9kZTtpZihhLnRpbWVzdGFtcD1EYXRlLm5vdygpLHQuc3ViYXJyYXkmJighYS5jb250ZW50c3x8YS5jb250ZW50cy5zdWJhcnJheSkpe2lmKGkpcmV0dXJuIGEuY29udGVudHM9dC5zdWJhcnJheShyLHIrbiksYS51c2VkQnl0ZXM9bixuO2lmKDA9PT1hLnVzZWRCeXRlcyYmMD09PW8pcmV0dXJuIGEuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkodC5zdWJhcnJheShyLHIrbikpLGEudXNlZEJ5dGVzPW4sbjtpZihvK248PWEudXNlZEJ5dGVzKXJldHVybiBhLmNvbnRlbnRzLnNldCh0LnN1YmFycmF5KHIscituKSxvKSxufWlmKHdlLmV4cGFuZEZpbGVTdG9yYWdlKGEsbytuKSxhLmNvbnRlbnRzLnN1YmFycmF5JiZ0LnN1YmFycmF5KWEuY29udGVudHMuc2V0KHQuc3ViYXJyYXkocixyK24pLG8pO2Vsc2UgZm9yKHZhciBzPTA7czxuO3MrKylhLmNvbnRlbnRzW28rc109dFtyK3NdO3JldHVybiBhLnVzZWRCeXRlcz1NYXRoLm1heChhLnVzZWRCeXRlcyxvK24pLG59LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09cj9uKz1lLnBvc2l0aW9uOjI9PT1yJiZUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiYobis9ZS5ub2RlLnVzZWRCeXRlcyksbjwwKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7cmV0dXJuIG59LGFsbG9jYXRlOmZ1bmN0aW9uKGUsdCxyKXt3ZS5leHBhbmRGaWxlU3RvcmFnZShlLm5vZGUsdCtyKSxlLm5vZGUudXNlZEJ5dGVzPU1hdGgubWF4KGUubm9kZS51c2VkQnl0ZXMsdCtyKX0sbW1hcDpmdW5jdGlvbihlLHQscixuLG8saSxhKXtpZighVGUuaXNGaWxlKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9ERVYpO3ZhciBzLHUsYz1lLm5vZGUuY29udGVudHM7aWYoMiZhfHxjLmJ1ZmZlciE9PXQmJmMuYnVmZmVyIT09dC5idWZmZXIpe2lmKChvPjB8fG8rbjxlLm5vZGUudXNlZEJ5dGVzKSYmKGM9Yy5zdWJhcnJheT9jLnN1YmFycmF5KG8sbytuKTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjLG8sbytuKSksdT0hMCwhKHM9SnQobikpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT01FTSk7dC5zZXQoYyxzKX1lbHNlIHU9ITEscz1jLmJ5dGVPZmZzZXQ7cmV0dXJue3B0cjpzLGFsbG9jYXRlZDp1fX0sbXN5bmM6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighVGUuaXNGaWxlKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9ERVYpO2lmKDImbylyZXR1cm4gMDt3ZS5zdHJlYW1fb3BzLndyaXRlKGUsdCwwLG4sciwhMSk7cmV0dXJuIDB9fX0sX2U9e2Riczp7fSxpbmRleGVkREI6ZnVuY3Rpb24oKXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGluZGV4ZWREQilyZXR1cm4gaW5kZXhlZERCO3ZhciBlPW51bGw7cmV0dXJuIm9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJihlPXdpbmRvdy5pbmRleGVkREJ8fHdpbmRvdy5tb3pJbmRleGVkREJ8fHdpbmRvdy53ZWJraXRJbmRleGVkREJ8fHdpbmRvdy5tc0luZGV4ZWREQikseShlLCJJREJGUyB1c2VkLCBidXQgaW5kZXhlZERCIG5vdCBzdXBwb3J0ZWQiKSxlfSxEQl9WRVJTSU9OOjIxLERCX1NUT1JFX05BTUU6IkZJTEVfREFUQSIsbW91bnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlLm1vdW50LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sc3luY2ZzOmZ1bmN0aW9uKGUsdCxyKXtfZS5nZXRMb2NhbFNldChlLChmdW5jdGlvbihuLG8pe2lmKG4pcmV0dXJuIHIobik7X2UuZ2V0UmVtb3RlU2V0KGUsKGZ1bmN0aW9uKGUsbil7aWYoZSlyZXR1cm4gcihlKTt2YXIgaT10P246byxhPXQ/bzpuO19lLnJlY29uY2lsZShpLGEscil9KSl9KSl9LGdldERCOmZ1bmN0aW9uKGUsdCl7dmFyIHIsbj1fZS5kYnNbZV07aWYobilyZXR1cm4gdChudWxsLG4pO3RyeXtyPV9lLmluZGV4ZWREQigpLm9wZW4oZSxfZS5EQl9WRVJTSU9OKX1jYXRjaChlKXtyZXR1cm4gdChlKX1pZighcilyZXR1cm4gdCgiVW5hYmxlIHRvIGNvbm5lY3QgdG8gSW5kZXhlZERCIik7ci5vbnVwZ3JhZGVuZWVkZWQ9ZnVuY3Rpb24oZSl7dmFyIHQscj1lLnRhcmdldC5yZXN1bHQsbj1lLnRhcmdldC50cmFuc2FjdGlvbjsodD1yLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoX2UuREJfU1RPUkVfTkFNRSk/bi5vYmplY3RTdG9yZShfZS5EQl9TVE9SRV9OQU1FKTpyLmNyZWF0ZU9iamVjdFN0b3JlKF9lLkRCX1NUT1JFX05BTUUpKS5pbmRleE5hbWVzLmNvbnRhaW5zKCJ0aW1lc3RhbXAiKXx8dC5jcmVhdGVJbmRleCgidGltZXN0YW1wIiwidGltZXN0YW1wIix7dW5pcXVlOiExfSl9LHIub25zdWNjZXNzPWZ1bmN0aW9uKCl7bj1yLnJlc3VsdCxfZS5kYnNbZV09bix0KG51bGwsbil9LHIub25lcnJvcj1mdW5jdGlvbihlKXt0KHRoaXMuZXJyb3IpLGUucHJldmVudERlZmF1bHQoKX19LGdldExvY2FsU2V0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9e307ZnVuY3Rpb24gbihlKXtyZXR1cm4iLiIhPT1lJiYiLi4iIT09ZX1mdW5jdGlvbiBvKGUpe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gZ2Uuam9pbjIoZSx0KX19Zm9yKHZhciBpPVRlLnJlYWRkaXIoZS5tb3VudHBvaW50KS5maWx0ZXIobikubWFwKG8oZS5tb3VudHBvaW50KSk7aS5sZW5ndGg7KXt2YXIgYSxzPWkucG9wKCk7dHJ5e2E9VGUuc3RhdChzKX1jYXRjaChlKXtyZXR1cm4gdChlKX1UZS5pc0RpcihhLm1vZGUpJiZpLnB1c2guYXBwbHkoaSxUZS5yZWFkZGlyKHMpLmZpbHRlcihuKS5tYXAobyhzKSkpLHJbc109e3RpbWVzdGFtcDphLm10aW1lfX1yZXR1cm4gdChudWxsLHt0eXBlOiJsb2NhbCIsZW50cmllczpyfSl9LGdldFJlbW90ZVNldDpmdW5jdGlvbihlLHQpe3ZhciByPXt9O19lLmdldERCKGUubW91bnRwb2ludCwoZnVuY3Rpb24oZSxuKXtpZihlKXJldHVybiB0KGUpO3RyeXt2YXIgbz1uLnRyYW5zYWN0aW9uKFtfZS5EQl9TVE9SRV9OQU1FXSwicmVhZG9ubHkiKTtvLm9uZXJyb3I9ZnVuY3Rpb24oZSl7dCh0aGlzLmVycm9yKSxlLnByZXZlbnREZWZhdWx0KCl9LG8ub2JqZWN0U3RvcmUoX2UuREJfU1RPUkVfTkFNRSkuaW5kZXgoInRpbWVzdGFtcCIpLm9wZW5LZXlDdXJzb3IoKS5vbnN1Y2Nlc3M9ZnVuY3Rpb24oZSl7dmFyIG89ZS50YXJnZXQucmVzdWx0O2lmKCFvKXJldHVybiB0KG51bGwse3R5cGU6InJlbW90ZSIsZGI6bixlbnRyaWVzOnJ9KTtyW28ucHJpbWFyeUtleV09e3RpbWVzdGFtcDpvLmtleX0sby5jb250aW51ZSgpfX1jYXRjaChlKXtyZXR1cm4gdChlKX19KSl9LGxvYWRMb2NhbEVudHJ5OmZ1bmN0aW9uKGUsdCl7dmFyIHIsbjt0cnl7bj1UZS5sb29rdXBQYXRoKGUpLm5vZGUscj1UZS5zdGF0KGUpfWNhdGNoKGUpe3JldHVybiB0KGUpfXJldHVybiBUZS5pc0RpcihyLm1vZGUpP3QobnVsbCx7dGltZXN0YW1wOnIubXRpbWUsbW9kZTpyLm1vZGV9KTpUZS5pc0ZpbGUoci5tb2RlKT8obi5jb250ZW50cz13ZS5nZXRGaWxlRGF0YUFzVHlwZWRBcnJheShuKSx0KG51bGwse3RpbWVzdGFtcDpyLm10aW1lLG1vZGU6ci5tb2RlLGNvbnRlbnRzOm4uY29udGVudHN9KSk6dChuZXcgRXJyb3IoIm5vZGUgdHlwZSBub3Qgc3VwcG9ydGVkIikpfSxzdG9yZUxvY2FsRW50cnk6ZnVuY3Rpb24oZSx0LHIpe3RyeXtpZihUZS5pc0Rpcih0Lm1vZGUpKVRlLm1rZGlyKGUsdC5tb2RlKTtlbHNle2lmKCFUZS5pc0ZpbGUodC5tb2RlKSlyZXR1cm4gcihuZXcgRXJyb3IoIm5vZGUgdHlwZSBub3Qgc3VwcG9ydGVkIikpO1RlLndyaXRlRmlsZShlLHQuY29udGVudHMse2Nhbk93bjohMH0pfVRlLmNobW9kKGUsdC5tb2RlKSxUZS51dGltZShlLHQudGltZXN0YW1wLHQudGltZXN0YW1wKX1jYXRjaChlKXtyZXR1cm4gcihlKX1yKG51bGwpfSxyZW1vdmVMb2NhbEVudHJ5OmZ1bmN0aW9uKGUsdCl7dHJ5e1RlLmxvb2t1cFBhdGgoZSk7dmFyIHI9VGUuc3RhdChlKTtUZS5pc0RpcihyLm1vZGUpP1RlLnJtZGlyKGUpOlRlLmlzRmlsZShyLm1vZGUpJiZUZS51bmxpbmsoZSl9Y2F0Y2goZSl7cmV0dXJuIHQoZSl9dChudWxsKX0sbG9hZFJlbW90ZUVudHJ5OmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1lLmdldCh0KTtuLm9uc3VjY2Vzcz1mdW5jdGlvbihlKXtyKG51bGwsZS50YXJnZXQucmVzdWx0KX0sbi5vbmVycm9yPWZ1bmN0aW9uKGUpe3IodGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0sc3RvcmVSZW1vdGVFbnRyeTpmdW5jdGlvbihlLHQscixuKXt2YXIgbz1lLnB1dChyLHQpO28ub25zdWNjZXNzPWZ1bmN0aW9uKCl7bihudWxsKX0sby5vbmVycm9yPWZ1bmN0aW9uKGUpe24odGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0scmVtb3ZlUmVtb3RlRW50cnk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUuZGVsZXRlKHQpO24ub25zdWNjZXNzPWZ1bmN0aW9uKCl7cihudWxsKX0sbi5vbmVycm9yPWZ1bmN0aW9uKGUpe3IodGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0scmVjb25jaWxlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj0wLG89W107T2JqZWN0LmtleXMoZS5lbnRyaWVzKS5mb3JFYWNoKChmdW5jdGlvbihyKXt2YXIgaT1lLmVudHJpZXNbcl0sYT10LmVudHJpZXNbcl07KCFhfHxpLnRpbWVzdGFtcD5hLnRpbWVzdGFtcCkmJihvLnB1c2gociksbisrKX0pKTt2YXIgaT1bXTtpZihPYmplY3Qua2V5cyh0LmVudHJpZXMpLmZvckVhY2goKGZ1bmN0aW9uKHIpe3QuZW50cmllc1tyXTtlLmVudHJpZXNbcl18fChpLnB1c2gociksbisrKX0pKSwhbilyZXR1cm4gcihudWxsKTt2YXIgYT0wLHM9KCJyZW1vdGUiPT09ZS50eXBlP2UuZGI6dC5kYikudHJhbnNhY3Rpb24oW19lLkRCX1NUT1JFX05BTUVdLCJyZWFkd3JpdGUiKSx1PXMub2JqZWN0U3RvcmUoX2UuREJfU1RPUkVfTkFNRSk7ZnVuY3Rpb24gYyhlKXtyZXR1cm4gZT9jLmVycm9yZWQ/dm9pZCAwOihjLmVycm9yZWQ9ITAscihlKSk6KythPj1uP3IobnVsbCk6dm9pZCAwfXMub25lcnJvcj1mdW5jdGlvbihlKXtjKHRoaXMuZXJyb3IpLGUucHJldmVudERlZmF1bHQoKX0sby5zb3J0KCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ImxvY2FsIj09PXQudHlwZT9fZS5sb2FkUmVtb3RlRW50cnkodSxlLChmdW5jdGlvbih0LHIpe2lmKHQpcmV0dXJuIGModCk7X2Uuc3RvcmVMb2NhbEVudHJ5KGUscixjKX0pKTpfZS5sb2FkTG9jYWxFbnRyeShlLChmdW5jdGlvbih0LHIpe2lmKHQpcmV0dXJuIGModCk7X2Uuc3RvcmVSZW1vdGVFbnRyeSh1LGUscixjKX0pKX0pKSxpLnNvcnQoKS5yZXZlcnNlKCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ImxvY2FsIj09PXQudHlwZT9fZS5yZW1vdmVMb2NhbEVudHJ5KGUsYyk6X2UucmVtb3ZlUmVtb3RlRW50cnkodSxlLGMpfSkpfX0sYmU9e2lzV2luZG93czohMSxzdGF0aWNJbml0OmZ1bmN0aW9uKCl7YmUuaXNXaW5kb3dzPSEhcHJvY2Vzcy5wbGF0Zm9ybS5tYXRjaCgvXndpbi8pO3ZhciBlPXByb2Nlc3MuYmluZGluZygiY29uc3RhbnRzIik7ZS5mcyYmKGU9ZS5mcyksYmUuZmxhZ3NGb3JOb2RlTWFwPXsxMDI0OmUuT19BUFBFTkQsNjQ6ZS5PX0NSRUFULDEyODplLk9fRVhDTCwwOmUuT19SRE9OTFksMjplLk9fUkRXUiw0MDk2OmUuT19TWU5DLDUxMjplLk9fVFJVTkMsMTplLk9fV1JPTkxZfX0sYnVmZmVyRnJvbTpmdW5jdGlvbihlKXtyZXR1cm4gQnVmZmVyLmFsbG9jP0J1ZmZlci5mcm9tKGUpOm5ldyBCdWZmZXIoZSl9LG1vdW50OmZ1bmN0aW9uKGUpe3JldHVybiB5KGwpLGJlLmNyZWF0ZU5vZGUobnVsbCwiLyIsYmUuZ2V0TW9kZShlLm9wdHMucm9vdCksMCl9LGNyZWF0ZU5vZGU6ZnVuY3Rpb24oZSx0LHIsbil7aWYoIVRlLmlzRGlyKHIpJiYhVGUuaXNGaWxlKHIpJiYhVGUuaXNMaW5rKHIpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIG89VGUuY3JlYXRlTm9kZShlLHQscik7cmV0dXJuIG8ubm9kZV9vcHM9YmUubm9kZV9vcHMsby5zdHJlYW1fb3BzPWJlLnN0cmVhbV9vcHMsb30sZ2V0TW9kZTpmdW5jdGlvbihlKXt2YXIgdDt0cnl7dD1mcy5sc3RhdFN5bmMoZSksYmUuaXNXaW5kb3dzJiYodC5tb2RlPXQubW9kZXwoMjkyJnQubW9kZSk+PjIpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX1yZXR1cm4gdC5tb2RlfSxyZWFsUGF0aDpmdW5jdGlvbihlKXtmb3IodmFyIHQ9W107ZS5wYXJlbnQhPT1lOyl0LnB1c2goZS5uYW1lKSxlPWUucGFyZW50O3JldHVybiB0LnB1c2goZS5tb3VudC5vcHRzLnJvb3QpLHQucmV2ZXJzZSgpLGdlLmpvaW4uYXBwbHkobnVsbCx0KX0sZmxhZ3NGb3JOb2RlOmZ1bmN0aW9uKGUpe2UmPS0yMDk3MTUzLGUmPS0yMDQ5LGUmPS0zMjc2OSxlJj0tNTI0Mjg5O3ZhciB0PTA7Zm9yKHZhciByIGluIGJlLmZsYWdzRm9yTm9kZU1hcCllJnImJih0fD1iZS5mbGFnc0Zvck5vZGVNYXBbcl0sZV49cik7aWYoZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiB0fSxub2RlX29wczp7Z2V0YXR0cjpmdW5jdGlvbihlKXt2YXIgdCxyPWJlLnJlYWxQYXRoKGUpO3RyeXt0PWZzLmxzdGF0U3luYyhyKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9cmV0dXJuIGJlLmlzV2luZG93cyYmIXQuYmxrc2l6ZSYmKHQuYmxrc2l6ZT00MDk2KSxiZS5pc1dpbmRvd3MmJiF0LmJsb2NrcyYmKHQuYmxvY2tzPSh0LnNpemUrdC5ibGtzaXplLTEpL3QuYmxrc2l6ZXwwKSx7ZGV2OnQuZGV2LGlubzp0Lmlubyxtb2RlOnQubW9kZSxubGluazp0Lm5saW5rLHVpZDp0LnVpZCxnaWQ6dC5naWQscmRldjp0LnJkZXYsc2l6ZTp0LnNpemUsYXRpbWU6dC5hdGltZSxtdGltZTp0Lm10aW1lLGN0aW1lOnQuY3RpbWUsYmxrc2l6ZTp0LmJsa3NpemUsYmxvY2tzOnQuYmxvY2tzfX0sc2V0YXR0cjpmdW5jdGlvbihlLHQpe3ZhciByPWJlLnJlYWxQYXRoKGUpO3RyeXtpZih2b2lkIDAhPT10Lm1vZGUmJihmcy5jaG1vZFN5bmMocix0Lm1vZGUpLGUubW9kZT10Lm1vZGUpLHZvaWQgMCE9PXQudGltZXN0YW1wKXt2YXIgbj1uZXcgRGF0ZSh0LnRpbWVzdGFtcCk7ZnMudXRpbWVzU3luYyhyLG4sbil9dm9pZCAwIT09dC5zaXplJiZmcy50cnVuY2F0ZVN5bmMocix0LnNpemUpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGxvb2t1cDpmdW5jdGlvbihlLHQpe3ZhciByPWdlLmpvaW4yKGJlLnJlYWxQYXRoKGUpLHQpLG49YmUuZ2V0TW9kZShyKTtyZXR1cm4gYmUuY3JlYXRlTm9kZShlLHQsbil9LG1rbm9kOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWJlLmNyZWF0ZU5vZGUoZSx0LHIsbiksaT1iZS5yZWFsUGF0aChvKTt0cnl7VGUuaXNEaXIoby5tb2RlKT9mcy5ta2RpclN5bmMoaSxvLm1vZGUpOmZzLndyaXRlRmlsZVN5bmMoaSwiIix7bW9kZTpvLm1vZGV9KX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9cmV0dXJuIG99LHJlbmFtZTpmdW5jdGlvbihlLHQscil7dmFyIG49YmUucmVhbFBhdGgoZSksbz1nZS5qb2luMihiZS5yZWFsUGF0aCh0KSxyKTt0cnl7ZnMucmVuYW1lU3luYyhuLG8pfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LHVubGluazpmdW5jdGlvbihlLHQpe3ZhciByPWdlLmpvaW4yKGJlLnJlYWxQYXRoKGUpLHQpO3RyeXtmcy51bmxpbmtTeW5jKHIpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LHJtZGlyOmZ1bmN0aW9uKGUsdCl7dmFyIHI9Z2Uuam9pbjIoYmUucmVhbFBhdGgoZSksdCk7dHJ5e2ZzLnJtZGlyU3luYyhyKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSxyZWFkZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PWJlLnJlYWxQYXRoKGUpO3RyeXtyZXR1cm4gZnMucmVhZGRpclN5bmModCl9Y2F0Y2goZSl7aWYoIWUuY29kZSl0aHJvdyBlO3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lW2UuY29kZV0pfX0sc3ltbGluazpmdW5jdGlvbihlLHQscil7dmFyIG49Z2Uuam9pbjIoYmUucmVhbFBhdGgoZSksdCk7dHJ5e2ZzLnN5bWxpbmtTeW5jKHIsbil9Y2F0Y2goZSl7aWYoIWUuY29kZSl0aHJvdyBlO3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lW2UuY29kZV0pfX0scmVhZGxpbms6ZnVuY3Rpb24oZSl7dmFyIHQ9YmUucmVhbFBhdGgoZSk7dHJ5e3JldHVybiB0PWZzLnJlYWRsaW5rU3luYyh0KSx0PU5PREVKU19QQVRILnJlbGF0aXZlKE5PREVKU19QQVRILnJlc29sdmUoZS5tb3VudC5vcHRzLnJvb3QpLHQpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19fSxzdHJlYW1fb3BzOntvcGVuOmZ1bmN0aW9uKGUpe3ZhciB0PWJlLnJlYWxQYXRoKGUubm9kZSk7dHJ5e1RlLmlzRmlsZShlLm5vZGUubW9kZSkmJihlLm5mZD1mcy5vcGVuU3luYyh0LGJlLmZsYWdzRm9yTm9kZShlLmZsYWdzKSkpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGNsb3NlOmZ1bmN0aW9uKGUpe3RyeXtUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiZlLm5mZCYmZnMuY2xvc2VTeW5jKGUubmZkKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSxyZWFkOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoMD09PW4pcmV0dXJuIDA7dHJ5e3JldHVybiBmcy5yZWFkU3luYyhlLm5mZCxiZS5idWZmZXJGcm9tKHQuYnVmZmVyKSxyLG4sbyl9Y2F0Y2goZSl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8pe3RyeXtyZXR1cm4gZnMud3JpdGVTeW5jKGUubmZkLGJlLmJ1ZmZlckZyb20odC5idWZmZXIpLHIsbixvKX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09ciluKz1lLnBvc2l0aW9uO2Vsc2UgaWYoMj09PXImJlRlLmlzRmlsZShlLm5vZGUubW9kZSkpdHJ5e24rPWZzLmZzdGF0U3luYyhlLm5mZCkuc2l6ZX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX1pZihuPDApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtyZXR1cm4gbn19fSxBZT17RElSX01PREU6MTY4OTUsRklMRV9NT0RFOjMzMjc5LHJlYWRlcjpudWxsLG1vdW50OmZ1bmN0aW9uKGUpe3koYyksQWUucmVhZGVyfHwoQWUucmVhZGVyPW5ldyBGaWxlUmVhZGVyU3luYyk7dmFyIHQ9QWUuY3JlYXRlTm9kZShudWxsLCIvIixBZS5ESVJfTU9ERSwwKSxyPXt9O2Z1bmN0aW9uIG4oZSl7Zm9yKHZhciBuPWUuc3BsaXQoIi8iKSxvPXQsaT0wO2k8bi5sZW5ndGgtMTtpKyspe3ZhciBhPW4uc2xpY2UoMCxpKzEpLmpvaW4oIi8iKTtyW2FdfHwoclthXT1BZS5jcmVhdGVOb2RlKG8sbltpXSxBZS5ESVJfTU9ERSwwKSksbz1yW2FdfXJldHVybiBvfWZ1bmN0aW9uIG8oZSl7dmFyIHQ9ZS5zcGxpdCgiLyIpO3JldHVybiB0W3QubGVuZ3RoLTFdfXJldHVybiBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGUub3B0cy5maWxlc3x8W10sKGZ1bmN0aW9uKGUpe0FlLmNyZWF0ZU5vZGUobihlLm5hbWUpLG8oZS5uYW1lKSxBZS5GSUxFX01PREUsMCxlLGUubGFzdE1vZGlmaWVkRGF0ZSl9KSksKGUub3B0cy5ibG9ic3x8W10pLmZvckVhY2goKGZ1bmN0aW9uKGUpe0FlLmNyZWF0ZU5vZGUobihlLm5hbWUpLG8oZS5uYW1lKSxBZS5GSUxFX01PREUsMCxlLmRhdGEpfSkpLChlLm9wdHMucGFja2FnZXN8fFtdKS5mb3JFYWNoKChmdW5jdGlvbihlKXtlLm1ldGFkYXRhLmZpbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciByPXQuZmlsZW5hbWUuc3Vic3RyKDEpO0FlLmNyZWF0ZU5vZGUobihyKSxvKHIpLEFlLkZJTEVfTU9ERSwwLGUuYmxvYi5zbGljZSh0LnN0YXJ0LHQuZW5kKSl9KSl9KSksdH0sY3JlYXRlTm9kZTpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9VGUuY3JlYXRlTm9kZShlLHQscik7cmV0dXJuIGEubW9kZT1yLGEubm9kZV9vcHM9QWUubm9kZV9vcHMsYS5zdHJlYW1fb3BzPUFlLnN0cmVhbV9vcHMsYS50aW1lc3RhbXA9KGl8fG5ldyBEYXRlKS5nZXRUaW1lKCkseShBZS5GSUxFX01PREUhPT1BZS5ESVJfTU9ERSkscj09PUFlLkZJTEVfTU9ERT8oYS5zaXplPW8uc2l6ZSxhLmNvbnRlbnRzPW8pOihhLnNpemU9NDA5NixhLmNvbnRlbnRzPXt9KSxlJiYoZS5jb250ZW50c1t0XT1hKSxhfSxub2RlX29wczp7Z2V0YXR0cjpmdW5jdGlvbihlKXtyZXR1cm57ZGV2OjEsaW5vOnZvaWQgMCxtb2RlOmUubW9kZSxubGluazoxLHVpZDowLGdpZDowLHJkZXY6dm9pZCAwLHNpemU6ZS5zaXplLGF0aW1lOm5ldyBEYXRlKGUudGltZXN0YW1wKSxtdGltZTpuZXcgRGF0ZShlLnRpbWVzdGFtcCksY3RpbWU6bmV3IERhdGUoZS50aW1lc3RhbXApLGJsa3NpemU6NDA5NixibG9ja3M6TWF0aC5jZWlsKGUuc2l6ZS80MDk2KX19LHNldGF0dHI6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT10Lm1vZGUmJihlLm1vZGU9dC5tb2RlKSx2b2lkIDAhPT10LnRpbWVzdGFtcCYmKGUudGltZXN0YW1wPXQudGltZXN0YW1wKX0sbG9va3VwOmZ1bmN0aW9uKGUsdCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKX0sbWtub2Q6ZnVuY3Rpb24oZSx0LHIsbil7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxyZW5hbWU6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKX0sdW5saW5rOmZ1bmN0aW9uKGUsdCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxybWRpcjpmdW5jdGlvbihlLHQpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKX0scmVhZGRpcjpmdW5jdGlvbihlKXt2YXIgdD1bIi4iLCIuLiJdO2Zvcih2YXIgciBpbiBlLmNvbnRlbnRzKWUuY29udGVudHMuaGFzT3duUHJvcGVydHkocikmJnQucHVzaChyKTtyZXR1cm4gdH0sc3ltbGluazpmdW5jdGlvbihlLHQscil7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxyZWFkbGluazpmdW5jdGlvbihlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSl9fSxzdHJlYW1fb3BzOntyZWFkOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYobz49ZS5ub2RlLnNpemUpcmV0dXJuIDA7dmFyIGk9ZS5ub2RlLmNvbnRlbnRzLnNsaWNlKG8sbytuKSxhPUFlLnJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihpKTtyZXR1cm4gdC5zZXQobmV3IFVpbnQ4QXJyYXkoYSksciksaS5zaXplfSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8pe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09cj9uKz1lLnBvc2l0aW9uOjI9PT1yJiZUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiYobis9ZS5ub2RlLnNpemUpLG48MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiBufX19O0wrPTE2LEwrPTE2O3ZhciBUZT17cm9vdDpudWxsLG1vdW50czpbXSxkZXZpY2VzOnt9LHN0cmVhbXM6W10sbmV4dElub2RlOjEsbmFtZVRhYmxlOm51bGwsY3VycmVudFBhdGg6Ii8iLGluaXRpYWxpemVkOiExLGlnbm9yZVBlcm1pc3Npb25zOiEwLHRyYWNraW5nRGVsZWdhdGU6e30sdHJhY2tpbmc6e29wZW5GbGFnczp7UkVBRDoxLFdSSVRFOjJ9fSxFcnJub0Vycm9yOm51bGwsZ2VuZXJpY0Vycm9yczp7fSxmaWxlc3lzdGVtczpudWxsLHN5bmNGU1JlcXVlc3RzOjAsaGFuZGxlRlNFcnJvcjpmdW5jdGlvbihlKXtpZighKGUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yKSl0aHJvdyBlKyIgOiAiK1AoKTtyZXR1cm4geWUoZS5lcnJubyl9LGxvb2t1cFBhdGg6ZnVuY3Rpb24oZSx0KXtpZih0PXR8fHt9LCEoZT1nZS5yZXNvbHZlKFRlLmN3ZCgpLGUpKSlyZXR1cm57cGF0aDoiIixub2RlOm51bGx9O3ZhciByPXtmb2xsb3dfbW91bnQ6ITAscmVjdXJzZV9jb3VudDowfTtmb3IodmFyIG4gaW4gcil2b2lkIDA9PT10W25dJiYodFtuXT1yW25dKTtpZih0LnJlY3Vyc2VfY291bnQ+OCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTE9PUCk7Zm9yKHZhciBvPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhMSksaT1UZS5yb290LGE9Ii8iLHM9MDtzPG8ubGVuZ3RoO3MrKyl7dmFyIHU9cz09PW8ubGVuZ3RoLTE7aWYodSYmdC5wYXJlbnQpYnJlYWs7aWYoaT1UZS5sb29rdXBOb2RlKGksb1tzXSksYT1nZS5qb2luMihhLG9bc10pLFRlLmlzTW91bnRwb2ludChpKSYmKCF1fHx1JiZ0LmZvbGxvd19tb3VudCkmJihpPWkubW91bnRlZC5yb290KSwhdXx8dC5mb2xsb3cpZm9yKHZhciBjPTA7VGUuaXNMaW5rKGkubW9kZSk7KXt2YXIgbD1UZS5yZWFkbGluayhhKTtpZihhPWdlLnJlc29sdmUoZ2UuZGlybmFtZShhKSxsKSxpPVRlLmxvb2t1cFBhdGgoYSx7cmVjdXJzZV9jb3VudDp0LnJlY3Vyc2VfY291bnR9KS5ub2RlLGMrKz40MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTE9PUCl9fXJldHVybntwYXRoOmEsbm9kZTppfX0sZ2V0UGF0aDpmdW5jdGlvbihlKXtmb3IodmFyIHQ7Oyl7aWYoVGUuaXNSb290KGUpKXt2YXIgcj1lLm1vdW50Lm1vdW50cG9pbnQ7cmV0dXJuIHQ/Ii8iIT09cltyLmxlbmd0aC0xXT9yKyIvIit0OnIrdDpyfXQ9dD9lLm5hbWUrIi8iK3Q6ZS5uYW1lLGU9ZS5wYXJlbnR9fSxoYXNoTmFtZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj0wLG49MDtuPHQubGVuZ3RoO24rKylyPShyPDw1KS1yK3QuY2hhckNvZGVBdChuKXwwO3JldHVybihlK3I+Pj4wKSVUZS5uYW1lVGFibGUubGVuZ3RofSxoYXNoQWRkTm9kZTpmdW5jdGlvbihlKXt2YXIgdD1UZS5oYXNoTmFtZShlLnBhcmVudC5pZCxlLm5hbWUpO2UubmFtZV9uZXh0PVRlLm5hbWVUYWJsZVt0XSxUZS5uYW1lVGFibGVbdF09ZX0saGFzaFJlbW92ZU5vZGU6ZnVuY3Rpb24oZSl7dmFyIHQ9VGUuaGFzaE5hbWUoZS5wYXJlbnQuaWQsZS5uYW1lKTtpZihUZS5uYW1lVGFibGVbdF09PT1lKVRlLm5hbWVUYWJsZVt0XT1lLm5hbWVfbmV4dDtlbHNlIGZvcih2YXIgcj1UZS5uYW1lVGFibGVbdF07cjspe2lmKHIubmFtZV9uZXh0PT09ZSl7ci5uYW1lX25leHQ9ZS5uYW1lX25leHQ7YnJlYWt9cj1yLm5hbWVfbmV4dH19LGxvb2t1cE5vZGU6ZnVuY3Rpb24oZSx0KXt2YXIgcj1UZS5tYXlMb29rdXAoZSk7aWYocil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihyLGUpO2Zvcih2YXIgbj1UZS5oYXNoTmFtZShlLmlkLHQpLG89VGUubmFtZVRhYmxlW25dO287bz1vLm5hbWVfbmV4dCl7dmFyIGk9by5uYW1lO2lmKG8ucGFyZW50LmlkPT09ZS5pZCYmaT09PXQpcmV0dXJuIG99cmV0dXJuIFRlLmxvb2t1cChlLHQpfSxjcmVhdGVOb2RlOmZ1bmN0aW9uKGUsdCxyLG4pe2lmKCFUZS5GU05vZGUpe1RlLkZTTm9kZT1mdW5jdGlvbihlLHQscixuKXtlfHwoZT10aGlzKSx0aGlzLnBhcmVudD1lLHRoaXMubW91bnQ9ZS5tb3VudCx0aGlzLm1vdW50ZWQ9bnVsbCx0aGlzLmlkPVRlLm5leHRJbm9kZSsrLHRoaXMubmFtZT10LHRoaXMubW9kZT1yLHRoaXMubm9kZV9vcHM9e30sdGhpcy5zdHJlYW1fb3BzPXt9LHRoaXMucmRldj1ufSxUZS5GU05vZGUucHJvdG90eXBlPXt9O09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKFRlLkZTTm9kZS5wcm90b3R5cGUse3JlYWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiAzNjU9PSgzNjUmdGhpcy5tb2RlKX0sc2V0OmZ1bmN0aW9uKGUpe2U/dGhpcy5tb2RlfD0zNjU6dGhpcy5tb2RlJj0tMzY2fX0sd3JpdGU6e2dldDpmdW5jdGlvbigpe3JldHVybiAxNDY9PSgxNDYmdGhpcy5tb2RlKX0sc2V0OmZ1bmN0aW9uKGUpe2U/dGhpcy5tb2RlfD0xNDY6dGhpcy5tb2RlJj0tMTQ3fX0saXNGb2xkZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBUZS5pc0Rpcih0aGlzLm1vZGUpfX0saXNEZXZpY2U6e2dldDpmdW5jdGlvbigpe3JldHVybiBUZS5pc0NocmRldih0aGlzLm1vZGUpfX19KX12YXIgbz1uZXcgVGUuRlNOb2RlKGUsdCxyLG4pO3JldHVybiBUZS5oYXNoQWRkTm9kZShvKSxvfSxkZXN0cm95Tm9kZTpmdW5jdGlvbihlKXtUZS5oYXNoUmVtb3ZlTm9kZShlKX0saXNSb290OmZ1bmN0aW9uKGUpe3JldHVybiBlPT09ZS5wYXJlbnR9LGlzTW91bnRwb2ludDpmdW5jdGlvbihlKXtyZXR1cm4hIWUubW91bnRlZH0saXNGaWxlOmZ1bmN0aW9uKGUpe3JldHVybiAzMjc2OD09KDYxNDQwJmUpfSxpc0RpcjpmdW5jdGlvbihlKXtyZXR1cm4gMTYzODQ9PSg2MTQ0MCZlKX0saXNMaW5rOmZ1bmN0aW9uKGUpe3JldHVybiA0MDk2MD09KDYxNDQwJmUpfSxpc0NocmRldjpmdW5jdGlvbihlKXtyZXR1cm4gODE5Mj09KDYxNDQwJmUpfSxpc0Jsa2RldjpmdW5jdGlvbihlKXtyZXR1cm4gMjQ1NzY9PSg2MTQ0MCZlKX0saXNGSUZPOmZ1bmN0aW9uKGUpe3JldHVybiA0MDk2PT0oNjE0NDAmZSl9LGlzU29ja2V0OmZ1bmN0aW9uKGUpe3JldHVybiA0OTE1Mj09KDQ5MTUyJmUpfSxmbGFnTW9kZXM6e3I6MCxyczoxMDUyNjcyLCJyKyI6Mix3OjU3Nyx3eDo3MDUseHc6NzA1LCJ3KyI6NTc4LCJ3eCsiOjcwNiwieHcrIjo3MDYsYToxMDg5LGF4OjEyMTcseGE6MTIxNywiYSsiOjEwOTAsImF4KyI6MTIxOCwieGErIjoxMjE4fSxtb2RlU3RyaW5nVG9GbGFnczpmdW5jdGlvbihlKXt2YXIgdD1UZS5mbGFnTW9kZXNbZV07aWYodm9pZCAwPT09dCl0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gZmlsZSBvcGVuIG1vZGU6ICIrZSk7cmV0dXJuIHR9LGZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nOmZ1bmN0aW9uKGUpe3ZhciB0PVsiciIsInciLCJydyJdWzMmZV07cmV0dXJuIDUxMiZlJiYodCs9InciKSx0fSxub2RlUGVybWlzc2lvbnM6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gVGUuaWdub3JlUGVybWlzc2lvbnN8fCgtMT09PXQuaW5kZXhPZigiciIpfHwyOTImZS5tb2RlKSYmKC0xPT09dC5pbmRleE9mKCJ3Iil8fDE0NiZlLm1vZGUpJiYoLTE9PT10LmluZGV4T2YoIngiKXx8NzMmZS5tb2RlKT8wOm1lLkVBQ0NFU30sbWF5TG9va3VwOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLm5vZGVQZXJtaXNzaW9ucyhlLCJ4Iik7cmV0dXJuIHR8fChlLm5vZGVfb3BzLmxvb2t1cD8wOm1lLkVBQ0NFUyl9LG1heUNyZWF0ZTpmdW5jdGlvbihlLHQpe3RyeXtUZS5sb29rdXBOb2RlKGUsdCk7cmV0dXJuIG1lLkVFWElTVH1jYXRjaChlKXt9cmV0dXJuIFRlLm5vZGVQZXJtaXNzaW9ucyhlLCJ3eCIpfSxtYXlEZWxldGU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuO3RyeXtuPVRlLmxvb2t1cE5vZGUoZSx0KX1jYXRjaChlKXtyZXR1cm4gZS5lcnJub312YXIgbz1UZS5ub2RlUGVybWlzc2lvbnMoZSwid3giKTtpZihvKXJldHVybiBvO2lmKHIpe2lmKCFUZS5pc0RpcihuLm1vZGUpKXJldHVybiBtZS5FTk9URElSO2lmKFRlLmlzUm9vdChuKXx8VGUuZ2V0UGF0aChuKT09PVRlLmN3ZCgpKXJldHVybiBtZS5FQlVTWX1lbHNlIGlmKFRlLmlzRGlyKG4ubW9kZSkpcmV0dXJuIG1lLkVJU0RJUjtyZXR1cm4gMH0sbWF5T3BlbjpmdW5jdGlvbihlLHQpe3JldHVybiBlP1RlLmlzTGluayhlLm1vZGUpP21lLkVMT09QOlRlLmlzRGlyKGUubW9kZSkmJigiciIhPT1UZS5mbGFnc1RvUGVybWlzc2lvblN0cmluZyh0KXx8NTEyJnQpP21lLkVJU0RJUjpUZS5ub2RlUGVybWlzc2lvbnMoZSxUZS5mbGFnc1RvUGVybWlzc2lvblN0cmluZyh0KSk6bWUuRU5PRU5UfSxNQVhfT1BFTl9GRFM6NDA5NixuZXh0ZmQ6ZnVuY3Rpb24oZSx0KXtlPWV8fDAsdD10fHxUZS5NQVhfT1BFTl9GRFM7Zm9yKHZhciByPWU7cjw9dDtyKyspaWYoIVRlLnN0cmVhbXNbcl0pcmV0dXJuIHI7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU1GSUxFKX0sZ2V0U3RyZWFtOmZ1bmN0aW9uKGUpe3JldHVybiBUZS5zdHJlYW1zW2VdfSxjcmVhdGVTdHJlYW06ZnVuY3Rpb24oZSx0LHIpe1RlLkZTU3RyZWFtfHwoVGUuRlNTdHJlYW09ZnVuY3Rpb24oKXt9LFRlLkZTU3RyZWFtLnByb3RvdHlwZT17fSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyhUZS5GU1N0cmVhbS5wcm90b3R5cGUse29iamVjdDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubm9kZX0sc2V0OmZ1bmN0aW9uKGUpe3RoaXMubm9kZT1lfX0saXNSZWFkOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMSE9KDIwOTcxNTUmdGhpcy5mbGFncyl9fSxpc1dyaXRlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMCE9KDIwOTcxNTUmdGhpcy5mbGFncyl9fSxpc0FwcGVuZDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDEwMjQmdGhpcy5mbGFnc319fSkpO3ZhciBuPW5ldyBUZS5GU1N0cmVhbTtmb3IodmFyIG8gaW4gZSluW29dPWVbb107ZT1uO3ZhciBpPVRlLm5leHRmZCh0LHIpO3JldHVybiBlLmZkPWksVGUuc3RyZWFtc1tpXT1lLGV9LGNsb3NlU3RyZWFtOmZ1bmN0aW9uKGUpe1RlLnN0cmVhbXNbZV09bnVsbH0sY2hyZGV2X3N0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oZSl7dmFyIHQ9VGUuZ2V0RGV2aWNlKGUubm9kZS5yZGV2KTtlLnN0cmVhbV9vcHM9dC5zdHJlYW1fb3BzLGUuc3RyZWFtX29wcy5vcGVuJiZlLnN0cmVhbV9vcHMub3BlbihlKX0sbGxzZWVrOmZ1bmN0aW9uKCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVNQSVBFKX19LG1ham9yOmZ1bmN0aW9uKGUpe3JldHVybiBlPj44fSxtaW5vcjpmdW5jdGlvbihlKXtyZXR1cm4gMjU1JmV9LG1ha2VkZXY6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZTw8OHx0fSxyZWdpc3RlckRldmljZTpmdW5jdGlvbihlLHQpe1RlLmRldmljZXNbZV09e3N0cmVhbV9vcHM6dH19LGdldERldmljZTpmdW5jdGlvbihlKXtyZXR1cm4gVGUuZGV2aWNlc1tlXX0sZ2V0TW91bnRzOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxyPVtlXTtyLmxlbmd0aDspe3ZhciBuPXIucG9wKCk7dC5wdXNoKG4pLHIucHVzaC5hcHBseShyLG4ubW91bnRzKX1yZXR1cm4gdH0sc3luY2ZzOmZ1bmN0aW9uKGUsdCl7ImZ1bmN0aW9uIj09dHlwZW9mIGUmJih0PWUsZT0hMSksVGUuc3luY0ZTUmVxdWVzdHMrKyxUZS5zeW5jRlNSZXF1ZXN0cz4xJiZjb25zb2xlLmxvZygid2FybmluZzogIitUZS5zeW5jRlNSZXF1ZXN0cysiIEZTLnN5bmNmcyBvcGVyYXRpb25zIGluIGZsaWdodCBhdCBvbmNlLCBwcm9iYWJseSBqdXN0IGRvaW5nIGV4dHJhIHdvcmsiKTt2YXIgcj1UZS5nZXRNb3VudHMoVGUucm9vdC5tb3VudCksbj0wO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIHkoVGUuc3luY0ZTUmVxdWVzdHM+MCksVGUuc3luY0ZTUmVxdWVzdHMtLSx0KGUpfWZ1bmN0aW9uIGkoZSl7aWYoZSlyZXR1cm4gaS5lcnJvcmVkP3ZvaWQgMDooaS5lcnJvcmVkPSEwLG8oZSkpOysrbj49ci5sZW5ndGgmJm8obnVsbCl9ci5mb3JFYWNoKChmdW5jdGlvbih0KXtpZighdC50eXBlLnN5bmNmcylyZXR1cm4gaShudWxsKTt0LnR5cGUuc3luY2ZzKHQsZSxpKX0pKX0sbW91bnQ6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuLG89Ii8iPT09cixpPSFyO2lmKG8mJlRlLnJvb3QpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO2lmKCFvJiYhaSl7dmFyIGE9VGUubG9va3VwUGF0aChyLHtmb2xsb3dfbW91bnQ6ITF9KTtpZihyPWEucGF0aCxuPWEubm9kZSxUZS5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO2lmKCFUZS5pc0RpcihuLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RESVIpfXZhciBzPXt0eXBlOmUsb3B0czp0LG1vdW50cG9pbnQ6cixtb3VudHM6W119LHU9ZS5tb3VudChzKTtyZXR1cm4gdS5tb3VudD1zLHMucm9vdD11LG8/VGUucm9vdD11Om4mJihuLm1vdW50ZWQ9cyxuLm1vdW50JiZuLm1vdW50Lm1vdW50cy5wdXNoKHMpKSx1fSx1bm1vdW50OmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93X21vdW50OiExfSk7aWYoIVRlLmlzTW91bnRwb2ludCh0Lm5vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIHI9dC5ub2RlLG49ci5tb3VudGVkLG89VGUuZ2V0TW91bnRzKG4pO09iamVjdC5rZXlzKFRlLm5hbWVUYWJsZSkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVRlLm5hbWVUYWJsZVtlXTt0Oyl7dmFyIHI9dC5uYW1lX25leHQ7LTEhPT1vLmluZGV4T2YodC5tb3VudCkmJlRlLmRlc3Ryb3lOb2RlKHQpLHQ9cn19KSksci5tb3VudGVkPW51bGw7dmFyIGk9ci5tb3VudC5tb3VudHMuaW5kZXhPZihuKTt5KC0xIT09aSksci5tb3VudC5tb3VudHMuc3BsaWNlKGksMSl9LGxvb2t1cDpmdW5jdGlvbihlLHQpe3JldHVybiBlLm5vZGVfb3BzLmxvb2t1cChlLHQpfSxta25vZDpmdW5jdGlvbihlLHQscil7dmFyIG49VGUubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLG89Z2UuYmFzZW5hbWUoZSk7aWYoIW98fCIuIj09PW98fCIuLiI9PT1vKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIGk9VGUubWF5Q3JlYXRlKG4sbyk7aWYoaSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihpKTtpZighbi5ub2RlX29wcy5ta25vZCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIG4ubm9kZV9vcHMubWtub2QobixvLHQscil9LGNyZWF0ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0PXZvaWQgMCE9PXQ/dDo0MzgsdCY9NDA5NSx0fD0zMjc2OCxUZS5ta25vZChlLHQsMCl9LG1rZGlyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQ9dm9pZCAwIT09dD90OjUxMSx0Jj0xMDIzLHR8PTE2Mzg0LFRlLm1rbm9kKGUsdCwwKX0sbWtkaXJUcmVlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPWUuc3BsaXQoIi8iKSxuPSIiLG89MDtvPHIubGVuZ3RoOysrbylpZihyW29dKXtuKz0iLyIrcltvXTt0cnl7VGUubWtkaXIobix0KX1jYXRjaChlKXtpZihlLmVycm5vIT1tZS5FRVhJU1QpdGhyb3cgZX19fSxta2RldjpmdW5jdGlvbihlLHQscil7cmV0dXJuIHZvaWQgMD09PXImJihyPXQsdD00MzgpLHR8PTgxOTIsVGUubWtub2QoZSx0LHIpfSxzeW1saW5rOmZ1bmN0aW9uKGUsdCl7aWYoIWdlLnJlc29sdmUoZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTt2YXIgcj1UZS5sb29rdXBQYXRoKHQse3BhcmVudDohMH0pLm5vZGU7aWYoIXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTt2YXIgbj1nZS5iYXNlbmFtZSh0KSxvPVRlLm1heUNyZWF0ZShyLG4pO2lmKG8pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3Iobyk7aWYoIXIubm9kZV9vcHMuc3ltbGluayl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIHIubm9kZV9vcHMuc3ltbGluayhyLG4sZSl9LHJlbmFtZTpmdW5jdGlvbihlLHQpe3ZhciByLG4sbz1nZS5kaXJuYW1lKGUpLGk9Z2UuZGlybmFtZSh0KSxhPWdlLmJhc2VuYW1lKGUpLHM9Z2UuYmFzZW5hbWUodCk7dHJ5e3I9VGUubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLG49VGUubG9va3VwUGF0aCh0LHtwYXJlbnQ6ITB9KS5ub2RlfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKX1pZighcnx8IW4pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTtpZihyLm1vdW50IT09bi5tb3VudCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FWERFVik7dmFyIHUsYz1UZS5sb29rdXBOb2RlKHIsYSksbD1nZS5yZWxhdGl2ZShlLGkpO2lmKCIuIiE9PWwuY2hhckF0KDApKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7aWYoIi4iIT09KGw9Z2UucmVsYXRpdmUodCxvKSkuY2hhckF0KDApKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RFTVBUWSk7dHJ5e3U9VGUubG9va3VwTm9kZShuLHMpfWNhdGNoKGUpe31pZihjIT09dSl7dmFyIGY9VGUuaXNEaXIoYy5tb2RlKSxkPVRlLm1heURlbGV0ZShyLGEsZik7aWYoZCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihkKTtpZihkPXU/VGUubWF5RGVsZXRlKG4scyxmKTpUZS5tYXlDcmVhdGUobixzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihkKTtpZighci5ub2RlX29wcy5yZW5hbWUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pO2lmKFRlLmlzTW91bnRwb2ludChjKXx8dSYmVGUuaXNNb3VudHBvaW50KHUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKTtpZihuIT09ciYmKGQ9VGUubm9kZVBlcm1pc3Npb25zKHIsInciKSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IoZCk7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUud2lsbE1vdmVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLndpbGxNb3ZlUGF0aChlLHQpfWNhdGNoKHIpe2NvbnNvbGUubG9nKCJGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsTW92ZVBhdGgnXSgnIitlKyInLCAnIit0KyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrci5tZXNzYWdlKX1UZS5oYXNoUmVtb3ZlTm9kZShjKTt0cnl7ci5ub2RlX29wcy5yZW5hbWUoYyxuLHMpfWNhdGNoKGUpe3Rocm93IGV9ZmluYWxseXtUZS5oYXNoQWRkTm9kZShjKX10cnl7VGUudHJhY2tpbmdEZWxlZ2F0ZS5vbk1vdmVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uTW92ZVBhdGgoZSx0KX1jYXRjaChyKXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25Nb3ZlUGF0aCddKCciK2UrIicsICciK3QrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIityLm1lc3NhZ2UpfX19LHJtZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSkubm9kZSxyPWdlLmJhc2VuYW1lKGUpLG49VGUubG9va3VwTm9kZSh0LHIpLG89VGUubWF5RGVsZXRlKHQsciwhMCk7aWYobyl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihvKTtpZighdC5ub2RlX29wcy5ybWRpcil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7aWYoVGUuaXNNb3VudHBvaW50KG4pKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKTt0cnl7VGUudHJhY2tpbmdEZWxlZ2F0ZS53aWxsRGVsZXRlUGF0aCYmVGUudHJhY2tpbmdEZWxlZ2F0ZS53aWxsRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbERlbGV0ZVBhdGgnXSgnIitlKyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrdC5tZXNzYWdlKX10Lm5vZGVfb3BzLnJtZGlyKHQsciksVGUuZGVzdHJveU5vZGUobik7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUub25EZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIrZSsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9fSxyZWFkZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtpZighdC5ub2RlX29wcy5yZWFkZGlyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RESVIpO3JldHVybiB0Lm5vZGVfb3BzLnJlYWRkaXIodCl9LHVubGluazpmdW5jdGlvbihlKXt2YXIgdD1UZS5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pLm5vZGUscj1nZS5iYXNlbmFtZShlKSxuPVRlLmxvb2t1cE5vZGUodCxyKSxvPVRlLm1heURlbGV0ZSh0LHIsITEpO2lmKG8pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3Iobyk7aWYoIXQubm9kZV9vcHMudW5saW5rKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTtpZihUZS5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO3RyeXtUZS50cmFja2luZ0RlbGVnYXRlLndpbGxEZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLndpbGxEZWxldGVQYXRoKGUpfWNhdGNoKHQpe2NvbnNvbGUubG9nKCJGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsRGVsZXRlUGF0aCddKCciK2UrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIit0Lm1lc3NhZ2UpfXQubm9kZV9vcHMudW5saW5rKHQsciksVGUuZGVzdHJveU5vZGUobik7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUub25EZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIrZSsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9fSxyZWFkbGluazpmdW5jdGlvbihlKXt2YXIgdD1UZS5sb29rdXBQYXRoKGUpLm5vZGU7aWYoIXQpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTtpZighdC5ub2RlX29wcy5yZWFkbGluayl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiBnZS5yZXNvbHZlKFRlLmdldFBhdGgodC5wYXJlbnQpLHQubm9kZV9vcHMucmVhZGxpbmsodCkpfSxzdGF0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6IXR9KS5ub2RlO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT0VOVCk7aWYoIXIubm9kZV9vcHMuZ2V0YXR0cil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIHIubm9kZV9vcHMuZ2V0YXR0cihyKX0sbHN0YXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIFRlLnN0YXQoZSwhMCl9LGNobW9kOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbjsic3RyaW5nIj09dHlwZW9mIGU/bj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohcn0pLm5vZGU6bj1lO2lmKCFuLm5vZGVfb3BzLnNldGF0dHIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pO24ubm9kZV9vcHMuc2V0YXR0cihuLHttb2RlOjQwOTUmdHwtNDA5NiZuLm1vZGUsdGltZXN0YW1wOkRhdGUubm93KCl9KX0sbGNobW9kOmZ1bmN0aW9uKGUsdCl7VGUuY2htb2QoZSx0LCEwKX0sZmNobW9kOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUuZ2V0U3RyZWFtKGUpO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtUZS5jaG1vZChyLm5vZGUsdCl9LGNob3duOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvOyJzdHJpbmciPT10eXBlb2YgZT9vPVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiFufSkubm9kZTpvPWU7aWYoIW8ubm9kZV9vcHMuc2V0YXR0cil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7by5ub2RlX29wcy5zZXRhdHRyKG8se3RpbWVzdGFtcDpEYXRlLm5vdygpfSl9LGxjaG93bjpmdW5jdGlvbihlLHQscil7VGUuY2hvd24oZSx0LHIsITApfSxmY2hvd246ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmdldFN0cmVhbShlKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7VGUuY2hvd24obi5ub2RlLHQscil9LHRydW5jYXRlOmZ1bmN0aW9uKGUsdCl7aWYodDwwKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIHI7InN0cmluZyI9PXR5cGVvZiBlP3I9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KS5ub2RlOnI9ZTtpZighci5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTtpZihUZS5pc0RpcihyLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJU0RJUik7aWYoIVRlLmlzRmlsZShyLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIG49VGUubm9kZVBlcm1pc3Npb25zKHIsInciKTtpZihuKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG4pO3Iubm9kZV9vcHMuc2V0YXR0cihyLHtzaXplOnQsdGltZXN0YW1wOkRhdGUubm93KCl9KX0sZnRydW5jYXRlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUuZ2V0U3RyZWFtKGUpO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZigwPT0oMjA5NzE1NSZyLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO1RlLnRydW5jYXRlKHIubm9kZSx0KX0sdXRpbWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtuLm5vZGVfb3BzLnNldGF0dHIobix7dGltZXN0YW1wOk1hdGgubWF4KHQscil9KX0sb3BlbjpmdW5jdGlvbihlLHQscixuLGkpe2lmKCIiPT09ZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9FTlQpO3ZhciBhO2lmKHI9dm9pZCAwPT09cj80Mzg6cixyPTY0Jih0PSJzdHJpbmciPT10eXBlb2YgdD9UZS5tb2RlU3RyaW5nVG9GbGFncyh0KTp0KT80MDk1JnJ8MzI3Njg6MCwib2JqZWN0Ij09dHlwZW9mIGUpYT1lO2Vsc2V7ZT1nZS5ub3JtYWxpemUoZSk7dHJ5e2E9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ISgxMzEwNzImdCl9KS5ub2RlfWNhdGNoKGUpe319dmFyIHM9ITE7aWYoNjQmdClpZihhKXtpZigxMjgmdCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FRVhJU1QpfWVsc2UgYT1UZS5ta25vZChlLHIsMCkscz0hMDtpZighYSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9FTlQpO2lmKFRlLmlzQ2hyZGV2KGEubW9kZSkmJih0Jj0tNTEzKSw2NTUzNiZ0JiYhVGUuaXNEaXIoYS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9URElSKTtpZighcyl7dmFyIHU9VGUubWF5T3BlbihhLHQpO2lmKHUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IodSl9NTEyJnQmJlRlLnRydW5jYXRlKGEsMCksdCY9LTY0MTt2YXIgYz1UZS5jcmVhdGVTdHJlYW0oe25vZGU6YSxwYXRoOlRlLmdldFBhdGgoYSksZmxhZ3M6dCxzZWVrYWJsZTohMCxwb3NpdGlvbjowLHN0cmVhbV9vcHM6YS5zdHJlYW1fb3BzLHVuZ290dGVuOltdLGVycm9yOiExfSxuLGkpO2Muc3RyZWFtX29wcy5vcGVuJiZjLnN0cmVhbV9vcHMub3BlbihjKSwhby5sb2dSZWFkRmlsZXN8fDEmdHx8KFRlLnJlYWRGaWxlc3x8KFRlLnJlYWRGaWxlcz17fSksZSBpbiBUZS5yZWFkRmlsZXN8fChUZS5yZWFkRmlsZXNbZV09MSxvLnByaW50RXJyKCJyZWFkIGZpbGU6ICIrZSkpKTt0cnl7aWYoVGUudHJhY2tpbmdEZWxlZ2F0ZS5vbk9wZW5GaWxlKXt2YXIgbD0wOzEhPSgyMDk3MTU1JnQpJiYobHw9VGUudHJhY2tpbmcub3BlbkZsYWdzLlJFQUQpLDAhPSgyMDk3MTU1JnQpJiYobHw9VGUudHJhY2tpbmcub3BlbkZsYWdzLldSSVRFKSxUZS50cmFja2luZ0RlbGVnYXRlLm9uT3BlbkZpbGUoZSxsKX19Y2F0Y2godCl7Y29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uT3BlbkZpbGUnXSgnIitlKyInLCBmbGFncykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9cmV0dXJuIGN9LGNsb3NlOmZ1bmN0aW9uKGUpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtlLmdldGRlbnRzJiYoZS5nZXRkZW50cz1udWxsKTt0cnl7ZS5zdHJlYW1fb3BzLmNsb3NlJiZlLnN0cmVhbV9vcHMuY2xvc2UoZSl9Y2F0Y2goZSl7dGhyb3cgZX1maW5hbGx5e1RlLmNsb3NlU3RyZWFtKGUuZmQpfWUuZmQ9bnVsbH0saXNDbG9zZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGw9PT1lLmZkfSxsbHNlZWs6ZnVuY3Rpb24oZSx0LHIpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZighZS5zZWVrYWJsZXx8IWUuc3RyZWFtX29wcy5sbHNlZWspdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVNQSVBFKTtyZXR1cm4gZS5wb3NpdGlvbj1lLnN0cmVhbV9vcHMubGxzZWVrKGUsdCxyKSxlLnVuZ290dGVuPVtdLGUucG9zaXRpb259LHJlYWQ6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZihuPDB8fG88MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZigxPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoVGUuaXNEaXIoZS5ub2RlLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJU0RJUik7aWYoIWUuc3RyZWFtX29wcy5yZWFkKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIGk9dm9pZCAwIT09bztpZihpKXtpZighZS5zZWVrYWJsZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FU1BJUEUpfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBhPWUuc3RyZWFtX29wcy5yZWFkKGUsdCxyLG4sbyk7cmV0dXJuIGl8fChlLnBvc2l0aW9uKz1hKSxhfSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8saSl7aWYobjwwfHxvPDApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtpZihUZS5pc0Nsb3NlZChlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoMD09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJBREYpO2lmKFRlLmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSVNESVIpO2lmKCFlLnN0cmVhbV9vcHMud3JpdGUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTsxMDI0JmUuZmxhZ3MmJlRlLmxsc2VlayhlLDAsMik7dmFyIGE9dm9pZCAwIT09bztpZihhKXtpZighZS5zZWVrYWJsZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FU1BJUEUpfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBzPWUuc3RyZWFtX29wcy53cml0ZShlLHQscixuLG8saSk7YXx8KGUucG9zaXRpb24rPXMpO3RyeXtlLnBhdGgmJlRlLnRyYWNraW5nRGVsZWdhdGUub25Xcml0ZVRvRmlsZSYmVGUudHJhY2tpbmdEZWxlZ2F0ZS5vbldyaXRlVG9GaWxlKGUucGF0aCl9Y2F0Y2goZSl7Y29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uV3JpdGVUb0ZpbGUnXSgnIitwYXRoKyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrZS5tZXNzYWdlKX1yZXR1cm4gc30sYWxsb2NhdGU6ZnVuY3Rpb24oZSx0LHIpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZih0PDB8fHI8PTApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtpZigwPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoIVRlLmlzRmlsZShlLm5vZGUubW9kZSkmJiFUZS5pc0RpcihlLm5vZGUubW9kZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtpZighZS5zdHJlYW1fb3BzLmFsbG9jYXRlKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVPUE5PVFNVUFApO2Uuc3RyZWFtX29wcy5hbGxvY2F0ZShlLHQscil9LG1tYXA6ZnVuY3Rpb24oZSx0LHIsbixvLGksYSl7aWYoMT09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUFDQ0VTKTtpZighZS5zdHJlYW1fb3BzLm1tYXApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtyZXR1cm4gZS5zdHJlYW1fb3BzLm1tYXAoZSx0LHIsbixvLGksYSl9LG1zeW5jOmZ1bmN0aW9uKGUsdCxyLG4sbyl7cmV0dXJuIGUmJmUuc3RyZWFtX29wcy5tc3luYz9lLnN0cmVhbV9vcHMubXN5bmMoZSx0LHIsbixvKTowfSxtdW5tYXA6ZnVuY3Rpb24oZSl7cmV0dXJuIDB9LGlvY3RsOmZ1bmN0aW9uKGUsdCxyKXtpZighZS5zdHJlYW1fb3BzLmlvY3RsKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RUWSk7cmV0dXJuIGUuc3RyZWFtX29wcy5pb2N0bChlLHQscil9LHJlYWRGaWxlOmZ1bmN0aW9uKGUsdCl7aWYoKHQ9dHx8e30pLmZsYWdzPXQuZmxhZ3N8fCJyIix0LmVuY29kaW5nPXQuZW5jb2Rpbmd8fCJiaW5hcnkiLCJ1dGY4IiE9PXQuZW5jb2RpbmcmJiJiaW5hcnkiIT09dC5lbmNvZGluZyl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW5jb2RpbmcgdHlwZSAiJyt0LmVuY29kaW5nKyciJyk7dmFyIHIsbj1UZS5vcGVuKGUsdC5mbGFncyksbz1UZS5zdGF0KGUpLnNpemUsaT1uZXcgVWludDhBcnJheShvKTtyZXR1cm4gVGUucmVhZChuLGksMCxvLDApLCJ1dGY4Ij09PXQuZW5jb2Rpbmc/cj1fKGksMCk6ImJpbmFyeSI9PT10LmVuY29kaW5nJiYocj1pKSxUZS5jbG9zZShuKSxyfSx3cml0ZUZpbGU6ZnVuY3Rpb24oZSx0LHIpeyhyPXJ8fHt9KS5mbGFncz1yLmZsYWdzfHwidyI7dmFyIG49VGUub3BlbihlLHIuZmxhZ3Msci5tb2RlKTtpZigic3RyaW5nIj09dHlwZW9mIHQpe3ZhciBvPW5ldyBVaW50OEFycmF5KFModCkrMSksaT1BKHQsbywwLG8ubGVuZ3RoKTtUZS53cml0ZShuLG8sMCxpLHZvaWQgMCxyLmNhbk93bil9ZWxzZXtpZighQXJyYXlCdWZmZXIuaXNWaWV3KHQpKXRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgZGF0YSB0eXBlIik7VGUud3JpdGUobix0LDAsdC5ieXRlTGVuZ3RoLHZvaWQgMCxyLmNhbk93bil9VGUuY2xvc2Uobil9LGN3ZDpmdW5jdGlvbigpe3JldHVybiBUZS5jdXJyZW50UGF0aH0sY2hkaXI6ZnVuY3Rpb24oZSl7dmFyIHQ9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KTtpZihudWxsPT09dC5ub2RlKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT0VOVCk7aWYoIVRlLmlzRGlyKHQubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9URElSKTt2YXIgcj1UZS5ub2RlUGVybWlzc2lvbnModC5ub2RlLCJ4Iik7aWYocil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihyKTtUZS5jdXJyZW50UGF0aD10LnBhdGh9LGNyZWF0ZURlZmF1bHREaXJlY3RvcmllczpmdW5jdGlvbigpe1RlLm1rZGlyKCIvdG1wIiksVGUubWtkaXIoIi9ob21lIiksVGUubWtkaXIoIi9ob21lL3dlYl91c2VyIil9LGNyZWF0ZURlZmF1bHREZXZpY2VzOmZ1bmN0aW9uKCl7dmFyIGU7aWYoVGUubWtkaXIoIi9kZXYiKSxUZS5yZWdpc3RlckRldmljZShUZS5tYWtlZGV2KDEsMykse3JlYWQ6ZnVuY3Rpb24oKXtyZXR1cm4gMH0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvKXtyZXR1cm4gbn19KSxUZS5ta2RldigiL2Rldi9udWxsIixUZS5tYWtlZGV2KDEsMykpLHZlLnJlZ2lzdGVyKFRlLm1ha2VkZXYoNSwwKSx2ZS5kZWZhdWx0X3R0eV9vcHMpLHZlLnJlZ2lzdGVyKFRlLm1ha2VkZXYoNiwwKSx2ZS5kZWZhdWx0X3R0eTFfb3BzKSxUZS5ta2RldigiL2Rldi90dHkiLFRlLm1ha2VkZXYoNSwwKSksVGUubWtkZXYoIi9kZXYvdHR5MSIsVGUubWFrZWRldig2LDApKSwidW5kZWZpbmVkIiE9dHlwZW9mIGNyeXB0byl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoMSk7ZT1mdW5jdGlvbigpe3JldHVybiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHQpLHRbMF19fWVsc2UgZT1sP2Z1bmN0aW9uKCl7cmV0dXJuIHJlcXVpcmUoImNyeXB0byIpLnJhbmRvbUJ5dGVzKDEpWzBdfTpmdW5jdGlvbigpe3JldHVybiAyNTYqTWF0aC5yYW5kb20oKXwwfTtUZS5jcmVhdGVEZXZpY2UoIi9kZXYiLCJyYW5kb20iLGUpLFRlLmNyZWF0ZURldmljZSgiL2RldiIsInVyYW5kb20iLGUpLFRlLm1rZGlyKCIvZGV2L3NobSIpLFRlLm1rZGlyKCIvZGV2L3NobS90bXAiKX0sY3JlYXRlU3BlY2lhbERpcmVjdG9yaWVzOmZ1bmN0aW9uKCl7VGUubWtkaXIoIi9wcm9jIiksVGUubWtkaXIoIi9wcm9jL3NlbGYiKSxUZS5ta2RpcigiL3Byb2Mvc2VsZi9mZCIpLFRlLm1vdW50KHttb3VudDpmdW5jdGlvbigpe3ZhciBlPVRlLmNyZWF0ZU5vZGUoIi9wcm9jL3NlbGYiLCJmZCIsMTY4OTUsNzMpO3JldHVybiBlLm5vZGVfb3BzPXtsb29rdXA6ZnVuY3Rpb24oZSx0KXt2YXIgcj0rdCxuPVRlLmdldFN0cmVhbShyKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7dmFyIG89e3BhcmVudDpudWxsLG1vdW50Onttb3VudHBvaW50OiJmYWtlIn0sbm9kZV9vcHM6e3JlYWRsaW5rOmZ1bmN0aW9uKCl7cmV0dXJuIG4ucGF0aH19fTtyZXR1cm4gby5wYXJlbnQ9byxvfX0sZX19LHt9LCIvcHJvYy9zZWxmL2ZkIil9LGNyZWF0ZVN0YW5kYXJkU3RyZWFtczpmdW5jdGlvbigpe28uc3RkaW4/VGUuY3JlYXRlRGV2aWNlKCIvZGV2Iiwic3RkaW4iLG8uc3RkaW4pOlRlLnN5bWxpbmsoIi9kZXYvdHR5IiwiL2Rldi9zdGRpbiIpLG8uc3Rkb3V0P1RlLmNyZWF0ZURldmljZSgiL2RldiIsInN0ZG91dCIsbnVsbCxvLnN0ZG91dCk6VGUuc3ltbGluaygiL2Rldi90dHkiLCIvZGV2L3N0ZG91dCIpLG8uc3RkZXJyP1RlLmNyZWF0ZURldmljZSgiL2RldiIsInN0ZGVyciIsbnVsbCxvLnN0ZGVycik6VGUuc3ltbGluaygiL2Rldi90dHkxIiwiL2Rldi9zdGRlcnIiKTt2YXIgZT1UZS5vcGVuKCIvZGV2L3N0ZGluIiwiciIpO3koMD09PWUuZmQsImludmFsaWQgaGFuZGxlIGZvciBzdGRpbiAoIitlLmZkKyIpIik7dmFyIHQ9VGUub3BlbigiL2Rldi9zdGRvdXQiLCJ3Iik7eSgxPT09dC5mZCwiaW52YWxpZCBoYW5kbGUgZm9yIHN0ZG91dCAoIit0LmZkKyIpIik7dmFyIHI9VGUub3BlbigiL2Rldi9zdGRlcnIiLCJ3Iik7eSgyPT09ci5mZCwiaW52YWxpZCBoYW5kbGUgZm9yIHN0ZGVyciAoIityLmZkKyIpIil9LGVuc3VyZUVycm5vRXJyb3I6ZnVuY3Rpb24oKXtUZS5FcnJub0Vycm9yfHwoVGUuRXJybm9FcnJvcj1mdW5jdGlvbihlLHQpe3RoaXMubm9kZT10LHRoaXMuc2V0RXJybm89ZnVuY3Rpb24oZSl7Zm9yKHZhciB0IGluIHRoaXMuZXJybm89ZSxtZSlpZihtZVt0XT09PWUpe3RoaXMuY29kZT10O2JyZWFrfX0sdGhpcy5zZXRFcnJubyhlKSx0aGlzLm1lc3NhZ2U9RWVbZV0sdGhpcy5zdGFjayYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsInN0YWNrIix7dmFsdWU6KG5ldyBFcnJvcikuc3RhY2ssd3JpdGFibGU6ITB9KX0sVGUuRXJybm9FcnJvci5wcm90b3R5cGU9bmV3IEVycm9yLFRlLkVycm5vRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yPVRlLkVycm5vRXJyb3IsW21lLkVOT0VOVF0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7VGUuZ2VuZXJpY0Vycm9yc1tlXT1uZXcgVGUuRXJybm9FcnJvcihlKSxUZS5nZW5lcmljRXJyb3JzW2VdLnN0YWNrPSI8Z2VuZXJpYyBlcnJvciwgbm8gc3RhY2s+In0pKSl9LHN0YXRpY0luaXQ6ZnVuY3Rpb24oKXtUZS5lbnN1cmVFcnJub0Vycm9yKCksVGUubmFtZVRhYmxlPW5ldyBBcnJheSg0MDk2KSxUZS5tb3VudCh3ZSx7fSwiLyIpLFRlLmNyZWF0ZURlZmF1bHREaXJlY3RvcmllcygpLFRlLmNyZWF0ZURlZmF1bHREZXZpY2VzKCksVGUuY3JlYXRlU3BlY2lhbERpcmVjdG9yaWVzKCksVGUuZmlsZXN5c3RlbXM9e01FTUZTOndlLElEQkZTOl9lLE5PREVGUzpiZSxXT1JLRVJGUzpBZX19LGluaXQ6ZnVuY3Rpb24oZSx0LHIpe3koIVRlLmluaXQuaW5pdGlhbGl6ZWQsIkZTLmluaXQgd2FzIHByZXZpb3VzbHkgY2FsbGVkLiBJZiB5b3Ugd2FudCB0byBpbml0aWFsaXplIGxhdGVyIHdpdGggY3VzdG9tIHBhcmFtZXRlcnMsIHJlbW92ZSBhbnkgZWFybGllciBjYWxscyAobm90ZSB0aGF0IG9uZSBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBnZW5lcmF0ZWQgY29kZSkiKSxUZS5pbml0LmluaXRpYWxpemVkPSEwLFRlLmVuc3VyZUVycm5vRXJyb3IoKSxvLnN0ZGluPWV8fG8uc3RkaW4sby5zdGRvdXQ9dHx8by5zdGRvdXQsby5zdGRlcnI9cnx8by5zdGRlcnIsVGUuY3JlYXRlU3RhbmRhcmRTdHJlYW1zKCl9LHF1aXQ6ZnVuY3Rpb24oKXtUZS5pbml0LmluaXRpYWxpemVkPSExO3ZhciBlPW8uX2ZmbHVzaDtlJiZlKDApO2Zvcih2YXIgdD0wO3Q8VGUuc3RyZWFtcy5sZW5ndGg7dCsrKXt2YXIgcj1UZS5zdHJlYW1zW3RdO3ImJlRlLmNsb3NlKHIpfX0sZ2V0TW9kZTpmdW5jdGlvbihlLHQpe3ZhciByPTA7cmV0dXJuIGUmJihyfD0zNjUpLHQmJihyfD0xNDYpLHJ9LGpvaW5QYXRoOmZ1bmN0aW9uKGUsdCl7dmFyIHI9Z2Uuam9pbi5hcHBseShudWxsLGUpO3JldHVybiB0JiYiLyI9PXJbMF0mJihyPXIuc3Vic3RyKDEpKSxyfSxhYnNvbHV0ZVBhdGg6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZ2UucmVzb2x2ZSh0LGUpfSxzdGFuZGFyZGl6ZVBhdGg6ZnVuY3Rpb24oZSl7cmV0dXJuIGdlLm5vcm1hbGl6ZShlKX0sZmluZE9iamVjdDpmdW5jdGlvbihlLHQpe3ZhciByPVRlLmFuYWx5emVQYXRoKGUsdCk7cmV0dXJuIHIuZXhpc3RzP3Iub2JqZWN0Oih5ZShyLmVycm9yKSxudWxsKX0sYW5hbHl6ZVBhdGg6ZnVuY3Rpb24oZSx0KXt0cnl7ZT0obj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohdH0pKS5wYXRofWNhdGNoKGUpe312YXIgcj17aXNSb290OiExLGV4aXN0czohMSxlcnJvcjowLG5hbWU6bnVsbCxwYXRoOm51bGwsb2JqZWN0Om51bGwscGFyZW50RXhpc3RzOiExLHBhcmVudFBhdGg6bnVsbCxwYXJlbnRPYmplY3Q6bnVsbH07dHJ5e3ZhciBuPVRlLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSk7ci5wYXJlbnRFeGlzdHM9ITAsci5wYXJlbnRQYXRoPW4ucGF0aCxyLnBhcmVudE9iamVjdD1uLm5vZGUsci5uYW1lPWdlLmJhc2VuYW1lKGUpLG49VGUubG9va3VwUGF0aChlLHtmb2xsb3c6IXR9KSxyLmV4aXN0cz0hMCxyLnBhdGg9bi5wYXRoLHIub2JqZWN0PW4ubm9kZSxyLm5hbWU9bi5ub2RlLm5hbWUsci5pc1Jvb3Q9Ii8iPT09bi5wYXRofWNhdGNoKGUpe3IuZXJyb3I9ZS5lcnJub31yZXR1cm4gcn0sY3JlYXRlRm9sZGVyOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksaT1UZS5nZXRNb2RlKHIsbik7cmV0dXJuIFRlLm1rZGlyKG8saSl9LGNyZWF0ZVBhdGg6ZnVuY3Rpb24oZSx0LHIsbil7ZT0ic3RyaW5nIj09dHlwZW9mIGU/ZTpUZS5nZXRQYXRoKGUpO2Zvcih2YXIgbz10LnNwbGl0KCIvIikucmV2ZXJzZSgpO28ubGVuZ3RoOyl7dmFyIGk9by5wb3AoKTtpZihpKXt2YXIgYT1nZS5qb2luMihlLGkpO3RyeXtUZS5ta2RpcihhKX1jYXRjaChlKXt9ZT1hfX1yZXR1cm4gYX0sY3JlYXRlRmlsZTpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksYT1UZS5nZXRNb2RlKG4sbyk7cmV0dXJuIFRlLmNyZWF0ZShpLGEpfSxjcmVhdGVEYXRhRmlsZTpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9dD9nZS5qb2luMigic3RyaW5nIj09dHlwZW9mIGU/ZTpUZS5nZXRQYXRoKGUpLHQpOmUscz1UZS5nZXRNb2RlKG4sbyksdT1UZS5jcmVhdGUoYSxzKTtpZihyKXtpZigic3RyaW5nIj09dHlwZW9mIHIpe2Zvcih2YXIgYz1uZXcgQXJyYXkoci5sZW5ndGgpLGw9MCxmPXIubGVuZ3RoO2w8ZjsrK2wpY1tsXT1yLmNoYXJDb2RlQXQobCk7cj1jfVRlLmNobW9kKHUsMTQ2fHMpO3ZhciBkPVRlLm9wZW4odSwidyIpO1RlLndyaXRlKGQsciwwLHIubGVuZ3RoLDAsaSksVGUuY2xvc2UoZCksVGUuY2htb2QodSxzKX1yZXR1cm4gdX0sY3JlYXRlRGV2aWNlOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksaT1UZS5nZXRNb2RlKCEhciwhIW4pO1RlLmNyZWF0ZURldmljZS5tYWpvcnx8KFRlLmNyZWF0ZURldmljZS5tYWpvcj02NCk7dmFyIGE9VGUubWFrZWRldihUZS5jcmVhdGVEZXZpY2UubWFqb3IrKywwKTtyZXR1cm4gVGUucmVnaXN0ZXJEZXZpY2UoYSx7b3BlbjpmdW5jdGlvbihlKXtlLnNlZWthYmxlPSExfSxjbG9zZTpmdW5jdGlvbihlKXtuJiZuLmJ1ZmZlciYmbi5idWZmZXIubGVuZ3RoJiZuKDEwKX0scmVhZDpmdW5jdGlvbihlLHQsbixvLGkpe2Zvcih2YXIgYT0wLHM9MDtzPG87cysrKXt2YXIgdTt0cnl7dT1yKCl9Y2F0Y2goZSl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlPKX1pZih2b2lkIDA9PT11JiYwPT09YSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQUdBSU4pO2lmKG51bGw9PXUpYnJlYWs7YSsrLHRbbitzXT11fXJldHVybiBhJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfSx3cml0ZTpmdW5jdGlvbihlLHQscixvLGkpe2Zvcih2YXIgYT0wO2E8bzthKyspdHJ5e24odFtyK2FdKX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU8pfXJldHVybiBvJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfX0pLFRlLm1rZGV2KG8saSxhKX0sY3JlYXRlTGluazpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCk7cmV0dXJuIFRlLnN5bWxpbmsocixpKX0sZm9yY2VMb2FkRmlsZTpmdW5jdGlvbihlKXtpZihlLmlzRGV2aWNlfHxlLmlzRm9sZGVyfHxlLmxpbmt8fGUuY29udGVudHMpcmV0dXJuITA7dmFyIHQ9ITA7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCl0aHJvdyBuZXcgRXJyb3IoIkxhenkgbG9hZGluZyBzaG91bGQgaGF2ZSBiZWVuIHBlcmZvcm1lZCAoY29udGVudHMgc2V0KSBpbiBjcmVhdGVMYXp5RmlsZSwgYnV0IGl0IHdhcyBub3QuIExhenkgbG9hZGluZyBvbmx5IHdvcmtzIGluIHdlYiB3b3JrZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2Mgb24gdGhlIG1haW4gdGhyZWFkLiIpO2lmKCFvLnJlYWQpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgbG9hZCB3aXRob3V0IHJlYWQoKSBvciBYTUxIdHRwUmVxdWVzdC4iKTt0cnl7ZS5jb250ZW50cz0kdChvLnJlYWQoZS51cmwpLCEwKSxlLnVzZWRCeXRlcz1lLmNvbnRlbnRzLmxlbmd0aH1jYXRjaChlKXt0PSExfXJldHVybiB0fHx5ZShtZS5FSU8pLHR9LGNyZWF0ZUxhenlGaWxlOmZ1bmN0aW9uKGUsdCxyLG4sbyl7ZnVuY3Rpb24gaSgpe3RoaXMubGVuZ3RoS25vd249ITEsdGhpcy5jaHVua3M9W119aWYoaS5wcm90b3R5cGUuZ2V0PWZ1bmN0aW9uKGUpe2lmKCEoZT50aGlzLmxlbmd0aC0xfHxlPDApKXt2YXIgdD1lJXRoaXMuY2h1bmtTaXplLHI9ZS90aGlzLmNodW5rU2l6ZXwwO3JldHVybiB0aGlzLmdldHRlcihyKVt0XX19LGkucHJvdG90eXBlLnNldERhdGFHZXR0ZXI9ZnVuY3Rpb24oZSl7dGhpcy5nZXR0ZXI9ZX0saS5wcm90b3R5cGUuY2FjaGVMZW5ndGg9ZnVuY3Rpb24oKXt2YXIgZT1uZXcgWE1MSHR0cFJlcXVlc3Q7aWYoZS5vcGVuKCJIRUFEIixyLCExKSxlLnNlbmQobnVsbCksIShlLnN0YXR1cz49MjAwJiZlLnN0YXR1czwzMDB8fDMwND09PWUuc3RhdHVzKSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIityKyIuIFN0YXR1czogIitlLnN0YXR1cyk7dmFyIHQsbj1OdW1iZXIoZS5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1sZW5ndGgiKSksbz0odD1lLmdldFJlc3BvbnNlSGVhZGVyKCJBY2NlcHQtUmFuZ2VzIikpJiYiYnl0ZXMiPT09dCxpPSh0PWUuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtRW5jb2RpbmciKSkmJiJnemlwIj09PXQsYT0xMDQ4NTc2O298fChhPW4pO3ZhciBzPXRoaXM7cy5zZXREYXRhR2V0dGVyKChmdW5jdGlvbihlKXt2YXIgdD1lKmEsbz0oZSsxKSphLTE7aWYobz1NYXRoLm1pbihvLG4tMSksdm9pZCAwPT09cy5jaHVua3NbZV0mJihzLmNodW5rc1tlXT1mdW5jdGlvbihlLHQpe2lmKGU+dCl0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmFuZ2UgKCIrZSsiLCAiK3QrIikgb3Igbm8gYnl0ZXMgcmVxdWVzdGVkISIpO2lmKHQ+bi0xKXRocm93IG5ldyBFcnJvcigib25seSAiK24rIiBieXRlcyBhdmFpbGFibGUhIHByb2dyYW1tZXIgZXJyb3IhIik7dmFyIG89bmV3IFhNTEh0dHBSZXF1ZXN0O2lmKG8ub3BlbigiR0VUIixyLCExKSxuIT09YSYmby5zZXRSZXF1ZXN0SGVhZGVyKCJSYW5nZSIsImJ5dGVzPSIrZSsiLSIrdCksInVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OEFycmF5JiYoby5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIiksby5vdmVycmlkZU1pbWVUeXBlJiZvLm92ZXJyaWRlTWltZVR5cGUoInRleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQiKSxvLnNlbmQobnVsbCksIShvLnN0YXR1cz49MjAwJiZvLnN0YXR1czwzMDB8fDMwND09PW8uc3RhdHVzKSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIityKyIuIFN0YXR1czogIitvLnN0YXR1cyk7cmV0dXJuIHZvaWQgMCE9PW8ucmVzcG9uc2U/bmV3IFVpbnQ4QXJyYXkoby5yZXNwb25zZXx8W10pOiR0KG8ucmVzcG9uc2VUZXh0fHwiIiwhMCl9KHQsbykpLHZvaWQgMD09PXMuY2h1bmtzW2VdKXRocm93IG5ldyBFcnJvcigiZG9YSFIgZmFpbGVkISIpO3JldHVybiBzLmNodW5rc1tlXX0pKSwhaSYmbnx8KGE9bj0xLG49dGhpcy5nZXR0ZXIoMCkubGVuZ3RoLGE9bixjb25zb2xlLmxvZygiTGF6eUZpbGVzIG9uIGd6aXAgZm9yY2VzIGRvd25sb2FkIG9mIHRoZSB3aG9sZSBmaWxlIHdoZW4gbGVuZ3RoIGlzIGFjY2Vzc2VkIikpLHRoaXMuX2xlbmd0aD1uLHRoaXMuX2NodW5rU2l6ZT1hLHRoaXMubGVuZ3RoS25vd249ITB9LCJ1bmRlZmluZWQiIT10eXBlb2YgWE1MSHR0cFJlcXVlc3Qpe2lmKCFjKXRocm93IkNhbm5vdCBkbyBzeW5jaHJvbm91cyBiaW5hcnkgWEhScyBvdXRzaWRlIHdlYndvcmtlcnMgaW4gbW9kZXJuIGJyb3dzZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2MiO3ZhciBhPW5ldyBpO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGEse2xlbmd0aDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGVuZ3RoS25vd258fHRoaXMuY2FjaGVMZW5ndGgoKSx0aGlzLl9sZW5ndGh9fSxjaHVua1NpemU6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aEtub3dufHx0aGlzLmNhY2hlTGVuZ3RoKCksdGhpcy5fY2h1bmtTaXplfX19KTt2YXIgcz17aXNEZXZpY2U6ITEsY29udGVudHM6YX19ZWxzZSBzPXtpc0RldmljZTohMSx1cmw6cn07dmFyIHU9VGUuY3JlYXRlRmlsZShlLHQscyxuLG8pO3MuY29udGVudHM/dS5jb250ZW50cz1zLmNvbnRlbnRzOnMudXJsJiYodS5jb250ZW50cz1udWxsLHUudXJsPXMudXJsKSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh1LHt1c2VkQnl0ZXM6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aH19fSk7dmFyIGw9e307cmV0dXJuIE9iamVjdC5rZXlzKHUuc3RyZWFtX29wcykuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9dS5zdHJlYW1fb3BzW2VdO2xbZV09ZnVuY3Rpb24oKXtpZighVGUuZm9yY2VMb2FkRmlsZSh1KSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU8pO3JldHVybiB0LmFwcGx5KG51bGwsYXJndW1lbnRzKX19KSksbC5yZWFkPWZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoIVRlLmZvcmNlTG9hZEZpbGUodSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlPKTt2YXIgaT1lLm5vZGUuY29udGVudHM7aWYobz49aS5sZW5ndGgpcmV0dXJuIDA7dmFyIGE9TWF0aC5taW4oaS5sZW5ndGgtbyxuKTtpZih5KGE+PTApLGkuc2xpY2UpZm9yKHZhciBzPTA7czxhO3MrKyl0W3Irc109aVtvK3NdO2Vsc2UgZm9yKHM9MDtzPGE7cysrKXRbcitzXT1pLmdldChvK3MpO3JldHVybiBhfSx1LnN0cmVhbV9vcHM9bCx1fSxjcmVhdGVQcmVsb2FkZWRGaWxlOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMsdSxjLGwpe0Jyb3dzZXIuaW5pdCgpO3ZhciBmPXQ/Z2UucmVzb2x2ZShnZS5qb2luMihlLHQpKTplO2Z1bmN0aW9uIGQocil7ZnVuY3Rpb24gZChyKXtsJiZsKCksdXx8VGUuY3JlYXRlRGF0YUZpbGUoZSx0LHIsbixpLGMpLGEmJmEoKSxsZSgpfXZhciBoPSExO28ucHJlbG9hZFBsdWdpbnMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aHx8ZS5jYW5IYW5kbGUoZikmJihlLmhhbmRsZShyLGYsZCwoZnVuY3Rpb24oKXtzJiZzKCksbGUoKX0pKSxoPSEwKX0pKSxofHxkKHIpfWNlKCksInN0cmluZyI9PXR5cGVvZiByP0Jyb3dzZXIuYXN5bmNMb2FkKHIsKGZ1bmN0aW9uKGUpe2QoZSl9KSxzKTpkKHIpfSxpbmRleGVkREI6ZnVuY3Rpb24oKXtyZXR1cm4gd2luZG93LmluZGV4ZWREQnx8d2luZG93Lm1vekluZGV4ZWREQnx8d2luZG93LndlYmtpdEluZGV4ZWREQnx8d2luZG93Lm1zSW5kZXhlZERCfSxEQl9OQU1FOmZ1bmN0aW9uKCl7cmV0dXJuIkVNX0ZTXyIrd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lfSxEQl9WRVJTSU9OOjIwLERCX1NUT1JFX05BTUU6IkZJTEVfREFUQSIsc2F2ZUZpbGVzVG9EQjpmdW5jdGlvbihlLHQscil7dD10fHxmdW5jdGlvbigpe30scj1yfHxmdW5jdGlvbigpe307dmFyIG49VGUuaW5kZXhlZERCKCk7dHJ5e3ZhciBvPW4ub3BlbihUZS5EQl9OQU1FKCksVGUuREJfVkVSU0lPTil9Y2F0Y2goZSl7cmV0dXJuIHIoZSl9by5vbnVwZ3JhZGVuZWVkZWQ9ZnVuY3Rpb24oKXtjb25zb2xlLmxvZygiY3JlYXRpbmcgZGIiKSxvLnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZShUZS5EQl9TVE9SRV9OQU1FKX0sby5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt2YXIgbj1vLnJlc3VsdC50cmFuc2FjdGlvbihbVGUuREJfU1RPUkVfTkFNRV0sInJlYWR3cml0ZSIpLGk9bi5vYmplY3RTdG9yZShUZS5EQl9TVE9SRV9OQU1FKSxhPTAscz0wLHU9ZS5sZW5ndGg7ZnVuY3Rpb24gYygpezA9PXM/dCgpOnIoKX1lLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWkucHV0KFRlLmFuYWx5emVQYXRoKGUpLm9iamVjdC5jb250ZW50cyxlKTt0Lm9uc3VjY2Vzcz1mdW5jdGlvbigpeysrYStzPT11JiZjKCl9LHQub25lcnJvcj1mdW5jdGlvbigpe3MrKyxhK3M9PXUmJmMoKX19KSksbi5vbmVycm9yPXJ9LG8ub25lcnJvcj1yfSxsb2FkRmlsZXNGcm9tREI6ZnVuY3Rpb24oZSx0LHIpe3Q9dHx8ZnVuY3Rpb24oKXt9LHI9cnx8ZnVuY3Rpb24oKXt9O3ZhciBuPVRlLmluZGV4ZWREQigpO3RyeXt2YXIgbz1uLm9wZW4oVGUuREJfTkFNRSgpLFRlLkRCX1ZFUlNJT04pfWNhdGNoKGUpe3JldHVybiByKGUpfW8ub251cGdyYWRlbmVlZGVkPXIsby5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt2YXIgbj1vLnJlc3VsdDt0cnl7dmFyIGk9bi50cmFuc2FjdGlvbihbVGUuREJfU1RPUkVfTkFNRV0sInJlYWRvbmx5Iil9Y2F0Y2goZSl7cmV0dXJuIHZvaWQgcihlKX12YXIgYT1pLm9iamVjdFN0b3JlKFRlLkRCX1NUT1JFX05BTUUpLHM9MCx1PTAsYz1lLmxlbmd0aDtmdW5jdGlvbiBsKCl7MD09dT90KCk6cigpfWUuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9YS5nZXQoZSk7dC5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXtUZS5hbmFseXplUGF0aChlKS5leGlzdHMmJlRlLnVubGluayhlKSxUZS5jcmVhdGVEYXRhRmlsZShnZS5kaXJuYW1lKGUpLGdlLmJhc2VuYW1lKGUpLHQucmVzdWx0LCEwLCEwLCEwKSwrK3MrdT09YyYmbCgpfSx0Lm9uZXJyb3I9ZnVuY3Rpb24oKXt1Kysscyt1PT1jJiZsKCl9fSkpLGkub25lcnJvcj1yfSxvLm9uZXJyb3I9cn19LFNlPXtERUZBVUxUX1BPTExNQVNLOjUsbWFwcGluZ3M6e30sdW1hc2s6NTExLGNhbGN1bGF0ZUF0OmZ1bmN0aW9uKGUsdCl7aWYoIi8iIT09dFswXSl7dmFyIHI7aWYoLTEwMD09PWUpcj1UZS5jd2QoKTtlbHNle3ZhciBuPVRlLmdldFN0cmVhbShlKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7cj1uLnBhdGh9dD1nZS5qb2luMihyLHQpfXJldHVybiB0fSxkb1N0YXQ6ZnVuY3Rpb24oZSx0LHIpe3RyeXt2YXIgbj1lKHQpfWNhdGNoKGUpe2lmKGUmJmUubm9kZSYmZ2Uubm9ybWFsaXplKHQpIT09Z2Uubm9ybWFsaXplKFRlLmdldFBhdGgoZS5ub2RlKSkpcmV0dXJuLW1lLkVOT1RESVI7dGhyb3cgZX1yZXR1cm4gRltyPj4yXT1uLmRldixGW3IrND4+Ml09MCxGW3IrOD4+Ml09bi5pbm8sRltyKzEyPj4yXT1uLm1vZGUsRltyKzE2Pj4yXT1uLm5saW5rLEZbcisyMD4+Ml09bi51aWQsRltyKzI0Pj4yXT1uLmdpZCxGW3IrMjg+PjJdPW4ucmRldixGW3IrMzI+PjJdPTAsRltyKzM2Pj4yXT1uLnNpemUsRltyKzQwPj4yXT00MDk2LEZbcis0ND4+Ml09bi5ibG9ja3MsRltyKzQ4Pj4yXT1uLmF0aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNTI+PjJdPTAsRltyKzU2Pj4yXT1uLm10aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNjA+PjJdPTAsRltyKzY0Pj4yXT1uLmN0aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNjg+PjJdPTAsRltyKzcyPj4yXT1uLmlubywwfSxkb01zeW5jOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPW5ldyBVaW50OEFycmF5KE8uc3ViYXJyYXkoZSxlK3IpKTtUZS5tc3luYyh0LG8sMCxyLG4pfSxkb01rZGlyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIi8iPT09KGU9Z2Uubm9ybWFsaXplKGUpKVtlLmxlbmd0aC0xXSYmKGU9ZS5zdWJzdHIoMCxlLmxlbmd0aC0xKSksVGUubWtkaXIoZSx0LDApLDB9LGRvTWtub2Q6ZnVuY3Rpb24oZSx0LHIpe3N3aXRjaCg2MTQ0MCZ0KXtjYXNlIDMyNzY4OmNhc2UgODE5MjpjYXNlIDI0NTc2OmNhc2UgNDA5NjpjYXNlIDQ5MTUyOmJyZWFrO2RlZmF1bHQ6cmV0dXJuLW1lLkVJTlZBTH1yZXR1cm4gVGUubWtub2QoZSx0LHIpLDB9LGRvUmVhZGxpbms6ZnVuY3Rpb24oZSx0LHIpe2lmKHI8PTApcmV0dXJuLW1lLkVJTlZBTDt2YXIgbj1UZS5yZWFkbGluayhlKSxvPU1hdGgubWluKHIsUyhuKSksaT1SW3Qrb107cmV0dXJuIFQobix0LHIrMSksUlt0K29dPWksb30sZG9BY2Nlc3M6ZnVuY3Rpb24oZSx0KXtpZigtOCZ0KXJldHVybi1tZS5FSU5WQUw7dmFyIHI7cj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohMH0pLm5vZGU7dmFyIG49IiI7cmV0dXJuIDQmdCYmKG4rPSJyIiksMiZ0JiYobis9InciKSwxJnQmJihuKz0ieCIpLG4mJlRlLm5vZGVQZXJtaXNzaW9ucyhyLG4pPy1tZS5FQUNDRVM6MH0sZG9EdXA6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmdldFN0cmVhbShyKTtyZXR1cm4gbiYmVGUuY2xvc2UobiksVGUub3BlbihlLHQsMCxyLHIpLmZkfSxkb1JlYWR2OmZ1bmN0aW9uKGUsdCxyLG4pe2Zvcih2YXIgbz0wLGk9MDtpPHI7aSsrKXt2YXIgYT1GW3QrOCppPj4yXSxzPUZbdCsoOCppKzQpPj4yXSx1PVRlLnJlYWQoZSxSLGEscyxuKTtpZih1PDApcmV0dXJuLTE7aWYobys9dSx1PHMpYnJlYWt9cmV0dXJuIG99LGRvV3JpdGV2OmZ1bmN0aW9uKGUsdCxyLG4pe2Zvcih2YXIgbz0wLGk9MDtpPHI7aSsrKXt2YXIgYT1GW3QrOCppPj4yXSxzPUZbdCsoOCppKzQpPj4yXSx1PVRlLndyaXRlKGUsUixhLHMsbik7aWYodTwwKXJldHVybi0xO28rPXV9cmV0dXJuIG99LHZhcmFyZ3M6MCxnZXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIFNlLnZhcmFyZ3MrPTQsRltTZS52YXJhcmdzLTQ+PjJdfSxnZXRTdHI6ZnVuY3Rpb24oKXtyZXR1cm4gdihTZS5nZXQoKSl9LGdldFN0cmVhbUZyb21GRDpmdW5jdGlvbigpe3ZhciBlPVRlLmdldFN0cmVhbShTZS5nZXQoKSk7aWYoIWUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJBREYpO3JldHVybiBlfSxnZXRTb2NrZXRGcm9tRkQ6ZnVuY3Rpb24oKXt2YXIgZT1TT0NLRlMuZ2V0U29ja2V0KFNlLmdldCgpKTtpZighZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7cmV0dXJuIGV9LGdldFNvY2tldEFkZHJlc3M6ZnVuY3Rpb24oZSl7dmFyIHQ9U2UuZ2V0KCkscj1TZS5nZXQoKTtpZihlJiYwPT09dClyZXR1cm4gbnVsbDt2YXIgbj1fX3JlYWRfc29ja2FkZHIodCxyKTtpZihuLmVycm5vKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG4uZXJybm8pO3JldHVybiBuLmFkZHI9RE5TLmxvb2t1cF9hZGRyKG4uYWRkcil8fG4uYWRkcixufSxnZXQ2NDpmdW5jdGlvbigpe3ZhciBlPVNlLmdldCgpLHQ9U2UuZ2V0KCk7cmV0dXJuIHkoZT49MD8wPT09dDotMT09PXQpLGV9LGdldFplcm86ZnVuY3Rpb24oKXt5KDA9PT1TZS5nZXQoKSl9fTt2YXIga2U9NDI7dmFyIFBlPXt9O2Z1bmN0aW9uIERlKGUpe2Zvcig7ZS5sZW5ndGg7KXt2YXIgdD1lLnBvcCgpO2UucG9wKCkodCl9fWZ1bmN0aW9uIFJlKGUpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShNW2U+PjJdKX12YXIgT2U9e30sQ2U9e30sTmU9e307ZnVuY3Rpb24gRmUoZSl7aWYodm9pZCAwPT09ZSlyZXR1cm4iX3Vua25vd24iO3ZhciB0PShlPWUucmVwbGFjZSgvW15hLXpBLVowLTlfXS9nLCIkIikpLmNoYXJDb2RlQXQoMCk7cmV0dXJuIHQ+PTQ4JiZ0PD01Nz8iXyIrZTplfWZ1bmN0aW9uIE1lKGUsdCl7cmV0dXJuIGU9RmUoZSksbmV3IEZ1bmN0aW9uKCJib2R5IiwicmV0dXJuIGZ1bmN0aW9uICIrZSsnKCkge1xuICAgICJ1c2Ugc3RyaWN0IjsgICAgcmV0dXJuIGJvZHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG4nKSh0KX1mdW5jdGlvbiBJZShlLHQpe3ZhciByPU1lKHQsKGZ1bmN0aW9uKGUpe3RoaXMubmFtZT10LHRoaXMubWVzc2FnZT1lO3ZhciByPW5ldyBFcnJvcihlKS5zdGFjazt2b2lkIDAhPT1yJiYodGhpcy5zdGFjaz10aGlzLnRvU3RyaW5nKCkrIlxuIityLnJlcGxhY2UoL15FcnJvcig6W15cbl0qKT9cbi8sIiIpKX0pKTtyZXR1cm4gci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlLnByb3RvdHlwZSksci5wcm90b3R5cGUuY29uc3RydWN0b3I9cixyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB2b2lkIDA9PT10aGlzLm1lc3NhZ2U/dGhpcy5uYW1lOnRoaXMubmFtZSsiOiAiK3RoaXMubWVzc2FnZX0scn12YXIgQmU9dm9pZCAwO2Z1bmN0aW9uIExlKGUpe3Rocm93IG5ldyBCZShlKX1mdW5jdGlvbiB4ZShlLHQscil7ZnVuY3Rpb24gbih0KXt2YXIgbj1yKHQpO24ubGVuZ3RoIT09ZS5sZW5ndGgmJkxlKCJNaXNtYXRjaGVkIHR5cGUgY29udmVydGVyIGNvdW50Iik7Zm9yKHZhciBvPTA7bzxlLmxlbmd0aDsrK28pWWUoZVtvXSxuW29dKX1lLmZvckVhY2goKGZ1bmN0aW9uKGUpe05lW2VdPXR9KSk7dmFyIG89bmV3IEFycmF5KHQubGVuZ3RoKSxpPVtdLGE9MDt0LmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7Q2UuaGFzT3duUHJvcGVydHkoZSk/b1t0XT1DZVtlXTooaS5wdXNoKGUpLE9lLmhhc093blByb3BlcnR5KGUpfHwoT2VbZV09W10pLE9lW2VdLnB1c2goKGZ1bmN0aW9uKCl7b1t0XT1DZVtlXSwrK2E9PT1pLmxlbmd0aCYmbihvKX0pKSl9KSksMD09PWkubGVuZ3RoJiZuKG8pfWZ1bmN0aW9uIGplKGUpe3N3aXRjaChlKXtjYXNlIDE6cmV0dXJuIDA7Y2FzZSAyOnJldHVybiAxO2Nhc2UgNDpyZXR1cm4gMjtjYXNlIDg6cmV0dXJuIDM7ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIHR5cGUgc2l6ZTogIitlKX19dmFyIFVlPXZvaWQgMDtmdW5jdGlvbiB6ZShlKXtmb3IodmFyIHQ9IiIscj1lO09bcl07KXQrPVVlW09bcisrXV07cmV0dXJuIHR9dmFyICRlPXZvaWQgMDtmdW5jdGlvbiBXZShlKXt0aHJvdyBuZXcgJGUoZSl9ZnVuY3Rpb24gWWUoZSx0LHIpe2lmKHI9cnx8e30sISgiYXJnUGFja0FkdmFuY2UiaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigicmVnaXN0ZXJUeXBlIHJlZ2lzdGVyZWRJbnN0YW5jZSByZXF1aXJlcyBhcmdQYWNrQWR2YW5jZSIpO3ZhciBuPXQubmFtZTtpZihlfHxXZSgndHlwZSAiJytuKyciIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGludGVnZXIgdHlwZWlkIHBvaW50ZXInKSxDZS5oYXNPd25Qcm9wZXJ0eShlKSl7aWYoci5pZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zKXJldHVybjtXZSgiQ2Fubm90IHJlZ2lzdGVyIHR5cGUgJyIrbisiJyB0d2ljZSIpfWlmKENlW2VdPXQsZGVsZXRlIE5lW2VdLE9lLmhhc093blByb3BlcnR5KGUpKXt2YXIgbz1PZVtlXTtkZWxldGUgT2VbZV0sby5mb3JFYWNoKChmdW5jdGlvbihlKXtlKCl9KSl9fWZ1bmN0aW9uIFZlKGUpe2lmKCEodGhpcyBpbnN0YW5jZW9mIGV0KSlyZXR1cm4hMTtpZighKGUgaW5zdGFuY2VvZiBldCkpcmV0dXJuITE7Zm9yKHZhciB0PXRoaXMuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Mscj10aGlzLiQkLnB0cixuPWUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Msbz1lLiQkLnB0cjt0LmJhc2VDbGFzczspcj10LnVwY2FzdChyKSx0PXQuYmFzZUNsYXNzO2Zvcig7bi5iYXNlQ2xhc3M7KW89bi51cGNhc3Qobyksbj1uLmJhc2VDbGFzcztyZXR1cm4gdD09PW4mJnI9PT1vfWZ1bmN0aW9uIEhlKGUpe1dlKGUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MubmFtZSsiIGluc3RhbmNlIGFscmVhZHkgZGVsZXRlZCIpfWZ1bmN0aW9uIEdlKCl7aWYodGhpcy4kJC5wdHJ8fEhlKHRoaXMpLHRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUpcmV0dXJuIHRoaXMuJCQuY291bnQudmFsdWUrPTEsdGhpczt2YXIgZSx0PU9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLHskJDp7dmFsdWU6KGU9dGhpcy4kJCx7Y291bnQ6ZS5jb3VudCxkZWxldGVTY2hlZHVsZWQ6ZS5kZWxldGVTY2hlZHVsZWQscHJlc2VydmVQb2ludGVyT25EZWxldGU6ZS5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSxwdHI6ZS5wdHIscHRyVHlwZTplLnB0clR5cGUsc21hcnRQdHI6ZS5zbWFydFB0cixzbWFydFB0clR5cGU6ZS5zbWFydFB0clR5cGV9KX19KTtyZXR1cm4gdC4kJC5jb3VudC52YWx1ZSs9MSx0LiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSx0fWZ1bmN0aW9uIHFlKCl7dmFyIGU7dGhpcy4kJC5wdHJ8fEhlKHRoaXMpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSYmV2UoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKSx0aGlzLiQkLmNvdW50LnZhbHVlLT0xLDA9PT10aGlzLiQkLmNvdW50LnZhbHVlJiYoKGU9dGhpcy4kJCkuc21hcnRQdHI/ZS5zbWFydFB0clR5cGUucmF3RGVzdHJ1Y3RvcihlLnNtYXJ0UHRyKTplLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLnJhd0Rlc3RydWN0b3IoZS5wdHIpKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlfHwodGhpcy4kJC5zbWFydFB0cj12b2lkIDAsdGhpcy4kJC5wdHI9dm9pZCAwKX1mdW5jdGlvbiBYZSgpe3JldHVybiF0aGlzLiQkLnB0cn12YXIgS2U9dm9pZCAwLEplPVtdO2Z1bmN0aW9uIFplKCl7Zm9yKDtKZS5sZW5ndGg7KXt2YXIgZT1KZS5wb3AoKTtlLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSxlLmRlbGV0ZSgpfX1mdW5jdGlvbiBRZSgpe3JldHVybiB0aGlzLiQkLnB0cnx8SGUodGhpcyksdGhpcy4kJC5kZWxldGVTY2hlZHVsZWQmJiF0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlJiZXZSgiT2JqZWN0IGFscmVhZHkgc2NoZWR1bGVkIGZvciBkZWxldGlvbiIpLEplLnB1c2godGhpcyksMT09PUplLmxlbmd0aCYmS2UmJktlKFplKSx0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMCx0aGlzfWZ1bmN0aW9uIGV0KCl7fXZhciB0dD17fTtmdW5jdGlvbiBydChlLHQscil7aWYodm9pZCAwPT09ZVt0XS5vdmVybG9hZFRhYmxlKXt2YXIgbj1lW3RdO2VbdF09ZnVuY3Rpb24oKXtyZXR1cm4gZVt0XS5vdmVybG9hZFRhYmxlLmhhc093blByb3BlcnR5KGFyZ3VtZW50cy5sZW5ndGgpfHxXZSgiRnVuY3Rpb24gJyIrcisiJyBjYWxsZWQgd2l0aCBhbiBpbnZhbGlkIG51bWJlciBvZiBhcmd1bWVudHMgKCIrYXJndW1lbnRzLmxlbmd0aCsiKSAtIGV4cGVjdHMgb25lIG9mICgiK2VbdF0ub3ZlcmxvYWRUYWJsZSsiKSEiKSxlW3RdLm92ZXJsb2FkVGFibGVbYXJndW1lbnRzLmxlbmd0aF0uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxlW3RdLm92ZXJsb2FkVGFibGU9W10sZVt0XS5vdmVybG9hZFRhYmxlW24uYXJnQ291bnRdPW59fWZ1bmN0aW9uIG50KGUsdCxyLG4sbyxpLGEscyl7dGhpcy5uYW1lPWUsdGhpcy5jb25zdHJ1Y3Rvcj10LHRoaXMuaW5zdGFuY2VQcm90b3R5cGU9cix0aGlzLnJhd0Rlc3RydWN0b3I9bix0aGlzLmJhc2VDbGFzcz1vLHRoaXMuZ2V0QWN0dWFsVHlwZT1pLHRoaXMudXBjYXN0PWEsdGhpcy5kb3duY2FzdD1zLHRoaXMucHVyZVZpcnR1YWxGdW5jdGlvbnM9W119ZnVuY3Rpb24gb3QoZSx0LHIpe2Zvcig7dCE9PXI7KXQudXBjYXN0fHxXZSgiRXhwZWN0ZWQgbnVsbCBvciBpbnN0YW5jZSBvZiAiK3IubmFtZSsiLCBnb3QgYW4gaW5zdGFuY2Ugb2YgIit0Lm5hbWUpLGU9dC51cGNhc3QoZSksdD10LmJhc2VDbGFzcztyZXR1cm4gZX1mdW5jdGlvbiBpdChlLHQpe2lmKG51bGw9PT10KXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZXZSgibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksMDt0LiQkfHxXZSgnQ2Fubm90IHBhc3MgIicrT3QodCkrJyIgYXMgYSAnK3RoaXMubmFtZSksdC4kJC5wdHJ8fFdlKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSk7dmFyIHI9dC4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcztyZXR1cm4gb3QodC4kJC5wdHIscix0aGlzLnJlZ2lzdGVyZWRDbGFzcyl9ZnVuY3Rpb24gYXQoZSx0KXt2YXIgcjtpZihudWxsPT09dClyZXR1cm4gdGhpcy5pc1JlZmVyZW5jZSYmV2UoIm51bGwgaXMgbm90IGEgdmFsaWQgIit0aGlzLm5hbWUpLHRoaXMuaXNTbWFydFBvaW50ZXI/KHI9dGhpcy5yYXdDb25zdHJ1Y3RvcigpLG51bGwhPT1lJiZlLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHIpLHIpOjA7dC4kJHx8V2UoJ0Nhbm5vdCBwYXNzICInK090KHQpKyciIGFzIGEgJyt0aGlzLm5hbWUpLHQuJCQucHRyfHxXZSgiQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgIit0aGlzLm5hbWUpLCF0aGlzLmlzQ29uc3QmJnQuJCQucHRyVHlwZS5pc0NvbnN0JiZXZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiKyh0LiQkLnNtYXJ0UHRyVHlwZT90LiQkLnNtYXJ0UHRyVHlwZS5uYW1lOnQuJCQucHRyVHlwZS5uYW1lKSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTt2YXIgbj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO2lmKHI9b3QodC4kJC5wdHIsbix0aGlzLnJlZ2lzdGVyZWRDbGFzcyksdGhpcy5pc1NtYXJ0UG9pbnRlcilzd2l0Y2godm9pZCAwPT09dC4kJC5zbWFydFB0ciYmV2UoIlBhc3NpbmcgcmF3IHBvaW50ZXIgdG8gc21hcnQgcG9pbnRlciBpcyBpbGxlZ2FsIiksdGhpcy5zaGFyaW5nUG9saWN5KXtjYXNlIDA6dC4kJC5zbWFydFB0clR5cGU9PT10aGlzP3I9dC4kJC5zbWFydFB0cjpXZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiKyh0LiQkLnNtYXJ0UHRyVHlwZT90LiQkLnNtYXJ0UHRyVHlwZS5uYW1lOnQuJCQucHRyVHlwZS5uYW1lKSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTticmVhaztjYXNlIDE6cj10LiQkLnNtYXJ0UHRyO2JyZWFrO2Nhc2UgMjppZih0LiQkLnNtYXJ0UHRyVHlwZT09PXRoaXMpcj10LiQkLnNtYXJ0UHRyO2Vsc2V7dmFyIG89dC5jbG9uZSgpO3I9dGhpcy5yYXdTaGFyZShyLFJ0KChmdW5jdGlvbigpe28uZGVsZXRlKCl9KSkpLG51bGwhPT1lJiZlLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHIpfWJyZWFrO2RlZmF1bHQ6V2UoIlVuc3VwcG9ydGluZyBzaGFyaW5nIHBvbGljeSIpfXJldHVybiByfWZ1bmN0aW9uIHN0KGUsdCl7aWYobnVsbD09PXQpcmV0dXJuIHRoaXMuaXNSZWZlcmVuY2UmJldlKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKSwwO3QuJCR8fFdlKCdDYW5ub3QgcGFzcyAiJytPdCh0KSsnIiBhcyBhICcrdGhpcy5uYW1lKSx0LiQkLnB0cnx8V2UoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKSx0LiQkLnB0clR5cGUuaXNDb25zdCYmV2UoIkNhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgIit0LiQkLnB0clR5cGUubmFtZSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTt2YXIgcj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO3JldHVybiBvdCh0LiQkLnB0cixyLHRoaXMucmVnaXN0ZXJlZENsYXNzKX1mdW5jdGlvbiB1dChlKXtyZXR1cm4gdGhpcy5yYXdHZXRQb2ludGVlJiYoZT10aGlzLnJhd0dldFBvaW50ZWUoZSkpLGV9ZnVuY3Rpb24gY3QoZSl7dGhpcy5yYXdEZXN0cnVjdG9yJiZ0aGlzLnJhd0Rlc3RydWN0b3IoZSl9ZnVuY3Rpb24gbHQoZSl7bnVsbCE9PWUmJmUuZGVsZXRlKCl9ZnVuY3Rpb24gZnQoKXtyZXR1cm4gT2JqZWN0LmtleXMocHQpLmxlbmd0aH1mdW5jdGlvbiBkdCgpe3ZhciBlPVtdO2Zvcih2YXIgdCBpbiBwdClwdC5oYXNPd25Qcm9wZXJ0eSh0KSYmZS5wdXNoKHB0W3RdKTtyZXR1cm4gZX1mdW5jdGlvbiBodChlKXtLZT1lLEplLmxlbmd0aCYmS2UmJktlKFplKX12YXIgcHQ9e307ZnVuY3Rpb24gbXQoZSx0KXtyZXR1cm4gdD1mdW5jdGlvbihlLHQpe2Zvcih2b2lkIDA9PT10JiZXZSgicHRyIHNob3VsZCBub3QgYmUgdW5kZWZpbmVkIik7ZS5iYXNlQ2xhc3M7KXQ9ZS51cGNhc3QodCksZT1lLmJhc2VDbGFzcztyZXR1cm4gdH0oZSx0KSxwdFt0XX1mdW5jdGlvbiB5dChlLHQpe3JldHVybiB0LnB0clR5cGUmJnQucHRyfHxMZSgibWFrZUNsYXNzSGFuZGxlIHJlcXVpcmVzIHB0ciBhbmQgcHRyVHlwZSIpLCEhdC5zbWFydFB0clR5cGUhPT0hIXQuc21hcnRQdHImJkxlKCJCb3RoIHNtYXJ0UHRyVHlwZSBhbmQgc21hcnRQdHIgbXVzdCBiZSBzcGVjaWZpZWQiKSx0LmNvdW50PXt2YWx1ZToxfSxPYmplY3QuY3JlYXRlKGUseyQkOnt2YWx1ZTp0fX0pfWZ1bmN0aW9uIEV0KGUpe3ZhciB0PXRoaXMuZ2V0UG9pbnRlZShlKTtpZighdClyZXR1cm4gdGhpcy5kZXN0cnVjdG9yKGUpLG51bGw7dmFyIHI9bXQodGhpcy5yZWdpc3RlcmVkQ2xhc3MsdCk7aWYodm9pZCAwIT09cil7aWYoMD09PXIuJCQuY291bnQudmFsdWUpcmV0dXJuIHIuJCQucHRyPXQsci4kJC5zbWFydFB0cj1lLHIuY2xvbmUoKTt2YXIgbj1yLmNsb25lKCk7cmV0dXJuIHRoaXMuZGVzdHJ1Y3RvcihlKSxufWZ1bmN0aW9uIG8oKXtyZXR1cm4gdGhpcy5pc1NtYXJ0UG9pbnRlcj95dCh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLnBvaW50ZWVUeXBlLHB0cjp0LHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOmV9KTp5dCh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLHB0cjplfSl9dmFyIGksYT10aGlzLnJlZ2lzdGVyZWRDbGFzcy5nZXRBY3R1YWxUeXBlKHQpLHM9dHRbYV07aWYoIXMpcmV0dXJuIG8uY2FsbCh0aGlzKTtpPXRoaXMuaXNDb25zdD9zLmNvbnN0UG9pbnRlclR5cGU6cy5wb2ludGVyVHlwZTt2YXIgdT1mdW5jdGlvbiBlKHQscixuKXtpZihyPT09bilyZXR1cm4gdDtpZih2b2lkIDA9PT1uLmJhc2VDbGFzcylyZXR1cm4gbnVsbDt2YXIgbz1lKHQscixuLmJhc2VDbGFzcyk7cmV0dXJuIG51bGw9PT1vP251bGw6bi5kb3duY2FzdChvKX0odCx0aGlzLnJlZ2lzdGVyZWRDbGFzcyxpLnJlZ2lzdGVyZWRDbGFzcyk7cmV0dXJuIG51bGw9PT11P28uY2FsbCh0aGlzKTp0aGlzLmlzU21hcnRQb2ludGVyP3l0KGkucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOmkscHRyOnUsc21hcnRQdHJUeXBlOnRoaXMsc21hcnRQdHI6ZX0pOnl0KGkucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOmkscHRyOnV9KX1mdW5jdGlvbiBndChlLHQscixuLG8saSxhLHMsdSxjLGwpe3RoaXMubmFtZT1lLHRoaXMucmVnaXN0ZXJlZENsYXNzPXQsdGhpcy5pc1JlZmVyZW5jZT1yLHRoaXMuaXNDb25zdD1uLHRoaXMuaXNTbWFydFBvaW50ZXI9byx0aGlzLnBvaW50ZWVUeXBlPWksdGhpcy5zaGFyaW5nUG9saWN5PWEsdGhpcy5yYXdHZXRQb2ludGVlPXMsdGhpcy5yYXdDb25zdHJ1Y3Rvcj11LHRoaXMucmF3U2hhcmU9Yyx0aGlzLnJhd0Rlc3RydWN0b3I9bCxvfHx2b2lkIDAhPT10LmJhc2VDbGFzcz90aGlzLnRvV2lyZVR5cGU9YXQ6bj8odGhpcy50b1dpcmVUeXBlPWl0LHRoaXMuZGVzdHJ1Y3RvckZ1bmN0aW9uPW51bGwpOih0aGlzLnRvV2lyZVR5cGU9c3QsdGhpcy5kZXN0cnVjdG9yRnVuY3Rpb249bnVsbCl9ZnVuY3Rpb24gdnQoZSx0KXt2YXIgcjtpZihlPXplKGUpLHZvaWQgMCE9PW9bIkZVTkNUSU9OX1RBQkxFXyIrZV0pcj1vWyJGVU5DVElPTl9UQUJMRV8iK2VdW3RdO2Vsc2UgaWYoInVuZGVmaW5lZCIhPXR5cGVvZiBGVU5DVElPTl9UQUJMRSlyPUZVTkNUSU9OX1RBQkxFW3RdO2Vsc2V7dmFyIG49by5hc21bImR5bkNhbGxfIitlXTt2b2lkIDA9PT1uJiZ2b2lkIDA9PT0obj1vLmFzbVsiZHluQ2FsbF8iK2UucmVwbGFjZSgvZi9nLCJkIildKSYmV2UoIk5vIGR5bkNhbGwgaW52b2tlciBmb3Igc2lnbmF0dXJlOiAiK2UpLHI9ZnVuY3Rpb24ocil7Zm9yKHZhciBuPVtdLG89MTtvPGUubGVuZ3RoOysrbyluLnB1c2goImEiK28pO3ZhciBpPSJyZXR1cm4gZnVuY3Rpb24gIisoImR5bkNhbGxfIitlKyJfIit0KSsiKCIrbi5qb2luKCIsICIpKyIpIHtcbiI7cmV0dXJuIGkrPSIgICAgcmV0dXJuIGR5bkNhbGwocmF3RnVuY3Rpb24iKyhuLmxlbmd0aD8iLCAiOiIiKStuLmpvaW4oIiwgIikrIik7XG4iLGkrPSJ9O1xuIixuZXcgRnVuY3Rpb24oImR5bkNhbGwiLCJyYXdGdW5jdGlvbiIsaSkocix0KX0obil9cmV0dXJuImZ1bmN0aW9uIiE9dHlwZW9mIHImJldlKCJ1bmtub3duIGZ1bmN0aW9uIHBvaW50ZXIgd2l0aCBzaWduYXR1cmUgIitlKyI6ICIrdCkscn12YXIgd3Q9dm9pZCAwO2Z1bmN0aW9uIF90KGUpe3ZhciB0PXF0KGUpLHI9emUodCk7cmV0dXJuIEt0KHQpLHJ9ZnVuY3Rpb24gYnQoZSx0KXt2YXIgcj1bXSxuPXt9O3Rocm93IHQuZm9yRWFjaCgoZnVuY3Rpb24gZSh0KXtuW3RdfHxDZVt0XXx8KE5lW3RdP05lW3RdLmZvckVhY2goZSk6KHIucHVzaCh0KSxuW3RdPSEwKSl9KSksbmV3IHd0KGUrIjogIityLm1hcChfdCkuam9pbihbIiwgIl0pKX1mdW5jdGlvbiBBdChlLHQpe2Zvcih2YXIgcj1bXSxuPTA7bjxlO24rKylyLnB1c2goRlsodD4+Mikrbl0pO3JldHVybiByfWZ1bmN0aW9uIFR0KGUsdCxyLG4sbyl7dmFyIGk9dC5sZW5ndGg7aTwyJiZXZSgiYXJnVHlwZXMgYXJyYXkgc2l6ZSBtaXNtYXRjaCEgTXVzdCBhdCBsZWFzdCBnZXQgcmV0dXJuIHZhbHVlIGFuZCAndGhpcycgdHlwZXMhIik7Zm9yKHZhciBhPW51bGwhPT10WzFdJiZudWxsIT09cixzPSExLHU9MTt1PHQubGVuZ3RoOysrdSlpZihudWxsIT09dFt1XSYmdm9pZCAwPT09dFt1XS5kZXN0cnVjdG9yRnVuY3Rpb24pe3M9ITA7YnJlYWt9dmFyIGM9InZvaWQiIT09dFswXS5uYW1lLGw9IiIsZj0iIjtmb3IodT0wO3U8aS0yOysrdSlsKz0oMCE9PXU/IiwgIjoiIikrImFyZyIrdSxmKz0oMCE9PXU/IiwgIjoiIikrImFyZyIrdSsiV2lyZWQiO3ZhciBkPSJyZXR1cm4gZnVuY3Rpb24gIitGZShlKSsiKCIrbCsiKSB7XG5pZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gIisoaS0yKSsiKSB7XG50aHJvd0JpbmRpbmdFcnJvcignZnVuY3Rpb24gIitlKyIgY2FsbGVkIHdpdGggJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIGFyZ3VtZW50cywgZXhwZWN0ZWQgIisoaS0yKSsiIGFyZ3MhJyk7XG59XG4iO3MmJihkKz0idmFyIGRlc3RydWN0b3JzID0gW107XG4iKTt2YXIgaD1zPyJkZXN0cnVjdG9ycyI6Im51bGwiLHA9WyJ0aHJvd0JpbmRpbmdFcnJvciIsImludm9rZXIiLCJmbiIsInJ1bkRlc3RydWN0b3JzIiwicmV0VHlwZSIsImNsYXNzUGFyYW0iXSxtPVtXZSxuLG8sRGUsdFswXSx0WzFdXTthJiYoZCs9InZhciB0aGlzV2lyZWQgPSBjbGFzc1BhcmFtLnRvV2lyZVR5cGUoIitoKyIsIHRoaXMpO1xuIik7Zm9yKHU9MDt1PGktMjsrK3UpZCs9InZhciBhcmciK3UrIldpcmVkID0gYXJnVHlwZSIrdSsiLnRvV2lyZVR5cGUoIitoKyIsIGFyZyIrdSsiKTsgLy8gIit0W3UrMl0ubmFtZSsiXG4iLHAucHVzaCgiYXJnVHlwZSIrdSksbS5wdXNoKHRbdSsyXSk7aWYoYSYmKGY9InRoaXNXaXJlZCIrKGYubGVuZ3RoPjA/IiwgIjoiIikrZiksZCs9KGM/InZhciBydiA9ICI6IiIpKyJpbnZva2VyKGZuIisoZi5sZW5ndGg+MD8iLCAiOiIiKStmKyIpO1xuIixzKWQrPSJydW5EZXN0cnVjdG9ycyhkZXN0cnVjdG9ycyk7XG4iO2Vsc2UgZm9yKHU9YT8xOjI7dTx0Lmxlbmd0aDsrK3Upe3ZhciB5PTE9PT11PyJ0aGlzV2lyZWQiOiJhcmciKyh1LTIpKyJXaXJlZCI7bnVsbCE9PXRbdV0uZGVzdHJ1Y3RvckZ1bmN0aW9uJiYoZCs9eSsiX2R0b3IoIit5KyIpOyAvLyAiK3RbdV0ubmFtZSsiXG4iLHAucHVzaCh5KyJfZHRvciIpLG0ucHVzaCh0W3VdLmRlc3RydWN0b3JGdW5jdGlvbikpfXJldHVybiBjJiYoZCs9InZhciByZXQgPSByZXRUeXBlLmZyb21XaXJlVHlwZShydik7XG5yZXR1cm4gcmV0O1xuIiksZCs9In1cbiIscC5wdXNoKGQpLGZ1bmN0aW9uKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgRnVuY3Rpb24pKXRocm93IG5ldyBUeXBlRXJyb3IoIm5ld18gY2FsbGVkIHdpdGggY29uc3RydWN0b3IgdHlwZSAiK3R5cGVvZiBlKyIgd2hpY2ggaXMgbm90IGEgZnVuY3Rpb24iKTt2YXIgcj1NZShlLm5hbWV8fCJ1bmtub3duRnVuY3Rpb25OYW1lIiwoZnVuY3Rpb24oKXt9KSk7ci5wcm90b3R5cGU9ZS5wcm90b3R5cGU7dmFyIG49bmV3IHIsbz1lLmFwcGx5KG4sdCk7cmV0dXJuIG8gaW5zdGFuY2VvZiBPYmplY3Q/bzpufShGdW5jdGlvbixwKS5hcHBseShudWxsLG0pfXZhciBTdD1bXSxrdD1be30se3ZhbHVlOnZvaWQgMH0se3ZhbHVlOm51bGx9LHt2YWx1ZTohMH0se3ZhbHVlOiExfV07ZnVuY3Rpb24gUHQoKXtmb3IodmFyIGU9MCx0PTU7dDxrdC5sZW5ndGg7Kyt0KXZvaWQgMCE9PWt0W3RdJiYrK2U7cmV0dXJuIGV9ZnVuY3Rpb24gRHQoKXtmb3IodmFyIGU9NTtlPGt0Lmxlbmd0aDsrK2UpaWYodm9pZCAwIT09a3RbZV0pcmV0dXJuIGt0W2VdO3JldHVybiBudWxsfWZ1bmN0aW9uIFJ0KGUpe3N3aXRjaChlKXtjYXNlIHZvaWQgMDpyZXR1cm4gMTtjYXNlIG51bGw6cmV0dXJuIDI7Y2FzZSEwOnJldHVybiAzO2Nhc2UhMTpyZXR1cm4gNDtkZWZhdWx0OnZhciB0PVN0Lmxlbmd0aD9TdC5wb3AoKTprdC5sZW5ndGg7cmV0dXJuIGt0W3RdPXtyZWZjb3VudDoxLHZhbHVlOmV9LHR9fWZ1bmN0aW9uIE90KGUpe2lmKG51bGw9PT1lKXJldHVybiJudWxsIjt2YXIgdD10eXBlb2YgZTtyZXR1cm4ib2JqZWN0Ij09PXR8fCJhcnJheSI9PT10fHwiZnVuY3Rpb24iPT09dD9lLnRvU3RyaW5nKCk6IiIrZX1mdW5jdGlvbiBDdChlLHQpe3N3aXRjaCh0KXtjYXNlIDI6cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShJW2U+PjJdKX07Y2FzZSAzOnJldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoQltlPj4zXSl9O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBmbG9hdCB0eXBlOiAiK2UpfX1mdW5jdGlvbiBOdChlLHQscil7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gUltlXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE9bZV19O2Nhc2UgMTpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gQ1tlPj4xXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE5bZT4+MV19O2Nhc2UgMjpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gRltlPj4yXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE1bZT4+Ml19O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBpbnRlZ2VyIHR5cGU6ICIrZSl9fXZhciBGdD1MKz0xNjt2YXIgTXQ9e307dmFyIEl0PUwrPTE2O0wrPTQ4O2coJHQoIkdNVCIpLCJpOCIsMik7dmFyIEJ0PUwsTHQ9TCs9MTYseHQ9TCs9MTY7ZnVuY3Rpb24ganQoKXtpZighanQuY2FsbGVkKXtqdC5jYWxsZWQ9ITAsRlt4dD4+Ml09NjAqKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpO3ZhciBlPW5ldyBEYXRlKDJlMywwLDEpLHQ9bmV3IERhdGUoMmUzLDYsMSk7RltMdD4+Ml09TnVtYmVyKGUuZ2V0VGltZXpvbmVPZmZzZXQoKSE9dC5nZXRUaW1lem9uZU9mZnNldCgpKTt2YXIgcj1hKGUpLG49YSh0KSxvPWcoJHQociksImk4IiwwKSxpPWcoJHQobiksImk4IiwwKTt0LmdldFRpbWV6b25lT2Zmc2V0KCk8ZS5nZXRUaW1lem9uZU9mZnNldCgpPyhGW0J0Pj4yXT1vLEZbQnQrND4+Ml09aSk6KEZbQnQ+PjJdPWksRltCdCs0Pj4yXT1vKX1mdW5jdGlvbiBhKGUpe3ZhciB0PWUudG9UaW1lU3RyaW5nKCkubWF0Y2goL1woKFtBLVphLXogXSspXCkkLyk7cmV0dXJuIHQ/dFsxXToiR01UIn19TCs9MTY7dmFyIFV0PXt9O3ZhciB6dD0xO2Z1bmN0aW9uICR0KGUsdCxyKXt2YXIgbj1yPjA/cjpTKGUpKzEsbz1uZXcgQXJyYXkobiksaT1BKGUsbywwLG8ubGVuZ3RoKTtyZXR1cm4gdCYmKG8ubGVuZ3RoPWkpLG99VGUuc3RhdGljSW5pdCgpLEoudW5zaGlmdCgoZnVuY3Rpb24oKXtvLm5vRlNJbml0fHxUZS5pbml0LmluaXRpYWxpemVkfHxUZS5pbml0KCl9KSksWi5wdXNoKChmdW5jdGlvbigpe1RlLmlnbm9yZVBlcm1pc3Npb25zPSExfSkpLFEucHVzaCgoZnVuY3Rpb24oKXtUZS5xdWl0KCl9KSksSi51bnNoaWZ0KChmdW5jdGlvbigpe3ZlLmluaXQoKX0pKSxRLnB1c2goKGZ1bmN0aW9uKCl7dmUuc2h1dGRvd24oKX0pKSxCZT1vLkludGVybmFsRXJyb3I9SWUoRXJyb3IsIkludGVybmFsRXJyb3IiKSxmdW5jdGlvbigpe2Zvcih2YXIgZT1uZXcgQXJyYXkoMjU2KSx0PTA7dDwyNTY7Kyt0KWVbdF09U3RyaW5nLmZyb21DaGFyQ29kZSh0KTtVZT1lfSgpLCRlPW8uQmluZGluZ0Vycm9yPUllKEVycm9yLCJCaW5kaW5nRXJyb3IiKSxldC5wcm90b3R5cGUuaXNBbGlhc09mPVZlLGV0LnByb3RvdHlwZS5jbG9uZT1HZSxldC5wcm90b3R5cGUuZGVsZXRlPXFlLGV0LnByb3RvdHlwZS5pc0RlbGV0ZWQ9WGUsZXQucHJvdG90eXBlLmRlbGV0ZUxhdGVyPVFlLGd0LnByb3RvdHlwZS5nZXRQb2ludGVlPXV0LGd0LnByb3RvdHlwZS5kZXN0cnVjdG9yPWN0LGd0LnByb3RvdHlwZS5hcmdQYWNrQWR2YW5jZT04LGd0LnByb3RvdHlwZS5yZWFkVmFsdWVGcm9tUG9pbnRlcj1SZSxndC5wcm90b3R5cGUuZGVsZXRlT2JqZWN0PWx0LGd0LnByb3RvdHlwZS5mcm9tV2lyZVR5cGU9RXQsby5nZXRJbmhlcml0ZWRJbnN0YW5jZUNvdW50PWZ0LG8uZ2V0TGl2ZUluaGVyaXRlZEluc3RhbmNlcz1kdCxvLmZsdXNoUGVuZGluZ0RlbGV0ZXM9WmUsby5zZXREZWxheUZ1bmN0aW9uPWh0LHd0PW8uVW5ib3VuZFR5cGVFcnJvcj1JZShFcnJvciwiVW5ib3VuZFR5cGVFcnJvciIpLG8uY291bnRfZW12YWxfaGFuZGxlcz1QdCxvLmdldF9maXJzdF9lbXZhbD1EdCxmdW5jdGlvbiBlKHQpe3ZhciByLG47ZS5jYWxsZWQ/KG49RltGdD4+Ml0scj1GW24+PjJdKTooZS5jYWxsZWQ9ITAsTXQuVVNFUj1NdC5MT0dOQU1FPSJ3ZWJfdXNlciIsTXQuUEFUSD0iLyIsTXQuUFdEPSIvIixNdC5IT01FPSIvaG9tZS93ZWJfdXNlciIsTXQuTEFORz0iQy5VVEYtOCIsTXQuXz1vLnRoaXNQcm9ncmFtLHI9ZigxMDI0KSxuPWYoMjU2KSxGW24+PjJdPXIsRltGdD4+Ml09bik7dmFyIGk9W10sYT0wO2Zvcih2YXIgcyBpbiB0KWlmKCJzdHJpbmciPT10eXBlb2YgdFtzXSl7dmFyIHU9cysiPSIrdFtzXTtpLnB1c2godSksYSs9dS5sZW5ndGh9aWYoYT4xMDI0KXRocm93IG5ldyBFcnJvcigiRW52aXJvbm1lbnQgc2l6ZSBleGNlZWRlZCBUT1RBTF9FTlZfU0laRSEiKTtmb3IodmFyIGM9MDtjPGkubGVuZ3RoO2MrKyl7cmUodT1pW2NdLHIpLEZbbis0KmM+PjJdPXIscis9dS5sZW5ndGgrMX1GW24rNCppLmxlbmd0aD4+Ml09MH0oTXQpLCQ9Zig0KSxqPVU9aChMKSx6PWgoaitHKSxGWyQ+PjJdPXoseD0hMCxvLndhc21UYWJsZVNpemU9MzE2LG8ud2FzbU1heFRhYmxlU2l6ZT0zMTYsby5hc21HbG9iYWxBcmc9e30sby5hc21MaWJyYXJ5QXJnPXthYm9ydDpycixlbmxhcmdlTWVtb3J5OkgsZ2V0VG90YWxNZW1vcnk6ZnVuY3Rpb24oKXtyZXR1cm4gcX0sYWJvcnRPbkNhbm5vdEdyb3dNZW1vcnk6ZnVuY3Rpb24oKXtycigiQ2Fubm90IGVubGFyZ2UgbWVtb3J5IGFycmF5cy4gRWl0aGVyICgxKSBjb21waWxlIHdpdGggIC1zIFRPVEFMX01FTU9SWT1YICB3aXRoIFggaGlnaGVyIHRoYW4gdGhlIGN1cnJlbnQgdmFsdWUgIitxKyIsICgyKSBjb21waWxlIHdpdGggIC1zIEFMTE9XX01FTU9SWV9HUk9XVEg9MSAgd2hpY2ggYWxsb3dzIGluY3JlYXNpbmcgdGhlIHNpemUgYXQgcnVudGltZSwgb3IgKDMpIGlmIHlvdSB3YW50IG1hbGxvYyB0byByZXR1cm4gTlVMTCAoMCkgaW5zdGVhZCBvZiB0aGlzIGFib3J0LCBjb21waWxlIHdpdGggIC1zIEFCT1JUSU5HX01BTExPQz0wICIpfSxpbnZva2VfaTpmdW5jdGlvbihlKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9pKGUpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paTpmdW5jdGlvbihlLHQpe3RyeXtyZXR1cm4gby5keW5DYWxsX2lpKGUsdCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX2lpaTpmdW5jdGlvbihlLHQscil7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpKGUsdCxyKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfaWlpaTpmdW5jdGlvbihlLHQscixuKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9paWlpKGUsdCxyLG4pfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paWlpaTpmdW5jdGlvbihlLHQscixuLGkpe3RyeXtyZXR1cm4gby5keW5DYWxsX2lpaWlpKGUsdCxyLG4saSl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX2lpaWlpaWk6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyl7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpaWlpaShlLHQscixuLGksYSxzKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfaWlpaWlpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSxzLHUsYyxsKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9paWlpaWlpaWlpKGUsdCxyLG4saSxhLHMsdSxjLGwpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paWlpaWlqaWk6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyx1LGMsbCl7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpaWlpamlpKGUsdCxyLG4saSxhLHMsdSxjLGwpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9pamo6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9pamooZSx0LHIsbixpKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2Vfamk6ZnVuY3Rpb24oZSx0KXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9qaShlLHQpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92OmZ1bmN0aW9uKGUpe3RyeXtvLmR5bkNhbGxfdihlKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2Vfdmk6ZnVuY3Rpb24oZSx0KXt0cnl7by5keW5DYWxsX3ZpKGUsdCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaTpmdW5jdGlvbihlLHQscil7dHJ5e28uZHluQ2FsbF92aWkoZSx0LHIpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWlpOmZ1bmN0aW9uKGUsdCxyLG4pe3RyeXtvLmR5bkNhbGxfdmlpaShlLHQscixuKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfdmlpaWk6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7by5keW5DYWxsX3ZpaWlpKGUsdCxyLG4saSl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSl7dHJ5e28uZHluQ2FsbF92aWlpaWkoZSx0LHIsbixpLGEpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWlpaWlpOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMpe3RyeXtvLmR5bkNhbGxfdmlpaWlpaShlLHQscixuLGksYSxzKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfdmlpaWlpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSxzLHUsYyxsKXt0cnl7by5keW5DYWxsX3ZpaWlpaWlpaWkoZSx0LHIsbixpLGEscyx1LGMsbCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaWlpaWlpaWlpOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMsdSxjLGwsZil7dHJ5e28uZHluQ2FsbF92aWlpaWlpaWlpaShlLHQscixuLGksYSxzLHUsYyxsLGYpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWo6ZnVuY3Rpb24oZSx0LHIsbil7dHJ5e28uZHluQ2FsbF92aWooZSx0LHIsbil9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3Zpamk6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7by5keW5DYWxsX3ZpamkoZSx0LHIsbixpKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxfX19jeGFfYWxsb2NhdGVfZXhjZXB0aW9uOmZ1bmN0aW9uKGUpe3JldHVybiBKdChlKX0sX19fY3hhX2JlZ2luX2NhdGNoOmZ1bmN0aW9uKGUpe3ZhciB0PWRlLmluZm9zW2VdO3JldHVybiB0JiYhdC5jYXVnaHQmJih0LmNhdWdodD0hMCksdCYmKHQucmV0aHJvd249ITEpLGRlLmNhdWdodC5wdXNoKGUpLGRlLmFkZFJlZihkZS5kZUFkanVzdChlKSksZX0sX19fY3hhX2VuZF9jYXRjaDpmdW5jdGlvbigpe28uc2V0VGhyZXcoMCk7dmFyIGU9ZGUuY2F1Z2h0LnBvcCgpO2UmJihkZS5kZWNSZWYoZGUuZGVBZGp1c3QoZSkpLGRlLmxhc3Q9MCl9LF9fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoXzI6ZnVuY3Rpb24oKXtyZXR1cm4gcGUuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8zOmZ1bmN0aW9uKCl7cmV0dXJuIHBlLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2hfNDpmdW5jdGlvbigpe3JldHVybiBwZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9fX2N4YV9mcmVlX2V4Y2VwdGlvbjpoZSxfX19jeGFfdGhyb3c6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IGRlLmluZm9zW2VdPXtwdHI6ZSxhZGp1c3RlZDplLHR5cGU6dCxkZXN0cnVjdG9yOnIscmVmY291bnQ6MCxjYXVnaHQ6ITEscmV0aHJvd246ITF9LGRlLmxhc3Q9ZSxlfSxfX19sb2NrOmZ1bmN0aW9uKCl7fSxfX19tYXBfZmlsZTpmdW5jdGlvbihlLHQpe3JldHVybiB5ZShtZS5FUEVSTSksLTF9LF9fX3Jlc3VtZUV4Y2VwdGlvbjpmdW5jdGlvbihlKXt0aHJvdyBkZS5sYXN0fHwoZGUubGFzdD1lKSxlfSxfX19zZXRFcnJObzp5ZSxfX19zeXNjYWxsMTQwOmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHJlYW1Gcm9tRkQoKSxuPShTZS5nZXQoKSxTZS5nZXQoKSksbz1TZS5nZXQoKSxpPVNlLmdldCgpLGE9bjtyZXR1cm4gVGUubGxzZWVrKHIsYSxpKSxGW28+PjJdPXIucG9zaXRpb24sci5nZXRkZW50cyYmMD09PWEmJjA9PT1pJiYoci5nZXRkZW50cz1udWxsKSwwfWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDE0NTpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0U3RyZWFtRnJvbUZEKCksbj1TZS5nZXQoKSxvPVNlLmdldCgpO3JldHVybiBTZS5kb1JlYWR2KHIsbixvKX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGwxNDY6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3ZhciByPVNlLmdldFN0cmVhbUZyb21GRCgpLG49U2UuZ2V0KCksbz1TZS5nZXQoKTtyZXR1cm4gU2UuZG9Xcml0ZXYocixuLG8pfWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDE4MzpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS5nZXQoKTtpZigwPT09bilyZXR1cm4tbWUuRUlOVkFMO3ZhciBvPVRlLmN3ZCgpO3JldHVybiBuPFMobykrMT8tbWUuRVJBTkdFOihUKG8scixuKSxyKX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGwxOTg6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3ZhciByPVNlLmdldFN0cigpLG49U2UuZ2V0KCksbz1TZS5nZXQoKTtyZXR1cm4gVGUuY2hvd24ocixuLG8pLDB9Y2F0Y2goZSl7cmV0dXJuIHZvaWQgMCE9PVRlJiZlIGluc3RhbmNlb2YgVGUuRXJybm9FcnJvcnx8cnIoZSksLWUuZXJybm99fSxfX19zeXNjYWxsMjA6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3JldHVybiBrZX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw2OmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHJlYW1Gcm9tRkQoKTtyZXR1cm4gVGUuY2xvc2UociksMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw2MDpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS51bWFzaztyZXR1cm4gU2UudW1hc2s9cixufWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDgzOmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHIoKSxuPVNlLmdldFN0cigpO3JldHVybiBUZS5zeW1saW5rKHIsbiksMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw5MTpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS5nZXQoKSxvPVNlLm1hcHBpbmdzW3JdO2lmKCFvKXJldHVybiAwO2lmKG49PT1vLmxlbil7dmFyIGk9VGUuZ2V0U3RyZWFtKG8uZmQpO1NlLmRvTXN5bmMocixpLG4sby5mbGFncyksVGUubXVubWFwKGkpLFNlLm1hcHBpbmdzW3JdPW51bGwsby5hbGxvY2F0ZWQmJkt0KG8ubWFsbG9jKX1yZXR1cm4gMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3VubG9jazpmdW5jdGlvbigpe30sX19lbWJpbmRfZmluYWxpemVfdmFsdWVfb2JqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0PVBlW2VdO2RlbGV0ZSBQZVtlXTt2YXIgcj10LnJhd0NvbnN0cnVjdG9yLG49dC5yYXdEZXN0cnVjdG9yLG89dC5maWVsZHM7eGUoW2VdLG8ubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gZS5nZXR0ZXJSZXR1cm5UeXBlfSkpLmNvbmNhdChvLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUuc2V0dGVyQXJndW1lbnRUeXBlfSkpKSwoZnVuY3Rpb24oZSl7dmFyIGk9e307cmV0dXJuIG8uZm9yRWFjaCgoZnVuY3Rpb24odCxyKXt2YXIgbj10LmZpZWxkTmFtZSxhPWVbcl0scz10LmdldHRlcix1PXQuZ2V0dGVyQ29udGV4dCxjPWVbcitvLmxlbmd0aF0sbD10LnNldHRlcixmPXQuc2V0dGVyQ29udGV4dDtpW25dPXtyZWFkOmZ1bmN0aW9uKGUpe3JldHVybiBhLmZyb21XaXJlVHlwZShzKHUsZSkpfSx3cml0ZTpmdW5jdGlvbihlLHQpe3ZhciByPVtdO2woZixlLGMudG9XaXJlVHlwZShyLHQpKSxEZShyKX19fSkpLFt7bmFtZTp0Lm5hbWUsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3ZhciB0PXt9O2Zvcih2YXIgciBpbiBpKXRbcl09aVtyXS5yZWFkKGUpO3JldHVybiBuKGUpLHR9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG8gaW4gaSlpZighKG8gaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiTWlzc2luZyBmaWVsZCIpO3ZhciBhPXIoKTtmb3IobyBpbiBpKWlbb10ud3JpdGUoYSx0W29dKTtyZXR1cm4gbnVsbCE9PWUmJmUucHVzaChuLGEpLGF9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6UmUsZGVzdHJ1Y3RvckZ1bmN0aW9uOm59XX0pKX0sX19lbWJpbmRfcmVnaXN0ZXJfYm9vbDpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWplKHIpO1llKGUse25hbWU6dD16ZSh0KSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7cmV0dXJuISFlfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQ/bjpvfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOmZ1bmN0aW9uKGUpe3ZhciBuO2lmKDE9PT1yKW49UjtlbHNlIGlmKDI9PT1yKW49QztlbHNle2lmKDQhPT1yKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gYm9vbGVhbiB0eXBlIHNpemU6ICIrdCk7bj1GfXJldHVybiB0aGlzLmZyb21XaXJlVHlwZShuW2U+PmldKX0sZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX0sX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3M6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyx1LGMsbCxmLGQsaCl7Zj16ZShmKSxhPXZ0KGksYSksdSYmKHU9dnQocyx1KSksbCYmKGw9dnQoYyxsKSksaD12dChkLGgpO3ZhciBwPUZlKGYpOyFmdW5jdGlvbihlLHQscil7by5oYXNPd25Qcm9wZXJ0eShlKT8oKHZvaWQgMD09PXJ8fHZvaWQgMCE9PW9bZV0ub3ZlcmxvYWRUYWJsZSYmdm9pZCAwIT09b1tlXS5vdmVybG9hZFRhYmxlW3JdKSYmV2UoIkNhbm5vdCByZWdpc3RlciBwdWJsaWMgbmFtZSAnIitlKyInIHR3aWNlIikscnQobyxlLGUpLG8uaGFzT3duUHJvcGVydHkocikmJldlKCJDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgb3ZlcmxvYWRzIG9mIGEgZnVuY3Rpb24gd2l0aCB0aGUgc2FtZSBudW1iZXIgb2YgYXJndW1lbnRzICgiK3IrIikhIiksb1tlXS5vdmVybG9hZFRhYmxlW3JdPXQpOihvW2VdPXQsdm9pZCAwIT09ciYmKG9bZV0ubnVtQXJndW1lbnRzPXIpKX0ocCwoZnVuY3Rpb24oKXtidCgiQ2Fubm90IGNvbnN0cnVjdCAiK2YrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsW25dKX0pKSx4ZShbZSx0LHJdLG4/W25dOltdLChmdW5jdGlvbih0KXt2YXIgcixpO3Q9dFswXSxpPW4/KHI9dC5yZWdpc3RlcmVkQ2xhc3MpLmluc3RhbmNlUHJvdG90eXBlOmV0LnByb3RvdHlwZTt2YXIgcz1NZShwLChmdW5jdGlvbigpe2lmKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSE9PWMpdGhyb3cgbmV3ICRlKCJVc2UgJ25ldycgdG8gY29uc3RydWN0ICIrZik7aWYodm9pZCAwPT09ZC5jb25zdHJ1Y3Rvcl9ib2R5KXRocm93IG5ldyAkZShmKyIgaGFzIG5vIGFjY2Vzc2libGUgY29uc3RydWN0b3IiKTt2YXIgZT1kLmNvbnN0cnVjdG9yX2JvZHlbYXJndW1lbnRzLmxlbmd0aF07aWYodm9pZCAwPT09ZSl0aHJvdyBuZXcgJGUoIlRyaWVkIHRvIGludm9rZSBjdG9yIG9mICIrZisiIHdpdGggaW52YWxpZCBudW1iZXIgb2YgcGFyYW1ldGVycyAoIithcmd1bWVudHMubGVuZ3RoKyIpIC0gZXhwZWN0ZWQgKCIrT2JqZWN0LmtleXMoZC5jb25zdHJ1Y3Rvcl9ib2R5KS50b1N0cmluZygpKyIpIHBhcmFtZXRlcnMgaW5zdGVhZCEiKTtyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSksYz1PYmplY3QuY3JlYXRlKGkse2NvbnN0cnVjdG9yOnt2YWx1ZTpzfX0pO3MucHJvdG90eXBlPWM7dmFyIGQ9bmV3IG50KGYscyxjLGgscixhLHUsbCksbT1uZXcgZ3QoZixkLCEwLCExLCExKSx5PW5ldyBndChmKyIqIixkLCExLCExLCExKSxFPW5ldyBndChmKyIgY29uc3QqIixkLCExLCEwLCExKTtyZXR1cm4gdHRbZV09e3BvaW50ZXJUeXBlOnksY29uc3RQb2ludGVyVHlwZTpFfSxmdW5jdGlvbihlLHQscil7by5oYXNPd25Qcm9wZXJ0eShlKXx8TGUoIlJlcGxhY2luZyBub25leGlzdGFudCBwdWJsaWMgc3ltYm9sIiksdm9pZCAwIT09b1tlXS5vdmVybG9hZFRhYmxlJiZ2b2lkIDAhPT1yP29bZV0ub3ZlcmxvYWRUYWJsZVtyXT10OihvW2VdPXQsb1tlXS5hcmdDb3VudD1yKX0ocCxzKSxbbSx5LEVdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19jb25zdHJ1Y3RvcjpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9QXQodCxyKTtvPXZ0KG4sbykseGUoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgcj0iY29uc3RydWN0b3IgIisoZT1lWzBdKS5uYW1lO2lmKHZvaWQgMD09PWUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHkmJihlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5PVtdKSx2b2lkIDAhPT1lLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W3QtMV0pdGhyb3cgbmV3ICRlKCJDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgY29uc3RydWN0b3JzIHdpdGggaWRlbnRpY2FsIG51bWJlciBvZiBwYXJhbWV0ZXJzICgiKyh0LTEpKyIpIGZvciBjbGFzcyAnIitlLm5hbWUrIichIE92ZXJsb2FkIHJlc29sdXRpb24gaXMgY3VycmVudGx5IG9ubHkgcGVyZm9ybWVkIHVzaW5nIHRoZSBwYXJhbWV0ZXIgY291bnQsIG5vdCBhY3R1YWwgdHlwZSBpbmZvISIpO3JldHVybiBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W3QtMV09ZnVuY3Rpb24oKXtidCgiQ2Fubm90IGNvbnN0cnVjdCAiK2UubmFtZSsiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixhKX0seGUoW10sYSwoZnVuY3Rpb24obil7cmV0dXJuIGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXT1mdW5jdGlvbigpe2FyZ3VtZW50cy5sZW5ndGghPT10LTEmJldlKHIrIiBjYWxsZWQgd2l0aCAiK2FyZ3VtZW50cy5sZW5ndGgrIiBhcmd1bWVudHMsIGV4cGVjdGVkICIrKHQtMSkpO3ZhciBlPVtdLGE9bmV3IEFycmF5KHQpO2FbMF09aTtmb3IodmFyIHM9MTtzPHQ7KytzKWFbc109bltzXS50b1dpcmVUeXBlKGUsYXJndW1lbnRzW3MtMV0pO3ZhciB1PW8uYXBwbHkobnVsbCxhKTtyZXR1cm4gRGUoZSksblswXS5mcm9tV2lyZVR5cGUodSl9LFtdfSkpLFtdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19mdW5jdGlvbjpmdW5jdGlvbihlLHQscixuLG8saSxhLHMpe3ZhciB1PUF0KHIsbik7dD16ZSh0KSxpPXZ0KG8saSkseGUoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgbj0oZT1lWzBdKS5uYW1lKyIuIit0O2Z1bmN0aW9uIG8oKXtidCgiQ2Fubm90IGNhbGwgIituKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLHUpfXMmJmUucmVnaXN0ZXJlZENsYXNzLnB1cmVWaXJ0dWFsRnVuY3Rpb25zLnB1c2godCk7dmFyIGM9ZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsbD1jW3RdO3JldHVybiB2b2lkIDA9PT1sfHx2b2lkIDA9PT1sLm92ZXJsb2FkVGFibGUmJmwuY2xhc3NOYW1lIT09ZS5uYW1lJiZsLmFyZ0NvdW50PT09ci0yPyhvLmFyZ0NvdW50PXItMixvLmNsYXNzTmFtZT1lLm5hbWUsY1t0XT1vKToocnQoYyx0LG4pLGNbdF0ub3ZlcmxvYWRUYWJsZVtyLTJdPW8pLHhlKFtdLHUsKGZ1bmN0aW9uKG8pe3ZhciBzPVR0KG4sbyxlLGksYSk7cmV0dXJuIHZvaWQgMD09PWNbdF0ub3ZlcmxvYWRUYWJsZT8ocy5hcmdDb3VudD1yLTIsY1t0XT1zKTpjW3RdLm92ZXJsb2FkVGFibGVbci0yXT1zLFtdfSkpLFtdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9lbXZhbDpmdW5jdGlvbihlLHQpe1llKGUse25hbWU6dD16ZSh0KSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7dmFyIHQ9a3RbZV0udmFsdWU7cmV0dXJuIGZ1bmN0aW9uKGUpe2U+NCYmMD09LS1rdFtlXS5yZWZjb3VudCYmKGt0W2VdPXZvaWQgMCxTdC5wdXNoKGUpKX0oZSksdH0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe3JldHVybiBSdCh0KX0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpSZSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9mbG9hdDpmdW5jdGlvbihlLHQscil7dmFyIG49amUocik7WWUoZSx7bmFtZTp0PXplKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4gZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe2lmKCJudW1iZXIiIT10eXBlb2YgdCYmImJvb2xlYW4iIT10eXBlb2YgdCl0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCAiJytPdCh0KSsnIiB0byAnK3RoaXMubmFtZSk7cmV0dXJuIHR9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6Q3QodCxuKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9pbnRlZ2VyOmZ1bmN0aW9uKGUsdCxyLG4sbyl7dD16ZSh0KSwtMT09PW8mJihvPTQyOTQ5NjcyOTUpO3ZhciBpPWplKHIpLGE9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9O2lmKDA9PT1uKXt2YXIgcz0zMi04KnI7YT1mdW5jdGlvbihlKXtyZXR1cm4gZTw8cz4+PnN9fXZhciB1PS0xIT10LmluZGV4T2YoInVuc2lnbmVkIik7WWUoZSx7bmFtZTp0LGZyb21XaXJlVHlwZTphLHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSxyKXtpZigibnVtYmVyIiE9dHlwZW9mIHImJiJib29sZWFuIiE9dHlwZW9mIHIpdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgIicrT3QocikrJyIgdG8gJyt0aGlzLm5hbWUpO2lmKHI8bnx8cj5vKXRocm93IG5ldyBUeXBlRXJyb3IoJ1Bhc3NpbmcgYSBudW1iZXIgIicrT3QocikrJyIgZnJvbSBKUyBzaWRlIHRvIEMvQysrIHNpZGUgdG8gYW4gYXJndW1lbnQgb2YgdHlwZSAiJyt0KyciLCB3aGljaCBpcyBvdXRzaWRlIHRoZSB2YWxpZCByYW5nZSBbJytuKyIsICIrbysiXSEiKTtyZXR1cm4gdT9yPj4+MDowfHJ9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6TnQodCxpLDAhPT1uKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9tZW1vcnlfdmlldzpmdW5jdGlvbihlLHQscil7dmFyIG49W0ludDhBcnJheSxVaW50OEFycmF5LEludDE2QXJyYXksVWludDE2QXJyYXksSW50MzJBcnJheSxVaW50MzJBcnJheSxGbG9hdDMyQXJyYXksRmxvYXQ2NEFycmF5XVt0XTtmdW5jdGlvbiBvKGUpe3ZhciB0PU0scj10W2U+Pj0yXSxvPXRbZSsxXTtyZXR1cm4gbmV3IG4odC5idWZmZXIsbyxyKX1ZZShlLHtuYW1lOnI9emUociksZnJvbVdpcmVUeXBlOm8sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpvfSx7aWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9uczohMH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nOmZ1bmN0aW9uKGUsdCl7WWUoZSx7bmFtZTp0PXplKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9TVtlPj4yXSxyPW5ldyBBcnJheSh0KSxuPTA7bjx0OysrbilyW25dPVN0cmluZy5mcm9tQ2hhckNvZGUoT1tlKzQrbl0pO3JldHVybiBLdChlKSxyLmpvaW4oIiIpfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gcihlLHQpe3JldHVybiBlW3RdfXZhciBuO3QgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHQ9bmV3IFVpbnQ4QXJyYXkodCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5fHx0IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXk/bj1yOiJzdHJpbmciPT10eXBlb2YgdD9uPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuY2hhckNvZGVBdCh0KX06V2UoIkNhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gc3RkOjpzdHJpbmciKTt2YXIgbz10Lmxlbmd0aCxpPUp0KDQrbyk7TVtpPj4yXT1vO2Zvcih2YXIgYT0wO2E8bzsrK2Epe3ZhciBzPW4odCxhKTtzPjI1NSYmKEt0KGkpLFdlKCJTdHJpbmcgaGFzIFVURi0xNiBjb2RlIHVuaXRzIHRoYXQgZG8gbm90IGZpdCBpbiA4IGJpdHMiKSksT1tpKzQrYV09c31yZXR1cm4gbnVsbCE9PWUmJmUucHVzaChLdCxpKSxpfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOlJlLGRlc3RydWN0b3JGdW5jdGlvbjpmdW5jdGlvbihlKXtLdChlKX19KX0sX19lbWJpbmRfcmVnaXN0ZXJfc3RkX3dzdHJpbmc6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuLG87cj16ZShyKSwyPT09dD8obj1mdW5jdGlvbigpe3JldHVybiBOfSxvPTEpOjQ9PT10JiYobj1mdW5jdGlvbigpe3JldHVybiBNfSxvPTIpLFllKGUse25hbWU6cixmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW4oKSxyPU1bZT4+Ml0saT1uZXcgQXJyYXkociksYT1lKzQ+Pm8scz0wO3M8cjsrK3MpaVtzXT1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbYStzXSk7cmV0dXJuIEt0KGUpLGkuam9pbigiIil9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSxyKXt2YXIgaT1uKCksYT1yLmxlbmd0aCxzPUp0KDQrYSp0KTtNW3M+PjJdPWE7Zm9yKHZhciB1PXMrND4+byxjPTA7YzxhOysrYylpW3UrY109ci5jaGFyQ29kZUF0KGMpO3JldHVybiBudWxsIT09ZSYmZS5wdXNoKEt0LHMpLHN9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6UmUsZGVzdHJ1Y3RvckZ1bmN0aW9uOmZ1bmN0aW9uKGUpe0t0KGUpfX0pfSxfX2VtYmluZF9yZWdpc3Rlcl92YWx1ZV9vYmplY3Q6ZnVuY3Rpb24oZSx0LHIsbixvLGkpe1BlW2VdPXtuYW1lOnplKHQpLHJhd0NvbnN0cnVjdG9yOnZ0KHIsbikscmF3RGVzdHJ1Y3Rvcjp2dChvLGkpLGZpZWxkczpbXX19LF9fZW1iaW5kX3JlZ2lzdGVyX3ZhbHVlX29iamVjdF9maWVsZDpmdW5jdGlvbihlLHQscixuLG8saSxhLHMsdSxjKXtQZVtlXS5maWVsZHMucHVzaCh7ZmllbGROYW1lOnplKHQpLGdldHRlclJldHVyblR5cGU6cixnZXR0ZXI6dnQobixvKSxnZXR0ZXJDb250ZXh0Omksc2V0dGVyQXJndW1lbnRUeXBlOmEsc2V0dGVyOnZ0KHMsdSksc2V0dGVyQ29udGV4dDpjfSl9LF9fZW1iaW5kX3JlZ2lzdGVyX3ZvaWQ6ZnVuY3Rpb24oZSx0KXtZZShlLHtpc1ZvaWQ6ITAsbmFtZTp0PXplKHQpLGFyZ1BhY2tBZHZhbmNlOjAsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKCl7fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7fX0pfSxfYWJvcnQ6ZnVuY3Rpb24oKXtvLmFib3J0KCl9LF9lbXNjcmlwdGVuX21lbWNweV9iaWc6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBPLnNldChPLnN1YmFycmF5KHQsdCtyKSxlKSxlfSxfZ2V0ZW52OmZ1bmN0aW9uIGUodCl7cmV0dXJuIDA9PT10PzA6KHQ9dih0KSxNdC5oYXNPd25Qcm9wZXJ0eSh0KT8oZS5yZXQmJkt0KGUucmV0KSxlLnJldD0ocj1NdFt0XSxuPVMocikrMSwobz1KdChuKSkmJkEocixSLG8sbiksbykpOjApO3ZhciByLG4sb30sX2dldGdybmFtOmZ1bmN0aW9uKCl7by5wcmludEVycigibWlzc2luZyBmdW5jdGlvbjogZ2V0Z3JuYW0iKSxycigtMSl9LF9nZXRwd25hbTpmdW5jdGlvbigpe3Rocm93ImdldHB3bmFtOiBUT0RPIn0sX2pzQ2xvc2U6ZnVuY3Rpb24oKXtyZXR1cm4gYS5jbG9zZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9qc0NyZWF0ZTpmdW5jdGlvbihlKXtyZXR1cm4gYS5jcmVhdGUuY2FsbChudWxsLGsoZSkpfSxfanNPcGVuOmZ1bmN0aW9uKGUpe3JldHVybiBhLm9wZW4uY2FsbChudWxsLGsoZSkpfSxfanNSZWFkOmZ1bmN0aW9uKCl7cmV0dXJuIGEucmVhZC5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9qc1NlZWs6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBhLnNlZWsuY2FsbChudWxsLGUsdCxiKHIpKX0sX2pzVGVsbDpmdW5jdGlvbigpe3JldHVybiBhLnRlbGwuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxfanNXcml0ZTpmdW5jdGlvbigpe3JldHVybiBhLndyaXRlLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sX2xsdm1fZWhfdHlwZWlkX2ZvcjpmdW5jdGlvbihlKXtyZXR1cm4gZX0sX2xvY2FsdGltZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSx0KXtqdCgpO3ZhciByPW5ldyBEYXRlKDFlMypGW2U+PjJdKTtGW3Q+PjJdPXIuZ2V0U2Vjb25kcygpLEZbdCs0Pj4yXT1yLmdldE1pbnV0ZXMoKSxGW3QrOD4+Ml09ci5nZXRIb3VycygpLEZbdCsxMj4+Ml09ci5nZXREYXRlKCksRlt0KzE2Pj4yXT1yLmdldE1vbnRoKCksRlt0KzIwPj4yXT1yLmdldEZ1bGxZZWFyKCktMTkwMCxGW3QrMjQ+PjJdPXIuZ2V0RGF5KCk7dmFyIG49bmV3IERhdGUoci5nZXRGdWxsWWVhcigpLDAsMSksbz0oci5nZXRUaW1lKCktbi5nZXRUaW1lKCkpLzg2NGU1fDA7Rlt0KzI4Pj4yXT1vLEZbdCszNj4+Ml09LTYwKnIuZ2V0VGltZXpvbmVPZmZzZXQoKTt2YXIgaT1uZXcgRGF0ZSgyZTMsNiwxKS5nZXRUaW1lem9uZU9mZnNldCgpLGE9bi5nZXRUaW1lem9uZU9mZnNldCgpLHM9MHwoaSE9YSYmci5nZXRUaW1lem9uZU9mZnNldCgpPT1NYXRoLm1pbihhLGkpKTtGW3QrMzI+PjJdPXM7dmFyIHU9RltCdCsocz80OjApPj4yXTtyZXR1cm4gRlt0KzQwPj4yXT11LHR9KGUsSXQpfSxfbWt0aW1lOmZ1bmN0aW9uKGUpe2p0KCk7dmFyIHQ9bmV3IERhdGUoRltlKzIwPj4yXSsxOTAwLEZbZSsxNj4+Ml0sRltlKzEyPj4yXSxGW2UrOD4+Ml0sRltlKzQ+PjJdLEZbZT4+Ml0sMCkscj1GW2UrMzI+PjJdLG49dC5nZXRUaW1lem9uZU9mZnNldCgpLG89bmV3IERhdGUodC5nZXRGdWxsWWVhcigpLDAsMSksaT1uZXcgRGF0ZSgyZTMsNiwxKS5nZXRUaW1lem9uZU9mZnNldCgpLGE9by5nZXRUaW1lem9uZU9mZnNldCgpLHM9TWF0aC5taW4oYSxpKTtpZihyPDApRltlKzMyPj4yXT1OdW1iZXIoaSE9YSYmcz09bik7ZWxzZSBpZihyPjAhPShzPT1uKSl7dmFyIHU9TWF0aC5tYXgoYSxpKSxjPXI+MD9zOnU7dC5zZXRUaW1lKHQuZ2V0VGltZSgpKzZlNCooYy1uKSl9RltlKzI0Pj4yXT10LmdldERheSgpO3ZhciBsPSh0LmdldFRpbWUoKS1vLmdldFRpbWUoKSkvODY0ZTV8MDtyZXR1cm4gRltlKzI4Pj4yXT1sLHQuZ2V0VGltZSgpLzFlM3wwfSxfcHRocmVhZF9nZXRzcGVjaWZpYzpmdW5jdGlvbihlKXtyZXR1cm4gVXRbZV18fDB9LF9wdGhyZWFkX2tleV9jcmVhdGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gMD09ZT9tZS5FSU5WQUw6KEZbZT4+Ml09enQsVXRbenRdPTAsenQrKywwKX0sX3B0aHJlYWRfb25jZTpmdW5jdGlvbiBlKHQscil7ZS5zZWVufHwoZS5zZWVuPXt9KSx0IGluIGUuc2Vlbnx8KG8uZHluQ2FsbF92KHIpLGUuc2Vlblt0XT0xKX0sX3B0aHJlYWRfc2V0c3BlY2lmaWM6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZSBpbiBVdD8oVXRbZV09dCwwKTptZS5FSU5WQUx9LF90aW1lOmZ1bmN0aW9uKGUpe3ZhciB0PURhdGUubm93KCkvMWUzfDA7cmV0dXJuIGUmJihGW2U+PjJdPXQpLHR9LERZTkFNSUNUT1BfUFRSOiQsU1RBQ0tUT1A6VX07dmFyIFd0PW8uYXNtKG8uYXNtR2xvYmFsQXJnLG8uYXNtTGlicmFyeUFyZyxEKTtvLmFzbT1XdDt2YXIgWXQ9by5fX0dMT0JBTF9fc3ViX0lfYmluZF9jcHA9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uX19HTE9CQUxfX3N1Yl9JX2JpbmRfY3BwLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sVnQ9by5fX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcC5hcHBseShudWxsLGFyZ3VtZW50cyl9LEh0PW8uX19HTE9CQUxfX3N1Yl9JX2NyY19jcHA9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uX19HTE9CQUxfX3N1Yl9JX2NyY19jcHAuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxHdD1vLl9fR0xPQkFMX19zdWJfSV9nbG9iYWxfY3BwPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fR0xPQkFMX19zdWJfSV9nbG9iYWxfY3BwLmFwcGx5KG51bGwsYXJndW1lbnRzKX0scXQ9KG8uX19fY3hhX2Nhbl9jYXRjaD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX19jeGFfY2FuX2NhdGNoLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5fX19jeGFfaXNfcG9pbnRlcl90eXBlPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fX2N4YV9pc19wb2ludGVyX3R5cGUuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLl9fX2Vycm5vX2xvY2F0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fX2Vycm5vX2xvY2F0aW9uLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5fX19nZXRUeXBlTmFtZT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX19nZXRUeXBlTmFtZS5hcHBseShudWxsLGFyZ3VtZW50cyl9KSxYdD1vLl9lbXNjcmlwdGVuX3JlcGxhY2VfbWVtb3J5PWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9lbXNjcmlwdGVuX3JlcGxhY2VfbWVtb3J5LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sS3Q9by5fZnJlZT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fZnJlZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LEp0PW8uX21hbGxvYz1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fbWFsbG9jLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sWnQ9by5zZXRUZW1wUmV0MD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5zZXRUZW1wUmV0MC5hcHBseShudWxsLGFyZ3VtZW50cyl9LFF0PShvLnNldFRocmV3PWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLnNldFRocmV3LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5zdGFja0FsbG9jPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLnN0YWNrQWxsb2MuYXBwbHkobnVsbCxhcmd1bWVudHMpfSk7by5keW5DYWxsX2RpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2RpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9pPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2lpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaWlpLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2lpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlpaWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlqaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF9paWlpaWlqaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfaWpqPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWpqLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2ppPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfamkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdj1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3YuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpZD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWQuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWlpaWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaWlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWo9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWouYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlqaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpamkuYXBwbHkobnVsbCxhcmd1bWVudHMpfTtmdW5jdGlvbiBlcihlKXt0aGlzLm5hbWU9IkV4aXRTdGF0dXMiLHRoaXMubWVzc2FnZT0iUHJvZ3JhbSB0ZXJtaW5hdGVkIHdpdGggZXhpdCgiK2UrIikiLHRoaXMuc3RhdHVzPWV9ZnVuY3Rpb24gdHIoZSl7ZnVuY3Rpb24gdCgpe28uY2FsbGVkUnVufHwoby5jYWxsZWRSdW49ITAsbXx8KHRlfHwodGU9ITAsWChKKSksWChaKSxvLm9uUnVudGltZUluaXRpYWxpemVkJiZvLm9uUnVudGltZUluaXRpYWxpemVkKCksZnVuY3Rpb24oKXtpZihvLnBvc3RSdW4pZm9yKCJmdW5jdGlvbiI9PXR5cGVvZiBvLnBvc3RSdW4mJihvLnBvc3RSdW49W28ucG9zdFJ1bl0pO28ucG9zdFJ1bi5sZW5ndGg7KWU9by5wb3N0UnVuLnNoaWZ0KCksZWUudW5zaGlmdChlKTt2YXIgZTtYKGVlKX0oKSkpfXNlPjB8fCghZnVuY3Rpb24oKXtpZihvLnByZVJ1bilmb3IoImZ1bmN0aW9uIj09dHlwZW9mIG8ucHJlUnVuJiYoby5wcmVSdW49W28ucHJlUnVuXSk7by5wcmVSdW4ubGVuZ3RoOyllPW8ucHJlUnVuLnNoaWZ0KCksSy51bnNoaWZ0KGUpO3ZhciBlO1goSyl9KCksc2U+MHx8by5jYWxsZWRSdW58fChvLnNldFN0YXR1cz8oby5zZXRTdGF0dXMoIlJ1bm5pbmcuLi4iKSxzZXRUaW1lb3V0KChmdW5jdGlvbigpe3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7by5zZXRTdGF0dXMoIiIpfSksMSksdCgpfSksMSkpOnQoKSkpfWZ1bmN0aW9uIHJyKGUpe3Rocm93IG8ub25BYm9ydCYmby5vbkFib3J0KGUpLHZvaWQgMCE9PWU/KG8ucHJpbnQoZSksby5wcmludEVycihlKSxlPUpTT04uc3RyaW5naWZ5KGUpKTplPSIiLG09ITAsImFib3J0KCIrZSsiKS4gQnVpbGQgd2l0aCAtcyBBU1NFUlRJT05TPTEgZm9yIG1vcmUgaW5mby4ifWlmKG8uYXNtPVd0LGVyLnByb3RvdHlwZT1uZXcgRXJyb3IsZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yPWVyLHVlPWZ1bmN0aW9uIGUoKXtvLmNhbGxlZFJ1bnx8dHIoKSxvLmNhbGxlZFJ1bnx8KHVlPWUpfSxvLnJ1bj10cixvLmV4aXQ9ZnVuY3Rpb24oZSx0KXt0JiZvLm5vRXhpdFJ1bnRpbWUmJjA9PT1lfHwoby5ub0V4aXRSdW50aW1lfHwobT0hMCxVPXZvaWQgMCxYKFEpLG8ub25FeGl0JiZvLm9uRXhpdChlKSksbCYmcHJvY2Vzcy5leGl0KGUpLG8ucXVpdChlLG5ldyBlcihlKSkpfSxvLmFib3J0PXJyLG8ucHJlSW5pdClmb3IoImZ1bmN0aW9uIj09dHlwZW9mIG8ucHJlSW5pdCYmKG8ucHJlSW5pdD1bby5wcmVJbml0XSk7by5wcmVJbml0Lmxlbmd0aD4wOylvLnByZUluaXQucG9wKCkoKTtyZXR1cm4gby5ub0V4aXRSdW50aW1lPSEwLHRyKCksdH07ZnVuY3Rpb24gaSh7cmVzb3VyY2VJZDplLHVybDp0fSl7cmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbihlLG8pe2lmKCFyKXRocm93IG5ldyBFcnJvcigidW5wYWNrQnJpZGdlIG5vdCBkZXRlY3RlZCIpO2lmKCFuKXRocm93IG5ldyBFcnJvcigidW5wYWNrIG5vdCBkZXRlY3RlZCIpOyhmdW5jdGlvbihlKXtyZXR1cm4gZmV0Y2gobmV3IFJlcXVlc3QoZSkpLnRoZW4oZT0+e2lmKGUub2spcmV0dXJuIGUuYXJyYXlCdWZmZXIoKTt0aHJvdyBuZXcgRXJyb3IoIjQwNCBFcnJvcjogRmlsZSBub3QgZm91bmQuIil9KS50aGVuKGU9PnIuY3JlYXRlRXh0cmFjdG9yRnJvbURhdGEoZSkpfSkodCkudGhlbih0PT57ZSh0LmV4dHJhY3RBbGwoKSl9LGU9PntvKGUpfSl9KSl9ZnVuY3Rpb24gYShlLHQpe2NvbnN0W3Isbl09dDtpZigiRkFJTCI9PXIuc3RhdGUpe2NvbnN0IHQ9e3R5cGU6IkVSUk9SIixyZWFzb246ci5yZWFzb24sbXNnOnIubXNnLHJlc291cmNlSWQ6ZS5kYXRhLnJlc291cmNlSWQsdXJsOmUuZGF0YS51cmx9O3JldHVybiB2b2lkIHNlbGYucG9zdE1lc3NhZ2UodCl9Y29uc3Qgbz17dHlwZToiRklOSVNIRUQiLHJlc291cmNlSWQ6ZS5kYXRhLnJlc291cmNlSWQsZW50cmllczp7fX0saT1bXTtpZihuJiZuLmZpbGVzKWZvcihjb25zdCBlIG9mIG4uZmlsZXMpby5lbnRyaWVzW2UuZmlsZUhlYWRlci5uYW1lXT1lLmV4dHJhY3RbMV0saS5wdXNoKGUuZXh0cmFjdFsxXS5idWZmZXIpO3NlbGYucG9zdE1lc3NhZ2UobyxpKX1vbm1lc3NhZ2U9ZnVuY3Rpb24oZSl7aWYoImluaXQiPT1lLmRhdGEudHlwZSluPW8oZS5kYXRhLndhc21VcmwpLG4ub25SdW50aW1lSW5pdGlhbGl6ZWQ9KCk9PnBvc3RNZXNzYWdlKHt0eXBlOiJXQVNNX0xPQURFRCJ9KTtlbHNlIGlmKCJmZXRjaCI9PWUuZGF0YS50eXBlKWkoZS5kYXRhKS50aGVuKHQ9PnthKGUsdCl9LHQ9Pntjb25zdCByPXt0eXBlOiJFUlJPUiIscmVzb3VyY2VJZDplLmRhdGEucmVzb3VyY2VJZCx1cmw6ZS5kYXRhLnVybH07c2VsZi5wb3N0TWVzc2FnZShyKX0pO2Vsc2UgaWYoInVucGFjayI9PWUuZGF0YS50eXBlKXtjb25zdHtidWZmZXI6dH09ZS5kYXRhO2lmKCFyKXRocm93IG5ldyBFcnJvcigidW5wYWNrQnJpZGdlIG5vdCBkZXRlY3RlZCIpO2lmKCFuKXRocm93IG5ldyBFcnJvcigidW5wYWNrIG5vdCBkZXRlY3RlZCIpO2NvbnN0IG89ci5jcmVhdGVFeHRyYWN0b3JGcm9tRGF0YSh0KS5leHRyYWN0QWxsKCk7YShlLG8pfX07Cgo=",null,!1);function dt(t){return t&&"object"==typeof t&&!Array.isArray(t)}function ct(t){var e,a;var i=[];for(var n=1;n<arguments.length;n++){i[n-1]=arguments[n]}if(!i.length)return t;var r=i.shift();if(dt(t)&&dt(r))for(var o in r)dt(r[o])?(t[o]||Object.assign(t,(e={},e[o]={},e)),ct(t[o],r[o])):Object.assign(t,(a={},a[o]=r[o],a));return ct.apply(void 0,__spreadArrays([t],i))}var ut=new(function(t){__extends(e,t);function e(){var e=this;var a;e=t.call(this)||this,e.__totalWork=0,e.__totalWorkByCategory={},e.__doneWork=0,e.__doneWorkByCategory={},e.__resourceRegisterCallbacks={},e.__callbacks={},e.__resources={},e.__resourcesTreeEntities={},e.__resourcesTree={children:{}},e.__workers=[],e.__nextWorker=0;var i=document.getElementsByTagName("script");for(var n=0;n<i.length;n++){var r=i[n];if(r.src.includes("zea-engine")){var o=r.src.split("/");o.pop(),o.pop(),a=o.join("/");break}}a||(a="https://unpkg.com/@zeainc/zea-engine@0.1.3"),e.wasmUrl=a+"/public-resources/unpack.wasm",e.addResourceURL("ZeaEngine/Vive.vla",a+"/public-resources/Vive.vla"),e.addResourceURL("ZeaEngine/Oculus.vla",a+"/public-resources/Oculus.vla");return e}e.prototype.getRootFolder=function(){return this.__resourcesTree};e.prototype.registerResourceCallback=function(t,e){this.__resourceRegisterCallbacks[t]=e;for(var a in this.__resources){var i=this.__resources[a];i.name.includes(t)&&e(i)}};e.prototype.__applyCallbacks=function(t){var e=this;var a=function(t){for(var a in e.__resourceRegisterCallbacks)t.name.includes(a)&&e.__resourceRegisterCallbacks[a](t)};for(var i in t){var n=t[i];n.url&&a(n)}};e.prototype.__buildTree=function(t){var e=this;var a=function(i){if(e.__resourcesTreeEntities[i])return;var n=t[i];n.id=i,"folder"!==n.type&&"dependency"!==n.type||(n.children={}),n.parent&&(e.__resourcesTreeEntities[n.parent]||a(n.parent));(n.parent?e.__resourcesTreeEntities[n.parent]:e.__resourcesTree).children[n.name]=n,e.__resourcesTreeEntities[i]=n};for(var i in t)a(i)};e.prototype.setResources=function(t){this.__resources=Object.assign(this.__resources,t),this.__buildTree(t),this.__applyCallbacks(t)};e.prototype.addResourceURL=function(t,e){var a=t.split("/"),i=a.pop();if(!e){var n=window.location.href.split("#")[0];n=n.split("?")[0],(n.endsWith(".html")||n.endsWith(".html"))&&(n=n.substring(0,n.lastIndexOf("/"))+"/");var r=n;if("."==a[0])a.shift();else if(".."==a[0]){item=item.substring(3);var o=r.split("/");o.pop(),o.pop(),r=o.join("/")+"/"}e=r+t}var s;var d={};for(var c=0,u=a;c<u.length;c++){var h=u[c];var m=l(h);m in this.__resources||(this.__resources[m]={name:h,type:"folder",parent:s},d[m]=this.__resources[m]),s=m}var p=l(i),f={name:i,url:e,parent:s,id:p};this.__resources[p]=f,d[p]=f,this.__buildTree(d),this.__applyCallbacks(d)};e.prototype.updateFile=function(t){var e=!(t.id in this.__resources);if(this.__resources[t.id]=t,e){console.log("New file added");var a={};a[t.id]=t,this.__buildTree(a)}this.emit("fileUpdated",{fileId:t.id})};e.prototype.freeData=function(t){};e.prototype.__getWorker=function(){var t=this;return this.__nextWorker=(this.__nextWorker+1)%3,null==this.__workers[this.__nextWorker]&&(this.__workers[this.__nextWorker]=function(){return new Promise((function(e){var a=new st;a.postMessage({type:"init",wasmUrl:t.wasmUrl}),a.onmessage=function(i){if("WASM_LOADED"===i.data.type)e(a);else if("FINISHED"===i.data.type){t.addWorkDone(i.data.resourceId,1),t.__onFinishedReceiveFileData(i.data)}else if("ERROR"===i.data.type){var n=i.data,r=t.__resources[n.resourceId];console.error("Unable to load Resource:",r?r.name:n.resourceId," With url:",n.url)}}}))}()),this.__workers[this.__nextWorker]};e.prototype.__terminateWorkers=function(){for(var t=0,e=this.__workers;t<e.length;t++){var a=e[t];a.terminate()}this.__workers=[]};e.prototype.getFilepath=function(t){var e=this.__resources[t];var a=[e.name];for(;e.parent;)e=this.__resources[e.parent],a.splice(0,0,e.name);return a.join("/")};e.prototype.resourceAvailable=function(t){return t.indexOf(".")>0?(console.warn("Deprecation warning for resourceAvailable. Value should be a file id, not a path."),null!=this.resolveFilepath(t)):t in this.__resources};e.prototype.getFile=function(t){return this.__resources[t]};e.prototype.resolveFilePathToId=function(t){if(!t)return void console.warn("Invalid file path:",t);var e=this.resolveFilepath(t);return e?e.id:void 0};e.prototype.resolveFilepath=function(t){var e=t.split("/");"."!=e[0]&&""!=e[0]||e.shift();var a=this.__resourcesTree;for(var i=0,n=e;i<n.length;i++){var r=n[i];if(!(r in a.children))return console.warn("Unable to resolve key:"+r+" of path:"+t),null;a=a.children[r]}return a};e.prototype.resolveFile=function(t){return console.warn("Deprecation warning for resolveFile. Use resolveFilepath."),this.resolveFilepath(t)};e.prototype.resolveURL=function(t){console.warn("Deprecation warning for resolveURL. Use resolveFilepath.");var e=this.resolveFilepath(t);if(e)return e.url};e.prototype.addWork=function(t,e){this.__totalWork+=e;var a=this.__doneWork/this.__totalWork*100;this.emit("progressIncremented",{percent:a})};e.prototype.addWorkDone=function(t,e){this.__doneWork+=e;var a=this.__doneWork/this.__totalWork*100;if(this.emit("progressIncremented",{percent:a}),this.__doneWork>this.__totalWork)throw new Error("Mismatch between work loaded and work done.");this.__doneWork==this.__totalWork&&this.emit("allResourcesLoaded",{})};e.prototype.loadResource=function(t,e,a){if(a===void 0){a=!0}var i=this.getFile(t);if(!i)throw new Error("Invalid resource Id:'"+t+"' not found in Resources:"+JSON.stringify(this.__resources,null,2));this.loadUrl(t,i.url,e,a)};e.prototype.loadURL=function(t,e,a,i){if(i===void 0){i=!0}return console.warn("Please call loadUrl instead,"),this.loadUrl(t,e,a,i)};e.prototype.loadUrl=function(t,e,a,i){var n=this;if(i===void 0){i=!0}i&&this.addWork(t,3),t in this.__callbacks||(this.__callbacks[t]=[]),this.__callbacks[t].push(a),fetch(e).then((function(t){return function(t){if(!t.ok)throw new Error("HTTP "+t.status+" - "+t.statusText);return t}(t)&&t.arrayBuffer()})).then((function(e){n.__getWorker().then((function(a){a.postMessage({type:"unpack",resourceId:t,buffer:e})}))}))};e.prototype.unpackBuffer=function(t,e,a,i){var n=this;if(i===void 0){i=!0}return new Promise((function(r,o){i&&n.addWork(t,3),t in n.__callbacks||(n.__callbacks[t]=[]),a&&n.__callbacks[t].push(a),n.__callbacks[t].push((function(t){r(t)})),n.__getWorker().then((function(a){a.postMessage({type:"unpack",resourceId:t,buffer:e},[e])}))}))};e.prototype.__onFinishedReceiveFileData=function(t){var e=t.resourceId;this.addWorkDone(e,1);var a=this.__callbacks[e];if(a){for(var i=0,n=a;i<n.length;i++){var r=n[i];r(t.entries)}delete this.__callbacks[e]}this.emit("loaded",{resourceId:e}),this.addWorkDone(e,1)};e.prototype.suspend=function(){this.__terminateWorkers()};e.prototype.traverse=function(t){var e=function(t){for(var e in t.children)a(t.children[e])},a=function(a){if(0==t(a))return!1;a.children&&e(a)};e(this.__resourcesTree)};return e}(L));var ht=function(){function t(t){if(t){var e=t.split("-"),a=e[0].split(".");this.major=parseInt(a[0]),this.minor=parseInt(a[1]),this.patch=parseInt(a[2]),2==e.length&&(this.branch=e[1])}else this.major=0,this.minor=0,this.patch=0}t.prototype.compare=function(t){var e=[this.major,this.minor,this.patch];for(var a=0;a<3;a++)if(e[a]!==t[a])return e[a]-t[a];return 0};t.prototype.equals=function(t){return!(this.patch==t[2]&&this.minor==t[1]&&this.major==t[0])};t.prototype.lessThan=function(t){return!(this.major>=t[0]||this.minor>=t[1]||this.patch>=t[2])};t.prototype.greaterThan=function(t){return this.major>t[0]||this.minor>t[1]||this.patch>t[2]};t.prototype.greaterOrEqualThan=function(t){return!(this.major<t[0])&&(this.major>t[0]||!(this.minor<t[1])&&(this.minor>t[1]||!(this.patch<t[2])))};return t}();var mt=function(){function t(t,e,a){if(e===void 0){e=0}if(a===void 0){a=!0}this.__data=t,this.__byteOffset=e,this.__dataView=new DataView(this.__data),this.__isMobileDevice=a,this.utf8decoder=new TextDecoder}Object.defineProperty(t.prototype,"isMobileDevice",{get:function(){return this.__isMobileDevice},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"data",{get:function(){return this.__data},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"byteLength",{get:function(){return this.__dataView.byteLength},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"remainingByteLength",{get:function(){return this.__dataView.byteLength-this.__byteOffset},enumerable:true,configurable:true});t.prototype.pos=function(){return this.__byteOffset};t.prototype.seek=function(t){this.__byteOffset=t};t.prototype.advance=function(t){this.__byteOffset+=t};t.prototype.loadUInt8=function(){var t=this.__dataView.getUint8(this.__byteOffset);return this.__byteOffset+=1,t};t.prototype.loadUInt16=function(){var t=this.__dataView.getUint16(this.__byteOffset,!0);return this.__byteOffset+=2,t};t.prototype.loadUInt32=function(){var t=this.__dataView.getUint32(this.__byteOffset,!0);return this.__byteOffset+=4,t};t.prototype.loadSInt32=function(){var t=this.__dataView.getInt32(this.__byteOffset,!0);return this.__byteOffset+=4,t};t.prototype.loadFloat16=function(){var t=this.loadUInt16();return Math.decode16BitFloat(t)};t.prototype.loadUFloat16=function(){var t=this.loadFloat16();return t<0?2048-t:t};t.prototype.loadFloat16From2xUInt8=function(){var t=this.__dataView.getFloat16(this.__byteOffset,!0);return this.__byteOffset+=2,t};t.prototype.loadUInt32From2xUFloat16=function(){return this.loadUFloat16()+4096*this.loadUFloat16()};t.prototype.loadSInt32From2xFloat16=function(){return this.loadFloat16()+2048*this.loadFloat16()};t.prototype.loadFloat32=function(){var t=this.__dataView.getFloat32(this.__byteOffset,!0);return this.__byteOffset+=4,t};t.prototype.loadUInt8Array=function(t,e){if(e===void 0){e=!1}null==t&&(t=this.loadUInt32());var a=new Uint8Array(this.__data,this.__byteOffset,t);this.__byteOffset+=t;return a};t.prototype.loadUInt16Array=function(t,e){if(e===void 0){e=!1}if(null==t&&(t=this.loadUInt32()),0==t)return new Uint16Array;var a;if(this.readPadd(2),this.__isMobileDevice){a=new Uint16Array(t);for(var i=0;i<t;i++)a[i]=this.__dataView.getUint16(this.__byteOffset,!0),this.__byteOffset+=2}else a=new Uint16Array(this.__data,this.__byteOffset,t),this.__byteOffset+=2*t;return a};t.prototype.loadUInt32Array=function(t,e){if(e===void 0){e=!1}if(null==t&&(t=this.loadUInt32()),0==t)return new Uint32Array;var a;if(this.readPadd(4),this.__isMobileDevice){a=new Uint32Array(t);for(var i=0;i<t;i++)a[i]=this.__dataView.getUint32(this.__byteOffset,!0),this.__byteOffset+=4}else a=new Uint32Array(this.__data,this.__byteOffset,t),this.__byteOffset+=4*t;return a};t.prototype.loadFloat32Array=function(t,e){if(e===void 0){e=!1}if(null==t&&(t=this.loadUInt32()),0==t)return new Float32Array;var a;if(this.readPadd(4),this.__isMobileDevice){a=new Float32Array(t);for(var i=0;i<t;i++)a[i]=this.__dataView.getFloat32(this.__byteOffset,!0),this.__byteOffset+=4}else a=new Float32Array(this.__data,this.__byteOffset,t),this.__byteOffset+=4*t;return a};t.prototype.loadStr=function(){var t=this.loadUInt32(),e=new Uint8Array(this.__data,this.__byteOffset,t);return this.__byteOffset+=t,this.utf8decoder.decode(e)};t.prototype.loadStrArray=function(){var t=this.loadUInt32(),e=[];for(var a=0;a<t;a++)e[a]=this.loadStr();return e};t.prototype.loadSInt32Vec2=function(){var t=this.loadSInt32(),e=this.loadSInt32();return new h(t,e)};t.prototype.loadUInt32Vec2=function(){var t=this.loadUInt32(),e=this.loadUInt32();return new h(t,e)};t.prototype.loadFloat16Vec2=function(){var t=this.loadFloat16(),e=this.loadFloat16();return new h(t,e)};t.prototype.loadFloat32Vec2=function(){var t=this.loadFloat32(),e=this.loadFloat32();return new h(t,e)};t.prototype.loadFloat16Vec3=function(){var t=this.loadFloat16(),e=this.loadFloat16(),a=this.loadFloat16();return new m(t,e,a)};t.prototype.loadFloat32Vec3=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32();return new m(t,e,a)};t.prototype.loadFloat16Quat=function(){var t=this.loadFloat16(),e=this.loadFloat16(),a=this.loadFloat16(),i=this.loadFloat16();return new G(t,e,a,i)};t.prototype.loadFloat32Quat=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32(),i=this.loadFloat32();return new G(t,e,a,i)};t.prototype.loadRGBFloat32Color=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32();return new y(t,e,a)};t.prototype.loadRGBAFloat32Color=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32(),i=this.loadFloat32();return new y(t,e,a,i)};t.prototype.loadRGBUInt8Color=function(){var t=this.loadUInt8(),e=this.loadUInt8(),a=this.loadUInt8();return new y(t/255,e/255,a/255)};t.prototype.loadRGBAUInt8Color=function(){var t=this.loadUInt8(),e=this.loadUInt8(),a=this.loadUInt8(),i=this.loadUInt8();return new y(t/255,e/255,a/255,i/255)};t.prototype.loadBox2=function(){return new V(this.loadFloat32Vec2(),this.loadFloat32Vec2())};t.prototype.loadBox3=function(){return new R(this.loadFloat32Vec3(),this.loadFloat32Vec3())};t.prototype.readPadd=function(t){var e=this.__byteOffset%t;0!=e&&(this.__byteOffset+=t-e)};return t}();var pt=function(){function t(t){if(t===void 0){t=0}this.__data=new ArrayBuffer(t),this.__byteOffset=0,this.__reserved=t,this.__dataView=new DataView(this.__data)}t.prototype.pos=function(){return this.__byteOffset};t.prototype.seek=function(t){this.__byteOffset=t};t.prototype.seekEnd=function(){this.__byteOffset=this.__reserved};t.prototype.getBuffer=function(){if(this.__data.byteLength==this.__byteOffset)return this.__data;return new Uint8Array(this.__data).slice(0,this.__byteOffset).buffer};t.prototype.__grow=function(){var t=2*(this.__reserved>0?this.__reserved:1),e=new ArrayBuffer(t),a=new Uint8Array(e),i=new Uint8Array(this.__data);a.set(i),this.__data=e,this.__dataView=new DataView(this.__data),this.__reserved=t};t.prototype.__reserve=function(t){this.__byteOffset+t>this.__reserved&&this.__grow()};t.prototype.__offset=function(t){this.__byteOffset+=t,this.__byteOffset>this.__reserved&&this.__grow()};t.prototype.writeUInt8=function(t){this.__reserve(1),this.__dataView.setUint8(this.__byteOffset,t),this.__offset(1)};t.prototype.writeUInt16=function(t){this.__reserve(2),this.__dataView.setUint16(this.__byteOffset,t,!0),this.__offset(2)};t.prototype.writeUInt32=function(t){this.__reserve(4),this.__dataView.setUint32(this.__byteOffset,t,!0),this.__offset(4)};t.prototype.writeSInt32=function(t){this.__reserve(4),this.__dataView.setInt32(this.__byteOffset,t,!0),this.__offset(4)};t.prototype.writeFloat16=function(t){var e=Math.encode16BitFloat(t);this.writeUInt16(e)};t.prototype.writeFloat32=function(t){this.__reserve(4),this.__dataView.setFloat32(this.__byteOffset,t,!0),this.__offset(4)};t.prototype.writeUInt8Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeUInt8(t[i])};t.prototype.writeUInt16Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(2*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeUInt16(t[i])};t.prototype.writeUInt32Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(4*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeUInt32(t[i])};t.prototype.writeFloat32Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(4*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeFloat32(t[i])};t.prototype.writeStr=function(t,e){if(e===void 0){e=!0}var a=value.length;this.__reserve(4*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeFloat32(value.charCodeAt(i))};t.prototype.writeSInt32Vec2=function(t){this.writeSInt32(t.x),this.writeSInt32(t.y)};t.prototype.writeUInt32Vec2=function(t){this.writeUInt32(t.x),this.writeUInt32(t.y)};t.prototype.writeFloat16Vec2=function(t){this.writeFloat16(t.x),this.writeFloat16(t.y)};t.prototype.writeFloat32Vec2=function(t){this.writeFloat32(t.x),this.writeFloat32(t.y)};t.prototype.writeFloat16Vec3=function(t){this.writeFloat16(t.x),this.writeFloat16(t.y),this.writeFloat16(t.z)};t.prototype.writeFloat32Vec3=function(t){this.writeFloat32(t.x),this.writeFloat32(t.y),this.writeFloat32(t.z)};t.prototype.writeFloat16Quat=function(t){this.writeFloat16(t.x),this.writeFloat16(t.y),this.writeFloat16(t.z),this.writeFloat16(t.w)};t.prototype.writeFloat32Quat=function(t){this.writeFloat32(t.x),this.writeFloat32(t.y),this.writeFloat32(t.z),this.writeFloat32(t.w)};t.prototype.writeRGBFloat32Color=function(t){this.writeFloat32(t.r),this.writeFloat32(t.g),this.writeFloat32(t.b)};t.prototype.writeRGBAFloat32Color=function(t){this.writeFloat32(t.r),this.writeFloat32(t.g),this.writeFloat32(t.b),this.writeFloat32(t.a)};t.prototype.writeRGBUInt8Color=function(t){this.writeUInt8(t.r),this.writeUInt8(t.g),this.writeUInt8(t.b)};t.prototype.writeRGBAUInt8Color=function(t){this.writeUInt8(t.r),this.writeUInt8(t.g),this.writeUInt8(t.b),this.writeUInt8(t.a)};t.prototype.writeBox2=function(t){this.writeFloat32Vec2(t.p0),this.writeFloat32Vec2(t.p1)};t.prototype.writeBox3=function(t){this.writeFloat32Vec3(t.p0),this.writeFloat32Vec3(t.p1)};t.prototype.writePadd=function(t){var e=t-this.__byteOffset;this.__reserve(e),this.__offset(e)};t.prototype.writeAlignment=function(t){var e=this.__byteOffset%t;0!=e&&(this.__reserve(t-e),this.__offset(t-e))};return t}();var ft=function(t){__extends(e,t);function e(e,a,i,n){if(a===void 0){a=0}var r=this;r=t.call(this,e,a,"Number")||this,i&&!Array.isArray(i)&&console.error("Range value must be an array of 2 numbers."),r.__range=i,r.__step=n;return r}e.prototype.setValue=function(e,a){a==z.USER_SETVALUE&&(this.__range&&(e=Math.clamp(e,this.__range[0],this.__range[1])),this.__step&&(e=Math.round(e/this.__step)*this.__step)),t.prototype.setValue.call(this,e,a)};e.prototype.getValue=function(e){return t.prototype.getValue.call(this,e)};e.prototype.getRange=function(){return this.__range};e.prototype.setRange=function(t){return this.__range=t,this};e.prototype.getStep=function(){return this.__step};e.prototype.setStep=function(t){return this.__step=t,this};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.__range&&(i.range=this.__range),this.__step&&(i.step=this.__step),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.range&&(this.__range=e.range),e.step&&(this.__step=e.step)};e.prototype.readBinary=function(t,e){var a=t.loadFloat32();this.setValue(a,z.DATA_LOAD)};e.prototype.clone=function(t){var a=new e(this.__name,this.__value);return a.__range=this.__range,a.__step=this.__step,a};return e}(k);t("Z",ft);K.registerClass("NumberParameter",ft),K.registerClass("Property_SInt32",ft),K.registerClass("Property_UInt32",ft),K.registerClass("Property_Float32",ft);var bt=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a,[0,i.length],1)||this,n.choices=i;return n}e.prototype.getChoices=function(){return this.choices};e.prototype.setValue=function(e,a){"string"==typeof e?t.prototype.setValue.call(this,this.choices.indexOf(e),a):t.prototype.setValue.call(this,e,a)};return e}(ft);var yt=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a,"Boolean")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(k);t("X",yt);K.registerClass("BooleanParameter",yt);var gt=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a||new h,"Vec2")||this,n.__range=i;return n}e.prototype.getRange=function(){return this.__range};e.prototype.__setRange=function(t){this.__range=t,this.emit("rangeChanged",{range:t})};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(k);t("b",gt);var _t=function(t){__extends(e,t);function e(e,a,i){return t.call(this,e,a||new m,"Vec3")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(k);t("f",_t);var Zt=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new p,"Vec4")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(k);t("V",Zt);var Gt=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new y,"Color")||this}e.prototype.readBinary=function(t,e){var a=t.loadRGBAFloat32Color();a.applyGamma(2.2),this.setValue(a,z.DATA_LOAD)};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(k);t("I",Gt);K.registerClass("ColorParameter",Gt);var Xt=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new _,"Mat3")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(k);var vt=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new Z,"Mat4")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(k);var Vt=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new v,"Xfo")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(k);t("d",Vt);var It=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a,"BaseImage")||this}e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.__value&&(i.imageType=K.getClassName(this.__value)),i};e.prototype.fromJSON=function(e,a,i){return e.imageType&&(this.__value=K.constructClass(e.imageType)),t.prototype.fromJSON.call(this,e,a,i)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(k);var Rt=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=""}var i=this;i=t.call(this,e,a,"String")||this,i.multiLine=!1;return i}e.prototype.setMultiLine=function(t){this.multiLine=t};e.prototype.getMultiLine=function(){return this.multiLine};e.prototype.readBinary=function(t,e){var a=t.loadStr();this.setValue(a,z.DATA_LOAD)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(k);t("W",Rt);K.registerClass("StringParameter",Rt),K.registerClass("Property_String",Rt);var xt=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=""}var i=this;i=t.call(this,e,a,"String")||this,i.lang="js";return i}e.prototype.setLanguage=function(t){this.lang=t};e.prototype.getLanguage=function(){return this.lang};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(Rt);t("a",xt);K.registerClass("CodeParameter",xt);var St=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,"","FilePath")||this,a&&i.setSupportedExts(a);return i}e.prototype.setSupportedExts=function(t){this.__reextensions=new RegExp("\\.("+t+")$","i")};e.prototype.getFilepath=function(){return this.__file?ut.getFilepath(this.__file.id):""};e.prototype.setFilepath=function(t,e){var a=ut.resolveFilePathToId(t);a?this.setValue(a,e):console.warn("Resource unavailable:"+t)};e.prototype.getFilename=function(){if(this.__file)return this.__file.name};e.prototype.getExt=function(){var t=this.getFilename(),e=t.lastIndexOf(".");if(-1!=e)return t.substring(e).toLowerCase()};e.prototype.getStem=function(){var t=this.getFilename();if(t){var e=t.split(".");return 2==e.length?e[0]:t}};e.prototype.getFileFolder=function(){if(this.__file)return this.__file.parent?ut.getFile(this.__file.parent):ut.getRootFolder()};e.prototype.getFileFolderPath=function(){var t=this.getFilepath();if(t)return t.substring(0,t.lastIndexOf("/"))+"/"};e.prototype.getFile=function(){return this.__file};e.prototype.getFileDesc=function(){return this.__file};e.prototype.setUrl=function(t,e,a){if(a===void 0){a=z.USER_SETVALUE}var i=t.split("/");e||(e=i[i.length-1]),this.__value=e,this.__file={id:t,name:e,url:t},a!=z.USER_SETVALUE&&a!=z.REMOTEUSER_SETVALUE||(this.__flags|=U.USER_EDITED),this.emit("valueChanged",{mode:a})};e.prototype.getUrl=function(){return this.__file?this.__file.url:void 0};e.prototype.setDirty=function(t){throw new Error("Cannot drive a filepath param from an oporator")};e.prototype.setValue=function(t,e){var a=this;if(e===void 0){e=z.USER_SETVALUE}if(null==t)throw new Error("Invalid value for setValue.");if(t.indexOf(".")>0)return console.warn("Deprecation warning for setValue. setValue should now only take a file id, not a path."),this.setFilepath(t,e);if(t==this.__value)return;var i=t;if(!ut.resourceAvailable(i))return void console.warn("Resource unavailable:"+i);var n=ut.getFile(i);if(this.__reextensions&&!this.__reextensions.test(n.name))return console.warn("Unsupported file type:"+n.name),!1;this.__value=t,this.__file=n,ut.addListener("fileUpdated",(function(t){t.fileId==a.__value&&(a.__file=ut.getFile(a.__value),a.emit("fileUpdated",t))})),e==z.USER_SETVALUE&&(this.__flags|=U.USER_EDITED),this.emit("valueChanged",{mode:e})};e.prototype.toJSON=function(t,e){if(0==(this.__flags&U.USER_EDITED))return;var a={};return this.__file&&(a.value=this.__file.id,a.filepath=ut.getFilepath(this.__file.id)),a};e.prototype.fromJSON=function(t,e,a){if(t.value){if(t.value.indexOf(".")>0)return void this.setFilepath(t.value,z.DATA_LOAD);if(ut.resourceAvailable(t.value))return this.setValue(t.value,z.DATA_LOAD),void(this.__flags|=U.USER_EDITED)}if(t.filepath){var i=ut.resolveFilePathToId(t.filepath);if(i)return void this.setValue(i,z.DATA_LOAD);console.warn("Resource unavailable:"+t.filepath)}};e.prototype.clone=function(t){var a=new e(this.__name);return a.__file=this.__file,a};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(k);var Wt=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,[])||this,i.__dataType=a;return i}e.prototype.__filter=function(t){return!0};e.prototype.getCount=function(){return this.__value.length};e.prototype.getElement=function(t){return this.__value[t]};e.prototype.setElement=function(t,e){this.__value[t]=e,this.emit("valueChanged",{mode:z.USER_SETVALUE})};e.prototype.addElement=function(t){if(null==t)t=new this.__dataType;else if(!this.__filter(t))return;return this.__value.push(t),this.__flags|=U.USER_EDITED,this.emit("elementAdded",{elem:t,index:this.__value.length-1}),this.emit("valueChanged",{mode:z.USER_SETVALUE}),t};e.prototype.removeElement=function(t){var e=this.__value[t];this.__value.splice(t,1),this.__flags|=U.USER_EDITED,this.emit("elementRemoved",{elem:e,index:t}),this.emit("valueChanged",{mode:z.USER_SETVALUE})};e.prototype.insertElement=function(t,e){this.__filter(e)&&(this.__value.splice(t,0,e),this.__flags|=U.USER_EDITED,this.emit("elementAdded",{elem:e,index:t}),this.emit("valueChanged",{mode:z.USER_SETVALUE}))};e.prototype.toJSON=function(t,e){if(0==(this.__flags&U.USER_EDITED))return;var a=[];for(var i=0,n=this.__value;i<n.length;i++){var r=n[i];"string"==typeof this.__dataType?a.push(r):a.push(r.toJSON(t,e))}return{items:a}};e.prototype.fromJSON=function(t,e,a){if(null!=t.items){this.__flags|=U.USER_EDITED,this.__value=[];for(var i=0;i<t.items.length;i++){var n=void 0;"string"==typeof this.__dataType?n=t.items[i]:(n=new this.__dataType,n.fromJSON(t.items[i],e)),this.__value.push(n),this.emit("elementAdded",{elem:n,index:this.__value.length-1})}this.emit("valueChanged",{mode:z.DATA_LOAD})}else console.warn("Invalid Parameter JSON")};e.prototype.clone=function(t){var a=this.__value.slice(0),i=new e(this.__name,this.__dataType);return i.setValue(a),i};e.prototype.destroy=function(){for(var t=0;t<this.__value.length;t++)this.__value[t]instanceof k&&this.__value[t].destroy(),this.removeElement(t)};return e}(k);var Lt=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e,{},"Struct")||this,a.__members=[];return a}e.prototype._addMember=function(t){var e=this;return this.__value[t.getName()]=t.getValue(),t.addListener("valueChanged",(function(){e.__value[t.getName()]=t.getValue()})),this.__members.push(t),this.__flags|=U.USER_EDITED,this.emit("valueChanged",{}),t};e.prototype.getParameter=function(t){for(var e=0,a=this.__members;e<a.length;e++){var i=a[e];if(i.getName()==t)return i}};e.prototype.getMember=function(t){return this.getParameter(t)};e.prototype.getMemberNames=function(){var t=[];for(var e=0;e<this.__members.length;e++){var a=this.__members[e];null!=a&&(t[e]=a.getName())}return t};e.prototype.toJSON=function(t,e){if(0==(this.__flags&U.USER_EDITED))return;var a=[];for(var i=0,n=this.__members;i<n.length;i++){var r=n[i];a.push(r.toJSON(t,e))}return{members:a}};e.prototype.fromJSON=function(t,e,a){if(null!=t.members){this.__flags|=U.USER_EDITED;for(var i=0;i<t.members.length;i++)t.members[i]&&this.__members[i].fromJSON(t.members[i],e)}else console.warn("Invalid Parameter JSON")};e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0,a=this.__members;e<a.length;e++){var i=a[e];i.destroy()}};return e}(k);var Tt=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,"TreeItem")||this,i.__filterFn=a,i.__emittreeItemGlobalXfoChanged=i.__emittreeItemGlobalXfoChanged.bind(i);return i}e.prototype.__emittreeItemGlobalXfoChanged=function(t){this.emit("treeItemGlobalXfoChanged",t)};e.prototype.setOwner=function(t){this.__owner=t};e.prototype.getOwner=function(){return this.__owner};e.prototype.setFilterFn=function(){this.__filterFn=filterFn};e.prototype.getFilterFn=function(){return this.__filterFn};e.prototype.setValue=function(t,e){if(e===void 0){e=z.USER_SETVALUE}if(this.__filterFn&&!this.__filterFn(t))return!1;this.__value!==t&&(this.__value&&this.__value.removeListener("globalXfoChanged",this.__emittreeItemGlobalXfoChanged),this.__value=t,this.__value&&this.__value.addListener("globalXfoChanged",this.__emittreeItemGlobalXfoChanged),e!=z.USER_SETVALUE&&e!=z.REMOTEUSER_SETVALUE||(this.__flags|=U.USER_EDITED),this.emit("valueChanged",{mode:e}))};e.prototype.toJSON=function(t,e){if(0!=(this.__flags&U.USER_EDITED))return{value:t.makeRelative(this.__value.getPath())}};e.prototype.fromJSON=function(t,e,a){var i=this;null!=t.value?(e.resolvePath(t.value,(function(t){i.setValue(t)}),(function(){console.warn("Unable to resolve tree item parameter value:"+pj.paramPath)})),this.__flags|=U.USER_EDITED):console.warn("Invalid Parameter JSON")};e.prototype.clone=function(t){return new e(this.__name,this.__filterFn)};e.prototype.destroy=function(){this.__value&&this.__value.removeListener("globalXfoChanged",this.__emittreeItemGlobalXfoChanged)};return e}(k);var Mt=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,"BaseItem")||this,i.__items=new Set,i.__filterFn=a;return i}e.prototype.setFilterFn=function(t){this.__filterFn=t};e.prototype.getFilterFn=function(){return this.__filterFn};e.prototype.getItem=function(t){return Array.from(this.__items)[t]};e.prototype.addItem=function(t,e){if(e===void 0){e=!0}if(this.__filterFn&&!this.__filterFn(t))return console.warn("ItemSet __filterFn rejecting item:",t.getPath()),!1;this.__items.add(t);var a=Array.from(this.__items).indexOf(t);return this.emit("itemAdded",{item:t,index:a}),e&&this.emit("valueChanged",{}),a};e.prototype.addItems=function(t,e){var a=this;if(e===void 0){e=!0}t.forEach((function(t){return a.addItem(t,!1)})),e&&this.emit("valueChanged",{})};e.prototype.removeItem=function(t,e){if(e===void 0){e=!0}var a=Array.from(this.__items)[t];return this.__items.delete(a),this.emit("itemRemoved",{item:a,index:t}),e&&this.emit("valueChanged",{}),a};e.prototype.setItems=function(t,e){if(e===void 0){e=!0}for(var a=this.__items.length-1;a>=0;a--){var i=this.__items[a];t.has(i)||this.removeItem(i,!1)}for(var n=0,r=t;n<r.length;n++){var o=r[n];this.__items.has(o)||this.addItem(o,!1)}e&&this.emit("valueChanged",{})};e.prototype.clearItems=function(t){if(t===void 0){t=!0}this.__items.clear(),t&&this.emit("valueChanged",{})};e.prototype.getNumItems=function(){return Array.from(this.__items).length};e.prototype.getValue=function(){return this.__items};e.prototype.toJSON=function(t,e){return{}};e.prototype.fromJSON=function(t,e,a){};e.prototype.clone=function(t){return new e(this.__name,this.__filterFn)};return e}(k);var Ft=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,a.getDataType())||this,i.setSourceParameter(a);return i}e.prototype.setSourceParameter=function(t){this.sourceParameter=t,this.sourceParameter.addListener("valueChanged",this.__proxyValueChanged.bind(this))};e.prototype.__proxyValueChanged=function(t){this.emit("valueChanged",{mode:t})};e.prototype.getDataType=function(){return this.sourceParameter.getDataType()};e.prototype.setValue=function(t,e){};e.prototype.getValue=function(t){return this.sourceParameter.getValue(t)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.sourceParameter&&(i.sourceParameter=this.sourceParameter.getPath()),i};e.prototype.fromJSON=function(e,a,i){var n=this;t.prototype.fromJSON.call(this,e,a,i),e.sourceParameter&&a.resolvePath(e.sourceParameter,(function(t){n.setSourceParameter(t)}),(function(t){console.warn("Error loading Proxy Param: '"+n.getName()+"'. Unable to connect to:"+e.sourceParameter)})),e.range&&(this.sourceParameter=e.range),e.step&&(this.__step=e.step)};e.prototype.clone=function(t,a){var i=new e(this.__name,this.__value);return this.sourceParameter&&this.connectToClonedSourceParam(a),i};e.prototype.connectToClonedSourceParam=function(t){var e=this;t.resolveClonedItem(this.sourceParameter,(function(t){clonedParam.setSourceParameter(t)}),(function(t){console.warn("Error cloning Proxy Param: '"+e.getName()+"'. Unable to connect to:"+j.sourceParameter)}))};return e}(k);K.registerClass("ProxyParameter",Ft);var Ct=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,"Geometry")||this,i.setValue(a),i.__emitboundingBoxDirtied=i.__emitboundingBoxDirtied.bind(i);return i}e.prototype.__emitboundingBoxDirtied=function(t){this.emit("boundingBoxChanged",t)};e.prototype.setValue=function(t,e){if(e===void 0){e=z.USER_SETVALUE}this.__value!==t&&(this.__value&&this.__value.removeListener("boundingBoxChanged",this.__emitboundingBoxDirtied),this.__value=t,this.__value&&this.__value.addListener("boundingBoxChanged",this.__emitboundingBoxDirtied),e!=z.USER_SETVALUE&&e!=z.REMOTEUSER_SETVALUE||(this.__flags|=U.USER_EDITED),e!=z.OPERATOR_SETVALUE&&this.emit("valueChanged",{mode:e}))};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){return t.prototype.fromJSON.call(this,e,a,i)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};e.prototype.destroy=function(){this.__value&&this.__value.removeListener("boundingBoxChanged",this.__emitboundingBoxDirtied)};return e}(k);var Nt=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.width=0,a.height=0,a.format="RGB",a.type="UNSIGNED_BYTE",a.addParameter(new yt("AlphaFromLuminance",!1)),a.addParameter(new yt("Invert",!1)),a.addParameter(new yt("FlipY",!1)),a.on("parameterValueChanged",(function(t){a.emit("updated")})),a.loaded=!1;return a}e.prototype.isLoaded=function(){return!0};e.prototype.getMapping=function(){return this.__mapping};e.prototype.setMapping=function(t){this.__mapping=t};e.prototype.isStream=function(){return!1};e.prototype.isStreamAtlas=function(){return this.__streamAtlas};e.prototype.getParams=function(){return{type:this.type,format:this.format,width:this.width,height:this.height,flipY:this.getParameter("FlipY").getValue(),invert:this.getParameter("Invert").getValue(),alphaFromLuminance:this.getParameter("AlphaFromLuminance").getValue()}};return e}(A);var Yt=function(t){__extends(e,t);function e(e,a,i){return t.call(this,e,a,i)||this}e.prototype.getImage=function(){return this.__image};e.prototype.setImage=function(t,e){var a=this;if(e===void 0){e=0}var i=function(){a.emit("textureDisconnected",{})};t?(null!=this.__image&&this.__image!==t&&i(),this.__image=t,this.emit("textureConnected",{}),this.emit("valueChanged",{mode:e})):null!=this.__image&&(i(),this.__image=void 0,this.emit("textureDisconnected",{}))};e.prototype.setValue=function(e){e instanceof Nt?this.setImage(e):(null!=this.__image&&this.setImage(void 0),t.prototype.setValue.call(this,e))};e.prototype.readBinary=function(e,a){t.prototype.readBinary.call(this,e,a);var i=e.loadStr();""!=i&&(console.log("Load Texture"),this.setImage(a.materialLibrary.getImage(i)))};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(ft);K.registerClass("MaterialFloatParam",Yt);var Kt=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.__imageUpdated=i.__imageUpdated.bind(i);return i}e.prototype.getImage=function(){return this.__image};e.prototype.__imageUpdated=function(){this.emit("valueChanged",{})};e.prototype.setImage=function(t,e){var a=this;if(e===void 0){e=0}var i=function(){a.__image.removeListener("loaded",a.__imageUpdated),a.__image.removeListener("updated",a.__imageUpdated),a.__image=null,a.emit("textureDisconnected",{})};t?(null!=this.__image&&this.__image!==t&&i(),this.__image=t,this.__image.addListener("updated",this.__imageUpdated),this.emit("textureConnected",{}),this.emit("valueChanged",{mode:e})):null!=this.__image&&(i(),this.__image=void 0,this.emit("textureDisconnected",{}))};e.prototype.setValue=function(e){e instanceof Nt?this.setImage(e):(null!=this.__image&&this.setImage(void 0),t.prototype.setValue.call(this,e))};e.prototype.readBinary=function(e,a){t.prototype.readBinary.call(this,e,a);var i=e.loadStr();""!=i&&this.setImage(a.materialLibrary.getImage(i))};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Gt);t("U",Kt);K.registerClass("MaterialColorParam",Kt);var wt=function(t,e,a,i){return"boolean"==typeof e||!1===e||!0===e?new k(t,e,"Boolean"):"string"==typeof e?new k(t,e,"String"):Number.isNumeric(e)?i?new Yt(t,e,a):new ft(t,e,a):e instanceof h?new gt(t,e):e instanceof m?new _t(t,e):e instanceof y?i?new Kt(t,e):new Gt(t,e):new k(t,e)};var zt=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.visibleInGeomDataBuffer=!0,a&&i.setShaderName(a);return i}e.prototype.getShaderName=function(){return this.__shaderName};e.prototype.setShaderName=function(t){if(this.__shaderName==t)return;var e=K.getClass(t);if(!e)throw new Error("Error setting Shader. Shader not found:"+t);var a=e.getParamDeclarations(),i={};for(var n=0,r=a;n<r.length;n++){var o=r[n];var l=this.getParameter(o.name);l||(l=this.addParameter(wt(o.name,o.defaultValue,o.range,0!=o.texturable))),i[o.name]=!0}for(var s=0,d=this.__params;s<d.length;s++){var c=d[s];i[c.getName()]||this.removeParameter(c.getName())}this.__shaderName=t,this.emit("shaderNameChanged",{shaderName:t})};e.prototype.removeAllTextures=function(){for(var t=0,e=this.__params;t<e.length;t++){var a=e[t];a.getImage&&a.getImage()&&a.setImage(void 0)}};e.prototype.getParamTextures=function(){var t={};for(var e=0,a=this.__params;e<a.length;e++){var i=a[e];i.getImage&&i.getImage()&&(t[i.getName()]=i.getImage())}return t};e.prototype.__makeParameterTexturable=function(t){makeParameterTexturable(t)};e.prototype.isTransparent=function(){var t=this.getParameter("Opacity");if(t&&(t.getValue()<.99||t.getImage()))return!0;var e=this.getParameter("BaseColor");return!(!e||!e.getImage()||"RGBA"!=e.getImage().format)};e.prototype.getShaderClass=function(){return K.getClass(this.getShaderName())};e.prototype.modifyParams=function(t,e){e&&this.setShaderName(e);for(var a in t){var i=this.getParameter(a);i&&(t[a]instanceof k?this.replaceParameter(t[a]):i.setValue(t[a]))}};e.prototype.toJSON=function(e,a){if(a===void 0){a=0}return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){if(a===void 0){a={}}if(i===void 0){i=0}e.shader?(this.setShaderName(e.shader),t.prototype.fromJSON.call(this,e,a,i)):console.warn("Invalid Material JSON")};e.prototype.readBinary=function(e,a){var i=e.loadStr();if("StandardMaterial"==i&&(i="StandardSurfaceShader"),"TransparentMaterial"==i&&(i="TransparentSurfaceShader"),this.setShaderName(i),a.versions["zea-engine"].lessThan([0,0,3])){this.setName(e.loadStr());var n=e.loadUInt32();for(var r=0;r<n;r++){var o=(c=e.loadStr()).charAt(0).toUpperCase()+c.slice(1);var l=void 0;"MaterialColorParam"==e.loadStr()?(l=e.loadRGBAFloat32Color(),l.applyGamma(2.2)):l=e.loadFloat32();var s=e.loadStr();var d=this.getParameter(o);d?d.setValue(l):d=this.addParameter(wt(o,l)),""!=s&&d.setImage&&(a.materialLibrary.hasImage(s)?d.setImage(a.materialLibrary.getImage(s)):console.warn("Missing Texture:"+s))}}else t.prototype.readBinary.call(this,e,a);var c};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){t.prototype.copyFrom.call(this,e,a),this.setShaderName(e.getShaderName());for(var i=0,n=e.getParameters();i<n.length;i++){var r=n[i];var o=e.getParameter(r.getName());r.getImage||this.__makeParameterTexturable(o)}};e.prototype.destroy=function(){this.removeAllTextures(),t.prototype.destroy.call(this)};return e}(A);var Ut=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,null==e&&(e=a.constructor.name),a.__name=e,a.format="RGBA",a.type="UNSIGNED_BYTE",a.__loaded=!1,a.width=1,a.height=1;return a}e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getName=function(){return this.__name};e.prototype.isStream=function(){return!1};e.prototype.setData=function(t,e,a){this.width=t,this.height=e,this.__data=a,this.__loaded?this.emit("updated",{}):(this.__loaded=!0,this.emit("loaded",{}))};e.prototype.getParams=function(){var e=t.prototype.getParams.call(this);return e.data=this.__data,e};return e}(Nt);function Jt(t){this.data=t,this.pos=0}function Pt(t){this.stream=new Jt(t),this.output={}}K.registerClass("DataImage2D",Ut),K.registerClass("DataImage",Ut),Jt.prototype.readByte=function(){return this.data[this.pos++]},Jt.prototype.peekByte=function(){return this.data[this.pos]},Jt.prototype.readBytes=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=this.readByte();return e},Jt.prototype.peekBytes=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=this.data[this.pos+a];return e},Jt.prototype.readString=function(t){for(var e="",a=0;a<t;a++)e+=String.fromCharCode(this.readByte());return e},Jt.prototype.readBitArray=function(){for(var t=[],e=this.readByte(),a=7;a>=0;a--)t.push(!!(e&1<<a));return t},Jt.prototype.readUnsigned=function(t){var e=this.readBytes(2);return t?(e[1]<<8)+e[0]:(e[0]<<8)+e[1]},Pt.prototype.parse=function(t){return this.parseParts(this.output,t),this.output},Pt.prototype.parseParts=function(t,e){for(var a=0;a<e.length;a++){var i=e[a];this.parsePart(t,i)}},Pt.prototype.parsePart=function(t,e){var a,i=e.label;if(!e.requires||e.requires(this.stream,this.output,t))if(e.loop){for(var n=[];e.loop(this.stream);){var r={};this.parseParts(r,e.parts),n.push(r)}t[i]=n}else e.parts?(a={},this.parseParts(a,e.parts),t[i]=a):e.parser?(a=e.parser(this.stream,this.output,t),e.skip||(t[i]=a)):e.bits&&(t[i]=this.parseBits(e.bits))},Pt.prototype.parseBits=function(t){var e={},a=this.stream.readBitArray();for(var i in t){var n=t[i];n.length?e[i]=a.slice(n.index,n.index+n.length).reduce((function(t,e){return 2*t+e}),0):e[i]=a[n.index]}return e};var Et=function(){return function(t){return t.readByte()}},Ht=function(t){return function(e){return e.readBytes(t)}},kt=function(t){return function(e){return e.readString(t)}},Bt=function(t){return function(e){return e.readUnsigned(t)}},Dt=function(t,e){return function(a,i,n){for(var r=e(a,i,n),o=new Array(r),l=0;l<r;l++)o[l]=a.readBytes(t);return o}},Ot={label:"blocks",parser:function(t){for(var e=[],a=t.readByte();0!==a;a=t.readByte())e=e.concat(t.readBytes(a));return e}},Qt={label:"gce",requires:function(t){var e=t.peekBytes(2);return 33===e[0]&&249===e[1]},parts:[{label:"codes",parser:Ht(2),skip:!0},{label:"byteSize",parser:Et()},{label:"extras",bits:{future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}}},{label:"delay",parser:Bt(!0)},{label:"transparentColorIndex",parser:Et()},{label:"terminator",parser:Et(),skip:!0}]},At={label:"image",requires:function(t){return 44===t.peekByte()},parts:[{label:"code",parser:Et(),skip:!0},{label:"descriptor",parts:[{label:"left",parser:Bt(!0)},{label:"top",parser:Bt(!0)},{label:"width",parser:Bt(!0)},{label:"height",parser:Bt(!0)},{label:"lct",bits:{exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}}}]},{label:"lct",requires:function(t,e,a){return a.descriptor.lct.exists},parser:Dt(3,(function(t,e,a){return Math.pow(2,a.descriptor.lct.size+1)}))},{label:"data",parts:[{label:"minCodeSize",parser:Et()},Ot]}]},jt={label:"text",requires:function(t){var e=t.peekBytes(2);return 33===e[0]&&1===e[1]},parts:[{label:"codes",parser:Ht(2),skip:!0},{label:"blockSize",parser:Et()},{label:"preData",parser:function(t,e,a){return t.readBytes(a.text.blockSize)}},Ot]},qt={label:"frames",parts:[Qt,{label:"application",requires:function(t,e,a){var i=t.peekBytes(2);return 33===i[0]&&255===i[1]},parts:[{label:"codes",parser:Ht(2),skip:!0},{label:"blockSize",parser:Et()},{label:"id",parser:function(t,e,a){return t.readString(a.blockSize)}},Ot]},{label:"comment",requires:function(t,e,a){var i=t.peekBytes(2);return 33===i[0]&&254===i[1]},parts:[{label:"codes",parser:Ht(2),skip:!0},Ot]},At,jt],loop:function(t){var e=t.peekByte();return 33===e||44===e}},$t=[{label:"header",parts:[{label:"signature",parser:kt(3)},{label:"version",parser:kt(3)}]},{label:"lsd",parts:[{label:"width",parser:Bt(!0)},{label:"height",parser:Bt(!0)},{label:"gct",bits:{exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}}},{label:"backgroundColorIndex",parser:Et()},{label:"pixelAspectRatio",parser:Et()}]},{label:"gct",requires:function(t,e){return e.lsd.gct.exists},parser:Dt(3,(function(t,e){return Math.pow(2,e.lsd.gct.size+1)}))},qt];function te(t){var e=new Pt(new Uint8Array(t));this.raw=e.parse($t),this.raw.hasImages=!1;for(var a=0;a<this.raw.frames.length;a++)if(this.raw.frames[a].image){this.raw.hasImages=!0;break}}te.prototype.decompressFrame=function(t,e){if(t>=this.raw.frames.length)return null;var a=this.raw.frames[t];if(a.image){var i=a.image.descriptor.width*a.image.descriptor.height,n=function(t,e,a){var i,n,r,o,l,s,d,c,u,h,m,p,f,b,y,g,_=a,Z=new Array(a),G=new Array(4096),X=new Array(4096),v=new Array(4097);for(l=(n=1<<(p=t))+1,i=n+2,d=-1,r=(1<<(o=p+1))-1,u=0;u<n;u++)G[u]=0,X[u]=u;for(m=c=f=b=g=y=0,h=0;h<_;){if(0===b){if(c<o){m+=e[y]<<c,c+=8,y++;continue}if(u=m&r,m>>=o,c-=o,u>i||u==l)break;if(u==n){r=(1<<(o=p+1))-1,i=n+2,d=-1;continue}if(-1==d){v[b++]=X[u],d=u,f=u;continue}for(s=u,u==i&&(v[b++]=f,u=d);u>n;)v[b++]=X[u],u=G[u];f=255&X[u],v[b++]=f,i<4096&&(G[i]=d,X[i]=f,0==(++i&r)&&i<4096&&(o++,r+=i)),d=s}b--,Z[g++]=v[b],h++}for(h=g;h<_;h++)Z[h]=0;return Z}(a.image.data.minCodeSize,a.image.data.blocks,i);a.image.descriptor.lct.interlaced&&(n=function(t,e){for(var a=new Array(t.length),i=t.length/e,n=function(i,n){var r=t.slice(n*e,(n+1)*e);a.splice.apply(a,[i*e,e].concat(r))},r=[0,4,2,1],o=[8,8,4,2],l=0,s=0;s<4;s++)for(var d=r[s];d<i;d+=o[s])n(d,l),l++;return a}(n,a.image.descriptor.width));var r={pixels:n,dims:{top:a.image.descriptor.top,left:a.image.descriptor.left,width:a.image.descriptor.width,height:a.image.descriptor.height}};return a.image.descriptor.lct&&a.image.descriptor.lct.exists?r.colorTable=a.image.lct:r.colorTable=this.raw.gct,a.gce&&(r.delay=10*(a.gce.delay||10),r.disposalType=a.gce.extras.disposal,a.gce.extras.transparentColorGiven&&(r.transparentIndex=a.gce.transparentColorIndex)),e&&(r.patch=function(t){for(var e=t.pixels.length,a=new Uint8ClampedArray(4*e),i=0;i<e;i++){var n=4*i,r=t.pixels[i],o=t.colorTable[r];a[n]=o[0],a[n+1]=o[1],a[n+2]=o[2],a[n+3]=r!==t.transparentIndex?255:0}return a}(r)),r}return null},te.prototype.decompressFrames=function(t){for(var e=[],a=0;a<this.raw.frames.length;a++){this.raw.frames[a].image&&e.push(this.decompressFrame(a,t))}return e};var ee={},ae={},ie=-1!==navigator.userAgent.indexOf("Chrome");var ne=function(t){__extends(e,t);function e(e,a,i){if(a===void 0){a=""}if(i===void 0){i={}}var n=this;a.constructor==Object&&(i=a),null!=e&&-1!=e.lastIndexOf(".")&&(console.warn("Deprecated signature. Please provide a name and filepath to the image constructor"),e=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."))),n=t.call(this,e,i)||this,n.__loaded=!1;var r=n.addParameter(new St("FilePath"));r.addListener("valueChanged",(function(){if(n.loaded=!1,""==n.getName()){var t=r.getStem(),e=t.substring(t.length-1);isNaN(e)?n.setName(t):n.setName(t.substring(0,t.length-1))}var a=r.getFileDesc();a&&n.__loadData(a)})),a&&""!=a&&r.setFilepath(a);return n}e.__imageDataLibrary=function(){return ee};e.registerLoader=function(t,e){ae[t]=e};e.constructLoader=function(t,e){for(var a=0,i=ae;a<i.length;a++){var n=i[a];if(new RegExp("\\.("+n+")$","i").test(t.name)){var r=new ae[n](e);if(r)return r.getParameter("FilePath").setValue(t.id),r}}};e.prototype.__loadData=function(t){var e=this.getParameter("FilePath").getExt();if(".jpg"==e||".png"==e||".webp"==e)this.__loadLDRImage(t,e);else if(".mp4"==e||".ogg"==e)this.__loadLDRVideo(t);else if(".vlh"==e)this.__loadVLH(t);else if(".gif"==e)this.__loadGIF(t);else{if(".svg"!=e)throw new Error("Unsupported file type. Check the ext:"+t);console.warn("SVG Image not yet supported")}};e.prototype.__loadLDRImage=function(t,e){var a=this;var i;".jpg"==e?this.format="RGB":".png"==e&&(this.format="RGBA"),this.type="UNSIGNED_BYTE";var r=function(){a.getDOMElement=function(){return i},a.width=i.width,a.height=i.height,a.__data=i,a.__loaded=!0,a.emit("loaded",{})};if(t.id in ee)i=ee[t.id],i.complete?r():i.addListener("load",r);else{ut.addWork(t.id,1);var o=this.addParameter(new ft("PreferredSize",-1));var l=t.url;if(t.assets&&Object.keys(t.assets).length>0){var s={maxSize:n.gpuDesc.maxTextureSize},d=o.getValue();-1==d?t.assets.reduce&&(s.prefSize=t.assets.reduce.w):s.prefSize=d;var c=function(t,e){if(e=e.filter((function(t){return null!==t})),ie){var a=e.filter((function(t){return"webp"===t.format}));a.length>1&&(e=a)}else e=e.filter((function(t){return"webp"!==t.format}));if(t.maxSize&&(e=e.filter((function(e){return e.w<=t.maxSize}))),t.filter){var i=e.filter((function(e){return-1!==e.url.indexOf(t.filter)}));i.length>1&&(e=i)}if(t.prefSize&&(e=e.map((function(e){return Object.assign({score:Math.abs(t.prefSize-e.w)},e)}))).sort((function(t,e){return t.score>e.score?1:t.score<e.score?-1:0})),e.length>0)return e[0]}(s,Object.values(t.assets));c&&(console.log("Selected image:"+t.name+" format:"+c.format+" :"+c.w+"x"+c.h+" url:"+c.url),l=c.url)}else console.warn("Images not processed for this file:"+t.name);i=new Image,i.crossOrigin="anonymous",i.src=l,i.addListener("load",r),i.addListener("load",(function(){ut.addWorkDone(t.id,1)})),ee[t.id]=i}};e.prototype.__removeVideoParams=function(){this.getParameterIndex("spatializeAudio")&&(this.removeParameter(this.getParameterIndex("Loop")),this.removeParameter(this.getParameterIndex("spatializeAudio")),this.removeParameter(this.getParameterIndex("Gain")),this.removeParameter(this.getParameterIndex("refDistance")),this.removeParameter(this.getParameterIndex("maxDistance")),this.removeParameter(this.getParameterIndex("rolloffFactor")),this.removeParameter(this.getParameterIndex("coneInnerAngle")),this.removeParameter(this.getParameterIndex("coneOuterAngle")),this.removeParameter(this.getParameterIndex("coneOuterGain")))};e.prototype.__loadLDRVideo=function(t){var e=this;this.format="RGB",this.type="UNSIGNED_BYTE",ut.addWork(t.id,1);var a=this.addParameter(new yt("Mute",!0)),i=this.addParameter(new yt("Loop",!0)),n=document.createElement("video");n.style.display="none",n.preload="auto",n.crossOrigin="anonymous",this.getAudioSource=function(){return n},document.body.appendChild(n),n.addListener("loadedmetadata",(function(){n.muted=a.getValue(),a.addListener("valueChanged",(function(){n.muted=a.getValue()})),n.loop=i.getValue(),i.addListener("valueChanged",(function(){n.loop=i.getValue()})),e.width=n.videoHeight,e.height=n.videoWidth,e.__data=n,e.__loaded=!0,ut.addWorkDone(t.id,1),e.emit("loaded",{}),n.play().then((function(){var t=0;var a=function(){if(n.paused||n.ended)return;var i=Math.floor(29.97*n.currentTime);t!=i&&(e.emit("updated",{}),t=i),setTimeout(a,20)};a()}),(function(t){console.log("Autoplay was prevented.",t,t.message)}))}),!1),n.src=t.url};e.prototype.__loadVLH=function(t){var e=this;this.type="FLOAT";var a=new y(1,1,1,1);this.setHDRTint=function(t){a=t},this.getHDRTint=function(){return a},ut.loadUrl(t.id,t.url,(function(t){var a,i;for(var n in t)n.endsWith(".jpg")?a=t[n]:n.endsWith(".bin")&&(i=t[n]);var r=new Blob([a.buffer]),o=new Image;o.onload=function(){e.width=o.width,e.height=o.height,e.__data={ldr:o,cdm:i},e.__loaded?e.emit("updated",{}):(e.__loaded=!0,e.emit("loaded",{}))},o.src=URL.createObjectURL(r)}))};e.prototype.__loadGIF=function(t){var e=this;var a,i,n;this.format="RGBA",this.type="UNSIGNED_BYTE",this.__streamAtlas=!0,this.addParameter(new Zt("StreamAtlasDesc",new p)),this.addParameter(new ft("StreamAtlasIndex",0)),this.getParameter("StreamAtlasIndex").setRange([0,1]),this.getFrameDelay=function(){return 20},this.play=function(){n.then((function(){a=!0,i&&i()}))},this.stop=function(){a=!1},t.id in ee?n=ee[t.id]:(n=new Promise((function(e,a){if(ut.addWork(t.id,1),t.assets&&t.assets.atlas){var i=new Image;return i.crossOrigin="anonymous",i.src=t.assets.atlas.url,void i.addListener("load",(function(){e({width:t.assets.atlas.width,height:t.assets.atlas.height,atlasSize:t.assets.atlas.atlasSize,frameDelays:t.assets.atlas.frameDelays,frameRange:[0,t.assets.atlas.frameDelays.length],imageData:i}),ut.addWorkDone(t.id,1)}))}nt(t.url,(function(a){console.warn("Unpacking Gif client side:"+t.name);var i=performance.now(),n=new te(a).decompressFrames(!0),r=Math.sqrt(n.length),o=[r,r];Math.fract(r)>0&&(o[0]=Math.floor(o[0]+1),Math.fract(r)>.5?o[1]=Math.floor(o[1]+1):o[1]=Math.floor(o[1]));var l=n[0].dims.width,s=n[0].dims.height,d=document.createElement("canvas"),c=d.getContext("2d"),u=document.createElement("canvas"),h=u.getContext("2d");u.width=l,u.height=s;var m=document.createElement("canvas"),p=m.getContext("2d");var f;m.width=o[0]*l,m.height=o[1]*s;var b=[],y=function(t,e){var a=t.dims;b.push(t.delay/10),f&&a.width==f.width&&a.height==f.height||(d.width=a.width,d.height=a.height,f=c.createImageData(a.width,a.height)),f.data.set(t.patch),c.putImageData(f,0,0),2==t.disposalType&&h.clearRect(0,0,u.width,u.height),h.drawImage(d,a.left,a.top),p.drawImage(u,e%o[0]*l,Math.floor(e/o[0])*s)};for(var g=0;g<n.length;g++)y(n[g],g);ut.addWorkDone(t.id,1);var _=p.getImageData(0,0,m.width,m.height),Z=performance.now()-i;console.log("Decode GIF '"+t.name+"' time:"+Z),e({width:m.width,height:m.height,atlasSize:o,frameRange:[0,n.length],frameDelays:b,imageData:_})}),(function(e){console.warn("Unable to Load URL:"+e+":"+t.url),a()}))})),ee[t.id]=n),n.then((function(t){e.width=t.width,e.height=t.height,e.getParameter("StreamAtlasDesc").setValue(new p(t.atlasSize[0],t.atlasSize[1],0,0)),e.getParameter("StreamAtlasIndex").setRange(t.frameRange),e.__data=t.imageData,e.getFrameDelay=function(e){return 10*t.frameDelays[e]};var n=e.getParameter("StreamAtlasIndex"),r=n.getRange()[1];var o=0;i=function(){n.setValue(o),a&&setTimeout(i,e.getFrameDelay(o)),o=(o+1)%r},a&&i(),e.__loaded=!0,e.emit("loaded",{})}))};e.prototype.getFilepath=function(){return this.getParameter("FilePath").getValue()};e.prototype.isStream=function(){return!1};e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getParams=function(){var e=t.prototype.getParams.call(this);return this.__loaded&&(e.data=this.__data),e};e.prototype.toJSON=function(t,e){};e.prototype.fromJSON=function(t,e,a){};e.prototype.readBinary=function(t,e){this.setName(t.loadStr());var a=t.loadStr();if("string"==typeof a&&""!=a){if(e.lod>=0){var i=a.lastIndexOf(".");if(-1!=i){var n=a.substring(0,i)+e.lod+a.substring(i);ut.resolveFilepath(n)&&(a=n)}}this.getParameter("FilePath").setFilepath(a)}};return e}(Nt);var re=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;console.warn("FileImage2D is becoming deprecated in favor of simple FileImage"),i=t.call(this,e,a)||this;return i}return e}(ne);K.registerClass("FileImage2D",ne),K.registerClass("FileImage",ne);var oe=-1!==navigator.userAgent.indexOf("Chrome");var le=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a,i)||this,n.type="UNSIGNED_BYTE",n.addParameter(new ft("PreferredSize",-1)),n.__crossOrigin="anonymous";return n}e.prototype.setCrossOrigin=function(t){this.__crossOrigin=t};e.prototype.__loadData=function(t){".png"==this.getParameter("FilePath").getExt()&&(this.format="RGBA");var e=t.url;if(t.assets&&Object.keys(t.assets).length>0){var a={maxSize:n.gpuDesc.maxTextureSize},i=this.getParameter("PreferredSize").getValue();-1==i?t.assets.reduce&&(a.prefSize=t.assets.reduce.w):a.prefSize=i;var r=function(t,e){if(e=e.filter((function(t){return null!==t})),oe){var a=e.filter((function(t){return"webp"===t.format}));a.length>1&&(e=a)}else e=e.filter((function(t){return"webp"!==t.format}));if(t.maxSize&&(e=e.filter((function(e){return e.w<=t.maxSize}))),t.filter){var i=e.filter((function(e){return-1!==e.url.indexOf(t.filter)}));i.length>1&&(e=i)}if(t.prefSize&&(e=e.map((function(e){return Object.assign({score:Math.abs(t.prefSize-e.w)},e)}))).sort((function(t,e){return t.score>e.score?1:t.score<e.score?-1:0})),e.length>0)return e[0]}(a,Object.values(t.assets));r&&(console.log("Selected image:"+t.name+" format:"+r.format+" :"+r.w+"x"+r.h+" url:"+r.url),e=r.url)}else console.warn("Images not processed for this file:"+t.name);this.setImageURL(e,"RGB")};e.prototype.setImageURL=function(t,e){var a=this;if(e===void 0){e="RGB"}if(!e){var i=t.lastIndexOf(".");if(-1!=i){".png"==t.substring(i).toLowerCase()&&(e="RGBA")}}var n;this.format=e,this.__loaded=!1;var r=function(){a.getDOMElement=function(){return n},a.width=n.width,a.height=n.height,a.__data=n,a.__loaded=!0,a.emit("loaded",{})},o=ne.__imageDataLibrary();t in o?(n=o[t],n.complete?r():n.addListener("load",r)):(n=new Image,n.crossOrigin=this.__crossOrigin,n.src=t,n.addListener("load",r),o[t]=n)};return e}(ne);ne.registerLoader("jpg|jpeg|png",le),K.registerClass("LDRImage",le);var se=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a,i)||this,n.format="RGB",n.type="UNSIGNED_BYTE",n.addParameter(new yt("Mute",!1)),n.addParameter(new yt("Loop",!0)),n.addParameter(new ft("Gain",2)).setRange([0,5]),n.addParameter(new yt("SpatializeAudio",!0)),n.addParameter(new ft("refDistance",2)),n.addParameter(new ft("maxDistance",1e4)),n.addParameter(new ft("rolloffFactor",1)),n.addParameter(new ft("coneInnerAngle",360)),n.addParameter(new ft("coneOuterAngle",0)),n.addParameter(new ft("coneOuterGain",1));return n}e.prototype.__loadData=function(t){var e=this;ut.addWork(t.id,1);var a=document.createElement("video");a.style.display="none",a.preload="auto",a.crossOrigin="anonymous",this.getAudioSource=function(){return a},document.body.appendChild(a),a.addListener("loadedmetadata",(function(){var i=e.getParameter("Mute");a.muted=i.getValue(),i.addListener("valueChanged",(function(){a.muted=i.getValue()}));var n=e.getParameter("Loop");a.loop=n.getValue(),n.addListener("valueChanged",(function(){a.loop=n.getValue()})),e.width=a.videoHeight,e.height=a.videoWidth,e.__data=a,e.__loaded=!0,ut.addWorkDone(t.id,1),e.emit("loaded",{});var r=0;var o=function(){if(a.paused||a.ended)return;var t=Math.floor(29.97*a.currentTime);r!=t&&(e.emit("updated",{}),r=t),setTimeout(o,20)};o()}),!1),a.src=t.url;var i=a.play();void 0!==i&&i.then((function(t){console.log("Autoplay started!")})).catch((function(){console.log("Autoplay was prevented.")}))};return e}(ne);ne.registerLoader("mp4|ogg",se),K.registerClass("LDRVideo",se);var de=function(t){__extends(e,t);function e(e,a,i){if(a===void 0){a=""}if(i===void 0){i={}}var n=this;n=t.call(this,e,a,i)||this,n.format="RGBA",n.type="UNSIGNED_BYTE",n.__streamAtlas=!0,n.getParameter("FilePath").setSupportedExts("gif"),n.addParameter(new Zt("StreamAtlasDesc")),n.addParameter(new ft("StreamAtlasIndex",0));var r=n.getParameter("StreamAtlasIndex");var o;r.setRange([0,1]);var l=0;var s=function(t){r.setValue(l),o&&setTimeout((function(){return s(t)}),n.getFrameDelay(l)),l=(l+1)%t};n.play=function(){n.__resourcePromise.then((function(){o=!0;var t=r.getRange()[1];s(t)}))},n.stop=function(){o=!1};return n}e.prototype.getFrameDelay=function(t){return 10*this.__unpackedData.frameDelays[t]};e.prototype.__loadData=function(t){var e=this;var a=ne.__imageDataLibrary();t.id in a?this.__resourcePromise=a[t.id]:(this.__resourcePromise=new Promise((function(e,a){if(ut.addWork(t.id,1),t.assets&&t.assets.atlas){var i=new Image;return i.crossOrigin="anonymous",i.src=t.assets.atlas.url,void i.addListener("load",(function(){e({width:t.assets.atlas.width,height:t.assets.atlas.height,atlasSize:t.assets.atlas.atlasSize,frameDelays:t.assets.atlas.frameDelays,frameRange:[0,t.assets.atlas.frameDelays.length],imageData:i}),ut.addWorkDone(t.id,1)}))}nt(t.url,(function(a){console.warn("Unpacking Gif client side:"+t.name);var i=performance.now(),n=new te(a).decompressFrames(!0),r=Math.sqrt(n.length),o=[r,r];Math.fract(r)>0&&(o[0]=Math.floor(o[0]+1),Math.fract(r)>.5?o[1]=Math.floor(o[1]+1):o[1]=Math.floor(o[1]));var l=n[0].dims.width,s=n[0].dims.height,d=document.createElement("canvas"),c=d.getContext("2d"),u=document.createElement("canvas"),h=u.getContext("2d");u.width=l,u.height=s;var m=document.createElement("canvas"),p=m.getContext("2d");var f;m.width=o[0]*l,m.height=o[1]*s;var b=[],y=function(t,e){var a=t.dims;b.push(t.delay/10),f&&a.width==f.width&&a.height==f.height||(d.width=a.width,d.height=a.height,f=c.createImageData(a.width,a.height)),f.data.set(t.patch),c.putImageData(f,0,0),2==t.disposalType&&h.clearRect(0,0,u.width,u.height),h.drawImage(d,a.left,a.top),p.drawImage(u,e%o[0]*l,Math.floor(e/o[0])*s)};for(var g=0;g<n.length;g++)y(n[g],g);ut.addWorkDone(t.id,1);var _=p.getImageData(0,0,m.width,m.height),Z=performance.now()-i;console.log("Decode GIF '"+t.name+"' time:"+Z),e({width:m.width,height:m.height,atlasSize:o,frameRange:[0,n.length],frameDelays:b,imageData:_})}),(function(e){console.warn("Unable to Load URL:"+e+":"+t.url),a()}))})),a[t.id]=this.__resourcePromise),this.__resourcePromise.then((function(t){e.width=t.width,e.height=t.height,e.getParameter("StreamAtlasDesc").setValue(new p(t.atlasSize[0],t.atlasSize[1],0,0)),e.getParameter("StreamAtlasIndex").setRange(t.frameRange),e.__unpackedData=t,e.__data=t.imageData,e.__loaded=!0,e.emit("loaded",{})}))};return e}(ne);ne.registerLoader("gif",de),K.registerClass("GIFImage",de);var ce=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;var n;null!=e&&-1!=e.lastIndexOf(".")&&(n=e,e=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."))),i=t.call(this,e,a)||this,i.__loaded=!1,i.__exposure=1,i.__ambientLightFactor=0,i.__hdrtint=new y(1,1,1,1),i.__stream="stream"in a&&a.stream,i.type="FLOAT";var r=i.addParameter(new St("FilePath"));r.addListener("valueChanged",(function(){if(i.loaded=!1,""==i.getName()){var t=r.getStem(),e=t.substring(t.length-1);isNaN(e)?i.setName(t):i.setName(t.substring(0,t.length-1))}var a=r.getValue(),n=r.getFile();i.__loadVLH(a,n)})),n&&i.getParameter("FilePath").setFilepath(n);return i}e.prototype.getDOMElement=function(){return this.__domElement};e.prototype.getResourcePath=function(){return this.getParameter("FilePath").getValue()};e.prototype.__decodeData=function(t){var e=this;var a=t.ldr,i=t.cdm,n=new Blob([a.buffer]),r=new Image;r.onload=function(){e.width=r.width,e.height=r.height,e.__data={ldr:r,cdm:i},e.__loaded?e.emit("updated",{}):(e.__loaded=!0,e.emit("loaded",{}))},r.src=URL.createObjectURL(n)};e.prototype.__loadVLH=function(t,e){var a=this;this.type="FLOAT",ut.loadUrl(t,e.url,(function(t){if(!t.ldr||!t.cdm)for(var e in t)e.endsWith(".jpg")?(t.ldr=t[e],delete t[e]):e.endsWith(".bin")&&(t.cdm=t[e],delete t[e]);a.__decodeData(t)}))};e.prototype.isStream=function(){return!1};e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getParams=function(){var e=t.prototype.getParams.call(this);return this.__loaded&&(e.data=this.__data,e.exposure=this.__exposure),e};e.prototype.setHDRTint=function(t){this.__hdrtint=t};e.prototype.getHDRTint=function(){return this.__hdrtint};e.prototype.toJSON=function(t,e){};e.prototype.fromJSON=function(t,e,a){};e.prototype.readBinary=function(t,e){this.setName(t.loadStr());var a=t.loadStr();if("string"==typeof a&&""!=a){if(e.lod>=0){var i=a.lastIndexOf(".");if(-1!=i){var n=a.substring(0,i)+e.lod+a.substring(i);ut.resourceAvailable(n)&&(a=n)}}this.getParameter("FilePath").setValue(a)}};return e}(Nt);K.registerClass("VLHImage",ce);var ue=1,he=2,me=function(t,e){return e<t?0:1};function pe(t){return t.dot(new h(1,1))}function fe(t){return new h(Math.abs(t.x),Math.abs(t.y))}function be(t,e){return new h(Math.max(t.x,e),Math.max(t.y,e))}function ye(t){var e=function(t){return new m(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))}(t),a=function(t){return new m(2*me(0,t.x)-1,2*me(0,t.y)-1,2*me(0,t.z)-1)}(t),i=new h(e.x,e.y);var n=be(i,1e-20);var r=Math.atan2(n.x,n.y)/Math.HALF_PI;n=be(new h(e.z,i.length()),1e-20);var o=Math.atan2(n.y,n.x)/Math.HALF_PI;var l=new h(a.x*r,a.y*(1-r));if(l.scaleInPlace(o),t.z<0){var s=new h(l.y,l.x),d=new h(a.x,a.y);l=d.subtract(fe(s).multiply(d))}return l.scale(.5).add(new h(.5,.5))}function ge(t){var e=function(t){return new h(2*me(0,t.x)-1,2*me(0,t.y)-1)}(t=t.scale(2).subtract(new h(1,1))),a=pe(fe(t)),i=a*Math.PI*.5;if(i<=0)return new m(0,0,1);if(Math.abs(i-Math.PI)<1e-6)return new m(0,0,-1);if(a>1){t=fe(h(t.y,t.x)).negate().add(new h(1,1)).multiply(e),a=pe(fe(t))}var n=Math.abs(t.x)/a*Math.HALF_PI,r=Math.sin(n),o=Math.cos(n),l=Math.sin(i),s=Math.cos(i);return new m(r*e.x*l,o*e.y*l,s)}var _e=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;i=t.call(this,e,a)||this,i.mapping=he;return i}e.prototype.__decodeData=function(e){t.prototype.__decodeData.call(this,e);var a=e.samples;a&&(window.TextDecoder?this.__sampleSets=JSON.parse(new TextDecoder("utf-8").decode(a)):this.__sampleSets=JSON.parse(F(a)),this.__sampleSets.luminanceThumbnail&&(this.__thumbSize=Math.sqrt(this.__sampleSets.luminanceThumbnail.length)))};e.prototype.getSampleSets=function(){return this.__sampleSets};e.prototype.uvToDir=function(t){switch(this.mapping){case ue:return function(t,e){var a=Math.PI*(2*t-1),i=Math.PI*e;return new m(sin(i)*sin(a),-sin(i)*cos(a),cos(i))}(t);case he:return ge(t)}};e.prototype.dirToUv=function(t){switch(this.mapping){case ue:return function(t){var e=Math.acos(t.z),a=Math.atan2(t.x,-t.y);return new h((1+a/Math.PI)/2,e/Math.PI)}(t);case he:return ye(t)}};e.prototype.uvToLuminance=function(t){var e=Math.floor(t.y*this.__thumbSize)*this.__thumbSize+Math.floor(t.x*this.__thumbSize);return this.__sampleSets.luminanceThumbnail[e]};e.prototype.dirToLuminance=function(t){return this.uvToLuminance(this.dirToUv(t))};return e}(ce);K.registerClass("EnvMap",_e);var Ze=new(function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__labelLibraries={};var a=function(){var t=window.navigator,e=["language","browserLanguage","systemLanguage","userLanguage"];var a,i;if(Array.isArray(t.languages))for(a=0;a<t.languages.length;a++)if(i=t.languages[a],i&&i.length)return i;for(a=0;a<e.length;a++)if(i=t[e[a]],i&&i.length)return i;return null}();a.startsWith("en")?e.__language="En":a.startsWith("es")?e.__language="Es":a.startsWith("fr")?e.__language="Fr":(a.startsWith("gb")||a.startsWith("de"))&&(e.__language="Gb"),e.__foundLabelLibraries={},ut.registerResourceCallback(".labels",(function(t){var a=t.name.split(".")[0];e.__foundLabelLibraries[a]=t,tt(t.url,(function(t){e.__labelLibraries[a]=JSON.parse(t),e.emit("labelLibraryLoaded",{library:a})}))})),window.XLSX&&ut.registerResourceCallback(".xlsx",(function(t){var a=t.name.split(".")[0];e.__foundLabelLibraries[a]=t,nt(t.url,(function(t){var i=new Uint8Array(t),n=XLSX.read(i,{type:"array"}),r={};n.SheetNames.forEach((function(t){XLSX.utils.sheet_to_row_object_array(n.Sheets[t]).forEach((function(t){var e=t.Identifier;delete t.Identifier,r[e]=t}))})),e.__labelLibraries[a]=r,e.emit("labelLibraryLoaded",{library:a})}))}));return e}e.prototype.loadLibrary=function(t,e){this.__foundLabelLibraries[t]=!0,this.__labelLibraries[t]=e,this.labelLibraryLoaded.emit(t)};e.prototype.isLibraryFound=function(t){return t in this.__foundLabelLibraries};e.prototype.isLibraryLoaded=function(t){return t in this.__labelLibraries};e.prototype.getLabelText=function(t,e){var a=this.__labelLibraries[t];if(!a)throw new Error("LabelLibrary: '"+t+"' not found in LabelManager. Found: ["+Object.keys(this.__labelLibraries)+"]");var i=a[e];if(!i)throw new Error("Label: '"+e+"' not found in LabelLibrary: '"+t+"'. Found: ["+Object.keys(a)+"]");var n=i[this.__language];if(!n){if(i.En)return i.En;throw new Error("labelText: '"+language+"' not found in Label. Found: ["+Object.keys(i)+"]")}return n};e.prototype.setLabelText=function(t,e,a){var i=this.__labelLibraries[t];i||(i={},this.__labelLibraries[t]=i);var n=i[e];n||(n={},i[e]=n),n[this.__language]=a};e.prototype.setLanguage=function(t){this.__language=t};return e}(L));var Ge=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__canvasElem=document.createElement("canvas");var n=i.addParameter(new Rt("Library"));i.addParameter(new Rt("Text","")),i.addParameter(new Gt("FontColor",new y(0,0,0))),i.addParameter(new ft("Margin",11)),i.addParameter(new ft("BorderWidth",2)),i.addParameter(new ft("BorderRadius",11)),i.addParameter(new yt("Outline",!1)),i.addParameter(new yt("OutlineColor",new y(0,0,0))),i.addParameter(new yt("Background",!0)),i.addParameter(new Gt("BackgroundColor",new y("#FBC02D"))),i.addParameter(new yt("FillBackground",!0)),i.addParameter(new yt("StrokeBackgroundOutline",!0)),i.addParameter(new ft("FontSize",22)),i.addParameter(new Rt("Font","Helvetica"));i.addListener("nameChanged",(function(){i.loadLabelData()})),a&&n.setValue(a),i.__requestedRerender=!1,i.__needsRender=!1,i.loadLabelData();return i}e.prototype.__parameterValueChanged=function(e){t.prototype.__parameterValueChanged.call(this,e),this.__requestedRerender||(this.__requestedRerender=!0,this.loadLabelData())};e.prototype.loadLabelData=function(){var t=this;Promise.all([function(){return new Promise((function(e){var a=t.getParameter("Library").getValue();if(""==a)return void e();if(!Ze.isLibraryFound(a))return console.warn("Label Libary not found:",a),void e();var i=function(){try{var i=t.getName(),n=Ze.getLabelText(a,i);t.getParameter("Text").setValue(n)}catch(e){console.warn(e)}e()};Ze.isLibraryLoaded(a)?i():Ze.addListener("labelLibraryLoaded",(function(t){t.library==a&&i()}))}))}(),function(){return new Promise((function(e){if(null!=document.fonts){var a=t.getParameter("Font").getValue(),i=t.getParameter("FontSize").getValue();document.fonts.load(i+'px "'+a+'"').then((function(){e()}))}else e()}))}()]).then((function(){t.__requestedRerender=!1,t.__needsRender=!0,t.__loaded?t.emit("updated",{}):(t.__loaded=!0,t.emit("loaded",{}))}))};e.prototype.renderLabelToImage=function(){var t=this.__canvasElem.getContext("2d",{alpha:!0});var e=this.getParameter("Text").getValue();""==e&&(e=this.getName());var a=this.getParameter("Font").getValue(),i=this.getParameter("FontColor").getValue(),n=this.getParameter("FontSize").getValue(),r=this.getParameter("Margin").getValue(),o=this.getParameter("BorderWidth").getValue(),l=this.getParameter("BorderRadius").getValue(),s=this.getParameter("Outline").getValue(),d=this.getParameter("OutlineColor").getValue(),c=this.getParameter("Background").getValue(),u=this.getParameter("BackgroundColor").getValue(),h=this.getParameter("FillBackground").getValue(),m=this.getParameter("StrokeBackgroundOutline").getValue(),p=r+o,f=e.split("\n");t.font=n+'px "'+a+'"';var b=0;f.forEach((function(e){b=Math.max(t.measureText(e).width,b)}));var y=n;this.width=Math.ceil(b+2*p),this.height=Math.ceil(y*f.length+2*p),t.canvas.width=this.width,t.canvas.height=this.height,this.__canvasElem.width=this.width,this.__canvasElem.height=this.height,t.fillStyle="rgba(0, 0, 0, 0.0)",t.fillRect(0,0,this.width,this.height),c&&(t.fillStyle=u.toHex(),t.strokeStyle=d.toHex(),function(t,e,a,i,n,r,o,l,s){if(void 0===l&&(l=!0),void 0===r&&(r=5),"number"==typeof r)r={tl:r,tr:r,br:r,bl:r};else{var d={tl:0,tr:0,br:0,bl:0};for(var c in d)r[c]=r[c]||d[c]}t.beginPath(),t.moveTo(e+r.tl,a),t.lineTo(e+i-r.tr,a),t.quadraticCurveTo(e+i,a,e+i,a+r.tr),t.lineTo(e+i,a+n-r.br),t.quadraticCurveTo(e+i,a+n,e+i-r.br,a+n),t.lineTo(e+r.bl,a+n),t.quadraticCurveTo(e,a+n,e,a+n-r.bl),t.lineTo(e,a+r.tl),t.quadraticCurveTo(e,a,e+r.tl,a),t.closePath(),o&&t.fill(),l&&(t.lineWidth=s,t.stroke())}(t,o,o,this.width-2*o,this.height-2*o,l,h,m,o)),t.font=n+'px "'+a+'"',t.textAlign="left",t.fillStyle=i.toHex(),t.textBaseline="hanging",f.forEach((function(e,a){t.fillText(e,p,p+a*y)})),s&&(t.strokeStyle=d.toHex(),t.lineWidth=1.5,t.strokeText(e,p,p)),this.__data=t.getImageData(0,0,this.width,this.height),this.__needsRender=!1,this.emit("labelRendered",{width:this.width,height:this.height,data:this.__data})};e.prototype.getParams=function(){return this.__needsRender&&this.renderLabelToImage(),t.prototype.getParams.call(this)};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__getLabelText()};return e}(Ut);K.registerClass("Label",Ge);var Xe=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__loaded=!1;return e}e.prototype.connectWebcam=function(t,e,a){var i=this;if(a===void 0){a=!1}var n={width:t,height:e,frameRate:{ideal:60,max:60}};n.facingMode=a?{exact:"environment"}:{facingMode:"user"};var r=document.createElement("video");r.style.display="none",r.preload="auto",r.crossOrigin="anonymous",document.body.appendChild(r),navigator.mediaDevices.getUserMedia({audio:!1,video:n}).then((function(t){r.srcObject=t,r.onloadedmetadata=function(t){r.play(),i.width=r.videoWidth,i.height=r.videoHeight,console.log("Webcam:["+i.width+", "+i.height+"]"),i.__data=r,i.__loaded=!0,i.emit("loaded",{});var e=0;var a=function(){if(r.paused||r.ended)return;var t=Math.floor(60*r.currentTime);e!=t&&(i.emit("updated",{}),e=t),setTimeout(a,20)};a()}})).catch((function(t){}))};e.prototype.setVideoStream=function(t){this.__loaded=!1,this.width=t.videoWidth,this.height=t.videoHeight,this.start(),this.__data=t,this.__loaded=!0,this.emit("loaded",{})};e.prototype.stop=function(){clearInterval(this.__intervalId)};e.prototype.start=function(){var t=this;this.__intervalId=setInterval((function(){t.emit("updated",{})}),20)};e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getParams=function(){return{type:this.type,format:this.format,width:this.width,height:this.height,data:this.__data,flipY:this.getParameter("FlipY").getValue()}};return e}(Nt);K.registerClass("VideoStreamImage2D",Xe);var ve=function(t){__extends(e,t);function e(e){if(e===void 0){e="MaterialLibrary"}var a=this;a=t.call(this)||this,a.__name=e,a.lod=0,n.isMobileDevice&&(a.lod=1),a.clear();return a}e.prototype.clear=function(){this.__images={},this.__materials={Default:new zt("Default","SimpleSurfaceShader")}};e.prototype.getPath=function(){return[this.__name]};e.prototype.getNumMaterials=function(){return Object.keys(this.__materials).length};e.prototype.getMaterials=function(){return Object.values(this.__materials)};e.prototype.getMaterialNames=function(){var t=[];for(var e in this.__materials)t.push(e);return t};e.prototype.hasMaterial=function(t){return t in this.__materials};e.prototype.addMaterial=function(t){t.setOwner(this),this.__materials[t.getName()]=t};e.prototype.getMaterial=function(t,e){if(e===void 0){e=!0}var a=this.__materials[t];if(!a&&e)throw new Error("Material:"+t+" not found in library:"+this.getMaterialNames());return a};e.prototype.hasImage=function(t){return t in this.__images};e.prototype.addImage=function(t){t.setOwner(this),this.__images[t.getName()]=t};e.prototype.getImage=function(t,e){if(e===void 0){e=!0}var a=this.__images[t];if(!a&&e)throw new Error("Image:"+t+" not found in library:"+this.getImageNames());return a};e.prototype.getImageNames=function(){var t=[];for(var e in this.__images)t.push(e);return t};e.prototype.load=function(t){var e=this;var a=new XMLHttpRequest;a.open("GET",t,!0),a.ontimeout=function(){throw new Error("The request for "+t+" timed out.")},a.onload=function(){4===a.readyState&&(200===a.status?e.fromJSON(JSON.parse(a.responseText)):console.warn(a.statusText))},a.send(null)};e.prototype.toJSON=function(t,e){if(t===void 0){t={}}if(e===void 0){e=0}return{numMaterials:this.geoms.length()}};e.prototype.fromJSON=function(t,e,a){if(e===void 0){e={}}if(a===void 0){a=0}e.lod=this.lod;for(var i in t.textures){new ne(i).fromJSON(t.textures[i]),this.__images[i]=texture}for(var n in t.materials){var r=new zt(n);r.fromJSON(t.materials[n]),this.addMaterial(r)}};e.prototype.readBinary=function(t,e){if(e===void 0){e={}}this.name=t.loadStr(),e.lod=this.lod,e.materialLibrary=this;var a=t.loadUInt32();for(var i=0;i<a;i++){var n=t.loadStr(),r=K.constructClass(n,void 0);r.readBinary(t,e),this.__images[r.getName()]=r}var o=t.loadUInt32();if(o>0){var l=t.loadUInt32Array(o);for(var s=0;s<o;s++){var d=new zt("");t.seek(l[s]),d.readBinary(t,e,this.__images),this.addMaterial(d)}}this.emit("loaded",{})};e.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return e}(L);var Ve=new(function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__materialLibraries={},ut.registerResourceCallback(".matlib",(function(t){tt(t.url,(function(a){var i=t.name.split(".")[0],n=JSON.parse(a),r=new ve(i);r.fromJSON(n),e.__materialLibraries[i]=r,e.emit("materialLibraryLoaded",{matlib:r})}))}));return e}e.prototype.getMaterialLibraryNames=function(){var t=[];for(var e in this.__materialLibraries)t.push(e);return t};e.prototype.hasMaterialLibrary=function(t){return t in this.__materialLibraries};e.prototype.getMaterialLibrary=function(t){var e=this.__materialLibraries[t];return e||console.warn("MaterialLibrary:"+t+" not found in MaterialLibraryManager. Found: ["+this.getMaterialLibraryNames()+"]"),e};e.prototype.resolveMaterialFromPath=function(t){var e=this.getMaterialLibrary(t[0]);if(e)return e.getMaterial(t[1])};return e}(L));var Ie=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a,"Material")||this,i.__valueParameterValueChanged=i.__valueParameterValueChanged.bind(i);return i}e.prototype.__valueParameterValueChanged=function(t){this.emit("valueParameterValueChanged",t)};e.prototype.setValue=function(t,e){if(e===void 0){e=z.USER_SETVALUE}this.__value!==t&&(this.__value&&this.__value.removeListener("parameterValueChanged",this.__valueParameterValueChanged),this.__value=t,this.__value&&this.__value.addListener("parameterValueChanged",this.__valueParameterValueChanged),e!=z.USER_SETVALUE&&e!=z.REMOTEUSER_SETVALUE||(this.__flags|=U.USER_EDITED),e!=z.OPERATOR_SETVALUE&&this.emit("valueChanged",{mode:e}))};e.prototype.toJSON=function(t,e){if(0!=(this.__flags&U.USER_EDITED))return{value:this.__value.getPath()}};e.prototype.fromJSON=function(t,e,a){if(null==t.value)return void console.warn("Invalid Parameter JSON");var i=t.value,n=Ve.resolveMaterialFromPath(i);n&&this.setValue(n),this.__flags|=U.USER_EDITED};e.prototype.clone=function(t){return new e(this.__name,this.__value)};e.prototype.destroy=function(){this.__value&&this.__value.removeListener("parameterValueChanged",this.__valueParameterValueChanged)};return e}(k);var Re=function(){function t(t,e,a){if(this.__dataType=t,this.normalized=!1,null!=t.numElements)this.__dimension=this.__dataType.numElements();else switch(t){case 6:case 4:case 5:this.__dimension=1;break;default:throw new Error("Invalid data type for attribute:"+t)}var i;this.__defaultElementValue=null!=a?a:Number.MAX_VALUE,(i=e)&&void 0!==i.byteLength?this.__data=e:(this.__data=new Float32Array(e*this.__dimension),this.initRange(0))}t.prototype.resize=function(t){var e=this.__data.length,a=t*this.__dimension,i=new Float32Array(a);for(var n=0;n<Math.min(this.__data.length,a);n++)i[n]=this.__data[n];this.__data.length<a&&(this.__data=i),this.initRange(e)};t.prototype.initRange=function(t){for(var e=t;e<this.__data.length;e++)this.__data[e]=this.__defaultElementValue};t.prototype.getCount=function(){return this.__data.length/this.__dimension};Object.defineProperty(t.prototype,"length",{get:function(){return this.__data.length/this.__dimension},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dataType",{get:function(){return this.__dataType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"data",{get:function(){return this.__data},set:function(t){this.__data=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numElements",{get:function(){return this.__dimension},enumerable:true,configurable:true});t.prototype.getFloat32Value=function(t){return this.__data[t]};t.prototype.setFloat32Value=function(t,e){this.__data[t]=e};t.prototype.getValueRef=function(t){var e=this.__dimension;if(t>=this.__data.length/e)throw new Error("Invalid vertex index:"+t+". Num Vertices:"+this.__data.length/3);return this.__dataType.createFromFloat32Buffer(this.__data.buffer,t*e)};t.prototype.setValue=function(t,e){var a=this.__dimension;if(t>=this.__data.length/a)throw new Error("Invalid vertex index:"+t+". Num Vertices:"+this.__data.length/3);this.__dataType.createFromFloat32Buffer(this.__data.buffer,t*a).setFromOther(e)};t.prototype.toJSON=function(t,e){return{data:Array.from(this.__data),dataType:u.getTypeName(this.__dataType),defaultValue:this.__defaultElementValue,length:this.__data.length/this.__dimension}};t.prototype.fromJSON=function(t){this.__data=Float32Array.from(t.data)};t.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return t}();var xe=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__boundingBox=new R,e.__boundingBoxDirty=!0,e.__vertexAttributes=new Map,e.__metaData=new Map,e.addVertexAttribute("positions",m,0);return e}e.prototype.setDebugName=function(t){this.__name=t};e.prototype.addVertexAttribute=function(t,e,a){var i;var n;return i=(n=a)&&void 0!==n.byteLength?new Re(e,a):new Re(e,null!=this.vertices?this.vertices.length:0,a),this.__vertexAttributes.set(t,i),i};e.prototype.hasVertexAttribute=function(t){return this.__vertexAttributes.has(t)};e.prototype.getVertexAttribute=function(t){return this.__vertexAttributes.get(t)};e.prototype.getVertexAttributes=function(t){var e={};for(var a=0,i=this.__vertexAttributes.entries();a<i.length;a++){var n=i[a],r=n[0],o=n[1];e[r]=o}return e};Object.defineProperty(e.prototype,"vertices",{get:function(){return this.__vertexAttributes.get("positions")},enumerable:true,configurable:true});e.prototype.numVertices=function(){return this.vertices.length};e.prototype.getNumVertices=function(){return this.vertices.length};e.prototype.setNumVertices=function(t){this.__vertexAttributes.forEach((function(e){return e.resize(t)}))};e.prototype.getVertex=function(t){return m.createFromFloat32Buffer(this.vertices.data.buffer,3*t)};e.prototype.setVertex=function(t,e){return m.createFromFloat32Buffer(this.vertices.data.buffer,3*t).setFromOther(e)};e.prototype.moveVertices=function(t){var e=this.vertices;for(var a=0;a<e.length;a++)e.getValueRef(a).addInPlace(t);this.setBoundingBoxDirty()};e.prototype.transformVertices=function(t){var e=this.vertices;for(var a=0;a<e.length;a++){var i=e.getValueRef(a),n=t.transformVec3(i);i.set(n.x,n.y,n.z)}this.setBoundingBoxDirty()};Object.defineProperty(e.prototype,"boundingBox",{get:function(){return this.__boundingBoxDirty&&this.updateBoundingBox(),this.__boundingBox},enumerable:true,configurable:true});e.prototype.setBoundingBoxDirty=function(){this.__boundingBoxDirty=!0,this.emit("boundingBoxChanged",{})};e.prototype.updateBoundingBox=function(){var t=this.vertices,e=new R,a=t.length;for(var i=0;i<a;i++)e.addPoint(t.getValueRef(i));this.__boundingBox=e,this.__boundingBoxDirty=!1};e.prototype.getMetadata=function(t){return this.__metaData.get(t)};e.prototype.hasMetadata=function(t){return this.__metaData.has(t)};e.prototype.setMetadata=function(t,e){this.__metaData.set(t,e)};e.prototype.deleteMetadata=function(t){this.__metaData.delete(t)};e.prototype.genBuffers=function(t){var e={};for(var a=0,i=this.__vertexAttributes;a<i.length;a++){var n=i[a],r=n[0],o=n[1];e[r]={values:o.data,count:o.size,dataType:o.dataType,normalized:o.normalized}}return{numVertices:this.numVertices(),attrBuffers:e}};e.prototype.freeBuffers=function(){};e.prototype.loadBaseGeomBinary=function(t){this.name=t.loadStr();var e=t.loadUInt8();this.debugColor=t.loadRGBFloat32Color();var a=t.loadUInt32();this.__boundingBox.set(t.loadFloat32Vec3(),t.loadFloat32Vec3()),this.setNumVertices(a);var i=this.vertices;var n,r;2&e&&(n=this.getVertexAttribute("normals"),n||(n=this.addVertexAttribute("normals",m,0))),4&e&&(r=this.getVertexAttribute("texCoords"),r||(r=this.addVertexAttribute("texCoords",h,0)));var o=function(t,e,a,n){for(var r=t[0];r<t[1];r++){var o=new m(n[3*r+0]/255,n[3*r+1]/255,n[3*r+2]/255);o.multiplyInPlace(a),o.addInPlace(e),i.setValue(r,o)}},l=function(t,e,a,i){a.isNull()&&a.set(1,1,1);for(var r=t[0];r<t[1];r++){var o=new m(i[3*r+0]/255,i[3*r+1]/255,i[3*r+2]/255);o.multiplyInPlace(a),o.addInPlace(e),o.normalizeInPlace(),n.setValue(r,o)}},s=function(t,e,a,i){for(var n=t[0];n<t[1];n++){var o=new h(i[2*n+0]/255,i[2*n+1]/255);o.multiplyInPlace(a),o.addInPlace(e),r.setValue(n,o)}},d=t.loadUInt32();if(1==d){{var c=this.__boundingBox,u=t.loadUInt8Array(3*a);o([0,a],c.p0,c.diagonal(),u)}if(n){var p=new R(t.loadFloat32Vec3(),t.loadFloat32Vec3()),f=t.loadUInt8Array(3*a);l([0,a],p.p0,p.diagonal(),f),n.loadSplitValues(t)}if(r){var b=new V(t.loadFloat32Vec2(),t.loadFloat32Vec2()),y=t.loadUInt8Array(2*a);s([0,a],b.p0,b.diagonal(),y),r.loadSplitValues(t)}}else{var g=[];var _=0;for(var Z=0;Z<d;Z++){var G=t.loadUInt32(),X={range:[_,_+G],bbox:new R(t.loadFloat32Vec3(),t.loadFloat32Vec3())};n&&(X.normalsRange=new R(t.loadFloat32Vec3(),t.loadFloat32Vec3())),r&&(X.texCoordsRange=new V(t.loadFloat32Vec2(),t.loadFloat32Vec2())),g.push(X),_+=G}var v=t.loadUInt8Array(3*a);var I=void 0,x;n&&(I=t.loadUInt8Array(3*a)),r&&(x=t.loadUInt8Array(2*a));for(var S=0;S<d;S++){{var W=g[S].bbox;o(g[S].range,W.p0,W.diagonal(),v)}if(n){var L=g[S].normalsRange;l(g[S].range,L.p0,L.diagonal(),I)}if(r){var T=g[S].texCoordsRange;s(g[S].range,T.p0,T.diagonal(),x)}}n&&n.loadSplitValues(t),r&&r.loadSplitValues(t)}};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);if(i||(i={}),i.type=K.getClassName(this),!(1024&a)){var n={};for(var r=0,o=this.__vertexAttributes.entries();r<o.length;r++){var l=o[r],s=l[0],d=l[1];n[s]=d.toJSON(e,a)}i.vertexAttributes=n}return i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i);for(var n in e.vertexAttributes){var r=this.__vertexAttributes.get(n);var o=e.vertexAttributes[n];if(!r){var l=u.getType(o.dataType);r=new VertexAttribute(this,l,0,o.defaultScalarValue),this.__vertexAttributes.set(n,r)}r.fromJSON(o)}};e.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return e}(D);var Se=function(t){__extends(e,t);function e(e,a,i,n){var r=this;r=t.call(this,a,i,n)||this,r.__geom=e,r.__splits={},r.__splitValues=[];return r}e.prototype.getFaceVertexValueRef=function(t,e){var a=this.__geom.getFaceVertexIndex(t,e);return a in this.__splits&&t in this.__splits[a]?this.__splitValues[this.__splits[a][t]]:this.getValueRef(a)};e.prototype.setFaceVertexValue=function(t,e,a){var i=this.__geom.getFaceVertexIndex(t,e);this.setFaceVertexValue_ByVertexIndex(t,i,a)};e.prototype.setFaceVertexValue_ByVertexIndex=function(t,e,a){var i=this.getValueRef(e);if(i.isValid())if(i.approxEqual(a));else{if(e in this.__splits){var n=this.__splits[e];for(var r in n){var o=n[r];if(this.__splitValues[o].approxEqual(a))return void(n[t]=o)}if(t in this.__splits[e]){return void this.__splitValues[this.__splits[e][t]].setFromOther(a)}}else this.__splits[e]={};this.__splits[e][t]=this.__splitValues.length,this.__splitValues.push(a)}else i.setFromOther(a)};e.prototype.setSplitVertexValue=function(t,e,a){if(t in this.__splits||(this.__splits[t]={}),e in this.__splits[t]){if(this.__splitValues[this.__splits[t][e]].approxEqual(a))return;console.warn("Face Vertex Already Split with different value")}this.__splits[t][e]=this.__splitValues.length,this.__splitValues.push(a)};e.prototype.setSplitVertexValues=function(t,e,a){t in this.__splits||(this.__splits[t]={});var i=this.__splitValues.length;this.__splitValues.push(a);for(var n=0,r=e;n<r.length;n++){var o=r[n];this.__splits[t][o]=i}};e.prototype.getSplits=function(){return this.__splits};e.prototype.getSplitCount=function(){var t=0;for(var e in this.__splits)t+=Object.keys(this.__splits[e]).length;return t};e.prototype.generateSplitValues=function(t,e){if(0==e)return this.__data;var a=this.length,i=this.length+e,n=this.__dataType.numElements?this.__dataType.numElements():1,r=new Float32Array(i*n);for(var o=0;o<this.__data.length;o++)r[o]=this.__data[o];for(var l in t){var s=t[l];for(var d in s){var c=a+s[d];if(l in this.__splits&&d in this.__splits[l]){var u=this.__splits[l][d];6==this.__dataType?r[c*n]=this.__splitValues[u]:this.__dataType.createFromFloat32Buffer(r.buffer,c*n).setFromOther(this.__splitValues[u])}else{var h=parseInt(l);for(var m=0;m<n;m++)h*n+m>this.__data.length&&console.log("Error remapping src:"+h*n+m),c*n+m>r.length&&console.log("Error remapping tgt:"+c*n+m),r[c*n+m]=this.__data[h*n+m]}}}return r};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return i.splits=this.__splits,i.splitValues=this.__splitValues,i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__splits=e.splits,this.__splitValues=[];for(var n=0,r=e.splitValues;n<r.length;n++){var o=r[n];this.__splitValues.push(this.__dataType.createFromJSON(o))}};e.prototype.loadSplitValues=function(t){var e=t.loadUInt32Array();if(0==e.length)return;var a=0,i=0;for(;;){var n=e[a++],r=e[a++],o={};for(var l=0;l<r;l++){var s=e[a++],d=e[a++];o[s]=d,d>=i&&(i=d+1)}if(this.__splits[n]=o,a>=e.length)break}var c=this.__numFloat32Elements,u=t.loadFloat32Array(i*c);this.__splitValues=[];for(var h=0;h<i;h++){var m=this.__dataType.createFromFloat32Array(u.slice(h*c,h*c+c));this.__splitValues.push(m)}};return e}(Re);var We=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.loadBin=function(t){this.name=t.loadStr();var e=t.loadUInt32();this.__boundingBox.set(t.loadFloat32Vec3(),t.loadFloat32Vec3()),this.setNumVertices(e);var a=this.vertices;if(e<256){var i=this.__boundingBox.toMat4(),n=t.loadUInt8Array(3*e);for(var r=0;r<e;r++){var o=new Vec3(n[3*r+0]/255,n[3*r+1]/255,n[3*r+2]/255);a.setValue(r,i.transformVec3(o))}}else{var l=t.loadUInt32(),n=[];for(var s=0;s<l;s++){var d=t.loadUInt32Vec2(),c=t.loadFloat32Vec3(),u=t.loadFloat32Vec3();n.push({range:d,bbox:new Box3(c,u)})}var h=t.loadUInt8Array(3*e);for(var m=0;m<l;m++){var p=n[m].bbox.toMat4();for(var f=n[m].range.x;f<n[m].range.y;f++){var b=new Vec3(h[3*f+0]/255,h[3*f+1]/255,h[3*f+2]/255);a.setValue(f,p.transformVec3(b))}}}};e.prototype.readBinary=function(e,a){t.prototype.loadBaseGeomBinary.call(this,e),this.emit("geomDataChanged",{})};return e}(xe);var Le=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__indices=new Uint32Array,e.__segmentAttributes=new Map,e.lineThickness=0;return e}e.prototype.getIndices=function(){return this.__indices};e.prototype.getNumSegments=function(){return this.__indices.length/2};e.prototype.setNumSegments=function(t){var e=new Uint32Array(2*t);this.__indices=e};e.prototype.setSegment=function(t,e,a){if(t>=this.__indices.length/2)throw new Error("Invalid line index:"+t+". Num Segments:"+this.__indices.length/2);this.__indices[2*t+0]=e,this.__indices[2*t+1]=a};e.prototype.getSegmentVertexIndex=function(t,e){if(t<this.numLines)return this.__indices[2*t+e]};e.prototype.addSegmentAttribute=function(t,e,a){var i=new Attribute(e,null!=a?a:this.polygonCount);return this.__segmentAttributes.set(t,i),i};e.prototype.hasSegmentAttribute=function(t){return this.__segmentAttributes.has(t)};e.prototype.getSegmentAttribute=function(t){return this.__segmentAttributes.get(t)};e.prototype.genBuffers=function(){var e=t.prototype.genBuffers.call(this);var a;return e.numVertices<Math.pow(2,8)?(a=new Uint8Array(this.__indices.length),this.__indices.forEach((function(t,e){a[e]=t}))):e.numVertices<Math.pow(2,16)?(a=new Uint16Array(this.__indices.length),this.__indices.forEach((function(t,e){a[e]=t}))):a=this.__indices,e.indices=a,e};e.prototype.readBinary=function(e,a){t.prototype.loadBaseGeomBinary.call(this,e),this.setNumSegments(e.loadUInt32());var i=e.loadUInt8();1==i?this.__indices=e.loadUInt8Array():2==i?this.__indices=e.loadUInt16Array():4==i&&(this.__indices=e.loadUInt32Array()),this.geomDataChanged.emit()};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return 1024&a||(i.indices=Array.from(this.__indices)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__indices=Uint32Array.from(e.indices)};return e}(xe);var Te=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.init();return e}e.prototype.init=function(){this.__faceCounts=[],this.__faceVertexCounts=new Uint8Array,this.__faceOffsets=new Uint32Array,this.__faceVertexIndices=new Uint32Array,this.__numPopulatedFaceVertexIndices=0,this.__faceAttributes=new Map,this.__edgeAttributes=new Map,this.__logTopologyWarnings=!1,this.edgeVerts=void 0,this.vertexEdges=void 0,this.numEdges=0,this.edgeFlags=new Uint32Array,this.edgeAngles=new Float32Array};e.prototype.getFaceVertexIndices=function(){return this.__faceVertexIndices};e.prototype.getFaceCounts=function(){return this.__faceCounts};e.prototype.clear=function(){this.__faceVertexIndices=void 0,this.__faceCounts=[],this.__numPopulatedFaceVertexIndices=0};e.prototype.setFaceCounts=function(t){if(this.__numPopulatedFaceVertexIndices)throw new Error("Cannot set face counts on a mesh that is already populated. Please call 'clear' before re-building the mesh.");this.__faceCounts=t;var e=0,a=0,i=3;for(var n=0,r=this.__faceCounts;n<r.length;n++){var o=r[n];e+=o,a+=o*i,i++}this.__faceVertexCounts=new Uint8Array(e),this.__faceOffsets=new Uint32Array(e),this.__faceVertexIndices=new Uint32Array(a);for(var l=0,s=this.__faceAttributes;l<s.length;l++){var d=s[l];d.resize(e)}};e.prototype.setFaceVertexIndices=function(t){var e=Array.prototype.slice.call(arguments,1),a=this.__numPopulatedFaceVertexIndices;for(var i=0;i<e.length;i++)this.__faceVertexIndices[a+i]=e[i];this.__faceVertexCounts[t]=e.length-3,this.__faceOffsets[t]=a,this.__numPopulatedFaceVertexIndices+=e.length};e.prototype.getFaceVertexIndices=function(t){var e=[],a=this.__faceOffsets[t],i=this.__faceVertexCounts[t]+3;for(var n=0;n<i;n++)e.push(this.__faceVertexIndices[a+n]);return e};e.prototype.getFaceVertexIndex=function(t,e){var a=this.__faceOffsets[t];return this.__faceVertexIndices[a+e]};e.prototype.getNumFaces=function(){return this.__faceVertexCounts.length};e.prototype.addVertexAttribute=function(t,e,a){var i=new Se(this,e,null!=this.vertices?this.vertices.length:0,a);return this.__vertexAttributes.set(t,i),i};e.prototype.addFaceAttribute=function(t,e,a){var i=new Re(e,null!=a?a:this.getNumFaces());return this.__faceAttributes.set(t,i),i};e.prototype.hasFaceAttribute=function(t){return this.__faceAttributes.has(t)};e.prototype.getFaceAttribute=function(t){return this.__faceAttributes.get(t)};e.prototype.addEdgeAttribute=function(t,e,a){var i=new Re(e,null!=a?a:this.getNumEdges());return this.__edgeAttributes.set(t,i),i};e.prototype.hasEdgeAttribute=function(t){return this.__edgeAttributes.has(t)};e.prototype.getEdgeAttribute=function(t){return this.__edgeAttributes.get(t)};e.prototype.genTopologyInfo=function(){var t=this;var e={};this.vertexEdges=[],this.edgeFaces=[],this.edgeVerts=[],this.faceEdges=[],this.numEdges=0;var a=function(a,i){var n=a,r=i;if(r<n){var o=n;n=r,r=o}var l=n+">"+r;if(l in e)return e[l];var s=t.vertices.getValueRef(n),d=t.vertices.getValueRef(r).subtract(s),c={edgeIndex:t.edgeFaces.length/2,edgeVec:d};return e[l]=c,t.edgeFaces.push(-1),t.edgeFaces.push(-1),t.edgeVerts.push(n),t.edgeVerts.push(r),t.numEdges++,c},i=function(e,i,n){var r=a(e,i).edgeIndex;if(i<e){var o=2*r+0;t.__logTopologyWarnings&&-1!=t.edgeFaces[o]&&console.warn("Edge poly 0 already set. Mesh is non-manifold."),t.edgeFaces[o]=n}else{var l=2*r+1;t.__logTopologyWarnings&&-1!=t.edgeFaces[l]&&console.warn("Edge poly 1 already set. Mesh is non-manifold."),t.edgeFaces[l]=n}n in t.faceEdges||(t.faceEdges[n]=[]),t.faceEdges[n].push(r),null==t.vertexEdges[e]&&(t.vertexEdges[e]=new Set),null==t.vertexEdges[i]&&(t.vertexEdges[i]=new Set),t.vertexEdges[e].add(r),t.vertexEdges[i].add(r)},n=this.getNumFaces();for(var r=0;r<n;r++){var o=this.getFaceVertexIndices(r);for(var l=0;l<o.length;l++){i(o[l],o[(l+1)%o.length],r)}}};e.prototype.computeFaceNormals=function(){var t=this.vertices,e=this.addFaceAttribute("normals",m),a=this.getNumFaces();for(var i=0;i<a;i++){var n=this.getFaceVertexIndices(i),r=t.getValueRef(n[0]);var o=t.getValueRef(n[1]);var l=new m;for(var s=2;s<n.length;s++){var d=t.getValueRef(n[s]),c=o.subtract(r),u=d.subtract(r);l.addInPlace(c.cross(u).normalize()),o=d}l.lengthSquared(),e.setValue(i,l.normalize())}};e.prototype.generateEdgeFlags=function(){null==this.vertexEdges&&this.genTopologyInfo(),this.hasFaceAttribute("normals")||this.computeFaceNormals();var t=this.vertices,e=this.getFaceAttribute("normals");this.edgeVecs=[],this.edgeAngles=new Float32Array(this.numEdges);for(var a=0;a<this.edgeFaces.length;a+=2){var i=this.edgeVerts[a],n=this.edgeVerts[a+1],r=t.getValueRef(n).subtract(t.getValueRef(i));r.normalizeInPlace(),this.edgeVecs.push(r);var o=this.edgeFaces[a],l=this.edgeFaces[a+1];if(-1==o||-1==l){this.edgeAngles[a/2]=2*Math.PI;continue}var s=e.getValueRef(o),d=e.getValueRef(l);this.edgeAngles[a/2]=s.angleTo(d)}};e.prototype.computeVertexNormals=function(t){var e=this;if(t===void 0){t=1}this.generateEdgeFlags();var a=this.getFaceAttribute("normals"),i=this.addVertexAttribute("normals",m),n=a.data.buffer,r=function(t){return new m(n,12*t)},o=i.data,l=function(t,e){o[3*t+0]=e.x,o[3*t+1]=e.y,o[3*t+2]=e.z},s=function(t,a){var i,n;var r=e.faceEdges[t];for(var o=0,l=r;o<l.length;o++){var s=l[o];(e.edgeVerts[2*s]==a||e.edgeVerts[2*s+1]==a)&&(i?n=e.edgeVecs[s]:i=e.edgeVecs[s])}return[i,n]};var d=function(e){if(null==c.vertexEdges[e])return"continue";var a=c.vertexEdges[e],n=[],o=function(t){var e=!1;for(var a=0,i=n;a<i.length;a++){var r=i[a];if(e=-1!=r.indexOf(t),e)break}e||n.push([t])};for(var d=0,u=a;d<u.length;d++){var h=u[d];var p=c.edgeFaces[2*h],f=c.edgeFaces[2*h+1];if(-1!=p&&-1==f&&c.edgeAngles[h]<t){var b=-1,y=-1;for(var g=0;g<n.length;g++)-1==b&&-1!=n[g].indexOf(p)&&(b=g),-1==y&&-1!=n[g].indexOf(f)&&(y=g);-1==b&&-1==y?n.push([p,f]):-1!=b&&-1!=y?b!=y&&(n[b]=n[b].concat(n[y]),n.splice(y,1)):(-1==b&&n[y].push(p),-1==y&&n[b].push(f))}else-1!=p&&o(p),-1!=f&&o(f)}n.sort((function(t,e){return t.length<e.length?1:t.length>e.length?-1:0}));var _=!0;for(var Z=0,G=n;Z<G.length;Z++){var X=G[Z];var v=new m;for(var V=0,I=X;V<I.length;V++){var R=I[V];var x=s(R,e),S=x[0].angleTo(x[1]);v.addInPlace(r(R).scale(S))}v.normalizeInPlace(),_?(l(e,v),_=!1):i.setSplitVertexValues(e,X,v)}};var c=this;for(var u=0;u<this.vertexEdges.length;u++){d(u)}return i};e.prototype.computeNumTriangles=function(){var t=3,e=0;for(var a=0,i=this.__faceCounts;a<i.length;a++){var n=i[a];e+=n*(t-2),t++}return e};e.prototype.generateTriangulatedIndices=function(t,e,a){var i=this.computeNumTriangles();var n;n=t<Math.pow(2,8)?new Uint8Array(3*i):t<Math.pow(2,16)?new Uint16Array(3*i):new Uint32Array(3*i);var r=0;var o=function(t,i){t in a&&i in a[t]&&(t=e+a[t][i]),n[r]=t,r++},l=this.getNumFaces();for(var s=0;s<l;s++){var d=this.getFaceVertexIndices(s);for(var c=0;c<d.length;c++)c>=3&&(o(d[0],s),o(d[c-1],s)),o(d[c],s)}return n};e.prototype.computeHardEdgesIndices=function(t){var e=this;if(t===void 0){t=1}var a=[],i=function(t){a.push(e.edgeVerts[t]),a.push(e.edgeVerts[t+1])};for(var n=0;n<this.edgeFlags.length;n+=2)this.edgeAngles[n/2]>t&&i(n);return a};e.prototype.getWireframeIndices=function(){return indices};e.prototype.genBuffers=function(t){var e={};var a=0;for(var i=0,n=this.__vertexAttributes;i<n.length;i++){var r=n[i],o=r[1];var l=o.getSplits();for(var s in l){s in e||(e[s]={});var d=l[s];for(var c in d){var u=parseInt(c);u in e[s]||(e[s][u]=a,a++)}}}var h=this.vertices.length,m=h+a;var p;t&&0==t.includeIndices||(p=this.generateTriangulatedIndices(m,h,e));var f={};for(var b=0,y=this.__vertexAttributes;b<y.length;b++){var g=y[b],_=g[0],Z=g[1];var G=void 0;G=0==a?Z.data:Z.generateSplitValues(e,a);var X=Z.numElements,v=G.length/X;f[_]={values:G,count:v,dimension:X,normalized:"normals"==_,dataType:Z.dataType}}var V={numVertices:this.numVertices(),numRenderVerts:m,indices:p,attrBuffers:f};if(t&&t.includeVertexNeighbors){null==this.vertexEdges&&this.genTopologyInfo();var I=0;for(var R=0;R<this.vertexEdges.length;R++)this.vertexEdges[R]&&(I+=this.vertexEdges[R].size);var x=new Uint32Array(2*this.vertexEdges.length+I),S=function(t){for(var e=0;e<t.length;e++){var a=t[e];for(var i=0;i<e;i++){var n=t[i];if(-1!=a[0]&&a[0]==n[1]){e!=i+1&&(t.splice(e,1),t.splice(i+1,0,a));break}if(-1!=a[1]&&a[1]==n[0]){t.splice(e,1),t.splice(i,0,a);break}}}},W=function(t){if(!(-1!=t[0][0]&&-1!=t[t.length-1][1]||-1==t[0][0]&&-1==t[t.length-1][1]))throw new Error("If fan starts with -1, it must also end with -1");for(var e=0;e<t.length;e++){var a=t[e];if((-1==a[0]||-1==a[1])&&0!=e&&e!=t.length-1)throw new Error("-1 only allowed at the beginning and end of a fan.");if(-1!=a[0]){var i=e-1;if(i<0&&(i+=t.length),a[0]!=t[i][1])throw new Error("Faces are not sequential")}if(-1!=a[1]){var n=(e+1)%t.length;if(a[1]!=t[n][0])throw new Error("Faces are not sequential")}}};var L=2*this.vertexEdges.length;for(var T=0;T<this.vertexEdges.length;T++){if(null==this.vertexEdges[T])continue;var M=this.vertexEdges[T],F=[];for(var C=0,N=M;C<N.length;C++){var Y=N[C];var K=this.edgeVerts[2*Y],w=this.edgeVerts[2*Y+1];var z=void 0,U=this.edgeFaces[2*Y],J=this.edgeFaces[2*Y+1];if(K==T)z=w;else{if(w!=T)throw new Error("Invalid topology");{z=K;var P=U;U=J,J=P}}F.push([U,J,z])}S(F),W(F);var E=0;(-1!=F[0][0]||-1!=F[F.length-1][1])&&(E+=1),x[2*T]=L,x[2*T+1]=M.size+(E<<8);for(var H=0,k=F;H<k.length;H++){var B=k[H];x[L]=B[2],L++}}V.vertexNeighbors=x}return V};e.prototype.freeBuffers=function(){t.prototype.freeBuffers.call(this),this.init()};e.prototype.readBinary=function(e,a){t.prototype.loadBaseGeomBinary.call(this,e),this.setFaceCounts(e.loadUInt32Array()),this.__faceVertexCounts=e.loadUInt8Array(this.__faceVertexCounts.length);var i=e.loadSInt32Vec2(),n=e.loadUInt8();var r;1==n?r=e.loadUInt8Array():2==n?r=e.loadUInt16Array():4==n&&(r=e.loadUInt32Array());var o=this.getNumFaces();var l=0,s=0;for(var d=0;d<o;d++){var c=this.__faceVertexCounts[d]+3;this.__faceOffsets[d]=l;for(var u=0;u<c;u++){var m=l+u,p=r[m]+i.x;if(0==d)this.__faceVertexIndices[m]=p;else{var f=this.__faceOffsets[d-1];f+=u<s?u:s-1,this.__faceVertexIndices[m]=this.__faceVertexIndices[f]+p}}l+=c,s=c}this.__numPopulatedFaceVertexIndices=l;var b=e.loadUInt32();if(b>0){var y=this.vertices,g=this.addVertexAttribute("lightmapCoords",h);for(var _=0;_<b;_++){var Z=new v(e.loadFloat32Vec3(),e.loadFloat32Quat()),G=e.loadFloat32(),X=e.loadFloat32Vec2(),V=e.loadSInt32Vec2(),I=e.loadUInt8();var R=void 0;R=1==I?e.loadUInt8Array():2==I?e.loadUInt16Array():e.loadUInt32Array();var x=0;for(var S=0,W=R;S<W.length;S++){var L=W[S];var T=L+V.x;T+=x,x=T;var M=this.getFaceVertexIndices(T);for(var F=0,C=M;F<C.length;F++){var N=C[F];var Y=y.getValueRef(N),K=Z.transformVec3(Y),w=new h(K.x,K.z);w.scaleInPlace(G),w.addInPlace(X),g.setFaceVertexValue_ByVertexIndex(T,N,w)}}}}this.hasVertexAttribute("normals")||this.computeVertexNormals(),this.emit("geomDataChanged",{})};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return 1024&a||(i.faceCounts=Array.from(this.__faceCounts),i.faceVertexIndices=Array.from(this.__faceVertexIndices)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.faceCounts&&(this.__faceCounts=Uint32Array.from(e.faceCounts)),e.faceVertexIndices&&(this.__faceVertexIndices=Uint32Array.from(e.faceVertexIndices))};return e}(xe);var Me=function(t){__extends(e,t);function e(e){var a=this;if(a=t.call(this)||this,a.name=e.name,a.__buffers=e.geomBuffers,a.__buffers.attrBuffers)for(var i in a.__buffers.attrBuffers){var n=a.__buffers.attrBuffers[i],r=u.getType(n.dataType);n.dataType=r}a.boundingBox=new R,a.boundingBox.p0.__data=e.bbox.p0.__data,a.boundingBox.p1.__data=e.bbox.p1.__data,a.__metaData=new Map;return a}e.prototype.genBuffers=function(){return this.__buffers};e.prototype.freeBuffers=function(){if(this.__buffers.indices&&delete this.__buffers.indices,this.__buffers.attrBuffers){for(var t in this.__buffers.attrBuffers){delete this.__buffers.attrBuffers[t]}delete this.__buffers.attrBuffers}};e.prototype.getMetadata=function(t){return this.__metaData.get(t)};e.prototype.hasMetadata=function(t){return this.__metaData.has(t)};e.prototype.setMetadata=function(t,e){this.__metaData.set(t,e)};return e}(Y);var Fe=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}return e}(Me);var Ce=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}return e}(Me);var Ne=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}return e}(Me);var Ye=function(t){__extends(e,t);function e(e,a,i,n,r){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=1}if(r===void 0){r=!1}var o=this;if(o=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");o.__x=e,o.__y=a,o.__xDivisions=i,o.__yDivisions=n,r&&o.addVertexAttribute("texCoords",h),o.__rebuild();return o}Object.defineProperty(e.prototype,"x",{get:function(){return console.warn("getter is deprectated. Please use 'getX'"),this.getX()},set:function(t){console.warn("getter is deprectated. Please use 'setX'"),this.setX(t)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return console.warn("getter is deprectated. Please use 'getY'"),this.getY()},set:function(t){console.warn("getter is deprectated. Please use 'setY'"),this.setY(t)},enumerable:true,configurable:true});e.prototype.getX=function(){return this.__x};e.prototype.setX=function(t){this.__x=t,this.__resize()};e.prototype.getY=function(){return this.__y};e.prototype.setY=function(t){this.__y=t,this.__resize()};e.prototype.setSize=function(t,e){this.__x=t,this.__y=e,this.__resize()};e.prototype.__rebuild=function(){this.setNumVertices(this.__xDivisions*this.__yDivisions);var t=this.getVertexAttribute("texCoords");if(t)for(var e=0;e<this.__yDivisions;e++){var a=e/(this.__yDivisions-1);for(var i=0;i<this.__xDivisions;i++){var n=i/(this.__xDivisions-1);t.getValueRef(e*this.__xDivisions+i).set(n,a)}}this.__resize()};e.prototype.__resize=function(){for(var t=0;t<this.__yDivisions;t++){var e=(t/(this.__yDivisions-1)-.5)*this.__y;for(var a=0;a<this.__xDivisions;a++){var i=(a/(this.__xDivisions-1)-.5)*this.__x;this.getVertex(t*this.__xDivisions+a).set(i,e,0)}}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e.xDivisions=this.__xDivisions,e.yDivisions=this.__yDivisions,e};return e}(We);var Ke=function(t){__extends(e,t);function e(e,a){if(e===void 0){e=1}if(a===void 0){a=1}var i=this;if(i=t.call(this)||this,isNaN(e)||isNaN(a))throw new Error("Invalid geom args");i.__x=i.addParameter(new ft("x",e)),i.__x.addListener("valueChanged",i.__resize.bind(i)),i.__y=i.addParameter(new ft("y",a)),i.__y.addListener("valueChanged",i.__resize.bind(i)),i.__rebuild();return i}Object.defineProperty(e.prototype,"x",{get:function(){return this.__x.getValue()},set:function(t){this.__x.setValue(t)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__y.getValue()},set:function(t){this.__y.setValue(t)},enumerable:true,configurable:true});e.prototype.setSize=function(t,e){this.__x.setValue(t,-1),this.__y.setValue(e,-1),this.__resize()};e.prototype.__rebuild=function(){this.setNumVertices(4),this.setNumSegments(4),this.setSegment(0,0,1),this.setSegment(1,1,2),this.setSegment(2,2,3),this.setSegment(3,3,0),this.__resize(-1),this.emit("geomDataTopologyChanged",{})};e.prototype.__resize=function(t){var e=this.__x.getValue(),a=this.__y.getValue();this.getVertex(0).set(-.5*e,-.5*a,0),this.getVertex(1).set(.5*e,-.5*a,0),this.getVertex(2).set(.5*e,.5*a,0),this.getVertex(3).set(-.5*e,.5*a,0),this.setBoundingBoxDirty(),-1!=t&&this.emit("geomDataChanged",{})};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e};return e}(Le);K.registerClass("Rect",Ke);var we=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=1}if(a===void 0){a=32}if(i===void 0){i=2*Math.PI}var n=this;if(n=t.call(this)||this,isNaN(e)||isNaN(a))throw new Error("Invalid geom args");n.__radius=n.addParameter(new ft("Radius",e)),n.__angle=n.addParameter(new ft("Angle",i)),n.__numSegments=n.addParameter(new ft("NumSegments",a>=3?a:3,[3,200],1));var r=function(){n.__rebuild()};n.__radius.addListener("valueChanged",(function(){n.__resize()})),n.__angle.addListener("valueChanged",r),n.__numSegments.addListener("valueChanged",r),n.__rebuild();return n}e.prototype.__rebuild=function(){var t=this.__numSegments.getValue();this.setNumVertices(t);var e=this.__angle.getValue()<2*Math.PI;e?this.setNumSegments(t-1):this.setNumSegments(t);for(var a=0;a<(e?t-1:t);a++)this.setSegment(a,a,(a+1)%t);this.__resize(-1),this.emit("geomDataTopologyChanged",{})};e.prototype.__resize=function(t){var e=this.__radius.getValue(),a=this.__numSegments.getValue(),i=this.__angle.getValue()/a;for(var n=0;n<a;n++)this.getVertex(n).set(Math.cos(i*n)*e,Math.sin(i*n)*e,0);this.setBoundingBoxDirty(),-1!=t&&this.emit("geomDataChanged",{})};return e}(Le);K.registerClass("Circle",we);var ze=function(t){__extends(e,t);function e(e){if(e===void 0){e=1}var a=this;if(a=t.call(this)||this,isNaN(e))throw new Error("Invalid geom args");a.__sizeParam=a.addParameter(new ft("size",e)),a.__rebuild();a.__sizeParam.addListener("valueChanged",(function(){a.__resize()}));return a}Object.defineProperty(e.prototype,"size",{get:function(){return this.__size},set:function(t){this.__size=t,this.__resize()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){this.setNumVertices(6),this.setNumSegments(3),this.setSegment(0,0,1),this.setSegment(1,2,3),this.setSegment(2,4,5),this.__resize()};e.prototype.__resize=function(){var t=this.__sizeParam.getValue();this.getVertex(0).set(-.5*t,0,0),this.getVertex(1).set(.5*t,0,0),this.getVertex(2).set(0,.5*t,0),this.getVertex(3).set(0,-.5*t,0),this.getVertex(4).set(0,0,.5*t),this.getVertex(5).set(0,0,-.5*t),this.setBoundingBoxDirty()};return e}(Le);K.registerClass("Cross",ze);var Ue=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=!1}var r=this;r=t.call(this)||this,r.__x=r.addParameter(new ft("x",e)),r.__y=r.addParameter(new ft("y",a)),r.__z=r.addParameter(new ft("z",i)),r.__baseZAtZero=r.addParameter(new ft("BaseZAtZero",n)),r.__rebuild();var o=function(){r.__resize()};r.__x.addListener("valueChanged",o),r.__y.addListener("valueChanged",o),r.__z.addListener("valueChanged",o),r.__baseZAtZero.addListener("valueChanged",(function(){r.__rebuild()}));return r}e.prototype.__rebuild=function(){this.setNumVertices(8),this.setNumSegments(12),this.setSegment(0,0,1),this.setSegment(1,1,2),this.setSegment(2,2,3),this.setSegment(3,3,0),this.setSegment(4,4,5),this.setSegment(5,5,6),this.setSegment(6,6,7),this.setSegment(7,7,4),this.setSegment(8,0,4),this.setSegment(9,1,5),this.setSegment(10,2,6),this.setSegment(11,3,7),this.__resize(-1),this.emit("geomDataTopologyChanged",{})};e.prototype.__resize=function(t){var e=this.__x.getValue(),a=this.__y.getValue(),i=this.__z.getValue(),n=this.__baseZAtZero.getValue();var r=.5;n&&(r=1),this.getVertex(0).set(.5*e,-.5*a,r*i),this.getVertex(1).set(.5*e,.5*a,r*i),this.getVertex(2).set(-.5*e,.5*a,r*i),this.getVertex(3).set(-.5*e,-.5*a,r*i),r=-.5,n&&(r=0),this.getVertex(4).set(.5*e,-.5*a,r*i),this.getVertex(5).set(.5*e,.5*a,r*i),this.getVertex(6).set(-.5*e,.5*a,r*i),this.getVertex(7).set(-.5*e,-.5*a,r*i),this.setBoundingBoxDirty(),-1!=t&&this.emit("geomDataChanged",{})};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.size=this.__size,e};return e}(Le);K.registerClass("LinesCuboid",Ue);var Je=function(t){__extends(e,t);function e(e,a,i,n,r){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=10}if(n===void 0){n=10}if(r===void 0){r=!1}var o=this;if(o=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");o.__xParam=o.addParameter(new ft("x",e)),o.__yParam=o.addParameter(new ft("y",a)),o.__xDivisionsParam=o.addParameter(new ft("xDivisions",i)),o.__yDivisionsParam=o.addParameter(new ft("yDivisions",n)),o.__skipCenterLinesParam=o.addParameter(new yt("skipCenterLines",r)),o.__rebuild();return o}Object.defineProperty(e.prototype,"sizeX",{get:function(){return this.__x},set:function(t){this.__x=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sizeY",{get:function(){return this.__y},set:function(t){this.__y=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"divisionsX",{get:function(){return this.__xDivisions},set:function(t){this.__xDivisions=t,this.__rebuild()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"divisionsY",{get:function(){return this.__yDivisions},set:function(t){this.__yDivisions=t,this.__rebuild()},enumerable:true,configurable:true});e.prototype.setSize=function(t,e){this.__x=t,this.__y=e,this.__resize()};e.prototype.__rebuild=function(){var t=this.__xDivisionsParam.getValue(),e=this.__yDivisionsParam.getValue(),a=this.__skipCenterLinesParam.getValue()&&t%2==0&&e%2==0;this.setNumVertices(2*(t+e+2-(a?1:0))),this.setNumSegments(t+e+2-(a?1:0));var i=0;for(var n=0;n<=t;n++){if(a&&n==t/2)continue;var r=2*i,o=2*i+1;this.setSegment(i,r,o),i++}for(var r=0;r<=e;r++){if(a&&r==t/2)continue;var l=2*i,o=2*i+1;this.setSegment(i,l,o),i++}this.__resize()};e.prototype.__resize=function(){var t=this.__xDivisionsParam.getValue(),e=this.__yDivisionsParam.getValue(),a=this.__xParam.getValue(),i=this.__yParam.getValue(),n=this.__skipCenterLinesParam.getValue()&&t%2==0&&e%2==0;var r=0;for(var o=0;o<=t;o++){if(n&&o==t/2)continue;var l=2*r,s=2*r+1,d=(o/t-.5)*a;this.getVertex(l).set(d,-.5*i,0),this.getVertex(s).set(d,.5*i,0),r++}for(var l=0;l<=e;l++){if(n&&l==t/2)continue;var s=2*r,d=2*r+1,c=(l/e-.5)*i;this.getVertex(s).set(-.5*a,c,0),this.getVertex(d).set(.5*a,c,0),r++}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.z=this.__y,e.xDivisions=this.__xDivisions,e.yDivisions=this.__yDivisions,e};return e}(Le);K.registerClass("Grid",Je);var Pe=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=.5}if(a===void 0){a=1}if(i===void 0){i=32}if(n===void 0){n=!0}var r=this;if(r=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");r.__radiusParam=r.addParameter(new ft("radius",e)),r.__heightParam=r.addParameter(new ft("height",a)),r.__detailParam=r.addParameter(new ft("detail",i>=3?i:3,[3,200],1)),r.__capParam=r.addParameter(new yt("cap",n)),r.addVertexAttribute("texCoords",h),r.addVertexAttribute("normals",m),r.__rebuild();var o=function(){r.__resize()},l=function(){r.__rebuild()};r.__radiusParam.addListener("valueChanged",o),r.__heightParam.addListener("valueChanged",o),r.__detailParam.addListener("valueChanged",l),r.__capParam.addListener("valueChanged",l);return r}Object.defineProperty(e.prototype,"radius",{get:function(){return this.__radiusParam.getValue()},set:function(t){this.__radiusParam.setValue(t),this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this.__heightParam.getValue()},set:function(t){this.__heightParam.setValue(t),this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"detail",{get:function(){return this.__detailParam.getValue()},set:function(t){this.__detailParam.setValue(t),this.__rebuild()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cap",{get:function(){return this.__capParam.getValue()},set:function(t){this.__capParam.setValue(t),this.__rebuild()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){this.clear();var t=this.__detailParam.getValue(),e=this.__radiusParam.getValue(),a=this.__heightParam.getValue(),i=this.__capParam.getValue();var n=t+1;i&&(n+=1),this.setNumVertices(n);var r=t,o=t+1;this.getVertex(r).set(0,0,a);for(var l=0;l<t;l++){var s=l/t*2*Math.PI;this.getVertex(l).set(e*Math.cos(s),e*Math.sin(s),0)}i&&this.getVertex(o).set(0,0,0),this.setFaceCounts([t+(i?t:0)]);for(var d=0;d<t;d++){var c=(d+1)%t;this.setFaceVertexIndices(d,c,d,r)}if(i)for(var u=0;u<t;u++){var p=(u+1)%t;this.setFaceVertexIndices(t+u,u,p,o)}var f=this.getVertexAttribute("normals");var b;var y=a;Math.abs(a)<1e-12&&(b=a<0?-1e-12:1e-12),b=e/y;var g=0;for(var _=0;_<t;_++){var Z=(_+1)/t*2*Math.PI,G=_/t*2*Math.PI,X=.5*(Z+G);f.setFaceVertexValue(g,0,new m(Math.cos(Z),b,Math.sin(Z)).normalize()),f.setFaceVertexValue(g,1,new m(Math.cos(G),b,Math.sin(G)).normalize()),f.setFaceVertexValue(g,2,new m(Math.cos(X),b,Math.sin(X)).normalize()),g++}if(i){var v=new m(0,-1,0);for(var V=0;V<t;V++)f.setFaceVertexValue(g,0,v),f.setFaceVertexValue(g,1,v),f.setFaceVertexValue(g,2,v),g++}var I=this.getVertexAttribute("texCoords");g=0;for(var R=0;R<t;R++)I.setFaceVertexValue(g,0,new h((R+1)/t,0)),I.setFaceVertexValue(g,1,new h(R/t,0)),I.setFaceVertexValue(g,2,new h((R+.5)/t,1));if(i)for(var x=0;x<t;x++)I.setFaceVertexValue(g,0,new h(x/t,0)),I.setFaceVertexValue(g,1,new h((x+1)/t,0)),I.setFaceVertexValue(g,2,new h((x+.5)/t,1)),g++;this.setBoundingBoxDirty()};e.prototype.__resize=function(){var t=this.__detailParam.getValue(),e=this.__radiusParam.getValue(),a=this.__heightParam.getValue(),i=(this.__capParam.getValue(),t),n=t+1;this.getVertex(i).set(0,0,a);for(var r=0;r<t;r++){var o=r/t*2*Math.PI;this.getVertex(r).set(e*Math.cos(o),e*Math.sin(o),0)}this.__cap&&this.getVertex(n).set(0,0,0),this.setBoundingBoxDirty()};return e}(Te);K.registerClass("Cone",Pe);var Ee=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=!1}var r=this;if(r=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");r.__xParam=r.addParameter(new ft("x",e)),r.__yParam=r.addParameter(new ft("y",a)),r.__zParam=r.addParameter(new ft("z",i)),r.__baseZAtZeroParam=r.addParameter(new yt("baseZAtZero",n)),r.setFaceCounts([0,6]),r.setFaceVertexIndices(0,0,1,2,3),r.setFaceVertexIndices(1,7,6,5,4),r.setFaceVertexIndices(2,1,0,4,5),r.setFaceVertexIndices(3,3,2,6,7),r.setFaceVertexIndices(4,0,3,7,4),r.setFaceVertexIndices(5,2,1,5,6),r.setNumVertices(8),r.addVertexAttribute("texCoords",h),r.addVertexAttribute("normals",m),r.__rebuild();var o=function(){r.__resize()};r.__xParam.addListener("valueChanged",o),r.__yParam.addListener("valueChanged",o),r.__zParam.addListener("valueChanged",o),r.__baseZAtZeroParam.addListener("valueChanged",o);return r}e.prototype.setSize=function(t,e,a){this.__xParam.setValue(t),this.__yParam.setValue(e),this.__zParam.setValue(a)};e.prototype.setBaseSize=function(t,e){this.__xParam.setValue(t),this.__yParam.setValue(e)};e.prototype.__rebuild=function(){var t=this.getVertexAttribute("normals");for(var e=0;e<6;e++){var a=void 0;switch(e){case 0:a=new m(0,0,1);break;case 1:a=new m(0,0,-1);break;case 2:a=new m(1,0,0);break;case 3:a=new m(-1,0,0);break;case 4:a=new m(0,1,0);break;case 5:a=new m(0,-1,0)}t.setFaceVertexValue(e,0,a),t.setFaceVertexValue(e,1,a),t.setFaceVertexValue(e,2,a),t.setFaceVertexValue(e,3,a)}var i=this.getVertexAttribute("texCoords");for(var n=0;n<6;n++)i.setFaceVertexValue(n,0,new h(0,0)),i.setFaceVertexValue(n,1,new h(1,0)),i.setFaceVertexValue(n,2,new h(1,1)),i.setFaceVertexValue(n,3,new h(0,1));this.__resize()};e.prototype.__resize=function(t){var e=this.__xParam.getValue(),a=this.__yParam.getValue(),i=this.__zParam.getValue(),n=this.__baseZAtZeroParam.getValue();var r=.5;n&&(r=1),this.getVertex(0).set(.5*e,-.5*a,r*i),this.getVertex(1).set(.5*e,.5*a,r*i),this.getVertex(2).set(-.5*e,.5*a,r*i),this.getVertex(3).set(-.5*e,-.5*a,r*i),r=-.5,n&&(r=0),this.getVertex(4).set(.5*e,-.5*a,r*i),this.getVertex(5).set(.5*e,.5*a,r*i),this.getVertex(6).set(-.5*e,.5*a,r*i),this.getVertex(7).set(-.5*e,-.5*a,r*i),this.setBoundingBoxDirty(),this.emit("geomDataChanged",{})};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e.z=this.__z,e};return e}(Te);K.registerClass("Cuboid",Ee);var He=function(t){__extends(e,t);function e(e,a,i,n,r,o){if(e===void 0){e=.5}if(a===void 0){a=1}if(i===void 0){i=32}if(n===void 0){n=2}if(r===void 0){r=!0}if(o===void 0){o=!1}var l=this;if(l=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");l.__radiusParam=l.addParameter(new ft("radius",e)),l.__heightParam=l.addParameter(new ft("height",a)),l.__sidesParam=l.addParameter(new ft("sides",i>=3?i:3,[3,200],1)),l.__loopsParam=l.addParameter(new ft("loops",n>=2?n:2,[1,200],1)),l.__capsParam=l.addParameter(new yt("caps",r)),l.__baseZAtZeroParam=l.addParameter(new yt("baseZAtZero",o)),l.addVertexAttribute("texCoords",h),l.addVertexAttribute("normals",m),l.__rebuild();var s=function(){l.__resize()},d=function(){l.__rebuild()};l.__radiusParam.addListener("valueChanged",s),l.__heightParam.addListener("valueChanged",s),l.__sidesParam.addListener("valueChanged",d),l.__loopsParam.addListener("valueChanged",d),l.__capsParam.addListener("valueChanged",d),l.__baseZAtZeroParam.addListener("valueChanged",s);return l}e.prototype.__rebuild=function(){this.clear();var t=this.__sidesParam.getValue(),e=this.__loopsParam.getValue(),a=this.__capsParam.getValue();var i=t*e;a&&(i+=2),this.setNumVertices(i),a?this.setFaceCounts([2*t,t]):this.setFaceCounts([0,t]);var n=0;for(var r=0;r<e-1;r++)for(var o=0;o<t;o++){var l=t*r+(o+1)%t,s=t*r+o,d=t*(r+1)+o,c=t*(r+1)+(o+1)%t;this.setFaceVertexIndices(n++,l,s,d,c)}if(a){for(var u=0;u<t;u++){var p=i-1,f=u,b=(u+1)%t;this.setFaceVertexIndices(n++,p,f,b)}for(var y=0;y<t;y++){var g=t*(e-1)+y,_=i-2,c=t*(e-1)+(y+1)%t;this.setFaceVertexIndices(n++,g,_,c)}}var Z=this.getVertexAttribute("normals");n=0;for(var G=0;G<e-1;G++)for(var X=0;X<t;X++){var v=X/t*2*Math.PI;var V=new m(Math.sin(v),Math.cos(v),0);Z.setFaceVertexValue(n,0,V),Z.setFaceVertexValue(n,1,V),v=(X+1)/t*2*Math.PI;var I=new m(Math.sin(v),Math.cos(v),0);Z.setFaceVertexValue(n,2,I),Z.setFaceVertexValue(n,3,I),n++}if(a){var R=new m(0,0,-1);for(var x=0;x<t;x++)Z.setFaceVertexValue(n,0,R),Z.setFaceVertexValue(n,1,R),Z.setFaceVertexValue(n,2,R),n++;R.set(0,0,1);for(var S=0;S<t;S++)Z.setFaceVertexValue(n,0,R),Z.setFaceVertexValue(n,1,R),Z.setFaceVertexValue(n,2,R),n++}var W=this.getVertexAttribute("texCoords");n=0;for(var L=0;L<t;L++)W.setFaceVertexValue(n,0,new h((L+1)/t,0)),W.setFaceVertexValue(n,2,new h((L+1)/t,1)),W.setFaceVertexValue(n,1,new h(L/t,0)),W.setFaceVertexValue(n,3,new h(L/t,1)),n++;if(a){for(var T=0;T<t;T++)W.setFaceVertexValue(n,0,new h(T/t,0)),W.setFaceVertexValue(n,1,new h((T+1)/t,0)),W.setFaceVertexValue(n,2,new h((T+.5)/t,1)),n++;for(var M=0;M<t;M++)W.setFaceVertexValue(n,0,new h(M/t,0)),W.setFaceVertexValue(n,1,new h((M+1)/t,0)),W.setFaceVertexValue(n,2,new h((M+.5)/t,1)),n++}this.emit("geomDataTopologyChanged",{}),this.__resize()};e.prototype.__resize=function(){var t=this.__sidesParam.getValue(),e=this.__loopsParam.getValue(),a=this.__radiusParam.getValue(),i=this.__heightParam.getValue(),n=this.__capsParam.getValue(),r=this.__baseZAtZeroParam.getValue();var o=t*e;n&&(o+=2);var l=0,s=.5;r&&(s=0);for(var d=0;d<e;d++){var c=d/(e-1)*i-i*s;for(var u=0;u<t;u++){var h=u/t*2*Math.PI;this.getVertex(l).set(Math.sin(h)*a,Math.cos(h)*a,c),l++}}n&&(this.getVertex(o-1).set(0,0,i*(r?0:-.5)),this.getVertex(o-2).set(0,0,i*(r?1:.5))),this.setBoundingBoxDirty(),this.emit("geomDataChanged",{})};return e}(Te);K.registerClass("Cylinder",He);var ke=function(t){__extends(e,t);function e(e,a){if(e===void 0){e=.5}if(a===void 0){a=32}var i=this;if(i=t.call(this)||this,isNaN(e)||isNaN(a))throw new Error("Invalid geom args");i.__radiusParam=i.addParameter(new ft("radius",e)),i.__sidesParam=i.addParameter(new ft("sides",a>=3?a:3,[3,200],1)),i.addVertexAttribute("texCoords",h),i.addVertexAttribute("normals",m),i.__rebuild();return i}Object.defineProperty(e.prototype,"radius",{get:function(){return this.__radius},set:function(t){this.__radius=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sides",{set:function(t){this.__sides=t>=3?t:3,this.__rebuild()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){var t=this.__sidesParam.getValue();this.setNumVertices(t+1),this.setFaceCounts([t]),this.getVertex(0).set(0,0,0);for(var e=0;e<t;e++){var a=e%t+1,i=(e+1)%t+1;this.setFaceVertexIndices(e,0,a,i)}var n=this.getVertexAttribute("normals"),r=new m(0,0,1);n.setValue(0,r);for(var o=0;o<t;o++)n.setValue(o+1,r);var l=this.getVertexAttribute("texCoords");l.getValueRef(0).set(.5,.5);for(var s=0;s<t;s++){var d=s/t*2*Math.PI;l.getValueRef(s+1).set(.5*Math.sin(d)+.5,.5*Math.cos(d)+.5)}this.setBoundingBoxDirty(),this.__resize()};e.prototype.__resize=function(){var t=this.__sidesParam.getValue(),e=this.__radiusParam.getValue();for(var a=0;a<t;a++){var i=a/t*2*Math.PI;this.getVertex(a+1).set(Math.sin(i)*e,Math.cos(i)*e,0)}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.radius=this.__radius,e};return e}(Te);K.registerClass("Disc",ke);var Be=function(t){__extends(e,t);function e(e,a,i,n,r,o){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=1}if(r===void 0){r=!0}if(o===void 0){o=!0}var l=this;if(l=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");l.__sizeXParam=l.addParameter(new ft("SizeX",e)),l.__sizeYParam=l.addParameter(new ft("SizeY",a)),l.__detailXParam=l.addParameter(new ft("DetailX",i)),l.__detailYParam=l.addParameter(new ft("DetailY",n)),r&&l.addVertexAttribute("normals",m),o&&l.addVertexAttribute("texCoords",h),l.__rebuild();var s=function(){l.__resize()},d=function(){l.__rebuild()};l.__sizeXParam.addListener("valueChanged",s),l.__sizeYParam.addListener("valueChanged",s),l.__detailXParam.addListener("valueChanged",d),l.__detailYParam.addListener("valueChanged",d);return l}e.prototype.__rebuild=function(){var t=this.__detailXParam.getValue(),e=this.__detailYParam.getValue();this.setNumVertices((t+1)*(e+1)),this.setFaceCounts([0,t*e]);var a=0;for(var i=0;i<e;i++)for(var n=0;n<t;n++){var r=(t+1)*(i+1)+n,o=(t+1)*(i+1)+(n+1),l=(t+1)*i+(n+1),s=(t+1)*i+n;this.setFaceVertexIndices(a,r,o,l,s),a+=1}var d=0;var c=this.getVertexAttribute("normals");if(c)for(var u=0;u<=e;u++)for(var h=0;h<=t;h++)c.getValueRef(d).set(0,0,1),d++;d=0;var m=this.getVertexAttribute("texCoords");if(m)for(var p=0;p<=e;p++){var f=p/e;for(var b=0;b<=t;b++){var y=b/t;m.getValueRef(d).set(y,f),d++}}this.__resize(!1),this.emit("geomDataTopologyChanged",{})};e.prototype.__resize=function(t){if(t===void 0){t=!0}var e=this.__sizeXParam.getValue(),a=this.__sizeYParam.getValue(),i=this.__detailXParam.getValue(),n=this.__detailYParam.getValue();var r=0;for(var o=0;o<=n;o++){var l=(o/n-.5)*a;for(var s=0;s<=i;s++){var d=(s/i-.5)*e;this.getVertex(r).set(d,l,0),r++}}this.setBoundingBoxDirty(),t&&this.emit("geomDataChanged",{})};return e}(Te);var De=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=1}if(a===void 0){a=12}if(i===void 0){i=12}var n=this;if(n=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");n.__radiusParam=n.addParameter(new ft("radius",e)),n.__sidesParam=n.addParameter(new ft("sides",a>=3?a:3,[3,200],1)),n.__loopsParam=n.addParameter(new ft("loops",i>=3?i:3,[3,200],1)),n.addVertexAttribute("texCoords",h),n.addVertexAttribute("normals",m),n.__rebuild();var r=function(){n.__rebuild()};n.__radiusParam.addListener("valueChanged",(function(){n.__resize()})),n.__sidesParam.addListener("valueChanged",r),n.__loopsParam.addListener("valueChanged",r);return n}e.prototype.__rebuild=function(){var t=this.__radiusParam.getValue(),e=this.__sidesParam.getValue(),a=this.__loopsParam.getValue(),i=2+e*a,n=2*e,r=e*a;this.setNumVertices(i),this.setFaceCounts([n,r]);var o=this.getVertexAttribute("normals"),l=new m(0,0,1);var s=0;this.getVertex(s).set(0,0,t),o.getValueRef(s).set(0,0,1),s++;for(var d=0;d<a;d++){var c=(d+1)/(a+1)*Math.PI;for(var u=0;u<e;u++){var p=u/e*2*Math.PI;l.set(Math.sin(c)*Math.cos(p),Math.sin(c)*Math.sin(p),Math.cos(c)),this.getVertex(s).setFromOther(l.scale(t)),o.getValueRef(s).setFromOther(l),s++}}this.getVertex(s).set(0,0,-t),o.getValueRef(s).set(0,0,-1),s++;var f=this.getVertexAttribute("texCoords");var b=0;for(var y=0;y<e;y++){var g=0,_=(y+1)%e+1,Z=y+1;this.setFaceVertexIndices(b,g,_,Z);var G=new h(.5,0),X=new h(1-(y+1)/e,0),v=new h(1-y/e,1/(a+1));f.setFaceVertexValue(b,0,G),f.setFaceVertexValue(b,1,X),f.setFaceVertexValue(b,2,v),b++}for(var V=0;V<e;V++){var I=i-1,R=e*(a-1)+V+1,x=e*(a-1)+(V+1)%e+1;this.setFaceVertexIndices(b,I,R,x);var S=new h(1-V/e,a/(a+1)),W=new h(1-(V+1)/e,a/(a+1)),L=new h(.5,1);f.setFaceVertexValue(b,0,S),f.setFaceVertexValue(b,1,W),f.setFaceVertexValue(b,2,L),b++}for(var T=0;T<a-1;T++)for(var M=0;M<e;M++){var F=e*T+M+1,C=e*T+(M+1)%e+1,N=e*(T+1)+(M+1)%e+1,Y=e*(T+1)+M+1;this.setFaceVertexIndices(b,F,C,N,Y),f.setFaceVertexValue(b,0,new h(T/a,M/a)),f.setFaceVertexValue(b,1,new h(T/a,(M+1)/a)),f.setFaceVertexValue(b,2,new h((T+1)/a,(M+1)/a)),f.setFaceVertexValue(b,3,new h((T+1)/a,M/a)),b++}this.setBoundingBoxDirty(),this.emit("geomDataTopologyChanged",{})};e.prototype.__resize=function(){var t=this.__radiusParam.getValue(),e=this.__sidesParam.getValue(),a=this.__loopsParam.getValue();var i=0;var n=new m(0,0,1);this.getVertex(i).set(0,0,t),i++;for(var r=0;r<a;r++){var o=(r+1)/(a+1)*Math.PI;for(var l=0;l<e;l++){var s=l/e*2*Math.PI;n.set(Math.sin(o)*Math.cos(s),Math.sin(o)*Math.sin(s),Math.cos(o)),this.getVertex(i).setFromOther(n.scale(t)),i++}}this.getVertex(i).set(0,0,-t),i++,this.setBoundingBoxDirty(),this.emit("geomDataChanged",{})};return e}(Te);K.registerClass("Sphere",De);var Oe=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=.5}if(a===void 0){a=1}if(i===void 0){i=32}var n=this;if(n=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");n.__innerRadius=e,n.__outerRadius=a,n.__detail=i>=3?i:3,n.addVertexAttribute("texCoords",h),n.addVertexAttribute("normals",m),n.__rebuild();return n}Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this.__innerRadius},set:function(t){this.__innerRadius=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this.__outerRadius},set:function(t){this.__outerRadius=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"detail",{get:function(){return this.__detail},set:function(t){this.__detail=t>=3?t:3,this.__rebuild()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){var t=this.__detail,e=2*this.__detail,a=t*e;this.setNumVertices(a),this.setFaceCounts([0,t*e]);var i=this.getVertexAttribute("normals");var n=0;for(var r=0;r<e;r++){var o=r/e*2*Math.PI,l=Math.cos(o),s=Math.sin(o);for(var d=0;d<t;d++){var c=d/t*2*Math.PI,u=Math.sin(c),m=Math.cos(c),p=this.__outerRadius+m*this.__innerRadius;this.getVertex(n).set(l*p,s*p,this.__innerRadius*u),i.getValueRef(n).set(l*m,s*m,u),n++}}var f=this.getVertexAttribute("texCoords");var b=0;for(var y=0;y<e;y++)for(var g=0;g<t;g++){var _=(y+1)%e,s=(g+1)%t,m=t*y+g,p=t*y+s,Z=t*_+s,G=t*_+g;this.setFaceVertexIndices(b,m,p,Z,G),f.setFaceVertexValue(b,0,new h(y/e,g/e)),f.setFaceVertexValue(b,1,new h(y/e,(g+1)/e)),f.setFaceVertexValue(b,2,new h((y+1)/e,(g+1)/e)),f.setFaceVertexValue(b,3,new h((y+1)/e,g/e)),b++}this.setBoundingBoxDirty()};e.prototype.__resize=function(){var t=this.__detail,e=2*this.__detail;for(var a=0;a<e;a++){var i=a/e*2*Math.PI,n=Math.cos(i),r=Math.sin(i);for(var o=0;o<t;o++){var l=o/t*2*Math.PI,s=Math.sin(l),d=Math.cos(l),c=this.__outerRadius+d*this.__innerRadius;this.getVertex(0).set(n*c,r*c,this.__innerRadius*s),index++}}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e.z=this.__z,e};return e}(Te);var Qe={SAVE_FLAG_SKIP_CHILDREN:1},Ae={LOAD_FLAG_LOADING_BIN_TREE_VALUES:16},je={CLONE_FLAG_INSTANCED_TREE:1};var qe=new y("#03E3AC");qe.a=.1;var $e=qe.lerp(new y("white"),.5);$e.a=.1;var ta=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__visibleCounter=1,a.__visible=!0,a.__highlightMapping={},a.__highlights=[],a.__childItems=[],a.__childItemsSignalIds=[],a.__childItemsMapping={},a.__visibleParam=a.addParameter(new yt("Visible",!0)),a.__localXfoParam=a.addParameter(new Vt("LocalXfo",new v)),a.__globalXfoParam=a.addParameter(new Vt("GlobalXfo",new v)),a.__boundingBoxParam=a.addParameter(new k("BoundingBox",new R)),a._cleanGlobalXfo=a._cleanGlobalXfo.bind(a),a._setGlobalXfoDirty=a._setGlobalXfoDirty.bind(a),a._setBoundingBoxDirty=a._setBoundingBoxDirty.bind(a),a._cleanBoundingBox=a._cleanBoundingBox.bind(a),a.__localXfoParam.on("valueChanged",a._setGlobalXfoDirty);var i=function(){var t=a.__globalXfoParam.getValue();return void 0!==a.__ownerItem?a.__ownerItem.getGlobalXfo().inverse().multiply(t):t};a.__globalXfoParam.on("valueChanged",(function(t){t.mode!=z.OPERATOR_DIRTIED&&a.__localXfoParam.setDirty(i),a._setBoundingBoxDirty(),a.emit("globalXfoChanged",t)})),a.__visibleParam.on("valueChanged",(function(){a.__visibleCounter+=a.__visibleParam.getValue()?1:-1,a.__updateVisiblity()})),a.on("selectedChanged",(function(){a.__selected?a.addHighlight("selected",qe,!0):a.removeHighlight("selected",!0)}));return a}Object.defineProperty(e,"SaveFlags",{get:function(){return Qe},enumerable:true,configurable:true});Object.defineProperty(e,"LoadFlags",{get:function(){return Ae},enumerable:true,configurable:true});Object.defineProperty(e,"CloneFlags",{get:function(){return je},enumerable:true,configurable:true});e.getSelectionOutlineColor=function(){return qe};e.setSelectionOutlineColor=function(t){qe=t};e.getBranchSelectionOutlineColor=function(){return $e};e.setBranchSelectionOutlineColor=function(t){$e=t};e.prototype._childFlagsChanged=function(t){0!=(t&U.USER_EDITED)&&this.setFlag(O.USER_EDITED)};e.prototype.setFlag=function(e){t.prototype.setFlag.call(this,e),this.__ownerItem&&this.__ownerItem._childFlagsChanged(e)};e.prototype.setOwner=function(e){if(this.__ownerItem){this.__ownerItem.removeListener("globalXfoChanged",this._setGlobalXfoDirty),this.__ownerItem.getVisible()||this.__visibleCounter++;var a=this.__ownerItem.getChildIndex(this);a>=0&&this.__ownerItem.__unbindChild(a,this)}t.prototype.setOwner.call(this,e),this._setGlobalXfoDirty(),this.__ownerItem&&(this.setSelectable(this.__ownerItem.getSelectable(),!0),this.__ownerItem.getVisible()||this.__visibleCounter--,this.__ownerItem.addListener("globalXfoChanged",this._setGlobalXfoDirty)),this.__updateVisiblity()};e.prototype.__updatePath=function(){t.prototype.__updatePath.call(this);for(var e=0,a=this.__childItems;e<a.length;e++){var i=a[e];i&&i.__updatePath()}};e.prototype.getParentItem=function(){return this.getOwner()};e.prototype.setParentItem=function(t){this.setOwner(t)};e.prototype.getLocalXfo=function(){return this.__localXfoParam.getValue()};e.prototype.setLocalXfo=function(t,e){this.__localXfoParam.setValue(t,e)};e.prototype.getGlobalXfo=function(t){return this.__globalXfoParam.getValue(t)};e.prototype.setGlobalXfo=function(t,e){var a=this.getOwner();if(a){var i=a.getGlobalXfo().inverse().multiply(t);this.__localXfoParam.setValue(i,e)}else this.__globalXfoParam.setValue(t,e)};e.prototype._cleanGlobalXfo=function(t){var e=this.getParentItem(),a=this.__localXfoParam.getValue();if(void 0!==e){return e.getGlobalXfo().multiply(a)}return a};e.prototype._setGlobalXfoDirty=function(){this.__globalXfoParam.setDirty(this._cleanGlobalXfo)};e.prototype.getVisible=function(){return this.__visibleCounter>0};e.prototype.setVisible=function(t){this.__visibleParam.setValue(t)};e.prototype.propagateVisiblity=function(t){this.__visibleCounter+=t,this.__updateVisiblity()};e.prototype.__updateVisiblity=function(){var t=this.__visibleCounter>0;if(t!=this.__visible){this.__visible=t;for(var a=0,i=this.__childItems;a<i.length;a++){var n=i[a];n instanceof e&&n.propagateVisiblity(this.__visible?1:-1)}return this.emit("visibilityChanged",{visible:t}),!0}return!1};e.prototype.addHighlight=function(t,a,i){if(i===void 0){i=!1}if(t in this.__highlightMapping){var n=this.__highlights.indexOf(t);this.__highlights.splice(n,1)}this.__highlights.push(t),this.__highlightMapping[t]=a,this.emit("highlightChanged",{name:t,color:a}),i&&this.__childItems.forEach((function(n){n instanceof e&&n.addHighlight(t,a,i)}))};e.prototype.removeHighlight=function(t,a){if(a===void 0){a=!1}if(t in this.__highlightMapping){var i=this.__highlights.indexOf(t);this.__highlights.splice(i,1),delete this.__highlightMapping[t],this.emit("highlightChanged",{})}a&&this.__childItems.forEach((function(i){i instanceof e&&i.removeHighlight(t,a)}))};e.prototype.getHighlight=function(){if(this.__highlights.length>0)return this.__highlightMapping[this.__highlights[this.__highlights.length-1]]};e.prototype.isHighlighted=function(){return this.__highlights.length>0};Object.defineProperty(e.prototype,"boundingBox",{get:function(){return console.warn("getter is deprectated. Please use 'getBoundingBox'"),this.getBoundingBox()},enumerable:true,configurable:true});e.prototype.getBoundingBox=function(){return this.__boundingBoxParam.getValue()};e.prototype._cleanBoundingBox=function(t){return t.reset(),this.__childItems.forEach((function(a){a instanceof e&&a.getVisible()&&!a.testFlag(O.IGNORE_BBOX)&&t.addBox3(a.getBoundingBox())})),t};e.prototype._childBBoxChanged=function(){this._setBoundingBoxDirty()};e.prototype._setBoundingBoxDirty=function(){this.__boundingBoxParam&&this.__boundingBoxParam.setDirty(this._cleanBoundingBox)};e.prototype.getChildren=function(){return this.__childItems};e.prototype.numChildren=function(){return console.warn("Deprecated method. Please use getNumChildren"),this.__childItems.length};e.prototype.getNumChildren=function(){return this.__childItems.length};e.prototype.generateUniqueName=function(t){if(!(t in this.__childItemsMapping))return t;var e=1;t.length>4&&!Number.isNaN(parseInt(t.substring(t.length-4)))?e=parseInt(t.substr(t.length-4)):t.length>3&&!Number.isNaN(parseInt(t.substring(t.length-3)))?e=parseInt(t.substr(t.length-3)):t.length>2&&!Number.isNaN(parseInt(t.substring(t.length-2)))&&(e=parseInt(t.substr(t.length-2)));var a=[];for(var i=0,n=this.__childItems;i<n.length;i++){var r=n[i];r&&a.push(r.getName())}var o=t;for(;;){var l=""+e;for(;l.length<2;)l="0"+l;if(o=t+l,-1==a.indexOf(o))break;e++}return o};e.prototype.__updateMapping=function(t){for(var e=t;e<this.__childItems.length;e++)this.__childItemsMapping[this.__childItems[e].getName()]=e};e.prototype.insertChild=function(t,a,i,n){var r=this;if(i===void 0){i=!1}if(n===void 0){n=!0}if(t.getName()in this.__childItemsMapping){if(!n)throw new Error("Item '"+t.getName()+"' is already a child of :"+this.getPath());t.setName(this.generateUniqueName(t.getName()))}if(!(t instanceof A))throw new Error("Object is is not a tree item :"+t.constructor.name);var o={};var l;return o.nameChangedId=t.addListener("nameChanged",(function(t){var e=r.__childItemsMapping[t.oldName];delete r.__childItemsMapping[t.oldName],r.__childItemsMapping[t.newName]=e})),t instanceof e&&(i&&(l=this.getGlobalXfo().inverse().multiply(t.getGlobalXfo())),o.bboxChangedId=t.addListener("boundingChanged",(function(){r._setBoundingBoxDirty()})),o.visChangedId=t.addListener("visibilityChanged",this._setBoundingBoxDirty)),this.__childItems.splice(a,0,t),this.__childItemsSignalIds.splice(a,0,o),this.__childItemsMapping[t.getName()]=a,this.__updateMapping(a),t.setOwner(this),t instanceof e&&(i&&t.setLocalXfo(l),this._setBoundingBoxDirty()),t.testFlag(O.USER_EDITED)&&this.setFlag(O.USER_EDITED),this.emit("childAdded",{childItem:t,index:a}),t};e.prototype.addChild=function(t,e,a){if(e===void 0){e=!0}if(a===void 0){a=!0}var i=this.__childItems.length;return this.insertChild(t,i,e,a),i};e.prototype.getChild=function(t){return this.__childItems[t]};e.prototype.getChildByName=function(t){var e=this.__childItemsMapping[t];return null!=e?this.__childItems[e]:null};e.prototype.getChildNames=function(){var t=[];for(var e=0;e<this.__childItems.length;e++){var a=this.__childItems[e];null!=a&&(t[e]=a.getName())}return t};e.prototype.__unbindChild=function(t,a){var i=this.__childItemsSignalIds[t];a.removeListenerById("nameChanged",i.nameChangedId),a instanceof e&&(a.removeListenerById("boundingChanged",i.bboxChangedId),a.removeListenerById("visibilityChanged",i.visChangedId)),this.__childItems.splice(t,1),this.__childItemsSignalIds.splice(t,1),delete this.__childItemsMapping[a.getName()],this.__updateMapping(t),a instanceof e&&this._setBoundingBoxDirty(),this.emit("childRemoved",{childItem:a,index:t})};e.prototype.removeChild=function(t){var e=this.__childItems[t];e&&(this.__unbindChild(t,e),e.setOwner(void 0))};e.prototype.removeChildByName=function(t){var e=this.__childItemsMapping[t];return null!=e?this.removeChild(e):null};e.prototype.removeChildByHandle=function(t){console.warn("Deprecated method. Please use removeChild");var e=this.__childItems.indexOf(t);if(-1==e)throw new Error("Error in removeChildByHandle. Child not found:"+t.getName());this.removeChild(e)};e.prototype.removeAllChildren=function(){var t=this.__childItems.length;for(;t--;)this.removeChild(t);this._setBoundingBoxDirty()};e.prototype.getChildIndex=function(t){return this.__childItems.indexOf(t)};e.prototype.indexOfChild=function(t){return console.warn("Deprecated method. Please use getChildIndex"),this.getChildIndex(t)};e.prototype.resolvePath=function(t,e){if(e===void 0){e=0}if("string"==typeof t&&(t=t.split("/")),0==e)if("."==t[0]||t[0]==this.__name)e++;else if(".."==t[0])return this.__ownerItem.resolvePath(t,e+1);if(e==t.length)return this;var a=t[e],i=this.getChildByName(a);if(null==i){var n=this.getParameter(t[e]);return n||null}return i.resolvePath(t,e+1)};e.prototype.traverse=function(t,a){if(a===void 0){a=!0}var i=function(t,e){var a=t.getChildren();for(var i=0,r=a;i<r.length;i++){var o=r[i];o&&n(o,e+1)}},n=function(a,n){if(0==t(a,n))return!1;a instanceof e&&i(a,n)};a?n(this,1):i(this,0)};e.prototype.onMouseDown=function(t){this.emit("mouseDown",t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseDown(t)};e.prototype.onMouseUp=function(t){this.emit("mouseUp",t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseUp(t)};e.prototype.onMouseMove=function(t){this.emit("mouseMove",t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseMove(t)};e.prototype.onMouseEnter=function(t){this.emit("mouseEnter",t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseEnter(t)};e.prototype.onMouseLeave=function(t){this.emit("mouseLeave",t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseLeave(t)};e.prototype.onWheel=function(t){t.propagating&&this.__ownerItem&&this.__ownerItem.onWheel(t)};e.prototype.toJSON=function(e,a){if(!this.testFlag(O.USER_EDITED))return;var i=t.prototype.toJSON.call(this,e,a);if(!(a&Qe.SAVE_FLAG_SKIP_CHILDREN)){var n={};for(var r=0,o=this.__childItems;r<o.length;r++){var l=o[r];if(l){var s=l.toJSON(e,a);s&&(n[l.getName()]=s)}}Object.keys(n).length>0&&(i?i.children=n:i={name:this.__name,children:n})}return i};e.prototype.fromJSON=function(e,a,i){if(t.prototype.fromJSON.call(this,e,a,i),a.numTreeItems++,this.setFlag(O.USER_EDITED),null!=e.children){var n=e.children;if(Array.isArray(n))for(var r=0,o=n;r<o.length;r++){var l=o[r];var s=this.getChildByName(l.name);s?s.fromJSON(l,a,i):l.type&&(s=K.constructClass(l.type),s&&(s.fromJSON(l,a,i),this.addChild(s,!1,!1)))}else for(var d in n){var c=n[d];var u=this.getChildByName(d);u?u.fromJSON(c,a,i):c.type&&(u=K.constructClass(c.type),u&&(u.fromJSON(c,a,i),this.addChild(u,!1,!1)))}}};e.prototype.readBinary=function(e,a){t.prototype.readBinary.call(this,e,a),a.numTreeItems++;var i=e.loadUInt8();if(4&i){var n=new v;n.tr=e.loadFloat32Vec3(),n.ori=e.loadFloat32Quat(),n.sc.set(e.loadFloat32()),this.__localXfoParam.setValue(n,z.DATA_LOAD)}8&i&&this.__boundingBoxParam.setValue(new R(e.loadFloat32Vec3(),e.loadFloat32Vec3()),z.DATA_LOAD);var r=e.loadUInt32();if(r>0){var o=e.loadUInt32Array(r);for(var l=0;l<r;l++)try{e.seek(o[l]);var s=e.loadStr();if(s.startsWith("N")&&s.endsWith("E")){var d=s.indexOf("podium");-1!=d&&(s=parseInt(s[d+7])?s.substring(d+8,s.length-1):s.substring(d+7,s.length-1));-1!=s.indexOf("livenurbs")&&(s=s.substring(s.indexOf("CAD"),s.length-1))}var c=K.constructClass(s);if(!c){var u=e.loadStr();console.warn("Unable to construct child:"+u+" of type:"+s);continue}e.seek(o[l]),c.readBinary(e,a),c.setFlag(O.BIN_NODE),this.addChild(c,!1,!1)}catch(e){console.warn("Error loading tree item: ",e)}}};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){var i=this;t.prototype.copyFrom.call(this,e,a),e.getChildren().forEach((function(t){t&&i.addChild(t.clone(a),!1,!1)}))};e.prototype.destroy=function(){this.removeAllChildren(),t.prototype.destroy.call(this)};return e}(A);K.registerClass("TreeItem",ta);var ea=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e.prototype.setSrcTree=function(t,e){var a=this;this.__srcTree=t;if(0==this.__srcTree.getNumChildren()){var i=this.__srcTree.clone(e);i.setLocalXfo(new v,z.DATA_LOAD),this.addChild(i,!1)}else{this.__srcTree.getChildren().forEach((function(t){var i=t.clone(e);a.addChild(i,!1)}))}};e.prototype.getSrcTree=function(){return this.__srcTree};e.prototype.readBinary=function(e,a){var i=this;if(a===void 0){a={}}t.prototype.readBinary.call(this,e,a);var n=e.loadStrArray();a.resolvePath(n,(function(t){i.setSrcTree(t,a)}))};e.prototype.toJSON=function(e,a){if(e===void 0){e={}}if(a===void 0){a=0}return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(t,e,a,i){if(e===void 0){e={}}if(a===void 0){a=0}};return e}(ta);K.registerClass("InstanceItem",ea);var aa=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__loaded=!1;var i=a.addParameter(new St("FilePath"));var n,r;var o=function(){n=window.ZeaAudioaudioCtx.createBufferSource(),n.buffer=r,n.loop=c.getValue(),n.muted=d.getValue(),n.start(0),a.emit("audioSourceCreated",{audioSource:n})};i.addListener("valueChanged",(function(){var t=new XMLHttpRequest;t.open("GET",i.getURL(),!0),t.responseType="arraybuffer",t.onload=function(){var e=t.response;window.ZeaAudioaudioCtx.decodeAudioData(e,(function(t){r=t,a.__loaded=!0,a.emit("loaded",{}),l.getValue()&&o()}),(function(t){console.log("Error with decoding audio data"+t.err)}))},t.send()}));var l=a.addParameter(new yt("Autoplay",!1)),s=a.addParameter(new ft("PlayState",0));s.addListener("valueChanged",(function(t){if(mode.mode!=z.CUSTOM)switch(s.getValue()){case 0:a.__loaded&&n&&(n.stop(0),n=void 0);break;case 1:a.__loaded&&o()}})),a.isPlaying=function(){return 0!=s.getValue()},a.play=function(){s.setValue(1,z.CUSTOM)},a.stop=function(){s.setValue(0,z.CUSTOM)},a.pause=function(){s.setValue(0,z.CUSTOM)},a.getAudioSource=function(){return n};var d=a.addParameter(new yt("Mute",!1));a.addParameter(new ft("Gain",1)).setRange([0,5]);var c=a.addParameter(new yt("Loop",!1));a.addParameter(new yt("SpatializeAudio",!0)),a.addParameter(new ft("refDistance",2)),a.addParameter(new ft("maxDistance",1e4)),a.addParameter(new ft("rolloffFactor",1)),a.addParameter(new ft("coneInnerAngle",360)),a.addParameter(new ft("coneOuterAngle",0)),a.addParameter(new ft("coneOuterGain",1)),d.addListener("valueChanged",(function(){n&&(n.muted=d.getValue())})),c.addListener("valueChanged",(function(){n&&(n.loop=c.getValue())})),a.mute=function(t){d.setValue(t,z.CUSTOM)},a.loaded=!1;return a}e.prototype.isLoaded=function(){return this.__loaded};e.prototype.setAudioStream=function(){this.__loaded=!0,this.emit("loaded",{}),this.emit("audioSourceCreated",{audioSource:audioSource})};return e}(ta);var ia=function(t){__extends(e,t);function e(t){var e=this;return e}return e}(aa);var na=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.overlay=!1,a.__cutAway=!1,a.__cutAwayVector=!1,a.__cutAwayDist=!1,a.__layers=[];return a}e.prototype.setOverlay=function(t){this.overlay=t};e.prototype.isOverlay=function(){return this.overlay};e.prototype.addLayer=function(t){this.__layers.push(t)};e.prototype.getLayers=function(){return this.__layers};e.prototype.isCutawayEnabled=function(){return this.__cutAway};e.prototype.setCutawayEnabled=function(t){this.__cutAway=t,this.emit("cutAwayChanged",{})};e.prototype.getCutVector=function(){return this.__cutAwayVector};e.prototype.setCutVector=function(t){this.__cutAwayVector=t,this.emit("cutAwayChanged",{})};e.prototype.getCutDist=function(){return this.__cutAwayDist};e.prototype.setCutDist=function(t){this.__cutAwayDist=t,this.emit("cutAwayChanged",{})};e.prototype.readBinary=function(e,a){if(t.prototype.readBinary.call(this,e,a),a.versions["zea-engine"].greaterOrEqualThan([0,0,4])){var i=e.loadStr();var n=a.assetItem.getMaterialLibrary().getMaterial(i,!1);if(n||(n=new zt(i,"SimpleSurfaceShader"),n.getParameter("BaseColor").setValue(y.random(.25),z.DATA_LOAD),a.assetItem.getMaterialLibrary().addMaterial(n)),this.setMaterial(n,z.DATA_LOAD),this.__layers=e.loadStrArray(),this.__layers.length>0)for(var r=0,o=this.__layers;r<o.length;r++){var l=o[r];a.addGeomToLayer(this,l)}}};return e}(ta);var ra=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e)||this,n.__geomParam=n.insertParameter(new Ct("Geometry"),0),n._setBoundingBoxDirty=n._setBoundingBoxDirty.bind(n),n.__geomParam.addListener("valueChanged",n._setBoundingBoxDirty),n.__geomParam.addListener("boundingBoxChanged",n._setBoundingBoxDirty),n.__materialParam=n.insertParameter(new Ie("Material"),1),n.__paramMapping.material=n.getParameterIndex(n.__materialParam),n.__lightmapCoordOffset=new h,n.__geomOffsetXfoParam=n.addParameter(new Vt("GeomOffsetXfo")),n.__geomMatParam=n.addParameter(new vt("GeomMat")),n.__cleanGeomMat=n.__cleanGeomMat.bind(n),n.__globalXfoParam.addListener("valueChanged",(function(){n.__geomMatParam.setDirty(n.__cleanGeomMat)})),n.__geomOffsetXfoParam.addListener("valueChanged",(function(){n.__geomMatParam.setDirty(n.__cleanGeomMat)})),n.__geomMatParam.addListener("valueChanged",(function(t){n.emit("geomXfoChanged",t)})),n.__materialParam.addListener("valueChanged",(function(t){n.emit("materialAssigned",t)})),n.__geomParam.addListener("valueChanged",(function(t){n.emit("geomAssigned",t)})),a&&n.setGeometry(a,z.DATA_LOAD),i&&n.setMaterial(i,z.DATA_LOAD);return n}e.prototype.__cleanGeomMat=function(){var t=this.__globalXfoParam.getValue().toMat4(),e=this.__geomOffsetXfoParam.getValue().toMat4();return t.multiply(e)};e.prototype.getGeometry=function(){return this.__geomParam.getValue()};e.prototype.setGeometry=function(t,e){this.__geomParam.setValue(t,e)};e.prototype.getGeom=function(){return console.warn("getGeom is deprectated. Please use 'getGeometry'"),this.getGeometry()};e.prototype.setGeom=function(t){return console.warn("setGeom is deprectated. Please use 'setGeometry'"),this.setGeometry(t)};e.prototype.getMaterial=function(){return this.__materialParam.getValue()};e.prototype.setMaterial=function(t,e){this.__materialParam.setValue(t,e)};e.prototype._cleanBoundingBox=function(e){e=t.prototype._cleanBoundingBox.call(this,e);var a=this.getGeometry();return a&&e.addBox3(a.boundingBox,this.getGeomMat4()),e};e.prototype.getGeomOffsetXfo=function(){return this.__geomOffsetXfoParam.getValue()};e.prototype.setGeomOffsetXfo=function(t){this.__geomOffsetXfoParam.setValue(t)};e.prototype.getGeomMat4=function(){return this.__geomMatParam.getValue()};e.prototype.getLightmapName=function(){return this.__lightmapName};e.prototype.getLightmapCoordsOffset=function(){return this.__lightmapCoordOffset};e.prototype.applyAssetLightmapSettings=function(t,e){this.__lightmap=t,this.__lightmapCoordOffset.addInPlace(e)};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a){t.prototype.fromJSON.call(this,e,a),a.numGeomItems++};e.prototype.readBinary=function(e,a){var i=this;t.prototype.readBinary.call(this,e,a),a.numGeomItems++,this.__lightmapName=a.assetItem.getName();var n=e.loadUInt8(),r=e.loadUInt32(),o=a.assetItem.getGeometryLibrary(),l=o.getGeom(r);if(l)this.setGeometry(l,z.DATA_LOAD);else{this.geomIndex=r;var s=function(t){var e=t.range;if(r>=e[0]&&r<e[1]){var a=o.getGeom(r);a?i.setGeometry(a,z.DATA_LOAD):console.warn("Geom not loaded:",i.getName()),o.removeListenerById("rangeLoaded",d)}},d=o.addListener("rangeLoaded",s)}if(4&n&&this.__geomOffsetXfoParam.setValue(new v(e.loadFloat32Vec3(),e.loadFloat32Quat(),e.loadFloat32Vec3())),a.versions["zea-engine"].lessThan([0,0,4])){if(n&8){var c=a.assetItem.getMaterialLibrary(),u=e.loadStr();var h=c.getMaterial(u);h||(console.warn("Geom :'"+this.name+"' Material not found:"+u),h=c.getMaterial("Default")),this.setMaterial(h,z.DATA_LOAD)}else this.setMaterial(a.assetItem.getMaterialLibrary().getMaterial("Default"),z.DATA_LOAD)}this.__lightmapCoordOffset=e.loadFloat32Vec2()};e.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){var i=this;if(t.prototype.copyFrom.call(this,e,a),this.__lightmapCoordOffset=e.__lightmapCoordOffset,!e.getGeometry()&&-1!=e.geomIndex){var n=a.assetItem.getGeometryLibrary(),r=e.geomIndex,o=function(t){var e=t.range;if(r>=e[0]&&r<e[1]){var a=n.getGeom(r);a?i.setGeometry(a,z.DATA_LOAD):console.warn("Geom not loaded:",i.getName()),n.removeListenerById("rangeLoaded",l)}},l=n.addListener("rangeLoaded",o)}this.__geomMatParam.setDirty(this.__cleanGeomMat)};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(na);K.registerClass("GeomItem",ra);var oa={manual:0,first:1,average:2,globalOri:3};var la=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.setFlag(O.USER_EDITED),a.groupXfoDirty=!1,a.calculatingGroupXfo=!1,a.dirty=!1,a.invGroupXfo=void 0,a.__initialXfos=[],a.__signalIndices=[],a.__itemsParam=a.addParameter(new Mt("Items",(function(t){return t instanceof ta}))),a.__itemsParam.addListener("itemAdded",(function(t){a.__bindItem(t.item,t.index)})),a.__itemsParam.addListener("itemRemoved",(function(t){a.__unbindItem(t.item,t.index)})),a.__itemsParam.addListener("valueChanged",(function(){a.calcGroupXfo(),a._setBoundingBoxDirty()})),a.__initialXfoModeParam=a.addParameter(new bt("InitialXfoMode",oa.average,["manual","first","average","global"])),a.__initialXfoModeParam.addListener("valueChanged",(function(){a.calcGroupXfo()})),a.__highlightedParam=a.addParameter(new yt("Highlighted",!1)),a.__highlightedParam.addListener("valueChanged",(function(){a.__updateHighlight()})),a.__updateHighlight=a.__updateHighlight.bind(a);a.addParameter(new Gt("HighlightColor",new y(.5,.5,1))).addListener("valueChanged",a.__updateHighlight);a.addParameter(new ft("HighlightFill",0,[0,1])).addListener("valueChanged",a.__updateHighlight),a.__materialParam=a.addParameter(new Ie("Material")),a.__materialParam.addListener("valueChanged",(function(){a.__updateMaterial()})),a.__updateCutaway=a.__updateCutaway.bind(a),a.addParameter(new yt("CutAwayEnabled",!1)).addListener("valueChanged",a.__updateCutaway),a.addParameter(new _t("CutPlaneNormal",new m(1,0,0))).addListener("valueChanged",a.__updateCutaway),a.addParameter(new ft("CutPlaneDist",0)).addListener("valueChanged",a.__updateCutaway),a.__globalXfoParam.addListener("valueChanged",(function(t){a.calculatingGroupXfo||a.groupXfoDirty||a._propagateDirtyXfoToItems()}));return a}Object.defineProperty(e,"INITIAL_XFO_MODES",{get:function(){return oa},enumerable:true,configurable:true});e.prototype.__updateVisiblity=function(){if(t.prototype.__updateVisiblity.call(this)){var e=this.getVisible();return Array.from(this.__itemsParam.getValue()).forEach((function(t){t instanceof ta&&t.propagateVisiblity(e?1:-1)})),!0}return!1};e.prototype.__updateHighlight=function(){var t,e=!1;(this.getParameter("Highlighted").getValue()||this.isSelected())&&(e=!0,t=this.getParameter("HighlightColor").getValue(),t.a=this.getParameter("HighlightFill").getValue());var a="groupItemHighlight"+this.getId();Array.from(this.__itemsParam.getValue()).forEach((function(i){i instanceof ta&&(e?i.addHighlight(a,t,!0):i.removeHighlight(a,!0))}))};e.prototype.setSelected=function(e){t.prototype.setSelected.call(this,e),this.__updateHighlight()};e.prototype._setGlobalXfoDirty=function(){t.prototype._setGlobalXfoDirty.call(this)};e.prototype.calcGroupXfo=function(){var t=this;var e=Array.from(this.__itemsParam.getValue());if(0==e.length)return new v;this.calculatingGroupXfo=!0;var a=this.__initialXfoModeParam.getValue();var i;if(a==oa.manual)return this.invGroupXfo=this.getGlobalXfo().inverse(),this.calculatingGroupXfo=!1,void(this.groupXfoDirty=!1);if(a==oa.first)i=this.__initialXfos[0];else if(a==oa.average){i=new v,i.ori.set(0,0,0,0);var n=0;e.forEach((function(e,a){e instanceof ta&&(i.tr.addInPlace(t.__initialXfos[a].tr),i.ori.addInPlace(t.__initialXfos[a].ori),n++)})),i.tr.scaleInPlace(1/n),i.ori.normalizeInPlace()}else{if(a!=oa.globalOri)throw new Error("Invalid mode.");{i=new v;var r=0;e.forEach((function(e,a){e instanceof ta&&(i.tr.addInPlace(t.__initialXfos[a].tr),r++)})),i.tr.scaleInPlace(1/r)}}this.setGlobalXfo(i,z.GENERATED_VALUE);var o=this.getGlobalXfo();this.invGroupXfo=o.inverse(),this.calculatingGroupXfo=!1,this.groupXfoDirty=!1};e.prototype._propagateDirtyXfoToItems=function(){var t=this;if(this.groupXfoDirty||this.calculatingGroupXfo)return;var e=Array.from(this.__itemsParam.getValue());if(!this.calculatingGroupXfo&&e.length>0&&this.invGroupXfo&&!this.dirty){var a;this.dirty=!0,this.propagatingXfoToItems=!0;var i=function(e,i){var n=e.getParameter("GlobalXfo");n.setDirty((function(){if(!a){var e=t.__globalXfoParam.getValue();a=e.multiply(t.invGroupXfo),t.dirty=!1}var r=a.multiply(i);n.setClean(r)}))};e.forEach((function(e,a){e instanceof ta&&i(e,t.__initialXfos[a])})),this.propagatingXfoToItems=!1}};e.prototype.__updateMaterial=function(){var t=this.getParameter("Material").getValue();Array.from(this.__itemsParam.getValue()).forEach((function(e){e.traverse((function(e){if(e instanceof ta&&e.hasParameter("Material")){var a=e.getParameter("Material");if(t){var i=a.getValue();i!=t&&(a.__backupMaterial=i,a.setValue(t,z.GENERATED_VALUE))}else a.__backupMaterial&&a.setValue(a.__backupMaterial,z.GENERATED_VALUE)}}),!1)}))};e.prototype.__updateCutaway=function(){var t=this.getParameter("CutAwayEnabled").getValue(),e=this.getParameter("CutPlaneNormal").getValue(),a=this.getParameter("CutPlaneDist").getValue();Array.from(this.__itemsParam.getValue()).forEach((function(i){i.traverse((function(i){i instanceof na&&(i.setCutawayEnabled(t),i.setCutVector(e),i.setCutDist(a))}),!0)}))};e.prototype.setPaths=function(t){var e=this;this.clearItems(!1);var a=this.getOwner();if(null==a)return void console.warn("Group does not have an owner and so cannot resolve paths:",this.getName());var i=[];t.forEach((function(t){var n=a.resolvePath(t);n?i.push(n):console.warn("Path does not resolve to an Item:",t," group:",e.getName())})),this.setItems(i)};e.prototype.resolveItems=function(t){this.setPaths(t)};e.prototype.__bindItem=function(t,e){var a=this;if(!(t instanceof ta))return;var i={};i.mouseDownIndex=t.addListener("mouseDown",(function(t){a.onMouseDown(t)})),i.mouseUpIndex=t.addListener("mouseUp",(function(t){a.onMouseUp(t)})),i.mouseMoveIndex=t.addListener("mouseMove",(function(t){a.onMouseMove(t)})),i.mouseEnterIndex=t.addListener("mouseEnter",(function(t){a.onMouseEnter(t)})),i.mouseLeaveIndex=t.addListener("mouseLeave",(function(t){a.onMouseLeave(t)}));var n=this.getParameter("Material").getValue();if(n&&t.traverse((function(t){if(t instanceof ta&&t.hasParameter("Material")){var e=t.getParameter("Material");if(n){var a=e.getValue();a!=n&&(e.__backupMaterial=a,e.setValue(n,z.GENERATED_VALUE))}}}),!0),t instanceof ta&&this.getParameter("Highlighted").getValue()){var r=this.getParameter("HighlightColor").getValue();r.a=this.getParameter("HighlightFill").getValue(),t.addHighlight("groupItemHighlight"+this.getId(),r,!0)}var o=this.getParameter("CutAwayEnabled").getValue();if(o){var l=this.getParameter("CutPlaneNormal").getValue(),s=this.getParameter("CutPlaneDist").getValue();t.traverse((function(t){t instanceof na&&(t.setCutawayEnabled(o),t.setCutVector(l),t.setCutDist(s))}),!0)}this.getVisible()||t.propagateVisiblity(-1);var d=function(){var t=a.__initialXfoModeParam.getValue();t==oa.first&&0==e?a.calcGroupXfo():t!=oa.average&&t!=oa.globalOri||a.calcGroupXfo()};i.globalXfoChangedIndex=t.addListener("globalXfoChanged",(function(i){a.propagatingXfoToItems||(a.__initialXfos[e]=t.getGlobalXfo(),a.groupXfoDirty=!0,d())})),this.__initialXfos[e]=t.getGlobalXfo(),i.bboxChangedIndex=t.addListener("boundingChanged",this._setBoundingBoxDirty),this.__signalIndices[e]=i,d()};e.prototype.__unbindItem=function(t,e){if(!(t instanceof ta))return;t.removeHighlight("branchselected"+this.getId(),!0),this.getParameter("Highlighted").getValue()&&t.removeHighlight("groupItemHighlight"+this.getId(),!0),this.getVisible()||t.propagateVisiblity(1),t.traverse((function(t){t instanceof na&&t.setCutawayEnabled(!1)}),!0);var a=this.__signalIndices[e];t.removeListenerById("mouseDown",a.mouseDownIndex),t.removeListenerById("mouseUp",a.mouseUpIndex),t.removeListenerById("mouseMove",a.mouseMoveIndex),t.removeListenerById("mouseEnter",a.mouseEnterIndex),t.removeListenerById("mouseLeave",a.mouseLeaveIndex),t.removeListenerById("globalXfoChanged",a.globalXfoChangedIndex),t.removeListenerById("boundingChanged",a.bboxChangedIndex),this.__signalIndices.splice(e,1),this.__initialXfos.splice(e,1)};e.prototype.addItem=function(t,e){if(e===void 0){e=!0}t?this.__itemsParam.addItem(t,e):console.warn("Error adding item to group. Item is null")};e.prototype.removeItem=function(t,e){if(e===void 0){e=!0}this.__itemsParam.removeItem(t,e)};e.prototype.clearItems=function(t){if(t===void 0){t=!0}var e=Array.from(this.__itemsParam.getValue());for(var a=e.length-1;a>=0;a--)this.__unbindItem(e[a],a);this.__signalIndices=[],this.__initialXfos=[],this.__itemsParam.clearItems(t)};e.prototype.getItems=function(){return this.__itemsParam.getValue()};e.prototype.setItems=function(t){this.clearItems(!1),this.__itemsParam.setItems(t)};e.prototype._cleanBoundingBox=function(e){var a=t.prototype._cleanBoundingBox.call(this,e);return Array.from(this.__itemsParam.getValue()).forEach((function(t){t instanceof ta&&t.getVisible()&&!t.testFlag(O.IGNORE_BBOX)&&a.addBox3(t.getBoundingBox())})),a};e.prototype.onMouseDown=function(e){t.prototype.onMouseDown.call(this,e)};e.prototype.onMouseUp=function(e){t.prototype.onMouseUp.call(this,e)};e.prototype.onMouseMove=function(e){t.prototype.onMouseMove.call(this,e)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a),n=Array.from(this.__itemsParam.getValue()),r=[];return n.forEach((function(t){var a=t.getPath();r.push(e?e.makeRelative(a):a)})),i.treeItems=r,i};e.prototype.fromJSON=function(e,a,i){var n=this;if(t.prototype.fromJSON.call(this,e,a,i),this.setFlag(O.USER_EDITED),!e.treeItems)return void console.warn("Invalid Parameter JSON");var r=e.treeItems.length;var o=function(t){a.resolvePath(t,(function(t){n.addItem(t),r--,0==r&&(n.calculatingGroupXfo=!0,n.calcGroupXfo(),n.calculatingGroupXfo=!1)}),(function(e){console.warn("Group: '"+n.getName()+"'. Unable to load item:"+t)}))};for(var l=0,s=e.treeItems;l<s.length;l++){var d=s[l];o(d)}};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){t.prototype.copyFrom.call(this,e,a)};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(ta);K.registerClass("Group",la);var sa=lt("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwpjb25zdCB0PU1hdGguUEkvMTgwO01hdGguSEFMRl9QST0uNSpNYXRoLlBJLE1hdGguVFdPX1BJPTIqTWF0aC5QSTtNYXRoLnJhZFRvRGVnPWZ1bmN0aW9uKGUpe3JldHVybiBlL3R9LE1hdGguZGVnVG9SYWQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUqdH0sTnVtYmVyLmlzTnVtZXJpYz10PT4haXNOYU4ocGFyc2VGbG9hdCh0KSkmJmlzRmluaXRlKHQpLFN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbD1mdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnJlcGxhY2UobmV3IFJlZ0V4cCh0LCJnIiksZSl9O2Z1bmN0aW9uIGUodCxlPTAscz01KXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkodCwoZnVuY3Rpb24odCxlKXtyZXR1cm4gZSYmZS50b0ZpeGVkP051bWJlcihlLnRvRml4ZWQocykpOmV9KSxlKX1TdHJpbmcucHJvdG90eXBlLmhhc2g9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24odCl7bGV0IGUscyxhLGk9MDtpZigwPT09dC5sZW5ndGgpcmV0dXJuIGk7Zm9yKGU9MCxhPXQubGVuZ3RoO2U8YTtlKyspcz10LmNoYXJDb2RlQXQoZSksaT0oaTw8NSktaStzLGl8PTA7cmV0dXJuIE1hdGguYWJzKGkpfSh0aGlzKX0sU3RyaW5nLnByb3RvdHlwZS50cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzK3xccyskL2csIiIpfSxTdHJpbmcucHJvdG90eXBlLmx0cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzKy8sIiIpfSxTdHJpbmcucHJvdG90eXBlLnJ0cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXHMrJC8sIiIpfSxTdHJpbmcucHJvdG90eXBlLmxwYWQ9ZnVuY3Rpb24odCxlKXtsZXQgcz10aGlzO2Zvcig7cy5sZW5ndGg8ZTspcz10K3M7cmV0dXJuIHN9LFN0cmluZy5wcm90b3R5cGUucnBhZD1mdW5jdGlvbih0LGUpe2xldCBzPXRoaXM7Zm9yKDtzLmxlbmd0aDxlOylzKz10O3JldHVybiBzfSxNYXRoLnJhbmRvbUludD1mdW5jdGlvbih0LGUpe3JldHVybiB0PU1hdGguY2VpbCh0KSxlPU1hdGguZmxvb3IoZSksTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihlLXQpKSt0fSxNYXRoLmxlcnA9KHQsZSxzKT0+dCtzKihlLXQpLE1hdGguY2xhbXA9ZnVuY3Rpb24odCxlLHMpe3JldHVybiBNYXRoLm1pbihNYXRoLm1heCh0LGUpLHMpfSxNYXRoLm5lYXJlc3RQb3cyPWZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdygyLE1hdGgucm91bmQoTWF0aC5sb2codCkvTWF0aC5sb2coMikpKX0sTWF0aC5uZWFyZXN0UG93MTA9ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGgucG93KDEwLE1hdGgucm91bmQoTWF0aC5sb2cxMCh0KS9NYXRoLmxvZzEwKDEwKSkpfSxNYXRoLm5leHRQb3cyPWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKDt0PjA7KWUrKyx0Pj49MTtyZXR1cm4gMTw8ZX0sTWF0aC5mcmFjdD1mdW5jdGlvbih0KXtyZXR1cm4gMD09dD8wOnQ8MD90Pi0xPy10Oi10JU1hdGguZmxvb3IoLXQpOnQ8MT90OnQlTWF0aC5mbG9vcih0KX0sTWF0aC5yZW1hcD1mdW5jdGlvbih0LGUscyxhLGkpe3JldHVybiBhKyh0LWUpLyhzLWUpKihpLWEpfSxNYXRoLmNvbnZlcnRGbG9hdDMyQXJyYXlUb1VJbnQxNkFycmF5PWZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IFVpbnQxNkFycmF5KHQubGVuZ3RoKSxzPW5ldyBJbnQzMkFycmF5KHQuYnVmZmVyKSxhPXQ9PntsZXQgZT10Pj4xNiYzMjc2OCxzPXQ+PjEyJjIwNDc7Y29uc3QgYT10Pj4yMyYyNTU7cmV0dXJuIGE8MTAzP2U6YT4xNDI/KGV8PTMxNzQ0LGV8PSgyNTU9PWE/MDoxKSYmODM4ODYwNyZ0LGUpOmE8MTEzPyhzfD0yMDQ4LGV8PShzPj4xMTQtYSkrKHM+PjExMy1hJjEpLGUpOihlfD1hLTExMjw8MTB8cz4+MSxlKz0xJnMsZSl9O2ZvcihsZXQgaT0wO2k8dC5sZW5ndGg7aSsrKWVbaV09YShzW2ldKTtyZXR1cm4gZX0sTWF0aC5kZWNvZGUxNkJpdEZsb2F0RnJvbTJ4VUludDg9dD0+e2NvbnN0IGU9dFswXSxzPSgxMjAmZSk+PjM7bGV0IGE9MD09cz8wOjIwNDg7Y29uc3QgaT1hKygoNyZlKTw8OCkrdFsxXTthPTA9PXM/MTowO3JldHVybigxMjgmZT8xOi0xKSppKk1hdGgucG93KDIscythLTE2KX0sTWF0aC5lbmNvZGUxNkJpdEZsb2F0SW50bzJ4VUludDg9dD0+e2N8fChjPW5ldyBVaW50OEFycmF5KDIpKTtjb25zdCBlPXQ+PTA/MTI4OjA7dD1NYXRoLmFicyh0KTtsZXQgcyxhPTE1LGk9MTAyNDtmb3IobGV0IGU9MTU7ZT4wO2UtLSl0PGkmJihpLz0yLGEtLSk7cz0wPT1hP3QvaS8yOih0LWkpL2k7Y29uc3Qgcj1NYXRoLnJvdW5kKDIwNDgqcyksbj1yLzI1NixoPXItMjU2Km47cmV0dXJuIGNbMF09ZSs4KmErbixjWzFdPWgsdD49MjA0OCYmKGNbMF09MjU1KSxjfSxNYXRoLmVuY29kZTE2Qml0RmxvYXQ9dD0+e2NvbnN0IGU9bmV3IEZsb2F0MzJBcnJheSgxKTtlWzBdPXQ7cmV0dXJuKHQ9PntsZXQgZT10Pj4xNiYzMjc2OCxzPXQ+PjEyJjIwNDc7Y29uc3QgYT10Pj4yMyYyNTU7cmV0dXJuIGE8MTAzP2U6YT4xNDI/KGV8PTMxNzQ0LGV8PSgyNTU9PWE/MDoxKSYmODM4ODYwNyZ0LGUpOmE8MTEzPyhzfD0yMDQ4LGV8PShzPj4xMTQtYSkrKHM+PjExMy1hJjEpLGUpOihlfD1hLTExMjw8MTB8cz4+MSxlKz0xJnMsZSl9KShuZXcgSW50MzJBcnJheShlLmJ1ZmZlcilbMF0pfSxNYXRoLmRlY29kZTE2Qml0RmxvYXQ9dD0+e2NvbnN0IGU9KDMyNzY4JnQpPj4xNSxzPSgzMTc0NCZ0KT4+MTAsYT0xMDIzJnQ7cmV0dXJuIDA9PXM/KGU/LTE6MSkqTWF0aC5wb3coMiwtMTQpKihhL01hdGgucG93KDIsMTApKTozMT09cz9hP05hTjoxLzAqKGU/LTE6MSk6KGU/LTE6MSkqTWF0aC5wb3coMixzLTE1KSooMSthL01hdGgucG93KDIsMTApKX0sTWF0aC5zbW9vdGhTdGVwPSh0LGUscyk9Pntjb25zdCBhPU1hdGguY2xhbXAoKHMtdCkvKGUtdCksMCwxKTtyZXR1cm4gYSphKigzLTIqYSl9LE1hdGgubGluU3RlcD0odCxlLHMpPT5NYXRoLmNsYW1wKChzLXQpLyhlLXQpLDAsMSk7Y2xhc3Mgc3tpc1ZhbGlkKCl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5fX2RhdGEpaWYodD09MS8wfHxpc05hTih0KSlyZXR1cm4hMTtyZXR1cm4hMH1zdGF0aWMgY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodCxlKXt0aHJvdyBuZXcgRXJyb3IoIk5vdCB5ZXQgaW1wbGVtZW50ZWQgZm9yIHRoaXMgdHlwZToiK3RoaXMuY29uc3RydWN0b3IubmFtZSl9c3RhdGljIG51bUVsZW1lbnRzKCl7dGhyb3cgbmV3IEVycm9yKCJOb3QgeWV0IGltcGxlbWVudGVkIGZvciB0aGlzIHR5cGU6Iit0aGlzLmNvbnN0cnVjdG9yLm5hbWUpfWFzQXJyYXkoKXtyZXR1cm4gdGhpcy5fX2RhdGF9dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX10b0pTT04oKXt0aHJvdyBuZXcgRXJyb3IoIk5vdCB5ZXQgaW1wbGVtZW50ZWQgZm9yIHRoaXMgdHlwZToiK3RoaXMuY29uc3RydWN0b3IubmFtZSl9fWNvbnN0IGE9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5fX3R5cGVzPXt9LHRoaXMuX19uYW1lcz17fSx0aGlzLnJlZ2lzdGVyVHlwZSgiU0ludDMyIiw1KSx0aGlzLnJlZ2lzdGVyVHlwZSgiVUludDMyIiw0KSx0aGlzLnJlZ2lzdGVyVHlwZSgiRmxvYXQzMiIsNil9cmVnaXN0ZXJUeXBlKHQsZSl7dGhpcy5fX3R5cGVzW3RdPWUsZS5uYW1lP3RoaXMuX19uYW1lc1tlLm5hbWVdPXQ6dGhpcy5fX25hbWVzW2VdPXR9Z2V0VHlwZSh0KXtyZXR1cm4gdGhpcy5fX3R5cGVzW3RdfWdldFR5cGVOYW1lKHQpe2lmKHRoaXMuX19uYW1lc1t0XSlyZXR1cm4gdGhpcy5fX25hbWVzW3RdO2lmKHRoaXMuX19uYW1lc1t0Lm5hbWVdKXJldHVybiB0aGlzLl9fbmFtZXNbdC5uYW1lXTt0aHJvdyB0fX07Y2xhc3MgaSBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgVWludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsMil9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMiksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMiksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lKX1nZXQgeCgpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgeCh0KXt0aGlzLl9fZGF0YVswXT10fWdldCB5KCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCB5KHQpe3RoaXMuX19kYXRhWzFdPXR9c2V0KHQsZSl7dGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lfXNldEZyb21PdGhlcih0KXt0aGlzLng9dC54LHRoaXMueT10Lnl9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueX1ub3RFcXVhbHModCl7cmV0dXJuIHRoaXMueCE9dC54JiZ0aGlzLnkhPXQueX1hcHByb3hFcXVhbCh0LGU9TnVtYmVyLkVQU0lMT04pe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KTxlJiZNYXRoLmFicyh0aGlzLnktdC55KTxlfWFkZCh0KXtyZXR1cm4gbmV3IGkodGhpcy54K3QueCx0aGlzLnkrdC55KX1hZGRJblBsYWNlKHQpe3RoaXMueCs9dC54LHRoaXMueSs9dC55fXN1YnRyYWN0KHQpe3JldHVybiBuZXcgaSh0aGlzLngtdC54LHRoaXMueS10LnkpfXN1YnRyYWN0SW5QbGFjZSh0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpc31zY2FsZSh0KXtyZXR1cm4gbmV3IGkodGhpcy54KnQsdGhpcy55KnQpfXNjYWxlSW5QbGFjZSh0KXt0aGlzLngqPXQsdGhpcy55Kj10fWludmVydCgpe3JldHVybiBuZXcgaSgxL3RoaXMueCwxL3RoaXMueSl9aW52ZXJ0SW5QbGFjZSgpe3JldHVybiB0aGlzLng9MS90aGlzLngsdGhpcy55PTEvdGhpcy55LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIG5ldyBpKHRoaXMueCp0LngsdGhpcy55KnQueSl9bXVsdGlwbHlJblBsYWNlKHQpe3RoaXMueCo9dC54LHRoaXMueSo9dC55fWxlbmd0aFNxdWFyZWQoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV07cmV0dXJuIHQqdCtlKmV9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLmxlbmd0aFNxdWFyZWQoKSl9ZGlzdGFuY2VUbyh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdLXQueCxzPXRoaXMuX19kYXRhWzFdLXQueTtyZXR1cm4gTWF0aC5zcXJ0KGUqZStzKnMpfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXTtsZXQgcz10KnQrZSplO3JldHVybiBzPE51bWJlci5FUFNJTE9OP25ldyBpOihzPTEvTWF0aC5zcXJ0KHMpLG5ldyBpKHQqcyxlKnMpKX1ub3JtYWxpemVJblBsYWNlKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdO2xldCBzPXQqdCtlKmU7czxOdW1iZXIuRVBTSUxPTnx8KHM9MS9NYXRoLnNxcnQocyksdGhpcy5zZXQodCpzLGUqcykpfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55fWNyb3NzKHQpe3JldHVybiB0aGlzLngqdC55LXRoaXMueSp0Lnh9YW5nbGVUbyh0KXtjb25zdCBlPXRoaXMubm9ybWFsaXplKCkuZG90KHQubm9ybWFsaXplKCkpO3JldHVybiBlPjE/MDplPC0xP01hdGguUEk6TWF0aC5hY29zKGUpfXNpZ25lZEFuZ2xlVG8odCl7Y29uc3QgZT10aGlzLmFuZ2xlVG8odCk7cmV0dXJuIHRoaXMuY3Jvc3ModCk8MD8tZTplfXJvdGF0ZSh0KXtjb25zdCBlPU1hdGguY29zKHQpLHM9TWF0aC5zaW4odCk7cmV0dXJuIG5ldyBpKHRoaXMueCplLXRoaXMueSpzLHRoaXMueCpzK3RoaXMueSplKX1sZXJwKHQsZSl7Y29uc3Qgcz10aGlzLngsYT10aGlzLnk7cmV0dXJuIG5ldyBpKHMrZSoodC54LXMpLGErZSoodC55LWEpKX1zZXRSYW5kb21EaXIodD0xKXtjb25zdCBlPTIqTWF0aC5yYW5kb20oKSpNYXRoLlBJO3JldHVybiB0aGlzLl9fZGF0YVswXT1NYXRoLmNvcyhlKSp6U2NhbGUsdGhpcy5fX2RhdGFbMV09TWF0aC5zaW4oZSkqelNjYWxlLHRoaXN9c2V0UmFuZG9tKHQ9MSl7cmV0dXJuIHRoaXMuX19kYXRhWzBdPU1hdGgucmFuZG9tKCkqdCx0aGlzLl9fZGF0YVsxXT1NYXRoLnJhbmRvbSgpKnQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgaSh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgaSguLi50KX1zdGF0aWMgY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodCxlPTApe3JldHVybiBuZXcgaSh0LDQqZSl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQXJyYXkodCl7cmV0dXJuIG5ldyBpKHQpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiAyfXRvSlNPTigpe3JldHVybnt4OnRoaXMueCx5OnRoaXMueX19ZnJvbUpTT04odCl7dGhpcy54PXQueCx0aGlzLnk9dC55fX1hLnJlZ2lzdGVyVHlwZSgiVmVjMiIsaSk7Y2xhc3MgciBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCxzPTApe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsMyl9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMyksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMyksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXMpfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCB4eSgpe3JldHVybiBuZXcgaSh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSl9Z2V0IHl6KCl7cmV0dXJuIG5ldyBpKHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdKX1zZXQodCxlLHMpe3RoaXMueD10LHRoaXMueT12b2lkIDAhPT1lP2U6dCx0aGlzLno9dm9pZCAwIT09cz9zOnR9c2V0RGF0YUFycmF5KHQpe3RoaXMuX19kYXRhPXR9c2V0RnJvbU90aGVyKHQpe3RoaXMueD10LngsdGhpcy55PXQueSx0aGlzLno9dC56fWlzTnVsbCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicyh0aGlzLnkpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicyh0aGlzLnopPE51bWJlci5FUFNJTE9OfWlzMTExKCl7cmV0dXJuIE1hdGguYWJzKDEtdGhpcy54KTxOdW1iZXIuRVBTSUxPTiYmTWF0aC5hYnMoMS10aGlzLnkpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicygxLXRoaXMueik8TnVtYmVyLkVQU0lMT059ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10Lnp9bm90RXF1YWxzKHQpe3JldHVybiB0aGlzLnghPXQueCYmdGhpcy55IT10LnkmJnRoaXMueiE9dC56fWFwcHJveEVxdWFsKHQsZT1OdW1iZXIuRVBTSUxPTil7cmV0dXJuIE1hdGguYWJzKHRoaXMueC10LngpPGUmJk1hdGguYWJzKHRoaXMueS10LnkpPGUmJk1hdGguYWJzKHRoaXMuei10LnopPGV9YWRkKHQpe3JldHVybiBuZXcgcih0aGlzLngrdC54LHRoaXMueSt0LnksdGhpcy56K3Queil9YWRkSW5QbGFjZSh0KXt0aGlzLngrPXQueCx0aGlzLnkrPXQueSx0aGlzLnorPXQuen1zdWJ0cmFjdCh0KXtyZXR1cm4gbmV3IHIodGhpcy54LXQueCx0aGlzLnktdC55LHRoaXMuei10LnopfXN1YnRyYWN0SW5QbGFjZSh0KXt0aGlzLngtPXQueCx0aGlzLnktPXQueSx0aGlzLnotPXQuen1tdWx0aXBseSh0KXtyZXR1cm4gbmV3IHIodGhpcy54KnQueCx0aGlzLnkqdC55LHRoaXMueip0LnopfW11bHRpcGx5SW5QbGFjZSh0KXt0aGlzLngqPXQueCx0aGlzLnkqPXQueSx0aGlzLnoqPXQuen1kaXZpZGUodCl7cmV0dXJuIG5ldyByKHRoaXMueC90LngsdGhpcy55L3QueSx0aGlzLnovdC56KX1kaXZpZGVJblBsYWNlKHQpe3RoaXMueC89dC54LHRoaXMueS89dC55LHRoaXMuei89dC56fXNjYWxlKHQpe3JldHVybiBuZXcgcih0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10fW5lZ2F0ZSgpe3JldHVybiBuZXcgcigtdGhpcy54LC10aGlzLnksLXRoaXMueil9aW52ZXJzZSgpe3JldHVybiBuZXcgcigxL3RoaXMueCwxL3RoaXMueSwxL3RoaXMueil9bGVuZ3RoU3F1YXJlZCgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdO3JldHVybiB0KnQrZSplK3Mqc31sZW5ndGgoKXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3F1YXJlZCgpKX1kaXN0YW5jZVRvKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0tdC54LHM9dGhpcy5fX2RhdGFbMV0tdC55LGE9dGhpcy5fX2RhdGFbMl0tdC56O3JldHVybiBNYXRoLnNxcnQoZSplK3MqcythKmEpfW5vcm1hbGl6ZSgpe2xldCB0PXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO3JldHVybiB0PE51bWJlci5FUFNJTE9OP25ldyByOih0PTEvTWF0aC5zcXJ0KHQpLG5ldyByKHRoaXMuX19kYXRhWzBdKnQsdGhpcy5fX2RhdGFbMV0qdCx0aGlzLl9fZGF0YVsyXSp0KSl9bm9ybWFsaXplSW5QbGFjZSgpe2xldCB0PXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO2lmKHQ8TnVtYmVyLkVQU0lMT04pcmV0dXJuO3Q9TWF0aC5zcXJ0KHQpO2NvbnN0IGU9MS90O3JldHVybiB0aGlzLl9fZGF0YVswXSo9ZSx0aGlzLl9fZGF0YVsxXSo9ZSx0aGlzLl9fZGF0YVsyXSo9ZSx0fXJlc2l6ZSh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO2lmKGU8TnVtYmVyLkVQU0lMT04pcmV0dXJuO2NvbnN0IHM9dC9NYXRoLnNxcnQoZSk7cmV0dXJuIG5ldyByKHRoaXMuX19kYXRhWzBdKnMsdGhpcy5fX2RhdGFbMV0qcyx0aGlzLl9fZGF0YVsyXSpzKX1yZXNpemVJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0qdGhpcy5fX2RhdGFbMF0rdGhpcy5fX2RhdGFbMV0qdGhpcy5fX2RhdGFbMV0rdGhpcy5fX2RhdGFbMl0qdGhpcy5fX2RhdGFbMl07aWYoZTxOdW1iZXIuRVBTSUxPTilyZXR1cm47Y29uc3Qgcz10L01hdGguc3FydChlKTt0aGlzLl9fZGF0YVswXSo9cyx0aGlzLl9fZGF0YVsxXSo9cyx0aGlzLl9fZGF0YVsyXSo9c31kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56fWNyb3NzKHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dC54LG49dC55LGg9dC56O3JldHVybiBuZXcgcihzKmgtYSpuLGEqaS1lKmgsZSpuLXMqaSl9YW5nbGVUbyh0KXtjb25zdCBlPXRoaXMuZG90KHQpO3JldHVybiBlPjE/MDpNYXRoLmFjb3MoZSl9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy54LGE9dGhpcy55LGk9dGhpcy56O3JldHVybiBuZXcgcihzK2UqKHQueC1zKSxhK2UqKHQueS1hKSxpK2UqKHQuei1pKSl9YWJzKCl7cmV0dXJuIG5ldyByKE1hdGguYWJzKHRoaXMueCksTWF0aC5hYnModGhpcy55KSxNYXRoLmFicyh0aGlzLnopKX1zZXRSYW5kb21EaXIodD0xKXtjb25zdCBlPTIqTWF0aC5yYW5kb20oKSpNYXRoLlBJLHM9MipNYXRoLnJhbmRvbSgpLTEsYT1NYXRoLnNxcnQoMS1zKnMpKnQ7cmV0dXJuIHRoaXMuX19kYXRhWzBdPU1hdGguY29zKGUpKmEsdGhpcy5fX2RhdGFbMV09TWF0aC5zaW4oZSkqYSx0aGlzLl9fZGF0YVsyXT1zKnQsdGhpc31zZXRSYW5kb20odD0xKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpcy5fX2RhdGFbMV09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpcy5fX2RhdGFbMl09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgcih0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgciguLi50KX1zdGF0aWMgY3JlYXRlRnJvbUpTT04odCl7Y29uc3QgZT1uZXcgcjtyZXR1cm4gZS5mcm9tSlNPTih0KSxlfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyByKHQsNCplKX1zdGF0aWMgY3JlYXRlRnJvbUZsb2F0MzJBcnJheSh0KXtyZXR1cm4gbmV3IHIodCl9c3RhdGljIG51bUVsZW1lbnRzKCl7cmV0dXJuIDN9dG9KU09OKCl7cmV0dXJue3g6dGhpcy54LHk6dGhpcy55LHo6dGhpcy56fX1mcm9tSlNPTih0KXt0aGlzLng9dC54LHRoaXMueT10LnksdGhpcy56PXQuen19YS5yZWdpc3RlclR5cGUoIlZlYzMiLHIpO2NsYXNzIG4gZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MCl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoNCksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoNCksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXMsdGhpcy5fX2RhdGFbM109YSl9Z2V0IHgoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF19c2V0IHgodCl7dGhpcy5fX2RhdGFbMF09dH1nZXQgeSgpe3JldHVybiB0aGlzLl9fZGF0YVsxXX1zZXQgeSh0KXt0aGlzLl9fZGF0YVsxXT10fWdldCB6KCl7cmV0dXJuIHRoaXMuX19kYXRhWzJdfXNldCB6KHQpe3RoaXMuX19kYXRhWzJdPXR9Z2V0IHQoKXtyZXR1cm4gdGhpcy5fX2RhdGFbM119c2V0IHQodCl7dGhpcy5fX2RhdGFbM109dH1nZXQgeHl6KCl7cmV0dXJuIG5ldyByKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdKX1zZXQodCxlLHMsYSl7dGhpcy54PXQsdGhpcy55PWUsdGhpcy56PXMsdGhpcy50PWF9c2V0RnJvbU90aGVyKHQpe3RoaXMueD10LngsdGhpcy55PXQueSx0aGlzLno9dC56LHRoaXMudD10LnR9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10LnomJnRoaXMudD09dC50fW5vdEVxdWFscyh0KXtyZXR1cm4gdGhpcy54IT10LngmJnRoaXMueSE9dC55JiZ0aGlzLnohPXQueiYmdGhpcy50IT10LnR9YXBwcm94RXF1YWwodCxlPU51bWJlci5FUFNJTE9OKXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCk8ZSYmTWF0aC5hYnModGhpcy55LXQueSk8ZSYmTWF0aC5hYnModGhpcy56LXQueik8ZSYmTWF0aC5hYnModGhpcy50LXQudCk8ZX1hZGQodCl7cmV0dXJuIG5ldyBuKHRoaXMueCt0LngsdGhpcy55K3QueSx0aGlzLnordC56LHRoaXMudCt0LnQpfWFkZEluUGxhY2UodCl7dGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy50Kz10LnR9c3VidHJhY3QodCl7cmV0dXJuIG5ldyBuKHRoaXMueC10LngsdGhpcy55LXQueSx0aGlzLnotdC56LHRoaXMudC10LnQpfXN1YnRyYWN0SW5QbGFjZSh0KXt0aGlzLngtPXQueCx0aGlzLnktPXQueSx0aGlzLnotPXQueix0aGlzLnQtPXQudH1tdWx0aXBseSh0KXtyZXR1cm4gbmV3IG4odGhpcy54KnQueCx0aGlzLnkqdC55LHRoaXMueip0LnosdGhpcy50KnQudCl9bXVsdGlwbHlJblBsYWNlKHQpe3RoaXMueCo9dC54LHRoaXMueSo9dC55LHRoaXMueio9dC56LHRoaXMudCo9dC50fWRpdmlkZSh0KXtyZXR1cm4gbmV3IG4odGhpcy54L3QueCx0aGlzLnkvdC55LHRoaXMuei90LnosdGhpcy50L3QudCl9ZGl2aWRlSW5QbGFjZSh0KXt0aGlzLngvPXQueCx0aGlzLnkvPXQueSx0aGlzLnovPXQueix0aGlzLnQvPXQudH1zY2FsZSh0KXtyZXR1cm4gbmV3IG4odGhpcy54KnQsdGhpcy55KnQsdGhpcy56KnQsdGhpcy50KnQpfXNjYWxlSW5QbGFjZSh0KXt0aGlzLnNldCh0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCx0aGlzLnQqdCl9bGVuZ3RoKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVsyXTtyZXR1cm4gTWF0aC5zcXJ0KHQqdCtlKmUrcypzK2EqYSl9bGVuZ3RoU3F1YXJlZCgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107cmV0dXJuIHQqdCtlKmUrcypzK2EqYX1ub3JtYWxpemUoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO2xldCBpPXQqdCtlKmUrcypzK2EqYTtyZXR1cm4gaTxOdW1iZXIuRVBTSUxPTj9uZXcgbjooaT0xL01hdGguc3FydChpKSxuZXcgbih0KmksZSppLHMqaSkpfW5vcm1hbGl6ZUluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO2xldCBpPXQqdCtlKmUrcypzK2EqYTtpPE51bWJlci5FUFNJTE9OfHwoaT0xL01hdGguc3FydChpKSx0aGlzLnNldCh0KmksZSppLHMqaSxhKmkpKX1kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56K3RoaXMudCpiLnR9Y3Jvc3ModCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksYT10aGlzLnosaT10aGlzLnQscj10LngsaD10Lnksbz10LnosXz10LnQ7cmV0dXJuIG5ldyBuKHMqby1hKmgsYSpfLWkqbyxpKnItZSpfLGUqaC1zKnIpfWFuZ2xlVG8odCl7Y29uc3QgZT10aGlzLm5vcm1hbGl6ZSgpLHM9dC5ub3JtYWxpemUoKSxhPWUuZG90KHMpO3JldHVybiBhPjE/MDpNYXRoLmFjb3MoYSl9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy54LGE9dGhpcy55LGk9dGhpcy56O3JldHVybiBhdD10aGlzLnQsbmV3IG4ocytlKih0LngtcyksYStlKih0LnktYSksaStlKih0LnotaSksYXQrZSoodC50LWF0KSl9cmFuZG9tKHQ9MSl7Y29uc3QgZT0yKmdsTWF0cml4LlJBTkRPTSgpKk1hdGguUEkscz0yKmdsTWF0cml4LlJBTkRPTSgpLTEsYT1NYXRoLnNxcnQoMS1zKnMpKnQ7cmV0dXJuIG91dFswXT1NYXRoLmNvcyhlKSphLG91dFsxXT1NYXRoLnNpbihlKSphLG91dFsyXT1zKnQsb3V0fWNsb25lKCl7cmV0dXJuIG5ldyBuKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdKX10b1ZlYzMoKXtyZXR1cm4gbmV3IHIodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0pfWFzQXJyYXkoKXtyZXR1cm4gdGhpcy5fX2RhdGF9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IHIoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IG4odCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fXRvSlNPTigpe3JldHVybnt4OnRoaXMueCx5OnRoaXMueSx6OnRoaXMueix0OnRoaXMudH19fWEucmVnaXN0ZXJUeXBlKCJWZWM0IixuKTtjbGFzcyBoIGV4dGVuZHMgc3tjb25zdHJ1Y3Rvcih0PTAsZT0wLHM9MCxhPTI1NSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl0aGlzLl9fZGF0YT10O2Vsc2UgaWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBVaW50OEFycmF5KHMsYSw0KX1lbHNlIHRoaXMuX19kYXRhPW5ldyBVaW50OEFycmF5KDQpLCJzdHJpbmciPT10eXBlb2YgdD90LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tQ1NTQ29sb3JOYW1lKHQpOih0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hKX1nZXQgcigpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgcih0KXt0aGlzLl9fZGF0YVswXT10fWdldCBnKCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCBnKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IGIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IGIodCl7dGhpcy5fX2RhdGFbMl09dH1nZXQgYSgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgYSh0KXt0aGlzLl9fZGF0YVszXT10fXNldCh0LGUscyxhPTI1NSl7dGhpcy5yPXQsdGhpcy5nPWUsdGhpcy5iPXMsdGhpcy5hPWF9c2V0RnJvbU90aGVyKHQpe3RoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXMuYT10LmF9c2V0RnJvbUFycmF5KHQpe3RoaXMucj10WzBdLHRoaXMuZz10WzFdLHRoaXMuYj10WzJdLHRoaXMuYT00PT10Lmxlbmd0aD90WzNdOjF9c2V0RnJvbUhleCh0KXtjb25zdCBlPWZ1bmN0aW9uKHQpe2NvbnN0IGU9L14jPyhbYS1mXGRdezJ9KShbYS1mXGRdezJ9KShbYS1mXGRdezJ9KSQvaS5leGVjKHQpO3JldHVybiBlP3tyOnBhcnNlSW50KGVbMV0sMTYpLGc6cGFyc2VJbnQoZVsyXSwxNiksYjpwYXJzZUludChlWzNdLDE2KX06bnVsbH0odCk7ZT90aGlzLnNldChlLnIsZS5nLGUuYik6Y29uc29sZS53YXJuKCJJbnZhbGlkIGhleCBjb2RlOiIrdCl9c2V0RnJvbUNTU0NvbG9yTmFtZSh0KXt0LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tSGV4KCh0PT57Y29uc3QgZT17YWxpY2VibHVlOiIjZjBmOGZmIixhbnRpcXVld2hpdGU6IiNmYWViZDciLGFxdWE6IiMwMGZmZmYiLGFxdWFtYXJpbmU6IiM3ZmZmZDQiLGF6dXJlOiIjZjBmZmZmIixiZWlnZToiI2Y1ZjVkYyIsYmlzcXVlOiIjZmZlNGM0IixibGFjazoiIzAwMDAwMCIsYmxhbmNoZWRhbG1vbmQ6IiNmZmViY2QiLGJsdWU6IiMwMDAwZmYiLGJsdWV2aW9sZXQ6IiM4YTJiZTIiLGJyb3duOiIjYTUyYTJhIixidXJseXdvb2Q6IiNkZWI4ODciLGNhZGV0Ymx1ZToiIzVmOWVhMCIsY2hhcnRyZXVzZToiIzdmZmYwMCIsY2hvY29sYXRlOiIjZDI2OTFlIixjb3JhbDoiI2ZmN2Y1MCIsY29ybmZsb3dlcmJsdWU6IiM2NDk1ZWQiLGNvcm5zaWxrOiIjZmZmOGRjIixjcmltc29uOiIjZGMxNDNjIixjeWFuOiIjMDBmZmZmIixkYXJrYmx1ZToiIzAwMDA4YiIsZGFya2N5YW46IiMwMDhiOGIiLGRhcmtnb2xkZW5yb2Q6IiNiODg2MGIiLGRhcmtncmF5OiIjYTlhOWE5IixkYXJrZ3JlZW46IiMwMDY0MDAiLGRhcmtraGFraToiI2JkYjc2YiIsZGFya21hZ2VudGE6IiM4YjAwOGIiLGRhcmtvbGl2ZWdyZWVuOiIjNTU2YjJmIixkYXJrb3JhbmdlOiIjZmY4YzAwIixkYXJrb3JjaGlkOiIjOTkzMmNjIixkYXJrcmVkOiIjOGIwMDAwIixkYXJrc2FsbW9uOiIjZTk5NjdhIixkYXJrc2VhZ3JlZW46IiM4ZmJjOGYiLGRhcmtzbGF0ZWJsdWU6IiM0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IiMyZjRmNGYiLGRhcmt0dXJxdW9pc2U6IiMwMGNlZDEiLGRhcmt2aW9sZXQ6IiM5NDAwZDMiLGRlZXBwaW5rOiIjZmYxNDkzIixkZWVwc2t5Ymx1ZToiIzAwYmZmZiIsZGltZ3JheToiIzY5Njk2OSIsZG9kZ2VyYmx1ZToiIzFlOTBmZiIsZmlyZWJyaWNrOiIjYjIyMjIyIixmbG9yYWx3aGl0ZToiI2ZmZmFmMCIsZm9yZXN0Z3JlZW46IiMyMjhiMjIiLGZ1Y2hzaWE6IiNmZjAwZmYiLGdhaW5zYm9ybzoiI2RjZGNkYyIsZ2hvc3R3aGl0ZToiI2Y4ZjhmZiIsZ29sZDoiI2ZmZDcwMCIsZ29sZGVucm9kOiIjZGFhNTIwIixncmF5OiIjODA4MDgwIixncmVlbjoiIzAwODAwMCIsZ3JlZW55ZWxsb3c6IiNhZGZmMmYiLGhvbmV5ZGV3OiIjZjBmZmYwIixob3RwaW5rOiIjZmY2OWI0IiwiaW5kaWFucmVkICI6IiNjZDVjNWMiLGluZGlnbzoiIzRiMDA4MiIsaXZvcnk6IiNmZmZmZjAiLGtoYWtpOiIjZjBlNjhjIixsYXZlbmRlcjoiI2U2ZTZmYSIsbGF2ZW5kZXJibHVzaDoiI2ZmZjBmNSIsbGF3bmdyZWVuOiIjN2NmYzAwIixsZW1vbmNoaWZmb246IiNmZmZhY2QiLGxpZ2h0Ymx1ZToiI2FkZDhlNiIsbGlnaHRjb3JhbDoiI2YwODA4MCIsbGlnaHRjeWFuOiIjZTBmZmZmIixsaWdodGdvbGRlbnJvZHllbGxvdzoiI2ZhZmFkMiIsbGlnaHRncmV5OiIjZDNkM2QzIixsaWdodGdyZWVuOiIjOTBlZTkwIixsaWdodHBpbms6IiNmZmI2YzEiLGxpZ2h0c2FsbW9uOiIjZmZhMDdhIixsaWdodHNlYWdyZWVuOiIjMjBiMmFhIixsaWdodHNreWJsdWU6IiM4N2NlZmEiLGxpZ2h0c2xhdGVncmF5OiIjNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiI2IwYzRkZSIsbGlnaHR5ZWxsb3c6IiNmZmZmZTAiLGxpbWU6IiMwMGZmMDAiLGxpbWVncmVlbjoiIzMyY2QzMiIsbGluZW46IiNmYWYwZTYiLG1hZ2VudGE6IiNmZjAwZmYiLG1hcm9vbjoiIzgwMDAwMCIsbWVkaXVtYXF1YW1hcmluZToiIzY2Y2RhYSIsbWVkaXVtYmx1ZToiIzAwMDBjZCIsbWVkaXVtb3JjaGlkOiIjYmE1NWQzIixtZWRpdW1wdXJwbGU6IiM5MzcwZDgiLG1lZGl1bXNlYWdyZWVuOiIjM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IiM3YjY4ZWUiLG1lZGl1bXNwcmluZ2dyZWVuOiIjMDBmYTlhIixtZWRpdW10dXJxdW9pc2U6IiM0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiI2M3MTU4NSIsbWlkbmlnaHRibHVlOiIjMTkxOTcwIixtaW50Y3JlYW06IiNmNWZmZmEiLG1pc3R5cm9zZToiI2ZmZTRlMSIsbW9jY2FzaW46IiNmZmU0YjUiLG5hdmFqb3doaXRlOiIjZmZkZWFkIixuYXZ5OiIjMDAwMDgwIixvbGRsYWNlOiIjZmRmNWU2IixvbGl2ZToiIzgwODAwMCIsb2xpdmVkcmFiOiIjNmI4ZTIzIixvcmFuZ2U6IiNmZmE1MDAiLG9yYW5nZXJlZDoiI2ZmNDUwMCIsb3JjaGlkOiIjZGE3MGQ2IixwYWxlZ29sZGVucm9kOiIjZWVlOGFhIixwYWxlZ3JlZW46IiM5OGZiOTgiLHBhbGV0dXJxdW9pc2U6IiNhZmVlZWUiLHBhbGV2aW9sZXRyZWQ6IiNkODcwOTMiLHBhcGF5YXdoaXA6IiNmZmVmZDUiLHBlYWNocHVmZjoiI2ZmZGFiOSIscGVydToiI2NkODUzZiIscGluazoiI2ZmYzBjYiIscGx1bToiI2RkYTBkZCIscG93ZGVyYmx1ZToiI2IwZTBlNiIscHVycGxlOiIjODAwMDgwIixyZWJlY2NhcHVycGxlOiIjNjYzMzk5IixyZWQ6IiNmZjAwMDAiLHJvc3licm93bjoiI2JjOGY4ZiIscm95YWxibHVlOiIjNDE2OWUxIixzYWRkbGVicm93bjoiIzhiNDUxMyIsc2FsbW9uOiIjZmE4MDcyIixzYW5keWJyb3duOiIjZjRhNDYwIixzZWFncmVlbjoiIzJlOGI1NyIsc2Vhc2hlbGw6IiNmZmY1ZWUiLHNpZW5uYToiI2EwNTIyZCIsc2lsdmVyOiIjYzBjMGMwIixza3libHVlOiIjODdjZWViIixzbGF0ZWJsdWU6IiM2YTVhY2QiLHNsYXRlZ3JheToiIzcwODA5MCIsc25vdzoiI2ZmZmFmYSIsc3ByaW5nZ3JlZW46IiMwMGZmN2YiLHN0ZWVsYmx1ZToiIzQ2ODJiNCIsdGFuOiIjZDJiNDhjIix0ZWFsOiIjMDA4MDgwIix0aGlzdGxlOiIjZDhiZmQ4Iix0b21hdG86IiNmZjYzNDciLHR1cnF1b2lzZToiIzQwZTBkMCIsdmlvbGV0OiIjZWU4MmVlIix3aGVhdDoiI2Y1ZGViMyIsd2hpdGU6IiNmZmZmZmYiLHdoaXRlc21va2U6IiNmNWY1ZjUiLHllbGxvdzoiI2ZmZmYwMCIseWVsbG93Z3JlZW46IiM5YWNkMzIifTtyZXR1cm4gdm9pZCAwIT09ZVt0LnRvTG93ZXJDYXNlKCldJiZlW3QudG9Mb3dlckNhc2UoKV19KSh0KSl9dG9IZXgoKXtmdW5jdGlvbiB0KHQpe2NvbnN0IGU9dC50b1N0cmluZygxNik7cmV0dXJuIDE9PWUubGVuZ3RoPyIwIitlOmV9cmV0dXJuIiMiK3QodGhpcy5yKSt0KHRoaXMuZykrdCh0aGlzLmIpfWVxdWFsKHQpe3JldHVybiB0aGlzLnI9PXQuciYmdGhpcy5nPT10LmcmJnRoaXMuYj09dC5iJiZ0aGlzLmE9PXQuYX1ub3RlcXVhbHModCl7cmV0dXJuIHRoaXMuciE9dC5yJiZ0aGlzLmchPXQuZyYmdGhpcy5iIT10LmImJnRoaXMuYSE9dC5hfWFwcHJveEVxdWFsKHQsZT1OdW1iZXIuRVBTSUxPTil7cmV0dXJuIE1hdGguYWJzKHRoaXMuci10LnIpPGUmJk1hdGguYWJzKHRoaXMuZy10LmcpPGUmJk1hdGguYWJzKHRoaXMuYi10LmIpPGUmJk1hdGguYWJzKHRoaXMuYS10LmEpPGV9YWRkKHQpe3JldHVybiBuZXcgaCh0aGlzLnIrdC5yLHRoaXMuZyt0LmcsdGhpcy5iK3QuYix0aGlzLmErdC5hKX1zdWJ0cmFjdCh0KXtyZXR1cm4gbmV3IGgodGhpcy5yLXQucix0aGlzLmctdC5nLHRoaXMuYi10LmIsdGhpcy5hLXQuYSl9c2NhbGUodCl7cmV0dXJuIG5ldyBoKHRoaXMucip0LHRoaXMuZyp0LHRoaXMuYip0LHRoaXMuYSp0KX1zY2FsZUluUGxhY2UodCl7dGhpcy5yKj10LHRoaXMuZyo9dCx0aGlzLmIqPXQsdGhpcy5hKj10fWFwcGx5R2FtbWEodCl7dGhpcy5zZXQoTWF0aC5wb3codGhpcy5yLHQpLE1hdGgucG93KHRoaXMuZyx0KSxNYXRoLnBvdyh0aGlzLmIsdCksdGhpcy5hKX10b0xpbmVhcih0PTIuMil7cmV0dXJuIG5ldyBoKE1hdGgucG93KHRoaXMucix0KSxNYXRoLnBvdyh0aGlzLmcsdCksTWF0aC5wb3codGhpcy5iLHQpLHRoaXMuYSl9dG9HYW1tYSh0PTIuMil7cmV0dXJuIG5ldyBoKE1hdGgucG93KHRoaXMuciwxL3QpLE1hdGgucG93KHRoaXMuZywxL3QpLE1hdGgucG93KHRoaXMuYiwxL3QpLHRoaXMuYSl9bHVtaW5hbmNlKCl7cmV0dXJuLjIxMjYqdGhpcy5yKy43MTUyKnRoaXMuZysuMDcyMip0aGlzLmJ9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy5yLGE9dGhpcy5nLGk9dGhpcy5iLHI9dGhpcy5hO3JldHVybiBuZXcgaChzK2UqKHQuci1zKSxhK2UqKHQuZy1hKSxpK2UqKHQuYi1pKSxyK2UqKHQuYS1yKSl9c3RhdGljIHJhbmRvbSh0PTAsZT0hMSl7cmV0dXJuIHQ+MD9uZXcgaCh0K01hdGgucmFuZG9tKCkqKDEtdCksdCtNYXRoLnJhbmRvbSgpKigxLXQpLHQrTWF0aC5yYW5kb20oKSooMS10KSxlP3QrTWF0aC5yYW5kb20oKSooMS10KToxKTp0PDA/bmV3IGgoTWF0aC5yYW5kb20oKSooMSt0KSxNYXRoLnJhbmRvbSgpKigxK3QpLE1hdGgucmFuZG9tKCkqKDErdCksZT9NYXRoLnJhbmRvbSgpKigxK3QpOjEpOm5ldyBoKE1hdGgucmFuZG9tKCksTWF0aC5yYW5kb20oKSxNYXRoLnJhbmRvbSgpLGU/TWF0aC5yYW5kb20oKToxKX1jbG9uZSgpe3JldHVybiBuZXcgaCh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXSx0aGlzLl9fZGF0YVszXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1hczNDb21wb25lbnRBcnJheSgpe3JldHVyblt0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXV19c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IGgoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IGgodCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fXRvSlNPTigpe3JldHVybntyOnRoaXMucixnOnRoaXMuZyxiOnRoaXMuYixhOnRoaXMuYX19ZnJvbUpTT04odCl7dGhpcy5yPXQucix0aGlzLmc9dC5nLHRoaXMuYj10LmIsdGhpcy5hPXQuYX10b0NTU1N0cmluZygpe3JldHVybiJyZ2JhKCIrTWF0aC5yb3VuZCgyNTUqdGhpcy5yKSsiLCAiK01hdGgucm91bmQoMjU1KnRoaXMuZykrIiwgIitNYXRoLnJvdW5kKDI1NSp0aGlzLmIpKyIsICIrdGhpcy5hKyIpIn19YS5yZWdpc3RlclR5cGUoIlJHQkEiLGgpO2NsYXNzIG8gZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSB0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDQpLCJzdHJpbmciPT10eXBlb2YgdD90LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tQ1NTQ29sb3JOYW1lKHQpOih0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hKX1nZXQgcigpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgcih0KXt0aGlzLl9fZGF0YVswXT10fWdldCBnKCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCBnKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IGIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IGIodCl7dGhpcy5fX2RhdGFbMl09dH1nZXQgYSgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgYSh0KXt0aGlzLl9fZGF0YVszXT10fXNldCh0LGUscyxhPTEpe3RoaXMucj10LHRoaXMuZz1lLHRoaXMuYj1zLHRoaXMuYT1hfXNldEZyb21PdGhlcih0KXt0aGlzLnI9dC5yLHRoaXMuZz10LmcsdGhpcy5iPXQuYix0aGlzLmE9dC5hfXNldEZyb21TY2FsYXJBcnJheSh0KXt0aGlzLnI9dFswXSx0aGlzLmc9dFsxXSx0aGlzLmI9dFsyXSx0aGlzLmE9ND09dC5sZW5ndGg/dFszXToxfWdldEFzUkdCQXJyYXkoKXtyZXR1cm5bMjU1KnRoaXMuciwyNTUqdGhpcy5nLDI1NSp0aGlzLmJdfWdldEFzUkdCRGljdCgpe3JldHVybntyOjI1NSp0aGlzLnIsZzoyNTUqdGhpcy5nLGI6MjU1KnRoaXMuYn19c2V0RnJvbVJHQih0LGUscyxhKXt0aGlzLnI9dC8yNTUsdGhpcy5nPWUvMjU1LHRoaXMuYj1zLzI1NSx0aGlzLmE9YT9hLzI1NToxfXNldEZyb21SR0JBcnJheSh0KXt0aGlzLnI9dFswXS8yNTUsdGhpcy5nPXRbMV0vMjU1LHRoaXMuYj10WzJdLzI1NSx0aGlzLmE9ND09dC5sZW5ndGg/dFszXS8yNTU6MX1zZXRGcm9tUkdCRGljdCh0KXt0aGlzLnI9dC5yLzI1NSx0aGlzLmc9dC5nLzI1NSx0aGlzLmI9dC5iLzI1NSx0aGlzLmE9ND09dC5hP3QuYS8yNTU6MX1zZXRGcm9tSGV4KHQpe2NvbnN0IGU9ZnVuY3Rpb24odCl7Y29uc3QgZT0vXiM/KFthLWZcZF17Mn0pKFthLWZcZF17Mn0pKFthLWZcZF17Mn0pJC9pLmV4ZWModCk7cmV0dXJuIGU/e3I6cGFyc2VJbnQoZVsxXSwxNiksZzpwYXJzZUludChlWzJdLDE2KSxiOnBhcnNlSW50KGVbM10sMTYpfTpudWxsfSh0KTtlP3RoaXMuc2V0RnJvbVJHQihlLnIsZS5nLGUuYik6Y29uc29sZS53YXJuKCJJbnZhbGlkIGhleCBjb2RlOiIrdCl9c2V0RnJvbUNTU0NvbG9yTmFtZSh0KXt0LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tSGV4KCh0PT57Y29uc3QgZT17YWxpY2VibHVlOiIjZjBmOGZmIixhbnRpcXVld2hpdGU6IiNmYWViZDciLGFxdWE6IiMwMGZmZmYiLGFxdWFtYXJpbmU6IiM3ZmZmZDQiLGF6dXJlOiIjZjBmZmZmIixiZWlnZToiI2Y1ZjVkYyIsYmlzcXVlOiIjZmZlNGM0IixibGFjazoiIzAwMDAwMCIsYmxhbmNoZWRhbG1vbmQ6IiNmZmViY2QiLGJsdWU6IiMwMDAwZmYiLGJsdWV2aW9sZXQ6IiM4YTJiZTIiLGJyb3duOiIjYTUyYTJhIixidXJseXdvb2Q6IiNkZWI4ODciLGNhZGV0Ymx1ZToiIzVmOWVhMCIsY2hhcnRyZXVzZToiIzdmZmYwMCIsY2hvY29sYXRlOiIjZDI2OTFlIixjb3JhbDoiI2ZmN2Y1MCIsY29ybmZsb3dlcmJsdWU6IiM2NDk1ZWQiLGNvcm5zaWxrOiIjZmZmOGRjIixjcmltc29uOiIjZGMxNDNjIixjeWFuOiIjMDBmZmZmIixkYXJrYmx1ZToiIzAwMDA4YiIsZGFya2N5YW46IiMwMDhiOGIiLGRhcmtnb2xkZW5yb2Q6IiNiODg2MGIiLGRhcmtncmF5OiIjYTlhOWE5IixkYXJrZ3JlZW46IiMwMDY0MDAiLGRhcmtraGFraToiI2JkYjc2YiIsZGFya21hZ2VudGE6IiM4YjAwOGIiLGRhcmtvbGl2ZWdyZWVuOiIjNTU2YjJmIixkYXJrb3JhbmdlOiIjZmY4YzAwIixkYXJrb3JjaGlkOiIjOTkzMmNjIixkYXJrcmVkOiIjOGIwMDAwIixkYXJrc2FsbW9uOiIjZTk5NjdhIixkYXJrc2VhZ3JlZW46IiM4ZmJjOGYiLGRhcmtzbGF0ZWJsdWU6IiM0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IiMyZjRmNGYiLGRhcmt0dXJxdW9pc2U6IiMwMGNlZDEiLGRhcmt2aW9sZXQ6IiM5NDAwZDMiLGRlZXBwaW5rOiIjZmYxNDkzIixkZWVwc2t5Ymx1ZToiIzAwYmZmZiIsZGltZ3JheToiIzY5Njk2OSIsZG9kZ2VyYmx1ZToiIzFlOTBmZiIsZmlyZWJyaWNrOiIjYjIyMjIyIixmbG9yYWx3aGl0ZToiI2ZmZmFmMCIsZm9yZXN0Z3JlZW46IiMyMjhiMjIiLGZ1Y2hzaWE6IiNmZjAwZmYiLGdhaW5zYm9ybzoiI2RjZGNkYyIsZ2hvc3R3aGl0ZToiI2Y4ZjhmZiIsZ29sZDoiI2ZmZDcwMCIsZ29sZGVucm9kOiIjZGFhNTIwIixncmF5OiIjODA4MDgwIixncmVlbjoiIzAwODAwMCIsZ3JlZW55ZWxsb3c6IiNhZGZmMmYiLGhvbmV5ZGV3OiIjZjBmZmYwIixob3RwaW5rOiIjZmY2OWI0IiwiaW5kaWFucmVkICI6IiNjZDVjNWMiLGluZGlnbzoiIzRiMDA4MiIsaXZvcnk6IiNmZmZmZjAiLGtoYWtpOiIjZjBlNjhjIixsYXZlbmRlcjoiI2U2ZTZmYSIsbGF2ZW5kZXJibHVzaDoiI2ZmZjBmNSIsbGF3bmdyZWVuOiIjN2NmYzAwIixsZW1vbmNoaWZmb246IiNmZmZhY2QiLGxpZ2h0Ymx1ZToiI2FkZDhlNiIsbGlnaHRjb3JhbDoiI2YwODA4MCIsbGlnaHRjeWFuOiIjZTBmZmZmIixsaWdodGdvbGRlbnJvZHllbGxvdzoiI2ZhZmFkMiIsbGlnaHRncmV5OiIjZDNkM2QzIixsaWdodGdyZWVuOiIjOTBlZTkwIixsaWdodHBpbms6IiNmZmI2YzEiLGxpZ2h0c2FsbW9uOiIjZmZhMDdhIixsaWdodHNlYWdyZWVuOiIjMjBiMmFhIixsaWdodHNreWJsdWU6IiM4N2NlZmEiLGxpZ2h0c2xhdGVncmF5OiIjNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiI2IwYzRkZSIsbGlnaHR5ZWxsb3c6IiNmZmZmZTAiLGxpbWU6IiMwMGZmMDAiLGxpbWVncmVlbjoiIzMyY2QzMiIsbGluZW46IiNmYWYwZTYiLG1hZ2VudGE6IiNmZjAwZmYiLG1hcm9vbjoiIzgwMDAwMCIsbWVkaXVtYXF1YW1hcmluZToiIzY2Y2RhYSIsbWVkaXVtYmx1ZToiIzAwMDBjZCIsbWVkaXVtb3JjaGlkOiIjYmE1NWQzIixtZWRpdW1wdXJwbGU6IiM5MzcwZDgiLG1lZGl1bXNlYWdyZWVuOiIjM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IiM3YjY4ZWUiLG1lZGl1bXNwcmluZ2dyZWVuOiIjMDBmYTlhIixtZWRpdW10dXJxdW9pc2U6IiM0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiI2M3MTU4NSIsbWlkbmlnaHRibHVlOiIjMTkxOTcwIixtaW50Y3JlYW06IiNmNWZmZmEiLG1pc3R5cm9zZToiI2ZmZTRlMSIsbW9jY2FzaW46IiNmZmU0YjUiLG5hdmFqb3doaXRlOiIjZmZkZWFkIixuYXZ5OiIjMDAwMDgwIixvbGRsYWNlOiIjZmRmNWU2IixvbGl2ZToiIzgwODAwMCIsb2xpdmVkcmFiOiIjNmI4ZTIzIixvcmFuZ2U6IiNmZmE1MDAiLG9yYW5nZXJlZDoiI2ZmNDUwMCIsb3JjaGlkOiIjZGE3MGQ2IixwYWxlZ29sZGVucm9kOiIjZWVlOGFhIixwYWxlZ3JlZW46IiM5OGZiOTgiLHBhbGV0dXJxdW9pc2U6IiNhZmVlZWUiLHBhbGV2aW9sZXRyZWQ6IiNkODcwOTMiLHBhcGF5YXdoaXA6IiNmZmVmZDUiLHBlYWNocHVmZjoiI2ZmZGFiOSIscGVydToiI2NkODUzZiIscGluazoiI2ZmYzBjYiIscGx1bToiI2RkYTBkZCIscG93ZGVyYmx1ZToiI2IwZTBlNiIscHVycGxlOiIjODAwMDgwIixyZWJlY2NhcHVycGxlOiIjNjYzMzk5IixyZWQ6IiNmZjAwMDAiLHJvc3licm93bjoiI2JjOGY4ZiIscm95YWxibHVlOiIjNDE2OWUxIixzYWRkbGVicm93bjoiIzhiNDUxMyIsc2FsbW9uOiIjZmE4MDcyIixzYW5keWJyb3duOiIjZjRhNDYwIixzZWFncmVlbjoiIzJlOGI1NyIsc2Vhc2hlbGw6IiNmZmY1ZWUiLHNpZW5uYToiI2EwNTIyZCIsc2lsdmVyOiIjYzBjMGMwIixza3libHVlOiIjODdjZWViIixzbGF0ZWJsdWU6IiM2YTVhY2QiLHNsYXRlZ3JheToiIzcwODA5MCIsc25vdzoiI2ZmZmFmYSIsc3ByaW5nZ3JlZW46IiMwMGZmN2YiLHN0ZWVsYmx1ZToiIzQ2ODJiNCIsdGFuOiIjZDJiNDhjIix0ZWFsOiIjMDA4MDgwIix0aGlzdGxlOiIjZDhiZmQ4Iix0b21hdG86IiNmZjYzNDciLHR1cnF1b2lzZToiIzQwZTBkMCIsdmlvbGV0OiIjZWU4MmVlIix3aGVhdDoiI2Y1ZGViMyIsd2hpdGU6IiNmZmZmZmYiLHdoaXRlc21va2U6IiNmNWY1ZjUiLHllbGxvdzoiI2ZmZmYwMCIseWVsbG93Z3JlZW46IiM5YWNkMzIifTtyZXR1cm4gdm9pZCAwIT09ZVt0LnRvTG93ZXJDYXNlKCldJiZlW3QudG9Mb3dlckNhc2UoKV19KSh0KSl9dG9IZXgoKXtmdW5jdGlvbiB0KHQpe2NvbnN0IGU9TWF0aC5yb3VuZCgyNTUqdCkudG9TdHJpbmcoMTYpO3JldHVybiAxPT1lLmxlbmd0aD8iMCIrZTplfXJldHVybiIjIit0KHRoaXMucikrdCh0aGlzLmcpK3QodGhpcy5iKX1lcXVhbCh0KXtyZXR1cm4gdGhpcy5yPT10LnImJnRoaXMuZz09dC5nJiZ0aGlzLmI9PXQuYiYmdGhpcy5hPT10LmF9bm90ZXF1YWxzKHQpe3JldHVybiB0aGlzLnIhPXQuciYmdGhpcy5nIT10LmcmJnRoaXMuYiE9dC5iJiZ0aGlzLmEhPXQuYX1hcHByb3hFcXVhbCh0LGU9TnVtYmVyLkVQU0lMT04pe3JldHVybiBNYXRoLmFicyh0aGlzLnItdC5yKTxlJiZNYXRoLmFicyh0aGlzLmctdC5nKTxlJiZNYXRoLmFicyh0aGlzLmItdC5iKTxlJiZNYXRoLmFicyh0aGlzLmEtdC5hKTxlfWFkZCh0KXtyZXR1cm4gbmV3IG8odGhpcy5yK3Qucix0aGlzLmcrdC5nLHRoaXMuYit0LmIsdGhpcy5hK3QuYSl9c3VidHJhY3QodCl7cmV0dXJuIG5ldyBvKHRoaXMuci10LnIsdGhpcy5nLXQuZyx0aGlzLmItdC5iLHRoaXMuYS10LmEpfXNjYWxlKHQpe3JldHVybiBuZXcgbyh0aGlzLnIqdCx0aGlzLmcqdCx0aGlzLmIqdCx0aGlzLmEqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMucio9dCx0aGlzLmcqPXQsdGhpcy5iKj10LHRoaXMuYSo9dH1hcHBseUdhbW1hKHQpe3RoaXMuc2V0KE1hdGgucG93KHRoaXMucix0KSxNYXRoLnBvdyh0aGlzLmcsdCksTWF0aC5wb3codGhpcy5iLHQpLHRoaXMuYSl9dG9MaW5lYXIodD0yLjIpe3JldHVybiBuZXcgbyhNYXRoLnBvdyh0aGlzLnIsdCksTWF0aC5wb3codGhpcy5nLHQpLE1hdGgucG93KHRoaXMuYix0KSx0aGlzLmEpfXRvR2FtbWEodD0yLjIpe3JldHVybiBuZXcgbyhNYXRoLnBvdyh0aGlzLnIsMS90KSxNYXRoLnBvdyh0aGlzLmcsMS90KSxNYXRoLnBvdyh0aGlzLmIsMS90KSx0aGlzLmEpfWx1bWluYW5jZSgpe3JldHVybi4yMTI2KnRoaXMucisuNzE1Mip0aGlzLmcrLjA3MjIqdGhpcy5ifWxlcnAodCxlKXtjb25zdCBzPXRoaXMucixhPXRoaXMuZyxpPXRoaXMuYixyPXRoaXMuYTtyZXR1cm4gbmV3IG8ocytlKih0LnItcyksYStlKih0LmctYSksaStlKih0LmItaSkscitlKih0LmEtcikpfXN0YXRpYyByYW5kb20odD0wLGU9ITEpe3JldHVybiB0PjA/bmV3IG8odCtNYXRoLnJhbmRvbSgpKigxLXQpLHQrTWF0aC5yYW5kb20oKSooMS10KSx0K01hdGgucmFuZG9tKCkqKDEtdCksZT90K01hdGgucmFuZG9tKCkqKDEtdCk6MSk6dDwwP25ldyBvKE1hdGgucmFuZG9tKCkqKDErdCksTWF0aC5yYW5kb20oKSooMSt0KSxNYXRoLnJhbmRvbSgpKigxK3QpLGU/TWF0aC5yYW5kb20oKSooMSt0KToxKTpuZXcgbyhNYXRoLnJhbmRvbSgpLE1hdGgucmFuZG9tKCksTWF0aC5yYW5kb20oKSxlP01hdGgucmFuZG9tKCk6MSl9Y2xvbmUoKXtyZXR1cm4gbmV3IG8odGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbM10pfWFzQXJyYXkoKXtyZXR1cm4gdGhpcy5fX2RhdGF9YXMzQ29tcG9uZW50QXJyYXkoKXtyZXR1cm5bdGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl1dfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBvKC4uLnQpfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyBvKHQsNCplKX1zdGF0aWMgbnVtRWxlbWVudHMoKXtyZXR1cm4gNH10b0pTT04oKXtyZXR1cm57cjp0aGlzLnIsZzp0aGlzLmcsYjp0aGlzLmIsYTp0aGlzLmF9fWZyb21KU09OKHQpe3RoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXMuYT10LmF9dG9DU1NTdHJpbmcoKXtyZXR1cm4icmdiYSgiK01hdGgucm91bmQoMjU1KnRoaXMucikrIiwgIitNYXRoLnJvdW5kKDI1NSp0aGlzLmcpKyIsICIrTWF0aC5yb3VuZCgyNTUqdGhpcy5iKSsiLCAiK3RoaXMuYSsiKSJ9fWEucmVnaXN0ZXJUeXBlKCJDb2xvciIsbyk7Y2xhc3MgXyBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCxzPTAsYT0wKXtpZihzdXBlcigpLGlzTmFOKGEpKXN3aXRjaChhKXtjYXNlIlhZWiI6dGhpcy5vcmRlcj0wO2JyZWFrO2Nhc2UiWVpYIjp0aGlzLm9yZGVyPTE7YnJlYWs7Y2FzZSJaWFkiOnRoaXMub3JkZXI9MjticmVhaztjYXNlIlhaWSI6dGhpcy5vcmRlcj0zO2JyZWFrO2Nhc2UiWllYIjp0aGlzLm9yZGVyPTQ7YnJlYWs7Y2FzZSJZWFoiOnRoaXMub3JkZXI9NTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBFdWxlciBBbmdsZXMgT3JkZXI6IithKX1lbHNlIHRoaXMub3JkZXI9YTtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSB0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDMpLHRoaXMuX19kYXRhWzBdPXQsdGhpcy5fX2RhdGFbMV09ZSx0aGlzLl9fZGF0YVsyXT1zfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fXNldCh0LGUscyl7dGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXN9fWEucmVnaXN0ZXJUeXBlKCJFdWxlckFuZ2xlcyIsXyk7Y2xhc3MgZCBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0xLGU9MCxzPTAsYT0wLGk9MSxyPTAsbj0wLGg9MCxvPTEpe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkocyxhLDkpfWVsc2UgdGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSg5KSx0aGlzLnNldCh0LGUscyxhLGkscixuLGgsbyl9Z2V0IG0wMCgpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgbTAwKHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IG0wMSgpe3JldHVybiB0aGlzLl9fZGF0YVsxXX1zZXQgbTAxKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IG0wMigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgbTAyKHQpe3RoaXMuX19kYXRhWzJdPXR9Z2V0IG0xMCgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgbTEwKHQpe3RoaXMuX19kYXRhWzNdPXR9Z2V0IG0xMSgpe3JldHVybiB0aGlzLl9fZGF0YVs0XX1zZXQgbTExKHQpe3RoaXMuX19kYXRhWzRdPXR9Z2V0IG0xMigpe3JldHVybiB0aGlzLl9fZGF0YVs1XX1zZXQgbTEyKHQpe3RoaXMuX19kYXRhWzVdPXR9Z2V0IG0yMCgpe3JldHVybiB0aGlzLl9fZGF0YVs2XX1zZXQgbTIwKHQpe3RoaXMuX19kYXRhWzZdPXR9Z2V0IG0yMSgpe3JldHVybiB0aGlzLl9fZGF0YVs3XX1zZXQgbTIxKHQpe3RoaXMuX19kYXRhWzddPXR9Z2V0IG0yMigpe3JldHVybiB0aGlzLl9fZGF0YVs4XX1zZXQgbTIyKHQpe3RoaXMuX19kYXRhWzhdPXR9Z2V0IHhBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDApfXNldCB4QXhpcyh0KXt0aGlzLnhBeGlzLnNldCh0LngsdC55LHQueil9Z2V0IHlBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDMpfXNldCB5QXhpcyh0KXt0aGlzLnlBeGlzLnNldCh0LngsdC55LHQueil9Z2V0IHpBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDYpfXNldCB6QXhpcyh0KXt0aGlzLnpBeGlzLnNldCh0LngsdC55LHQueil9c2V0KHQ9MSxlPTAscz0wLGE9MCxpPTEscj0wLG49MCxoPTAsbz0xKXt0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hLHRoaXMuX19kYXRhWzRdPWksdGhpcy5fX2RhdGFbNV09cix0aGlzLl9fZGF0YVs2XT1uLHRoaXMuX19kYXRhWzddPWgsdGhpcy5fX2RhdGFbOF09b31zZXRJZGVudGl0eSgpe3RoaXMuc2V0KCl9c2V0RnJvbU1hdCh0KXt0aGlzLl9fZGF0YVswXT10Lm0wMCx0aGlzLl9fZGF0YVsxXT10Lm0wMSx0aGlzLl9fZGF0YVsyXT10Lm0wMix0aGlzLl9fZGF0YVszXT10Lm0xMCx0aGlzLl9fZGF0YVs0XT10Lm0xMSx0aGlzLl9fZGF0YVs1XT10Lm0xMix0aGlzLl9fZGF0YVs2XT10Lm0yMCx0aGlzLl9fZGF0YVs3XT10Lm0yMSx0aGlzLl9fZGF0YVs4XT10Lm0yMn1zZXRGcm9tRGlyZWN0aW9uQW5kVXB2ZWN0b3IodCxlKXtjb25zdCBzPXQsYT1zLmxlbmd0aCgpO2lmKGE8TnVtYmVyLkVQU0lMT04pcmV0dXJuIHZvaWQgdGhpcy5zZXRJZGVudGl0eSgpO3Muc2NhbGVJblBsYWNlKDEvYSk7Y29uc3QgaT1lLmNyb3NzKHMpLHI9aS5sZW5ndGgoKTtyPk51bWJlci5FUFNJTE9OJiZpLnNjYWxlSW5QbGFjZSgxL3IpO2NvbnN0IG49cy5jcm9zcyhpKSxoPW4ubGVuZ3RoKCk7aD5OdW1iZXIuRVBTSUxPTiYmbi5zY2FsZUluUGxhY2UoMS9oKSx0aGlzLnNldChpLngsaS55LGkueixuLngsbi55LG4ueixzLngscy55LHMueil9aW52ZXJzZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM10saT10aGlzLl9fZGF0YVs0XSxyPXRoaXMuX19kYXRhWzVdLG49dGhpcy5fX2RhdGFbNl0saD10aGlzLl9fZGF0YVs3XSxvPXRoaXMuX19kYXRhWzhdLF89byppLXIqaCxsPS1vKmErcipuLGM9aCphLWkqbix1PXQqXytlKmwrcypjO3JldHVybiB1Pyh1PTEvdSxuZXcgZChfKnUsKC1vKmUrcypoKSp1LChyKmUtcyppKSp1LGwqdSwobyp0LXMqbikqdSwoLXIqdCtzKmEpKnUsYyp1LCgtaCp0K2UqbikqdSwoaSp0LWUqYSkqdSkpOihjb25zb2xlLndhcm4oIlVuYWJsZSB0byBpbnZlcnQgTWF0MyIpLG51bGwpfWludmVydEluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdLGk9dGhpcy5fX2RhdGFbNF0scj10aGlzLl9fZGF0YVs1XSxuPXRoaXMuX19kYXRhWzZdLGg9dGhpcy5fX2RhdGFbN10sbz10aGlzLl9fZGF0YVs4XSxfPW8qaS1yKmgsZD0tbyphK3IqbixsPWgqYS1pKm4sYz10Kl8rZSpkK3MqbDtyZXR1cm4gYz8oYz0xL2MsdGhpcy5zZXQoXypjLCgtbyplK3MqaCkqYywociplLXMqaSkqYyxkKmMsKG8qdC1zKm4pKmMsKC1yKnQrcyphKSpjLGwqYywoLWgqdCtlKm4pKmMsKGkqdC1lKmEpKmMpLCEwKTooY29uc29sZS53YXJuKCJVbmFibGUgdG8gaW52ZXJ0IE1hdDMiKSwhMSl9dHJhbnNwb3NlKCl7cmV0dXJuIGQodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbM10sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbNF0sdGhpcy5fX2RhdGFbN10sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbNV0sdGhpcy5fX2RhdGFbOF0pfXRyYW5zcG9zZUluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzFdLGU9dGhpcy5fX2RhdGFbMl0scz10aGlzLl9fZGF0YVs1XTt0aGlzLl9fZGF0YVsxXT10aGlzLl9fZGF0YVszXSx0aGlzLl9fZGF0YVsyXT10aGlzLl9fZGF0YVs2XSx0aGlzLl9fZGF0YVszXT10LHRoaXMuX19kYXRhWzVdPXRoaXMuX19kYXRhWzddLHRoaXMuX19kYXRhWzZdPWUsdGhpcy5fX2RhdGFbN109c310cmFuc2Zvcm1WZWMzKHQpe3JldHVybiBuZXcgcih0aGlzLl9fZGF0YVswXSp0LngrdGhpcy5fX2RhdGFbMV0qdC55K3RoaXMuX19kYXRhWzJdKnQueix0aGlzLl9fZGF0YVszXSp0LngrdGhpcy5fX2RhdGFbNF0qdC55K3RoaXMuX19kYXRhWzVdKnQueix0aGlzLl9fZGF0YVs2XSp0LngrdGhpcy5fX2RhdGFbN10qdC55K3RoaXMuX19kYXRhWzhdKnQueil9Y2xvbmUoKXtyZXR1cm4gbmV3IGQodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbM10sdGhpcy5fX2RhdGFbNF0sdGhpcy5fX2RhdGFbNV0sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbN10sdGhpcy5fX2RhdGFbOF0sdGhpcy5fX2RhdGFbOV0pfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBkKC4uLnQpfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyBkKHQsNCplKX10b0pTT04oKXtyZXR1cm4gdGhpcy5fX2RhdGF9ZnJvbUpTT04odCl7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSh0KX10b1N0cmluZygpe3JldHVybiB0aGlzLnRvSlNPTigpLnRvU3RyaW5nKCl9fWEucmVnaXN0ZXJUeXBlKCJNYXQzIixkKTtjbGFzcyBsIGV4dGVuZHMgc3tjb25zdHJ1Y3Rvcih0PTEsZT0wLHM9MCxhPTAsaT0wLHI9MSxuPTAsaD0wLG89MCxfPTAsZD0xLGw9MCxjPTAsdT0wLGY9MCxtPTEpe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSl0aGlzLl9fZGF0YT10O2Vsc2UgaWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkocyxhLDE2KX1lbHNlIHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMTYpLHRoaXMuc2V0KHQsZSxzLGEsaSxyLG4saCxvLF8sZCxsLGMsdSxmLG0pfWdldCBtMDAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF19c2V0IG0wMCh0KXt0aGlzLl9fZGF0YVswXT10fWdldCBtMDEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IG0wMSh0KXt0aGlzLl9fZGF0YVsxXT10fWdldCBtMDIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IG0wMih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCBtMDMoKXtyZXR1cm4gdGhpcy5fX2RhdGFbM119c2V0IG0wMyh0KXt0aGlzLl9fZGF0YVszXT10fWdldCBtMTAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNF19c2V0IG0xMCh0KXt0aGlzLl9fZGF0YVs0XT10fWdldCBtMTEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNV19c2V0IG0xMSh0KXt0aGlzLl9fZGF0YVs1XT10fWdldCBtMTIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNl19c2V0IG0xMih0KXt0aGlzLl9fZGF0YVs2XT10fWdldCBtMTMoKXtyZXR1cm4gdGhpcy5fX2RhdGFbN119c2V0IG0xMyh0KXt0aGlzLl9fZGF0YVs3XT10fWdldCBtMjAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbOF19c2V0IG0yMCh0KXt0aGlzLl9fZGF0YVs4XT10fWdldCBtMjEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbOV19c2V0IG0yMSh0KXt0aGlzLl9fZGF0YVs5XT10fWdldCBtMjIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMTBdfXNldCBtMjIodCl7dGhpcy5fX2RhdGFbMTBdPXR9Z2V0IG0yMygpe3JldHVybiB0aGlzLl9fZGF0YVsxMV19c2V0IG0yMyh0KXt0aGlzLl9fZGF0YVsxMV09dH1nZXQgbTMwKCl7cmV0dXJuIHRoaXMuX19kYXRhWzEyXX1zZXQgbTMwKHQpe3RoaXMuX19kYXRhWzEyXT10fWdldCBtMzEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMTNdfXNldCBtMzEodCl7dGhpcy5fX2RhdGFbMTNdPXR9Z2V0IG0zMigpe3JldHVybiB0aGlzLl9fZGF0YVsxNF19c2V0IG0zMih0KXt0aGlzLl9fZGF0YVsxNF09dH1nZXQgbTMzKCl7cmV0dXJuIHRoaXMuX19kYXRhWzE1XX1zZXQgbTMzKHQpe3RoaXMuX19kYXRhWzE1XT10fWdldCB4QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciwwKX1zZXQgeEF4aXModCl7dGhpcy54QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB5QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciw0KX1zZXQgeUF4aXModCl7dGhpcy55QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB6QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciw4KX1zZXQgekF4aXModCl7dGhpcy56QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB0cmFuc2xhdGlvbigpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciwxMil9c2V0IHRyYW5zbGF0aW9uKHQpe3RoaXMudHJhbnNsYXRpb24uc2V0KHQueCx0LnksdC56KX1zZXQodD0xLGU9MCxzPTAsYT0wLGk9MCxyPTEsbj0wLGg9MCxvPTAsXz0wLGQ9MSxsPTAsYz0wLHU9MCxmPTAsbT0xKXt0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hLHRoaXMuX19kYXRhWzRdPWksdGhpcy5fX2RhdGFbNV09cix0aGlzLl9fZGF0YVs2XT1uLHRoaXMuX19kYXRhWzddPWgsdGhpcy5fX2RhdGFbOF09byx0aGlzLl9fZGF0YVs5XT1fLHRoaXMuX19kYXRhWzEwXT1kLHRoaXMuX19kYXRhWzExXT1sLHRoaXMuX19kYXRhWzEyXT1jLHRoaXMuX19kYXRhWzEzXT11LHRoaXMuX19kYXRhWzE0XT1mLHRoaXMuX19kYXRhWzE1XT1tfXNldElkZW50aXR5KCl7dGhpcy5zZXQoKX1zZXREYXRhQXJyYXkodCl7dGhpcy5fX2RhdGE9dH1zZXRGcm9tTWF0NCh0KXt0aGlzLl9fZGF0YVswXT10Lm0wMCx0aGlzLl9fZGF0YVsxXT10Lm0wMSx0aGlzLl9fZGF0YVsyXT10Lm0wMix0aGlzLl9fZGF0YVszXT10Lm0wMyx0aGlzLl9fZGF0YVs0XT10Lm0xMCx0aGlzLl9fZGF0YVs1XT10Lm0xMSx0aGlzLl9fZGF0YVs2XT10Lm0xMix0aGlzLl9fZGF0YVs3XT10Lm0xMyx0aGlzLl9fZGF0YVs4XT10Lm0yMCx0aGlzLl9fZGF0YVs5XT10Lm0yMSx0aGlzLl9fZGF0YVsxMF09dC5tMjIsdGhpcy5fX2RhdGFbMTFdPXQubTIzLHRoaXMuX19kYXRhWzEyXT10Lm0zMCx0aGlzLl9fZGF0YVsxM109dC5tMzEsdGhpcy5fX2RhdGFbMTRdPXQubTMyLHRoaXMuX19kYXRhWzE1XT10Lm0zM310b01hdDModCl7cmV0dXJuIG5ldyBkKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzVdLHRoaXMuX19kYXRhWzZdLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzldLHRoaXMuX19kYXRhWzEwXSl9dHJhbnNwb3NlSW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMV0sZT10aGlzLl9fZGF0YVsyXSxzPXRoaXMuX19kYXRhWzNdLGE9dGhpcy5fX2RhdGFbNl0saT10aGlzLl9fZGF0YVs3XSxyPXRoaXMuX19kYXRhWzExXTt0aGlzLl9fZGF0YVsxXT10aGlzLl9fZGF0YVs0XSx0aGlzLl9fZGF0YVsyXT10aGlzLl9fZGF0YVs4XSx0aGlzLl9fZGF0YVszXT10aGlzLl9fZGF0YVsxMl0sdGhpcy5fX2RhdGFbNF09dCx0aGlzLl9fZGF0YVs2XT10aGlzLl9fZGF0YVs5XSx0aGlzLl9fZGF0YVs3XT10aGlzLl9fZGF0YVsxM10sdGhpcy5fX2RhdGFbOF09ZSx0aGlzLl9fZGF0YVs5XT1hLHRoaXMuX19kYXRhWzExXT10aGlzLl9fZGF0YVsxNF0sdGhpcy5fX2RhdGFbMTJdPXMsdGhpcy5fX2RhdGFbMTNdPWksdGhpcy5fX2RhdGFbMTRdPXJ9dHJhbnNwb3NlKCl7cmV0dXJuIG5ldyBsKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzEyXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVs1XSx0aGlzLl9fZGF0YVs5XSx0aGlzLl9fZGF0YVsxM10sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbMTBdLHRoaXMuX19kYXRhWzE0XSx0aGlzLl9fZGF0YVszXSx0aGlzLl9fZGF0YVs3XSx0aGlzLl9fZGF0YVsxMV0sdGhpcy5fX2RhdGFbMTVdKX1pbnZlcnNlKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVszXSxpPXRoaXMuX19kYXRhWzRdLHI9dGhpcy5fX2RhdGFbNV0sbj10aGlzLl9fZGF0YVs2XSxoPXRoaXMuX19kYXRhWzddLG89dGhpcy5fX2RhdGFbOF0sXz10aGlzLl9fZGF0YVs5XSxkPXRoaXMuX19kYXRhWzEwXSxjPXRoaXMuX19kYXRhWzExXSx1PXRoaXMuX19kYXRhWzEyXSxmPXRoaXMuX19kYXRhWzEzXSxtPXRoaXMuX19kYXRhWzE0XSxnPXRoaXMuX19kYXRhWzE1XSx5PXQqci1lKmkscD10Km4tcyppLGI9dCpoLWEqaSx4PWUqbi1zKnIsdz1lKmgtYSpyLEk9cypoLWEqbixOPW8qZi1fKnUsRj1vKm0tZCp1LHo9bypnLWMqdSxWPV8qbS1kKmYsTT1fKmctYypmLEE9ZCpnLWMqbTtsZXQgUz15KkEtcCpNK2IqVit4KnotdypGK0kqTjtyZXR1cm4gUz8oUz0xL1MsbmV3IGwoKHIqQS1uKk0raCpWKSpTLChzKk0tZSpBLWEqVikqUywoZipJLW0qdytnKngpKlMsKGQqdy1fKkktYyp4KSpTLChuKnotaSpBLWgqRikqUywodCpBLXMqeithKkYpKlMsKG0qYi11KkktZypwKSpTLChvKkktZCpiK2MqcCkqUywoaSpNLXIqeitoKk4pKlMsKGUqei10Kk0tYSpOKSpTLCh1KnctZipiK2cqeSkqUywoXypiLW8qdy1jKnkpKlMsKHIqRi1pKlYtbipOKSpTLCh0KlYtZSpGK3MqTikqUywoZipwLXUqeC1tKnkpKlMsKG8qeC1fKnArZCp5KSpTKSk6KGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGludmVydCBNYXQ0IiksbnVsbCl9aW52ZXJ0SW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM10saT10aGlzLl9fZGF0YVs0XSxyPXRoaXMuX19kYXRhWzVdLG49dGhpcy5fX2RhdGFbNl0saD10aGlzLl9fZGF0YVs3XSxvPXRoaXMuX19kYXRhWzhdLF89dGhpcy5fX2RhdGFbOV0sZD10aGlzLl9fZGF0YVsxMF0sbD10aGlzLl9fZGF0YVsxMV0sYz10aGlzLl9fZGF0YVsxMl0sdT10aGlzLl9fZGF0YVsxM10sZj10aGlzLl9fZGF0YVsxNF0sbT10aGlzLl9fZGF0YVsxNV0sZz10KnItZSppLHk9dCpuLXMqaSxwPXQqaC1hKmksYj1lKm4tcypyLHg9ZSpoLWEqcix3PXMqaC1hKm4sST1vKnUtXypjLE49bypmLWQqYyxGPW8qbS1sKmMsej1fKmYtZCp1LFY9XyptLWwqdSxNPWQqbS1sKmY7bGV0IEE9ZypNLXkqVitwKnorYipGLXgqTit3Kkk7cmV0dXJuIEE/KEE9MS9BLHRoaXMuc2V0KChyKk0tbipWK2gqeikqQSwocypWLWUqTS1hKnopKkEsKHUqdy1mKngrbSpiKSpBLChkKngtXyp3LWwqYikqQSwobipGLWkqTS1oKk4pKkEsKHQqTS1zKkYrYSpOKSpBLChmKnAtYyp3LW0qeSkqQSwobyp3LWQqcCtsKnkpKkEsKGkqVi1yKkYraCpJKSpBLChlKkYtdCpWLWEqSSkqQSwoYyp4LXUqcCttKmcpKkEsKF8qcC1vKngtbCpnKSpBLChyKk4taSp6LW4qSSkqQSwodCp6LWUqTitzKkkpKkEsKHUqeS1jKmItZipnKSpBLChvKmItXyp5K2QqZykqQSksITApOihjb25zb2xlLndhcm4oIlVuYWJsZSB0byBpbnZlcnQgTWF0NCIpLCExKX1zZXRJbnZlcnNlKHQpe2NvbnN0IGU9dC5fX2RhdGFbMF0scz10Ll9fZGF0YVsxXSxhPXQuX19kYXRhWzJdLGk9dC5fX2RhdGFbM10scj10Ll9fZGF0YVs0XSxuPXQuX19kYXRhWzVdLGg9dC5fX2RhdGFbNl0sbz10Ll9fZGF0YVs3XSxfPXQuX19kYXRhWzhdLGQ9dC5fX2RhdGFbOV0sbD10Ll9fZGF0YVsxMF0sYz10Ll9fZGF0YVsxMV0sdT10Ll9fZGF0YVsxMl0sZj10Ll9fZGF0YVsxM10sbT10Ll9fZGF0YVsxNF0sZz10Ll9fZGF0YVsxNV0seT1lKm4tcypyLHA9ZSpoLWEqcixiPWUqby1pKnIseD1zKmgtYSpuLHc9cypvLWkqbixJPWEqby1pKmgsTj1fKmYtZCp1LEY9XyptLWwqdSx6PV8qZy1jKnUsVj1kKm0tbCpmLE09ZCpnLWMqZixBPWwqZy1jKm07bGV0IFM9eSpBLXAqTStiKlYreCp6LXcqRitJKk47aWYoIVMpdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gaW52ZXJ0IE1hdDQiKTtTPTEvUyx0aGlzLnNldCgobipBLWgqTStvKlYpKlMsKGEqTS1zKkEtaSpWKSpTLChmKkktbSp3K2cqeCkqUywobCp3LWQqSS1jKngpKlMsKGgqei1yKkEtbypGKSpTLChlKkEtYSp6K2kqRikqUywobSpiLXUqSS1nKnApKlMsKF8qSS1sKmIrYypwKSpTLChyKk0tbip6K28qTikqUywocyp6LWUqTS1pKk4pKlMsKHUqdy1mKmIrZyp5KSpTLChkKmItXyp3LWMqeSkqUywobipGLXIqVi1oKk4pKlMsKGUqVi1zKkYrYSpOKSpTLChmKnAtdSp4LW0qeSkqUywoXyp4LWQqcCtsKnkpKlMpfW11bHRpcGx5KHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0scz10aGlzLl9fZGF0YVsxXSxhPXRoaXMuX19kYXRhWzJdLGk9dGhpcy5fX2RhdGFbM10scj10aGlzLl9fZGF0YVs0XSxuPXRoaXMuX19kYXRhWzVdLGg9dGhpcy5fX2RhdGFbNl0sbz10aGlzLl9fZGF0YVs3XSxfPXRoaXMuX19kYXRhWzhdLGQ9dGhpcy5fX2RhdGFbOV0sYz10aGlzLl9fZGF0YVsxMF0sdT10aGlzLl9fZGF0YVsxMV0sZj10aGlzLl9fZGF0YVsxMl0sbT10aGlzLl9fZGF0YVsxM10sZz10aGlzLl9fZGF0YVsxNF0seT10aGlzLl9fZGF0YVsxNV0scD10LmFzQXJyYXkoKTtsZXQgYj1wWzBdLHg9cFsxXSx3PXBbMl0sST1wWzNdO2NvbnN0IE49bmV3IGw7cmV0dXJuIE4ubTAwPWIqZSt4KnIrdypfK0kqZixOLm0wMT1iKnMreCpuK3cqZCtJKm0sTi5tMDI9YiphK3gqaCt3KmMrSSpnLE4ubTAzPWIqaSt4Km8rdyp1K0kqeSxiPXBbNF0seD1wWzVdLHc9cFs2XSxJPXBbN10sTi5tMTA9YiplK3gqcit3Kl8rSSpmLE4ubTExPWIqcyt4Km4rdypkK0kqbSxOLm0xMj1iKmEreCpoK3cqYytJKmcsTi5tMTM9YippK3gqbyt3KnUrSSp5LGI9cFs4XSx4PXBbOV0sdz1wWzEwXSxJPXBbMTFdLE4ubTIwPWIqZSt4KnIrdypfK0kqZixOLm0yMT1iKnMreCpuK3cqZCtJKm0sTi5tMjI9YiphK3gqaCt3KmMrSSpnLE4ubTIzPWIqaSt4Km8rdyp1K0kqeSxiPXBbMTJdLHg9cFsxM10sdz1wWzE0XSxJPXBbMTVdLE4ubTMwPWIqZSt4KnIrdypfK0kqZixOLm0zMT1iKnMreCpuK3cqZCtJKm0sTi5tMzI9YiphK3gqaCt3KmMrSSpnLE4ubTMzPWIqaSt4Km8rdyp1K0kqeSxOfW11bHRpcGx5SW5QbGFjZSh0KXtjb25zdCBlPXRoaXMuYXNBcnJheSgpLHM9ZVswXSxhPWVbMV0saT1lWzJdLHI9ZVszXSxuPWVbNF0saD1lWzVdLG89ZVs2XSxfPWVbN10sZD1lWzhdLGw9ZVs5XSxjPWVbMTBdLHU9ZVsxMV0sZj1lWzEyXSxtPWVbMTNdLGc9ZVsxNF0seT1lWzE1XSxwPXQuYXNBcnJheSgpO2xldCBiPXBbMF0seD1wWzFdLHc9cFsyXSxJPXBbM107cmV0dXJuIHRoaXMubTAwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0wMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMDI9YippK3gqbyt3KmMrSSpnLHRoaXMubTAzPWIqcit4Kl8rdyp1K0kqeSxiPXBbNF0seD1wWzVdLHc9cFs2XSxJPXBbN10sdGhpcy5tMTA9YipzK3gqbit3KmQrSSpmLHRoaXMubTExPWIqYSt4KmgrdypsK0kqbSx0aGlzLm0xMj1iKmkreCpvK3cqYytJKmcsdGhpcy5tMTM9YipyK3gqXyt3KnUrSSp5LGI9cFs4XSx4PXBbOV0sdz1wWzEwXSxJPXBbMTFdLHRoaXMubTIwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0yMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMjI9YippK3gqbyt3KmMrSSpnLHRoaXMubTIzPWIqcit4Kl8rdyp1K0kqeSxiPXBbMTJdLHg9cFsxM10sdz1wWzE0XSxJPXBbMTVdLHRoaXMubTMwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0zMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMzI9YippK3gqbyt3KmMrSSpnLHRoaXMubTMzPWIqcit4Kl8rdyp1K0kqeSx0aGlzfXBvc3RtdWx0aXBseUluUGxhY2UodCl7Y29uc3QgZT10LmFzQXJyYXkoKSxzPWVbMF0sYT1lWzFdLGk9ZVsyXSxyPWVbM10sbj1lWzRdLGg9ZVs1XSxvPWVbNl0sXz1lWzddLGQ9ZVs4XSxsPWVbOV0sYz1lWzEwXSx1PWVbMTFdLGY9ZVsxMl0sbT1lWzEzXSxnPWVbMTRdLHk9ZVsxNV0scD10aGlzLmFzQXJyYXkoKTtsZXQgYj1wWzBdLHg9cFsxXSx3PXBbMl0sST1wWzNdO3JldHVybiB0aGlzLm0wMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMDE9YiphK3gqaCt3KmwrSSptLHRoaXMubTAyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0wMz1iKnIreCpfK3cqdStJKnksYj1wWzRdLHg9cFs1XSx3PXBbNl0sST1wWzddLHRoaXMubTEwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0xMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMTI9YippK3gqbyt3KmMrSSpnLHRoaXMubTEzPWIqcit4Kl8rdyp1K0kqeSxiPXBbOF0seD1wWzldLHc9cFsxMF0sST1wWzExXSx0aGlzLm0yMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMjE9YiphK3gqaCt3KmwrSSptLHRoaXMubTIyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0yMz1iKnIreCpfK3cqdStJKnksYj1wWzEyXSx4PXBbMTNdLHc9cFsxNF0sST1wWzE1XSx0aGlzLm0zMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMzE9YiphK3gqaCt3KmwrSSptLHRoaXMubTMyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0zMz1iKnIreCpfK3cqdStJKnksdGhpc310cmFuc2xhdGVJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGEscz10LngsYT10LnksaT10Lno7cmV0dXJuIGVbMTJdPWVbMF0qcytlWzRdKmErZVs4XSppK2VbMTJdLGVbMTNdPWVbMV0qcytlWzVdKmErZVs5XSppK2VbMTNdLGVbMTRdPWVbMl0qcytlWzZdKmErZVsxMF0qaStlWzE0XSxlWzE1XT1lWzNdKnMrZVs3XSphK2VbMTFdKmkrZVsxNV0sdGhpc31zZXRMb29rQXQodCxlLHMpe2NvbnN0IGE9dC5zdWJ0cmFjdChlKSxpPWEubGVuZ3RoKCk7aWYoaTxOdW1iZXIuRVBTSUxPTilyZXR1cm4gdm9pZCB0aGlzLnNldElkZW50aXR5KCk7YS5zY2FsZUluUGxhY2UoMS9pKTtjb25zdCByPXMuY3Jvc3MoYSksbj1yLmxlbmd0aCgpO24+TnVtYmVyLkVQU0lMT04mJnIuc2NhbGVJblBsYWNlKDEvbik7Y29uc3QgaD1hLmNyb3NzKHIpLG89aC5sZW5ndGgoKTtvPk51bWJlci5FUFNJTE9OJiZoLnNjYWxlSW5QbGFjZSgxL28pLHRoaXMuc2V0KHIueCxyLnksci56LDAsaC54LGgueSxoLnosMCxhLngsYS55LGEueiwwLHQueCx0LnksdC56LDEpfXNldFJvdGF0aW9uKHQsZSl7Y29uc3Qgcz10Lmxlbmd0aCgpO2lmKE1hdGguYWJzKHMpPE51bWJlci5FUFNJTE9OKXJldHVybiBudWxsO2NvbnN0IGE9dC54L3MsaT10LnkvcyxyPXQuei9zLG49TWF0aC5zaW4oZSksaD1NYXRoLmNvcyhlKSxvPTEtaCxfPXRoaXMuX19kYXRhO3JldHVybiBfWzBdPWEqYSpvK2gsX1sxXT1pKmEqbytyKm4sX1syXT1yKmEqby1pKm4sX1szXT0wLF9bNF09YSppKm8tcipuLF9bNV09aSppKm8raCxfWzZdPXIqaSpvK2EqbixfWzddPTAsX1s4XT1hKnIqbytpKm4sX1s5XT1pKnIqby1hKm4sX1sxMF09cipyKm8raCxfWzExXT0wLF9bMTJdPTAsX1sxM109MCxfWzE0XT0wLF9bMTVdPTEsdGhpc31zZXRYUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09MSxhWzFdPTAsYVsyXT0wLGFbM109MCxhWzRdPTAsYVs1XT1zLGFbNl09ZSxhWzddPTAsYVs4XT0wLGFbOV09LWUsYVsxMF09cyxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc31zZXRZUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09cyxhWzFdPTAsYVsyXT0tZSxhWzNdPTAsYVs0XT0wLGFbNV09MSxhWzZdPTAsYVs3XT0wLGFbOF09ZSxhWzldPTAsYVsxMF09cyxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc31zZXRaUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09cyxhWzFdPWUsYVsyXT0wLGFbM109MCxhWzRdPS1lLGFbNV09cyxhWzZdPTAsYVs3XT0wLGFbOF09MCxhWzldPTAsYVsxMF09MSxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc310cmFuc2Zvcm1WZWM0KHQpe2NvbnN0IGU9dGhpcy5fX2RhdGEscz10LngsYT10LnksaT10Lnoscj10LnQ7cmV0dXJuIG5ldyBWZWM0KGVbMF0qcytlWzRdKmErZVs4XSppK2VbMTJdKnIsZVsxXSpzK2VbNV0qYStlWzldKmkrZVsxM10qcixlWzJdKnMrZVs2XSphK2VbMTBdKmkrZVsxNF0qcixlWzNdKnMrZVs3XSphK2VbMTFdKmkrZVsxNV0qcil9dHJhbnNmb3JtVmVjMyh0KXtjb25zdCBlPXRoaXMuX19kYXRhLHM9dC54LGE9dC55LGk9dC56O3JldHVybiBuZXcgcihlWzBdKnMrZVs0XSphK2VbOF0qaStlWzEyXSxlWzFdKnMrZVs1XSphK2VbOV0qaStlWzEzXSxlWzJdKnMrZVs2XSphK2VbMTBdKmkrZVsxNF0pfXJvdGF0ZVZlYzModCl7Y29uc3QgZT10aGlzLl9fZGF0YSxzPXQueCxhPXQueSxpPXQuejtyZXR1cm4gbmV3IHIoZVswXSpzK2VbNF0qYStlWzhdKmksZVsxXSpzK2VbNV0qYStlWzldKmksZVsyXSpzK2VbNl0qYStlWzEwXSppKX1zZXRQZXJzcGVjdGl2ZU1hdHJpeCh0LGUscyxhKXtjb25zdCBpPU1hdGgudGFuKC41Kk1hdGguUEktLjUqdCkscj0xLyhzLWEpO3RoaXMuc2V0KGkvZSwwLDAsMCwwLGksMCwwLDAsMCwocythKSpyLC0xLDAsMCxzKmEqcioyLDApfXNldE9ydGhvZ3JhcGhpY01hdHJpeCh0LGUscyxhLGkscil7Y29uc3Qgbj0xLyh0LWUpLGg9MS8ocy1hKSxvPTEvKGktcik7dGhpcy5zZXQoLTIqbiwwLDAsMCwwLC0yKmgsMCwwLDAsMCwyKm8sMCwodCtlKSpuLChhK3MpKmgsKHIraSkqbywxKX1zZXRTY2FsZSh0LGUscyl7dCBpbnN0YW5jZW9mIHI/dGhpcy5zZXQodC54LDAsMCwwLDAsdC55LDAsMCwwLDAsdC56LDAsMCwwLDAsMSk6dGhpcy5zZXQodCwwLDAsMCwwLGUsMCwwLDAsMCxzLDAsMCwwLDAsMSl9c2V0RnJvbU1hdDN4NEFycmF5KHQpe3RoaXMuc2V0KHRbMF0sdFsxXSx0WzJdLDAsdFszXSx0WzRdLHRbNV0sMCx0WzZdLHRbN10sdFs4XSwwLHRbOV0sdFsxMF0sdFsxMV0sMSl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IGwodCw0KmUpfWNsb25lKCl7cmV0dXJuIG5ldyBsKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzVdLHRoaXMuX19kYXRhWzZdLHRoaXMuX19kYXRhWzddLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzldLHRoaXMuX19kYXRhWzEwXSx0aGlzLl9fZGF0YVsxMV0sdGhpcy5fX2RhdGFbMTJdLHRoaXMuX19kYXRhWzEzXSx0aGlzLl9fZGF0YVsxNF0sdGhpcy5fX2RhdGFbMTVdKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgbCguLi50KX10b0pTT04oKXtyZXR1cm4gdGhpcy5fX2RhdGF9ZnJvbUpTT04odCl7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSh0KX19YS5yZWdpc3RlclR5cGUoIk1hdDQiLGwpO2NsYXNzIHUgZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSBpZih0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDQpLCJvYmplY3QiPT10eXBlb2YgdCl7dGhpcy5fX2RhdGFbMF09MCx0aGlzLl9fZGF0YVsxXT0wLHRoaXMuX19kYXRhWzJdPTAsdGhpcy5fX2RhdGFbM109MTtmb3IoY29uc3QgZSBpbiB0KUFycmF5LmlzQXJyYXkodFtlXSk/dGhpc1tlXS5jYWxsKHRoaXMsLi4udFtlXSk6dGhpc1tlXS5jYWxsKHRoaXMsdFtlXSl9ZWxzZSB0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCB3KCl7cmV0dXJuIHRoaXMuX19kYXRhWzNdfXNldCB3KHQpe3RoaXMuX19kYXRhWzNdPXR9c2V0KHQsZSxzLGEpe3RoaXMuX19kYXRhWzBdPXQsdGhpcy5fX2RhdGFbMV09ZSx0aGlzLl9fZGF0YVsyXT1zLHRoaXMuX19kYXRhWzNdPWF9c2V0RGF0YUFycmF5KHQpe3RoaXMuX19kYXRhPXR9c2V0RnJvbU90aGVyKHQpe3RoaXMuX19kYXRhWzBdPXQueCx0aGlzLl9fZGF0YVsxXT10LnksdGhpcy5fX2RhdGFbMl09dC56LHRoaXMuX19kYXRhWzNdPXQud31zZXRGcm9tRXVsZXJBbmdsZXModCl7Y29uc3QgZT1uZXcgcjtzd2l0Y2godC5vcmRlcil7Y2FzZSAwOmUuc2V0KHQueCwtdC55LHQueik7YnJlYWs7Y2FzZSAxOmUuc2V0KHQueSwtdC56LHQueCk7YnJlYWs7Y2FzZSAyOmUuc2V0KHQueiwtdC54LHQueSk7YnJlYWs7Y2FzZSAzOmUuc2V0KHQueCx0LnosdC55KTticmVhaztjYXNlIDQ6ZS5zZXQodC56LHQueSx0LngpO2JyZWFrO2Nhc2UgNTplLnNldCh0LnksdC54LHQueik7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoInNkcnR5Iil9Y29uc3Qgcz0uNSplLngsYT0uNSplLnksaT0uNSplLnosbj1NYXRoLmNvcyhzKSxoPU1hdGguY29zKGEpLG89TWF0aC5jb3MoaSksXz1NYXRoLnNpbihzKSxkPU1hdGguc2luKGEpLGw9TWF0aC5zaW4oaSksYz1uKm8sdT1uKmwsZj1fKm8sbT1fKmwsZz1oKmYtZCp1LHk9aCptK2QqYyxwPWgqdS1kKmY7c3dpdGNoKHRoaXMudz1oKmMrZCptLHQub3JkZXIpe2Nhc2UgMDp0aGlzLng9Zyx0aGlzLnk9LXksdGhpcy56PXA7YnJlYWs7Y2FzZSAxOnRoaXMueD1wLHRoaXMueT1nLHRoaXMuej0teTticmVhaztjYXNlIDI6dGhpcy54PS15LHRoaXMueT1wLHRoaXMuej1nO2JyZWFrO2Nhc2UgMzp0aGlzLng9Zyx0aGlzLnk9cCx0aGlzLno9eTticmVhaztjYXNlIDQ6dGhpcy54PXAsdGhpcy55PXksdGhpcy56PWc7YnJlYWs7Y2FzZSA1OnRoaXMueD15LHRoaXMueT1nLHRoaXMuej1wO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJzZHJ0eSIpfX10b0V1bGVyQW5nbGVzKHQpe2NvbnN0IGU9bmV3IHI7c3dpdGNoKHQpe2Nhc2UgMDplLnNldCh0aGlzLnosdGhpcy54LHRoaXMueSk7YnJlYWs7Y2FzZSAxOmUuc2V0KHRoaXMueCx0aGlzLnksdGhpcy56KTticmVhaztjYXNlIDI6ZS5zZXQodGhpcy55LHRoaXMueix0aGlzLngpO2JyZWFrO2Nhc2UgMzplLnNldCh0aGlzLnksLXRoaXMueCx0aGlzLnopO2JyZWFrO2Nhc2UgNDplLnNldCh0aGlzLngsLXRoaXMueix0aGlzLnkpO2JyZWFrO2Nhc2UgNTplLnNldCh0aGlzLnosLXRoaXMueSx0aGlzLngpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJvdGF0aW9uIG9yZGVyOiIrdCl9Y29uc3Qgcz1uZXcgcixhPWUueCplLnkrZS56KnRoaXMudztpZihhPi40OTk5OSlzLnk9MipNYXRoLmF0YW4yKGUueCx0aGlzLncpLHMuej0uNSpNYXRoLlBJLHMueD0wO2Vsc2UgaWYoYTwtLjQ5OTk5KXMueT0tMipNYXRoLmF0YW4yKGUueCx0aGlzLncpLHMuej0tLjUqTWF0aC5QSSxzLng9MDtlbHNle2NvbnN0IHQ9ZS54KmUueCxpPWUueSplLnkscj1lLnoqZS56O3MueT1NYXRoLmF0YW4yKDIqZS55KnRoaXMudy0yKmUueCplLnosMS0yKmktMipyKSxzLno9TWF0aC5hc2luKDIqYSkscy54PU1hdGguYXRhbjIoMiplLngqdGhpcy53LTIqZS55KmUueiwxLTIqdC0yKnIpfXN3aXRjaCh0KXtjYXNlIDA6cmV0dXJuIG5ldyBfKHMueSxzLnoscy54LHQpO2Nhc2UgMTpyZXR1cm4gbmV3IF8ocy54LHMueSxzLnosdCk7Y2FzZSAyOnJldHVybiBuZXcgXyhzLnoscy54LHMueSx0KTtjYXNlIDM6cmV0dXJuIG5ldyBfKC1zLnkscy54LHMueix0KTtjYXNlIDQ6cmV0dXJuIG5ldyBfKHMueCxzLnosLXMueSx0KTtjYXNlIDU6cmV0dXJuIG5ldyBfKHMueiwtcy55LHMueCx0KX19c2V0RnJvbUF4aXNBbmRBbmdsZSh0LGUpe2NvbnN0IHM9ZS8yLGE9dC5ub3JtYWxpemUoKS5zY2FsZShNYXRoLnNpbihzKSk7dGhpcy5zZXQoYS54LGEueSxhLnosTWF0aC5jb3MocykpfXNldEZyb21EaXJlY3Rpb25BbmRVcHZlY3Rvcih0LGUpe2NvbnN0IHM9bmV3IGQ7cy5zZXRGcm9tRGlyZWN0aW9uQW5kVXB2ZWN0b3IodCxlKSx0aGlzLnNldEZyb21NYXQzKHMpfXNldEZyb20yVmVjdG9ycyh0LGUpe3Qubm9ybWFsaXplKCksZS5ub3JtYWxpemUoKTtjb25zdCBzPXQuY3Jvc3MoZSksYT10LmRvdChlKSxpPU1hdGguc3FydCgyKigxK2EpKTt0aGlzLnNldChzLngvaSxzLnkvaSxzLnovaSxpLzIpLHRoaXMubm9ybWFsaXplSW5QbGFjZSgpfXNldEZyb21NYXQzKHQpe2NvbnN0IGU9dC5fX2RhdGFbMF0rdC5fX2RhdGFbNF0rdC5fX2RhdGFbOF07bGV0IHM7aWYoZT4wKXM9TWF0aC5zcXJ0KGUrMSksdGhpcy5fX2RhdGFbM109LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbMF09KHQuX19kYXRhWzVdLXQuX19kYXRhWzddKSpzLHRoaXMuX19kYXRhWzFdPSh0Ll9fZGF0YVs2XS10Ll9fZGF0YVsyXSkqcyx0aGlzLl9fZGF0YVsyXT0odC5fX2RhdGFbMV0tdC5fX2RhdGFbM10pKnM7ZWxzZXtsZXQgZT0wO3QuX19kYXRhWzRdPnQuX19kYXRhWzBdJiYoZT0xKSx0Ll9fZGF0YVs4XT50Ll9fZGF0YVszKmUrZV0mJihlPTIpO2NvbnN0IGE9KGUrMSklMyxpPShlKzIpJTM7cz1NYXRoLnNxcnQodC5fX2RhdGFbMyplK2VdLXQuX19kYXRhWzMqYSthXS10Ll9fZGF0YVszKmkraV0rMSksdGhpcy5fX2RhdGFbZV09LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbM109KHQuX19kYXRhWzMqYStpXS10Ll9fZGF0YVszKmkrYV0pKnMsdGhpcy5fX2RhdGFbYV09KHQuX19kYXRhWzMqYStlXSt0Ll9fZGF0YVszKmUrYV0pKnMsdGhpcy5fX2RhdGFbaV09KHQuX19kYXRhWzMqaStlXSt0Ll9fZGF0YVszKmUraV0pKnN9dGhpcy5ub3JtYWxpemVJblBsYWNlKCl9c2V0RnJvbU1hdDQodCl7Y29uc3QgZT10Ll9fZGF0YVswXSt0Ll9fZGF0YVs1XSt0Ll9fZGF0YVsxMF07bGV0IHM7aWYoZT4wKXM9TWF0aC5zcXJ0KGUrMSksdGhpcy5fX2RhdGFbM109LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbMF09KHQuX19kYXRhWzZdLXQuX19kYXRhWzldKSpzLHRoaXMuX19kYXRhWzFdPSh0Ll9fZGF0YVs4XS10Ll9fZGF0YVsyXSkqcyx0aGlzLl9fZGF0YVsyXT0odC5fX2RhdGFbMV0tdC5fX2RhdGFbNF0pKnM7ZWxzZXtsZXQgZT0wO3QuX19kYXRhWzVdPnQuX19kYXRhWzBdJiYoZT0xKSx0Ll9fZGF0YVsxMF0+dC5fX2RhdGFbNCplK2VdJiYoZT0yKTtjb25zdCBhPShlKzEpJTMsaT0oZSsyKSUzO3M9TWF0aC5zcXJ0KHQuX19kYXRhWzQqZStlXS10Ll9fZGF0YVs0KmErYV0tdC5fX2RhdGFbNCppK2ldKzEpLHRoaXMuX19kYXRhW2VdPS41KnMscz0uNS9zLHRoaXMuX19kYXRhWzNdPSh0Ll9fZGF0YVs0KmEraV0tdC5fX2RhdGFbNCppK2FdKSpzLHRoaXMuX19kYXRhW2FdPSh0Ll9fZGF0YVs0KmErZV0rdC5fX2RhdGFbNCplK2FdKSpzLHRoaXMuX19kYXRhW2ldPSh0Ll9fZGF0YVs0KmkrZV0rdC5fX2RhdGFbNCplK2ldKSpzfXRoaXMubm9ybWFsaXplSW5QbGFjZSgpfWlzSWRlbnRpdHkoKXtyZXR1cm4gdGhpcy5nZXRBbmdsZSgpPE51bWJlci5FUFNJTE9OfWdldEFuZ2xlKCl7cmV0dXJuIDIqTWF0aC5hY29zKHRoaXMudyl9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10LnomJnRoaXMudz09dC53fW5vdGVxdWFscyh0KXtyZXR1cm4gdGhpcy54IT10LngmJnRoaXMueSE9dC55JiZ0aGlzLnohPXQueiYmdGhpcy53IT10Lnd9YXBwcm94RXF1YWwodCxlPU51bWJlci5FUFNJTE9OKXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCk8ZSYmTWF0aC5hYnModGhpcy55LXQueSk8ZSYmTWF0aC5hYnModGhpcy56LXQueik8ZSYmTWF0aC5hYnModGhpcy53LXQudyk8ZX1hZGQodCl7cmV0dXJuIG5ldyB1KHRoaXMueCt0LngsdGhpcy55K3QueSx0aGlzLnordC56LHRoaXMudyt0LncpfWFkZEluUGxhY2UodCl7dGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy53Kz10Lnd9c3VidHJhY3QodCl7cmV0dXJuIG5ldyB1KHRoaXMueC10LngsdGhpcy55LXQueSx0aGlzLnotdC56LHRoaXMudy10LncpfXNjYWxlKHQpe3JldHVybiBuZXcgdSh0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCx0aGlzLncqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10LHRoaXMudyo9dH1sZW5ndGgoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO3JldHVybiBNYXRoLnNxcnQodCp0K2UqZStzKnMrYSphKX1sZW5ndGhTcXVhcmVkKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVszXTtyZXR1cm4gdCp0K2UqZStzKnMrYSphfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107bGV0IGk9dCp0K2UqZStzKnMrYSphO3JldHVybiBpPE51bWJlci5FUFNJTE9OP25ldyB1OihpPTEvTWF0aC5zcXJ0KGkpLG5ldyB1KHQqaSxlKmkscyppKSl9bm9ybWFsaXplSW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107bGV0IGk9dCp0K2UqZStzKnMrYSphO2k8TnVtYmVyLkVQU0lMT058fChpPTEvTWF0aC5zcXJ0KGkpLHRoaXMuc2V0KHQqaSxlKmkscyppLGEqaSkpfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55K3RoaXMueip0LnordGhpcy53KnQud31jcm9zcyh0KXtjb25zdCBlPXRoaXMueCxzPXRoaXMueSxhPXRoaXMueixpPXRoaXMudyxyPXQueCxuPXQueSxoPXQueixvPXQudztyZXR1cm4gbmV3IHUocypoLWEqbixhKm8taSpoLGkqci1lKm8sZSpuLXMqcil9Y29uanVnYXRlKCl7cmV0dXJuIG5ldyB1KC10aGlzLngsLXRoaXMueSwtdGhpcy56LHRoaXMudyl9aW52ZXJzZSgpe3JldHVybiB0aGlzLmNvbmp1Z2F0ZSgpfWFsaWduV2l0aCh0KXt0aGlzLmRvdCh0KTwwJiZ0aGlzLnNldCgtdGhpcy54LC10aGlzLnksLXRoaXMueiwtdGhpcy53KX1tdWx0aXBseSh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdLHM9dGhpcy5fX2RhdGFbMV0sYT10aGlzLl9fZGF0YVsyXSxpPXRoaXMuX19kYXRhWzNdLHI9dC5fX2RhdGFbMF0sbj10Ll9fZGF0YVsxXSxoPXQuX19kYXRhWzJdLG89dC5fX2RhdGFbM107cmV0dXJuIG5ldyB1KGUqbytpKnIrcypoLWEqbixzKm8raSpuK2Eqci1lKmgsYSpvK2kqaCtlKm4tcypyLGkqby1lKnItcypuLWEqaCl9bXVsdGlwbHlJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0scz10aGlzLl9fZGF0YVsxXSxhPXRoaXMuX19kYXRhWzJdLGk9dGhpcy5fX2RhdGFbM10scj10Ll9fZGF0YVswXSxuPXQuX19kYXRhWzFdLGg9dC5fX2RhdGFbMl0sbz10Ll9fZGF0YVszXTt0aGlzLnNldChlKm8raSpyK3MqaC1hKm4scypvK2kqbithKnItZSpoLGEqbytpKmgrZSpuLXMqcixpKm8tZSpyLXMqbi1hKmgpfXJvdGF0ZVZlYzModCl7Y29uc3QgZT1uZXcgdSh0LngsdC55LHQueiwwKSxzPXRoaXMubXVsdGlwbHkoZSkubXVsdGlwbHkodGhpcy5jb25qdWdhdGUoKSk7cmV0dXJuIG5ldyByKHMueCxzLnkscy56KX1yb3RhdGVYKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuK2kqcix0aGlzLnk9cypuK2Eqcix0aGlzLno9YSpuLXMqcix0aGlzLnc9aSpuLWUqcn1yb3RhdGVZKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuLWEqcix0aGlzLnk9cypuK2kqcix0aGlzLno9YSpuK2Uqcix0aGlzLnc9aSpuLXMqcn1yb3RhdGVaKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuK3Mqcix0aGlzLnk9cypuLWUqcix0aGlzLno9YSpuK2kqcix0aGlzLnc9aSpuLWEqcn10b01hdDMoKXtjb25zdCB0PXRoaXMueCxlPXRoaXMueSxzPXRoaXMueixhPXRoaXMudyxpPXQrdCxyPWUrZSxuPXMrcyxoPXQqaSxvPWUqaSxfPWUqcixsPXMqaSxjPXMqcix1PXMqbixmPWEqaSxtPWEqcixnPWEqbix5PW5ldyBkO3JldHVybiB5Ll9fZGF0YVswXT0xLV8tdSx5Ll9fZGF0YVszXT1vLWcseS5fX2RhdGFbNl09bCttLHkuX19kYXRhWzFdPW8rZyx5Ll9fZGF0YVs0XT0xLWgtdSx5Ll9fZGF0YVs3XT1jLWYseS5fX2RhdGFbMl09bC1tLHkuX19kYXRhWzVdPWMrZix5Ll9fZGF0YVs4XT0xLWgtXyx5fWdldFhheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy55LGU9dGhpcy54KnRoaXMueixzPXRoaXMueSp0aGlzLnksYT10aGlzLnkqdGhpcy53LGk9dGhpcy56KnRoaXMueixuPXRoaXMueip0aGlzLnc7cmV0dXJuIG5ldyByKDEtMiooaStzKSwyKih0K24pLDIqKGUtYSkpfWdldFlheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy54LGU9dGhpcy54KnRoaXMueSxzPXRoaXMueCp0aGlzLncsYT10aGlzLnkqdGhpcy56LGk9dGhpcy56KnRoaXMueixuPXRoaXMueip0aGlzLnc7cmV0dXJuIG5ldyByKDIqKGUtbiksMS0yKihpK3QpLDIqKGErcykpfWdldFpheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy54LGU9dGhpcy54KnRoaXMueixzPXRoaXMueCp0aGlzLncsYT10aGlzLnkqdGhpcy55LGk9dGhpcy55KnRoaXMueixuPXRoaXMueSp0aGlzLnc7bmV3IHI7cmV0dXJuIG5ldyByKDIqKG4rZSksMiooaS1zKSwxLTIqKGErdCkpfW1pcnJvcih0KXtzd2l0Y2godCl7Y2FzZSAwOnJldHVybiBuZXcgdSh0aGlzLnosdGhpcy53LHRoaXMueCx0aGlzLnkpO2Nhc2UgMTpyZXR1cm4gbmV3IHUoLXRoaXMudyx0aGlzLnosdGhpcy55LC10aGlzLngpO2Nhc2UgMjpyZXR1cm4gbmV3IHUodGhpcy54LHRoaXMueSx0aGlzLnosLXRoaXMudyl9fXRvTWF0NCgpe2NvbnN0IHQ9dGhpcy54LGU9dGhpcy55LHM9dGhpcy56LGE9dGhpcy53LGk9dCt0LHI9ZStlLG49cytzLGg9dCppLG89ZSppLF89ZSpyLGQ9cyppLGM9cypyLHU9cypuLGY9YSppLG09YSpyLGc9YSpuLHk9bmV3IGw7cmV0dXJuIHkuX19kYXRhWzBdPTEtXy11LHkuX19kYXRhWzRdPW8tZyx5Ll9fZGF0YVs4XT1kK20seS5fX2RhdGFbMV09bytnLHkuX19kYXRhWzVdPTEtaC11LHkuX19kYXRhWzldPWMtZix5Ll9fZGF0YVsyXT1kLW0seS5fX2RhdGFbNl09YytmLHkuX19kYXRhWzEwXT0xLWgtXyx5fWxlcnAodCxlKXtjb25zdCBzPW5ldyB1KHRoaXMueCtlKih0LngtdGhpcy54KSx0aGlzLnkrZSoodC55LXRoaXMueSksdGhpcy56K2UqKHQuei10aGlzLnopLHRoaXMudytlKih0LnctdGhpcy53KSk7cmV0dXJuIHMubm9ybWFsaXplSW5QbGFjZSgpLHN9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IHUoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IHUodCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fWNsb25lKCl7cmV0dXJuIG5ldyB1KHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdKX10b0pTT04oKXtyZXR1cm57eDp0aGlzLngseTp0aGlzLnksejp0aGlzLnosdzp0aGlzLnd9fWZyb21KU09OKHQpe3RoaXMuX19kYXRhWzBdPXQueCx0aGlzLl9fZGF0YVsxXT10LnksdGhpcy5fX2RhdGFbMl09dC56LHRoaXMuX19kYXRhWzNdPXQudyx0aGlzLm5vcm1hbGl6ZUluUGxhY2UoKX19YS5yZWdpc3RlclR5cGUoIlF1YXQiLHUpO2NsYXNzIGZ7Y29uc3RydWN0b3IodCxlKXt0aGlzLnN0YXJ0PXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIsdGhpcy5kaXI9ZSBpbnN0YW5jZW9mIHI/ZTpuZXcgcn1jbG9zZXN0UG9pbnQodCl7Y29uc3QgZT10LnN1YnRyYWN0KHRoaXMuc3RhcnQpLmRvdCh0aGlzLmRpcik7aWYoZTxOdW1iZXIuRVBTSUxPTilyZXR1cm4gdGhpcy5zdGFydDtjb25zdCBzPWUvdGhpcy5kaXIuZG90KHRoaXMuZGlyKTtyZXR1cm4gdGhpcy5zdGFydC5hZGQodGhpcy5kaXIuc2NhbGUocykpfXBvaW50QXREaXN0KHQpe3JldHVybiB0aGlzLnN0YXJ0LmFkZCh0aGlzLmRpci5zY2FsZSh0KSl9aW50ZXJzZWN0UmF5VmVjdG9yKHQpe2NvbnN0IGU9dGhpcy5kaXIscz10LmRpcixhPXRoaXMuc3RhcnQuc3VidHJhY3QodC5zdGFydCksaT1lLmRvdChlKSxyPWUuZG90KHMpLG49cy5kb3QocyksaD1lLmRvdChhKSxvPXMuZG90KGEpO2lmKDA9PWkmJjA9PW4pcmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUbyh0LnN0YXJ0KTtpZigwPT1pKXJldHVybiB0LmNsb3Nlc3RQb2ludCh0aGlzLnN0YXJ0KTtpZigwPT1uKXJldHVybiB0aGlzLmNsb3Nlc3RQb2ludCh0LnN0YXJ0KTtjb25zdCBfPWkqbi1yKnI7bGV0IGQsbDtyZXR1cm4gXzwuMDAxPyhkPTAsbD1yPm4/aC9yOm8vbik6KGQ9KHIqby1uKmgpL18sbD0oaSpvLXIqaCkvXyksW2QsbF19aW50ZXJzZWN0UmF5UGxhbmUodCl7Y29uc3QgZT10aGlzLnN0YXJ0LnN1YnRyYWN0KHQuc3RhcnQpLHM9dC5kaXIuZG90KHRoaXMuZGlyKSxhPS10LmRpci5kb3QoZSk7aWYoTWF0aC5hYnMocyk8TnVtYmVyLlBSRUNJU0lPTilyZXR1cm4tMTtjb25zdCBpPWEvcztyZXR1cm4gaTwtTnVtYmVyLlBSRUNJU0lPTj8tMTppfWNsb25lKCl7cmV0dXJuIG5ldyBmKHRoaXMuc3RhcnQuY2xvbmUoKSx0aGlzLmRpci5jbG9uZSgpKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgZiguLi50KX10b0pTT04oKXtyZXR1cm57c3RhcnQ6dGhpcy5zdGFydCxkaXI6dGhpcy5kaXJ9fWZyb21KU09OKHQpe3RoaXMuc3RhcnQuZnJvbUpTT04odC5zdGFydCksdGhpcy5kaXIuZnJvbUpTT04odC5kaXIpfXRvU3RyaW5nKCl7cmV0dXJuIGUodGhpcy50b0pTT04oKSl9fWEucmVnaXN0ZXJUeXBlKCJSYXkiLGYpO25ldyByKDEsMSwxKTtjbGFzcyBte2NvbnN0cnVjdG9yKHQsZSxzKXtpZih0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KXRoaXMuc2V0RnJvbUZsb2F0MzJBcnJheSh0KTtlbHNle2lmKHQgaW5zdGFuY2VvZiByKXRoaXMudHI9dDtlbHNle2lmKHQgaW5zdGFuY2VvZiB1JiZudWxsPT1lJiZudWxsPT1zKXJldHVybiB0aGlzLnRyPW5ldyByLHRoaXMub3JpPXQsdm9pZCh0aGlzLnNjPW5ldyByKDEsMSwxKSk7dGhpcy50cj1uZXcgcn10aGlzLm9yaT1lIGluc3RhbmNlb2YgdT9lOm5ldyB1LHRoaXMuc2M9cyBpbnN0YW5jZW9mIHI/czpuZXcgcigxLDEsMSl9fXNldCh0LGUscyl7dGhpcy50cj10LHRoaXMub3JpPWUscyBpbnN0YW5jZW9mIHImJih0aGlzLnNjPXMpfXNldEZyb21PdGhlcih0KXt0aGlzLnRyPXQudHIsdGhpcy5vcmk9dC5vcmksdGhpcy5zYz10LnNjfWlzSWRlbnRpdHkoKXtyZXR1cm4gdGhpcy50ci5pc051bGwoKSYmdGhpcy5vcmkuaXNJZGVudGl0eSgpJiZ0aGlzLnNjLmlzMTExKCl9c2V0TG9va0F0KHQsZSxzKXtjb25zdCBhPXQuc3VidHJhY3QoZSk7aWYoYS5sZW5ndGgoKTxOdW1iZXIuRVBTSUxPTil0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZGlyIik7dGhpcy5vcmkuc2V0RnJvbURpcmVjdGlvbkFuZFVwdmVjdG9yKGEscyksdGhpcy50cj10fW11bHRpcGx5KHQpe2xldCBlPXRoaXMuc2M7dGhpcy5zYy54PT10aGlzLnNjLnkmJnRoaXMuc2MueD09dGhpcy5zYy56fHwoZT10Lm9yaS5yb3RhdGVWZWMzKHRoaXMuc2MpLE1hdGguc2lnbihlLngpIT1NYXRoLnNpZ24odGhpcy5zYy54KSYmKGUueD0tZS54KSxNYXRoLnNpZ24oZS55KSE9TWF0aC5zaWduKHRoaXMuc2MueSkmJihlLnk9LWUueSksTWF0aC5zaWduKGUueikhPU1hdGguc2lnbih0aGlzLnNjLnopJiYoZS56PS1lLnopKTtyZXR1cm4gbmV3IG0odGhpcy50ci5hZGQodGhpcy5vcmkucm90YXRlVmVjMyhlLm11bHRpcGx5KHQudHIpKSksdGhpcy5vcmkubXVsdGlwbHkodC5vcmkpLGUubXVsdGlwbHkodC5zYykpfWludmVyc2UoKXtjb25zdCB0PW5ldyBtO3JldHVybiB0Lm9yaT10aGlzLm9yaS5pbnZlcnNlKCksdGhpcy5zYy54IT10aGlzLnNjLnl8fHRoaXMuc2MueCE9dGhpcy5zYy56Pyh0LnNjPXQub3JpLnJvdGF0ZVZlYzModGhpcy5zYyksTWF0aC5zaWduKHQuc2MueCkhPU1hdGguc2lnbih0aGlzLnNjLngpJiYodC5zYy54PS10LnNjLngpLE1hdGguc2lnbih0LnNjLnkpIT1NYXRoLnNpZ24odGhpcy5zYy55KSYmKHQuc2MueT0tdC5zYy55KSxNYXRoLnNpZ24odC5zYy56KSE9TWF0aC5zaWduKHRoaXMuc2MueikmJih0LnNjLno9LXQuc2MueikpOnQuc2M9dGhpcy5zYy5pbnZlcnNlKCksdC50cj10Lm9yaS5yb3RhdGVWZWMzKHRoaXMudHIubmVnYXRlKCkubXVsdGlwbHkodC5zYykpLHR9dHJhbnNmb3JtVmVjMyh0KXtyZXR1cm4gdGhpcy50ci5hZGQodGhpcy5vcmkucm90YXRlVmVjMyh0aGlzLnNjLm11bHRpcGx5KHQpKSl9dG9NYXQ0KCl7Y29uc3QgdD1uZXcgbCh0aGlzLnNjLngsMCwwLDAsMCx0aGlzLnNjLnksMCwwLDAsMCx0aGlzLnNjLnosMCwwLDAsMCwxKSxlPXRoaXMub3JpLnRvTWF0NCgpLHM9bmV3IGw7cmV0dXJuIHMudHJhbnNsYXRpb249dGhpcy50cixzLm11bHRpcGx5KGUpLm11bHRpcGx5KHQpfWZyb21NYXQ0KHQpe3RoaXMudHI9dC50cmFuc2xhdGlvbix0aGlzLm9yaS5zZXRGcm9tTWF0NCh0KX1zZXRGcm9tRmxvYXQzMkFycmF5KHQpe2lmKDc9PXQubGVuZ3RoKXJldHVybiB0aGlzLnRyPW5ldyByKHQuYnVmZmVyLHQuYnl0ZU9mZnNldCksdGhpcy5vcmk9bmV3IHUodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKSx2b2lkKHRoaXMuc2M9bmV3IHIoMSwxLDEpKTtpZig4IT10Lmxlbmd0aClyZXR1cm4gMTA9PXQubGVuZ3RoPyh0aGlzLnRyPW5ldyByKHQuYnVmZmVyLHQuYnl0ZU9mZnNldCksdGhpcy5vcmk9bmV3IHUodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKSx2b2lkKHRoaXMuc2M9bmV3IHIodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzIxKSkpOnZvaWQgMDt7dGhpcy50cj1uZXcgcih0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQpLHRoaXMub3JpPW5ldyB1KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCsxMik7Y29uc3QgZT10WzddO3RoaXMuc2M9bmV3IHIoZSxlLGUpfX1jbG9uZSgpe3JldHVybiBuZXcgbSh0aGlzLnRyLmNsb25lKCksdGhpcy5vcmkuY2xvbmUoKSx0aGlzLnNjLmNsb25lKCkpfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBtKC4uLnQpfXRvSlNPTigpe2NvbnN0IHQ9e3RyOnRoaXMudHIudG9KU09OKCksb3JpOnRoaXMub3JpLnRvSlNPTigpfTtyZXR1cm4gdGhpcy5zYy5pczExMSgpfHwodC5zYz10aGlzLnNjLnRvSlNPTigpKSx0fWZyb21KU09OKHQpe3RoaXMudHIuZnJvbUpTT04odC50ciksdGhpcy5vcmkuZnJvbUpTT04odC5vcmkpLHQuc2MmJnRoaXMuc2MuZnJvbUpTT04odC5zYyl9dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIlhmbyIsbSk7Y2xhc3MgZ3tjb25zdHJ1Y3Rvcih0LGUpe3RoaXMucDA9dCBpbnN0YW5jZW9mIGk/dDpuZXcgaShOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSx0aGlzLnAxPWUgaW5zdGFuY2VvZiBpP2U6bmV3IGkoTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLE51bWJlci5ORUdBVElWRV9JTkZJTklUWSl9c2V0KHQsZSl7dGhpcy5wMD10LHRoaXMucDE9ZX1yZXNldCgpe3RoaXMucDAueD1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksdGhpcy5wMS54PU51bWJlci5ORUdBVElWRV9JTkZJTklUWSx0aGlzLnAwLnk9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLHRoaXMucDEueT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFl9aXNWYWxpZCgpe3JldHVybiB0aGlzLnAwLnghPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdGhpcy5wMS54IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJnRoaXMucDAueSE9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZJiZ0aGlzLnAxLnkhPU51bWJlci5ORUdBVElWRV9JTkZJTklUWX1hZGRQb2ludCh0KXsodGhpcy5wMC54PT1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl8fHQueDx0aGlzLnAwLngpJiYodGhpcy5wMC54PXQueCksKHRoaXMucDAueT09TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfHx0Lnk8dGhpcy5wMC55KSYmKHRoaXMucDAueT10LnkpLCh0aGlzLnAxLnk9PU51bWJlci5ORUdBVElWRV9JTkZJTklUWXx8dC54PnRoaXMucDEueCkmJih0aGlzLnAxLng9dC54KSwodGhpcy5wMS55PT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFl8fHQueT50aGlzLnAxLnkpJiYodGhpcy5wMS55PXQueSl9c2l6ZSgpe3JldHVybiB0aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApfWRpYWdvbmFsKCl7cmV0dXJuIHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCl9Y2VudGVyKCl7Y29uc3QgdD10aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApO3JldHVybiB0LnNjYWxlSW5QbGFjZSguNSksdC5hZGRJblBsYWNlKHRoaXMucDApLHR9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IGcoLi4udCl9dG9KU09OKCl7cmV0dXJue3AwOnRoaXMucDAudG9KU09OKCkscDE6dGhpcy5wMS50b0pTT04oKX19dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIkJveDIiLGcpO2NsYXNzIHkgZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQsZT0wKXtzdXBlcigpLHRoaXMucG9zPXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIsdGhpcy5yYWRpdXM9ZX1jbG9uZSgpe3JldHVybiBuZXcgU3BoZXJlKHRoaXMucG9zLmNsb25lKCksdGhpcy5yYWRpdXMpfWludGVyc2VjdHNCb3godCl7cmV0dXJuIHQuaW50ZXJzZWN0c1NwaGVyZSh0aGlzKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgU3BoZXJlKC4uLnQpfXRvSlNPTigpe3JldHVybntwb3M6dGhpcy5wb3MudG9KU09OKCkscmFkaXVzOnRoaXMucmFkaXVzfX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX1hLnJlZ2lzdGVyVHlwZSgiU3BoZXJlVHlwZSIseSk7Y2xhc3MgcHtjb25zdHJ1Y3Rvcih0LGUpe3QgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXk/dGhpcy5zZXRGcm9tRmxvYXQzMkFycmF5KHQpOih0aGlzLnAwPXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIoTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLHRoaXMucDE9ZSBpbnN0YW5jZW9mIHI/ZTpuZXcgcihOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkpfWdldCBtaW4oKXtyZXR1cm4gdGhpcy5wMH1nZXQgbWF4KCl7cmV0dXJuIHRoaXMucDF9c2V0KHQsZSl7dGhpcy5wMD10LHRoaXMucDE9ZX1yZXNldCgpe3RoaXMucDAueD1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksdGhpcy5wMS54PU51bWJlci5ORUdBVElWRV9JTkZJTklUWSx0aGlzLnAwLnk9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLHRoaXMucDEueT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksdGhpcy5wMC56PU51bWJlci5QT1NJVElWRV9JTkZJTklUWSx0aGlzLnAxLno9TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZfWlzVmFsaWQoKXtyZXR1cm4gdGhpcy5wMC54IT1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkmJnRoaXMucDEueCE9TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZJiZ0aGlzLnAwLnkhPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdGhpcy5wMS55IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJnRoaXMucDAueiE9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZJiZ0aGlzLnAxLnohPU51bWJlci5ORUdBVElWRV9JTkZJTklUWX1hZGRQb2ludCh0KXt0LnghPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC54IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lng8dGhpcy5wMC54JiYodGhpcy5wMC54PXQueCksdC54PnRoaXMucDEueCYmKHRoaXMucDEueD10LngpKSx0LnkhPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC55IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lnk8dGhpcy5wMC55JiYodGhpcy5wMC55PXQueSksdC55PnRoaXMucDEueSYmKHRoaXMucDEueT10LnkpKSx0LnohPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC56IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lno8dGhpcy5wMC56JiYodGhpcy5wMC56PXQueiksdC56PnRoaXMucDEueiYmKHRoaXMucDEuej10LnopKX1hZGRCb3gzKHQsZSl7ZT8odGhpcy5hZGRQb2ludChlLnRyYW5zZm9ybVZlYzModC5wMCkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAwLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAxLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAwLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAxLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAwLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAxLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKHQucDEpKSk6KHRoaXMuYWRkUG9pbnQodC5wMCksdGhpcy5hZGRQb2ludCh0LnAxKSl9c2l6ZSgpe3JldHVybiB0aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApfWRpYWdvbmFsKCl7cmV0dXJuIHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCl9Y2VudGVyKCl7Y29uc3QgdD10aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApO3JldHVybiB0LnNjYWxlSW5QbGFjZSguNSksdC5hZGRJblBsYWNlKHRoaXMucDApLHR9dG9NYXQ0KCl7Y29uc3QgdD10aGlzLnAxLngtdGhpcy5wMC54LGU9dGhpcy5wMS55LXRoaXMucDAueSxzPXRoaXMucDEuei10aGlzLnAwLno7cmV0dXJuIG5ldyBsKHQsMCwwLDAsMCxlLDAsMCwwLDAscywwLHRoaXMucDAueCx0aGlzLnAwLnksdGhpcy5wMC56LDEpfWdldEJvdW5kaW5nU3BoZXJlKCl7cmV0dXJuIG5ldyB5KHRoaXMuY2VudGVyKCksLjUqdGhpcy5kaWFnb25hbCgpLmxlbmd0aCgpKX1pbnRlcnNlY3RzQm94KHQpe3JldHVybiEodC5tYXgueDx0aGlzLm1pbi54fHx0Lm1pbi54PnRoaXMubWF4Lnh8fHQubWF4Lnk8dGhpcy5taW4ueXx8dC5taW4ueT50aGlzLm1heC55fHx0Lm1heC56PHRoaXMubWluLnp8fHQubWluLno+dGhpcy5tYXgueil9aW50ZXJzZWN0c1NwaGVyZSh0KXtyZXR1cm4gY2xvc2VzdFBvaW50LmRpc3RhbmNlVG9TcXVhcmVkKHQuY2VudGVyKTw9dC5yYWRpdXMqdC5yYWRpdXN9aW50ZXJzZWN0c1BsYW5lKHQpe2xldCBlLHM7cmV0dXJuIHQubm9ybWFsLng+MD8oZT10Lm5vcm1hbC54KnRoaXMubWluLngscz10Lm5vcm1hbC54KnRoaXMubWF4LngpOihlPXQubm9ybWFsLngqdGhpcy5tYXgueCxzPXQubm9ybWFsLngqdGhpcy5taW4ueCksdC5ub3JtYWwueT4wPyhlKz10Lm5vcm1hbC55KnRoaXMubWluLnkscys9dC5ub3JtYWwueSp0aGlzLm1heC55KTooZSs9dC5ub3JtYWwueSp0aGlzLm1heC55LHMrPXQubm9ybWFsLnkqdGhpcy5taW4ueSksdC5ub3JtYWwuej4wPyhlKz10Lm5vcm1hbC56KnRoaXMubWluLnoscys9dC5ub3JtYWwueip0aGlzLm1heC56KTooZSs9dC5ub3JtYWwueip0aGlzLm1heC56LHMrPXQubm9ybWFsLnoqdGhpcy5taW4ueiksZTw9LXQuY29uc3RhbnQmJnM+PS10LmNvbnN0YW50fWNsb25lKCl7cmV0dXJuIG5ldyBwKHRoaXMucDAuY2xvbmUoKSx0aGlzLnAxLmNsb25lKCkpfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBwKC4uLnQpfXN0YXRpYyBzaXplSW5CeXRlcygpe3JldHVybiAyNH10b0pTT04oKXtyZXR1cm57cDA6dGhpcy5wMC50b0pTT04oKSxwMTp0aGlzLnAxLnRvSlNPTigpfX1mcm9tSlNPTih0KXt0aGlzLnAwLmZyb21KU09OKHQucDApLHRoaXMucDEuZnJvbUpTT04odC5wMSl9bG9hZEJpbih0LGUpe3RoaXMucDAubG9hZEJpbih0LGUpLHRoaXMucDAubG9hZEJpbih0LGUrMTIpfXNldEZyb21GbG9hdDMyQXJyYXkodCl7dGhpcy5wMD1uZXcgcih0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQpLHRoaXMucDE9bmV3IHIodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX1hLnJlZ2lzdGVyVHlwZSgiQm94MyIscCk7Y2xhc3MgeCBleHRlbmRzIHN7Y29uc3RydWN0b3IodCxlPTApe3N1cGVyKCksdGhpcy5ub3JtYWw9dCBpbnN0YW5jZW9mIHI/dDpuZXcgcix0aGlzLnc9ZX1zZXQodCxlLHMsYSl7dGhpcy5ub3JtYWwuc2V0KHQsZSxzKSx0aGlzLnc9YX1kaXZpZGVTY2FsYXIodCl7dGhpcy5ub3JtYWwuc2NhbGVJblBsYWNlKDEvdCksdGhpcy53Lz10fWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdC5kb3QodGhpcy5ub3JtYWwpK3RoaXMud31ub3JtYWxpemVJblBsYWNlKCl7Y29uc3QgdD0xL3RoaXMubm9ybWFsLmxlbmd0aCgpO3RoaXMubm9ybWFsLnNjYWxlSW5QbGFjZSh0KSx0aGlzLncqPXR9Y2xvbmUoKXtyZXR1cm4gbmV3IFBsYW5lKHRoaXMubm9ybWFsLmNsb25lKCksdGhpcy53KX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgUGxhbmUoLi4udCl9dG9KU09OKCl7cmV0dXJue25vcm1hbDp0aGlzLm5vcm1hbC50b0pTT04oKSx3OnRoaXMud319dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIlBsYW5lVHlwZSIseCk7YS5yZWdpc3RlclR5cGUoIkZydXN0dW0iLGNsYXNze2NvbnN0cnVjdG9yKHQsZSxzLGEsaSxyKXt0aGlzLnBsYW5lcz1bdHx8bmV3IHgsZXx8bmV3IHgsc3x8bmV3IHgsYXx8bmV3IHgsaXx8bmV3IHgscnx8bmV3IHhdfXNldEZyb21NYXRyaXgodCl7Y29uc3QgZT10LHM9dGhpcy5wbGFuZXM7c1swXS5zZXQoZS5tMDMtZS5tMDAsZS5tMTMtZS5tMTAsZS5tMjMtZS5tMjAsZS5tMzMtZS5tMzApLHNbMV0uc2V0KGUubTAzK2UubTAwLGUubTEzK2UubTEwLGUubTIzK2UubTIwLGUubTMzK2UubTMwKSxzWzJdLnNldChlLm0wMytlLm0wMSxlLm0xMytlLm0xMSxlLm0yMytlLm0yMSxlLm0zMytlLm0zMSksc1szXS5zZXQoZS5tMDMtZS5tMDEsZS5tMTMtZS5tMTEsZS5tMjMtZS5tMjEsZS5tMzMtZS5tMzEpLHNbNF0uc2V0KGUubTAzLWUubTAyLGUubTEzLWUubTEyLGUubTIzLWUubTIyLGUubTMzLWUubTMyKSxzWzVdLnNldChlLm0wMytlLm0wMixlLm0xMytlLm0xMixlLm0yMytlLm0yMixlLm0zMytlLm0zMikscy5mb3JFYWNoKHQ9PnQubm9ybWFsaXplSW5QbGFjZSgpKX1pbnRlcnNlY3RzQm94KHQpe2NvbnN0IGU9bmV3IHIscz10aGlzLnBsYW5lcyx7bWluOmEsbWF4Oml9PXQ7Zm9yKGxldCB0PTA7dDw2O3QrKyl7Y29uc3Qgcj1zW3RdO2lmKGUueD1yLm5vcm1hbC54PjA/aS54OmEueCxlLnk9ci5ub3JtYWwueT4wP2kueTphLnksZS56PXIubm9ybWFsLno+MD9pLno6YS56LHIuZGlzdGFuY2VUb1BvaW50KGUpPDApcmV0dXJuITF9cmV0dXJuITB9dG9KU09OKCl7cmV0dXJue3AwOnRoaXMucDAudG9KU09OKCkscDE6dGhpcy5wMS50b0pTT04oKSxwMjp0aGlzLnAyLnRvSlNPTigpLHAzOnRoaXMucDMudG9KU09OKCkscDQ6dGhpcy5wNC50b0pTT04oKSxwNTp0aGlzLnA1LnRvSlNPTigpfX1mcm9tSlNPTih0KXt0aGlzLnAwLmZyb21KU09OKHQucDApLHRoaXMucDEuZnJvbUpTT04odC5wMSksdGhpcy5wMi5mcm9tSlNPTih0LnAyKSx0aGlzLnAzLmZyb21KU09OKHQucDMpLHRoaXMucDQuZnJvbUpTT04odC5wNCksdGhpcy5wNS5mcm9tSlNPTih0LnA1KX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX0pO2NvbnN0IHc9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzPXt9LHRoaXMuX19jbGFzc05hbWVzPXt9LHRoaXMuX19jbGFzc0xpc3Q9W119cmVnaXN0ZXJDbGFzcyh0LGUpe3RoaXMuX19yZWdpc3RlcmVkQ2xhc3Nlc1t0XT17Y2xzOmUsY2FsbGJhY2tzOltdfTtjb25zdCBzPXRoaXMuX19jbGFzc0xpc3QubGVuZ3RoO3RoaXMuX19jbGFzc0xpc3QucHVzaChlKSx0aGlzLl9fY2xhc3NOYW1lc1tzXT10fWdldENsYXNzKHQpe2lmKHRoaXMuX19yZWdpc3RlcmVkQ2xhc3Nlc1t0XSlyZXR1cm4gdGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzW3RdLmNsc31nZXRDbGFzc05hbWUodCl7Y29uc3QgZT10aGlzLl9fY2xhc3NMaXN0LmluZGV4T2YodC5jb25zdHJ1Y3Rvcik7cmV0dXJuIHRoaXMuX19jbGFzc05hbWVzW2VdP3RoaXMuX19jbGFzc05hbWVzW2VdOihjb25zb2xlLndhcm4oIkNsYXNzIG5vdCByZWdpc3RlcmVkOiIsdC5jb25zdHJ1Y3Rvci5uYW1lKSx0LmNvbnN0cnVjdG9yLm5hbWUpfWNvbnN0cnVjdENsYXNzKHQpe2NvbnN0IGU9dGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzW3RdO2lmKCFlKXJldHVybiBjb25zb2xlLndhcm4oIkZhY3Rvcnkgbm90IHJlZ2lzdGVyZWQ6Iit0KSxudWxsO3RoaXMuX19jb25zdHJ1Y3Rpbmc9ITA7Y29uc3Qgcz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksYT1uZXcgZS5jbHMoLi4ucyk7cmV0dXJuIHRoaXMuX19jb25zdHJ1Y3Rpbmc9ITEsYX19LEk9MyxOPTI7bGV0IEY9MDtjbGFzcyB6e2NvbnN0cnVjdG9yKHQsZSxzKXtpZih0aGlzLl9fZGF0YVR5cGU9dCx0aGlzLm5vcm1hbGl6ZWQ9ITEsbnVsbCE9dC5udW1FbGVtZW50cyl0aGlzLl9fZGltZW5zaW9uPXRoaXMuX19kYXRhVHlwZS5udW1FbGVtZW50cygpO2Vsc2Ugc3dpdGNoKHQpe2Nhc2UgNjpjYXNlIDQ6Y2FzZSA1OnRoaXMuX19kaW1lbnNpb249MTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBkYXRhIHR5cGUgZm9yIGF0dHJpYnV0ZToiK3QpfXZhciBhO3RoaXMuX19kZWZhdWx0RWxlbWVudFZhbHVlPW51bGwhPXM/czpOdW1iZXIuTUFYX1ZBTFVFLChhPWUpJiZ2b2lkIDAhPT1hLmJ5dGVMZW5ndGg/dGhpcy5fX2RhdGE9ZToodGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShlKnRoaXMuX19kaW1lbnNpb24pLHRoaXMuaW5pdFJhbmdlKDApKX1yZXNpemUodCl7Y29uc3QgZT10aGlzLl9fZGF0YS5sZW5ndGgscz10KnRoaXMuX19kaW1lbnNpb24sYT1uZXcgRmxvYXQzMkFycmF5KHMpO2ZvcihsZXQgdD0wO3Q8TWF0aC5taW4odGhpcy5fX2RhdGEubGVuZ3RoLHMpO3QrKylhW3RdPXRoaXMuX19kYXRhW3RdO3RoaXMuX19kYXRhLmxlbmd0aDxzJiYodGhpcy5fX2RhdGE9YSksdGhpcy5pbml0UmFuZ2UoZSl9aW5pdFJhbmdlKHQpe2ZvcihsZXQgZT10O2U8dGhpcy5fX2RhdGEubGVuZ3RoO2UrKyl0aGlzLl9fZGF0YVtlXT10aGlzLl9fZGVmYXVsdEVsZW1lbnRWYWx1ZX1nZXRDb3VudCgpe3JldHVybiB0aGlzLl9fZGF0YS5sZW5ndGgvdGhpcy5fX2RpbWVuc2lvbn1nZXQgbGVuZ3RoKCl7cmV0dXJuIHRoaXMuX19kYXRhLmxlbmd0aC90aGlzLl9fZGltZW5zaW9ufWdldCBkYXRhVHlwZSgpe3JldHVybiB0aGlzLl9fZGF0YVR5cGV9Z2V0IGRhdGEoKXtyZXR1cm4gdGhpcy5fX2RhdGF9c2V0IGRhdGEodCl7dGhpcy5fX2RhdGE9dH1nZXQgbnVtRWxlbWVudHMoKXtyZXR1cm4gdGhpcy5fX2RpbWVuc2lvbn1nZXRGbG9hdDMyVmFsdWUodCl7cmV0dXJuIHRoaXMuX19kYXRhW3RdfXNldEZsb2F0MzJWYWx1ZSh0LGUpe3RoaXMuX19kYXRhW3RdPWV9Z2V0VmFsdWVSZWYodCl7Y29uc3QgZT10aGlzLl9fZGltZW5zaW9uO2lmKHQ+PXRoaXMuX19kYXRhLmxlbmd0aC9lKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2ZXJ0ZXggaW5kZXg6Iit0KyIuIE51bSBWZXJ0aWNlczoiK3RoaXMuX19kYXRhLmxlbmd0aC8zKTtyZXR1cm4gdGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlcix0KmUpfXNldFZhbHVlKHQsZSl7Y29uc3Qgcz10aGlzLl9fZGltZW5zaW9uO2lmKHQ+PXRoaXMuX19kYXRhLmxlbmd0aC9zKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2ZXJ0ZXggaW5kZXg6Iit0KyIuIE51bSBWZXJ0aWNlczoiK3RoaXMuX19kYXRhLmxlbmd0aC8zKTt0aGlzLl9fZGF0YVR5cGUuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLHQqcykuc2V0RnJvbU90aGVyKGUpfXRvSlNPTih0LGUpe3JldHVybntkYXRhOkFycmF5LmZyb20odGhpcy5fX2RhdGEpLGRhdGFUeXBlOmEuZ2V0VHlwZU5hbWUodGhpcy5fX2RhdGFUeXBlKSxkZWZhdWx0VmFsdWU6dGhpcy5fX2RlZmF1bHRFbGVtZW50VmFsdWUsbGVuZ3RoOnRoaXMuX19kYXRhLmxlbmd0aC90aGlzLl9fZGltZW5zaW9ufX1mcm9tSlNPTih0KXt0aGlzLl9fZGF0YT1GbG9hdDMyQXJyYXkuZnJvbSh0LmRhdGEpfXRvU3RyaW5nKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCksbnVsbCwyKX19Y2xhc3MgViBleHRlbmRzIGNsYXNzIGV4dGVuZHMgY2xhc3N7Y29uc3RydWN0b3IoKXt0aGlzLl9fc2xvdHM9e319YWRkTGlzdGVuZXIodCxlKXtpZihudWxsPT1lKXRocm93IG5ldyBFcnJvcigiYSBmdW5jdGlvbiBjYWxsYmFjayBtdXN0IGJlIHBhc3NlZCB0byBFdmVudEVtaXR0ZXIuYWRkTGlzdGVuZXIiKTt0aGlzLl9fc2xvdHNbdF18fCh0aGlzLl9fc2xvdHNbdF09W10pO2NvbnN0IHM9dGhpcy5fX3Nsb3RzW3RdO2lmKC0xIT1zLmluZGV4T2YoZSkpcmV0dXJuIHZvaWQgY29uc29sZS53YXJuKCJsaXN0ZW5lciAnIitlLm5hbWUrIicgYWxyZWFkeSBjb25uZWN0ZWQgdG8gRXZlbnRFbWl0dGVyIHdpdGggZXZlbnROYW1lOiIrdCk7Y29uc3QgYT1zLmxlbmd0aDtyZXR1cm4gc1thXT1lLGF9cmVtb3ZlTGlzdGVuZXIodCxlKXtpZihudWxsPT1lKXRocm93IG5ldyBFcnJvcigiYSBmdW5jdGlvbiBjYWxsYmFjayBtdXN0IGJlIHBhc3NlZCB0byBFdmVudEVtaXR0ZXIuZGlzY29ubmVjdCIpO2NvbnN0IHM9dGhpcy5fX3Nsb3RzW3RdLGE9W107aWYocyYmcy5mb3JFYWNoKCh0LHMpPT57dD09PWUmJmEucHVzaChzKX0pLDA9PWEubGVuZ3RoKXtjb25zdCB0PXRoaXMuZ2V0TmFtZT90aGlzLmdldE5hbWUoKTp0aGlzLmNvbnN0cnVjdG9yLm5hbWU7Y29uc29sZS53YXJuKCJFcnJvciBpbiByZW1vdmVMaXN0ZW5lci4gbGlzdGVuZXIgOiIrZS5uYW1lKyIgd2FzIG5vdCBjb25uZWN0ZWQgdG8gdGhpcyBldmVudCBlbWl0dGVyOiIrdCl9ZWxzZSBmb3IoY29uc3QgdCBvZiBhKXNbdF09dm9pZCAwfXJlbW92ZUxpc3RlbmVyQnlJZCh0LGUpe2NvbnN0IHM9dGhpcy5fX3Nsb3RzW3RdO2lmKHMpe2lmKCFzW2VdKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBJRCIpO3NbZV09dm9pZCAwfWVsc2V7Y29uc3Qgcz0iY2FsbGJhY2sgOiIrZSsiIHdhcyBub3QgY29ubmVjdGVkIHRvIHRoaXMgc2lnbmFsOiIrdDtjb25zb2xlLndhcm4ocyl9fW9uKHQsZSl7cmV0dXJuIHRoaXMuYWRkTGlzdGVuZXIodCxlKX1vbmNlKHQsZSl7Y29uc3Qgcz10aGlzLmFkZExpc3RlbmVyKHQsYT0+e2UoYSksdGhpcy5yZW1vdmVMaXN0ZW5lckJ5SWQodCxzKX0pfW9mZih0LGUpeyJudW1iZXIiPT10eXBlb2YgZT90aGlzLnJlbW92ZUxpc3RlbmVyQnlJZCh0LGUpOnRoaXMucmVtb3ZlTGlzdGVuZXIodCxlKX1lbWl0KHQsZSl7Y29uc3Qgcz10aGlzLl9fc2xvdHNbdF07aWYoIXMpcmV0dXJuO2NvbnN0IGE9cy5sZW5ndGg7Zm9yKGxldCB0PTA7dDxhO3QrKyl7Y29uc3QgYT1zW3RdO2EmJmEoZSl9fX17Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuX19pZD0rK0YsdGhpcy5fX3BhcmFtcz1bXSx0aGlzLl9fcGFyYW1NYXBwaW5nPXt9LHRoaXMuX19wYXJhbVNpZ25hbElkcz17fX1nZXRJZCgpe3JldHVybiB0aGlzLl9faWR9bnVtUGFyYW1ldGVycygpe3JldHVybiB0aGlzLl9fcGFyYW1zLmxlbmd0aH1nZXRQYXJhbWV0ZXJzKCl7cmV0dXJuIHRoaXMuX19wYXJhbXN9Z2V0UGFyYW1ldGVySW5kZXgodCl7cmV0dXJuIHRoaXMuX19wYXJhbU1hcHBpbmdbdF19Z2V0UGFyYW1ldGVyQnlJbmRleCh0KXtyZXR1cm4gdGhpcy5fX3BhcmFtc1t0XX1oYXNQYXJhbWV0ZXIodCl7cmV0dXJuIHQgaW4gdGhpcy5fX3BhcmFtTWFwcGluZ31nZXRQYXJhbWV0ZXIodCl7Y29uc3QgZT10aGlzLl9fcGFyYW1NYXBwaW5nW3RdO3JldHVybi0xPT1lP251bGw6dGhpcy5fX3BhcmFtc1tlXX1fX3BhcmFtZXRlclZhbHVlQ2hhbmdlZCh0KXt0aGlzLmVtaXQoInBhcmFtZXRlclZhbHVlQ2hhbmdlZCIsdCl9YWRkUGFyYW1ldGVyKHQpe2NvbnN0IGU9dC5nZXROYW1lKCk7cmV0dXJuIG51bGwhPXRoaXMuX19wYXJhbU1hcHBpbmdbZV0mJihjb25zb2xlLndhcm4oIlJlcGxhY2luZyBQYXJhbWV0ZXI6IitlKSx0aGlzLnJlbW92ZVBhcmFtZXRlcihlKSksdGhpcy5fX3BhcmFtU2lnbmFsSWRzW2VdPXQuYWRkTGlzdGVuZXIoInZhbHVlQ2hhbmdlZCIsZT0+dGhpcy5fX3BhcmFtZXRlclZhbHVlQ2hhbmdlZCh7Li4uZSxwYXJhbTp0fSkpLHRoaXMuX19wYXJhbXMucHVzaCh0KSx0aGlzLl9fcGFyYW1NYXBwaW5nW2VdPXRoaXMuX19wYXJhbXMubGVuZ3RoLTEsdC5zZXRPd25lcih0aGlzKSx0aGlzLmVtaXQoInBhcmFtZXRlckFkZGVkIix7bmFtZTplfSksdH1pbnNlcnRQYXJhbWV0ZXIodCxlKXtjb25zdCBzPXQuZ2V0TmFtZSgpO251bGwhPXRoaXMuX19wYXJhbU1hcHBpbmdbc10mJihjb25zb2xlLndhcm4oIlJlcGxhY2luZyBQYXJhbWV0ZXI6IitzKSx0aGlzLnJlbW92ZVBhcmFtZXRlcihzKSksdGhpcy5fX3BhcmFtU2lnbmFsSWRzW3NdPXQuYWRkTGlzdGVuZXIoInZhbHVlQ2hhbmdlZCIsZT0+dGhpcy5fX3BhcmFtZXRlclZhbHVlQ2hhbmdlZCh7Li4uZSxwYXJhbTp0fSkpLHRoaXMuX19wYXJhbXMuc3BsaWNlKGUsMCx0KTtjb25zdCBhPXt9O2ZvcihsZXQgdD0wO3Q8dGhpcy5fX3BhcmFtcy5sZW5ndGg7dCsrKWFbdGhpcy5fX3BhcmFtc1t0XS5nZXROYW1lKCldPXQ7cmV0dXJuIHRoaXMuX19wYXJhbU1hcHBpbmc9YSx0aGlzLmVtaXQoInBhcmFtZXRlckFkZGVkIix7bmFtZTpzfSksdH1yZW1vdmVQYXJhbWV0ZXIodCl7bnVsbD09dGhpcy5fX3BhcmFtTWFwcGluZ1t0XSYmY29uc29sZS50aHJvdygiVW5hYmxlIHRvIFJlbW92ZSBQYXJhbWV0ZXI6Iit0KTtjb25zdCBlPXRoaXMuX19wYXJhbU1hcHBpbmdbdF07dGhpcy5fX3BhcmFtc1t0aGlzLl9fcGFyYW1NYXBwaW5nW3RdXS5yZW1vdmVMaXN0ZW5lckJ5SWQoInZhbHVlQ2hhbmdlZCIsdGhpcy5fX3BhcmFtU2lnbmFsSWRzW3RdKSx0aGlzLl9fcGFyYW1zLnNwbGljZShlLDEpO2NvbnN0IHM9e307Zm9yKGxldCB0PTA7dDx0aGlzLl9fcGFyYW1zLmxlbmd0aDt0Kyspc1t0aGlzLl9fcGFyYW1zW3RdLmdldE5hbWUoKV09dDt0aGlzLl9fcGFyYW1NYXBwaW5nPXMsdGhpcy5lbWl0KCJwYXJhbWV0ZXJSZW1vdmVkIix7bmFtZTpuYW1lfSl9cmVwbGFjZVBhcmFtZXRlcih0KXtjb25zdCBlPXQuZ2V0TmFtZSgpLHM9dGhpcy5fX3BhcmFtTWFwcGluZ1tlXTtyZXR1cm4gdGhpcy5fX3BhcmFtc1t0aGlzLl9fcGFyYW1NYXBwaW5nW2VdXS5yZW1vdmVMaXN0ZW5lckJ5SWQoInZhbHVlQ2hhbmdlZCIsdGhpcy5fX3BhcmFtU2lnbmFsSWRzW2VdKSx0aGlzLl9fcGFyYW1TaWduYWxJZHNbZV09dC5hZGRMaXN0ZW5lcigidmFsdWVDaGFuZ2VkIixlPT50aGlzLl9fcGFyYW1ldGVyVmFsdWVDaGFuZ2VkKHsuLi5lLHBhcmFtOnR9KSksdGhpcy5fX3BhcmFtc1tzXT10LHR9dG9KU09OKHQsZSl7Y29uc3Qgcz17fTtsZXQgYT0wO2Zvcihjb25zdCBpIG9mIHRoaXMuX19wYXJhbXMpe2lmKCFpLnRlc3RGbGFnKE4pKWNvbnRpbnVlO2NvbnN0IHI9aS50b0pTT04odCxlKTtyJiYoc1tpLmdldE5hbWUoKV09cixhKyspfWlmKGE+MClyZXR1cm57cGFyYW1zOnN9fWZyb21KU09OKHQsZSxzKXtpZih0LnBhcmFtcylmb3IoY29uc3QgcyBpbiB0LnBhcmFtcyl7Y29uc3QgYT10LnBhcmFtc1tzXSxpPXRoaXMuZ2V0UGFyYW1ldGVyKHMpO2k/YS5wYXJhbVBhdGg/ZS5yZXNvbHZlUGF0aChhLnBhcmFtUGF0aCx0PT57dGhpcy5yZXBsYWNlUGFyYW1ldGVyKHQpfSx0PT57Y29uc29sZS53YXJuKCJVbmFibGUgdG8gcmVzb2x2ZSBzaGFyZWQgcGFyYW1ldGVyOiIrYS5wYXJhbVBhdGgpfSk6aS5mcm9tSlNPTihhLGUpOmNvbnNvbGUud2FybigiUGFyYW0gbm90IGZvdW5kOiIrcyl9fXJlYWRCaW5hcnkodCxlKXtpZihlLnZlcnNpb25zWyJ6ZWEtZW5naW5lIl0uZ3JlYXRlck9yRXF1YWxUaGFuKFswLDAsM10pKXtjb25zdCBzPXQubG9hZFVJbnQzMigpO2ZvcihsZXQgYT0wO2E8czthKyspe2NvbnN0IHM9dC5sb2FkU3RyKCksYT10LmxvYWRTdHIoKTtsZXQgaT10aGlzLmdldFBhcmFtZXRlcihhKTtpZighaSl7aWYoaT13LmNvbnN0cnVjdENsYXNzKHMsYSksIWkpe2NvbnNvbGUuZXJyb3IoIlVuYWJsZSB0byBjb25zdHJ1Y3QgcHJvcDoiK2ErIiBvZiB0eXBlOiIrcyk7Y29udGludWV9dGhpcy5hZGRQYXJhbWV0ZXIoaSl9aS5yZWFkQmluYXJ5KHQsZSl9fX10b1N0cmluZygpe3JldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpLG51bGwsMil9Y29weUZyb20odCxlKXtsZXQgcz10Lm51bVBhcmFtZXRlcnMoKTtmb3IoO3MtLTspe2NvbnN0IGU9dC5nZXRQYXJhbWV0ZXJCeUluZGV4KHMpLGE9dGhpcy5nZXRQYXJhbWV0ZXIoZS5nZXROYW1lKCkpO2E/YS5zZXRWYWx1ZShlLmdldFZhbHVlKCksSSk6dGhpcy5hZGRQYXJhbWV0ZXIoZS5jbG9uZSgpKX19fXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5fX2JvdW5kaW5nQm94PW5ldyBwLHRoaXMuX19ib3VuZGluZ0JveERpcnR5PSEwLHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzPW5ldyBNYXAsdGhpcy5fX21ldGFEYXRhPW5ldyBNYXAsdGhpcy5hZGRWZXJ0ZXhBdHRyaWJ1dGUoInBvc2l0aW9ucyIsciwwKX1zZXREZWJ1Z05hbWUodCl7dGhpcy5fX25hbWU9dH1hZGRWZXJ0ZXhBdHRyaWJ1dGUodCxlLHMpe2xldCBhO3ZhciBpO3JldHVybiBhPShpPXMpJiZ2b2lkIDAhPT1pLmJ5dGVMZW5ndGg/bmV3IHooZSxzKTpuZXcgeihlLG51bGwhPXRoaXMudmVydGljZXM/dGhpcy52ZXJ0aWNlcy5sZW5ndGg6MCxzKSx0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5zZXQodCxhKSxhfWhhc1ZlcnRleEF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuaGFzKHQpfWdldFZlcnRleEF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZ2V0KHQpfWdldFZlcnRleEF0dHJpYnV0ZXModCl7Y29uc3QgZT17fTtmb3IoY29uc3RbdCxzXW9mIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLmVudHJpZXMoKSllW3RdPXM7cmV0dXJuIGV9Z2V0IHZlcnRpY2VzKCl7cmV0dXJuIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLmdldCgicG9zaXRpb25zIil9bnVtVmVydGljZXMoKXtyZXR1cm4gdGhpcy52ZXJ0aWNlcy5sZW5ndGh9Z2V0TnVtVmVydGljZXMoKXtyZXR1cm4gdGhpcy52ZXJ0aWNlcy5sZW5ndGh9c2V0TnVtVmVydGljZXModCl7dGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZm9yRWFjaChlPT5lLnJlc2l6ZSh0KSl9Z2V0VmVydGV4KHQpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMudmVydGljZXMuZGF0YS5idWZmZXIsMyp0KX1zZXRWZXJ0ZXgodCxlKXtyZXR1cm4gci5jcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0aGlzLnZlcnRpY2VzLmRhdGEuYnVmZmVyLDMqdCkuc2V0RnJvbU90aGVyKGUpfW1vdmVWZXJ0aWNlcyh0KXtjb25zdCBlPXRoaXMudmVydGljZXM7Zm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKyspZS5nZXRWYWx1ZVJlZihzKS5hZGRJblBsYWNlKHQpO3RoaXMuc2V0Qm91bmRpbmdCb3hEaXJ0eSgpfXRyYW5zZm9ybVZlcnRpY2VzKHQpe2NvbnN0IGU9dGhpcy52ZXJ0aWNlcztmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl7Y29uc3QgYT1lLmdldFZhbHVlUmVmKHMpLGk9dC50cmFuc2Zvcm1WZWMzKGEpO2Euc2V0KGkueCxpLnksaS56KX10aGlzLnNldEJvdW5kaW5nQm94RGlydHkoKX1nZXQgYm91bmRpbmdCb3goKXtyZXR1cm4gdGhpcy5fX2JvdW5kaW5nQm94RGlydHkmJnRoaXMudXBkYXRlQm91bmRpbmdCb3goKSx0aGlzLl9fYm91bmRpbmdCb3h9c2V0Qm91bmRpbmdCb3hEaXJ0eSgpe3RoaXMuX19ib3VuZGluZ0JveERpcnR5PSEwLHRoaXMuZW1pdCgiYm91bmRpbmdCb3hDaGFuZ2VkIix7fSl9dXBkYXRlQm91bmRpbmdCb3goKXtjb25zdCB0PXRoaXMudmVydGljZXMsZT1uZXcgcCxzPXQubGVuZ3RoO2ZvcihsZXQgYT0wO2E8czthKyspZS5hZGRQb2ludCh0LmdldFZhbHVlUmVmKGEpKTt0aGlzLl9fYm91bmRpbmdCb3g9ZSx0aGlzLl9fYm91bmRpbmdCb3hEaXJ0eT0hMX1nZXRNZXRhZGF0YSh0KXtyZXR1cm4gdGhpcy5fX21ldGFEYXRhLmdldCh0KX1oYXNNZXRhZGF0YSh0KXtyZXR1cm4gdGhpcy5fX21ldGFEYXRhLmhhcyh0KX1zZXRNZXRhZGF0YSh0LGUpe3RoaXMuX19tZXRhRGF0YS5zZXQodCxlKX1kZWxldGVNZXRhZGF0YSh0KXt0aGlzLl9fbWV0YURhdGEuZGVsZXRlKHQpfWdlbkJ1ZmZlcnModCl7Y29uc3QgZT17fTtmb3IoY29uc3RbdCxzXW9mIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzKWVbdF09e3ZhbHVlczpzLmRhdGEsY291bnQ6cy5zaXplLGRhdGFUeXBlOnMuZGF0YVR5cGUsbm9ybWFsaXplZDpzLm5vcm1hbGl6ZWR9O3JldHVybntudW1WZXJ0aWNlczp0aGlzLm51bVZlcnRpY2VzKCksYXR0ckJ1ZmZlcnM6ZX19ZnJlZUJ1ZmZlcnMoKXt9bG9hZEJhc2VHZW9tQmluYXJ5KHQpe3RoaXMubmFtZT10LmxvYWRTdHIoKTtjb25zdCBlPXQubG9hZFVJbnQ4KCk7dGhpcy5kZWJ1Z0NvbG9yPXQubG9hZFJHQkZsb2F0MzJDb2xvcigpO2NvbnN0IHM9dC5sb2FkVUludDMyKCk7dGhpcy5fX2JvdW5kaW5nQm94LnNldCh0LmxvYWRGbG9hdDMyVmVjMygpLHQubG9hZEZsb2F0MzJWZWMzKCkpLHRoaXMuc2V0TnVtVmVydGljZXMocyk7Y29uc3QgYT10aGlzLnZlcnRpY2VzO2xldCBuLGg7MiZlJiYobj10aGlzLmdldFZlcnRleEF0dHJpYnV0ZSgibm9ybWFscyIpLG58fChuPXRoaXMuYWRkVmVydGV4QXR0cmlidXRlKCJub3JtYWxzIixyLDApKSksNCZlJiYoaD10aGlzLmdldFZlcnRleEF0dHJpYnV0ZSgidGV4Q29vcmRzIiksaHx8KGg9dGhpcy5hZGRWZXJ0ZXhBdHRyaWJ1dGUoInRleENvb3JkcyIsaSwwKSkpO2NvbnN0IG89KHQsZSxzLGkpPT57Zm9yKGxldCBuPXRbMF07bjx0WzFdO24rKyl7Y29uc3QgdD1uZXcgcihpWzMqbiswXS8yNTUsaVszKm4rMV0vMjU1LGlbMypuKzJdLzI1NSk7dC5tdWx0aXBseUluUGxhY2UocyksdC5hZGRJblBsYWNlKGUpLGEuc2V0VmFsdWUobix0KX19LF89KHQsZSxzLGEpPT57cy5pc051bGwoKSYmcy5zZXQoMSwxLDEpO2ZvcihsZXQgaT10WzBdO2k8dFsxXTtpKyspe2NvbnN0IHQ9bmV3IHIoYVszKmkrMF0vMjU1LGFbMyppKzFdLzI1NSxhWzMqaSsyXS8yNTUpO3QubXVsdGlwbHlJblBsYWNlKHMpLHQuYWRkSW5QbGFjZShlKSx0Lm5vcm1hbGl6ZUluUGxhY2UoKSxuLnNldFZhbHVlKGksdCl9fSxkPSh0LGUscyxhKT0+e2ZvcihsZXQgcj10WzBdO3I8dFsxXTtyKyspe2NvbnN0IHQ9bmV3IGkoYVsyKnIrMF0vMjU1LGFbMipyKzFdLzI1NSk7dC5tdWx0aXBseUluUGxhY2UocyksdC5hZGRJblBsYWNlKGUpLGguc2V0VmFsdWUocix0KX19LGw9dC5sb2FkVUludDMyKCk7aWYoMT09bCl7e2NvbnN0IGU9dGhpcy5fX2JvdW5kaW5nQm94LGE9dC5sb2FkVUludDhBcnJheSgzKnMpO28oWzAsc10sZS5wMCxlLmRpYWdvbmFsKCksYSl9aWYobil7Y29uc3QgZT1uZXcgcCh0LmxvYWRGbG9hdDMyVmVjMygpLHQubG9hZEZsb2F0MzJWZWMzKCkpLGE9dC5sb2FkVUludDhBcnJheSgzKnMpO18oWzAsc10sZS5wMCxlLmRpYWdvbmFsKCksYSksbi5sb2FkU3BsaXRWYWx1ZXModCl9aWYoaCl7Y29uc3QgZT1uZXcgZyh0LmxvYWRGbG9hdDMyVmVjMigpLHQubG9hZEZsb2F0MzJWZWMyKCkpLGE9dC5sb2FkVUludDhBcnJheSgyKnMpO2QoWzAsc10sZS5wMCxlLmRpYWdvbmFsKCksYSksaC5sb2FkU3BsaXRWYWx1ZXModCl9fWVsc2V7Y29uc3QgZT1bXTtsZXQgYT0wO2ZvcihsZXQgcz0wO3M8bDtzKyspe2NvbnN0IHM9dC5sb2FkVUludDMyKCksaT17cmFuZ2U6W2EsYStzXSxiYm94Om5ldyBwKHQubG9hZEZsb2F0MzJWZWMzKCksdC5sb2FkRmxvYXQzMlZlYzMoKSl9O24mJihpLm5vcm1hbHNSYW5nZT1uZXcgcCh0LmxvYWRGbG9hdDMyVmVjMygpLHQubG9hZEZsb2F0MzJWZWMzKCkpKSxoJiYoaS50ZXhDb29yZHNSYW5nZT1uZXcgZyh0LmxvYWRGbG9hdDMyVmVjMigpLHQubG9hZEZsb2F0MzJWZWMyKCkpKSxlLnB1c2goaSksYSs9c31jb25zdCBpPXQubG9hZFVJbnQ4QXJyYXkoMypzKTtsZXQgcixjO24mJihyPXQubG9hZFVJbnQ4QXJyYXkoMypzKSksaCYmKGM9dC5sb2FkVUludDhBcnJheSgyKnMpKTtmb3IobGV0IHQ9MDt0PGw7dCsrKXt7Y29uc3Qgcz1lW3RdLmJib3g7byhlW3RdLnJhbmdlLHMucDAscy5kaWFnb25hbCgpLGkpfWlmKG4pe2NvbnN0IHM9ZVt0XS5ub3JtYWxzUmFuZ2U7XyhlW3RdLnJhbmdlLHMucDAscy5kaWFnb25hbCgpLHIpfWlmKGgpe2NvbnN0IHM9ZVt0XS50ZXhDb29yZHNSYW5nZTtkKGVbdF0ucmFuZ2Uscy5wMCxzLmRpYWdvbmFsKCksYyl9fW4mJm4ubG9hZFNwbGl0VmFsdWVzKHQpLGgmJmgubG9hZFNwbGl0VmFsdWVzKHQpfX10b0pTT04odCxlKXtsZXQgcz1zdXBlci50b0pTT04odCxlKTtpZihzfHwocz17fSkscy50eXBlPXcuZ2V0Q2xhc3NOYW1lKHRoaXMpLCEoMTAyNCZlKSl7Y29uc3QgYT17fTtmb3IoY29uc3RbcyxpXW9mIHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLmVudHJpZXMoKSlhW3NdPWkudG9KU09OKHQsZSk7cy52ZXJ0ZXhBdHRyaWJ1dGVzPWF9cmV0dXJuIHN9ZnJvbUpTT04odCxlLHMpe3N1cGVyLmZyb21KU09OKHQsZSxzKTtmb3IoY29uc3QgZSBpbiB0LnZlcnRleEF0dHJpYnV0ZXMpe2xldCBzPXRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLmdldChlKTtjb25zdCBpPXQudmVydGV4QXR0cmlidXRlc1tlXTtpZighcyl7Y29uc3QgdD1hLmdldFR5cGUoaS5kYXRhVHlwZSk7cz1uZXcgVmVydGV4QXR0cmlidXRlKHRoaXMsdCwwLGkuZGVmYXVsdFNjYWxhclZhbHVlKSx0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5zZXQoZSxzKX1zLmZyb21KU09OKGkpfX10b1N0cmluZygpe3JldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpLG51bGwsMil9fWNsYXNzIE0gZXh0ZW5kcyBWe2NvbnN0cnVjdG9yKCl7c3VwZXIoKX1sb2FkQmluKHQpe3RoaXMubmFtZT10LmxvYWRTdHIoKTtjb25zdCBlPXQubG9hZFVJbnQzMigpO3RoaXMuX19ib3VuZGluZ0JveC5zZXQodC5sb2FkRmxvYXQzMlZlYzMoKSx0LmxvYWRGbG9hdDMyVmVjMygpKSx0aGlzLnNldE51bVZlcnRpY2VzKGUpO2NvbnN0IHM9dGhpcy52ZXJ0aWNlcztpZihlPDI1Nil7Y29uc3QgYT10aGlzLl9fYm91bmRpbmdCb3gudG9NYXQ0KCksaT10LmxvYWRVSW50OEFycmF5KDMqZSk7Zm9yKGxldCB0PTA7dDxlO3QrKyl7Y29uc3QgZT1uZXcgVmVjMyhpWzMqdCswXS8yNTUsaVszKnQrMV0vMjU1LGlbMyp0KzJdLzI1NSk7cy5zZXRWYWx1ZSh0LGEudHJhbnNmb3JtVmVjMyhlKSl9fWVsc2V7Y29uc3QgYT10LmxvYWRVSW50MzIoKSxpPVtdO2ZvcihsZXQgZT0wO2U8YTtlKyspe2NvbnN0IGU9dC5sb2FkVUludDMyVmVjMigpLHM9dC5sb2FkRmxvYXQzMlZlYzMoKSxhPXQubG9hZEZsb2F0MzJWZWMzKCk7aS5wdXNoKHtyYW5nZTplLGJib3g6bmV3IEJveDMocyxhKX0pfWNvbnN0IHI9dC5sb2FkVUludDhBcnJheSgzKmUpO2ZvcihsZXQgdD0wO3Q8YTt0Kyspe2NvbnN0IGU9aVt0XS5iYm94LnRvTWF0NCgpO2ZvcihsZXQgYT1pW3RdLnJhbmdlLng7YTxpW3RdLnJhbmdlLnk7YSsrKXtjb25zdCB0PW5ldyBWZWMzKHJbMyphKzBdLzI1NSxyWzMqYSsxXS8yNTUsclszKmErMl0vMjU1KTtzLnNldFZhbHVlKGEsZS50cmFuc2Zvcm1WZWMzKHQpKX19fX1yZWFkQmluYXJ5KHQsZSl7c3VwZXIubG9hZEJhc2VHZW9tQmluYXJ5KHQpLHRoaXMuZW1pdCgiZ2VvbURhdGFDaGFuZ2VkIix7fSl9fWNsYXNzIEEgZXh0ZW5kcyBWe2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLl9faW5kaWNlcz1uZXcgVWludDMyQXJyYXksdGhpcy5fX3NlZ21lbnRBdHRyaWJ1dGVzPW5ldyBNYXAsdGhpcy5saW5lVGhpY2tuZXNzPTB9Z2V0SW5kaWNlcygpe3JldHVybiB0aGlzLl9faW5kaWNlc31nZXROdW1TZWdtZW50cygpe3JldHVybiB0aGlzLl9faW5kaWNlcy5sZW5ndGgvMn1zZXROdW1TZWdtZW50cyh0KXtjb25zdCBlPW5ldyBVaW50MzJBcnJheSgyKnQpO3RoaXMuX19pbmRpY2VzPWV9c2V0U2VnbWVudCh0LGUscyl7aWYodD49dGhpcy5fX2luZGljZXMubGVuZ3RoLzIpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGxpbmUgaW5kZXg6Iit0KyIuIE51bSBTZWdtZW50czoiK3RoaXMuX19pbmRpY2VzLmxlbmd0aC8yKTt0aGlzLl9faW5kaWNlc1syKnQrMF09ZSx0aGlzLl9faW5kaWNlc1syKnQrMV09c31nZXRTZWdtZW50VmVydGV4SW5kZXgodCxlKXtpZih0PHRoaXMubnVtTGluZXMpcmV0dXJuIHRoaXMuX19pbmRpY2VzWzIqdCtlXX1hZGRTZWdtZW50QXR0cmlidXRlKHQsZSxzKXtjb25zdCBhPW5ldyBBdHRyaWJ1dGUoZSxudWxsIT1zP3M6dGhpcy5wb2x5Z29uQ291bnQpO3JldHVybiB0aGlzLl9fc2VnbWVudEF0dHJpYnV0ZXMuc2V0KHQsYSksYX1oYXNTZWdtZW50QXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fc2VnbWVudEF0dHJpYnV0ZXMuaGFzKHQpfWdldFNlZ21lbnRBdHRyaWJ1dGUodCl7cmV0dXJuIHRoaXMuX19zZWdtZW50QXR0cmlidXRlcy5nZXQodCl9Z2VuQnVmZmVycygpe2NvbnN0IHQ9c3VwZXIuZ2VuQnVmZmVycygpO2xldCBlO3JldHVybiB0Lm51bVZlcnRpY2VzPE1hdGgucG93KDIsOCk/KGU9bmV3IFVpbnQ4QXJyYXkodGhpcy5fX2luZGljZXMubGVuZ3RoKSx0aGlzLl9faW5kaWNlcy5mb3JFYWNoKCh0LHMpPT57ZVtzXT10fSkpOnQubnVtVmVydGljZXM8TWF0aC5wb3coMiwxNik/KGU9bmV3IFVpbnQxNkFycmF5KHRoaXMuX19pbmRpY2VzLmxlbmd0aCksdGhpcy5fX2luZGljZXMuZm9yRWFjaCgodCxzKT0+e2Vbc109dH0pKTplPXRoaXMuX19pbmRpY2VzLHQuaW5kaWNlcz1lLHR9cmVhZEJpbmFyeSh0LGUpe3N1cGVyLmxvYWRCYXNlR2VvbUJpbmFyeSh0KSx0aGlzLnNldE51bVNlZ21lbnRzKHQubG9hZFVJbnQzMigpKTtjb25zdCBzPXQubG9hZFVJbnQ4KCk7MT09cz90aGlzLl9faW5kaWNlcz10LmxvYWRVSW50OEFycmF5KCk6Mj09cz90aGlzLl9faW5kaWNlcz10LmxvYWRVSW50MTZBcnJheSgpOjQ9PXMmJih0aGlzLl9faW5kaWNlcz10LmxvYWRVSW50MzJBcnJheSgpKSx0aGlzLmdlb21EYXRhQ2hhbmdlZC5lbWl0KCl9dG9KU09OKHQsZSl7Y29uc3Qgcz1zdXBlci50b0pTT04odCxlKTtyZXR1cm4gMTAyNCZlfHwocy5pbmRpY2VzPUFycmF5LmZyb20odGhpcy5fX2luZGljZXMpKSxzfWZyb21KU09OKHQsZSxzKXtzdXBlci5mcm9tSlNPTih0LGUscyksdGhpcy5fX2luZGljZXM9VWludDMyQXJyYXkuZnJvbSh0LmluZGljZXMpfX1jbGFzcyBTIGV4dGVuZHMgentjb25zdHJ1Y3Rvcih0LGUscyxhKXtzdXBlcihlLHMsYSksdGhpcy5fX2dlb209dCx0aGlzLl9fc3BsaXRzPXt9LHRoaXMuX19zcGxpdFZhbHVlcz1bXX1nZXRGYWNlVmVydGV4VmFsdWVSZWYodCxlKXtjb25zdCBzPXRoaXMuX19nZW9tLmdldEZhY2VWZXJ0ZXhJbmRleCh0LGUpO3JldHVybiBzIGluIHRoaXMuX19zcGxpdHMmJnQgaW4gdGhpcy5fX3NwbGl0c1tzXT90aGlzLl9fc3BsaXRWYWx1ZXNbdGhpcy5fX3NwbGl0c1tzXVt0XV06dGhpcy5nZXRWYWx1ZVJlZihzKX1zZXRGYWNlVmVydGV4VmFsdWUodCxlLHMpe2NvbnN0IGE9dGhpcy5fX2dlb20uZ2V0RmFjZVZlcnRleEluZGV4KHQsZSk7dGhpcy5zZXRGYWNlVmVydGV4VmFsdWVfQnlWZXJ0ZXhJbmRleCh0LGEscyl9c2V0RmFjZVZlcnRleFZhbHVlX0J5VmVydGV4SW5kZXgodCxlLHMpe2NvbnN0IGE9dGhpcy5nZXRWYWx1ZVJlZihlKTtpZihhLmlzVmFsaWQoKSlpZihhLmFwcHJveEVxdWFsKHMpKTtlbHNle2lmKGUgaW4gdGhpcy5fX3NwbGl0cyl7Y29uc3QgYT10aGlzLl9fc3BsaXRzW2VdO2Zvcihjb25zdCBlIGluIGEpe2NvbnN0IGk9YVtlXTtpZih0aGlzLl9fc3BsaXRWYWx1ZXNbaV0uYXBwcm94RXF1YWwocykpcmV0dXJuIHZvaWQoYVt0XT1pKX1pZih0IGluIHRoaXMuX19zcGxpdHNbZV0pe3JldHVybiB2b2lkIHRoaXMuX19zcGxpdFZhbHVlc1t0aGlzLl9fc3BsaXRzW2VdW3RdXS5zZXRGcm9tT3RoZXIocyl9fWVsc2UgdGhpcy5fX3NwbGl0c1tlXT17fTt0aGlzLl9fc3BsaXRzW2VdW3RdPXRoaXMuX19zcGxpdFZhbHVlcy5sZW5ndGgsdGhpcy5fX3NwbGl0VmFsdWVzLnB1c2gocyl9ZWxzZSBhLnNldEZyb21PdGhlcihzKX1zZXRTcGxpdFZlcnRleFZhbHVlKHQsZSxzKXtpZih0IGluIHRoaXMuX19zcGxpdHN8fCh0aGlzLl9fc3BsaXRzW3RdPXt9KSxlIGluIHRoaXMuX19zcGxpdHNbdF0pe2lmKHRoaXMuX19zcGxpdFZhbHVlc1t0aGlzLl9fc3BsaXRzW3RdW2VdXS5hcHByb3hFcXVhbChzKSlyZXR1cm47Y29uc29sZS53YXJuKCJGYWNlIFZlcnRleCBBbHJlYWR5IFNwbGl0IHdpdGggZGlmZmVyZW50IHZhbHVlIil9dGhpcy5fX3NwbGl0c1t0XVtlXT10aGlzLl9fc3BsaXRWYWx1ZXMubGVuZ3RoLHRoaXMuX19zcGxpdFZhbHVlcy5wdXNoKHMpfXNldFNwbGl0VmVydGV4VmFsdWVzKHQsZSxzKXt0IGluIHRoaXMuX19zcGxpdHN8fCh0aGlzLl9fc3BsaXRzW3RdPXt9KTtjb25zdCBhPXRoaXMuX19zcGxpdFZhbHVlcy5sZW5ndGg7dGhpcy5fX3NwbGl0VmFsdWVzLnB1c2gocyk7Zm9yKGNvbnN0IHMgb2YgZSl0aGlzLl9fc3BsaXRzW3RdW3NdPWF9Z2V0U3BsaXRzKCl7cmV0dXJuIHRoaXMuX19zcGxpdHN9Z2V0U3BsaXRDb3VudCgpe2xldCB0PTA7Zm9yKGNvbnN0IGUgaW4gdGhpcy5fX3NwbGl0cyl0Kz1PYmplY3Qua2V5cyh0aGlzLl9fc3BsaXRzW2VdKS5sZW5ndGg7cmV0dXJuIHR9Z2VuZXJhdGVTcGxpdFZhbHVlcyh0LGUpe2lmKDA9PWUpcmV0dXJuIHRoaXMuX19kYXRhO2NvbnN0IHM9dGhpcy5sZW5ndGgsYT10aGlzLmxlbmd0aCtlLGk9dGhpcy5fX2RhdGFUeXBlLm51bUVsZW1lbnRzP3RoaXMuX19kYXRhVHlwZS5udW1FbGVtZW50cygpOjEscj1uZXcgRmxvYXQzMkFycmF5KGEqaSk7Zm9yKGxldCB0PTA7dDx0aGlzLl9fZGF0YS5sZW5ndGg7dCsrKXJbdF09dGhpcy5fX2RhdGFbdF07Zm9yKGNvbnN0IGUgaW4gdCl7Y29uc3QgYT10W2VdO2Zvcihjb25zdCB0IGluIGEpe2NvbnN0IG49cythW3RdO2lmKGUgaW4gdGhpcy5fX3NwbGl0cyYmdCBpbiB0aGlzLl9fc3BsaXRzW2VdKXtjb25zdCBzPXRoaXMuX19zcGxpdHNbZV1bdF07Nj09dGhpcy5fX2RhdGFUeXBlP3JbbippXT10aGlzLl9fc3BsaXRWYWx1ZXNbc106dGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHIuYnVmZmVyLG4qaSkuc2V0RnJvbU90aGVyKHRoaXMuX19zcGxpdFZhbHVlc1tzXSl9ZWxzZXtjb25zdCB0PXBhcnNlSW50KGUpO2ZvcihsZXQgZT0wO2U8aTtlKyspdCppK2U+dGhpcy5fX2RhdGEubGVuZ3RoJiZjb25zb2xlLmxvZygiRXJyb3IgcmVtYXBwaW5nIHNyYzoiK3QqaStlKSxuKmkrZT5yLmxlbmd0aCYmY29uc29sZS5sb2coIkVycm9yIHJlbWFwcGluZyB0Z3Q6IituKmkrZSkscltuKmkrZV09dGhpcy5fX2RhdGFbdCppK2VdfX19cmV0dXJuIHJ9dG9KU09OKHQsZSl7Y29uc3Qgcz1zdXBlci50b0pTT04odCxlKTtyZXR1cm4gcy5zcGxpdHM9dGhpcy5fX3NwbGl0cyxzLnNwbGl0VmFsdWVzPXRoaXMuX19zcGxpdFZhbHVlcyxzfWZyb21KU09OKHQsZSxzKXtzdXBlci5mcm9tSlNPTih0LGUscyksdGhpcy5fX3NwbGl0cz10LnNwbGl0cyx0aGlzLl9fc3BsaXRWYWx1ZXM9W107Zm9yKGNvbnN0IGUgb2YgdC5zcGxpdFZhbHVlcyl0aGlzLl9fc3BsaXRWYWx1ZXMucHVzaCh0aGlzLl9fZGF0YVR5cGUuY3JlYXRlRnJvbUpTT04oZSkpfWxvYWRTcGxpdFZhbHVlcyh0KXtjb25zdCBlPXQubG9hZFVJbnQzMkFycmF5KCk7aWYoMD09ZS5sZW5ndGgpcmV0dXJuO2xldCBzPTAsYT0wO2Zvcig7Oyl7Y29uc3QgdD1lW3MrK10saT1lW3MrK10scj17fTtmb3IobGV0IHQ9MDt0PGk7dCsrKXtjb25zdCB0PWVbcysrXSxpPWVbcysrXTtyW3RdPWksaT49YSYmKGE9aSsxKX1pZih0aGlzLl9fc3BsaXRzW3RdPXIscz49ZS5sZW5ndGgpYnJlYWt9Y29uc3QgaT10aGlzLl9fbnVtRmxvYXQzMkVsZW1lbnRzLHI9dC5sb2FkRmxvYXQzMkFycmF5KGEqaSk7dGhpcy5fX3NwbGl0VmFsdWVzPVtdO2ZvcihsZXQgdD0wO3Q8YTt0Kyspe2NvbnN0IGU9dGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21GbG9hdDMyQXJyYXkoci5zbGljZSh0KmksdCppK2kpKTt0aGlzLl9fc3BsaXRWYWx1ZXMucHVzaChlKX19fWNsYXNzIE8gZXh0ZW5kcyBWe2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmluaXQoKX1pbml0KCl7dGhpcy5fX2ZhY2VDb3VudHM9W10sdGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHM9bmV3IFVpbnQ4QXJyYXksdGhpcy5fX2ZhY2VPZmZzZXRzPW5ldyBVaW50MzJBcnJheSx0aGlzLl9fZmFjZVZlcnRleEluZGljZXM9bmV3IFVpbnQzMkFycmF5LHRoaXMuX19udW1Qb3B1bGF0ZWRGYWNlVmVydGV4SW5kaWNlcz0wLHRoaXMuX19mYWNlQXR0cmlidXRlcz1uZXcgTWFwLHRoaXMuX19lZGdlQXR0cmlidXRlcz1uZXcgTWFwLHRoaXMuX19sb2dUb3BvbG9neVdhcm5pbmdzPSExLHRoaXMuZWRnZVZlcnRzPXZvaWQgMCx0aGlzLnZlcnRleEVkZ2VzPXZvaWQgMCx0aGlzLm51bUVkZ2VzPTAsdGhpcy5lZGdlRmxhZ3M9bmV3IFVpbnQzMkFycmF5LHRoaXMuZWRnZUFuZ2xlcz1uZXcgRmxvYXQzMkFycmF5fWdldEZhY2VWZXJ0ZXhJbmRpY2VzKCl7cmV0dXJuIHRoaXMuX19mYWNlVmVydGV4SW5kaWNlc31nZXRGYWNlQ291bnRzKCl7cmV0dXJuIHRoaXMuX19mYWNlQ291bnRzfWNsZWFyKCl7dGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzPXZvaWQgMCx0aGlzLl9fZmFjZUNvdW50cz1bXSx0aGlzLl9fbnVtUG9wdWxhdGVkRmFjZVZlcnRleEluZGljZXM9MH1zZXRGYWNlQ291bnRzKHQpe2lmKHRoaXMuX19udW1Qb3B1bGF0ZWRGYWNlVmVydGV4SW5kaWNlcyl0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgZmFjZSBjb3VudHMgb24gYSBtZXNoIHRoYXQgaXMgYWxyZWFkeSBwb3B1bGF0ZWQuIFBsZWFzZSBjYWxsICdjbGVhcicgYmVmb3JlIHJlLWJ1aWxkaW5nIHRoZSBtZXNoLiIpO3RoaXMuX19mYWNlQ291bnRzPXQ7bGV0IGU9MCxzPTAsYT0zO2Zvcihjb25zdCB0IG9mIHRoaXMuX19mYWNlQ291bnRzKWUrPXQscys9dCphLGErKzt0aGlzLl9fZmFjZVZlcnRleENvdW50cz1uZXcgVWludDhBcnJheShlKSx0aGlzLl9fZmFjZU9mZnNldHM9bmV3IFVpbnQzMkFycmF5KGUpLHRoaXMuX19mYWNlVmVydGV4SW5kaWNlcz1uZXcgVWludDMyQXJyYXkocyk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5fX2ZhY2VBdHRyaWJ1dGVzKXQucmVzaXplKGUpfXNldEZhY2VWZXJ0ZXhJbmRpY2VzKHQpe2NvbnN0IGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLHM9dGhpcy5fX251bVBvcHVsYXRlZEZhY2VWZXJ0ZXhJbmRpY2VzO2ZvcihsZXQgdD0wO3Q8ZS5sZW5ndGg7dCsrKXRoaXMuX19mYWNlVmVydGV4SW5kaWNlc1tzK3RdPWVbdF07dGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHNbdF09ZS5sZW5ndGgtMyx0aGlzLl9fZmFjZU9mZnNldHNbdF09cyx0aGlzLl9fbnVtUG9wdWxhdGVkRmFjZVZlcnRleEluZGljZXMrPWUubGVuZ3RofWdldEZhY2VWZXJ0ZXhJbmRpY2VzKHQpe2NvbnN0IGU9W10scz10aGlzLl9fZmFjZU9mZnNldHNbdF0sYT10aGlzLl9fZmFjZVZlcnRleENvdW50c1t0XSszO2ZvcihsZXQgdD0wO3Q8YTt0KyspZS5wdXNoKHRoaXMuX19mYWNlVmVydGV4SW5kaWNlc1tzK3RdKTtyZXR1cm4gZX1nZXRGYWNlVmVydGV4SW5kZXgodCxlKXtjb25zdCBzPXRoaXMuX19mYWNlT2Zmc2V0c1t0XTtyZXR1cm4gdGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzW3MrZV19Z2V0TnVtRmFjZXMoKXtyZXR1cm4gdGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHMubGVuZ3RofWFkZFZlcnRleEF0dHJpYnV0ZSh0LGUscyl7Y29uc3QgYT1uZXcgUyh0aGlzLGUsbnVsbCE9dGhpcy52ZXJ0aWNlcz90aGlzLnZlcnRpY2VzLmxlbmd0aDowLHMpO3JldHVybiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5zZXQodCxhKSxhfWFkZEZhY2VBdHRyaWJ1dGUodCxlLHMpe2NvbnN0IGE9bmV3IHooZSxudWxsIT1zP3M6dGhpcy5nZXROdW1GYWNlcygpKTtyZXR1cm4gdGhpcy5fX2ZhY2VBdHRyaWJ1dGVzLnNldCh0LGEpLGF9aGFzRmFjZUF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX2ZhY2VBdHRyaWJ1dGVzLmhhcyh0KX1nZXRGYWNlQXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fZmFjZUF0dHJpYnV0ZXMuZ2V0KHQpfWFkZEVkZ2VBdHRyaWJ1dGUodCxlLHMpe2NvbnN0IGE9bmV3IHooZSxudWxsIT1zP3M6dGhpcy5nZXROdW1FZGdlcygpKTtyZXR1cm4gdGhpcy5fX2VkZ2VBdHRyaWJ1dGVzLnNldCh0LGEpLGF9aGFzRWRnZUF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX2VkZ2VBdHRyaWJ1dGVzLmhhcyh0KX1nZXRFZGdlQXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fZWRnZUF0dHJpYnV0ZXMuZ2V0KHQpfWdlblRvcG9sb2d5SW5mbygpe2NvbnN0IHQ9e307dGhpcy52ZXJ0ZXhFZGdlcz1bXSx0aGlzLmVkZ2VGYWNlcz1bXSx0aGlzLmVkZ2VWZXJ0cz1bXSx0aGlzLmZhY2VFZGdlcz1bXSx0aGlzLm51bUVkZ2VzPTA7Y29uc3QgZT0oZSxzKT0+e2xldCBhPWUsaT1zO2lmKGk8YSl7Y29uc3QgdD1hO2E9aSxpPXR9Y29uc3Qgcj1hKyI+IitpO2lmKHIgaW4gdClyZXR1cm4gdFtyXTtjb25zdCBuPXRoaXMudmVydGljZXMuZ2V0VmFsdWVSZWYoYSksaD10aGlzLnZlcnRpY2VzLmdldFZhbHVlUmVmKGkpLnN1YnRyYWN0KG4pLG89e2VkZ2VJbmRleDp0aGlzLmVkZ2VGYWNlcy5sZW5ndGgvMixlZGdlVmVjOmh9O3JldHVybiB0W3JdPW8sdGhpcy5lZGdlRmFjZXMucHVzaCgtMSksdGhpcy5lZGdlRmFjZXMucHVzaCgtMSksdGhpcy5lZGdlVmVydHMucHVzaChhKSx0aGlzLmVkZ2VWZXJ0cy5wdXNoKGkpLHRoaXMubnVtRWRnZXMrKyxvfSxzPSh0LHMsYSk9Pntjb25zdCBpPWUodCxzKS5lZGdlSW5kZXg7aWYoczx0KXtjb25zdCB0PTIqaSswO3RoaXMuX19sb2dUb3BvbG9neVdhcm5pbmdzJiYtMSE9dGhpcy5lZGdlRmFjZXNbdF0mJmNvbnNvbGUud2FybigiRWRnZSBwb2x5IDAgYWxyZWFkeSBzZXQuIE1lc2ggaXMgbm9uLW1hbmlmb2xkLiIpLHRoaXMuZWRnZUZhY2VzW3RdPWF9ZWxzZXtjb25zdCB0PTIqaSsxO3RoaXMuX19sb2dUb3BvbG9neVdhcm5pbmdzJiYtMSE9dGhpcy5lZGdlRmFjZXNbdF0mJmNvbnNvbGUud2FybigiRWRnZSBwb2x5IDEgYWxyZWFkeSBzZXQuIE1lc2ggaXMgbm9uLW1hbmlmb2xkLiIpLHRoaXMuZWRnZUZhY2VzW3RdPWF9YSBpbiB0aGlzLmZhY2VFZGdlc3x8KHRoaXMuZmFjZUVkZ2VzW2FdPVtdKSx0aGlzLmZhY2VFZGdlc1thXS5wdXNoKGkpLG51bGw9PXRoaXMudmVydGV4RWRnZXNbdF0mJih0aGlzLnZlcnRleEVkZ2VzW3RdPW5ldyBTZXQpLG51bGw9PXRoaXMudmVydGV4RWRnZXNbc10mJih0aGlzLnZlcnRleEVkZ2VzW3NdPW5ldyBTZXQpLHRoaXMudmVydGV4RWRnZXNbdF0uYWRkKGkpLHRoaXMudmVydGV4RWRnZXNbc10uYWRkKGkpfSxhPXRoaXMuZ2V0TnVtRmFjZXMoKTtmb3IobGV0IHQ9MDt0PGE7dCsrKXtjb25zdCBlPXRoaXMuZ2V0RmFjZVZlcnRleEluZGljZXModCk7Zm9yKGxldCBhPTA7YTxlLmxlbmd0aDthKyspe3MoZVthXSxlWyhhKzEpJWUubGVuZ3RoXSx0KX19fWNvbXB1dGVGYWNlTm9ybWFscygpe2NvbnN0IHQ9dGhpcy52ZXJ0aWNlcyxlPXRoaXMuYWRkRmFjZUF0dHJpYnV0ZSgibm9ybWFscyIscikscz10aGlzLmdldE51bUZhY2VzKCk7Zm9yKGxldCBhPTA7YTxzO2ErKyl7Y29uc3Qgcz10aGlzLmdldEZhY2VWZXJ0ZXhJbmRpY2VzKGEpLGk9dC5nZXRWYWx1ZVJlZihzWzBdKTtsZXQgbj10LmdldFZhbHVlUmVmKHNbMV0pO2NvbnN0IGg9bmV3IHI7Zm9yKGxldCBlPTI7ZTxzLmxlbmd0aDtlKyspe2NvbnN0IGE9dC5nZXRWYWx1ZVJlZihzW2VdKSxyPW4uc3VidHJhY3QoaSksbz1hLnN1YnRyYWN0KGkpO2guYWRkSW5QbGFjZShyLmNyb3NzKG8pLm5vcm1hbGl6ZSgpKSxuPWF9aC5sZW5ndGhTcXVhcmVkKCksTnVtYmVyLkVQU0lMT04sZS5zZXRWYWx1ZShhLGgubm9ybWFsaXplKCkpfX1nZW5lcmF0ZUVkZ2VGbGFncygpe251bGw9PXRoaXMudmVydGV4RWRnZXMmJnRoaXMuZ2VuVG9wb2xvZ3lJbmZvKCksdGhpcy5oYXNGYWNlQXR0cmlidXRlKCJub3JtYWxzIil8fHRoaXMuY29tcHV0ZUZhY2VOb3JtYWxzKCk7Y29uc3QgdD10aGlzLnZlcnRpY2VzLGU9dGhpcy5nZXRGYWNlQXR0cmlidXRlKCJub3JtYWxzIik7dGhpcy5lZGdlVmVjcz1bXSx0aGlzLmVkZ2VBbmdsZXM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLm51bUVkZ2VzKTtmb3IobGV0IHM9MDtzPHRoaXMuZWRnZUZhY2VzLmxlbmd0aDtzKz0yKXtjb25zdCBhPXRoaXMuZWRnZVZlcnRzW3NdLGk9dGhpcy5lZGdlVmVydHNbcysxXSxyPXQuZ2V0VmFsdWVSZWYoaSkuc3VidHJhY3QodC5nZXRWYWx1ZVJlZihhKSk7ci5ub3JtYWxpemVJblBsYWNlKCksdGhpcy5lZGdlVmVjcy5wdXNoKHIpO2NvbnN0IG49dGhpcy5lZGdlRmFjZXNbc10saD10aGlzLmVkZ2VGYWNlc1tzKzFdO2lmKC0xPT1ufHwtMT09aCl7dGhpcy5lZGdlQW5nbGVzW3MvMl09MipNYXRoLlBJO2NvbnRpbnVlfWNvbnN0IG89ZS5nZXRWYWx1ZVJlZihuKSxfPWUuZ2V0VmFsdWVSZWYoaCk7dGhpcy5lZGdlQW5nbGVzW3MvMl09by5hbmdsZVRvKF8pfX1jb21wdXRlVmVydGV4Tm9ybWFscyh0PTEpe3RoaXMuZ2VuZXJhdGVFZGdlRmxhZ3MoKTt0aGlzLnZlcnRpY2VzO2NvbnN0IGU9dGhpcy5nZXRGYWNlQXR0cmlidXRlKCJub3JtYWxzIikscz10aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgibm9ybWFscyIsciksYT1lLmRhdGEuYnVmZmVyLGk9cy5kYXRhLG49KHQsZSk9PntpWzMqdCswXT1lLngsaVszKnQrMV09ZS55LGlbMyp0KzJdPWUuen0saD0odCxlKT0+e2xldCBzLGE7Y29uc3QgaT10aGlzLmZhY2VFZGdlc1t0XTtmb3IoY29uc3QgdCBvZiBpKSh0aGlzLmVkZ2VWZXJ0c1syKnRdPT1lfHx0aGlzLmVkZ2VWZXJ0c1syKnQrMV09PWUpJiYocz9hPXRoaXMuZWRnZVZlY3NbdF06cz10aGlzLmVkZ2VWZWNzW3RdKTtyZXR1cm5bcyxhXX07Zm9yKGxldCBlPTA7ZTx0aGlzLnZlcnRleEVkZ2VzLmxlbmd0aDtlKyspe2lmKG51bGw9PXRoaXMudmVydGV4RWRnZXNbZV0pY29udGludWU7Y29uc3QgaT10aGlzLnZlcnRleEVkZ2VzW2VdLF89W10sZD10PT57bGV0IGU9ITE7Zm9yKGNvbnN0IHMgb2YgXylpZihlPS0xIT1zLmluZGV4T2YodCksZSlicmVhaztlfHxfLnB1c2goW3RdKX07Zm9yKGNvbnN0IGUgb2YgaSl7Y29uc3Qgcz10aGlzLmVkZ2VGYWNlc1syKmVdLGE9dGhpcy5lZGdlRmFjZXNbMiplKzFdO2lmKC0xIT1zJiYtMT09YSYmdGhpcy5lZGdlQW5nbGVzW2VdPHQpe2xldCB0PS0xLGU9LTE7Zm9yKGxldCBpPTA7aTxfLmxlbmd0aDtpKyspLTE9PXQmJi0xIT1fW2ldLmluZGV4T2YocykmJih0PWkpLC0xPT1lJiYtMSE9X1tpXS5pbmRleE9mKGEpJiYoZT1pKTstMT09dCYmLTE9PWU/Xy5wdXNoKFtzLGFdKTotMSE9dCYmLTEhPWU/dCE9ZSYmKF9bdF09X1t0XS5jb25jYXQoX1tlXSksXy5zcGxpY2UoZSwxKSk6KC0xPT10JiZfW2VdLnB1c2gocyksLTE9PWUmJl9bdF0ucHVzaChhKSl9ZWxzZS0xIT1zJiZkKHMpLC0xIT1hJiZkKGEpfV8uc29ydCgodCxlKT0+dC5sZW5ndGg8ZS5sZW5ndGg/MTp0Lmxlbmd0aD5lLmxlbmd0aD8tMTowKTtsZXQgbD0hMDtmb3IoY29uc3QgdCBvZiBfKXtjb25zdCBpPW5ldyByO2Zvcihjb25zdCBzIG9mIHQpe2NvbnN0IHQ9aChzLGUpLG49dFswXS5hbmdsZVRvKHRbMV0pO2kuYWRkSW5QbGFjZSgobz1zLG5ldyByKGEsMTIqbykpLnNjYWxlKG4pKX1pLm5vcm1hbGl6ZUluUGxhY2UoKSxsPyhuKGUsaSksbD0hMSk6cy5zZXRTcGxpdFZlcnRleFZhbHVlcyhlLHQsaSl9fXZhciBvO3JldHVybiBzfWNvbXB1dGVOdW1UcmlhbmdsZXMoKXtsZXQgdD0zLGU9MDtmb3IoY29uc3QgcyBvZiB0aGlzLl9fZmFjZUNvdW50cyllKz1zKih0LTIpLHQrKztyZXR1cm4gZX1nZW5lcmF0ZVRyaWFuZ3VsYXRlZEluZGljZXModCxlLHMpe2NvbnN0IGE9dGhpcy5jb21wdXRlTnVtVHJpYW5nbGVzKCk7bGV0IGk7aT10PE1hdGgucG93KDIsOCk/bmV3IFVpbnQ4QXJyYXkoMyphKTp0PE1hdGgucG93KDIsMTYpP25ldyBVaW50MTZBcnJheSgzKmEpOm5ldyBVaW50MzJBcnJheSgzKmEpO2xldCByPTA7Y29uc3Qgbj1mdW5jdGlvbih0LGEpe3QgaW4gcyYmYSBpbiBzW3RdJiYodD1lK3NbdF1bYV0pLGlbcl09dCxyKyt9LGg9dGhpcy5nZXROdW1GYWNlcygpO2ZvcihsZXQgdD0wO3Q8aDt0Kyspe2NvbnN0IGU9dGhpcy5nZXRGYWNlVmVydGV4SW5kaWNlcyh0KTtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKylzPj0zJiYobihlWzBdLHQpLG4oZVtzLTFdLHQpKSxuKGVbc10sdCl9cmV0dXJuIGl9Y29tcHV0ZUhhcmRFZGdlc0luZGljZXModD0xKXtjb25zdCBlPVtdLHM9dD0+e2UucHVzaCh0aGlzLmVkZ2VWZXJ0c1t0XSksZS5wdXNoKHRoaXMuZWRnZVZlcnRzW3QrMV0pfTtmb3IobGV0IGU9MDtlPHRoaXMuZWRnZUZsYWdzLmxlbmd0aDtlKz0yKXRoaXMuZWRnZUFuZ2xlc1tlLzJdPnQmJnMoZSk7cmV0dXJuIGV9Z2V0V2lyZWZyYW1lSW5kaWNlcygpe3JldHVybiBpbmRpY2VzfWdlbkJ1ZmZlcnModCl7Y29uc3QgZT17fTtsZXQgcz0wO2Zvcihjb25zdFssdF1vZiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcyl7Y29uc3QgYT10LmdldFNwbGl0cygpO2Zvcihjb25zdCB0IGluIGEpe3QgaW4gZXx8KGVbdF09e30pO2NvbnN0IGk9YVt0XTtmb3IoY29uc3QgYSBpbiBpKXtjb25zdCBpPXBhcnNlSW50KGEpO2kgaW4gZVt0XXx8KGVbdF1baV09cyxzKyspfX19Y29uc3QgYT10aGlzLnZlcnRpY2VzLmxlbmd0aCxpPWErcztsZXQgcjt0JiYwPT10LmluY2x1ZGVJbmRpY2VzfHwocj10aGlzLmdlbmVyYXRlVHJpYW5ndWxhdGVkSW5kaWNlcyhpLGEsZSkpO2NvbnN0IG49e307Zm9yKGNvbnN0W3QsYV1vZiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcyl7bGV0IGk7aT0wPT1zP2EuZGF0YTphLmdlbmVyYXRlU3BsaXRWYWx1ZXMoZSxzKTtjb25zdCByPWEubnVtRWxlbWVudHMsaD1pLmxlbmd0aC9yO25bdF09e3ZhbHVlczppLGNvdW50OmgsZGltZW5zaW9uOnIsbm9ybWFsaXplZDoibm9ybWFscyI9PXQsZGF0YVR5cGU6YS5kYXRhVHlwZX19Y29uc3QgaD17bnVtVmVydGljZXM6dGhpcy5udW1WZXJ0aWNlcygpLG51bVJlbmRlclZlcnRzOmksaW5kaWNlczpyLGF0dHJCdWZmZXJzOm59O2lmKHQmJnQuaW5jbHVkZVZlcnRleE5laWdoYm9ycyl7bnVsbD09dGhpcy52ZXJ0ZXhFZGdlcyYmdGhpcy5nZW5Ub3BvbG9neUluZm8oKTtsZXQgdD0wO2ZvcihsZXQgZT0wO2U8dGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGg7ZSsrKXRoaXMudmVydGV4RWRnZXNbZV0mJih0Kz10aGlzLnZlcnRleEVkZ2VzW2VdLnNpemUpO2NvbnN0IGU9bmV3IFVpbnQzMkFycmF5KDIqdGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGgrdCkscz10PT57Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspe2NvbnN0IHM9dFtlXTtmb3IobGV0IGE9MDthPGU7YSsrKXtjb25zdCBpPXRbYV07aWYoLTEhPXNbMF0mJnNbMF09PWlbMV0pe2UhPWErMSYmKHQuc3BsaWNlKGUsMSksdC5zcGxpY2UoYSsxLDAscykpO2JyZWFrfWlmKC0xIT1zWzFdJiZzWzFdPT1pWzBdKXt0LnNwbGljZShlLDEpLHQuc3BsaWNlKGEsMCxzKTticmVha319fX0sYT10PT57aWYoISgtMSE9dFswXVswXSYmLTEhPXRbdC5sZW5ndGgtMV1bMV18fC0xPT10WzBdWzBdJiYtMT09dFt0Lmxlbmd0aC0xXVsxXSkpdGhyb3cgbmV3IEVycm9yKCJJZiBmYW4gc3RhcnRzIHdpdGggLTEsIGl0IG11c3QgYWxzbyBlbmQgd2l0aCAtMSIpO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKXtjb25zdCBzPXRbZV07aWYoKC0xPT1zWzBdfHwtMT09c1sxXSkmJjAhPWUmJmUhPXQubGVuZ3RoLTEpdGhyb3cgbmV3IEVycm9yKCItMSBvbmx5IGFsbG93ZWQgYXQgdGhlIGJlZ2lubmluZyBhbmQgZW5kIG9mIGEgZmFuLiIpO2lmKC0xIT1zWzBdKXtsZXQgYT1lLTE7aWYoYTwwJiYoYSs9dC5sZW5ndGgpLHNbMF0hPXRbYV1bMV0pdGhyb3cgbmV3IEVycm9yKCJGYWNlcyBhcmUgbm90IHNlcXVlbnRpYWwiKX1pZigtMSE9c1sxXSl7Y29uc3QgYT0oZSsxKSV0Lmxlbmd0aDtpZihzWzFdIT10W2FdWzBdKXRocm93IG5ldyBFcnJvcigiRmFjZXMgYXJlIG5vdCBzZXF1ZW50aWFsIil9fX07bGV0IGk9Mip0aGlzLnZlcnRleEVkZ2VzLmxlbmd0aDtmb3IobGV0IHQ9MDt0PHRoaXMudmVydGV4RWRnZXMubGVuZ3RoO3QrKyl7aWYobnVsbD09dGhpcy52ZXJ0ZXhFZGdlc1t0XSljb250aW51ZTtjb25zdCByPXRoaXMudmVydGV4RWRnZXNbdF0sbj1bXTtmb3IoY29uc3QgZSBvZiByKXtjb25zdCBzPXRoaXMuZWRnZVZlcnRzWzIqZV0sYT10aGlzLmVkZ2VWZXJ0c1syKmUrMV07bGV0IGkscj10aGlzLmVkZ2VGYWNlc1syKmVdLGg9dGhpcy5lZGdlRmFjZXNbMiplKzFdO2lmKHM9PXQpaT1hO2Vsc2V7aWYoYSE9dCl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdG9wb2xvZ3kiKTt7aT1zO2NvbnN0IHQ9cjtyPWgsaD10fX1uLnB1c2goW3IsaCxpXSl9cyhuKSxhKG4pO2xldCBoPTA7KC0xIT1uWzBdWzBdfHwtMSE9bltuLmxlbmd0aC0xXVsxXSkmJihoKz0xKSxlWzIqdF09aSxlWzIqdCsxXT1yLnNpemUrKGg8PDgpO2Zvcihjb25zdCB0IG9mIG4pZVtpXT10WzJdLGkrK31oLnZlcnRleE5laWdoYm9ycz1lfXJldHVybiBofWZyZWVCdWZmZXJzKCl7c3VwZXIuZnJlZUJ1ZmZlcnMoKSx0aGlzLmluaXQoKX1yZWFkQmluYXJ5KHQsZSl7c3VwZXIubG9hZEJhc2VHZW9tQmluYXJ5KHQpLHRoaXMuc2V0RmFjZUNvdW50cyh0LmxvYWRVSW50MzJBcnJheSgpKSx0aGlzLl9fZmFjZVZlcnRleENvdW50cz10LmxvYWRVSW50OEFycmF5KHRoaXMuX19mYWNlVmVydGV4Q291bnRzLmxlbmd0aCk7Y29uc3Qgcz10LmxvYWRTSW50MzJWZWMyKCksYT10LmxvYWRVSW50OCgpO2xldCByOzE9PWE/cj10LmxvYWRVSW50OEFycmF5KCk6Mj09YT9yPXQubG9hZFVJbnQxNkFycmF5KCk6ND09YSYmKHI9dC5sb2FkVUludDMyQXJyYXkoKSk7Y29uc3Qgbj10aGlzLmdldE51bUZhY2VzKCk7bGV0IGg9MCxvPTA7Zm9yKGxldCB0PTA7dDxuO3QrKyl7Y29uc3QgZT10aGlzLl9fZmFjZVZlcnRleENvdW50c1t0XSszO3RoaXMuX19mYWNlT2Zmc2V0c1t0XT1oO2ZvcihsZXQgYT0wO2E8ZTthKyspe2NvbnN0IGU9aCthLGk9cltlXStzLng7aWYoMD09dCl0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbZV09aTtlbHNle2xldCBzPXRoaXMuX19mYWNlT2Zmc2V0c1t0LTFdO3MrPWE8bz9hOm8tMSx0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbZV09dGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzW3NdK2l9fWgrPWUsbz1lfXRoaXMuX19udW1Qb3B1bGF0ZWRGYWNlVmVydGV4SW5kaWNlcz1oO2NvbnN0IF89dC5sb2FkVUludDMyKCk7aWYoXz4wKXtjb25zdCBlPXRoaXMudmVydGljZXMscz10aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgibGlnaHRtYXBDb29yZHMiLGkpO2ZvcihsZXQgYT0wO2E8XzthKyspe2NvbnN0IGE9bmV3IG0odC5sb2FkRmxvYXQzMlZlYzMoKSx0LmxvYWRGbG9hdDMyUXVhdCgpKSxyPXQubG9hZEZsb2F0MzIoKSxuPXQubG9hZEZsb2F0MzJWZWMyKCksaD10LmxvYWRTSW50MzJWZWMyKCksbz10LmxvYWRVSW50OCgpO2xldCBfO189MT09bz90LmxvYWRVSW50OEFycmF5KCk6Mj09bz90LmxvYWRVSW50MTZBcnJheSgpOnQubG9hZFVJbnQzMkFycmF5KCk7bGV0IGQ9MDtmb3IoY29uc3QgdCBvZiBfKXtsZXQgbz10K2gueDtvKz1kLGQ9bztjb25zdCBfPXRoaXMuZ2V0RmFjZVZlcnRleEluZGljZXMobyk7Zm9yKGNvbnN0IHQgb2YgXyl7Y29uc3QgaD1lLmdldFZhbHVlUmVmKHQpLF89YS50cmFuc2Zvcm1WZWMzKGgpLGQ9bmV3IGkoXy54LF8ueik7ZC5zY2FsZUluUGxhY2UociksZC5hZGRJblBsYWNlKG4pLHMuc2V0RmFjZVZlcnRleFZhbHVlX0J5VmVydGV4SW5kZXgobyx0LGQpfX19fXRoaXMuaGFzVmVydGV4QXR0cmlidXRlKCJub3JtYWxzIil8fHRoaXMuY29tcHV0ZVZlcnRleE5vcm1hbHMoKSx0aGlzLmVtaXQoImdlb21EYXRhQ2hhbmdlZCIse30pfXRvSlNPTih0LGUpe2NvbnN0IHM9c3VwZXIudG9KU09OKHQsZSk7cmV0dXJuIDEwMjQmZXx8KHMuZmFjZUNvdW50cz1BcnJheS5mcm9tKHRoaXMuX19mYWNlQ291bnRzKSxzLmZhY2VWZXJ0ZXhJbmRpY2VzPUFycmF5LmZyb20odGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzKSksc31mcm9tSlNPTih0LGUscyl7c3VwZXIuZnJvbUpTT04odCxlLHMpLHQuZmFjZUNvdW50cyYmKHRoaXMuX19mYWNlQ291bnRzPVVpbnQzMkFycmF5LmZyb20odC5mYWNlQ291bnRzKSksdC5mYWNlVmVydGV4SW5kaWNlcyYmKHRoaXMuX19mYWNlVmVydGV4SW5kaWNlcz1VaW50MzJBcnJheS5mcm9tKHQuZmFjZVZlcnRleEluZGljZXMpKX19Y2xhc3MgRXtjb25zdHJ1Y3Rvcih0LGU9MCxzPSEwKXt0aGlzLl9fZGF0YT10LHRoaXMuX19ieXRlT2Zmc2V0PWUsdGhpcy5fX2RhdGFWaWV3PW5ldyBEYXRhVmlldyh0aGlzLl9fZGF0YSksdGhpcy5fX2lzTW9iaWxlRGV2aWNlPXMsdGhpcy51dGY4ZGVjb2Rlcj1uZXcgVGV4dERlY29kZXJ9Z2V0IGlzTW9iaWxlRGV2aWNlKCl7cmV0dXJuIHRoaXMuX19pc01vYmlsZURldmljZX1nZXQgZGF0YSgpe3JldHVybiB0aGlzLl9fZGF0YX1nZXQgYnl0ZUxlbmd0aCgpe3JldHVybiB0aGlzLl9fZGF0YVZpZXcuYnl0ZUxlbmd0aH1nZXQgcmVtYWluaW5nQnl0ZUxlbmd0aCgpe3JldHVybiB0aGlzLl9fZGF0YVZpZXcuYnl0ZUxlbmd0aC10aGlzLl9fYnl0ZU9mZnNldH1wb3MoKXtyZXR1cm4gdGhpcy5fX2J5dGVPZmZzZXR9c2Vlayh0KXt0aGlzLl9fYnl0ZU9mZnNldD10fWFkdmFuY2UodCl7dGhpcy5fX2J5dGVPZmZzZXQrPXR9bG9hZFVJbnQ4KCl7Y29uc3QgdD10aGlzLl9fZGF0YVZpZXcuZ2V0VWludDgodGhpcy5fX2J5dGVPZmZzZXQpO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9MSx0fWxvYWRVSW50MTYoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRVaW50MTYodGhpcy5fX2J5dGVPZmZzZXQsITApO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9Mix0fWxvYWRVSW50MzIoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRVaW50MzIodGhpcy5fX2J5dGVPZmZzZXQsITApO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9NCx0fWxvYWRTSW50MzIoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRJbnQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz00LHR9bG9hZEZsb2F0MTYoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQxNigpO3JldHVybiBNYXRoLmRlY29kZTE2Qml0RmxvYXQodCl9bG9hZFVGbG9hdDE2KCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDE2KCk7cmV0dXJuIHQ8MD8yMDQ4LXQ6dH1sb2FkRmxvYXQxNkZyb20yeFVJbnQ4KCl7Y29uc3QgdD10aGlzLl9fZGF0YVZpZXcuZ2V0RmxvYXQxNih0aGlzLl9fYnl0ZU9mZnNldCwhMCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz0yLHR9bG9hZFVJbnQzMkZyb20yeFVGbG9hdDE2KCl7cmV0dXJuIHRoaXMubG9hZFVGbG9hdDE2KCkrNDA5Nip0aGlzLmxvYWRVRmxvYXQxNigpfWxvYWRTSW50MzJGcm9tMnhGbG9hdDE2KCl7cmV0dXJuIHRoaXMubG9hZEZsb2F0MTYoKSsyMDQ4KnRoaXMubG9hZEZsb2F0MTYoKX1sb2FkRmxvYXQzMigpe2NvbnN0IHQ9dGhpcy5fX2RhdGFWaWV3LmdldEZsb2F0MzIodGhpcy5fX2J5dGVPZmZzZXQsITApO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9NCx0fWxvYWRVSW50OEFycmF5KHQsZT0hMSl7bnVsbD09dCYmKHQ9dGhpcy5sb2FkVUludDMyKCkpO2NvbnN0IHM9bmV3IFVpbnQ4QXJyYXkodGhpcy5fX2RhdGEsdGhpcy5fX2J5dGVPZmZzZXQsdCk7dGhpcy5fX2J5dGVPZmZzZXQrPXQ7dGhpcy5fX2J5dGVPZmZzZXQ7cmV0dXJuIHN9bG9hZFVJbnQxNkFycmF5KHQsZT0hMSl7aWYobnVsbD09dCYmKHQ9dGhpcy5sb2FkVUludDMyKCkpLDA9PXQpcmV0dXJuIG5ldyBVaW50MTZBcnJheTtsZXQgcztpZih0aGlzLnJlYWRQYWRkKDIpLHRoaXMuX19pc01vYmlsZURldmljZSl7cz1uZXcgVWludDE2QXJyYXkodCk7Zm9yKGxldCBlPTA7ZTx0O2UrKylzW2VdPXRoaXMuX19kYXRhVmlldy5nZXRVaW50MTYodGhpcy5fX2J5dGVPZmZzZXQsITApLHRoaXMuX19ieXRlT2Zmc2V0Kz0yfWVsc2Ugcz1uZXcgVWludDE2QXJyYXkodGhpcy5fX2RhdGEsdGhpcy5fX2J5dGVPZmZzZXQsdCksdGhpcy5fX2J5dGVPZmZzZXQrPTIqdDtyZXR1cm4gc31sb2FkVUludDMyQXJyYXkodCxlPSExKXtpZihudWxsPT10JiYodD10aGlzLmxvYWRVSW50MzIoKSksMD09dClyZXR1cm4gbmV3IFVpbnQzMkFycmF5O2xldCBzO2lmKHRoaXMucmVhZFBhZGQoNCksdGhpcy5fX2lzTW9iaWxlRGV2aWNlKXtzPW5ldyBVaW50MzJBcnJheSh0KTtmb3IobGV0IGU9MDtlPHQ7ZSsrKXNbZV09dGhpcy5fX2RhdGFWaWV3LmdldFVpbnQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCksdGhpcy5fX2J5dGVPZmZzZXQrPTR9ZWxzZSBzPW5ldyBVaW50MzJBcnJheSh0aGlzLl9fZGF0YSx0aGlzLl9fYnl0ZU9mZnNldCx0KSx0aGlzLl9fYnl0ZU9mZnNldCs9NCp0O3JldHVybiBzfWxvYWRGbG9hdDMyQXJyYXkodCxlPSExKXtpZihudWxsPT10JiYodD10aGlzLmxvYWRVSW50MzIoKSksMD09dClyZXR1cm4gbmV3IEZsb2F0MzJBcnJheTtsZXQgcztpZih0aGlzLnJlYWRQYWRkKDQpLHRoaXMuX19pc01vYmlsZURldmljZSl7cz1uZXcgRmxvYXQzMkFycmF5KHQpO2ZvcihsZXQgZT0wO2U8dDtlKyspc1tlXT10aGlzLl9fZGF0YVZpZXcuZ2V0RmxvYXQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCksdGhpcy5fX2J5dGVPZmZzZXQrPTR9ZWxzZSBzPW5ldyBGbG9hdDMyQXJyYXkodGhpcy5fX2RhdGEsdGhpcy5fX2J5dGVPZmZzZXQsdCksdGhpcy5fX2J5dGVPZmZzZXQrPTQqdDtyZXR1cm4gc31sb2FkU3RyKCl7Y29uc3QgdD10aGlzLmxvYWRVSW50MzIoKSxlPW5ldyBVaW50OEFycmF5KHRoaXMuX19kYXRhLHRoaXMuX19ieXRlT2Zmc2V0LHQpO3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldCs9dCx0aGlzLnV0ZjhkZWNvZGVyLmRlY29kZShlKX1sb2FkU3RyQXJyYXkoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQzMigpLGU9W107Zm9yKGxldCBzPTA7czx0O3MrKyllW3NdPXRoaXMubG9hZFN0cigpO3JldHVybiBlfWxvYWRTSW50MzJWZWMyKCl7Y29uc3QgdD10aGlzLmxvYWRTSW50MzIoKSxlPXRoaXMubG9hZFNJbnQzMigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRVSW50MzJWZWMyKCl7Y29uc3QgdD10aGlzLmxvYWRVSW50MzIoKSxlPXRoaXMubG9hZFVJbnQzMigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRGbG9hdDE2VmVjMigpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQxNigpLGU9dGhpcy5sb2FkRmxvYXQxNigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRGbG9hdDMyVmVjMigpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQzMigpLGU9dGhpcy5sb2FkRmxvYXQzMigpO3JldHVybiBuZXcgaSh0LGUpfWxvYWRGbG9hdDE2VmVjMygpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQxNigpLGU9dGhpcy5sb2FkRmxvYXQxNigpLHM9dGhpcy5sb2FkRmxvYXQxNigpO3JldHVybiBuZXcgcih0LGUscyl9bG9hZEZsb2F0MzJWZWMzKCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDMyKCksZT10aGlzLmxvYWRGbG9hdDMyKCkscz10aGlzLmxvYWRGbG9hdDMyKCk7cmV0dXJuIG5ldyByKHQsZSxzKX1sb2FkRmxvYXQxNlF1YXQoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MTYoKSxlPXRoaXMubG9hZEZsb2F0MTYoKSxzPXRoaXMubG9hZEZsb2F0MTYoKSxhPXRoaXMubG9hZEZsb2F0MTYoKTtyZXR1cm4gbmV3IHUodCxlLHMsYSl9bG9hZEZsb2F0MzJRdWF0KCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDMyKCksZT10aGlzLmxvYWRGbG9hdDMyKCkscz10aGlzLmxvYWRGbG9hdDMyKCksYT10aGlzLmxvYWRGbG9hdDMyKCk7cmV0dXJuIG5ldyB1KHQsZSxzLGEpfWxvYWRSR0JGbG9hdDMyQ29sb3IoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MzIoKSxlPXRoaXMubG9hZEZsb2F0MzIoKSxzPXRoaXMubG9hZEZsb2F0MzIoKTtyZXR1cm4gbmV3IG8odCxlLHMpfWxvYWRSR0JBRmxvYXQzMkNvbG9yKCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDMyKCksZT10aGlzLmxvYWRGbG9hdDMyKCkscz10aGlzLmxvYWRGbG9hdDMyKCksYT10aGlzLmxvYWRGbG9hdDMyKCk7cmV0dXJuIG5ldyBvKHQsZSxzLGEpfWxvYWRSR0JVSW50OENvbG9yKCl7Y29uc3QgdD10aGlzLmxvYWRVSW50OCgpLGU9dGhpcy5sb2FkVUludDgoKSxzPXRoaXMubG9hZFVJbnQ4KCk7cmV0dXJuIG5ldyBvKHQvMjU1LGUvMjU1LHMvMjU1KX1sb2FkUkdCQVVJbnQ4Q29sb3IoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQ4KCksZT10aGlzLmxvYWRVSW50OCgpLHM9dGhpcy5sb2FkVUludDgoKSxhPXRoaXMubG9hZFVJbnQ4KCk7cmV0dXJuIG5ldyBvKHQvMjU1LGUvMjU1LHMvMjU1LGEvMjU1KX1sb2FkQm94Migpe3JldHVybiBuZXcgZyh0aGlzLmxvYWRGbG9hdDMyVmVjMigpLHRoaXMubG9hZEZsb2F0MzJWZWMyKCkpfWxvYWRCb3gzKCl7cmV0dXJuIG5ldyBwKHRoaXMubG9hZEZsb2F0MzJWZWMzKCksdGhpcy5sb2FkRmxvYXQzMlZlYzMoKSl9cmVhZFBhZGQodCl7Y29uc3QgZT10aGlzLl9fYnl0ZU9mZnNldCV0OzAhPWUmJih0aGlzLl9fYnl0ZU9mZnNldCs9dC1lKX19Y2xhc3MgUHtjb25zdHJ1Y3Rvcih0KXtpZih0KXtjb25zdCBlPXQuc3BsaXQoIi0iKSxzPWVbMF0uc3BsaXQoIi4iKTt0aGlzLm1ham9yPXBhcnNlSW50KHNbMF0pLHRoaXMubWlub3I9cGFyc2VJbnQoc1sxXSksdGhpcy5wYXRjaD1wYXJzZUludChzWzJdKSwyPT1lLmxlbmd0aCYmKHRoaXMuYnJhbmNoPWVbMV0pfWVsc2UgdGhpcy5tYWpvcj0wLHRoaXMubWlub3I9MCx0aGlzLnBhdGNoPTB9Y29tcGFyZSh0KXtjb25zdCBlPVt0aGlzLm1ham9yLHRoaXMubWlub3IsdGhpcy5wYXRjaF07Zm9yKGxldCBzPTA7czwzO3MrKylpZihlW3NdIT09dFtzXSlyZXR1cm4gZVtzXS10W3NdO3JldHVybiAwfWVxdWFscyh0KXtyZXR1cm4hKHRoaXMucGF0Y2g9PXRbMl0mJnRoaXMubWlub3I9PXRbMV0mJnRoaXMubWFqb3I9PXRbMF0pfWxlc3NUaGFuKHQpe3JldHVybiEodGhpcy5tYWpvcj49dFswXXx8dGhpcy5taW5vcj49dFsxXXx8dGhpcy5wYXRjaD49dFsyXSl9Z3JlYXRlclRoYW4odCl7cmV0dXJuIHRoaXMubWFqb3I+dFswXXx8dGhpcy5taW5vcj50WzFdfHx0aGlzLnBhdGNoPnRbMl19Z3JlYXRlck9yRXF1YWxUaGFuKHQpe3JldHVybiEodGhpcy5tYWpvcjx0WzBdKSYmKHRoaXMubWFqb3I+dFswXXx8ISh0aGlzLm1pbm9yPHRbMV0pJiYodGhpcy5taW5vcj50WzFdfHwhKHRoaXMucGF0Y2g8dFsyXSkpKX19c2VsZi5vbm1lc3NhZ2U9ZnVuY3Rpb24odCl7KCh0LGUpPT57Zm9yKGxldCBlIGluIHQuY29udGV4dC52ZXJzaW9ucyl7Y29uc3Qgcz10LmNvbnRleHQudmVyc2lvbnNbZV0sYT1uZXcgUDthLm1ham9yPXMubWFqb3IsYS5taW5vcj1zLm1pbm9yLGEucGF0Y2g9cy5wYXRjaCxhLmJyYW5jaD1zLmJyYW5jaCx0LmNvbnRleHQudmVyc2lvbnNbZV09YX1jb25zdCBzPVtdLGk9dC50b2NbdC5nZW9tc1JhbmdlWzBdXSxyPVtdO2ZvcihsZXQgZT10Lmdlb21zUmFuZ2VbMF07ZTx0Lmdlb21zUmFuZ2VbMV07ZSsrKXtjb25zdCBuPW5ldyBFKHQuYnVmZmVyU2xpY2UsdC50b2NbZV0taSx0LmlzTW9iaWxlRGV2aWNlKSxoPW4ubG9hZFN0cigpLG89bi5wb3MoKTtsZXQgXztzd2l0Y2goaCl7Y2FzZSJQb2ludHMiOl89bmV3IE07YnJlYWs7Y2FzZSJMaW5lcyI6Xz1uZXcgQTticmVhaztjYXNlIk1lc2giOl89bmV3IE87YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIEdlb20gdHlwZToiK2gpfXRyeXtuLnNlZWsobyksXy5yZWFkQmluYXJ5KG4sdC5jb250ZXh0KX1jYXRjaCh0KXtjb25zb2xlLndhcm4oIkVycm9yIGxvYWRpbmc6IitfLm5hbWUrIlxuOiIrdCkscy5wdXNoKHt9KTtjb250aW51ZX1jb25zdCBkPV8uZ2VuQnVmZmVycyh0LmdlbkJ1ZmZlcnNPcHRzKTtkLmluZGljZXMmJnIucHVzaChkLmluZGljZXMuYnVmZmVyKTtmb3IoY29uc3QgdCBpbiBkLmF0dHJCdWZmZXJzKXtjb25zdCBlPWQuYXR0ckJ1ZmZlcnNbdF0scz1hLmdldFR5cGVOYW1lKGUuZGF0YVR5cGUpO2UuZGF0YVR5cGU9cyxyLnB1c2goZS52YWx1ZXMuYnVmZmVyKX1kLnZlcnRleE5laWdoYm9ycyYmci5wdXNoKGQudmVydGV4TmVpZ2hib3JzLmJ1ZmZlciksci5wdXNoKF8uYm91bmRpbmdCb3gucDAuX19kYXRhLmJ1ZmZlciksci5wdXNoKF8uYm91bmRpbmdCb3gucDEuX19kYXRhLmJ1ZmZlcikscy5wdXNoKHtuYW1lOl8ubmFtZSx0eXBlOmgsZ2VvbUJ1ZmZlcnM6ZCxiYm94Ol8uYm91bmRpbmdCb3h9KX1lKHtrZXk6dC5rZXksZ2VvbUluZGV4T2Zmc2V0OnQuZ2VvbUluZGV4T2Zmc2V0LGdlb21zUmFuZ2U6dC5nZW9tc1JhbmdlLGdlb21EYXRhczpzfSxyKX0pKHQuZGF0YSwodCxlKT0+e3NlbGYucG9zdE1lc3NhZ2UodCxlKX0pfTsKCg==",null,!1);var da=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__streamInfos={},e.__genBuffersOpts={},e.__workers=[],e.__nextWorker=0;for(var a=0;a<3;a++)e.__workers.push(e.__constructWorker());e.clear();return e}e.prototype.clear=function(){this.__loaded=0,this.__numGeoms=0,this.geoms=[]};e.prototype.__constructWorker=function(){var t=this;var e=new sa;return e.onmessage=function(e){t.__recieveGeomDatas(e.data.key,e.data.geomDatas,e.data.geomIndexOffset,e.data.geomsRange)},e};e.prototype.__terminateWorkers=function(){for(var t=0,e=this.__workers;t<e.length;t++){var a=e[t];a.terminate()}this.__workers=[]};e.prototype.setGenBufferOption=function(t,e){this.__genBuffersOpts[t]=e};e.prototype.setNumGeoms=function(t){this.__numGeoms=t};e.prototype.getGeom=function(t){return t>=this.geoms.length?null:this.geoms[t]};e.prototype.loadUrl=function(t){var e=this;nt(t,(function(t){e.loadBin(t)}),(function(t){console.warn(t)}))};e.prototype.readBinaryBuffer=function(t,e,a){var i=n.isMobileDevice,r=new mt(e,0,i),o=r.loadUInt32(),l=r.loadUInt32();if(this.__streamInfos[t]={total:o,done:0},0==o)return this.emit("streamFileParsed",{}),o;0==this.__numGeoms&&(this.__numGeoms=o);var s=r.loadUInt32Array(o);var d=window.navigator.hardwareConcurrency;d||(d=i?2:4);var c=Math.max(1,Math.floor(o/d+1));var u=0;for(;u<o;){var h=s[u];var m=void 0,p=void 0;u+c>=o?(p=[u,o],m=e.byteLength):(p=[u,u+c],m=s[p[1]]);var f=e.slice(h,m);u+=c,this.__workers[this.__nextWorker].postMessage({key:t,toc:s,geomIndexOffset:l,geomsRange:p,isMobileDevice:r.isMobileDevice,bufferSlice:f,genBuffersOpts:this.__genBuffersOpts,context:a},[f]),this.__nextWorker=(this.__nextWorker+1)%this.__workers.length}return o};e.prototype.__recieveGeomDatas=function(t,e,a,i){var n=a+i[0],r=[n,a+i[1]];for(var o=0;o<e.length;o++){var l=e[o];if(!l.type)continue;var s=void 0;switch(l.type){case"Points":s=new Fe(l);break;case"Lines":s=new Ce(l);break;case"Mesh":case"Plane":case"Sphere":case"Cone":s=new Ne(l);break;default:throw new Error("Unsupported Geom type:"+className)}this.geoms[n+o]=s}this.emit("rangeLoaded",{range:r});var d=r[1]-r[0],c=this.__streamInfos[t];c.done+=d,c.done==c.total&&this.emit("streamFileParsed",{count:1}),this.__loaded+=d,this.__loaded==this.__numGeoms&&(this.__terminateWorkers(),this.emit("loaded"))};e.prototype.toJSON=function(){return{numGeoms:this.geoms.length()}};e.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return e}(L);var ca=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__geomLibrary=new da,a.__materials=new ve,a.loaded=!1;return a}e.prototype.isLoaded=function(){return this.loaded};e.prototype.getEngineDataVersion=function(){return this.__engineDataVersion};e.prototype.getGeometryLibrary=function(){return this.__geomLibrary};e.prototype.getMaterialLibrary=function(){return this.__materials};e.prototype.getUnitsConversion=function(){return this.__unitsScale};e.prototype.readBinary=function(e,a){var i=this;if(a===void 0){a={}}var n;a.assetItem=this,a.numTreeItems=0,a.numGeomItems=0,a.versions["zea-engine"]||(a.versions["zea-engine"]=new ht(e.loadStr())),this.__engineDataVersion=a.versions["zea-engine"],console.log("Loading Engine File version:",a.versions["zea-engine"]);var r={};a.addGeomToLayer=function(t,e){if(!r[e]){n||(n=new ta("Layers"),i.addChild(n,!1));var a=new la(e);a.propagateXfoToItems=!1,n.addChild(a,!1),r[e]=a}r[e].addItem(t)};var o=function(){i.__units=e.loadStr();var t=1;switch(i.__units){case"Millimeters":t=.001;break;case"Centimeters":t=.01;break;case"Meters":t=1;break;case"Kilometers":t=1e3;break;case"Inches":t=.0254;break;case"Feet":t=.3048;break;case"Miles":t=1609.34}i.__unitsScale=t;var a=i.getLocalXfo().clone();a.sc.scaleInPlace(t),i.setLocalXfo(a)};a.versions["zea-engine"].greaterThan([0,0,6])&&o(),this.__materials.readBinary(e,a),t.prototype.readBinary.call(this,e,a),a.versions["zea-engine"].greaterOrEqualThan([0,0,5])&&a.versions["zea-engine"].lessThan([0,0,7])&&o()};e.prototype.toJSON=function(e,a){var i=this;if(e===void 0){e={}}if(a===void 0){a=0}e.makeRelative=function(t){var e=i.getPath(),a=t.slice(0,e.length);for(var n=0;n<a.length-1;n++)if(a[n]!=e[n])return console.warn("Param Path is not relative to the asset. May not be able to be resolved at load time:"+t),t;var r=t.slice(e.length-1);return r[0]=".",r},e.assetItem=this;return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i,n){var r=this;if(a===void 0){a={}}if(i===void 0){i=0}a||(a={}),a.assetItem=this,a.numTreeItems=0,a.numGeomItems=0,null==a.version&&(a.version=0),a.assetItem=this;var o=[];a.resolvePath=function(t,e){if(!t)throw new Error("Path not spcecified");var a=r.resolvePath(t);a?e(a):o.push((function(){var a=r.resolvePath(t);a?e(a):console.warn("Path unable to be resolved:"+t)}))},a.addPLCB=function(t){return o.push(t)},t.prototype.fromJSON.call(this,e,a,i);for(var l=0,s=o;l<s.length;l++){var d=s[l];d()}n&&n()};return e}(ta);K.registerClass("AssetItem",ca);var ua=function(t){__extends(e,t);function e(e,a){var i=t.call(this,e)||this;var n=i.addParameter(new It("Image"));a&&n.setValue(a),i.addParameter(new ft("PixelsPerMeter",1e3)),i.addParameter(new ft("Alpha",1)),i.addParameter(new Gt("Color",new y(1,1,1))),i.addParameter(new yt("AlignedToCamera",!1)),i.addParameter(new yt("DrawOnTop",!1));return i}return e}(ta);K.registerClass("BillboardItem",ua);var ha=function(t){__extends(e,t);function e(e){var a=this;null==e&&(e="Camera"),a=t.call(this,e)||this,a.__isOrthographicParam=a.addParameter(new yt("isOrthographic",!1)),a.__fovParam=a.addParameter(new ft("fov",1)),a.__nearParam=a.addParameter(new ft("near",.1)),a.__farParam=a.addParameter(new ft("far",1e3)),a.__focalDistanceParam=a.addParameter(new ft("focalDistance",5));var i=function(t){a.emit("projectionParamChanged",t)};a.__isOrthographicParam.addListener("valueChanged",i),a.__fovParam.addListener("valueChanged",i),a.__nearParam.addListener("valueChanged",i),a.__farParam.addListener("valueChanged",i),a.setPositionAndTarget(new m(3,3,1.75),new m(0,0,1),z.GENERATED_VALUE),a.setLensFocalLength("28mm",z.GENERATED_VALUE);return a}e.prototype.getNear=function(){return this.__nearParam.getValue()};e.prototype.setNear=function(t){this.__nearParam.setValue(t)};e.prototype.getFar=function(){return this.__farParam.getValue()};e.prototype.setFar=function(t){this.__farParam.setValue(t)};e.prototype.getFov=function(){return this.__fovParam.getValue()};e.prototype.setFov=function(t){this.__fovParam.setValue(t)};e.prototype.setLensFocalLength=function(t,e){if(e===void 0){e=z.USER_SETVALUE}var a={"10mm":100.4,"11mm":95,"12mm":90,"14mm":81.2,"15mm":77.3,"17mm":70.4,"18mm":67.4,"19mm":64.6,"20mm":61.9,"24mm":53.1,"28mm":46.4,"30mm":43.6,"35mm":37.8,"45mm":29.9,"50mm":27,"55mm":24.6,"60mm":22.6,"70mm":19.5,"75mm":18.2,"80mm":17.1,"85mm":16.1,"90mm":15.2,"100mm":13.7,"105mm":13,"120mm":11.4,"125mm":11,"135mm":10.2,"150mm":9.1,"170mm":8.1,"180mm":7.6,"210mm":6.5,"300mm":4.6,"400mm":3.4,"500mm":2.7,"600mm":2.3,"800mm":1.7};!t in a?console.warn("Camera lense focal length not suported:"+t):this.__fovParam.setValue(Math.degToRad(a[t]),e)};e.prototype.getFocalDistance=function(){return this.__focalDistanceParam.getValue()};e.prototype.setFocalDistance=function(t,e){if(e===void 0){e=z.USER_SETVALUE}t<1e-4&&console.error("Never set focal distance to zero"),this.__focalDistanceParam.setValue(t,e),this.__nearParam.setValue(.01*t,e),this.__farParam.setValue(200*t,e)};e.prototype.getIsOrthographic=function(){return this.__isOrthographicParam.getValue()};e.prototype.setIsOrthographic=function(t,e){if(e===void 0){e=z.USER_SETVALUE}this.__isOrthographicParam.setValue(t,e)};e.prototype.setPositionAndTarget=function(t,e,a){if(a===void 0){a=z.USER_SETVALUE}this.setFocalDistance(t.distanceTo(e),a);var i=new v;i.setLookAt(t,e,new m(0,0,1)),this.setGlobalXfo(i,a)};e.prototype.getTargetPostion=function(){var t=this.__focalDistanceParam.getValue(),e=this.getGlobalXfo(),a=e.ori.getZaxis();return a.scaleInPlace(-t),a.addInPlace(e.tr),a};e.prototype.frameView=function(t,e,a){if(a===void 0){a=z.USER_SETVALUE}var i=new R;for(var n=0,r=e;n<r.length;n++){var o=r[n];i.addBox3(o.getBoundingBox())}if(!i.isValid())return void console.warn("Bounding box not valid.");var l=this.__focalDistanceParam.getValue(),s=this.__fovParam.getValue(),d=this.getGlobalXfo().clone(),c=d.ori.getZaxis(),u=c.scale(-l),h=d.tr.add(u),m=i.center().subtract(h);d.tr.addInPlace(m);var p=new R;p.addBox3(i,d.inverse());p.center();var f=s*(t.getWidth()/t.getHeight()),b=p.p1,y=Math.abs(b.x)/Math.tan(.5*f)*1.2,g=Math.abs(b.y)/Math.tan(.5*s)*1.2,_=-.5*(p.p0.z-p.p1.z),Z=Math.max(y,g)+_,G=Z-l;d.tr.addInPlace(c.scale(G)),this.setFocalDistance(Z,a),this.setGlobalXfo(d,a),this.emit("movementFinished",{mode:a})};e.prototype.updateProjectionMatrix=function(t,e){this.__isOrthographicParam.getValue();var a=this.__fovParam.getValue(),i=this.__nearParam.getValue(),n=this.__farParam.getValue();t.setPerspectiveMatrix(a,e,i,n)};return e}(ta);K.registerClass("Camera",ha);var ma=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.addParameter(new Gt("BackgroundColor",new y("#808080"))),a.addParameter(new It("EnvMap")),a.addParameter(new yt("Display EnvMap",!1)),a.addParameter(new ft("EnvMapLOD",0));return a}return e}(A);var pa=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.loaded=!1,a.lightmap=null,a.geomsLoaded=!1,a.loaded=!1,a.__geomLibrary.addListener("loaded",(function(){a.emit("geomsLoaded",{})})),a.__datafileParam=a.addParameter(new St("DataFilePath")),a.__datafileParam.addListener("valueChanged",(function(){var t=a.__datafileParam.getFileDesc();if(t){if(console.log(t),""==a.getName()){var e=a.__datafileParam.getStem();a.setName(e)}a.geomsLoaded=!1,a.loadDataFile((function(){a.loaded||a.emit("loaded",{})}),(function(){}))}})),a.addParameter(new Gt("LightmapTint",new y(1,1,1,1)));return a}e.prototype.readBinary=function(e,a){if(-1!=a.version){var i=new ht;i.patch=a.version,a.versions={"zea-mesh":i,"zea-engine":i},a.meshSdk="FBX"}else{var n=e.loadUInt8();if(e.seek(0),10!=n){var r=new ht;r.patch=e.loadUInt32(),a.versions={"zea-mesh":r,"zea-engine":r},a.meshSdk="FBX"}else{var o=new ht(e.loadStr());a.versions={"zea-mesh":o},a.meshSdk="FBX"}}this.meshfileversion=a.versions["zea-mesh"],this.meshSdk=a.meshSdk,console.log("Loading CAD File version:",a.versions["zea-mesh"]," exported using SDK:",a.meshSdk);var l=e.loadUInt32();return t.prototype.readBinary.call(this,e,a),a.versions["zea-engine"].lessThan([0,0,5])&&e.seek(e.byteLength-4),this.__geomLibrary.setNumGeoms(e.loadUInt32()),l};e.prototype.loadDataFile=function(t,e){var a=this;var i=this.__datafileParam.getFileDesc();if(!i)return void console.warn("VLAAsset data file not found.");var r=this.__datafileParam.getFileFolderPath(),o=this.__datafileParam.getValue(),l=this.__datafileParam.getStem();var s=0;var d=new RegExp("\\.(vla)$","i").test(i.name),c=[],u=function(i){var r,l=-1;if(i.tree2)r=new mt(i.tree2.buffer,0,n.isMobileDevice);else{var u=i.tree?i.tree:i[Object.keys(i)[0]];r=new mt(u.buffer,0,n.isMobileDevice),l=0}s=a.readBinary(r,{assetItem:a,version:l}),d||s!=c.length&&console.error("The number of GeomFiles does not match the count given by the VLA file."),t(),0==s&&i.geoms0?(ut.addWork(o+"geoms",1),a.__geomLibrary.readBinaryBuffer(o,i.geoms0.buffer,{version:l}),e()):(ut.addWork(o+"geoms",4*s),h())},h=function(){var t=[];for(var a=0;a<s;a++)if(d){var i=r+l+a+".vlageoms",n=ut.resolveFilepath(i);if(!n)throw new Error("VLA Geoms file not found:"+i);t.push(m(a,n.url))}else t.push(m(a,c[a].url));Promise.all(t).then((function(){e&&e()}))},m=function(t,e){return new Promise((function(i){ut.loadUrl(o+t,e,(function(t){var e=t[Object.keys(t)[0]];a.__geomLibrary.readBinaryBuffer(o,e.buffer),i()}),!1)}))};if(d)ut.loadResource(o,u);else if(i.metadata.ConvertFile){var p;i.metadata.ConvertFile.map((function(t){t.filename.endsWith(".vla")?p=t:t.filename.endsWith(".vlageoms")&&c.push(t)})),p?ut.loadUrl(o,p.url,u):console.warn("ConvertFile metadata contains no vla file.")}this.__geomLibrary.addListener("streamFileParsed",(function(t){ut.addWorkDone(o+"geoms",t.fraction)}))};e.prototype.fromJSON=function(e,a,i){var n=this;a||(a={}),a.assetItem=this;var r=function(){t.prototype.fromJSON.call(n,e,a,i),i&&i()};if(e.params&&e.params.DataFilePath){this.__datafileLoaded=r;var o=e.params.DataFilePath;delete e.params.DataFilePath,this.__datafileParam.fromJSON(o,a)}else r()};return e}(ca);K.registerClass("VLAAsset",pa);var fa=new y("#DCDCDC");var ba=function(){function t(t){t&&ut.setResources(t),this.settings=new ma("Scene Settings"),this.root=new ta("root"),this.root.addChild(this.settings),this.__commonResources={}}t.prototype.getSettings=function(){return this.settings};t.prototype.getRoot=function(){return this.root};t.prototype.getResourceLoader=function(){return ut};t.prototype.setEnvMap=function(t){console.warn("Deprecated Function. Please access the Scene Settings object."),this.settings.getParameter("EnvMap").setValue(t)};t.prototype.addAsset=function(t){console.warn("Deprecated Function. Please access the Scene Root object."),this.root.addChild(t,!1)};t.prototype.setupGrid=function(t,e,a){if(t===void 0){t=5}if(e===void 0){e=50}if(a===void 0){a=fa}var i=new ta("Grid"),n=new zt("gridMaterial","LinesShader");n.getParameter("BaseColor").setValue(a);var r=new Je(t,t,e,e,!0);i.addChild(new ra("GridItem",r,n),!1);var o=new Le;o.setNumVertices(2),o.setNumSegments(1),o.setSegment(0,0,1),o.getVertex(0).set(-.5*t,0,0),o.getVertex(1).set(.5*t,0,0);var l=new zt("gridXAxisMaterial","LinesShader");l.getParameter("BaseColor").setValue(new y(a.luminance(),0,0)),i.addChild(new ra("xAxisLine",o,l),!1);var s=new zt("gridZAxisMaterial","LinesShader");s.getParameter("BaseColor").setValue(new y(0,a.luminance(),0));var d=new v;d.ori.setFromAxisAndAngle(new m(0,0,1),.5*Math.PI);var c=new ra("yAxisLine",o,s);return c.setGeomOffsetXfo(d),i.addChild(c,!1),i.setSelectable(!1,!0),i.setFlag(O.IGNORE_BBOX),i.clearFlag(O.USER_EDITED),i.setFlag(O.INVISIBLE),this.root.addChild(i,!1),i};t.prototype.loadCommonAssetResource=function(t){if(t in this.__commonResources)return this.__commonResources[t];var e=new pa;return e.getParameter("DataFilePath").setValue(t),this.__commonResources[t]=e,e};t.prototype.toJSON=function(t,e){if(t===void 0){t={}}if(e===void 0){e=0}t.makeRelative=function(t){return t};return{root:this.root.toJSON(t,e)}};t.prototype.fromJSON=function(t,e){var a=this;if(e===void 0){e={}}var i=[];e.resolvePath=function(t,e){if(!t)throw new Error("Path not spcecified");var n=a.root.resolvePath(t);n?e(n):i.push((function(){var i=a.resolvePath(t);i?e(i):console.warn("Path unable to be resolved:"+t)}))},e.addPLCB=function(t){return i.push(t)},e.settings=this.settings,t.root&&this.root.fromJSON(t.root,e);for(var n=0,r=i;n<r.length;n++){var o=r[n];o()}};return t}();var ya=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.geomsLoaded=!1,a.loaded=!1,a.addParameter(new yt("splitObjects",!1)),a.addParameter(new yt("splitGroupsIntoObjects",!1)),a.addParameter(new yt("loadMtlFile",!0)),a.addParameter(new ft("unitsConversion",1)),a.addParameter(new Rt("defaultShader","")),a.objfileParam=a.addParameter(new St("ObjFilePath")),a.objfileParam.addListener("valueChanged",(function(){a.loaded=!1,a.__loadObj((function(){a.emit("loaded",{})}),(function(){a.emit("geomsLoaded",{})}))})),a.geomLibrary=new da,a.materials=new ve;return a}e.prototype.getGeometryLibrary=function(){return this.geomLibrary};e.prototype.getMaterialLibrary=function(){return this.materials};e.prototype.__loadObj=function(t,e){var a=this;var i=this.objfileParam.getStem(),n=function(t){var e=t.split("\n"),i=/\s+/;var n;var r=function(t){if(3==t.length)return new y(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]));throw new Error("Unable to parse a color from the following parts:"+t.join("_"))},o=function(t){var e=a.objfileParam.getFileFolder();return new FileImage(t[0],e+t[0])};for(var l=0;l<e.length;l++){var s=e[l].trim();if(s.startsWith("#"))continue;-1!=s.indexOf("#")&&(s=s.substring(0,s.indexOf("#")).trim());var d=s.split(i),c=d.shift(),u=d.join(" ");switch(c){case"newmtl":n=new zt(u),n.setShaderName("StandardSurfaceShader"),a.materials.addMaterial(n);break;case"Kd":n.getParameter("BaseColor").setValue(r(d));break;case"map_Kd":n.getParameter("BaseColor").setValue(o(d));break;case"Ks":var h=(parseFloat(d[0])+parseFloat(d[1])+parseFloat(d[2]))/3;n.roughness=1-h,n.getParameter("Roughness").setValue(1-h),n.getParameter("Reflectance").setValue(h);break;case"map_Ks":n.getParameter("Roughness").setValue(o(d)),n.getParameter("Reflectance").setValue(.2);break;case"d":var m=parseFloat(u);m<1&&(n.setShaderName("TransparentSurfaceShader"),n.getParameter("Opacity").setValue(m));break;case"map_d":n.getParameter("alpha").setValue(parseFloat(d));break;case"map_bump":n.getParameter("normal").setValue(o(d))}}},r=new M;r.incAsyncCount(),r.addListener("ready",(function(){p()}));var o=function(t){return new Promise((function(e){tt(t.url,(function(t){ut.addWorkDone(i,1),n(t),r.decAsyncCount(),ut.addWorkDone(i,1),e()}))}))},l=new Array,s=new Array,d=new Array,c={},u=function(t){return __awaiter(a,void 0,void 0,(function(){var e,a,n,u,h,m,p,f,b,y,g,_,Z,G,X,v,V,I,R,x,S,W,L,T,M;return __generator(this,(function(F){switch(F.label){case 0:e=t.split("\n"),a=/\s+/;n=void 0,u=void 0;h=function(t){var e=0;for(;t in c;)e++,t+=String(e);n={verticesRemapping:{},texCoordsRemapping:{},normalsRemapping:{},vertexIndices:[],texCoordIndices:[],normalIndices:[],numVertices:0,numTexCoords:0,numNormals:0,numTris:0,numQuads:0,material:u},c[t]=n};h(i);m=this.getParameter("splitGroupsIntoObjects").getValue();p=0;F.label=1;case 1:if(!(p<e.length))return[3,15];f=e[p].trim();if(f.startsWith("#"))return[3,14];-1!=f.indexOf("#")&&(f=f.substring(0,f.indexOf("#")).trim());b=f.split(a),y=b.shift(),g=b.join(" ");_=y;switch(_){case"":return[3,2];case"s":return[3,2];case"mtllib":return[3,3];case"o":return[3,6];case"usemtl":return[3,7];case"g":return[3,8];case"v":return[3,9];case"vt":return[3,10];case"vn":return[3,11];case"f":return[3,12]}return[3,13];case 2:return[3,14];case 3:if(!this.getParameter("loadMtlFile").getValue())return[3,14];r.incAsyncCount(),ut.addWork(i,2);Z=this.objfileParam.getFileFolderPath(),G=ut.resolveFilepath(Z+g);X=G;if(!X)return[3,5];return[4,o(G)];case 4:X=F.sent();F.label=5;case 5:X;return[3,14];case 6:h(g);return[3,14];case 7:u=g,h(g+Object.keys(c).length);return[3,14];case 8:m&&h(b.join("_"));return[3,14];case 9:l.push(b.map((function(t){return parseFloat(t)})));return[3,14];case 10:d.push(b.map((function(t){return parseFloat(t)})));return[3,14];case 11:s.push(b.map((function(t){return parseFloat(t)})));return[3,14];case 12:{v=[],V=[],I=[];for(R=0,x=b.length;R<x;R++){S=b[R].split("/").map((function(t){return parseInt(t)-1})),W=S[0];L=n.verticesRemapping[W];if(null==L&&(L=n.numVertices,n.verticesRemapping[W]=L,n.numVertices++),v.push(L),S.length>1&&!isNaN(S[1])){T=S[1];V.push(T)}if(S.length>2&&!isNaN(S[2])){M=S[2];I.push(M)}}n.vertexIndices.push(v),I.length>0&&n.normalIndices.push(I),V.length>0&&n.texCoordIndices.push(V),3==v.length?n.numTris++:n.numQuads++;return[3,14]}F.label=13;case 13:console.warn("Unhandled line:"+f);F.label=14;case 14:p++;return[3,1];case 15:r.decAsyncCount();return[2]}}))}))},p=function(){for(var a in c)0!=c[a].numVertices&&f(a,c[a]);t(),e()},f=function(t,e){var i=e.numVertices,n=new Te(t);n.setFaceCounts([e.numTris,e.numQuads]),n.setNumVertices(i);var r=n.getVertexAttribute("positions"),o=a.getParameter("unitsConversion").getValue();for(var c in e.verticesRemapping){var u=e.verticesRemapping[c];r.getValueRef(u).set(l[c][0]*o,l[c][1]*o,l[c][2]*o)}var p,f;e.normalIndices.length>0&&(p=n.addVertexAttribute("normals",m)),e.texCoordIndices.length>0&&(f=n.addVertexAttribute("texCoords",h));for(var b=0;b<e.vertexIndices.length;b++){var g=e.vertexIndices[b];if(n.setFaceVertexIndices.apply(n,__spreadArrays([b],g)),p){var _=e.normalIndices[b];for(var Z=0;Z<_.length;Z++){var G=new m(s[_[Z]][0],s[_[Z]][1],s[_[Z]][2]);p.setFaceVertexValue(b,Z,G)}}if(f&&e.texCoordIndices.length==e.vertexIndices.length){var X=e.texCoordIndices[b];for(var V=0;V<X.length;V++){var I=new h(d[X[V]][0],d[X[V]][1]);f.setFaceVertexValue(b,V,I)}}}var R=new ra(t,n);R.selectable=!0;var x=n.boundingBox.center();if(n.moveVertices(x.negate()),R.setLocalXfo(new v(x)),null!=e.material&&a.materials.hasMaterial(e.material))R.setMaterial(a.materials.getMaterial(e.material));else{var S=a.getParameter("defaultShader").getValue(),W=new zt(t+"mat");W.setShaderName(""!=S?S:"StandardSurfaceShader");var L=W.getParameter("BaseColor");if(L)L.setValue(y.random(.5));else{var T=W.getParameter("Color");T&&T.setValue(y.random(.5))}var M=W.getParameter("Roughness");M&&M.setValue(.6);var F=W.getParameter("Reflectance");F&&F.setValue(.2),a.materials.addMaterial(W),R.setMaterial(W)}a.addChild(R,!1)};(function(){var t=a.objfileParam.getFileDesc(),e=a.objfileParam.getStem();ut.addWork(e,2),tt(t.url,(function(t){ut.addWorkDone(e,1),u(t),ut.addWorkDone(e,1)}))})()};return e}(ca);var ga=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.setFlag(O.USER_EDITED),a.__outputs=[],a.__evalOutput=a.__evalOutput.bind(a);return a}e.prototype.setDirty=function(){for(var t=0,e=this.__outputs;t<e.length;t++){var a=e[t];a.setDirtyFromOp()}};e.prototype.__parameterValueChanged=function(e){t.prototype.__parameterValueChanged.call(this,e),this.setDirty()};e.prototype.addOutput=function(t){var e=this;return this.__outputs.push(t),t.addListener("paramSet",(function(t){var a=t.param;a.bindOperator(e)})),t};e.prototype.removeOutput=function(t){t.getParam()&&t.getParam().unbindOperator(this),this.__outputs.splice(this.__outputs.indexOf(t),1)};e.prototype.getNumOutputs=function(){return this.__outputs.length};e.prototype.getOutputByIndex=function(t){return this.__outputs[t]};e.prototype.getOutput=function(t){for(var e=0,a=this.__outputs;e<a.length;e++){var i=a[e];if(i.getName()==t)return i}};e.prototype.__evalOutput=function(t){for(var e=0,a=this.__outputs;e<a.length;e++){var i=a[e];i.removeCleanerFn(this.__evalOutput)}this.evaluate()};e.prototype.__opInputChanged=function(){this.setDirty()};e.prototype.evaluate=function(){throw new Error("Not yet implemented")};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);i.type=K.getClassName(this);var n=[];for(var r=0,o=this.__outputs;r<o.length;r++){var l=o[r];n.push(l.toJSON(e,a))}return i.outputs=n,i};e.prototype.fromJSON=function(e,a,i){var n=this;if(t.prototype.fromJSON.call(this,e,a,i),e.outputs){for(var r=0;r<this.__outputs.length;r++){this.__outputs[r].fromJSON(e.outputs[r],a)}a.addPLCB((function(){n.__opInputChanged()}))}};e.prototype.detach=function(){this.__outputs.forEach((function(t){return t.detach()}))};e.prototype.reattach=function(){this.__outputs.forEach((function(t){return t.reattach()}))};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__outputs=[]};return e}(A);var _a=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this)||this,i.__name=e,i.__filterFn=a,i._param=void 0,i.detached=!1;return i}e.prototype.getName=function(){return this.__name};e.prototype.getFilterFn=function(){return this.__filterFn};e.prototype.isConnected=function(){return null!=this._param};e.prototype.getParam=function(){return this._param};e.prototype.setParam=function(t){this._param=t,this.emit("paramSet",{param:t})};e.prototype.getValue=function(t){if(t===void 0){t=w.OPERATOR_GETVALUE}if(this._param)return this._param.getValue(t)};e.prototype.setValue=function(t,e){if(e===void 0){e=z.OPERATOR_SETVALUE}this._param&&this._param.setValue(t,e)};e.prototype.setClean=function(t){this._param&&this._param.setClean(t)};e.prototype.setDirty=function(t){this._param&&this._param.setDirty(t)};e.prototype.setDirtyFromOp=function(){this._param&&this._param.setDirtyFromOp()};e.prototype.removeCleanerFn=function(t){this._param&&this._param.removeCleanerFn(t)};e.prototype.toJSON=function(t,e){var a=this._param?this._param.getPath():"";return{type:K.getClassName(this),paramPath:t&&t.makeRelative?t.makeRelative(a):a}};e.prototype.fromJSON=function(t,e,a){var i=this;t.paramPath&&e.resolvePath(t.paramPath,(function(t){i.setParam(t)}),(function(e){console.warn("Operator Output: '"+i.getName()+"'. Unable to load item:"+t.paramPath)}))};e.prototype.detach=function(){this.detached=!0};e.prototype.reattach=function(){this.detached=!1};return e}(L);K.registerClass("OperatorOutput",_a);var Za=function(t){__extends(e,t);function e(e){return t.call(this,e,(function(t){return"Xfo"==t.getDataType()}))||this}e.prototype.getInitialValue=function(){return this._initialParamValue};e.prototype.setParam=function(t){var e=this;(function(){if(e._initialParamValue=t.getValue(),e._initialParamValue.clone&&(e._initialParamValue=e._initialParamValue.clone()),null==e._initialParamValue)throw new Error("WTF?")})(),this._param=t,this.emit("paramSet",{param:t})};return e}(_a);K.registerClass("XfoOperatorOutput",Za);var Ga=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__stageParam=a._addMember(new ft("Stage",0)),a.__axisParam=a._addMember(new _t("Axis",new m(1,0,0))),a.__movementParam=a._addMember(new gt("MovementTiming",new h(0,1),[new h(0,0),new h(1,1)])),a.__multiplierParam=a._addMember(new ft("Multiplier",1)),a.__output=new Za("Part");return a}e.prototype.getStage=function(t){if(t===void 0){t=z.USER_GETVALUE}return this.__stageParam.getValue(t)};e.prototype.setStage=function(t,e){if(e===void 0){e=z.USER_SETVALUE}this.__stageParam.setValue(t,e)};e.prototype.getOutput=function(){return this.__output};e.prototype.evaluate=function(t,e,a,i,n,r,o,l){if(!this.__output.isConnected())return;var s=this.__stageParam.getValue(),d=this.__movementParam.getValue();var c;if(n){var u=s/i;r&&(u-=.5),c=e*Math.linStep(d.x,d.y,Math.max(0,t-u))}else{var h=1-s/i;r&&(h-=.5),c=e*Math.linStep(d.x,d.y,t)*h}c+=a;var m=this.__axisParam.getValue();var p=this.__multiplierParam.getValue(),f=this.__output.getInitialValue();var b;o?(b=l.multiply(f),m=o.ori.rotateVec3(m),b.tr.addInPlace(m.scale(c*p))):(b=this.__output.getValue(),b.tr=f.tr.add(m.scale(c*p))),this.__output.setClean(b)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return i&&(i.output=this.__output.toJSON(e,a)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.output&&this.__output.fromJSON(e.output,a)};return e}(Lt);var Xa=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__stagesParam=a.addParameter(new ft("Stages",0)),a._explodeParam=a.addParameter(new ft("Explode",0,[0,1])),a._distParam=a.addParameter(new ft("Dist",1)),a._offsetParam=a.addParameter(new ft("Offset",0)),a._cascadeParam=a.addParameter(new yt("Cascade",!1)),a._centeredParam=a.addParameter(new yt("Centered",!1)),a.__parentItemParam=a.addParameter(new Tt("RelativeTo")),a.__parentItemParam.addListener("valueChanged",(function(){var t=a.__parentItemParam.getValue();a.__invParentSpace=t?t.getGlobalXfo().inverse():void 0})),a.__parentItemParam.addListener("treeItemGlobalXfoChanged",(function(){a.setDirty()})),a.__itemsParam=a.addParameter(new Wt("Parts",Ga)),a.__itemsParam.addListener("elementAdded",(function(t){if(t.index>0){var e=a.__itemsParam.getElement(t.index-1).getStage();t.elem.setStage(e+1),a.__stagesParam.setClean(e+2)}else a.__stagesParam.setClean(1);a.addOutput(t.elem.getOutput()),a.setDirty()})),a.__itemsParam.addListener("elementRemoved",(function(t){a.removeOutput(t.elem.getOutput())})),a.__localXfos=[],a.__parts=[],a.__stages=2;return a}e.prototype.evaluate=function(){var t=this.__stagesParam.getValue(),e=this._explodeParam.getValue(),a=this._distParam.getValue(),i=this._offsetParam.getValue(),n=this._cascadeParam.getValue(),r=this._centeredParam.getValue(),o=this.__parentItemParam.getValue();var l,s;o&&(l=o.getGlobalXfo(),s=this.__invParentSpace.multiply(l));var d=this.__itemsParam.getValue();for(var c=0;c<d.length;c++){d[c].evaluate(e,a,i,t,n,r,l,s)}};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i)};e.prototype.destroy=function(){clearTimeout(this.__timeoutId),t.prototype.destroy.call(this)};return e}(ga);K.registerClass("ExplodePartsOperator",Xa);var va=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__ratioParam=a._addMember(new ft("Ratio",1)),a.__offsetParam=a._addMember(new ft("Offset",0)),a.__axisParam=a._addMember(new _t("Axis",new m(1,0,0))),a.__output=new Za("Gear");return a}e.prototype.getOutput=function(){return this.__output};e.prototype.getRatio=function(){return this.__ratioParam.getValue()};e.prototype.getOffset=function(){return this.__offsetParam.getValue()};e.prototype.getAxis=function(){return this.__axisParam.getValue()};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return i&&(i.output=this.__output.toJSON(e,a)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.output&&this.__output.fromJSON(e.output,a)};return e}(Lt);var Va=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__revolutionsParam=a.addParameter(new ft("Revolutions",0));var i=a.addParameter(new ft("RPM",0));i.addListener("valueChanged",(function(){var t=i.getValue();if(Math.abs(t)>0){if(!a.__timeoutId){var e=function(){var t=i.getValue(),n=a.__revolutionsParam.getValue();a.__revolutionsParam.setValue(n+t*(1/3e3)),a.__timeoutId=setTimeout(e,20)};e()}}else clearTimeout(a.__timeoutId),a.__timeoutId=void 0})),a.__gearsParam=a.addParameter(new Wt("Gears",va)),a.__gearsParam.addListener("elementAdded",(function(t){a.addOutput(t.elem.getOutput())})),a.__gearsParam.addListener("elementRemoved",(function(t){a.removeOutput(t.index)})),a.__gears=[];return a}e.prototype.evaluate=function(){var t=this.__revolutionsParam.getValue(),e=this.__gearsParam.getValue();for(var a=0,i=e;a<i.length;a++){var n=i[a];var r=n.getOutput(),o=r.getInitialValue();if(!o)return;var l=t*n.getRatio()+n.getOffset(),s=new G;s.setFromAxisAndAngle(n.getAxis(),l*Math.PI*2);var d=r.getValue();d.ori=s.multiply(o.ori),r.setClean(d)}};e.prototype.detach=function(){t.prototype.detach.call(this),this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=null)};e.prototype.reattach=function(){t.prototype.reattach.call(this),this.getParameter("RPM").emit("valueChanged",{mode:k.ValueSetMode.USER_SETVALUE})};e.prototype.destroy=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=null),t.prototype.destroy.call(this)};return e}(ga);K.registerClass("GearsOperator",Va);var Ia=function(t){__extends(e,t);function e(){var e=this;e=t.call(this,"Piston")||this,e.__pistonAngleParam=e._addMember(new ft("PistonAngle",0)),e.__camPhaseParam=e._addMember(new ft("CamPhase",0)),e.__camLengthParam=e._addMember(new ft("CamLength",3)),e.__rodLengthParam=e._addMember(new ft("RodLength",3)),e.__rodoutput=new Za("Rod"),e.__capoutput=new Za("Cap"),e.__pistonAngleParam.addListener("valueChanged",e.init.bind(e)),e.__camPhaseParam.addListener("valueChanged",e.init.bind(e)),e.__camLengthParam.addListener("valueChanged",e.init.bind(e)),e.__rodLengthParam.addListener("valueChanged",e.init.bind(e)),e.__bindXfos={};return e}e.prototype.getRodOutput=function(){return this.__rodoutput};e.prototype.getCapOutput=function(){return this.__capoutput};e.prototype.setCrankXfo=function(t){this.__baseCrankXfo=t,this.init()};e.prototype.init=function(){if(!this.__baseCrankXfo)return;var t=this.__camPhaseParam.getValue(),e=this.__camLengthParam.getValue(),a=this.__rodLengthParam.getValue(),i=this.__pistonAngleParam.getValue(),n=new m(Math.sin(Math.degToRad(i)),Math.cos(Math.degToRad(i)),0);this.__pistonAxis=this.__baseCrankXfo.ori.rotateVec3(n),this.__camVec=this.__baseCrankXfo.ori.rotateVec3(new m(Math.sin(2*t*Math.PI)*e,Math.cos(2*t*Math.PI)*e,0));var r=2*t*Math.PI,o=Math.sin(r)*e,l=Math.sqrt(a*a-o*o)+Math.cos(r)*e;this.__pistonOffset=l};e.prototype.evaluate=function(t,e,a){var i=this.__camPhaseParam.getValue(),n=this.__camLengthParam.getValue(),r=this.__rodLengthParam.getValue(),o=2*(i+a)*Math.PI,l=Math.sin(o)*n,s=Math.asin(l/r),d=Math.sqrt(r*r-l*l)+Math.cos(o)*n;if(this.__rodoutput.isConnected()){var c=this.__rodoutput.getInitialValue().clone(),u=this.__rodoutput.getValue(),h=u.tr.subtract(this.__baseCrankXfo.tr).dot(e),m=new G;m.setFromAxisAndAngle(e,-s),u.tr=this.__baseCrankXfo.tr.add(t.rotateVec3(this.__camVec)),u.tr.addInPlace(e.scale(h)),u.ori=m.multiply(c.ori),this.__rodoutput.setValue(u)}if(this.__capoutput.isConnected()){var p=this.__capoutput.getInitialValue().clone(),f=this.__capoutput.getValue();f.tr=p.tr.add(this.__pistonAxis.scale(d-this.__pistonOffset)),this.__capoutput.setValue(f)}};e.prototype.setOwner=function(t){this.__owner=t};e.prototype.getOwner=function(){return this.__owner};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(Lt);var Ra=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__revolutionsParam=a.addParameter(new ft("Revolutions",0,[0,1]));var i=a.addParameter(new ft("RPM",0));i.addListener("valueChanged",(function(){var t=i.getValue();if(t>0){if(!a.__timeoutId){var e=function(){t=i.getValue();var n=a.__revolutionsParam.getValue();a.__revolutionsParam.setValue(n+t*(1/3e3)),a.__timeoutId=setTimeout(e,20)};e()}}else clearTimeout(a.__timeoutId),a.__timeoutId=void 0})),a.__crankOutput=a.addOutput(new Za("Crank")),a.__crankOutput.addListener("paramSet",a.init.bind(a)),a.__crankAxisParam=a.addParameter(new _t("CrankAxis",new m(1,0,0))),a.__crankAxisParam.addListener("valueChanged",(function(){a.__baseCrankXfo.ori.setFromDirectionAndUpvector(a.__crankAxisParam.getValue(),new m(0,0,1)),a.init()})),a.__pistonsParam=a.addParameter(new Wt("Pistons",Ia)),a.__pistonsParam.addListener("elementAdded",(function(t){t.elem.setCrankXfo(a.__baseCrankXfo),a.addOutput(t.elem.getRodOutput()),a.addOutput(t.elem.getCapOutput())})),a.__pistonsParam.addListener("elementRemoved",(function(t){a.removeOutput(t.elem.getRodOutput()),a.removeOutput(t.elem.getCapOutput())})),a.__baseCrankXfo=new v,a.__pistons=[];return a}e.prototype.setOwner=function(e){t.prototype.setOwner.call(this,e)};e.prototype.getCrankOutput=function(){return this.__crankOutput};e.prototype.init=function(){var t=this.__pistonsParam.getValue();for(var e=0,a=t;e<a.length;e++){var i=a[e];i.setCrankXfo(this.__baseCrankXfo)}this.__crankOutput.isConnected()&&(this.__crankOffset=this.__baseCrankXfo.inverse().multiply(this.__crankOutput.getInitialValue()))};e.prototype.evaluate=function(){var t=this.__revolutionsParam.getValue(w.OPERATOR_GETVALUE),e=this.__crankAxisParam.getValue(w.OPERATOR_GETVALUE),a=new G;if(a.setFromAxisAndAngle(e,t*Math.PI*2),this.__crankOutput.isConnected()){var i=this.__crankOutput.getValue();i.ori=a.multiply(this.__crankOutput.getInitialValue().ori),this.__crankOutput.setValue(i)}var n=this.__pistonsParam.getValue(),r=n.length;for(var o=0;o<r;o++){n[o].evaluate(a,e,t)}this.emit("postEval",{})};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.crankOutput&&this.__crankOutput.fromJSON(e.crankOutput,a),this.init()};e.prototype.destroy=function(){clearTimeout(this.__timeoutId),t.prototype.destroy.call(this)};return e}(ga);K.registerClass("PistonOperator",Ra);var xa=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__inputParam=a.addParameter(new ft("Input")),a.__multipliersParam=a.addParameter(new Wt("Multipliers",ft)),a.__multipliersParam.on("elementAdded",(function(t){t.elem.setValue(1),a.addOutput(new _a("Output"))})),a.__multipliersParam.on("elementRemoved",(function(t){a.removeOutput(a.getOutputByIndex(t.index))}));return a}e.prototype.addRoute=function(){var t=this.__multipliersParam.getCount();return this.__multipliersParam.addElement(new ft("Mult"+t)),this.getOutputByIndex(t)};e.prototype.evaluate=function(){var t=this.__inputParam.getValue(w.OPERATOR_GETVALUE),e=this.__multipliersParam.getValue();var a=this.__outputs.length;for(;a--;){var i=this.__outputs[a],n=e[a].getValue(w.OPERATOR_GETVALUE);i.setValue(t*n)}this.emit("postEval",{})};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i)};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(ga);K.registerClass("RouterOperator",xa);var Sa=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.addParameter(new ft("Weight",1)),a.addParameter(new bt("Axis",0,["+X Axis","-X Axis","+Y Axis","-Y Axis","+Z Axis","-Z Axis"])),a.addParameter(new ft("Stretch",0)),a.addParameter(new ft("Initial Dist",1)),a.addParameter(new Vt("Target")),a.addOutput(new Za("InputOutput"));return a}e.prototype.resetStretchRefDist=function(){var t=this.getParameter("Target").getValue(),e=this.getOutputByIndex(0).getValue(),a=t.tr.subtract(e.tr).length();this.getParameter("Initial Dist").setValue(a)};e.prototype.evaluate=function(){var t=this.getParameter("Weight").getValue(),e=this.getParameter("Target").getValue(),a=this.getParameter("Axis").getValue(),i=this.getOutputByIndex(0),n=i.getValue(),r=e.tr.subtract(n.tr),o=r.length();if(o<1e-6)return;var l;switch(r.scaleInPlace(1/o),a){case 0:l=n.ori.getXaxis();break;case 1:l=n.ori.getXaxis().negate();break;case 2:l=n.ori.getYaxis();break;case 3:l=n.ori.getYaxis().negate();break;case 4:l=n.ori.getZaxis();break;case 5:l=n.ori.getZaxis().negate()}var s=new G;s.setFrom2Vectors(l,r),s.alignWith(new G),t<1&&(s=(new G).lerp(s,t)),n.ori=s.multiply(n.ori);var d=this.getParameter("Stretch").getValue();if(d>0){var c=1+(o/this.getParameter("Initial Dist").getValue()-1)*d;switch(a){case 0:case 1:n.sc.x=c;break;case 2:case 3:n.sc.y=c;break;case 4:case 5:n.sc.z=c}}i.setClean(n)};return e}(ga);K.registerClass("AimOperator",Sa);var Wa=function(t){__extends(e,t);function e(e){var a=this;null==e&&(e="Camera"),a=t.call(this,e)||this,a.__defaultManipulationState="orbit",a.__manipulationState=a.__defaultManipulationState,a.__mouseDown=!1,a.__dragging=!1,a.__mouseDragDelta=new h,a.__keyboardMovement=!1,a.__keysPressed=[],a.__maxVel=.002,a.__velocity=new m,a.__ongoingTouches={},a.__orbitRateParam=a.addParameter(new ft("orbitRate",n.isMobileDevice?-.3:1)),a.__dollySpeedParam=a.addParameter(new ft("dollySpeed",.02)),a.__mouseWheelDollySpeedParam=a.addParameter(new ft("mouseWheelDollySpeed",5e-4));return a}e.prototype.setDefaultManipulationMode=function(t){this.__defaultManipulationState=t};e.prototype.look=function(t,e){var a=t.viewport,i=a.getCamera(),n=i.getFocalDistance(),r=this.__orbitRateParam.getValue();if(this.__keyboardMovement){var o=i.getGlobalXfo();this.__mouseDownCameraXfo=o.clone(),this.__mouseDownZaxis=o.ori.getZaxis();var l=this.__mouseDownZaxis.scale(-n);this.__mouseDownCameraTarget=o.tr.add(l)}var s=this.__mouseDownCameraXfo.clone(),d=new G;d.rotateZ(e.x/a.getWidth()*Math.PI*r),s.ori=d.multiply(s.ori);var c=new G;c.rotateX(e.y/a.getHeight()*Math.PI*r),s.ori.multiplyInPlace(c),i.setGlobalXfo(s)};e.prototype.orbit=function(t,e){var a=t.viewport,i=a.getCamera(),n=i.getFocalDistance(),r=this.__orbitRateParam.getValue();if(this.__keyboardMovement){var o=i.getGlobalXfo();this.__mouseDownCameraXfo=o.clone(),this.__mouseDownZaxis=o.ori.getZaxis();var l=this.__mouseDownZaxis.scale(-n);this.__mouseDownCameraTarget=o.tr.add(l)}var s=this.__mouseDownCameraXfo.clone(),d=new G;d.rotateZ(e.x/a.getWidth()*2*Math.PI*-r),s.ori=d.multiply(s.ori);var c=new G;c.rotateX(e.y/a.getHeight()*Math.PI*-r),s.ori.multiplyInPlace(c),s.tr=this.__mouseDownCameraTarget.add(s.ori.getZaxis().scale(n)),i.setGlobalXfo(s)};e.prototype.pan=function(t,e){var a=t.viewport,i=a.getCamera(),n=i.getFocalDistance(),r=i.getFov(),o=new m(1,0,0),l=new m(0,1,0),s=2*n*Math.tan(.5*r),d=s*(a.getWidth()/a.getHeight()),c=new v;c.tr=o.scale(-e.x/a.getWidth()*d),c.tr.addInPlace(l.scale(e.y/a.getHeight()*s)),i.setGlobalXfo(this.__mouseDownCameraXfo.multiply(c))};e.prototype.dolly=function(t,e){var a=t.viewport,i=a.getCamera(),n=e.x*this.__dollySpeedParam.getValue(),r=new v;r.tr.set(0,0,n),i.setGlobalXfo(this.__mouseDownCameraXfo.multiply(r))};e.prototype.panAndZoom=function(t,e,a){var i=t.viewport,n=i.getCamera(),r=n.getFocalDistance(),o=n.getFov(),l=new m(1,0,0),s=new m(0,1,0),d=2*r*Math.tan(.5*o),c=d*(i.getWidth()/i.getHeight()),u=new v;u.tr=l.scale(-e.x/i.getWidth()*c),u.tr.addInPlace(s.scale(e.y/i.getHeight()*d));var h=a*r;n.setFocalDistance(this.__mouseDownFocalDist+h),u.tr.z+=h,n.setGlobalXfo(this.__mouseDownCameraXfo.multiply(u))};e.prototype.initDrag=function(t){var e=t.viewport,a=e.getCamera(),i=a.getFocalDistance();this.__mouseDown=!0,this.__calculatingDragAction=!1,this.__mouseDownPos=t.mousePos,this.__mouseDownViewport=e,this.__mouseDragDelta.set(0,0),this.__mouseDownCameraXfo=a.getGlobalXfo().clone(),this.__mouseDownZaxis=this.__mouseDownCameraXfo.ori.getZaxis();var n=this.__mouseDownZaxis.scale(-i);this.__mouseDownCameraTarget=a.getGlobalXfo().tr.add(n),this.__mouseDownFocalDist=i,this.__dragListenerId=a.getParameter("GlobalXfo").on("valueChanged",this.__globalXfoChangedDuringDrag.bind(this))};e.prototype.__globalXfoChangedDuringDrag=function(t){if(!this.__calculatingDragAction){if(null!=this.__dragListenerId){this.__mouseDownViewport.getCamera().getParameter("GlobalXfo").removeListenerById("valueChanged",this.__dragListenerId),this.__dragListenerId=null}this.initDrag({viewport:this.__mouseDownViewport,mousePos:this.__mouseDownPos})}};e.prototype.endDrag=function(t){if(null!=this.__dragListenerId){var e=t.viewport;e.getCamera().getParameter("GlobalXfo").removeListenerById("valueChanged",this.__dragListenerId),this.__dragListenerId=null}this.__mouseDown=!1,this.__dragging=!1};e.prototype.aimFocus=function(t,e){var a=this;var i=t.viewport,n=i.getCamera();this.__focusIntervalId&&clearInterval(this.__focusIntervalId);var r=0;var o=function(){var t=n.getGlobalXfo(),i=n.getFocalDistance(),l=e.subtract(t.tr),s=l.normalizeInPlace(),d=new G,c=new G;{var u=t.ori.getZaxis().clone();u.z=0;var h=l.negate();h.z=0,d.setFrom2Vectors(u,h)}{var m=t.ori.getZaxis().clone(),p=l.negate();m.x=p.x,m.y=p.y,m.normalizeInPlace(),m.cross(p).dot(t.ori.getXaxis())>0?c.rotateX(m.angleTo(p)):c.rotateX(-m.angleTo(p))}var f=t.clone();f.ori=d.multiply(f.ori),f.ori.multiplyInPlace(c);var b=Math.pow(r/20,2),y=t.clone();y.ori=t.ori.lerp(f.ori,b),n.setFocalDistance(i+(s-i)*b),n.setGlobalXfo(y),r++,r<=20?a.__focusIntervalId=setTimeout(o,20):(a.__focusIntervalId=void 0,a.emit("movementFinished",{}),n.emit("movementFinished",{}))};o(),this.__manipulationState="focussing"};e.prototype.onMouseMove=function(t){};e.prototype.onDoubleClick=function(t){if(t.intersectionData){var e=t.viewport.getCamera().getGlobalXfo().tr.add(t.mouseRay.dir.scale(t.intersectionData.dist));this.aimFocus(t,e)}};e.prototype.onMouseDown=function(t){this.initDrag(t),2==t.button?this.__manipulationState="pan":t.ctrlKey&&t.altKey?this.__manipulationState="dolly":t.ctrlKey||2==t.button?this.__manipulationState="look":this.__manipulationState=this.__defaultManipulationState,t.stopPropagation(),t.preventDefault()};e.prototype.onMouseMove=function(t){if(!this.__mouseDown)return;var e=t.mousePos;switch(this.__calculatingDragAction=!0,this.__keyboardMovement?this.__mouseDragDelta=e:this.__mouseDragDelta=e.subtract(this.__mouseDownPos),this.__manipulationState){case"orbit":this.orbit(t,this.__mouseDragDelta);break;case"look":this.look(t,this.__mouseDragDelta);break;case"pan":this.pan(t,this.__mouseDragDelta);break;case"dolly":this.dolly(t,this.__mouseDragDelta)}this.__dragging=!0,this.__calculatingDragAction=!1,t.stopPropagation(),t.preventDefault()};e.prototype.onMouseUp=function(t){if(this.__dragging){this.emit("movementFinished",{});t.viewport.getCamera().emit("movementFinished",{}),this.__dragging=!1,t.stopPropagation()}this.endDrag(t)};e.prototype.onWheel=function(t){var e=this;var a=t.viewport,i=a.getCamera(),n=this.__mouseWheelDollySpeedParam.getValue(),r=t.shiftKey?.1:.5,o=i.getGlobalXfo(),l=o.ori.getZaxis();this.__mouseWheelZoomIntervalId&&clearInterval(this.__mouseWheelZoomIntervalId);var s=0;var d=function(){var a=i.getFocalDistance(),c=t.deltaY*n*a*r;o.tr.addInPlace(l.scale(c)),"orbit"==e.__defaultManipulationState&&i.setFocalDistance(i.getFocalDistance()+c),i.setGlobalXfo(o),s++,s<10?e.__mouseWheelZoomIntervalId=setTimeout(d,10):(e.__mouseWheelZoomIntervalId=void 0,e.emit("movementFinished",{}),i.emit("movementFinished",{}))};d(),t.preventDefault(),t.stopPropagation()};e.prototype.__integrateVelocityChange=function(t){var e=t.viewport,a=e.getCamera(),i=new v;i.tr=this.__velocity.normalize().scale(this.__maxVel),a.setGlobalXfo(a.getGlobalXfo().multiply(i))};e.prototype.onKeyPressed=function(t,e){return!1};e.prototype.onKeyDown=function(t,e){};e.prototype.onKeyUp=function(t,e){};e.prototype.__startTouch=function(t){this.__ongoingTouches[t.identifier]={identifier:t.identifier,pos:new h(t.pageX,t.pageY)}};e.prototype.__endTouch=function(t){delete this.__ongoingTouches[t.identifier]};e.prototype.onTouchStart=function(t){console.log("onTouchStart"),t.preventDefault(),t.stopPropagation(),0==Object.keys(this.__ongoingTouches).length&&(this.__manipMode=void 0);var e=t.changedTouches;for(var a=0;a<e.length;a++)this.__startTouch(e[a]);1==Object.keys(this.__ongoingTouches).length&&(this.initDrag(t),this.__dragging=!0)};e.prototype.onTouchMove=function(t){t.preventDefault(),t.stopPropagation(),this.__calculatingDragAction=!0;var e=t.touches;if(1==e.length&&"panAndZoom"!=this.__manipMode){var a=e[0],i=new h(a.pageX,a.pageY),n=this.__ongoingTouches[a.identifier].pos.subtract(i);"look"==this.__defaultManipulationState?(n.scaleInPlace(6),this.look(t,n)):this.orbit(t,n)}else if(2==e.length){var r=e[0],o=this.__ongoingTouches[r.identifier],n=e[1],l=this.__ongoingTouches[n.identifier],s=new h(r.pageX,r.pageY),d=new h(n.pageX,n.pageY),c=l.pos.subtract(o.pos).length()-d.subtract(s).length(),u=s.subtract(o.pos),m=d.subtract(l.pos),p=u.add(m);p.scaleInPlace(.5),this.panAndZoom(t,p,.002*c),this.__manipMode="panAndZoom"}this.__calculatingDragAction=!1};e.prototype.onTouchEnd=function(t){t.preventDefault(),t.stopPropagation();var e=t.changedTouches;for(var a=0;a<e.length;a++)this.__endTouch(e[a]);0==Object.keys(this.__ongoingTouches).length&&this.endDrag(t)};e.prototype.onTouchCancel=function(t){t.preventDefault();var e=t.touches;for(var a=0;a<e.length;a++)this.__endTouch(e[a]);0==Object.keys(this.__ongoingTouches).length&&this.endDrag(t)};e.prototype.onDoubleTap=function(t){if(t.intersectionData){var e=t.viewport,a=e.getCamera().getGlobalXfo().tr.add(t.touchRay.dir.scale(t.intersectionData.dist));this.aimFocus(t,a)}t.preventDefault()};return e}(D);var La=Object.freeze({__proto__:null,RefCounted:Y,ParameterOwner:D,ItemFlags:O,BaseItem:A,getFileFolder:q,loadTextfile:tt,loadJSONfile:et,loadXMLfile:it,loadBinfile:nt,sgFactory:K,isObject:dt,mergeDeep:ct,resourceLoader:ut,Version:ht,BinReader:mt,BinWriter:pt,ParamFlags:U,ValueGetMode:w,ValueSetMode:z,BaseParameter:H,Parameter:k,MultiChoiceParameter:bt,BooleanParameter:yt,NumberParameter:ft,Vec2Parameter:gt,Vec3Parameter:_t,Vec4Parameter:Zt,ColorParameter:Gt,Mat3Parameter:Xt,Mat4Parameter:vt,XfoParameter:Vt,ImageParameter:It,StringParameter:Rt,CodeParameter:xt,FilePathParameter:St,ListParameter:Wt,StructParameter:Lt,TreeItemParameter:Tt,ItemSetParameter:Mt,ProxyParameter:Ft,GeometryParameter:Ct,MaterialParameter:Ie,MaterialFloatParam:Yt,MaterialColorParam:Kt,Attribute:Re,BaseGeom:xe,SAVE_FLAG_SKIP_GEOMDATA:1024,VertexAttribute:Se,Points:We,Lines:Le,Mesh:Te,PointsProxy:Fe,LinesProxy:Ce,MeshProxy:Ne,PointGrid:Ye,Rect:Ke,Circle:we,Cross:ze,LinesCuboid:Ue,Grid:Je,Cone:Pe,Cuboid:Ee,Cylinder:He,Disc:ke,Plane:Be,Sphere:De,Torus:Oe,DataImage:Ut,FileImage:ne,FileImage2D:re,LDRImage:le,LDRVideo:se,GIFImage:de,EnvMap:_e,Label:Ge,VideoStreamImage2D:Xe,labelManager:Ze,SaveFlags:Qe,LoadFlags:Ae,CloneFlags:je,TreeItem:ta,InstanceItem:ea,AudioItem:aa,FileAudioItem:ia,BaseGeomItem:na,GeomItem:ra,AssetItem:ca,BillboardItem:ua,Camera:ha,Group:la,GeomLibrary:da,Material:zt,BaseImage:Nt,MaterialLibrary:ve,Scene:ba,VLAAsset:pa,ObjAsset:ya,Operator:ga,OperatorOutput:_a,XfoOperatorOutput:Za,ExplodePartsOperator:Xa,GearsOperator:Va,PistonOperator:Ra,RouterOperator:xa,AimOperator:Sa,CameraMouseAndKeyboard:Wa});var Ta=function(t,e){console.log(n);var a=null;if(null!=e.webglContextType)try{a=t.getContext(e.webglContextType,e),a.name=e.webglContextType}catch(t){}else{["webgl2","webgl"].some((function(i){try{a=t.getContext(i,e),a.name=i}catch(t){}if(a)return!0}))}if(a)return a.sizeInBytes=function(t){switch(t){case this.BYTE:case this.UNSIGNED_BYTE:return 1;case this.SHORT:case this.UNSIGNED_SHORT:return 2;case this.INT:case this.UNSIGNED_INT:case this.FLOAT:return 4;default:throw new Error("unknown type")}},"webgl2"==a.name?(a.floatTexturesSupported=!0,a.__ext_float_linear=a.getExtension("OES_texture_float_linear"),a.__ext_texture_half_float_linear=a.getExtension("OES_texture_half_float_linear"),a.__ext_color_buffer_float=a.getExtension("EXT_color_buffer_float")):(a.__ext_float=a.getExtension("OES_texture_float"),a.__ext_float?(a.floatTexturesSupported=!0,a.__ext_float_linear=a.getExtension("OES_texture_float_linear")):console.warn("OES_texture_float is not available"),a.__ext_half_float=a.getExtension("OES_texture_half_float"),a.__ext_half_float&&(a.HALF_FLOAT=a.__ext_half_float.HALF_FLOAT_OES,a.floatTexturesSupported=!0,a.__ext_texture_half_float_linear=a.getExtension("OES_texture_half_float_linear")),a.__ext_color_buffer_float=a.getExtension("EXT_color_buffer_float"),a.__ext_std_derivatives=a.getExtension("OES_standard_derivatives"),a.__ext_Inst=a.getExtension("ANGLE_instanced_arrays"),a.__ext_Inst&&(a.vertexAttribDivisor=a.__ext_Inst.vertexAttribDivisorANGLE.bind(a.__ext_Inst),a.drawArraysInstanced=a.__ext_Inst.drawArraysInstancedANGLE.bind(a.__ext_Inst),a.drawElementsInstanced=a.__ext_Inst.drawElementsInstancedANGLE.bind(a.__ext_Inst)),a.__ext_VAO=a.getExtension("OES_vertex_array_object"),a.__ext_VAO&&(a.createVertexArray=a.__ext_VAO.createVertexArrayOES.bind(a.__ext_VAO),a.deleteVertexArray=a.__ext_VAO.deleteVertexArrayOES.bind(a.__ext_VAO),a.bindVertexArray=a.__ext_VAO.bindVertexArrayOES.bind(a.__ext_VAO)),a.__ext_element_index_uint=a.getExtension("OES_element_index_uint"),a.__ext_WEBGL_depth_texture=a.getExtension("WEBGL_depth_texture"),a.__ext_WEBGL_depth_texture&&(a.UNSIGNED_INT_24_8=a.__ext_WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL),a.DRAW_FRAMEBUFFER=a.FRAMEBUFFER),a.__ext_frag_depth=a.getExtension("EXT_frag_depth"),a.setupInstancedQuad=function(){var t=new Float32Array([0,1,2,3]),e=new Uint16Array([0,1,2,2,1,3]);this.__quadVertexIdsBuffer=this.createBuffer(),this.bindBuffer(this.ARRAY_BUFFER,this.__quadVertexIdsBuffer),this.bufferData(this.ARRAY_BUFFER,t,this.STATIC_DRAW),this.__quadIndexBuffer=this.createBuffer(),this.bindBuffer(this.ELEMENT_ARRAY_BUFFER,this.__quadIndexBuffer),this.bufferData(this.ELEMENT_ARRAY_BUFFER,e,this.STATIC_DRAW),this.__quadattrbuffers={vertexIDs:{buffer:this.__quadVertexIdsBuffer,dataType:6,dimension:1,count:t.length,shared:!0}}},a.drawQuad=function(){this.drawElements(this.TRIANGLES,6,this.UNSIGNED_SHORT,0)},a.setupLineSegAttrBuffers=function(){var t=new Float32Array([0,1]),e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e),a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW),a.__linesegattrbuffers={vertexIDs:{buffer:e,dimension:1,count:t.length,shared:!0}}},a};var Ma=function(t){__extends(e,t);function e(e,a){var i=this;if(i=t.call(this)||this,i.__gl=e,i.ready=!1,i.width=0,i.height=0,i.textureType=1,i.textureDesc=[0,0,0,0],i.__loaded=!1,i.__bound=!1,null!=a)if(a instanceof Nt){i.__texture=a,i.__texture.setMetadata("gltexture",i);var n=function(){var t=i.__texture.getParams(),e=t.width,a=t.height,n=t.data;i.bufferData(n,e,a)};i.__texture.addListener("updated",n),i.__texture.isLoaded()?i.configure(i.__texture.getParams()):i.__texture.addListener("loaded",(function(){i.configure(i.__texture.getParams())}))}else i.configure(a);return i}e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getTexture=function(){return this.__texture};e.prototype.getInternalFormat=function(){return this.__internalFormat};e.prototype.getType=function(){return this.__typeParam};e.prototype.getTypeID=function(){return this.__type};e.prototype.getFormat=function(){return this.__formatParam};e.prototype.getFormatID=function(){return this.__format};e.prototype.getFilter=function(){return this.__filterParam};e.prototype.getWrap=function(){return this.__wrapParam};e.prototype.getMipMapped=function(){return this.__mipMapped};e.prototype.configure=function(t,e){if(e===void 0){e=!0}if(!("type"in t&&"format"in t&&"width"in t&&"height"in t))throw new Error("Invalid texture params");var a=this.__gl,i=t.width,n=t.height,r=t.data,o=a.getParameter(a.MAX_TEXTURE_SIZE);if(i<=0||i>o||n<=0||n>o)throw new Error("gl-texture2d: Invalid texture size. width:"+i+" height:"+n+" maxSize:"+o);var l=t.format,s=t.type;var d="minFilter"in t?t.minFilter:"filter"in t?t.filter:"LINEAR",c="magFilter"in t?t.magFilter:"filter"in t?t.filter:"LINEAR";var u="wrap"in t?t.wrap:"CLAMP_TO_EDGE";if("FLOAT"==s)if(this.textureType=3,"webgl2"==a.name)"LINEAR"!=d||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),c="NEAREST");else if(a.__ext_float)"LINEAR"!=d||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),c="NEAREST");else{if(!a.__ext_half_float)throw new Error("OES_texture_half_float is not available");s="HALF_FLOAT","LINEAR"!=d||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),c="NEAREST")}else if("HALF_FLOAT"==s)if("webgl2"==a.name);else{if(!a.supportUploadingHalfFloat&&null!=r)throw new Error("Safari does not support uploading HALF_FLOAT texture data.");if(!a.__ext_half_float)throw new Error("OES_texture_half_float is not available");if("LINEAR"!=d||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),c="NEAREST"),"RGB"==l)throw new Error("OES_texture_half_float onlysupports RGBA textures")}else if("sRGB"==s&&!a.__ext_sRGB)throw new Error("EXT_sRGB is not available");this.__formatParam=l,this.__typeParam=s,this.__minFilterParam=d,this.__magFilterParam=c,this.__wrapParam=u,this.__format=a[l],this.__internalFormat="internalFormat"in t?a[t.internalFormat]:this.__format,this.__type=a[s],"webgl2"==a.name&&("internalFormat"in t||(this.__type==a.FLOAT?this.__format==a.RED?this.__internalFormat=a.R32F:this.__format==a.RG?this.__internalFormat=a.RG32F:this.__format==a.RGB?this.__internalFormat=a.RGB32F:this.__format==a.RGBA&&(this.__internalFormat=a.RGBA32F):this.__type==a.HALF_FLOAT?this.__format==a.RED?this.__internalFormat=a.R16F:this.__format==a.RG?this.__internalFormat=a.RG16F:this.__format==a.RGB?this.__internalFormat=a.RGB16F:this.__format==a.RGBA&&(this.__internalFormat=a.RGBA16F):this.__type==a.UNSIGNED_BYTE&&(this.__format==a.RED&&(this.__internalFormat=a.R8),this.__format==a.RG&&(this.__internalFormat=a.RG8),this.__format==a.RGB?this.__internalFormat=a.RGB8:this.__format==a.RGBA&&(this.__internalFormat=a.RGBA8)))),this.__minFilter=a[d],this.__magFilter=a[c],this.__wrap=a[u],this.__flipY="flipY"in t&&t.flipY,this.__mipMapped="mipMapped"in t&&t.mipMapped,this.invert="invert"in t&&t.invert,this.alphaFromLuminance="alphaFromLuminance"in t&&t.alphaFromLuminance,this.textureDesc=[i,n,0,0],this.__gltex&&a.deleteTexture(this.__gltex),this.__gltex=a.createTexture(),this.__updateGLTexParams(),r?this.bufferData(r,i,n,!1,!1):this.resize(i,n,!1,!1),this.__loaded||(this.emit("ready",{}),this.__loaded=!0)};e.prototype.__updateGLTexParams=function(){var t=this.__gl;t.bindTexture(t.TEXTURE_2D,this.__gltex),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.__minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.__magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.__wrap),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.__wrap)};e.prototype.bufferData=function(t,e,a,i,n){if(e===void 0){e=-1}if(a===void 0){a=-1}if(i===void 0){i=!0}if(n===void 0){n=!0}var r=this.__gl;if(i&&r.bindTexture(r.TEXTURE_2D,this.__gltex),null!=t){if(t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,this.__format,this.__type,t),this.width=t.width,this.height=t.height;else{-1==e&&(e=this.width),-1==a&&(a=this.height);var o=e*a;var l;switch(this.__format){case r.RED:case r.RED_INTEGER:case r.ALPHA:case r.LUMINANCE:case r.LUMINANCE_ALPHA:l=1;break;case r.RG:l=2;break;case r.RGB:l=3;break;case r.RGBA:l=4}t.length!=o*l&&console.warn("Invalid data for Image width:"+e+" height:"+a+" format:"+this.__formatParam+" type:"+this.__typeParam+" Data Length:"+t.length+" Expected:"+o*l),this.__type==r.HALF_FLOAT&&t instanceof Float32Array&&(t=Math.convertFloat32ArrayToUInt16Array(t)),"webgl2"==r.name?r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,e,a,0,this.__format,this.__type,t,0):r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,e,a,0,this.__format,this.__type,t),this.width=e,this.height=a}this.__mipMapped&&r.generateMipmap(r.TEXTURE_2D)}else r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,null),this.width=e,this.height=a;n&&this.emit("updated",{})};e.prototype.clear=function(){var t=this.__gl,e=this.width*this.height;var a,i;switch(this.__format){case t.RED:case t.RED_INTEGER:case t.ALPHA:case t.LUMINANCE:case t.LUMINANCE_ALPHA:a=1;break;case t.RG:a=2;break;case t.RGB:a=3;break;case t.RGBA:a=4;break;default:throw new Error("Invalid Format")}switch(this.__type){case t.UNSIGNED_BYTE:i=new UInt8Array(e*a);break;case t.HALF_FLOAT:i=new UInt16Array(e*a);break;case t.FLOAT:i=new Float32Array(e*a);break;default:throw new Error("Invalid Type")}"webgl2"==t.name?t.texImage2D(t.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,i,0):t.texImage2D(t.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,i)};e.prototype.resize=function(t,e,a,i){if(a===void 0){a=!1}if(i===void 0){i=!0}var n=this.__gl;if(this.width!=t||this.height!=e){var r=n.getParameter(n.MAX_TEXTURE_SIZE);if(t<0||t>r||e<0||e>r)throw new Error("gl-texture2d: Invalid texture size. width:"+t+" height:"+e+" maxSize:"+r);if(a){var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,this.__internalFormat,t,e,0,this.__format,this.__type,null);var l=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,l),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.__gltex,0),n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,this.__internalFormat,0,0,this.width,this.height,0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteFramebuffer(l),this.__gl.deleteTexture(this.__gltex),this.__gltex=o,this.__updateGLTexParams()}else n.bindTexture(n.TEXTURE_2D,this.__gltex),n.texImage2D(n.TEXTURE_2D,0,this.__internalFormat,t,e,0,this.__format,this.__type,null);this.width=t,this.height=e,i&&this.emit("resized",{width:t,height:e})}};e.prototype.populate=function(t,e,a,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=!0}var o=this.__gl;r&&o.bindTexture(o.TEXTURE_2D,this.__gltex),o.texSubImage2D(o.TEXTURE_2D,0,i,n,e,a,this.__format,this.__type,t)};e.prototype.getSize=function(){return[this.width,this.height]};Object.defineProperty(e.prototype,"glTex",{get:function(){return this.__gltex},enumerable:true,configurable:true});e.prototype.getTexHdl=function(){return this.__gltex};e.prototype.bind=function(t,e){return console.warn("'bind' is deprecated. Please use 'bindToUniform'"),this.bindToUniform(t,e)};e.prototype.preBind=function(t,e){return{textureTypeUnif:e[t.name+"Type"],textureDescUnif:e[t.name+"Desc"]}};e.prototype.bindToUniform=function(t,e,a){if(!this.__loaded)return!1;if(!this.__gltex)throw new Error("Unable to bind non-initialized or deleted texture.");var i=t.boundTextures++,n=this.__gl.TEXTURE0+i,r=this.__gl;return r.activeTexture(n),r.bindTexture(r.TEXTURE_2D,this.__gltex),r.uniform1i(e.location,i),a&&(a.textureTypeUnif&&r.uniform1i(a.textureTypeUnif.location,this.textureType),a.textureDescUnif&&this.__gl.uniform4fv(a.textureDescUnif.location,this.textureDesc)),!0};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__texture&&this.__texture.setMetadata("gltexture",void 0),this.__gl.deleteTexture(this.__gltex),this.__gltex=void 0};return e}(Y);var Fa=function(){function t(t,e,a,i){this.__gl=t,this.__shaderAttrs=e,this.__glattrbuffers=a,this.__indexBuffer=i}t.prototype.bind=function(t){var e=this.__gl;for(var a in this.__shaderAttrs){if("instancedIds"==a)continue;var i=this.__shaderAttrs[a],n=i.location;if(-1==n)continue;var r=this.__glattrbuffers[a];if(!r){e.disableVertexAttribArray(n);continue}var o=void 0,l=void 0,s=void 0;switch(r.dataType){case 0:o=1,l=4,s=e.UNSIGNED_BYTE;break;case 1:o=1,l=4,s=e.BYTE;break;case 2:o=1,l=4,s=e.UNSIGNED_SHORT;break;case 3:o=1,l=4,s=e.SHORT;break;case 4:o=1,l=4,s=e.UNSIGNED_INT;break;case 5:o=1,l=4,s=e.INT;break;case 6:o=1,l=4,s=e.FLOAT;break;case h:o=2,l=4,s=e.FLOAT;break;case m:o=3,l=4,s=e.FLOAT;break;case p:case y:o=4,l=4,s=e.FLOAT;break;case f:o=4,l=1,s=e.UNSIGNED_BYTE;break;default:throw"Unhandled Type"}var d=o*l,c=null!=r.offset?r.offset*o*l:0,u=1==r.normalized,b=i.instanced;e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.vertexAttribPointer(n,o,s,u,d,c),e.vertexAttribDivisor&&(1==b?e.vertexAttribDivisor(n,1):e.vertexAttribDivisor(n,0))}return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),!0};t.prototype.unbind=function(){var t=this.__gl;for(var e in this.__shaderAttrs){var a=this.__shaderAttrs[e].location;-1!=a&&(t.disableVertexAttribArray(a),t.vertexAttribDivisor(a,0))}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)};t.prototype.destroy=function(){};return t}();var Ca=function(){function t(t,e,a,i){this.__gl=t,this.__vao=t.createVertexArray(),t.bindVertexArray(this.__vao);for(var n in e){if("instancedIds"==n)continue;var r=e[n],o=r.location;if(-1==o)continue;var l=a[n];if(!l){t.disableVertexAttribArray(o);continue}var s=void 0,d=void 0,c=void 0;switch(l.dataType){case 0:s=1,d=4,c=t.UNSIGNED_BYTE;break;case 1:s=1,d=4,c=t.BYTE;break;case 2:s=1,d=4,c=t.UNSIGNED_SHORT;break;case 3:s=1,d=4,c=t.SHORT;break;case 4:s=1,d=4,c=t.UNSIGNED_INT;break;case 5:s=1,d=4,c=t.INT;break;case 6:s=1,d=4,c=t.FLOAT;break;case h:s=2,d=4,c=t.FLOAT;break;case m:s=3,d=4,c=t.FLOAT;break;case p:case y:s=4,d=4,c=t.FLOAT;break;case f:s=4,d=1,c=t.UNSIGNED_BYTE;break;default:throw"Unhandled Type"}var u=s*d,b=null!=l.offset?l.offset*s*d:0,g=1==l.normalized,_=r.instanced;t.enableVertexAttribArray(o),t.bindBuffer(t.ARRAY_BUFFER,l.buffer),t.vertexAttribPointer(o,s,c,g,u,b),_?t.vertexAttribDivisor(o,1):t.vertexAttribDivisor(o,0)}this.__indexBuffer=i}t.prototype.bind=function(t){return this.__gl.bindVertexArray(this.__vao),this.__indexBuffer&&this.__gl.bindBuffer(this.__gl.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),!0};t.prototype.unbind=function(){var t=this.__gl;for(var e in this.__shaderAttrs){var a=this.__shaderAttrs[e].location;-1!=a&&(t.disableVertexAttribArray(a),t.vertexAttribDivisor(a,0))}this.__gl.bindVertexArray(null),this.__indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)};t.prototype.destroy=function(){this.__gl.deleteVertexArray(this.__vao)};return t}();function Na(t,e,a,i){return null==t.createVertexArray?new Fa(t,e,a,i):new Ca(t,e,a,i)}var Ya=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this)||this,i.__gl=e,i.__geom=a,i.__glattrs={},i.__glattrbuffers={},i.__shaderBindings={};i.__geom.addListener("geomDataChanged",(function(t){i.updateBuffers(t),i.emit("updated",{})}));i.__geom.addListener("geomDataTopologyChanged",(function(t){i.clearShaderBindings(),i.updateBuffers(t),i.emit("updated",{})}));return i}e.prototype.getGeom=function(){return this.__geom};e.prototype.genBuffers=function(){};e.prototype.updateBuffers=function(t){};e.prototype.bind=function(t){if(this.__destroyed)throw new Error("Error binding a destroyed geom");var e=this.__shaderBindings[t.shaderkey];if(!e){e=Na(this.__gl,t.attrs,this.__glattrbuffers,this.__indexBuffer),this.__shaderBindings[t.shaderkey]=e}return e.bind(t),!0};e.prototype.unbind=function(t){var e=this.__shaderBindings[t.shaderkey];e&&e.unbind(t)};e.prototype.draw=function(){throw new Error("Not implemented. Implement this method in a derived class.")};e.prototype.drawInstanced=function(t){throw new Error("Not implemented. Implement this method in a derived class.")};e.prototype.bindAndDraw=function(t){this.bind(t),this.draw(t)};e.prototype.clearShaderBindings=function(){for(var t in this.__shaderBindings){this.__shaderBindings[t].destroy()}this.__shaderBindings={}};e.prototype.destroy=function(){this.__geom.deleteMetadata("glgeom"),this.clearShaderBindings();var t=this.__gl;for(var e in this.__glattrbuffers){var a=this.__glattrbuffers[e];a.shared||t.deleteBuffer(a.buffer)}this.__glattrs={},this.__shaderBindings={},this.__destroyed=!0};return e}(Y);var Ka=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.genBuffers();return i}e.prototype.getNumTriangles=function(){return this.__numTriangles};e.prototype.genBuffers=function(){t.prototype.genBuffers.call(this);var e=this.__gl,a=this.__geom.genBuffers(),i=a.indices;this.__numTriIndices=a.indices.length,i instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),i instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),i instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT),this.__numTriangles=i.length/3,this.__numRenderVerts=a.numRenderVerts,this.__indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,a.indices,e.STATIC_DRAW);for(var n in a.attrBuffers){var r=a.attrBuffers[n],o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,r.values,e.STATIC_DRAW),this.__glattrbuffers[n]={buffer:o,dataType:r.dataType,normalized:r.normalized},"textureCoords"==n&&(this.__glattrbuffers.texCoords=this.__glattrbuffers.textureCoords)}};e.prototype.updateBuffers=function(t){var e=this.__gl,a=this.__geom.genBuffers({includeIndices:!1});for(var i in a.attrBuffers){var n=a.attrBuffers[i],r=this.__glattrbuffers[i];e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.bufferData(e.ARRAY_BUFFER,n.values,e.STATIC_DRAW)}};e.prototype.getNumUnSplitVerts=function(){return this.__geom.vertices.length};e.prototype.getNumSplitVerts=function(){return this.__numRenderVerts};e.prototype.generateWireframesVAO=function(){if(!this.__vao)return!1;this.__geom.edgeVerts||this.__geom.genTopologyInfo(),this.__wireframesVao&&this.__ext.deleteVertexArrayOES(this.__wireframesVao),this.__wireframesVao=this.__ext.createVertexArrayOES(),this.__ext.bindVertexArrayOES(this.__wireframesVao);var t=this.__gl,e=t.createBuffer(),a=Uint32Array.from(this.__geom.edgeVerts);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW);var i=this.__glattrbuffers.positions.buffer;t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(0,3,t.FLOAT,!1,12,0),this.__numWireIndices=a.length,this.__ext.bindVertexArrayOES(null)};e.prototype.bindWireframeVAO=function(t){return null!=this.__wireframesVao&&(this.__ext.bindVertexArrayOES(this.__wireframesVao),!0)};e.prototype.unbindWireframeVAO=function(){this.__ext.bindVertexArrayOES(null)};e.prototype.drawWireframe=function(){this.__wireframesVao&&this.__gl.drawElements(this.__gl.LINES,this.__numWireIndices,this.__gl.UNSIGNED_INT,0)};e.prototype.generateHardEdgesVAO=function(){if(!this.__vao)return!1;this.__geom.edgeVerts||this.__geom.generateHardEdgesFlags(),this.__hardEdgesVao&&this.__ext.deleteVertexArrayOES(this.__hardEdgesVao),this.__hardEdgesVao=this.__ext.createVertexArrayOES(),this.__ext.bindVertexArrayOES(this.__hardEdgesVao);var t=this.__gl,e=t.createBuffer(),a=Uint32Array.from(this.__geom.computeHardEdgesIndices());t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW);var i=this.__glattrbuffers.positions.buffer;t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(0,3,t.FLOAT,!1,12,0),this.__numEdgeIndices=a.length,this.__ext.bindVertexArrayOES(null)};e.prototype.bindHardEdgesVAO=function(t){return null!=this.__hardEdgesVao&&(this.__ext.bindVertexArrayOES(this.__hardEdgesVao),!0)};e.prototype.unbindHardEdgesVAO=function(){this.__ext.bindVertexArrayOES(null)};e.prototype.drawHardEdges=function(){this.__hardEdgesVao&&this.__gl.drawElements(this.__gl.LINES,this.__numEdgeIndices,this.__gl.UNSIGNED_INT,0)};e.prototype.drawPoints=function(){this.__gl.drawArrays(this.__gl.POINTS,0,this.__geom.numVertices())};e.prototype.draw=function(){this.__gl.drawElements(this.__gl.TRIANGLES,this.__numTriIndices,this.__indexDataType,0)};e.prototype.drawInstanced=function(t){this.__gl.drawElementsInstanced(this.__gl.TRIANGLES,this.__numTriIndices,this.__indexDataType,0,t)};e.prototype.destroy=function(){t.prototype.destroy.call(this);this.__gl.deleteBuffer(this.__indexBuffer),this.__indexBuffer=void 0};return e}(Ya);var wa=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.genBuffers();return i}e.prototype.genBuffers=function(){t.prototype.genBuffers.call(this);var e=this.__gl,a=this.__geom.genBuffers(),i=a.indices;if(this.fatLines=(this.__geom.lineThickness>0||a.attrBuffers.lineThickness)&&e.floatTexturesSupported,this.fatLines){e.__quadVertexIdsBuffer||e.setupInstancedQuad(),this.__glattrbuffers.vertexIDs=e.__quadattrbuffers.vertexIDs,this.__drawCount=i.length/2;var n=this.__geom.getVertexAttributes(),r=n.positions,o=n.lineThickness,l=4,s=new Float32Array(r.length*l);for(var d=0;d<r.length;d++){m.createFromFloat32Buffer(s.buffer,4*d).setFromOther(r.getValueRef(d)),s[4*d+3]=o?o.getFloat32Value(d):this.__geom.lineThickness}this.__positionsTexture=new Ma(e,{format:"RGBA",type:"FLOAT",width:r.length,height:1,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",data:s,mipMapped:!1});var c=new Float32Array(i.length);for(var u=0;u<i.length;u++){var h=void 0;h=u%2==0?u>0?i[u]==i[u-1]:i[u]==i[i.length-1]:u<i.length-1?i[u]==i[u+1]:i[u]==i[0],c[u]=(h?1:0)+2*i[u]}var p=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,p),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW),this.__glattrbuffers.segmentIndices={buffer:p,dimension:2}}else{this.__indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW);for(var f in a.attrBuffers){var b=a.attrBuffers[f],o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,b.values,e.STATIC_DRAW),this.__glattrbuffers[f]={buffer:o,dataType:b.dataType,normalized:b.normalized}}this.__numSegIndices=i.length,this.__numVertices=a.numVertices}i instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),i instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),i instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT)};e.prototype.updateBuffers=function(t){var e=this.__gl,a=this.__geom.genBuffers(),i=a.indices;if(this.fatLines){this.__drawCount=i.length/2;var n=this.__geom.getVertexAttributes(),r=n.positions,o=n.lineThickness,l=4,s=new Float32Array(r.length*l);for(var d=0;d<r.length;d++){m.createFromFloat32Buffer(s.buffer,4*d).setFromOther(r.getValueRef(d)),s[4*d+3]=o?o.getFloat32Value(d):this.__geom.lineThickness}this.__positionsTexture.bufferData(s,r.length,1);var c=new Float32Array(i.length);for(var u=0;u<i.length;u++){var h=void 0;h=u%2==0?u>0&&i[u]==i[u-1]:u<i.length-1&&i[u]==i[u+1],c[u]=(h?1:0)+2*i[u]}e.bindBuffer(e.ARRAY_BUFFER,this.__glattrbuffers.segmentIndices.buffer),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW)}else{this.__geom.getVertexAttributes();if(t&&t.indicesChanged){var p=this.__geom.getIndices();this.__numSegIndices!=p.length&&(e.deleteBuffer(this.__indexBuffer),this.__indexBuffer=e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,p,e.STATIC_DRAW),this.__numSegIndices=p.length}var o=a.numVertices!=this.__numVertices;for(var f in a.attrBuffers){var b=a.attrBuffers[f],l=this.__glattrbuffers[f];o&&(e.deleteBuffer(l.buffer),l.buffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,l.buffer),e.bufferData(e.ARRAY_BUFFER,b.values,e.STATIC_DRAW)}this.__numVertices=a.numVertices,this.__numSegIndices=i.length}i instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),i instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),i instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT)};e.prototype.bind=function(e){if(this.fatLines&&"LineThickness"in e.unifs){var a=this.__gl;var i=this.__shaderBindings[e.shaderkey];i||(i=Na(a,e.attrs,this.__glattrbuffers,a.__quadIndexBuffer),this.__shaderBindings[e.shaderkey]=i),i.bind(e);{var n=e.unifs;n.positionsTexture&&(this.__positionsTexture.bindToUniform(e,n.positionsTexture),a.uniform1i(n.positionsTextureSize.location,this.__positionsTexture.width))}var r=e.unifs;return a.uniform1f(r.LineThickness.location,(this.__geom.lineThickness?this.__geom.lineThickness:1)*e.viewScale),!0}return t.prototype.bind.call(this,e)};e.prototype.drawPoints=function(){this.__gl.drawArrays(this.__gl.POINTS,0,this.__geom.numVertices())};e.prototype.draw=function(t){var e=this.__gl;this.fatLines?t.unifs.LineThickness&&e.drawElementsInstanced(e.TRIANGLES,6,e.UNSIGNED_SHORT,0,this.__drawCount):e.drawElements(this.__gl.LINES,this.__numSegIndices,this.__indexDataType,0)};e.prototype.drawInstanced=function(t){this.__gl.drawElementsInstanced(this.__gl.LINES,this.__numSegIndices,this.__indexDataType,0,t)};return e}(Ya);var za=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.genBuffers();return i}e.prototype.genBuffers=function(){t.prototype.genBuffers.call(this);var e=this.__gl,a=this.__geom.genBuffers();for(var i in a.attrBuffers){var n=a.attrBuffers[i],r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,n.values,e.STATIC_DRAW),this.__glattrbuffers[i]={buffer:r,dataType:n.dataType,normalized:n.normalized}}this.__numVerts=a.numVertices,this.__vboState=2};e.prototype.bind=function(e){if(e.unifs.PointSize){var a=this.__gl;var i=this.__shaderBindings[e.shaderkey];if(!i){a.__quadVertexIdsBuffer||a.setupInstancedQuad();var n=Object.assign(this.__glattrbuffers,a.__quadattrbuffers);i=Na(a,e.attrs,n,a.__quadIndexBuffer),this.__shaderBindings[e.shaderkey]=i}return i.bind(e),!0}return t.prototype.bind.call(this,e)};e.prototype.draw=function(t){var e=this.__gl;t.unifs.PointSize?e.drawElementsInstanced(e.TRIANGLES,6,e.UNSIGNED_SHORT,0,this.__numVerts):e.drawArrays(e.POINTS,0,this.__numVerts)};e.prototype.drawInstanced=function(t){this.__gl.drawArraysInstanced(this.__gl.POINTS,0,this.__numVerts,t)};return e}(Ya);var Ua={bool:Boolean,int:5,uint:4,float:6,ivec2:h,ivec3:m,ivec4:p,vec2:h,vec3:m,vec4:p,color:y,mat3:_,mat4:Z,sampler2D:Nt};var Ja=new(function(){function t(){this.__shaderModules={}}t.prototype.hasShaderModule=function(t){return t in this.__shaderModules};t.prototype.setShaderModule=function(t,e){return this.parseShader(t,e)};t.prototype.getShaderModule=function(t){return this.__shaderModules[t]};t.prototype.getShaderModuleNames=function(){var t=[];for(var e in this.__shaderModules)t.push(e);return t};t.prototype.parseShader=function(t,e){var a=function(t){if(t.startsWith("..")){return i.substring(0,i.lastIndexOf("/"))+t.substring(2)}return t.startsWith(".")?i+t.substring(1):t.startsWith("/")?t.substring(1):t},i=(l(t),t.substring(0,t.lastIndexOf("/"))),n=e.split("\n"),r={glsl:" //starting:"+t+"\n",lines:n,numLines:0,includeMetaData:[],uniforms:{},attributes:{}},o=/\s+/;var s=function(e){var i=n[e],s=i.trim();if(s.startsWith("//")||s.startsWith("*"))r.glsl=r.glsl+i+"\n",r.numLines++;else if(-1!=s.indexOf("//")&&(s=s.slice(0,s.indexOf("//")).trim()),s.startsWith("<%")||s.startsWith("</%")){var u=function(t){var e=(t=(t=t.startsWith("</%")?t.slice(3):t.slice(2)).endsWith("/>")?t.slice(0,t.length-2):t.slice(0,t.length-1)).split(o),a={tag:e.shift(),attributes:{}};for(var i=0,n=e;i<n.length;i++){var r=n[i];var l=r.split("=");a.attributes[l[0]]=l[1].replace(/['"]+/g,"")}return a}(n[e].trim());switch(u.tag){case"include":{var h=a(u.attributes.file);if(!d.hasShaderModule(h))throw new Error("Error while parsing :"+t+" \nShader module not found:"+h+"\n in:"+d.getShaderModuleNames());var m=d.getShaderModule(h);l(u.attributes.file);var p=m.glsl;p=p.substring(p.indexOf("\n")+1),r.glsl=r.glsl+" //including:"+u.attributes.file+"\n";var f={};for(var b in u.attributes){if("file"==b)continue;var y=u.attributes[b];p=p.replaceAll(b,y),f[b]=y}r.glsl=r.glsl+p,r.includeMetaData.push({src:r.numLines,tgt:e,length:m.numLines,key:h}),r.glsl=r.glsl+" //continuing:"+t+"\n",r.numLines+=m.numLines+1;for(var g in m.attributes){var _=g;for(var Z in f)_=_.replaceAll(Z,f[Z]);r.attributes[_]=m.attributes[g]}for(var G in m.uniforms){var X=G;for(var v in f)X=X.replaceAll(v,f[v]);r.uniforms[X]=m.uniforms[G]}break}default:console.warn("Error while parsing :"+t+" \nUnhandled line:"+i);return c=e,"continue"}}else{var V=function(e,a){if(!(e[1]in Ua))throw new Error("Error while parsing :"+t+" \nType not recognized:"+e[1]);var n=e[2].slice(0,e[2].length-1);r.attributes[n]={type:Ua[e[1]],instanced:a},"color"==e[1]&&(e[1]="vec4",i=e.join(" "))};if(s.startsWith("struct")){var I="";if(-1!=s.indexOf("}"))I=s.substring(s.indexOf("{")+1,s.indexOf("}")-1);else for(e++;i+=n[e]+"\n",I+=i.trim(),e++,-1==I.indexOf("}"););var R=I.substring(I.indexOf("{")+1,I.indexOf("}")-1).split(";"),x=[];for(var S=0,W=R;S<W.length;S++){var L=W[S];if(0==L.length)continue;var T=L.trim().split(o);x.push({name:T[1],type:Ua[T[0]]})}var f=s.split(o);Ua[f[1]]=x}if(s.startsWith("attribute")){V(s.split(o),!1)}if(s.startsWith("instancedattribute")){var M=s.split(o);V(M,!0),M[0]="attribute",i=M.join(" ")}else if(s.startsWith("uniform")){var F=s.split(o);var C=1;4==F.length&&(C=2);var N=F[C];if(!(N in Ua))throw new Error("Error while parsing :"+t+" \nType not recognized:"+F[1]);var f=F[C+1].slice(0,F[C+1].length-1);r.uniforms[f]=Ua[N],"struct"==r.uniforms[f]&&console.log(F),"color"==F[1]&&(F[1]="vec4",i=F.join(" "))}r.glsl=r.glsl+i+"\n",r.numLines++}c=e};var d=this,c;for(var u=0;u<n.length;u++){s(u);u=c}return this.__shaderModules[t]=r,r};return t}());var Pa=0;var Ea=function(t){__extends(e,t);function e(e){var a=this;if(a=t.call(this)||this,!e)throw new Error("gl context must be passed to shader constructor");a.__gl=e,a.__shaderStages={VERTEX_SHADER:{glsl:"",lines:0,uniforms:{},attributes:{}},FRAGMENT_SHADER:{glsl:"",lines:0,uniforms:{},attributes:{}}},a.__shaderProgramHdls={},a.__gltextures={},a.__id=Pa++,a.invisibleToGeomBuffer=!1;return a}e.isTransparent=function(){return!1};e.isOverlay=function(){return!1};e.prototype.__compileShaderStage=function(t,e,a,i){var n=this.__gl;if(i||(i=n.shaderopts),i){if(i.repl)for(var r in i.repl)t=t.replaceAll(r,i.repl[r]);i.defines&&(t=i.defines+t)}"webgl2"==n.name&&(t=t.replaceAll("attribute","in"),t="#version 300 es\n"+(t=(t="vertexShader"==a?t.replaceAll("varying","out"):t.replaceAll("varying","in")).replaceAll("texture2D","texture")));var o=n.createShader(e);if(n.shaderSource(o,t),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS)){console.log("Errors in :"+this.constructor.name);var l=n.getShaderInfoLog(o).split("\n"),s={};for(var d in l){if(l[d].startsWith("'")){l[d-1]=l[d-1]+l[d],delete l[d],d--;continue}var c=l[d].split(":");if(c.length>=2){var u=parseInt(c[2]);isNaN(u)||(s[u]?s[u].push(l[d]):s[u]=[l[d]])}}var h=[],m=t.split("\n");for(var p=0;p<m.length;p++)if(h.push((p+1+":").lpad(" ",3)+m[p]),p+1 in s){var f=s[p+1];for(var b=0,y=f;b<y.length;b++){var g=y[b];h.push(g),h.push("-".lpad("-",g.length))}}throw new Error("An error occurred compiling the shader \n=================\n"+this.constructor.name+"."+a+": \n\n"+l.join("\n")+"\n"+h.join("\n"))}return o};e.prototype.__createProgram=function(t){var e=this.__gl;this.__shaderCompilationAttempted=!0;var a=e.createProgram(),i=this.__shaderStages.VERTEX_SHADER.glsl,n={};if(null!=i){var r=this.__compileShaderStage(i,e.VERTEX_SHADER,"vertexShader",t);if(!r)return!1;e.attachShader(a,r),n[e.VERTEX_SHADER]=r}var o=this.__shaderStages.FRAGMENT_SHADER.glsl;if(null!=o){var l=Object.assign({},e.shaderopts,t);l.frag&&(l.defines=l.frag.defines+l.defines);var s=this.__compileShaderStage(o,e.FRAGMENT_SHADER,"fragmentShader",l);if(!s)return!1;e.attachShader(a,s),n[e.FRAGMENT_SHADER]=s}if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var d=e.getProgramInfoLog(a);if(d.includes("D3D shader compilation failed")){var c=e.getExtension("WEBGL_debug_shaders");if(c){var u=c.getTranslatedShaderSource(n[e.VERTEX_SHADER]);console.log(u)}}throw console.log("vertexShaderGLSL:"+i),console.log("fragmentShaderGLSL:"+o),new Error("Unable to link the shader program:"+this.constructor.name+"\n==================\n"+d)}var h=this.__extractAttributeAndUniformLocations(a,t);return h.shaderProgramHdl=a,h};e.prototype.__extractAttributeAndUniformLocations=function(t,e){var a=this.__gl,i=this.getAttributes(),n={attrs:{},unifs:{}};for(var r in i){var o=a.getAttribLocation(t,r);if(null==o){console.warn("Shader attribute not found:"+r);continue}var l=i[r];n.attrs[r]={name:r,location:o,type:l.type,instanced:l.instanced}}var s=this.getUniforms();for(var d in s){var l=s[d];if(l instanceof Array)for(var c=0,u=l;c<u.length;c++){var h=u[c];var m=d+"."+h.name,p=a.getUniformLocation(t,m);null!=p&&(n.unifs[m]={name:m,location:p,type:h.type})}if(e&&e.repl)for(var f in e.repl)d=d.replace(f,e.repl[f]);var b=a.getUniformLocation(t,d);null!=b&&(n.unifs[d]={name:d,location:b,type:l})}return n};e.prototype.getAttributes=function(){var t={};for(var e in this.__shaderStages){var a=this.__shaderStages[e];for(var i in a.attributes)t[i]=a.attributes[i]}return t};e.prototype.getUniforms=function(){var t={};for(var e in this.__shaderStages){var a=this.__shaderStages[e];for(var i in a.uniforms)t[i]=a.uniforms[i]}return t};e.prototype.finalize=function(){};e.prototype.compileForTarget=function(t,e){var a=t?this.__id+t:this.__id;var i=this.__shaderProgramHdls[a];return i||!1!==i&&(i=this.__createProgram(e),i.shaderkey=a,this.__shaderProgramHdls[a]=i),i};e.prototype.compile=function(){this.compileForTarget()};e.prototype.bind=function(t,e){var a=this.__gl;if(t.glshader!=this){var i=this.compileForTarget(e,t.shaderopts);if(!1===i)return console.warn(this.constructor.name+" is not compiled for "+e),!1;var n=i.shaderProgramHdl;a.useProgram(n),t.glshader=this,t.shaderkey=i.shaderkey,t.unifs=i.unifs,t.attrs=i.attrs,t.boundTextures=0,t.boundLightmap=void 0,t.glgeom=void 0,t.bindRendererUnifs&&t.bindRendererUnifs(i.unifs)}return t.supportsInstancing=!0,!0};e.prototype.unbind=function(t){return!0};e.getParamDeclarations=function(){return[]};e.getGeomDataShaderName=function(){};e.getSelectedShaderName=function(){};e.prototype.destroy=function(){var t=this.__gl;for(var e in this.__shaderProgramHdls){var a=this.__shaderProgramHdls[e];t.deleteProgram(a.shaderProgramHdl)}this.__shaderProgramHdls={}};return e}(A);Ja.setShaderModule("utils/quadVertexFromID.glsl","\n\nattribute float vertexIDs;\n\nvec2 getQuadVertexPositionFromID(){\n    int vertexID = int(vertexIDs);\n    if(vertexID == 0)\n        return vec2(-0.5, -0.5);\n    else if(vertexID == 1)\n        return vec2(0.5, -0.5);\n    else if(vertexID == 2)\n        return vec2(-0.5, 0.5);\n    else if(vertexID == 3)\n        return vec2(0.5, 0.5);\n    return vec2(0,0);\n}\n"),Ja.setShaderModule("utils/unpackHDR.glsl","\n\nvec3 decodeHDR(const in vec3 ldrPixel, const in float cdmAlpha) {\n    float avg = (cdmAlpha * 16.0 - 8.0);\n    float scl = 1.0;\n    vec3 color;\n    color.x = (tan((ldrPixel.x-0.5)*1.5)/scl)+avg;\n    color.y = (tan((ldrPixel.y-0.5)*1.5)/scl)+avg;\n    color.z = (tan((ldrPixel.z-0.5)*1.5)/scl)+avg;\n\n    // convert from logarithmic curve to linear curve.\n    // subtract the epsilon that was added during encoding.\n    const float eps = 0.001;\n    color.x = pow(10.0, color.x) - eps;\n    color.y = pow(10.0, color.y) - eps;\n    color.z = pow(10.0, color.z) - eps;\n    return color;\n}\n\nvec3 decodeHDR(sampler2D ldrSampler, sampler2D cdmSampler, vec2 texCoord) {\n#ifdef ENABLE_ES3\n    float cdm = texture2D(cdmSampler, texCoord).r;\n#else\n    float cdm = texture2D(cdmSampler, texCoord).a;\n#endif\n    return decodeHDR(texture2D(ldrSampler, texCoord).rgb, cdm);\n}\n\n");var Ha=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("UnpackHDRShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("UnpackHDRShader.fragmentShader",'\nprecision highp float;\n\nvarying vec2 v_texCoord;\nuniform sampler2D ldrSampler;\nuniform sampler2D cdmSampler;\nuniform float exposure;\nuniform vec4 tint;\n\n<%include file="utils/unpackHDR.glsl"/>\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(decodeHDR(ldrSampler, cdmSampler, v_texCoord) * tint.rgb * exposure, 1.0);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n\n');return a}return e}(Ea);var ka=function(){function t(t,e,a){if(a===void 0){a=!1}!n.isIOSDevice||"FLOAT"!=e.getType()&&"HALF_FLOAT"!=e.getType()||console.error("IOS devices are unable to render to float textures."),this.__gl=t,this.__colorTexture=e,this.__createDepthTexture=a,this.__clearColor=[0,0,0,0],this.__depthTexture=void 0,this.setup=this.setup.bind(this),this.resize=this.resize.bind(this),this.__colorTexture&&this.__colorTexture.addListener("resized",this.resize),this.setup()}t.prototype.setClearColor=function(t){this.__clearColor=t};t.prototype.getWidth=function(){return this.__colorTexture.width};t.prototype.getHeight=function(){return this.__colorTexture.height};t.prototype.getSize=function(){return[this.__colorTexture.width,this.__colorTexture.height]};t.prototype.getColorTexture=function(){return this.__colorTexture};t.prototype.getDepthTextureGL=function(){return this.__depthTexture};Object.defineProperty(t.prototype,"width",{get:function(){return this.__colorTexture.width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this.__colorTexture.height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"size",{get:function(){return[this.__colorTexture.width,this.__colorTexture.height]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.__colorTexture},enumerable:true,configurable:true});t.prototype.setColorTexture=function(t){this.__colorTexture=t,gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.__colorTexture.glTex,0)};Object.defineProperty(t.prototype,"depthTextureGL",{get:function(){return this.__depthTexture},enumerable:true,configurable:true});t.prototype.setup=function(){var t=this.__gl;if(this.__fbo=t.createFramebuffer(),"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.__fbo):t.bindFramebuffer(t.FRAMEBUFFER,this.__fbo),this.__colorTexture&&("webgl2"==t.name?t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.__colorTexture.glTex,0):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.__colorTexture.glTex,0)),this.__createDepthTexture)if("webgl2"==t.name||t.__ext_WEBGL_depth_texture)t.activeTexture(t.TEXTURE0),this.__depthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.__depthTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),"webgl2"==t.name?(t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT24,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.__depthTexture,0)):(t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.__depthTexture,0));else{var e=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}this.__checkFramebuffer(),"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null)};t.prototype.resize=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.__fbo):t.bindFramebuffer(t.FRAMEBUFFER,this.__fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.__colorTexture.glTex,0),this.__depthTexture&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.__depthTexture),"webgl2"==t.name?t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT24,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null):t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null)),this.__checkFramebuffer()};t.prototype.__checkFramebuffer=function(){var t=this.__gl;var e;if(e="webgl2"==t.name?t.checkFramebufferStatus(t.DRAW_FRAMEBUFFER):t.checkFramebufferStatus(t.FRAMEBUFFER),e!==t.FRAMEBUFFER_COMPLETE)switch(t.bindTexture(t.TEXTURE_2D,null),"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null),console.warn("Error creating Fbo width:",this.width,", height:",this.height," Texture Type:",this.__colorTexture.getType()),e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");case 36061:throw new Error("The framebuffer is unsupported");default:throw new Error("Incomplete Frambuffer")}};t.prototype.bindForWriting=function(t){t&&(this.__prevBoundFbo=t.boundRendertarget,t.boundRendertarget=this.__fbo);var e=this.__gl;"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.__fbo):e.bindFramebuffer(e.FRAMEBUFFER,this.__fbo),e.viewport(0,0,this.width,this.height)};t.prototype.unbindForWriting=function(t){t&&(t.boundRendertarget=this.__prevBoundFbo);var e=this.__gl;"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.__prevBoundFbo):e.bindFramebuffer(e.FRAMEBUFFER,this.__prevBoundFbo)};t.prototype.bind=function(t){this.bindForWriting(t)};t.prototype.unbind=function(t){this.unbindForWriting(t)};t.prototype.bindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,this.__fbo):t.bindFramebuffer(t.FRAMEBUFFER,this.__fbo)};t.prototype.unbindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null)};t.prototype.clear=function(){var t=this.__gl;t.colorMask(!0,!0,!0,!0),t.clearColor.apply(t,this.__clearColor),this.__createDepthTexture?t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT)};t.prototype.bindAndClear=function(t){this.bind(t),this.clear(t)};t.prototype.unbind=function(){var t=this.__gl;t.bindFramebuffer(t.FRAMEBUFFER,null)};t.prototype.destroy=function(){var t=this.__gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(this.__fbo),this.__fbo=null,this.__colorTexture.removeListener("resized",this.resize)};return t}();var Ba=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__hdrImage=a,i.__hdrImage.setMetadata("gltexture",i);var n=function(){i.__unpackHDRImage(i.__hdrImage.getParams())};i.__hdrImage.addListener("updated",n),i.__hdrImage.isLoaded()?n():i.__hdrImage.addListener("loaded",n);return i}e.prototype.__unpackHDRImage=function(t){var e=this.__gl,a=t.data.ldr,i=t.data.cdm;if(this.__fbo)this.__srcLDRTex.bufferData(a),this.__srcCDMTex.bufferData(i);else{this.configure({format:"RGBA",type:"FLOAT",width:a.width,height:a.height,filter:"LINEAR",wrap:"CLAMP_TO_EDGE"}),this.__fbo=new ka(e,this),this.__fbo.setClearColor([0,0,0,0]),this.__srcLDRTex=new Ma(e,{format:"RGB",type:"UNSIGNED_BYTE",width:a.width,height:a.height,filter:"NEAREST",mipMapped:!1,wrap:"CLAMP_TO_EDGE",data:a}),this.__srcCDMTex=new Ma(e,{format:"webgl2"==e.name?"RED":"ALPHA",type:"UNSIGNED_BYTE",width:a.width,height:a.height,filter:"NEAREST",mipMapped:!1,wrap:"CLAMP_TO_EDGE",data:i}),this.__unpackHDRShader=new Ha(e);var n=this.__unpackHDRShader.compileForTarget("GLHDRImage");this.__shaderBinding=Na(e,n.attrs,e.__quadattrbuffers,e.__quadIndexBuffer)}this.__fbo.bindAndClear();var r={};this.__unpackHDRShader.bind(r,"GLHDRImage"),this.__shaderBinding.bind(r);var o=r.unifs;this.__srcLDRTex.bindToUniform(r,o.ldrSampler),this.__srcCDMTex.bindToUniform(r,o.cdmSampler),e.uniform1f(o.exposure.location,1),e.uniform4fv(o.tint.location,this.__hdrImage.getHDRTint().asArray()),e.drawQuad(),this.__fbo.unbind(),this.emit("updated",{})};e.prototype.bindToUniform=function(e,a,i){return t.prototype.bindToUniform.call(this,e,a,i)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__fbo&&(this.__fbo.destroy(),this.__srcLDRTex.destroy(),this.__srcCDMTex.destroy()),this.__unpackHDRShader&&this.__unpackHDRShader.destroy(),this.__shaderBinding&&this.__shaderBinding.destroy(),this.__hdrImage.loaded.disconnectScope(this),this.__hdrImage.updated.disconnectScope(this)};return e}(Ma);Ja.setShaderModule("GLSLUtils.glsl","\n\n\nint ftoi(float val){\n    return int(floor(val + 0.5));\n}\nivec2 ftoi(vec2 v2) {\n    return ivec2(ftoi(v2.x), ftoi(v2.y));\n}\nivec3 ftoi(vec3 v4) {\n    return ivec3(ftoi(v4.x), ftoi(v4.y), ftoi(v4.z));\n}\nivec4 ftoi(vec4 v4) {\n    return ivec4(ftoi(v4.x), ftoi(v4.y), ftoi(v4.z), ftoi(v4.w));\n}\n\n#ifdef ENABLE_ES3\n\nint imod(int x, int y) {\n    return x % y;\n}\n\nvoid setFlag(inout int flags, int flag) {\n    flags |= flag;\n}\n\nvoid clearFlag(inout int flags, int flag) {\n    flags &= ~flag;\n}\n\nbool testFlag(int flags, int flag) {\n    return (flags & flag) != 0;\n}\n\n// private function: Mangle me...\nivec2 _pixelIndexToUV(int index, int textureWidth){\n    return ivec2(index % textureWidth, index / textureWidth);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureWidth, int index) {\n    return texelFetch(texture, _pixelIndexToUV(index, textureWidth), 0);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n    return texelFetch(texture, texCoord, 0);\n}\n\n#else\n\n// TODO: integrate: https://gist.github.com/mattatz/70b96f8c57d4ba1ad2cd\n\nint max(int a, int b) {\n    return a > b ? a : b;\n}\nint min(int a, int b) {\n    return a < b ? a : b;\n}\n\n\nfloat round(float val){\n    return floor(val + 0.4);\n}\n\nint imod(int x, int y) {\n    return x-y*(x/y);\n}\n\nvoid setFlag(inout int flags, int flag) {\n    flags += flag;\n}\nvoid clearFlag(inout int flags, int flag) {\n    flags -= flag;\n}\n\nbool testFlag(int flags, int flag) {\n    return imod(flags / flag, 2) != 0;\n}\n\n// private function: Mangle me...\nvec2 _pixelIndexToUV(int index, int textureSize){\n    float flTexSize = float(textureSize);\n    float x = (float(imod(index, textureSize))+0.5)/flTexSize;\n    float y = (floor(float(index / textureSize))+0.5)/flTexSize;\n    return vec2(x, y);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureSize, int index) {\n    vec2 texCoord = _pixelIndexToUV(index, textureSize);\n    return texture2D(texture, texCoord);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n    vec2 ftextureSize = vec2(textureSize);\n    return texture2D(texture, (vec2(texCoord) + 0.5) / ftextureSize);\n}\n\n\n#endif // ENABLE_ES3\n\nint uvToPixelIndex(vec2 uv, int textureSize){\n    return int(uv.x * float(textureSize)) + (int(floor(uv.y * float(textureSize))) * textureSize);\n}\n\n\n\n"),Ja.setShaderModule("utils/ImageStream.glsl","\n\n// Stream Desc looks like the following\n// x : atlas Width in images\n// y : atlas height in images\n// z : image Width\n// w : image Height\n\nvec2 calcFrameImageTexCoords(vec2 texCoord, int index, in vec4 streamDesc){\n\tfloat index_x = floor(mod(float(index), streamDesc.x));\n\tfloat index_y = floor(float(index) / streamDesc.x);\n    return vec2( \n    \t(index_x + texCoord.x) / streamDesc.x, \n    \t(index_y + texCoord.y) / streamDesc.y\n    \t);\n}\n\nvec4 sampleStreamFrame(vec2 texCoord, int index, in sampler2D streamImage, in vec4 streamDesc){\n    return texture2D(streamImage, calcFrameImageTexCoords(texCoord, index, streamDesc));\n}\n\n");var Da=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this)||this,i.__gl=e,i.__streamImage=a,i.__descParam=i.__streamImage.getParameter("StreamAtlasDesc"),i.__indexParam=i.__streamImage.getParameter("StreamAtlasIndex"),i.__indexParam.addListener("valueChanged",(function(){i.emit("updated",{})}));var n=function(){var t=i.__streamImage.getParams();t.data.__atlasTexture||(t.data.__atlasTexture=new Ma(e,t)),i.__atlasTexture=t.data.__atlasTexture,i.__atlasTexture.textureType=2,i.__atlasTexture.textureDesc=i.__descParam.getValue().asArray()};i.__streamImage.isLoaded()?n():i.__indexParam.addListener("loaded",(function(){n()}));return i}e.prototype.preBind=function(t,e){var a=this.__atlasTexture.preBind(t,e);return a.textureDescUnif=e[t.name+"Desc"],a.textureIndexUnif=e[t.name+"Index"],a};e.prototype.bindToUniform=function(t,e,a){return!!this.__atlasTexture.bindToUniform(t,e,a)&&(a&&a.textureIndexUnif&&this.__gl.uniform1i(a.textureIndexUnif.location,this.__indexParam.getValue()),!0)};return e}(Y);var Oa=function(){function t(t,e,a,i){var n=this;switch(this.__unif=i,i.type){case Boolean:this.uniformXX=t.uniform1i.bind(t);break;case 4:"webgl2"==t.name?this.uniformXX=t.uniform1ui.bind(t):this.uniformXX=t.uniform1i.bind(t);break;case 5:this.uniformXX=t.uniform1i.bind(t);break;case 6:this.uniformXX=t.uniform1f.bind(t)}this.__val=a.getValue(),a.addListener("valueChanged",(function(){n.__val=a.getValue(),e.emit("updated",{})}))}t.prototype.bind=function(t){this.uniformXX(this.__unif.location,this.__val)};t.prototype.unbind=function(){};t.prototype.destroy=function(){};return t}();var Qa=function(){function t(t,e,a,i){var n=this;switch(this.__unif=i,i.type){case h:this.uniformXX=t.uniform2fv.bind(t);break;case m:this.uniformXX=t.uniform3fv.bind(t);break;case p:this.uniformXX=t.uniform4fv.bind(t)}this.__vals=a.getValue().asArray(),a.addListener("valueChanged",(function(){n.__vals=a.getValue().asArray(),e.emit("updated",{})}))}t.prototype.bind=function(t){this.uniformXX(this.__unif.location,this.__vals)};t.prototype.unbind=function(){};t.prototype.destroy=function(){};return t}();var Aa=function(){function t(t,e,a,i){var n=this;switch(this.__unif=i,i.type){case Mat3:this.uniformMatrixXXX=t.uniformMatrix3fv.bind(t);break;case Z:this.uniformMatrixXXX=t.uniformMatrix4fv.bind(t)}this.__vals=a.getValue().asArray(),a.addListener("valueChanged",(function(){n.__val=a.getValue().asArray(),e.emit("updated",{})}))}t.prototype.bind=function(t){this.uniformMatrixXXX(this.__unif.location,!1,this.__val)};t.prototype.unbind=function(){};t.prototype.destroy=function(){};return t}();var ja=function(){function t(t,e,a,i,n){var r=this;this.__gl=t,this.__unif=i,this.__textureUnif=n[i.name+"Tex"],this.__textureTypeUnif=n[i.name+"TexType"],this.__vals=[0,0,0,0],this.bind=this.bindValue;var o=function(t){var a=t.getMetadata("gltexture");a||(a="FLOAT"===t.type?new Ba(r.__gl,t):t.isStreamAtlas()?new Da(r.__gl,t):new Ma(r.__gl,t)),r.texBinding=a.preBind(r.__textureUnif,n),a.addListener("updated",(function(){e.emit("updated",{})})),r.gltexture=a,r.gltexture.addRef(r),r.textureType=1,r.bind=r.bindTexture,e.emit("updated",{})};var l,s;var d=function(){o(l)},c=function(t){t.isLoaded()?o(t):t.addListener("loaded",d),l=t},u=function(){l.getMetadata("gltexture").removeRef(r),r.texBinding=null,r.gltexture=null,r.textureType=null,r.bind=r.bindValue,s&&l.removeListenerById("loaded",s),l=null,s=null,e.emit("updated",{})},h=function(){var t=a.getValue(!1);if(r.__vals=t.asArray(),r.__textureUnif){var i;a.getImage&&(i=a.getImage()),i&&i!=l?c(i):!i&&l&&u()}e.emit("updated")};h(),a.textureConnected&&a.addListener("textureConnected",(function(){c(a.getImage())})),a.addListener("valueChanged",h),this.uniform1i=t.uniform1i.bind(t),this.uniform4fv=t.uniform4fv.bind(t)}t.prototype.bindValue=function(t){this.uniform4fv(this.__unif.location,this.__vals),this.__textureTypeUnif&&this.uniform1i(this.__textureTypeUnif.location,0)};t.prototype.bindTexture=function(t){this.gltexture.bindToUniform(t,this.__textureUnif,this.texBinding)};return t}();var qa={};var $a=function(){function t(t,e,a,i){var n=this;this.__uniformBindings=[];var r=function(r){var o=r.getName(),l=a[o];if(null!=l)switch(l.type){case Boolean:case 4:case 5:case 6:n.__uniformBindings.push(new Oa(t,e,r,l));break;case h:case m:case p:n.__uniformBindings.push(new Qa(t,e,r,l));break;case y:n.__uniformBindings.push(new ja(t,e,r,l,a));break;case Z:n.__uniformBindings.push(new Aa(t,e,r,l));break;default:return void console.warn("Param :"+o+" has unhandled data type:"+l.type)}else if(i){var s=e.getMaterial().getShaderName();qa[s]||(qa[s]={}),qa[s][o]||(console.warn("Material:"+e.getMaterial().getName(),"with Shader ",s,"Param has no unif",o),qa[s][o]=!0)}},o=e.getMaterial().getParameters();for(var l=0,s=o;l<s.length;l++){var d=s[l];r(d)}}t.prototype.bind=function(t){for(var e=0,a=this.__uniformBindings;e<a.length;e++){var i=a[e];i.bind(t)}return!0};t.prototype.unbind=function(){for(var t=0,e=this.__uniformBindings;t<e.length;t++){var a=e[t];a.unbind(renderstate)}};t.prototype.destroy=function(){for(var t=0,e=this.__uniformBindings;t<e.length;t++){var a=e[t];a.destroy(renderstate)}};return t}();var ti=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this)||this,n.__gl=e,n.__material=a,n.__glshader=i,n.__shaderBindings={};return n}e.prototype.getMaterial=function(){return this.__material};e.prototype.getGLShader=function(){return this.__glshader};e.prototype.generateShaderBinding=function(){var t=this.__material.getParameters();for(var e=0,a=t;e<a.length;e++){var i=a[e];bindParam(gl,i)}};e.prototype.bind=function(t,e){this.__boundTexturesBeforeMaterial=t.boundTextures;var a=this.__shaderBindings[t.shaderkey];if(!a){var i=this.__gl;a=new $a(i,this,t.unifs,e),this.__shaderBindings[t.shaderkey]=a}return a.bind(t)};e.prototype.unbind=function(t){t.boundTextures=this.__boundTexturesBeforeMaterial};return e}(L);var ei=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this)||this,i.__gl=e,i.textureTargets=[],i.depthTexture=null,a&&i.configure(a);return i}e.prototype.configure=function(t){var e=this.__gl,a=function(t,e){if(!e.width||!e.height)throw new Error("Invalid texture params");var a=t.getParameter(t.MAX_TEXTURE_SIZE);if(e.width<=0||e.width>a||e.height<=0||e.height>a)throw new Error("GLTextureParams: Invalid texture size. width:"+e.width+" height:"+e.height+" maxSize:"+a);var i={width:e.width,height:e.height},n=function(a,n){a in e?i[a]=isNaN(e[a])?t[e[a]]:e[a]:n&&(i[a]=n)};if(n("format"),n("internalFormat",i.format),n("type",t.UNSIGNED_BYTE),n("minFilter",t.LINEAR),n("magFilter",t.LINEAR),n("wrapS",t.CLAMP_TO_EDGE),n("wrapT",t.CLAMP_TO_EDGE),n("flipY",!1),n("mipMapped",!1),n("depthFormat"),n("depthType"),i.format==t.FLOAT)if("webgl2"==t.name)i.filter!=t.LINEAR||t.__ext_float_linear||(console.warn("Floating point texture filtering not supported on result device"),i.filter=t.NEAREST);else if(t.__ext_float)i.filter!=t.LINEAR||t.__ext_float_linear||(console.warn("Floating point texture filtering not supported on result device"),i.filter=t.NEAREST);else{if(!t.__ext_half_float)throw new Error("OES_texture_half_float is not available");i.format=t.HALF_FLOAT,i.filter!=t.LINEAR||t.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on result device"),i.filter=t.NEAREST)}else if(i.format==t.HALF_FLOAT)if("webgl2"==t.name);else{if(!t.__ext_half_float)throw new Error("OES_texture_half_float is not available");if(i.filter!=t.LINEAR||t.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on result device"),i.filter=t.NEAREST),i.channels==t.RGB)throw new Error("OES_texture_half_float onlysupports RGBA textures")}else if("sRGB"==i.format&&!t.__ext_sRGB)throw new Error("EXT_sRGB is not available");return null!=i.format&&"webgl2"==t.name&&i.internalFormat==i.format&&(i.type==t.FLOAT?i.format==t.RED||i.format==t.RED?i.internalFormat=t.R32F:i.format==t.RG?i.internalFormat=t.RG32F:i.format==t.RGBA&&(i.internalFormat=t.RGBA32F):i.type==t.HALF_FLOAT?i.format==t.RED?i.internalFormat=t.R16F:i.format==t.RGB?i.internalFormat=t.RGB16F:i.format==t.RGBA&&(i.internalFormat=t.RGBA16F):i.type==t.UNSIGNED_BYTE&&(i.format==t.RED&&(i.internalFormat=t.R8),i.format==t.RGB?i.internalFormat=t.RGB8:i.format==t.RGBA&&(i.internalFormat=t.RGBA8))),null!=i.depthFormat&&("webgl2"==t.name?i.depthType==t.UNSIGNED_SHORT?i.depthInternalFormat=t.DEPTH_COMPONENT16:i.depthType==t.UNSIGNED_INT&&(i.depthInternalFormat=t.UNSIGNED_INT):i.depthInternalFormat=i.depthFormat),i}(e,t);this.textureTargets.forEach((function(t){e.deleteTexture(t)})),this.textureTargets=[],this.depthTexture&&(e.deleteTexture(this.depthTexture),this.depthTexture=null),this.frameBuffer&&e.deleteFramebuffer(this.frameBuffer),this.type=a.type,this.format=a.format,this.internalFormat=a.internalFormat,this.filter=a.filter,this.wrap=a.wrap,this.flipY=a.flipY,this.width=a.width,this.height=a.height,this.clearColor=new y(0,0,0,0),this.colorMask=[!0,!0,!0,!0],this.textureType=1,this.textureDesc=[this.width,this.height,0,0];var i=null!=t.numColorChannels?t.numColorChannels:null!=a.format?1:0;for(var n=0;n<i;n++){e.activeTexture(e.TEXTURE0+1);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a.wrapT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.minFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a.magFilter),e.texImage2D(e.TEXTURE_2D,0,this.internalFormat,a.width,a.height,0,this.format,this.type,null),this.textureTargets.push(r)}if(a.depthFormat){if("webgl"==e.name&&!e.__ext_WEBGL_depth_texture)throw new Error("Depth textures not support on this device");e.activeTexture(e.TEXTURE0),this.depthTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.depthTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a.wrapT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.minFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a.magFilter),e.texImage2D(e.TEXTURE_2D,0,a.depthInternalFormat,a.width,a.height,0,a.depthFormat,a.depthType,null)}if(this.frameBuffer=e.createFramebuffer(),"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.frameBuffer):e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),this.textureTargets.length>0){if(this.textureTargets.length>1&&"webgl"==e.name&&!e.drawBuffers){e.__ext_draw_buffers=e.getExtension("WEBGL_draw_buffers"),e.drawBuffers=e.__ext_draw_buffers.drawBuffersWEBGL.bind(e.__ext_draw_buffers);for(var o=1;o<14;o++)e["COLOR_ATTACHMENT"+o]=e.__ext_draw_buffers["COLOR_ATTACHMENT"+o+"_WEBGL"];e.MAX_COLOR_ATTACHMENTS=e.__ext_draw_buffers.MAX_COLOR_ATTACHMENTS_WEBGL,e.MAX_DRAW_BUFFERS=e.__ext_draw_buffers.MAX_DRAW_BUFFERS_WEBGL}var l=[];for(var s=0;s<this.textureTargets.length;s++)e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,this.textureTargets[s],0),l.push(e.COLOR_ATTACHMENT0+s);this.textureTargets.length>1&&e.drawBuffers(l)}this.depthTexture&&e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this.depthTexture,0);var d=e.checkFramebufferStatus(e.DRAW_FRAMEBUFFER);if(d!=e.FRAMEBUFFER_COMPLETE)switch(d){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");case 36061:throw new Error("The framebuffer is unsupported");default:throw new Error("Incomplete Frambuffer")}this.unbind()};e.prototype.bindForWriting=function(t,e){if(e===void 0){e=!1}t&&(this.__prevBoundFbo=t.boundRendertarget,t.boundRendertarget=this.frameBuffer);var a=this.__gl;"webgl2"==a.name?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.frameBuffer):a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.viewport(0,0,this.width,this.height),e&&this.clear()};e.prototype.unbindForWriting=function(t){t&&(t.boundRendertarget=this.__prevBoundFbo);var e=this.__gl;"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.__prevBoundFbo):e.bindFramebuffer(e.FRAMEBUFFER,this.__prevBoundFbo)};e.prototype.clear=function(t){if(t===void 0){t=!0}var e=this.__gl;e.colorMask.apply(e,this.colorMask),e.clearColor.apply(e,this.clearColor.asArray());var a=0;this.textureTargets.length>0&&(a|=e.COLOR_BUFFER_BIT),this.depthTexture&&(a|=e.DEPTH_BUFFER_BIT),e.clear(a)};e.prototype.bindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer)};e.prototype.unbindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null)};e.prototype.bindColorTexture=function(t,e,a){if(a===void 0){a=0}var i=this.__gl,n=t.boundTextures++;return i.uniform1i(e.location,n),i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,this.textureTargets[a]),!0};e.prototype.bindDepthTexture=function(t,e){var a=this.__gl,i=t.boundTextures++;return a.uniform1i(e.location,i),a.activeTexture(a.TEXTURE0+i),a.bindTexture(a.TEXTURE_2D,this.depthTexture),!0};e.prototype.unbind=function(){var t=this.__gl;t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)};e.prototype.resize=function(t,e,a){if(a===void 0){a=!1}};e.prototype.bindToUniform=function(t,e,a){var i=t.boundTextures++,n=this.__gl.TEXTURE0+i,r=this.__gl;return r.activeTexture(n),r.bindTexture(r.TEXTURE_2D,this.textureTargets[0]),r.uniform1i(e.location,i),a&&(a.textureTypeUnif&&r.uniform1i(a.textureTypeUnif.location,this.textureType),a.textureDescUnif&&this.__gl.uniform4fv(a.textureDescUnif.location,this.textureDesc)),!0};e.prototype.destroy=function(){var t=this.__gl;this.textureTargets.forEach((function(e){t.deleteTexture(e)})),this.textureTargets=[],this.depthTexture&&(t.deleteTexture(this.depthTexture),this.depthTexture=null),this.frameBuffer&&t.deleteFramebuffer(this.frameBuffer)};return e}(L);var ai=new Uint32Array(1);function ii(t){return ai[0]=t,ai[0]=(ai[0]<<16|ai[0]>>16)>>>0,ai[0]=(1431655765&ai[0])<<1|(2863311530&ai[0])>>>1>>>0,ai[0]=(858993459&ai[0])<<2|(3435973836&ai[0])>>>2>>>0,ai[0]=(252645135&ai[0])<<4|(4042322160&ai[0])>>>4>>>0,ai[0]=(16711935&ai[0])<<8|(4278255360&ai[0])>>>8>>>0,2.3283064365386963e-10*ai[0]}function ni(t,e){return[t/e,ii(t)]}Ja.setShaderModule("utils/imageAtlas.glsl","\n\n// Note: On mobile, I can't seem to pass around a stuct containing sampler2D.\n// I have to unpack the struct and pass its members. :(\n// struct ImageAtlas {\n//     sampler2D layout;\n//     sampler2D image;\n//     vec4 desc;\n// };\n\n\n\nvec4 getSubImageLayout(int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    return fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n}\n\nvec2 calcSubImageTexCoords(vec2 texCoord, int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    // The following line is a hack to fix artifacts in our PBR lighting\n    // We were seeing loads of lighting garbage on some sufaces that were orthogonal\n    // to the world. The UV coordinates would have been landing right on the edges\n    // of our subimages and were often sampling outside the image. This couuld\n    // have been because of filtering, or an error in the uv coords. \n    texCoord = clamp(texCoord, vec2(0.01, 0.01), vec2(0.99, 0.99));\n    vec2 subimageTexel = texCoord * layoutData.zw;\n    // subimageTexel = clamp(subimageTexel, vec2(0.0, 0.0), vec2(1.0, 1.0));\n    return subimageTexel + layoutData.xy;\n}\n\nvec4 sampleSubImage(vec2 texCoord, int index, in sampler2D atlasLayout, in sampler2D atlasImage, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    vec2 atlasCoords = calcSubImageTexCoords(texCoord, index, atlasLayout, atlasDesc);\n    return texture2D(atlasImage, atlasCoords);\n}\n\n");var ri=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("AtlasLayoutShader.vertexShader",'\n\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform vec2 pos;\nuniform vec2 size;\nuniform vec2 srctextureDim;\nconst int border = 2;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * size * 2.0), 0.0, 1.0);\n\n  vec2 borderVec2 = vec2(float(border), float(border));\n  v_texCoord *= (srctextureDim + (borderVec2 * 2.0)) / srctextureDim;\n  v_texCoord -= borderVec2 / srctextureDim;\n}\n\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("AtlasLayoutShader.fragmentShader","\nprecision highp float;\n\nuniform sampler2D srctexture;\nuniform vec2 srctextureDim;\nuniform bool alphaFromLuminance;\nuniform bool invert;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\nfloat luminanceFromRGB(vec3 rgb) {\n  return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n  vec2 pixelCoord = v_texCoord*srctextureDim;\n  vec2 uv = v_texCoord;\n\n  // Wrap X coords\n  if(pixelCoord.x < 0.0){\n    uv.x += 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n  else if(pixelCoord.x > srctextureDim.x){\n    uv.x -= 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n\n  // Wrap Y coords\n  if(pixelCoord.y < 0.0){\n    uv.y += 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n  else if(pixelCoord.y > srctextureDim.y){\n    uv.y -= 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n\n  vec4 texel = texture2D(srctexture, uv);\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  // TODO: check why we pre-multiply alphas here.\n  // fragColor = vec4(texel.rgb/texel.a, texel.a);\n\n  if(alphaFromLuminance) {\n    fragColor = vec4(texel.rgb, luminanceFromRGB(texel.rgb));\n  }\n  else {\n    fragColor = texel;\n  }\n  \n  if(invert) {\n    fragColor = vec4(1.0) - fragColor;\n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n");return a}return e}(Ea);var oi=function(t){__extends(e,t);function e(e,a,i,n){if(i===void 0){i="RGBA"}if(n===void 0){n="FLOAT"}var r=this;r=t.call(this,e)||this,r.__name=a,r.__formatParam=i,r.__typeParam=n,r.clearColor=new y(0,0,0,0),r.__subImages=[],r.__layoutNeedsRegeneration=!1,r.__async=new M,r.loaded=!1,r.__async.addListener("ready",(function(){r.loaded=!0,r.emit("loaded",{})}));return r}e.prototype.isLoaded=function(){return 0==this.__async.count};e.prototype.getMainImage=function(){return this.super};e.prototype.addSubImage=function(t){var e=this;if(t instanceof Nt){var a=new Ma(this.__gl,t);t.isLoaded()||(this.__async.incAsyncCount(),t.addListener("loaded",(function(){e.__async.decAsyncCount()}))),t.setMetadata("ImageAtlas_gltex",a),a.addRef(this);var i=function(){e.__layoutNeedsRegeneration=!0,e.renderAtlas()};t.addListener("updated",i),this.__subImages.push(a)}else t.addRef(this),this.__subImages.push(t);return this.__layoutNeedsRegeneration=!0,this.__subImages.length-1};e.prototype.removeSubImage=function(t){var e;if(t instanceof Nt){var a=t.getMetadata("ImageAtlas_gltex");e=this.__subImages.indexOf(a),t.deleteMetadata("ImageAtlas_gltex")}else e=this.__subImages.indexOf(t);this.__subImages[e].removeRef(this),this.__subImages.splice(e,1),this.__layoutNeedsRegeneration=!0};e.prototype.getSubImage=function(t){return this.__subImages[t]};e.prototype.numSubImages=function(){return this.__layout?this.__layout.length:this.__subImages.length};e.prototype.generateAtlasLayout=function(){var t=this;if(0==this.__subImages.length)return void(this.__layoutNeedsRegeneration=!1);var e=[];this.__subImages.forEach((function(t,a){e.push({w:t.width+4,h:t.height+4,area:t.width*t.height,index:a})})),e.sort((function(t,e){return t.area>e.area?-1:t.area<e.area?1:0}));var a=new T;a.fit(e),this.__layout=[],e.forEach((function(e,a){e.fit?t.__layout[e.index]={pos:new h(e.fit.x+2,e.fit.y+2),size:new h(e.w,e.h)}:console.warn("Unable to fit image")}));var i=a.root.w,n=a.root.h;this.configure({width:i,height:n,format:"FLOAT"==this.__typeParam&&"RGB"==this.__formatParam?"RGBA":this.__formatParam,type:this.__typeParam,filter:"LINEAR"});var r=this.__gl;if(r.__quadVertexIdsBuffer||r.setupInstancedQuad(),!r.__atlasLayoutShader){r.__atlasLayoutShader=new ri(r);var o=r.__atlasLayoutShader.compileForTarget("GLImageAtlas");r.__atlasLayoutShaderBinding=Na(r,o.attrs,r.__quadattrbuffers,r.__quadIndexBuffer)}var l=Math.round(Math.sqrt(1*this.__layout.length)+.5);if(l=Math.nextPow2(l),l%1!=0&&(l+=1-l%1),r.floatTexturesSupported){var s=new Float32Array(l*l*4);for(var d=0;d<this.__layout.length;d++){var c=this.__layout[d];p.createFromFloat32Buffer(s.buffer,4*d).set(c.pos.x/i,c.pos.y/n,c.size.x/i,c.size.y/n)}this.__atlasLayoutTexture&&this.__atlasLayoutTexture.width==l&&this.__atlasLayoutTexture.height==l?this.__atlasLayoutTexture.bufferData(s,l,l):(this.__atlasLayoutTexture&&this.__atlasLayoutTexture.destroy(),this.__atlasLayoutTexture=new Ma(r,{format:"RGBA",type:"FLOAT",filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1,width:l,height:l,data:s}))}else this.__layoutVec4s=[],this.__layout.forEach((function(e,a){t.__layoutVec4s[a]=[e.pos.x/i,e.pos.y/n,e.size.x/i,e.size.y/n]}));this.__layoutNeedsRegeneration=!1};e.prototype.getLayoutData=function(t){return this.__layoutVec4s[t]};e.prototype.renderAtlas=function(t,e){if(t===void 0){t=!1}if(e===void 0){e=0}if(0==this.__subImages.length)return;this.__layoutNeedsRegeneration&&this.generateAtlasLayout();var a=this.__gl,i={};this.bindForWriting(i,!0),a.__atlasLayoutShader.bind(i,"GLImageAtlas"),a.__atlasLayoutShaderBinding.bind(i);var n=new h(1/this.width,1/this.height),r=i.unifs;for(var o=e;o<this.__subImages.length;o++){var l=this.__subImages[o],s=this.__layout[o];l.bindToUniform(i,r.srctexture),a.uniform2fv(r.pos.location,s.pos.multiply(n).asArray()),a.uniform2fv(r.size.location,s.size.multiply(n).asArray()),a.uniform2f(r.srctextureDim.location,l.width,l.height),a.uniform1i(r.alphaFromLuminance.location,l.alphaFromLuminance),a.uniform1i(r.invert.location,l.invert),a.drawQuad(),i.boundTextures--}t&&this.cleanup(),this.unbind(i),this.emit("updated",{})};e.prototype.isReady=function(){return null!=this.__atlasLayoutTexture};e.prototype.bindToUniform=function(e,a){if(!this.__atlasLayoutTexture)return!1;t.prototype.bindToUniform.call(this,e,a);var i=e.unifs,n=i[a.name+"_layout"];n&&this.__atlasLayoutTexture.bindToUniform(e,n);var r=i[a.name+"_desc"];return r&&this.__gl.uniform4f(r.location,this.width,this.height,this.__atlasLayoutTexture.width,0),!0};e.prototype.cleanup=function(){for(var t=0,e=this.__subImages;t<e.length;t++){var a=e[t];a.removeRef(this)}this.__subImages=[],this.destroy()};e.prototype.destroy=function(){this.cleanup(),t.prototype.destroy.call(this)};return e}(ei);var li=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("ConvolverShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("ConvolverShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n\nuniform float roughness;\nvarying vec2 v_texCoord;\n\nuniform sampler2D hammersleyMap;\nvec2 Hammersley(int i, int N) {\n  vec4 rgba =  texture2D(hammersleyMap, vec2((float(i) + 0.5)/float(N)), 0.5);\n  return rgba.rg;\n}\n\nmat3 matrixFromVector(vec3 n) { // frisvad\n  float a = 1.0 / (1.0 + n.z);\n  float b = -n.x * n.y * a;\n  vec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n  vec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n  return mat3(b1, b2, n);\n}\n\nvec3 ImportanceSampleGGX(vec2 Xi, float a) {\n  float phi = 2.0 * PI * Xi.x;\n  float cos_theta = sqrt((1.0 - Xi.y)/(1.0 + (a*a - 1.0) * Xi.y));\n  float sin_theta = sqrt(1.0 - cos_theta * cos_theta);\n\n  // float phi = Xi.y * 2.0 * PI;\n  // float cos_theta = sqrt(1.0 - Xi.x);\n  // float sin_theta = sqrt(1.0 - cos_theta * cos_theta);\n\n  vec3 H;\n  H.x = sin_theta * cos(phi);\n  H.y = sin_theta * sin(phi);\n  H.z = cos_theta;\n  return H;\n}\n\n// TODO: use tobias\'s code. The guy clearly knows what he\'s doing...\n// https://github.com/thefranke/dirtchamber/blob/master/shader/importance.hlsl\n// Compute a LOD level for filtered importance sampling.\n// From GPU Gems 3: GPU-Based Importance Sampling.\n\n\n#define M_PI       3.14159265358979323846   // pi\n#define M_HALF_PI  1.57079632679489661923   // pi/2\nfloat sqr(float val){ return val*val; }\nfloat saturate(float val) { return clamp(val, 0.0, 1.0); }\nvec3 saturate(vec3 val) { return clamp(val, 0.0, 1.0); }\n\n// Microfacet Models for Refraction through Rough Surfaces\n// Walter et al.\n// http://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.html\n// aka Towbridge-Reitz\nfloat D_ggx(in float alpha, in float NoH)\n{\n  float a2 = alpha*alpha;\n  float cos2 = NoH*NoH;\n\n  return (1.0/M_PI) * sqr(alpha/(cos2 * (a2 - 1.0) + 1.0));\n\n  /*\n  // version from the paper, eq 33\n  float CosSquared = NoH*NoH;\n  float TanSquared = (1.0 - CosSquared)/CosSquared;\n  return (1.0/M_PI) * sqr(alpha/(CosSquared * (alpha*alpha + TanSquared)));\n  */\n}\nfloat compute_lod(in vec3 H, in float pdf, in int num_samples, in int ww, in int hh)\n{\n  return max(0.0, 0.5*log2(float(ww*hh)/float(num_samples)) - 0.5*log2(pdf));\n}\n\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec3 N = sphOctUvToDir(v_texCoord);\n\n  if(false){\n    vec2 uv = dirToSphOctUv(N);\n    // fragColor = vec4(uv.x, uv.y, 0.0, 1.0);\n    fragColor = sampleImagePyramid(uv, 0.5, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc);\n    // fragColor = sampleSubImage(uv, 0, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc);\n    // fragColor = texture2D(envMapPyramid, uv);\n  }\n  else{\n    const int numSamples = NUM_SAMPLES;\n    int w = int(floor(envMapPyramid_desc.x + 0.5));\n    int h = int(floor(envMapPyramid_desc.y + 0.5));\n\n    vec4 color = vec4(0.0,0.0,0.0,0.0);\n    float weight = 0.0;\n    mat3 vecSpace = matrixFromVector(N);\n    float a = roughness*roughness;\n    for(int i=0; i<numSamples; i++) {\n      vec2 Xi = Hammersley(i, numSamples);\n      vec3 H = ImportanceSampleGGX(Xi, a);\n      vec3 V = normalize(vecSpace * H);\n      float VdotN = dot(V, N);\n      float NoH = saturate( dot( N, H ) );\n      float VoH = saturate( dot( V, H ) );\n\n      vec2 uv = dirToSphOctUv(V);\n      // float pdf = D_ggx(a, NoH) * NoH / (4.0 * VoH);\n      // float lod = compute_lod(H, pdf, numSamples, w, h);\n\n      color += sampleImagePyramid(uv, a, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc) * VdotN;\n      weight += VdotN;\n    }\n    color /= float(weight);\n    fragColor = vec4(color.rgb, 1.0);\n  }\n  \n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n');return a}return e}(Ea);Ja.setShaderModule("utils/imagePyramid.glsl",'\n\n<%include file="utils/imageAtlas.glsl"/>\n\nvec4 sampleImagePyramid(vec2 uv, float lod, in sampler2D atlasLayout, in sampler2D atlasImage, in vec4 atlasDesc){\n  if (lod < 0.00001 || lod > 0.9999) {\n    float imageIndex = lod * (atlasDesc.z-1.0);\n    int imageId0 = int(imageIndex);\n    return sampleSubImage(uv, imageId0, atlasLayout, atlasImage, atlasDesc);\n  } else {\n    float imageIndex = lod * (atlasDesc.z-1.0);\n    int imageId0 = int(floor(imageIndex));\n    int imageId1 = imageId0+1;\n    float blend = fract(imageIndex);\n    vec4 c0 = sampleSubImage(uv, imageId0, atlasLayout, atlasImage, atlasDesc);\n    vec4 c1 = sampleSubImage(uv, imageId1, atlasLayout, atlasImage, atlasDesc);\n    return mix(c0, c1, blend);\n  } \n}\n\n\n');var si=function(t){__extends(e,t);function e(e,a,i,n,r){if(n===void 0){n=!0}if(r===void 0){r=16}var o=this;o=t.call(this,e,a)||this,o.__srcGLTex=i,o.__fbos=[],i.addListener("updated",(function(){o.renderAtlas(n)})),o.__srcGLTex.isLoaded()?(o.generateAtlasLayout(r),o.renderAtlas(n)):o.__srcGLTex.addListener("updated",(function(){o.generateAtlasLayout(r),o.renderAtlas(n)})),i.addListener("destructing",(function(){console.log(o.__srcGLTex.getName()+" ImagePyramid destructing"),o.destroy()}));return o}e.prototype.generateAtlasLayout=function(e){var a=this.__gl;this.size=this.__srcGLTex.height;var i=this.__srcGLTex.width/this.__srcGLTex.height;this.addSubImage(this.__srcGLTex);for(var n=Math.round(function(t){return Math.log2(t)}(this.size))-1;n>=0;--n){var r=Math.pow(2,n);if(r<e)break;var o=new Ma(a,{format:this.__srcGLTex.getFormat(),type:this.__srcGLTex.getType(),width:r*i,height:r,filter:"LINEAR",wrap:"CLAMP_TO_EDGE"});this.addSubImage(o),this.__fbos.push(new ka(a,o))}t.prototype.generateAtlasLayout.call(this)};e.prototype.renderAtlas=function(e){if(e===void 0){e=!0}var a=this.__gl,i={};a.screenQuad.bindShader(i);for(var n=0;n<this.__fbos.length;n++)this.__fbos[n].bindAndClear(),a.screenQuad.draw(i,this.getSubImage(n));t.prototype.renderAtlas.call(this,e)};e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0,a=this.__fbos;e<a.length;e++){var i=a[e];i.destroy()}};return e}(oi);var di=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.__gl=e,e.__quadVertexIdsBuffer||e.setupInstancedQuad(),i.__convolved=!1,i.__fbos=[];return i}e.prototype.generateHammersleySamples=function(t){var e=this.__gl;if(!e["Hammersley"+t]){var a=new Float32Array(3*t);for(var i=0;i<t;i++){var n=ni(i,t),r=3*i;a[r+0]=n[0],a[r+1]=n[1]}e["Hammersley"+t]=new Ma(e,{format:"RGB",type:"FLOAT",filter:"NEAREST",wrap:"CLAMP_TO_EDGE",width:t,height:1,data:a,mipMapped:!1})}return e["Hammersley"+t]};e.prototype.convolveProbe=function(t){var e=this;var a=this.__gl,i=this.generateHammersleySamples(1024);if(!this.__convolved){this.__lodPyramid||(this.__lodPyramid=new si(a,"Probe Lods",t,!1),this.__lodPyramid.addListener("updated",(function(){e.convolveProbe(t)}))),this.addSubImage(t);var n=[t.width/2,t.height/2];var r=6;for(var o=0;o<r;o++){var l=new Ma(a,{format:"RGBA",type:"FLOAT",filter:"LINEAR",wrap:"CLAMP_TO_EDGE",width:n[0],height:n[1]});this.addSubImage(l);var s=new ka(a,l);s.setClearColor([0,1,0,0]),this.__fbos.push(s),n=[n[0]/2,n[1]/2]}this.generateAtlasLayout(),this.__convolverShader=new li(a);var d=this.__convolverShader.compileForTarget("GLProbe",Object.assign({repl:{NUM_SAMPLES:1024}},a.shaderopts));this.__covolverShaderBinding=Na(a,d.attrs,a.__quadattrbuffers,a.__quadIndexBuffer)}var c={};this.__convolverShader.bind(c,"GLProbe"),this.__covolverShaderBinding.bind(c);var u=c.unifs;for(var h=0;h<this.__fbos.length;h++){if(this.__fbos[h].bindAndClear(),this.__lodPyramid.bindToUniform(c,u.envMapPyramid),"hammersleyMap"in u&&i.bindToUniform(c,u.hammersleyMap),"roughness"in u){var m=(h+1)/this.__fbos.length;a.uniform1f(u.roughness.location,m)}a.drawQuad()}this.__convolved=!0,this.renderAtlas(!1)};e.prototype.bindProbeToUniform=function(e,a){this.__convolved&&t.prototype.bindToUniform.call(this,e,a)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__convolverShader.destroy();for(var e=0,a=this.__fbos;e<a.length;e++){var i=a[e];i.destroy()}};return e}(oi);Ja.setShaderModule("stack-gl/inverse.glsl","\n\n\n#ifndef ENABLE_ES3\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n#endif\n\n"),Ja.setShaderModule("stack-gl/transpose.glsl","\n\n\n#ifndef ENABLE_ES3\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\n#endif\n\n"),Ja.setShaderModule("pragmatic-pbr/envmap-octahedral.glsl","\n\n#define sectorize(value) step(0.0, (value))*2.0-1.0\n#define sum(value) dot(clamp((value), 1.0, 1.0), (value))\n\n\nvec2 dirToSphOctUv(vec3 normal){\n    normal = normalize(normal);\n    vec3 aNorm = abs(normal);\n    vec3 sNorm = sectorize(normal);\n\n    vec2 dir = max(aNorm.xy, 1e-20);\n    float orient = atan(dir.x, dir.y)/HalfPI;\n\n    dir = max(vec2(aNorm.z, length(aNorm.xy)), 1e-20);\n    float pitch = atan(dir.y, dir.x)/HalfPI;\n\n    vec2 uv = vec2(sNorm.x*orient, sNorm.y*(1.0-orient))*pitch;\n\n    if(normal.z < 0.0){\n        uv = sNorm.xy - abs(uv.ts)*sNorm.xy;\n    }\n    return uv*0.5+0.5;\n}\n\n\nvec3 sphOctUvToDir(vec2 uv){\n    uv = uv*2.0-1.0;\n    vec2 suv = sectorize(uv);\n    float sabsuv =  sum(abs(uv));\n    float pitch = sabsuv*HalfPI;\n\n    if (pitch <= 0.0) {\n        return vec3(0.0, 0.0, 1.0);\n    }\n    if (abs(pitch - PI) < 0.000001) {\n        return vec3(0.0, 0.0, -1.0);\n    }\n    if(sabsuv > 1.0){\n        uv = (1.0-abs(uv.ts))*suv;\n    }\n\n    float orient = (abs(uv.s)/sabsuv)*HalfPI;\n    float sOrient = sin(orient);\n    float cOrient = cos(orient);\n    float sPitch = sin(pitch);\n    float cPitch = cos(pitch);\n\n    return vec3(\n        sOrient*suv.s*sPitch,\n        cOrient*suv.t*sPitch,\n        cPitch\n    );\n}\n\n"),Ja.setShaderModule("pragmatic-pbr/envmap-equirect.glsl","\n\n\nvec2 latLongUVsFromDir(vec3 dir) {\n  // Math function taken from...\n  // http://gl.ict.usc.edu/Data/HighResProbes/\n  // Note: Scaling from u=[0,2], v=[0,1] to u=[0,1], v=[0,1]\n  float phi = acos(dir.z);\n  float theta = atan(dir.x, dir.y);\n  return vec2((1.0 + theta / PI) / 2.0, phi / PI);\n}\n\n// Note: when u == 0.5 z = 1.0\nvec3 dirFromLatLongUVs(float u, float v) {\n    // http://gl.ict.usc.edu/Data/HighResProbes/\n    float theta = PI*((u * 2.0) - 1.0);\n    float phi = PI*v;\n    return vec3(sin(phi)*sin(theta), sin(phi)*cos(theta), cos(phi));\n}\n\nvec3 dirFromPolar(vec2 polar) {\n    float u = polar.x / (PI * 2.0);\n    float v = polar.y / PI;\n    return dirFromLatLongUVs(u, v);\n}\n\n"),Ja.setShaderModule("pragmatic-pbr/envmap-dualfisheye.glsl","\n\n\n\nvec2 dualfisheyeUVsFromDir(vec3 dir) {\n  vec2 result;\n  float angle = 0.465;\n    if(dir.x < 0.0) {\n        result = vec2(((dir.z * -angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n    }\n    else {\n        result = vec2( 0.5 + ((dir.z * angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n    }\n    return result;\n}\n\n\n");var ci=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("EnvMapShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\n\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID() * 2.0;\n  v_texCoord = position * 0.5 + 0.5;\n\n  mat4 inverseProjection = inverse(projectionMatrix);\n  mat3 inverseModelview = transpose(mat3(viewMatrix));\n\n  // transform from the normalized device coordinates back to the view space\n  vec3 unprojected = (inverseProjection * vec4(position, 0, 1)).xyz;\n\n  // transfrom from the view space back to the world space\n  // and use it as a sampling vector\n  v_worldDir = inverseModelview * unprojected;\n\n  gl_Position = vec4(position, 0, 1);\n}\n\n');return a}return e}(Ea);var ui=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("LatLongEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec4 texel = texture2D(backgroundImage, v_texCoord);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(ci);var hi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("OctahedralEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n\nuniform float focus;\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\n// uniform ImageAtlas envMap;\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dirToSphOctUv(normalize(v_worldDir));\n  if(false){\n    // Use these lines to debug the src GL image.\n    vec4 texel = texture2D(envMapPyramid, uv);\n    fragColor = vec4(texel.rgb/texel.a, 1.0);\n  }\n  else{\n    fragColor = vec4(sampleImagePyramid(uv, focus, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc).rgb, 1.0);\n  }\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(ci);var mi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("LatLongEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = latLongUVsFromDir(normalize(v_worldDir));\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){return t.getParamDeclarations.call(this)};return e}(ci);var pi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("SterioLatLongEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform int eye;// L = 0, R = 1;\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = latLongUVsFromDir(normalize(v_worldDir));\n  uv.y *= 0.5;\n  if(eye == 1){\n    uv.y += 0.5;\n  }\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(ci);var fi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("DualFishEyeEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-dualfisheye.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dualfisheyeUVsFromDir(normalize(v_worldDir));\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(ci);var bi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("DualFishEyeEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n<%include file="pragmatic-pbr/envmap-dualfisheye.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dualfisheyeUVsFromDir(dirFromLatLongUVs(v_texCoord.x, v_texCoord.y));\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  // fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(ci);var yi=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e.gl,"EnvMap")||this,n.__renderer=e,n.__envMap=a,n.__backgroundFocus=0;var r=e.gl;r.__quadVertexIdsBuffer||r.setupInstancedQuad();var o=n.__envMap.getMetadata("gltexture");o||(o=new Ba(r,n.__envMap)),n.__srcGLTex=o,n.__envMapShader=new hi(r);var l=n.__envMapShader.compileForTarget("GLEnvMap",i);if(n.__envMapShaderBinding=Na(r,l.attrs,r.__quadattrbuffers,r.__quadIndexBuffer),n.__envMap.isLoaded())n.convolveProbe(o);else{var s=function(){n.convolveProbe(o),n.emit("loaded",{})};n.__envMap.addListener("loaded",s)}return n}e.prototype.getEnvMap=function(){return this.__envMap};e.prototype.getBackgroundFocus=function(){return this.__backgroundFocus};e.prototype.setBackgroundFocus=function(t){this.__backgroundFocus=t,this.__renderer.requestRedraw()};e.prototype.draw=function(t){if(this.__envMap.isLoaded()){var e=this.__gl;{this.__envMapShader.bind(t,"GLEnvMap");var a=t.unifs;this.bindProbeToUniform(t,a.envMapPyramid);{var i=a.focus;i&&e.uniform1f(i.location,this.__backgroundFocus)}{var n=a.exposure;n&&e.uniform1f(n.location,t.exposure)}this.__envMapShaderBinding.bind(t),e.depthMask(!1),t.bindViewports(a,(function(){e.drawQuad()}))}}};e.prototype.bindToUniform=function(t,e,a){return this.__srcGLTex.bindToUniform(t,e,a)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__srcGLTex.loaded.disconnectScope(this),this.__srcGLTex.updated.disconnectScope(this),this.__srcGLTex.destroy()};return e}(di);var gi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("ScreenQuadShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform vec2 pos;\nuniform vec2 size;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * abs(size) * 2.0), 0.0, 1.0);\n    if(size.x < 0.0)\n        v_texCoord.x = 1.0 - v_texCoord.x;\n    if(size.y < 0.0)\n        v_texCoord.y = 1.0 - v_texCoord.y;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("ScreenQuadShader.fragmentShader","\nprecision highp float;\n\nuniform sampler2D image;\n\nvarying vec2 v_texCoord;\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = texture2D(image, v_texCoord);\n    fragColor = vec4(fragColor.rgb/fragColor.a, 1.0);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n"),a.finalize();return a}return e}(Ea);var _i=function(){function t(t,e){this.__gl=t,this.__pos=[0,0],this.__size=[1,1],this.flipY=!0,this.__glshader=new gi(t),t.__quadVertexIdsBuffer||t.setupInstancedQuad();var a=this.__glshader.compileForTarget("GLScreenQuad",e);this.__quadBinding=Na(t,a.attrs,t.__quadattrbuffers,t.__quadIndexBuffer),this.ready=!0}t.prototype.bind=function(t,e,a,i){var n=t.unifs;e.bindToUniform(t,t.unifs.image);var r=this.__gl;{var o=n.pos;o&&r.uniform2fv(o.location,a?a instanceof d?a.asArray():a:this.__pos)}{var l=n.size;l&&r.uniform2fv(l.location,i?i instanceof d?i.asArray():i:this.__size)}this.__quadBinding.bind(t)};t.prototype.bindShader=function(t){return this.__glshader.bind(t,"GLScreenQuad")};t.prototype.draw=function(t,e,a,i){this.bind(t,e,a,i),this.__gl.drawQuad()};t.prototype.destroy=function(){};return t}();var Zi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__renderer=e,a.__doubleClickTimeMSParam=a.addParameter(new ft("DoubleClickTimeMS",200)),a.__fbo=void 0;a.__renderer.addListener("sceneSet",(function(){var t=e.getScene().settings.getParameter("BackgroundColor"),i=function(e){var i=t.getValue(),n=a.__renderer.gl;i instanceof Nt?"FLOAT"===i.type?(a.__backgroundTexture=i,a.__backgroundGLTexture=new Ba(n,i)):(a.__backgroundTexture=i,a.__backgroundGLTexture=new Ma(n,i)):i instanceof y?(a.__backgroundGLTexture&&(a.__backgroundGLTexture.destroy(),a.__backgroundGLTexture=void 0,a.__backgroundTexture=void 0),a.__backgroundColor=i):console.warn("Invalid background:"+i),a.emit("updated",{})};i(t.getValue()),t.addListener("valueChanged",i)}));return a}e.prototype.getRenderer=function(){return this.__renderer};e.prototype.getName=function(){return this.__name};e.prototype.getBl=function(){return this.__bl};e.prototype.setBl=function(t){this.__bl=t,this.resize(this.__canvasWidth,this.__canvasHeight)};e.prototype.getTr=function(){return this.__tr};e.prototype.setTr=function(t){this.__tr=t,this.resize(this.__canvasWidth,this.__canvasHeight)};e.prototype.getPosX=function(){return this.__x};e.prototype.getPosY=function(){return this.__y};e.prototype.getWidth=function(){return this.__width};e.prototype.getHeight=function(){return this.__height};e.prototype.getBackground=function(){console.warn("Deprecated Function. Please access the Scene Settings object.");return this.__renderer.getScene().settings.getParameter("BackgroundColor").getValue()};e.prototype.setBackground=function(t){console.warn("Deprecated Function. Please access the Scene Settings object.");this.__renderer.getScene().settings.getParameter("BackgroundColor").setValue(t),this.emit("updated",{})};e.prototype.resize=function(t,e){this.__canvasWidth=t,this.__canvasHeight=e,this.__width=t,this.__height=e,this.emit("resized",{width:this.__width,height:this.__height})};e.prototype.onMouseDown=function(t){return!1};e.prototype.onMouseUp=function(t){return!1};e.prototype.onMouseMove=function(t){return!1};e.prototype.onMouseLeave=function(t){return!1};e.prototype.onKeyPressed=function(t,e){return!1};e.prototype.onKeyDown=function(t,e){return!1};e.prototype.onKeyUp=function(t,e){return!1};return e}(D);var Gi=function(t){__extends(e,t);function e(e,a,i,n){var r=this;r=t.call(this,e)||this,r.__name=a,r.__projectionMatrix=new Z,r.__frustumDim=new h,r.__bl=new h(0,0),r.__tr=new h(1,1),r.__exposure=0,r.__exposureRange=[-5,10],r.__tonemap=!0,r.__gamma=2.2,r.__prevDownTime=0,r.__geomDataBuffer=void 0,r.__geomDataBufferFbo=void 0,r.setCamera(new ha("Default")),r.setManipulator(new Wa),r.resize(i,n);return r}e.prototype.resize=function(t,e){this.__canvasWidth=t,this.__canvasHeight=e,this.__x=t*this.__bl.x,this.__y=t*this.__bl.y,this.__width=t*this.__tr.x-t*this.__bl.x,this.__height=e*this.__tr.y-e*this.__bl.y,this.region=[this.__x,this.__y,this.__width,this.__height],this.__camera&&this.__updateProjectionMatrix(),this.__geomDataBufferFbo&&(this.__geomDataBuffer.resize(this.__width,this.__height),this.__geomDataBufferFbo.resize()),this.emit("resized",{width:t,height:e})};e.prototype.getCamera=function(){return this.__camera};e.prototype.setCamera=function(t){var e=this;this.__camera=t;var a=t.getParameter("GlobalXfo"),i=function(){e.__cameraXfo=a.getValue(),e.__cameraMat=e.__cameraXfo.toMat4(),e.__viewMat=e.__cameraMat.inverse()};i(),a.addListener("valueChanged",(function(){i(),e.invalidateGeomDataBuffer(),e.emit("updated",{}),e.emit("viewChanged",{interfaceType:"CameraAndPointer",viewXfo:e.__cameraXfo,focalDistance:e.__camera.getFocalDistance()})})),this.__camera.addListener("projectionParamChanged",(function(){e.__updateProjectionMatrix(),e.emit("updated",{})})),this.__updateProjectionMatrix()};e.prototype.getManipulator=function(){return this.__cameraManipulator};e.prototype.setManipulator=function(t){this.__cameraManipulator=t};e.prototype.__updateProjectionMatrix=function(){var t=this.__width/this.__height;this.__camera.updateProjectionMatrix(this.__projectionMatrix,t);var e=Math.tan(this.__camera.getFov()/2)*this.__camera.getNear()*2,a=e*t;this.__frustumDim.set(a,e)};e.prototype.getProjectionMatrix=function(){return this.__projectionMatrix};e.prototype.getViewMatrix=function(){return this.__viewMat};e.prototype.setActive=function(t){activeViewport=t?this:void 0};e.prototype.frameView=function(t){this.__width>0&&this.__height>0?this.__camera.frameView(this,t):console.warn("Unable to frameView while Viewport with and height are 0.")};e.prototype.calcRayFromScreenPos=function(t){var e=this.__canvasHeight*(1-this.__tr.y);var a=(t.x-this.__x)/this.__width,i=(t.y-e)/this.__height;a=2*a-1,i=2*i-1;var n=this.__cameraMat,r=this.__projectionMatrix.inverse();if(null==r)return null;var o,l;return this.__camera.getIsOrthographic()?(o=n.transformVec3(r.transformVec3(new m(a,-i,-1))),l=new m(0,0,-1)):(o=n.translation,l=r.transformVec3(new m(a,-i,-1))),l=n.rotateVec3(l).normalize(),new X(o,l)};e.prototype.createGeomDataFbo=function(t){var e=this.__renderer.gl;this.__floatGeomBuffer=t,this.__floatGeomBuffer?this.__geomDataBuffer=new Ma(e,{type:"FLOAT",format:"RGBA",filter:"NEAREST",width:this.__width<=1?1:this.__width,height:this.__height<=1?1:this.__height}):this.__geomDataBuffer=new Ma(e,{type:"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:this.__width<=1?1:this.__width,height:this.__height<=1?1:this.__height}),this.__geomDataBufferFbo=new ka(e,this.__geomDataBuffer,!0),this.__geomDataBufferFbo.setClearColor([0,0,0,0])};e.prototype.getGeomDataFbo=function(){return this.__geomDataBufferFbo};e.prototype.renderGeomDataFbo=function(){if(this.__geomDataBufferFbo){this.__geomDataBufferFbo.bindAndClear();var t={};this.__initRenderState(t),this.__renderer.drawSceneGeomData(t),this.__geomDataBufferInvalid=!1}};e.prototype.invalidateGeomDataBuffer=function(){this.__geomDataBufferInvalid=!0};e.prototype.getGeomDataAtPos=function(t,e){if(this.__geomDataBufferFbo){if(this.__geomDataBufferInvalid&&(this.renderGeomDataFbo(),this.__screenPos=null),t===this.__screenPos)return this.__intersectionData;this.__screenPos=t,this.__intersectionData=null;var a=this.__renderer.gl;var i,n=void 0;if(a.finish(),this.__geomDataBufferFbo.bindForReading(),a.floatGeomBuffer){if(n=new Float32Array(4),a.readPixels(t.x,this.__height-t.y,1,1,a.RGBA,a.FLOAT,n),0==n[3])return;i=63&Math.round(n[0])}else{if(n=new Uint8Array(4),a.readPixels(t.x,this.__height-t.y,1,1,a.RGBA,a.UNSIGNED_BYTE,n),a.bindFramebuffer(a.FRAMEBUFFER,null),0==n[0]&&0==n[1])return;i=0}this.__geomDataBufferFbo.unbind();var r=this.__renderer.getPass(i);if(!r)return void console.warn("Geom data buffer returns invalid pass id:",i);var o=r.getGeomItemAndDist(n);if(o){e||(e=this.calcRayFromScreenPos(t));var l=e.start.add(e.dir.scale(o.dist));this.__intersectionData={screenPos:t,mouseRay:e,intersectionPos:l,geomItem:o.geomItem,dist:o.dist,geomData:n}}return this.__intersectionData}};e.prototype.getGeomItemsInRect=function(t,e){if(this.__geomDataBufferFbo){var a=this.__renderer.gl;a.finish();var i=Math.round(this.__height-e.y),n=Math.round(t.x),r=Math.round(e.x-t.x),o=Math.round(e.y-t.y),l=r*o;var s=void 0;this.__geomDataBufferFbo.bindForReading(),a.floatGeomBuffer?(s=new Float32Array(4*l),a.readPixels(n,i,r,o,a.RGBA,a.FLOAT,s)):(s=new Uint8Array(4*l),a.readPixels(n,i,r,o,a.RGBA,a.UNSIGNED_BYTE,s)),a.bindFramebuffer(a.FRAMEBUFFER,null);var d=new Set;for(var c=0;c<l;c++){var u=void 0;var h=s.subarray(4*c,4*(c+1));u=a.floatGeomBuffer?Math.round(h[0]):0;var m=this.__renderer.getPass(u).getGeomItemAndDist(h);m&&d.add(m.geomItem)}return d}};e.prototype.__eventMousePos=function(t){return new h(t.rendererX-this.getPosX(),t.rendererY-this.getPosY())};e.prototype.__prepareEvent=function(t){var e=this;if(t.viewport=this,t.propagating=!0,t.stopPropagation=function(){t.propagating=!1},t.setCapture=function(t){e.capturedItem=t},t.getCapture=function(t){return e.capturedItem},t.releaseCapture=function(){e.capturedItem=null,e.renderGeomDataFbo()},t instanceof MouseEvent){var a=this.__eventMousePos(t);t.mousePos=a,t.mouseRay=this.calcRayFromScreenPos(a);var i=this.getGeomDataAtPos(t.mousePos,t.mouseRay);null!=i&&(t.intersectionData=i)}};e.prototype.setCapture=function(t){this.capturedItem=t};e.prototype.getCapture=function(){return this.capturedItem};e.prototype.releaseCapture=function(){this.capturedItem=null,this.renderGeomDataFbo()};e.prototype.onMouseDown=function(t){if(this.__prepareEvent(t),this.capturedItem)return void this.capturedItem.onMouseDown(t);if(null!=t.intersectionData){if(t.intersectionData.geomItem.onMouseDown(t),!t.propagating||this.capturedItem)return;if(this.emit("mouseDownOnGeom",t),!t.propagating)return}var e=Date.now();if(e-this.__prevDownTime<this.__doubleClickTimeMSParam.getValue()){if(this.__cameraManipulator&&(this.__cameraManipulator.onDoubleClick(t),!t.propagating))return;this.emit("mouseDoubleClicked",t)}else{if(this.__prevDownTime=e,this.__cameraManipulator&&(this.__cameraManipulator.onMouseDown(t),!t.propagating))return;this.emit("mouseDown",t)}return!1};e.prototype.onMouseMove=function(t){if(this.__prepareEvent(t),this.capturedItem)this.capturedItem.onMouseMove(t);else{if(null!=t.intersectionData){if(t.intersectionData.geomItem!=this.mouseOverItem&&(this.mouseOverItem&&this.mouseOverItem.onMouseLeave(t),this.mouseOverItem=t.intersectionData.geomItem,this.mouseOverItem.onMouseEnter(t)),t.intersectionData.geomItem.onMouseMove(t),!t.propagating||this.capturedItem)return}else this.mouseOverItem&&(this.mouseOverItem.onMouseLeave(t),this.mouseOverItem=null);this.__cameraManipulator&&(this.__cameraManipulator.onMouseMove(t),!t.propagating)||this.emit("mouseMove",t)}};e.prototype.onMouseUp=function(t){this.__prepareEvent(t),this.capturedItem?this.capturedItem.onMouseUp(t):(null==t.intersectionData||(t.intersectionData.geomItem.onMouseUp(t),t.propagating))&&(this.__cameraManipulator&&(this.__cameraManipulator.onMouseUp(t),!t.propagating)||this.emit("mouseUp",t))};e.prototype.onMouseLeave=function(t){this.__prepareEvent(t),this.emit("mouseLeave",t)};e.prototype.onKeyPressed=function(t,e){this.__prepareEvent(e),this.__cameraManipulator&&this.__cameraManipulator.onKeyPressed(t,e)||this.emit("keyPressed",e)};e.prototype.onKeyDown=function(t,e){this.__prepareEvent(e),this.__cameraManipulator&&this.__cameraManipulator.onKeyDown(t,e)||this.emit("keyDown",e)};e.prototype.onKeyUp=function(t,e){this.__prepareEvent(e),this.__cameraManipulator&&this.__cameraManipulator.onKeyUp(t,e)||this.emit("keyUp",e)};e.prototype.onWheel=function(t){this.__prepareEvent(t),(null==t.intersectionData||(t.intersectionData.geomItem.onWheel(t),t.propagating))&&(this.__cameraManipulator?this.__cameraManipulator.onWheel(t):this.emit("mouseWheel",t))};e.prototype.__eventTouchPos=function(t){return new h(t.rendererX-this.getPosX(),t.rendererY-this.getPosY())};e.prototype.onTouchStart=function(t){if(this.__prepareEvent(t),1==t.touches.length){var e=t.touches[0],a=this.__eventTouchPos(e);t.touchPos=a,t.touchRay=this.calcRayFromScreenPos(a);var i=this.getGeomDataAtPos(a,t.touchRay);if(null!=i){if(t.intersectionData=i,i.geomItem.onMouseDown(t,i),!t.propagating)return;if(this.capturedItem)return;if(this.emit("mouseDownOnGeom",t),!t.propagating)return}var n=Date.now();if(n-this.__prevDownTime<this.__doubleClickTimeMSParam.getValue()){if(this.__cameraManipulator&&(this.__cameraManipulator.onDoubleTap(t),!t.propagating))return;return void this.emit("doubleTapped",t)}this.__prevDownTime=n}this.__cameraManipulator?this.__cameraManipulator.onTouchStart(t):this.emit("touchStart",t)};e.prototype.onTouchMove=function(t){if(this.__prepareEvent(t),this.capturedItem){t.touchPos=[],t.touchRay=[];for(var e=0;e<t.touches.length;e++){var a=t.touches[e],i=this.__eventTouchPos(a);t.touchPos[e]=i,t.touchRay[e]=this.calcRayFromScreenPos(i)}return t.mousePos=t.touchPos[0],t.mouseRay=t.touchRay[0],void this.capturedItem.onMouseMove(t)}this.__cameraManipulator?this.__cameraManipulator.onTouchMove(t):this.emit("touchMove",t)};e.prototype.onTouchEnd=function(t){this.__prepareEvent(t),this.capturedItem?this.capturedItem.onMouseUp(t):this.__cameraManipulator?this.__cameraManipulator.onTouchEnd(t):this.emit("touchEnd",t)};e.prototype.onTouchCancel=function(t){this.__prepareEvent(t),this.capturedItem?this.capturedItem.onTouchCancel(t):this.__cameraManipulator?this.__cameraManipulator.onTouchCancel(t):this.emit("touchCancel",t)};e.prototype.__initRenderState=function(t){t.viewXfo=this.__cameraXfo,t.viewScale=1,t.region=this.region,t.cameraMatrix=this.__cameraMat,t.viewports=[{region:this.region,viewMatrix:this.__viewMat,projectionMatrix:this.__projectionMatrix,viewportFrustumSize:this.__frustumDim,isOrthographic:this.__camera.getIsOrthographic(),fovY:this.__camera.getFov()}]};e.prototype.draw=function(){var t=this.__renderer.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport.apply(t,this.region),this.__backgroundColor&&t.clearColor.apply(t,this.__backgroundColor.asArray()),t.colorMask(!0,!0,!0,!0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);var e={};this.__initRenderState(e),this.__renderer.drawScene(e)};return e}(Zi);var Xi=function(){function t(t,e){this.__vrviewport=t,this.__treeItem=new ta("VRHead"),e.addChild(this.__treeItem),this.__mat4=new Z,this.__localXfo=new v}t.prototype.update=function(t){this.__mat4.setDataArray(t.transform.matrix),this.__localXfo.fromMat4(this.__mat4),this.__treeItem.setLocalXfo(this.__localXfo)};t.prototype.getTreeItem=function(){return this.__treeItem};t.prototype.getXfo=function(){return this.__localXfo};return t}();var vi=function(){function t(t,e,a){var i=this;if(this.__vrviewport=t,this.__inputSource=e,this.__id=a,this.__isDaydramController=n.isMobileDevice,this.__pressedButtons=[],this.__mat4=new Z,this.__xfo=new v,this.__treeItem=new ta("VRController:"+e.handedness+a),!this.__isDaydramController){this.__tip=new ta("Tip");var r=new v;r.tr.set(0,-.05,-.13),this.__tip.setLocalXfo(r),this.__treeItem.addChild(this.__tip,!1),t.getTreeItem().addChild(this.__treeItem),this.__activeVolumeSize=.04,t.loadHMDResources().then((function(t){t.addListener("loaded",(function(){var e;0==a?e=t.getChildByName("LeftController"):1==a&&(e=t.getChildByName("RightController")),e||(e=t.getChildByName("Controller"));var n=e.clone();n.setLocalXfo(new v(new m(0,-.035,-.085),new G({setFromAxisAndAngle:[new m(0,1,0),Math.PI]}),new m(.001,.001,.001))),i.__treeItem.addChild(n,!1)}))}))}}t.prototype.getHandedness=function(){return this.__inputSource.handedness};t.prototype.getId=function(){return this.__id};t.prototype.getTreeItem=function(){return this.__treeItem};t.prototype.getTipItem=function(){return this.__tip};t.prototype.getTipXfo=function(){return this.__tip.getGlobalXfo()};t.prototype.getTouchPadValue=function(){return this.__touchpadValue};t.prototype.isButtonPressed=function(){return this.__buttonPressed};t.prototype.getControllerStageLocalXfo=function(){return this.__xfo};t.prototype.getControllerTipStageLocalXfo=function(){return this.__xfo.multiply(this.__tip.getLocalXfo())};t.prototype.updatePose=function(t,e,a){var i=e.getPose(a.gripSpace,t);i&&i.transform&&(this.__mat4.setDataArray(i.transform.matrix),this.__xfo.fromMat4(this.__mat4),this.__treeItem.setLocalXfo(this.__xfo),this.__geomAtTip=void 0,this.__hitTested=!1)};t.prototype.getGeomItemAtTip=function(){if(this.__hitTested)return this.__intersectionData;this.__hitTested=!0;var t=this.__vrviewport.getRenderer(),e=this.__tip.getGlobalXfo(),a=this.__activeVolumeSize;return this.__intersectionData=t.raycastWithXfo(e,a,a),this.__intersectionData};return t}();var Vi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.getParameter("DoubleClickTimeMS").setValue(300),a.__projectionMatriciesUpdated=!1,a.__far=1024,a.__near=.1,a.__stageTreeItem=new ta("VRStage"),a.__stageTreeItem.setSelectable(!1),a.__stageTreeItem.setVisible(!1),a.__renderer.addTreeItem(a.__stageTreeItem),a.__vrhead=new Xi(a.__renderer.gl,a.__stageTreeItem),a.__vrControllersMap={},a.__vrControllers=[];var i=new v;i.ori.setFromAxisAndAngle(new m(1,0,0),.5*Math.PI),a.setXfo(i),a.__leftViewMatrix=new Z,a.__leftProjectionMatrix=new Z,a.__rightViewMatrix=new Z,a.__rightProjectionMatrix=new Z;return a}e.prototype.getVRDisplay=function(){return this.__vrDisplay};e.prototype.getAsset=function(){return this.__vrAsset};e.prototype.getTreeItem=function(){return this.__stageTreeItem};e.prototype.getVRHead=function(){return this.__vrhead};e.prototype.getXfo=function(){return this.__stageXfo};e.prototype.setXfo=function(t){this.__stageXfo=t,this.__stageTreeItem.setGlobalXfo(t),this.__stageMatrix=t.inverse().toMat4(),this.__stageScale=t.sc.x};e.prototype.getControllers=function(){return this.__vrControllers};e.prototype.canPresent=function(){return this.__canPresent};e.prototype.isPresenting=function(){return this.__session};e.prototype.__startSession=function(){var t=this;var e=function(a,i){t.__session&&(t.__session.requestAnimationFrame(e),t.draw(i))};this.__session.requestAnimationFrame(e)};e.prototype.loadHMDResources=function(){var t=this;var e=localStorage.getItem("hmd");return this.__hmd!=e&&(this.__hmdAssetPromise=void 0),this.__hmdAssetPromise||(this.__hmd=e,this.__hmdAssetPromise=new Promise((function(a,i){t.__renderer.addListener("sceneSet",(function(r){var o=r.scene.getResourceLoader();var l;switch(e){case"Vive":l="ZeaEngine/Vive.vla";break;case"Oculus":default:l="ZeaEngine/Oculus.vla"}var s=o.resolveFilePathToId(l);s&&!n.isMobileDevice?(t.__vrAsset=t.__renderer.getScene().loadCommonAssetResource(s),t.__vrAsset.addListener("loaded",(function(){var e=t.__vrAsset.getMaterialLibrary(),i=e.getMaterialNames();for(var n=0,r=i;n<r.length;n++){var o=r[n];var l=e.getMaterial(o,!1);l&&(l.visibleInGeomDataBuffer=!1,l.setShaderName("SimpleSurfaceShader"))}a(t.__vrAsset)}))):i()}))}))),this.__hmdAssetPromise};e.prototype.startPresenting=function(){var t=this;return new Promise((function(e,a){var i=t.__renderer.gl,r=function(){navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor"]}).then((function(r){var o;t.__renderer.__xrViewportPresenting=!0,n.isMobileDevice||(o=document.createElement("canvas"),o.style.position="relative",o.style.left="0px",o.style.top="0px",o.style.width="100%",o.style.height="100%",t.__renderer.getDiv().replaceChild(o,t.__renderer.getGLCanvas()),r.addListener("end",(function(e){t.__renderer.getDiv().replaceChild(t.__renderer.getGLCanvas(),o)}))),r.addListener("end",(function(e){t.__stageTreeItem.setVisible(!1),t.__session=null,t.emit("presentingChanged",{state:!1})}));r.addListener("selectstart",(function(e){var a=t.__vrControllersMap[e.inputSource.handedness];if(a){var i=Date.now();console.log("controller:",e.inputSource.handedness," down",i-a.__prevDownTime),i-a.__prevDownTime<t.__doubleClickTimeMSParam.getValue()?t.emit("controllerDoubleClicked",{button:1,controller:a,vleStopPropagation:!1,vrviewport:t},t):(a.__prevDownTime=i,t.emit("controllerButtonDown",{button:1,controller:a,vleStopPropagation:!1,vrviewport:t},t))}})),r.addListener("selectend",(function(e){var a=t.__vrControllersMap[e.inputSource.handedness];a&&(console.log("controller:",e.inputSource.handedness," up"),t.emit("controllerButtonUp",{button:1,controller:a,vleStopPropagation:!1,vrviewport:t},t))})),t.__session=r,r.updateRenderState({baseLayer:new XRWebGLLayer(r,i,{compositionDisabled:"inline"==r.mode}),outputContext:o?o.getContext("xrpresent"):null}),r.requestReferenceSpace(n.isMobileDevice?"local":"local-floor").catch((function(t){return console.log("Falling back to identity reference space"),r.requestReferenceSpace("viewer").then((function(t){return t.getOffsetReferenceSpace(new XRRigidTransform({y:-1.6}))}))})).then((function(a){t.__refSpace=a,t.__stageTreeItem.setVisible(!0),t.emit("presentingChanged",{state:!0}),t.__startSession(),e()})).catch((function(t){console.warn(t.message),a("Unable to start XR Session:"+t.message)}))})).catch((function(t){console.warn(t.message)}))};n.isMobileDevice?r():t.loadHMDResources().then(r)}))};e.prototype.stopPresenting=function(){this.__session&&this.__session.end()};e.prototype.togglePresenting=function(){this.__session?this.stopPresenting():this.startPresenting()};e.prototype.getHMDCanvasSize=function(){return this.__hmdCanvasSize};e.prototype.__createController=function(t,e){console.log("creating controller:",e.handedness);var a=new vi(this,e,t);return this.__vrControllersMap[e.handedness]=a,this.__vrControllers[t]=a,this.emit("controllerAdded",{controller:a}),vrController};e.prototype.updateControllers=function(t){var e=this.__session.inputSources;for(var a=0;a<e.length;a++){var i=e[a];if(""==i.handedness||"none"==i.handedness)return;this.__vrControllers[a]||this.__createController(a,i),this.__vrControllers[a].updatePose(this.__refSpace,t,i)}};e.prototype.draw=function(t){var e=t.session.renderState.baseLayer,a=t.getViewerPose(this.__refSpace),i=a.views;if(!this.__projectionMatriciesUpdated){this.__projectionMatrices=[],this.__viewMatrices=[],this.__cameraMatrices=[],this.__region=[0,0,0,0];for(var n=0;n<i.length;n++){var r=i[n],o=new Z;o.setDataArray(r.projectionMatrix),this.__projectionMatrices[n]=o,this.__viewMatrices[n]=new Z,this.__cameraMatrices[n]=new Z;var l=e.getViewport(r);this.__region[2]=Math.max(this.__region[2],l.x+l.width),this.__region[3]=Math.max(this.__region[3],l.y+l.height)}this.__renderer.resizeFbos(this.__region[2],this.__region[3]),this.__projectionMatriciesUpdated=!0}var s=this.__renderer.gl;s.bindFramebuffer(s.FRAMEBUFFER,e.framebuffer),this.__backgroundColor&&s.clearColor.apply(s,this.__backgroundColor.asArray()),s.colorMask(!0,!0,!0,!0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var d={boundRendertarget:e.framebuffer,region:this.__region,viewports:[]};for(var c=0;c<i.length;c++){var u=i[c];this.__viewMatrices[c].setDataArray(u.transform.inverse.matrix),this.__viewMatrices[c].multiplyInPlace(this.__stageMatrix);var h=e.getViewport(u);d.viewports.push({viewMatrix:this.__viewMatrices[c],projectionMatrix:this.__projectionMatrices[c],region:[h.x,h.y,h.width,h.height]})}if(this.__vrhead.update(a),this.updateControllers(t),d.viewXfo=this.__vrhead.getTreeItem().getGlobalXfo(),d.viewScale=1/this.__stageScale,d.cameraMatrix=d.viewXfo.toMat4(),d.region=this.__region,d.vrPresenting=!0,this.__renderer.drawScene(d),this.capturedElement){var m={viewport:this};this.capturedElement.onMouseMove(m)}var p={interfaceType:"VR",hmd:this.__hmd,viewXfo:d.viewXfo,controllers:this.__vrControllers,vrviewport:this};this.emit("viewChanged",p)};e.prototype.setCapture=function(t){this.capturedElement=t};e.prototype.getCapture=function(){return this.capturedElement};e.prototype.releaseCapture=function(){this.capturedElement=null,this.renderGeomDataFbo()};return e}(Zi);var Ii=void 0,Ri=!1,xi=!1;var Si={};var Wi=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;if(i=t.call(this)||this,n.gpuDesc){i.__shaders={},i.__passes={},i.__passCallbacks=[],i.__childItemAdded=i.__childItemAdded.bind(i),i.__childItemRemoved=i.__childItemRemoved.bind(i),i.__viewports=[],i.__activeViewport=void 0,i.__continuousDrawing=!1,i.__redrawRequested=!1,i.__isMobile=n.isMobileDevice,i.__drawSuspensionLevel=1,i.__shaderDirectives={},i.__preproc={},i.__xrViewportPresenting=!1,i.renderGeomDataFbos=i.renderGeomDataFbos.bind(i),i.requestRedraw=i.requestRedraw.bind(i),i.setupWebGL(e,a.webglOptions?a.webglOptions:{}),i.bindEventHandlers();for(var r in Si)for(var o=0,l=Si[r];o<l.length;o++){var s=l[o];i.addPass(new s,r,!1)}i.addViewport("main"),i.__supportXR=void 0===a.supportXR||a.supportXR,i.__xrViewport=void 0,i.__xrViewportPromise=new Promise((function(t,e){if(i.__supportXR&&navigator.xr){var a=function(){i.__gl.makeXRCompatible().then((function(){i.__xrViewport=i.__setupXRViewport(),i.emit("xrViewportSetup",{xrViewport:i.__xrViewport}),t(i.__xrViewport)}))};navigator.xr.supportsSessionMode?navigator.xr.supportsSessionMode("immersive-vr").then(a).catch((function(t){console.warn("Unable to setup XR:"+t)})):navigator.xr.isSessionSupported("immersive-vr").then((function(t){t&&a()})).catch((function(t){console.warn("Unable to setup XR:"+t)}))}}))}else console.warn("Unable to create renderer");return i}e.prototype.addShaderPreprocessorDirective=function(t,e){this.__shaderDirectives[t]=e?"#define "+t+" = "+e:"#define "+t;var a=[];for(var i in this.__shaderDirectives)a.push(this.__shaderDirectives[i]);this.__preproc.defines=a.join("\n")+"\n",this.__gl.shaderopts=this.__preproc};e.prototype.getShaderPreproc=function(){return this.__preproc};e.prototype.getWidth=function(){return this.__glcanvas.width};e.prototype.getHeight=function(){return this.__glcanvas.height};e.prototype.addViewport=function(t){var e=this;var a=new Gi(this,t,this.getWidth(),this.getHeight());a.createGeomDataFbo(this.__floatGeomBuffer);return a.addListener("updated",(function(){e.requestRedraw()})),a.addListener("viewChanged",(function(t){e.__xrViewportPresenting||e.emit("viewChanged",t)})),this.__viewports.push(a),a};e.prototype.getViewport=function(t){if(t===void 0){t=0}return this.__viewports[t]};e.prototype.getViewportAtPos=function(t,e){for(var a=0,i=this.__viewports;a<i.length;a++){var n=i[a];var r=n.getPosX(),o=n.getPosY(),l=n.getWidth(),s=n.getHeight();if(t>=r&&e>=o&&t<=l+r&&e<=s+o)return n}};e.prototype.activateViewport=function(t){this.__activeViewport!=t&&(this.__activeViewport=t)};e.prototype.activateViewportAtPos=function(t,e){if(this.__xrViewportPresenting)return;var a=this.getViewportAtPos(t,e);a&&a!=this.__activeViewport&&this.activateViewport(a)};e.prototype.getActiveViewport=function(){return this.__xrViewportPresenting?this.__xrViewport:this.__activeViewport};e.prototype.suspendDrawing=function(){this.__drawSuspensionLevel++};e.prototype.resumeDrawing=function(){this.__drawSuspensionLevel--,0==this.__drawSuspensionLevel&&(this.__loadingImg&&this.__glcanvasDiv.removeChild(this.__loadingImg),this.renderGeomDataFbos(),this.requestRedraw())};e.prototype.renderGeomDataFbos=function(){var t=this;if(1==this.__renderGeomDataFbosRequested)return;this.__renderGeomDataFbosRequested=!0;window.requestAnimationFrame((function(){for(var e=0,a=t.__viewports;e<a.length;e++){var i=a[e];i.renderGeomDataFbo()}t.__renderGeomDataFbosRequested=!1}))};e.prototype.setupGrid=function(t,e,a,i){return console.warn("Deprecated Method. Please use scene.setupGrid"),this.__scene.setupGrid(t,a,e)};e.prototype.getScene=function(){return this.__scene};e.prototype.setScene=function(t){this.__scene=t,this.addTreeItem(this.__scene.getRoot()),this.__gizmoContext&&this.__gizmoContext.setSelectionManager(t.getSelectionManager()),this.emit("sceneSet",{scene:this.__scene})};e.prototype.__childItemAdded=function(t){this.addTreeItem(t.childItem)};e.prototype.__childItemRemoved=function(t){this.removeTreeItem(t.childItem)};e.prototype.addTreeItem=function(t){if(t instanceof ta){for(var e=0,a=this.__passCallbacks;e<a.length;e++){var i=a[e];var n={continueInSubTree:!0};if(i.itemAddedFn(t,n)){if(!n.continueInSubTree)return;break}}for(var r=0,o=t.getChildren();r<o.length;r++){var l=o[r];l&&this.addTreeItem(l)}t.addListener("childAdded",this.__childItemAdded),t.addListener("childRemoved",this.__childItemRemoved),this.renderGeomDataFbos()}};e.prototype.removeTreeItem=function(t){if(t instanceof ta){t.removeListener("childAdded",this.__childItemAdded),t.removeListener("childRemoved",this.__childItemRemoved);for(var e=0,a=this.__passCallbacks;e<a.length;e++){var i=a[e];if(!i.itemRemovedFn)continue;var n={continueInSubTree:!0};if(i.itemRemovedFn(t,n)){if(!n.continueInSubTree)return;break}}for(var r=0,o=t.getChildren();r<o.length;r++){var l=o[r];l&&this.removeTreeItem(l)}this.renderGeomDataFbos()}};Object.defineProperty(e.prototype,"gl",{get:function(){return this.__gl},enumerable:true,configurable:true});e.prototype.getGL=function(){return this.__gl};e.prototype.resizeFbos=function(t,e){};e.prototype.__onResize=function(){if(!this.__xrViewportPresenting){var t=1;this.__glcanvas.width=this.__glcanvas.clientWidth*t,this.__glcanvas.height=this.__glcanvas.clientHeight*t;for(var e=0,a=this.__viewports;e<a.length;e++){var i=a[e];i.resize(this.__glcanvas.width,this.__glcanvas.height)}this.resizeFbos(this.__glcanvas.width,this.__glcanvas.height),this.emit("resized",{width:this.__glcanvas.width,height:this.__glcanvas.height}),this.requestRedraw()}};e.prototype.getDiv=function(){return this.__glcanvasDiv};e.prototype.setupWebGL=function(t,e){var a=this;this.__glcanvas=document.createElement("canvas"),this.__glcanvas.style.position=e.canvasPosition?e.canvasPosition:"absolute",this.__glcanvas.style.left="0px",this.__glcanvas.style.top="0px",this.__glcanvas.style.width="100%",this.__glcanvas.style.height="100%",this.__glcanvasDiv=t,this.__glcanvasDiv.appendChild(this.__glcanvas),i(this.__glcanvas,(function(t){a.__onResize()})),this.__onResize(),e.preserveDrawingBuffer=!0,e.stencil=!!e.stencil&&e.stencil,e.alpha=!!e.alpha&&e.alpha,e.xrCompatible=!0,this.__gl=Ta(this.__glcanvas,e),this.__gl||alert("Unable to create WebGL context. WebGL not supported."),this.__gl.renderer=this,"webgl2"==this.__gl.name&&this.addShaderPreprocessorDirective("ENABLE_ES3"),this.__gl.floatTexturesSupported&&this.addShaderPreprocessorDirective("ENABLE_FLOAT_TEXTURES"),this.__gl.screenQuad=new _i(this.__gl),this.__screenQuad=this.__gl.screenQuad,this.__floatGeomBuffer=this.__gl.floatTexturesSupported&&"Safari"!=n.browserName,this.__gl.floatGeomBuffer=this.__floatGeomBuffer};e.prototype.bindEventHandlers=function(){var t=this;var e=function(){return t.__glcanvas.width>0&&t.__glcanvas.height},a=function(e){var a=t.__glcanvas.getBoundingClientRect();e.rendererX=1*(e.clientX-a.left),e.rendererY=1*(e.clientY-a.top)};this.__glcanvas.addEventListener("mouseenter",(function(e){e.undoRedoManager=t.undoRedoManager,Ri||(Ii=t,a(e),Ii.activateViewportAtPos(e.rendererX,e.rendererY),xi=!1)})),this.__glcanvas.addEventListener("mouseleave",(function(a){if(Ii==t&&e())if(a.undoRedoManager=t.undoRedoManager,Ri)xi=!0;else{var i=Ii.getActiveViewport();i&&(i.onMouseLeave(a),a.preventDefault()),Ii=void 0}})),this.__glcanvas.addEventListener("mousedown",(function(e){e.undoRedoManager=t.undoRedoManager,a(e),Ri=!0,Ii=t,Ii.activateViewportAtPos(e.rendererX,e.rendererY);var i=Ii.getActiveViewport();return i&&i.onMouseDown(e),xi=!1,!1})),document.addEventListener("mouseup",(function(i){if(Ii!=t||!e())return;i.undoRedoManager=t.undoRedoManager,a(i),Ri=!1;var n=Ii.getActiveViewport();if(n&&n.onMouseUp(i),xi){var r=Ii.getActiveViewport();r&&(r.onMouseLeave(i),i.preventDefault()),Ii=void 0}return!1})),document.addEventListener("mousemove",(function(i){if(Ii!=t||!e())return;i.undoRedoManager=t.undoRedoManager,a(i),Ri||Ii.activateViewportAtPos(i.rendererX,i.rendererY);var n=Ii.getActiveViewport();return n&&n.onMouseMove(i),!1}));var i=function(a){if(Ii==t&&e())return Ii&&(a.undoRedoManager=t.undoRedoManager,t.onWheel(a)),!1};window.addEventListener?window.addEventListener("wheel",i,{passive:!1}):window.onmousewheel=document.onmousewheel=i,window.oncontextmenu=function(){return!1},document.addEventListener("keypress",(function(a){if(Ii!=t||!e())return;var i=String.fromCharCode(a.keyCode).toLowerCase(),n=Ii.getActiveViewport();n&&n.onKeyPressed(i,a)})),document.addEventListener("keydown",(function(a){if(Ii!=t||!e())return;var i=String.fromCharCode(a.keyCode).toLowerCase(),n=Ii.getActiveViewport();n&&n.onKeyDown(i,a)})),document.addEventListener("keyup",(function(a){if(Ii!=t||!e())return;var i=String.fromCharCode(a.keyCode).toLowerCase(),n=Ii.getActiveViewport();n&&n.onKeyUp(i,a)})),this.__glcanvas.addEventListener("touchstart",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager;for(var i=0;i<e.touches.length;i++)a(e.touches[i]);t.getViewport().onTouchStart(e)}),!1),this.__glcanvas.addEventListener("touchmove",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager;for(var i=0;i<e.touches.length;i++)a(e.touches[i]);t.getViewport().onTouchMove(e)}),!1),this.__glcanvas.addEventListener("touchend",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager;for(var i=0;i<e.touches.length;i++)a(e.touches[i]);t.getViewport().onTouchEnd(e)}),!1),this.__glcanvas.addEventListener("touchcancel",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager,t.getViewport().onTouchCancel(e)}),!1)};e.prototype.setUndoRedoManager=function(t){this.undoRedoManager=t};e.prototype.getGLCanvas=function(){return this.__glcanvas};e.prototype.getScreenQuad=function(){return this.__screenQuad};e.prototype.onWheel=function(t){this.__viewports[0].onWheel(t)};e.prototype.frameAll=function(t){if(t===void 0){t=0}this.__viewports[t].frameView([this.__scene.getRoot()])};e.prototype.getOrCreateShader=function(t){var e=this.__shaders[t];return e||(e=K.constructClass(t,this.__gl),e||console.error("Shader not registered with the SGFactory:",t),this.__shaders[t]=e),e};e.prototype.addPass=function(t,e,a){if(e===void 0){e=0}if(a===void 0){a=!0}this.__passes[e]||(this.__passes[e]=[]);var i=0;for(var n in this.__passes){if(n==e)break;i+=this.__passes[n].length}if(i+=this.__passes[e].length,t.addListener("updated",this.requestRedraw),t.init(this,i),this.__passes[e].push(t),a){var r=0;for(var o in this.__passes){var l=this.__passes[o];l.forEach((function(t,e){t.setPassIndex(r+e)})),r+=l.length}}return this.requestRedraw(),i};e.prototype.registerPass=function(t,e){this.__passCallbacks.splice(0,0,{itemAddedFn:t,itemRemovedFn:e})};e.prototype.getPass=function(t){var e=0;for(var a in this.__passes){var i=this.__passes[a];if(t-e<i.length)return i[t-e];e+=i.length}};e.prototype.findPass=function(t){for(var e in this.__passes){var a=this.__passes[e];for(var i=0,n=a;i<n.length;i++){var r=n[i];if(r.constructor==t)return r}}};e.prototype.getGizmoPass=function(){return this.__gizmoPass};e.prototype.supportsVR=function(){return console.warn("Deprecated Method. Please instead connect to the vrViewportSetup signal."),this.__supportXR&&null!=navigator.xr};e.prototype.__setupXRViewport=function(){var t=this;var e=new Vi(this),a=function(e){t.emit("viewChanged",e)};return e.addListener("presentingChanged",(function(i){var n=i.state;if(t.__xrViewportPresenting=n,n){for(var r in t.__passes){var o=t.__passes[r];for(var l=0,s=o;l<s.length;l++){var d=s[l];d.startPresenting()}}e.addListener("viewChanged",a)}else{e.removeListener("viewChanged",a),t.emit("updated",{});for(var c in t.__passes){var u=t.__passes[c];for(var h=0,m=u;h<m.length;h++){var p=m[h];p.stopPresenting()}}var f={interfaceType:"CameraAndPointer",viewXfo:t.getViewport().getCamera().getGlobalXfo()};t.emit("viewChanged",f),t.resizeFbos(t.__glcanvas.width,t.__glcanvas.height),t.requestRedraw()}})),e};e.prototype.getVRViewport=function(){return this.__xrViewport};e.prototype.getXRViewport=function(){return this.__xrViewportPromise};e.prototype.isXRViewportPresenting=function(){return this.__xrViewportPresenting};e.prototype.isContinuouslyDrawing=function(){return this.__continuousDrawing};e.prototype.startContinuousDrawing=function(){var t=this;if(this.isContinuouslyDrawing()||this.__xrViewportPresenting)return;var e=function(){t.__continuousDrawing&&!t.__xrViewportPresenting&&window.requestAnimationFrame(e);for(var a=0,i=t.__viewports;a<i.length;a++){var n=i[a];n.draw()}};this.__continuousDrawing=!0,window.requestAnimationFrame(e)};e.prototype.stopContinuousDrawing=function(){this.__continuousDrawing=!1};e.prototype.toggleContinuousDrawing=function(){this.__continuousDrawing?this.stopContinuousDrawing():this.startContinuousDrawing()};e.prototype.drawItemChanged=function(){for(var t=0,e=this.__viewports;t<e.length;t++){var a=e[t];a.invalidateGeomDataBuffer()}this.requestRedraw()};e.prototype.requestRedraw=function(){var t=this;if(this.__redrawRequested||this.__continuousDrawing||this.__xrViewportPresenting)return!1;return window.requestAnimationFrame((function(){t.__redrawRequested=!1;for(var e=0,a=t.__viewports;e<a.length;e++){var i=a[e];i.draw()}})),this.__redrawRequested=!0,!0};e.prototype.bindGLBaseRenderer=function(t){t.shaderopts=this.__preproc;var e=this.__gl;t.viewports&&1!=t.viewports.length?(t.bindRendererUnifs=function(a){var i=a.cameraMatrix;i&&e.uniformMatrix4fv(i.location,!1,t.cameraMatrix.asArray())},t.bindViewports=function(a,i){t.viewports.forEach((function(t,n){e.viewport.apply(e,t.region);var r=a.viewMatrix,o=a.projectionMatrix,l=a.eye;r&&e.uniformMatrix4fv(r.location,!1,t.viewMatrix.asArray()),o&&e.uniformMatrix4fv(o.location,!1,t.projectionMatrix.asArray()),l&&e.uniform1i(l.location,n),i()}))}):(t.bindRendererUnifs=function(a){var i=a.cameraMatrix,n=a.viewMatrix,r=a.projectionMatrix,o=a.eye;i&&e.uniformMatrix4fv(i.location,!1,t.cameraMatrix.asArray());var l=t.viewports[0];n&&e.uniformMatrix4fv(n.location,!1,l.viewMatrix.asArray()),r&&e.uniformMatrix4fv(r.location,!1,l.projectionMatrix.asArray()),o&&e.uniform1i(o.location,index)},t.bindViewports=function(t,e){return e()})};e.prototype.drawScene=function(t){for(var e in this.__passes){var a=this.__passes[e];for(var i=0,n=a;i<n.length;i++){var r=n[i];r.enabled&&r.draw(t)}}};e.prototype.drawHighlightedGeoms=function(t){this.bindGLBaseRenderer(t);for(var e in this.__passes){var a=this.__passes[e];for(var i=0,n=a;i<n.length;i++){var r=n[i];r.enabled&&r.drawHighlightedGeoms(t)}}};e.prototype.drawSceneGeomData=function(t,e){if(e===void 0){e=255}this.bindGLBaseRenderer(t);for(var a in this.__passes){if(0==(Number.parseInt(a)&e))continue;var i=this.__passes[a];for(var n=0,r=i;n<r.length;n++){var o=r[n];o.enabled&&o.drawGeomData(t)}}};e.registerPass=function(t,e){Si[e]||(Si[e]=[]),Si[e].push(t)};return e}(D);var Li={OPAQUE:1,TRANSPARENT:2,OVERLAY:4};var Ti=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.enabled=!0,e.__passIndex=0;var a=e.addParameter(new yt("Enabled",!0));a.addListener("valueChanged",(function(t){return e.enabled=a.getValue()}));return e}e.prototype.__parameterValueChanged=function(e){t.prototype.__parameterValueChanged.call(this,e),this.__renderer&&this.__renderer.requestRedraw()};e.prototype.init=function(t,e){if(null==e)throw new Error("Missing constructor argument.");this.__gl=t.gl,this.__renderer=t,this.__passIndex=e};e.prototype.setPassIndex=function(t){this.__passIndex=t};e.prototype.startPresenting=function(){};e.prototype.stopPresenting=function(){};e.prototype.draw=function(t){};e.prototype.drawHighlightedGeoms=function(t){};e.prototype.drawGeomData=function(t){};e.prototype.getGeomItemAndDist=function(t){};return e}(D);var Mi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("OutlinesShader.vertexShader","\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    v_texCoord = positions.xy+0.5;\n    gl_Position = vec4(positions.xy*2.0, 0.0, 1.0);\n}\n\n"),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("OutlinesShader.fragmentShader","\nprecision highp float;\n\nuniform sampler2D highlightDataTexture;\nuniform vec2 highlightDataTextureSize;\n\nvarying vec2 v_texCoord;\n\n\nbool isFilledPixel(vec4 p) {\n    return p.r > 0.01 || p.g > 0.01 || p.b > 0.01;\n}\nvoid accumOutlinePixel(vec2 fragCoord, inout vec4 res) {\n    vec3 p = texture2D(highlightDataTexture, fragCoord/highlightDataTextureSize).rgb;\n    if(p.r > 0.01 || p.g > 0.01 || p.b > 0.01) {\n        res.r += p.r;\n        res.g += p.g;\n        res.b += p.b;\n        res.a += 1.0;\n    }\n}\nvec4 getOutlinePixelColor(vec2 fragCoord) {\n    vec4 M = texture2D(highlightDataTexture, fragCoord/highlightDataTextureSize);\n    \n    /// To display a fill instead of an outline.\n    // return M;\n\n    if( isFilledPixel(M) ) {\n        // Note: the filled pixel has an alpha value\n        // that determines how much fill is applied\n        // The outline is a solid color. \n        return M;\n    }\n    // Search surrounding pixels for selected geoms.\n    vec4 res;\n    accumOutlinePixel(fragCoord+vec2( 1, 1), res); // NW\n    accumOutlinePixel(fragCoord+vec2(-1, 1), res); // NE\n    accumOutlinePixel(fragCoord+vec2( 1,-1), res); // SW\n    accumOutlinePixel(fragCoord+vec2(-1,-1), res); // SE\n    accumOutlinePixel(fragCoord+vec2( 0, 2), res); // NN\n    accumOutlinePixel(fragCoord+vec2(-2, 0), res); // EE\n    accumOutlinePixel(fragCoord+vec2( 2, 0), res); // WW\n    accumOutlinePixel(fragCoord+vec2( 0,-2), res); // SS\n    accumOutlinePixel(fragCoord+vec2( 1, 2), res); // NNW\n    accumOutlinePixel(fragCoord+vec2(-1, 2), res); // NNE\n    accumOutlinePixel(fragCoord+vec2(-2, 1), res); // EEN\n    accumOutlinePixel(fragCoord+vec2(-2,-1), res); // EES\n    accumOutlinePixel(fragCoord+vec2( 2, 1), res); // WWN\n    accumOutlinePixel(fragCoord+vec2( 2,-1), res); // WWS\n    accumOutlinePixel(fragCoord+vec2( 1,-2), res); // SSW\n    accumOutlinePixel(fragCoord+vec2(-1,-2), res); // SSE\n\n    if(isFilledPixel(res))\n        return vec4(res.rgb / res.a, 1.0);\n    else\n        return vec4(0.0, 0.0, 0.0, 0.0);\n}\n\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n    // fragColor = texture2D(highlightDataTexture, v_texCoord);;\n    //can also use gl_FragCoord.xy\n    mediump vec2 fragCoord = v_texCoord * highlightDataTextureSize; \n    /////////////////\n    // Selection Outlines\n    vec4 outlineColor = getOutlinePixelColor(fragCoord);\n    if(outlineColor.a > 0.0001){\n#ifndef ENABLE_ES3\n        gl_FragColor = outlineColor;\n#else\n        fragColor = outlineColor;\n#endif\n    }\n    else {\n        discard;\n    }\n}\n\n");return a}return e}(Ea);var Fi=Li.OPAQUE|Li.TRANSPARENT|Li.OVERLAY;var Ci=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;i=t.call(this,e,a,{antialias:!0,depth:!0})||this,i.__exposure=1,i.__tonemap=!0,i.__gamma=2.2,i.__glEnvMap=void 0,i.__glBackgroundMap=void 0,i.__glLightmaps={},i.__displayEnvironment=!0,i.__debugMode=0,i.__debugLightmaps=!1,i._planeDist=0,i.__cutPlaneNormal=new m(1,0,0);var r=i.__gl;i.__debugTextures=[void 0],i.addShaderPreprocessorDirective("ENABLE_INLINE_GAMMACORRECTION"),a.disableLightmaps||i.addShaderPreprocessorDirective("ENABLE_LIGHTMAPS"),a.disableTextures||i.addShaderPreprocessorDirective("ENABLE_TEXTURES"),n.isMobileDevice||a.disableSpecular||i.addShaderPreprocessorDirective("ENABLE_SPECULAR"),i.__outlineShader=new Mi(r),i.quad=new Ka(r,new Be(1,1)),i.createSelectedGeomsFbo(),i.createRayCastRenderTarget();return i}e.prototype.__bindEnvMap=function(t){if(t instanceof _e)this.__glEnvMap=t.getMetadata("gltexture"),this.__glEnvMap||("FLOAT"===t.type?(this.addShaderPreprocessorDirective("ENABLE_SPECULAR"),this.__glEnvMap=new yi(this,t,this.__preproc)):t.isStreamAtlas()?this.__glEnvMap=new GLImageStream(this.__gl,t):this.__glEnvMap=new Ma(this.__gl,t)),this.__glEnvMap.addListener("loaded",this.requestRedraw),this.__glEnvMap.addListener("updated",this.requestRedraw),this.emit("envMapAssigned",{envMap:this.__glEnvMap});else{var e=t;if(this.__glBackgroundMap=e.getMetadata("gltexture"),this.__glBackgroundMap||("FLOAT"===e.type?this.__glBackgroundMap=new Ba(gl,e):this.__glBackgroundMap=new Ma(gl,e)),this.__glBackgroundMap.addListener("loaded",this.requestRedraw),this.__glBackgroundMap.addListener("updated",this.requestRedraw),!this.__backgroundMapShader){switch(gl.__quadVertexIdsBuffer||gl.setupInstancedQuad(),e.getMapping()){case"octahedral":this.__backgroundMapShader=new hi(gl);break;case"latlong":this.__backgroundMapShader=new mi(gl);break;case"steriolatlong":this.__backgroundMapShader=new pi(gl);break;case"dualfisheye":this.__backgroundMapShader=new bi(gl);break;case"uv":default:this.__backgroundMapShader=new ui(gl)}var a=this.__backgroundMapShader.compileForTarget();this.__backgroundMapShaderBinding=Na(gl,a.attrs,gl.__quadattrbuffers,gl.__quadIndexBuffer)}}};e.prototype.getGLEnvMap=function(){return this.__glEnvMap};e.prototype.getEnvMapTex=function(){return console.warn("Deprecated Function"),this.__glEnvMap};e.prototype.setScene=function(e){var a=this;var i=e.settings.getParameter("EnvMap");null!=i.getValue()&&this.__bindEnvMap(i.getValue()),i.addListener("valueChanged",(function(){a.__bindEnvMap(i.getValue())}));var n=e.settings.getParameter("Display EnvMap");this.__displayEnvironment=n.getValue(),n.addListener("valueChanged",(function(){a.__displayEnvironment=n.getValue(),a.requestRedraw()})),t.prototype.setScene.call(this,e)};e.prototype.addTreeItem=function(e){var a=this;if(t.prototype.addTreeItem.call(this,e),e instanceof pa){var i=function(t,e){var i=e.image.getMetadata("gltexture");i||(i=new Ba(a.__gl,e.image)),i.addListener("updated",(function(t){a.requestRedraw()})),a.__glLightmaps[t]={atlasSize:e.atlasSize,glimage:i}},n=e;n.addListener("loaded",(function(){a.__glEnvMap&&n.getLightmap()&&i(n.getName(),n.getLightmap())}))}};e.prototype.removeTreeItem=function(e){t.prototype.removeTreeItem.call(this,e)};e.prototype.addViewport=function(e){return t.prototype.addViewport.call(this,e)};e.prototype.onKeyPressed=function(e,a){switch(e){case"b":this.__displayEnvironment=!this.__displayEnvironment,this.requestRedraw();break;default:t.prototype.onKeyPressed.call(this,e,a)}};Object.defineProperty(e.prototype,"exposure",{get:function(){return this.__exposure},set:function(t){this.__exposure=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"gamma",{get:function(){return this.__gamma},set:function(t){this.__gamma=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"displayEnvironment",{get:function(){return this.__displayEnvironment},set:function(t){this.__displayEnvironment=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"planeDist",{get:function(){return this._planeDist},set:function(t){this._planeDist=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cutPlaneNormal",{get:function(){return this.__cutPlaneNormal},set:function(t){this.__cutPlaneNormal=t,this.requestRedraw()},enumerable:true,configurable:true});e.prototype.resizeFbos=function(e,a){t.prototype.resizeFbos.call(this),this.__fbo&&this.__fbo.colorTexture.resize(e,a),this.__highlightedGeomsBufferFbo&&this.__highlightedGeomsBuffer.resize(e,a)};e.prototype.createSelectedGeomsFbo=function(){var t=this.__gl;this.__highlightedGeomsBuffer=new Ma(t,{type:"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:this.__glcanvas.width<=1?1:this.__glcanvas.width,height:this.__glcanvas.height<=1?1:this.__glcanvas.height}),this.__highlightedGeomsBufferFbo=new ka(t,this.__highlightedGeomsBuffer,!0),this.__highlightedGeomsBufferFbo.setClearColor([0,0,0,0])};e.prototype.getFbo=function(){return this.__fbo};e.prototype.createOffscreenFbo=function(t){if(t===void 0){t="RGB"}var e=this.__glcanvas.width,a=this.__glcanvas.height,i=this.__gl;this.__fwBuffer=new Ma(i,{type:"FLOAT",format:t,filter:"NEAREST",width:e,height:a}),this.__fbo=new ka(i,this.__fwBuffer,!0),this.__fbo.setClearColor(this.__backgroundColor.asArray())};e.prototype.createRayCastRenderTarget=function(){var t=this.__gl;this.__rayCastRenderTarget=new ei(t,{type:"FLOAT",format:"RGBA",filter:"NEAREST",width:3,height:3,numColorChannels:1}),this.__rayCastRenderTargetProjMatrix=new Z,this.rayCastDist=0,this.rayCastArea=0};e.prototype.raycastWithRay=function(t,e,a,i){if(a===void 0){a=.01}if(i===void 0){i=Fi}var n=new v;return n.setLookAt(t.start,t.start.add(t.dir)),this.raycast(n,t,e,a,i)};e.prototype.raycastWithXfo=function(t,e,a,i){if(a===void 0){a=.01}if(i===void 0){i=Fi}var n=new X(t.tr,t.ori.getZaxis().negate());return this.raycast(t,n,e,a,i)};e.prototype.raycast=function(t,e,a,i,n){if(i===void 0){i=.01}if(n===void 0){n=Fi}this.rayCastDist==a&&this.rayCastArea==i||(this.__rayCastRenderTargetProjMatrix.setOrthographicMatrix(-.5*i,.5*i,-.5*i,.5*i,0,a),this.rayCastDist=a,this.rayCastArea=i);var r=this.__gl,o={cameraMatrix:t.toMat4(),viewports:[{region:[0,0,3,3],viewMatrix:t.inverse().toMat4(),projectionMatrix:this.__rayCastRenderTargetProjMatrix,isOrthographic:!0}]};this.__rayCastRenderTarget.bindForWriting(o,!0),r.enable(r.CULL_FACE),r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.depthMask(!0),this.drawSceneGeomData(o,n),r.finish(),this.__rayCastRenderTarget.unbindForWriting(),this.__rayCastRenderTarget.bindForReading();var l=new Float32Array(36);r.readPixels(0,0,3,3,r.RGBA,r.FLOAT,l),this.__rayCastRenderTarget.unbindForReading();var s=[4,3,5,1,7];var d;for(var c=0,u=s;c<u.length;c++){var h=u[c];if(0!=l[4*h+3]){d=l.subarray(4*h,4*h+4);break}}if(!d)return;var m=63&Math.round(d[0]),p=this.getPass(m).getGeomItemAndDist(d);if(p){var f=e.start.add(e.dir.scale(p.dist));return{ray:e,intersectionPos:f,geomItem:p.geomItem,dist:p.dist,geomData:d}}};e.prototype.drawBackground=function(t){if(this.__glBackgroundMap){if(!this.__glBackgroundMap.isLoaded())return;var e=this.__gl;e.depthMask(!1),this.__backgroundMapShader.bind(t);var a=t.unifs;this.__glBackgroundMap.bindToUniform(t,a.backgroundImage),this.__backgroundMapShaderBinding.bind(t),e.drawQuad()}else this.__glEnvMap&&this.__glEnvMap.draw&&this.__glEnvMap.draw(t)};e.prototype.bindGLRenderer=function(e){var a=this;t.prototype.bindGLBaseRenderer.call(this,e),e.envMap=this.__glEnvMap,e.exposure=this.__exposure,e.gamma=this.__gamma,e.lightmaps=this.__glLightmaps,e.boundLightmap=void 0;var i=this.__gl,n=e.bindRendererUnifs;e.bindRendererUnifs=function(t){if(n(t),a.__glEnvMap){var r=t.envMapPyramid;if(r&&a.__glEnvMap.bindProbeToUniform)a.__glEnvMap.bindProbeToUniform(e,r);else{var o=t.envMapTex,l=t.envMapTexType;o&&a.__glEnvMap.bindToUniform(e,o,{textureTypeUnif:l})}}{var s=t.exposure;s&&i.uniform1f(s.location,a.__exposure)}{var d=t.gamma;d&&i.uniform1f(d.location,a.__gamma)}}};e.prototype.drawScene=function(e){if(this.bindGLRenderer(e),this.__displayEnvironment&&this.drawBackground(e),t.prototype.drawScene.call(this,e),this.__highlightedGeomsBufferFbo){var a=this.__gl;this.__highlightedGeomsBufferFbo.bindForWriting(e),this.__highlightedGeomsBufferFbo.clear(),a.disable(a.BLEND),a.enable(a.DEPTH_TEST),a.depthFunc(a.LESS),a.depthMask(!0),this.drawHighlightedGeoms(e),this.__highlightedGeomsBufferFbo.unbindForWriting(e),a.viewport.apply(a,e.region),this.__outlineShader.bind(e),a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);var i=e.unifs;this.__highlightedGeomsBuffer.bindToUniform(e,i.highlightDataTexture),a.uniform2f(i.highlightDataTextureSize.location,e.region[2],e.region[3]),this.quad.bindAndDraw(e),a.disable(a.BLEND)}this.emit("redrawOccured",{})};return e}(Wi);Ja.setShaderModule("drawItemId.glsl","\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nattribute float instancedIds;    // instanced attribute..\nuniform int instancedDraw;\nuniform int transformIndex;\n\nint getDrawItemId() {\n    if(instancedDraw == 0){\n       return transformIndex;\n    }\n    else{\n       return int(instancedIds);\n    }\n}\n\n\n#else\n\nuniform int transformIndex;\n\nint getDrawItemId() {\n    return transformIndex;\n}\n\n#endif\n\n"),Ja.setShaderModule("drawItemTexture.glsl",'\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nuniform sampler2D instancesTexture;\nuniform highp int instancesTextureSize;\n\n<%include file="GLSLUtils.glsl"/>\n\nconst int pixelsPerItem = 6;\n\nvec4 getInstanceData(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 0);\n}\n\n#else\n\nuniform vec4 drawItemData;\n\nvec4 getInstanceData(int id) {\n    return drawItemData;\n}\n\n#endif\n\n\n'),Ja.setShaderModule("modelMatrix.glsl","\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n    // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\n    vec4 col0 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 1);\n    vec4 col1 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 2);\n    vec4 col2 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 3);\n    mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\n    return transpose(result);\n    // return mat4(1.0);\n}\n\nmat4 getModelMatrix(int id) {\n    return getMatrix(instancesTexture, instancesTextureSize, id);\n}\n\n#else\n\nuniform mat4 modelMatrix;\n\nmat4 getModelMatrix(int id) {\n    return modelMatrix;\n}\n\n#endif\n\n\n"),Ja.setShaderModule("materialparams.glsl","\n\n////////////////////////\n// Material Param Helpers.\n\nvec4 getColorParamValue(vec4 value, sampler2D tex, int texType, vec2 texCoord) {\n    if(texType == 0){\n        return toLinear(value);\n    }\n    else if(texType == 1 || texType == 2){\n        // TODO: Use SRGB textures.\n        return toLinear(texture2D(tex, texCoord));\n    }\n    else if(texType == 3){\n        // Float HDR Texture\n        return texture2D(tex, texCoord);\n    }\n    else\n        return value;\n}\n\n\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\nfloat getLuminanceParamValue(float value, sampler2D tex, int texType, vec2 texCoord) {\n    if(texType == 0)\n        return value;\n    else\n        return luminanceFromRGB(texture2D(tex, texCoord).rgb);\n}\n"),Ja.setShaderModule("debugColors.glsl","\n\nfloat modI(float a, float b) {\n    float m=a-floor((a+0.5)/b)*b;\n    return floor(m+0.5);\n}\n\nvec3 getDebugColor(float id) {\n#ifdef GLSL_ES3\n    const vec3 clusterColors[4] = vec3[4]( vec3(0.0, 0.25, 0.25), vec3(0.0, 0.85, 0.25), vec3(0.0, 0.25, 0.85), vec3(0.0, 0.85, 0.85) );\n#else\n    vec3 clusterColors[8];\n    clusterColors[0] = vec3(0.0, 0.15, 0.15);\n    clusterColors[1] = vec3(0.0, 0.85, 0.15);\n    clusterColors[2] = vec3(0.0, 0.15, 0.85);\n    clusterColors[3] = vec3(0.0, 0.85, 0.85);\n    clusterColors[4] = vec3(0.75, 0.15, 0.15);\n    clusterColors[5] = vec3(0.75, 0.85, 0.15);\n    clusterColors[6] = vec3(0.75, 0.15, 0.85);\n    clusterColors[7] = vec3(0.75, 0.85, 0.85);\n#endif\n\n    if(modI(id, 8.0) == 0.0)\n        return clusterColors[0];\n    else if(modI(id, 8.0) == 1.0)\n        return clusterColors[1];\n    else if(modI(id, 8.0) == 2.0)\n        return clusterColors[2];\n    else if(modI(id, 8.0) == 3.0)\n        return clusterColors[3];\n    else if(modI(id, 8.0) == 4.0)\n        return clusterColors[4];\n    else if(modI(id, 8.0) == 5.0)\n        return clusterColors[5];\n    else if(modI(id, 8.0) == 6.0)\n        return clusterColors[6];\n    else if(modI(id, 8.0) == 7.0)\n        return clusterColors[7];\n\n    return vec3(1,0,0);\n}\n\n\n");var Ni=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("BillboardShader.vertexShader",'\nprecision highp float;\n\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 cameraMatrix;\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\ninstancedattribute float instanceIds;\n\n<%include file="GLSLUtils.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="utils/imageAtlas.glsl"/>\n\nuniform sampler2D atlasBillboards_layout;\nuniform vec4 atlasBillboards_desc;\n\nuniform sampler2D instancesTexture;\nuniform int instancesTextureSize;\n\n\nconst int cols_per_instance = 5;\n\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n  // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\n  vec4 col0 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 0);\n  vec4 col1 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 1);\n  vec4 col2 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 2);\n  mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\n  return transpose(result);\n  // return mat4(1.0);\n}\n\nmat4 getModelMatrix(int id) {\n  return getMatrix(instancesTexture, instancesTextureSize, id);\n}\nvec4 getInstanceData(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 3);\n}\nvec4 getTintColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 4);\n}\n\n\n#else\n\nuniform vec4 atlasBillboards_desc;\n\nuniform mat4 modelMatrix;\nuniform vec4 billboardData;\nuniform vec4 tintColor;\nuniform vec4 layoutData;\n\n#endif\n\nuniform int inVR;\n\nmat4 calcLookAtMatrix(vec3 origin, vec3 target, float roll) {\n  // vec3 rr = vec3(sin(roll), 0.0, cos(roll));\n  vec3 rr = vec3(0.0, 0.0, 1.0);\n  vec3 ww = normalize(target - origin);\n  vec3 uu = normalize(cross(rr, ww));\n  vec3 vv = normalize(cross(ww, uu));\n\n  return mat4(vec4(uu, 0.0), vec4(vv, 0.0), vec4(ww, 0.0), vec4(origin, 1.0));\n}\n\nfloat map(float value, float inMin, float inMax, float outMin, float outMax) {\n  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);\n}\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\n\nvoid main(void) {\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\n  int instanceID = int(instanceIds);\n\n  mat4 modelMatrix = getModelMatrix(instanceID);\n  vec4 billboardData = getInstanceData(instanceID);\n  vec4 layoutData = fetchTexel(atlasBillboards_layout, int(atlasBillboards_desc.z), int(billboardData.z));\n  v_tint = getTintColor(instanceID);\n\n#else\n\n  v_tint = tintColor;\n\n#endif\n\n  vec2 quadVertex = getQuadVertexPositionFromID();\n\n\n  v_texCoord = vec2(quadVertex.x, -quadVertex.y) + 0.5;\n  v_alpha = billboardData.w;\n  v_texCoord *= layoutData.zw;\n  v_texCoord += layoutData.xy;\n\n  float scl = billboardData.x;\n  float width = layoutData.z * atlasBillboards_desc.x * scl;\n  float height = layoutData.w * atlasBillboards_desc.y * scl;\n  int flags = int(billboardData.y);\n  bool alignedToCamera = (flags & (1<<2)) != 0;\n  mat4 modelViewProjectionMatrix;\n  if(alignedToCamera){\n    if (inVR == 0) {\n      gl_Position = (viewMatrix * modelMatrix) * vec4(0.0, 0.0, 0.0, 1.0);\n      gl_Position += vec4(quadVertex.x * width, (quadVertex.y + 0.5) * height, 0.0, 0.0);\n      gl_Position = projectionMatrix * gl_Position;\n    } else {\n      vec3 cameraPos = vec3(cameraMatrix[3][0], cameraMatrix[3][1], cameraMatrix[3][2]);\n      vec3 billboardPos = vec3(modelMatrix[3][0], modelMatrix[3][1], modelMatrix[3][2]);\n      mat4 lookAt = calcLookAtMatrix(billboardPos, cameraPos, 0.0);\n      mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * lookAt;\n      gl_Position = modelViewProjectionMatrix * vec4(quadVertex.x * width, (quadVertex.y + 0.5) * height, 0.0, 1.0);\n    }\n  }\n  else{\n    modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(quadVertex.x * width, (quadVertex.y + 0.5) * height, 0.0, 1.0);\n  }\n\n  // Note: nowhere are we setting this flag\n  bool drawOnTop = (flags & (1<<3)) != 0;\n  if(drawOnTop){\n    gl_Position.z -= 0.05;\n  }\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("BillboardShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="materialparams.glsl"/>\n<%include file="utils/imageAtlas.glsl"/>\n\nuniform sampler2D atlasBillboards;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\n\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = texture2D(atlasBillboards, v_texCoord) * v_tint;\n  fragColor.a *= v_alpha;\n\n  // fragColor.r = 1.0;\n  // fragColor.a = 1.0;\n  \n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}return e}(Ea);var Yi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("DepthMapShader.vertexShader","\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 modelMatrix;\nuniform mat4 lightViewMatrix;\nuniform mat4 lightProjectionMatrix;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n\nvoid main(void) {\n  mat4 modelViewMatrix = lightViewMatrix * modelMatrix;\n  v_viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = lightProjectionMatrix * v_viewPos;\n}\n\n"),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("DepthMapShader.fragmentShader","\n#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\nuniform float near;\nuniform float far;\n\nvarying vec3 v_viewPos;\n\nfloat linstep(float edge0, float edge1, float value){\n  return clamp((value-edge0)/(edge1-edge0), 0.0, 1.0);\n}\n\nvoid main(void) {\n  float depth = linstep(near, far, -v_viewPos.z);\n  //gl_FragColor = vec4(depth, depth, depth,  1.0);\n\n  float dx = dFdx(depth);\n  float dy = dFdy(depth);\n  gl_FragColor = vec4(depth, pow(depth, 2.0) + 0.25*(dx*dx + dy*dy), 0.0, 1.0);\n}\n");return a}return e}(Ea);var Ki=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("EnvProjectionShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 projectionCenter;\n\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n \nvoid main()\n{\n  int drawItemId = getDrawItemId();\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n\n  gl_Position = modelViewProjectionMatrix * pos;\n\n  vec4 worldPos = modelMatrix * pos;\n  v_worldDir = worldPos.xyz - projectionCenter;\n}\n\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"projectionCenter",defaultValue:new m(0,0,1.7)}),e};return e}(Ea);var wi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("OctahedralEnvProjectionShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = dirToSphOctUv(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(Ki);K.registerClass("OctahedralEnvProjectionShader",wi);var zi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("LatLongEnvProjectionShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = latLongUVsFromDir(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(Ki);K.registerClass("LatLongEnvProjectionShader",zi);var Ui=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("FatLinesShader.vertexShader",'\nprecision highp float;\n\ninstancedattribute vec2 segmentIndices;\nattribute float vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nuniform sampler2D positionsTexture;\nuniform int positionsTextureSize;\n\nuniform float LineThickness;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  int vertexID = int(vertexIDs);\n\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  int seqentialIndex_0 = int(mod(segmentIndices.x, 2.));\n  int seqentialIndex_1 = int(mod(segmentIndices.y, 2.));\n  int index_0 = int(segmentIndices.x) / 2;\n  int index_1 = int(segmentIndices.y) / 2;\n\n  vec3 viewPos;\n  vec4 data_0 = fetchTexel(positionsTexture, positionsTextureSize, index_0);\n  vec4 data_1 = fetchTexel(positionsTexture, positionsTextureSize, index_1);\n\n  vec4 pos_0 = modelViewMatrix * vec4(data_0.xyz, 1.0);\n  vec4 pos_1 = modelViewMatrix * vec4(data_1.xyz, 1.0);\n  // Note: multiply the per-vertex line thickness with the line thickness uniform value;\n  float lineThickness_0 = LineThickness * data_0.w;\n  float lineThickness_1 = LineThickness * data_1.w;\n\n  if(vertexID < 2){\n    viewPos = pos_0.xyz;\n  }\n  else{\n    viewPos = pos_1.xyz;\n  }\n  if(pos_1 != pos_0){\n    vec3 segmentDir = normalize(pos_1.xyz - pos_0.xyz);\n    vec3 viewVector = normalize(viewPos);\n\n    if(vertexID < 2){\n      vec3 segmentStartDir = segmentDir;\n      if(seqentialIndex_0 != 0){\n        //if index_0 == 0, get the last index in the line as previous\n        int index_prev = (index_0 > 0) ? (index_0-1) : (positionsTextureSize-1);\n        vec4 data_prev = fetchTexel(positionsTexture, positionsTextureSize, index_prev);\n        vec4 pos_prev = modelViewMatrix * vec4(data_prev.xyz, 1.0);\n        segmentStartDir = normalize(segmentDir + normalize(pos_0.xyz - pos_prev.xyz));\n      }\n      vec3 startBiTangent = normalize(cross(segmentStartDir, viewVector));\n      v_viewNormal = normalize(cross(segmentStartDir, startBiTangent));\n      // Move the endpoints to overlap a bit more.\n      //viewPos -= vec3(segmentStartDir * lineThickness_0 * 0.25);\n      if(mod(vertexIDs, 2.0) == 0.0){\n        viewPos += vec3(startBiTangent * lineThickness_0);\n        v_texCoord.x = 1.0;\n      }\n      else{\n        viewPos -= vec3(startBiTangent * lineThickness_0);\n        v_texCoord.x = 0.0;\n      }\n      v_texCoord.y = 0.0;\n    }\n    else{\n      vec3 segmentEndDir = segmentDir;\n      if(seqentialIndex_1 != 0){\n        //if index_1 == numPoints-1, get the first index in the line as next\n        int index_next = (index_1 < (positionsTextureSize-1)) ? (index_1+1) : 0;\n        vec4 data_next = fetchTexel(positionsTexture, positionsTextureSize, index_next);\n        vec4 pos_next = modelViewMatrix * vec4(data_next.xyz, 1.0);\n        segmentEndDir = normalize(segmentDir + normalize(pos_next.xyz - pos_1.xyz));\n      }\n      vec3 endBiTangent = normalize(cross(segmentEndDir, viewVector));\n      v_viewNormal = normalize(cross(segmentEndDir, endBiTangent));\n      // Move the endpoints to overlap a bit more.\n      //viewPos += vec3(segmentEndDir * lineThickness_1 * 0.25);\n      if(mod(vertexIDs, 2.0) == 0.0){\n        viewPos += vec3(endBiTangent * lineThickness_1);\n        v_texCoord.x = 1.0;\n      }\n      else{\n        viewPos -= vec3(endBiTangent * lineThickness_1);\n        v_texCoord.x = 0.0;\n      }\n      v_texCoord.y = 1.0;\n    }\n\n    // Move the line towards the viewer by the line thickness.\n    // this is to avoid depth issues when lines are rendered over meshes. \n    viewPos.z -= (lineThickness_0 + lineThickness_1) * 0.25;\n  }\n\n  v_viewPos       = viewPos;\n  gl_Position     = projectionMatrix * vec4(viewPos, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("FatLinesShader.fragmentShader","\nprecision highp float;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\n\nuniform color BaseColor;\nuniform mat4 cameraMatrix;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int debugLevel = 0;\n  if(debugLevel == 0){\n\n    vec3 viewVector = mat3(cameraMatrix) * normalize(-v_viewPos);\n    vec3 normal = mat3(cameraMatrix) * v_viewNormal;\n    float NdotV = dot(normalize(normal), normalize(viewVector));\n\n    // Modulate the lighting using the texture coord so the line looks round.\n    NdotV *= cos((v_texCoord.x - 0.5) * 2.0);\n\n    vec4 color = BaseColor * NdotV;\n    fragColor = vec4(color.rgb, BaseColor.a);\n  }\n  else{\n    fragColor = vec4(v_texCoord.x, 0.0, 0.0, 1.0);\n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n"),a.finalize();return a}e.prototype.bind=function(e){return!!t.prototype.bind.call(this,e)&&(e.supportsInstancing=!1,!0)};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e.push({name:"Opacity",defaultValue:1}),e};return e}(Ea);K.registerClass("FatLinesShader",Ui),Ja.setShaderModule("stack-gl/gamma.glsl","\n\nconst float gamma_const = 2.2;\n\nfloat toLinear(float v) {\n  return pow(v, gamma_const);\n}\n\nvec2 toLinear(vec2 v) {\n  return pow(v, vec2(gamma_const));\n}\n\nvec3 toLinear(vec3 v) {\n  return pow(v, vec3(gamma_const));\n}\n\nvec4 toLinear(vec4 v) {\n  return vec4(toLinear(v.rgb), v.a);\n}\n\n\nfloat toGamma(float v) {\n  return pow(v, 1.0 / gamma_const);\n}\n\nvec2 toGamma(vec2 v) {\n  return pow(v, vec2(1.0 / gamma_const));\n}\n\nvec3 toGamma(vec3 v) {\n  return pow(v, vec3(1.0 / gamma_const));\n}\n\nvec4 toGamma(vec4 v) {\n  return vec4(toGamma(v.rgb), v.a);\n}\n\nfloat toGamma(float v, float gamma) {\n  return pow(v, 1.0 / gamma);\n}\n\nvec2 toGamma(vec2 v, float gamma) {\n  return pow(v, vec2(1.0 / gamma));\n}\n\nvec3 toGamma(vec3 v, float gamma) {\n  return pow(v, vec3(1.0 / gamma));\n}\n\nvec4 toGamma(vec4 v, float gamma) {\n  return vec4(toGamma(v.rgb, gamma), v.a);\n}\n\n\n");var Ji=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("FlatSurfaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n    vec4 viewPos = (modelViewMatrix * vec4(positions, 1.0));\n    gl_Position = projectionMatrix * viewPos;\n\n    v_viewPos = viewPos.xyz;\n    v_textureCoord = texCoords;\n    v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("FlatSurfaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Ea);K.registerClass("FlatSurfaceShader",Ji);var Pi=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(Ji);K.registerClass("FlatAlphaSurfaceShader",Pi),Ja.setShaderModule("math/constants.glsl","\n\n#define PI 3.141592653589793\n#define TwoPI (2.0 * PI)\n#define HalfPI (0.5 * PI)\n\n"),Ja.setShaderModule("GGX_Specular.glsl",'\n\n\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n\n// uniform ImageAtlas envMap;\n// see: GLImageAtlas.js: line 460.\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n\nvec3 sampleEnvMap(vec3 dir, float roughness) {\n    return sampleImagePyramid(dirToSphOctUv(dir), roughness, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc).rgb;\n}\n\n\n// Borrowed heavily from here: http://www.codinglabs.net/article_physically_based_rendering_cook_torrance.aspx\n\nvec3 Fresnel_Schlick(float cosT, vec3 F0)\n{\n    return F0 + (vec3(1.0)-F0) * vec3(pow( 1.0 - cosT, 5.0));\n\n    // for now we calculate this in the suface shader\n    // float schlick = reflectance + pow((1.0-reflectance)*(1.0-dot(N,V)), 5.0);\n}\n\nfloat chiGGX(float v)\n{\n    return v > 0.0 ? 1.0 : 0.0;\n}\n\nfloat saturate(float v)\n{\n    return clamp(v, 0.0, 1.0);\n}\n\nvec3 saturate(vec3 v)\n{\n    return clamp(v, vec3(0.0), vec3(1.0));\n}\n\nfloat saturatedDot( in vec3 a, in vec3 b )\n{\n    return max( dot( a, b ), 0.0 );   \n}\n\nfloat GGX_PartialGeometryTerm(vec3 v, vec3 n, vec3 h, float alpha)\n{\n    float VoH2 = saturate(dot(v,h));\n    float chi = chiGGX( VoH2 / saturate(dot(v,n)) );\n    VoH2 = VoH2 * VoH2;\n    float tan2 = ( 1.0 - VoH2 ) / VoH2;\n    return (chi * 2.0) / ( 1.0 + sqrt( 1.0 + alpha * alpha * tan2 ) );\n}\n\nvec3 GGX_Specular_PrefilteredEnv(vec3 normal, vec3 viewVector, float roughness, float fresnel)\n{\n    vec3 reflectionVector = reflect(-viewVector, normal);\n    vec3 radiance = vec3(0.0);\n    float NoV = saturate(dot(normal, viewVector));\n\n    vec3 sampleVector = reflectionVector;\n\n    // Calculate the half vector\n    vec3 halfVector = normalize(sampleVector + viewVector);\n    float cosT = saturatedDot(reflectionVector, normal);\n    float sinT = sqrt( 1.0 - cosT * cosT);\n\n    // Calculate fresnel\n    // vec3 fresnel = Fresnel_Schlick( saturate(dot( halfVector, viewVector ) ), F0 );\n    // Geometry term\n    float geometry = GGX_PartialGeometryTerm(viewVector, normal, halfVector, clamp(roughness, 0.01, 1.0)) * GGX_PartialGeometryTerm(reflectionVector, normal, halfVector, clamp(roughness, 0.01, 1.0));\n\n    // Calculate the Cook-Torrance denominator\n    float denominator = clamp( 4.0 * (NoV * saturate(dot(halfVector, normal)) + 0.05), 0.0, 1.0 );\n    // kS += fresnel;\n\n    // Accumulate the radiance\n    vec3 envColor = sampleEnvMap(reflectionVector, roughness);\n    radiance += envColor * geometry * fresnel * sinT / denominator;\n    //radiance += envColor * fresnel; // Removing "geometry" for now until we construct a better geometric shading term\n\n    return radiance;        \n}\n'),Ja.setShaderModule("PBRSurfaceRadiance.glsl","\n\nstruct MaterialParams {\n    vec3 baseColor;\n    float metallic;\n    float roughness;\n    float reflectance;\n};\n\nvec4 pbrSpecularReflectance(in MaterialParams materialParams, vec3 normal, in vec3 viewVector) {\n\n    float NdotV = dot(normal, viewVector);\n    \n    // -------------------------- Specular Reflectance --------------------------\n    // vec3 ks = vec3(0.0);\n    // vec3 specular = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, F0, ks );\n    // vec3 kd = (vec3(1.0) - ks) * vec3(1.0 - metallic);    \n\n    float schlickFresnel = materialParams.reflectance + pow((1.0-materialParams.reflectance)*(1.0-NdotV), 5.0);\n\n    vec3 specularReflectance = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, schlickFresnel);\n\n\n    // -------------------------- Specular Occlusion --------------------------\n    // Fast and quick way of reducing specular reflection in areas that are less exposed to the environment\n    // A better approch is to try screen space specular occlusion but need to check performance and feasibility in webGL\n    //float specularOcclusion = clamp(length(irradiance), 0.01, 1.0);    \n    //specularReflectance = (specularReflectance * specularOcclusion); \n\n    return vec4(specularReflectance, schlickFresnel);\n}\n\n\nvec3 pbrSurfaceRadiance(in MaterialParams materialParams, vec3 irradiance, vec3 normal, in vec3 viewVector) {\n\n    float NdotV = dot(normal, viewVector);\n    vec3 specularReflectance;\n\n    // -------------------------- Diffuse Reflectance --------------------------\n\n    vec3 diffuseReflectance = materialParams.baseColor * irradiance;\n\n    // From the Disney dielectric BRDF    \n    // Need to check if this is useful for us but the implementation works based on their paper\n    //diffuseReflectance = (diffuseReflectance / PI); // << [PT 18-08-2018] What did this line do??? (makes everything 3.1x darker.)\n    // diffuseReflectance = vec3(mix(diffuseReflectance, diffuseReflectance * mix(0.5, 2.5, materialParams.roughness), pow(1.0 - NdotV, 5.0)));\n    diffuseReflectance = vec3(mix(diffuseReflectance, diffuseReflectance * mix(0.5, 1.0, materialParams.roughness), pow(1.0 - NdotV, 5.0)));\n\n\n    // -------------------------- Color at normal incidence --------------------------\n    \n    // Need to use 'Reflectance' here instead of 'ior'\n    //vec3 F0 = vec3(abs((1.0 - ior) / (1.0 + ior)));    \n    //F0 = F0 * F0;\n    //F0 = mix(F0, materialParams.baseColor, materialParams.metallic);      \n\n\n    // -------------------------- Specular Reflectance --------------------------\n    // vec3 ks = vec3(0.0);\n    // vec3 specular = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, F0, ks );\n    // vec3 kd = (vec3(1.0) - ks) * vec3(1.0 - metallic);    \n\n    float schlickFresnel = materialParams.reflectance + pow((1.0-materialParams.reflectance)*(1.0-NdotV), 5.0);\n\n    specularReflectance = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, schlickFresnel);\n\n\n    // -------------------------- Specular Occlusion --------------------------\n    // Fast and quick way of reducing specular reflection in areas that are less exposed to the environment\n    // A better approch is to try screen space specular occlusion but need to check performance and feasibility in webGL\n    //float specularOcclusion = clamp(length(irradiance), 0.01, 1.0);    \n    //specularReflectance = (specularReflectance * specularOcclusion);  \n      \n\n    // -------------------------- Metallic --------------------------\n    // We need to do few things given a higher > 0 metallic value\n    //      1. tint specular reflectance by the albedo color (not at grazing angles)\n    //      2. almost elliminate all diffuse reflectance (in reality metals have some diffuse due to layering (i.e. dust, prints, etc.))\n    //      3. set \"specular\" artistic value to metallic range (0.6 - 0.85)\n\n    specularReflectance = mix(specularReflectance, specularReflectance * materialParams.baseColor, materialParams.metallic);\n    diffuseReflectance = mix(diffuseReflectance, vec3(0.0,0.0,0.0), materialParams.metallic); // Leaveing at pure black for now but always need some %3 diffuse left for imperfection of pulished pure metal\n    // Would be best to compute reflectace internally and set here to 0.6-0.85 for metals\n    \n\n    // -------------------------- Final color --------------------------\n    // Energy conservation already taken into account in both the diffuse and specular reflectance\n    vec3 radiance = diffuseReflectance + specularReflectance;\n\n    // radiance = vec4( kd * diffuse + /*ks */ specular, 1);\n    return radiance;\n}\n");var Ei=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("LayeredCarPaintShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nattribute float clusterIDs;\nuniform vec2 lightmapSize;\n\n/* VS Outputs */\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    v_geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n#endif\n    // v_lightmapCoord = (lightmapCoords + geomItemData.zw) / lightmapSize;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + geomItemData.xy), 0., 1.);\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n//     v_clusterID = clusterIDs;\n// #endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("LayeredCarPaintShader.fragmentShader",'\n#ifndef ENABLE_ES3\n    #extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n<%include file="materialparams.glsl"/>\n\n/* VS Outputs */\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\nuniform sampler2D lightmap;\nuniform vec2 lightmapSize;\n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n<%include file="debugColors.glsl"/>\nuniform bool debugLightmapTexelSize;\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform color MidColorTint;\nuniform float MidColorTintReflectance;\n\nuniform float MicroflakePerturbation;\nuniform sampler2D FlakesNormalTex;\nuniform float FlakesScale;\n\n#ifdef ENABLE_SPECULAR\n\nuniform float BaseRoughness;\nuniform float BaseMetallic;\nuniform float BaseReflectance;\nuniform float GlossRoughness;\nuniform float GlossMetallic;\nuniform float GlossReflectance;\n\n#endif\n\n#ifdef ENABLE_TEXTURES\n\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n\n#endif\n\n// Followup: Normal Mapping Without Precomputed Tangents\n// http://www.thetenthplanet.de/archives/1180\nmat3 cotangent_frame( vec3 normal, vec3 position, vec2 uv )\n{\n    // get edge vectors of the pixel triangle\n    vec3 dp1 = dFdx( position );\n    vec3 dp2 = dFdy( position );\n    vec2 duv1 = dFdx( uv );\n    vec2 duv2 = dFdy( uv );\n \n    // solve the linear system\n    vec3 dp2perp = cross( dp2, normal );\n    vec3 dp1perp = cross( normal, dp1 );\n    vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 bitangent = dp2perp * duv1.y + dp1perp * duv2.y;\n \n    // construct a scale-invariant frame \n    float invmax = inversesqrt( max( dot(tangent,tangent), dot(bitangent,bitangent) ) );\n    return mat3( tangent * invmax, bitangent * invmax, normal );\n}\n\n#define WITH_NORMALMAP_UNSIGNED 1\n\nvec3 sampleNormalMap( sampler2D normalMap, vec2 texcoord )\n{\n    // assume normal, the interpolated vertex normal and \n    // viewVec, the view vector (vertex to eye)\n    vec3 map = texture2D( normalMap, texcoord ).xyz;\n#ifdef WITH_NORMALMAP_UNSIGNED\n    map = map * 255./127. - 128./127.;\n#endif\n#ifdef WITH_NORMALMAP_2CHANNEL\n    map.z = sqrt( 1. - dot( map.xy, map.xy ) );\n#endif\n#ifdef WITH_NORMALMAP_GREEN_UP\n    map.y = -map.y;\n#endif\n    return map;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n    MaterialParams material;\n\n#ifndef ENABLE_TEXTURES\n    material.baseColor      = BaseColor.rgb;\n#else\n    vec2 texCoord           = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n#endif\n\n#ifdef ENABLE_SPECULAR\n    material.roughness      = BaseRoughness;\n    material.metallic       = BaseMetallic;\n    material.reflectance    = BaseReflectance;\n#endif\n\n    vec3 irradiance = texture2D(lightmap, v_lightmapCoord).rgb;\n \n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n    if(debugLightmapTexelSize)\n    {\n        vec2 coord_texelSpace = (v_lightmapCoord * lightmapSize) - v_geomItemData.zw;\n        //vec2 coord_texelSpace = (v_textureCoord * lightmapSize);\n        float total = floor(coord_texelSpace.x) +\n                      floor(coord_texelSpace.y);\n                      \n        vec3 clustercolor = getDebugColor(v_clusterID);\n\n        if(mod(total,2.0)==0.0){\n            material.baseColor = clustercolor;\n            irradiance = vec3(1.0);\n        }\n        else{\n            material.baseColor = material.baseColor * 1.5;\n        }\n    }\n#endif\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    vec3 surfacePos = -v_viewPos;\n\n    // The vector from the camera to the surface point.\n    vec3 viewVector = mat3(cameraMatrix) * normalize(v_viewPos);\n    vec3 viewDir = normalize(viewVector);\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n\n    float NdotV = dot(normal, viewDir);\n    if(NdotV < 0.0){\n        normal = -normal;\n        NdotV = dot(normal, viewDir);\n    }\n\n#ifndef ENABLE_SPECULAR\n    vec3 radiance = material.baseColor * irradiance;\n#else\n    \n    // Mix the base color to give a multi-layered paint look.\n    material.baseColor      = mix(material.baseColor, material.baseColor * MidColorTint.rgb, (1.0-NdotV));\n\n    mat3 TBN = cotangent_frame( normal, surfacePos, v_lightmapCoord );\n    vec3 flakesNormal = TBN * -sampleNormalMap( FlakesNormalTex, (v_lightmapCoord * lightmapSize) / FlakesScale );\n    flakesNormal = normalize(mix(normal, flakesNormal, MicroflakePerturbation));\n\n    vec3 baseRadiance = pbrSurfaceRadiance(material, irradiance, flakesNormal, viewVector);\n\n    material.roughness      = GlossRoughness;\n    material.reflectance    = GlossReflectance;\n    vec4 gloss = pbrSpecularReflectance(material, normal, viewVector);\n    vec3 radiance = mix(baseRadiance, gloss.rgb, gloss.a);\n    //vec3 radiance = baseRadiance;\n\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(radiance, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);e.push({name:"BaseColor",defaultValue:new y(1,0,0)}),e.push({name:"BaseMetallic",defaultValue:0}),e.push({name:"BaseRoughness",defaultValue:.35}),e.push({name:"BaseReflectance",defaultValue:.03}),e.push({name:"MidColorTint",defaultValue:new y(1,1,1)}),e.push({name:"MidColorTintReflectance",defaultValue:.03}),e.push({name:"GlossMetallic",defaultValue:0}),e.push({name:"GlossRoughness",defaultValue:.35}),e.push({name:"GlossReflectance",defaultValue:.03});var a=new ne("flakes","ZeaEngine/FlakesNormalMap.png");return a.wrap="REPEAT",a.mipMapped=!0,e.push({name:"FlakesNormal",defaultValue:a}),e.push({name:"FlakesScale",defaultValue:.1}),e.push({name:"MicroflakePerturbation",defaultValue:.1}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Ea);K.registerClass("LayeredCarPaintShader",Ei);var Hi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("FlatShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 ProjectionCenter;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nattribute float clusterIDs;\nuniform vec2 lightmapSize;\n\n/* VS Outputs */\n// varying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    vec4 geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position     = modelViewProjectionMatrix * pos;\n\n    vec4 worldPos = modelMatrix * pos;\n    v_worldDir = worldPos.xyz - ProjectionCenter;\n\n    v_lightmapCoord = (lightmapCoords + geomItemData.zw) / lightmapSize;\n}\n');return a}return e}(Ea);K.registerClass("ShadowCatcherShader",function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("ShadowCatcherShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n\n/* VS Outputs */\nvarying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nuniform sampler2D lightmap;\nuniform float ShadowMultiplier;\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n    vec4 env = envMap;\n    if(envMapTexType != 0) {\n        vec2 texCoord = dirToSphOctUv(normalize(v_worldDir));\n        env = texture2D(envMapTex, texCoord);\n    }\n\n    vec3 irradiance = texture2D(lightmap, v_lightmapCoord).rgb * ShadowMultiplier;\n    float irradianceLum = clamp(luminanceFromRGB(irradiance), 0.0, 1.0);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(env.rgb/env.a, 1.0);\n    fragColor.rgb = mix(fragColor.rgb * irradiance, fragColor.rgb, irradianceLum);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"ProjectionCenter",defaultValue:new m(0,0,1.7)}),e.push({name:"ShadowMultiplier",defaultValue:1}),e};e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(Hi));K.registerClass("FloatingShadowCatcherShader",function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("FloatingShadowCatcherShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nuniform sampler2D lightmap;\n\nuniform float ShadowMultiplier;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    \n    float shadow = luminanceFromRGB(texture2D(lightmap, v_lightmapCoord).rgb) * ShadowMultiplier;\n\n    // This material works by multiplying the image buffer values by the luminance in the lightmap.\n    fragColor.rgb = vec3(pow(shadow, 1.0/ShadowMultiplier));\n    fragColor.a = 1.0;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');return a}e.prototype.bind=function(e,a){return"MULTIPLY"==e.pass&&t.prototype.bind.call(this,e,a)};e.isTransparent=function(){return!0};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"ShadowMultiplier",defaultValue:1}),e};return e}(Hi));var ki=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("LinesShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("LinesShader.fragmentShader","\nprecision highp float;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = BaseColor;\n    fragColor.a *= Opacity;\n    \n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n"),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e.push({name:"Opacity",defaultValue:1}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(Ea);K.registerClass("LinesShader",ki);var Bi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("NormalsShader.vertexShader",'\nprecision highp float;\n\ninstancedattribute vec3 positions;\ninstancedattribute vec3 normals;\nattribute vec2 vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nuniform float normalLength;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\n/* VS Outputs */\nvarying float v_weight;\n\nvoid main(void) {\n  mat4 modelMatrix = getModelMatrix(transformIndex);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n  if(vertexIDs.x == 0.0){\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n    v_weight = 1.0;\n  }\n  else{\n    gl_Position = modelViewProjectionMatrix * vec4(positions+(normals*normalLength), 1.0);\n    v_weight = 0.0;\n  }\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("NormalsShader.fragmentShader","\nprecision highp float;\n\nuniform color normalColor;\n\n/* VS Outputs */\nvarying float v_weight;\n\n\nvoid main(void) {\n  gl_FragColor = normalColor;\n  gl_FragColor.a = v_weight;\n}\n");return a}return e}(Ea);var Di=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("PointsShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n  gl_Position = modelViewProjectionMatrix * vec4(positions, 1.);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("PointsShader.fragmentShader","\nprecision highp float;\n\nuniform color BaseColor;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = BaseColor;\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n");return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e};return e}(Ea);K.registerClass("PointsShader",Di);var Oi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("FatPointsShader.vertexShader",'\nprecision highp float;\n\ninstancedattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform float PointSize;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  vec2 quadPointPos = getQuadVertexPositionFromID();\n  v_texCoord = quadPointPos + 0.5;\n\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.);\n\n  viewPos += vec4(vec3(quadPointPos, 0.0) * PointSize, 0.);\n\n  // Generate a quad which is 0.5 * PointSize closer towards\n  // us. This allows points to be visualized even if snug on \n  // a surface. (else they get fully clipped)\n  viewPos.z += 0.5 * PointSize;\n\n  v_drawItemId = float(getDrawItemId());\n  v_viewPos = -viewPos.xyz;\n  \n  gl_Position = projectionMatrix * viewPos;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("FatPointsShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n\nuniform color BaseColor;\nuniform float Rounded;\nuniform float BorderWidth;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n  if(dist > 0.5 - (BorderWidth * 0.5))\n    fragColor = vec4(0.,0.,0.,1.);\n  else {\n    // Modulate the lighting using the texture coord so the point looks round.\n    float NdotV = cos(dist * PI);\n\n    fragColor = BaseColor * mix(1.0, NdotV, Rounded);\n  }\n  \n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}e.prototype.bind=function(e){return!!t.prototype.bind.call(this,e)&&(e.supportsInstancing=!1,!0)};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e.push({name:"PointSize",defaultValue:.05}),e.push({name:"Rounded",defaultValue:1}),e.push({name:"BorderWidth",defaultValue:.2}),e};e.getGeomDataShaderName=function(){return"FatPointsGeomDataShader"};e.getSelectedShaderName=function(){return"FatPointsSelectedShader"};return e}(Ea);var Qi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("FatPointsGeomDataShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n    \n\n  float viewDist = length(v_viewPos);\n\n  if(floatGeomBuffer != 0) {\n    fragColor.r = float(passId); \n    fragColor.g = float(v_drawItemId);\n    fragColor.b = 0.0;// TODO: store poly-id or something.\n    fragColor.a = viewDist;\n  }\n  else {\n    ///////////////////////////////////\n    // UInt8 buffer\n    fragColor.r = (mod(v_drawItemId, 256.) + 0.5) / 255.;\n    fragColor.g = (floor(v_drawItemId / 256.) + 0.5) / 255.;\n\n    // encode the dist as a 16 bit float\n    vec2 float16bits = encode16BitFloatInto2xUInt8(viewDist);\n    fragColor.b = float16bits.x;\n    fragColor.a = float16bits.y;\n  }\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}return e}(Oi);var Ai=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("FatPointsSelectedShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n\n<%include file="drawItemTexture.glsl"/>\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n    return highlightColor;\n}\n\n#endif\n\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n  \n  int drawItemId = int(v_drawItemId + 0.5);\n  fragColor = getHighlightColor(drawItemId);\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}return e}(Oi);K.registerClass("FatPointsShader",Oi),K.registerClass("FatPointsGeomDataShader",Qi),K.registerClass("FatPointsSelectedShader",Ai),Ja.setShaderModule("pragmatic-pbr/exposure.glsl","\n\n/*\n* Get an exposure using the Saturation-based Speed method.\n*/\nfloat getSaturationBasedExposure(float aperture,\n                                 float shutterSpeed,\n                                 float iso)\n{\n    float l_max = (7800.0 / 65.0) * sqrt(aperture) / (iso * shutterSpeed);\n    return 1.0 / l_max;\n}\n\n//White balance middle grey we are targetting for a good scene exposure\n//https://en.wikipedia.org/wiki/Middle_gray\nconst float MIDDLE_GREY = 0.18;\n\n/*\n* Get an exposure using the Standard Output Sensitivity method.\n* Accepts an additional parameter of the target middle grey.\n*/\nfloat getStandardOutputBasedExposure(float aperture,\n                                     float shutterSpeed,\n                                     float iso)\n{\n    //https://placeholderart.wordpress.com/2014/11/21/implementing-a-physically-based-camera-manual-exposure/\n    //https://en.wikipedia.org/wiki/Film_speed#Standard_output_sensitivity_.28SOS.29\n    //photometric exposure magic\n    //represents the properties of lens\n    float q = 0.65;\n\n    //float l_avg = (1000.0f / 65.0f) * sqrt(aperture) / (iso * shutterSpeed);\n    float l_avg = (1.0 / q) * sqrt(aperture) / (iso * shutterSpeed);\n    //float l_avg = sqrt(aperture) / (iso * shutterSpeed);\n    return MIDDLE_GREY / l_avg;\n}\n\n"),Ja.setShaderModule("pragmatic-pbr/tonemap-filmic.glsl","\n\n//Based on Filmic Tonemapping Operators http://filmicgames.com/archives/75\nvec3 tonemapFilmic(vec3 color) {\n    vec3 x = max(vec3(0.0), color - 0.004);\n    return (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);\n}\n\n"),Ja.setShaderModule("mattdesl/fxaa-texcoords.glsl","\n//To save 9 dependent texture reads, you can compute\n//these in the vertex shader and use the optimized\n//frag.glsl function in your frag shader. \n\n//This is best suited for mobile devices, like iOS.\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\n"),Ja.setShaderModule("mattdesl/fxaa.glsl",'\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n--\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\nCopyright (c) 2011 by Armin Ronacher.\nSome rights reserved.\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent \n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE, \n            vec2 v_rgbSW, vec2 v_rgbSE, \n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n'),Ja.setShaderModule("mattdesl/fxaa-apply.glsl",'\n\n<%include file="mattdesl/fxaa.glsl"/>\n\nvec4 apply(sampler2D tex, vec2 fragCoord, vec2 resolution) {\n    mediump vec2 v_rgbNW;\n    mediump vec2 v_rgbNE;\n    mediump vec2 v_rgbSW;\n    mediump vec2 v_rgbSE;\n    mediump vec2 v_rgbM;\n\n    //compute the texture coords\n    texcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n    \n    //compute FXAA\n    return fxaa(tex, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\n');var ji=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("PostProcessing.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n<%include file="mattdesl/fxaa-texcoords.glsl"/>\n\nuniform vec2 textureSize;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n\n    vec2 fragCoord = v_texCoord * textureSize;\n    texcoords(fragCoord, textureSize, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("PostProcessing.fragmentShader",'\nprecision highp float;\n\n<%include file="pragmatic-pbr/exposure.glsl"/>\n<%include file="pragmatic-pbr/tonemap-filmic.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n\n<%include file="mattdesl/fxaa.glsl"/>\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D texture;\nuniform vec2 textureSize;\n\nuniform bool antialiase;\nuniform bool tonemap;\nuniform float exposure;\nuniform float gamma;\n\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n    //can also use gl_FragCoord.xy\n    mediump vec2 fragCoord = v_texCoord * textureSize; \n\n    if (antialiase) {\n        fragColor = fxaa(texture, fragCoord, textureSize, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n    } else {\n        fragColor = texture2D(texture, v_texCoord);\n    }\n    \n    //fragColor.rgb *= getStandardOutputBasedExposure(aperture, shutterSpeed, iso);\n    fragColor.rgb *= exposure;\n    \n    if (tonemap) \n        fragColor.rgb = tonemapFilmic(fragColor.rgb);\n    else\n        fragColor.rgb = toGamma(fragColor.rgb, gamma);\n\n    \n    //fragColor.rgb = toGamma(fragColor.rgb, gamma);\n    \n    fragColor.a = 1.0;\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}'),a.finalize();return a}return e}(Ea);var qi=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("SimpleSurfaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    v_geomItemData  = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n    // v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n#endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("SimpleSurfaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_TEXTURES\n\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\nuniform sampler2D OpacityTex;\nuniform int OpacityTexType;\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\n\nvoid main(void) {\n    int drawItemId = int(v_drawItemId + 0.5);\n\n    int flags = int(v_geomItemData.r + 0.5);\n    // Cutaways\n    if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) \n    {\n        vec4 cutAwayData   = getCutaway(drawItemId);\n        vec3 planeNormal = cutAwayData.xyz;\n        float planeDist = cutAwayData.w;\n        if(cutaway(v_worldPos, planeNormal, planeDist)){\n            discard;\n            return;\n        }\n        else if(!gl_FrontFacing){\n            fragColor = cutColor;\n#ifndef ENABLE_ES3\n            gl_FragColor = fragColor;\n#endif\n            return;\n        }\n    }\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor      = BaseColor;\n    float opacity       = baseColor.a * Opacity;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n    float opacity       = baseColor.a * getLuminanceParamValue(Opacity, OpacityTex, OpacityTexType, v_textureCoord);\n#endif\n\n    // Hacky simple irradiance. \n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * v_viewNormal);\n    float ndotv = dot(normal, viewVector);\n    if(ndotv < 0.0){\n        normal = -normal;\n        ndotv = dot(normal, viewVector);\n\n        // Note: these 2 lines can be used to debug inverted meshes.\n        //baseColor = vec4(1.0, 0.0, 0.0, 1.0);\n        //ndotv = 1.0;\n    }\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = vec4(ndotv * baseColor.rgb, opacity);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e.push({name:"Opacity",defaultValue:1,range:[0,1]}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Ea);K.registerClass("SimpleSurfaceShader",qi),Ja.setShaderModule("cutaways.glsl","\n\n\nconst int GEOMITEM_FLAG_CUTAWAY =  1; // 1<<0;\n\n#define RAY_EPS 0.0000001\nstruct Ray {\n    vec3 start;\n    vec3 dir;\n};\n\nfloat intersectRayPlane(Ray ray, Ray plane) {\n    vec3 w = ray.start - plane.start;\n    float D = dot(plane.dir, ray.dir);\n    float N = dot(-plane.dir, w);\n\n    if (abs(D) < RAY_EPS) {\n        // segment is parallel to plane\n        if (N == 0.0)\n            return -1.0; // segment lies in plane\n        else\n            return -1.0; // no intersection\n    }\n    // they are not parallel\n    // compute intersect param\n    float sI = N / D;\n    if (sI < -RAY_EPS) {\n        return -1.0; // no intersection\n    }\n    return sI;\n}\n\n\nbool cutaway(vec3 worldPos, vec3 planeNormal, float planeDist) {\n\n    vec3 planePos = planeNormal * planeDist;\n    vec3 planeDir = worldPos + planePos;\n    float planeOffset = dot(planeDir, planeNormal);\n    if(planeOffset > 0.0){\n        return true;\n    }\n    return  false;\n}\n");var $i=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("StandardSurfaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n// attribute float clusterIDs;\n// uniform vec2 lightmapSize;\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    v_geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n#endif\n\n    // v_lightmapCoord = (lightmapCoords + v_geomItemData.zw) / lightmapSize;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + v_geomItemData.zw), 0., 1.);\n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n    v_clusterID = clusterIDs;\n#endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("StandardSurfaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\n// uniform sampler2D lightmap;\n// uniform bool lightmapConnected;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// <%include file="debugColors.glsl"/>\n// uniform vec2 lightmapSize;\n// uniform bool debugLightmapTexelSize;\n// #endif\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform float EmissiveStrength;\n\n\n#ifdef ENABLE_SPECULAR\nuniform float Roughness;\nuniform float Metallic;\nuniform float Reflectance;\n#endif\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n\n#ifdef ENABLE_SPECULAR\nuniform sampler2D RoughnessTex;\nuniform int RoughnessTexType;\n\nuniform sampler2D MetallicTex;\nuniform int MetallicTexType;\n\nuniform sampler2D ReflectanceTex;\nuniform int ReflectanceTexType;\n\nuniform sampler2D NormalTex;\nuniform int NormalTexType;\n// uniform float NormalScale;\n#endif\n\nuniform sampler2D EmissiveStrengthTex;\nuniform int EmissiveStrengthTexType;\n\n\n#endif\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n\n#endif\n\nvoid main(void) {\n    int drawItemId = int(v_drawItemId + 0.5);\n\n    int flags = int(v_geomItemData.r + 0.5);\n    // Cutaways\n    if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n        vec4 cutAwayData   = getCutaway(drawItemId);\n        vec3 planeNormal = cutAwayData.xyz;\n        float planeDist = cutAwayData.w;\n        if(cutaway(v_worldPos, planeNormal, planeDist)){\n            discard;\n            return;\n        }\n        else if(!gl_FrontFacing){\n            fragColor = cutColor;\n#ifndef ENABLE_ES3\n            gl_FragColor = fragColor;\n#endif\n            return;\n        }\n    }\n\n\n    MaterialParams material;\n\n#ifndef ENABLE_TEXTURES\n    material.BaseColor     = BaseColor.rgb;\n    float emission         = EmissiveStrength;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness     = Roughness;\n    material.metallic      = Metallic;\n    material.reflectance   = Reflectance;\n#endif\n\n#else\n    // Planar YZ projection for texturing, repeating every meter.\n    // vec2 texCoord       = v_worldPos.xz * 0.2;\n    vec2 texCoord          = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor     = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness     = getLuminanceParamValue(Roughness, RoughnessTex, RoughnessTexType, texCoord);\n    material.metallic      = getLuminanceParamValue(Metallic, MetallicTex, MetallicTexType, texCoord);\n    material.reflectance   = getLuminanceParamValue(Reflectance, ReflectanceTex, ReflectanceTexType, texCoord);\n#endif\n    float emission         = getLuminanceParamValue(EmissiveStrength, EmissiveStrengthTex, EmissiveStrengthTexType, texCoord);\n#endif\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    //vec3 surfacePos = -v_viewPos;\n\n#ifdef ENABLE_TEXTURES\n#ifdef ENABLE_SPECULAR\n    if(NormalTexType != 0){\n        vec3 textureNormal_tangentspace = normalize(texture2D(NormalTex, texCoord).rgb * 2.0 - 1.0);\n        viewNormal = normalize(mix(viewNormal, textureNormal_tangentspace, 0.3));\n    }\n#endif\n#endif\n\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n    if(dot(normal, viewVector) < 0.0){\n        normal = -normal;\n        // Note: this line can be used to debug inverted meshes.\n        //material.baseColor = vec3(1.0, 0.0, 0.0);\n    }\n\n    vec3 irradiance;\n    // if(lightmapConnected){\n    //     irradiance = texture2D(lightmap, v_lightmapCoord).rgb;\n    // }\n    // else{\n#ifndef ENABLE_SPECULAR\n        irradiance = sampleEnvMap(normal, 1.0);\n#else\n        irradiance = vec3(dot(normal, viewVector));\n#endif\n        \n    // }\n\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n//     if(debugLightmapTexelSize)\n//     {\n//         vec2 coord_texelSpace = (v_lightmapCoord * lightmapSize) - v_geomItemData.zw;\n//         //vec2 coord_texelSpace = (v_textureCoord * lightmapSize);\n//         float total = floor(coord_texelSpace.x) +\n//                       floor(coord_texelSpace.y);\n                      \n//         vec3 clustercolor = getDebugColor(v_clusterID);\n\n//         material.metallic = 0.0;\n//         material.reflectance = 0.0;\n//         if(mod(total,2.0)==0.0){\n//             material.baseColor = clustercolor;\n//             irradiance = vec3(1.0);\n//         }\n//         else{\n//             material.baseColor = material.baseColor * 1.5;\n//         }\n//     }\n// #endif\n\n#ifndef ENABLE_SPECULAR\n    vec3 radiance = material.baseColor * irradiance;\n#else\n    vec3 radiance = pbrSurfaceRadiance(material, irradiance, normal, viewVector);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    // fragColor = vec4(material.baseColor, 1.0);\n    // fragColor = vec4(material.baseColor * irradiance, 1.0);\n    fragColor = vec4(radiance + (emission * material.baseColor), 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e.push({name:"Metallic",defaultValue:0,range:[0,1]}),e.push({name:"Roughness",defaultValue:.85,range:[0,1]}),e.push({name:"Reflectance",defaultValue:.1,range:[0,1]}),e.push({name:"EmissiveStrength",defaultValue:0,range:[0,1]}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Ea);K.registerClass("StandardSurfaceShader",$i),Ja.setShaderModule("GLSLBits.glsl",'\n    \n/////////////////////////////////////////////////////////////////\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\nfloat shift_right(float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\n  return floor(v * exp2(amt) + 0.5);\n}\n\nfloat mask_last(float v, float bits) {\n  return mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\n  from = floor(from + 0.5);\n  to = floor(to + 0.5);\n  return mask_last(shift_right(num, from), to - from);\n}\n\n/////////////////////////////////////////////////////////////////\n// https://stackoverflow.com/questions/18453302/how-do-you-pack-one-32bit-int-into-4-8bit-ints-in-glsl-webgl\n\nconst vec4 bitEnc = vec4(1.,255.,65025.,16581375.);\nconst vec4 bitDec = 1./bitEnc;\nvec4 EncodeFloatRGBA (float v) {\n    vec4 enc = bitEnc * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec2(1./255., 0.).xxxy;\n    return enc;\n}\nfloat DecodeFloatRGBA (vec4 v) {\n    return dot(v, bitDec);\n}\n\n\n\n/////////////////////////////////////////////////////////////////\n// https://gist.github.com/Flexi23/1713774\n// \nvec2 encode16BitFloatInto2xUInt8(float v){\n    vec2 c = vec2(0.);\n\n    int signum = (v >= 0.) ? 128 : 0;\n    v = abs(v);\n    int exponent = 15;\n    float limit = 1024.; // considering the bias from 2^-5 to 2^10 (==1024)\n    for(int exp = 15; exp > 0; exp--){\n        if( v < limit){\n            limit /= 2.;\n            exponent--;\n        }\n    }\n\n    float rest;\n    if(exponent == 0){\n        rest = v / limit / 2.;      // "subnormalize" implicite preceding 0. \n    }else{\n        rest = (v - limit)/limit;   // normalize accordingly to implicite preceding 1.\n    }\n\n    int mantissa = int(rest * 2048.);   // 2048 = 2^11 for the (split) 11 bit mantissa\n    int msb = mantissa / 256;           // the most significant 3 bits go into the lower part of the first byte\n    int lsb = mantissa - msb * 256;     // there go the other 8 bit of the lower significance\n\n    c.x = float(signum + exponent * 8 + msb) / 255.;    // color normalization for texture2D\n    c.y = float(lsb) / 255.;\n\n    if(v >= 2048.){\n        c.y = 1.;\n    }\n\n    return c;\n}\n\nfloat decode16BitFloatFrom2xUInt8(vec2 c){\n    float v = 0.;\n\n    int ix = int(c.x*255.); // 1st byte: 1 bit signum, 4 bits exponent, 3 bits mantissa (MSB)\n    int iy = int(c.y*255.); // 2nd byte: 8 bit mantissa (LSB)\n\n    int s = (c.x >= 0.5) ? 1 : -1;\n    ix = (s > 0) ? ix - 128 : ix;   // remove the signum bit from exponent\n    int iexp = ix / 8;              // cut off the last 3 bits of the mantissa to select the 4 exponent bits\n    int msb = ix - iexp * 8;        // subtract the exponent bits to select the 3 most significant bits of the mantissa\n\n    int norm = (iexp == 0) ? 0 : 2048;          // distinguish between normalized and subnormalized numbers\n    int mantissa = norm + msb * 256 + iy;       // implicite preceding 1 or 0 added here\n    norm = (iexp == 0) ? 1 : 0;                 // normalization toggle\n    float exponent = pow( 2., float(iexp + norm) - 16.); // -5 for the the exponent bias from 2^-5 to 2^10 plus another -11 for the normalized 12 bit mantissa \n    v = float( s * mantissa ) * exponent;\n\n    return v;\n}\n\n\n// TODO : Encoding Float32 to 4x UInt8\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\n// http://ultraist.hatenablog.com/entry/20110608/1307539319\n\n');var tn=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__shaderStages.VERTEX_SHADER=Ja.parseShader("StandardSurfaceGeomDataShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  v_drawItemId = float(drawItemId);\n  v_geomItemData = getInstanceData(drawItemId);\n\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  vec4 viewPos = modelViewMatrix * pos;\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = -viewPos.xyz;\n\n  v_drawItemID = float(getDrawItemId());\n  \n  v_worldPos      = (modelMatrix * pos).xyz;\n}\n'),i.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("StandardSurfaceGeomDataShader.fragmentShader",'\nprecision highp float;\n\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n  int drawItemId = int(v_drawItemId + 0.5);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n  int flags = int(v_geomItemData.r + 0.5);\n  // Cutaways\n  if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n      vec4 cutAwayData   = getCutaway(drawItemId);\n      vec3 planeNormal = cutAwayData.xyz;\n      float planeDist = cutAwayData.w;\n      if(cutaway(v_worldPos, planeNormal, planeDist)){\n          discard;\n          return;\n      }\n      else if(!gl_FrontFacing){\n          fragColor = cutColor;\n  #ifndef ENABLE_ES3\n          gl_FragColor = fragColor;\n  #endif\n          return;\n      }\n  }\n\n    float dist = length(v_viewPos);\n\n    if(floatGeomBuffer != 0) {\n        fragColor.r = float(passId); \n        fragColor.g = float(v_drawItemID);\n        fragColor.b = 0.0;// TODO: store poly-id or something.\n        fragColor.a = dist;\n    }\n    else {\n        ///////////////////////////////////\n        // UInt8 buffer\n        fragColor.r = (mod(v_drawItemID, 256.) + 0.5) / 255.;\n        fragColor.g = (floor(v_drawItemID / 256.) + 0.5) / 255.;\n\n\n        // encode the dist as a 16 bit float\n        vec2 float16bits = encode16BitFloatInto2xUInt8(dist);\n        fragColor.b = float16bits.x;\n        fragColor.a = float16bits.y;\n    }\n\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');return i}return e}(Ea);K.registerClass("StandardSurfaceGeomDataShader",tn);var en=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__shaderStages.VERTEX_SHADER=Ja.parseShader("StandardSurfaceSelectedGeomsShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nvarying float v_drawItemId;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n    gl_Position = projectionMatrix * viewPos;\n\n}\n'),i.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("StandardSurfaceSelectedGeomsShader.fragmentShader",'\nprecision highp float;\n\nvarying float v_drawItemId;\n\n\n<%include file="drawItemTexture.glsl"/>\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n    return highlightColor;\n}\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    int drawItemId = int(v_drawItemId + 0.5);\n    fragColor = getHighlightColor(drawItemId);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');return i}return e}(Ea);K.registerClass("StandardSurfaceSelectedGeomsShader",en);var an=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("HandleShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int maintainScreenSize;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  if(maintainScreenSize != 0) {\n    float dist = modelViewMatrix[3][2];\n    float sc = dist;\n    mat4 scmat = mat4(\n      sc, 0.0, 0.0, 0.0,\n      0.0, sc, 0.0, 0.0,\n      0.0, 0.0, sc, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n    modelViewMatrix = modelViewMatrix * scmat;\n  }\n\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = viewPos.xyz;\n  v_textureCoord = texCoords;\n  v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("HandleShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e.push({name:"maintainScreenSize",defaultValue:0}),e};e.isOverlay=function(){return!0};e.getGeomDataShaderName=function(){return"HandleGeomDataShader"};return e}(Ea);K.registerClass("HandleShader",an);var nn=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__shaderStages.VERTEX_SHADER=Ja.parseShader("HandleGeomDataShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int maintainScreenSize;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  if(maintainScreenSize != 0) {\n    float dist = modelViewMatrix[3][2];\n    float sc = dist;\n    mat4 scmat = mat4(\n      sc, 0.0, 0.0, 0.0,\n      0.0, sc, 0.0, 0.0,\n      0.0, 0.0, sc, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n    modelViewMatrix = modelViewMatrix * scmat;\n  }\n\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = -viewPos.xyz;\n\n  v_drawItemID = float(getDrawItemId());\n}\n');return i}return e}(tn);K.registerClass("HandleGeomDataShader",nn);var rn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("TransparentSurfaceShader.vertexShader",'\nprecision highp float;\n\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    vec4 geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + geomItemData.xy), 0., 1.);\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("TransparentSurfaceShader.fragmentShader",'\nprecision highp float;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n<%include file="GLSLUtils.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\nuniform float planeDist;\nuniform float planeAngle;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_SPECULAR\n<%include file="math/constants.glsl"/>\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\nuniform float Roughness;\nuniform float Metallic;\nuniform float Reflectance;\n#endif\n\n#ifdef __ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform bool BaseColorTexType;\n\nuniform sampler2D OpacityTex;\nuniform bool OpacityTexType;\n\nuniform sampler2D RoughnessTex;\nuniform bool RoughnessTexType;\n\nuniform sampler2D ReflectanceTex;\nuniform bool ReflectanceTexType;\n\nuniform sampler2D NormalTex;\nuniform bool NormalTexType;\nuniform float NormalScale;\n\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n    MaterialParams material;\n\n#ifndef __ENABLE_TEXTURES\n    material.baseColor      = BaseColor.rgb;\n    float opacity           = Opacity;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness      = Roughness;\n    material.metallic       = Metallic;\n    material.reflectance    = Reflectance;\n#endif\n\n#else\n    // Planar YZ projection for texturing, repeating every meter.\n    // vec2 texCoord        = v_worldPos.xz * 0.2;\n    vec2 texCoord           = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n    material.roughness      = getLuminanceParamValue(Roughness, RoughnessTex, RoughnessTexType, texCoord);\n    material.metallic       = getLuminanceParamValue(Metallic, MetallicTex, MetallicTexType, texCoord);\n    material.reflectance    = Reflectance;//getLuminanceParamValue(Reflectance, ReflectanceTex, ReflectanceTexType, texCoord);\n\n    float opacity           = getLuminanceParamValue(Opacity, OpacityTex, OpacityTexType, texCoords);\n#endif\n\n#ifndef ENABLE_SPECULAR\n    gl_FragColor = vec4(material.baseColor.rgb, opacity);\n#else\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    //vec3 surfacePos = -v_viewPos;\n\n#ifdef __ENABLE_TEXTURES\n    if(NormalTexType != 0){\n        vec3 textureNormal_tangentspace = normalize(texture2D(NormalTex, texCoord).rgb * 2.0 - 1.0);\n        viewNormal = normalize(mix(viewNormal, textureNormal_tangentspace, 0.3));\n    }\n#endif\n\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n    if(dot(normal, viewVector) < 0.0){\n        normal = -normal;\n        // Note: this line can be used to debug inverted meshes.\n        //material.baseColor = vec3(1.0, 0.0, 0.0);\n    }\n\n    vec4 specularReflectance = pbrSpecularReflectance(material, normal, viewVector);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(specularReflectance.rgb, mix(opacity, 1.0, specularReflectance.a));\n\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e.push({name:"Opacity",defaultValue:1,range:[0,1]}),e.push({name:"Roughness",defaultValue:.85}),e.push({name:"Reflectance",defaultValue:1e-4}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(Ea);K.registerClass("TransparentSurfaceShader",rn);var on=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("ScreenSpaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n\n    gl_Position = (modelMatrix * vec4(positions, 1.0));\n\n    v_textureCoord = texCoords;\n    v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("ScreenSpaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.isOverlay=function(){return!0};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new y(1,1,.5)}),e};e.getGeomDataShaderName=function(){return null};e.getSelectedShaderName=function(){return null};return e}(Ea);K.registerClass("ScreenSpaceShader",on);var ln=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.invisibleToGeomBuffer=!0;return a}return e}(Ji);K.registerClass("ToolIconShader",ln);var sn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("UnpackLDRAlphaImageShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("UnpackLDRAlphaImageShader.fragmentShader","\nprecision highp float;\n\nvarying vec2 v_texCoord;\nuniform sampler2D ldrSampler;\nuniform sampler2D alphaSampler;\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(texture2D(ldrSampler, v_texCoord).rgb, luminanceFromRGB(texture2D(alphaSampler, v_texCoord).rgb));\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n\n");return a}return e}(Ea);var dn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=Ja.parseShader("WireShader.vertexShader","\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n/* VS Outputs */\n\nvoid main(void) {\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n\n    // Apply the perspective transform, and then move the vertices\n    //  towards the camera by a tiny little bit...\n    gl_Position.z -= 0.001 / gl_Position.w;\n    //gl_Position.z *= 0.999;\n}\n"),a.__shaderStages.FRAGMENT_SHADER=Ja.parseShader("WireShader.fragmentShader","\nprecision highp float;\n\nuniform color wireColor;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifdef ENABLE_ES3\n    gl_FragColor = color;\n#else\n    fragColor = color;\n#endif  \n}\n");return a}return e}(Ea);var cn=0,un=1,hn=2,mn=3;var pn=function(t){__extends(e,t);function e(e,a,i,n,r){if(r===void 0){r=null}var o=this;o=t.call(this)||this,o.gl=e,o.geomItem=a,o.glGeom=i,o.id=n,o.flags=r,o.visible=o.geomItem.getVisible(),o.culled=!1,o.lightmapName=a.getLightmapName(),o.updateVisibility=o.updateVisibility.bind(o),o.updateVisibility=o.updateVisibility.bind(o),o.destroy=o.destroy.bind(o),e.floatTexturesSupported?o.updateXfo=function(){o.emit("updated",{type:cn})}:o.updateXfo=function(){o.updateGeomMatrix()};o.geomItem.addListener("geomXfoChanged",o.updateXfo),o.geomItem.addListener("visibilityChanged",o.updateVisibility),o.geomItem.addListener("cutAwayChanged",(function(){o.emit("updated",{type:cn})})),o.geomItem.addListener("destructing",o.destroy),o.highlightChangedId=o.geomItem.addListener("highlightChanged",(function(){o.emit("updated",{type:mn}),o.emit("highlightChanged")})),o.glGeom.addListener("updated",(function(){o.emit("updated",{type:un})}));var l=o.geomItem.getLightmapCoordsOffset();o.geomData=[l.x,l.y,0,0];return o}e.prototype.getGeomItem=function(){return this.geomItem};e.prototype.getGLGeom=function(){return this.glGeom};e.prototype.getVisible=function(){return this.geomItem.getVisible()};e.prototype.getId=function(){return this.id};e.prototype.getFlags=function(){return this.flags};e.prototype.updateVisibility=function(){var t=this.geomItem.getVisible()&&!this.culled;this.visible!=t&&(this.visible=t,this.emit("visibilityChanged",{visible:t}),this.emit("updated",{}))};e.prototype.setCullState=function(t){this.culled=t,this.updateVisibility()};e.prototype.updateGeomMatrix=function(){this.modelMatrixArray=this.geomItem.getGeomMat4().asArray()};e.prototype.getGeomMatrixArray=function(){return this.modelMatrixArray};e.prototype.bind=function(t){var e=this.gl,a=t.unifs;if(!e.floatTexturesSupported){var i=a.modelMatrix;i&&e.uniformMatrix4fv(i.location,!1,this.modelMatrixArray);var n=a.drawItemData;n&&e.uniform4f(n.location,this.geomData)}var r=a.transformIndex;if(r&&e.uniform1i(r.location,this.id),t.lightmaps&&a.lightmap&&t.boundLightmap!=this.lightmapName){var o=t.lightmaps[this.lightmapName];o&&o.glimage.isLoaded()?(o.glimage.bindToUniform(t,a.lightmap),e.uniform2fv(a.lightmapSize.location,o.atlasSize.asArray()),a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!0),t.boundLightmap=this.lightmapName):a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!1)}return!0};e.prototype.destroy=function(){this.geomItem.removeListener("visibilityChanged",this.updateVisibility),this.geomItem.removeListener("geomXfoChanged",this.updateXfo),this.geomItem.removeListenerById("highlightChanged",this.highlightChangedId)};return e}(L);var fn=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__drawItems=[void 0],e.__drawItemsIndexFreeList=[],e.__dirtyItemIndices=[];return e}e.prototype.init=function(e,a){var i=this;t.prototype.init.call(this,e,a),this.__renderer.registerPass((function(t){if(t instanceof ra){if(t.getMetadata("glgeomItem"))return!1;{var e=function(e){return!!i.filterGeomItem(e)&&(null==t.getGeometry()?t.addListener("geomAssigned",(function(){i.addGeomItem(e)})):i.addGeomItem(e),!0)};return null==t.getMaterial()?(console.warn("Scene item :"+t.getPath()+" has no material"),!1):e(t)}}return!1}),(function(t){return!!(t instanceof ra&&t.getMetadata("glgeomItem"))&&i.removeGeomItem(t)}))};e.prototype.filterGeomItem=function(t){return!0};e.prototype.addShader=function(t){return this.__renderer.getOrCreateShader(t.getShaderName())};e.prototype.constructShaders=function(t){var e,a;var i=this.__renderer.getOrCreateShader(t);return i.constructor.getGeomDataShaderName()&&(e=this.__renderer.getOrCreateShader(i.constructor.getGeomDataShaderName())),i.constructor.getSelectedShaderName()&&(a=this.__renderer.getOrCreateShader(i.constructor.getSelectedShaderName())),{glshader:i,glgeomdatashader:e,glselectedshader:a}};e.prototype.addMaterial=function(t){var e=this;var a=t.getMetadata("glmaterial");if(a)return a;var i=this.__renderer.getOrCreateShader(t.getShaderName());a=new ti(this.__gl,t,i);a.addListener("updated",(function(t){e.__renderer.requestRedraw()}));return t.setMetadata("glmaterial",a),a};e.prototype.addGeom=function(t){var e=t.getMetadata("glgeom");if(e)return e.addRef(this),e;var a=this.__gl;if(t instanceof Te||t instanceof Ne)e=new Ka(a,t);else if(t instanceof Le||t instanceof Ce)e=new wa(a,t);else{if(!(t instanceof We||t instanceof Fe))throw new Error("Unsupported geom type:"+t.constructor.name);e=new za(a,t)}return t.setMetadata("glgeom",e),e.addRef(this),e};e.prototype.removeGeom=function(t){var e=t.getMetadata("glgeom");if(e)return e.removeRef(this),e};e.prototype.addGeomItem=function(t){var e=this;var a=this.addGeom(t.getGeometry());var i;this.__drawItemsIndexFreeList.length>0?i=this.__drawItemsIndexFreeList.pop():(i=this.__drawItems.length,this.__drawItems.push(null)),this.__dirtyItemIndices.push(i);var n=this.__gl,r=new pn(n,t,a,i,1);t.setMetadata("glgeomItem",r);r.addListener("updated",(function(t){switch(t.type){case cn:if(-1!=e.__dirtyItemIndices.indexOf(i))return;e.__dirtyItemIndices.push(i);break;case un:case hn:break;case mn:if(-1!=e.__dirtyItemIndices.indexOf(i))return;return e.__dirtyItemIndices.push(i),void e.__renderer.requestRedraw()}e.__renderer.drawItemChanged()}));return this.__drawItems[i]=r,this.__renderer.requestRedraw(),t.setMetadata("glpass",this),r};e.prototype.removeGeomItem=function(t){if(t.getMetadata("glpass")!=this)return;var e=t.getMetadata("glgeomItem"),a=e.getId();return this.__drawItems[a]=null,this.__drawItemsIndexFreeList.push(a),this.__renderer.requestRedraw(),t.getMetadata("glpass"),t.deleteMetadata("glgeomItem"),e};e.prototype.removeGLGeom=function(t,e){var a=e.geomItemMappings.indexOf(t);e.geomItemMappings.splice(a,1)};e.prototype.getGeomItem=function(t){if(!(t>=this.__drawItems.length))return this.__drawItems[t];console.warn("Invalid Draw Item id:"+t+" NumItems:"+(this.__drawItems.length-1))};e.prototype.__populateDrawItemDataArray=function(t,e,a){var i=24*e;var n=0;if(t.isCutawayEnabled()){n|=1}var r=t.getLightmapCoordsOffset();p.createFromFloat32Buffer(a.buffer,i+0).set(n,0,r.x,r.y);var o=t.getGeomMat4(),l=p.createFromFloat32Buffer(a.buffer,i+4),s=p.createFromFloat32Buffer(a.buffer,i+8),d=p.createFromFloat32Buffer(a.buffer,i+12);l.set(o.xAxis.x,o.yAxis.x,o.zAxis.x,o.translation.x),s.set(o.xAxis.y,o.yAxis.y,o.zAxis.y,o.translation.y),d.set(o.xAxis.z,o.yAxis.z,o.zAxis.z,o.translation.z);var c=p.createFromFloat32Buffer(a.buffer,i+16);if(t.isHighlighted()){var u=t.getHighlight();c.set(u.r,u.g,u.b,u.a)}var h=p.createFromFloat32Buffer(a.buffer,i+20);if(t.isCutawayEnabled()){var m=t.getCutVector(),f=t.getCutDist();h.set(m.x,m.y,m.z,f)}};e.prototype.newItemsReadyForLoading=function(){return this.__dirtyItemIndices.length>0};e.prototype.uploadGeomItems=function(){var t=this.__gl;if(!t.floatTexturesSupported){var e=this.__dirtyItemIndices.length;for(var a=0;a<e;a++){var i=this.__drawItems[this.__dirtyItemIndices[a]];i&&i.updateGeomMatrix()}return void(this.__dirtyItemIndices=[])}var n=Math.round(Math.sqrt(6*this.__drawItems.length)+.5);n=Math.nextPow2(n),n%6!=0&&(n+=6-n%6),this.__drawItemsTexture?this.__drawItemsTexture.width!=n&&(this.__drawItemsTexture.resize(n,n),this.__dirtyItemIndices=Array(n*n/6).fill().map((function(t,e){return e}))):(this.__drawItemsTexture=new Ma(t,{format:"RGBA",type:"FLOAT",width:n,height:n,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),this.__drawItemsTexture.clear()),t.bindTexture(t.TEXTURE_2D,this.__drawItemsTexture.glTex);var r=this.__drawItemsTexture.getTypeID();for(var o=0;o<this.__dirtyItemIndices.length;o++){var l=this.__dirtyItemIndices[o],s=Math.floor(6*l/n);var d=l+1;for(var c=o+1;c<this.__dirtyItemIndices.length;c++){var u=this.__dirtyItemIndices[c];if(Math.floor(6*u/n)!=s)break;if(u!=d)break;d++}var h=d-l,m=6*l%n,p=6*h,f=1,b=new Float32Array(24*h);for(var y=l;y<d;y++){var g=this.__drawItems[y];g&&this.__populateDrawItemDataArray(g.getGeomItem(),y-l,b)}if(r==t.FLOAT)this.__drawItemsTexture.populate(b,p,f,m,s,!1);else{var _=Math.convertFloat32ArrayToUInt16Array(b);this.__drawItemsTexture.populate(_,p,f,m,s,!1)}o+=h-1}this.__dirtyItemIndices=[]};e.prototype.finalize=function(){0!=this.__dirtyItemIndices.length&&this.uploadGeomItems()};e.prototype.bind=function(t){var e=this.__gl,a=t.unifs;return this.__drawItemsTexture&&a.instancesTexture&&(this.__drawItemsTexture.bindToUniform(t,a.instancesTexture),e.uniform1i(a.instancesTextureSize.location,this.__drawItemsTexture.width)),!0};e.prototype.bindShader=function(t,e){return!!e.bind(t)&&!!this.bind(t)};e.prototype.bindMaterial=function(t,e,a){return e.bind(t,a)};return e}(Ti);var bn=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this)||this,i.gl=e,i.glgeom=a,i.glgeomItems=[],i.glgeomItems_freeIndices=[],i.glgeomItemSignalIds=[],i.drawIdsArray=null,i.drawIdsBuffer=null,i.drawIdsBufferDirty=!0,i.highlightedIdsArray=null,i.highlightedIdsBuffer=null,i.highlightedIdsBufferDirty=!0,i.lightmapName=void 0,i.visibleItems=[],i.highlightedItems=[];return i}e.prototype.getGLGeom=function(){return this.glgeom};e.prototype.getLightmapName=function(){return this.lightmapName};e.prototype.getDrawCount=function(){return this.visibleItems.length};e.prototype.addGeomItem=function(t){var e=this;var a;this.glgeomItems_freeIndices.length>0?a=this.glgeomItems_freeIndices.pop():(a=this.glgeomItems.length,this.glgeomItems.push(null)),t.visible&&(this.visibleItems.push(a),this.emit("drawCountChanged",{count:1})),t.getGeomItem().isHighlighted()&&(this.highlightedItems.push(a),this.highlightedIdsBufferDirty=!0),1==this.glgeomItems.length&&(this.lightmapName=t.getGeomItem().getLightmapName());var i={};i.hil=t.on("highlightChanged",(function(){if(t.getGeomItem().isHighlighted()){if(-1!=e.highlightedItems.indexOf(a))return;e.highlightedItems.push(a)}else e.highlightedItems.splice(e.highlightedItems.indexOf(a),1);e.highlightedIdsBufferDirty=!0}));i.vis=t.on("visibilityChanged",(function(t){t.visible?(e.visibleItems.push(a),e.emit("drawCountChanged",{count:1})):(e.visibleItems.splice(e.visibleItems.indexOf(a),1),e.emit("drawCountChanged",{count:-1})),e.drawIdsBufferDirty=!0})),this.glgeomItems[a]=t,this.glgeomItemSignalIds[a]=i,this.drawIdsBufferDirty=!0};e.prototype.removeGeomItem=function(t){var e=this.glgeomItems.indexOf(t),a=this.glgeomItemSignalIds[e];t.removeListenerById("highlightChanged",a.hil),t.removeListenerById("visibilityChanged",a.vis),this.glgeomItems[e]=null,this.glgeomItemSignalIds[e]=null,this.glgeomItems_freeIndices.push(e),t.visible&&(this.visibleItems.splice(this.visibleItems.indexOf(e),1),this.emit("drawCountChanged",{count:-1}));t.getGeomItem().isHighlighted()&&this.highlightedItems.splice(this.highlightedItems.indexOf(e),1),this.drawIdsBufferDirty=!0,0==this.glgeomItems.length&&this.destroy()};e.prototype.updateDrawIDsBuffer=function(){var t=this;var e=this.gl;e.floatTexturesSupported?(this.drawIdsBuffer&&this.glgeomItems.length!=this.drawIdsArray.length&&(this.gl.deleteBuffer(this.drawIdsBuffer),this.drawIdsBuffer=null),this.drawIdsBuffer||(this.drawIdsArray=new Float32Array(this.glgeomItems.length),this.drawIdsBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.drawIdsBuffer)),this.visibleItems.forEach((function(e,a){t.drawIdsArray[a]=t.glgeomItems[e].getId()})),e.bindBuffer(e.ARRAY_BUFFER,this.drawIdsBuffer),e.bufferData(e.ARRAY_BUFFER,this.drawIdsArray,e.STATIC_DRAW),this.drawIdsBufferDirty=!1):this.drawIdsBufferDirty=!1};e.prototype.updateHighlightedIDsBuffer=function(){var t=this;var e=this.gl;e.floatTexturesSupported?(this.highlightedIdsBuffer&&this.glgeomItems.length!=this.highlightedIdsArray.length&&(this.gl.deleteBuffer(this.highlightedIdsBuffer),this.highlightedIdsBuffer=null),(!this.highlightedIdsArray||this.highlightedItems.length>this.highlightedIdsArray.length)&&(this.highlightedIdsArray=new Float32Array(this.highlightedItems.length),this.highlightedIdsBuffer&&(e.deleteBuffer(this.highlightedIdsBuffer),this.highlightedIdsBuffer=null)),this.highlightedItems.forEach((function(e,a){t.highlightedIdsArray[a]=t.glgeomItems[e].getId()})),this.highlightedIdsBuffer||(this.highlightedIdsBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.highlightedIdsBuffer),e.bufferData(e.ARRAY_BUFFER,this.highlightedIdsArray,e.STATIC_DRAW),this.highlightedIdsBufferDirty=!1):this.highlightedIdsBufferDirty=!1};e.prototype.draw=function(t){if(0==this.visibleItems.length)return;this.drawIdsBufferDirty&&this.updateDrawIDsBuffer();var e=this.gl,a=t.unifs;if(t.lightmaps&&a.lightmap&&t.boundLightmap!=this.lightmapName){var i=t.lightmaps[this.lightmapName];i&&i.glimage.isLoaded()?(i.glimage.bindToUniform(t,a.lightmap),e.uniform2fv(a.lightmapSize.location,i.atlasSize.asArray()),a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!0),t.boundLightmap=this.lightmapName):a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!1)}this.__bindAndRender(t,this.visibleItems,this.drawIdsBuffer)};e.prototype.drawHighlighted=function(t){0!=this.highlightedItems.length&&(this.highlightedIdsBufferDirty&&this.updateHighlightedIDsBuffer(),this.__bindAndRender(t,this.highlightedItems,this.highlightedIdsBuffer))};e.prototype.__bindAndRender=function(t,e,a){var i=this;var n=this.gl,r=t.unifs;if(t.glgeom!=this.glgeom&&(this.glgeom.bind(t),t.glgeom=this.glgeom),n.floatTexturesSupported&&n.drawElementsInstanced&&t.supportsInstancing){n.uniform1i(t.unifs.instancedDraw.location,1);var o=t.attrs.instancedIds.location;n.enableVertexAttribArray(o),n.bindBuffer(n.ARRAY_BUFFER,a),n.vertexAttribPointer(o,1,n.FLOAT,!1,4,0),n.vertexAttribDivisor(o,1),t.bindViewports(r,(function(){i.glgeom.drawInstanced(e.length)}))}else t.unifs.instancedDraw&&n.uniform1i(t.unifs.instancedDraw.location,0),e.forEach((function(e){i.glgeomItems[e].bind(t),t.bindViewports(r,(function(){i.glgeom.draw(t)}))}))};e.prototype.destroy=function(){this.emit("destructing",{})};return e}(L);var yn=function(){function t(t){this.glshader=t.glshader,this.glgeomdatashader=t.glgeomdatashader,this.glselectedshader=t.glselectedshader,this.glmaterialGeomItemSets=[]}t.prototype.findMaterialGeomItemSets=function(t){for(var e=0,a=this.glmaterialGeomItemSets;e<a.length;e++){var i=a[e];if(i.glmaterial==t)return i}};t.prototype.addMaterialGeomItemSets=function(t){this.glmaterialGeomItemSets.push(t)};t.prototype.removeMaterialGeomItemSets=function(t){var e=this.glmaterialGeomItemSets.indexOf(t);this.glmaterialGeomItemSets.splice(e,1)};t.prototype.getMaterialGeomItemSets=function(){return this.glmaterialGeomItemSets};return t}();var gn=function(){function t(t){this.glmaterial=t,this.geomItemSets=[],this.drawCount=0,this.visibleInGeomDataBuffer=t.getMaterial().visibleInGeomDataBuffer,this.__drawCountChanged=this.__drawCountChanged.bind(this)}t.prototype.getGLMaterial=function(){return this.glmaterial};t.prototype.__drawCountChanged=function(t){this.drawCount+=t};t.prototype.addGeomItemSet=function(t){-1==this.geomItemSets.indexOf(t)?(this.geomItemSets.push(t),this.drawCount+=t.drawCount,t.addListener("drawCountChanged",this.__drawCountChanged)):console.warn("geomItemSet already added to GLMaterialGeomItemSets")};t.prototype.removeGeomItemSet=function(t){var e=this.geomItemSets.indexOf(t);this.geomItemSets.splice(e,1),t.removeListener("drawCountChanged",this.__drawCountChanged)};t.prototype.findGeomItemSet=function(t){for(var e=0,a=this.geomItemSets;e<a.length;e++){var i=a[e];if(i.getGLGeom()==t)return i}return null};t.prototype.getGeomItemSets=function(){return this.geomItemSets};return t}();var _n=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__glshadermaterials={};return e}e.prototype.init=function(e,a){t.prototype.init.call(this,e,a)};e.prototype.filterGeomItem=function(t){var e=t.getMaterial().getShaderClass();if(e){if(e.isTransparent())return!1;if(e.isOverlay())return!1;var a=t.getMaterial().getParameter("BaseColor");return!(a&&a.getValue().a<1)}return!1};e.prototype.addGeomItem=function(e){var a=e.getMaterial(),i=a.getShaderName(),n=this.constructShaders(i);var r=this.addMaterial(a),o=t.prototype.addGeomItem.call(this,e);var l=this.__glshadermaterials[i];l||(l=new yn(n),this.__glshadermaterials[i]=l);var s=l.findMaterialGeomItemSets(r);s||(s=new gn(r),l.addMaterialGeomItemSets(s));var d=s.findGeomItemSet(o.glGeom);return d||(d=new bn(this.__gl,o.glGeom),s.addGeomItemSet(d)),e.setMetadata("geomItemSet",d),d.addGeomItem(o),!0};e.prototype.removeGeomItem=function(e){var a=t.prototype.removeGeomItem.call(this,e);if(!a)return!1;var i=e.getMetadata("geomItemSet");return i&&(i.removeGeomItem(a),e.deleteMetadata("geomItemSet")),!0};e.prototype.removeMaterial=function(t){var e=this.__glshadermaterials[t.hash];if(!e||e!=t.getMetadata("glshaderMaterials"))return void console.warn("Material not found in pass");var a=t.getMetadata("glmaterialGeomItemSets");e.removeMaterialGeomItemSets(a)};e.prototype.__traverseTreeAndDraw=function(t){for(var e in this.__glshadermaterials){var a=this.__glshadermaterials[e],i=a.glshader;if(this.bindShader(t,i)){var n=a.getMaterialGeomItemSets();for(var r=0,o=n;r<o.length;r++){var l=o[r];if(0!=l.drawCount&&this.bindMaterial(t,l.getGLMaterial(),!0)){var s=l.getGeomItemSets();for(var d=0,c=s;d<c.length;d++){var u=c[d];u.draw(t)}}}}i.unbind(t)}t.glgeom&&t.glgeom.unbind(t)};e.prototype.draw=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0),this.__traverseTreeAndDraw(t)};e.prototype.drawHighlightedGeoms=function(t){var e=this.__gl;e.disable(e.CULL_FACE);for(var a in this.__glshadermaterials){var i=this.__glshadermaterials[a];if(!i.glselectedshader)continue;if(!this.bindShader(t,i.glselectedshader))continue;var n=i.getMaterialGeomItemSets();for(var r=0,o=n;r<o.length;r++){var l=o[r];var s=l.getGeomItemSets();for(var d=0,c=s;d<c.length;d++){var u=c[d];u.drawHighlighted(t)}}}t.glgeom&&t.glgeom.unbind(t)};e.prototype.getGeomItemAndDist=function(t){var e,a;this.__gl.floatGeomBuffer?(e=Math.round(t[1]),a=t[3]):(e=t[0]+(t[1]<<8),a=Math.decode16BitFloatFrom2xUInt8([t[2],t[3]]));var i=this.__drawItems[e];if(i)return{geomItem:i.getGeomItem(),dist:a}};e.prototype.drawGeomData=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0);for(var a in this.__glshadermaterials){var i=this.__glshadermaterials[a];if(!i.glgeomdatashader)continue;if(!this.bindShader(t,i.glgeomdatashader))continue;{var n=t.unifs.floatGeomBuffer;n&&e.uniform1i(n.location,e.floatGeomBuffer?1:0)}{var r=t.unifs.passId;r&&e.uniform1i(r.location,this.__passIndex)}var o=i.getMaterialGeomItemSets();for(var l=0,s=o;l<s.length;l++){var d=s[l];if(0!=d.drawCount&&d.visibleInGeomDataBuffer&&this.bindMaterial(t,d.getGLMaterial(),!1)){var c=d.getGeomItemSets();for(var u=0,h=c;u<h.length;u++){var m=h[u];m.draw(t)}}}}t.glgeom&&t.glgeom.unbind(t)};return e}(fn);Ci.registerPass(_n,Li.OPAQUE);var Zn=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.init=function(e,a){t.prototype.init.call(this,e,a),this.transparentItems=[],this.freeList=[],this.visibleItems=[],this.prevSortCameraPos=new m(999,999,999),this.resort=!1};e.prototype.filterGeomItem=function(t){var e=t.getMaterial().getShaderClass();if(e){if(e.isTransparent())return!0;if(e.isOverlay())return!1;var a=t.getMaterial().getParameter("BaseColor");if(a&&a.getValue().a<.999)return!0}return!1};e.prototype.addGeomItem=function(e){var a=this;var i=e.getMaterial(),n=i.getShaderName(),r=this.constructShaders(n),o=this.addMaterial(i),l=t.prototype.addGeomItem.call(this,e),s=e.addListener("visibilityChanged",(function(t){if(t.visible)a.visibleItems.push(c);else{var e=a.visibleItems.indexOf(c);a.visibleItems.splice(e,1)}})),d=e.addListener("geomXfoChanged",(function(){a.resort=!0})),c={geomItem:e,shaders:r,glmaterial:o,glgeomitem:l,visibilityChangedId:s,geomXfoChangedId:d};var u;u=this.freeList.length>0?this.freeList.pop():this.transparentItems.length,this.transparentItems[u]=c,e.setMetadata("itemIndex",u),e.getVisible()&&this.visibleItems.push(c),this.resort=!0};e.prototype.removeGeomItem=function(e){if(!t.prototype.removeGeomItem.call(this,e))return;var a=e.getMetadata("itemIndex"),i=this.transparentItems[a];this.transparentItems[a]=null,this.freeList.push(a);var n=this.visibleItems.indexOf(i);-1!=n&&this.visibleItems.splice(n,1)};e.prototype.sortItems=function(t){for(var e=0,a=this.visibleItems;e<a.length;e++){var i=a[e];var n=i.glgeomitem.geomItem.getGeomMat4();i.dist=n.translation.distanceTo(t)}this.visibleItems.sort((function(t,e){return t.dist>e.dist?-1:t.dist<e.dist?1:0})),this.prevSortCameraPos=t,this.resort=!1};e.prototype._drawItem=function(t,e,a){if(a.currentglMaterial!=e.glmaterial&&(a.currentglMaterial=e.glmaterial,!a.currentglMaterial.bind(t)))return;var i=e.glgeomitem;if((a.currentglGeom==i.glGeom||(a.currentglGeom=i.glGeom,a.currentglGeom.bind(t)))&&i.bind(t)){if(t.unifs.instancedDraw){var n=this.__gl;n.uniform1i(t.unifs.instancedDraw.location,0),n.disableVertexAttribArray(t.attrs.instancedIds.location)}t.bindViewports(t.unifs,(function(){a.currentglGeom.draw(t)}))}};e.prototype._drawItems=function(t){var e={currentglShader:null,currentglMaterial:null,currentglGeom:null};for(var a=0,i=this.visibleItems;a<i.length;a++){var n=i[a];if(e.currentglShader!=n.shaders.glshader){if(!this.bindShader(t,n.shaders.glshader))continue;e.currentglShader=n.shaders.glshader}this._drawItem(t,n,e)}e.currentglGeom&&e.currentglGeom.unbind(t)};e.prototype.draw=function(t){if(0==this.visibleItems.length)return;this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl,a=t.viewXfo.tr;(this.resort||a.distanceTo(this.prevSortCameraPos)>.3)&&this.sortItems(a),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),t.pass="MULTIPLY",e.blendFunc(e.DST_COLOR,e.ZERO),this._drawItems(t),t.pass="ADD",e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this._drawItems(t),e.disable(e.BLEND)};e.prototype.drawHighlightedGeoms=function(t){var e=this.__gl;e.disable(e.CULL_FACE);var a={currentglShader:null,currentglMaterial:null,currentglGeom:null};for(var i=0,n=this.visibleItems;i<n.length;i++){var r=n[i];if(!r.geomItem.isHighlighted())continue;if(!r.shaders.glselectedshader)continue;var o=r.shaders;if(a.currentglShader!=o.glselectedshader){if(!this.bindShader(t,o.glselectedshader))continue;a.currentglShader=o.glselectedshader}this._drawItem(t,r,a)}a.currentglGeom&&a.currentglGeom.unbind(t)};e.prototype.getGeomItemAndDist=function(t){var e,a;this.__gl.floatGeomBuffer?(e=Math.round(t[1]),a=t[3]):(e=t[0]+(t[1]<<8),a=Math.decode16BitFloatFrom2xUInt8([t[2],t[3]]));var i=this.__drawItems[e];if(i)return{geomItem:i.getGeomItem(),dist:a}};e.prototype.drawGeomData=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0);var a={currentglShader:null,currentglMaterial:null,currentglGeom:null};for(var i=0,n=this.visibleItems;i<n.length;i++){var r=n[i];var o=r.shaders;if(!o.glgeomdatashader){if(a.currentglShader!=o.glgeomdatashader){if(!this.bindShader(t,o.glgeomdatashader))continue;a.currentglShader=o.glgeomdatashader}{var l=t.unifs.floatGeomBuffer;l&&e.uniform1i(l.location,e.floatGeomBuffer?1:0)}{var s=t.unifs.passId;s&&e.uniform1i(s.location,this.__passIndex)}this._drawItem(t,r,a)}}a.currentglGeom&&a.currentglGeom.unbind(t)};return e}(fn);Ci.registerPass(Zn,Li.TRANSPARENT);var Gn=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.init=function(e,a){var i=this;t.prototype.init.call(this,e,a),this.__billboards=[],this.__freeIndices=[],this.__drawCount=0,this.__threshold=0,this.__updateRequested=!1,this.__prevSortCameraPos=new m,this.__atlas=new oi(this.__renderer.gl,"Billboards","RGBA","UNSIGNED_BYTE",[1,1,1,0]);var n=function(t){return i.emit("updated",t)};this.__atlas.on("loaded",n),this.__atlas.on("updated",n),this.__renderer.registerPass((function(t){return t instanceof ua&&(i.addBillboard(t),!0)}),(function(t){return t instanceof ua&&(i.removeBillboard(t),!0)}))};e.prototype.filterRenderTree=function(){};e.prototype.addBillboard=function(t){var e=this;var a=t.getParameter("Image"),i=a.getValue();if(!i)return void a.on("valueChanged",(function(){return e.addBillboard(t)}));var n;n=this.__freeIndices.length>0?this.__freeIndices.pop():this.__billboards.length;var r=this.__atlas.addSubImage(i);t.setMetadata("GLBillboardsPass_Index",n);var o=t.on("visibilityChanged",(function(){t.getVisible()?(e.__drawCount++,e.__updateBillboard(n)):e.__drawCount--,e.__reqUpdateIndexArray()})),l=t.getParameter("GlobalXfo").on("valueChanged",(function(){t.getVisible()&&(e.__updateBillboard(n),e.emit("updated",{}))})),s=t.getParameter("Alpha").on("valueChanged",(function(){t.getVisible()&&(e.__updateBillboard(n),e.emit("updated",{}))}));t.getVisible()&&this.__drawCount++,this.__billboards[n]={billboard:t,imageIndex:r,visibilityChangedId:o,xfoChangedId:l,alphaChangedId:s},this.indexArrayUpdateNeeded=!0,this.__requestUpdate()};e.prototype.removeBillboard=function(t){var e=t.getMetadata("GLBillboardsPass_Index");if(-1==e)return void console.warn("Billboard already removed.");var a=this.__billboards[e],i=a.billboard.getParameter("Image").getValue();this.__atlas.removeSubImage(i),t.removeListenerById("visibilityChanged",a.visibilityChangedId),t.getParameter("GlobalXfo").removeListenerById("valueChanged",a.xfoChangedId),t.getParameter("Alpha").removeListenerById("valueChanged",a.alphaChangedId),this.__billboards[e]=null,this.__freeIndices.push(e),t.getVisible()&&this.__drawCount--,this.indexArrayUpdateNeeded=!0,this.__requestUpdate()};e.prototype.__populateBillboardDataArray=function(t,e,a){var i=t.billboard,n=i.getGlobalXfo().toMat4(),r=1/i.getParameter("PixelsPerMeter").getValue();var o=0;i.getParameter("AlignedToCamera").getValue()&&(o|=4),i.getParameter("DrawOnTop").getValue()&&(o|=8);var l=i.getParameter("Alpha").getValue(),s=i.getParameter("Color").getValue(),d=5*e*4,c=p.createFromFloat32Buffer(a.buffer,d),u=p.createFromFloat32Buffer(a.buffer,d+4),h=p.createFromFloat32Buffer(a.buffer,d+8),m=p.createFromFloat32Buffer(a.buffer,d+12);c.set(n.xAxis.x,n.yAxis.x,n.zAxis.x,n.translation.x),u.set(n.xAxis.y,n.yAxis.y,n.zAxis.y,n.translation.y),h.set(n.xAxis.z,n.yAxis.z,n.zAxis.z,n.translation.z),m.set(r,o,t.imageIndex,l);p.createFromFloat32Buffer(a.buffer,d+16).set(s.r,s.g,s.b,s.a)};e.prototype.__requestUpdate=function(){var t=this;this.__updateRequested||(this.__updateRequested=!0,setTimeout((function(){t.__updateBillboards()}),100))};e.prototype.__reqUpdateIndexArray=function(){var t=this;this.indexArrayUpdateNeeded||(this.indexArrayUpdateNeeded=!0,this.updateIndexArrayId=setTimeout((function(){t.indexArrayUpdateNeeded&&(t.__updateIndexArray(),t.emit("updated",{}))}),1))};e.prototype.__updateIndexArray=function(){var t=this.__gl;this.__indexArray&&this.__indexArray.length!=this.__drawCount&&(t.deleteBuffer(this.__instanceIdsBuffer),this.__instanceIdsBuffer=null),this.__indexArray=new Float32Array(this.__drawCount);var e=0;for(var a=0;a<this.__billboards.length;a++)this.__billboards[a]&&this.__billboards[a].billboard.getVisible()&&(this.__indexArray[e]=a,e++);this.__instanceIdsBuffer||(this.__instanceIdsBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.__instanceIdsBuffer),t.bufferData(t.ARRAY_BUFFER,this.__indexArray,t.STATIC_DRAW),this.indexArrayUpdateNeeded=!1};e.prototype.__updateBillboards=function(){var t=this;var e=function(){t.indexArrayUpdateNeeded&&t.__updateIndexArray();var e=t.__gl;if(!t.__glshader){e.__quadVertexIdsBuffer||e.setupInstancedQuad(),t.__glshader=new Ni(e);var a=t.__glshader.compileForTarget("GLBillboardsPass",t.__renderer.getShaderPreproc());t.__shaderBinding=Na(e,a.attrs,e.__quadattrbuffers,e.__quadIndexBuffer)}if(t.__atlas.renderAtlas(),!e.floatTexturesSupported||!e.drawElementsInstanced)return t.__modelMatrixArray=[],t.__billboardDataArray=[],t.__tintColorArray=[],t.__indexArray.forEach((function(e){var a=t.__billboards[e],i=a.billboard,n=i.getGlobalXfo().toMat4(),r=1/i.getParameter("PixelsPerMeter").getValue();var o=0;i.getParameter("AlignedToCamera").getValue()&&(o|=4);var l=i.getParameter("Alpha").getValue(),s=i.getParameter("Color").getValue();t.__modelMatrixArray[e]=n.asArray(),t.__billboardDataArray[e]=[r,o,a.imageIndex,l],t.__tintColorArray[e]=[s.r,s.g,s.b,s.a]})),void(t.__updateRequested=!1);var i=Math.round(Math.sqrt(5*(t.__billboards.length-t.__freeIndices.length))+.5);i%5!=0&&(i+=5-i%5),t.__width=i,t.__drawItemsTexture?t.__drawItemsTexture.resize(i,i):(t.__drawItemsTexture=new Ma(e,{format:"RGBA",type:"FLOAT",width:i,height:i,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),t.__drawItemsTexture.clear()),t.__indexArray.forEach((function(e){-1!=e&&t.__updateBillboard(e)})),t.__updateRequested=!1};this.__atlas.isLoaded()?e():this.__atlas.on("loaded",e)};e.prototype.__updateBillboard=function(t){if(0==this.__drawCount||!this.__drawItemsTexture)return;var e=this.__billboards[t];if(!e.billboard.getVisible())return;var a=this.__gl,i=new Float32Array(20);this.__populateBillboardDataArray(e,0,i),a.bindTexture(a.TEXTURE_2D,this.__drawItemsTexture.glTex);var n=5*t%this.__width,r=Math.floor(5*t/this.__width),o=this.__drawItemsTexture.getType(),l=this.__drawItemsTexture.getFormat();if("FLOAT"==o)a.texSubImage2D(a.TEXTURE_2D,0,n,r,5,1,a[l],a[o],i);else{var s=Math.convertFloat32ArrayToUInt16Array(i);a.texSubImage2D(a.TEXTURE_2D,0,n,r,5,1,a[l],a[o],s)}};e.prototype.sort=function(t){var e=this;for(var a=0,i=this.__billboards;a<i.length;a++){var n=i[a];var r=n.billboard;if(r&&r.getVisible()){var o=r.getGlobalXfo();n.dist=o.tr.distanceTo(t)}}this.__indexArray.sort((function(t,a){return-1==t?1:-1==a||e.__billboards[t].dist>e.__billboards[a].dist?-1:e.__billboards[t].dist<e.__billboards[a].dist?1:0}));var l=this.__gl;l.floatTexturesSupported&&this.__instanceIdsBuffer&&(l.bindBuffer(l.ARRAY_BUFFER,this.__instanceIdsBuffer),l.bufferData(l.ARRAY_BUFFER,this.__indexArray,l.STATIC_DRAW))};e.prototype.draw=function(t){var e=this;if(0==this.__drawCount||!this.__atlas.isReady()||this.__updateRequested)return;this.indexArrayUpdateNeeded&&this.__updateIndexArray();var a=this.__gl;a.disable(a.CULL_FACE),a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);var i=t.viewXfo.tr;if(i.distanceTo(this.__prevSortCameraPos)>this.__threshold)if(this.sort(i),this.__prevSortCameraPos=i.clone(),this.__drawCount>1){var n=this.__billboards[this.__indexArray[0]].billboard.getGlobalXfo().tr,r=this.__billboards[this.__indexArray[1]].billboard.getGlobalXfo().tr;this.__threshold=n.distanceTo(r)}else this.__threshold=9999;this.__glshader.bind(t),this.__shaderBinding.bind(t);var o=t.unifs;this.__atlas.bindToUniform(t,o.atlasBillboards);var l=1==t.vrPresenting;if(a.uniform1i(o.inVR.location,l),a.floatTexturesSupported&&a.drawElementsInstanced){this.__drawItemsTexture.bindToUniform(t,o.instancesTexture),a.uniform1i(o.instancesTextureSize.location,this.__width);{var s=t.attrs.instanceIds.location;a.enableVertexAttribArray(s),a.bindBuffer(a.ARRAY_BUFFER,this.__instanceIdsBuffer),a.vertexAttribPointer(s,1,a.FLOAT,!1,4,0),a.vertexAttribDivisor(s,1)}t.bindViewports(o,(function(){a.drawElementsInstanced(a.TRIANGLES,6,a.UNSIGNED_SHORT,0,e.__drawCount)}))}else{var d=this.__indexArray.length;for(var c=0;c<d;c++)a.uniformMatrix4fv(o.modelMatrix.location,!1,this.__modelMatrixArray[c]),a.uniform4fv(o.billboardData.location,this.__billboardDataArray[c]),a.uniform4fv(o.tintColor.location,this.__tintColorArray[c]),a.uniform4fv(o.layoutData.location,this.__atlas.getLayoutData(this.__billboards[c].imageIndex)),t.bindViewports(o,(function(){a.drawQuad()}))}a.disable(a.BLEND)};return e}(Ti);Ci.registerPass(Gn,Li.TRANSPARENT);var Xn=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.init=function(e,a){t.prototype.init.call(this,e,a)};e.prototype.filterGeomItem=function(t){if(t.isOverlay())return!0;var e=t.getMaterial().getShaderClass();return!(!e||!e.isOverlay())};e.prototype.draw=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.clear(e.DEPTH_BUFFER_BIT),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),t.pass="ADD",e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.__traverseTreeAndDraw(t),e.disable(e.BLEND)};e.prototype.drawGeomData=function(e){var a=this.__gl;a.clear(a.DEPTH_BUFFER_BIT),a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),e.pass="ADD",a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),t.prototype.drawGeomData.call(this,e),a.disable(a.BLEND),a.enable(a.DEPTH_TEST)};return e}(_n);Ci.registerPass(Xn,Li.OVERLAY);var vn=window.AudioContext||window.webkitAudioContext||!1;var Vn;vn?Vn=new vn:alert("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox");var In=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__audioItems=[];return e}e.prototype.init=function(e,a){var i=this;t.prototype.init.call(this,e,a),Vn&&this.__renderer.registerPass((function(t){if(t instanceof aa)return t.addListener("audioSourceCreated",(function(e){var a=e.audioSource;i.addAudioSource(t,a,t)})),!0;if(t instanceof ra){var e=t.getMaterial();if(e){var a=e.getParameter("BaseColor");if(a&&a.getImage&&a.getImage()){var n=a.getImage();n.addListener("loaded",(function(){if(n.getAudioSource){var e=n.getAudioSource();(e instanceof HTMLMediaElement||e instanceof AudioBufferSourceNode)&&i.addAudioSource(t,e,n)}}))}}return!1}}),(function(t){}))};e.prototype.addAudioSource=function(t,e,a){if(e.addedToCollector)return;var i;i=e instanceof HTMLMediaElement?Vn.createMediaElementSource(e):e instanceof AudioBufferSourceNode?e:Vn.createMediaStreamSource(e);var n=Vn.createGain(),r=a.getParameter("Gain");var o,l;r&&(o=r,l=n.gain,o&&(l.setValueAtTime(o.getValue(),0),l.setValueAtTime(o.getValue(),5),o.addListener("valueChanged",(function(){l.value=o.getValue()})))),inNode;var s=a.getParameter("SpatializeAudio");if(s&&0==s.getValue())dioCtx.destination;else{var d=Vn.createPanner();d.panningModel="HRTF",d.distanceModel="inverse"("pasource",nner)("aupanner",dioCtx.destination);var c=function(t){var e=a.getParameter(t);e&&(d[t]=e.getValue(),e.addListener("valueChanged",(function(){d[t]=e.getValue()})))};c("coneInnerAngle"),c("coneOuterAngle"),c("coneOuterGain");var u=function(){var e;e=t instanceof ra?t.getGeomMat4():t.getGlobalXfo().toMat4();var a=e.translation;d.setPosition(a.x,a.y,a.z);var i=e.zAxis;d.setOrientation(i.x,i.y,i.z)};u(),t.addListener("globalXfoChanged",(function(t){u()}))}e.addedToCollector=!0,this.__audioItems.push({treeItem:t,audioSource:e,parameterOwner:a}),this.emit("updated",{})};e.prototype.__updateListenerPosition=function(t){if(!Vn)return;var e=Vn.listener;e.setPosition(t.tr.x,t.tr.y,t.tr.z);var a=t.ori.getYaxis(),i=t.ori.getZaxis().negate();e.setOrientation(i.x,i.y,i.z,a.x,a.y,a.z)};e.prototype.draw=function(t){0!=this.__audioItems.length&&this.__updateListenerPosition(t.viewXfo)};return e}(Ti);Ci.registerPass(In,Li.OVERLAY),window&&(window.ZeaAudioaudioCtx=Vn);var Rn=Object.freeze({__proto__:null,create3DContext:Ta,GLTexture2D:Ma,GLMesh:Ka,GLLines:wa,GLPoints:za,GLMaterial:ti,GLShader:Ea,GLFbo:ka,GLRenderTarget:ei,GLRenderer:Ci,GLBaseViewport:Zi,GLViewport:Gi,shaderLibrary:Ja,generateShaderGeomBinding:Na,BillboardShader:Ni,ConvolverShader:li,DepthMapShader:Yi,EnvMapShader:ci,BackgroundImageShader:ui,OctahedralEnvMapShader:hi,LatLongEnvMapShader:mi,SterioLatLongEnvMapShader:pi,DualFishEyeEnvMapShader:fi,DualFishEyeToLatLongBackgroundShader:bi,EnvProjectionShader:Ki,OctahedralEnvProjectionShader:wi,LatLongEnvProjectionShader:zi,FatLinesShader:Ui,FlatSurfaceShader:Ji,FlatAlphaSurfaceShader:Pi,LayeredCarPaintShader:Ei,LinesShader:ki,NormalsShader:Bi,PointsShader:Di,FatPointsShader:Oi,FatPointsGeomDataShader:Qi,FatPointsSelectedShader:Ai,PostProcessing:ji,ScreenQuadShader:gi,SimpleSurfaceShader:qi,StandardSurfaceShader:$i,StandardSurfaceGeomDataShader:tn,StandardSurfaceSelectedGeomsShader:en,HandleShader:an,HandleGeomDataShader:nn,TransparentSurfaceShader:rn,ScreenSpaceShader:on,ToolIconShader:ln,UnpackHDRShader:Ha,UnpackLDRAlphaImageShader:sn,WireShader:dn,GLPass:Ti,PassType:Li,GLStandardGeomsPass:fn,GLOpaqueGeomsPass:_n,GLTransparentGeomsPass:Zn,GLBillboardsPass:Gn,GLOverlayPass:Xn,GLAudioItemsPass:In,get audioCtx(){return Vn},VRViewport:Vi});var xn=function(){function t(t){this.__name=t||K.getClassName(this),this.__stateEvents=[],this.__activationActions=[],this.__deactivationActions=[]}t.prototype.getName=function(){return this.__name};t.prototype.setName=function(t){this.__name=t};t.prototype.setStateMachine=function(t){this.__stateMachine=t};t.prototype.getStateMachine=function(){return this.__stateMachine};t.prototype.activate=function(){this.__stateEvents.forEach((function(t){t.activate()})),this.__activationActions.forEach((function(t){t.activate()}))};t.prototype.deactivate=function(){this.__stateEvents.forEach((function(t){t.deactivate()})),this.__activationActions.forEach((function(t){t.deactivate()})),this.__deactivationActions.forEach((function(t){t.activate()}))};t.prototype.addStateEvent=function(t){t.setState(this),this.__stateEvents.push(t)};t.prototype.getStateEvent=function(t){return this.__stateEvents[t]};t.prototype.addActivationAction=function(t){t.setState(this),this.__activationActions.push(t)};t.prototype.getActivationAction=function(t){return this.__activationActions[t]};t.prototype.addDeactivationAction=function(t){t.setState(this),this.__deactivationActions.push(t)};t.prototype.toJSON=function(t,e){var a={name:this.__name,type:K.getClassName(this)},i=[];for(var n=0,r=this.__stateEvents;n<r.length;n++){var o=r[n];i.push(o.toJSON(t,e))}a.stateEvents=i;var l=[];for(var s=0,d=this.__activationActions;s<d.length;s++){var c=d[s];l.push(c.toJSON(t,e))}a.activationActions=l;var u=[];for(var h=0,m=this.__deactivationActions;h<m.length;h++){var p=m[h];u.push(p.toJSON(t,e))}return a.deactivationActions=u,a};t.prototype.fromJSON=function(t,e,a){this.__name=t.name;for(var i=0,n=t.stateEvents;i<n.length;i++){var r=n[i];var o=K.constructClass(r.type);o.fromJSON(r,e),this.addStateEvent(o)}for(var l=0,s=t.activationActions;l<s.length;l++){var d=s[l];var c=K.constructClass(d.type);c.fromJSON(d,e),this.addActivationAction(c)}for(var u=0,h=t.deactivationActions;u<h.length;u++){var m=h[u];var p=K.constructClass(m.type);p.fromJSON(m,e),this.addDeactivationAction(p)}};return t}();K.registerClass("State",xn);var Sn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__name=e,a.__childActions=[],a.__outputs={};return a}e.prototype.addOutput=function(t){return this.__outputs[t.getName()]=t,t};e.prototype.getOutput=function(t){return this.__outputs[t]};e.prototype.setState=function(t){this.__state=t,this.__childActions.forEach((function(e){e.setState(t)}))};e.prototype.addChild=function(t){this.__childActions.push(t),t.setState(this.__state)};e.prototype.getChild=function(t){return this.__childActions[t]};e.prototype.activate=function(){console.warn("activate must be implmented by each action. this:"+K.getClassName(this))};e.prototype.addChild=function(t){this.__childActions.push(t),t.setState(this.__state)};e.prototype.deactivate=function(){this.__childActions.forEach((function(t){t.deactivate()}))};e.prototype.__onDone=function(){this.__childActions.forEach((function(t){t.activate()}))};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);i||(i={}),i.type=K.getClassName(this);var n=[];for(var r=0,o=this.__childActions;r<o.length;r++){var l=o[r];n.push(l.toJSON(e,a))}i.childActions=n;var s={};for(var d in this.__outputs)s[d]=this.__outputs[d].toJSON(e,a);return i.outputs=s,i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i);for(var n=0,r=e.childActions;n<r.length;n++){var o=r[n];var l=K.constructClass(o.type);if(!l)throw new Error("Invalid type:"+o.type);l.fromJSON(o,a),this.addChild(l)}for(var s in e.outputs)this.__outputs[s].fromJSON(e.outputs[s],a)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__outputs=[]};return e}(D);var Wn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__name=e,a.__onEvent=a.__onEvent.bind(a);return a}e.prototype.__onEvent=function(){this.__childActions.forEach((function(t){t.activate()}))};e.prototype.deactivate=function(){this.__childActions.forEach((function(t){t.deactivate()}))};return e}(Sn);var Ln=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__states={},a.setFlag(O.USER_EDITED);return a}e.prototype.addState=function(t){t.setStateMachine(this),this.__states[t.getName()]=t,1==Object.keys(this.__states).length&&null==this.__initialStateName&&(this.__initialStateName=t.getName())};e.prototype.getState=function(t){return this.__states[t]};e.prototype.activateState=function(t){if(!this.__states[t])throw new Error("Invalid state transtion:"+t);this.__currentState!=this.__states[t]&&(this.__currentState&&this.__currentState.deactivate(),this.__currentState=this.__states[t],this.__currentState.activate(),this.emit("stateChanged",{name:t}))};e.prototype.getActiveState=function(){return this.__currentState};e.prototype.getActiveStateName=function(){return K.getClassName(this.__currentState)};e.prototype.getInitialState=function(){return this.__initialStateName};e.prototype.setInitialState=function(t){this.__initialStateName=t};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);i.initialStateName=this.__initialStateName;var n={};for(var r in this.__states)n[r]=this.__states[r].toJSON(e,a);return i.states=n,i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__initialStateName=e.initialStateName,a.stateMachine=this;for(var n in e.states){var r=e.states[n],o=K.constructClass(r.type);if(!o)throw new Error("Invalid type:"+r.type);o.fromJSON(r,a),this.addState(o)}a.addPLCB((function(){}))};return e}(A);K.registerClass("StateMachine",Ln);var Tn=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__targetStateParam=e.addParameter(new Rt("TargetState",""));return e}e.prototype.activate=function(){this.__state.getStateMachine().activateState(this.__targetStateParam.getValue())};return e}(Sn);K.registerClass("SwitchState",Tn);var Mn=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.addParameter(new Tt("Camera",(function(t){return t instanceof ha}))),e.addParameter(new _t("CameraPos")),e.addParameter(new _t("CameraTarget")),e.addParameter(new ft("InterpTime",1)),e.addParameter(new ft("UpdateFrequency",30));return e}e.prototype.setCameraPositionAndTarget=function(t,e){this.getParameter("CameraPos").setValue(t),this.getParameter("CameraTarget").setValue(e)};e.prototype.activate=function(){var t=this;var e=this.getParameter("Camera").getValue();if(!e)return void console.warn("Camera not assigned to SetCameraPositionAndTarget state action");var a=this.getParameter("CameraPos").getValue(),i=this.getParameter("CameraTarget").getValue(),n=this.getParameter("InterpTime").getValue();if(n>0){var r=e.getGlobalXfo().tr,o=e.getTargetPostion(),l=(r.subtract(o).length(),this.getParameter("UpdateFrequency").getValue()),s=a.subtract(i).length();var d=!0,c=0,u=0;var h=Math.round(n*l);var m=!1;var p=function(){m||(d=!1)};e.addListener("globalXfoChanged",p);var f=function(){if(d)if(u++,u<h){var n=u/h,r=Math.smoothStep(0,1,n),o=(r-c)/(1-n);c=r;var b=e.getGlobalXfo().tr,y=e.getTargetPostion(),g=b.subtract(y).length();var _=b;var Z=y.lerp(i,o);d&&(_=b.lerp(a,o));var G=_.subtract(Z),X=(G.length(),Math.lerp(g,s,o));G.scaleInPlace(X/G.length()),m=!0,e.setPositionAndTarget(Z.add(G),Z),m=!1,t.__timeoutId=window.setTimeout(f,1e3/l)}else e.removeListener("globalXfoChanged",p),e.emit("movementFinished",{}),t.__timeoutId=void 0,t.__onDone()};f()}else e.setPositionAndTarget(a,i)};e.prototype.deactivate=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=void 0),t.prototype.deactivate.call(this)};e.prototype.cancel=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=void 0)};return e}(Sn);K.registerClass("SetCameraPositionAndTarget",Mn);var Fn=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__interpTimeParam=e.addParameter(new ft("InterpTime",1)),e.__updateFrequencyParam=e.addParameter(new ft("UpdateFrequency",30)),e.__outParam=e.addOutput(new _a("Param")),e.__outParam.addListener("paramSet",(function(t){var a=t.param;if(a&&!e.__valueParam||a.getDataType()!=e.__valueParam.getDataType()){var i=a.clone();i.setName("Value"),e.__outParam.getInitialValue?i.setValue(e.__outParam.getInitialValue()):i.setValue(a.getValue()),e.__valueParam=e.addParameter(i)}}));return e}e.prototype.activate=function(){var t=this;if(this.__outParam.isConnected()){var e=this.__interpTimeParam.getValue();if(e>0){var a=this.__updateFrequencyParam.getValue(),i=this.__outParam.getValue(),n=this.__valueParam.getValue();var r=0;var o=Math.round(e/(1/a)),l=function(){if(r++,r<o){var e=r/o,s=Math.smoothStep(0,1,e),d=Math.lerp(i,n,s);t.__outParam.setValue(d,z.GENERATED_VALUE),t.__timeoutId=window.setTimeout(l,1e3/a)}else t.__outParam.setValue(t.__valueParam.getValue(),z.GENERATED_VALUE),t.__timeoutId=void 0,t.__onDone()};l()}else this.__outParam.setValue(this.__valueParam.getValue(),z.GENERATED_VALUE),this.__onDone()}};e.prototype.deactivate=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=void 0),t.prototype.deactivate.call(this)};e.prototype.cancel=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=void 0)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.__valueParam&&(i.valueParamType=K.getClassName(this.__valueParam)),i};e.prototype.fromJSON=function(e,a,i){if(e.valueParamType){var n=K.constructClass(e.valueParamType,"Value");n&&(this.__valueParam=this.addParameter(n))}t.prototype.fromJSON.call(this,e,a,i)};return e}(Sn);K.registerClass("SetParameterValue",Fn);var Cn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__geomParam=a.addParameter(new Tt("TreeItem")),a.__geomParam.addListener("valueChanged",(function(){a.__geom=a.__geomParam.getValue(),a.__activated&&a.__geom&&a.__geom.addListener("mouseDown",a.__geomClicked)})),a.__geomClicked=a.__geomClicked.bind(a),a.__activated=!1,a.__geomClickedBindId=-1;return a}e.prototype.__geomClicked=function(t){t.stopPropagation(),this.__onEvent()};e.prototype.activate=function(){this.__geom&&this.__geom.addListener("mouseDown",this.__geomClicked),this.__activated=!0};e.prototype.deactivate=function(){this.__geom&&this.__geom.removeListener("mouseDown",this.__geomClicked),this.__activated=!1,t.prototype.deactivate.call(this)};return e}(Wn);K.registerClass("GeomClicked",Cn);var Nn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.onKeyPressed=a.onKeyPressed.bind(a),a.__keyParam=a.addParameter(new Rt("Key",""));return a}e.prototype.onKeyPressed=function(t){console.log(t.key),t.key==this.__keyParam.getValue()&&this.__onEvent()};e.prototype.activate=function(){document.addEventListener("keydown",this.onKeyPressed)};e.prototype.deactivate=function(){document.removeEventListener("keydown",this.onKeyPressed)};return e}(Wn);K.registerClass("KeyPressedEvent",Nn);var Yn=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__waitTimeParam=a.addParameter(new ft("WaitTime",1));return a}e.prototype.activate=function(){var t=this;this.__timeoutId=window.setTimeout((function(){delete t.__timeoutId,t.__onEvent()}),1e3*this.__waitTimeParam.getValue())};e.prototype.deactivate=function(){this.__timeoutId&&window.clearTimeout(this.__timeoutId)};return e}(Wn);K.registerClass("TimedWait",Yn);var Kn=__assign(__assign(__assign(__assign(__assign(__assign({onResize:i},r),W),C),La),Rn),Object.freeze({__proto__:null,State:xn,StateAction:Sn,StateEvent:Wn,StateMachine:Ln,SwitchState:Tn,SetCameraPositionAndTarget:Mn,SetParameterValue:Fn,GeomClicked:Cn,KeyPressedEvent:Nn,TimedWait:Yn}));function wn(t,e){if(!wn.watchedElementData){wn.watchedElementData=[];var a=function(){wn.watchedElementData.forEach((function(t){t.element.offsetWidth===t.offsetWidth&&t.element.offsetHeight===t.offsetHeight||(t.offsetWidth=t.element.offsetWidth,t.offsetHeight=t.element.offsetHeight,t.callback())}))};window.addEventListener("resize",a),new MutationObserver(a).observe(document.body,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}wn.watchedElementData.push({element:t,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,callback:e})}var zn=function(){var t=null!=(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Pixel/i)||navigator.userAgent.match(/Windows Phone/i)),e=function(){var t=navigator.userAgent;var e,a,i,n=navigator.appName,r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10);return-1!=(a=t.indexOf("Opera"))?(n="Opera",r=t.substring(a+6),-1!=(a=t.indexOf("Version"))&&(r=t.substring(a+8))):-1!=(a=t.indexOf("MSIE"))?(n="Microsoft Internet Explorer",r=t.substring(a+5)):-1!=(a=t.indexOf("Edge"))?(n="Edge",r=t.substring(a+4)):-1!=(a=t.indexOf("Chrome"))?(n="Chrome",r=t.substring(a+7)):-1!=(a=t.indexOf("Safari"))?(n="Safari",r=t.substring(a+7),-1!=(a=t.indexOf("Version"))&&(r=t.substring(a+8))):-1!=(a=t.indexOf("Firefox"))?(n="Firefox",r=t.substring(a+8)):(e=t.lastIndexOf(" ")+1)<(a=t.lastIndexOf("/"))&&(n=t.substring(e,a),r=t.substring(a+1),n.toLowerCase()==n.toUpperCase()&&(n=navigator.appName)),-1!=(i=r.indexOf(";"))&&(r=r.substring(0,i)),-1!=(i=r.indexOf(" "))&&(r=r.substring(0,i)),o=parseInt(""+r,10),isNaN(o)&&(r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10)),{browserName:n,fullVersion:r,majorVersion:o,appName:navigator.appName,userAgent:navigator.userAgent}}(),a=function(){var t,e;try{t=document.createElement("canvas").getContext("webgl")}catch(t){}if(!t)return;try{e=document.createElement("canvas").getContext("webgl2")}catch(t){}var a=t.getExtension("WEBGL_debug_renderer_info"),i=t.getParameter(a.UNMASKED_VENDOR_WEBGL),n=t.getParameter(a.UNMASKED_RENDERER_WEBGL),r=t.getParameter(t.MAX_TEXTURE_SIZE);var o;return n.match(/NVIDIA/i)?o="NVidia":n.match(/AMD/i)||n.match(/Radeon/i)?o="AMD":n.match(/Intel/i)?o="Intel":n.match(/Mali/i)?o="ARM":n.match(/Adreno/i)?o="Adreno":console.warn("Unable to determine GPU vendor:",n),{vendor:i,renderer:n,gpuVendor:o,maxTextureSize:r,supportsWebGL2:null!=e}}();var i="Low";if(a)if(t)i="Low";else{var n=a.renderer.replace(/[()]/g,"").split(" ");if("NVidia"==a.gpuVendor){var r=n.indexOf("GTX");if(-1!=r){var o=n[r+1];if(o.endsWith("M")){i=parseInt(o.substring(0,o.length-2))>=900?"Medium":"Low"}else{i=parseInt(o)>=1030?"High":"Medium"}}else i=-1!=n.indexOf("TITAN")||-1!=n.indexOf("Quadro")?"High":"Low"}else if("AMD"==a.gpuVendor){var l=n.indexOf("Radeon");if(-1!=l){var s=n.indexOf("RX");if(-1!=s)if("Vega"==n[s+1])i="High";else{var d=n[s+1];var c=void 0;d.endsWith("X")?(c=parseInt(d.substring(0,d.length-2)),i="High"):c=parseInt(d),i=c>=480?"High":"Medium"}else if("Pro"==n[l+1]){i=parseInt(n[s+1])>=450?"Medium":"Low"}else if("Sky"==n[l+1]){i=parseInt(n[s+1])>=700?"Medium":"Low"}else i="Low"}else i=-1!=n.indexOf("FirePro")||-1!=n.indexOf("Quadro")?"High":"Low"}else("Adreno"==a.gpuVendor||"Intel"==a.gpuVendor)&&(i="Low")}return{isMobileDevice:t,isIOSDevice:null!=(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)),browserName:e.browserName,fullVersion:e.fullVersion,majorVersion:e.majorVersion,appName:e.appName,userAgent:e.userAgent,webGLSupported:null!=a,gpuDesc:a,deviceCategory:i}}();var Un=Object.freeze({__proto__:null,SystemDesc:zn});var Jn=Math.PI/180;Math.HALF_PI=.5*Math.PI,Math.TWO_PI=2*Math.PI;Math.radToDeg=function(t){return t/Jn},Math.degToRad=function(t){return t*Jn},Number.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)};var Pn=function(t){var e,a,i,n=0;if(0===t.length)return n;for(e=0,i=t.length;e<i;e++)a=t.charCodeAt(e),n=(n<<5)-n+a,n|=0;return Math.abs(n)};function En(t,e,a){if(e===void 0){e=0}if(a===void 0){a=5}return JSON.stringify(t,(function(t,e){return e&&e.toFixed?Number(e.toFixed(a)):e}),e)}String.prototype.hash=function(){return Pn(this)},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.lpad=function(t,e){var a=this;for(;a.length<e;)a=t+a;return a},String.prototype.rpad=function(t,e){var a=this;for(;a.length<e;)a+=t;return a},Math.randomInt=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t},Math.lerp=function(t,e,a){return t+a*(e-t)},Math.clamp=function(t,e,a){return Math.min(Math.max(t,e),a)},Math.nearestPow2=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))},Math.nearestPow10=function(t){return Math.pow(10,Math.round(Math.log10(t)/Math.log10(10)))},Math.nextPow2=function(t){var e=0;for(;t>0;)e++,t>>=1;return 1<<e},Math.fract=function(t){return 0==t?0:t<0?t>-1?-t:-t%Math.floor(-t):t<1?t:t%Math.floor(t)},Math.remap=function(t,e,a,i,n){return i+(t-e)/(a-e)*(n-i)},Math.convertFloat32ArrayToUInt16Array=function(t){var e=new Uint16Array(t.length),a=new Int32Array(t.buffer),i=function(t){var e=t>>16&32768,a=t>>12&2047;var i=t>>23&255;return i<103?e:i>142?(e|=31744,e|=(255==i?0:1)&&8388607&t,e):i<113?(a|=2048,e|=(a>>114-i)+(a>>113-i&1),e):(e|=i-112<<10|a>>1,e+=1&a,e)};for(var n=0;n<t.length;n++)e[n]=i(a[n]);return e},Math.decode16BitFloatFrom2xUInt8=function(t){var e=t[0],a=(120&e)>>3;var i=0==a?0:2048;var n=i+((7&e)<<8)+t[1];return i=0==a?1:0,(128&e?1:-1)*n*Math.pow(2,a+i-16)},Math.encode16BitFloatInto2xUInt8=function(t){c||(c=new Uint8Array(2));var e=t>=0?128:0;t=Math.abs(t);var a,i=15,n=1024;for(var r=15;r>0;r--)t<n&&(n/=2,i--);a=0==i?t/n/2:(t-n)/n;var o=Math.round(2048*a),l=o/256,s=o-256*l;return c[0]=e+8*i+l,c[1]=s,t>=2048&&(c[0]=255),c},Math.encode16BitFloat=function(t){var e=new Float32Array(1);e[0]=t;return function(t){var e=t>>16&32768,a=t>>12&2047;var i=t>>23&255;return i<103?e:i>142?(e|=31744,e|=(255==i?0:1)&&8388607&t,e):i<113?(a|=2048,e|=(a>>114-i)+(a>>113-i&1),e):(e|=i-112<<10|a>>1,e+=1&a,e)}(new Int32Array(e.buffer)[0])},Math.decode16BitFloat=function(t){var e=(32768&t)>>15,a=(31744&t)>>10,i=1023&t;return 0==a?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==a?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,a-15)*(1+i/Math.pow(2,10))},Math.smoothStep=function(t,e,a){var i=Math.clamp((a-t)/(e-t),0,1);return i*i*(3-2*i)},Math.linStep=function(t,e,a){return Math.clamp((a-t)/(e-t),0,1)};var Hn=function(){function t(){}t.prototype.isValid=function(){for(var t=0,e=this.__data;t<e.length;t++){var a=e[t];if(a==1/0||isNaN(a))return!1}return!0};t.createFromFloat32Buffer=function(t,e){throw new Error("Not yet implemented for this type:"+this.constructor.name)};t.numElements=function(){throw new Error("Not yet implemented for this type:"+this.constructor.name)};t.prototype.asArray=function(){return this.__data};t.prototype.toString=function(){return En(this.toJSON())};return t}();var kn=new(function(){function t(){this.__types={},this.__names={},this.registerType("SInt32",5),this.registerType("UInt32",4),this.registerType("Float32",6)}t.prototype.registerType=function(t,e){this.__types[t]=e,e.name?this.__names[e.name]=t:this.__names[e]=t};t.prototype.getType=function(t){return this.__types[t]};t.prototype.getTypeName=function(t){if(this.__names[t])return this.__names[t];if(this.__names[t.name])return this.__names[t.name];throw t};return t}());var Bn=function(t){__extends(e,t);function e(e,a){if(e===void 0){e=0}if(a===void 0){a=0}var i=this;if(i=t.call(this)||this,e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)i.__data=e;else if(e instanceof ArrayBuffer){var n=e,r=a;i.__data=new Float32Array(n,r,2)}else null!=e&&"object"==typeof e?(i.__data=new Float32Array(2),i.fromJSON(e)):(i.__data=new Float32Array(2),i.__data[0]=e,i.__data[1]=a);return i}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e){this.__data[0]=t,this.__data[1]=e};e.prototype.setFromOther=function(t){this.x=t.x,this.y=t.y};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y};e.prototype.notEquals=function(t){return this.x!=t.x&&this.y!=t.y};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)};e.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this};e.prototype.scale=function(t){return new e(this.x*t,this.y*t)};e.prototype.scaleInPlace=function(t){this.x*=t,this.y*=t};e.prototype.invert=function(){return new e(1/this.x,1/this.y)};e.prototype.invertInPlace=function(){return this.x=1/this.x,this.y=1/this.y,this};e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)};e.prototype.multiplyInPlace=function(t){this.x*=t.x,this.y*=t.y};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1];return t*t+e*e};e.prototype.length=function(){return Math.sqrt(this.lengthSquared())};e.prototype.distanceTo=function(t){var e=this.__data[0]-t.x,a=this.__data[1]-t.y;return Math.sqrt(e*e+a*a)};e.prototype.normalize=function(){var t=this.__data[0],a=this.__data[1];var i=t*t+a*a;return i<Number.EPSILON?new e:(i=1/Math.sqrt(i),new e(t*i,a*i))};e.prototype.normalizeInPlace=function(){var t=this.__data[0],e=this.__data[1];var a=t*t+e*e;a<Number.EPSILON||(a=1/Math.sqrt(a),this.set(t*a,e*a))};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y};e.prototype.cross=function(t){return this.x*t.y-this.y*t.x};e.prototype.angleTo=function(t){var e=this.normalize().dot(t.normalize());return e>1?0:e<-1?Math.PI:Math.acos(e)};e.prototype.signedAngleTo=function(t){var e=this.angleTo(t);return this.cross(t)<0?-e:e};e.prototype.rotate=function(t){var a=Math.cos(t),i=Math.sin(t);return new e(this.x*a-this.y*i,this.x*i+this.y*a)};e.prototype.lerp=function(t,a){var i=this.x,n=this.y;return new e(i+a*(t.x-i),n+a*(t.y-n))};e.prototype.setRandomDir=function(t){if(t===void 0){t=1}var e=2*Math.random()*Math.PI;return this.__data[0]=Math.cos(e)*zScale,this.__data[1]=Math.sin(e)*zScale,this};e.prototype.setRandom=function(t){if(t===void 0){t=1}return this.__data[0]=Math.random()*t,this.__data[1]=Math.random()*t,this};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1])};e.prototype.asArray=function(){return this.__data};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.createFromFloat32Array=function(t){return new e(t)};e.numElements=function(){return 2};e.prototype.toJSON=function(){return{x:this.x,y:this.y}};e.prototype.fromJSON=function(t){this.x=t.x,this.y=t.y};return e}(Hn);kn.registerType("Vec2",Bn);var Dn=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}var n=this;if(n=t.call(this)||this,e instanceof Float32Array||e instanceof Uint32Array)n.__data=e;else if(e instanceof ArrayBuffer){var r=e,o=a;n.__data=new Float32Array(r,o,3)}else null!=e&&"object"==typeof e?(n.__data=new Float32Array(3),n.fromJSON(e)):(n.__data=new Float32Array(3),n.__data[0]=e,n.__data[1]=a,n.__data[2]=i);return n}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xy",{get:function(){return new Bn(this.__data[0],this.__data[1])},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yz",{get:function(){return new Bn(this.__data[1],this.__data[2])},enumerable:true,configurable:true});e.prototype.set=function(t,e,a){this.x=t,this.y=void 0!==e?e:t,this.z=void 0!==a?a:t};e.prototype.setDataArray=function(t){this.__data=t};e.prototype.setFromOther=function(t){this.x=t.x,this.y=t.y,this.z=t.z};e.prototype.isNull=function(){return Math.abs(this.x)<Number.EPSILON&&Math.abs(this.y)<Number.EPSILON&&Math.abs(this.z)<Number.EPSILON};e.prototype.is111=function(){return Math.abs(1-this.x)<Number.EPSILON&&Math.abs(1-this.y)<Number.EPSILON&&Math.abs(1-this.z)<Number.EPSILON};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z};e.prototype.notEquals=function(t){return this.x!=t.x&&this.y!=t.y&&this.z!=t.z};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)};e.prototype.subtractInPlace=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z};e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z)};e.prototype.multiplyInPlace=function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z};e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z)};e.prototype.divideInPlace=function(t){this.x/=t.x,this.y/=t.y,this.z/=t.z};e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t)};e.prototype.scaleInPlace=function(t){this.x*=t,this.y*=t,this.z*=t};e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z)};e.prototype.inverse=function(){return new e(1/this.x,1/this.y,1/this.z)};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2];return t*t+e*e+a*a};e.prototype.length=function(){return Math.sqrt(this.lengthSquared())};e.prototype.distanceTo=function(t){var e=this.__data[0]-t.x,a=this.__data[1]-t.y,i=this.__data[2]-t.z;return Math.sqrt(e*e+a*a+i*i)};e.prototype.normalize=function(){var t=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];return t<Number.EPSILON?new e:(t=1/Math.sqrt(t),new e(this.__data[0]*t,this.__data[1]*t,this.__data[2]*t))};e.prototype.normalizeInPlace=function(){var t=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(t<Number.EPSILON)return;t=Math.sqrt(t);var e=1/t;return this.__data[0]*=e,this.__data[1]*=e,this.__data[2]*=e,t};e.prototype.resize=function(t){var a=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(a<Number.EPSILON)return;var i=t/Math.sqrt(a);return new e(this.__data[0]*i,this.__data[1]*i,this.__data[2]*i)};e.prototype.resizeInPlace=function(t){var e=this.__data[0]*this.__data[0]+this.__data[1]*this.__data[1]+this.__data[2]*this.__data[2];if(e<Number.EPSILON)return;var a=t/Math.sqrt(e);this.__data[0]*=a,this.__data[1]*=a,this.__data[2]*=a};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z};e.prototype.cross=function(t){var a=this.x,i=this.y,n=this.z,r=t.x,o=t.y,l=t.z;return new e(i*l-n*o,n*r-a*l,a*o-i*r)};e.prototype.angleTo=function(t){var e=this.dot(t);return e>1?0:Math.acos(e)};e.prototype.lerp=function(t,a){var i=this.x,n=this.y,r=this.z;return new e(i+a*(t.x-i),n+a*(t.y-n),r+a*(t.z-r))};e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))};e.prototype.setRandomDir=function(t){if(t===void 0){t=1}var e=2*Math.random()*Math.PI,a=2*Math.random()-1,i=Math.sqrt(1-a*a)*t;return this.__data[0]=Math.cos(e)*i,this.__data[1]=Math.sin(e)*i,this.__data[2]=a*t,this};e.prototype.setRandom=function(t){if(t===void 0){t=1}return this.__data[0]=(Math.random()-.5)*t,this.__data[1]=(Math.random()-.5)*t,this.__data[2]=(Math.random()-.5)*t,this};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2])};e.prototype.asArray=function(){return this.__data};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromJSON=function(t){var a=new e;return a.fromJSON(t),a};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.createFromFloat32Array=function(t){return new e(t)};e.numElements=function(){return 3};e.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z}};e.prototype.fromJSON=function(t){this.x=t.x,this.y=t.y,this.z=t.z};return e}(Hn);kn.registerType("Vec3",Dn);var On=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}var r=this;if(r=t.call(this)||this,e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Float32Array(o,l,4)}else null!=e&&"object"==typeof e?(r.__data=new Float32Array(4),r.fromJSON(e)):(r.__data=new Float32Array(4),r.__data[0]=e,r.__data[1]=a,r.__data[2]=i,r.__data[3]=n);return r}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"t",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xyz",{get:function(){return new Dn(this.__data[0],this.__data[1],this.__data[2])},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){this.x=t,this.y=e,this.z=a,this.t=i};e.prototype.setFromOther=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.t=t.t};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.t==t.t};e.prototype.notEquals=function(t){return this.x!=t.x&&this.y!=t.y&&this.z!=t.z&&this.t!=t.t};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&Math.abs(this.t-t.t)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.t+t.t)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.t+=t.t};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.t-t.t)};e.prototype.subtractInPlace=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.t-=t.t};e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.t*t.t)};e.prototype.multiplyInPlace=function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z,this.t*=t.t};e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.t/t.t)};e.prototype.divideInPlace=function(t){this.x/=t.x,this.y/=t.y,this.z/=t.z,this.t/=t.t};e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.t*t)};e.prototype.scaleInPlace=function(t){this.set(this.x*t,this.y*t,this.z*t,this.t*t)};e.prototype.length=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[2];return Math.sqrt(t*t+e*e+a*a+i*i)};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];return t*t+e*e+a*a+i*i};e.prototype.normalize=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3];var r=t*t+a*a+i*i+n*n;return r<Number.EPSILON?new e:(r=1/Math.sqrt(r),new e(t*r,a*r,i*r))};e.prototype.normalizeInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];var n=t*t+e*e+a*a+i*i;n<Number.EPSILON||(n=1/Math.sqrt(n),this.set(t*n,e*n,a*n,i*n))};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.t*b.t};e.prototype.cross=function(t){var a=this.x,i=this.y,n=this.z,r=this.t,o=t.x,l=t.y,s=t.z,d=t.t;return new e(i*s-n*l,n*d-r*s,r*o-a*d,a*l-i*o)};e.prototype.angleTo=function(t){var e=this.normalize(),a=t.normalize(),i=e.dot(a);return i>1?0:Math.acos(i)};e.prototype.lerp=function(t,a){var i=this.x,n=this.y,r=this.z;return at=this.t,new e(i+a*(t.x-i),n+a*(t.y-n),r+a*(t.z-r),at+a*(t.t-at))};e.prototype.random=function(t){if(t===void 0){t=1}var e=2*glMatrix.RANDOM()*Math.PI,a=2*glMatrix.RANDOM()-1,i=Math.sqrt(1-a*a)*t;return out[0]=Math.cos(e)*i,out[1]=Math.sin(e)*i,out[2]=a*t,out};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.toVec3=function(){return new Dn(this.__data[0],this.__data[1],this.__data[2])};e.prototype.asArray=function(){return this.__data};e.create=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return new(Dn.bind.apply(Dn,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z,t:this.t}};return e}(Hn);kn.registerType("Vec4",On);var Qn=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=255}var r=this;if(r=t.call(this)||this,e instanceof Uint8Array)r.__data=e;else if(e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Uint8Array(o,l,4)}else r.__data=new Uint8Array(4),"string"==typeof e?e.startsWith("#")?r.setFromHex(e):r.setFromCSSColorName(e):(r.__data[0]=e,r.__data[1]=a,r.__data[2]=i,r.__data[3]=n);return r}Object.defineProperty(e.prototype,"r",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"g",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"b",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"a",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){if(i===void 0){i=255}this.r=t,this.g=e,this.b=a,this.a=i};e.prototype.setFromOther=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.setFromArray=function(t){this.r=t[0],this.g=t[1],this.b=t[2],this.a=4==t.length?t[3]:1};e.prototype.setFromHex=function(t){var e=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}(t);e?this.set(e.r,e.g,e.b):console.warn("Invalid hex code:"+t)};e.prototype.setFromCSSColorName=function(t){t.startsWith("#")?this.setFromHex(t):this.setFromHex(function(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==e[t.toLowerCase()]&&e[t.toLowerCase()]}(t))};e.prototype.toHex=function(){function t(t){var e=t.toString(16);return 1==e.length?"0"+e:e}return"#"+t(this.r)+t(this.g)+t(this.b)};e.prototype.equal=function(t){return this.r==t.r&&this.g==t.g&&this.b==t.b&&this.a==t.a};e.prototype.notequals=function(t){return this.r!=t.r&&this.g!=t.g&&this.b!=t.b&&this.a!=t.a};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.r-t.r)<e&&Math.abs(this.g-t.g)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.a-t.a)<e};e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)};e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)};e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)};e.prototype.scaleInPlace=function(t){this.r*=t,this.g*=t,this.b*=t,this.a*=t};e.prototype.applyGamma=function(t){this.set(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toLinear=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toGamma=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,1/t),Math.pow(this.g,1/t),Math.pow(this.b,1/t),this.a)};e.prototype.luminance=function(){return.2126*this.r+.7152*this.g+.0722*this.b};e.prototype.lerp=function(t,a){var i=this.r,n=this.g,r=this.b,o=this.a;return new e(i+a*(t.r-i),n+a*(t.g-n),r+a*(t.b-r),o+a*(t.a-o))};e.random=function(t,a){if(t===void 0){t=0}if(a===void 0){a=!1}return t>0?new e(t+Math.random()*(1-t),t+Math.random()*(1-t),t+Math.random()*(1-t),a?t+Math.random()*(1-t):1):t<0?new e(Math.random()*(1+t),Math.random()*(1+t),Math.random()*(1+t),a?Math.random()*(1+t):1):new e(Math.random(),Math.random(),Math.random(),a?Math.random():1)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.asArray=function(){return this.__data};e.prototype.as3ComponentArray=function(){return[this.__data[0],this.__data[1],this.__data[2]]};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b,a:this.a}};e.prototype.fromJSON=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.toCSSString=function(){return"rgba("+Math.round(255*this.r)+", "+Math.round(255*this.g)+", "+Math.round(255*this.b)+", "+this.a+")"};return e}(Hn);kn.registerType("RGBA",Qn);var An=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=1}var r=this;if(r=t.call(this)||this,e instanceof Float32Array)r.__data=e;else if(e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Float32Array(o,l,4)}else r.__data=new Float32Array(4),"string"==typeof e?e.startsWith("#")?r.setFromHex(e):r.setFromCSSColorName(e):(r.__data[0]=e,r.__data[1]=a,r.__data[2]=i,r.__data[3]=n);return r}Object.defineProperty(e.prototype,"r",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"g",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"b",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"a",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){if(i===void 0){i=1}this.r=t,this.g=e,this.b=a,this.a=i};e.prototype.setFromOther=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.setFromScalarArray=function(t){this.r=t[0],this.g=t[1],this.b=t[2],this.a=4==t.length?t[3]:1};e.prototype.getAsRGBArray=function(){return[255*this.r,255*this.g,255*this.b]};e.prototype.getAsRGBDict=function(){return{r:255*this.r,g:255*this.g,b:255*this.b}};e.prototype.setFromRGB=function(t,e,a,i){this.r=t/255,this.g=e/255,this.b=a/255,this.a=i?i/255:1};e.prototype.setFromRGBArray=function(t){this.r=t[0]/255,this.g=t[1]/255,this.b=t[2]/255,this.a=4==t.length?t[3]/255:1};e.prototype.setFromRGBDict=function(t){this.r=t.r/255,this.g=t.g/255,this.b=t.b/255,this.a=4==t.a?t.a/255:1};e.prototype.setFromHex=function(t){var e=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}(t);e?this.setFromRGB(e.r,e.g,e.b):console.warn("Invalid hex code:"+t)};e.prototype.setFromCSSColorName=function(t){t.startsWith("#")?this.setFromHex(t):this.setFromHex(function(t){var e={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==e[t.toLowerCase()]&&e[t.toLowerCase()]}(t))};e.prototype.toHex=function(){function t(t){var e=Math.round(255*t).toString(16);return 1==e.length?"0"+e:e}return"#"+t(this.r)+t(this.g)+t(this.b)};e.prototype.equal=function(t){return this.r==t.r&&this.g==t.g&&this.b==t.b&&this.a==t.a};e.prototype.notequals=function(t){return this.r!=t.r&&this.g!=t.g&&this.b!=t.b&&this.a!=t.a};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.r-t.r)<e&&Math.abs(this.g-t.g)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.a-t.a)<e};e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)};e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)};e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)};e.prototype.scaleInPlace=function(t){this.r*=t,this.g*=t,this.b*=t,this.a*=t};e.prototype.applyGamma=function(t){this.set(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toLinear=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,t),Math.pow(this.g,t),Math.pow(this.b,t),this.a)};e.prototype.toGamma=function(t){if(t===void 0){t=2.2}return new e(Math.pow(this.r,1/t),Math.pow(this.g,1/t),Math.pow(this.b,1/t),this.a)};e.prototype.luminance=function(){return.2126*this.r+.7152*this.g+.0722*this.b};e.prototype.lerp=function(t,a){var i=this.r,n=this.g,r=this.b,o=this.a;return new e(i+a*(t.r-i),n+a*(t.g-n),r+a*(t.b-r),o+a*(t.a-o))};e.random=function(t,a){if(t===void 0){t=0}if(a===void 0){a=!1}return t>0?new e(t+Math.random()*(1-t),t+Math.random()*(1-t),t+Math.random()*(1-t),a?t+Math.random()*(1-t):1):t<0?new e(Math.random()*(1+t),Math.random()*(1+t),Math.random()*(1+t),a?Math.random()*(1+t):1):new e(Math.random(),Math.random(),Math.random(),a?Math.random():1)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.asArray=function(){return this.__data};e.prototype.as3ComponentArray=function(){return[this.__data[0],this.__data[1],this.__data[2]]};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b,a:this.a}};e.prototype.fromJSON=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};e.prototype.toCSSString=function(){return"rgba("+Math.round(255*this.r)+", "+Math.round(255*this.g)+", "+Math.round(255*this.b)+", "+this.a+")"};return e}(Hn);kn.registerType("Color",An);var jn=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}var r=this;if(r=t.call(this)||this,isNaN(n))switch(n){case"XYZ":r.order=0;break;case"YZX":r.order=1;break;case"ZXY":r.order=2;break;case"XZY":r.order=3;break;case"ZYX":r.order=4;break;case"YXZ":r.order=5;break;default:throw new Error("Invalid Euler Angles Order:"+n)}else r.order=n;if(e instanceof ArrayBuffer){var o=e,l=a;r.__data=new Float32Array(o,l,4)}else r.__data=new Float32Array(3),r.__data[0]=e,r.__data[1]=a,r.__data[2]=i;return r}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a){this.__data[0]=t,this.__data[1]=e,this.__data[2]=a};return e}(Hn);kn.registerType("EulerAngles",jn);var qn=function(t){__extends(e,t);function e(e,a,i,n,r,o,l,s,d){if(e===void 0){e=1}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=1}if(o===void 0){o=0}if(l===void 0){l=0}if(s===void 0){s=0}if(d===void 0){d=1}var c=this;if(c=t.call(this)||this,e instanceof ArrayBuffer){var u=e,h=a;c.__data=new Float32Array(u,h,9)}else c.__data=new Float32Array(9),c.set(e,a,i,n,r,o,l,s,d);return c}Object.defineProperty(e.prototype,"m00",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m01",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m02",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m10",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m11",{get:function(){return this.__data[4]},set:function(t){this.__data[4]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m12",{get:function(){return this.__data[5]},set:function(t){this.__data[5]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m20",{get:function(){return this.__data[6]},set:function(t){this.__data[6]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m21",{get:function(){return this.__data[7]},set:function(t){this.__data[7]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m22",{get:function(){return this.__data[8]},set:function(t){this.__data[8]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xAxis",{get:function(){return Dn.createFromFloat32Buffer(this.__data.buffer,0)},set:function(t){this.xAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yAxis",{get:function(){return Dn.createFromFloat32Buffer(this.__data.buffer,3)},set:function(t){this.yAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"zAxis",{get:function(){return Dn.createFromFloat32Buffer(this.__data.buffer,6)},set:function(t){this.zAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i,n,r,o,l,s){if(t===void 0){t=1}if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=1}if(r===void 0){r=0}if(o===void 0){o=0}if(l===void 0){l=0}if(s===void 0){s=1}this.__data[0]=t,this.__data[1]=e,this.__data[2]=a,this.__data[3]=i,this.__data[4]=n,this.__data[5]=r,this.__data[6]=o,this.__data[7]=l,this.__data[8]=s};e.prototype.setIdentity=function(){this.set()};e.prototype.setFromMat=function(t){this.__data[0]=t.m00,this.__data[1]=t.m01,this.__data[2]=t.m02,this.__data[3]=t.m10,this.__data[4]=t.m11,this.__data[5]=t.m12,this.__data[6]=t.m20,this.__data[7]=t.m21,this.__data[8]=t.m22};e.prototype.setFromDirectionAndUpvector=function(t,e){var a=t,i=a.length();if(i<Number.EPSILON)return void this.setIdentity();a.scaleInPlace(1/i);var n=e.cross(a),r=n.length();r>Number.EPSILON&&n.scaleInPlace(1/r);var o=a.cross(n),l=o.length();l>Number.EPSILON&&o.scaleInPlace(1/l),this.set(n.x,n.y,n.z,o.x,o.y,o.z,a.x,a.y,a.z)};e.prototype.inverse=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3],r=this.__data[4],o=this.__data[5],l=this.__data[6],s=this.__data[7],d=this.__data[8],c=d*r-o*s,u=-d*n+o*l,h=s*n-r*l,m=t*c+a*u+i*h;return m?(m=1/m,new e(c*m,(-d*a+i*s)*m,(o*a-i*r)*m,u*m,(d*t-i*l)*m,(-o*t+i*n)*m,h*m,(-s*t+a*l)*m,(r*t-a*n)*m)):(console.warn("Unable to invert Mat3"),null)};e.prototype.invertInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3],n=this.__data[4],r=this.__data[5],o=this.__data[6],l=this.__data[7],s=this.__data[8],d=s*n-r*l,c=-s*i+r*o,u=l*i-n*o,h=t*d+e*c+a*u;return h?(h=1/h,this.set(d*h,(-s*e+a*l)*h,(r*e-a*n)*h,c*h,(s*t-a*o)*h,(-r*t+a*i)*h,u*h,(-l*t+e*o)*h,(n*t-e*i)*h),!0):(console.warn("Unable to invert Mat3"),!1)};e.prototype.transpose=function(){return e(this.__data[0],this.__data[3],this.__data[6],this.__data[1],this.__data[4],this.__data[7],this.__data[2],this.__data[5],this.__data[8])};e.prototype.transposeInPlace=function(){var t=this.__data[1],e=this.__data[2],a=this.__data[5];this.__data[1]=this.__data[3],this.__data[2]=this.__data[6],this.__data[3]=t,this.__data[5]=this.__data[7],this.__data[6]=e,this.__data[7]=a};e.prototype.transformVec3=function(t){return new Dn(this.__data[0]*t.x+this.__data[1]*t.y+this.__data[2]*t.z,this.__data[3]*t.x+this.__data[4]*t.y+this.__data[5]*t.z,this.__data[6]*t.x+this.__data[7]*t.y+this.__data[8]*t.z)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3],this.__data[4],this.__data[5],this.__data[6],this.__data[7],this.__data[8],this.__data[9])};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.prototype.toJSON=function(){return this.__data};e.prototype.fromJSON=function(t){this.__data=new Float32Array(t)};e.prototype.toString=function(){return this.toJSON().toString()};return e}(Hn);kn.registerType("Mat3",qn);var $n=function(t){__extends(e,t);function e(e,a,i,n,r,o,l,s,d,c,u,h,m,p,f,b){if(e===void 0){e=1}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=0}if(o===void 0){o=1}if(l===void 0){l=0}if(s===void 0){s=0}if(d===void 0){d=0}if(c===void 0){c=0}if(u===void 0){u=1}if(h===void 0){h=0}if(m===void 0){m=0}if(p===void 0){p=0}if(f===void 0){f=0}if(b===void 0){b=1}var y=this;if(y=t.call(this)||this,e instanceof Float32Array)y.__data=e;else if(e instanceof ArrayBuffer){var g=e,_=a;y.__data=new Float32Array(g,_,16)}else y.__data=new Float32Array(16),y.set(e,a,i,n,r,o,l,s,d,c,u,h,m,p,f,b);return y}Object.defineProperty(e.prototype,"m00",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m01",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m02",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m03",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m10",{get:function(){return this.__data[4]},set:function(t){this.__data[4]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m11",{get:function(){return this.__data[5]},set:function(t){this.__data[5]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m12",{get:function(){return this.__data[6]},set:function(t){this.__data[6]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m13",{get:function(){return this.__data[7]},set:function(t){this.__data[7]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m20",{get:function(){return this.__data[8]},set:function(t){this.__data[8]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m21",{get:function(){return this.__data[9]},set:function(t){this.__data[9]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m22",{get:function(){return this.__data[10]},set:function(t){this.__data[10]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m23",{get:function(){return this.__data[11]},set:function(t){this.__data[11]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m30",{get:function(){return this.__data[12]},set:function(t){this.__data[12]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m31",{get:function(){return this.__data[13]},set:function(t){this.__data[13]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m32",{get:function(){return this.__data[14]},set:function(t){this.__data[14]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"m33",{get:function(){return this.__data[15]},set:function(t){this.__data[15]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"xAxis",{get:function(){return Dn.createFromFloat32Buffer(this.__data.buffer,0)},set:function(t){this.xAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yAxis",{get:function(){return Dn.createFromFloat32Buffer(this.__data.buffer,4)},set:function(t){this.yAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"zAxis",{get:function(){return Dn.createFromFloat32Buffer(this.__data.buffer,8)},set:function(t){this.zAxis.set(t.x,t.y,t.z)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"translation",{get:function(){return Dn.createFromFloat32Buffer(this.__data.buffer,12)},set:function(t){this.translation.set(t.x,t.y,t.z)},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i,n,r,o,l,s,d,c,u,h,m,p,f){if(t===void 0){t=1}if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=1}if(o===void 0){o=0}if(l===void 0){l=0}if(s===void 0){s=0}if(d===void 0){d=0}if(c===void 0){c=1}if(u===void 0){u=0}if(h===void 0){h=0}if(m===void 0){m=0}if(p===void 0){p=0}if(f===void 0){f=1}this.__data[0]=t,this.__data[1]=e,this.__data[2]=a,this.__data[3]=i,this.__data[4]=n,this.__data[5]=r,this.__data[6]=o,this.__data[7]=l,this.__data[8]=s,this.__data[9]=d,this.__data[10]=c,this.__data[11]=u,this.__data[12]=h,this.__data[13]=m,this.__data[14]=p,this.__data[15]=f};e.prototype.setIdentity=function(){this.set()};e.prototype.setDataArray=function(t){this.__data=t};e.prototype.setFromMat4=function(t){this.__data[0]=t.m00,this.__data[1]=t.m01,this.__data[2]=t.m02,this.__data[3]=t.m03,this.__data[4]=t.m10,this.__data[5]=t.m11,this.__data[6]=t.m12,this.__data[7]=t.m13,this.__data[8]=t.m20,this.__data[9]=t.m21,this.__data[10]=t.m22,this.__data[11]=t.m23,this.__data[12]=t.m30,this.__data[13]=t.m31,this.__data[14]=t.m32,this.__data[15]=t.m33};e.prototype.toMat3=function(t){return new qn(this.__data[0],this.__data[1],this.__data[2],this.__data[4],this.__data[5],this.__data[6],this.__data[8],this.__data[9],this.__data[10])};e.prototype.transposeInPlace=function(){var t=this.__data[1],e=this.__data[2],a=this.__data[3],i=this.__data[6],n=this.__data[7],r=this.__data[11];this.__data[1]=this.__data[4],this.__data[2]=this.__data[8],this.__data[3]=this.__data[12],this.__data[4]=t,this.__data[6]=this.__data[9],this.__data[7]=this.__data[13],this.__data[8]=e,this.__data[9]=i,this.__data[11]=this.__data[14],this.__data[12]=a,this.__data[13]=n,this.__data[14]=r};e.prototype.transpose=function(){return new e(this.__data[0],this.__data[4],this.__data[8],this.__data[12],this.__data[1],this.__data[5],this.__data[9],this.__data[13],this.__data[2],this.__data[6],this.__data[10],this.__data[14],this.__data[3],this.__data[7],this.__data[11],this.__data[15])};e.prototype.inverse=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3],r=this.__data[4],o=this.__data[5],l=this.__data[6],s=this.__data[7],d=this.__data[8],c=this.__data[9],u=this.__data[10],h=this.__data[11],m=this.__data[12],p=this.__data[13],f=this.__data[14],b=this.__data[15],y=t*o-a*r,g=t*l-i*r,_=t*s-n*r,Z=a*l-i*o,G=a*s-n*o,X=i*s-n*l,v=d*p-c*m,V=d*f-u*m,I=d*b-h*m,R=c*f-u*p,x=c*b-h*p,S=u*b-h*f;var W=y*S-g*x+_*R+Z*I-G*V+X*v;return W?(W=1/W,new e((o*S-l*x+s*R)*W,(i*x-a*S-n*R)*W,(p*X-f*G+b*Z)*W,(u*G-c*X-h*Z)*W,(l*I-r*S-s*V)*W,(t*S-i*I+n*V)*W,(f*_-m*X-b*g)*W,(d*X-u*_+h*g)*W,(r*x-o*I+s*v)*W,(a*I-t*x-n*v)*W,(m*G-p*_+b*y)*W,(c*_-d*G-h*y)*W,(o*V-r*R-l*v)*W,(t*R-a*V+i*v)*W,(p*g-m*Z-f*y)*W,(d*Z-c*g+u*y)*W)):(console.warn("Unable to invert Mat4"),null)};e.prototype.invertInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3],n=this.__data[4],r=this.__data[5],o=this.__data[6],l=this.__data[7],s=this.__data[8],d=this.__data[9],c=this.__data[10],u=this.__data[11],h=this.__data[12],m=this.__data[13],p=this.__data[14],f=this.__data[15],b=t*r-e*n,y=t*o-a*n,g=t*l-i*n,_=e*o-a*r,Z=e*l-i*r,G=a*l-i*o,X=s*m-d*h,v=s*p-c*h,V=s*f-u*h,I=d*p-c*m,R=d*f-u*m,x=c*f-u*p;var S=b*x-y*R+g*I+_*V-Z*v+G*X;return S?(S=1/S,this.set((r*x-o*R+l*I)*S,(a*R-e*x-i*I)*S,(m*G-p*Z+f*_)*S,(c*Z-d*G-u*_)*S,(o*V-n*x-l*v)*S,(t*x-a*V+i*v)*S,(p*g-h*G-f*y)*S,(s*G-c*g+u*y)*S,(n*R-r*V+l*X)*S,(e*V-t*R-i*X)*S,(h*Z-m*g+f*b)*S,(d*g-s*Z-u*b)*S,(r*v-n*I-o*X)*S,(t*I-e*v+a*X)*S,(m*y-h*_-p*b)*S,(s*_-d*y+c*b)*S),!0):(console.warn("Unable to invert Mat4"),!1)};e.prototype.setInverse=function(t){var e=t.__data[0],a=t.__data[1],i=t.__data[2],n=t.__data[3],r=t.__data[4],o=t.__data[5],l=t.__data[6],s=t.__data[7],d=t.__data[8],c=t.__data[9],u=t.__data[10],h=t.__data[11],m=t.__data[12],p=t.__data[13],f=t.__data[14],b=t.__data[15],y=e*o-a*r,g=e*l-i*r,_=e*s-n*r,Z=a*l-i*o,G=a*s-n*o,X=i*s-n*l,v=d*p-c*m,V=d*f-u*m,I=d*b-h*m,R=c*f-u*p,x=c*b-h*p,S=u*b-h*f;var W=y*S-g*x+_*R+Z*I-G*V+X*v;if(!W)throw new Error("Unable to invert Mat4");W=1/W,this.set((o*S-l*x+s*R)*W,(i*x-a*S-n*R)*W,(p*X-f*G+b*Z)*W,(u*G-c*X-h*Z)*W,(l*I-r*S-s*V)*W,(e*S-i*I+n*V)*W,(f*_-m*X-b*g)*W,(d*X-u*_+h*g)*W,(r*x-o*I+s*v)*W,(a*I-e*x-n*v)*W,(m*G-p*_+b*y)*W,(c*_-d*G-h*y)*W,(o*V-r*R-l*v)*W,(e*R-a*V+i*v)*W,(p*g-m*Z-f*y)*W,(d*Z-c*g+u*y)*W)};e.prototype.multiply=function(t){var a=this.__data[0],i=this.__data[1],n=this.__data[2],r=this.__data[3],o=this.__data[4],l=this.__data[5],s=this.__data[6],d=this.__data[7],c=this.__data[8],u=this.__data[9],h=this.__data[10],m=this.__data[11],p=this.__data[12],f=this.__data[13],b=this.__data[14],y=this.__data[15],g=t.asArray();var _=g[0],Z=g[1],G=g[2],X=g[3];var v=new e;return v.m00=_*a+Z*o+G*c+X*p,v.m01=_*i+Z*l+G*u+X*f,v.m02=_*n+Z*s+G*h+X*b,v.m03=_*r+Z*d+G*m+X*y,_=g[4],Z=g[5],G=g[6],X=g[7],v.m10=_*a+Z*o+G*c+X*p,v.m11=_*i+Z*l+G*u+X*f,v.m12=_*n+Z*s+G*h+X*b,v.m13=_*r+Z*d+G*m+X*y,_=g[8],Z=g[9],G=g[10],X=g[11],v.m20=_*a+Z*o+G*c+X*p,v.m21=_*i+Z*l+G*u+X*f,v.m22=_*n+Z*s+G*h+X*b,v.m23=_*r+Z*d+G*m+X*y,_=g[12],Z=g[13],G=g[14],X=g[15],v.m30=_*a+Z*o+G*c+X*p,v.m31=_*i+Z*l+G*u+X*f,v.m32=_*n+Z*s+G*h+X*b,v.m33=_*r+Z*d+G*m+X*y,v};e.prototype.multiplyInPlace=function(t){var e=this.asArray(),a=e[0],i=e[1],n=e[2],r=e[3],o=e[4],l=e[5],s=e[6],d=e[7],c=e[8],u=e[9],h=e[10],m=e[11],p=e[12],f=e[13],b=e[14],y=e[15],g=t.asArray();var _=g[0],Z=g[1],G=g[2],X=g[3];return this.m00=_*a+Z*o+G*c+X*p,this.m01=_*i+Z*l+G*u+X*f,this.m02=_*n+Z*s+G*h+X*b,this.m03=_*r+Z*d+G*m+X*y,_=g[4],Z=g[5],G=g[6],X=g[7],this.m10=_*a+Z*o+G*c+X*p,this.m11=_*i+Z*l+G*u+X*f,this.m12=_*n+Z*s+G*h+X*b,this.m13=_*r+Z*d+G*m+X*y,_=g[8],Z=g[9],G=g[10],X=g[11],this.m20=_*a+Z*o+G*c+X*p,this.m21=_*i+Z*l+G*u+X*f,this.m22=_*n+Z*s+G*h+X*b,this.m23=_*r+Z*d+G*m+X*y,_=g[12],Z=g[13],G=g[14],X=g[15],this.m30=_*a+Z*o+G*c+X*p,this.m31=_*i+Z*l+G*u+X*f,this.m32=_*n+Z*s+G*h+X*b,this.m33=_*r+Z*d+G*m+X*y,this};e.prototype.postmultiplyInPlace=function(t){var e=t.asArray(),a=e[0],i=e[1],n=e[2],r=e[3],o=e[4],l=e[5],s=e[6],d=e[7],c=e[8],u=e[9],h=e[10],m=e[11],p=e[12],f=e[13],b=e[14],y=e[15],g=this.asArray();var _=g[0],Z=g[1],G=g[2],X=g[3];return this.m00=_*a+Z*o+G*c+X*p,this.m01=_*i+Z*l+G*u+X*f,this.m02=_*n+Z*s+G*h+X*b,this.m03=_*r+Z*d+G*m+X*y,_=g[4],Z=g[5],G=g[6],X=g[7],this.m10=_*a+Z*o+G*c+X*p,this.m11=_*i+Z*l+G*u+X*f,this.m12=_*n+Z*s+G*h+X*b,this.m13=_*r+Z*d+G*m+X*y,_=g[8],Z=g[9],G=g[10],X=g[11],this.m20=_*a+Z*o+G*c+X*p,this.m21=_*i+Z*l+G*u+X*f,this.m22=_*n+Z*s+G*h+X*b,this.m23=_*r+Z*d+G*m+X*y,_=g[12],Z=g[13],G=g[14],X=g[15],this.m30=_*a+Z*o+G*c+X*p,this.m31=_*i+Z*l+G*u+X*f,this.m32=_*n+Z*s+G*h+X*b,this.m33=_*r+Z*d+G*m+X*y,this};e.prototype.translateInPlace=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z;return e[12]=e[0]*a+e[4]*i+e[8]*n+e[12],e[13]=e[1]*a+e[5]*i+e[9]*n+e[13],e[14]=e[2]*a+e[6]*i+e[10]*n+e[14],e[15]=e[3]*a+e[7]*i+e[11]*n+e[15],this};e.prototype.setLookAt=function(t,e,a){var i=t.subtract(e),n=i.length();if(n<Number.EPSILON)return void this.setIdentity();i.scaleInPlace(1/n);var r=a.cross(i),o=r.length();o>Number.EPSILON&&r.scaleInPlace(1/o);var l=i.cross(r),s=l.length();s>Number.EPSILON&&l.scaleInPlace(1/s),this.set(r.x,r.y,r.z,0,l.x,l.y,l.z,0,i.x,i.y,i.z,0,t.x,t.y,t.z,1)};e.prototype.setRotation=function(t,e){var a=t.length();if(Math.abs(a)<Number.EPSILON)return null;var i=t.x/a,n=t.y/a,r=t.z/a,o=Math.sin(e),l=Math.cos(e),s=1-l,d=this.__data;return d[0]=i*i*s+l,d[1]=n*i*s+r*o,d[2]=r*i*s-n*o,d[3]=0,d[4]=i*n*s-r*o,d[5]=n*n*s+l,d[6]=r*n*s+i*o,d[7]=0,d[8]=i*r*s+n*o,d[9]=n*r*s-i*o,d[10]=r*r*s+l,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this};e.prototype.setXRotation=function(t){var e=Math.sin(t),a=Math.cos(t),i=this.__data;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=e,i[7]=0,i[8]=0,i[9]=-e,i[10]=a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this};e.prototype.setYRotation=function(t){var e=Math.sin(t),a=Math.cos(t),i=this.__data;return i[0]=a,i[1]=0,i[2]=-e,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=e,i[9]=0,i[10]=a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this};e.prototype.setZRotation=function(t){var e=Math.sin(t),a=Math.cos(t),i=this.__data;return i[0]=a,i[1]=e,i[2]=0,i[3]=0,i[4]=-e,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this};e.prototype.transformVec4=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z,r=t.t;return new Vec4(e[0]*a+e[4]*i+e[8]*n+e[12]*r,e[1]*a+e[5]*i+e[9]*n+e[13]*r,e[2]*a+e[6]*i+e[10]*n+e[14]*r,e[3]*a+e[7]*i+e[11]*n+e[15]*r)};e.prototype.transformVec3=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z;return new Dn(e[0]*a+e[4]*i+e[8]*n+e[12],e[1]*a+e[5]*i+e[9]*n+e[13],e[2]*a+e[6]*i+e[10]*n+e[14])};e.prototype.rotateVec3=function(t){var e=this.__data,a=t.x,i=t.y,n=t.z;return new Dn(e[0]*a+e[4]*i+e[8]*n,e[1]*a+e[5]*i+e[9]*n,e[2]*a+e[6]*i+e[10]*n)};e.prototype.setPerspectiveMatrix=function(t,e,a,i){var n=Math.tan(.5*Math.PI-.5*t),r=1/(a-i);this.set(n/e,0,0,0,0,n,0,0,0,0,(a+i)*r,-1,0,0,a*i*r*2,0)};e.prototype.setOrthographicMatrix=function(t,e,a,i,n,r){var o=1/(t-e),l=1/(a-i),s=1/(n-r);this.set(-2*o,0,0,0,0,-2*l,0,0,0,0,2*s,0,(t+e)*o,(i+a)*l,(r+n)*s,1)};e.prototype.setScale=function(t,e,a){t instanceof Dn?this.set(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1):this.set(t,0,0,0,0,e,0,0,0,0,a,0,0,0,0,1)};e.prototype.setFromMat3x4Array=function(t){this.set(t[0],t[1],t[2],0,t[3],t[4],t[5],0,t[6],t[7],t[8],0,t[9],t[10],t[11],1)};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3],this.__data[4],this.__data[5],this.__data[6],this.__data[7],this.__data[8],this.__data[9],this.__data[10],this.__data[11],this.__data[12],this.__data[13],this.__data[14],this.__data[15])};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.prototype.toJSON=function(){return this.__data};e.prototype.fromJSON=function(t){this.__data=new Float32Array(t)};return e}(Hn);kn.registerType("Mat4",$n);var tr=function(t){__extends(e,t);function e(e,a,i,n){var r;if(e===void 0){e=0}if(a===void 0){a=0}if(i===void 0){i=0}if(n===void 0){n=1}var o=this;if(o=t.call(this)||this,e instanceof ArrayBuffer){var l=e,s=a;o.__data=new Float32Array(l,s,4)}else if(o.__data=new Float32Array(4),"object"==typeof e){o.__data[0]=0,o.__data[1]=0,o.__data[2]=0,o.__data[3]=1;for(var d in e)Array.isArray(e[d])?(r=o[d]).call.apply(r,__spreadArrays([o],e[d])):o[d].call(o,e[d])}else o.__data[0]=e,o.__data[1]=a,o.__data[2]=i,o.__data[3]=n;return o}Object.defineProperty(e.prototype,"x",{get:function(){return this.__data[0]},set:function(t){this.__data[0]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__data[1]},set:function(t){this.__data[1]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this.__data[2]},set:function(t){this.__data[2]=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"w",{get:function(){return this.__data[3]},set:function(t){this.__data[3]=t},enumerable:true,configurable:true});e.prototype.set=function(t,e,a,i){this.__data[0]=t,this.__data[1]=e,this.__data[2]=a,this.__data[3]=i};e.prototype.setDataArray=function(t){this.__data=t};e.prototype.setFromOther=function(t){this.__data[0]=t.x,this.__data[1]=t.y,this.__data[2]=t.z,this.__data[3]=t.w};e.prototype.setFromEulerAngles=function(t){var e=new Dn;switch(t.order){case 0:e.set(t.x,-t.y,t.z);break;case 1:e.set(t.y,-t.z,t.x);break;case 2:e.set(t.z,-t.x,t.y);break;case 3:e.set(t.x,t.z,t.y);break;case 4:e.set(t.z,t.y,t.x);break;case 5:e.set(t.y,t.x,t.z);break;default:throw new Error("sdrty")}var a=.5*e.x,i=.5*e.y,n=.5*e.z,r=Math.cos(a),o=Math.cos(i),l=Math.cos(n),s=Math.sin(a),d=Math.sin(i),c=Math.sin(n),u=r*l,h=r*c,m=s*l,p=s*c,f=o*m-d*h,b=o*p+d*u,y=o*h-d*m;switch(this.w=o*u+d*p,t.order){case 0:this.x=f,this.y=-b,this.z=y;break;case 1:this.x=y,this.y=f,this.z=-b;break;case 2:this.x=-b,this.y=y,this.z=f;break;case 3:this.x=f,this.y=y,this.z=b;break;case 4:this.x=y,this.y=b,this.z=f;break;case 5:this.x=b,this.y=f,this.z=y;break;default:throw new Error("sdrty")}};e.prototype.toEulerAngles=function(t){var e=new Dn;switch(t){case 0:e.set(this.z,this.x,this.y);break;case 1:e.set(this.x,this.y,this.z);break;case 2:e.set(this.y,this.z,this.x);break;case 3:e.set(this.y,-this.x,this.z);break;case 4:e.set(this.x,-this.z,this.y);break;case 5:e.set(this.z,-this.y,this.x);break;default:throw new Error("Invalid rotation order:"+t)}var a=new Dn,i=e.x*e.y+e.z*this.w;if(i>.49999)a.y=2*Math.atan2(e.x,this.w),a.z=.5*Math.PI,a.x=0;else if(i<-.49999)a.y=-2*Math.atan2(e.x,this.w),a.z=-.5*Math.PI,a.x=0;else{var n=e.x*e.x,r=e.y*e.y,o=e.z*e.z;a.y=Math.atan2(2*e.y*this.w-2*e.x*e.z,1-2*r-2*o),a.z=Math.asin(2*i),a.x=Math.atan2(2*e.x*this.w-2*e.y*e.z,1-2*n-2*o)}switch(t){case 0:return new jn(a.y,a.z,a.x,t);case 1:return new jn(a.x,a.y,a.z,t);case 2:return new jn(a.z,a.x,a.y,t);case 3:return new jn(-a.y,a.x,a.z,t);case 4:return new jn(a.x,a.z,-a.y,t);case 5:return new jn(a.z,-a.y,a.x,t)}};e.prototype.setFromAxisAndAngle=function(t,e){var a=e/2,i=t.normalize().scale(Math.sin(a));this.set(i.x,i.y,i.z,Math.cos(a))};e.prototype.setFromDirectionAndUpvector=function(t,e){var a=new qn;a.setFromDirectionAndUpvector(t,e),this.setFromMat3(a)};e.prototype.setFrom2Vectors=function(t,e){t.normalize(),e.normalize();var a=t.cross(e),i=t.dot(e),n=Math.sqrt(2*(1+i));this.set(a.x/n,a.y/n,a.z/n,n/2),this.normalizeInPlace()};e.prototype.setFromMat3=function(t){var e=t.__data[0]+t.__data[4]+t.__data[8];var a;if(e>0)a=Math.sqrt(e+1),this.__data[3]=.5*a,a=.5/a,this.__data[0]=(t.__data[5]-t.__data[7])*a,this.__data[1]=(t.__data[6]-t.__data[2])*a,this.__data[2]=(t.__data[1]-t.__data[3])*a;else{var i=0;t.__data[4]>t.__data[0]&&(i=1),t.__data[8]>t.__data[3*i+i]&&(i=2);var n=(i+1)%3,r=(i+2)%3;a=Math.sqrt(t.__data[3*i+i]-t.__data[3*n+n]-t.__data[3*r+r]+1),this.__data[i]=.5*a,a=.5/a,this.__data[3]=(t.__data[3*n+r]-t.__data[3*r+n])*a,this.__data[n]=(t.__data[3*n+i]+t.__data[3*i+n])*a,this.__data[r]=(t.__data[3*r+i]+t.__data[3*i+r])*a}this.normalizeInPlace()};e.prototype.setFromMat4=function(t){var e=t.__data[0]+t.__data[5]+t.__data[10];var a;if(e>0)a=Math.sqrt(e+1),this.__data[3]=.5*a,a=.5/a,this.__data[0]=(t.__data[6]-t.__data[9])*a,this.__data[1]=(t.__data[8]-t.__data[2])*a,this.__data[2]=(t.__data[1]-t.__data[4])*a;else{var i=0;t.__data[5]>t.__data[0]&&(i=1),t.__data[10]>t.__data[4*i+i]&&(i=2);var n=(i+1)%3,r=(i+2)%3;a=Math.sqrt(t.__data[4*i+i]-t.__data[4*n+n]-t.__data[4*r+r]+1),this.__data[i]=.5*a,a=.5/a,this.__data[3]=(t.__data[4*n+r]-t.__data[4*r+n])*a,this.__data[n]=(t.__data[4*n+i]+t.__data[4*i+n])*a,this.__data[r]=(t.__data[4*r+i]+t.__data[4*i+r])*a}this.normalizeInPlace()};e.prototype.isIdentity=function(){return this.getAngle()<Number.EPSILON};e.prototype.getAngle=function(){return 2*Math.acos(this.w)};e.prototype.equal=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.w==t.w};e.prototype.notequals=function(t){return this.x!=t.x&&this.y!=t.y&&this.z!=t.z&&this.w!=t.w};e.prototype.approxEqual=function(t,e){if(e===void 0){e=Number.EPSILON}return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.z-t.z)<e&&Math.abs(this.w-t.w)<e};e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)};e.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w};e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)};e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)};e.prototype.scaleInPlace=function(t){this.x*=t,this.y*=t,this.z*=t,this.w*=t};e.prototype.length=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];return Math.sqrt(t*t+e*e+a*a+i*i)};e.prototype.lengthSquared=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];return t*t+e*e+a*a+i*i};e.prototype.normalize=function(){var t=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3];var r=t*t+a*a+i*i+n*n;return r<Number.EPSILON?new e:(r=1/Math.sqrt(r),new e(t*r,a*r,i*r))};e.prototype.normalizeInPlace=function(){var t=this.__data[0],e=this.__data[1],a=this.__data[2],i=this.__data[3];var n=t*t+e*e+a*a+i*i;n<Number.EPSILON||(n=1/Math.sqrt(n),this.set(t*n,e*n,a*n,i*n))};e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w};e.prototype.cross=function(t){var a=this.x,i=this.y,n=this.z,r=this.w,o=t.x,l=t.y,s=t.z,d=t.w;return new e(i*s-n*l,n*d-r*s,r*o-a*d,a*l-i*o)};e.prototype.conjugate=function(){return new e(-this.x,-this.y,-this.z,this.w)};e.prototype.inverse=function(){return this.conjugate()};e.prototype.alignWith=function(t){this.dot(t)<0&&this.set(-this.x,-this.y,-this.z,-this.w)};e.prototype.multiply=function(t){var a=this.__data[0],i=this.__data[1],n=this.__data[2],r=this.__data[3],o=t.__data[0],l=t.__data[1],s=t.__data[2],d=t.__data[3];return new e(a*d+r*o+i*s-n*l,i*d+r*l+n*o-a*s,n*d+r*s+a*l-i*o,r*d-a*o-i*l-n*s)};e.prototype.multiplyInPlace=function(t){var e=this.__data[0],a=this.__data[1],i=this.__data[2],n=this.__data[3],r=t.__data[0],o=t.__data[1],l=t.__data[2],s=t.__data[3];this.set(e*s+n*r+a*l-i*o,a*s+n*o+i*r-e*l,i*s+n*l+e*o-a*r,n*s-e*r-a*o-i*l)};e.prototype.rotateVec3=function(t){var a=new e(t.x,t.y,t.z,0),i=this.multiply(a).multiply(this.conjugate());return new Dn(i.x,i.y,i.z)};e.prototype.rotateX=function(t){t*=.5;var e=this.x,a=this.y,i=this.z,n=this.w,r=Math.sin(t),o=Math.cos(t);this.x=e*o+n*r,this.y=a*o+i*r,this.z=i*o-a*r,this.w=n*o-e*r};e.prototype.rotateY=function(t){t*=.5;var e=this.x,a=this.y,i=this.z,n=this.w,r=Math.sin(t),o=Math.cos(t);this.x=e*o-i*r,this.y=a*o+n*r,this.z=i*o+e*r,this.w=n*o-a*r};e.prototype.rotateZ=function(t){t*=.5;var e=this.x,a=this.y,i=this.z,n=this.w,r=Math.sin(t),o=Math.cos(t);this.x=e*o+a*r,this.y=a*o-e*r,this.z=i*o+n*r,this.w=n*o-i*r};e.prototype.toMat3=function(){var t=this.x,e=this.y,a=this.z,i=this.w,n=t+t,r=e+e,o=a+a,l=t*n,s=e*n,d=e*r,c=a*n,u=a*r,h=a*o,m=i*n,p=i*r,f=i*o,b=new qn;return b.__data[0]=1-d-h,b.__data[3]=s-f,b.__data[6]=c+p,b.__data[1]=s+f,b.__data[4]=1-l-h,b.__data[7]=u-m,b.__data[2]=c-p,b.__data[5]=u+m,b.__data[8]=1-l-d,b};e.prototype.getXaxis=function(){var t=this.x*this.y,e=this.x*this.z,a=this.y*this.y,i=this.y*this.w,n=this.z*this.z,r=this.z*this.w;return new Dn(1-2*(n+a),2*(t+r),2*(e-i))};e.prototype.getYaxis=function(){var t=this.x*this.x,e=this.x*this.y,a=this.x*this.w,i=this.y*this.z,n=this.z*this.z,r=this.z*this.w;return new Dn(2*(e-r),1-2*(n+t),2*(i+a))};e.prototype.getZaxis=function(){var t=this.x*this.x,e=this.x*this.z,a=this.x*this.w,i=this.y*this.y,n=this.y*this.z,r=this.y*this.w;new Dn;return new Dn(2*(r+e),2*(n-a),1-2*(i+t))};e.prototype.mirror=function(t){switch(t){case 0:return new e(this.z,this.w,this.x,this.y);case 1:return new e(-this.w,this.z,this.y,-this.x);case 2:return new e(this.x,this.y,this.z,-this.w)}};e.prototype.toMat4=function(){var t=this.x,e=this.y,a=this.z,i=this.w,n=t+t,r=e+e,o=a+a,l=t*n,s=e*n,d=e*r,c=a*n,u=a*r,h=a*o,m=i*n,p=i*r,f=i*o,b=new $n;return b.__data[0]=1-d-h,b.__data[4]=s-f,b.__data[8]=c+p,b.__data[1]=s+f,b.__data[5]=1-l-h,b.__data[9]=u-m,b.__data[2]=c-p,b.__data[6]=u+m,b.__data[10]=1-l-d,b};e.prototype.lerp=function(t,a){var i=new e(this.x+a*(t.x-this.x),this.y+a*(t.y-this.y),this.z+a*(t.z-this.z),this.w+a*(t.w-this.w));return i.normalizeInPlace(),i};e.create=function(){var t=[];for(var a=0;a<arguments.length;a++){t[a]=arguments[a]}return new(e.bind.apply(e,__spreadArrays([void 0],t)))};e.createFromFloat32Buffer=function(t,a){if(a===void 0){a=0}return new e(t,4*a)};e.numElements=function(){return 4};e.prototype.clone=function(){return new e(this.__data[0],this.__data[1],this.__data[2],this.__data[3])};e.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}};e.prototype.fromJSON=function(t){this.__data[0]=t.x,this.__data[1]=t.y,this.__data[2]=t.z,this.__data[3]=t.w,this.normalizeInPlace()};return e}(Hn);kn.registerType("Quat",tr);var er=function(){function t(t,e){this.start=t instanceof Dn?t:new Dn,this.dir=e instanceof Dn?e:new Dn}t.prototype.closestPoint=function(t){var e=t.subtract(this.start).dot(this.dir);if(e<Number.EPSILON)return this.start;var a=e/this.dir.dot(this.dir);return this.start.add(this.dir.scale(a))};t.prototype.pointAtDist=function(t){return this.start.add(this.dir.scale(t))};t.prototype.intersectRayVector=function(t){var e=this.dir,a=t.dir,i=this.start.subtract(t.start),n=e.dot(e),r=e.dot(a),o=a.dot(a),l=e.dot(i),s=a.dot(i);if(0==n&&0==o)return this.start.distanceTo(t.start);if(0==n)return t.closestPoint(this.start);if(0==o)return this.closestPoint(t.start);var d=n*o-r*r;var c,u;return d<.001?(c=0,u=r>o?l/r:s/o):(c=(r*s-o*l)/d,u=(n*s-r*l)/d),[c,u]};t.prototype.intersectRayPlane=function(t){var e=this.start.subtract(t.start),a=t.dir.dot(this.dir),i=-t.dir.dot(e);if(Math.abs(a)<Number.PRECISION)return-1;var n=i/a;return n<-Number.PRECISION?-1:n};t.prototype.clone=function(){return new t(this.start.clone(),this.dir.clone())};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.prototype.toJSON=function(){return{start:this.start,dir:this.dir}};t.prototype.fromJSON=function(t){this.start.fromJSON(t.start),this.dir.fromJSON(t.dir)};t.prototype.toString=function(){return En(this.toJSON())};return t}();kn.registerType("Ray",er);new Dn(1,1,1);var ar=function(){function t(t,e,a){if(t instanceof Float32Array)this.setFromFloat32Array(t);else{if(t instanceof Dn)this.tr=t;else{if(t instanceof tr&&null==e&&null==a)return this.tr=new Dn,this.ori=t,void(this.sc=new Dn(1,1,1));this.tr=new Dn}this.ori=e instanceof tr?e:new tr,this.sc=a instanceof Dn?a:new Dn(1,1,1)}}t.prototype.set=function(t,e,a){this.tr=t,this.ori=e,a instanceof Dn&&(this.sc=a)};t.prototype.setFromOther=function(t){this.tr=t.tr,this.ori=t.ori,this.sc=t.sc};t.prototype.isIdentity=function(){return this.tr.isNull()&&this.ori.isIdentity()&&this.sc.is111()};t.prototype.setLookAt=function(t,e,a){var i=t.subtract(e);if(i.length()<Number.EPSILON)throw new Error("Invalid dir");this.ori.setFromDirectionAndUpvector(i,a),this.tr=t};t.prototype.multiply=function(e){var a=this.sc;return this.sc.x==this.sc.y&&this.sc.x==this.sc.z||(a=e.ori.rotateVec3(this.sc),Math.sign(a.x)!=Math.sign(this.sc.x)&&(a.x=-a.x),Math.sign(a.y)!=Math.sign(this.sc.y)&&(a.y=-a.y),Math.sign(a.z)!=Math.sign(this.sc.z)&&(a.z=-a.z)),new t(this.tr.add(this.ori.rotateVec3(a.multiply(e.tr))),this.ori.multiply(e.ori),a.multiply(e.sc))};t.prototype.inverse=function(){var e=new t;return e.ori=this.ori.inverse(),this.sc.x!=this.sc.y||this.sc.x!=this.sc.z?(e.sc=e.ori.rotateVec3(this.sc),Math.sign(e.sc.x)!=Math.sign(this.sc.x)&&(e.sc.x=-e.sc.x),Math.sign(e.sc.y)!=Math.sign(this.sc.y)&&(e.sc.y=-e.sc.y),Math.sign(e.sc.z)!=Math.sign(this.sc.z)&&(e.sc.z=-e.sc.z)):e.sc=this.sc.inverse(),e.tr=e.ori.rotateVec3(this.tr.negate().multiply(e.sc)),e};t.prototype.transformVec3=function(t){return this.tr.add(this.ori.rotateVec3(this.sc.multiply(t)))};t.prototype.toMat4=function(){var t=new $n(this.sc.x,0,0,0,0,this.sc.y,0,0,0,0,this.sc.z,0,0,0,0,1),e=this.ori.toMat4(),a=new $n;return a.translation=this.tr,a.multiply(e).multiply(t)};t.prototype.fromMat4=function(t){this.tr=t.translation,this.ori.setFromMat4(t)};t.prototype.setFromFloat32Array=function(t){if(7==t.length)return this.tr=new Dn(t.buffer,t.byteOffset),this.ori=new tr(t.buffer,t.byteOffset+12),void(this.sc=new Dn(1,1,1));if(8!=t.length)return 10==t.length?(this.tr=new Dn(t.buffer,t.byteOffset),this.ori=new tr(t.buffer,t.byteOffset+12),void(this.sc=new Dn(t.buffer,t.byteOffset+21))):void 0;{this.tr=new Dn(t.buffer,t.byteOffset),this.ori=new tr(t.buffer,t.byteOffset+12);var e=t[7];this.sc=new Dn(e,e,e)}};t.prototype.clone=function(){return new t(this.tr.clone(),this.ori.clone(),this.sc.clone())};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.prototype.toJSON=function(){var t={tr:this.tr.toJSON(),ori:this.ori.toJSON()};return this.sc.is111()||(t.sc=this.sc.toJSON()),t};t.prototype.fromJSON=function(t){this.tr.fromJSON(t.tr),this.ori.fromJSON(t.ori),t.sc&&this.sc.fromJSON(t.sc)};t.prototype.toString=function(){return En(this.toJSON())};return t}();kn.registerType("Xfo",ar);var ir=function(){function t(t,e){this.p0=t instanceof Bn?t:new Bn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.p1=e instanceof Bn?e:new Bn(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY)}t.prototype.set=function(t,e){this.p0=t,this.p1=e};t.prototype.reset=function(){this.p0.x=Number.POSITIVE_INFINITY,this.p1.x=Number.NEGATIVE_INFINITY,this.p0.y=Number.POSITIVE_INFINITY,this.p1.y=Number.NEGATIVE_INFINITY};t.prototype.isValid=function(){return this.p0.x!=Number.POSITIVE_INFINITY&&this.p1.x!=Number.NEGATIVE_INFINITY&&this.p0.y!=Number.POSITIVE_INFINITY&&this.p1.y!=Number.NEGATIVE_INFINITY};t.prototype.addPoint=function(t){(this.p0.x==Number.POSITIVE_INFINITY||t.x<this.p0.x)&&(this.p0.x=t.x),(this.p0.y==Number.POSITIVE_INFINITY||t.y<this.p0.y)&&(this.p0.y=t.y),(this.p1.y==Number.NEGATIVE_INFINITY||t.x>this.p1.x)&&(this.p1.x=t.x),(this.p1.y==Number.NEGATIVE_INFINITY||t.y>this.p1.y)&&(this.p1.y=t.y)};t.prototype.size=function(){return this.p1.subtract(this.p0)};t.prototype.diagonal=function(){return this.p1.subtract(this.p0)};t.prototype.center=function(){var t=this.p1.subtract(this.p0);return t.scaleInPlace(.5),t.addInPlace(this.p0),t};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.prototype.toJSON=function(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON()}};t.prototype.toString=function(){return En(this.toJSON())};return t}();kn.registerType("Box2",ir);var nr=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=0}var i=this;i=t.call(this)||this,i.pos=e instanceof Dn?e:new Dn,i.radius=a;return i}e.prototype.clone=function(){return new Sphere(this.pos.clone(),this.radius)};e.prototype.intersectsBox=function(t){return t.intersectsSphere(this)};e.create=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return new(Sphere.bind.apply(Sphere,__spreadArrays([void 0],t)))};e.prototype.toJSON=function(){return{pos:this.pos.toJSON(),radius:this.radius}};e.prototype.toString=function(){return En(this.toJSON())};return e}(Hn);kn.registerType("SphereType",nr);var rr=function(){function t(t,e){t instanceof Float32Array?this.setFromFloat32Array(t):(this.p0=t instanceof Dn?t:new Dn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.p1=e instanceof Dn?e:new Dn(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))}Object.defineProperty(t.prototype,"min",{get:function(){return this.p0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"max",{get:function(){return this.p1},enumerable:true,configurable:true});t.prototype.set=function(t,e){this.p0=t,this.p1=e};t.prototype.reset=function(){this.p0.x=Number.POSITIVE_INFINITY,this.p1.x=Number.NEGATIVE_INFINITY,this.p0.y=Number.POSITIVE_INFINITY,this.p1.y=Number.NEGATIVE_INFINITY,this.p0.z=Number.POSITIVE_INFINITY,this.p1.z=Number.NEGATIVE_INFINITY};t.prototype.isValid=function(){return this.p0.x!=Number.POSITIVE_INFINITY&&this.p1.x!=Number.NEGATIVE_INFINITY&&this.p0.y!=Number.POSITIVE_INFINITY&&this.p1.y!=Number.NEGATIVE_INFINITY&&this.p0.z!=Number.POSITIVE_INFINITY&&this.p1.z!=Number.NEGATIVE_INFINITY};t.prototype.addPoint=function(t){t.x!=Number.POSITIVE_INFINITY&&t.x!=Number.NEGATIVE_INFINITY&&(t.x<this.p0.x&&(this.p0.x=t.x),t.x>this.p1.x&&(this.p1.x=t.x)),t.y!=Number.POSITIVE_INFINITY&&t.y!=Number.NEGATIVE_INFINITY&&(t.y<this.p0.y&&(this.p0.y=t.y),t.y>this.p1.y&&(this.p1.y=t.y)),t.z!=Number.POSITIVE_INFINITY&&t.z!=Number.NEGATIVE_INFINITY&&(t.z<this.p0.z&&(this.p0.z=t.z),t.z>this.p1.z&&(this.p1.z=t.z))};t.prototype.addBox3=function(t,e){e?(this.addPoint(e.transformVec3(t.p0)),this.addPoint(e.transformVec3(new Dn(t.p0.x,t.p0.y,t.p1.z))),this.addPoint(e.transformVec3(new Dn(t.p0.x,t.p1.y,t.p0.z))),this.addPoint(e.transformVec3(new Dn(t.p1.x,t.p0.y,t.p0.z))),this.addPoint(e.transformVec3(new Dn(t.p0.x,t.p1.y,t.p1.z))),this.addPoint(e.transformVec3(new Dn(t.p1.x,t.p0.y,t.p1.z))),this.addPoint(e.transformVec3(new Dn(t.p1.x,t.p1.y,t.p0.z))),this.addPoint(e.transformVec3(t.p1))):(this.addPoint(t.p0),this.addPoint(t.p1))};t.prototype.size=function(){return this.p1.subtract(this.p0)};t.prototype.diagonal=function(){return this.p1.subtract(this.p0)};t.prototype.center=function(){var t=this.p1.subtract(this.p0);return t.scaleInPlace(.5),t.addInPlace(this.p0),t};t.prototype.toMat4=function(){var t=this.p1.x-this.p0.x,e=this.p1.y-this.p0.y,a=this.p1.z-this.p0.z;return new $n(t,0,0,0,0,e,0,0,0,0,a,0,this.p0.x,this.p0.y,this.p0.z,1)};t.prototype.getBoundingSphere=function(){return new nr(this.center(),.5*this.diagonal().length())};t.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)};t.prototype.intersectsSphere=function(t){return closestPoint.distanceToSquared(t.center)<=t.radius*t.radius};t.prototype.intersectsPlane=function(t){var e,a;return t.normal.x>0?(e=t.normal.x*this.min.x,a=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,a=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,a+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,a+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,a+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,a+=t.normal.z*this.min.z),e<=-t.constant&&a>=-t.constant};t.prototype.clone=function(){return new t(this.p0.clone(),this.p1.clone())};t.create=function(){var e=[];for(var a=0;a<arguments.length;a++){e[a]=arguments[a]}return new(t.bind.apply(t,__spreadArrays([void 0],e)))};t.sizeInBytes=function(){return 24};t.prototype.toJSON=function(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON()}};t.prototype.fromJSON=function(t){this.p0.fromJSON(t.p0),this.p1.fromJSON(t.p1)};t.prototype.loadBin=function(t,e){this.p0.loadBin(t,e),this.p0.loadBin(t,e+12)};t.prototype.setFromFloat32Array=function(t){this.p0=new Dn(t.buffer,t.byteOffset),this.p1=new Dn(t.buffer,t.byteOffset+12)};t.prototype.toString=function(){return En(this.toJSON())};return t}();kn.registerType("Box3",rr);var or=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=0}var i=this;i=t.call(this)||this,i.normal=e instanceof Dn?e:new Dn,i.w=a;return i}e.prototype.set=function(t,e,a,i){this.normal.set(t,e,a),this.w=i};e.prototype.divideScalar=function(t){this.normal.scaleInPlace(1/t),this.w/=t};e.prototype.distanceToPoint=function(t){return t.dot(this.normal)+this.w};e.prototype.normalizeInPlace=function(){var t=1/this.normal.length();this.normal.scaleInPlace(t),this.w*=t};e.prototype.clone=function(){return new Plane(this.normal.clone(),this.w)};e.create=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return new(Plane.bind.apply(Plane,__spreadArrays([void 0],t)))};e.prototype.toJSON=function(){return{normal:this.normal.toJSON(),w:this.w}};e.prototype.toString=function(){return En(this.toJSON())};return e}(Hn);kn.registerType("PlaneType",or);var lr=function(){function t(t,e,a,i,n,r){this.planes=[t||new or,e||new or,a||new or,i||new or,n||new or,r||new or]}t.prototype.setFromMatrix=function(t){var e=t,a=this.planes;a[0].set(e.m03-e.m00,e.m13-e.m10,e.m23-e.m20,e.m33-e.m30),a[1].set(e.m03+e.m00,e.m13+e.m10,e.m23+e.m20,e.m33+e.m30),a[2].set(e.m03+e.m01,e.m13+e.m11,e.m23+e.m21,e.m33+e.m31),a[3].set(e.m03-e.m01,e.m13-e.m11,e.m23-e.m21,e.m33-e.m31),a[4].set(e.m03-e.m02,e.m13-e.m12,e.m23-e.m22,e.m33-e.m32),a[5].set(e.m03+e.m02,e.m13+e.m12,e.m23+e.m22,e.m33+e.m32),a.forEach((function(t){return t.normalizeInPlace()}))};t.prototype.intersectsBox=function(t){var e=new Dn,a=this.planes,i=t.min,n=t.max;for(var r=0;r<6;r++){var o=a[r];if(e.x=o.normal.x>0?n.x:i.x,e.y=o.normal.y>0?n.y:i.y,e.z=o.normal.z>0?n.z:i.z,o.distanceToPoint(e)<0)return!1}return!0};t.prototype.toJSON=function(){return{p0:this.p0.toJSON(),p1:this.p1.toJSON(),p2:this.p2.toJSON(),p3:this.p3.toJSON(),p4:this.p4.toJSON(),p5:this.p5.toJSON()}};t.prototype.fromJSON=function(t){this.p0.fromJSON(t.p0),this.p1.fromJSON(t.p1),this.p2.fromJSON(t.p2),this.p3.fromJSON(t.p3),this.p4.fromJSON(t.p4),this.p5.fromJSON(t.p5)};t.prototype.toString=function(){return En(this.toJSON())};return t}();kn.registerType("Frustum",lr);var sr=Object.freeze({__proto__:null,UInt8:0,SInt8:1,SInt16:3,UInt16:2,SInt32:5,UInt32:4,Float32:6,hashStr:Pn,JSON_stringify_fixedPrecision:En,AttrValue:Hn,Vec2:Bn,Vec3:Dn,Vec4:On,RGBA:Qn,Color:An,EulerAngles:jn,Quat:tr,Ray:er,Mat3:qn,Mat4:$n,Xfo:ar,Box2:ir,Box3:rr,Frustum:lr,PlaneType:or,SphereType:nr,typeRegistry:kn});var dr=function(){function t(t){if(t===void 0){t=!1}this.__slots=[],this.__toggledSignal=t,this.__toggled=!1,this.__data=null,this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.emit=this.emit.bind(this)}t.prototype.connect=function(t){if(null==t)throw new Error("a function callback must be passed to Signal.connect");if(-1!=this.__slots.indexOf(t))return void console.warn("fn '"+t.name+"' already connected to Signal.");var e=this.__slots.length;return this.__slots[e]=t,this.__toggledSignal&&this.__toggled&&(this.__data?t.apply(void 0,this.__data):t()),e};t.prototype.disconnect=function(t){if(null==t)throw new Error("a function callback must be passed to Signal.disconnect");var e=[];if(this.__slots.forEach((function(a,i){a===t&&e.push(i)})),0!=e.length)for(var a=0,i=e;a<i.length;a++){var n=i[a];this.__slots[n]=void 0}else console.warn("callback :"+t.name+" was not connected to this signal:"+this.__name)};t.prototype.disconnectId=function(t){if(!this.__slots[t])throw new Error("Invalid ID");this.__slots[t]=void 0};t.prototype.emit=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}this.__toggledSignal&&(this.__toggled?console.warn("Toggled signals should only be fired once, or untoggled before re-firing.."):(this.__toggled=!0,this.__data=t));var a=this.__slots.length;for(var i=0;i<a;i++){var n=this.__slots[i];n&&n.apply(void 0,t)}};t.prototype.isToggled=function(){return this.__toggled};t.prototype.setToggled=function(t){this.__toggled=t,this.__data=void 0};t.prototype.getNumConnections=function(){return this.__slots.length};t.prototype.untoggle=function(){this.__toggled=!1,this.__data=void 0};return t}();var cr=function(){function t(t,e){if(t===void 0){t=0}if(e===void 0){e=0}this.root={x:0,y:0,w:t,h:e},this.resized=new dr}t.prototype.fit=function(t){var e=this;if(0==t.length)return;var a=!1;this.root.w<t[0].w&&(this.root.w=t[0].w,a=!0),this.root.h<t[0].h&&(this.root.h=t[0].h,a=!0),a&&this.resized.emit(this.root.w,this.root.h);t.forEach((function(t){t.fit=e.__addBlock(t)}))};t.prototype.__addBlock=function(t){var e=this.findNode(this.root,t.w,t.h);return e?this.splitNode(e,t.w,t.h):this.growNode(t.w,t.h)};t.prototype.addBlock=function(t){var e=!1;this.root.w<t.w&&(this.root.w=t.w,e=!0),this.root.h<t.h&&(this.root.h=t.h,e=!0),e&&this.resized.emit(this.root.w,this.root.h);var a=this.findNode(this.root,t.w,t.h);return a?this.splitNode(a,t.w,t.h):this.growNode(t.w,t.h)};t.prototype.findNode=function(t,e,a){return t.used?this.findNode(t.right,e,a)||this.findNode(t.down,e,a):e<=t.w&&a<=t.h?t:null};t.prototype.splitNode=function(t,e,a){return t.used=!0,t.down={x:t.x,y:t.y+a,w:t.w,h:t.h-a},t.right={x:t.x+e,y:t.y,w:t.w-e,h:a},t};t.prototype.growNode=function(t,e){var a=t<=this.root.w,i=e<=this.root.h,n=i&&this.root.h>=this.root.w+t,r=a&&this.root.w>=this.root.h+e;return n?this.growRight(t,e):r?this.growDown(t,e):i?this.growRight(t,e):a?this.growDown(t,e):null};t.prototype.growRight=function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w+t,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:t,h:this.root.h}};var a=this.findNode(this.root,t,e);var i;return a&&(i=this.splitNode(a,t,e)),this.resized.emit(this.root.w,this.root.h),i};t.prototype.growDown=function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+e,down:{x:0,y:this.root.h,w:this.root.w,h:e},right:this.root};var a=this.findNode(this.root,t,e);var i;return a&&(i=this.splitNode(a,t,e)),this.resized.emit(this.root.w,this.root.h),i};return t}();var ur=function(){function t(t){if(t===void 0){t=0}this.__asyncCount=t,this.ready=new dr(!0),this.incAsyncCount=function(t){if(t===void 0){t=1}this.__asyncCount+=t,this.ready.setToggled(!1)}.bind(this),this.decAsyncCount=function(){this.__asyncCount>0&&(this.__asyncCount--,0==this.__asyncCount&&this.__asyncsCompleted())}.bind(this),this.__asyncsCompleted=function(){this.ready.emit()}.bind(this)}Object.defineProperty(t.prototype,"count",{get:function(){return this.__asyncCount},enumerable:true,configurable:true});return t}();var hr=function(t){if(window.TextDecoder)return new TextDecoder("utf-8").decode(t);{var e="";for(var a=0;a<t.length;a++)e+=String.fromCharCode(t[a]);return e}};var mr=Object.freeze({__proto__:null,GrowingPacker:cr,Async:ur,Signal:dr,decodeText:hr});var pr=0;var fr=function(){function t(){if("RefCounted"==this.constructor.name)throw new Error("RefCounted should not be instantiated directly.");this.__id=++pr,this.__refs=[],this.destructing=new dr,this.__destroyed=!1}t.prototype.getId=function(){return this.__id};t.prototype.numRefs=function(){return this.__refs.length};t.prototype.addRef=function(t){if(!t)throw new Error("Error in RefCounted.addRef: Must provide a referer");return this.__refs.push(t),!0};t.prototype.removeRef=function(t){if(!t)throw new Error("Error in RefCounted.removeRef: Must provide a referer");var e=this.__refs.indexOf(t);if(-1==e)throw new Error("Error in RefCounted.removeRef: referer not found in refs list.");this.__refs.splice(e,1),0==this.__refs.length&&this.destroy()};t.prototype.getRefer=function(t){return this.__refs[t]};t.prototype.getRefIndex=function(t){return this.__refs.indexOf(t)};t.prototype.isDestroyed=function(){return this.__destroyed};t.prototype.destroy=function(){this.__destroyed=!0,this.destructing.emit(this)};return t}();var br=new(function(){function t(){this.__registeredClasses={},this.__classNames={},this.__classList=[]}t.prototype.registerClass=function(t,e){this.__registeredClasses[t]={cls:e,callbacks:[]};var a=this.__classList.length;this.__classList.push(e),this.__classNames[a]=t};t.prototype.getClass=function(t){if(this.__registeredClasses[t])return this.__registeredClasses[t].cls};t.prototype.getClassName=function(t){var e=this.__classList.indexOf(t.constructor);return this.__classNames[e]?this.__classNames[e]:(console.warn("Class not registered:",t.constructor.name),t.constructor.name)};t.prototype.constructClass=function(t){var e;var a=this.__registeredClasses[t];if(!a)return console.warn("Factory not registered:"+t),null;this.__constructing=!0;var i=Array.prototype.slice.call(arguments,1),n=new((e=a.cls).bind.apply(e,__spreadArrays([void 0],i)));return this.__constructing=!1,n};return t}()),yr={NORMAL:0,OPERATOR_GETVALUE:1},gr={USER_SETVALUE:0,REMOTEUSER_SETVALUE:1,USER_SETVALUE_DONE:2,OPERATOR_SETVALUE:3,OPERATOR_DIRTIED:4,COMPUTED_VALUE:4,GENERATED_VALUE:4,DATA_LOAD:4},_r={USER_EDITED:2,DISABLED:4},Zr=0,Gr=1,Xr=2;var vr=function(){function t(t){this.__name=t,this.__cleanerFns=[],this.__boundOps=[],this.__state=Zr,this.__flags=0,this.valueChanged=new dr,this.nameChanged=new dr,this.getName=this.getName.bind(this),this.setName=this.setName.bind(this),this.getValue=this.getValue.bind(this),this.setValue=this.setValue.bind(this)}t.prototype.getName=function(){return this.__name};t.prototype.setName=function(t){if(t!=this.__name){var e=this.__name;this.__name=t,this.nameChanged.emit(this.__name,e)}};t.prototype.getOwner=function(){return this.ownerItem};t.prototype.addOwner=function(t){this.ownerItem=t};t.prototype.getPath=function(){var t=this.getOwner();if(t&&t.getName){if(t.getPath){var e=t.getPath().slice();return e.push(this.__name),e}return[t.getName(),this.__name]}return[this.__name]};t.prototype.setFlag=function(t){this.__flags|=t};t.prototype.clearFlag=function(t){this.__flags&=~t};t.prototype.testFlag=function(t){return 0!=(this.__flags&t)};t.prototype.getValue=function(){};t.prototype.setValue=function(t){};t.prototype.setEnabled=function(t){console.warn("Deprecated Method: This method will be removed soon."),t?this.setFlag(_r.DISABLED):this.clearFlag(_r.DISABLED)};t.prototype.isEnabled=function(){console.warn("Deprecated Method: This method will be removed soon."),this.testFlag(_r.DISABLED)};t.prototype.bindOperator=function(t){this.__boundOps.push(t),this.__state=Gr,this.valueChanged.emit(gr.OPERATOR_DIRTIED)};t.prototype.unbindOperator=function(t){var e=this.__boundOps.indexOf(t);if(-1==e)return!1;this.__boundOps.splice(e,1),this.__state=Gr,this.valueChanged.emit(gr.OPERATOR_DIRTIED)};t.prototype.setDirty=function(t){return-1==this.__cleanerFns.indexOf(t)&&(this.__cleanerFns.push(t),this.__state=Gr,this.valueChanged.emit(gr.OPERATOR_DIRTIED),!0)};t.prototype.setDirtyFromOp=function(){return this.__state==Zr&&(this.__state=Gr,this.valueChanged.emit(gr.OPERATOR_DIRTIED)),!0};t.prototype.isDirty=function(){return this.__state==Gr};t.prototype._clean=function(){this.__state=Xr;var t=this.__cleanerFns;this.__cleanerFns=[];for(var e=0,a=t;e<a.length;e++){var i=a[e];var n=i(this.__value);null!=n&&(this.__value=n)}for(var r=0,o=this.__boundOps;r<o.length;r++){var l=o[r];l.evaluate()}this.__state=Zr};t.prototype.removeCleanerFn=function(t){var e=this.__cleanerFns.indexOf(t);if(-1==e)return 0;this.__cleanerFns.splice(e,1)};t.prototype.clone=function(t){console.error("TOOD: implment me")};t.prototype.destroy=function(){};return t}();var Vr=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e)||this,n.__value=a,n.__dataType=i||a.constructor.name;return n}e.prototype.getDataType=function(){return this.__dataType};e.prototype.getValue=function(t){if(t===void 0){t=yr.NORMAL}return this.__state==Gr&&this._clean(),this.__value};e.prototype.setClean=function(t){this.__value=t};e.prototype.setValue=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}if(this.__cleanerFns.length>0&&(this.__cleanerFns=[]),null==t)throw"undefined was passed into the setvalue for param:"+this.getName();(t.fromJSON||this.__value!=t)&&(this.__value=t,e!=gr.USER_SETVALUE&&e!=gr.REMOTEUSER_SETVALUE||this.setFlag(_r.USER_EDITED),e!=gr.OPERATOR_SETVALUE&&this.valueChanged.emit(e))};e.prototype.setValueDone=function(){this.valueChanged.emit(gr.USER_SETVALUE_DONE)};e.prototype.toJSON=function(t,e){return this.__value.toJSON?{value:this.__value.toJSON(t,e)}:{value:this.__value}};e.prototype.fromJSON=function(t,e,a){null!=t.value?(this.setFlag(_r.USER_EDITED),t.value.type&&null==this.__value&&(this.__value=br.constructClass(t.value.type)),null!=this.__value&&this.__value.fromJSON?(this.__value.fromJSON(t.value,e),this.valueChanged.emit(gr.DATA_LOAD)):this.setValue(t.value,gr.DATA_LOAD)):console.warn("Invalid Parameter JSON")};e.prototype.readBinary=function(t,e){console.error("TODO")};e.prototype.clone=function(t){var a=this.__value;return a.clone&&(a=a.clone()),new e(this.__name,a,this.__dataType)};return e}(vr);var Ir=0;var Rr=function(){function t(){this.__id=++Ir,this.__params=[],this.__paramMapping={},this.__paramSignalIds={},this.parameterAdded=new dr,this.parameterRemoved=new dr,this.parameterValueChanged=new dr}t.prototype.getId=function(){return this.__id};t.prototype.numParameters=function(){return this.__params.length};t.prototype.getParameters=function(){return this.__params};t.prototype.getParameterIndex=function(t){return this.__paramMapping[t]};t.prototype.getParameterByIndex=function(t){return this.__params[t]};t.prototype.hasParameter=function(t){return t in this.__paramMapping};t.prototype.getParameter=function(t){var e=this.__paramMapping[t];return-1==e?null:this.__params[e]};t.prototype.__parameterValueChanged=function(t,e){this.parameterValueChanged.emit(t,e)};t.prototype.addParameter=function(t){var e=this;var a=t.getName();return null!=this.__paramMapping[a]&&(console.warn("Replacing Parameter:"+a),this.removeParameter(a)),this.__paramSignalIds[a]=t.valueChanged.connect((function(a){return e.__parameterValueChanged(t,a)})),this.__params.push(t),this.__paramMapping[a]=this.__params.length-1,this.parameterAdded.emit(a),t};t.prototype.insertParameter=function(t,e){var a=this;var i=t.getName();null!=this.__paramMapping[i]&&(console.warn("Replacing Parameter:"+i),this.removeParameter(i)),this.__paramSignalIds[i]=t.valueChanged.connect((function(e){return a.__parameterValueChanged(t,e)})),this.__params.splice(e,0,t);var n={};for(var r=0;r<this.__params.length;r++)n[this.__params[r].getName()]=r;return this.__paramMapping=n,this.parameterAdded.emit(i),t};t.prototype.removeParameter=function(t){null==this.__paramMapping[t]&&console.throw("Unable to Remove Parameter:"+t);var e=this.__paramMapping[t];this.__params[this.__paramMapping[t]].valueChanged.disconnectId(this.__paramSignalIds[t]),this.__params.splice(e,1);var a={};for(var i=0;i<this.__params.length;i++)a[this.__params[i].getName()]=i;this.__paramMapping=a,this.parameterRemoved.emit(t)};t.prototype.replaceParameter=function(t){var e=this;var a=t.getName(),i=this.__paramMapping[a];return this.__params[this.__paramMapping[a]].valueChanged.disconnectId(this.__paramSignalIds[a]),this.__paramSignalIds[a]=t.valueChanged.connect((function(a){return e.__parameterValueChanged(t,a)})),this.__params[i]=t,t};t.prototype.toJSON=function(t,e){var a={};var i=0;for(var n=0,r=this.__params;n<r.length;n++){var o=r[n];if(o.testFlag(_r.USER_EDITED))if(o.numRefs()>1&&0!=o.getRefIndex(this))a[o.getName()]={paramPath:t.makeRelative(o.getPath())},i++;else{var l=o.toJSON(t,e);l&&(a[o.getName()]=l,i++)}}if(i>0)return{params:a}};t.prototype.fromJSON=function(t,e,a){var i=this;if(t.params){var n=function(a){var n=t.params[a],o=r.getParameter(a);o?n.paramPath?e.resolvePath(n.paramPath,(function(t){i.replaceParameter(t)}),(function(t){console.warn("Unable to resolve shared parameter:"+n.paramPath)})):o.fromJSON(n,e):console.warn("Param not found:"+a)};var r=this;for(var o in t.params){n(o)}}};t.prototype.readBinary=function(t,e){if(e.versions["zea-engine"].greaterOrEqualThan([0,0,3])){var a=t.loadUInt32();for(var i=0;i<a;i++){var n=t.loadStr(),r=t.loadStr();var o=this.getParameter(r);if(!o){if(o=br.constructClass(n,r),!o){console.error("Unable to construct prop:"+r+" of type:"+n);continue}this.addParameter(o)}o.readBinary(t,e)}}};t.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};t.prototype.copyFrom=function(t,e){var a=t.numParameters();for(;a--;){var i=t.getParameterByIndex(a),n=this.getParameter(i.getName());n?n.setValue(i.getValue(),gr.OPERATOR_SETVALUE):this.addParameter(i.clone())}};t.prototype.destroy=function(){for(var t=0,e=this.__params;t<e.length;t++){var a=e[t];a.destroy()}_super.prototype.destroy.call(this)};return t}();var xr={USER_EDITED:2,IGNORE_BBOX:4,BIN_NODE:8,INVISIBLE:16};var Sr=0;var Wr=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__name=e||"",a.__path=[a.__name],a.__ownerItem=void 0,a.__flags=0,a.__selectable=!0,a.__selected=!1,a.selectedChanged=new dr,a.__metaData={},a.nameChanged=new dr,Sr++;return a}e.getNumBaseItems=function(){return Sr};e.prototype.__parameterValueChanged=function(e,a){t.prototype.__parameterValueChanged.call(this,e,a),a!=gr.USER_SETVALUE&&a!=gr.REMOTEUSER_SETVALUE||this.setFlag(xr.USER_EDITED)};e.prototype.getName=function(){return this.__name};e.prototype.setName=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}if(this.__name!=t){var a=this.__name;this.__name=t,this.__updatePath(),this.nameChanged.emit(t,a,e)}};e.prototype.__updatePath=function(){null==this.__ownerItem?this.__path=[this.__name]:(this.__path=this.__ownerItem.getPath().slice(),this.__path.push(this.__name))};e.prototype.getPath=function(){return this.__path};e.prototype.setFlag=function(t){this.__flags|=t};e.prototype.clearFlag=function(t){this.__flags&=~t};e.prototype.testFlag=function(t){return 0!=(this.__flags&t)};e.prototype.resolvePath=function(t,e){if(e==t.length)return this;if(">"==t[e]&&e==t.length-1)return this.getParameter(t[e+1]);var a=this.getParameter(t[e]);if(a)return a;throw new Error("Invalid path:"+t+" member not found")};e.prototype.getOwner=function(){return this.__ownerItem};e.prototype.setOwner=function(t){this.__ownerItem!==t&&(this.__ownerItem=t,this.__updatePath())};e.prototype.getSelectable=function(){return this.__selectable};e.prototype.setSelectable=function(t){return this.__selectable!=t&&(this.__selectable=t,!0)};e.prototype.isSelected=function(){return this.__selected};e.prototype.getSelected=function(){return this.__selected};e.prototype.setSelected=function(t){this.__selected=t,this.selectedChanged.emit(this.__selected)};e.prototype.getMetadata=function(t){return this.__metaData[t]};e.prototype.hasMetadata=function(t){return t in this.__metaData};e.prototype.setMetadata=function(t,e){this.__metaData[t]=e};e.prototype.deleteMetadata=function(t){delete this.__metaData[t]};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return!i&&this.testFlag(xr.USER_EDITED)&&(i={}),i&&(i.name=this.__name,this.testFlag(xr.BIN_NODE)||(i.type=br.getClassName(this))),i};e.prototype.fromJSON=function(e,a,i){e.name&&(this.__name=e.name),t.prototype.fromJSON.call(this,e,a,i),this.__flags|=xr.USER_EDITED};e.prototype.readBinary=function(e,a){e.loadStr();this.setName(e.loadStr()),t.prototype.readBinary.call(this,e,a)};e.prototype.clone=function(t){throw new Error(this.constructor.name+" does not implment its clone method")};e.prototype.copyFrom=function(e,a){t.prototype.copyFrom.call(this,e,a),this.setName(e.getName())};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(Rr);var Lr=function(t){return t.substring(0,t.lastIndexOf("/"))+"/"},Tr=function(t,e,a,i,n){var r=new XMLHttpRequest;r.responseType=e;try{r.addEventListener("timeout",(function(e){throw new Error("The request for "+t+" timed out.")})),r.addEventListener("error",(function(e){throw new Error("The request for "+t+": xhr.readyState:"+r.readyState)})),r.addEventListener("abort",(function(e){throw new Error("The request for "+t+": xhr.readyState:"+r.readyState)})),r.addEventListener("loadend",(function(t){200==r.status?a(r):i(r.statusText)})),r.open("GET",t,!0),r.send()}catch(t){i(t)}},Mr=function(t,e,a,i){Tr(t,"text",(function(t){e(t.responseText)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},Fr=function(t,e,a,i){Tr(t,"json",(function(t){e(t.response,t)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},Cr=function(t,e,a,i){Tr(t,"document",(function(t){e(t.responseXML)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},Nr=function(t,e,a,i){Tr(t,"arraybuffer",(function(t){e(t.response)}),(function(e){if(null==a)throw new Error("Unable to XHR File:"+t);a(e)}))},Yr="[object process]"===Object.prototype.toString.call("undefined"!=typeof e?e:0),Kr=Yr&&"function"==typeof module.require?module.require:null;function wr(t,e,i){if(e===void 0){e=null}if(i===void 0){i=!1}var n=Yr?function(t,e){return a.from(t,"base64").toString(e?"utf16":"utf8")}(t,i):function(t,e){var a=atob(t);if(e){var i=new Uint8Array(a.length);return Array.prototype.forEach.call(i,(function(t,e,i){i[e]=a.charCodeAt(e)})),String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return a}(t,i),r=n.indexOf("\n",10)+1,o=n.substring(r)+(e?"//# sourceMappingURL="+e:"");if(Kr){var l=Kr("worker_threads").Worker;return function(t){return new l(o,Object.assign({},t,{eval:!0}))}}var s=new Blob([o],{type:"application/javascript"}),d=URL.createObjectURL(s);return function(t){return new Worker(d,t)}}var zr=wr("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwpNb2R1bGU9e0VOVklST05NRU5UOiJXT1JLRVIifTtjb25zdCBlPXt9O3ZhciB0Oyh0PWUpLnVucGFja0JyaWRnZT1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHQ9e307ZnVuY3Rpb24gcihuKXtpZih0W25dKXJldHVybiB0W25dLmV4cG9ydHM7dmFyIG89dFtuXT17aTpuLGw6ITEsZXhwb3J0czp7fX07cmV0dXJuIGVbbl0uY2FsbChvLmV4cG9ydHMsbyxvLmV4cG9ydHMsciksby5sPSEwLG8uZXhwb3J0c31yZXR1cm4gci5tPWUsci5jPXQsci5kPWZ1bmN0aW9uKGUsdCxuKXtyLm8oZSx0KXx8T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7ZW51bWVyYWJsZTohMCxnZXQ6bn0pfSxyLnI9ZnVuY3Rpb24oZSl7InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJlN5bWJvbC50b1N0cmluZ1RhZyYmT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsU3ltYm9sLnRvU3RyaW5nVGFnLHt2YWx1ZToiTW9kdWxlIn0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0sci50PWZ1bmN0aW9uKGUsdCl7aWYoMSZ0JiYoZT1yKGUpKSw4JnQpcmV0dXJuIGU7aWYoNCZ0JiYib2JqZWN0Ij09dHlwZW9mIGUmJmUmJmUuX19lc01vZHVsZSlyZXR1cm4gZTt2YXIgbj1PYmplY3QuY3JlYXRlKG51bGwpO2lmKHIucihuKSxPYmplY3QuZGVmaW5lUHJvcGVydHkobiwiZGVmYXVsdCIse2VudW1lcmFibGU6ITAsdmFsdWU6ZX0pLDImdCYmInN0cmluZyIhPXR5cGVvZiBlKWZvcih2YXIgbyBpbiBlKXIuZChuLG8sZnVuY3Rpb24odCl7cmV0dXJuIGVbdF19LmJpbmQobnVsbCxvKSk7cmV0dXJuIG59LHIubj1mdW5jdGlvbihlKXt2YXIgdD1lJiZlLl9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gZS5kZWZhdWx0fTpmdW5jdGlvbigpe3JldHVybiBlfTtyZXR1cm4gci5kKHQsImEiLHQpLHR9LHIubz1mdW5jdGlvbihlLHQpe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KX0sci5wPSIiLHIoci5zPTIpfShbZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTtjb25zdCBvPXIoMSksaT17MDoiRVJBUl9TVUNDRVNTIiwxMDoiRVJBUl9FTkRfQVJDSElWRSIsMTE6IkVSQVJfTk9fTUVNT1JZIiwxMjoiRVJBUl9CQURfREFUQSIsMTM6IkVSQVJfQkFEX0FSQ0hJVkUiLDE0OiJFUkFSX1VOS05PV05fRk9STUFUIiwxNToiRVJBUl9FT1BFTiIsMTY6IkVSQVJfRUNSRUFURSIsMTc6IkVSQVJfRUNMT1NFIiwxODoiRVJBUl9FUkVBRCIsMTk6IkVSQVJfRVdSSVRFIiwyMDoiRVJBUl9TTUFMTF9CVUYiLDIxOiJFUkFSX1VOS05PV04iLDIyOiJFUkFSX01JU1NJTkdfUEFTU1dPUkQiLDIzOiJFUkFSX0VSRUZFUkVOQ0UiLDI0OiJFUkFSX0JBRF9QQVNTV09SRCJ9LGE9ezA6IlN1Y2Nlc3MiLDExOiJOb3QgZW5vdWdoIG1lbW9yeSIsMTI6IkFyY2hpdmUgaGVhZGVyIG9yIGRhdGEgYXJlIGRhbWFnZWQiLDEzOiJGaWxlIGlzIG5vdCBSQVIgYXJjaGl2ZSIsMTQ6IlVua25vd24gYXJjaGl2ZSBmb3JtYXQiLDE1OiJGaWxlIG9wZW4gZXJyb3IiLDE2OiJGaWxlIGNyZWF0ZSBlcnJvciIsMTc6IkZpbGUgY2xvc2UgZXJyb3IiLDE4OiJGaWxlIHJlYWQgZXJyb3IiLDE5OiJGaWxlIHdyaXRlIGVycm9yIiwyMDoiQnVmZmVyIGZvciBhcmNoaXZlIGNvbW1lbnQgaXMgdG9vIHNtYWxsLCBjb21tZW50IHRydW5jYXRlZCIsMjE6IlVua25vd24gZXJyb3IiLDIyOiJQYXNzd29yZCBmb3IgZW5jcnlwdGVkIGZpbGUgb3IgaGVhZGVyIGlzIG5vdCBzcGVjaWZpZWQiLDIzOiJDYW5ub3Qgb3BlbiBmaWxlIHNvdXJjZSBmb3IgcmVmZXJlbmNlIHJlY29yZCIsMjQ6Ildyb25nIHBhc3N3b3JkIGlzIHNwZWNpZmllZCJ9O2NsYXNzIHN7Y29uc3RydWN0b3IoZT0iIil7dGhpcy5fcGFzc3dvcmQ9ZSx0aGlzLl9hcmNoaXZlPW51bGx9Z2V0RmlsZUxpc3QoKXtsZXQgZSxbdCxyXT10aGlzLm9wZW5BcmMoITApO2lmKCJTVUNDRVNTIiE9PXQuc3RhdGUpZT1bdCxudWxsXTtlbHNle2xldCB0LG4sbz1bXTtmb3IoO1t0LG5dPXRoaXMucHJvY2Vzc05leHRGaWxlKCgpPT4hMCksIlNVQ0NFU1MiPT09dC5zdGF0ZTspby5wdXNoKG4uZmlsZUhlYWRlcik7ZT0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpyLGZpbGVIZWFkZXJzOm99XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLGV9ZXh0cmFjdEFsbCgpe2xldCBlLFt0LHJdPXRoaXMub3BlbkFyYyghMSk7aWYoIlNVQ0NFU1MiIT09dC5zdGF0ZSllPVt0LG51bGxdO2Vsc2V7bGV0IHQsbixvPVtdO2Zvcig7W3Qsbl09dGhpcy5wcm9jZXNzTmV4dEZpbGUoKCk9PiExKSwiU1VDQ0VTUyI9PT10LnN0YXRlOylvLnB1c2gobik7ZT0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpyLGZpbGVzOm99XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLGV9ZXh0cmFjdEZpbGVzKGUsdCl7bGV0IHIsW24sb109dGhpcy5vcGVuQXJjKCExLHQpLGk9e307Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDsrK3QpaVtlW3RdXT10O2lmKCJTVUNDRVNTIiE9PW4uc3RhdGUpcj1bbixudWxsXTtlbHNle2xldCB0LG4sYT1BcnJheShlLmxlbmd0aCkuZmlsbChudWxsKSxzPTA7Zm9yKDs7KXtsZXQgcj0hMSxvPW51bGw7aWYoW3Qsbl09dGhpcy5wcm9jZXNzTmV4dEZpbGUoZT0+ZSBpbiBpPyhvPWlbZV0sITEpOihyPSEwLCEwKSksIlNVQ0NFU1MiIT09dC5zdGF0ZSlicmVhaztpZighciYmKGFbb109biwrK3M9PT1lLmxlbmd0aCkpe3QucmVhc29uPSJFUkFSX0VORF9BUkNISVZFIjticmVha319cj0iRVJBUl9FTkRfQVJDSElWRSIhPT10LnJlYXNvbj9bdCxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2FyY0hlYWRlcjpvLGZpbGVzOmF9XX1yZXR1cm4gdGhpcy5jbG9zZUFyYygpLHJ9ZmlsZUNyZWF0ZWQoZSl7fWNsb3NlKGUpe3RoaXMuX2xhc3RGaWxlQ29udGVudD10aGlzLmNsb3NlRmlsZShlKX1vcGVuQXJjKGUsdCl7by5FeHQuY3VycmVudD10aGlzLHRoaXMuX2FyY2hpdmU9bmV3IG4uUmFyQXJjaGl2ZTtsZXQgcixpPXRoaXMuX2FyY2hpdmUub3Blbih0aGlzLl9maWxlUGF0aCx0fHx0aGlzLl9wYXNzd29yZCxlKTtyZXR1cm4gcj0wIT09aS5zdGF0ZS5lcnJDb2RlP1t0aGlzLmdldEZhaWxJbmZvKGkuc3RhdGUuZXJyQ29kZSxpLnN0YXRlLmVyclR5cGUpLG51bGxdOlt7c3RhdGU6IlNVQ0NFU1MifSx7Y29tbWVudDppLmNvbW1lbnQsZmxhZ3M6e3ZvbHVtZTowIT0oMSZpLmZsYWdzKSxsb2NrOjAhPSg0JmkuZmxhZ3MpLHNvbGlkOjAhPSg4JmkuZmxhZ3MpLGF1dGhJbmZvOjAhPSgzMiZpLmZsYWdzKSxyZWNvdmVyeVJlY29yZDowIT0oNjQmaS5mbGFncyksaGVhZGVyRW5jcnlwdGVkOjAhPSgxMjgmaS5mbGFncyl9fV0sby5FeHQuY3VycmVudD1udWxsLHJ9cHJvY2Vzc05leHRGaWxlKGUpe2xldCB0O28uRXh0LmN1cnJlbnQ9dGhpcztsZXQgcj10aGlzLl9hcmNoaXZlLmdldEZpbGVIZWFkZXIoKSxuPVt7c3RhdGU6IlNVQ0NFU1MifSxudWxsXTtpZigwPT09ci5zdGF0ZS5lcnJDb2RlKXtsZXQgdD1lKHIubmFtZSk7dGhpcy5fbGFzdEZpbGVDb250ZW50PW51bGw7bGV0IG89dGhpcy5fYXJjaGl2ZS5yZWFkRmlsZSh0KTswPT09by5lcnJDb2RlfHx0fHwoblswXT10aGlzLmdldEZhaWxJbmZvKG8uZXJyQ29kZSxvLmVyclR5cGUpLDIyPT09by5lcnJDb2RlP289dGhpcy5fYXJjaGl2ZS5yZWFkRmlsZSghMCk6by5lcnJDb2RlPTApLDA9PT1vLmVyckNvZGU/blsxXT10aGlzLl9sYXN0RmlsZUNvbnRlbnQ6KHIuc3RhdGUuZXJyQ29kZT1vLmVyckNvZGUsci5zdGF0ZS5lcnJUeXBlPW8uZXJyVHlwZSksdGhpcy5fbGFzdEZpbGVDb250ZW50PW51bGx9cmV0dXJuIHQ9MCE9PXIuc3RhdGUuZXJyQ29kZT9bdGhpcy5nZXRGYWlsSW5mbyhyLnN0YXRlLmVyckNvZGUsci5zdGF0ZS5lcnJUeXBlKSxudWxsXTpbe3N0YXRlOiJTVUNDRVNTIn0se2ZpbGVIZWFkZXI6e25hbWU6ci5uYW1lLGZsYWdzOntlbmNyeXB0ZWQ6MCE9KDQmci5mbGFncyksc29saWQ6MCE9KDE2JnIuZmxhZ3MpLGRpcmVjdG9yeTowIT0oMzImci5mbGFncyl9LHBhY2tTaXplOnIucGFja1NpemUsdW5wU2l6ZTpyLnVucFNpemUsY3JjOnIuY3JjLHRpbWU6ZnVuY3Rpb24oZSl7Y29uc3QgdD1bNSw2LDUsNSw0LDddO2xldCByPVtdO2ZvcihsZXQgbiBvZiB0KXIucHVzaChlJigxPDxuKS0xKSxlPj49bjtsZXQgbj1lPT5lPDEwPyIwIitlOiIiK2U7cmV0dXJuYCR7MTk4MCsocj1yLnJldmVyc2UoKSlbMF19LSR7bihyWzFdKX0tJHtuKHJbMl0pfVQke24oclszXSl9OiR7bihyWzRdKX06JHtuKDIqcls1XSl9LjAwMGB9KHIudGltZSksdW5wVmVyOmAke01hdGguZmxvb3Ioci51bnBWZXIvMTApfS4ke3IudW5wVmVyJTEwfWAsbWV0aG9kOmZ1bmN0aW9uKGUpe3JldHVybns0ODoiU3RvcmluZyIsNDk6IkZhc3Rlc3QiLDUwOiJGYXN0Iiw1MToiTm9ybWFsIiw1MjoiR29vZCIsNTM6IkJlc3QifVtlXXx8IlVua25vd24ifShyLm1ldGhvZCl9LGV4dHJhY3Q6bn1dLG8uRXh0LmN1cnJlbnQ9bnVsbCx0fWNsb3NlQXJjKCl7by5FeHQuY3VycmVudD10aGlzLHRoaXMuX2FyY2hpdmUuZGVsZXRlKCksby5FeHQuY3VycmVudD1udWxsLHRoaXMuX2FyY2hpdmU9bnVsbH1nZXRGYWlsSW5mbyhlLHQpe3JldHVybntzdGF0ZToiRkFJTCIscmVhc29uOmlbZV0sbXNnOmFbZV19fX1zLl9jdXJyZW50PW51bGwsdC5FeHRyYWN0b3I9c30sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSx0LkV4dD17Y3VycmVudDpudWxsfX0sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxmdW5jdGlvbihlKXtmb3IodmFyIHIgaW4gZSl0Lmhhc093blByb3BlcnR5KHIpfHwodFtyXT1lW3JdKX0ocigzKSk7dmFyIG49cigxKTt0LkV4dD1uLkV4dH0sZnVuY3Rpb24oZSx0LHIpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTtjb25zdCBuPXIoNCksbz1yKDYpO3QuY3JlYXRlRXh0cmFjdG9yRnJvbURhdGE9ZnVuY3Rpb24oZSx0PSIiKXtyZXR1cm4gbmV3IG4uRGF0YUV4dHJhY3RvcihlLHQpfSx0LmNyZWF0ZUV4dHJhY3RvckZyb21GaWxlPWZ1bmN0aW9uKGUsdD0iIixyPSIiKXtyZXR1cm4gbmV3IG8uRmlsZUV4dHJhY3RvcihlLHQscil9fSxmdW5jdGlvbihlLHQscil7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO2NvbnN0IG89cig1KSxpPXIoMCk7dC5EYXRhRXh0cmFjdG9yPWNsYXNzIGV4dGVuZHMgaS5FeHRyYWN0b3J7Y29uc3RydWN0b3IoZSx0KXtzdXBlcih0KSx0aGlzLmRhdGFGaWxlcz17fSx0aGlzLmRhdGFGaWxlTWFwPXt9LHRoaXMuY3VycmVudEZkPTE7bGV0IHI9e2ZpbGU6bmV3IG8uRGF0YUZpbGUobmV3IFVpbnQ4QXJyYXkoZSkpLGZkOnRoaXMuY3VycmVudEZkKyt9O3RoaXMuX2ZpbGVQYXRoPSJfZGVmYXVsdFVucmFySlNfLnJhciIsdGhpcy5kYXRhRmlsZXNbdGhpcy5fZmlsZVBhdGhdPXIsdGhpcy5kYXRhRmlsZU1hcFtyLmZkXT10aGlzLl9maWxlUGF0aH1vcGVuKGUpe2xldCB0PXRoaXMuZGF0YUZpbGVzW2VdO3JldHVybiB0P3QuZmQ6MH1jcmVhdGUoZSl7bGV0IHQ9dGhpcy5jdXJyZW50RmQrKztyZXR1cm4gdGhpcy5kYXRhRmlsZXNbZV09e2ZpbGU6bmV3IG8uRGF0YUZpbGUsZmQ6dGhpcy5jdXJyZW50RmQrK30sdGhpcy5kYXRhRmlsZU1hcFt0XT1lLHR9Y2xvc2VGaWxlKGUpe2xldCB0PXRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbZV1dO2lmKCF0KXJldHVybiBudWxsO2xldCByPXQuZmlsZS5yZWFkQWxsKCk7cmV0dXJuIDEhPT1lPyhkZWxldGUgdGhpcy5kYXRhRmlsZXNbdGhpcy5kYXRhRmlsZU1hcFtlXV0sZGVsZXRlIHRoaXMuZGF0YUZpbGVNYXBbZV0pOnQuZmlsZS5zZWVrKDAsIlNFVCIpLHJ9cmVhZChlLHQscil7bGV0IG89dGhpcy5kYXRhRmlsZXNbdGhpcy5kYXRhRmlsZU1hcFtlXV07aWYoIW8pcmV0dXJuLTE7bGV0IGk9by5maWxlLnJlYWQocik7cmV0dXJuIG51bGw9PT1pPy0xOihuLkhFQVBVOC5zZXQoaSx0KSxpLmJ5dGVMZW5ndGgpfXdyaXRlKGUsdCxyKXtsZXQgbz10aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW2VdXTtyZXR1cm4hIW8mJihvLmZpbGUud3JpdGUobi5IRUFQVTguc2xpY2UodCx0K3IpKSwhMCl9dGVsbChlKXtsZXQgdD10aGlzLmRhdGFGaWxlc1t0aGlzLmRhdGFGaWxlTWFwW2VdXTtyZXR1cm4gdD90LmZpbGUudGVsbCgpOi0xfXNlZWsoZSx0LHIpe2xldCBuPXRoaXMuZGF0YUZpbGVzW3RoaXMuZGF0YUZpbGVNYXBbZV1dO3JldHVybiEhbiYmbi5maWxlLnNlZWsodCxyKX19fSxmdW5jdGlvbihlLHQscil7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLHQuRGF0YUZpbGU9Y2xhc3N7Y29uc3RydWN0b3IoZSl7dGhpcy5idWZmZXJzPVtdLHRoaXMucG9zPTAsdGhpcy5zaXplPTAsZSYmKHRoaXMuYnVmZmVycy5wdXNoKGUpLHRoaXMuc2l6ZT1lLmJ5dGVMZW5ndGgsdGhpcy5wb3M9MCl9cmVhZChlKXtpZih0aGlzLmZsYXR0ZW4oKSxlK3RoaXMucG9zPnRoaXMuc2l6ZSlyZXR1cm4gbnVsbDtsZXQgdD10aGlzLnBvcztyZXR1cm4gdGhpcy5wb3MrPWUsdGhpcy5idWZmZXJzWzBdLnNsaWNlKHQsdGhpcy5wb3MpfXJlYWRBbGwoKXtyZXR1cm4gdGhpcy5mbGF0dGVuKCksdGhpcy5idWZmZXJzWzBdfXdyaXRlKGUpe3JldHVybiB0aGlzLmJ1ZmZlcnMucHVzaChlKSx0aGlzLnNpemUrPWUuYnl0ZUxlbmd0aCx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RoLCEwfXRlbGwoKXtyZXR1cm4gdGhpcy5wb3N9c2VlayhlLHQpe2xldCByPXRoaXMucG9zO3JldHVybiJTRVQiPT09dD9yPWU6IkNVUiI9PT10P3IrPWU6cj10aGlzLnNpemUtZSwhKHI8MHx8cj50aGlzLnNpemV8fCh0aGlzLnBvcz1yLDApKX1mbGF0dGVuKCl7aWYodGhpcy5idWZmZXJzLmxlbmd0aDw9MSlyZXR1cm47bGV0IGU9bmV3IFVpbnQ4QXJyYXkodGhpcy5zaXplKSx0PTA7Zm9yKGxldCByIG9mIHRoaXMuYnVmZmVycyllLnNldChyLHQpLHQrPXIuYnl0ZUxlbmd0aDt0aGlzLmJ1ZmZlcnM9W2VdfX19LGZ1bmN0aW9uKGUsdCxyKXsoZnVuY3Rpb24oZSl7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO2NvbnN0IG89cigxMiksaT1yKDEzKSxhPXIoMCk7dC5GaWxlRXh0cmFjdG9yPWNsYXNzIGV4dGVuZHMgYS5FeHRyYWN0b3J7Y29uc3RydWN0b3IoZSx0LHIpe3N1cGVyKHIpLHRoaXMuX2ZpbGVQYXRoPWUsdGhpcy5maWxlTWFwPXt9LHRoaXMuX3RhcmdldD10fW9wZW4oZSl7bGV0IHQ9by5vcGVuU3luYyhlLCJyIik7cmV0dXJuIHRoaXMuZmlsZU1hcFt0XT17c2l6ZTpvLmZzdGF0U3luYyh0KS5zaXplLHBvczowLG5hbWU6ZX0sdH1jcmVhdGUoZSl7bGV0IHQ9aS5qb2luKHRoaXMuX3RhcmdldCxlKTtpLnBhcnNlKHQpLmRpci5zcGxpdCgiLyIpLnJlZHVjZSgoZSx0KT0+KGUrPXQrIi8iLG8uZXhpc3RzU3luYyhlKXx8by5ta2RpclN5bmMoZSksZSksIiIpO2xldCByPW8ub3BlblN5bmModCwidyIpO3JldHVybiB0aGlzLmZpbGVNYXBbcl09e3NpemU6MCxwb3M6MCxuYW1lOmV9LHJ9Y2xvc2VGaWxlKGUpe3JldHVybiBkZWxldGUgdGhpcy5maWxlTWFwW2VdLG8uY2xvc2VTeW5jKGUpLG51bGx9cmVhZCh0LHIsaSl7bGV0IGE9dGhpcy5maWxlTWFwW3RdLHM9bmV3IGUoaSksdT1vLnJlYWRTeW5jKHQscywwLGksYS5wb3MpO3JldHVybiBuLkhFQVBVOC5zZXQocyxyKSxhLnBvcys9dSx1fXdyaXRlKHQscixpKXtsZXQgYT10aGlzLmZpbGVNYXBbdF0scz1vLndyaXRlU3luYyh0LG5ldyBlKG4uSEVBUFU4LnN1YmFycmF5KHIscitpKSksMCxpKTtyZXR1cm4gYS5wb3MrPXMsYS5zaXplKz1zLHM9PT1pfXRlbGwoZSl7cmV0dXJuIHRoaXMuZmlsZU1hcFtlXS5wb3N9c2VlayhlLHQscil7bGV0IG49dGhpcy5maWxlTWFwW2VdLG89bi5wb3M7cmV0dXJuIlNFVCI9PT1yP289MDoiRU5EIj09PXImJihvPW4uc2l6ZSksISgobys9dCk8MHx8bz5uLnNpemV8fChuLnBvcz1vLDApKX19fSkuY2FsbCh0aGlzLHIoNykuQnVmZmVyKX0sZnVuY3Rpb24oZSx0LHIpeyhmdW5jdGlvbihlKXsKLyohCiAqIFRoZSBidWZmZXIgbW9kdWxlIGZyb20gbm9kZS5qcywgZm9yIHRoZSBicm93c2VyLgogKgogKiBAYXV0aG9yICAgRmVyb3NzIEFib3VraGFkaWplaCA8ZmVyb3NzQGZlcm9zcy5vcmc+IDxodHRwOi8vZmVyb3NzLm9yZz4KICogQGxpY2Vuc2UgIE1JVAogKi8KdmFyIG49cig5KSxvPXIoMTApLGk9cigxMSk7ZnVuY3Rpb24gYSgpe3JldHVybiB1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/MjE0NzQ4MzY0NzoxMDczNzQxODIzfWZ1bmN0aW9uIHMoZSx0KXtpZihhKCk8dCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW52YWxpZCB0eXBlZCBhcnJheSBsZW5ndGgiKTtyZXR1cm4gdS5UWVBFRF9BUlJBWV9TVVBQT1JUPyhlPW5ldyBVaW50OEFycmF5KHQpKS5fX3Byb3RvX189dS5wcm90b3R5cGU6KG51bGw9PT1lJiYoZT1uZXcgdSh0KSksZS5sZW5ndGg9dCksZX1mdW5jdGlvbiB1KGUsdCxyKXtpZighKHUuVFlQRURfQVJSQVlfU1VQUE9SVHx8dGhpcyBpbnN0YW5jZW9mIHUpKXJldHVybiBuZXcgdShlLHQscik7aWYoIm51bWJlciI9PXR5cGVvZiBlKXtpZigic3RyaW5nIj09dHlwZW9mIHQpdGhyb3cgbmV3IEVycm9yKCJJZiBlbmNvZGluZyBpcyBzcGVjaWZpZWQgdGhlbiB0aGUgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZyIpO3JldHVybiBmKHRoaXMsZSl9cmV0dXJuIGModGhpcyxlLHQscil9ZnVuY3Rpb24gYyhlLHQscixuKXtpZigibnVtYmVyIj09dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcignInZhbHVlIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIG51bWJlcicpO3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgQXJyYXlCdWZmZXImJnQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcj9mdW5jdGlvbihlLHQscixuKXtpZih0LmJ5dGVMZW5ndGgscjwwfHx0LmJ5dGVMZW5ndGg8cil0aHJvdyBuZXcgUmFuZ2VFcnJvcigiJ29mZnNldCcgaXMgb3V0IG9mIGJvdW5kcyIpO2lmKHQuYnl0ZUxlbmd0aDxyKyhufHwwKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiJ2xlbmd0aCcgaXMgb3V0IG9mIGJvdW5kcyIpO3JldHVybiB0PXZvaWQgMD09PXImJnZvaWQgMD09PW4/bmV3IFVpbnQ4QXJyYXkodCk6dm9pZCAwPT09bj9uZXcgVWludDhBcnJheSh0LHIpOm5ldyBVaW50OEFycmF5KHQscixuKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KGU9dCkuX19wcm90b19fPXUucHJvdG90eXBlOmU9ZChlLHQpLGV9KGUsdCxyLG4pOiJzdHJpbmciPT10eXBlb2YgdD9mdW5jdGlvbihlLHQscil7aWYoInN0cmluZyI9PXR5cGVvZiByJiYiIiE9PXJ8fChyPSJ1dGY4IiksIXUuaXNFbmNvZGluZyhyKSl0aHJvdyBuZXcgVHlwZUVycm9yKCciZW5jb2RpbmciIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTt2YXIgbj0wfHAodCxyKSxvPShlPXMoZSxuKSkud3JpdGUodCxyKTtyZXR1cm4gbyE9PW4mJihlPWUuc2xpY2UoMCxvKSksZX0oZSx0LHIpOmZ1bmN0aW9uKGUsdCl7aWYodS5pc0J1ZmZlcih0KSl7dmFyIHI9MHxoKHQubGVuZ3RoKTtyZXR1cm4gMD09PShlPXMoZSxyKSkubGVuZ3RofHx0LmNvcHkoZSwwLDAsciksZX1pZih0KXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIEFycmF5QnVmZmVyJiZ0LmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyfHwibGVuZ3RoImluIHQpcmV0dXJuIm51bWJlciIhPXR5cGVvZiB0Lmxlbmd0aHx8ZnVuY3Rpb24oZSl7cmV0dXJuIGUhPWV9KHQubGVuZ3RoKT9zKGUsMCk6ZChlLHQpO2lmKCJCdWZmZXIiPT09dC50eXBlJiZpKHQuZGF0YSkpcmV0dXJuIGQoZSx0LmRhdGEpfXRocm93IG5ldyBUeXBlRXJyb3IoIkZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBhcnJheS1saWtlIG9iamVjdC4iKX0oZSx0KX1mdW5jdGlvbiBsKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCcic2l6ZSIgYXJndW1lbnQgbXVzdCBiZSBhIG51bWJlcicpO2lmKGU8MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcignInNpemUiIGFyZ3VtZW50IG11c3Qgbm90IGJlIG5lZ2F0aXZlJyl9ZnVuY3Rpb24gZihlLHQpe2lmKGwodCksZT1zKGUsdDwwPzA6MHxoKHQpKSwhdS5UWVBFRF9BUlJBWV9TVVBQT1JUKWZvcih2YXIgcj0wO3I8dDsrK3IpZVtyXT0wO3JldHVybiBlfWZ1bmN0aW9uIGQoZSx0KXt2YXIgcj10Lmxlbmd0aDwwPzA6MHxoKHQubGVuZ3RoKTtlPXMoZSxyKTtmb3IodmFyIG49MDtuPHI7bis9MSllW25dPTI1NSZ0W25dO3JldHVybiBlfWZ1bmN0aW9uIGgoZSl7aWYoZT49YSgpKXRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4IithKCkudG9TdHJpbmcoMTYpKyIgYnl0ZXMiKTtyZXR1cm4gMHxlfWZ1bmN0aW9uIHAoZSx0KXtpZih1LmlzQnVmZmVyKGUpKXJldHVybiBlLmxlbmd0aDtpZigidW5kZWZpbmVkIiE9dHlwZW9mIEFycmF5QnVmZmVyJiYiZnVuY3Rpb24iPT10eXBlb2YgQXJyYXlCdWZmZXIuaXNWaWV3JiYoQXJyYXlCdWZmZXIuaXNWaWV3KGUpfHxlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKXJldHVybiBlLmJ5dGVMZW5ndGg7InN0cmluZyIhPXR5cGVvZiBlJiYoZT0iIitlKTt2YXIgcj1lLmxlbmd0aDtpZigwPT09cilyZXR1cm4gMDtmb3IodmFyIG49ITE7Oylzd2l0Y2godCl7Y2FzZSJhc2NpaSI6Y2FzZSJsYXRpbjEiOmNhc2UiYmluYXJ5IjpyZXR1cm4gcjtjYXNlInV0ZjgiOmNhc2UidXRmLTgiOmNhc2Ugdm9pZCAwOnJldHVybiBVKGUpLmxlbmd0aDtjYXNlInVjczIiOmNhc2UidWNzLTIiOmNhc2UidXRmMTZsZSI6Y2FzZSJ1dGYtMTZsZSI6cmV0dXJuIDIqcjtjYXNlImhleCI6cmV0dXJuIHI+Pj4xO2Nhc2UiYmFzZTY0IjpyZXR1cm4geihlKS5sZW5ndGg7ZGVmYXVsdDppZihuKXJldHVybiBVKGUpLmxlbmd0aDt0PSgiIit0KS50b0xvd2VyQ2FzZSgpLG49ITB9fWZ1bmN0aW9uIG0oZSx0LHIpe3ZhciBuPWVbdF07ZVt0XT1lW3JdLGVbcl09bn1mdW5jdGlvbiB5KGUsdCxyLG4sbyl7aWYoMD09PWUubGVuZ3RoKXJldHVybi0xO2lmKCJzdHJpbmciPT10eXBlb2Ygcj8obj1yLHI9MCk6cj4yMTQ3NDgzNjQ3P3I9MjE0NzQ4MzY0NzpyPC0yMTQ3NDgzNjQ4JiYocj0tMjE0NzQ4MzY0OCkscj0rcixpc05hTihyKSYmKHI9bz8wOmUubGVuZ3RoLTEpLHI8MCYmKHI9ZS5sZW5ndGgrcikscj49ZS5sZW5ndGgpe2lmKG8pcmV0dXJuLTE7cj1lLmxlbmd0aC0xfWVsc2UgaWYocjwwKXtpZighbylyZXR1cm4tMTtyPTB9aWYoInN0cmluZyI9PXR5cGVvZiB0JiYodD11LmZyb20odCxuKSksdS5pc0J1ZmZlcih0KSlyZXR1cm4gMD09PXQubGVuZ3RoPy0xOkUoZSx0LHIsbixvKTtpZigibnVtYmVyIj09dHlwZW9mIHQpcmV0dXJuIHQmPTI1NSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQmJiJmdW5jdGlvbiI9PXR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mP28/VWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGUsdCxyKTpVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGUsdCxyKTpFKGUsW3RdLHIsbixvKTt0aHJvdyBuZXcgVHlwZUVycm9yKCJ2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXIiKX1mdW5jdGlvbiBFKGUsdCxyLG4sbyl7dmFyIGksYT0xLHM9ZS5sZW5ndGgsdT10Lmxlbmd0aDtpZih2b2lkIDAhPT1uJiYoInVjczIiPT09KG49U3RyaW5nKG4pLnRvTG93ZXJDYXNlKCkpfHwidWNzLTIiPT09bnx8InV0ZjE2bGUiPT09bnx8InV0Zi0xNmxlIj09PW4pKXtpZihlLmxlbmd0aDwyfHx0Lmxlbmd0aDwyKXJldHVybi0xO2E9MixzLz0yLHUvPTIsci89Mn1mdW5jdGlvbiBjKGUsdCl7cmV0dXJuIDE9PT1hP2VbdF06ZS5yZWFkVUludDE2QkUodCphKX1pZihvKXt2YXIgbD0tMTtmb3IoaT1yO2k8cztpKyspaWYoYyhlLGkpPT09Yyh0LC0xPT09bD8wOmktbCkpe2lmKC0xPT09bCYmKGw9aSksaS1sKzE9PT11KXJldHVybiBsKmF9ZWxzZS0xIT09bCYmKGktPWktbCksbD0tMX1lbHNlIGZvcihyK3U+cyYmKHI9cy11KSxpPXI7aT49MDtpLS0pe2Zvcih2YXIgZj0hMCxkPTA7ZDx1O2QrKylpZihjKGUsaStkKSE9PWModCxkKSl7Zj0hMTticmVha31pZihmKXJldHVybiBpfXJldHVybi0xfWZ1bmN0aW9uIGcoZSx0LHIsbil7cj1OdW1iZXIocil8fDA7dmFyIG89ZS5sZW5ndGgtcjtuPyhuPU51bWJlcihuKSk+byYmKG49byk6bj1vO3ZhciBpPXQubGVuZ3RoO2lmKGklMiE9MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGhleCBzdHJpbmciKTtuPmkvMiYmKG49aS8yKTtmb3IodmFyIGE9MDthPG47KythKXt2YXIgcz1wYXJzZUludCh0LnN1YnN0cigyKmEsMiksMTYpO2lmKGlzTmFOKHMpKXJldHVybiBhO2VbcithXT1zfXJldHVybiBhfWZ1bmN0aW9uIHYoZSx0LHIsbil7cmV0dXJuICQoVSh0LGUubGVuZ3RoLXIpLGUscixuKX1mdW5jdGlvbiB3KGUsdCxyLG4pe3JldHVybiAkKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxyPTA7cjxlLmxlbmd0aDsrK3IpdC5wdXNoKDI1NSZlLmNoYXJDb2RlQXQocikpO3JldHVybiB0fSh0KSxlLHIsbil9ZnVuY3Rpb24gXyhlLHQscixuKXtyZXR1cm4gdyhlLHQscixuKX1mdW5jdGlvbiBiKGUsdCxyLG4pe3JldHVybiAkKHoodCksZSxyLG4pfWZ1bmN0aW9uIEEoZSx0LHIsbil7cmV0dXJuICQoZnVuY3Rpb24oZSx0KXtmb3IodmFyIHIsbixvLGk9W10sYT0wO2E8ZS5sZW5ndGgmJiEoKHQtPTIpPDApOysrYSluPShyPWUuY2hhckNvZGVBdChhKSk+Pjgsbz1yJTI1NixpLnB1c2gobyksaS5wdXNoKG4pO3JldHVybiBpfSh0LGUubGVuZ3RoLXIpLGUscixuKX1mdW5jdGlvbiBUKGUsdCxyKXtyZXR1cm4gMD09PXQmJnI9PT1lLmxlbmd0aD9uLmZyb21CeXRlQXJyYXkoZSk6bi5mcm9tQnl0ZUFycmF5KGUuc2xpY2UodCxyKSl9ZnVuY3Rpb24gUyhlLHQscil7cj1NYXRoLm1pbihlLmxlbmd0aCxyKTtmb3IodmFyIG49W10sbz10O288cjspe3ZhciBpLGEscyx1LGM9ZVtvXSxsPW51bGwsZj1jPjIzOT80OmM+MjIzPzM6Yz4xOTE/MjoxO2lmKG8rZjw9cilzd2l0Y2goZil7Y2FzZSAxOmM8MTI4JiYobD1jKTticmVhaztjYXNlIDI6MTI4PT0oMTkyJihpPWVbbysxXSkpJiYodT0oMzEmYyk8PDZ8NjMmaSk+MTI3JiYobD11KTticmVhaztjYXNlIDM6aT1lW28rMV0sYT1lW28rMl0sMTI4PT0oMTkyJmkpJiYxMjg9PSgxOTImYSkmJih1PSgxNSZjKTw8MTJ8KDYzJmkpPDw2fDYzJmEpPjIwNDcmJih1PDU1Mjk2fHx1PjU3MzQzKSYmKGw9dSk7YnJlYWs7Y2FzZSA0Omk9ZVtvKzFdLGE9ZVtvKzJdLHM9ZVtvKzNdLDEyOD09KDE5MiZpKSYmMTI4PT0oMTkyJmEpJiYxMjg9PSgxOTImcykmJih1PSgxNSZjKTw8MTh8KDYzJmkpPDwxMnwoNjMmYSk8PDZ8NjMmcyk+NjU1MzUmJnU8MTExNDExMiYmKGw9dSl9bnVsbD09PWw/KGw9NjU1MzMsZj0xKTpsPjY1NTM1JiYobC09NjU1MzYsbi5wdXNoKGw+Pj4xMCYxMDIzfDU1Mjk2KSxsPTU2MzIwfDEwMjMmbCksbi5wdXNoKGwpLG8rPWZ9cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciB0PWUubGVuZ3RoO2lmKHQ8PWspcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLGUpO2Zvcih2YXIgcj0iIixuPTA7bjx0OylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZyxlLnNsaWNlKG4sbis9aykpO3JldHVybiByfShuKX10LkJ1ZmZlcj11LHQuU2xvd0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4rZSE9ZSYmKGU9MCksdS5hbGxvYygrZSl9LHQuSU5TUEVDVF9NQVhfQllURVM9NTAsdS5UWVBFRF9BUlJBWV9TVVBQT1JUPXZvaWQgMCE9PWUuVFlQRURfQVJSQVlfU1VQUE9SVD9lLlRZUEVEX0FSUkFZX1NVUFBPUlQ6ZnVuY3Rpb24oKXt0cnl7dmFyIGU9bmV3IFVpbnQ4QXJyYXkoMSk7cmV0dXJuIGUuX19wcm90b19fPXtfX3Byb3RvX186VWludDhBcnJheS5wcm90b3R5cGUsZm9vOmZ1bmN0aW9uKCl7cmV0dXJuIDQyfX0sNDI9PT1lLmZvbygpJiYiZnVuY3Rpb24iPT10eXBlb2YgZS5zdWJhcnJheSYmMD09PWUuc3ViYXJyYXkoMSwxKS5ieXRlTGVuZ3RofWNhdGNoKGUpe3JldHVybiExfX0oKSx0LmtNYXhMZW5ndGg9YSgpLHUucG9vbFNpemU9ODE5Mix1Ll9hdWdtZW50PWZ1bmN0aW9uKGUpe3JldHVybiBlLl9fcHJvdG9fXz11LnByb3RvdHlwZSxlfSx1LmZyb209ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBjKG51bGwsZSx0LHIpfSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQmJih1LnByb3RvdHlwZS5fX3Byb3RvX189VWludDhBcnJheS5wcm90b3R5cGUsdS5fX3Byb3RvX189VWludDhBcnJheSwidW5kZWZpbmVkIiE9dHlwZW9mIFN5bWJvbCYmU3ltYm9sLnNwZWNpZXMmJnVbU3ltYm9sLnNwZWNpZXNdPT09dSYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHUsU3ltYm9sLnNwZWNpZXMse3ZhbHVlOm51bGwsY29uZmlndXJhYmxlOiEwfSkpLHUuYWxsb2M9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBmdW5jdGlvbihlLHQscixuKXtyZXR1cm4gbCh0KSx0PD0wP3MoZSx0KTp2b2lkIDAhPT1yPyJzdHJpbmciPT10eXBlb2Ygbj9zKGUsdCkuZmlsbChyLG4pOnMoZSx0KS5maWxsKHIpOnMoZSx0KX0obnVsbCxlLHQscil9LHUuYWxsb2NVbnNhZmU9ZnVuY3Rpb24oZSl7cmV0dXJuIGYobnVsbCxlKX0sdS5hbGxvY1Vuc2FmZVNsb3c9ZnVuY3Rpb24oZSl7cmV0dXJuIGYobnVsbCxlKX0sdS5pc0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4hKG51bGw9PWV8fCFlLl9pc0J1ZmZlcil9LHUuY29tcGFyZT1mdW5jdGlvbihlLHQpe2lmKCF1LmlzQnVmZmVyKGUpfHwhdS5pc0J1ZmZlcih0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzIik7aWYoZT09PXQpcmV0dXJuIDA7Zm9yKHZhciByPWUubGVuZ3RoLG49dC5sZW5ndGgsbz0wLGk9TWF0aC5taW4ocixuKTtvPGk7KytvKWlmKGVbb10hPT10W29dKXtyPWVbb10sbj10W29dO2JyZWFrfXJldHVybiByPG4/LTE6bjxyPzE6MH0sdS5pc0VuY29kaW5nPWZ1bmN0aW9uKGUpe3N3aXRjaChTdHJpbmcoZSkudG9Mb3dlckNhc2UoKSl7Y2FzZSJoZXgiOmNhc2UidXRmOCI6Y2FzZSJ1dGYtOCI6Y2FzZSJhc2NpaSI6Y2FzZSJsYXRpbjEiOmNhc2UiYmluYXJ5IjpjYXNlImJhc2U2NCI6Y2FzZSJ1Y3MyIjpjYXNlInVjcy0yIjpjYXNlInV0ZjE2bGUiOmNhc2UidXRmLTE2bGUiOnJldHVybiEwO2RlZmF1bHQ6cmV0dXJuITF9fSx1LmNvbmNhdD1mdW5jdGlvbihlLHQpe2lmKCFpKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTtpZigwPT09ZS5sZW5ndGgpcmV0dXJuIHUuYWxsb2MoMCk7dmFyIHI7aWYodm9pZCAwPT09dClmb3IodD0wLHI9MDtyPGUubGVuZ3RoOysrcil0Kz1lW3JdLmxlbmd0aDt2YXIgbj11LmFsbG9jVW5zYWZlKHQpLG89MDtmb3Iocj0wO3I8ZS5sZW5ndGg7KytyKXt2YXIgYT1lW3JdO2lmKCF1LmlzQnVmZmVyKGEpKXRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTthLmNvcHkobixvKSxvKz1hLmxlbmd0aH1yZXR1cm4gbn0sdS5ieXRlTGVuZ3RoPXAsdS5wcm90b3R5cGUuX2lzQnVmZmVyPSEwLHUucHJvdG90eXBlLnN3YXAxNj1mdW5jdGlvbigpe3ZhciBlPXRoaXMubGVuZ3RoO2lmKGUlMiE9MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDE2LWJpdHMiKTtmb3IodmFyIHQ9MDt0PGU7dCs9MiltKHRoaXMsdCx0KzEpO3JldHVybiB0aGlzfSx1LnByb3RvdHlwZS5zd2FwMzI9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmxlbmd0aDtpZihlJTQhPTApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAzMi1iaXRzIik7Zm9yKHZhciB0PTA7dDxlO3QrPTQpbSh0aGlzLHQsdCszKSxtKHRoaXMsdCsxLHQrMik7cmV0dXJuIHRoaXN9LHUucHJvdG90eXBlLnN3YXA2ND1mdW5jdGlvbigpe3ZhciBlPXRoaXMubGVuZ3RoO2lmKGUlOCE9MCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHMiKTtmb3IodmFyIHQ9MDt0PGU7dCs9OCltKHRoaXMsdCx0KzcpLG0odGhpcyx0KzEsdCs2KSxtKHRoaXMsdCsyLHQrNSksbSh0aGlzLHQrMyx0KzQpO3JldHVybiB0aGlzfSx1LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3ZhciBlPTB8dGhpcy5sZW5ndGg7cmV0dXJuIDA9PT1lPyIiOjA9PT1hcmd1bWVudHMubGVuZ3RoP1ModGhpcywwLGUpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj0hMTtpZigodm9pZCAwPT09dHx8dDwwKSYmKHQ9MCksdD50aGlzLmxlbmd0aClyZXR1cm4iIjtpZigodm9pZCAwPT09cnx8cj50aGlzLmxlbmd0aCkmJihyPXRoaXMubGVuZ3RoKSxyPD0wKXJldHVybiIiO2lmKChyPj4+PTApPD0odD4+Pj0wKSlyZXR1cm4iIjtmb3IoZXx8KGU9InV0ZjgiKTs7KXN3aXRjaChlKXtjYXNlImhleCI6cmV0dXJuIFIodGhpcyx0LHIpO2Nhc2UidXRmOCI6Y2FzZSJ1dGYtOCI6cmV0dXJuIFModGhpcyx0LHIpO2Nhc2UiYXNjaWkiOnJldHVybiBQKHRoaXMsdCxyKTtjYXNlImxhdGluMSI6Y2FzZSJiaW5hcnkiOnJldHVybiBEKHRoaXMsdCxyKTtjYXNlImJhc2U2NCI6cmV0dXJuIFQodGhpcyx0LHIpO2Nhc2UidWNzMiI6Y2FzZSJ1Y3MtMiI6Y2FzZSJ1dGYxNmxlIjpjYXNlInV0Zi0xNmxlIjpyZXR1cm4gTyh0aGlzLHQscik7ZGVmYXVsdDppZihuKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIrZSk7ZT0oZSsiIikudG9Mb3dlckNhc2UoKSxuPSEwfX0uYXBwbHkodGhpcyxhcmd1bWVudHMpfSx1LnByb3RvdHlwZS5lcXVhbHM9ZnVuY3Rpb24oZSl7aWYoIXUuaXNCdWZmZXIoZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciIpO3JldHVybiB0aGlzPT09ZXx8MD09PXUuY29tcGFyZSh0aGlzLGUpfSx1LnByb3RvdHlwZS5pbnNwZWN0PWZ1bmN0aW9uKCl7dmFyIGU9IiIscj10LklOU1BFQ1RfTUFYX0JZVEVTO3JldHVybiB0aGlzLmxlbmd0aD4wJiYoZT10aGlzLnRvU3RyaW5nKCJoZXgiLDAscikubWF0Y2goLy57Mn0vZykuam9pbigiICIpLHRoaXMubGVuZ3RoPnImJihlKz0iIC4uLiAiKSksIjxCdWZmZXIgIitlKyI+In0sdS5wcm90b3R5cGUuY29tcGFyZT1mdW5jdGlvbihlLHQscixuLG8pe2lmKCF1LmlzQnVmZmVyKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIiKTtpZih2b2lkIDA9PT10JiYodD0wKSx2b2lkIDA9PT1yJiYocj1lP2UubGVuZ3RoOjApLHZvaWQgMD09PW4mJihuPTApLHZvaWQgMD09PW8mJihvPXRoaXMubGVuZ3RoKSx0PDB8fHI+ZS5sZW5ndGh8fG48MHx8bz50aGlzLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigib3V0IG9mIHJhbmdlIGluZGV4Iik7aWYobj49byYmdD49cilyZXR1cm4gMDtpZihuPj1vKXJldHVybi0xO2lmKHQ+PXIpcmV0dXJuIDE7aWYodGhpcz09PWUpcmV0dXJuIDA7Zm9yKHZhciBpPShvPj4+PTApLShuPj4+PTApLGE9KHI+Pj49MCktKHQ+Pj49MCkscz1NYXRoLm1pbihpLGEpLGM9dGhpcy5zbGljZShuLG8pLGw9ZS5zbGljZSh0LHIpLGY9MDtmPHM7KytmKWlmKGNbZl0hPT1sW2ZdKXtpPWNbZl0sYT1sW2ZdO2JyZWFrfXJldHVybiBpPGE/LTE6YTxpPzE6MH0sdS5wcm90b3R5cGUuaW5jbHVkZXM9ZnVuY3Rpb24oZSx0LHIpe3JldHVybi0xIT09dGhpcy5pbmRleE9mKGUsdCxyKX0sdS5wcm90b3R5cGUuaW5kZXhPZj1mdW5jdGlvbihlLHQscil7cmV0dXJuIHkodGhpcyxlLHQsciwhMCl9LHUucHJvdG90eXBlLmxhc3RJbmRleE9mPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4geSh0aGlzLGUsdCxyLCExKX0sdS5wcm90b3R5cGUud3JpdGU9ZnVuY3Rpb24oZSx0LHIsbil7aWYodm9pZCAwPT09dCluPSJ1dGY4IixyPXRoaXMubGVuZ3RoLHQ9MDtlbHNlIGlmKHZvaWQgMD09PXImJiJzdHJpbmciPT10eXBlb2YgdCluPXQscj10aGlzLmxlbmd0aCx0PTA7ZWxzZXtpZighaXNGaW5pdGUodCkpdGhyb3cgbmV3IEVycm9yKCJCdWZmZXIud3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0WywgbGVuZ3RoXSkgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCIpO3R8PTAsaXNGaW5pdGUocik/KHJ8PTAsdm9pZCAwPT09biYmKG49InV0ZjgiKSk6KG49cixyPXZvaWQgMCl9dmFyIG89dGhpcy5sZW5ndGgtdDtpZigodm9pZCAwPT09cnx8cj5vKSYmKHI9byksZS5sZW5ndGg+MCYmKHI8MHx8dDwwKXx8dD50aGlzLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMiKTtufHwobj0idXRmOCIpO2Zvcih2YXIgaT0hMTs7KXN3aXRjaChuKXtjYXNlImhleCI6cmV0dXJuIGcodGhpcyxlLHQscik7Y2FzZSJ1dGY4IjpjYXNlInV0Zi04IjpyZXR1cm4gdih0aGlzLGUsdCxyKTtjYXNlImFzY2lpIjpyZXR1cm4gdyh0aGlzLGUsdCxyKTtjYXNlImxhdGluMSI6Y2FzZSJiaW5hcnkiOnJldHVybiBfKHRoaXMsZSx0LHIpO2Nhc2UiYmFzZTY0IjpyZXR1cm4gYih0aGlzLGUsdCxyKTtjYXNlInVjczIiOmNhc2UidWNzLTIiOmNhc2UidXRmMTZsZSI6Y2FzZSJ1dGYtMTZsZSI6cmV0dXJuIEEodGhpcyxlLHQscik7ZGVmYXVsdDppZihpKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIrbik7bj0oIiIrbikudG9Mb3dlckNhc2UoKSxpPSEwfX0sdS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJue3R5cGU6IkJ1ZmZlciIsZGF0YTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzLl9hcnJ8fHRoaXMsMCl9fTt2YXIgaz00MDk2O2Z1bmN0aW9uIFAoZSx0LHIpe3ZhciBuPSIiO3I9TWF0aC5taW4oZS5sZW5ndGgscik7Zm9yKHZhciBvPXQ7bzxyOysrbyluKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDEyNyZlW29dKTtyZXR1cm4gbn1mdW5jdGlvbiBEKGUsdCxyKXt2YXIgbj0iIjtyPU1hdGgubWluKGUubGVuZ3RoLHIpO2Zvcih2YXIgbz10O288cjsrK28pbis9U3RyaW5nLmZyb21DaGFyQ29kZShlW29dKTtyZXR1cm4gbn1mdW5jdGlvbiBSKGUsdCxyKXt2YXIgbj1lLmxlbmd0aDsoIXR8fHQ8MCkmJih0PTApLCghcnx8cjwwfHxyPm4pJiYocj1uKTtmb3IodmFyIG89IiIsaT10O2k8cjsrK2kpbys9aihlW2ldKTtyZXR1cm4gb31mdW5jdGlvbiBPKGUsdCxyKXtmb3IodmFyIG49ZS5zbGljZSh0LHIpLG89IiIsaT0wO2k8bi5sZW5ndGg7aSs9MilvKz1TdHJpbmcuZnJvbUNoYXJDb2RlKG5baV0rMjU2Km5baSsxXSk7cmV0dXJuIG99ZnVuY3Rpb24gQyhlLHQscil7aWYoZSUxIT0wfHxlPDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm9mZnNldCBpcyBub3QgdWludCIpO2lmKGUrdD5yKXRocm93IG5ldyBSYW5nZUVycm9yKCJUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoIil9ZnVuY3Rpb24gTihlLHQscixuLG8saSl7aWYoIXUuaXNCdWZmZXIoZSkpdGhyb3cgbmV3IFR5cGVFcnJvcignImJ1ZmZlciIgYXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciBpbnN0YW5jZScpO2lmKHQ+b3x8dDxpKXRocm93IG5ldyBSYW5nZUVycm9yKCcidmFsdWUiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKTtpZihyK24+ZS5sZW5ndGgpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIEYoZSx0LHIsbil7dDwwJiYodD02NTUzNSt0KzEpO2Zvcih2YXIgbz0wLGk9TWF0aC5taW4oZS5sZW5ndGgtciwyKTtvPGk7KytvKWVbcitvXT0odCYyNTU8PDgqKG4/bzoxLW8pKT4+PjgqKG4/bzoxLW8pfWZ1bmN0aW9uIE0oZSx0LHIsbil7dDwwJiYodD00Mjk0OTY3Mjk1K3QrMSk7Zm9yKHZhciBvPTAsaT1NYXRoLm1pbihlLmxlbmd0aC1yLDQpO288aTsrK28pZVtyK29dPXQ+Pj44KihuP286My1vKSYyNTV9ZnVuY3Rpb24gSShlLHQscixuLG8saSl7aWYocituPmUubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmRleCBvdXQgb2YgcmFuZ2UiKTtpZihyPDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIEIoZSx0LHIsbixpKXtyZXR1cm4gaXx8SShlLDAsciw0KSxvLndyaXRlKGUsdCxyLG4sMjMsNCkscis0fWZ1bmN0aW9uIEwoZSx0LHIsbixpKXtyZXR1cm4gaXx8SShlLDAsciw4KSxvLndyaXRlKGUsdCxyLG4sNTIsOCkscis4fXUucHJvdG90eXBlLnNsaWNlPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbj10aGlzLmxlbmd0aDtpZigoZT1+fmUpPDA/KGUrPW4pPDAmJihlPTApOmU+biYmKGU9biksKHQ9dm9pZCAwPT09dD9uOn5+dCk8MD8odCs9bik8MCYmKHQ9MCk6dD5uJiYodD1uKSx0PGUmJih0PWUpLHUuVFlQRURfQVJSQVlfU1VQUE9SVCkocj10aGlzLnN1YmFycmF5KGUsdCkpLl9fcHJvdG9fXz11LnByb3RvdHlwZTtlbHNle3ZhciBvPXQtZTtyPW5ldyB1KG8sdm9pZCAwKTtmb3IodmFyIGk9MDtpPG87KytpKXJbaV09dGhpc1tpK2VdfXJldHVybiByfSx1LnByb3RvdHlwZS5yZWFkVUludExFPWZ1bmN0aW9uKGUsdCxyKXtlfD0wLHR8PTAscnx8QyhlLHQsdGhpcy5sZW5ndGgpO2Zvcih2YXIgbj10aGlzW2VdLG89MSxpPTA7KytpPHQmJihvKj0yNTYpOyluKz10aGlzW2UraV0qbztyZXR1cm4gbn0sdS5wcm90b3R5cGUucmVhZFVJbnRCRT1mdW5jdGlvbihlLHQscil7ZXw9MCx0fD0wLHJ8fEMoZSx0LHRoaXMubGVuZ3RoKTtmb3IodmFyIG49dGhpc1tlKy0tdF0sbz0xO3Q+MCYmKG8qPTI1Nik7KW4rPXRoaXNbZSstLXRdKm87cmV0dXJuIG59LHUucHJvdG90eXBlLnJlYWRVSW50OD1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsMSx0aGlzLmxlbmd0aCksdGhpc1tlXX0sdS5wcm90b3R5cGUucmVhZFVJbnQxNkxFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwyLHRoaXMubGVuZ3RoKSx0aGlzW2VdfHRoaXNbZSsxXTw8OH0sdS5wcm90b3R5cGUucmVhZFVJbnQxNkJFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwyLHRoaXMubGVuZ3RoKSx0aGlzW2VdPDw4fHRoaXNbZSsxXX0sdS5wcm90b3R5cGUucmVhZFVJbnQzMkxFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSw0LHRoaXMubGVuZ3RoKSwodGhpc1tlXXx0aGlzW2UrMV08PDh8dGhpc1tlKzJdPDwxNikrMTY3NzcyMTYqdGhpc1tlKzNdfSx1LnByb3RvdHlwZS5yZWFkVUludDMyQkU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8QyhlLDQsdGhpcy5sZW5ndGgpLDE2Nzc3MjE2KnRoaXNbZV0rKHRoaXNbZSsxXTw8MTZ8dGhpc1tlKzJdPDw4fHRoaXNbZSszXSl9LHUucHJvdG90eXBlLnJlYWRJbnRMRT1mdW5jdGlvbihlLHQscil7ZXw9MCx0fD0wLHJ8fEMoZSx0LHRoaXMubGVuZ3RoKTtmb3IodmFyIG49dGhpc1tlXSxvPTEsaT0wOysraTx0JiYobyo9MjU2KTspbis9dGhpc1tlK2ldKm87cmV0dXJuIG4+PShvKj0xMjgpJiYobi09TWF0aC5wb3coMiw4KnQpKSxufSx1LnByb3RvdHlwZS5yZWFkSW50QkU9ZnVuY3Rpb24oZSx0LHIpe2V8PTAsdHw9MCxyfHxDKGUsdCx0aGlzLmxlbmd0aCk7Zm9yKHZhciBuPXQsbz0xLGk9dGhpc1tlKy0tbl07bj4wJiYobyo9MjU2KTspaSs9dGhpc1tlKy0tbl0qbztyZXR1cm4gaT49KG8qPTEyOCkmJihpLT1NYXRoLnBvdygyLDgqdCkpLGl9LHUucHJvdG90eXBlLnJlYWRJbnQ4PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSwxLHRoaXMubGVuZ3RoKSwxMjgmdGhpc1tlXT8tMSooMjU1LXRoaXNbZV0rMSk6dGhpc1tlXX0sdS5wcm90b3R5cGUucmVhZEludDE2TEU9ZnVuY3Rpb24oZSx0KXt0fHxDKGUsMix0aGlzLmxlbmd0aCk7dmFyIHI9dGhpc1tlXXx0aGlzW2UrMV08PDg7cmV0dXJuIDMyNzY4JnI/NDI5NDkwMTc2MHxyOnJ9LHUucHJvdG90eXBlLnJlYWRJbnQxNkJFPWZ1bmN0aW9uKGUsdCl7dHx8QyhlLDIsdGhpcy5sZW5ndGgpO3ZhciByPXRoaXNbZSsxXXx0aGlzW2VdPDw4O3JldHVybiAzMjc2OCZyPzQyOTQ5MDE3NjB8cjpyfSx1LnByb3RvdHlwZS5yZWFkSW50MzJMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksdGhpc1tlXXx0aGlzW2UrMV08PDh8dGhpc1tlKzJdPDwxNnx0aGlzW2UrM108PDI0fSx1LnByb3RvdHlwZS5yZWFkSW50MzJCRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksdGhpc1tlXTw8MjR8dGhpc1tlKzFdPDwxNnx0aGlzW2UrMl08PDh8dGhpc1tlKzNdfSx1LnByb3RvdHlwZS5yZWFkRmxvYXRMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsNCx0aGlzLmxlbmd0aCksby5yZWFkKHRoaXMsZSwhMCwyMyw0KX0sdS5wcm90b3R5cGUucmVhZEZsb2F0QkU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8QyhlLDQsdGhpcy5sZW5ndGgpLG8ucmVhZCh0aGlzLGUsITEsMjMsNCl9LHUucHJvdG90eXBlLnJlYWREb3VibGVMRT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHxDKGUsOCx0aGlzLmxlbmd0aCksby5yZWFkKHRoaXMsZSwhMCw1Miw4KX0sdS5wcm90b3R5cGUucmVhZERvdWJsZUJFPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fEMoZSw4LHRoaXMubGVuZ3RoKSxvLnJlYWQodGhpcyxlLCExLDUyLDgpfSx1LnByb3RvdHlwZS53cml0ZVVJbnRMRT1mdW5jdGlvbihlLHQscixuKXtlPStlLHR8PTAscnw9MCxufHxOKHRoaXMsZSx0LHIsTWF0aC5wb3coMiw4KnIpLTEsMCk7dmFyIG89MSxpPTA7Zm9yKHRoaXNbdF09MjU1JmU7KytpPHImJihvKj0yNTYpOyl0aGlzW3QraV09ZS9vJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZVVJbnRCRT1mdW5jdGlvbihlLHQscixuKXtlPStlLHR8PTAscnw9MCxufHxOKHRoaXMsZSx0LHIsTWF0aC5wb3coMiw4KnIpLTEsMCk7dmFyIG89ci0xLGk9MTtmb3IodGhpc1t0K29dPTI1NSZlOy0tbz49MCYmKGkqPTI1Nik7KXRoaXNbdCtvXT1lL2kmMjU1O3JldHVybiB0K3J9LHUucHJvdG90eXBlLndyaXRlVUludDg9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwxLDI1NSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlR8fChlPU1hdGguZmxvb3IoZSkpLHRoaXNbdF09MjU1JmUsdCsxfSx1LnByb3RvdHlwZS53cml0ZVVJbnQxNkxFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsMiw2NTUzNSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09MjU1JmUsdGhpc1t0KzFdPWU+Pj44KTpGKHRoaXMsZSx0LCEwKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlVUludDE2QkU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwyLDY1NTM1LDApLHUuVFlQRURfQVJSQVlfU1VQUE9SVD8odGhpc1t0XT1lPj4+OCx0aGlzW3QrMV09MjU1JmUpOkYodGhpcyxlLHQsITEpLHQrMn0sdS5wcm90b3R5cGUud3JpdGVVSW50MzJMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDQsNDI5NDk2NzI5NSwwKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdCszXT1lPj4+MjQsdGhpc1t0KzJdPWU+Pj4xNix0aGlzW3QrMV09ZT4+PjgsdGhpc1t0XT0yNTUmZSk6TSh0aGlzLGUsdCwhMCksdCs0fSx1LnByb3RvdHlwZS53cml0ZVVJbnQzMkJFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsNCw0Mjk0OTY3Mjk1LDApLHUuVFlQRURfQVJSQVlfU1VQUE9SVD8odGhpc1t0XT1lPj4+MjQsdGhpc1t0KzFdPWU+Pj4xNix0aGlzW3QrMl09ZT4+PjgsdGhpc1t0KzNdPTI1NSZlKTpNKHRoaXMsZSx0LCExKSx0KzR9LHUucHJvdG90eXBlLndyaXRlSW50TEU9ZnVuY3Rpb24oZSx0LHIsbil7aWYoZT0rZSx0fD0wLCFuKXt2YXIgbz1NYXRoLnBvdygyLDgqci0xKTtOKHRoaXMsZSx0LHIsby0xLC1vKX12YXIgaT0wLGE9MSxzPTA7Zm9yKHRoaXNbdF09MjU1JmU7KytpPHImJihhKj0yNTYpOyllPDAmJjA9PT1zJiYwIT09dGhpc1t0K2ktMV0mJihzPTEpLHRoaXNbdCtpXT0oZS9hPj4wKS1zJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZUludEJFPWZ1bmN0aW9uKGUsdCxyLG4pe2lmKGU9K2UsdHw9MCwhbil7dmFyIG89TWF0aC5wb3coMiw4KnItMSk7Tih0aGlzLGUsdCxyLG8tMSwtbyl9dmFyIGk9ci0xLGE9MSxzPTA7Zm9yKHRoaXNbdCtpXT0yNTUmZTstLWk+PTAmJihhKj0yNTYpOyllPDAmJjA9PT1zJiYwIT09dGhpc1t0K2krMV0mJihzPTEpLHRoaXNbdCtpXT0oZS9hPj4wKS1zJjI1NTtyZXR1cm4gdCtyfSx1LnByb3RvdHlwZS53cml0ZUludDg9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlPStlLHR8PTAscnx8Tih0aGlzLGUsdCwxLDEyNywtMTI4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlR8fChlPU1hdGguZmxvb3IoZSkpLGU8MCYmKGU9MjU1K2UrMSksdGhpc1t0XT0yNTUmZSx0KzF9LHUucHJvdG90eXBlLndyaXRlSW50MTZMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDIsMzI3NjcsLTMyNzY4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09MjU1JmUsdGhpc1t0KzFdPWU+Pj44KTpGKHRoaXMsZSx0LCEwKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlSW50MTZCRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDIsMzI3NjcsLTMyNzY4KSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09ZT4+PjgsdGhpc1t0KzFdPTI1NSZlKTpGKHRoaXMsZSx0LCExKSx0KzJ9LHUucHJvdG90eXBlLndyaXRlSW50MzJMRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIGU9K2UsdHw9MCxyfHxOKHRoaXMsZSx0LDQsMjE0NzQ4MzY0NywtMjE0NzQ4MzY0OCksdS5UWVBFRF9BUlJBWV9TVVBQT1JUPyh0aGlzW3RdPTI1NSZlLHRoaXNbdCsxXT1lPj4+OCx0aGlzW3QrMl09ZT4+PjE2LHRoaXNbdCszXT1lPj4+MjQpOk0odGhpcyxlLHQsITApLHQrNH0sdS5wcm90b3R5cGUud3JpdGVJbnQzMkJFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZT0rZSx0fD0wLHJ8fE4odGhpcyxlLHQsNCwyMTQ3NDgzNjQ3LC0yMTQ3NDgzNjQ4KSxlPDAmJihlPTQyOTQ5NjcyOTUrZSsxKSx1LlRZUEVEX0FSUkFZX1NVUFBPUlQ/KHRoaXNbdF09ZT4+PjI0LHRoaXNbdCsxXT1lPj4+MTYsdGhpc1t0KzJdPWU+Pj44LHRoaXNbdCszXT0yNTUmZSk6TSh0aGlzLGUsdCwhMSksdCs0fSx1LnByb3RvdHlwZS53cml0ZUZsb2F0TEU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBCKHRoaXMsZSx0LCEwLHIpfSx1LnByb3RvdHlwZS53cml0ZUZsb2F0QkU9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBCKHRoaXMsZSx0LCExLHIpfSx1LnByb3RvdHlwZS53cml0ZURvdWJsZUxFPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gTCh0aGlzLGUsdCwhMCxyKX0sdS5wcm90b3R5cGUud3JpdGVEb3VibGVCRT1mdW5jdGlvbihlLHQscil7cmV0dXJuIEwodGhpcyxlLHQsITEscil9LHUucHJvdG90eXBlLmNvcHk9ZnVuY3Rpb24oZSx0LHIsbil7aWYocnx8KHI9MCksbnx8MD09PW58fChuPXRoaXMubGVuZ3RoKSx0Pj1lLmxlbmd0aCYmKHQ9ZS5sZW5ndGgpLHR8fCh0PTApLG4+MCYmbjxyJiYobj1yKSxuPT09cilyZXR1cm4gMDtpZigwPT09ZS5sZW5ndGh8fDA9PT10aGlzLmxlbmd0aClyZXR1cm4gMDtpZih0PDApdGhyb3cgbmV3IFJhbmdlRXJyb3IoInRhcmdldFN0YXJ0IG91dCBvZiBib3VuZHMiKTtpZihyPDB8fHI+PXRoaXMubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VTdGFydCBvdXQgb2YgYm91bmRzIik7aWYobjwwKXRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VFbmQgb3V0IG9mIGJvdW5kcyIpO24+dGhpcy5sZW5ndGgmJihuPXRoaXMubGVuZ3RoKSxlLmxlbmd0aC10PG4tciYmKG49ZS5sZW5ndGgtdCtyKTt2YXIgbyxpPW4tcjtpZih0aGlzPT09ZSYmcjx0JiZ0PG4pZm9yKG89aS0xO28+PTA7LS1vKWVbbyt0XT10aGlzW28rcl07ZWxzZSBpZihpPDFlM3x8IXUuVFlQRURfQVJSQVlfU1VQUE9SVClmb3Iobz0wO288aTsrK28pZVtvK3RdPXRoaXNbbytyXTtlbHNlIFVpbnQ4QXJyYXkucHJvdG90eXBlLnNldC5jYWxsKGUsdGhpcy5zdWJhcnJheShyLHIraSksdCk7cmV0dXJuIGl9LHUucHJvdG90eXBlLmZpbGw9ZnVuY3Rpb24oZSx0LHIsbil7aWYoInN0cmluZyI9PXR5cGVvZiBlKXtpZigic3RyaW5nIj09dHlwZW9mIHQ/KG49dCx0PTAscj10aGlzLmxlbmd0aCk6InN0cmluZyI9PXR5cGVvZiByJiYobj1yLHI9dGhpcy5sZW5ndGgpLDE9PT1lLmxlbmd0aCl7dmFyIG89ZS5jaGFyQ29kZUF0KDApO288MjU2JiYoZT1vKX1pZih2b2lkIDAhPT1uJiYic3RyaW5nIiE9dHlwZW9mIG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZyIpO2lmKCJzdHJpbmciPT10eXBlb2YgbiYmIXUuaXNFbmNvZGluZyhuKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGVuY29kaW5nOiAiK24pfWVsc2UibnVtYmVyIj09dHlwZW9mIGUmJihlJj0yNTUpO2lmKHQ8MHx8dGhpcy5sZW5ndGg8dHx8dGhpcy5sZW5ndGg8cil0aHJvdyBuZXcgUmFuZ2VFcnJvcigiT3V0IG9mIHJhbmdlIGluZGV4Iik7aWYocjw9dClyZXR1cm4gdGhpczt2YXIgaTtpZih0Pj4+PTAscj12b2lkIDA9PT1yP3RoaXMubGVuZ3RoOnI+Pj4wLGV8fChlPTApLCJudW1iZXIiPT10eXBlb2YgZSlmb3IoaT10O2k8cjsrK2kpdGhpc1tpXT1lO2Vsc2V7dmFyIGE9dS5pc0J1ZmZlcihlKT9lOlUobmV3IHUoZSxuKS50b1N0cmluZygpKSxzPWEubGVuZ3RoO2ZvcihpPTA7aTxyLXQ7KytpKXRoaXNbaSt0XT1hW2klc119cmV0dXJuIHRoaXN9O3ZhciB4PS9bXitcLzAtOUEtWmEtei1fXS9nO2Z1bmN0aW9uIGooZSl7cmV0dXJuIGU8MTY/IjAiK2UudG9TdHJpbmcoMTYpOmUudG9TdHJpbmcoMTYpfWZ1bmN0aW9uIFUoZSx0KXt2YXIgcjt0PXR8fDEvMDtmb3IodmFyIG49ZS5sZW5ndGgsbz1udWxsLGk9W10sYT0wO2E8bjsrK2Epe2lmKChyPWUuY2hhckNvZGVBdChhKSk+NTUyOTUmJnI8NTczNDQpe2lmKCFvKXtpZihyPjU2MzE5KXsodC09Myk+LTEmJmkucHVzaCgyMzksMTkxLDE4OSk7Y29udGludWV9aWYoYSsxPT09bil7KHQtPTMpPi0xJiZpLnB1c2goMjM5LDE5MSwxODkpO2NvbnRpbnVlfW89cjtjb250aW51ZX1pZihyPDU2MzIwKXsodC09Myk+LTEmJmkucHVzaCgyMzksMTkxLDE4OSksbz1yO2NvbnRpbnVlfXI9NjU1MzYrKG8tNTUyOTY8PDEwfHItNTYzMjApfWVsc2UgbyYmKHQtPTMpPi0xJiZpLnB1c2goMjM5LDE5MSwxODkpO2lmKG89bnVsbCxyPDEyOCl7aWYoKHQtPTEpPDApYnJlYWs7aS5wdXNoKHIpfWVsc2UgaWYocjwyMDQ4KXtpZigodC09Mik8MClicmVhaztpLnB1c2gocj4+NnwxOTIsNjMmcnwxMjgpfWVsc2UgaWYocjw2NTUzNil7aWYoKHQtPTMpPDApYnJlYWs7aS5wdXNoKHI+PjEyfDIyNCxyPj42JjYzfDEyOCw2MyZyfDEyOCl9ZWxzZXtpZighKHI8MTExNDExMikpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNvZGUgcG9pbnQiKTtpZigodC09NCk8MClicmVhaztpLnB1c2gocj4+MTh8MjQwLHI+PjEyJjYzfDEyOCxyPj42JjYzfDEyOCw2MyZyfDEyOCl9fXJldHVybiBpfWZ1bmN0aW9uIHooZSl7cmV0dXJuIG4udG9CeXRlQXJyYXkoZnVuY3Rpb24oZSl7aWYoKGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGUudHJpbT9lLnRyaW0oKTplLnJlcGxhY2UoL15ccyt8XHMrJC9nLCIiKX0oZSkucmVwbGFjZSh4LCIiKSkubGVuZ3RoPDIpcmV0dXJuIiI7Zm9yKDtlLmxlbmd0aCU0IT0wOyllKz0iPSI7cmV0dXJuIGV9KGUpKX1mdW5jdGlvbiAkKGUsdCxyLG4pe2Zvcih2YXIgbz0wO288biYmIShvK3I+PXQubGVuZ3RofHxvPj1lLmxlbmd0aCk7KytvKXRbbytyXT1lW29dO3JldHVybiBvfX0pLmNhbGwodGhpcyxyKDgpKX0sZnVuY3Rpb24oZSx0KXt2YXIgcjtyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCk7dHJ5e3I9cnx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKXx8KDAsZXZhbCkoInRoaXMiKX1jYXRjaChlKXsib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmKHI9d2luZG93KX1lLmV4cG9ydHM9cn0sZnVuY3Rpb24oZSx0LHIpe3QuYnl0ZUxlbmd0aD1mdW5jdGlvbihlKXt2YXIgdD1jKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIDMqKHIrbikvNC1ufSx0LnRvQnl0ZUFycmF5PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxyPWMoZSksbj1yWzBdLGE9clsxXSxzPW5ldyBpKGZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gMyoodCtyKS80LXJ9KDAsbixhKSksdT0wLGw9YT4wP24tNDpuLGY9MDtmPGw7Zis9NCl0PW9bZS5jaGFyQ29kZUF0KGYpXTw8MTh8b1tlLmNoYXJDb2RlQXQoZisxKV08PDEyfG9bZS5jaGFyQ29kZUF0KGYrMildPDw2fG9bZS5jaGFyQ29kZUF0KGYrMyldLHNbdSsrXT10Pj4xNiYyNTUsc1t1KytdPXQ+PjgmMjU1LHNbdSsrXT0yNTUmdDtyZXR1cm4gMj09PWEmJih0PW9bZS5jaGFyQ29kZUF0KGYpXTw8MnxvW2UuY2hhckNvZGVBdChmKzEpXT4+NCxzW3UrK109MjU1JnQpLDE9PT1hJiYodD1vW2UuY2hhckNvZGVBdChmKV08PDEwfG9bZS5jaGFyQ29kZUF0KGYrMSldPDw0fG9bZS5jaGFyQ29kZUF0KGYrMildPj4yLHNbdSsrXT10Pj44JjI1NSxzW3UrK109MjU1JnQpLHN9LHQuZnJvbUJ5dGVBcnJheT1mdW5jdGlvbihlKXtmb3IodmFyIHQscj1lLmxlbmd0aCxvPXIlMyxpPVtdLGE9MCxzPXItbzthPHM7YSs9MTYzODMpaS5wdXNoKGYoZSxhLGErMTYzODM+cz9zOmErMTYzODMpKTtyZXR1cm4gMT09PW8/KHQ9ZVtyLTFdLGkucHVzaChuW3Q+PjJdK25bdDw8NCY2M10rIj09IikpOjI9PT1vJiYodD0oZVtyLTJdPDw4KStlW3ItMV0saS5wdXNoKG5bdD4+MTBdK25bdD4+NCY2M10rblt0PDwyJjYzXSsiPSIpKSxpLmpvaW4oIiIpfTtmb3IodmFyIG49W10sbz1bXSxpPSJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhBcnJheT9VaW50OEFycmF5OkFycmF5LGE9IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iLHM9MCx1PWEubGVuZ3RoO3M8dTsrK3MpbltzXT1hW3NdLG9bYS5jaGFyQ29kZUF0KHMpXT1zO2Z1bmN0aW9uIGMoZSl7dmFyIHQ9ZS5sZW5ndGg7aWYodCU0PjApdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0Iik7dmFyIHI9ZS5pbmRleE9mKCI9Iik7cmV0dXJuLTE9PT1yJiYocj10KSxbcixyPT09dD8wOjQtciU0XX1mdW5jdGlvbiBsKGUpe3JldHVybiBuW2U+PjE4JjYzXStuW2U+PjEyJjYzXStuW2U+PjYmNjNdK25bNjMmZV19ZnVuY3Rpb24gZihlLHQscil7Zm9yKHZhciBuLG89W10saT10O2k8cjtpKz0zKW49KGVbaV08PDE2JjE2NzExNjgwKSsoZVtpKzFdPDw4JjY1MjgwKSsoMjU1JmVbaSsyXSksby5wdXNoKGwobikpO3JldHVybiBvLmpvaW4oIiIpfW9bIi0iLmNoYXJDb2RlQXQoMCldPTYyLG9bIl8iLmNoYXJDb2RlQXQoMCldPTYzfSxmdW5jdGlvbihlLHQpe3QucmVhZD1mdW5jdGlvbihlLHQscixuLG8pe3ZhciBpLGEscz04Km8tbi0xLHU9KDE8PHMpLTEsYz11Pj4xLGw9LTcsZj1yP28tMTowLGQ9cj8tMToxLGg9ZVt0K2ZdO2ZvcihmKz1kLGk9aCYoMTw8LWwpLTEsaD4+PS1sLGwrPXM7bD4wO2k9MjU2KmkrZVt0K2ZdLGYrPWQsbC09OCk7Zm9yKGE9aSYoMTw8LWwpLTEsaT4+PS1sLGwrPW47bD4wO2E9MjU2KmErZVt0K2ZdLGYrPWQsbC09OCk7aWYoMD09PWkpaT0xLWM7ZWxzZXtpZihpPT09dSlyZXR1cm4gYT9OYU46MS8wKihoPy0xOjEpO2ErPU1hdGgucG93KDIsbiksaS09Y31yZXR1cm4oaD8tMToxKSphKk1hdGgucG93KDIsaS1uKX0sdC53cml0ZT1mdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGEscyx1LGM9OCppLW8tMSxsPSgxPDxjKS0xLGY9bD4+MSxkPTIzPT09bz9NYXRoLnBvdygyLC0yNCktTWF0aC5wb3coMiwtNzcpOjAsaD1uPzA6aS0xLHA9bj8xOi0xLG09dDwwfHwwPT09dCYmMS90PDA/MTowO2Zvcih0PU1hdGguYWJzKHQpLGlzTmFOKHQpfHx0PT09MS8wPyhzPWlzTmFOKHQpPzE6MCxhPWwpOihhPU1hdGguZmxvb3IoTWF0aC5sb2codCkvTWF0aC5MTjIpLHQqKHU9TWF0aC5wb3coMiwtYSkpPDEmJihhLS0sdSo9MiksKHQrPWErZj49MT9kL3U6ZCpNYXRoLnBvdygyLDEtZikpKnU+PTImJihhKyssdS89MiksYStmPj1sPyhzPTAsYT1sKTphK2Y+PTE/KHM9KHQqdS0xKSpNYXRoLnBvdygyLG8pLGErPWYpOihzPXQqTWF0aC5wb3coMixmLTEpKk1hdGgucG93KDIsbyksYT0wKSk7bz49ODtlW3IraF09MjU1JnMsaCs9cCxzLz0yNTYsby09OCk7Zm9yKGE9YTw8b3xzLGMrPW87Yz4wO2VbcitoXT0yNTUmYSxoKz1wLGEvPTI1NixjLT04KTtlW3IraC1wXXw9MTI4Km19fSxmdW5jdGlvbihlLHQpe3ZhciByPXt9LnRvU3RyaW5nO2UuZXhwb3J0cz1BcnJheS5pc0FycmF5fHxmdW5jdGlvbihlKXtyZXR1cm4iW29iamVjdCBBcnJheV0iPT1yLmNhbGwoZSl9fSxmdW5jdGlvbih0LHIpe3QuZXhwb3J0cz1lfSxmdW5jdGlvbihlLHQscil7KGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHIoZSx0KXtmb3IodmFyIHI9MCxuPWUubGVuZ3RoLTE7bj49MDtuLS0pe3ZhciBvPWVbbl07Ii4iPT09bz9lLnNwbGljZShuLDEpOiIuLiI9PT1vPyhlLnNwbGljZShuLDEpLHIrKyk6ciYmKGUuc3BsaWNlKG4sMSksci0tKX1pZih0KWZvcig7ci0tO3IpZS51bnNoaWZ0KCIuLiIpO3JldHVybiBlfXZhciBuPS9eKFwvP3wpKFtcc1xTXSo/KSgoPzpcLnsxLDJ9fFteXC9dKz98KShcLlteLlwvXSp8KSkoPzpbXC9dKikkLyxvPWZ1bmN0aW9uKGUpe3JldHVybiBuLmV4ZWMoZSkuc2xpY2UoMSl9O2Z1bmN0aW9uIGkoZSx0KXtpZihlLmZpbHRlcilyZXR1cm4gZS5maWx0ZXIodCk7Zm9yKHZhciByPVtdLG49MDtuPGUubGVuZ3RoO24rKyl0KGVbbl0sbixlKSYmci5wdXNoKGVbbl0pO3JldHVybiByfXQucmVzb2x2ZT1mdW5jdGlvbigpe2Zvcih2YXIgdD0iIixuPSExLG89YXJndW1lbnRzLmxlbmd0aC0xO28+PS0xJiYhbjtvLS0pe3ZhciBhPW8+PTA/YXJndW1lbnRzW29dOmUuY3dkKCk7aWYoInN0cmluZyIhPXR5cGVvZiBhKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLnJlc29sdmUgbXVzdCBiZSBzdHJpbmdzIik7YSYmKHQ9YSsiLyIrdCxuPSIvIj09PWEuY2hhckF0KDApKX1yZXR1cm4obj8iLyI6IiIpKyh0PXIoaSh0LnNwbGl0KCIvIiksKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhbikuam9pbigiLyIpKXx8Ii4ifSx0Lm5vcm1hbGl6ZT1mdW5jdGlvbihlKXt2YXIgbj10LmlzQWJzb2x1dGUoZSksbz0iLyI9PT1hKGUsLTEpO3JldHVybihlPXIoaShlLnNwbGl0KCIvIiksKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhbikuam9pbigiLyIpKXx8bnx8KGU9Ii4iKSxlJiZvJiYoZSs9Ii8iKSwobj8iLyI6IiIpK2V9LHQuaXNBYnNvbHV0ZT1mdW5jdGlvbihlKXtyZXR1cm4iLyI9PT1lLmNoYXJBdCgwKX0sdC5qb2luPWZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO3JldHVybiB0Lm5vcm1hbGl6ZShpKGUsKGZ1bmN0aW9uKGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLmpvaW4gbXVzdCBiZSBzdHJpbmdzIik7cmV0dXJuIGV9KSkuam9pbigiLyIpKX0sdC5yZWxhdGl2ZT1mdW5jdGlvbihlLHIpe2Z1bmN0aW9uIG4oZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aCYmIiI9PT1lW3RdO3QrKyk7Zm9yKHZhciByPWUubGVuZ3RoLTE7cj49MCYmIiI9PT1lW3JdO3ItLSk7cmV0dXJuIHQ+cj9bXTplLnNsaWNlKHQsci10KzEpfWU9dC5yZXNvbHZlKGUpLnN1YnN0cigxKSxyPXQucmVzb2x2ZShyKS5zdWJzdHIoMSk7Zm9yKHZhciBvPW4oZS5zcGxpdCgiLyIpKSxpPW4oci5zcGxpdCgiLyIpKSxhPU1hdGgubWluKG8ubGVuZ3RoLGkubGVuZ3RoKSxzPWEsdT0wO3U8YTt1KyspaWYob1t1XSE9PWlbdV0pe3M9dTticmVha312YXIgYz1bXTtmb3IodT1zO3U8by5sZW5ndGg7dSsrKWMucHVzaCgiLi4iKTtyZXR1cm4oYz1jLmNvbmNhdChpLnNsaWNlKHMpKSkuam9pbigiLyIpfSx0LnNlcD0iLyIsdC5kZWxpbWl0ZXI9IjoiLHQuZGlybmFtZT1mdW5jdGlvbihlKXt2YXIgdD1vKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIHJ8fG4/KG4mJihuPW4uc3Vic3RyKDAsbi5sZW5ndGgtMSkpLHIrbik6Ii4ifSx0LmJhc2VuYW1lPWZ1bmN0aW9uKGUsdCl7dmFyIHI9byhlKVsyXTtyZXR1cm4gdCYmci5zdWJzdHIoLTEqdC5sZW5ndGgpPT09dCYmKHI9ci5zdWJzdHIoMCxyLmxlbmd0aC10Lmxlbmd0aCkpLHJ9LHQuZXh0bmFtZT1mdW5jdGlvbihlKXtyZXR1cm4gbyhlKVszXX07dmFyIGE9ImIiPT09ImFiIi5zdWJzdHIoLTEpP2Z1bmN0aW9uKGUsdCxyKXtyZXR1cm4gZS5zdWJzdHIodCxyKX06ZnVuY3Rpb24oZSx0LHIpe3JldHVybiB0PDAmJih0PWUubGVuZ3RoK3QpLGUuc3Vic3RyKHQscil9fSkuY2FsbCh0aGlzLHIoMTQpKX0sZnVuY3Rpb24oZSx0KXt2YXIgcixuLG89ZS5leHBvcnRzPXt9O2Z1bmN0aW9uIGkoKXt0aHJvdyBuZXcgRXJyb3IoInNldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBhKCl7dGhyb3cgbmV3IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBzKGUpe2lmKHI9PT1zZXRUaW1lb3V0KXJldHVybiBzZXRUaW1lb3V0KGUsMCk7aWYoKHI9PT1pfHwhcikmJnNldFRpbWVvdXQpcmV0dXJuIHI9c2V0VGltZW91dCxzZXRUaW1lb3V0KGUsMCk7dHJ5e3JldHVybiByKGUsMCl9Y2F0Y2godCl7dHJ5e3JldHVybiByLmNhbGwobnVsbCxlLDApfWNhdGNoKHQpe3JldHVybiByLmNhbGwodGhpcyxlLDApfX19IWZ1bmN0aW9uKCl7dHJ5e3I9ImZ1bmN0aW9uIj09dHlwZW9mIHNldFRpbWVvdXQ/c2V0VGltZW91dDppfWNhdGNoKGUpe3I9aX10cnl7bj0iZnVuY3Rpb24iPT10eXBlb2YgY2xlYXJUaW1lb3V0P2NsZWFyVGltZW91dDphfWNhdGNoKGUpe249YX19KCk7dmFyIHUsYz1bXSxsPSExLGY9LTE7ZnVuY3Rpb24gZCgpe2wmJnUmJihsPSExLHUubGVuZ3RoP2M9dS5jb25jYXQoYyk6Zj0tMSxjLmxlbmd0aCYmaCgpKX1mdW5jdGlvbiBoKCl7aWYoIWwpe3ZhciBlPXMoZCk7bD0hMDtmb3IodmFyIHQ9Yy5sZW5ndGg7dDspe2Zvcih1PWMsYz1bXTsrK2Y8dDspdSYmdVtmXS5ydW4oKTtmPS0xLHQ9Yy5sZW5ndGh9dT1udWxsLGw9ITEsZnVuY3Rpb24oZSl7aWYobj09PWNsZWFyVGltZW91dClyZXR1cm4gY2xlYXJUaW1lb3V0KGUpO2lmKChuPT09YXx8IW4pJiZjbGVhclRpbWVvdXQpcmV0dXJuIG49Y2xlYXJUaW1lb3V0LGNsZWFyVGltZW91dChlKTt0cnl7bihlKX1jYXRjaCh0KXt0cnl7cmV0dXJuIG4uY2FsbChudWxsLGUpfWNhdGNoKHQpe3JldHVybiBuLmNhbGwodGhpcyxlKX19fShlKX19ZnVuY3Rpb24gcChlLHQpe3RoaXMuZnVuPWUsdGhpcy5hcnJheT10fWZ1bmN0aW9uIG0oKXt9by5uZXh0VGljaz1mdW5jdGlvbihlKXt2YXIgdD1uZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aC0xKTtpZihhcmd1bWVudHMubGVuZ3RoPjEpZm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyl0W3ItMV09YXJndW1lbnRzW3JdO2MucHVzaChuZXcgcChlLHQpKSwxIT09Yy5sZW5ndGh8fGx8fHMoaCl9LHAucHJvdG90eXBlLnJ1bj1mdW5jdGlvbigpe3RoaXMuZnVuLmFwcGx5KG51bGwsdGhpcy5hcnJheSl9LG8udGl0bGU9ImJyb3dzZXIiLG8uYnJvd3Nlcj0hMCxvLmVudj17fSxvLmFyZ3Y9W10sby52ZXJzaW9uPSIiLG8udmVyc2lvbnM9e30sby5vbj1tLG8uYWRkTGlzdGVuZXI9bSxvLm9uY2U9bSxvLm9mZj1tLG8ucmVtb3ZlTGlzdGVuZXI9bSxvLnJlbW92ZUFsbExpc3RlbmVycz1tLG8uZW1pdD1tLG8ucHJlcGVuZExpc3RlbmVyPW0sby5wcmVwZW5kT25jZUxpc3RlbmVyPW0sby5saXN0ZW5lcnM9ZnVuY3Rpb24oZSl7cmV0dXJuW119LG8uYmluZGluZz1mdW5jdGlvbihlKXt0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIil9LG8uY3dkPWZ1bmN0aW9uKCl7cmV0dXJuIi8ifSxvLmNoZGlyPWZ1bmN0aW9uKGUpe3Rocm93IG5ldyBFcnJvcigicHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkIil9LG8udW1hc2s9ZnVuY3Rpb24oKXtyZXR1cm4gMH19XSl9KHQuZnMpO2NvbnN0IHI9ZS51bnBhY2tCcmlkZ2U7bGV0IG47dmFyIG89ZnVuY3Rpb24oZSl7Y29uc3QgdD17fTtjcmVkZW50aWFscz0ib21pdCI7dmFyIG4sbz12b2lkIDAhPT10P3Q6e30saT1yLkV4dCxhPXtvcGVuOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC5vcGVuLmFwcGx5KGkuY3VycmVudCxhcmd1bWVudHMpfSxjbG9zZTpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQuY2xvc2UuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9LHJlYWQ6ZnVuY3Rpb24oKXtyZXR1cm4gaS5jdXJyZW50LnJlYWQuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9LHdyaXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC53cml0ZS5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sdGVsbDpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQudGVsbC5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sc2VlazpmdW5jdGlvbigpe3JldHVybiBpLmN1cnJlbnQuc2Vlay5hcHBseShpLmN1cnJlbnQsYXJndW1lbnRzKX0sY3JlYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIGkuY3VycmVudC5jcmVhdGUuYXBwbHkoaS5jdXJyZW50LGFyZ3VtZW50cyl9fSxzPXt9O2ZvcihuIGluIG8pby5oYXNPd25Qcm9wZXJ0eShuKSYmKHNbbl09b1tuXSk7by5hcmd1bWVudHM9W10sby50aGlzUHJvZ3JhbT0iLi90aGlzLnByb2dyYW0iLG8ucXVpdD1mdW5jdGlvbihlLHQpe3Rocm93IHR9LG8ucHJlUnVuPVtdLG8ucG9zdFJ1bj1bXTt2YXIgdT0hMSxjPSExLGw9ITE7aWYoby5FTlZJUk9OTUVOVCl7aWYoIldFQiI9PT1vLkVOVklST05NRU5UKXU9ITA7ZWxzZSBpZigiV09SS0VSIj09PW8uRU5WSVJPTk1FTlQpYz0hMDtlbHNlIGlmKCJOT0RFIj09PW8uRU5WSVJPTk1FTlQpbD0hMDtlbHNlIGlmKCJTSEVMTCIhPT1vLkVOVklST05NRU5UKXRocm93IG5ldyBFcnJvcigiTW9kdWxlWydFTlZJUk9OTUVOVCddIHZhbHVlIGlzIG5vdCB2YWxpZC4gbXVzdCBiZSBvbmUgb2Y6IFdFQnxXT1JLRVJ8Tk9ERXxTSEVMTC4iKX1lbHNlIHU9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3csYz0iZnVuY3Rpb24iPT10eXBlb2YgaW1wb3J0U2NyaXB0cyxsPSJvYmplY3QiPT10eXBlb2YgcHJvY2VzcyYmImZ1bmN0aW9uIj09dHlwZW9mIHJlcXVpcmUmJiF1JiYhYztmb3IobiBpbih1fHxjKSYmKG8ucmVhZD1mdW5jdGlvbihlKXt2YXIgdD1uZXcgWE1MSHR0cFJlcXVlc3Q7cmV0dXJuIHQub3BlbigiR0VUIixlLCExKSx0LnNlbmQobnVsbCksdC5yZXNwb25zZVRleHR9LGMmJihvLnJlYWRCaW5hcnk9ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IFhNTEh0dHBSZXF1ZXN0O3JldHVybiB0Lm9wZW4oIkdFVCIsZSwhMSksdC5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIix0LnNlbmQobnVsbCksbmV3IFVpbnQ4QXJyYXkodC5yZXNwb25zZSl9KSxvLnJlYWRBc3luYz1mdW5jdGlvbihlLHQscil7dmFyIG49bmV3IFhNTEh0dHBSZXF1ZXN0O24ub3BlbigiR0VUIixlLCEwKSxuLnJlc3BvbnNlVHlwZT0iYXJyYXlidWZmZXIiLG4ub25sb2FkPWZ1bmN0aW9uKCl7MjAwPT1uLnN0YXR1c3x8MD09bi5zdGF0dXMmJm4ucmVzcG9uc2U/dChuLnJlc3BvbnNlKTpyKCl9LG4ub25lcnJvcj1yLG4uc2VuZChudWxsKX0sby5zZXRXaW5kb3dUaXRsZT1mdW5jdGlvbihlKXtkb2N1bWVudC50aXRsZT1lfSksby5wcmludD0idW5kZWZpbmVkIiE9dHlwZW9mIGNvbnNvbGU/Y29uc29sZS5sb2cuYmluZChjb25zb2xlKToidW5kZWZpbmVkIiE9dHlwZW9mIHByaW50P3ByaW50Om51bGwsby5wcmludEVycj0idW5kZWZpbmVkIiE9dHlwZW9mIHByaW50RXJyP3ByaW50RXJyOiJ1bmRlZmluZWQiIT10eXBlb2YgY29uc29sZSYmY29uc29sZS53YXJuLmJpbmQoY29uc29sZSl8fG8ucHJpbnQsby5wcmludD1vLnByaW50LG8ucHJpbnRFcnI9by5wcmludEVycixzKXMuaGFzT3duUHJvcGVydHkobikmJihvW25dPXNbbl0pO3M9dm9pZCAwO2Z1bmN0aW9uIGYoZSl7eSgheCk7dmFyIHQ9TDtyZXR1cm4gTD1MK2UrMTUmLTE2LHR9ZnVuY3Rpb24gZChlKXt5KCQpO3ZhciB0PUZbJD4+Ml0scj10K2UrMTUmLTE2O2lmKChGWyQ+PjJdPXIscj49cSkmJiFIKCkpcmV0dXJuIEZbJD4+Ml09dCwwO3JldHVybiB0fWZ1bmN0aW9uIGgoZSx0KXtyZXR1cm4gdHx8KHQ9MTYpLGU9TWF0aC5jZWlsKGUvdCkqdH1mdW5jdGlvbiBwKGUpe3N3aXRjaChlKXtjYXNlImkxIjpjYXNlImk4IjpyZXR1cm4gMTtjYXNlImkxNiI6cmV0dXJuIDI7Y2FzZSJpMzIiOnJldHVybiA0O2Nhc2UiaTY0IjpyZXR1cm4gODtjYXNlImZsb2F0IjpyZXR1cm4gNDtjYXNlImRvdWJsZSI6cmV0dXJuIDg7ZGVmYXVsdDppZigiKiI9PT1lW2UubGVuZ3RoLTFdKXJldHVybiA0O2lmKCJpIj09PWVbMF0pe3ZhciB0PXBhcnNlSW50KGUuc3Vic3RyKDEpKTtyZXR1cm4geSh0JTg9PTApLHQvOH1yZXR1cm4gMH19bmV3IEFycmF5KDApO3ZhciBtPTA7ZnVuY3Rpb24geShlLHQpe2V8fHJyKCJBc3NlcnRpb24gZmFpbGVkOiAiK3QpfWZ1bmN0aW9uIEUoZSx0LHIsbil7c3dpdGNoKCIqIj09PShyPXJ8fCJpOCIpLmNoYXJBdChyLmxlbmd0aC0xKSYmKHI9ImkzMiIpLHIpe2Nhc2UiaTEiOmNhc2UiaTgiOlJbZT4+MF09dDticmVhaztjYXNlImkxNiI6Q1tlPj4xXT10O2JyZWFrO2Nhc2UiaTMyIjpGW2U+PjJdPXQ7YnJlYWs7Y2FzZSJpNjQiOnRlbXBJNjQ9W3Q+Pj4wLCh0ZW1wRG91YmxlPXQsK25lKHRlbXBEb3VibGUpPj0xP3RlbXBEb3VibGU+MD8oMHxhZSgraWUodGVtcERvdWJsZS80Mjk0OTY3Mjk2KSw0Mjk0OTY3Mjk1KSk+Pj4wOn5+K29lKCh0ZW1wRG91YmxlLSsofn50ZW1wRG91YmxlPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRltlPj4yXT10ZW1wSTY0WzBdLEZbZSs0Pj4yXT10ZW1wSTY0WzFdO2JyZWFrO2Nhc2UiZmxvYXQiOklbZT4+Ml09dDticmVhaztjYXNlImRvdWJsZSI6QltlPj4zXT10O2JyZWFrO2RlZmF1bHQ6cnIoImludmFsaWQgdHlwZSBmb3Igc2V0VmFsdWU6ICIrcil9fWZ1bmN0aW9uIGcoZSx0LHIsbil7dmFyIG8saTsibnVtYmVyIj09dHlwZW9mIGU/KG89ITAsaT1lKToobz0hMSxpPWUubGVuZ3RoKTt2YXIgYSxzPSJzdHJpbmciPT10eXBlb2YgdD90Om51bGw7aWYoYT00PT1yP246WyJmdW5jdGlvbiI9PXR5cGVvZiBKdD9KdDpmLFF0LGYsZF1bdm9pZCAwPT09cj8yOnJdKE1hdGgubWF4KGkscz8xOnQubGVuZ3RoKSksbyl7dmFyIHU7Zm9yKG49YSx5KDA9PSgzJmEpKSx1PWErKC00JmkpO248dTtuKz00KUZbbj4+Ml09MDtmb3IodT1hK2k7bjx1OylSW24rKz4+MF09MDtyZXR1cm4gYX1pZigiaTgiPT09cylyZXR1cm4gZS5zdWJhcnJheXx8ZS5zbGljZT9PLnNldChlLGEpOk8uc2V0KG5ldyBVaW50OEFycmF5KGUpLGEpLGE7Zm9yKHZhciBjLGwsaCxtPTA7bTxpOyl7dmFyIGc9ZVttXTswIT09KGM9c3x8dFttXSk/KCJpNjQiPT1jJiYoYz0iaTMyIiksRShhK20sZyxjKSxoIT09YyYmKGw9cChjKSxoPWMpLG0rPWwpOm0rK31yZXR1cm4gYX1mdW5jdGlvbiB2KGUsdCl7aWYoMD09PXR8fCFlKXJldHVybiIiO2Zvcih2YXIgcixuPTAsbz0wO258PXI9T1tlK28+PjBdLCgwIT1yfHx0KSYmKG8rKywhdHx8byE9dCk7KTt0fHwodD1vKTt2YXIgaT0iIjtpZihuPDEyOCl7Zm9yKHZhciBhO3Q+MDspYT1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZyxPLnN1YmFycmF5KGUsZStNYXRoLm1pbih0LDEwMjQpKSksaT1pP2krYTphLGUrPTEwMjQsdC09MTAyNDtyZXR1cm4gaX1yZXR1cm4gYihlKX12YXIgdz0idW5kZWZpbmVkIiE9dHlwZW9mIFRleHREZWNvZGVyP25ldyBUZXh0RGVjb2RlcigidXRmOCIpOnZvaWQgMDtmdW5jdGlvbiBfKGUsdCl7Zm9yKHZhciByPXQ7ZVtyXTspKytyO2lmKHItdD4xNiYmZS5zdWJhcnJheSYmdylyZXR1cm4gdy5kZWNvZGUoZS5zdWJhcnJheSh0LHIpKTtmb3IodmFyIG4sbyxpLGEscyx1PSIiOzspe2lmKCEobj1lW3QrK10pKXJldHVybiB1O2lmKDEyOCZuKWlmKG89NjMmZVt0KytdLDE5MiE9KDIyNCZuKSlpZihpPTYzJmVbdCsrXSwyMjQ9PSgyNDAmbik/bj0oMTUmbik8PDEyfG88PDZ8aTooYT02MyZlW3QrK10sMjQwPT0oMjQ4Jm4pP249KDcmbik8PDE4fG88PDEyfGk8PDZ8YToocz02MyZlW3QrK10sbj0yNDg9PSgyNTImbik/KDMmbik8PDI0fG88PDE4fGk8PDEyfGE8PDZ8czooMSZuKTw8MzB8bzw8MjR8aTw8MTh8YTw8MTJ8czw8Nnw2MyZlW3QrK10pKSxuPDY1NTM2KXUrPVN0cmluZy5mcm9tQ2hhckNvZGUobik7ZWxzZXt2YXIgYz1uLTY1NTM2O3UrPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8Yz4+MTAsNTYzMjB8MTAyMyZjKX1lbHNlIHUrPVN0cmluZy5mcm9tQ2hhckNvZGUoKDMxJm4pPDw2fG8pO2Vsc2UgdSs9U3RyaW5nLmZyb21DaGFyQ29kZShuKX19ZnVuY3Rpb24gYihlKXtyZXR1cm4gXyhPLGUpfWZ1bmN0aW9uIEEoZSx0LHIsbil7aWYoIShuPjApKXJldHVybiAwO2Zvcih2YXIgbz1yLGk9cituLTEsYT0wO2E8ZS5sZW5ndGg7KythKXt2YXIgcz1lLmNoYXJDb2RlQXQoYSk7aWYocz49NTUyOTYmJnM8PTU3MzQzJiYocz02NTUzNisoKDEwMjMmcyk8PDEwKXwxMDIzJmUuY2hhckNvZGVBdCgrK2EpKSxzPD0xMjcpe2lmKHI+PWkpYnJlYWs7dFtyKytdPXN9ZWxzZSBpZihzPD0yMDQ3KXtpZihyKzE+PWkpYnJlYWs7dFtyKytdPTE5MnxzPj42LHRbcisrXT0xMjh8NjMmc31lbHNlIGlmKHM8PTY1NTM1KXtpZihyKzI+PWkpYnJlYWs7dFtyKytdPTIyNHxzPj4xMix0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2UgaWYoczw9MjA5NzE1MSl7aWYociszPj1pKWJyZWFrO3RbcisrXT0yNDB8cz4+MTgsdFtyKytdPTEyOHxzPj4xMiY2Myx0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2UgaWYoczw9NjcxMDg4NjMpe2lmKHIrND49aSlicmVhazt0W3IrK109MjQ4fHM+PjI0LHRbcisrXT0xMjh8cz4+MTgmNjMsdFtyKytdPTEyOHxzPj4xMiY2Myx0W3IrK109MTI4fHM+PjYmNjMsdFtyKytdPTEyOHw2MyZzfWVsc2V7aWYocis1Pj1pKWJyZWFrO3RbcisrXT0yNTJ8cz4+MzAsdFtyKytdPTEyOHxzPj4yNCY2Myx0W3IrK109MTI4fHM+PjE4JjYzLHRbcisrXT0xMjh8cz4+MTImNjMsdFtyKytdPTEyOHxzPj42JjYzLHRbcisrXT0xMjh8NjMmc319cmV0dXJuIHRbcl09MCxyLW99ZnVuY3Rpb24gVChlLHQscil7cmV0dXJuIEEoZSxPLHQscil9ZnVuY3Rpb24gUyhlKXtmb3IodmFyIHQ9MCxyPTA7cjxlLmxlbmd0aDsrK3Ipe3ZhciBuPWUuY2hhckNvZGVBdChyKTtuPj01NTI5NiYmbjw9NTczNDMmJihuPTY1NTM2KygoMTAyMyZuKTw8MTApfDEwMjMmZS5jaGFyQ29kZUF0KCsrcikpLG48PTEyNz8rK3Q6dCs9bjw9MjA0Nz8yOm48PTY1NTM1PzM6bjw9MjA5NzE1MT80Om48PTY3MTA4ODYzPzU6Nn1yZXR1cm4gdH0idW5kZWZpbmVkIiE9dHlwZW9mIFRleHREZWNvZGVyJiZuZXcgVGV4dERlY29kZXIoInV0Zi0xNmxlIik7ZnVuY3Rpb24gayhlKXtmb3IodmFyIHQ9MCxyPSIiOzspe3ZhciBuPUZbZSs0KnQ+PjJdO2lmKDA9PW4pcmV0dXJuIHI7aWYoKyt0LG4+PTY1NTM2KXt2YXIgbz1uLTY1NTM2O3IrPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8bz4+MTAsNTYzMjB8MTAyMyZvKX1lbHNlIHIrPVN0cmluZy5mcm9tQ2hhckNvZGUobil9fWZ1bmN0aW9uIFAoKXt2YXIgZT1mdW5jdGlvbigpe3ZhciBlPW5ldyBFcnJvcjtpZighZS5zdGFjayl7dHJ5e3Rocm93IG5ldyBFcnJvcigwKX1jYXRjaCh0KXtlPXR9aWYoIWUuc3RhY2spcmV0dXJuIihubyBzdGFjayB0cmFjZSBhdmFpbGFibGUpIn1yZXR1cm4gZS5zdGFjay50b1N0cmluZygpfSgpO3JldHVybiBvLmV4dHJhU3RhY2tUcmFjZSYmKGUrPSJcbiIrby5leHRyYVN0YWNrVHJhY2UoKSksZS5yZXBsYWNlKC9fX1pbXHdcZF9dKy9nLChmdW5jdGlvbihlKXtyZXR1cm4gZT09ZT9lOmUrIiBbIitlKyJdIn0pKX12YXIgRCxSLE8sQyxOLEYsTSxJLEIsTCx4LGosVSx6LCQ7ZnVuY3Rpb24gVyhlLHQpe3JldHVybiBlJXQ+MCYmKGUrPXQtZSV0KSxlfWZ1bmN0aW9uIFkoZSl7by5idWZmZXI9RD1lfWZ1bmN0aW9uIFYoKXtvLkhFQVA4PVI9bmV3IEludDhBcnJheShEKSxvLkhFQVAxNj1DPW5ldyBJbnQxNkFycmF5KEQpLG8uSEVBUDMyPUY9bmV3IEludDMyQXJyYXkoRCksby5IRUFQVTg9Tz1uZXcgVWludDhBcnJheShEKSxvLkhFQVBVMTY9Tj1uZXcgVWludDE2QXJyYXkoRCksby5IRUFQVTMyPU09bmV3IFVpbnQzMkFycmF5KEQpLG8uSEVBUEYzMj1JPW5ldyBGbG9hdDMyQXJyYXkoRCksby5IRUFQRjY0PUI9bmV3IEZsb2F0NjRBcnJheShEKX1mdW5jdGlvbiBIKCl7dmFyIGU9by51c2luZ1dhc20/NjU1MzY6MTY3NzcyMTYsdD0yMTQ3NDgzNjQ4LWU7aWYoRlskPj4yXT50KXJldHVybiExO3ZhciByPXE7Zm9yKHE9TWF0aC5tYXgocSwxNjc3NzIxNik7cTxGWyQ+PjJdOylxPXE8PTUzNjg3MDkxMj9XKDIqcSxlKTpNYXRoLm1pbihXKCgzKnErMjE0NzQ4MzY0OCkvNCxlKSx0KTt2YXIgbj1vLnJlYWxsb2NCdWZmZXIocSk7cmV0dXJuIG4mJm4uYnl0ZUxlbmd0aD09cT8oWShuKSxWKCksITApOihxPXIsITEpfUw9VT0kPTAseD0hMSxvLnJlYWxsb2NCdWZmZXJ8fChvLnJlYWxsb2NCdWZmZXI9ZnVuY3Rpb24oZSl7dmFyIHQ7dHJ5e2lmKEFycmF5QnVmZmVyLnRyYW5zZmVyKXQ9QXJyYXlCdWZmZXIudHJhbnNmZXIoRCxlKTtlbHNle3ZhciByPVI7dD1uZXcgQXJyYXlCdWZmZXIoZSksbmV3IEludDhBcnJheSh0KS5zZXQocil9fWNhdGNoKGUpe3JldHVybiExfXJldHVybiEhWHQodCkmJnR9KTt0cnl7RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKEFycmF5QnVmZmVyLnByb3RvdHlwZSwiYnl0ZUxlbmd0aCIpLmdldCkobmV3IEFycmF5QnVmZmVyKDQpKX1jYXRjaChlKXsoZnVuY3Rpb24oZSl7cmV0dXJuIGUuYnl0ZUxlbmd0aH0pfXZhciBHPW8uVE9UQUxfU1RBQ0t8fDUyNDI4ODAscT1vLlRPVEFMX01FTU9SWXx8MTY3NzcyMTY7aWYocTxHJiZvLnByaW50RXJyKCJUT1RBTF9NRU1PUlkgc2hvdWxkIGJlIGxhcmdlciB0aGFuIFRPVEFMX1NUQUNLLCB3YXMgIitxKyIhIChUT1RBTF9TVEFDSz0iK0crIikiKSxvLmJ1ZmZlcj9EPW8uYnVmZmVyOigib2JqZWN0Ij09dHlwZW9mIFdlYkFzc2VtYmx5JiYiZnVuY3Rpb24iPT10eXBlb2YgV2ViQXNzZW1ibHkuTWVtb3J5PyhvLndhc21NZW1vcnk9bmV3IFdlYkFzc2VtYmx5Lk1lbW9yeSh7aW5pdGlhbDpxLzY1NTM2fSksRD1vLndhc21NZW1vcnkuYnVmZmVyKTpEPW5ldyBBcnJheUJ1ZmZlcihxKSxvLmJ1ZmZlcj1EKSxWKCksRlswXT0xNjY4NTA5MDI5LENbMV09MjU0NTksMTE1IT09T1syXXx8OTkhPT1PWzNdKXRocm93IlJ1bnRpbWUgZXJyb3I6IGV4cGVjdGVkIHRoZSBzeXN0ZW0gdG8gYmUgbGl0dGxlLWVuZGlhbiEiO2Z1bmN0aW9uIFgoZSl7Zm9yKDtlLmxlbmd0aD4wOyl7dmFyIHQ9ZS5zaGlmdCgpO2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0KXt2YXIgcj10LmZ1bmM7Im51bWJlciI9PXR5cGVvZiByP3ZvaWQgMD09PXQuYXJnP28uZHluQ2FsbF92KHIpOm8uZHluQ2FsbF92aShyLHQuYXJnKTpyKHZvaWQgMD09PXQuYXJnP251bGw6dC5hcmcpfWVsc2UgdCgpfX12YXIgSz1bXSxKPVtdLFo9W10sUT1bXSxlZT1bXSx0ZT0hMTtmdW5jdGlvbiByZShlLHQscil7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDsrK24pUlt0Kys+PjBdPWUuY2hhckNvZGVBdChuKTtyfHwoUlt0Pj4wXT0wKX12YXIgbmU9TWF0aC5hYnMsb2U9TWF0aC5jZWlsLGllPU1hdGguZmxvb3IsYWU9TWF0aC5taW4sc2U9MCx1ZT1udWxsO2Z1bmN0aW9uIGNlKGUpe3NlKyssby5tb25pdG9yUnVuRGVwZW5kZW5jaWVzJiZvLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMoc2UpfWZ1bmN0aW9uIGxlKGUpe2lmKHNlLS0sby5tb25pdG9yUnVuRGVwZW5kZW5jaWVzJiZvLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMoc2UpLDA9PXNlJiZ1ZSl7dmFyIHQ9dWU7dWU9bnVsbCx0KCl9fW8ucHJlbG9hZGVkSW1hZ2VzPXt9LG8ucHJlbG9hZGVkQXVkaW9zPXt9O2Z1bmN0aW9uIGZlKGUpe3JldHVybiBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGg/ZS5zdGFydHNXaXRoKCJkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsIik6MD09PWUuaW5kZXhPZigiZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCIpfSFmdW5jdGlvbigpe3ZhciB0PSJ1bnBhY2sud2FzdCIscj0idW5wYWNrLnRlbXAuYXNtLmpzIjsiZnVuY3Rpb24iPT10eXBlb2Ygby5sb2NhdGVGaWxlJiYoZmUodCl8fCh0PW8ubG9jYXRlRmlsZSh0KSksZmUoZSl8fChlPW8ubG9jYXRlRmlsZShlKSksZmUocil8fChyPW8ubG9jYXRlRmlsZShyKSkpO3ZhciBuPXtnbG9iYWw6bnVsbCxlbnY6bnVsbCxhc20yd2FzbTp7ImY2NC1yZW0iOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUldH0sZGVidWdnZXI6ZnVuY3Rpb24oKXt9fSxwYXJlbnQ6b30saT1udWxsO2Z1bmN0aW9uIGEoKXt0cnl7aWYoby53YXNtQmluYXJ5KXJldHVybiBuZXcgVWludDhBcnJheShvLndhc21CaW5hcnkpO2lmKG8ucmVhZEJpbmFyeSlyZXR1cm4gby5yZWFkQmluYXJ5KGUpO3Rocm93Im9uIHRoZSB3ZWIsIHdlIG5lZWQgdGhlIHdhc20gYmluYXJ5IHRvIGJlIHByZWxvYWRlZCBhbmQgc2V0IG9uIE1vZHVsZVsnd2FzbUJpbmFyeSddLiBlbWNjLnB5IHdpbGwgZG8gdGhhdCBmb3IgeW91IHdoZW4gZ2VuZXJhdGluZyBIVE1MIChidXQgbm90IEpTKSJ9Y2F0Y2goZSl7cnIoZSl9fWZ1bmN0aW9uIHModCxyLHMpe2lmKCJvYmplY3QiIT10eXBlb2YgV2ViQXNzZW1ibHkpcmV0dXJuIG8ucHJpbnRFcnIoIm5vIG5hdGl2ZSB3YXNtIHN1cHBvcnQgZGV0ZWN0ZWQiKSwhMTtpZighKG8ud2FzbU1lbW9yeSBpbnN0YW5jZW9mIFdlYkFzc2VtYmx5Lk1lbW9yeSkpcmV0dXJuIG8ucHJpbnRFcnIoIm5vIG5hdGl2ZSB3YXNtIE1lbW9yeSBpbiB1c2UiKSwhMTtmdW5jdGlvbiBsKGUsdCl7KGk9ZS5leHBvcnRzKS5tZW1vcnkmJmZ1bmN0aW9uKGUpe3ZhciB0PW8uYnVmZmVyO2UuYnl0ZUxlbmd0aDx0LmJ5dGVMZW5ndGgmJm8ucHJpbnRFcnIoInRoZSBuZXcgYnVmZmVyIGluIG1lcmdlTWVtb3J5IGlzIHNtYWxsZXIgdGhhbiB0aGUgcHJldmlvdXMgb25lLiBpbiBuYXRpdmUgd2FzbSwgd2Ugc2hvdWxkIGdyb3cgbWVtb3J5IGhlcmUiKTt2YXIgcj1uZXcgSW50OEFycmF5KHQpO25ldyBJbnQ4QXJyYXkoZSkuc2V0KHIpLFkoZSksVigpfShpLm1lbW9yeSksby5hc209aSxvLnVzaW5nV2FzbT0hMCxsZSgpfWlmKHIubWVtb3J5PW8ud2FzbU1lbW9yeSxuLmdsb2JhbD17TmFOOk5hTixJbmZpbml0eToxLzB9LG5bImdsb2JhbC5NYXRoIl09TWF0aCxuLmVudj1yLGNlKCksby5pbnN0YW50aWF0ZVdhc20pdHJ5e3JldHVybiBvLmluc3RhbnRpYXRlV2FzbShuLGwpfWNhdGNoKGUpe3JldHVybiBvLnByaW50RXJyKCJNb2R1bGUuaW5zdGFudGlhdGVXYXNtIGNhbGxiYWNrIGZhaWxlZCB3aXRoIGVycm9yOiAiK2UpLCExfWZ1bmN0aW9uIGYoZSl7bChlLmluc3RhbmNlLGUubW9kdWxlKX1mdW5jdGlvbiBkKHQpeyhvLndhc21CaW5hcnl8fCF1JiYhY3x8ImZ1bmN0aW9uIiE9dHlwZW9mIGZldGNoP25ldyBQcm9taXNlKChmdW5jdGlvbihlLHQpe2UoYSgpKX0pKTpmZXRjaChlLHtjcmVkZW50aWFsczoib21pdCJ9KS50aGVuKChmdW5jdGlvbih0KXtpZighdC5vayl0aHJvdyJmYWlsZWQgdG8gbG9hZCB3YXNtIGJpbmFyeSBmaWxlIGF0ICciK2UrIiciO3JldHVybiB0LmFycmF5QnVmZmVyKCl9KSkuY2F0Y2goKGZ1bmN0aW9uKCl7cmV0dXJuIGEoKX0pKSkudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGUsbil9KSkudGhlbih0KS5jYXRjaCgoZnVuY3Rpb24oZSl7by5wcmludEVycigiZmFpbGVkIHRvIGFzeW5jaHJvbm91c2x5IHByZXBhcmUgd2FzbTogIitlKSxycihlKX0pKX1yZXR1cm4gby53YXNtQmluYXJ5fHwiZnVuY3Rpb24iIT10eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmd8fGZlKGUpfHwiZnVuY3Rpb24iIT10eXBlb2YgZmV0Y2g/ZChmKTpXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyhmZXRjaChlLHtjcmVkZW50aWFsczoib21pdCJ9KSxuKS50aGVuKGYpLmNhdGNoKChmdW5jdGlvbihlKXtvLnByaW50RXJyKCJ3YXNtIHN0cmVhbWluZyBjb21waWxlIGZhaWxlZDogIitlKSxvLnByaW50RXJyKCJmYWxsaW5nIGJhY2sgdG8gQXJyYXlCdWZmZXIgaW5zdGFudGlhdGlvbiIpLGQoZil9KSkse319by5hc21QcmVsb2FkPW8uYXNtLG8ucmVhbGxvY0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSl7ZT1XKGUsby51c2luZ1dhc20/NjU1MzY6MTY3NzcyMTYpO3ZhciB0PW8uYnVmZmVyLmJ5dGVMZW5ndGg7aWYoby51c2luZ1dhc20pdHJ5e3JldHVybi0xIT09by53YXNtTWVtb3J5Lmdyb3coKGUtdCkvNjU1MzYpP28uYnVmZmVyPW8ud2FzbU1lbW9yeS5idWZmZXI6bnVsbH1jYXRjaChlKXtyZXR1cm4gbnVsbH19KGUpfSxvLmFzbT1mdW5jdGlvbihlLHQscil7aWYoISh0PXQpLnRhYmxlKXt2YXIgbj1vLndhc21UYWJsZVNpemU7dm9pZCAwPT09biYmKG49MTAyNCk7dmFyIGk9by53YXNtTWF4VGFibGVTaXplOyJvYmplY3QiPT10eXBlb2YgV2ViQXNzZW1ibHkmJiJmdW5jdGlvbiI9PXR5cGVvZiBXZWJBc3NlbWJseS5UYWJsZT90LnRhYmxlPXZvaWQgMCE9PWk/bmV3IFdlYkFzc2VtYmx5LlRhYmxlKHtpbml0aWFsOm4sbWF4aW11bTppLGVsZW1lbnQ6ImFueWZ1bmMifSk6bmV3IFdlYkFzc2VtYmx5LlRhYmxlKHtpbml0aWFsOm4sZWxlbWVudDoiYW55ZnVuYyJ9KTp0LnRhYmxlPW5ldyBBcnJheShuKSxvLndhc21UYWJsZT10LnRhYmxlfXZhciBhO3JldHVybiB0Lm1lbW9yeUJhc2V8fCh0Lm1lbW9yeUJhc2U9by5TVEFUSUNfQkFTRSksdC50YWJsZUJhc2V8fCh0LnRhYmxlQmFzZT0wKSwoYT1zKDAsdCkpfHxycigibm8gYmluYXJ5ZW4gbWV0aG9kIHN1Y2NlZWRlZC4gY29uc2lkZXIgZW5hYmxpbmcgbW9yZSBvcHRpb25zLCBsaWtlIGludGVycHJldGluZywgaWYgeW91IHdhbnQgdGhhdDogaHR0cHM6Ly9naXRodWIuY29tL2tyaXBrZW4vZW1zY3JpcHRlbi93aWtpL1dlYkFzc2VtYmx5I2JpbmFyeWVuLW1ldGhvZHMiKSxhfX0oKSxMPTY3OTg0LEoucHVzaCh7ZnVuYzpmdW5jdGlvbigpe0d0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe0h0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe1Z0KCl9fSx7ZnVuYzpmdW5jdGlvbigpe1l0KCl9fSk7by5TVEFUSUNfQkFTRT0xMDI0LG8uU1RBVElDX0JVTVA9NjY5NjAsTCs9MTY7dmFyIGRlPXtsYXN0OjAsY2F1Z2h0OltdLGluZm9zOnt9LGRlQWRqdXN0OmZ1bmN0aW9uKGUpe2lmKCFlfHxkZS5pbmZvc1tlXSlyZXR1cm4gZTtmb3IodmFyIHQgaW4gZGUuaW5mb3Mpe3ZhciByPSt0O2lmKGRlLmluZm9zW3JdLmFkanVzdGVkPT09ZSlyZXR1cm4gcn1yZXR1cm4gZX0sYWRkUmVmOmZ1bmN0aW9uKGUpe2UmJmRlLmluZm9zW2VdLnJlZmNvdW50Kyt9LGRlY1JlZjpmdW5jdGlvbihlKXtpZihlKXt2YXIgdD1kZS5pbmZvc1tlXTt5KHQucmVmY291bnQ+MCksdC5yZWZjb3VudC0tLDAhPT10LnJlZmNvdW50fHx0LnJldGhyb3dufHwodC5kZXN0cnVjdG9yJiZvLmR5bkNhbGxfdmkodC5kZXN0cnVjdG9yLGUpLGRlbGV0ZSBkZS5pbmZvc1tlXSxoZShlKSl9fSxjbGVhclJlZjpmdW5jdGlvbihlKXtlJiYoZGUuaW5mb3NbZV0ucmVmY291bnQ9MCl9fTtmdW5jdGlvbiBoZShlKXt0cnl7cmV0dXJuIEt0KGUpfWNhdGNoKGUpe319ZnVuY3Rpb24gcGUoKXt2YXIgZT1kZS5sYXN0O2lmKCFlKXJldHVybiAwfChadCgwKSwwKTt2YXIgdD1kZS5pbmZvc1tlXSxyPXQudHlwZTtpZighcilyZXR1cm4gMHwoWnQoMCksZSk7dmFyIG49QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtvLl9fX2N4YV9pc19wb2ludGVyX3R5cGUocik7cGUuYnVmZmVyfHwocGUuYnVmZmVyPUp0KDQpKSxGW3BlLmJ1ZmZlcj4+Ml09ZSxlPXBlLmJ1ZmZlcjtmb3IodmFyIGk9MDtpPG4ubGVuZ3RoO2krKylpZihuW2ldJiZvLl9fX2N4YV9jYW5fY2F0Y2gobltpXSxyLGUpKXJldHVybiBlPUZbZT4+Ml0sdC5hZGp1c3RlZD1lLDB8KFp0KG5baV0pLGUpO3JldHVybiBlPUZbZT4+Ml0sMHwoWnQociksZSl9dmFyIG1lPXtFUEVSTToxLEVOT0VOVDoyLEVTUkNIOjMsRUlOVFI6NCxFSU86NSxFTlhJTzo2LEUyQklHOjcsRU5PRVhFQzo4LEVCQURGOjksRUNISUxEOjEwLEVBR0FJTjoxMSxFV09VTERCTE9DSzoxMSxFTk9NRU06MTIsRUFDQ0VTOjEzLEVGQVVMVDoxNCxFTk9UQkxLOjE1LEVCVVNZOjE2LEVFWElTVDoxNyxFWERFVjoxOCxFTk9ERVY6MTksRU5PVERJUjoyMCxFSVNESVI6MjEsRUlOVkFMOjIyLEVORklMRToyMyxFTUZJTEU6MjQsRU5PVFRZOjI1LEVUWFRCU1k6MjYsRUZCSUc6MjcsRU5PU1BDOjI4LEVTUElQRToyOSxFUk9GUzozMCxFTUxJTks6MzEsRVBJUEU6MzIsRURPTTozMyxFUkFOR0U6MzQsRU5PTVNHOjQyLEVJRFJNOjQzLEVDSFJORzo0NCxFTDJOU1lOQzo0NSxFTDNITFQ6NDYsRUwzUlNUOjQ3LEVMTlJORzo0OCxFVU5BVENIOjQ5LEVOT0NTSTo1MCxFTDJITFQ6NTEsRURFQURMSzozNSxFTk9MQ0s6MzcsRUJBREU6NTIsRUJBRFI6NTMsRVhGVUxMOjU0LEVOT0FOTzo1NSxFQkFEUlFDOjU2LEVCQURTTFQ6NTcsRURFQURMT0NLOjM1LEVCRk9OVDo1OSxFTk9TVFI6NjAsRU5PREFUQTo2MSxFVElNRTo2MixFTk9TUjo2MyxFTk9ORVQ6NjQsRU5PUEtHOjY1LEVSRU1PVEU6NjYsRU5PTElOSzo2NyxFQURWOjY4LEVTUk1OVDo2OSxFQ09NTTo3MCxFUFJPVE86NzEsRU1VTFRJSE9QOjcyLEVET1RET1Q6NzMsRUJBRE1TRzo3NCxFTk9UVU5JUTo3NixFQkFERkQ6NzcsRVJFTUNIRzo3OCxFTElCQUNDOjc5LEVMSUJCQUQ6ODAsRUxJQlNDTjo4MSxFTElCTUFYOjgyLEVMSUJFWEVDOjgzLEVOT1NZUzozOCxFTk9URU1QVFk6MzksRU5BTUVUT09MT05HOjM2LEVMT09QOjQwLEVPUE5PVFNVUFA6OTUsRVBGTk9TVVBQT1JUOjk2LEVDT05OUkVTRVQ6MTA0LEVOT0JVRlM6MTA1LEVBRk5PU1VQUE9SVDo5NyxFUFJPVE9UWVBFOjkxLEVOT1RTT0NLOjg4LEVOT1BST1RPT1BUOjkyLEVTSFVURE9XTjoxMDgsRUNPTk5SRUZVU0VEOjExMSxFQUREUklOVVNFOjk4LEVDT05OQUJPUlRFRDoxMDMsRU5FVFVOUkVBQ0g6MTAxLEVORVRET1dOOjEwMCxFVElNRURPVVQ6MTEwLEVIT1NURE9XTjoxMTIsRUhPU1RVTlJFQUNIOjExMyxFSU5QUk9HUkVTUzoxMTUsRUFMUkVBRFk6MTE0LEVERVNUQUREUlJFUTo4OSxFTVNHU0laRTo5MCxFUFJPVE9OT1NVUFBPUlQ6OTMsRVNPQ0tUTk9TVVBQT1JUOjk0LEVBRERSTk9UQVZBSUw6OTksRU5FVFJFU0VUOjEwMixFSVNDT05OOjEwNixFTk9UQ09OTjoxMDcsRVRPT01BTllSRUZTOjEwOSxFVVNFUlM6ODcsRURRVU9UOjEyMixFU1RBTEU6MTE2LEVOT1RTVVA6OTUsRU5PTUVESVVNOjEyMyxFSUxTRVE6ODQsRU9WRVJGTE9XOjc1LEVDQU5DRUxFRDoxMjUsRU5PVFJFQ09WRVJBQkxFOjEzMSxFT1dORVJERUFEOjEzMCxFU1RSUElQRTo4Nn07ZnVuY3Rpb24geWUoZSl7cmV0dXJuIG8uX19fZXJybm9fbG9jYXRpb24mJihGW28uX19fZXJybm9fbG9jYXRpb24oKT4+Ml09ZSksZX12YXIgRWU9ezA6IlN1Y2Nlc3MiLDE6Ik5vdCBzdXBlci11c2VyIiwyOiJObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5IiwzOiJObyBzdWNoIHByb2Nlc3MiLDQ6IkludGVycnVwdGVkIHN5c3RlbSBjYWxsIiw1OiJJL08gZXJyb3IiLDY6Ik5vIHN1Y2ggZGV2aWNlIG9yIGFkZHJlc3MiLDc6IkFyZyBsaXN0IHRvbyBsb25nIiw4OiJFeGVjIGZvcm1hdCBlcnJvciIsOToiQmFkIGZpbGUgbnVtYmVyIiwxMDoiTm8gY2hpbGRyZW4iLDExOiJObyBtb3JlIHByb2Nlc3NlcyIsMTI6Ik5vdCBlbm91Z2ggY29yZSIsMTM6IlBlcm1pc3Npb24gZGVuaWVkIiwxNDoiQmFkIGFkZHJlc3MiLDE1OiJCbG9jayBkZXZpY2UgcmVxdWlyZWQiLDE2OiJNb3VudCBkZXZpY2UgYnVzeSIsMTc6IkZpbGUgZXhpc3RzIiwxODoiQ3Jvc3MtZGV2aWNlIGxpbmsiLDE5OiJObyBzdWNoIGRldmljZSIsMjA6Ik5vdCBhIGRpcmVjdG9yeSIsMjE6IklzIGEgZGlyZWN0b3J5IiwyMjoiSW52YWxpZCBhcmd1bWVudCIsMjM6IlRvbyBtYW55IG9wZW4gZmlsZXMgaW4gc3lzdGVtIiwyNDoiVG9vIG1hbnkgb3BlbiBmaWxlcyIsMjU6Ik5vdCBhIHR5cGV3cml0ZXIiLDI2OiJUZXh0IGZpbGUgYnVzeSIsMjc6IkZpbGUgdG9vIGxhcmdlIiwyODoiTm8gc3BhY2UgbGVmdCBvbiBkZXZpY2UiLDI5OiJJbGxlZ2FsIHNlZWsiLDMwOiJSZWFkIG9ubHkgZmlsZSBzeXN0ZW0iLDMxOiJUb28gbWFueSBsaW5rcyIsMzI6IkJyb2tlbiBwaXBlIiwzMzoiTWF0aCBhcmcgb3V0IG9mIGRvbWFpbiBvZiBmdW5jIiwzNDoiTWF0aCByZXN1bHQgbm90IHJlcHJlc2VudGFibGUiLDM1OiJGaWxlIGxvY2tpbmcgZGVhZGxvY2sgZXJyb3IiLDM2OiJGaWxlIG9yIHBhdGggbmFtZSB0b28gbG9uZyIsMzc6Ik5vIHJlY29yZCBsb2NrcyBhdmFpbGFibGUiLDM4OiJGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQiLDM5OiJEaXJlY3Rvcnkgbm90IGVtcHR5Iiw0MDoiVG9vIG1hbnkgc3ltYm9saWMgbGlua3MiLDQyOiJObyBtZXNzYWdlIG9mIGRlc2lyZWQgdHlwZSIsNDM6IklkZW50aWZpZXIgcmVtb3ZlZCIsNDQ6IkNoYW5uZWwgbnVtYmVyIG91dCBvZiByYW5nZSIsNDU6IkxldmVsIDIgbm90IHN5bmNocm9uaXplZCIsNDY6IkxldmVsIDMgaGFsdGVkIiw0NzoiTGV2ZWwgMyByZXNldCIsNDg6IkxpbmsgbnVtYmVyIG91dCBvZiByYW5nZSIsNDk6IlByb3RvY29sIGRyaXZlciBub3QgYXR0YWNoZWQiLDUwOiJObyBDU0kgc3RydWN0dXJlIGF2YWlsYWJsZSIsNTE6IkxldmVsIDIgaGFsdGVkIiw1MjoiSW52YWxpZCBleGNoYW5nZSIsNTM6IkludmFsaWQgcmVxdWVzdCBkZXNjcmlwdG9yIiw1NDoiRXhjaGFuZ2UgZnVsbCIsNTU6Ik5vIGFub2RlIiw1NjoiSW52YWxpZCByZXF1ZXN0IGNvZGUiLDU3OiJJbnZhbGlkIHNsb3QiLDU5OiJCYWQgZm9udCBmaWxlIGZtdCIsNjA6IkRldmljZSBub3QgYSBzdHJlYW0iLDYxOiJObyBkYXRhIChmb3Igbm8gZGVsYXkgaW8pIiw2MjoiVGltZXIgZXhwaXJlZCIsNjM6Ik91dCBvZiBzdHJlYW1zIHJlc291cmNlcyIsNjQ6Ik1hY2hpbmUgaXMgbm90IG9uIHRoZSBuZXR3b3JrIiw2NToiUGFja2FnZSBub3QgaW5zdGFsbGVkIiw2NjoiVGhlIG9iamVjdCBpcyByZW1vdGUiLDY3OiJUaGUgbGluayBoYXMgYmVlbiBzZXZlcmVkIiw2ODoiQWR2ZXJ0aXNlIGVycm9yIiw2OToiU3Jtb3VudCBlcnJvciIsNzA6IkNvbW11bmljYXRpb24gZXJyb3Igb24gc2VuZCIsNzE6IlByb3RvY29sIGVycm9yIiw3MjoiTXVsdGlob3AgYXR0ZW1wdGVkIiw3MzoiQ3Jvc3MgbW91bnQgcG9pbnQgKG5vdCByZWFsbHkgZXJyb3IpIiw3NDoiVHJ5aW5nIHRvIHJlYWQgdW5yZWFkYWJsZSBtZXNzYWdlIiw3NToiVmFsdWUgdG9vIGxhcmdlIGZvciBkZWZpbmVkIGRhdGEgdHlwZSIsNzY6IkdpdmVuIGxvZy4gbmFtZSBub3QgdW5pcXVlIiw3NzoiZi5kLiBpbnZhbGlkIGZvciB0aGlzIG9wZXJhdGlvbiIsNzg6IlJlbW90ZSBhZGRyZXNzIGNoYW5nZWQiLDc5OiJDYW4gICBhY2Nlc3MgYSBuZWVkZWQgc2hhcmVkIGxpYiIsODA6IkFjY2Vzc2luZyBhIGNvcnJ1cHRlZCBzaGFyZWQgbGliIiw4MToiLmxpYiBzZWN0aW9uIGluIGEub3V0IGNvcnJ1cHRlZCIsODI6IkF0dGVtcHRpbmcgdG8gbGluayBpbiB0b28gbWFueSBsaWJzIiw4MzoiQXR0ZW1wdGluZyB0byBleGVjIGEgc2hhcmVkIGxpYnJhcnkiLDg0OiJJbGxlZ2FsIGJ5dGUgc2VxdWVuY2UiLDg2OiJTdHJlYW1zIHBpcGUgZXJyb3IiLDg3OiJUb28gbWFueSB1c2VycyIsODg6IlNvY2tldCBvcGVyYXRpb24gb24gbm9uLXNvY2tldCIsODk6IkRlc3RpbmF0aW9uIGFkZHJlc3MgcmVxdWlyZWQiLDkwOiJNZXNzYWdlIHRvbyBsb25nIiw5MToiUHJvdG9jb2wgd3JvbmcgdHlwZSBmb3Igc29ja2V0Iiw5MjoiUHJvdG9jb2wgbm90IGF2YWlsYWJsZSIsOTM6IlVua25vd24gcHJvdG9jb2wiLDk0OiJTb2NrZXQgdHlwZSBub3Qgc3VwcG9ydGVkIiw5NToiTm90IHN1cHBvcnRlZCIsOTY6IlByb3RvY29sIGZhbWlseSBub3Qgc3VwcG9ydGVkIiw5NzoiQWRkcmVzcyBmYW1pbHkgbm90IHN1cHBvcnRlZCBieSBwcm90b2NvbCBmYW1pbHkiLDk4OiJBZGRyZXNzIGFscmVhZHkgaW4gdXNlIiw5OToiQWRkcmVzcyBub3QgYXZhaWxhYmxlIiwxMDA6Ik5ldHdvcmsgaW50ZXJmYWNlIGlzIG5vdCBjb25maWd1cmVkIiwxMDE6Ik5ldHdvcmsgaXMgdW5yZWFjaGFibGUiLDEwMjoiQ29ubmVjdGlvbiByZXNldCBieSBuZXR3b3JrIiwxMDM6IkNvbm5lY3Rpb24gYWJvcnRlZCIsMTA0OiJDb25uZWN0aW9uIHJlc2V0IGJ5IHBlZXIiLDEwNToiTm8gYnVmZmVyIHNwYWNlIGF2YWlsYWJsZSIsMTA2OiJTb2NrZXQgaXMgYWxyZWFkeSBjb25uZWN0ZWQiLDEwNzoiU29ja2V0IGlzIG5vdCBjb25uZWN0ZWQiLDEwODoiQ2FuJ3Qgc2VuZCBhZnRlciBzb2NrZXQgc2h1dGRvd24iLDEwOToiVG9vIG1hbnkgcmVmZXJlbmNlcyIsMTEwOiJDb25uZWN0aW9uIHRpbWVkIG91dCIsMTExOiJDb25uZWN0aW9uIHJlZnVzZWQiLDExMjoiSG9zdCBpcyBkb3duIiwxMTM6Ikhvc3QgaXMgdW5yZWFjaGFibGUiLDExNDoiU29ja2V0IGFscmVhZHkgY29ubmVjdGVkIiwxMTU6IkNvbm5lY3Rpb24gYWxyZWFkeSBpbiBwcm9ncmVzcyIsMTE2OiJTdGFsZSBmaWxlIGhhbmRsZSIsMTIyOiJRdW90YSBleGNlZWRlZCIsMTIzOiJObyBtZWRpdW0gKGluIHRhcGUgZHJpdmUpIiwxMjU6Ik9wZXJhdGlvbiBjYW5jZWxlZCIsMTMwOiJQcmV2aW91cyBvd25lciBkaWVkIiwxMzE6IlN0YXRlIG5vdCByZWNvdmVyYWJsZSJ9LGdlPXtzcGxpdFBhdGg6ZnVuY3Rpb24oZSl7cmV0dXJuL14oXC8/fCkoW1xzXFNdKj8pKCg/OlwuezEsMn18W15cL10rP3wpKFwuW14uXC9dKnwpKSg/OltcL10qKSQvLmV4ZWMoZSkuc2xpY2UoMSl9LG5vcm1hbGl6ZUFycmF5OmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPTAsbj1lLmxlbmd0aC0xO24+PTA7bi0tKXt2YXIgbz1lW25dOyIuIj09PW8/ZS5zcGxpY2UobiwxKToiLi4iPT09bz8oZS5zcGxpY2UobiwxKSxyKyspOnImJihlLnNwbGljZShuLDEpLHItLSl9aWYodClmb3IoO3I7ci0tKWUudW5zaGlmdCgiLi4iKTtyZXR1cm4gZX0sbm9ybWFsaXplOmZ1bmN0aW9uKGUpe3ZhciB0PSIvIj09PWUuY2hhckF0KDApLHI9Ii8iPT09ZS5zdWJzdHIoLTEpO3JldHVybihlPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhdCkuam9pbigiLyIpKXx8dHx8KGU9Ii4iKSxlJiZyJiYoZSs9Ii8iKSwodD8iLyI6IiIpK2V9LGRpcm5hbWU6ZnVuY3Rpb24oZSl7dmFyIHQ9Z2Uuc3BsaXRQYXRoKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIHJ8fG4/KG4mJihuPW4uc3Vic3RyKDAsbi5sZW5ndGgtMSkpLHIrbik6Ii4ifSxiYXNlbmFtZTpmdW5jdGlvbihlKXtpZigiLyI9PT1lKXJldHVybiIvIjt2YXIgdD1lLmxhc3RJbmRleE9mKCIvIik7cmV0dXJuLTE9PT10P2U6ZS5zdWJzdHIodCsxKX0sZXh0bmFtZTpmdW5jdGlvbihlKXtyZXR1cm4gZ2Uuc3BsaXRQYXRoKGUpWzNdfSxqb2luOmZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO3JldHVybiBnZS5ub3JtYWxpemUoZS5qb2luKCIvIikpfSxqb2luMjpmdW5jdGlvbihlLHQpe3JldHVybiBnZS5ub3JtYWxpemUoZSsiLyIrdCl9LHJlc29sdmU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9IiIsdD0hMSxyPWFyZ3VtZW50cy5sZW5ndGgtMTtyPj0tMSYmIXQ7ci0tKXt2YXIgbj1yPj0wP2FyZ3VtZW50c1tyXTpUZS5jd2QoKTtpZigic3RyaW5nIiE9dHlwZW9mIG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnRzIHRvIHBhdGgucmVzb2x2ZSBtdXN0IGJlIHN0cmluZ3MiKTtpZighbilyZXR1cm4iIjtlPW4rIi8iK2UsdD0iLyI9PT1uLmNoYXJBdCgwKX1yZXR1cm4odD8iLyI6IiIpKyhlPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhdCkuam9pbigiLyIpKXx8Ii4ifSxyZWxhdGl2ZTpmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIHIoZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aCYmIiI9PT1lW3RdO3QrKyk7Zm9yKHZhciByPWUubGVuZ3RoLTE7cj49MCYmIiI9PT1lW3JdO3ItLSk7cmV0dXJuIHQ+cj9bXTplLnNsaWNlKHQsci10KzEpfWU9Z2UucmVzb2x2ZShlKS5zdWJzdHIoMSksdD1nZS5yZXNvbHZlKHQpLnN1YnN0cigxKTtmb3IodmFyIG49cihlLnNwbGl0KCIvIikpLG89cih0LnNwbGl0KCIvIikpLGk9TWF0aC5taW4obi5sZW5ndGgsby5sZW5ndGgpLGE9aSxzPTA7czxpO3MrKylpZihuW3NdIT09b1tzXSl7YT1zO2JyZWFrfXZhciB1PVtdO2ZvcihzPWE7czxuLmxlbmd0aDtzKyspdS5wdXNoKCIuLiIpO3JldHVybih1PXUuY29uY2F0KG8uc2xpY2UoYSkpKS5qb2luKCIvIil9fSx2ZT17dHR5czpbXSxpbml0OmZ1bmN0aW9uKCl7fSxzaHV0ZG93bjpmdW5jdGlvbigpe30scmVnaXN0ZXI6ZnVuY3Rpb24oZSx0KXt2ZS50dHlzW2VdPXtpbnB1dDpbXSxvdXRwdXQ6W10sb3BzOnR9LFRlLnJlZ2lzdGVyRGV2aWNlKGUsdmUuc3RyZWFtX29wcyl9LHN0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oZSl7dmFyIHQ9dmUudHR5c1tlLm5vZGUucmRldl07aWYoIXQpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtlLnR0eT10LGUuc2Vla2FibGU9ITF9LGNsb3NlOmZ1bmN0aW9uKGUpe2UudHR5Lm9wcy5mbHVzaChlLnR0eSl9LGZsdXNoOmZ1bmN0aW9uKGUpe2UudHR5Lm9wcy5mbHVzaChlLnR0eSl9LHJlYWQ6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighZS50dHl8fCFlLnR0eS5vcHMuZ2V0X2NoYXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5YSU8pO2Zvcih2YXIgaT0wLGE9MDthPG47YSsrKXt2YXIgczt0cnl7cz1lLnR0eS5vcHMuZ2V0X2NoYXIoZS50dHkpfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9aWYodm9pZCAwPT09cyYmMD09PWkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUFHQUlOKTtpZihudWxsPT1zKWJyZWFrO2krKyx0W3IrYV09c31yZXR1cm4gaSYmKGUubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksaX0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighZS50dHl8fCFlLnR0eS5vcHMucHV0X2NoYXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5YSU8pO2Zvcih2YXIgaT0wO2k8bjtpKyspdHJ5e2UudHR5Lm9wcy5wdXRfY2hhcihlLnR0eSx0W3IraV0pfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9cmV0dXJuIG4mJihlLm5vZGUudGltZXN0YW1wPURhdGUubm93KCkpLGl9fSxkZWZhdWx0X3R0eV9vcHM6e2dldF9jaGFyOmZ1bmN0aW9uKGUpe2lmKCFlLmlucHV0Lmxlbmd0aCl7dmFyIHQ9bnVsbDtpZihsKXt2YXIgcj1uZXcgQnVmZmVyKDI1Niksbj0wLG89IndpbjMyIiE9cHJvY2Vzcy5wbGF0Zm9ybSxpPXByb2Nlc3Muc3RkaW4uZmQ7aWYobyl7dmFyIGE9ITE7dHJ5e2k9ZnMub3BlblN5bmMoIi9kZXYvc3RkaW4iLCJyIiksYT0hMH1jYXRjaChlKXt9fXRyeXtuPWZzLnJlYWRTeW5jKGksciwwLDI1NixudWxsKX1jYXRjaChlKXtpZigtMT09ZS50b1N0cmluZygpLmluZGV4T2YoIkVPRiIpKXRocm93IGU7bj0wfWEmJmZzLmNsb3NlU3luYyhpKSx0PW4+MD9yLnNsaWNlKDAsbikudG9TdHJpbmcoInV0Zi04Iik6bnVsbH1lbHNlInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJiJmdW5jdGlvbiI9PXR5cGVvZiB3aW5kb3cucHJvbXB0P251bGwhPT0odD13aW5kb3cucHJvbXB0KCJJbnB1dDogIikpJiYodCs9IlxuIik6ImZ1bmN0aW9uIj09dHlwZW9mIHJlYWRsaW5lJiZudWxsIT09KHQ9cmVhZGxpbmUoKSkmJih0Kz0iXG4iKTtpZighdClyZXR1cm4gbnVsbDtlLmlucHV0PSR0KHQsITApfXJldHVybiBlLmlucHV0LnNoaWZ0KCl9LHB1dF9jaGFyOmZ1bmN0aW9uKGUsdCl7bnVsbD09PXR8fDEwPT09dD8oby5wcmludChfKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSk6MCE9dCYmZS5vdXRwdXQucHVzaCh0KX0sZmx1c2g6ZnVuY3Rpb24oZSl7ZS5vdXRwdXQmJmUub3V0cHV0Lmxlbmd0aD4wJiYoby5wcmludChfKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSl9fSxkZWZhdWx0X3R0eTFfb3BzOntwdXRfY2hhcjpmdW5jdGlvbihlLHQpe251bGw9PT10fHwxMD09PXQ/KG8ucHJpbnRFcnIoXyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pOjAhPXQmJmUub3V0cHV0LnB1c2godCl9LGZsdXNoOmZ1bmN0aW9uKGUpe2Uub3V0cHV0JiZlLm91dHB1dC5sZW5ndGg+MCYmKG8ucHJpbnRFcnIoXyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pfX19LHdlPXtvcHNfdGFibGU6bnVsbCxtb3VudDpmdW5jdGlvbihlKXtyZXR1cm4gd2UuY3JlYXRlTm9kZShudWxsLCIvIiwxNjg5NSwwKX0sY3JlYXRlTm9kZTpmdW5jdGlvbihlLHQscixuKXtpZihUZS5pc0Jsa2RldihyKXx8VGUuaXNGSUZPKHIpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTt3ZS5vcHNfdGFibGV8fCh3ZS5vcHNfdGFibGU9e2Rpcjp7bm9kZTp7Z2V0YXR0cjp3ZS5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6d2Uubm9kZV9vcHMuc2V0YXR0cixsb29rdXA6d2Uubm9kZV9vcHMubG9va3VwLG1rbm9kOndlLm5vZGVfb3BzLm1rbm9kLHJlbmFtZTp3ZS5ub2RlX29wcy5yZW5hbWUsdW5saW5rOndlLm5vZGVfb3BzLnVubGluayxybWRpcjp3ZS5ub2RlX29wcy5ybWRpcixyZWFkZGlyOndlLm5vZGVfb3BzLnJlYWRkaXIsc3ltbGluazp3ZS5ub2RlX29wcy5zeW1saW5rfSxzdHJlYW06e2xsc2Vlazp3ZS5zdHJlYW1fb3BzLmxsc2Vla319LGZpbGU6e25vZGU6e2dldGF0dHI6d2Uubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOndlLm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTp7bGxzZWVrOndlLnN0cmVhbV9vcHMubGxzZWVrLHJlYWQ6d2Uuc3RyZWFtX29wcy5yZWFkLHdyaXRlOndlLnN0cmVhbV9vcHMud3JpdGUsYWxsb2NhdGU6d2Uuc3RyZWFtX29wcy5hbGxvY2F0ZSxtbWFwOndlLnN0cmVhbV9vcHMubW1hcCxtc3luYzp3ZS5zdHJlYW1fb3BzLm1zeW5jfX0sbGluazp7bm9kZTp7Z2V0YXR0cjp3ZS5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6d2Uubm9kZV9vcHMuc2V0YXR0cixyZWFkbGluazp3ZS5ub2RlX29wcy5yZWFkbGlua30sc3RyZWFtOnt9fSxjaHJkZXY6e25vZGU6e2dldGF0dHI6d2Uubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOndlLm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTpUZS5jaHJkZXZfc3RyZWFtX29wc319KTt2YXIgbz1UZS5jcmVhdGVOb2RlKGUsdCxyLG4pO3JldHVybiBUZS5pc0RpcihvLm1vZGUpPyhvLm5vZGVfb3BzPXdlLm9wc190YWJsZS5kaXIubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmRpci5zdHJlYW0sby5jb250ZW50cz17fSk6VGUuaXNGaWxlKG8ubW9kZSk/KG8ubm9kZV9vcHM9d2Uub3BzX3RhYmxlLmZpbGUubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmZpbGUuc3RyZWFtLG8udXNlZEJ5dGVzPTAsby5jb250ZW50cz1udWxsKTpUZS5pc0xpbmsoby5tb2RlKT8oby5ub2RlX29wcz13ZS5vcHNfdGFibGUubGluay5ub2RlLG8uc3RyZWFtX29wcz13ZS5vcHNfdGFibGUubGluay5zdHJlYW0pOlRlLmlzQ2hyZGV2KG8ubW9kZSkmJihvLm5vZGVfb3BzPXdlLm9wc190YWJsZS5jaHJkZXYubm9kZSxvLnN0cmVhbV9vcHM9d2Uub3BzX3RhYmxlLmNocmRldi5zdHJlYW0pLG8udGltZXN0YW1wPURhdGUubm93KCksZSYmKGUuY29udGVudHNbdF09byksb30sZ2V0RmlsZURhdGFBc1JlZ3VsYXJBcnJheTpmdW5jdGlvbihlKXtpZihlLmNvbnRlbnRzJiZlLmNvbnRlbnRzLnN1YmFycmF5KXtmb3IodmFyIHQ9W10scj0wO3I8ZS51c2VkQnl0ZXM7KytyKXQucHVzaChlLmNvbnRlbnRzW3JdKTtyZXR1cm4gdH1yZXR1cm4gZS5jb250ZW50c30sZ2V0RmlsZURhdGFBc1R5cGVkQXJyYXk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuY29udGVudHM/ZS5jb250ZW50cy5zdWJhcnJheT9lLmNvbnRlbnRzLnN1YmFycmF5KDAsZS51c2VkQnl0ZXMpOm5ldyBVaW50OEFycmF5KGUuY29udGVudHMpOm5ldyBVaW50OEFycmF5fSxleHBhbmRGaWxlU3RvcmFnZTpmdW5jdGlvbihlLHQpe2lmKGUuY29udGVudHMmJmUuY29udGVudHMuc3ViYXJyYXkmJnQ+ZS5jb250ZW50cy5sZW5ndGgmJihlLmNvbnRlbnRzPXdlLmdldEZpbGVEYXRhQXNSZWd1bGFyQXJyYXkoZSksZS51c2VkQnl0ZXM9ZS5jb250ZW50cy5sZW5ndGgpLCFlLmNvbnRlbnRzfHxlLmNvbnRlbnRzLnN1YmFycmF5KXt2YXIgcj1lLmNvbnRlbnRzP2UuY29udGVudHMubGVuZ3RoOjA7aWYocj49dClyZXR1cm47dD1NYXRoLm1heCh0LHIqKHI8MTA0ODU3Nj8yOjEuMTI1KXwwKSwwIT1yJiYodD1NYXRoLm1heCh0LDI1NikpO3ZhciBuPWUuY29udGVudHM7cmV0dXJuIGUuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkodCksdm9pZChlLnVzZWRCeXRlcz4wJiZlLmNvbnRlbnRzLnNldChuLnN1YmFycmF5KDAsZS51c2VkQnl0ZXMpLDApKX1mb3IoIWUuY29udGVudHMmJnQ+MCYmKGUuY29udGVudHM9W10pO2UuY29udGVudHMubGVuZ3RoPHQ7KWUuY29udGVudHMucHVzaCgwKX0scmVzaXplRmlsZVN0b3JhZ2U6ZnVuY3Rpb24oZSx0KXtpZihlLnVzZWRCeXRlcyE9dCl7aWYoMD09dClyZXR1cm4gZS5jb250ZW50cz1udWxsLHZvaWQoZS51c2VkQnl0ZXM9MCk7aWYoIWUuY29udGVudHN8fGUuY29udGVudHMuc3ViYXJyYXkpe3ZhciByPWUuY29udGVudHM7cmV0dXJuIGUuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkobmV3IEFycmF5QnVmZmVyKHQpKSxyJiZlLmNvbnRlbnRzLnNldChyLnN1YmFycmF5KDAsTWF0aC5taW4odCxlLnVzZWRCeXRlcykpKSx2b2lkKGUudXNlZEJ5dGVzPXQpfWlmKGUuY29udGVudHN8fChlLmNvbnRlbnRzPVtdKSxlLmNvbnRlbnRzLmxlbmd0aD50KWUuY29udGVudHMubGVuZ3RoPXQ7ZWxzZSBmb3IoO2UuY29udGVudHMubGVuZ3RoPHQ7KWUuY29udGVudHMucHVzaCgwKTtlLnVzZWRCeXRlcz10fX0sbm9kZV9vcHM6e2dldGF0dHI6ZnVuY3Rpb24oZSl7dmFyIHQ9e307cmV0dXJuIHQuZGV2PVRlLmlzQ2hyZGV2KGUubW9kZSk/ZS5pZDoxLHQuaW5vPWUuaWQsdC5tb2RlPWUubW9kZSx0Lm5saW5rPTEsdC51aWQ9MCx0LmdpZD0wLHQucmRldj1lLnJkZXYsVGUuaXNEaXIoZS5tb2RlKT90LnNpemU9NDA5NjpUZS5pc0ZpbGUoZS5tb2RlKT90LnNpemU9ZS51c2VkQnl0ZXM6VGUuaXNMaW5rKGUubW9kZSk/dC5zaXplPWUubGluay5sZW5ndGg6dC5zaXplPTAsdC5hdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5tdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5jdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5ibGtzaXplPTQwOTYsdC5ibG9ja3M9TWF0aC5jZWlsKHQuc2l6ZS90LmJsa3NpemUpLHR9LHNldGF0dHI6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT10Lm1vZGUmJihlLm1vZGU9dC5tb2RlKSx2b2lkIDAhPT10LnRpbWVzdGFtcCYmKGUudGltZXN0YW1wPXQudGltZXN0YW1wKSx2b2lkIDAhPT10LnNpemUmJndlLnJlc2l6ZUZpbGVTdG9yYWdlKGUsdC5zaXplKX0sbG9va3VwOmZ1bmN0aW9uKGUsdCl7dGhyb3cgVGUuZ2VuZXJpY0Vycm9yc1ttZS5FTk9FTlRdfSxta25vZDpmdW5jdGlvbihlLHQscixuKXtyZXR1cm4gd2UuY3JlYXRlTm9kZShlLHQscixuKX0scmVuYW1lOmZ1bmN0aW9uKGUsdCxyKXtpZihUZS5pc0RpcihlLm1vZGUpKXt2YXIgbjt0cnl7bj1UZS5sb29rdXBOb2RlKHQscil9Y2F0Y2goZSl7fWlmKG4pZm9yKHZhciBvIGluIG4uY29udGVudHMpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PVEVNUFRZKX1kZWxldGUgZS5wYXJlbnQuY29udGVudHNbZS5uYW1lXSxlLm5hbWU9cix0LmNvbnRlbnRzW3JdPWUsZS5wYXJlbnQ9dH0sdW5saW5rOmZ1bmN0aW9uKGUsdCl7ZGVsZXRlIGUuY29udGVudHNbdF19LHJtZGlyOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUubG9va3VwTm9kZShlLHQpO2Zvcih2YXIgbiBpbiByLmNvbnRlbnRzKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RFTVBUWSk7ZGVsZXRlIGUuY29udGVudHNbdF19LHJlYWRkaXI6ZnVuY3Rpb24oZSl7dmFyIHQ9WyIuIiwiLi4iXTtmb3IodmFyIHIgaW4gZS5jb250ZW50cyllLmNvbnRlbnRzLmhhc093blByb3BlcnR5KHIpJiZ0LnB1c2gocik7cmV0dXJuIHR9LHN5bWxpbms6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPXdlLmNyZWF0ZU5vZGUoZSx0LDQxNDcxLDApO3JldHVybiBuLmxpbms9cixufSxyZWFkbGluazpmdW5jdGlvbihlKXtpZighVGUuaXNMaW5rKGUubW9kZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtyZXR1cm4gZS5saW5rfX0sc3RyZWFtX29wczp7cmVhZDpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWUubm9kZS5jb250ZW50cztpZihvPj1lLm5vZGUudXNlZEJ5dGVzKXJldHVybiAwO3ZhciBhPU1hdGgubWluKGUubm9kZS51c2VkQnl0ZXMtbyxuKTtpZih5KGE+PTApLGE+OCYmaS5zdWJhcnJheSl0LnNldChpLnN1YmFycmF5KG8sbythKSxyKTtlbHNlIGZvcih2YXIgcz0wO3M8YTtzKyspdFtyK3NdPWlbbytzXTtyZXR1cm4gYX0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvLGkpe2lmKCFuKXJldHVybiAwO3ZhciBhPWUubm9kZTtpZihhLnRpbWVzdGFtcD1EYXRlLm5vdygpLHQuc3ViYXJyYXkmJighYS5jb250ZW50c3x8YS5jb250ZW50cy5zdWJhcnJheSkpe2lmKGkpcmV0dXJuIGEuY29udGVudHM9dC5zdWJhcnJheShyLHIrbiksYS51c2VkQnl0ZXM9bixuO2lmKDA9PT1hLnVzZWRCeXRlcyYmMD09PW8pcmV0dXJuIGEuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkodC5zdWJhcnJheShyLHIrbikpLGEudXNlZEJ5dGVzPW4sbjtpZihvK248PWEudXNlZEJ5dGVzKXJldHVybiBhLmNvbnRlbnRzLnNldCh0LnN1YmFycmF5KHIscituKSxvKSxufWlmKHdlLmV4cGFuZEZpbGVTdG9yYWdlKGEsbytuKSxhLmNvbnRlbnRzLnN1YmFycmF5JiZ0LnN1YmFycmF5KWEuY29udGVudHMuc2V0KHQuc3ViYXJyYXkocixyK24pLG8pO2Vsc2UgZm9yKHZhciBzPTA7czxuO3MrKylhLmNvbnRlbnRzW28rc109dFtyK3NdO3JldHVybiBhLnVzZWRCeXRlcz1NYXRoLm1heChhLnVzZWRCeXRlcyxvK24pLG59LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09cj9uKz1lLnBvc2l0aW9uOjI9PT1yJiZUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiYobis9ZS5ub2RlLnVzZWRCeXRlcyksbjwwKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7cmV0dXJuIG59LGFsbG9jYXRlOmZ1bmN0aW9uKGUsdCxyKXt3ZS5leHBhbmRGaWxlU3RvcmFnZShlLm5vZGUsdCtyKSxlLm5vZGUudXNlZEJ5dGVzPU1hdGgubWF4KGUubm9kZS51c2VkQnl0ZXMsdCtyKX0sbW1hcDpmdW5jdGlvbihlLHQscixuLG8saSxhKXtpZighVGUuaXNGaWxlKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9ERVYpO3ZhciBzLHUsYz1lLm5vZGUuY29udGVudHM7aWYoMiZhfHxjLmJ1ZmZlciE9PXQmJmMuYnVmZmVyIT09dC5idWZmZXIpe2lmKChvPjB8fG8rbjxlLm5vZGUudXNlZEJ5dGVzKSYmKGM9Yy5zdWJhcnJheT9jLnN1YmFycmF5KG8sbytuKTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjLG8sbytuKSksdT0hMCwhKHM9SnQobikpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT01FTSk7dC5zZXQoYyxzKX1lbHNlIHU9ITEscz1jLmJ5dGVPZmZzZXQ7cmV0dXJue3B0cjpzLGFsbG9jYXRlZDp1fX0sbXN5bmM6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighVGUuaXNGaWxlKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9ERVYpO2lmKDImbylyZXR1cm4gMDt3ZS5zdHJlYW1fb3BzLndyaXRlKGUsdCwwLG4sciwhMSk7cmV0dXJuIDB9fX0sX2U9e2Riczp7fSxpbmRleGVkREI6ZnVuY3Rpb24oKXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIGluZGV4ZWREQilyZXR1cm4gaW5kZXhlZERCO3ZhciBlPW51bGw7cmV0dXJuIm9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJihlPXdpbmRvdy5pbmRleGVkREJ8fHdpbmRvdy5tb3pJbmRleGVkREJ8fHdpbmRvdy53ZWJraXRJbmRleGVkREJ8fHdpbmRvdy5tc0luZGV4ZWREQikseShlLCJJREJGUyB1c2VkLCBidXQgaW5kZXhlZERCIG5vdCBzdXBwb3J0ZWQiKSxlfSxEQl9WRVJTSU9OOjIxLERCX1NUT1JFX05BTUU6IkZJTEVfREFUQSIsbW91bnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHdlLm1vdW50LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sc3luY2ZzOmZ1bmN0aW9uKGUsdCxyKXtfZS5nZXRMb2NhbFNldChlLChmdW5jdGlvbihuLG8pe2lmKG4pcmV0dXJuIHIobik7X2UuZ2V0UmVtb3RlU2V0KGUsKGZ1bmN0aW9uKGUsbil7aWYoZSlyZXR1cm4gcihlKTt2YXIgaT10P246byxhPXQ/bzpuO19lLnJlY29uY2lsZShpLGEscil9KSl9KSl9LGdldERCOmZ1bmN0aW9uKGUsdCl7dmFyIHIsbj1fZS5kYnNbZV07aWYobilyZXR1cm4gdChudWxsLG4pO3RyeXtyPV9lLmluZGV4ZWREQigpLm9wZW4oZSxfZS5EQl9WRVJTSU9OKX1jYXRjaChlKXtyZXR1cm4gdChlKX1pZighcilyZXR1cm4gdCgiVW5hYmxlIHRvIGNvbm5lY3QgdG8gSW5kZXhlZERCIik7ci5vbnVwZ3JhZGVuZWVkZWQ9ZnVuY3Rpb24oZSl7dmFyIHQscj1lLnRhcmdldC5yZXN1bHQsbj1lLnRhcmdldC50cmFuc2FjdGlvbjsodD1yLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoX2UuREJfU1RPUkVfTkFNRSk/bi5vYmplY3RTdG9yZShfZS5EQl9TVE9SRV9OQU1FKTpyLmNyZWF0ZU9iamVjdFN0b3JlKF9lLkRCX1NUT1JFX05BTUUpKS5pbmRleE5hbWVzLmNvbnRhaW5zKCJ0aW1lc3RhbXAiKXx8dC5jcmVhdGVJbmRleCgidGltZXN0YW1wIiwidGltZXN0YW1wIix7dW5pcXVlOiExfSl9LHIub25zdWNjZXNzPWZ1bmN0aW9uKCl7bj1yLnJlc3VsdCxfZS5kYnNbZV09bix0KG51bGwsbil9LHIub25lcnJvcj1mdW5jdGlvbihlKXt0KHRoaXMuZXJyb3IpLGUucHJldmVudERlZmF1bHQoKX19LGdldExvY2FsU2V0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9e307ZnVuY3Rpb24gbihlKXtyZXR1cm4iLiIhPT1lJiYiLi4iIT09ZX1mdW5jdGlvbiBvKGUpe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gZ2Uuam9pbjIoZSx0KX19Zm9yKHZhciBpPVRlLnJlYWRkaXIoZS5tb3VudHBvaW50KS5maWx0ZXIobikubWFwKG8oZS5tb3VudHBvaW50KSk7aS5sZW5ndGg7KXt2YXIgYSxzPWkucG9wKCk7dHJ5e2E9VGUuc3RhdChzKX1jYXRjaChlKXtyZXR1cm4gdChlKX1UZS5pc0RpcihhLm1vZGUpJiZpLnB1c2guYXBwbHkoaSxUZS5yZWFkZGlyKHMpLmZpbHRlcihuKS5tYXAobyhzKSkpLHJbc109e3RpbWVzdGFtcDphLm10aW1lfX1yZXR1cm4gdChudWxsLHt0eXBlOiJsb2NhbCIsZW50cmllczpyfSl9LGdldFJlbW90ZVNldDpmdW5jdGlvbihlLHQpe3ZhciByPXt9O19lLmdldERCKGUubW91bnRwb2ludCwoZnVuY3Rpb24oZSxuKXtpZihlKXJldHVybiB0KGUpO3RyeXt2YXIgbz1uLnRyYW5zYWN0aW9uKFtfZS5EQl9TVE9SRV9OQU1FXSwicmVhZG9ubHkiKTtvLm9uZXJyb3I9ZnVuY3Rpb24oZSl7dCh0aGlzLmVycm9yKSxlLnByZXZlbnREZWZhdWx0KCl9LG8ub2JqZWN0U3RvcmUoX2UuREJfU1RPUkVfTkFNRSkuaW5kZXgoInRpbWVzdGFtcCIpLm9wZW5LZXlDdXJzb3IoKS5vbnN1Y2Nlc3M9ZnVuY3Rpb24oZSl7dmFyIG89ZS50YXJnZXQucmVzdWx0O2lmKCFvKXJldHVybiB0KG51bGwse3R5cGU6InJlbW90ZSIsZGI6bixlbnRyaWVzOnJ9KTtyW28ucHJpbWFyeUtleV09e3RpbWVzdGFtcDpvLmtleX0sby5jb250aW51ZSgpfX1jYXRjaChlKXtyZXR1cm4gdChlKX19KSl9LGxvYWRMb2NhbEVudHJ5OmZ1bmN0aW9uKGUsdCl7dmFyIHIsbjt0cnl7bj1UZS5sb29rdXBQYXRoKGUpLm5vZGUscj1UZS5zdGF0KGUpfWNhdGNoKGUpe3JldHVybiB0KGUpfXJldHVybiBUZS5pc0RpcihyLm1vZGUpP3QobnVsbCx7dGltZXN0YW1wOnIubXRpbWUsbW9kZTpyLm1vZGV9KTpUZS5pc0ZpbGUoci5tb2RlKT8obi5jb250ZW50cz13ZS5nZXRGaWxlRGF0YUFzVHlwZWRBcnJheShuKSx0KG51bGwse3RpbWVzdGFtcDpyLm10aW1lLG1vZGU6ci5tb2RlLGNvbnRlbnRzOm4uY29udGVudHN9KSk6dChuZXcgRXJyb3IoIm5vZGUgdHlwZSBub3Qgc3VwcG9ydGVkIikpfSxzdG9yZUxvY2FsRW50cnk6ZnVuY3Rpb24oZSx0LHIpe3RyeXtpZihUZS5pc0Rpcih0Lm1vZGUpKVRlLm1rZGlyKGUsdC5tb2RlKTtlbHNle2lmKCFUZS5pc0ZpbGUodC5tb2RlKSlyZXR1cm4gcihuZXcgRXJyb3IoIm5vZGUgdHlwZSBub3Qgc3VwcG9ydGVkIikpO1RlLndyaXRlRmlsZShlLHQuY29udGVudHMse2Nhbk93bjohMH0pfVRlLmNobW9kKGUsdC5tb2RlKSxUZS51dGltZShlLHQudGltZXN0YW1wLHQudGltZXN0YW1wKX1jYXRjaChlKXtyZXR1cm4gcihlKX1yKG51bGwpfSxyZW1vdmVMb2NhbEVudHJ5OmZ1bmN0aW9uKGUsdCl7dHJ5e1RlLmxvb2t1cFBhdGgoZSk7dmFyIHI9VGUuc3RhdChlKTtUZS5pc0RpcihyLm1vZGUpP1RlLnJtZGlyKGUpOlRlLmlzRmlsZShyLm1vZGUpJiZUZS51bmxpbmsoZSl9Y2F0Y2goZSl7cmV0dXJuIHQoZSl9dChudWxsKX0sbG9hZFJlbW90ZUVudHJ5OmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1lLmdldCh0KTtuLm9uc3VjY2Vzcz1mdW5jdGlvbihlKXtyKG51bGwsZS50YXJnZXQucmVzdWx0KX0sbi5vbmVycm9yPWZ1bmN0aW9uKGUpe3IodGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0sc3RvcmVSZW1vdGVFbnRyeTpmdW5jdGlvbihlLHQscixuKXt2YXIgbz1lLnB1dChyLHQpO28ub25zdWNjZXNzPWZ1bmN0aW9uKCl7bihudWxsKX0sby5vbmVycm9yPWZ1bmN0aW9uKGUpe24odGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0scmVtb3ZlUmVtb3RlRW50cnk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUuZGVsZXRlKHQpO24ub25zdWNjZXNzPWZ1bmN0aW9uKCl7cihudWxsKX0sbi5vbmVycm9yPWZ1bmN0aW9uKGUpe3IodGhpcy5lcnJvciksZS5wcmV2ZW50RGVmYXVsdCgpfX0scmVjb25jaWxlOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj0wLG89W107T2JqZWN0LmtleXMoZS5lbnRyaWVzKS5mb3JFYWNoKChmdW5jdGlvbihyKXt2YXIgaT1lLmVudHJpZXNbcl0sYT10LmVudHJpZXNbcl07KCFhfHxpLnRpbWVzdGFtcD5hLnRpbWVzdGFtcCkmJihvLnB1c2gociksbisrKX0pKTt2YXIgaT1bXTtpZihPYmplY3Qua2V5cyh0LmVudHJpZXMpLmZvckVhY2goKGZ1bmN0aW9uKHIpe3QuZW50cmllc1tyXTtlLmVudHJpZXNbcl18fChpLnB1c2gociksbisrKX0pKSwhbilyZXR1cm4gcihudWxsKTt2YXIgYT0wLHM9KCJyZW1vdGUiPT09ZS50eXBlP2UuZGI6dC5kYikudHJhbnNhY3Rpb24oW19lLkRCX1NUT1JFX05BTUVdLCJyZWFkd3JpdGUiKSx1PXMub2JqZWN0U3RvcmUoX2UuREJfU1RPUkVfTkFNRSk7ZnVuY3Rpb24gYyhlKXtyZXR1cm4gZT9jLmVycm9yZWQ/dm9pZCAwOihjLmVycm9yZWQ9ITAscihlKSk6KythPj1uP3IobnVsbCk6dm9pZCAwfXMub25lcnJvcj1mdW5jdGlvbihlKXtjKHRoaXMuZXJyb3IpLGUucHJldmVudERlZmF1bHQoKX0sby5zb3J0KCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ImxvY2FsIj09PXQudHlwZT9fZS5sb2FkUmVtb3RlRW50cnkodSxlLChmdW5jdGlvbih0LHIpe2lmKHQpcmV0dXJuIGModCk7X2Uuc3RvcmVMb2NhbEVudHJ5KGUscixjKX0pKTpfZS5sb2FkTG9jYWxFbnRyeShlLChmdW5jdGlvbih0LHIpe2lmKHQpcmV0dXJuIGModCk7X2Uuc3RvcmVSZW1vdGVFbnRyeSh1LGUscixjKX0pKX0pKSxpLnNvcnQoKS5yZXZlcnNlKCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ImxvY2FsIj09PXQudHlwZT9fZS5yZW1vdmVMb2NhbEVudHJ5KGUsYyk6X2UucmVtb3ZlUmVtb3RlRW50cnkodSxlLGMpfSkpfX0sYmU9e2lzV2luZG93czohMSxzdGF0aWNJbml0OmZ1bmN0aW9uKCl7YmUuaXNXaW5kb3dzPSEhcHJvY2Vzcy5wbGF0Zm9ybS5tYXRjaCgvXndpbi8pO3ZhciBlPXByb2Nlc3MuYmluZGluZygiY29uc3RhbnRzIik7ZS5mcyYmKGU9ZS5mcyksYmUuZmxhZ3NGb3JOb2RlTWFwPXsxMDI0OmUuT19BUFBFTkQsNjQ6ZS5PX0NSRUFULDEyODplLk9fRVhDTCwwOmUuT19SRE9OTFksMjplLk9fUkRXUiw0MDk2OmUuT19TWU5DLDUxMjplLk9fVFJVTkMsMTplLk9fV1JPTkxZfX0sYnVmZmVyRnJvbTpmdW5jdGlvbihlKXtyZXR1cm4gQnVmZmVyLmFsbG9jP0J1ZmZlci5mcm9tKGUpOm5ldyBCdWZmZXIoZSl9LG1vdW50OmZ1bmN0aW9uKGUpe3JldHVybiB5KGwpLGJlLmNyZWF0ZU5vZGUobnVsbCwiLyIsYmUuZ2V0TW9kZShlLm9wdHMucm9vdCksMCl9LGNyZWF0ZU5vZGU6ZnVuY3Rpb24oZSx0LHIsbil7aWYoIVRlLmlzRGlyKHIpJiYhVGUuaXNGaWxlKHIpJiYhVGUuaXNMaW5rKHIpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIG89VGUuY3JlYXRlTm9kZShlLHQscik7cmV0dXJuIG8ubm9kZV9vcHM9YmUubm9kZV9vcHMsby5zdHJlYW1fb3BzPWJlLnN0cmVhbV9vcHMsb30sZ2V0TW9kZTpmdW5jdGlvbihlKXt2YXIgdDt0cnl7dD1mcy5sc3RhdFN5bmMoZSksYmUuaXNXaW5kb3dzJiYodC5tb2RlPXQubW9kZXwoMjkyJnQubW9kZSk+PjIpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX1yZXR1cm4gdC5tb2RlfSxyZWFsUGF0aDpmdW5jdGlvbihlKXtmb3IodmFyIHQ9W107ZS5wYXJlbnQhPT1lOyl0LnB1c2goZS5uYW1lKSxlPWUucGFyZW50O3JldHVybiB0LnB1c2goZS5tb3VudC5vcHRzLnJvb3QpLHQucmV2ZXJzZSgpLGdlLmpvaW4uYXBwbHkobnVsbCx0KX0sZmxhZ3NGb3JOb2RlOmZ1bmN0aW9uKGUpe2UmPS0yMDk3MTUzLGUmPS0yMDQ5LGUmPS0zMjc2OSxlJj0tNTI0Mjg5O3ZhciB0PTA7Zm9yKHZhciByIGluIGJlLmZsYWdzRm9yTm9kZU1hcCllJnImJih0fD1iZS5mbGFnc0Zvck5vZGVNYXBbcl0sZV49cik7aWYoZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiB0fSxub2RlX29wczp7Z2V0YXR0cjpmdW5jdGlvbihlKXt2YXIgdCxyPWJlLnJlYWxQYXRoKGUpO3RyeXt0PWZzLmxzdGF0U3luYyhyKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9cmV0dXJuIGJlLmlzV2luZG93cyYmIXQuYmxrc2l6ZSYmKHQuYmxrc2l6ZT00MDk2KSxiZS5pc1dpbmRvd3MmJiF0LmJsb2NrcyYmKHQuYmxvY2tzPSh0LnNpemUrdC5ibGtzaXplLTEpL3QuYmxrc2l6ZXwwKSx7ZGV2OnQuZGV2LGlubzp0Lmlubyxtb2RlOnQubW9kZSxubGluazp0Lm5saW5rLHVpZDp0LnVpZCxnaWQ6dC5naWQscmRldjp0LnJkZXYsc2l6ZTp0LnNpemUsYXRpbWU6dC5hdGltZSxtdGltZTp0Lm10aW1lLGN0aW1lOnQuY3RpbWUsYmxrc2l6ZTp0LmJsa3NpemUsYmxvY2tzOnQuYmxvY2tzfX0sc2V0YXR0cjpmdW5jdGlvbihlLHQpe3ZhciByPWJlLnJlYWxQYXRoKGUpO3RyeXtpZih2b2lkIDAhPT10Lm1vZGUmJihmcy5jaG1vZFN5bmMocix0Lm1vZGUpLGUubW9kZT10Lm1vZGUpLHZvaWQgMCE9PXQudGltZXN0YW1wKXt2YXIgbj1uZXcgRGF0ZSh0LnRpbWVzdGFtcCk7ZnMudXRpbWVzU3luYyhyLG4sbil9dm9pZCAwIT09dC5zaXplJiZmcy50cnVuY2F0ZVN5bmMocix0LnNpemUpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGxvb2t1cDpmdW5jdGlvbihlLHQpe3ZhciByPWdlLmpvaW4yKGJlLnJlYWxQYXRoKGUpLHQpLG49YmUuZ2V0TW9kZShyKTtyZXR1cm4gYmUuY3JlYXRlTm9kZShlLHQsbil9LG1rbm9kOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWJlLmNyZWF0ZU5vZGUoZSx0LHIsbiksaT1iZS5yZWFsUGF0aChvKTt0cnl7VGUuaXNEaXIoby5tb2RlKT9mcy5ta2RpclN5bmMoaSxvLm1vZGUpOmZzLndyaXRlRmlsZVN5bmMoaSwiIix7bW9kZTpvLm1vZGV9KX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9cmV0dXJuIG99LHJlbmFtZTpmdW5jdGlvbihlLHQscil7dmFyIG49YmUucmVhbFBhdGgoZSksbz1nZS5qb2luMihiZS5yZWFsUGF0aCh0KSxyKTt0cnl7ZnMucmVuYW1lU3luYyhuLG8pfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LHVubGluazpmdW5jdGlvbihlLHQpe3ZhciByPWdlLmpvaW4yKGJlLnJlYWxQYXRoKGUpLHQpO3RyeXtmcy51bmxpbmtTeW5jKHIpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LHJtZGlyOmZ1bmN0aW9uKGUsdCl7dmFyIHI9Z2Uuam9pbjIoYmUucmVhbFBhdGgoZSksdCk7dHJ5e2ZzLnJtZGlyU3luYyhyKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSxyZWFkZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PWJlLnJlYWxQYXRoKGUpO3RyeXtyZXR1cm4gZnMucmVhZGRpclN5bmModCl9Y2F0Y2goZSl7aWYoIWUuY29kZSl0aHJvdyBlO3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lW2UuY29kZV0pfX0sc3ltbGluazpmdW5jdGlvbihlLHQscil7dmFyIG49Z2Uuam9pbjIoYmUucmVhbFBhdGgoZSksdCk7dHJ5e2ZzLnN5bWxpbmtTeW5jKHIsbil9Y2F0Y2goZSl7aWYoIWUuY29kZSl0aHJvdyBlO3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lW2UuY29kZV0pfX0scmVhZGxpbms6ZnVuY3Rpb24oZSl7dmFyIHQ9YmUucmVhbFBhdGgoZSk7dHJ5e3JldHVybiB0PWZzLnJlYWRsaW5rU3luYyh0KSx0PU5PREVKU19QQVRILnJlbGF0aXZlKE5PREVKU19QQVRILnJlc29sdmUoZS5tb3VudC5vcHRzLnJvb3QpLHQpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19fSxzdHJlYW1fb3BzOntvcGVuOmZ1bmN0aW9uKGUpe3ZhciB0PWJlLnJlYWxQYXRoKGUubm9kZSk7dHJ5e1RlLmlzRmlsZShlLm5vZGUubW9kZSkmJihlLm5mZD1mcy5vcGVuU3luYyh0LGJlLmZsYWdzRm9yTm9kZShlLmZsYWdzKSkpfWNhdGNoKGUpe2lmKCFlLmNvZGUpdGhyb3cgZTt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGNsb3NlOmZ1bmN0aW9uKGUpe3RyeXtUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiZlLm5mZCYmZnMuY2xvc2VTeW5jKGUubmZkKX1jYXRjaChlKXtpZighZS5jb2RlKXRocm93IGU7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSxyZWFkOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoMD09PW4pcmV0dXJuIDA7dHJ5e3JldHVybiBmcy5yZWFkU3luYyhlLm5mZCxiZS5idWZmZXJGcm9tKHQuYnVmZmVyKSxyLG4sbyl9Y2F0Y2goZSl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWVbZS5jb2RlXSl9fSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8pe3RyeXtyZXR1cm4gZnMud3JpdGVTeW5jKGUubmZkLGJlLmJ1ZmZlckZyb20odC5idWZmZXIpLHIsbixvKX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX19LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09ciluKz1lLnBvc2l0aW9uO2Vsc2UgaWYoMj09PXImJlRlLmlzRmlsZShlLm5vZGUubW9kZSkpdHJ5e24rPWZzLmZzdGF0U3luYyhlLm5mZCkuc2l6ZX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZVtlLmNvZGVdKX1pZihuPDApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtyZXR1cm4gbn19fSxBZT17RElSX01PREU6MTY4OTUsRklMRV9NT0RFOjMzMjc5LHJlYWRlcjpudWxsLG1vdW50OmZ1bmN0aW9uKGUpe3koYyksQWUucmVhZGVyfHwoQWUucmVhZGVyPW5ldyBGaWxlUmVhZGVyU3luYyk7dmFyIHQ9QWUuY3JlYXRlTm9kZShudWxsLCIvIixBZS5ESVJfTU9ERSwwKSxyPXt9O2Z1bmN0aW9uIG4oZSl7Zm9yKHZhciBuPWUuc3BsaXQoIi8iKSxvPXQsaT0wO2k8bi5sZW5ndGgtMTtpKyspe3ZhciBhPW4uc2xpY2UoMCxpKzEpLmpvaW4oIi8iKTtyW2FdfHwoclthXT1BZS5jcmVhdGVOb2RlKG8sbltpXSxBZS5ESVJfTU9ERSwwKSksbz1yW2FdfXJldHVybiBvfWZ1bmN0aW9uIG8oZSl7dmFyIHQ9ZS5zcGxpdCgiLyIpO3JldHVybiB0W3QubGVuZ3RoLTFdfXJldHVybiBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGUub3B0cy5maWxlc3x8W10sKGZ1bmN0aW9uKGUpe0FlLmNyZWF0ZU5vZGUobihlLm5hbWUpLG8oZS5uYW1lKSxBZS5GSUxFX01PREUsMCxlLGUubGFzdE1vZGlmaWVkRGF0ZSl9KSksKGUub3B0cy5ibG9ic3x8W10pLmZvckVhY2goKGZ1bmN0aW9uKGUpe0FlLmNyZWF0ZU5vZGUobihlLm5hbWUpLG8oZS5uYW1lKSxBZS5GSUxFX01PREUsMCxlLmRhdGEpfSkpLChlLm9wdHMucGFja2FnZXN8fFtdKS5mb3JFYWNoKChmdW5jdGlvbihlKXtlLm1ldGFkYXRhLmZpbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciByPXQuZmlsZW5hbWUuc3Vic3RyKDEpO0FlLmNyZWF0ZU5vZGUobihyKSxvKHIpLEFlLkZJTEVfTU9ERSwwLGUuYmxvYi5zbGljZSh0LnN0YXJ0LHQuZW5kKSl9KSl9KSksdH0sY3JlYXRlTm9kZTpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9VGUuY3JlYXRlTm9kZShlLHQscik7cmV0dXJuIGEubW9kZT1yLGEubm9kZV9vcHM9QWUubm9kZV9vcHMsYS5zdHJlYW1fb3BzPUFlLnN0cmVhbV9vcHMsYS50aW1lc3RhbXA9KGl8fG5ldyBEYXRlKS5nZXRUaW1lKCkseShBZS5GSUxFX01PREUhPT1BZS5ESVJfTU9ERSkscj09PUFlLkZJTEVfTU9ERT8oYS5zaXplPW8uc2l6ZSxhLmNvbnRlbnRzPW8pOihhLnNpemU9NDA5NixhLmNvbnRlbnRzPXt9KSxlJiYoZS5jb250ZW50c1t0XT1hKSxhfSxub2RlX29wczp7Z2V0YXR0cjpmdW5jdGlvbihlKXtyZXR1cm57ZGV2OjEsaW5vOnZvaWQgMCxtb2RlOmUubW9kZSxubGluazoxLHVpZDowLGdpZDowLHJkZXY6dm9pZCAwLHNpemU6ZS5zaXplLGF0aW1lOm5ldyBEYXRlKGUudGltZXN0YW1wKSxtdGltZTpuZXcgRGF0ZShlLnRpbWVzdGFtcCksY3RpbWU6bmV3IERhdGUoZS50aW1lc3RhbXApLGJsa3NpemU6NDA5NixibG9ja3M6TWF0aC5jZWlsKGUuc2l6ZS80MDk2KX19LHNldGF0dHI6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT10Lm1vZGUmJihlLm1vZGU9dC5tb2RlKSx2b2lkIDAhPT10LnRpbWVzdGFtcCYmKGUudGltZXN0YW1wPXQudGltZXN0YW1wKX0sbG9va3VwOmZ1bmN0aW9uKGUsdCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKX0sbWtub2Q6ZnVuY3Rpb24oZSx0LHIsbil7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxyZW5hbWU6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKX0sdW5saW5rOmZ1bmN0aW9uKGUsdCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxybWRpcjpmdW5jdGlvbihlLHQpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKX0scmVhZGRpcjpmdW5jdGlvbihlKXt2YXIgdD1bIi4iLCIuLiJdO2Zvcih2YXIgciBpbiBlLmNvbnRlbnRzKWUuY29udGVudHMuaGFzT3duUHJvcGVydHkocikmJnQucHVzaChyKTtyZXR1cm4gdH0sc3ltbGluazpmdW5jdGlvbihlLHQscil7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pfSxyZWFkbGluazpmdW5jdGlvbihlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSl9fSxzdHJlYW1fb3BzOntyZWFkOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYobz49ZS5ub2RlLnNpemUpcmV0dXJuIDA7dmFyIGk9ZS5ub2RlLmNvbnRlbnRzLnNsaWNlKG8sbytuKSxhPUFlLnJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihpKTtyZXR1cm4gdC5zZXQobmV3IFVpbnQ4QXJyYXkoYSksciksaS5zaXplfSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8pe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTyl9LGxsc2VlazpmdW5jdGlvbihlLHQscil7dmFyIG49dDtpZigxPT09cj9uKz1lLnBvc2l0aW9uOjI9PT1yJiZUZS5pc0ZpbGUoZS5ub2RlLm1vZGUpJiYobis9ZS5ub2RlLnNpemUpLG48MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiBufX19O0wrPTE2LEwrPTE2O3ZhciBUZT17cm9vdDpudWxsLG1vdW50czpbXSxkZXZpY2VzOnt9LHN0cmVhbXM6W10sbmV4dElub2RlOjEsbmFtZVRhYmxlOm51bGwsY3VycmVudFBhdGg6Ii8iLGluaXRpYWxpemVkOiExLGlnbm9yZVBlcm1pc3Npb25zOiEwLHRyYWNraW5nRGVsZWdhdGU6e30sdHJhY2tpbmc6e29wZW5GbGFnczp7UkVBRDoxLFdSSVRFOjJ9fSxFcnJub0Vycm9yOm51bGwsZ2VuZXJpY0Vycm9yczp7fSxmaWxlc3lzdGVtczpudWxsLHN5bmNGU1JlcXVlc3RzOjAsaGFuZGxlRlNFcnJvcjpmdW5jdGlvbihlKXtpZighKGUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yKSl0aHJvdyBlKyIgOiAiK1AoKTtyZXR1cm4geWUoZS5lcnJubyl9LGxvb2t1cFBhdGg6ZnVuY3Rpb24oZSx0KXtpZih0PXR8fHt9LCEoZT1nZS5yZXNvbHZlKFRlLmN3ZCgpLGUpKSlyZXR1cm57cGF0aDoiIixub2RlOm51bGx9O3ZhciByPXtmb2xsb3dfbW91bnQ6ITAscmVjdXJzZV9jb3VudDowfTtmb3IodmFyIG4gaW4gcil2b2lkIDA9PT10W25dJiYodFtuXT1yW25dKTtpZih0LnJlY3Vyc2VfY291bnQ+OCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTE9PUCk7Zm9yKHZhciBvPWdlLm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiEhZX0pKSwhMSksaT1UZS5yb290LGE9Ii8iLHM9MDtzPG8ubGVuZ3RoO3MrKyl7dmFyIHU9cz09PW8ubGVuZ3RoLTE7aWYodSYmdC5wYXJlbnQpYnJlYWs7aWYoaT1UZS5sb29rdXBOb2RlKGksb1tzXSksYT1nZS5qb2luMihhLG9bc10pLFRlLmlzTW91bnRwb2ludChpKSYmKCF1fHx1JiZ0LmZvbGxvd19tb3VudCkmJihpPWkubW91bnRlZC5yb290KSwhdXx8dC5mb2xsb3cpZm9yKHZhciBjPTA7VGUuaXNMaW5rKGkubW9kZSk7KXt2YXIgbD1UZS5yZWFkbGluayhhKTtpZihhPWdlLnJlc29sdmUoZ2UuZGlybmFtZShhKSxsKSxpPVRlLmxvb2t1cFBhdGgoYSx7cmVjdXJzZV9jb3VudDp0LnJlY3Vyc2VfY291bnR9KS5ub2RlLGMrKz40MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTE9PUCl9fXJldHVybntwYXRoOmEsbm9kZTppfX0sZ2V0UGF0aDpmdW5jdGlvbihlKXtmb3IodmFyIHQ7Oyl7aWYoVGUuaXNSb290KGUpKXt2YXIgcj1lLm1vdW50Lm1vdW50cG9pbnQ7cmV0dXJuIHQ/Ii8iIT09cltyLmxlbmd0aC0xXT9yKyIvIit0OnIrdDpyfXQ9dD9lLm5hbWUrIi8iK3Q6ZS5uYW1lLGU9ZS5wYXJlbnR9fSxoYXNoTmFtZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcj0wLG49MDtuPHQubGVuZ3RoO24rKylyPShyPDw1KS1yK3QuY2hhckNvZGVBdChuKXwwO3JldHVybihlK3I+Pj4wKSVUZS5uYW1lVGFibGUubGVuZ3RofSxoYXNoQWRkTm9kZTpmdW5jdGlvbihlKXt2YXIgdD1UZS5oYXNoTmFtZShlLnBhcmVudC5pZCxlLm5hbWUpO2UubmFtZV9uZXh0PVRlLm5hbWVUYWJsZVt0XSxUZS5uYW1lVGFibGVbdF09ZX0saGFzaFJlbW92ZU5vZGU6ZnVuY3Rpb24oZSl7dmFyIHQ9VGUuaGFzaE5hbWUoZS5wYXJlbnQuaWQsZS5uYW1lKTtpZihUZS5uYW1lVGFibGVbdF09PT1lKVRlLm5hbWVUYWJsZVt0XT1lLm5hbWVfbmV4dDtlbHNlIGZvcih2YXIgcj1UZS5uYW1lVGFibGVbdF07cjspe2lmKHIubmFtZV9uZXh0PT09ZSl7ci5uYW1lX25leHQ9ZS5uYW1lX25leHQ7YnJlYWt9cj1yLm5hbWVfbmV4dH19LGxvb2t1cE5vZGU6ZnVuY3Rpb24oZSx0KXt2YXIgcj1UZS5tYXlMb29rdXAoZSk7aWYocil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihyLGUpO2Zvcih2YXIgbj1UZS5oYXNoTmFtZShlLmlkLHQpLG89VGUubmFtZVRhYmxlW25dO287bz1vLm5hbWVfbmV4dCl7dmFyIGk9by5uYW1lO2lmKG8ucGFyZW50LmlkPT09ZS5pZCYmaT09PXQpcmV0dXJuIG99cmV0dXJuIFRlLmxvb2t1cChlLHQpfSxjcmVhdGVOb2RlOmZ1bmN0aW9uKGUsdCxyLG4pe2lmKCFUZS5GU05vZGUpe1RlLkZTTm9kZT1mdW5jdGlvbihlLHQscixuKXtlfHwoZT10aGlzKSx0aGlzLnBhcmVudD1lLHRoaXMubW91bnQ9ZS5tb3VudCx0aGlzLm1vdW50ZWQ9bnVsbCx0aGlzLmlkPVRlLm5leHRJbm9kZSsrLHRoaXMubmFtZT10LHRoaXMubW9kZT1yLHRoaXMubm9kZV9vcHM9e30sdGhpcy5zdHJlYW1fb3BzPXt9LHRoaXMucmRldj1ufSxUZS5GU05vZGUucHJvdG90eXBlPXt9O09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKFRlLkZTTm9kZS5wcm90b3R5cGUse3JlYWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiAzNjU9PSgzNjUmdGhpcy5tb2RlKX0sc2V0OmZ1bmN0aW9uKGUpe2U/dGhpcy5tb2RlfD0zNjU6dGhpcy5tb2RlJj0tMzY2fX0sd3JpdGU6e2dldDpmdW5jdGlvbigpe3JldHVybiAxNDY9PSgxNDYmdGhpcy5tb2RlKX0sc2V0OmZ1bmN0aW9uKGUpe2U/dGhpcy5tb2RlfD0xNDY6dGhpcy5tb2RlJj0tMTQ3fX0saXNGb2xkZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBUZS5pc0Rpcih0aGlzLm1vZGUpfX0saXNEZXZpY2U6e2dldDpmdW5jdGlvbigpe3JldHVybiBUZS5pc0NocmRldih0aGlzLm1vZGUpfX19KX12YXIgbz1uZXcgVGUuRlNOb2RlKGUsdCxyLG4pO3JldHVybiBUZS5oYXNoQWRkTm9kZShvKSxvfSxkZXN0cm95Tm9kZTpmdW5jdGlvbihlKXtUZS5oYXNoUmVtb3ZlTm9kZShlKX0saXNSb290OmZ1bmN0aW9uKGUpe3JldHVybiBlPT09ZS5wYXJlbnR9LGlzTW91bnRwb2ludDpmdW5jdGlvbihlKXtyZXR1cm4hIWUubW91bnRlZH0saXNGaWxlOmZ1bmN0aW9uKGUpe3JldHVybiAzMjc2OD09KDYxNDQwJmUpfSxpc0RpcjpmdW5jdGlvbihlKXtyZXR1cm4gMTYzODQ9PSg2MTQ0MCZlKX0saXNMaW5rOmZ1bmN0aW9uKGUpe3JldHVybiA0MDk2MD09KDYxNDQwJmUpfSxpc0NocmRldjpmdW5jdGlvbihlKXtyZXR1cm4gODE5Mj09KDYxNDQwJmUpfSxpc0Jsa2RldjpmdW5jdGlvbihlKXtyZXR1cm4gMjQ1NzY9PSg2MTQ0MCZlKX0saXNGSUZPOmZ1bmN0aW9uKGUpe3JldHVybiA0MDk2PT0oNjE0NDAmZSl9LGlzU29ja2V0OmZ1bmN0aW9uKGUpe3JldHVybiA0OTE1Mj09KDQ5MTUyJmUpfSxmbGFnTW9kZXM6e3I6MCxyczoxMDUyNjcyLCJyKyI6Mix3OjU3Nyx3eDo3MDUseHc6NzA1LCJ3KyI6NTc4LCJ3eCsiOjcwNiwieHcrIjo3MDYsYToxMDg5LGF4OjEyMTcseGE6MTIxNywiYSsiOjEwOTAsImF4KyI6MTIxOCwieGErIjoxMjE4fSxtb2RlU3RyaW5nVG9GbGFnczpmdW5jdGlvbihlKXt2YXIgdD1UZS5mbGFnTW9kZXNbZV07aWYodm9pZCAwPT09dCl0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gZmlsZSBvcGVuIG1vZGU6ICIrZSk7cmV0dXJuIHR9LGZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nOmZ1bmN0aW9uKGUpe3ZhciB0PVsiciIsInciLCJydyJdWzMmZV07cmV0dXJuIDUxMiZlJiYodCs9InciKSx0fSxub2RlUGVybWlzc2lvbnM6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gVGUuaWdub3JlUGVybWlzc2lvbnN8fCgtMT09PXQuaW5kZXhPZigiciIpfHwyOTImZS5tb2RlKSYmKC0xPT09dC5pbmRleE9mKCJ3Iil8fDE0NiZlLm1vZGUpJiYoLTE9PT10LmluZGV4T2YoIngiKXx8NzMmZS5tb2RlKT8wOm1lLkVBQ0NFU30sbWF5TG9va3VwOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLm5vZGVQZXJtaXNzaW9ucyhlLCJ4Iik7cmV0dXJuIHR8fChlLm5vZGVfb3BzLmxvb2t1cD8wOm1lLkVBQ0NFUyl9LG1heUNyZWF0ZTpmdW5jdGlvbihlLHQpe3RyeXtUZS5sb29rdXBOb2RlKGUsdCk7cmV0dXJuIG1lLkVFWElTVH1jYXRjaChlKXt9cmV0dXJuIFRlLm5vZGVQZXJtaXNzaW9ucyhlLCJ3eCIpfSxtYXlEZWxldGU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuO3RyeXtuPVRlLmxvb2t1cE5vZGUoZSx0KX1jYXRjaChlKXtyZXR1cm4gZS5lcnJub312YXIgbz1UZS5ub2RlUGVybWlzc2lvbnMoZSwid3giKTtpZihvKXJldHVybiBvO2lmKHIpe2lmKCFUZS5pc0RpcihuLm1vZGUpKXJldHVybiBtZS5FTk9URElSO2lmKFRlLmlzUm9vdChuKXx8VGUuZ2V0UGF0aChuKT09PVRlLmN3ZCgpKXJldHVybiBtZS5FQlVTWX1lbHNlIGlmKFRlLmlzRGlyKG4ubW9kZSkpcmV0dXJuIG1lLkVJU0RJUjtyZXR1cm4gMH0sbWF5T3BlbjpmdW5jdGlvbihlLHQpe3JldHVybiBlP1RlLmlzTGluayhlLm1vZGUpP21lLkVMT09QOlRlLmlzRGlyKGUubW9kZSkmJigiciIhPT1UZS5mbGFnc1RvUGVybWlzc2lvblN0cmluZyh0KXx8NTEyJnQpP21lLkVJU0RJUjpUZS5ub2RlUGVybWlzc2lvbnMoZSxUZS5mbGFnc1RvUGVybWlzc2lvblN0cmluZyh0KSk6bWUuRU5PRU5UfSxNQVhfT1BFTl9GRFM6NDA5NixuZXh0ZmQ6ZnVuY3Rpb24oZSx0KXtlPWV8fDAsdD10fHxUZS5NQVhfT1BFTl9GRFM7Zm9yKHZhciByPWU7cjw9dDtyKyspaWYoIVRlLnN0cmVhbXNbcl0pcmV0dXJuIHI7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU1GSUxFKX0sZ2V0U3RyZWFtOmZ1bmN0aW9uKGUpe3JldHVybiBUZS5zdHJlYW1zW2VdfSxjcmVhdGVTdHJlYW06ZnVuY3Rpb24oZSx0LHIpe1RlLkZTU3RyZWFtfHwoVGUuRlNTdHJlYW09ZnVuY3Rpb24oKXt9LFRlLkZTU3RyZWFtLnByb3RvdHlwZT17fSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyhUZS5GU1N0cmVhbS5wcm90b3R5cGUse29iamVjdDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubm9kZX0sc2V0OmZ1bmN0aW9uKGUpe3RoaXMubm9kZT1lfX0saXNSZWFkOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMSE9KDIwOTcxNTUmdGhpcy5mbGFncyl9fSxpc1dyaXRlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMCE9KDIwOTcxNTUmdGhpcy5mbGFncyl9fSxpc0FwcGVuZDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDEwMjQmdGhpcy5mbGFnc319fSkpO3ZhciBuPW5ldyBUZS5GU1N0cmVhbTtmb3IodmFyIG8gaW4gZSluW29dPWVbb107ZT1uO3ZhciBpPVRlLm5leHRmZCh0LHIpO3JldHVybiBlLmZkPWksVGUuc3RyZWFtc1tpXT1lLGV9LGNsb3NlU3RyZWFtOmZ1bmN0aW9uKGUpe1RlLnN0cmVhbXNbZV09bnVsbH0sY2hyZGV2X3N0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oZSl7dmFyIHQ9VGUuZ2V0RGV2aWNlKGUubm9kZS5yZGV2KTtlLnN0cmVhbV9vcHM9dC5zdHJlYW1fb3BzLGUuc3RyZWFtX29wcy5vcGVuJiZlLnN0cmVhbV9vcHMub3BlbihlKX0sbGxzZWVrOmZ1bmN0aW9uKCl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVNQSVBFKX19LG1ham9yOmZ1bmN0aW9uKGUpe3JldHVybiBlPj44fSxtaW5vcjpmdW5jdGlvbihlKXtyZXR1cm4gMjU1JmV9LG1ha2VkZXY6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZTw8OHx0fSxyZWdpc3RlckRldmljZTpmdW5jdGlvbihlLHQpe1RlLmRldmljZXNbZV09e3N0cmVhbV9vcHM6dH19LGdldERldmljZTpmdW5jdGlvbihlKXtyZXR1cm4gVGUuZGV2aWNlc1tlXX0sZ2V0TW91bnRzOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxyPVtlXTtyLmxlbmd0aDspe3ZhciBuPXIucG9wKCk7dC5wdXNoKG4pLHIucHVzaC5hcHBseShyLG4ubW91bnRzKX1yZXR1cm4gdH0sc3luY2ZzOmZ1bmN0aW9uKGUsdCl7ImZ1bmN0aW9uIj09dHlwZW9mIGUmJih0PWUsZT0hMSksVGUuc3luY0ZTUmVxdWVzdHMrKyxUZS5zeW5jRlNSZXF1ZXN0cz4xJiZjb25zb2xlLmxvZygid2FybmluZzogIitUZS5zeW5jRlNSZXF1ZXN0cysiIEZTLnN5bmNmcyBvcGVyYXRpb25zIGluIGZsaWdodCBhdCBvbmNlLCBwcm9iYWJseSBqdXN0IGRvaW5nIGV4dHJhIHdvcmsiKTt2YXIgcj1UZS5nZXRNb3VudHMoVGUucm9vdC5tb3VudCksbj0wO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIHkoVGUuc3luY0ZTUmVxdWVzdHM+MCksVGUuc3luY0ZTUmVxdWVzdHMtLSx0KGUpfWZ1bmN0aW9uIGkoZSl7aWYoZSlyZXR1cm4gaS5lcnJvcmVkP3ZvaWQgMDooaS5lcnJvcmVkPSEwLG8oZSkpOysrbj49ci5sZW5ndGgmJm8obnVsbCl9ci5mb3JFYWNoKChmdW5jdGlvbih0KXtpZighdC50eXBlLnN5bmNmcylyZXR1cm4gaShudWxsKTt0LnR5cGUuc3luY2ZzKHQsZSxpKX0pKX0sbW91bnQ6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuLG89Ii8iPT09cixpPSFyO2lmKG8mJlRlLnJvb3QpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO2lmKCFvJiYhaSl7dmFyIGE9VGUubG9va3VwUGF0aChyLHtmb2xsb3dfbW91bnQ6ITF9KTtpZihyPWEucGF0aCxuPWEubm9kZSxUZS5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO2lmKCFUZS5pc0RpcihuLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RESVIpfXZhciBzPXt0eXBlOmUsb3B0czp0LG1vdW50cG9pbnQ6cixtb3VudHM6W119LHU9ZS5tb3VudChzKTtyZXR1cm4gdS5tb3VudD1zLHMucm9vdD11LG8/VGUucm9vdD11Om4mJihuLm1vdW50ZWQ9cyxuLm1vdW50JiZuLm1vdW50Lm1vdW50cy5wdXNoKHMpKSx1fSx1bm1vdW50OmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93X21vdW50OiExfSk7aWYoIVRlLmlzTW91bnRwb2ludCh0Lm5vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIHI9dC5ub2RlLG49ci5tb3VudGVkLG89VGUuZ2V0TW91bnRzKG4pO09iamVjdC5rZXlzKFRlLm5hbWVUYWJsZSkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVRlLm5hbWVUYWJsZVtlXTt0Oyl7dmFyIHI9dC5uYW1lX25leHQ7LTEhPT1vLmluZGV4T2YodC5tb3VudCkmJlRlLmRlc3Ryb3lOb2RlKHQpLHQ9cn19KSksci5tb3VudGVkPW51bGw7dmFyIGk9ci5tb3VudC5tb3VudHMuaW5kZXhPZihuKTt5KC0xIT09aSksci5tb3VudC5tb3VudHMuc3BsaWNlKGksMSl9LGxvb2t1cDpmdW5jdGlvbihlLHQpe3JldHVybiBlLm5vZGVfb3BzLmxvb2t1cChlLHQpfSxta25vZDpmdW5jdGlvbihlLHQscil7dmFyIG49VGUubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLG89Z2UuYmFzZW5hbWUoZSk7aWYoIW98fCIuIj09PW98fCIuLiI9PT1vKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIGk9VGUubWF5Q3JlYXRlKG4sbyk7aWYoaSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihpKTtpZighbi5ub2RlX29wcy5ta25vZCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIG4ubm9kZV9vcHMubWtub2QobixvLHQscil9LGNyZWF0ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0PXZvaWQgMCE9PXQ/dDo0MzgsdCY9NDA5NSx0fD0zMjc2OCxUZS5ta25vZChlLHQsMCl9LG1rZGlyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQ9dm9pZCAwIT09dD90OjUxMSx0Jj0xMDIzLHR8PTE2Mzg0LFRlLm1rbm9kKGUsdCwwKX0sbWtkaXJUcmVlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPWUuc3BsaXQoIi8iKSxuPSIiLG89MDtvPHIubGVuZ3RoOysrbylpZihyW29dKXtuKz0iLyIrcltvXTt0cnl7VGUubWtkaXIobix0KX1jYXRjaChlKXtpZihlLmVycm5vIT1tZS5FRVhJU1QpdGhyb3cgZX19fSxta2RldjpmdW5jdGlvbihlLHQscil7cmV0dXJuIHZvaWQgMD09PXImJihyPXQsdD00MzgpLHR8PTgxOTIsVGUubWtub2QoZSx0LHIpfSxzeW1saW5rOmZ1bmN0aW9uKGUsdCl7aWYoIWdlLnJlc29sdmUoZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTt2YXIgcj1UZS5sb29rdXBQYXRoKHQse3BhcmVudDohMH0pLm5vZGU7aWYoIXIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTt2YXIgbj1nZS5iYXNlbmFtZSh0KSxvPVRlLm1heUNyZWF0ZShyLG4pO2lmKG8pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3Iobyk7aWYoIXIubm9kZV9vcHMuc3ltbGluayl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIHIubm9kZV9vcHMuc3ltbGluayhyLG4sZSl9LHJlbmFtZTpmdW5jdGlvbihlLHQpe3ZhciByLG4sbz1nZS5kaXJuYW1lKGUpLGk9Z2UuZGlybmFtZSh0KSxhPWdlLmJhc2VuYW1lKGUpLHM9Z2UuYmFzZW5hbWUodCk7dHJ5e3I9VGUubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLG49VGUubG9va3VwUGF0aCh0LHtwYXJlbnQ6ITB9KS5ub2RlfWNhdGNoKGUpe3Rocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKX1pZighcnx8IW4pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTtpZihyLm1vdW50IT09bi5tb3VudCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FWERFVik7dmFyIHUsYz1UZS5sb29rdXBOb2RlKHIsYSksbD1nZS5yZWxhdGl2ZShlLGkpO2lmKCIuIiE9PWwuY2hhckF0KDApKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7aWYoIi4iIT09KGw9Z2UucmVsYXRpdmUodCxvKSkuY2hhckF0KDApKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RFTVBUWSk7dHJ5e3U9VGUubG9va3VwTm9kZShuLHMpfWNhdGNoKGUpe31pZihjIT09dSl7dmFyIGY9VGUuaXNEaXIoYy5tb2RlKSxkPVRlLm1heURlbGV0ZShyLGEsZik7aWYoZCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihkKTtpZihkPXU/VGUubWF5RGVsZXRlKG4scyxmKTpUZS5tYXlDcmVhdGUobixzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihkKTtpZighci5ub2RlX29wcy5yZW5hbWUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pO2lmKFRlLmlzTW91bnRwb2ludChjKXx8dSYmVGUuaXNNb3VudHBvaW50KHUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKTtpZihuIT09ciYmKGQ9VGUubm9kZVBlcm1pc3Npb25zKHIsInciKSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IoZCk7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUud2lsbE1vdmVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLndpbGxNb3ZlUGF0aChlLHQpfWNhdGNoKHIpe2NvbnNvbGUubG9nKCJGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsTW92ZVBhdGgnXSgnIitlKyInLCAnIit0KyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrci5tZXNzYWdlKX1UZS5oYXNoUmVtb3ZlTm9kZShjKTt0cnl7ci5ub2RlX29wcy5yZW5hbWUoYyxuLHMpfWNhdGNoKGUpe3Rocm93IGV9ZmluYWxseXtUZS5oYXNoQWRkTm9kZShjKX10cnl7VGUudHJhY2tpbmdEZWxlZ2F0ZS5vbk1vdmVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uTW92ZVBhdGgoZSx0KX1jYXRjaChyKXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25Nb3ZlUGF0aCddKCciK2UrIicsICciK3QrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIityLm1lc3NhZ2UpfX19LHJtZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSkubm9kZSxyPWdlLmJhc2VuYW1lKGUpLG49VGUubG9va3VwTm9kZSh0LHIpLG89VGUubWF5RGVsZXRlKHQsciwhMCk7aWYobyl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihvKTtpZighdC5ub2RlX29wcy5ybWRpcil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7aWYoVGUuaXNNb3VudHBvaW50KG4pKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCVVNZKTt0cnl7VGUudHJhY2tpbmdEZWxlZ2F0ZS53aWxsRGVsZXRlUGF0aCYmVGUudHJhY2tpbmdEZWxlZ2F0ZS53aWxsRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnd2lsbERlbGV0ZVBhdGgnXSgnIitlKyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrdC5tZXNzYWdlKX10Lm5vZGVfb3BzLnJtZGlyKHQsciksVGUuZGVzdHJveU5vZGUobik7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUub25EZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIrZSsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9fSxyZWFkZGlyOmZ1bmN0aW9uKGUpe3ZhciB0PVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtpZighdC5ub2RlX29wcy5yZWFkZGlyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RESVIpO3JldHVybiB0Lm5vZGVfb3BzLnJlYWRkaXIodCl9LHVubGluazpmdW5jdGlvbihlKXt2YXIgdD1UZS5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pLm5vZGUscj1nZS5iYXNlbmFtZShlKSxuPVRlLmxvb2t1cE5vZGUodCxyKSxvPVRlLm1heURlbGV0ZSh0LHIsITEpO2lmKG8pdGhyb3cgbmV3IFRlLkVycm5vRXJyb3Iobyk7aWYoIXQubm9kZV9vcHMudW5saW5rKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTtpZihUZS5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJVU1kpO3RyeXtUZS50cmFja2luZ0RlbGVnYXRlLndpbGxEZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLndpbGxEZWxldGVQYXRoKGUpfWNhdGNoKHQpe2NvbnNvbGUubG9nKCJGUy50cmFja2luZ0RlbGVnYXRlWyd3aWxsRGVsZXRlUGF0aCddKCciK2UrIicpIHRocmV3IGFuIGV4Y2VwdGlvbjogIit0Lm1lc3NhZ2UpfXQubm9kZV9vcHMudW5saW5rKHQsciksVGUuZGVzdHJveU5vZGUobik7dHJ5e1RlLnRyYWNraW5nRGVsZWdhdGUub25EZWxldGVQYXRoJiZUZS50cmFja2luZ0RlbGVnYXRlLm9uRGVsZXRlUGF0aChlKX1jYXRjaCh0KXtjb25zb2xlLmxvZygiRlMudHJhY2tpbmdEZWxlZ2F0ZVsnb25EZWxldGVQYXRoJ10oJyIrZSsiJykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9fSxyZWFkbGluazpmdW5jdGlvbihlKXt2YXIgdD1UZS5sb29rdXBQYXRoKGUpLm5vZGU7aWYoIXQpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PRU5UKTtpZighdC5ub2RlX29wcy5yZWFkbGluayl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO3JldHVybiBnZS5yZXNvbHZlKFRlLmdldFBhdGgodC5wYXJlbnQpLHQubm9kZV9vcHMucmVhZGxpbmsodCkpfSxzdGF0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6IXR9KS5ub2RlO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT0VOVCk7aWYoIXIubm9kZV9vcHMuZ2V0YXR0cil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7cmV0dXJuIHIubm9kZV9vcHMuZ2V0YXR0cihyKX0sbHN0YXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIFRlLnN0YXQoZSwhMCl9LGNobW9kOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbjsic3RyaW5nIj09dHlwZW9mIGU/bj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohcn0pLm5vZGU6bj1lO2lmKCFuLm5vZGVfb3BzLnNldGF0dHIpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVBFUk0pO24ubm9kZV9vcHMuc2V0YXR0cihuLHttb2RlOjQwOTUmdHwtNDA5NiZuLm1vZGUsdGltZXN0YW1wOkRhdGUubm93KCl9KX0sbGNobW9kOmZ1bmN0aW9uKGUsdCl7VGUuY2htb2QoZSx0LCEwKX0sZmNobW9kOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUuZ2V0U3RyZWFtKGUpO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtUZS5jaG1vZChyLm5vZGUsdCl9LGNob3duOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvOyJzdHJpbmciPT10eXBlb2YgZT9vPVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiFufSkubm9kZTpvPWU7aWYoIW8ubm9kZV9vcHMuc2V0YXR0cil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FUEVSTSk7by5ub2RlX29wcy5zZXRhdHRyKG8se3RpbWVzdGFtcDpEYXRlLm5vdygpfSl9LGxjaG93bjpmdW5jdGlvbihlLHQscil7VGUuY2hvd24oZSx0LHIsITApfSxmY2hvd246ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmdldFN0cmVhbShlKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7VGUuY2hvd24obi5ub2RlLHQscil9LHRydW5jYXRlOmZ1bmN0aW9uKGUsdCl7aWYodDwwKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIHI7InN0cmluZyI9PXR5cGVvZiBlP3I9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KS5ub2RlOnI9ZTtpZighci5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVQRVJNKTtpZihUZS5pc0RpcihyLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJU0RJUik7aWYoIVRlLmlzRmlsZShyLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIG49VGUubm9kZVBlcm1pc3Npb25zKHIsInciKTtpZihuKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG4pO3Iubm9kZV9vcHMuc2V0YXR0cihyLHtzaXplOnQsdGltZXN0YW1wOkRhdGUubm93KCl9KX0sZnRydW5jYXRlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9VGUuZ2V0U3RyZWFtKGUpO2lmKCFyKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZigwPT0oMjA5NzE1NSZyLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO1RlLnRydW5jYXRlKHIubm9kZSx0KX0sdXRpbWU6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtuLm5vZGVfb3BzLnNldGF0dHIobix7dGltZXN0YW1wOk1hdGgubWF4KHQscil9KX0sb3BlbjpmdW5jdGlvbihlLHQscixuLGkpe2lmKCIiPT09ZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9FTlQpO3ZhciBhO2lmKHI9dm9pZCAwPT09cj80Mzg6cixyPTY0Jih0PSJzdHJpbmciPT10eXBlb2YgdD9UZS5tb2RlU3RyaW5nVG9GbGFncyh0KTp0KT80MDk1JnJ8MzI3Njg6MCwib2JqZWN0Ij09dHlwZW9mIGUpYT1lO2Vsc2V7ZT1nZS5ub3JtYWxpemUoZSk7dHJ5e2E9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ISgxMzEwNzImdCl9KS5ub2RlfWNhdGNoKGUpe319dmFyIHM9ITE7aWYoNjQmdClpZihhKXtpZigxMjgmdCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FRVhJU1QpfWVsc2UgYT1UZS5ta25vZChlLHIsMCkscz0hMDtpZighYSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9FTlQpO2lmKFRlLmlzQ2hyZGV2KGEubW9kZSkmJih0Jj0tNTEzKSw2NTUzNiZ0JiYhVGUuaXNEaXIoYS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9URElSKTtpZighcyl7dmFyIHU9VGUubWF5T3BlbihhLHQpO2lmKHUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IodSl9NTEyJnQmJlRlLnRydW5jYXRlKGEsMCksdCY9LTY0MTt2YXIgYz1UZS5jcmVhdGVTdHJlYW0oe25vZGU6YSxwYXRoOlRlLmdldFBhdGgoYSksZmxhZ3M6dCxzZWVrYWJsZTohMCxwb3NpdGlvbjowLHN0cmVhbV9vcHM6YS5zdHJlYW1fb3BzLHVuZ290dGVuOltdLGVycm9yOiExfSxuLGkpO2Muc3RyZWFtX29wcy5vcGVuJiZjLnN0cmVhbV9vcHMub3BlbihjKSwhby5sb2dSZWFkRmlsZXN8fDEmdHx8KFRlLnJlYWRGaWxlc3x8KFRlLnJlYWRGaWxlcz17fSksZSBpbiBUZS5yZWFkRmlsZXN8fChUZS5yZWFkRmlsZXNbZV09MSxvLnByaW50RXJyKCJyZWFkIGZpbGU6ICIrZSkpKTt0cnl7aWYoVGUudHJhY2tpbmdEZWxlZ2F0ZS5vbk9wZW5GaWxlKXt2YXIgbD0wOzEhPSgyMDk3MTU1JnQpJiYobHw9VGUudHJhY2tpbmcub3BlbkZsYWdzLlJFQUQpLDAhPSgyMDk3MTU1JnQpJiYobHw9VGUudHJhY2tpbmcub3BlbkZsYWdzLldSSVRFKSxUZS50cmFja2luZ0RlbGVnYXRlLm9uT3BlbkZpbGUoZSxsKX19Y2F0Y2godCl7Y29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uT3BlbkZpbGUnXSgnIitlKyInLCBmbGFncykgdGhyZXcgYW4gZXhjZXB0aW9uOiAiK3QubWVzc2FnZSl9cmV0dXJuIGN9LGNsb3NlOmZ1bmN0aW9uKGUpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtlLmdldGRlbnRzJiYoZS5nZXRkZW50cz1udWxsKTt0cnl7ZS5zdHJlYW1fb3BzLmNsb3NlJiZlLnN0cmVhbV9vcHMuY2xvc2UoZSl9Y2F0Y2goZSl7dGhyb3cgZX1maW5hbGx5e1RlLmNsb3NlU3RyZWFtKGUuZmQpfWUuZmQ9bnVsbH0saXNDbG9zZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGw9PT1lLmZkfSxsbHNlZWs6ZnVuY3Rpb24oZSx0LHIpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZighZS5zZWVrYWJsZXx8IWUuc3RyZWFtX29wcy5sbHNlZWspdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRVNQSVBFKTtyZXR1cm4gZS5wb3NpdGlvbj1lLnN0cmVhbV9vcHMubGxzZWVrKGUsdCxyKSxlLnVuZ290dGVuPVtdLGUucG9zaXRpb259LHJlYWQ6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZihuPDB8fG88MCl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU5WQUwpO2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZigxPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoVGUuaXNEaXIoZS5ub2RlLm1vZGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJU0RJUik7aWYoIWUuc3RyZWFtX29wcy5yZWFkKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVJTlZBTCk7dmFyIGk9dm9pZCAwIT09bztpZihpKXtpZighZS5zZWVrYWJsZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FU1BJUEUpfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBhPWUuc3RyZWFtX29wcy5yZWFkKGUsdCxyLG4sbyk7cmV0dXJuIGl8fChlLnBvc2l0aW9uKz1hKSxhfSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8saSl7aWYobjwwfHxvPDApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtpZihUZS5pc0Nsb3NlZChlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoMD09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJBREYpO2lmKFRlLmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSVNESVIpO2lmKCFlLnN0cmVhbV9vcHMud3JpdGUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTsxMDI0JmUuZmxhZ3MmJlRlLmxsc2VlayhlLDAsMik7dmFyIGE9dm9pZCAwIT09bztpZihhKXtpZighZS5zZWVrYWJsZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FU1BJUEUpfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBzPWUuc3RyZWFtX29wcy53cml0ZShlLHQscixuLG8saSk7YXx8KGUucG9zaXRpb24rPXMpO3RyeXtlLnBhdGgmJlRlLnRyYWNraW5nRGVsZWdhdGUub25Xcml0ZVRvRmlsZSYmVGUudHJhY2tpbmdEZWxlZ2F0ZS5vbldyaXRlVG9GaWxlKGUucGF0aCl9Y2F0Y2goZSl7Y29uc29sZS5sb2coIkZTLnRyYWNraW5nRGVsZWdhdGVbJ29uV3JpdGVUb0ZpbGUnXSgnIitwYXRoKyInKSB0aHJldyBhbiBleGNlcHRpb246ICIrZS5tZXNzYWdlKX1yZXR1cm4gc30sYWxsb2NhdGU6ZnVuY3Rpb24oZSx0LHIpe2lmKFRlLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVCQURGKTtpZih0PDB8fHI8PTApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlOVkFMKTtpZigwPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7aWYoIVRlLmlzRmlsZShlLm5vZGUubW9kZSkmJiFUZS5pc0RpcihlLm5vZGUubW9kZSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtpZighZS5zdHJlYW1fb3BzLmFsbG9jYXRlKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVPUE5PVFNVUFApO2Uuc3RyZWFtX29wcy5hbGxvY2F0ZShlLHQscil9LG1tYXA6ZnVuY3Rpb24oZSx0LHIsbixvLGksYSl7aWYoMT09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUFDQ0VTKTtpZighZS5zdHJlYW1fb3BzLm1tYXApdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRU5PREVWKTtyZXR1cm4gZS5zdHJlYW1fb3BzLm1tYXAoZSx0LHIsbixvLGksYSl9LG1zeW5jOmZ1bmN0aW9uKGUsdCxyLG4sbyl7cmV0dXJuIGUmJmUuc3RyZWFtX29wcy5tc3luYz9lLnN0cmVhbV9vcHMubXN5bmMoZSx0LHIsbixvKTowfSxtdW5tYXA6ZnVuY3Rpb24oZSl7cmV0dXJuIDB9LGlvY3RsOmZ1bmN0aW9uKGUsdCxyKXtpZighZS5zdHJlYW1fb3BzLmlvY3RsKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT1RUWSk7cmV0dXJuIGUuc3RyZWFtX29wcy5pb2N0bChlLHQscil9LHJlYWRGaWxlOmZ1bmN0aW9uKGUsdCl7aWYoKHQ9dHx8e30pLmZsYWdzPXQuZmxhZ3N8fCJyIix0LmVuY29kaW5nPXQuZW5jb2Rpbmd8fCJiaW5hcnkiLCJ1dGY4IiE9PXQuZW5jb2RpbmcmJiJiaW5hcnkiIT09dC5lbmNvZGluZyl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW5jb2RpbmcgdHlwZSAiJyt0LmVuY29kaW5nKyciJyk7dmFyIHIsbj1UZS5vcGVuKGUsdC5mbGFncyksbz1UZS5zdGF0KGUpLnNpemUsaT1uZXcgVWludDhBcnJheShvKTtyZXR1cm4gVGUucmVhZChuLGksMCxvLDApLCJ1dGY4Ij09PXQuZW5jb2Rpbmc/cj1fKGksMCk6ImJpbmFyeSI9PT10LmVuY29kaW5nJiYocj1pKSxUZS5jbG9zZShuKSxyfSx3cml0ZUZpbGU6ZnVuY3Rpb24oZSx0LHIpeyhyPXJ8fHt9KS5mbGFncz1yLmZsYWdzfHwidyI7dmFyIG49VGUub3BlbihlLHIuZmxhZ3Msci5tb2RlKTtpZigic3RyaW5nIj09dHlwZW9mIHQpe3ZhciBvPW5ldyBVaW50OEFycmF5KFModCkrMSksaT1BKHQsbywwLG8ubGVuZ3RoKTtUZS53cml0ZShuLG8sMCxpLHZvaWQgMCxyLmNhbk93bil9ZWxzZXtpZighQXJyYXlCdWZmZXIuaXNWaWV3KHQpKXRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgZGF0YSB0eXBlIik7VGUud3JpdGUobix0LDAsdC5ieXRlTGVuZ3RoLHZvaWQgMCxyLmNhbk93bil9VGUuY2xvc2Uobil9LGN3ZDpmdW5jdGlvbigpe3JldHVybiBUZS5jdXJyZW50UGF0aH0sY2hkaXI6ZnVuY3Rpb24oZSl7dmFyIHQ9VGUubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KTtpZihudWxsPT09dC5ub2RlKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG1lLkVOT0VOVCk7aWYoIVRlLmlzRGlyKHQubm9kZS5tb2RlKSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FTk9URElSKTt2YXIgcj1UZS5ub2RlUGVybWlzc2lvbnModC5ub2RlLCJ4Iik7aWYocil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihyKTtUZS5jdXJyZW50UGF0aD10LnBhdGh9LGNyZWF0ZURlZmF1bHREaXJlY3RvcmllczpmdW5jdGlvbigpe1RlLm1rZGlyKCIvdG1wIiksVGUubWtkaXIoIi9ob21lIiksVGUubWtkaXIoIi9ob21lL3dlYl91c2VyIil9LGNyZWF0ZURlZmF1bHREZXZpY2VzOmZ1bmN0aW9uKCl7dmFyIGU7aWYoVGUubWtkaXIoIi9kZXYiKSxUZS5yZWdpc3RlckRldmljZShUZS5tYWtlZGV2KDEsMykse3JlYWQ6ZnVuY3Rpb24oKXtyZXR1cm4gMH0sd3JpdGU6ZnVuY3Rpb24oZSx0LHIsbixvKXtyZXR1cm4gbn19KSxUZS5ta2RldigiL2Rldi9udWxsIixUZS5tYWtlZGV2KDEsMykpLHZlLnJlZ2lzdGVyKFRlLm1ha2VkZXYoNSwwKSx2ZS5kZWZhdWx0X3R0eV9vcHMpLHZlLnJlZ2lzdGVyKFRlLm1ha2VkZXYoNiwwKSx2ZS5kZWZhdWx0X3R0eTFfb3BzKSxUZS5ta2RldigiL2Rldi90dHkiLFRlLm1ha2VkZXYoNSwwKSksVGUubWtkZXYoIi9kZXYvdHR5MSIsVGUubWFrZWRldig2LDApKSwidW5kZWZpbmVkIiE9dHlwZW9mIGNyeXB0byl7dmFyIHQ9bmV3IFVpbnQ4QXJyYXkoMSk7ZT1mdW5jdGlvbigpe3JldHVybiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHQpLHRbMF19fWVsc2UgZT1sP2Z1bmN0aW9uKCl7cmV0dXJuIHJlcXVpcmUoImNyeXB0byIpLnJhbmRvbUJ5dGVzKDEpWzBdfTpmdW5jdGlvbigpe3JldHVybiAyNTYqTWF0aC5yYW5kb20oKXwwfTtUZS5jcmVhdGVEZXZpY2UoIi9kZXYiLCJyYW5kb20iLGUpLFRlLmNyZWF0ZURldmljZSgiL2RldiIsInVyYW5kb20iLGUpLFRlLm1rZGlyKCIvZGV2L3NobSIpLFRlLm1rZGlyKCIvZGV2L3NobS90bXAiKX0sY3JlYXRlU3BlY2lhbERpcmVjdG9yaWVzOmZ1bmN0aW9uKCl7VGUubWtkaXIoIi9wcm9jIiksVGUubWtkaXIoIi9wcm9jL3NlbGYiKSxUZS5ta2RpcigiL3Byb2Mvc2VsZi9mZCIpLFRlLm1vdW50KHttb3VudDpmdW5jdGlvbigpe3ZhciBlPVRlLmNyZWF0ZU5vZGUoIi9wcm9jL3NlbGYiLCJmZCIsMTY4OTUsNzMpO3JldHVybiBlLm5vZGVfb3BzPXtsb29rdXA6ZnVuY3Rpb24oZSx0KXt2YXIgcj0rdCxuPVRlLmdldFN0cmVhbShyKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7dmFyIG89e3BhcmVudDpudWxsLG1vdW50Onttb3VudHBvaW50OiJmYWtlIn0sbm9kZV9vcHM6e3JlYWRsaW5rOmZ1bmN0aW9uKCl7cmV0dXJuIG4ucGF0aH19fTtyZXR1cm4gby5wYXJlbnQ9byxvfX0sZX19LHt9LCIvcHJvYy9zZWxmL2ZkIil9LGNyZWF0ZVN0YW5kYXJkU3RyZWFtczpmdW5jdGlvbigpe28uc3RkaW4/VGUuY3JlYXRlRGV2aWNlKCIvZGV2Iiwic3RkaW4iLG8uc3RkaW4pOlRlLnN5bWxpbmsoIi9kZXYvdHR5IiwiL2Rldi9zdGRpbiIpLG8uc3Rkb3V0P1RlLmNyZWF0ZURldmljZSgiL2RldiIsInN0ZG91dCIsbnVsbCxvLnN0ZG91dCk6VGUuc3ltbGluaygiL2Rldi90dHkiLCIvZGV2L3N0ZG91dCIpLG8uc3RkZXJyP1RlLmNyZWF0ZURldmljZSgiL2RldiIsInN0ZGVyciIsbnVsbCxvLnN0ZGVycik6VGUuc3ltbGluaygiL2Rldi90dHkxIiwiL2Rldi9zdGRlcnIiKTt2YXIgZT1UZS5vcGVuKCIvZGV2L3N0ZGluIiwiciIpO3koMD09PWUuZmQsImludmFsaWQgaGFuZGxlIGZvciBzdGRpbiAoIitlLmZkKyIpIik7dmFyIHQ9VGUub3BlbigiL2Rldi9zdGRvdXQiLCJ3Iik7eSgxPT09dC5mZCwiaW52YWxpZCBoYW5kbGUgZm9yIHN0ZG91dCAoIit0LmZkKyIpIik7dmFyIHI9VGUub3BlbigiL2Rldi9zdGRlcnIiLCJ3Iik7eSgyPT09ci5mZCwiaW52YWxpZCBoYW5kbGUgZm9yIHN0ZGVyciAoIityLmZkKyIpIil9LGVuc3VyZUVycm5vRXJyb3I6ZnVuY3Rpb24oKXtUZS5FcnJub0Vycm9yfHwoVGUuRXJybm9FcnJvcj1mdW5jdGlvbihlLHQpe3RoaXMubm9kZT10LHRoaXMuc2V0RXJybm89ZnVuY3Rpb24oZSl7Zm9yKHZhciB0IGluIHRoaXMuZXJybm89ZSxtZSlpZihtZVt0XT09PWUpe3RoaXMuY29kZT10O2JyZWFrfX0sdGhpcy5zZXRFcnJubyhlKSx0aGlzLm1lc3NhZ2U9RWVbZV0sdGhpcy5zdGFjayYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsInN0YWNrIix7dmFsdWU6KG5ldyBFcnJvcikuc3RhY2ssd3JpdGFibGU6ITB9KX0sVGUuRXJybm9FcnJvci5wcm90b3R5cGU9bmV3IEVycm9yLFRlLkVycm5vRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yPVRlLkVycm5vRXJyb3IsW21lLkVOT0VOVF0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7VGUuZ2VuZXJpY0Vycm9yc1tlXT1uZXcgVGUuRXJybm9FcnJvcihlKSxUZS5nZW5lcmljRXJyb3JzW2VdLnN0YWNrPSI8Z2VuZXJpYyBlcnJvciwgbm8gc3RhY2s+In0pKSl9LHN0YXRpY0luaXQ6ZnVuY3Rpb24oKXtUZS5lbnN1cmVFcnJub0Vycm9yKCksVGUubmFtZVRhYmxlPW5ldyBBcnJheSg0MDk2KSxUZS5tb3VudCh3ZSx7fSwiLyIpLFRlLmNyZWF0ZURlZmF1bHREaXJlY3RvcmllcygpLFRlLmNyZWF0ZURlZmF1bHREZXZpY2VzKCksVGUuY3JlYXRlU3BlY2lhbERpcmVjdG9yaWVzKCksVGUuZmlsZXN5c3RlbXM9e01FTUZTOndlLElEQkZTOl9lLE5PREVGUzpiZSxXT1JLRVJGUzpBZX19LGluaXQ6ZnVuY3Rpb24oZSx0LHIpe3koIVRlLmluaXQuaW5pdGlhbGl6ZWQsIkZTLmluaXQgd2FzIHByZXZpb3VzbHkgY2FsbGVkLiBJZiB5b3Ugd2FudCB0byBpbml0aWFsaXplIGxhdGVyIHdpdGggY3VzdG9tIHBhcmFtZXRlcnMsIHJlbW92ZSBhbnkgZWFybGllciBjYWxscyAobm90ZSB0aGF0IG9uZSBpcyBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoZSBnZW5lcmF0ZWQgY29kZSkiKSxUZS5pbml0LmluaXRpYWxpemVkPSEwLFRlLmVuc3VyZUVycm5vRXJyb3IoKSxvLnN0ZGluPWV8fG8uc3RkaW4sby5zdGRvdXQ9dHx8by5zdGRvdXQsby5zdGRlcnI9cnx8by5zdGRlcnIsVGUuY3JlYXRlU3RhbmRhcmRTdHJlYW1zKCl9LHF1aXQ6ZnVuY3Rpb24oKXtUZS5pbml0LmluaXRpYWxpemVkPSExO3ZhciBlPW8uX2ZmbHVzaDtlJiZlKDApO2Zvcih2YXIgdD0wO3Q8VGUuc3RyZWFtcy5sZW5ndGg7dCsrKXt2YXIgcj1UZS5zdHJlYW1zW3RdO3ImJlRlLmNsb3NlKHIpfX0sZ2V0TW9kZTpmdW5jdGlvbihlLHQpe3ZhciByPTA7cmV0dXJuIGUmJihyfD0zNjUpLHQmJihyfD0xNDYpLHJ9LGpvaW5QYXRoOmZ1bmN0aW9uKGUsdCl7dmFyIHI9Z2Uuam9pbi5hcHBseShudWxsLGUpO3JldHVybiB0JiYiLyI9PXJbMF0mJihyPXIuc3Vic3RyKDEpKSxyfSxhYnNvbHV0ZVBhdGg6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZ2UucmVzb2x2ZSh0LGUpfSxzdGFuZGFyZGl6ZVBhdGg6ZnVuY3Rpb24oZSl7cmV0dXJuIGdlLm5vcm1hbGl6ZShlKX0sZmluZE9iamVjdDpmdW5jdGlvbihlLHQpe3ZhciByPVRlLmFuYWx5emVQYXRoKGUsdCk7cmV0dXJuIHIuZXhpc3RzP3Iub2JqZWN0Oih5ZShyLmVycm9yKSxudWxsKX0sYW5hbHl6ZVBhdGg6ZnVuY3Rpb24oZSx0KXt0cnl7ZT0obj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohdH0pKS5wYXRofWNhdGNoKGUpe312YXIgcj17aXNSb290OiExLGV4aXN0czohMSxlcnJvcjowLG5hbWU6bnVsbCxwYXRoOm51bGwsb2JqZWN0Om51bGwscGFyZW50RXhpc3RzOiExLHBhcmVudFBhdGg6bnVsbCxwYXJlbnRPYmplY3Q6bnVsbH07dHJ5e3ZhciBuPVRlLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSk7ci5wYXJlbnRFeGlzdHM9ITAsci5wYXJlbnRQYXRoPW4ucGF0aCxyLnBhcmVudE9iamVjdD1uLm5vZGUsci5uYW1lPWdlLmJhc2VuYW1lKGUpLG49VGUubG9va3VwUGF0aChlLHtmb2xsb3c6IXR9KSxyLmV4aXN0cz0hMCxyLnBhdGg9bi5wYXRoLHIub2JqZWN0PW4ubm9kZSxyLm5hbWU9bi5ub2RlLm5hbWUsci5pc1Jvb3Q9Ii8iPT09bi5wYXRofWNhdGNoKGUpe3IuZXJyb3I9ZS5lcnJub31yZXR1cm4gcn0sY3JlYXRlRm9sZGVyOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksaT1UZS5nZXRNb2RlKHIsbik7cmV0dXJuIFRlLm1rZGlyKG8saSl9LGNyZWF0ZVBhdGg6ZnVuY3Rpb24oZSx0LHIsbil7ZT0ic3RyaW5nIj09dHlwZW9mIGU/ZTpUZS5nZXRQYXRoKGUpO2Zvcih2YXIgbz10LnNwbGl0KCIvIikucmV2ZXJzZSgpO28ubGVuZ3RoOyl7dmFyIGk9by5wb3AoKTtpZihpKXt2YXIgYT1nZS5qb2luMihlLGkpO3RyeXtUZS5ta2RpcihhKX1jYXRjaChlKXt9ZT1hfX1yZXR1cm4gYX0sY3JlYXRlRmlsZTpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksYT1UZS5nZXRNb2RlKG4sbyk7cmV0dXJuIFRlLmNyZWF0ZShpLGEpfSxjcmVhdGVEYXRhRmlsZTpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9dD9nZS5qb2luMigic3RyaW5nIj09dHlwZW9mIGU/ZTpUZS5nZXRQYXRoKGUpLHQpOmUscz1UZS5nZXRNb2RlKG4sbyksdT1UZS5jcmVhdGUoYSxzKTtpZihyKXtpZigic3RyaW5nIj09dHlwZW9mIHIpe2Zvcih2YXIgYz1uZXcgQXJyYXkoci5sZW5ndGgpLGw9MCxmPXIubGVuZ3RoO2w8ZjsrK2wpY1tsXT1yLmNoYXJDb2RlQXQobCk7cj1jfVRlLmNobW9kKHUsMTQ2fHMpO3ZhciBkPVRlLm9wZW4odSwidyIpO1RlLndyaXRlKGQsciwwLHIubGVuZ3RoLDAsaSksVGUuY2xvc2UoZCksVGUuY2htb2QodSxzKX1yZXR1cm4gdX0sY3JlYXRlRGV2aWNlOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCksaT1UZS5nZXRNb2RlKCEhciwhIW4pO1RlLmNyZWF0ZURldmljZS5tYWpvcnx8KFRlLmNyZWF0ZURldmljZS5tYWpvcj02NCk7dmFyIGE9VGUubWFrZWRldihUZS5jcmVhdGVEZXZpY2UubWFqb3IrKywwKTtyZXR1cm4gVGUucmVnaXN0ZXJEZXZpY2UoYSx7b3BlbjpmdW5jdGlvbihlKXtlLnNlZWthYmxlPSExfSxjbG9zZTpmdW5jdGlvbihlKXtuJiZuLmJ1ZmZlciYmbi5idWZmZXIubGVuZ3RoJiZuKDEwKX0scmVhZDpmdW5jdGlvbihlLHQsbixvLGkpe2Zvcih2YXIgYT0wLHM9MDtzPG87cysrKXt2YXIgdTt0cnl7dT1yKCl9Y2F0Y2goZSl7dGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlPKX1pZih2b2lkIDA9PT11JiYwPT09YSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQUdBSU4pO2lmKG51bGw9PXUpYnJlYWs7YSsrLHRbbitzXT11fXJldHVybiBhJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfSx3cml0ZTpmdW5jdGlvbihlLHQscixvLGkpe2Zvcih2YXIgYT0wO2E8bzthKyspdHJ5e24odFtyK2FdKX1jYXRjaChlKXt0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU8pfXJldHVybiBvJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfX0pLFRlLm1rZGV2KG8saSxhKX0sY3JlYXRlTGluazpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWdlLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOlRlLmdldFBhdGgoZSksdCk7cmV0dXJuIFRlLnN5bWxpbmsocixpKX0sZm9yY2VMb2FkRmlsZTpmdW5jdGlvbihlKXtpZihlLmlzRGV2aWNlfHxlLmlzRm9sZGVyfHxlLmxpbmt8fGUuY29udGVudHMpcmV0dXJuITA7dmFyIHQ9ITA7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCl0aHJvdyBuZXcgRXJyb3IoIkxhenkgbG9hZGluZyBzaG91bGQgaGF2ZSBiZWVuIHBlcmZvcm1lZCAoY29udGVudHMgc2V0KSBpbiBjcmVhdGVMYXp5RmlsZSwgYnV0IGl0IHdhcyBub3QuIExhenkgbG9hZGluZyBvbmx5IHdvcmtzIGluIHdlYiB3b3JrZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2Mgb24gdGhlIG1haW4gdGhyZWFkLiIpO2lmKCFvLnJlYWQpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgbG9hZCB3aXRob3V0IHJlYWQoKSBvciBYTUxIdHRwUmVxdWVzdC4iKTt0cnl7ZS5jb250ZW50cz0kdChvLnJlYWQoZS51cmwpLCEwKSxlLnVzZWRCeXRlcz1lLmNvbnRlbnRzLmxlbmd0aH1jYXRjaChlKXt0PSExfXJldHVybiB0fHx5ZShtZS5FSU8pLHR9LGNyZWF0ZUxhenlGaWxlOmZ1bmN0aW9uKGUsdCxyLG4sbyl7ZnVuY3Rpb24gaSgpe3RoaXMubGVuZ3RoS25vd249ITEsdGhpcy5jaHVua3M9W119aWYoaS5wcm90b3R5cGUuZ2V0PWZ1bmN0aW9uKGUpe2lmKCEoZT50aGlzLmxlbmd0aC0xfHxlPDApKXt2YXIgdD1lJXRoaXMuY2h1bmtTaXplLHI9ZS90aGlzLmNodW5rU2l6ZXwwO3JldHVybiB0aGlzLmdldHRlcihyKVt0XX19LGkucHJvdG90eXBlLnNldERhdGFHZXR0ZXI9ZnVuY3Rpb24oZSl7dGhpcy5nZXR0ZXI9ZX0saS5wcm90b3R5cGUuY2FjaGVMZW5ndGg9ZnVuY3Rpb24oKXt2YXIgZT1uZXcgWE1MSHR0cFJlcXVlc3Q7aWYoZS5vcGVuKCJIRUFEIixyLCExKSxlLnNlbmQobnVsbCksIShlLnN0YXR1cz49MjAwJiZlLnN0YXR1czwzMDB8fDMwND09PWUuc3RhdHVzKSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIityKyIuIFN0YXR1czogIitlLnN0YXR1cyk7dmFyIHQsbj1OdW1iZXIoZS5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1sZW5ndGgiKSksbz0odD1lLmdldFJlc3BvbnNlSGVhZGVyKCJBY2NlcHQtUmFuZ2VzIikpJiYiYnl0ZXMiPT09dCxpPSh0PWUuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtRW5jb2RpbmciKSkmJiJnemlwIj09PXQsYT0xMDQ4NTc2O298fChhPW4pO3ZhciBzPXRoaXM7cy5zZXREYXRhR2V0dGVyKChmdW5jdGlvbihlKXt2YXIgdD1lKmEsbz0oZSsxKSphLTE7aWYobz1NYXRoLm1pbihvLG4tMSksdm9pZCAwPT09cy5jaHVua3NbZV0mJihzLmNodW5rc1tlXT1mdW5jdGlvbihlLHQpe2lmKGU+dCl0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmFuZ2UgKCIrZSsiLCAiK3QrIikgb3Igbm8gYnl0ZXMgcmVxdWVzdGVkISIpO2lmKHQ+bi0xKXRocm93IG5ldyBFcnJvcigib25seSAiK24rIiBieXRlcyBhdmFpbGFibGUhIHByb2dyYW1tZXIgZXJyb3IhIik7dmFyIG89bmV3IFhNTEh0dHBSZXF1ZXN0O2lmKG8ub3BlbigiR0VUIixyLCExKSxuIT09YSYmby5zZXRSZXF1ZXN0SGVhZGVyKCJSYW5nZSIsImJ5dGVzPSIrZSsiLSIrdCksInVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OEFycmF5JiYoby5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIiksby5vdmVycmlkZU1pbWVUeXBlJiZvLm92ZXJyaWRlTWltZVR5cGUoInRleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQiKSxvLnNlbmQobnVsbCksIShvLnN0YXR1cz49MjAwJiZvLnN0YXR1czwzMDB8fDMwND09PW8uc3RhdHVzKSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGxvYWQgIityKyIuIFN0YXR1czogIitvLnN0YXR1cyk7cmV0dXJuIHZvaWQgMCE9PW8ucmVzcG9uc2U/bmV3IFVpbnQ4QXJyYXkoby5yZXNwb25zZXx8W10pOiR0KG8ucmVzcG9uc2VUZXh0fHwiIiwhMCl9KHQsbykpLHZvaWQgMD09PXMuY2h1bmtzW2VdKXRocm93IG5ldyBFcnJvcigiZG9YSFIgZmFpbGVkISIpO3JldHVybiBzLmNodW5rc1tlXX0pKSwhaSYmbnx8KGE9bj0xLG49dGhpcy5nZXR0ZXIoMCkubGVuZ3RoLGE9bixjb25zb2xlLmxvZygiTGF6eUZpbGVzIG9uIGd6aXAgZm9yY2VzIGRvd25sb2FkIG9mIHRoZSB3aG9sZSBmaWxlIHdoZW4gbGVuZ3RoIGlzIGFjY2Vzc2VkIikpLHRoaXMuX2xlbmd0aD1uLHRoaXMuX2NodW5rU2l6ZT1hLHRoaXMubGVuZ3RoS25vd249ITB9LCJ1bmRlZmluZWQiIT10eXBlb2YgWE1MSHR0cFJlcXVlc3Qpe2lmKCFjKXRocm93IkNhbm5vdCBkbyBzeW5jaHJvbm91cyBiaW5hcnkgWEhScyBvdXRzaWRlIHdlYndvcmtlcnMgaW4gbW9kZXJuIGJyb3dzZXJzLiBVc2UgLS1lbWJlZC1maWxlIG9yIC0tcHJlbG9hZC1maWxlIGluIGVtY2MiO3ZhciBhPW5ldyBpO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGEse2xlbmd0aDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGVuZ3RoS25vd258fHRoaXMuY2FjaGVMZW5ndGgoKSx0aGlzLl9sZW5ndGh9fSxjaHVua1NpemU6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aEtub3dufHx0aGlzLmNhY2hlTGVuZ3RoKCksdGhpcy5fY2h1bmtTaXplfX19KTt2YXIgcz17aXNEZXZpY2U6ITEsY29udGVudHM6YX19ZWxzZSBzPXtpc0RldmljZTohMSx1cmw6cn07dmFyIHU9VGUuY3JlYXRlRmlsZShlLHQscyxuLG8pO3MuY29udGVudHM/dS5jb250ZW50cz1zLmNvbnRlbnRzOnMudXJsJiYodS5jb250ZW50cz1udWxsLHUudXJsPXMudXJsKSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh1LHt1c2VkQnl0ZXM6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aH19fSk7dmFyIGw9e307cmV0dXJuIE9iamVjdC5rZXlzKHUuc3RyZWFtX29wcykuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9dS5zdHJlYW1fb3BzW2VdO2xbZV09ZnVuY3Rpb24oKXtpZighVGUuZm9yY2VMb2FkRmlsZSh1KSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FSU8pO3JldHVybiB0LmFwcGx5KG51bGwsYXJndW1lbnRzKX19KSksbC5yZWFkPWZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoIVRlLmZvcmNlTG9hZEZpbGUodSkpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUlPKTt2YXIgaT1lLm5vZGUuY29udGVudHM7aWYobz49aS5sZW5ndGgpcmV0dXJuIDA7dmFyIGE9TWF0aC5taW4oaS5sZW5ndGgtbyxuKTtpZih5KGE+PTApLGkuc2xpY2UpZm9yKHZhciBzPTA7czxhO3MrKyl0W3Irc109aVtvK3NdO2Vsc2UgZm9yKHM9MDtzPGE7cysrKXRbcitzXT1pLmdldChvK3MpO3JldHVybiBhfSx1LnN0cmVhbV9vcHM9bCx1fSxjcmVhdGVQcmVsb2FkZWRGaWxlOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMsdSxjLGwpe0Jyb3dzZXIuaW5pdCgpO3ZhciBmPXQ/Z2UucmVzb2x2ZShnZS5qb2luMihlLHQpKTplO2Z1bmN0aW9uIGQocil7ZnVuY3Rpb24gZChyKXtsJiZsKCksdXx8VGUuY3JlYXRlRGF0YUZpbGUoZSx0LHIsbixpLGMpLGEmJmEoKSxsZSgpfXZhciBoPSExO28ucHJlbG9hZFBsdWdpbnMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aHx8ZS5jYW5IYW5kbGUoZikmJihlLmhhbmRsZShyLGYsZCwoZnVuY3Rpb24oKXtzJiZzKCksbGUoKX0pKSxoPSEwKX0pKSxofHxkKHIpfWNlKCksInN0cmluZyI9PXR5cGVvZiByP0Jyb3dzZXIuYXN5bmNMb2FkKHIsKGZ1bmN0aW9uKGUpe2QoZSl9KSxzKTpkKHIpfSxpbmRleGVkREI6ZnVuY3Rpb24oKXtyZXR1cm4gd2luZG93LmluZGV4ZWREQnx8d2luZG93Lm1vekluZGV4ZWREQnx8d2luZG93LndlYmtpdEluZGV4ZWREQnx8d2luZG93Lm1zSW5kZXhlZERCfSxEQl9OQU1FOmZ1bmN0aW9uKCl7cmV0dXJuIkVNX0ZTXyIrd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lfSxEQl9WRVJTSU9OOjIwLERCX1NUT1JFX05BTUU6IkZJTEVfREFUQSIsc2F2ZUZpbGVzVG9EQjpmdW5jdGlvbihlLHQscil7dD10fHxmdW5jdGlvbigpe30scj1yfHxmdW5jdGlvbigpe307dmFyIG49VGUuaW5kZXhlZERCKCk7dHJ5e3ZhciBvPW4ub3BlbihUZS5EQl9OQU1FKCksVGUuREJfVkVSU0lPTil9Y2F0Y2goZSl7cmV0dXJuIHIoZSl9by5vbnVwZ3JhZGVuZWVkZWQ9ZnVuY3Rpb24oKXtjb25zb2xlLmxvZygiY3JlYXRpbmcgZGIiKSxvLnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZShUZS5EQl9TVE9SRV9OQU1FKX0sby5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt2YXIgbj1vLnJlc3VsdC50cmFuc2FjdGlvbihbVGUuREJfU1RPUkVfTkFNRV0sInJlYWR3cml0ZSIpLGk9bi5vYmplY3RTdG9yZShUZS5EQl9TVE9SRV9OQU1FKSxhPTAscz0wLHU9ZS5sZW5ndGg7ZnVuY3Rpb24gYygpezA9PXM/dCgpOnIoKX1lLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWkucHV0KFRlLmFuYWx5emVQYXRoKGUpLm9iamVjdC5jb250ZW50cyxlKTt0Lm9uc3VjY2Vzcz1mdW5jdGlvbigpeysrYStzPT11JiZjKCl9LHQub25lcnJvcj1mdW5jdGlvbigpe3MrKyxhK3M9PXUmJmMoKX19KSksbi5vbmVycm9yPXJ9LG8ub25lcnJvcj1yfSxsb2FkRmlsZXNGcm9tREI6ZnVuY3Rpb24oZSx0LHIpe3Q9dHx8ZnVuY3Rpb24oKXt9LHI9cnx8ZnVuY3Rpb24oKXt9O3ZhciBuPVRlLmluZGV4ZWREQigpO3RyeXt2YXIgbz1uLm9wZW4oVGUuREJfTkFNRSgpLFRlLkRCX1ZFUlNJT04pfWNhdGNoKGUpe3JldHVybiByKGUpfW8ub251cGdyYWRlbmVlZGVkPXIsby5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXt2YXIgbj1vLnJlc3VsdDt0cnl7dmFyIGk9bi50cmFuc2FjdGlvbihbVGUuREJfU1RPUkVfTkFNRV0sInJlYWRvbmx5Iil9Y2F0Y2goZSl7cmV0dXJuIHZvaWQgcihlKX12YXIgYT1pLm9iamVjdFN0b3JlKFRlLkRCX1NUT1JFX05BTUUpLHM9MCx1PTAsYz1lLmxlbmd0aDtmdW5jdGlvbiBsKCl7MD09dT90KCk6cigpfWUuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9YS5nZXQoZSk7dC5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXtUZS5hbmFseXplUGF0aChlKS5leGlzdHMmJlRlLnVubGluayhlKSxUZS5jcmVhdGVEYXRhRmlsZShnZS5kaXJuYW1lKGUpLGdlLmJhc2VuYW1lKGUpLHQucmVzdWx0LCEwLCEwLCEwKSwrK3MrdT09YyYmbCgpfSx0Lm9uZXJyb3I9ZnVuY3Rpb24oKXt1Kysscyt1PT1jJiZsKCl9fSkpLGkub25lcnJvcj1yfSxvLm9uZXJyb3I9cn19LFNlPXtERUZBVUxUX1BPTExNQVNLOjUsbWFwcGluZ3M6e30sdW1hc2s6NTExLGNhbGN1bGF0ZUF0OmZ1bmN0aW9uKGUsdCl7aWYoIi8iIT09dFswXSl7dmFyIHI7aWYoLTEwMD09PWUpcj1UZS5jd2QoKTtlbHNle3ZhciBuPVRlLmdldFN0cmVhbShlKTtpZighbil0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7cj1uLnBhdGh9dD1nZS5qb2luMihyLHQpfXJldHVybiB0fSxkb1N0YXQ6ZnVuY3Rpb24oZSx0LHIpe3RyeXt2YXIgbj1lKHQpfWNhdGNoKGUpe2lmKGUmJmUubm9kZSYmZ2Uubm9ybWFsaXplKHQpIT09Z2Uubm9ybWFsaXplKFRlLmdldFBhdGgoZS5ub2RlKSkpcmV0dXJuLW1lLkVOT1RESVI7dGhyb3cgZX1yZXR1cm4gRltyPj4yXT1uLmRldixGW3IrND4+Ml09MCxGW3IrOD4+Ml09bi5pbm8sRltyKzEyPj4yXT1uLm1vZGUsRltyKzE2Pj4yXT1uLm5saW5rLEZbcisyMD4+Ml09bi51aWQsRltyKzI0Pj4yXT1uLmdpZCxGW3IrMjg+PjJdPW4ucmRldixGW3IrMzI+PjJdPTAsRltyKzM2Pj4yXT1uLnNpemUsRltyKzQwPj4yXT00MDk2LEZbcis0ND4+Ml09bi5ibG9ja3MsRltyKzQ4Pj4yXT1uLmF0aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNTI+PjJdPTAsRltyKzU2Pj4yXT1uLm10aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNjA+PjJdPTAsRltyKzY0Pj4yXT1uLmN0aW1lLmdldFRpbWUoKS8xZTN8MCxGW3IrNjg+PjJdPTAsRltyKzcyPj4yXT1uLmlubywwfSxkb01zeW5jOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPW5ldyBVaW50OEFycmF5KE8uc3ViYXJyYXkoZSxlK3IpKTtUZS5tc3luYyh0LG8sMCxyLG4pfSxkb01rZGlyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIi8iPT09KGU9Z2Uubm9ybWFsaXplKGUpKVtlLmxlbmd0aC0xXSYmKGU9ZS5zdWJzdHIoMCxlLmxlbmd0aC0xKSksVGUubWtkaXIoZSx0LDApLDB9LGRvTWtub2Q6ZnVuY3Rpb24oZSx0LHIpe3N3aXRjaCg2MTQ0MCZ0KXtjYXNlIDMyNzY4OmNhc2UgODE5MjpjYXNlIDI0NTc2OmNhc2UgNDA5NjpjYXNlIDQ5MTUyOmJyZWFrO2RlZmF1bHQ6cmV0dXJuLW1lLkVJTlZBTH1yZXR1cm4gVGUubWtub2QoZSx0LHIpLDB9LGRvUmVhZGxpbms6ZnVuY3Rpb24oZSx0LHIpe2lmKHI8PTApcmV0dXJuLW1lLkVJTlZBTDt2YXIgbj1UZS5yZWFkbGluayhlKSxvPU1hdGgubWluKHIsUyhuKSksaT1SW3Qrb107cmV0dXJuIFQobix0LHIrMSksUlt0K29dPWksb30sZG9BY2Nlc3M6ZnVuY3Rpb24oZSx0KXtpZigtOCZ0KXJldHVybi1tZS5FSU5WQUw7dmFyIHI7cj1UZS5sb29rdXBQYXRoKGUse2ZvbGxvdzohMH0pLm5vZGU7dmFyIG49IiI7cmV0dXJuIDQmdCYmKG4rPSJyIiksMiZ0JiYobis9InciKSwxJnQmJihuKz0ieCIpLG4mJlRlLm5vZGVQZXJtaXNzaW9ucyhyLG4pPy1tZS5FQUNDRVM6MH0sZG9EdXA6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVRlLmdldFN0cmVhbShyKTtyZXR1cm4gbiYmVGUuY2xvc2UobiksVGUub3BlbihlLHQsMCxyLHIpLmZkfSxkb1JlYWR2OmZ1bmN0aW9uKGUsdCxyLG4pe2Zvcih2YXIgbz0wLGk9MDtpPHI7aSsrKXt2YXIgYT1GW3QrOCppPj4yXSxzPUZbdCsoOCppKzQpPj4yXSx1PVRlLnJlYWQoZSxSLGEscyxuKTtpZih1PDApcmV0dXJuLTE7aWYobys9dSx1PHMpYnJlYWt9cmV0dXJuIG99LGRvV3JpdGV2OmZ1bmN0aW9uKGUsdCxyLG4pe2Zvcih2YXIgbz0wLGk9MDtpPHI7aSsrKXt2YXIgYT1GW3QrOCppPj4yXSxzPUZbdCsoOCppKzQpPj4yXSx1PVRlLndyaXRlKGUsUixhLHMsbik7aWYodTwwKXJldHVybi0xO28rPXV9cmV0dXJuIG99LHZhcmFyZ3M6MCxnZXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIFNlLnZhcmFyZ3MrPTQsRltTZS52YXJhcmdzLTQ+PjJdfSxnZXRTdHI6ZnVuY3Rpb24oKXtyZXR1cm4gdihTZS5nZXQoKSl9LGdldFN0cmVhbUZyb21GRDpmdW5jdGlvbigpe3ZhciBlPVRlLmdldFN0cmVhbShTZS5nZXQoKSk7aWYoIWUpdGhyb3cgbmV3IFRlLkVycm5vRXJyb3IobWUuRUJBREYpO3JldHVybiBlfSxnZXRTb2NrZXRGcm9tRkQ6ZnVuY3Rpb24oKXt2YXIgZT1TT0NLRlMuZ2V0U29ja2V0KFNlLmdldCgpKTtpZighZSl0aHJvdyBuZXcgVGUuRXJybm9FcnJvcihtZS5FQkFERik7cmV0dXJuIGV9LGdldFNvY2tldEFkZHJlc3M6ZnVuY3Rpb24oZSl7dmFyIHQ9U2UuZ2V0KCkscj1TZS5nZXQoKTtpZihlJiYwPT09dClyZXR1cm4gbnVsbDt2YXIgbj1fX3JlYWRfc29ja2FkZHIodCxyKTtpZihuLmVycm5vKXRocm93IG5ldyBUZS5FcnJub0Vycm9yKG4uZXJybm8pO3JldHVybiBuLmFkZHI9RE5TLmxvb2t1cF9hZGRyKG4uYWRkcil8fG4uYWRkcixufSxnZXQ2NDpmdW5jdGlvbigpe3ZhciBlPVNlLmdldCgpLHQ9U2UuZ2V0KCk7cmV0dXJuIHkoZT49MD8wPT09dDotMT09PXQpLGV9LGdldFplcm86ZnVuY3Rpb24oKXt5KDA9PT1TZS5nZXQoKSl9fTt2YXIga2U9NDI7dmFyIFBlPXt9O2Z1bmN0aW9uIERlKGUpe2Zvcig7ZS5sZW5ndGg7KXt2YXIgdD1lLnBvcCgpO2UucG9wKCkodCl9fWZ1bmN0aW9uIFJlKGUpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShNW2U+PjJdKX12YXIgT2U9e30sQ2U9e30sTmU9e307ZnVuY3Rpb24gRmUoZSl7aWYodm9pZCAwPT09ZSlyZXR1cm4iX3Vua25vd24iO3ZhciB0PShlPWUucmVwbGFjZSgvW15hLXpBLVowLTlfXS9nLCIkIikpLmNoYXJDb2RlQXQoMCk7cmV0dXJuIHQ+PTQ4JiZ0PD01Nz8iXyIrZTplfWZ1bmN0aW9uIE1lKGUsdCl7cmV0dXJuIGU9RmUoZSksbmV3IEZ1bmN0aW9uKCJib2R5IiwicmV0dXJuIGZ1bmN0aW9uICIrZSsnKCkge1xuICAgICJ1c2Ugc3RyaWN0IjsgICAgcmV0dXJuIGJvZHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG4nKSh0KX1mdW5jdGlvbiBJZShlLHQpe3ZhciByPU1lKHQsKGZ1bmN0aW9uKGUpe3RoaXMubmFtZT10LHRoaXMubWVzc2FnZT1lO3ZhciByPW5ldyBFcnJvcihlKS5zdGFjazt2b2lkIDAhPT1yJiYodGhpcy5zdGFjaz10aGlzLnRvU3RyaW5nKCkrIlxuIityLnJlcGxhY2UoL15FcnJvcig6W15cbl0qKT9cbi8sIiIpKX0pKTtyZXR1cm4gci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlLnByb3RvdHlwZSksci5wcm90b3R5cGUuY29uc3RydWN0b3I9cixyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB2b2lkIDA9PT10aGlzLm1lc3NhZ2U/dGhpcy5uYW1lOnRoaXMubmFtZSsiOiAiK3RoaXMubWVzc2FnZX0scn12YXIgQmU9dm9pZCAwO2Z1bmN0aW9uIExlKGUpe3Rocm93IG5ldyBCZShlKX1mdW5jdGlvbiB4ZShlLHQscil7ZnVuY3Rpb24gbih0KXt2YXIgbj1yKHQpO24ubGVuZ3RoIT09ZS5sZW5ndGgmJkxlKCJNaXNtYXRjaGVkIHR5cGUgY29udmVydGVyIGNvdW50Iik7Zm9yKHZhciBvPTA7bzxlLmxlbmd0aDsrK28pWWUoZVtvXSxuW29dKX1lLmZvckVhY2goKGZ1bmN0aW9uKGUpe05lW2VdPXR9KSk7dmFyIG89bmV3IEFycmF5KHQubGVuZ3RoKSxpPVtdLGE9MDt0LmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7Q2UuaGFzT3duUHJvcGVydHkoZSk/b1t0XT1DZVtlXTooaS5wdXNoKGUpLE9lLmhhc093blByb3BlcnR5KGUpfHwoT2VbZV09W10pLE9lW2VdLnB1c2goKGZ1bmN0aW9uKCl7b1t0XT1DZVtlXSwrK2E9PT1pLmxlbmd0aCYmbihvKX0pKSl9KSksMD09PWkubGVuZ3RoJiZuKG8pfWZ1bmN0aW9uIGplKGUpe3N3aXRjaChlKXtjYXNlIDE6cmV0dXJuIDA7Y2FzZSAyOnJldHVybiAxO2Nhc2UgNDpyZXR1cm4gMjtjYXNlIDg6cmV0dXJuIDM7ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIHR5cGUgc2l6ZTogIitlKX19dmFyIFVlPXZvaWQgMDtmdW5jdGlvbiB6ZShlKXtmb3IodmFyIHQ9IiIscj1lO09bcl07KXQrPVVlW09bcisrXV07cmV0dXJuIHR9dmFyICRlPXZvaWQgMDtmdW5jdGlvbiBXZShlKXt0aHJvdyBuZXcgJGUoZSl9ZnVuY3Rpb24gWWUoZSx0LHIpe2lmKHI9cnx8e30sISgiYXJnUGFja0FkdmFuY2UiaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigicmVnaXN0ZXJUeXBlIHJlZ2lzdGVyZWRJbnN0YW5jZSByZXF1aXJlcyBhcmdQYWNrQWR2YW5jZSIpO3ZhciBuPXQubmFtZTtpZihlfHxXZSgndHlwZSAiJytuKyciIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGludGVnZXIgdHlwZWlkIHBvaW50ZXInKSxDZS5oYXNPd25Qcm9wZXJ0eShlKSl7aWYoci5pZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zKXJldHVybjtXZSgiQ2Fubm90IHJlZ2lzdGVyIHR5cGUgJyIrbisiJyB0d2ljZSIpfWlmKENlW2VdPXQsZGVsZXRlIE5lW2VdLE9lLmhhc093blByb3BlcnR5KGUpKXt2YXIgbz1PZVtlXTtkZWxldGUgT2VbZV0sby5mb3JFYWNoKChmdW5jdGlvbihlKXtlKCl9KSl9fWZ1bmN0aW9uIFZlKGUpe2lmKCEodGhpcyBpbnN0YW5jZW9mIGV0KSlyZXR1cm4hMTtpZighKGUgaW5zdGFuY2VvZiBldCkpcmV0dXJuITE7Zm9yKHZhciB0PXRoaXMuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Mscj10aGlzLiQkLnB0cixuPWUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Msbz1lLiQkLnB0cjt0LmJhc2VDbGFzczspcj10LnVwY2FzdChyKSx0PXQuYmFzZUNsYXNzO2Zvcig7bi5iYXNlQ2xhc3M7KW89bi51cGNhc3Qobyksbj1uLmJhc2VDbGFzcztyZXR1cm4gdD09PW4mJnI9PT1vfWZ1bmN0aW9uIEhlKGUpe1dlKGUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MubmFtZSsiIGluc3RhbmNlIGFscmVhZHkgZGVsZXRlZCIpfWZ1bmN0aW9uIEdlKCl7aWYodGhpcy4kJC5wdHJ8fEhlKHRoaXMpLHRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUpcmV0dXJuIHRoaXMuJCQuY291bnQudmFsdWUrPTEsdGhpczt2YXIgZSx0PU9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLHskJDp7dmFsdWU6KGU9dGhpcy4kJCx7Y291bnQ6ZS5jb3VudCxkZWxldGVTY2hlZHVsZWQ6ZS5kZWxldGVTY2hlZHVsZWQscHJlc2VydmVQb2ludGVyT25EZWxldGU6ZS5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSxwdHI6ZS5wdHIscHRyVHlwZTplLnB0clR5cGUsc21hcnRQdHI6ZS5zbWFydFB0cixzbWFydFB0clR5cGU6ZS5zbWFydFB0clR5cGV9KX19KTtyZXR1cm4gdC4kJC5jb3VudC52YWx1ZSs9MSx0LiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSx0fWZ1bmN0aW9uIHFlKCl7dmFyIGU7dGhpcy4kJC5wdHJ8fEhlKHRoaXMpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSYmV2UoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKSx0aGlzLiQkLmNvdW50LnZhbHVlLT0xLDA9PT10aGlzLiQkLmNvdW50LnZhbHVlJiYoKGU9dGhpcy4kJCkuc21hcnRQdHI/ZS5zbWFydFB0clR5cGUucmF3RGVzdHJ1Y3RvcihlLnNtYXJ0UHRyKTplLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLnJhd0Rlc3RydWN0b3IoZS5wdHIpKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlfHwodGhpcy4kJC5zbWFydFB0cj12b2lkIDAsdGhpcy4kJC5wdHI9dm9pZCAwKX1mdW5jdGlvbiBYZSgpe3JldHVybiF0aGlzLiQkLnB0cn12YXIgS2U9dm9pZCAwLEplPVtdO2Z1bmN0aW9uIFplKCl7Zm9yKDtKZS5sZW5ndGg7KXt2YXIgZT1KZS5wb3AoKTtlLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSxlLmRlbGV0ZSgpfX1mdW5jdGlvbiBRZSgpe3JldHVybiB0aGlzLiQkLnB0cnx8SGUodGhpcyksdGhpcy4kJC5kZWxldGVTY2hlZHVsZWQmJiF0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlJiZXZSgiT2JqZWN0IGFscmVhZHkgc2NoZWR1bGVkIGZvciBkZWxldGlvbiIpLEplLnB1c2godGhpcyksMT09PUplLmxlbmd0aCYmS2UmJktlKFplKSx0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMCx0aGlzfWZ1bmN0aW9uIGV0KCl7fXZhciB0dD17fTtmdW5jdGlvbiBydChlLHQscil7aWYodm9pZCAwPT09ZVt0XS5vdmVybG9hZFRhYmxlKXt2YXIgbj1lW3RdO2VbdF09ZnVuY3Rpb24oKXtyZXR1cm4gZVt0XS5vdmVybG9hZFRhYmxlLmhhc093blByb3BlcnR5KGFyZ3VtZW50cy5sZW5ndGgpfHxXZSgiRnVuY3Rpb24gJyIrcisiJyBjYWxsZWQgd2l0aCBhbiBpbnZhbGlkIG51bWJlciBvZiBhcmd1bWVudHMgKCIrYXJndW1lbnRzLmxlbmd0aCsiKSAtIGV4cGVjdHMgb25lIG9mICgiK2VbdF0ub3ZlcmxvYWRUYWJsZSsiKSEiKSxlW3RdLm92ZXJsb2FkVGFibGVbYXJndW1lbnRzLmxlbmd0aF0uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxlW3RdLm92ZXJsb2FkVGFibGU9W10sZVt0XS5vdmVybG9hZFRhYmxlW24uYXJnQ291bnRdPW59fWZ1bmN0aW9uIG50KGUsdCxyLG4sbyxpLGEscyl7dGhpcy5uYW1lPWUsdGhpcy5jb25zdHJ1Y3Rvcj10LHRoaXMuaW5zdGFuY2VQcm90b3R5cGU9cix0aGlzLnJhd0Rlc3RydWN0b3I9bix0aGlzLmJhc2VDbGFzcz1vLHRoaXMuZ2V0QWN0dWFsVHlwZT1pLHRoaXMudXBjYXN0PWEsdGhpcy5kb3duY2FzdD1zLHRoaXMucHVyZVZpcnR1YWxGdW5jdGlvbnM9W119ZnVuY3Rpb24gb3QoZSx0LHIpe2Zvcig7dCE9PXI7KXQudXBjYXN0fHxXZSgiRXhwZWN0ZWQgbnVsbCBvciBpbnN0YW5jZSBvZiAiK3IubmFtZSsiLCBnb3QgYW4gaW5zdGFuY2Ugb2YgIit0Lm5hbWUpLGU9dC51cGNhc3QoZSksdD10LmJhc2VDbGFzcztyZXR1cm4gZX1mdW5jdGlvbiBpdChlLHQpe2lmKG51bGw9PT10KXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZXZSgibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksMDt0LiQkfHxXZSgnQ2Fubm90IHBhc3MgIicrT3QodCkrJyIgYXMgYSAnK3RoaXMubmFtZSksdC4kJC5wdHJ8fFdlKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSk7dmFyIHI9dC4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcztyZXR1cm4gb3QodC4kJC5wdHIscix0aGlzLnJlZ2lzdGVyZWRDbGFzcyl9ZnVuY3Rpb24gYXQoZSx0KXt2YXIgcjtpZihudWxsPT09dClyZXR1cm4gdGhpcy5pc1JlZmVyZW5jZSYmV2UoIm51bGwgaXMgbm90IGEgdmFsaWQgIit0aGlzLm5hbWUpLHRoaXMuaXNTbWFydFBvaW50ZXI/KHI9dGhpcy5yYXdDb25zdHJ1Y3RvcigpLG51bGwhPT1lJiZlLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHIpLHIpOjA7dC4kJHx8V2UoJ0Nhbm5vdCBwYXNzICInK090KHQpKyciIGFzIGEgJyt0aGlzLm5hbWUpLHQuJCQucHRyfHxXZSgiQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgIit0aGlzLm5hbWUpLCF0aGlzLmlzQ29uc3QmJnQuJCQucHRyVHlwZS5pc0NvbnN0JiZXZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiKyh0LiQkLnNtYXJ0UHRyVHlwZT90LiQkLnNtYXJ0UHRyVHlwZS5uYW1lOnQuJCQucHRyVHlwZS5uYW1lKSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTt2YXIgbj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO2lmKHI9b3QodC4kJC5wdHIsbix0aGlzLnJlZ2lzdGVyZWRDbGFzcyksdGhpcy5pc1NtYXJ0UG9pbnRlcilzd2l0Y2godm9pZCAwPT09dC4kJC5zbWFydFB0ciYmV2UoIlBhc3NpbmcgcmF3IHBvaW50ZXIgdG8gc21hcnQgcG9pbnRlciBpcyBpbGxlZ2FsIiksdGhpcy5zaGFyaW5nUG9saWN5KXtjYXNlIDA6dC4kJC5zbWFydFB0clR5cGU9PT10aGlzP3I9dC4kJC5zbWFydFB0cjpXZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiKyh0LiQkLnNtYXJ0UHRyVHlwZT90LiQkLnNtYXJ0UHRyVHlwZS5uYW1lOnQuJCQucHRyVHlwZS5uYW1lKSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTticmVhaztjYXNlIDE6cj10LiQkLnNtYXJ0UHRyO2JyZWFrO2Nhc2UgMjppZih0LiQkLnNtYXJ0UHRyVHlwZT09PXRoaXMpcj10LiQkLnNtYXJ0UHRyO2Vsc2V7dmFyIG89dC5jbG9uZSgpO3I9dGhpcy5yYXdTaGFyZShyLFJ0KChmdW5jdGlvbigpe28uZGVsZXRlKCl9KSkpLG51bGwhPT1lJiZlLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHIpfWJyZWFrO2RlZmF1bHQ6V2UoIlVuc3VwcG9ydGluZyBzaGFyaW5nIHBvbGljeSIpfXJldHVybiByfWZ1bmN0aW9uIHN0KGUsdCl7aWYobnVsbD09PXQpcmV0dXJuIHRoaXMuaXNSZWZlcmVuY2UmJldlKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKSwwO3QuJCR8fFdlKCdDYW5ub3QgcGFzcyAiJytPdCh0KSsnIiBhcyBhICcrdGhpcy5uYW1lKSx0LiQkLnB0cnx8V2UoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKSx0LiQkLnB0clR5cGUuaXNDb25zdCYmV2UoIkNhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgIit0LiQkLnB0clR5cGUubmFtZSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKTt2YXIgcj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO3JldHVybiBvdCh0LiQkLnB0cixyLHRoaXMucmVnaXN0ZXJlZENsYXNzKX1mdW5jdGlvbiB1dChlKXtyZXR1cm4gdGhpcy5yYXdHZXRQb2ludGVlJiYoZT10aGlzLnJhd0dldFBvaW50ZWUoZSkpLGV9ZnVuY3Rpb24gY3QoZSl7dGhpcy5yYXdEZXN0cnVjdG9yJiZ0aGlzLnJhd0Rlc3RydWN0b3IoZSl9ZnVuY3Rpb24gbHQoZSl7bnVsbCE9PWUmJmUuZGVsZXRlKCl9ZnVuY3Rpb24gZnQoKXtyZXR1cm4gT2JqZWN0LmtleXMocHQpLmxlbmd0aH1mdW5jdGlvbiBkdCgpe3ZhciBlPVtdO2Zvcih2YXIgdCBpbiBwdClwdC5oYXNPd25Qcm9wZXJ0eSh0KSYmZS5wdXNoKHB0W3RdKTtyZXR1cm4gZX1mdW5jdGlvbiBodChlKXtLZT1lLEplLmxlbmd0aCYmS2UmJktlKFplKX12YXIgcHQ9e307ZnVuY3Rpb24gbXQoZSx0KXtyZXR1cm4gdD1mdW5jdGlvbihlLHQpe2Zvcih2b2lkIDA9PT10JiZXZSgicHRyIHNob3VsZCBub3QgYmUgdW5kZWZpbmVkIik7ZS5iYXNlQ2xhc3M7KXQ9ZS51cGNhc3QodCksZT1lLmJhc2VDbGFzcztyZXR1cm4gdH0oZSx0KSxwdFt0XX1mdW5jdGlvbiB5dChlLHQpe3JldHVybiB0LnB0clR5cGUmJnQucHRyfHxMZSgibWFrZUNsYXNzSGFuZGxlIHJlcXVpcmVzIHB0ciBhbmQgcHRyVHlwZSIpLCEhdC5zbWFydFB0clR5cGUhPT0hIXQuc21hcnRQdHImJkxlKCJCb3RoIHNtYXJ0UHRyVHlwZSBhbmQgc21hcnRQdHIgbXVzdCBiZSBzcGVjaWZpZWQiKSx0LmNvdW50PXt2YWx1ZToxfSxPYmplY3QuY3JlYXRlKGUseyQkOnt2YWx1ZTp0fX0pfWZ1bmN0aW9uIEV0KGUpe3ZhciB0PXRoaXMuZ2V0UG9pbnRlZShlKTtpZighdClyZXR1cm4gdGhpcy5kZXN0cnVjdG9yKGUpLG51bGw7dmFyIHI9bXQodGhpcy5yZWdpc3RlcmVkQ2xhc3MsdCk7aWYodm9pZCAwIT09cil7aWYoMD09PXIuJCQuY291bnQudmFsdWUpcmV0dXJuIHIuJCQucHRyPXQsci4kJC5zbWFydFB0cj1lLHIuY2xvbmUoKTt2YXIgbj1yLmNsb25lKCk7cmV0dXJuIHRoaXMuZGVzdHJ1Y3RvcihlKSxufWZ1bmN0aW9uIG8oKXtyZXR1cm4gdGhpcy5pc1NtYXJ0UG9pbnRlcj95dCh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLnBvaW50ZWVUeXBlLHB0cjp0LHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOmV9KTp5dCh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLHB0cjplfSl9dmFyIGksYT10aGlzLnJlZ2lzdGVyZWRDbGFzcy5nZXRBY3R1YWxUeXBlKHQpLHM9dHRbYV07aWYoIXMpcmV0dXJuIG8uY2FsbCh0aGlzKTtpPXRoaXMuaXNDb25zdD9zLmNvbnN0UG9pbnRlclR5cGU6cy5wb2ludGVyVHlwZTt2YXIgdT1mdW5jdGlvbiBlKHQscixuKXtpZihyPT09bilyZXR1cm4gdDtpZih2b2lkIDA9PT1uLmJhc2VDbGFzcylyZXR1cm4gbnVsbDt2YXIgbz1lKHQscixuLmJhc2VDbGFzcyk7cmV0dXJuIG51bGw9PT1vP251bGw6bi5kb3duY2FzdChvKX0odCx0aGlzLnJlZ2lzdGVyZWRDbGFzcyxpLnJlZ2lzdGVyZWRDbGFzcyk7cmV0dXJuIG51bGw9PT11P28uY2FsbCh0aGlzKTp0aGlzLmlzU21hcnRQb2ludGVyP3l0KGkucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOmkscHRyOnUsc21hcnRQdHJUeXBlOnRoaXMsc21hcnRQdHI6ZX0pOnl0KGkucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOmkscHRyOnV9KX1mdW5jdGlvbiBndChlLHQscixuLG8saSxhLHMsdSxjLGwpe3RoaXMubmFtZT1lLHRoaXMucmVnaXN0ZXJlZENsYXNzPXQsdGhpcy5pc1JlZmVyZW5jZT1yLHRoaXMuaXNDb25zdD1uLHRoaXMuaXNTbWFydFBvaW50ZXI9byx0aGlzLnBvaW50ZWVUeXBlPWksdGhpcy5zaGFyaW5nUG9saWN5PWEsdGhpcy5yYXdHZXRQb2ludGVlPXMsdGhpcy5yYXdDb25zdHJ1Y3Rvcj11LHRoaXMucmF3U2hhcmU9Yyx0aGlzLnJhd0Rlc3RydWN0b3I9bCxvfHx2b2lkIDAhPT10LmJhc2VDbGFzcz90aGlzLnRvV2lyZVR5cGU9YXQ6bj8odGhpcy50b1dpcmVUeXBlPWl0LHRoaXMuZGVzdHJ1Y3RvckZ1bmN0aW9uPW51bGwpOih0aGlzLnRvV2lyZVR5cGU9c3QsdGhpcy5kZXN0cnVjdG9yRnVuY3Rpb249bnVsbCl9ZnVuY3Rpb24gdnQoZSx0KXt2YXIgcjtpZihlPXplKGUpLHZvaWQgMCE9PW9bIkZVTkNUSU9OX1RBQkxFXyIrZV0pcj1vWyJGVU5DVElPTl9UQUJMRV8iK2VdW3RdO2Vsc2UgaWYoInVuZGVmaW5lZCIhPXR5cGVvZiBGVU5DVElPTl9UQUJMRSlyPUZVTkNUSU9OX1RBQkxFW3RdO2Vsc2V7dmFyIG49by5hc21bImR5bkNhbGxfIitlXTt2b2lkIDA9PT1uJiZ2b2lkIDA9PT0obj1vLmFzbVsiZHluQ2FsbF8iK2UucmVwbGFjZSgvZi9nLCJkIildKSYmV2UoIk5vIGR5bkNhbGwgaW52b2tlciBmb3Igc2lnbmF0dXJlOiAiK2UpLHI9ZnVuY3Rpb24ocil7Zm9yKHZhciBuPVtdLG89MTtvPGUubGVuZ3RoOysrbyluLnB1c2goImEiK28pO3ZhciBpPSJyZXR1cm4gZnVuY3Rpb24gIisoImR5bkNhbGxfIitlKyJfIit0KSsiKCIrbi5qb2luKCIsICIpKyIpIHtcbiI7cmV0dXJuIGkrPSIgICAgcmV0dXJuIGR5bkNhbGwocmF3RnVuY3Rpb24iKyhuLmxlbmd0aD8iLCAiOiIiKStuLmpvaW4oIiwgIikrIik7XG4iLGkrPSJ9O1xuIixuZXcgRnVuY3Rpb24oImR5bkNhbGwiLCJyYXdGdW5jdGlvbiIsaSkocix0KX0obil9cmV0dXJuImZ1bmN0aW9uIiE9dHlwZW9mIHImJldlKCJ1bmtub3duIGZ1bmN0aW9uIHBvaW50ZXIgd2l0aCBzaWduYXR1cmUgIitlKyI6ICIrdCkscn12YXIgd3Q9dm9pZCAwO2Z1bmN0aW9uIF90KGUpe3ZhciB0PXF0KGUpLHI9emUodCk7cmV0dXJuIEt0KHQpLHJ9ZnVuY3Rpb24gYnQoZSx0KXt2YXIgcj1bXSxuPXt9O3Rocm93IHQuZm9yRWFjaCgoZnVuY3Rpb24gZSh0KXtuW3RdfHxDZVt0XXx8KE5lW3RdP05lW3RdLmZvckVhY2goZSk6KHIucHVzaCh0KSxuW3RdPSEwKSl9KSksbmV3IHd0KGUrIjogIityLm1hcChfdCkuam9pbihbIiwgIl0pKX1mdW5jdGlvbiBBdChlLHQpe2Zvcih2YXIgcj1bXSxuPTA7bjxlO24rKylyLnB1c2goRlsodD4+Mikrbl0pO3JldHVybiByfWZ1bmN0aW9uIFR0KGUsdCxyLG4sbyl7dmFyIGk9dC5sZW5ndGg7aTwyJiZXZSgiYXJnVHlwZXMgYXJyYXkgc2l6ZSBtaXNtYXRjaCEgTXVzdCBhdCBsZWFzdCBnZXQgcmV0dXJuIHZhbHVlIGFuZCAndGhpcycgdHlwZXMhIik7Zm9yKHZhciBhPW51bGwhPT10WzFdJiZudWxsIT09cixzPSExLHU9MTt1PHQubGVuZ3RoOysrdSlpZihudWxsIT09dFt1XSYmdm9pZCAwPT09dFt1XS5kZXN0cnVjdG9yRnVuY3Rpb24pe3M9ITA7YnJlYWt9dmFyIGM9InZvaWQiIT09dFswXS5uYW1lLGw9IiIsZj0iIjtmb3IodT0wO3U8aS0yOysrdSlsKz0oMCE9PXU/IiwgIjoiIikrImFyZyIrdSxmKz0oMCE9PXU/IiwgIjoiIikrImFyZyIrdSsiV2lyZWQiO3ZhciBkPSJyZXR1cm4gZnVuY3Rpb24gIitGZShlKSsiKCIrbCsiKSB7XG5pZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gIisoaS0yKSsiKSB7XG50aHJvd0JpbmRpbmdFcnJvcignZnVuY3Rpb24gIitlKyIgY2FsbGVkIHdpdGggJyArIGFyZ3VtZW50cy5sZW5ndGggKyAnIGFyZ3VtZW50cywgZXhwZWN0ZWQgIisoaS0yKSsiIGFyZ3MhJyk7XG59XG4iO3MmJihkKz0idmFyIGRlc3RydWN0b3JzID0gW107XG4iKTt2YXIgaD1zPyJkZXN0cnVjdG9ycyI6Im51bGwiLHA9WyJ0aHJvd0JpbmRpbmdFcnJvciIsImludm9rZXIiLCJmbiIsInJ1bkRlc3RydWN0b3JzIiwicmV0VHlwZSIsImNsYXNzUGFyYW0iXSxtPVtXZSxuLG8sRGUsdFswXSx0WzFdXTthJiYoZCs9InZhciB0aGlzV2lyZWQgPSBjbGFzc1BhcmFtLnRvV2lyZVR5cGUoIitoKyIsIHRoaXMpO1xuIik7Zm9yKHU9MDt1PGktMjsrK3UpZCs9InZhciBhcmciK3UrIldpcmVkID0gYXJnVHlwZSIrdSsiLnRvV2lyZVR5cGUoIitoKyIsIGFyZyIrdSsiKTsgLy8gIit0W3UrMl0ubmFtZSsiXG4iLHAucHVzaCgiYXJnVHlwZSIrdSksbS5wdXNoKHRbdSsyXSk7aWYoYSYmKGY9InRoaXNXaXJlZCIrKGYubGVuZ3RoPjA/IiwgIjoiIikrZiksZCs9KGM/InZhciBydiA9ICI6IiIpKyJpbnZva2VyKGZuIisoZi5sZW5ndGg+MD8iLCAiOiIiKStmKyIpO1xuIixzKWQrPSJydW5EZXN0cnVjdG9ycyhkZXN0cnVjdG9ycyk7XG4iO2Vsc2UgZm9yKHU9YT8xOjI7dTx0Lmxlbmd0aDsrK3Upe3ZhciB5PTE9PT11PyJ0aGlzV2lyZWQiOiJhcmciKyh1LTIpKyJXaXJlZCI7bnVsbCE9PXRbdV0uZGVzdHJ1Y3RvckZ1bmN0aW9uJiYoZCs9eSsiX2R0b3IoIit5KyIpOyAvLyAiK3RbdV0ubmFtZSsiXG4iLHAucHVzaCh5KyJfZHRvciIpLG0ucHVzaCh0W3VdLmRlc3RydWN0b3JGdW5jdGlvbikpfXJldHVybiBjJiYoZCs9InZhciByZXQgPSByZXRUeXBlLmZyb21XaXJlVHlwZShydik7XG5yZXR1cm4gcmV0O1xuIiksZCs9In1cbiIscC5wdXNoKGQpLGZ1bmN0aW9uKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgRnVuY3Rpb24pKXRocm93IG5ldyBUeXBlRXJyb3IoIm5ld18gY2FsbGVkIHdpdGggY29uc3RydWN0b3IgdHlwZSAiK3R5cGVvZiBlKyIgd2hpY2ggaXMgbm90IGEgZnVuY3Rpb24iKTt2YXIgcj1NZShlLm5hbWV8fCJ1bmtub3duRnVuY3Rpb25OYW1lIiwoZnVuY3Rpb24oKXt9KSk7ci5wcm90b3R5cGU9ZS5wcm90b3R5cGU7dmFyIG49bmV3IHIsbz1lLmFwcGx5KG4sdCk7cmV0dXJuIG8gaW5zdGFuY2VvZiBPYmplY3Q/bzpufShGdW5jdGlvbixwKS5hcHBseShudWxsLG0pfXZhciBTdD1bXSxrdD1be30se3ZhbHVlOnZvaWQgMH0se3ZhbHVlOm51bGx9LHt2YWx1ZTohMH0se3ZhbHVlOiExfV07ZnVuY3Rpb24gUHQoKXtmb3IodmFyIGU9MCx0PTU7dDxrdC5sZW5ndGg7Kyt0KXZvaWQgMCE9PWt0W3RdJiYrK2U7cmV0dXJuIGV9ZnVuY3Rpb24gRHQoKXtmb3IodmFyIGU9NTtlPGt0Lmxlbmd0aDsrK2UpaWYodm9pZCAwIT09a3RbZV0pcmV0dXJuIGt0W2VdO3JldHVybiBudWxsfWZ1bmN0aW9uIFJ0KGUpe3N3aXRjaChlKXtjYXNlIHZvaWQgMDpyZXR1cm4gMTtjYXNlIG51bGw6cmV0dXJuIDI7Y2FzZSEwOnJldHVybiAzO2Nhc2UhMTpyZXR1cm4gNDtkZWZhdWx0OnZhciB0PVN0Lmxlbmd0aD9TdC5wb3AoKTprdC5sZW5ndGg7cmV0dXJuIGt0W3RdPXtyZWZjb3VudDoxLHZhbHVlOmV9LHR9fWZ1bmN0aW9uIE90KGUpe2lmKG51bGw9PT1lKXJldHVybiJudWxsIjt2YXIgdD10eXBlb2YgZTtyZXR1cm4ib2JqZWN0Ij09PXR8fCJhcnJheSI9PT10fHwiZnVuY3Rpb24iPT09dD9lLnRvU3RyaW5nKCk6IiIrZX1mdW5jdGlvbiBDdChlLHQpe3N3aXRjaCh0KXtjYXNlIDI6cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShJW2U+PjJdKX07Y2FzZSAzOnJldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoQltlPj4zXSl9O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBmbG9hdCB0eXBlOiAiK2UpfX1mdW5jdGlvbiBOdChlLHQscil7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gUltlXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE9bZV19O2Nhc2UgMTpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gQ1tlPj4xXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE5bZT4+MV19O2Nhc2UgMjpyZXR1cm4gcj9mdW5jdGlvbihlKXtyZXR1cm4gRltlPj4yXX06ZnVuY3Rpb24oZSl7cmV0dXJuIE1bZT4+Ml19O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBpbnRlZ2VyIHR5cGU6ICIrZSl9fXZhciBGdD1MKz0xNjt2YXIgTXQ9e307dmFyIEl0PUwrPTE2O0wrPTQ4O2coJHQoIkdNVCIpLCJpOCIsMik7dmFyIEJ0PUwsTHQ9TCs9MTYseHQ9TCs9MTY7ZnVuY3Rpb24ganQoKXtpZighanQuY2FsbGVkKXtqdC5jYWxsZWQ9ITAsRlt4dD4+Ml09NjAqKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpO3ZhciBlPW5ldyBEYXRlKDJlMywwLDEpLHQ9bmV3IERhdGUoMmUzLDYsMSk7RltMdD4+Ml09TnVtYmVyKGUuZ2V0VGltZXpvbmVPZmZzZXQoKSE9dC5nZXRUaW1lem9uZU9mZnNldCgpKTt2YXIgcj1hKGUpLG49YSh0KSxvPWcoJHQociksImk4IiwwKSxpPWcoJHQobiksImk4IiwwKTt0LmdldFRpbWV6b25lT2Zmc2V0KCk8ZS5nZXRUaW1lem9uZU9mZnNldCgpPyhGW0J0Pj4yXT1vLEZbQnQrND4+Ml09aSk6KEZbQnQ+PjJdPWksRltCdCs0Pj4yXT1vKX1mdW5jdGlvbiBhKGUpe3ZhciB0PWUudG9UaW1lU3RyaW5nKCkubWF0Y2goL1woKFtBLVphLXogXSspXCkkLyk7cmV0dXJuIHQ/dFsxXToiR01UIn19TCs9MTY7dmFyIFV0PXt9O3ZhciB6dD0xO2Z1bmN0aW9uICR0KGUsdCxyKXt2YXIgbj1yPjA/cjpTKGUpKzEsbz1uZXcgQXJyYXkobiksaT1BKGUsbywwLG8ubGVuZ3RoKTtyZXR1cm4gdCYmKG8ubGVuZ3RoPWkpLG99VGUuc3RhdGljSW5pdCgpLEoudW5zaGlmdCgoZnVuY3Rpb24oKXtvLm5vRlNJbml0fHxUZS5pbml0LmluaXRpYWxpemVkfHxUZS5pbml0KCl9KSksWi5wdXNoKChmdW5jdGlvbigpe1RlLmlnbm9yZVBlcm1pc3Npb25zPSExfSkpLFEucHVzaCgoZnVuY3Rpb24oKXtUZS5xdWl0KCl9KSksSi51bnNoaWZ0KChmdW5jdGlvbigpe3ZlLmluaXQoKX0pKSxRLnB1c2goKGZ1bmN0aW9uKCl7dmUuc2h1dGRvd24oKX0pKSxCZT1vLkludGVybmFsRXJyb3I9SWUoRXJyb3IsIkludGVybmFsRXJyb3IiKSxmdW5jdGlvbigpe2Zvcih2YXIgZT1uZXcgQXJyYXkoMjU2KSx0PTA7dDwyNTY7Kyt0KWVbdF09U3RyaW5nLmZyb21DaGFyQ29kZSh0KTtVZT1lfSgpLCRlPW8uQmluZGluZ0Vycm9yPUllKEVycm9yLCJCaW5kaW5nRXJyb3IiKSxldC5wcm90b3R5cGUuaXNBbGlhc09mPVZlLGV0LnByb3RvdHlwZS5jbG9uZT1HZSxldC5wcm90b3R5cGUuZGVsZXRlPXFlLGV0LnByb3RvdHlwZS5pc0RlbGV0ZWQ9WGUsZXQucHJvdG90eXBlLmRlbGV0ZUxhdGVyPVFlLGd0LnByb3RvdHlwZS5nZXRQb2ludGVlPXV0LGd0LnByb3RvdHlwZS5kZXN0cnVjdG9yPWN0LGd0LnByb3RvdHlwZS5hcmdQYWNrQWR2YW5jZT04LGd0LnByb3RvdHlwZS5yZWFkVmFsdWVGcm9tUG9pbnRlcj1SZSxndC5wcm90b3R5cGUuZGVsZXRlT2JqZWN0PWx0LGd0LnByb3RvdHlwZS5mcm9tV2lyZVR5cGU9RXQsby5nZXRJbmhlcml0ZWRJbnN0YW5jZUNvdW50PWZ0LG8uZ2V0TGl2ZUluaGVyaXRlZEluc3RhbmNlcz1kdCxvLmZsdXNoUGVuZGluZ0RlbGV0ZXM9WmUsby5zZXREZWxheUZ1bmN0aW9uPWh0LHd0PW8uVW5ib3VuZFR5cGVFcnJvcj1JZShFcnJvciwiVW5ib3VuZFR5cGVFcnJvciIpLG8uY291bnRfZW12YWxfaGFuZGxlcz1QdCxvLmdldF9maXJzdF9lbXZhbD1EdCxmdW5jdGlvbiBlKHQpe3ZhciByLG47ZS5jYWxsZWQ/KG49RltGdD4+Ml0scj1GW24+PjJdKTooZS5jYWxsZWQ9ITAsTXQuVVNFUj1NdC5MT0dOQU1FPSJ3ZWJfdXNlciIsTXQuUEFUSD0iLyIsTXQuUFdEPSIvIixNdC5IT01FPSIvaG9tZS93ZWJfdXNlciIsTXQuTEFORz0iQy5VVEYtOCIsTXQuXz1vLnRoaXNQcm9ncmFtLHI9ZigxMDI0KSxuPWYoMjU2KSxGW24+PjJdPXIsRltGdD4+Ml09bik7dmFyIGk9W10sYT0wO2Zvcih2YXIgcyBpbiB0KWlmKCJzdHJpbmciPT10eXBlb2YgdFtzXSl7dmFyIHU9cysiPSIrdFtzXTtpLnB1c2godSksYSs9dS5sZW5ndGh9aWYoYT4xMDI0KXRocm93IG5ldyBFcnJvcigiRW52aXJvbm1lbnQgc2l6ZSBleGNlZWRlZCBUT1RBTF9FTlZfU0laRSEiKTtmb3IodmFyIGM9MDtjPGkubGVuZ3RoO2MrKyl7cmUodT1pW2NdLHIpLEZbbis0KmM+PjJdPXIscis9dS5sZW5ndGgrMX1GW24rNCppLmxlbmd0aD4+Ml09MH0oTXQpLCQ9Zig0KSxqPVU9aChMKSx6PWgoaitHKSxGWyQ+PjJdPXoseD0hMCxvLndhc21UYWJsZVNpemU9MzE2LG8ud2FzbU1heFRhYmxlU2l6ZT0zMTYsby5hc21HbG9iYWxBcmc9e30sby5hc21MaWJyYXJ5QXJnPXthYm9ydDpycixlbmxhcmdlTWVtb3J5OkgsZ2V0VG90YWxNZW1vcnk6ZnVuY3Rpb24oKXtyZXR1cm4gcX0sYWJvcnRPbkNhbm5vdEdyb3dNZW1vcnk6ZnVuY3Rpb24oKXtycigiQ2Fubm90IGVubGFyZ2UgbWVtb3J5IGFycmF5cy4gRWl0aGVyICgxKSBjb21waWxlIHdpdGggIC1zIFRPVEFMX01FTU9SWT1YICB3aXRoIFggaGlnaGVyIHRoYW4gdGhlIGN1cnJlbnQgdmFsdWUgIitxKyIsICgyKSBjb21waWxlIHdpdGggIC1zIEFMTE9XX01FTU9SWV9HUk9XVEg9MSAgd2hpY2ggYWxsb3dzIGluY3JlYXNpbmcgdGhlIHNpemUgYXQgcnVudGltZSwgb3IgKDMpIGlmIHlvdSB3YW50IG1hbGxvYyB0byByZXR1cm4gTlVMTCAoMCkgaW5zdGVhZCBvZiB0aGlzIGFib3J0LCBjb21waWxlIHdpdGggIC1zIEFCT1JUSU5HX01BTExPQz0wICIpfSxpbnZva2VfaTpmdW5jdGlvbihlKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9pKGUpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paTpmdW5jdGlvbihlLHQpe3RyeXtyZXR1cm4gby5keW5DYWxsX2lpKGUsdCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX2lpaTpmdW5jdGlvbihlLHQscil7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpKGUsdCxyKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfaWlpaTpmdW5jdGlvbihlLHQscixuKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9paWlpKGUsdCxyLG4pfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paWlpaTpmdW5jdGlvbihlLHQscixuLGkpe3RyeXtyZXR1cm4gby5keW5DYWxsX2lpaWlpKGUsdCxyLG4saSl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX2lpaWlpaWk6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyl7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpaWlpaShlLHQscixuLGksYSxzKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfaWlpaWlpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSxzLHUsYyxsKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9paWlpaWlpaWlpKGUsdCxyLG4saSxhLHMsdSxjLGwpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9paWlpaWlqaWk6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyx1LGMsbCl7dHJ5e3JldHVybiBvLmR5bkNhbGxfaWlpaWlpamlpKGUsdCxyLG4saSxhLHMsdSxjLGwpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV9pamo6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9pamooZSx0LHIsbixpKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2Vfamk6ZnVuY3Rpb24oZSx0KXt0cnl7cmV0dXJuIG8uZHluQ2FsbF9qaShlLHQpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92OmZ1bmN0aW9uKGUpe3RyeXtvLmR5bkNhbGxfdihlKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2Vfdmk6ZnVuY3Rpb24oZSx0KXt0cnl7by5keW5DYWxsX3ZpKGUsdCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaTpmdW5jdGlvbihlLHQscil7dHJ5e28uZHluQ2FsbF92aWkoZSx0LHIpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWlpOmZ1bmN0aW9uKGUsdCxyLG4pe3RyeXtvLmR5bkNhbGxfdmlpaShlLHQscixuKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfdmlpaWk6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7by5keW5DYWxsX3ZpaWlpKGUsdCxyLG4saSl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSl7dHJ5e28uZHluQ2FsbF92aWlpaWkoZSx0LHIsbixpLGEpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWlpaWlpOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMpe3RyeXtvLmR5bkNhbGxfdmlpaWlpaShlLHQscixuLGksYSxzKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxpbnZva2VfdmlpaWlpaWlpaTpmdW5jdGlvbihlLHQscixuLGksYSxzLHUsYyxsKXt0cnl7by5keW5DYWxsX3ZpaWlpaWlpaWkoZSx0LHIsbixpLGEscyx1LGMsbCl9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3ZpaWlpaWlpaWlpOmZ1bmN0aW9uKGUsdCxyLG4saSxhLHMsdSxjLGwsZil7dHJ5e28uZHluQ2FsbF92aWlpaWlpaWlpaShlLHQscixuLGksYSxzLHUsYyxsLGYpfWNhdGNoKGUpe2lmKCJudW1iZXIiIT10eXBlb2YgZSYmImxvbmdqbXAiIT09ZSl0aHJvdyBlO28uc2V0VGhyZXcoMSwwKX19LGludm9rZV92aWo6ZnVuY3Rpb24oZSx0LHIsbil7dHJ5e28uZHluQ2FsbF92aWooZSx0LHIsbil9Y2F0Y2goZSl7aWYoIm51bWJlciIhPXR5cGVvZiBlJiYibG9uZ2ptcCIhPT1lKXRocm93IGU7by5zZXRUaHJldygxLDApfX0saW52b2tlX3Zpamk6ZnVuY3Rpb24oZSx0LHIsbixpKXt0cnl7by5keW5DYWxsX3ZpamkoZSx0LHIsbixpKX1jYXRjaChlKXtpZigibnVtYmVyIiE9dHlwZW9mIGUmJiJsb25nam1wIiE9PWUpdGhyb3cgZTtvLnNldFRocmV3KDEsMCl9fSxfX19jeGFfYWxsb2NhdGVfZXhjZXB0aW9uOmZ1bmN0aW9uKGUpe3JldHVybiBKdChlKX0sX19fY3hhX2JlZ2luX2NhdGNoOmZ1bmN0aW9uKGUpe3ZhciB0PWRlLmluZm9zW2VdO3JldHVybiB0JiYhdC5jYXVnaHQmJih0LmNhdWdodD0hMCksdCYmKHQucmV0aHJvd249ITEpLGRlLmNhdWdodC5wdXNoKGUpLGRlLmFkZFJlZihkZS5kZUFkanVzdChlKSksZX0sX19fY3hhX2VuZF9jYXRjaDpmdW5jdGlvbigpe28uc2V0VGhyZXcoMCk7dmFyIGU9ZGUuY2F1Z2h0LnBvcCgpO2UmJihkZS5kZWNSZWYoZGUuZGVBZGp1c3QoZSkpLGRlLmxhc3Q9MCl9LF9fX2N4YV9maW5kX21hdGNoaW5nX2NhdGNoXzI6ZnVuY3Rpb24oKXtyZXR1cm4gcGUuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxfX19jeGFfZmluZF9tYXRjaGluZ19jYXRjaF8zOmZ1bmN0aW9uKCl7cmV0dXJuIHBlLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sX19fY3hhX2ZpbmRfbWF0Y2hpbmdfY2F0Y2hfNDpmdW5jdGlvbigpe3JldHVybiBwZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9fX2N4YV9mcmVlX2V4Y2VwdGlvbjpoZSxfX19jeGFfdGhyb3c6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IGRlLmluZm9zW2VdPXtwdHI6ZSxhZGp1c3RlZDplLHR5cGU6dCxkZXN0cnVjdG9yOnIscmVmY291bnQ6MCxjYXVnaHQ6ITEscmV0aHJvd246ITF9LGRlLmxhc3Q9ZSxlfSxfX19sb2NrOmZ1bmN0aW9uKCl7fSxfX19tYXBfZmlsZTpmdW5jdGlvbihlLHQpe3JldHVybiB5ZShtZS5FUEVSTSksLTF9LF9fX3Jlc3VtZUV4Y2VwdGlvbjpmdW5jdGlvbihlKXt0aHJvdyBkZS5sYXN0fHwoZGUubGFzdD1lKSxlfSxfX19zZXRFcnJObzp5ZSxfX19zeXNjYWxsMTQwOmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHJlYW1Gcm9tRkQoKSxuPShTZS5nZXQoKSxTZS5nZXQoKSksbz1TZS5nZXQoKSxpPVNlLmdldCgpLGE9bjtyZXR1cm4gVGUubGxzZWVrKHIsYSxpKSxGW28+PjJdPXIucG9zaXRpb24sci5nZXRkZW50cyYmMD09PWEmJjA9PT1pJiYoci5nZXRkZW50cz1udWxsKSwwfWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDE0NTpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0U3RyZWFtRnJvbUZEKCksbj1TZS5nZXQoKSxvPVNlLmdldCgpO3JldHVybiBTZS5kb1JlYWR2KHIsbixvKX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGwxNDY6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3ZhciByPVNlLmdldFN0cmVhbUZyb21GRCgpLG49U2UuZ2V0KCksbz1TZS5nZXQoKTtyZXR1cm4gU2UuZG9Xcml0ZXYocixuLG8pfWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDE4MzpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS5nZXQoKTtpZigwPT09bilyZXR1cm4tbWUuRUlOVkFMO3ZhciBvPVRlLmN3ZCgpO3JldHVybiBuPFMobykrMT8tbWUuRVJBTkdFOihUKG8scixuKSxyKX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGwxOTg6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3ZhciByPVNlLmdldFN0cigpLG49U2UuZ2V0KCksbz1TZS5nZXQoKTtyZXR1cm4gVGUuY2hvd24ocixuLG8pLDB9Y2F0Y2goZSl7cmV0dXJuIHZvaWQgMCE9PVRlJiZlIGluc3RhbmNlb2YgVGUuRXJybm9FcnJvcnx8cnIoZSksLWUuZXJybm99fSxfX19zeXNjYWxsMjA6ZnVuY3Rpb24oZSx0KXtTZS52YXJhcmdzPXQ7dHJ5e3JldHVybiBrZX1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw2OmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHJlYW1Gcm9tRkQoKTtyZXR1cm4gVGUuY2xvc2UociksMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw2MDpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS51bWFzaztyZXR1cm4gU2UudW1hc2s9cixufWNhdGNoKGUpe3JldHVybiB2b2lkIDAhPT1UZSYmZSBpbnN0YW5jZW9mIFRlLkVycm5vRXJyb3J8fHJyKGUpLC1lLmVycm5vfX0sX19fc3lzY2FsbDgzOmZ1bmN0aW9uKGUsdCl7U2UudmFyYXJncz10O3RyeXt2YXIgcj1TZS5nZXRTdHIoKSxuPVNlLmdldFN0cigpO3JldHVybiBUZS5zeW1saW5rKHIsbiksMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3N5c2NhbGw5MTpmdW5jdGlvbihlLHQpe1NlLnZhcmFyZ3M9dDt0cnl7dmFyIHI9U2UuZ2V0KCksbj1TZS5nZXQoKSxvPVNlLm1hcHBpbmdzW3JdO2lmKCFvKXJldHVybiAwO2lmKG49PT1vLmxlbil7dmFyIGk9VGUuZ2V0U3RyZWFtKG8uZmQpO1NlLmRvTXN5bmMocixpLG4sby5mbGFncyksVGUubXVubWFwKGkpLFNlLm1hcHBpbmdzW3JdPW51bGwsby5hbGxvY2F0ZWQmJkt0KG8ubWFsbG9jKX1yZXR1cm4gMH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwIT09VGUmJmUgaW5zdGFuY2VvZiBUZS5FcnJub0Vycm9yfHxycihlKSwtZS5lcnJub319LF9fX3VubG9jazpmdW5jdGlvbigpe30sX19lbWJpbmRfZmluYWxpemVfdmFsdWVfb2JqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0PVBlW2VdO2RlbGV0ZSBQZVtlXTt2YXIgcj10LnJhd0NvbnN0cnVjdG9yLG49dC5yYXdEZXN0cnVjdG9yLG89dC5maWVsZHM7eGUoW2VdLG8ubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gZS5nZXR0ZXJSZXR1cm5UeXBlfSkpLmNvbmNhdChvLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUuc2V0dGVyQXJndW1lbnRUeXBlfSkpKSwoZnVuY3Rpb24oZSl7dmFyIGk9e307cmV0dXJuIG8uZm9yRWFjaCgoZnVuY3Rpb24odCxyKXt2YXIgbj10LmZpZWxkTmFtZSxhPWVbcl0scz10LmdldHRlcix1PXQuZ2V0dGVyQ29udGV4dCxjPWVbcitvLmxlbmd0aF0sbD10LnNldHRlcixmPXQuc2V0dGVyQ29udGV4dDtpW25dPXtyZWFkOmZ1bmN0aW9uKGUpe3JldHVybiBhLmZyb21XaXJlVHlwZShzKHUsZSkpfSx3cml0ZTpmdW5jdGlvbihlLHQpe3ZhciByPVtdO2woZixlLGMudG9XaXJlVHlwZShyLHQpKSxEZShyKX19fSkpLFt7bmFtZTp0Lm5hbWUsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3ZhciB0PXt9O2Zvcih2YXIgciBpbiBpKXRbcl09aVtyXS5yZWFkKGUpO3JldHVybiBuKGUpLHR9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG8gaW4gaSlpZighKG8gaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiTWlzc2luZyBmaWVsZCIpO3ZhciBhPXIoKTtmb3IobyBpbiBpKWlbb10ud3JpdGUoYSx0W29dKTtyZXR1cm4gbnVsbCE9PWUmJmUucHVzaChuLGEpLGF9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6UmUsZGVzdHJ1Y3RvckZ1bmN0aW9uOm59XX0pKX0sX19lbWJpbmRfcmVnaXN0ZXJfYm9vbDpmdW5jdGlvbihlLHQscixuLG8pe3ZhciBpPWplKHIpO1llKGUse25hbWU6dD16ZSh0KSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7cmV0dXJuISFlfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQ/bjpvfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOmZ1bmN0aW9uKGUpe3ZhciBuO2lmKDE9PT1yKW49UjtlbHNlIGlmKDI9PT1yKW49QztlbHNle2lmKDQhPT1yKXRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gYm9vbGVhbiB0eXBlIHNpemU6ICIrdCk7bj1GfXJldHVybiB0aGlzLmZyb21XaXJlVHlwZShuW2U+PmldKX0sZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX0sX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3M6ZnVuY3Rpb24oZSx0LHIsbixpLGEscyx1LGMsbCxmLGQsaCl7Zj16ZShmKSxhPXZ0KGksYSksdSYmKHU9dnQocyx1KSksbCYmKGw9dnQoYyxsKSksaD12dChkLGgpO3ZhciBwPUZlKGYpOyFmdW5jdGlvbihlLHQscil7by5oYXNPd25Qcm9wZXJ0eShlKT8oKHZvaWQgMD09PXJ8fHZvaWQgMCE9PW9bZV0ub3ZlcmxvYWRUYWJsZSYmdm9pZCAwIT09b1tlXS5vdmVybG9hZFRhYmxlW3JdKSYmV2UoIkNhbm5vdCByZWdpc3RlciBwdWJsaWMgbmFtZSAnIitlKyInIHR3aWNlIikscnQobyxlLGUpLG8uaGFzT3duUHJvcGVydHkocikmJldlKCJDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgb3ZlcmxvYWRzIG9mIGEgZnVuY3Rpb24gd2l0aCB0aGUgc2FtZSBudW1iZXIgb2YgYXJndW1lbnRzICgiK3IrIikhIiksb1tlXS5vdmVybG9hZFRhYmxlW3JdPXQpOihvW2VdPXQsdm9pZCAwIT09ciYmKG9bZV0ubnVtQXJndW1lbnRzPXIpKX0ocCwoZnVuY3Rpb24oKXtidCgiQ2Fubm90IGNvbnN0cnVjdCAiK2YrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsW25dKX0pKSx4ZShbZSx0LHJdLG4/W25dOltdLChmdW5jdGlvbih0KXt2YXIgcixpO3Q9dFswXSxpPW4/KHI9dC5yZWdpc3RlcmVkQ2xhc3MpLmluc3RhbmNlUHJvdG90eXBlOmV0LnByb3RvdHlwZTt2YXIgcz1NZShwLChmdW5jdGlvbigpe2lmKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSE9PWMpdGhyb3cgbmV3ICRlKCJVc2UgJ25ldycgdG8gY29uc3RydWN0ICIrZik7aWYodm9pZCAwPT09ZC5jb25zdHJ1Y3Rvcl9ib2R5KXRocm93IG5ldyAkZShmKyIgaGFzIG5vIGFjY2Vzc2libGUgY29uc3RydWN0b3IiKTt2YXIgZT1kLmNvbnN0cnVjdG9yX2JvZHlbYXJndW1lbnRzLmxlbmd0aF07aWYodm9pZCAwPT09ZSl0aHJvdyBuZXcgJGUoIlRyaWVkIHRvIGludm9rZSBjdG9yIG9mICIrZisiIHdpdGggaW52YWxpZCBudW1iZXIgb2YgcGFyYW1ldGVycyAoIithcmd1bWVudHMubGVuZ3RoKyIpIC0gZXhwZWN0ZWQgKCIrT2JqZWN0LmtleXMoZC5jb25zdHJ1Y3Rvcl9ib2R5KS50b1N0cmluZygpKyIpIHBhcmFtZXRlcnMgaW5zdGVhZCEiKTtyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSksYz1PYmplY3QuY3JlYXRlKGkse2NvbnN0cnVjdG9yOnt2YWx1ZTpzfX0pO3MucHJvdG90eXBlPWM7dmFyIGQ9bmV3IG50KGYscyxjLGgscixhLHUsbCksbT1uZXcgZ3QoZixkLCEwLCExLCExKSx5PW5ldyBndChmKyIqIixkLCExLCExLCExKSxFPW5ldyBndChmKyIgY29uc3QqIixkLCExLCEwLCExKTtyZXR1cm4gdHRbZV09e3BvaW50ZXJUeXBlOnksY29uc3RQb2ludGVyVHlwZTpFfSxmdW5jdGlvbihlLHQscil7by5oYXNPd25Qcm9wZXJ0eShlKXx8TGUoIlJlcGxhY2luZyBub25leGlzdGFudCBwdWJsaWMgc3ltYm9sIiksdm9pZCAwIT09b1tlXS5vdmVybG9hZFRhYmxlJiZ2b2lkIDAhPT1yP29bZV0ub3ZlcmxvYWRUYWJsZVtyXT10OihvW2VdPXQsb1tlXS5hcmdDb3VudD1yKX0ocCxzKSxbbSx5LEVdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19jb25zdHJ1Y3RvcjpmdW5jdGlvbihlLHQscixuLG8saSl7dmFyIGE9QXQodCxyKTtvPXZ0KG4sbykseGUoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgcj0iY29uc3RydWN0b3IgIisoZT1lWzBdKS5uYW1lO2lmKHZvaWQgMD09PWUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHkmJihlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5PVtdKSx2b2lkIDAhPT1lLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W3QtMV0pdGhyb3cgbmV3ICRlKCJDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgY29uc3RydWN0b3JzIHdpdGggaWRlbnRpY2FsIG51bWJlciBvZiBwYXJhbWV0ZXJzICgiKyh0LTEpKyIpIGZvciBjbGFzcyAnIitlLm5hbWUrIichIE92ZXJsb2FkIHJlc29sdXRpb24gaXMgY3VycmVudGx5IG9ubHkgcGVyZm9ybWVkIHVzaW5nIHRoZSBwYXJhbWV0ZXIgY291bnQsIG5vdCBhY3R1YWwgdHlwZSBpbmZvISIpO3JldHVybiBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W3QtMV09ZnVuY3Rpb24oKXtidCgiQ2Fubm90IGNvbnN0cnVjdCAiK2UubmFtZSsiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixhKX0seGUoW10sYSwoZnVuY3Rpb24obil7cmV0dXJuIGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXT1mdW5jdGlvbigpe2FyZ3VtZW50cy5sZW5ndGghPT10LTEmJldlKHIrIiBjYWxsZWQgd2l0aCAiK2FyZ3VtZW50cy5sZW5ndGgrIiBhcmd1bWVudHMsIGV4cGVjdGVkICIrKHQtMSkpO3ZhciBlPVtdLGE9bmV3IEFycmF5KHQpO2FbMF09aTtmb3IodmFyIHM9MTtzPHQ7KytzKWFbc109bltzXS50b1dpcmVUeXBlKGUsYXJndW1lbnRzW3MtMV0pO3ZhciB1PW8uYXBwbHkobnVsbCxhKTtyZXR1cm4gRGUoZSksblswXS5mcm9tV2lyZVR5cGUodSl9LFtdfSkpLFtdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19mdW5jdGlvbjpmdW5jdGlvbihlLHQscixuLG8saSxhLHMpe3ZhciB1PUF0KHIsbik7dD16ZSh0KSxpPXZ0KG8saSkseGUoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgbj0oZT1lWzBdKS5uYW1lKyIuIit0O2Z1bmN0aW9uIG8oKXtidCgiQ2Fubm90IGNhbGwgIituKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLHUpfXMmJmUucmVnaXN0ZXJlZENsYXNzLnB1cmVWaXJ0dWFsRnVuY3Rpb25zLnB1c2godCk7dmFyIGM9ZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsbD1jW3RdO3JldHVybiB2b2lkIDA9PT1sfHx2b2lkIDA9PT1sLm92ZXJsb2FkVGFibGUmJmwuY2xhc3NOYW1lIT09ZS5uYW1lJiZsLmFyZ0NvdW50PT09ci0yPyhvLmFyZ0NvdW50PXItMixvLmNsYXNzTmFtZT1lLm5hbWUsY1t0XT1vKToocnQoYyx0LG4pLGNbdF0ub3ZlcmxvYWRUYWJsZVtyLTJdPW8pLHhlKFtdLHUsKGZ1bmN0aW9uKG8pe3ZhciBzPVR0KG4sbyxlLGksYSk7cmV0dXJuIHZvaWQgMD09PWNbdF0ub3ZlcmxvYWRUYWJsZT8ocy5hcmdDb3VudD1yLTIsY1t0XT1zKTpjW3RdLm92ZXJsb2FkVGFibGVbci0yXT1zLFtdfSkpLFtdfSkpfSxfX2VtYmluZF9yZWdpc3Rlcl9lbXZhbDpmdW5jdGlvbihlLHQpe1llKGUse25hbWU6dD16ZSh0KSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7dmFyIHQ9a3RbZV0udmFsdWU7cmV0dXJuIGZ1bmN0aW9uKGUpe2U+NCYmMD09LS1rdFtlXS5yZWZjb3VudCYmKGt0W2VdPXZvaWQgMCxTdC5wdXNoKGUpKX0oZSksdH0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe3JldHVybiBSdCh0KX0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpSZSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9mbG9hdDpmdW5jdGlvbihlLHQscil7dmFyIG49amUocik7WWUoZSx7bmFtZTp0PXplKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4gZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe2lmKCJudW1iZXIiIT10eXBlb2YgdCYmImJvb2xlYW4iIT10eXBlb2YgdCl0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCAiJytPdCh0KSsnIiB0byAnK3RoaXMubmFtZSk7cmV0dXJuIHR9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6Q3QodCxuKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9pbnRlZ2VyOmZ1bmN0aW9uKGUsdCxyLG4sbyl7dD16ZSh0KSwtMT09PW8mJihvPTQyOTQ5NjcyOTUpO3ZhciBpPWplKHIpLGE9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9O2lmKDA9PT1uKXt2YXIgcz0zMi04KnI7YT1mdW5jdGlvbihlKXtyZXR1cm4gZTw8cz4+PnN9fXZhciB1PS0xIT10LmluZGV4T2YoInVuc2lnbmVkIik7WWUoZSx7bmFtZTp0LGZyb21XaXJlVHlwZTphLHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSxyKXtpZigibnVtYmVyIiE9dHlwZW9mIHImJiJib29sZWFuIiE9dHlwZW9mIHIpdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgIicrT3QocikrJyIgdG8gJyt0aGlzLm5hbWUpO2lmKHI8bnx8cj5vKXRocm93IG5ldyBUeXBlRXJyb3IoJ1Bhc3NpbmcgYSBudW1iZXIgIicrT3QocikrJyIgZnJvbSBKUyBzaWRlIHRvIEMvQysrIHNpZGUgdG8gYW4gYXJndW1lbnQgb2YgdHlwZSAiJyt0KyciLCB3aGljaCBpcyBvdXRzaWRlIHRoZSB2YWxpZCByYW5nZSBbJytuKyIsICIrbysiXSEiKTtyZXR1cm4gdT9yPj4+MDowfHJ9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6TnQodCxpLDAhPT1uKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9tZW1vcnlfdmlldzpmdW5jdGlvbihlLHQscil7dmFyIG49W0ludDhBcnJheSxVaW50OEFycmF5LEludDE2QXJyYXksVWludDE2QXJyYXksSW50MzJBcnJheSxVaW50MzJBcnJheSxGbG9hdDMyQXJyYXksRmxvYXQ2NEFycmF5XVt0XTtmdW5jdGlvbiBvKGUpe3ZhciB0PU0scj10W2U+Pj0yXSxvPXRbZSsxXTtyZXR1cm4gbmV3IG4odC5idWZmZXIsbyxyKX1ZZShlLHtuYW1lOnI9emUociksZnJvbVdpcmVUeXBlOm8sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpvfSx7aWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9uczohMH0pfSxfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nOmZ1bmN0aW9uKGUsdCl7WWUoZSx7bmFtZTp0PXplKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9TVtlPj4yXSxyPW5ldyBBcnJheSh0KSxuPTA7bjx0OysrbilyW25dPVN0cmluZy5mcm9tQ2hhckNvZGUoT1tlKzQrbl0pO3JldHVybiBLdChlKSxyLmpvaW4oIiIpfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gcihlLHQpe3JldHVybiBlW3RdfXZhciBuO3QgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHQ9bmV3IFVpbnQ4QXJyYXkodCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5fHx0IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXk/bj1yOiJzdHJpbmciPT10eXBlb2YgdD9uPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuY2hhckNvZGVBdCh0KX06V2UoIkNhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gc3RkOjpzdHJpbmciKTt2YXIgbz10Lmxlbmd0aCxpPUp0KDQrbyk7TVtpPj4yXT1vO2Zvcih2YXIgYT0wO2E8bzsrK2Epe3ZhciBzPW4odCxhKTtzPjI1NSYmKEt0KGkpLFdlKCJTdHJpbmcgaGFzIFVURi0xNiBjb2RlIHVuaXRzIHRoYXQgZG8gbm90IGZpdCBpbiA4IGJpdHMiKSksT1tpKzQrYV09c31yZXR1cm4gbnVsbCE9PWUmJmUucHVzaChLdCxpKSxpfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOlJlLGRlc3RydWN0b3JGdW5jdGlvbjpmdW5jdGlvbihlKXtLdChlKX19KX0sX19lbWJpbmRfcmVnaXN0ZXJfc3RkX3dzdHJpbmc6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuLG87cj16ZShyKSwyPT09dD8obj1mdW5jdGlvbigpe3JldHVybiBOfSxvPTEpOjQ9PT10JiYobj1mdW5jdGlvbigpe3JldHVybiBNfSxvPTIpLFllKGUse25hbWU6cixmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW4oKSxyPU1bZT4+Ml0saT1uZXcgQXJyYXkociksYT1lKzQ+Pm8scz0wO3M8cjsrK3MpaVtzXT1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbYStzXSk7cmV0dXJuIEt0KGUpLGkuam9pbigiIil9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSxyKXt2YXIgaT1uKCksYT1yLmxlbmd0aCxzPUp0KDQrYSp0KTtNW3M+PjJdPWE7Zm9yKHZhciB1PXMrND4+byxjPTA7YzxhOysrYylpW3UrY109ci5jaGFyQ29kZUF0KGMpO3JldHVybiBudWxsIT09ZSYmZS5wdXNoKEt0LHMpLHN9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6UmUsZGVzdHJ1Y3RvckZ1bmN0aW9uOmZ1bmN0aW9uKGUpe0t0KGUpfX0pfSxfX2VtYmluZF9yZWdpc3Rlcl92YWx1ZV9vYmplY3Q6ZnVuY3Rpb24oZSx0LHIsbixvLGkpe1BlW2VdPXtuYW1lOnplKHQpLHJhd0NvbnN0cnVjdG9yOnZ0KHIsbikscmF3RGVzdHJ1Y3Rvcjp2dChvLGkpLGZpZWxkczpbXX19LF9fZW1iaW5kX3JlZ2lzdGVyX3ZhbHVlX29iamVjdF9maWVsZDpmdW5jdGlvbihlLHQscixuLG8saSxhLHMsdSxjKXtQZVtlXS5maWVsZHMucHVzaCh7ZmllbGROYW1lOnplKHQpLGdldHRlclJldHVyblR5cGU6cixnZXR0ZXI6dnQobixvKSxnZXR0ZXJDb250ZXh0Omksc2V0dGVyQXJndW1lbnRUeXBlOmEsc2V0dGVyOnZ0KHMsdSksc2V0dGVyQ29udGV4dDpjfSl9LF9fZW1iaW5kX3JlZ2lzdGVyX3ZvaWQ6ZnVuY3Rpb24oZSx0KXtZZShlLHtpc1ZvaWQ6ITAsbmFtZTp0PXplKHQpLGFyZ1BhY2tBZHZhbmNlOjAsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKCl7fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7fX0pfSxfYWJvcnQ6ZnVuY3Rpb24oKXtvLmFib3J0KCl9LF9lbXNjcmlwdGVuX21lbWNweV9iaWc6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBPLnNldChPLnN1YmFycmF5KHQsdCtyKSxlKSxlfSxfZ2V0ZW52OmZ1bmN0aW9uIGUodCl7cmV0dXJuIDA9PT10PzA6KHQ9dih0KSxNdC5oYXNPd25Qcm9wZXJ0eSh0KT8oZS5yZXQmJkt0KGUucmV0KSxlLnJldD0ocj1NdFt0XSxuPVMocikrMSwobz1KdChuKSkmJkEocixSLG8sbiksbykpOjApO3ZhciByLG4sb30sX2dldGdybmFtOmZ1bmN0aW9uKCl7by5wcmludEVycigibWlzc2luZyBmdW5jdGlvbjogZ2V0Z3JuYW0iKSxycigtMSl9LF9nZXRwd25hbTpmdW5jdGlvbigpe3Rocm93ImdldHB3bmFtOiBUT0RPIn0sX2pzQ2xvc2U6ZnVuY3Rpb24oKXtyZXR1cm4gYS5jbG9zZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9qc0NyZWF0ZTpmdW5jdGlvbihlKXtyZXR1cm4gYS5jcmVhdGUuY2FsbChudWxsLGsoZSkpfSxfanNPcGVuOmZ1bmN0aW9uKGUpe3JldHVybiBhLm9wZW4uY2FsbChudWxsLGsoZSkpfSxfanNSZWFkOmZ1bmN0aW9uKCl7cmV0dXJuIGEucmVhZC5hcHBseShudWxsLGFyZ3VtZW50cyl9LF9qc1NlZWs6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBhLnNlZWsuY2FsbChudWxsLGUsdCxiKHIpKX0sX2pzVGVsbDpmdW5jdGlvbigpe3JldHVybiBhLnRlbGwuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxfanNXcml0ZTpmdW5jdGlvbigpe3JldHVybiBhLndyaXRlLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sX2xsdm1fZWhfdHlwZWlkX2ZvcjpmdW5jdGlvbihlKXtyZXR1cm4gZX0sX2xvY2FsdGltZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24oZSx0KXtqdCgpO3ZhciByPW5ldyBEYXRlKDFlMypGW2U+PjJdKTtGW3Q+PjJdPXIuZ2V0U2Vjb25kcygpLEZbdCs0Pj4yXT1yLmdldE1pbnV0ZXMoKSxGW3QrOD4+Ml09ci5nZXRIb3VycygpLEZbdCsxMj4+Ml09ci5nZXREYXRlKCksRlt0KzE2Pj4yXT1yLmdldE1vbnRoKCksRlt0KzIwPj4yXT1yLmdldEZ1bGxZZWFyKCktMTkwMCxGW3QrMjQ+PjJdPXIuZ2V0RGF5KCk7dmFyIG49bmV3IERhdGUoci5nZXRGdWxsWWVhcigpLDAsMSksbz0oci5nZXRUaW1lKCktbi5nZXRUaW1lKCkpLzg2NGU1fDA7Rlt0KzI4Pj4yXT1vLEZbdCszNj4+Ml09LTYwKnIuZ2V0VGltZXpvbmVPZmZzZXQoKTt2YXIgaT1uZXcgRGF0ZSgyZTMsNiwxKS5nZXRUaW1lem9uZU9mZnNldCgpLGE9bi5nZXRUaW1lem9uZU9mZnNldCgpLHM9MHwoaSE9YSYmci5nZXRUaW1lem9uZU9mZnNldCgpPT1NYXRoLm1pbihhLGkpKTtGW3QrMzI+PjJdPXM7dmFyIHU9RltCdCsocz80OjApPj4yXTtyZXR1cm4gRlt0KzQwPj4yXT11LHR9KGUsSXQpfSxfbWt0aW1lOmZ1bmN0aW9uKGUpe2p0KCk7dmFyIHQ9bmV3IERhdGUoRltlKzIwPj4yXSsxOTAwLEZbZSsxNj4+Ml0sRltlKzEyPj4yXSxGW2UrOD4+Ml0sRltlKzQ+PjJdLEZbZT4+Ml0sMCkscj1GW2UrMzI+PjJdLG49dC5nZXRUaW1lem9uZU9mZnNldCgpLG89bmV3IERhdGUodC5nZXRGdWxsWWVhcigpLDAsMSksaT1uZXcgRGF0ZSgyZTMsNiwxKS5nZXRUaW1lem9uZU9mZnNldCgpLGE9by5nZXRUaW1lem9uZU9mZnNldCgpLHM9TWF0aC5taW4oYSxpKTtpZihyPDApRltlKzMyPj4yXT1OdW1iZXIoaSE9YSYmcz09bik7ZWxzZSBpZihyPjAhPShzPT1uKSl7dmFyIHU9TWF0aC5tYXgoYSxpKSxjPXI+MD9zOnU7dC5zZXRUaW1lKHQuZ2V0VGltZSgpKzZlNCooYy1uKSl9RltlKzI0Pj4yXT10LmdldERheSgpO3ZhciBsPSh0LmdldFRpbWUoKS1vLmdldFRpbWUoKSkvODY0ZTV8MDtyZXR1cm4gRltlKzI4Pj4yXT1sLHQuZ2V0VGltZSgpLzFlM3wwfSxfcHRocmVhZF9nZXRzcGVjaWZpYzpmdW5jdGlvbihlKXtyZXR1cm4gVXRbZV18fDB9LF9wdGhyZWFkX2tleV9jcmVhdGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gMD09ZT9tZS5FSU5WQUw6KEZbZT4+Ml09enQsVXRbenRdPTAsenQrKywwKX0sX3B0aHJlYWRfb25jZTpmdW5jdGlvbiBlKHQscil7ZS5zZWVufHwoZS5zZWVuPXt9KSx0IGluIGUuc2Vlbnx8KG8uZHluQ2FsbF92KHIpLGUuc2Vlblt0XT0xKX0sX3B0aHJlYWRfc2V0c3BlY2lmaWM6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZSBpbiBVdD8oVXRbZV09dCwwKTptZS5FSU5WQUx9LF90aW1lOmZ1bmN0aW9uKGUpe3ZhciB0PURhdGUubm93KCkvMWUzfDA7cmV0dXJuIGUmJihGW2U+PjJdPXQpLHR9LERZTkFNSUNUT1BfUFRSOiQsU1RBQ0tUT1A6VX07dmFyIFd0PW8uYXNtKG8uYXNtR2xvYmFsQXJnLG8uYXNtTGlicmFyeUFyZyxEKTtvLmFzbT1XdDt2YXIgWXQ9by5fX0dMT0JBTF9fc3ViX0lfYmluZF9jcHA9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uX19HTE9CQUxfX3N1Yl9JX2JpbmRfY3BwLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sVnQ9by5fX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX0dMT0JBTF9fc3ViX0lfYnJpZGdlX2NwcC5hcHBseShudWxsLGFyZ3VtZW50cyl9LEh0PW8uX19HTE9CQUxfX3N1Yl9JX2NyY19jcHA9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uX19HTE9CQUxfX3N1Yl9JX2NyY19jcHAuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxHdD1vLl9fR0xPQkFMX19zdWJfSV9nbG9iYWxfY3BwPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fR0xPQkFMX19zdWJfSV9nbG9iYWxfY3BwLmFwcGx5KG51bGwsYXJndW1lbnRzKX0scXQ9KG8uX19fY3hhX2Nhbl9jYXRjaD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX19jeGFfY2FuX2NhdGNoLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5fX19jeGFfaXNfcG9pbnRlcl90eXBlPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fX2N4YV9pc19wb2ludGVyX3R5cGUuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLl9fX2Vycm5vX2xvY2F0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9fX2Vycm5vX2xvY2F0aW9uLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5fX19nZXRUeXBlTmFtZT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fX19nZXRUeXBlTmFtZS5hcHBseShudWxsLGFyZ3VtZW50cyl9KSxYdD1vLl9lbXNjcmlwdGVuX3JlcGxhY2VfbWVtb3J5PWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLl9lbXNjcmlwdGVuX3JlcGxhY2VfbWVtb3J5LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sS3Q9by5fZnJlZT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fZnJlZS5hcHBseShudWxsLGFyZ3VtZW50cyl9LEp0PW8uX21hbGxvYz1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5fbWFsbG9jLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sWnQ9by5zZXRUZW1wUmV0MD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5zZXRUZW1wUmV0MC5hcHBseShudWxsLGFyZ3VtZW50cyl9LFF0PShvLnNldFRocmV3PWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLnNldFRocmV3LmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5zdGFja0FsbG9jPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLnN0YWNrQWxsb2MuYXBwbHkobnVsbCxhcmd1bWVudHMpfSk7by5keW5DYWxsX2RpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2RpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9pPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2lpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaWlpLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2lpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX2lpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlpaWlpPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWlpaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF9paWlpaWlqaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF9paWlpaWlqaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfaWpqPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfaWpqLmFwcGx5KG51bGwsYXJndW1lbnRzKX0sby5keW5DYWxsX2ppPWZ1bmN0aW9uKCl7cmV0dXJuIG8uYXNtLmR5bkNhbGxfamkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdj1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3YuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpZD1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWQuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaWlpaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpaWlpaWlpaWkuYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlpaWlpaWlpaWk9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWlpaWlpaWlpaS5hcHBseShudWxsLGFyZ3VtZW50cyl9LG8uZHluQ2FsbF92aWo9ZnVuY3Rpb24oKXtyZXR1cm4gby5hc20uZHluQ2FsbF92aWouYXBwbHkobnVsbCxhcmd1bWVudHMpfSxvLmR5bkNhbGxfdmlqaT1mdW5jdGlvbigpe3JldHVybiBvLmFzbS5keW5DYWxsX3ZpamkuYXBwbHkobnVsbCxhcmd1bWVudHMpfTtmdW5jdGlvbiBlcihlKXt0aGlzLm5hbWU9IkV4aXRTdGF0dXMiLHRoaXMubWVzc2FnZT0iUHJvZ3JhbSB0ZXJtaW5hdGVkIHdpdGggZXhpdCgiK2UrIikiLHRoaXMuc3RhdHVzPWV9ZnVuY3Rpb24gdHIoZSl7ZnVuY3Rpb24gdCgpe28uY2FsbGVkUnVufHwoby5jYWxsZWRSdW49ITAsbXx8KHRlfHwodGU9ITAsWChKKSksWChaKSxvLm9uUnVudGltZUluaXRpYWxpemVkJiZvLm9uUnVudGltZUluaXRpYWxpemVkKCksZnVuY3Rpb24oKXtpZihvLnBvc3RSdW4pZm9yKCJmdW5jdGlvbiI9PXR5cGVvZiBvLnBvc3RSdW4mJihvLnBvc3RSdW49W28ucG9zdFJ1bl0pO28ucG9zdFJ1bi5sZW5ndGg7KWU9by5wb3N0UnVuLnNoaWZ0KCksZWUudW5zaGlmdChlKTt2YXIgZTtYKGVlKX0oKSkpfXNlPjB8fCghZnVuY3Rpb24oKXtpZihvLnByZVJ1bilmb3IoImZ1bmN0aW9uIj09dHlwZW9mIG8ucHJlUnVuJiYoby5wcmVSdW49W28ucHJlUnVuXSk7by5wcmVSdW4ubGVuZ3RoOyllPW8ucHJlUnVuLnNoaWZ0KCksSy51bnNoaWZ0KGUpO3ZhciBlO1goSyl9KCksc2U+MHx8by5jYWxsZWRSdW58fChvLnNldFN0YXR1cz8oby5zZXRTdGF0dXMoIlJ1bm5pbmcuLi4iKSxzZXRUaW1lb3V0KChmdW5jdGlvbigpe3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7by5zZXRTdGF0dXMoIiIpfSksMSksdCgpfSksMSkpOnQoKSkpfWZ1bmN0aW9uIHJyKGUpe3Rocm93IG8ub25BYm9ydCYmby5vbkFib3J0KGUpLHZvaWQgMCE9PWU/KG8ucHJpbnQoZSksby5wcmludEVycihlKSxlPUpTT04uc3RyaW5naWZ5KGUpKTplPSIiLG09ITAsImFib3J0KCIrZSsiKS4gQnVpbGQgd2l0aCAtcyBBU1NFUlRJT05TPTEgZm9yIG1vcmUgaW5mby4ifWlmKG8uYXNtPVd0LGVyLnByb3RvdHlwZT1uZXcgRXJyb3IsZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yPWVyLHVlPWZ1bmN0aW9uIGUoKXtvLmNhbGxlZFJ1bnx8dHIoKSxvLmNhbGxlZFJ1bnx8KHVlPWUpfSxvLnJ1bj10cixvLmV4aXQ9ZnVuY3Rpb24oZSx0KXt0JiZvLm5vRXhpdFJ1bnRpbWUmJjA9PT1lfHwoby5ub0V4aXRSdW50aW1lfHwobT0hMCxVPXZvaWQgMCxYKFEpLG8ub25FeGl0JiZvLm9uRXhpdChlKSksbCYmcHJvY2Vzcy5leGl0KGUpLG8ucXVpdChlLG5ldyBlcihlKSkpfSxvLmFib3J0PXJyLG8ucHJlSW5pdClmb3IoImZ1bmN0aW9uIj09dHlwZW9mIG8ucHJlSW5pdCYmKG8ucHJlSW5pdD1bby5wcmVJbml0XSk7by5wcmVJbml0Lmxlbmd0aD4wOylvLnByZUluaXQucG9wKCkoKTtyZXR1cm4gby5ub0V4aXRSdW50aW1lPSEwLHRyKCksdH07ZnVuY3Rpb24gaSh7cmVzb3VyY2VJZDplLHVybDp0fSl7cmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbihlLG8pe2lmKCFyKXRocm93IG5ldyBFcnJvcigidW5wYWNrQnJpZGdlIG5vdCBkZXRlY3RlZCIpO2lmKCFuKXRocm93IG5ldyBFcnJvcigidW5wYWNrIG5vdCBkZXRlY3RlZCIpOyhmdW5jdGlvbihlKXtyZXR1cm4gZmV0Y2gobmV3IFJlcXVlc3QoZSkpLnRoZW4oZT0+e2lmKGUub2spcmV0dXJuIGUuYXJyYXlCdWZmZXIoKTt0aHJvdyBuZXcgRXJyb3IoIjQwNCBFcnJvcjogRmlsZSBub3QgZm91bmQuIil9KS50aGVuKGU9PnIuY3JlYXRlRXh0cmFjdG9yRnJvbURhdGEoZSkpfSkodCkudGhlbih0PT57ZSh0LmV4dHJhY3RBbGwoKSl9LGU9PntvKGUpfSl9KSl9ZnVuY3Rpb24gYShlLHQpe2NvbnN0W3Isbl09dDtpZigiRkFJTCI9PXIuc3RhdGUpe2NvbnN0IHQ9e3R5cGU6IkVSUk9SIixyZWFzb246ci5yZWFzb24sbXNnOnIubXNnLHJlc291cmNlSWQ6ZS5kYXRhLnJlc291cmNlSWQsdXJsOmUuZGF0YS51cmx9O3JldHVybiB2b2lkIHNlbGYucG9zdE1lc3NhZ2UodCl9Y29uc3Qgbz17dHlwZToiRklOSVNIRUQiLHJlc291cmNlSWQ6ZS5kYXRhLnJlc291cmNlSWQsZW50cmllczp7fX0saT1bXTtpZihuJiZuLmZpbGVzKWZvcihjb25zdCBlIG9mIG4uZmlsZXMpby5lbnRyaWVzW2UuZmlsZUhlYWRlci5uYW1lXT1lLmV4dHJhY3RbMV0saS5wdXNoKGUuZXh0cmFjdFsxXS5idWZmZXIpO3NlbGYucG9zdE1lc3NhZ2UobyxpKX1vbm1lc3NhZ2U9ZnVuY3Rpb24oZSl7aWYoImluaXQiPT1lLmRhdGEudHlwZSluPW8oZS5kYXRhLndhc21VcmwpLG4ub25SdW50aW1lSW5pdGlhbGl6ZWQ9KCk9PnBvc3RNZXNzYWdlKHt0eXBlOiJXQVNNX0xPQURFRCJ9KTtlbHNlIGlmKCJmZXRjaCI9PWUuZGF0YS50eXBlKWkoZS5kYXRhKS50aGVuKHQ9PnthKGUsdCl9LHQ9Pntjb25zdCByPXt0eXBlOiJFUlJPUiIscmVzb3VyY2VJZDplLmRhdGEucmVzb3VyY2VJZCx1cmw6ZS5kYXRhLnVybH07c2VsZi5wb3N0TWVzc2FnZShyKX0pO2Vsc2UgaWYoInVucGFjayI9PWUuZGF0YS50eXBlKXtjb25zdHtidWZmZXI6dH09ZS5kYXRhO2lmKCFyKXRocm93IG5ldyBFcnJvcigidW5wYWNrQnJpZGdlIG5vdCBkZXRlY3RlZCIpO2lmKCFuKXRocm93IG5ldyBFcnJvcigidW5wYWNrIG5vdCBkZXRlY3RlZCIpO2NvbnN0IG89ci5jcmVhdGVFeHRyYWN0b3JGcm9tRGF0YSh0KS5leHRyYWN0QWxsKCk7YShlLG8pfX07Cgo=",null,!1);function Ur(t){return t&&"object"==typeof t&&!Array.isArray(t)}function Jr(t){var e,a;var i=[];for(var n=1;n<arguments.length;n++){i[n-1]=arguments[n]}if(!i.length)return t;var r=i.shift();if(Ur(t)&&Ur(r))for(var o in r)Ur(r[o])?(t[o]||Object.assign(t,(e={},e[o]={},e)),Jr(t[o],r[o])):Object.assign(t,(a={},a[o]=r[o],a));return Jr.apply(void 0,__spreadArrays([t],i))}var Pr=new(function(){function t(){var t;this.loaded=new dr,this.progressIncremented=new dr,this.allResourcesLoaded=new dr,this.fileUpdated=new dr,this.__totalWork=0,this.__totalWorkByCategory={},this.__doneWork=0,this.__doneWorkByCategory={},this.__resourceRegisterCallbacks={},this.__callbacks={},this.__resources={},this.__resourcesTreeEntities={},this.__resourcesTree={children:{}},this.__workers=[],this.__nextWorker=0;var e=document.getElementsByTagName("script");for(var a=0;a<e.length;a++){var i=e[a];if(i.src.includes("zea-engine")){var n=i.src.split("/");n.pop(),n.pop(),t=n.join("/");break}}t||(t="https://unpkg.com/@zeainc/zea-engine@0.1.3"),this.wasmUrl=t+"/public-resources/unpack.wasm",this.addResourceURL("ZeaEngine/Vive.vla",t+"/public-resources/Vive.vla"),this.addResourceURL("ZeaEngine/Oculus.vla",t+"/public-resources/Oculus.vla")}t.prototype.getRootFolder=function(){return this.__resourcesTree};t.prototype.registerResourceCallback=function(t,e){this.__resourceRegisterCallbacks[t]=e;for(var a in this.__resources){var i=this.__resources[a];i.name.includes(t)&&e(i)}};t.prototype.__applyCallbacks=function(t){var e=this;var a=function(t){for(var a in e.__resourceRegisterCallbacks)t.name.includes(a)&&e.__resourceRegisterCallbacks[a](t)};for(var i in t){var n=t[i];n.url&&a(n)}};t.prototype.__buildTree=function(t){var e=this;var a=function(i){if(e.__resourcesTreeEntities[i])return;var n=t[i];n.id=i,"folder"!==n.type&&"dependency"!==n.type||(n.children={}),n.parent&&(e.__resourcesTreeEntities[n.parent]||a(n.parent)),(n.parent?e.__resourcesTreeEntities[n.parent]:e.__resourcesTree).children[n.name]=n,e.__resourcesTreeEntities[i]=n};for(var i in t)a(i)};t.prototype.setResources=function(t){this.__resources=Object.assign(this.__resources,t),this.__buildTree(t),this.__applyCallbacks(t)};t.prototype.addResourceURL=function(t,e){var a=t.split("/"),i=a.pop();if(!e){var n=window.location.href.split("#")[0];n=n.split("?")[0],(n.endsWith(".html")||n.endsWith(".html"))&&(n=n.substring(0,n.lastIndexOf("/"))+"/");var r=n;if("."==a[0])a.shift();else if(".."==a[0]){item=item.substring(3);var o=r.split("/");o.pop(),o.pop(),r=o.join("/")+"/"}e=r+t}var l;var s={};for(var d=0,c=a;d<c.length;d++){var u=c[d];var h=Pn(u);h in this.__resources||(this.__resources[h]={name:u,type:"folder",parent:l},s[h]=this.__resources[h]),l=h}var m=Pn(i),p={name:i,url:e,parent:l,id:m};this.__resources[m]=p,s[m]=p,this.__buildTree(s),this.__applyCallbacks(s)};t.prototype.updateFile=function(t){var e=!(t.id in this.__resources);if(this.__resources[t.id]=t,e){console.log("New file added");var a={};a[t.id]=t,this.__buildTree(a)}this.fileUpdated.emit(t.id)};t.prototype.freeData=function(t){};t.prototype.__getWorker=function(){var t=this;return this.__nextWorker=(this.__nextWorker+1)%3,null==this.__workers[this.__nextWorker]&&(this.__workers[this.__nextWorker]=function(){return new Promise((function(e){var a=new zr;a.postMessage({type:"init",wasmUrl:t.wasmUrl}),a.onmessage=function(i){if("WASM_LOADED"===i.data.type)e(a);else if("FINISHED"===i.data.type){t.addWorkDone(i.data.resourceId,1),t.__onFinishedReceiveFileData(i.data)}else if("ERROR"===i.data.type){var n=i.data,r=t.__resources[n.resourceId];console.error("Unable to load Resource:",r?r.name:n.resourceId," With url:",n.url)}}}))}()),this.__workers[this.__nextWorker]};t.prototype.__terminateWorkers=function(){for(var t=0,e=this.__workers;t<e.length;t++){var a=e[t];a.terminate()}this.__workers=[]};t.prototype.getFilepath=function(t){var e=this.__resources[t];var a=[e.name];for(;e.parent;)e=this.__resources[e.parent],a.splice(0,0,e.name);return a.join("/")};t.prototype.resourceAvailable=function(t){return t.indexOf(".")>0?(console.warn("Deprecation warning for resourceAvailable. Value should be a file id, not a path."),null!=this.resolveFilepath(t)):t in this.__resources};t.prototype.getFile=function(t){return this.__resources[t]};t.prototype.resolveFilePathToId=function(t){if(!t)return void console.warn("Invalid file path:",t);var e=this.resolveFilepath(t);return e?e.id:void 0};t.prototype.resolveFilepath=function(t){var e=t.split("/");"."!=e[0]&&""!=e[0]||e.shift();var a=this.__resourcesTree;for(var i=0,n=e;i<n.length;i++){var r=n[i];if(!(r in a.children))return console.warn("Unable to resolve key:"+r+" of path:"+t),null;a=a.children[r]}return a};t.prototype.resolveFile=function(t){return console.warn("Deprecation warning for resolveFile. Use resolveFilepath."),this.resolveFilepath(t)};t.prototype.resolveURL=function(t){console.warn("Deprecation warning for resolveURL. Use resolveFilepath.");var e=this.resolveFilepath(t);if(e)return e.url};t.prototype.addWork=function(t,e){this.__totalWork+=e,this.progressIncremented.emit(this.__doneWork/this.__totalWork*100)};t.prototype.addWorkDone=function(t,e){if(this.__doneWork+=e,this.progressIncremented.emit(this.__doneWork/this.__totalWork*100),this.__doneWork>this.__totalWork)throw new Error("Mismatch between work loaded and work done.");this.__doneWork==this.__totalWork&&this.allResourcesLoaded.emit()};t.prototype.loadResource=function(t,e,a){if(a===void 0){a=!0}var i=this.getFile(t);if(!i)throw new Error("Invalid resource Id:'"+t+"' not found in Resources:"+JSON.stringify(this.__resources,null,2));this.loadUrl(t,i.url,e,a)};t.prototype.loadURL=function(t,e,a,i){if(i===void 0){i=!0}return console.warn("Please call loadUrl instead,"),this.loadUrl(t,e,a,i)};t.prototype.loadUrl=function(t,e,a,i){var n=this;if(i===void 0){i=!0}i&&this.addWork(t,3),t in this.__callbacks||(this.__callbacks[t]=[]),this.__callbacks[t].push(a),fetch(e).then((function(t){return function(t){if(!t.ok)throw new Error("HTTP "+t.status+" - "+t.statusText);return t}(t)&&t.arrayBuffer()})).then((function(e){n.__getWorker().then((function(a){a.postMessage({type:"unpack",resourceId:t,buffer:e})}))}))};t.prototype.unpackBuffer=function(t,e,a,i){var n=this;if(i===void 0){i=!0}return new Promise((function(r,o){i&&n.addWork(t,3),t in n.__callbacks||(n.__callbacks[t]=[]),a&&n.__callbacks[t].push(a),n.__callbacks[t].push((function(t){r(t)})),n.__getWorker().then((function(a){a.postMessage({type:"unpack",resourceId:t,buffer:e},[e])}))}))};t.prototype.__onFinishedReceiveFileData=function(t){var e=t.resourceId;this.addWorkDone(e,1);var a=this.__callbacks[e];if(a){for(var i=0,n=a;i<n.length;i++){var r=n[i];r(t.entries)}delete this.__callbacks[e]}this.loaded.emit(e),this.addWorkDone(e,1)};t.prototype.suspend=function(){this.__terminateWorkers()};t.prototype.traverse=function(t){var e=function(t){for(var e in t.children)a(t.children[e])},a=function(a){if(0==t(a))return!1;a.children&&e(a)};e(this.__resourcesTree)};return t}());var Er=function(){function t(t){if(t){var e=t.split("-"),a=e[0].split(".");this.major=parseInt(a[0]),this.minor=parseInt(a[1]),this.patch=parseInt(a[2]),2==e.length&&(this.branch=e[1])}else this.major=0,this.minor=0,this.patch=0}t.prototype.equals=function(t){return!(this.patch==t[2]&&this.minor==t[1]&&this.major==t[0])};t.prototype.lessThan=function(t){return!(this.major>=t[0]||this.minor>=t[1]||this.patch>=t[2])};t.prototype.greaterThan=function(t){return this.major>t[0]||this.minor>t[1]||this.patch>t[2]};t.prototype.greaterOrEqualThan=function(t){return!(this.major<t[0])&&(this.major>t[0]||!(this.minor<t[1])&&(this.minor>t[1]||!(this.patch<t[2])))};return t}();var Hr=function(){function t(t,e,a){if(e===void 0){e=0}if(a===void 0){a=!0}this.__data=t,this.__byteOffset=e,this.__dataView=new DataView(this.__data),this.__isMobileDevice=a,this.utf8decoder=new TextDecoder}Object.defineProperty(t.prototype,"isMobileDevice",{get:function(){return this.__isMobileDevice},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"data",{get:function(){return this.__data},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"byteLength",{get:function(){return this.__dataView.byteLength},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"remainingByteLength",{get:function(){return this.__dataView.byteLength-this.__byteOffset},enumerable:true,configurable:true});t.prototype.pos=function(){return this.__byteOffset};t.prototype.seek=function(t){this.__byteOffset=t};t.prototype.advance=function(t){this.__byteOffset+=t};t.prototype.loadUInt8=function(){var t=this.__dataView.getUint8(this.__byteOffset);return this.__byteOffset+=1,t};t.prototype.loadUInt16=function(){var t=this.__dataView.getUint16(this.__byteOffset,!0);return this.__byteOffset+=2,t};t.prototype.loadUInt32=function(){var t=this.__dataView.getUint32(this.__byteOffset,!0);return this.__byteOffset+=4,t};t.prototype.loadSInt32=function(){var t=this.__dataView.getInt32(this.__byteOffset,!0);return this.__byteOffset+=4,t};t.prototype.loadFloat16=function(){var t=this.loadUInt16();return Math.decode16BitFloat(t)};t.prototype.loadUFloat16=function(){var t=this.loadFloat16();return t<0?2048-t:t};t.prototype.loadFloat16From2xUInt8=function(){var t=this.__dataView.getFloat16(this.__byteOffset,!0);return this.__byteOffset+=2,t};t.prototype.loadUInt32From2xUFloat16=function(){return this.loadUFloat16()+4096*this.loadUFloat16()};t.prototype.loadSInt32From2xFloat16=function(){return this.loadFloat16()+2048*this.loadFloat16()};t.prototype.loadFloat32=function(){var t=this.__dataView.getFloat32(this.__byteOffset,!0);return this.__byteOffset+=4,t};t.prototype.loadUInt8Array=function(t,e){if(e===void 0){e=!1}null==t&&(t=this.loadUInt32());var a=new Uint8Array(this.__data,this.__byteOffset,t);this.__byteOffset+=t;return a};t.prototype.loadUInt16Array=function(t,e){if(e===void 0){e=!1}if(null==t&&(t=this.loadUInt32()),0==t)return new Uint16Array;var a;if(this.readPadd(2),this.__isMobileDevice){a=new Uint16Array(t);for(var i=0;i<t;i++)a[i]=this.__dataView.getUint16(this.__byteOffset,!0),this.__byteOffset+=2}else a=new Uint16Array(this.__data,this.__byteOffset,t),this.__byteOffset+=2*t;return a};t.prototype.loadUInt32Array=function(t,e){if(e===void 0){e=!1}if(null==t&&(t=this.loadUInt32()),0==t)return new Uint32Array;var a;if(this.readPadd(4),this.__isMobileDevice){a=new Uint32Array(t);for(var i=0;i<t;i++)a[i]=this.__dataView.getUint32(this.__byteOffset,!0),this.__byteOffset+=4}else a=new Uint32Array(this.__data,this.__byteOffset,t),this.__byteOffset+=4*t;return a};t.prototype.loadFloat32Array=function(t,e){if(e===void 0){e=!1}if(null==t&&(t=this.loadUInt32()),0==t)return new Float32Array;var a;if(this.readPadd(4),this.__isMobileDevice){a=new Float32Array(t);for(var i=0;i<t;i++)a[i]=this.__dataView.getFloat32(this.__byteOffset,!0),this.__byteOffset+=4}else a=new Float32Array(this.__data,this.__byteOffset,t),this.__byteOffset+=4*t;return a};t.prototype.loadStr=function(){var t=this.loadUInt32(),e=new Uint8Array(this.__data,this.__byteOffset,t);return this.__byteOffset+=t,this.utf8decoder.decode(e)};t.prototype.loadStrArray=function(){var t=this.loadUInt32(),e=[];for(var a=0;a<t;a++)e[a]=this.loadStr();return e};t.prototype.loadSInt32Vec2=function(){var t=this.loadSInt32(),e=this.loadSInt32();return new Bn(t,e)};t.prototype.loadUInt32Vec2=function(){var t=this.loadUInt32(),e=this.loadUInt32();return new Bn(t,e)};t.prototype.loadFloat16Vec2=function(){var t=this.loadFloat16(),e=this.loadFloat16();return new Bn(t,e)};t.prototype.loadFloat32Vec2=function(){var t=this.loadFloat32(),e=this.loadFloat32();return new Bn(t,e)};t.prototype.loadFloat16Vec3=function(){var t=this.loadFloat16(),e=this.loadFloat16(),a=this.loadFloat16();return new Dn(t,e,a)};t.prototype.loadFloat32Vec3=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32();return new Dn(t,e,a)};t.prototype.loadFloat16Quat=function(){var t=this.loadFloat16(),e=this.loadFloat16(),a=this.loadFloat16(),i=this.loadFloat16();return new tr(t,e,a,i)};t.prototype.loadFloat32Quat=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32(),i=this.loadFloat32();return new tr(t,e,a,i)};t.prototype.loadRGBFloat32Color=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32();return new An(t,e,a)};t.prototype.loadRGBAFloat32Color=function(){var t=this.loadFloat32(),e=this.loadFloat32(),a=this.loadFloat32(),i=this.loadFloat32();return new An(t,e,a,i)};t.prototype.loadRGBUInt8Color=function(){var t=this.loadUInt8(),e=this.loadUInt8(),a=this.loadUInt8();return new An(t/255,e/255,a/255)};t.prototype.loadRGBAUInt8Color=function(){var t=this.loadUInt8(),e=this.loadUInt8(),a=this.loadUInt8(),i=this.loadUInt8();return new An(t/255,e/255,a/255,i/255)};t.prototype.loadBox2=function(){return new ir(this.loadFloat32Vec2(),this.loadFloat32Vec2())};t.prototype.loadBox3=function(){return new rr(this.loadFloat32Vec3(),this.loadFloat32Vec3())};t.prototype.readPadd=function(t){var e=this.__byteOffset%t;0!=e&&(this.__byteOffset+=t-e)};return t}();var kr=function(){function t(t){if(t===void 0){t=0}this.__data=new ArrayBuffer(t),this.__byteOffset=0,this.__reserved=t,this.__dataView=new DataView(this.__data)}t.prototype.pos=function(){return this.__byteOffset};t.prototype.seek=function(t){this.__byteOffset=t};t.prototype.seekEnd=function(){this.__byteOffset=this.__reserved};t.prototype.getBuffer=function(){if(this.__data.byteLength==this.__byteOffset)return this.__data;return new Uint8Array(this.__data).slice(0,this.__byteOffset).buffer};t.prototype.__grow=function(){var t=2*(this.__reserved>0?this.__reserved:1),e=new ArrayBuffer(t),a=new Uint8Array(e),i=new Uint8Array(this.__data);a.set(i),this.__data=e,this.__dataView=new DataView(this.__data),this.__reserved=t};t.prototype.__reserve=function(t){this.__byteOffset+t>this.__reserved&&this.__grow()};t.prototype.__offset=function(t){this.__byteOffset+=t,this.__byteOffset>this.__reserved&&this.__grow()};t.prototype.writeUInt8=function(t){this.__reserve(1),this.__dataView.setUint8(this.__byteOffset,t),this.__offset(1)};t.prototype.writeUInt16=function(t){this.__reserve(2),this.__dataView.setUint16(this.__byteOffset,t,!0),this.__offset(2)};t.prototype.writeUInt32=function(t){this.__reserve(4),this.__dataView.setUint32(this.__byteOffset,t,!0),this.__offset(4)};t.prototype.writeSInt32=function(t){this.__reserve(4),this.__dataView.setInt32(this.__byteOffset,t,!0),this.__offset(4)};t.prototype.writeFloat16=function(t){var e=Math.encode16BitFloat(t);this.writeUInt16(e)};t.prototype.writeFloat32=function(t){this.__reserve(4),this.__dataView.setFloat32(this.__byteOffset,t,!0),this.__offset(4)};t.prototype.writeUInt8Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeUInt8(t[i])};t.prototype.writeUInt16Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(2*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeUInt16(t[i])};t.prototype.writeUInt32Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(4*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeUInt32(t[i])};t.prototype.writeFloat32Array=function(t,e){if(e===void 0){e=!0}var a=t.size?t.size:t.length;this.__reserve(4*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeFloat32(t[i])};t.prototype.writeStr=function(t,e){if(e===void 0){e=!0}var a=value.length;this.__reserve(4*a+(e?4:0)),e&&this.writeUInt32(a);for(var i=0;i<a;i++)this.writeFloat32(value.charCodeAt(i))};t.prototype.writeSInt32Vec2=function(t){this.writeSInt32(t.x),this.writeSInt32(t.y)};t.prototype.writeUInt32Vec2=function(t){this.writeUInt32(t.x),this.writeUInt32(t.y)};t.prototype.writeFloat16Vec2=function(t){this.writeFloat16(t.x),this.writeFloat16(t.y)};t.prototype.writeFloat32Vec2=function(t){this.writeFloat32(t.x),this.writeFloat32(t.y)};t.prototype.writeFloat16Vec3=function(t){this.writeFloat16(t.x),this.writeFloat16(t.y),this.writeFloat16(t.z)};t.prototype.writeFloat32Vec3=function(t){this.writeFloat32(t.x),this.writeFloat32(t.y),this.writeFloat32(t.z)};t.prototype.writeFloat16Quat=function(t){this.writeFloat16(t.x),this.writeFloat16(t.y),this.writeFloat16(t.z),this.writeFloat16(t.w)};t.prototype.writeFloat32Quat=function(t){this.writeFloat32(t.x),this.writeFloat32(t.y),this.writeFloat32(t.z),this.writeFloat32(t.w)};t.prototype.writeRGBFloat32Color=function(t){this.writeFloat32(t.r),this.writeFloat32(t.g),this.writeFloat32(t.b)};t.prototype.writeRGBAFloat32Color=function(t){this.writeFloat32(t.r),this.writeFloat32(t.g),this.writeFloat32(t.b),this.writeFloat32(t.a)};t.prototype.writeRGBUInt8Color=function(t){this.writeUInt8(t.r),this.writeUInt8(t.g),this.writeUInt8(t.b)};t.prototype.writeRGBAUInt8Color=function(t){this.writeUInt8(t.r),this.writeUInt8(t.g),this.writeUInt8(t.b),this.writeUInt8(t.a)};t.prototype.writeBox2=function(t){this.writeFloat32Vec2(t.p0),this.writeFloat32Vec2(t.p1)};t.prototype.writeBox3=function(t){this.writeFloat32Vec3(t.p0),this.writeFloat32Vec3(t.p1)};t.prototype.writePadd=function(t){var e=t-this.__byteOffset;this.__reserve(e),this.__offset(e)};t.prototype.writeAlignment=function(t){var e=this.__byteOffset%t;0!=e&&(this.__reserve(t-e),this.__offset(t-e))};return t}();var Br=function(t){__extends(e,t);function e(e,a,i,n){if(a===void 0){a=0}var r=this;r=t.call(this,e,a,"Number")||this,i&&!Array.isArray(i)&&console.error("Range value must be an array of 2 numbers."),r.__range=i,r.__step=n;return r}e.prototype.setValue=function(e,a){a==gr.USER_SETVALUE&&(this.__range&&(e=Math.clamp(e,this.__range[0],this.__range[1])),this.__step&&(e=Math.round(e/this.__step)*this.__step)),t.prototype.setValue.call(this,e,a)};e.prototype.getValue=function(e){return t.prototype.getValue.call(this,e)};e.prototype.getRange=function(){return this.__range};e.prototype.setRange=function(t){return this.__range=t,this};e.prototype.getStep=function(){return this.__step};e.prototype.setStep=function(t){return this.__step=t,this};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.__range&&(i.range=this.__range),this.__step&&(i.step=this.__step),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.range&&(this.__range=e.range),e.step&&(this.__step=e.step)};e.prototype.readBinary=function(t,e){var a=t.loadFloat32();this.setValue(a,gr.DATA_LOAD)};e.prototype.clone=function(t){var a=new e(this.__name,this.__value);return a.__range=this.__range,a.__step=this.__step,a};return e}(Vr);br.registerClass("NumberParameter",Br),br.registerClass("Property_SInt32",Br),br.registerClass("Property_UInt32",Br),br.registerClass("Property_Float32",Br);var Dr=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a,[0,i.length],1)||this,n.choices=i;return n}e.prototype.getChoices=function(){return this.choices};e.prototype.setValue=function(e,a){"string"==typeof e?t.prototype.setValue.call(this,this.choices.indexOf(e),a):t.prototype.setValue.call(this,e,a)};return e}(Br);var Or=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a,"Boolean")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(Vr);br.registerClass("BooleanParameter",Or);var Qr=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a||new Bn,"Vec2")||this,n.__range=i;return n}e.prototype.getRange=function(){return this.__range};e.prototype.__setRange=function(t){this.__range=t,this.rangeChanged.emit()};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Vr);var Ar=function(t){__extends(e,t);function e(e,a,i){return t.call(this,e,a||new Dn,"Vec3")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Vr);var jr=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new On,"Vec4")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Vr);var qr=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new An,"Color")||this}e.prototype.readBinary=function(t,e){var a=t.loadRGBAFloat32Color();a.applyGamma(2.2),this.setValue(a,gr.DATA_LOAD)};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Vr);br.registerClass("ColorParameter",qr);var $r=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new qn,"Mat3")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Vr);var to=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new $n,"Mat4")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Vr);var eo=function(t){__extends(e,t);function e(e,a){return t.call(this,e,a||new ar,"Xfo")||this}e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Vr);var ao=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a,"BaseImage")||this,i.valueParameterValueChanged=new dr;return i}e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.__value&&(i.imageType=br.getClassName(this.__value)),i};e.prototype.fromJSON=function(e,a,i){return e.imageType&&(this.__value=br.constructClass(e.imageType)),t.prototype.fromJSON.call(this,e,a,i)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(Vr);var io=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=""}var i=this;i=t.call(this,e,a,"String")||this,i.multiLine=!1;return i}e.prototype.setMultiLine=function(t){this.multiLine=t};e.prototype.getMultiLine=function(){return this.multiLine};e.prototype.readBinary=function(t,e){var a=t.loadStr();this.setValue(a,gr.DATA_LOAD)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(Vr);br.registerClass("StringParameter",io),br.registerClass("Property_String",io);var no=function(t){__extends(e,t);function e(e,a){if(a===void 0){a=""}var i=this;i=t.call(this,e,a,"String")||this,i.lang="js";return i}e.prototype.setLanguage=function(t){this.lang=t};e.prototype.getLanguage=function(){return this.lang};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(io);br.registerClass("CodeParameter",no);var ro=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,"","FilePath")||this,i.fileUpdated=new dr,a&&i.setSupportedExts(a);return i}e.prototype.setSupportedExts=function(t){this.__reextensions=new RegExp("\\.("+t+")$","i")};e.prototype.getFilepath=function(){return this.__file?Pr.getFilepath(this.__file.id):""};e.prototype.setFilepath=function(t,e){var a=Pr.resolveFilePathToId(t);a?this.setValue(a,e):console.warn("Resource unavailable:"+t)};e.prototype.getFilename=function(){if(this.__file)return this.__file.name};e.prototype.getExt=function(){var t=this.getFilename(),e=t.lastIndexOf(".");if(-1!=e)return t.substring(e).toLowerCase()};e.prototype.getStem=function(){var t=this.getFilename();if(t){var e=t.split(".");return 2==e.length?e[0]:t}};e.prototype.getFileFolder=function(){if(this.__file)return this.__file.parent?Pr.getFile(this.__file.parent):Pr.getRootFolder()};e.prototype.getFileFolderPath=function(){var t=this.getFilepath();if(t)return t.substring(0,t.lastIndexOf("/"))+"/"};e.prototype.getFile=function(){return this.__file};e.prototype.getFileDesc=function(){return this.__file};e.prototype.setUrl=function(t,e,a){if(a===void 0){a=gr.USER_SETVALUE}var i=t.split("/");e||(e=i[i.length-1]),this.__value=e,this.__file={id:t,name:e,url:t},a!=gr.USER_SETVALUE&&a!=gr.REMOTEUSER_SETVALUE||(this.__flags|=_r.USER_EDITED),this.valueChanged.emit(a)};e.prototype.getUrl=function(){return this.__file?this.__file.url:void 0};e.prototype.setDirty=function(t){throw new Error("Cannot drive a filepath param from an oporator")};e.prototype.setValue=function(t,e){var a=this;if(e===void 0){e=gr.USER_SETVALUE}if(null==t)throw new Error("Invalid value for setValue.");if(t.indexOf(".")>0)return console.warn("Deprecation warning for setValue. setValue should now only take a file id, not a path."),this.setFilepath(t,e);if(t==this.__value)return;var i=t;if(!Pr.resourceAvailable(i))return void console.warn("Resource unavailable:"+i);var n=Pr.getFile(i);if(this.__reextensions&&!this.__reextensions.test(n.name))return console.warn("Unsupported file type:"+n.name),!1;this.__value=t,this.__file=n,Pr.fileUpdated.connect((function(t){t==a.__value&&(a.__file=Pr.getFile(a.__value),a.fileUpdated.emit())})),e==gr.USER_SETVALUE&&(this.__flags|=_r.USER_EDITED),this.valueChanged.emit(e)};e.prototype.toJSON=function(t,e){if(0==(this.__flags&_r.USER_EDITED))return;var a={};return this.__file&&(a.value=this.__file.id,a.filepath=Pr.getFilepath(this.__file.id)),a};e.prototype.fromJSON=function(t,e,a){if(t.value){if(t.value.indexOf(".")>0)return void this.setFilepath(t.value,gr.DATA_LOAD);if(Pr.resourceAvailable(t.value))return this.setValue(t.value,gr.DATA_LOAD),void(this.__flags|=_r.USER_EDITED)}if(t.filepath){var i=Pr.resolveFilePathToId(t.filepath);if(i)return void this.setValue(i,gr.DATA_LOAD);console.warn("Resource unavailable:"+t.filepath)}};e.prototype.clone=function(t){var a=new e(this.__name);return a.__file=this.__file,a};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(Vr);var oo=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,[])||this,i.__dataType=a,i.elementAdded=new dr,i.elementRemoved=new dr;return i}e.prototype.__filter=function(t){return!0};e.prototype.getCount=function(){return this.__value.length};e.prototype.getElement=function(t){return this.__value[t]};e.prototype.setElement=function(t,e){this.__value[t]=e,this.valueChanged.emit(gr.USER_SETVALUE)};e.prototype.addElement=function(t){if(null==t)t=new this.__dataType;else if(!this.__filter(t))return;return this.__value.push(t),this.__flags|=_r.USER_EDITED,this.elementAdded.emit(t,this.__value.length-1),this.valueChanged.emit(gr.USER_SETVALUE),t};e.prototype.removeElement=function(t){var e=this.__value[t];this.__value.splice(t,1),this.__flags|=_r.USER_EDITED,this.elementRemoved.emit(e,t),this.valueChanged.emit(gr.USER_SETVALUE)};e.prototype.insertElement=function(t,e){this.__filter(e)&&(this.__value.splice(t,0,e),this.__flags|=_r.USER_EDITED,this.elementAdded.emit(e,t),this.valueChanged.emit(gr.USER_SETVALUE))};e.prototype.toJSON=function(t,e){if(0==(this.__flags&_r.USER_EDITED))return;var a=[];for(var i=0,n=this.__value;i<n.length;i++){var r=n[i];"string"==typeof this.__dataType?a.push(r):a.push(r.toJSON(t,e))}return{items:a}};e.prototype.fromJSON=function(t,e,a){if(null!=t.items){this.__flags|=_r.USER_EDITED,this.__value=[];for(var i=0;i<t.items.length;i++){var n=void 0;"string"==typeof this.__dataType?n=t.items[i]:(n=new this.__dataType,n.fromJSON(t.items[i],e)),this.__value.push(n),this.elementAdded.emit(n,this.__value.length-1)}this.valueChanged.emit(gr.DATA_LOAD)}else console.warn("Invalid Parameter JSON")};e.prototype.clone=function(t){var a=this.__value.slice(0),i=new e(this.__name,this.__dataType);return i.setValue(a),i};e.prototype.destroy=function(){for(var t=0;t<this.__value.length;t++)this.__value[t]instanceof Vr&&this.__value[t].destroy(),this.removeElement(t)};return e}(Vr);var lo=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e,{},"Struct")||this,a.__members=[];return a}e.prototype._addMember=function(t){var e=this;return this.__value[t.getName()]=t.getValue(),t.valueChanged.connect((function(){e.__value[t.getName()]=t.getValue()})),this.__members.push(t),this.__flags|=_r.USER_EDITED,this.valueChanged.emit(),t};e.prototype.getParameter=function(t){for(var e=0,a=this.__members;e<a.length;e++){var i=a[e];if(i.getName()==t)return i}};e.prototype.getMember=function(t){return this.getParameter(t)};e.prototype.getMemberNames=function(){var t=[];for(var e=0;e<this.__members.length;e++){var a=this.__members[e];null!=a&&(t[e]=a.getName())}return t};e.prototype.toJSON=function(t,e){if(0==(this.__flags&_r.USER_EDITED))return;var a=[];for(var i=0,n=this.__members;i<n.length;i++){var r=n[i];a.push(r.toJSON(t,e))}return{members:a}};e.prototype.fromJSON=function(t,e,a){if(null!=t.members){this.__flags|=_r.USER_EDITED;for(var i=0;i<t.members.length;i++)t.members[i]&&this.__members[i].fromJSON(t.members[i],e)}else console.warn("Invalid Parameter JSON")};e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0,a=this.__members;e<a.length;e++){var i=a[e];i.destroy()}};return e}(Vr);var so=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,"TreeItem")||this,i.__filterFn=a,i.treeItemGlobalXfoChanged=new dr;return i}e.prototype.setOwner=function(t){this.__owner=t};e.prototype.getOwner=function(){return this.__owner};e.prototype.setFilterFn=function(){this.__filterFn=filterFn};e.prototype.getFilterFn=function(){return this.__filterFn};e.prototype.setValue=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}if(this.__filterFn&&!this.__filterFn(t))return!1;this.__value!==t&&(this.__value&&this.__value.globalXfoChanged.disconnect(this.treeItemGlobalXfoChanged.emit),this.__value=t,this.__value&&this.__value.globalXfoChanged.connect(this.treeItemGlobalXfoChanged.emit),e!=gr.USER_SETVALUE&&e!=gr.REMOTEUSER_SETVALUE||(this.__flags|=_r.USER_EDITED),this.valueChanged.emit(e))};e.prototype.toJSON=function(t,e){if(0!=(this.__flags&_r.USER_EDITED))return{value:t.makeRelative(this.__value.getPath())}};e.prototype.fromJSON=function(t,e,a){var i=this;null!=t.value?(e.resolvePath(t.value,(function(t){i.setValue(t)}),(function(){console.warn("Unable to resolve tree item parameter value:"+pj.paramPath)})),this.__flags|=_r.USER_EDITED):console.warn("Invalid Parameter JSON")};e.prototype.clone=function(t){return new e(this.__name,this.__filterFn)};e.prototype.destroy=function(){this.__value&&this.__value.parameterValueChanged.disconnect(this.valueParameterValueChanged.emit)};return e}(Vr);var co=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,"BaseItem")||this,i.__items=new Set,i.__filterFn=a,i.itemAdded=new dr,i.itemRemoved=new dr;return i}e.prototype.setFilterFn=function(t){this.__filterFn=t};e.prototype.getFilterFn=function(){return this.__filterFn};e.prototype.getItem=function(t){return Array.from(this.__items)[t]};e.prototype.addItem=function(t,e){if(e===void 0){e=!0}if(this.__filterFn&&!this.__filterFn(t))return console.warn("ItemSet __filterFn rejecting item:",t.getPath()),!1;this.__items.add(t);var a=Array.from(this.__items).indexOf(t);return this.itemAdded.emit(t,a),e&&this.valueChanged.emit(),a};e.prototype.addItems=function(t,e){var a=this;if(e===void 0){e=!0}t.forEach((function(t){return a.addItem(t,!1)})),e&&this.valueChanged.emit()};e.prototype.removeItem=function(t,e){if(e===void 0){e=!0}var a=Array.from(this.__items)[t];return this.__items.delete(a),this.itemRemoved.emit(a,t),e&&this.valueChanged.emit(),a};e.prototype.setItems=function(t,e){if(e===void 0){e=!0}for(var a=this.__items.length-1;a>=0;a--){var i=this.__items[a];t.has(i)||this.removeItem(i,!1)}for(var n=0,r=t;n<r.length;n++){var o=r[n];this.__items.has(o)||this.addItem(o,!1)}e&&this.valueChanged.emit()};e.prototype.clearItems=function(t){if(t===void 0){t=!0}this.__items.clear(),t&&this.valueChanged.emit()};e.prototype.getNumItems=function(){return Array.from(this.__items).length};e.prototype.getValue=function(){return this.__items};e.prototype.toJSON=function(t,e){return{}};e.prototype.fromJSON=function(t,e,a){};e.prototype.clone=function(t){return new e(this.__name,this.__filterFn)};return e}(Vr);var uo=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,a.getDataType())||this,i.setSourceParameter(a);return i}e.prototype.setSourceParameter=function(t){this.sourceParameter=t,this.sourceParameter.valueChanged.connect(this.__proxyValueChanged.bind(this))};e.prototype.__proxyValueChanged=function(t){this.valueChanged.emit(t)};e.prototype.getDataType=function(){return this.sourceParameter.getDataType()};e.prototype.setValue=function(t,e){};e.prototype.getValue=function(t){return this.sourceParameter.getValue(t)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.sourceParameter&&(i.sourceParameter=this.sourceParameter.getPath()),i};e.prototype.fromJSON=function(e,a,i){var n=this;t.prototype.fromJSON.call(this,e,a,i),e.sourceParameter&&a.resolvePath(e.sourceParameter,(function(t){n.setSourceParameter(t)}),(function(t){console.warn("Error loading Proxy Param: '"+n.getName()+"'. Unable to connect to:"+e.sourceParameter)})),e.range&&(this.sourceParameter=e.range),e.step&&(this.__step=e.step)};e.prototype.clone=function(t,a){var i=new e(this.__name,this.__value);return this.sourceParameter&&this.connectToClonedSourceParam(a),i};e.prototype.connectToClonedSourceParam=function(t){var e=this;t.resolveClonedItem(this.sourceParameter,(function(t){clonedParam.setSourceParameter(t)}),(function(t){console.warn("Error cloning Proxy Param: '"+e.getName()+"'. Unable to connect to:"+j.sourceParameter)}))};return e}(Vr);br.registerClass("ProxyParameter",uo);var ho=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,void 0,"Geometry")||this,i.boundingBoxDirtied=new dr,i.setValue(a);return i}e.prototype.setValue=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}this.__value!==t&&(this.__value&&this.__value.boundingBoxDirtied.disconnect(this.boundingBoxDirtied.emit),this.__value=t,this.__value&&this.__value.boundingBoxDirtied.connect(this.boundingBoxDirtied.emit),e!=gr.USER_SETVALUE&&e!=gr.REMOTEUSER_SETVALUE||(this.__flags|=_r.USER_EDITED),e!=gr.OPERATOR_SETVALUE&&this.valueChanged.emit(e))};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){return t.prototype.fromJSON.call(this,e,a,i)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};e.prototype.destroy=function(){this.__value&&this.__value.boundingBoxDirtied.disconnect(this.boundingBoxDirtied.emit)};return e}(Vr);var mo=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.width=0,a.height=0,a.format="RGB",a.type="UNSIGNED_BYTE",a.addParameter(new Or("AlphaFromLuminance",!1)),a.addParameter(new Or("Invert",!1)),a.addParameter(new Or("FlipY",!1)),a.updated=a.parameterValueChanged,a.loaded=new dr(!0);return a}e.prototype.isLoaded=function(){return!0};e.prototype.getMapping=function(){return this.__mapping};e.prototype.setMapping=function(t){this.__mapping=t};e.prototype.isStream=function(){return!1};e.prototype.isStreamAtlas=function(){return this.__streamAtlas};e.prototype.getParams=function(){return{type:this.type,format:this.format,width:this.width,height:this.height,flipY:this.getParameter("FlipY").getValue(),invert:this.getParameter("Invert").getValue(),alphaFromLuminance:this.getParameter("AlphaFromLuminance").getValue()}};return e}(Wr);var po=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a,i)||this,n.textureConnected=new dr,n.textureDisconnected=new dr;return n}e.prototype.getImage=function(){return this.__image};e.prototype.setImage=function(t,e){var a=this;if(e===void 0){e=0}var i=function(){a.textureDisconnected.emit()};t?(null!=this.__image&&this.__image!==t&&i(),this.__image=t,this.textureConnected.emit(),this.valueChanged.emit(e)):null!=this.__image&&(i(),this.__image=void 0,this.textureDisconnected.emit())};e.prototype.setValue=function(e){e instanceof mo?this.setImage(e):(null!=this.__image&&this.setImage(void 0),t.prototype.setValue.call(this,e))};e.prototype.readBinary=function(e,a){t.prototype.readBinary.call(this,e,a);var i=e.loadStr();""!=i&&(console.log("Load Texture"),this.setImage(a.materialLibrary.getImage(i)))};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(Br);br.registerClass("MaterialFloatParam",po);var fo=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.textureConnected=new dr,i.textureDisconnected=new dr,i.__imageUpdated=i.__imageUpdated.bind(i);return i}e.prototype.getImage=function(){return this.__image};e.prototype.__imageUpdated=function(){this.valueChanged.emit()};e.prototype.setImage=function(t,e){var a=this;if(e===void 0){e=0}var i=function(){a.__image.loaded.disconnect(a.__imageUpdated),a.__image.updated.disconnect(a.__imageUpdated),a.__image=null,a.textureDisconnected.emit()};t?(null!=this.__image&&this.__image!==t&&i(),this.__image=t,this.__image.updated.connect(this.__imageUpdated),this.textureConnected.emit(),this.valueChanged.emit(e)):null!=this.__image&&(i(),this.__image=void 0,this.textureDisconnected.emit())};e.prototype.setValue=function(e){e instanceof mo?this.setImage(e):(null!=this.__image&&this.setImage(void 0),t.prototype.setValue.call(this,e))};e.prototype.readBinary=function(e,a){t.prototype.readBinary.call(this,e,a);var i=e.loadStr();""!=i&&this.setImage(a.materialLibrary.getImage(i))};e.prototype.clone=function(t){return new e(this.__name,this.__value.clone())};return e}(qr);br.registerClass("MaterialColorParam",fo);var bo=function(t,e,a,i){return"boolean"==typeof e||!1===e||!0===e?new Vr(t,e,"Boolean"):"string"==typeof e?new Vr(t,e,"String"):Number.isNumeric(e)?i?new po(t,e,a):new Br(t,e,a):e instanceof Bn?new Qr(t,e):e instanceof Dn?new Ar(t,e):e instanceof An?i?new fo(t,e):new qr(t,e):new Vr(t,e)};var yo=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.shaderNameChanged=new dr,i.visibleInGeomDataBuffer=!0,a&&i.setShaderName(a);return i}e.prototype.getShaderName=function(){return this.__shaderName};e.prototype.setShaderName=function(t){if(this.__shaderName==t)return;var e=br.getClass(t);if(!e)throw new Error("Error setting Shader. Shader not found:"+t);var a=e.getParamDeclarations(),i={};for(var n=0,r=a;n<r.length;n++){var o=r[n];var l=this.getParameter(o.name);l||(l=this.addParameter(bo(o.name,o.defaultValue,o.range,0!=o.texturable))),i[o.name]=!0}for(var s=0,d=this.__params;s<d.length;s++){var c=d[s];i[c.getName()]||this.removeParameter(c.getName())}this.__shaderName=t,this.shaderNameChanged.emit(this.__shaderName)};e.prototype.removeAllTextures=function(){for(var t=0,e=this.__params;t<e.length;t++){var a=e[t];a.getImage&&a.getImage()&&a.setImage(void 0)}};e.prototype.getParamTextures=function(){var t={};for(var e=0,a=this.__params;e<a.length;e++){var i=a[e];i.getImage&&i.getImage()&&(t[i.getName()]=i.getImage())}return t};e.prototype.__makeParameterTexturable=function(t){makeParameterTexturable(t)};e.prototype.isTransparent=function(){var t=this.getParameter("Opacity");if(t&&(t.getValue()<.99||t.getImage()))return!0;var e=this.getParameter("BaseColor");return!(!e||!e.getImage()||"RGBA"!=e.getImage().format)};e.prototype.getShaderClass=function(){return br.getClass(this.getShaderName())};e.prototype.modifyParams=function(t,e){e&&this.setShaderName(e);for(var a in t){var i=this.getParameter(a);i&&(t[a]instanceof Vr?this.replaceParameter(t[a]):i.setValue(t[a]))}};e.prototype.toJSON=function(e,a){if(a===void 0){a=0}return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){if(a===void 0){a={}}if(i===void 0){i=0}e.shader?(this.setShaderName(e.shader),t.prototype.fromJSON.call(this,e,a,i)):console.warn("Invalid Material JSON")};e.prototype.readBinary=function(e,a){var i=e.loadStr();if("StandardMaterial"==i&&(i="StandardSurfaceShader"),"TransparentMaterial"==i&&(i="TransparentSurfaceShader"),this.setShaderName(i),a.versions["zea-engine"].lessThan([0,0,3])){this.setName(e.loadStr());var n=e.loadUInt32();for(var r=0;r<n;r++){var o=(c=e.loadStr()).charAt(0).toUpperCase()+c.slice(1);var l=void 0;"MaterialColorParam"==e.loadStr()?(l=e.loadRGBAFloat32Color(),l.applyGamma(2.2)):l=e.loadFloat32();var s=e.loadStr();var d=this.getParameter(o);d?d.setValue(l):d=this.addParameter(bo(o,l)),""!=s&&d.setImage&&(a.materialLibrary.hasImage(s)?d.setImage(a.materialLibrary.getImage(s)):console.warn("Missing Texture:"+s))}}else t.prototype.readBinary.call(this,e,a);var c};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){t.prototype.copyFrom.call(this,e,a),this.setShaderName(e.getShaderName());for(var i=0,n=e.getParameters();i<n.length;i++){var r=n[i];var o=e.getParameter(r.getName());r.getImage||this.__makeParameterTexturable(o)}};e.prototype.destroy=function(){this.removeAllTextures(),t.prototype.destroy.call(this)};return e}(Wr);var go=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,null==e&&(e=a.constructor.name),a.__name=e,a.format="RGBA",a.type="UNSIGNED_BYTE",a.__loaded=!1,a.width=1,a.height=1;return a}e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getName=function(){return this.__name};e.prototype.isStream=function(){return!1};e.prototype.setData=function(t,e,a){this.width=t,this.height=e,this.__data=a,this.__loaded?this.updated.emit():(this.__loaded=!0,this.loaded.emit())};e.prototype.getParams=function(){var e=t.prototype.getParams.call(this);return e.data=this.__data,e};return e}(mo);function _o(t){this.data=t,this.pos=0}function Zo(t){this.stream=new _o(t),this.output={}}br.registerClass("DataImage2D",go),br.registerClass("DataImage",go),_o.prototype.readByte=function(){return this.data[this.pos++]},_o.prototype.peekByte=function(){return this.data[this.pos]},_o.prototype.readBytes=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=this.readByte();return e},_o.prototype.peekBytes=function(t){for(var e=new Array(t),a=0;a<t;a++)e[a]=this.data[this.pos+a];return e},_o.prototype.readString=function(t){for(var e="",a=0;a<t;a++)e+=String.fromCharCode(this.readByte());return e},_o.prototype.readBitArray=function(){for(var t=[],e=this.readByte(),a=7;a>=0;a--)t.push(!!(e&1<<a));return t},_o.prototype.readUnsigned=function(t){var e=this.readBytes(2);return t?(e[1]<<8)+e[0]:(e[0]<<8)+e[1]},Zo.prototype.parse=function(t){return this.parseParts(this.output,t),this.output},Zo.prototype.parseParts=function(t,e){for(var a=0;a<e.length;a++){var i=e[a];this.parsePart(t,i)}},Zo.prototype.parsePart=function(t,e){var a,i=e.label;if(!e.requires||e.requires(this.stream,this.output,t))if(e.loop){for(var n=[];e.loop(this.stream);){var r={};this.parseParts(r,e.parts),n.push(r)}t[i]=n}else e.parts?(a={},this.parseParts(a,e.parts),t[i]=a):e.parser?(a=e.parser(this.stream,this.output,t),e.skip||(t[i]=a)):e.bits&&(t[i]=this.parseBits(e.bits))},Zo.prototype.parseBits=function(t){var e={},a=this.stream.readBitArray();for(var i in t){var n=t[i];n.length?e[i]=a.slice(n.index,n.index+n.length).reduce((function(t,e){return 2*t+e}),0):e[i]=a[n.index]}return e};var Go=function(){return function(t){return t.readByte()}},Xo=function(t){return function(e){return e.readBytes(t)}},vo=function(t){return function(e){return e.readString(t)}},Vo=function(t){return function(e){return e.readUnsigned(t)}},Io=function(t,e){return function(a,i,n){for(var r=e(a,i,n),o=new Array(r),l=0;l<r;l++)o[l]=a.readBytes(t);return o}},Ro={label:"blocks",parser:function(t){for(var e=[],a=t.readByte();0!==a;a=t.readByte())e=e.concat(t.readBytes(a));return e}},xo={label:"gce",requires:function(t){var e=t.peekBytes(2);return 33===e[0]&&249===e[1]},parts:[{label:"codes",parser:Xo(2),skip:!0},{label:"byteSize",parser:Go()},{label:"extras",bits:{future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}}},{label:"delay",parser:Vo(!0)},{label:"transparentColorIndex",parser:Go()},{label:"terminator",parser:Go(),skip:!0}]},So={label:"image",requires:function(t){return 44===t.peekByte()},parts:[{label:"code",parser:Go(),skip:!0},{label:"descriptor",parts:[{label:"left",parser:Vo(!0)},{label:"top",parser:Vo(!0)},{label:"width",parser:Vo(!0)},{label:"height",parser:Vo(!0)},{label:"lct",bits:{exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}}}]},{label:"lct",requires:function(t,e,a){return a.descriptor.lct.exists},parser:Io(3,(function(t,e,a){return Math.pow(2,a.descriptor.lct.size+1)}))},{label:"data",parts:[{label:"minCodeSize",parser:Go()},Ro]}]},Wo={label:"text",requires:function(t){var e=t.peekBytes(2);return 33===e[0]&&1===e[1]},parts:[{label:"codes",parser:Xo(2),skip:!0},{label:"blockSize",parser:Go()},{label:"preData",parser:function(t,e,a){return t.readBytes(a.text.blockSize)}},Ro]},Lo={label:"frames",parts:[xo,{label:"application",requires:function(t,e,a){var i=t.peekBytes(2);return 33===i[0]&&255===i[1]},parts:[{label:"codes",parser:Xo(2),skip:!0},{label:"blockSize",parser:Go()},{label:"id",parser:function(t,e,a){return t.readString(a.blockSize)}},Ro]},{label:"comment",requires:function(t,e,a){var i=t.peekBytes(2);return 33===i[0]&&254===i[1]},parts:[{label:"codes",parser:Xo(2),skip:!0},Ro]},So,Wo],loop:function(t){var e=t.peekByte();return 33===e||44===e}},To=[{label:"header",parts:[{label:"signature",parser:vo(3)},{label:"version",parser:vo(3)}]},{label:"lsd",parts:[{label:"width",parser:Vo(!0)},{label:"height",parser:Vo(!0)},{label:"gct",bits:{exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}}},{label:"backgroundColorIndex",parser:Go()},{label:"pixelAspectRatio",parser:Go()}]},{label:"gct",requires:function(t,e){return e.lsd.gct.exists},parser:Io(3,(function(t,e){return Math.pow(2,e.lsd.gct.size+1)}))},Lo];function Mo(t){var e=new Zo(new Uint8Array(t));this.raw=e.parse(To),this.raw.hasImages=!1;for(var a=0;a<this.raw.frames.length;a++)if(this.raw.frames[a].image){this.raw.hasImages=!0;break}}Mo.prototype.decompressFrame=function(t,e){if(t>=this.raw.frames.length)return null;var a=this.raw.frames[t];if(a.image){var i=a.image.descriptor.width*a.image.descriptor.height,n=function(t,e,a){var i,n,r,o,l,s,d,c,u,h,m,p,f,b,y,g,_=a,Z=new Array(a),G=new Array(4096),X=new Array(4096),v=new Array(4097);for(l=(n=1<<(p=t))+1,i=n+2,d=-1,r=(1<<(o=p+1))-1,u=0;u<n;u++)G[u]=0,X[u]=u;for(m=c=f=b=g=y=0,h=0;h<_;){if(0===b){if(c<o){m+=e[y]<<c,c+=8,y++;continue}if(u=m&r,m>>=o,c-=o,u>i||u==l)break;if(u==n){r=(1<<(o=p+1))-1,i=n+2,d=-1;continue}if(-1==d){v[b++]=X[u],d=u,f=u;continue}for(s=u,u==i&&(v[b++]=f,u=d);u>n;)v[b++]=X[u],u=G[u];f=255&X[u],v[b++]=f,i<4096&&(G[i]=d,X[i]=f,0==(++i&r)&&i<4096&&(o++,r+=i)),d=s}b--,Z[g++]=v[b],h++}for(h=g;h<_;h++)Z[h]=0;return Z}(a.image.data.minCodeSize,a.image.data.blocks,i);a.image.descriptor.lct.interlaced&&(n=function(t,e){for(var a=new Array(t.length),i=t.length/e,n=function(i,n){var r=t.slice(n*e,(n+1)*e);a.splice.apply(a,[i*e,e].concat(r))},r=[0,4,2,1],o=[8,8,4,2],l=0,s=0;s<4;s++)for(var d=r[s];d<i;d+=o[s])n(d,l),l++;return a}(n,a.image.descriptor.width));var r={pixels:n,dims:{top:a.image.descriptor.top,left:a.image.descriptor.left,width:a.image.descriptor.width,height:a.image.descriptor.height}};return a.image.descriptor.lct&&a.image.descriptor.lct.exists?r.colorTable=a.image.lct:r.colorTable=this.raw.gct,a.gce&&(r.delay=10*(a.gce.delay||10),r.disposalType=a.gce.extras.disposal,a.gce.extras.transparentColorGiven&&(r.transparentIndex=a.gce.transparentColorIndex)),e&&(r.patch=function(t){for(var e=t.pixels.length,a=new Uint8ClampedArray(4*e),i=0;i<e;i++){var n=4*i,r=t.pixels[i],o=t.colorTable[r];a[n]=o[0],a[n+1]=o[1],a[n+2]=o[2],a[n+3]=r!==t.transparentIndex?255:0}return a}(r)),r}return null},Mo.prototype.decompressFrames=function(t){for(var e=[],a=0;a<this.raw.frames.length;a++){this.raw.frames[a].image&&e.push(this.decompressFrame(a,t))}return e};var Fo={},Co={},No=-1!==navigator.userAgent.indexOf("Chrome");var Yo=function(t){__extends(e,t);function e(e,a,i){if(a===void 0){a=""}if(i===void 0){i={}}var n=this;a.constructor==Object&&(i=a),null!=e&&-1!=e.lastIndexOf(".")&&(console.warn("Deprecated signature. Please provide a name and filepath to the image constructor"),e=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."))),n=t.call(this,e,i)||this,n.__loaded=!1;var r=n.addParameter(new ro("FilePath"));r.valueChanged.connect((function(){if(n.loaded.untoggle(),""==n.getName()){var t=r.getStem(),e=t.substring(t.length-1);isNaN(e)?n.setName(t):n.setName(t.substring(0,t.length-1))}var a=r.getFileDesc();a&&n.__loadData(a)})),a&&""!=a&&r.setFilepath(a);return n}e.__imageDataLibrary=function(){return Fo};e.registerLoader=function(t,e){Co[t]=e};e.constructLoader=function(t,e){for(var a=0,i=Co;a<i.length;a++){var n=i[a];if(new RegExp("\\.("+n+")$","i").test(t.name)){var r=new Co[n](e);if(r)return r.getParameter("FilePath").setValue(t.id),r}}};e.prototype.__loadData=function(t){var e=this.getParameter("FilePath").getExt();if(".jpg"==e||".png"==e||".webp"==e)this.__loadLDRImage(t,e);else if(".mp4"==e||".ogg"==e)this.__loadLDRVideo(t);else if(".vlh"==e)this.__loadVLH(t);else if(".gif"==e)this.__loadGIF(t);else{if(".svg"!=e)throw new Error("Unsupported file type. Check the ext:"+t);console.warn("SVG Image not yet supported")}};e.prototype.__loadLDRImage=function(t,e){var a=this;var i;".jpg"==e?this.format="RGB":".png"==e&&(this.format="RGBA"),this.type="UNSIGNED_BYTE";var n=function(){a.getDOMElement=function(){return i},a.width=i.width,a.height=i.height,a.__data=i,a.__loaded=!0,a.loaded.emit()};if(t.id in Fo)i=Fo[t.id],i.complete?n():i.addEventListener("load",n);else{Pr.addWork(t.id,1);var r=this.addParameter(new Br("PreferredSize",-1));var o=t.url;if(t.assets&&Object.keys(t.assets).length>0){var l={maxSize:zn.gpuDesc.maxTextureSize},s=r.getValue();-1==s?t.assets.reduce&&(l.prefSize=t.assets.reduce.w):l.prefSize=s;var d=function(t,e){if(e=e.filter((function(t){return null!==t})),No){var a=e.filter((function(t){return"webp"===t.format}));a.length>1&&(e=a)}else e=e.filter((function(t){return"webp"!==t.format}));if(t.maxSize&&(e=e.filter((function(e){return e.w<=t.maxSize}))),t.filter){var i=e.filter((function(e){return-1!==e.url.indexOf(t.filter)}));i.length>1&&(e=i)}if(t.prefSize&&(e=e.map((function(e){return Object.assign({score:Math.abs(t.prefSize-e.w)},e)}))).sort((function(t,e){return t.score>e.score?1:t.score<e.score?-1:0})),e.length>0)return e[0]}(l,Object.values(t.assets));d&&(console.log("Selected image:"+t.name+" format:"+d.format+" :"+d.w+"x"+d.h+" url:"+d.url),o=d.url)}else console.warn("Images not processed for this file:"+t.name);i=new Image,i.crossOrigin="anonymous",i.src=o,i.addEventListener("load",n),i.addEventListener("load",(function(){Pr.addWorkDone(t.id,1)})),Fo[t.id]=i}};e.prototype.__removeVideoParams=function(){this.getParameterIndex("spatializeAudio")&&(this.removeParameter(this.getParameterIndex("Loop")),this.removeParameter(this.getParameterIndex("spatializeAudio")),this.removeParameter(this.getParameterIndex("Gain")),this.removeParameter(this.getParameterIndex("refDistance")),this.removeParameter(this.getParameterIndex("maxDistance")),this.removeParameter(this.getParameterIndex("rolloffFactor")),this.removeParameter(this.getParameterIndex("coneInnerAngle")),this.removeParameter(this.getParameterIndex("coneOuterAngle")),this.removeParameter(this.getParameterIndex("coneOuterGain")))};e.prototype.__loadLDRVideo=function(t){var e=this;this.format="RGB",this.type="UNSIGNED_BYTE",Pr.addWork(t.id,1);var a=this.addParameter(new Or("Mute",!0)),i=this.addParameter(new Or("Loop",!0)),n=document.createElement("video");n.style.display="none",n.preload="auto",n.crossOrigin="anonymous",this.getAudioSource=function(){return n},document.body.appendChild(n),n.addEventListener("loadedmetadata",(function(){n.muted=a.getValue(),a.valueChanged.connect((function(){n.muted=a.getValue()})),n.loop=i.getValue(),i.valueChanged.connect((function(){n.loop=i.getValue()})),e.width=n.videoHeight,e.height=n.videoWidth,e.__data=n,e.__loaded=!0,Pr.addWorkDone(t.id,1),e.loaded.emit(n),n.play().then((function(){var t=0;var a=function(){if(n.paused||n.ended)return;var i=Math.floor(29.97*n.currentTime);t!=i&&(e.updated.emit(),t=i),setTimeout(a,20)};a()}),(function(t){console.log("Autoplay was prevented.",t,t.message)}))}),!1),n.src=t.url};e.prototype.__loadVLH=function(t){var e=this;this.type="FLOAT";var a=new An(1,1,1,1);this.setHDRTint=function(t){a=t},this.getHDRTint=function(){return a},Pr.loadUrl(t.id,t.url,(function(t){var a,i;for(var n in t)n.endsWith(".jpg")?a=t[n]:n.endsWith(".bin")&&(i=t[n]);var r=new Blob([a.buffer]),o=new Image;o.onload=function(){e.width=o.width,e.height=o.height,e.__data={ldr:o,cdm:i},e.__loaded?e.updated.emit():(e.__loaded=!0,e.loaded.emit())},o.src=URL.createObjectURL(r)}))};e.prototype.__loadGIF=function(t){var e=this;var a,i,n;this.format="RGBA",this.type="UNSIGNED_BYTE",this.__streamAtlas=!0,this.addParameter(new jr("StreamAtlasDesc",new On)),this.addParameter(new Br("StreamAtlasIndex",0)),this.getParameter("StreamAtlasIndex").setRange([0,1]),this.getFrameDelay=function(){return 20},this.play=function(){n.then((function(){a=!0,i&&i()}))},this.stop=function(){a=!1},t.id in Fo?n=Fo[t.id]:(n=new Promise((function(e,a){if(Pr.addWork(t.id,1),t.assets&&t.assets.atlas){var i=new Image;return i.crossOrigin="anonymous",i.src=t.assets.atlas.url,void i.addEventListener("load",(function(){e({width:t.assets.atlas.width,height:t.assets.atlas.height,atlasSize:t.assets.atlas.atlasSize,frameDelays:t.assets.atlas.frameDelays,frameRange:[0,t.assets.atlas.frameDelays.length],imageData:i}),Pr.addWorkDone(t.id,1)}))}Nr(t.url,(function(a){console.warn("Unpacking Gif client side:"+t.name);var i=performance.now(),n=new Mo(a).decompressFrames(!0),r=Math.sqrt(n.length),o=[r,r];Math.fract(r)>0&&(o[0]=Math.floor(o[0]+1),Math.fract(r)>.5?o[1]=Math.floor(o[1]+1):o[1]=Math.floor(o[1]));var l=n[0].dims.width,s=n[0].dims.height,d=document.createElement("canvas"),c=d.getContext("2d"),u=document.createElement("canvas"),h=u.getContext("2d");u.width=l,u.height=s;var m=document.createElement("canvas"),p=m.getContext("2d");var f;m.width=o[0]*l,m.height=o[1]*s;var b=[],y=function(t,e){var a=t.dims;b.push(t.delay/10),f&&a.width==f.width&&a.height==f.height||(d.width=a.width,d.height=a.height,f=c.createImageData(a.width,a.height)),f.data.set(t.patch),c.putImageData(f,0,0),2==t.disposalType&&h.clearRect(0,0,u.width,u.height),h.drawImage(d,a.left,a.top),p.drawImage(u,e%o[0]*l,Math.floor(e/o[0])*s)};for(var g=0;g<n.length;g++)y(n[g],g);Pr.addWorkDone(t.id,1);var _=p.getImageData(0,0,m.width,m.height),Z=performance.now()-i;console.log("Decode GIF '"+t.name+"' time:"+Z),e({width:m.width,height:m.height,atlasSize:o,frameRange:[0,n.length],frameDelays:b,imageData:_})}),(function(e){console.warn("Unable to Load URL:"+e+":"+t.url),a()}))})),Fo[t.id]=n),n.then((function(t){e.width=t.width,e.height=t.height,e.getParameter("StreamAtlasDesc").setValue(new On(t.atlasSize[0],t.atlasSize[1],0,0)),e.getParameter("StreamAtlasIndex").setRange(t.frameRange),e.__data=t.imageData,e.getFrameDelay=function(e){return 10*t.frameDelays[e]};var n=e.getParameter("StreamAtlasIndex"),r=n.getRange()[1];var o=0;i=function(){n.setValue(o),a&&setTimeout(i,e.getFrameDelay(o)),o=(o+1)%r},a&&i(),e.__loaded=!0,e.loaded.emit()}))};e.prototype.getFilepath=function(){return this.getParameter("FilePath").getValue()};e.prototype.isStream=function(){return!1};e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getParams=function(){var e=t.prototype.getParams.call(this);return this.__loaded&&(e.data=this.__data),e};e.prototype.toJSON=function(t,e){};e.prototype.fromJSON=function(t,e,a){};e.prototype.readBinary=function(t,e){this.setName(t.loadStr());var a=t.loadStr();if("string"==typeof a&&""!=a){if(e.lod>=0){var i=a.lastIndexOf(".");if(-1!=i){var n=a.substring(0,i)+e.lod+a.substring(i);Pr.resolveFilepath(n)&&(a=n)}}this.getParameter("FilePath").setFilepath(a)}};return e}(mo);var Ko=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;console.warn("FileImage2D is becoming deprecated in favor of simple FileImage"),i=t.call(this,e,a)||this;return i}return e}(Yo);br.registerClass("FileImage2D",Yo),br.registerClass("FileImage",Yo);var wo=-1!==navigator.userAgent.indexOf("Chrome");var zo=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a,i)||this,n.type="UNSIGNED_BYTE",n.addParameter(new Br("PreferredSize",-1)),n.__crossOrigin="anonymous";return n}e.prototype.setCrossOrigin=function(t){this.__crossOrigin=t};e.prototype.__loadData=function(t){".png"==this.getParameter("FilePath").getExt()&&(this.format="RGBA");var e=t.url;if(t.assets&&Object.keys(t.assets).length>0){var a={maxSize:zn.gpuDesc.maxTextureSize},i=this.getParameter("PreferredSize").getValue();-1==i?t.assets.reduce&&(a.prefSize=t.assets.reduce.w):a.prefSize=i;var n=function(t,e){if(e=e.filter((function(t){return null!==t})),wo){var a=e.filter((function(t){return"webp"===t.format}));a.length>1&&(e=a)}else e=e.filter((function(t){return"webp"!==t.format}));if(t.maxSize&&(e=e.filter((function(e){return e.w<=t.maxSize}))),t.filter){var i=e.filter((function(e){return-1!==e.url.indexOf(t.filter)}));i.length>1&&(e=i)}if(t.prefSize&&(e=e.map((function(e){return Object.assign({score:Math.abs(t.prefSize-e.w)},e)}))).sort((function(t,e){return t.score>e.score?1:t.score<e.score?-1:0})),e.length>0)return e[0]}(a,Object.values(t.assets));n&&(console.log("Selected image:"+t.name+" format:"+n.format+" :"+n.w+"x"+n.h+" url:"+n.url),e=n.url)}else console.warn("Images not processed for this file:"+t.name);this.setImageURL(e,"RGB")};e.prototype.setImageURL=function(t,e){var a=this;if(e===void 0){e="RGB"}if(!e){var i=t.lastIndexOf(".");if(-1!=i){".png"==t.substring(i).toLowerCase()&&(e="RGBA")}}var n;this.format=e,this.__loaded=!1;var r=function(){a.getDOMElement=function(){return n},a.width=n.width,a.height=n.height,a.__data=n,a.__loaded=!0,a.loaded.emit()},o=Yo.__imageDataLibrary();t in o?(n=o[t],n.complete?r():n.addEventListener("load",r)):(n=new Image,n.crossOrigin=this.__crossOrigin,n.src=t,n.addEventListener("load",r),o[t]=n)};return e}(Yo);Yo.registerLoader("jpg|jpeg|png",zo),br.registerClass("LDRImage",zo);var Uo=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e,a,i)||this,n.format="RGB",n.type="UNSIGNED_BYTE",n.addParameter(new Or("Mute",!1)),n.addParameter(new Or("Loop",!0)),n.addParameter(new Br("Gain",2)).setRange([0,5]),n.addParameter(new Or("SpatializeAudio",!0)),n.addParameter(new Br("refDistance",2)),n.addParameter(new Br("maxDistance",1e4)),n.addParameter(new Br("rolloffFactor",1)),n.addParameter(new Br("coneInnerAngle",360)),n.addParameter(new Br("coneOuterAngle",0)),n.addParameter(new Br("coneOuterGain",1));return n}e.prototype.__loadData=function(t){var e=this;Pr.addWork(t.id,1);var a=document.createElement("video");a.style.display="none",a.preload="auto",a.crossOrigin="anonymous",this.getAudioSource=function(){return a},document.body.appendChild(a),a.addEventListener("loadedmetadata",(function(){var i=e.getParameter("Mute");a.muted=i.getValue(),i.valueChanged.connect((function(){a.muted=i.getValue()}));var n=e.getParameter("Loop");a.loop=n.getValue(),n.valueChanged.connect((function(){a.loop=n.getValue()})),e.width=a.videoHeight,e.height=a.videoWidth,e.__data=a,e.__loaded=!0,Pr.addWorkDone(t.id,1),e.loaded.emit(a);var r=0;var o=function(){if(a.paused||a.ended)return;var t=Math.floor(29.97*a.currentTime);r!=t&&(e.updated.emit(),r=t),setTimeout(o,20)};o()}),!1),a.src=t.url;var i=a.play();void 0!==i&&i.then((function(t){console.log("Autoplay started!")})).catch((function(){console.log("Autoplay was prevented.")}))};return e}(Yo);Yo.registerLoader("mp4|ogg",Uo),br.registerClass("LDRVideo",Uo);var Jo=function(t){__extends(e,t);function e(e,a,i){if(a===void 0){a=""}if(i===void 0){i={}}var n=this;n=t.call(this,e,a,i)||this,n.format="RGBA",n.type="UNSIGNED_BYTE",n.__streamAtlas=!0,n.getParameter("FilePath").setSupportedExts("gif"),n.addParameter(new jr("StreamAtlasDesc")),n.addParameter(new Br("StreamAtlasIndex",0));var r=n.getParameter("StreamAtlasIndex");var o;r.setRange([0,1]);var l=0;var s=function(t){r.setValue(l),o&&setTimeout((function(){return s(t)}),n.getFrameDelay(l)),l=(l+1)%t};n.play=function(){n.__resourcePromise.then((function(){o=!0;var t=r.getRange()[1];s(t)}))},n.stop=function(){o=!1};return n}e.prototype.getFrameDelay=function(t){return 10*this.__unpackedData.frameDelays[t]};e.prototype.__loadData=function(t){var e=this;var a=Yo.__imageDataLibrary();t.id in a?this.__resourcePromise=a[t.id]:(this.__resourcePromise=new Promise((function(e,a){if(Pr.addWork(t.id,1),t.assets&&t.assets.atlas){var i=new Image;return i.crossOrigin="anonymous",i.src=t.assets.atlas.url,void i.addEventListener("load",(function(){e({width:t.assets.atlas.width,height:t.assets.atlas.height,atlasSize:t.assets.atlas.atlasSize,frameDelays:t.assets.atlas.frameDelays,frameRange:[0,t.assets.atlas.frameDelays.length],imageData:i}),Pr.addWorkDone(t.id,1)}))}Nr(t.url,(function(a){console.warn("Unpacking Gif client side:"+t.name);var i=performance.now(),n=new Mo(a).decompressFrames(!0),r=Math.sqrt(n.length),o=[r,r];Math.fract(r)>0&&(o[0]=Math.floor(o[0]+1),Math.fract(r)>.5?o[1]=Math.floor(o[1]+1):o[1]=Math.floor(o[1]));var l=n[0].dims.width,s=n[0].dims.height,d=document.createElement("canvas"),c=d.getContext("2d"),u=document.createElement("canvas"),h=u.getContext("2d");u.width=l,u.height=s;var m=document.createElement("canvas"),p=m.getContext("2d");var f;m.width=o[0]*l,m.height=o[1]*s;var b=[],y=function(t,e){var a=t.dims;b.push(t.delay/10),f&&a.width==f.width&&a.height==f.height||(d.width=a.width,d.height=a.height,f=c.createImageData(a.width,a.height)),f.data.set(t.patch),c.putImageData(f,0,0),2==t.disposalType&&h.clearRect(0,0,u.width,u.height),h.drawImage(d,a.left,a.top),p.drawImage(u,e%o[0]*l,Math.floor(e/o[0])*s)};for(var g=0;g<n.length;g++)y(n[g],g);Pr.addWorkDone(t.id,1);var _=p.getImageData(0,0,m.width,m.height),Z=performance.now()-i;console.log("Decode GIF '"+t.name+"' time:"+Z),e({width:m.width,height:m.height,atlasSize:o,frameRange:[0,n.length],frameDelays:b,imageData:_})}),(function(e){console.warn("Unable to Load URL:"+e+":"+t.url),a()}))})),a[t.id]=this.__resourcePromise),this.__resourcePromise.then((function(t){e.width=t.width,e.height=t.height,e.getParameter("StreamAtlasDesc").setValue(new On(t.atlasSize[0],t.atlasSize[1],0,0)),e.getParameter("StreamAtlasIndex").setRange(t.frameRange),e.__unpackedData=t,e.__data=t.imageData,e.__loaded=!0,e.loaded.emit()}))};return e}(Yo);Yo.registerLoader("gif",Jo),br.registerClass("GIFImage",Jo);var Po=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;var n;null!=e&&-1!=e.lastIndexOf(".")&&(n=e,e=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("."))),i=t.call(this,e,a)||this,i.__loaded=!1,i.__exposure=1,i.__ambientLightFactor=0,i.__hdrtint=new An(1,1,1,1),i.__stream="stream"in a&&a.stream,i.type="FLOAT";var r=i.addParameter(new ro("FilePath"));r.valueChanged.connect((function(){if(i.loaded.untoggle(),""==i.getName()){var t=r.getStem(),e=t.substring(t.length-1);isNaN(e)?i.setName(t):i.setName(t.substring(0,t.length-1))}var a=r.getValue(),n=r.getFile();i.__loadVLH(a,n)})),n&&i.getParameter("FilePath").setFilepath(n);return i}e.prototype.getDOMElement=function(){return this.__domElement};e.prototype.getResourcePath=function(){return this.getParameter("FilePath").getValue()};e.prototype.__decodeData=function(t){var e=this;var a=t.ldr,i=t.cdm,n=new Blob([a.buffer]),r=new Image;r.onload=function(){e.width=r.width,e.height=r.height,e.__data={ldr:r,cdm:i},e.__loaded?e.updated.emit():(e.__loaded=!0,e.loaded.emit())},r.src=URL.createObjectURL(n)};e.prototype.__loadVLH=function(t,e){var a=this;this.type="FLOAT",Pr.loadUrl(t,e.url,(function(t){if(!t.ldr||!t.cdm)for(var e in t)e.endsWith(".jpg")?(t.ldr=t[e],delete t[e]):e.endsWith(".bin")&&(t.cdm=t[e],delete t[e]);a.__decodeData(t)}))};e.prototype.isStream=function(){return!1};e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getParams=function(){var e=t.prototype.getParams.call(this);return this.__loaded&&(e.data=this.__data,e.exposure=this.__exposure),e};e.prototype.setHDRTint=function(t){this.__hdrtint=t};e.prototype.getHDRTint=function(){return this.__hdrtint};e.prototype.toJSON=function(t,e){};e.prototype.fromJSON=function(t,e,a){};e.prototype.readBinary=function(t,e){this.setName(t.loadStr());var a=t.loadStr();if("string"==typeof a&&""!=a){if(e.lod>=0){var i=a.lastIndexOf(".");if(-1!=i){var n=a.substring(0,i)+e.lod+a.substring(i);Pr.resourceAvailable(n)&&(a=n)}}this.getParameter("FilePath").setValue(a)}};return e}(mo);br.registerClass("VLHImage",Po);var Eo=1,Ho=2,ko=function(t,e){return e<t?0:1};function Bo(t){return t.dot(new Bn(1,1))}function Do(t){return new Bn(Math.abs(t.x),Math.abs(t.y))}function Oo(t,e){return new Bn(Math.max(t.x,e),Math.max(t.y,e))}function Qo(t){var e=function(t){return new Dn(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))}(t),a=function(t){return new Dn(2*ko(0,t.x)-1,2*ko(0,t.y)-1,2*ko(0,t.z)-1)}(t),i=new Bn(e.x,e.y);var n=Oo(i,1e-20);var r=Math.atan2(n.x,n.y)/Math.HALF_PI;n=Oo(new Bn(e.z,i.length()),1e-20);var o=Math.atan2(n.y,n.x)/Math.HALF_PI;var l=new Bn(a.x*r,a.y*(1-r));if(l.scaleInPlace(o),t.z<0){var s=new Bn(l.y,l.x),d=new Bn(a.x,a.y);l=d.subtract(Do(s).multiply(d))}return l.scale(.5).add(new Bn(.5,.5))}function Ao(t){var e=function(t){return new Bn(2*ko(0,t.x)-1,2*ko(0,t.y)-1)}(t=t.scale(2).subtract(new Bn(1,1))),a=Bo(Do(t)),i=a*Math.PI*.5;if(i<=0)return new Dn(0,0,1);if(Math.abs(i-Math.PI)<1e-6)return new Dn(0,0,-1);if(a>1){t=Do(Bn(t.y,t.x)).negate().add(new Bn(1,1)).multiply(e),a=Bo(Do(t))}var n=Math.abs(t.x)/a*Math.HALF_PI,r=Math.sin(n),o=Math.cos(n),l=Math.sin(i),s=Math.cos(i);return new Dn(r*e.x*l,o*e.y*l,s)}var jo=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;i=t.call(this,e,a)||this,i.mapping=Ho;return i}e.prototype.__decodeData=function(e){t.prototype.__decodeData.call(this,e);var a=e.samples;a&&(window.TextDecoder?this.__sampleSets=JSON.parse(new TextDecoder("utf-8").decode(a)):this.__sampleSets=JSON.parse(hr(a)),this.__sampleSets.luminanceThumbnail&&(this.__thumbSize=Math.sqrt(this.__sampleSets.luminanceThumbnail.length)))};e.prototype.getSampleSets=function(){return this.__sampleSets};e.prototype.uvToDir=function(t){switch(this.mapping){case Eo:return function(t,e){var a=Math.PI*(2*t-1),i=Math.PI*e;return new Dn(sin(i)*sin(a),-sin(i)*cos(a),cos(i))}(t);case Ho:return Ao(t)}};e.prototype.dirToUv=function(t){switch(this.mapping){case Eo:return function(t){var e=Math.acos(t.z),a=Math.atan2(t.x,-t.y);return new Bn((1+a/Math.PI)/2,e/Math.PI)}(t);case Ho:return Qo(t)}};e.prototype.uvToLuminance=function(t){var e=Math.floor(t.y*this.__thumbSize)*this.__thumbSize+Math.floor(t.x*this.__thumbSize);return this.__sampleSets.luminanceThumbnail[e]};e.prototype.dirToLuminance=function(t){return this.uvToLuminance(this.dirToUv(t))};return e}(Po);br.registerClass("EnvMap",jo);var qo=new(function(){function t(){var t=this;this.__labelLibraries={},this.labelLibraryLoaded=new dr;var e=function(){var t=window.navigator,e=["language","browserLanguage","systemLanguage","userLanguage"];var a,i;if(Array.isArray(t.languages))for(a=0;a<t.languages.length;a++)if(i=t.languages[a],i&&i.length)return i;for(a=0;a<e.length;a++)if(i=t[e[a]],i&&i.length)return i;return null}();e.startsWith("en")?this.__language="En":e.startsWith("es")?this.__language="Es":e.startsWith("fr")?this.__language="Fr":(e.startsWith("gb")||e.startsWith("de"))&&(this.__language="Gb"),this.__foundLabelLibraries={},Pr.registerResourceCallback(".labels",(function(e){var a=e.name.split(".")[0];t.__foundLabelLibraries[a]=e,Mr(e.url,(function(e){t.__labelLibraries[a]=JSON.parse(e),t.labelLibraryLoaded.emit(a)}))})),window.XLSX&&Pr.registerResourceCallback(".xlsx",(function(e){var a=e.name.split(".")[0];t.__foundLabelLibraries[a]=e,Nr(e.url,(function(e){var i=new Uint8Array(e),n=XLSX.read(i,{type:"array"}),r={};n.SheetNames.forEach((function(t){XLSX.utils.sheet_to_row_object_array(n.Sheets[t]).forEach((function(t){var e=t.Identifier;delete t.Identifier,r[e]=t}))})),t.__labelLibraries[a]=r,t.labelLibraryLoaded.emit(a)}))}))}t.prototype.isLibraryFound=function(t){return t in this.__foundLabelLibraries};t.prototype.isLibraryLoaded=function(t){return t in this.__labelLibraries};t.prototype.getLabelText=function(t,e){var a=this.__labelLibraries[t];if(!a)throw new Error("LabelLibrary: '"+t+"' not found in LabelManager. Found: ["+Object.keys(this.__labelLibraries)+"]");var i=a[e];if(!i)throw new Error("Label: '"+e+"' not found in LabelLibrary: '"+t+"'. Found: ["+Object.keys(a)+"]");var n=i[this.__language];if(!n){if(i.En)return i.En;throw new Error("labelText: '"+language+"' not found in Label. Found: ["+Object.keys(i)+"]")}return n};t.prototype.setLabelText=function(t,e,a){var i=this.__labelLibraries[t];i||(i={},this.__labelLibraries[t]=i);var n=i[e];n||(n={},i[e]=n),n[this.__language]=a};t.prototype.setLanguage=function(t){this.__language=t};return t}());var $o=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__canvasElem=document.createElement("canvas");var n=i.addParameter(new io("library"));i.addParameter(new io("text","")),i.addParameter(new qr("fontColor",new An(0,0,0))),i.addParameter(new Br("margin",11)),i.addParameter(new Br("borderWidth",2)),i.addParameter(new Br("borderRadius",11)),i.addParameter(new Or("outline",!1)),i.addParameter(new Or("outlineColor",new An(0,0,0))),i.addParameter(new Or("background",!0)),i.addParameter(new qr("backgroundColor",new An("#FBC02D"))),i.addParameter(new Or("fillBackground",!0)),i.addParameter(new Or("strokeBackgroundOutline",!0)),i.addParameter(new Br("fontSize",22)),i.addParameter(new io("font","Helvetica"));i.nameChanged.connect((function(){i.loadLabelData()})),a&&n.setValue(a),i.__requestedRerender=!1,i.__needsRender=!1,i.labelRendered=new dr,i.loadLabelData();return i}e.prototype.__parameterValueChanged=function(t,e){this.__requestedRerender||(this.__requestedRerender=!0,this.loadLabelData())};e.prototype.loadLabelData=function(){var t=this;Promise.all([function(){return new Promise((function(e){var a=t.getParameter("library").getValue();if(""==a)return void e();if(!qo.isLibraryFound(a))return console.warn("Label Libary not found:",a),void e();var i=function(){try{var i=t.getName(),n=qo.getLabelText(a,i);t.getParameter("text").setValue(n)}catch(e){console.warn(e)}e()};qo.isLibraryLoaded(a)?i():qo.labelLibraryLoaded.connect((function(t){t==a&&i()}))}))}(),function(){return new Promise((function(e){if(null!=document.fonts){var a=t.getParameter("font").getValue(),i=t.getParameter("fontSize").getValue();document.fonts.load(i+'px "'+a+'"').then((function(){e()}))}else e()}))}()]).then((function(){t.__requestedRerender=!1,t.__needsRender=!0,t.__loaded?t.updated.emit():(t.__loaded=!0,t.loaded.emit())}))};e.prototype.renderLabelToImage=function(){var t=this.__canvasElem.getContext("2d",{alpha:!0});var e=this.getParameter("text").getValue();""==e&&(e=this.getName());var a=this.getParameter("font").getValue(),i=this.getParameter("fontColor").getValue(),n=this.getParameter("fontSize").getValue(),r=this.getParameter("margin").getValue(),o=this.getParameter("borderWidth").getValue(),l=this.getParameter("borderRadius").getValue(),s=this.getParameter("outline").getValue(),d=this.getParameter("outlineColor").getValue(),c=this.getParameter("background").getValue(),u=this.getParameter("backgroundColor").getValue(),h=this.getParameter("fillBackground").getValue(),m=this.getParameter("strokeBackgroundOutline").getValue(),p=r+o,f=e.split("\n");t.font=n+'px "'+a+'"';var b=0;f.forEach((function(e){b=Math.max(t.measureText(e).width,b)}));var y=n;this.width=Math.ceil(b+2*p),this.height=Math.ceil(y*f.length+2*p),t.canvas.width=this.width,t.canvas.height=this.height,this.__canvasElem.width=this.width,this.__canvasElem.height=this.height,t.fillStyle="rgba(0, 0, 0, 0.0)",t.fillRect(0,0,this.width,this.height),c&&(t.fillStyle=u.toHex(),t.strokeStyle=d.toHex(),function(t,e,a,i,n,r,o,l,s){if(void 0===l&&(l=!0),void 0===r&&(r=5),"number"==typeof r)r={tl:r,tr:r,br:r,bl:r};else{var d={tl:0,tr:0,br:0,bl:0};for(var c in d)r[c]=r[c]||d[c]}t.beginPath(),t.moveTo(e+r.tl,a),t.lineTo(e+i-r.tr,a),t.quadraticCurveTo(e+i,a,e+i,a+r.tr),t.lineTo(e+i,a+n-r.br),t.quadraticCurveTo(e+i,a+n,e+i-r.br,a+n),t.lineTo(e+r.bl,a+n),t.quadraticCurveTo(e,a+n,e,a+n-r.bl),t.lineTo(e,a+r.tl),t.quadraticCurveTo(e,a,e+r.tl,a),t.closePath(),o&&t.fill(),l&&(t.lineWidth=s,t.stroke())}(t,o,o,this.width-2*o,this.height-2*o,l,h,m,o)),t.font=n+'px "'+a+'"',t.textAlign="left",t.fillStyle=i.toHex(),t.textBaseline="hanging",f.forEach((function(e,a){t.fillText(e,p,p+a*y)})),s&&(t.strokeStyle=d.toHex(),t.lineWidth=1.5,t.strokeText(e,p,p)),this.__data=t.getImageData(0,0,this.width,this.height),this.__needsRender=!1,this.labelRendered.emit({width:this.width,height:this.height,data:this.__data})};e.prototype.getParams=function(){return this.__needsRender&&this.renderLabelToImage(),t.prototype.getParams.call(this)};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__getLabelText()};return e}(go);br.registerClass("Label",$o);var tl=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__loaded=!1;return e}e.prototype.connectWebcam=function(t,e,a){var i=this;if(a===void 0){a=!1}var n={width:t,height:e,frameRate:{ideal:60,max:60}};n.facingMode=a?{exact:"environment"}:{facingMode:"user"};var r=document.createElement("video");r.style.display="none",r.preload="auto",r.crossOrigin="anonymous",document.body.appendChild(r),navigator.mediaDevices.getUserMedia({audio:!1,video:n}).then((function(t){r.srcObject=t,r.onloadedmetadata=function(t){r.play(),i.width=r.videoWidth,i.height=r.videoHeight,console.log("Webcam:["+i.width+", "+i.height+"]"),i.__data=r,i.__loaded=!0,i.loaded.emit(r);var e=0;var a=function(){if(r.paused||r.ended)return;var t=Math.floor(60*r.currentTime);e!=t&&(i.updated.emit(),e=t),setTimeout(a,20)};a()}})).catch((function(t){}))};e.prototype.setVideoStream=function(t){this.__loaded=!1,this.width=t.videoWidth,this.height=t.videoHeight,this.start(),this.__data=t,this.__loaded=!0,this.loaded.emit(t)};e.prototype.stop=function(){clearInterval(this.__intervalId)};e.prototype.start=function(){var t=this;this.__intervalId=setInterval((function(){t.updated.emit()}),20)};e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getParams=function(){return{type:this.type,format:this.format,width:this.width,height:this.height,data:this.__data,flipY:this.getParameter("FlipY").getValue()}};return e}(mo);br.registerClass("VideoStreamImage2D",tl);var el=function(){function t(t){if(t===void 0){t="MaterialLibrary"}this.__name=t,this.lod=0,zn.isMobileDevice&&(this.lod=1),this.loaded=new dr,this.clear()}t.prototype.clear=function(){this.__images={},this.__materials={Default:new yo("Default","SimpleSurfaceShader")}};t.prototype.getPath=function(){return[this.__name]};t.prototype.getNumMaterials=function(){return Object.keys(this.__materials).length};t.prototype.getMaterials=function(){return Object.values(this.__materials)};t.prototype.getMaterialNames=function(){var t=[];for(var e in this.__materials)t.push(e);return t};t.prototype.hasMaterial=function(t){return t in this.__materials};t.prototype.addMaterial=function(t){t.setOwner(this),this.__materials[t.getName()]=t};t.prototype.getMaterial=function(t,e){if(e===void 0){e=!0}var a=this.__materials[t];if(!a&&e)throw new Error("Material:"+t+" not found in library:"+this.getMaterialNames());return a};t.prototype.hasImage=function(t){return t in this.__images};t.prototype.addImage=function(t){t.setOwner(this),this.__images[t.getName()]=t};t.prototype.getImage=function(t,e){if(e===void 0){e=!0}var a=this.__images[t];if(!a&&e)throw new Error("Image:"+t+" not found in library:"+this.getImageNames());return a};t.prototype.getImageNames=function(){var t=[];for(var e in this.__images)t.push(e);return t};t.prototype.load=function(t){var e=this;var a=new XMLHttpRequest;a.open("GET",t,!0),a.ontimeout=function(){throw new Error("The request for "+t+" timed out.")},a.onload=function(){4===a.readyState&&(200===a.status?e.fromJSON(JSON.parse(a.responseText)):console.warn(a.statusText))},a.send(null)};t.prototype.toJSON=function(t,e){if(t===void 0){t={}}if(e===void 0){e=0}return{numMaterials:this.geoms.length()}};t.prototype.fromJSON=function(t,e,a){if(e===void 0){e={}}if(a===void 0){a=0}e.lod=this.lod;for(var i in t.textures){new Yo(i).fromJSON(t.textures[i]),this.__images[i]=texture}for(var n in t.materials){var r=new yo(n);r.fromJSON(t.materials[n]),this.addMaterial(r)}};t.prototype.readBinary=function(t,e){if(e===void 0){e={}}this.name=t.loadStr(),e.lod=this.lod,e.materialLibrary=this;var a=t.loadUInt32();for(var i=0;i<a;i++){var n=t.loadStr(),r=br.constructClass(n,void 0);r.readBinary(t,e),this.__images[r.getName()]=r}var o=t.loadUInt32();if(o>0){var l=t.loadUInt32Array(o);for(var s=0;s<o;s++){var d=new yo("");t.seek(l[s]),d.readBinary(t,e,this.__images),this.addMaterial(d)}}this.loaded.emit()};t.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return t}();var al=new(function(){function t(){var t=this;this.__materialLibraries={},this.materialLibraryLoaded=new dr,Pr.registerResourceCallback(".matlib",(function(e){Mr(e.url,(function(a){var i=e.name.split(".")[0],n=JSON.parse(a),r=new el(i);r.fromJSON(n),t.__materialLibraries[i]=r,t.materialLibraryLoaded.emit(r)}))}))}t.prototype.getMaterialLibraryNames=function(){var t=[];for(var e in this.__materialLibraries)t.push(e);return t};t.prototype.hasMaterialLibrary=function(t){return t in this.__materialLibraries};t.prototype.getMaterialLibrary=function(t){var e=this.__materialLibraries[t];return e||console.warn("MaterialLibrary:"+t+" not found in MaterialLibraryManager. Found: ["+this.getMaterialLibraryNames()+"]"),e};t.prototype.resolveMaterialFromPath=function(t){var e=this.getMaterialLibrary(t[0]);if(e)return e.getMaterial(t[1])};return t}());var il=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a,"Material")||this,i.valueParameterValueChanged=new dr;return i}e.prototype.setValue=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}this.__value!==t&&(this.__value&&this.__value.parameterValueChanged.disconnect(this.valueParameterValueChanged.emit),this.__value=t,this.__value&&this.__value.parameterValueChanged.connect(this.valueParameterValueChanged.emit),e!=gr.USER_SETVALUE&&e!=gr.REMOTEUSER_SETVALUE||(this.__flags|=_r.USER_EDITED),e!=gr.OPERATOR_SETVALUE&&this.valueChanged.emit(e))};e.prototype.toJSON=function(t,e){if(0!=(this.__flags&_r.USER_EDITED))return{value:this.__value.getPath()}};e.prototype.fromJSON=function(t,e,a){if(null==t.value)return void console.warn("Invalid Parameter JSON");var i=t.value,n=al.resolveMaterialFromPath(i);n&&this.setValue(n),this.__flags|=_r.USER_EDITED};e.prototype.clone=function(t){return new e(this.__name,this.__value)};e.prototype.destroy=function(){this.__value&&this.__value.parameterValueChanged.disconnect(this.valueParameterValueChanged.emit)};return e}(Vr);var nl=function(){function t(t,e,a){if(this.__dataType=t,this.normalized=!1,null!=t.numElements)this.__dimension=this.__dataType.numElements();else switch(t){case 6:case 4:case 5:this.__dimension=1;break;default:throw new Error("Invalid data type for attribute:"+t)}var i;this.__defaultElementValue=null!=a?a:Number.MAX_VALUE,(i=e)&&void 0!==i.byteLength?this.__data=e:(this.__data=new Float32Array(e*this.__dimension),this.initRange(0))}t.prototype.resize=function(t){var e=this.__data.length,a=t*this.__dimension,i=new Float32Array(a);for(var n=0;n<Math.min(this.__data.length,a);n++)i[n]=this.__data[n];this.__data.length<a&&(this.__data=i),this.initRange(e)};t.prototype.initRange=function(t){for(var e=t;e<this.__data.length;e++)this.__data[e]=this.__defaultElementValue};t.prototype.getCount=function(){return this.__data.length/this.__dimension};Object.defineProperty(t.prototype,"length",{get:function(){return this.__data.length/this.__dimension},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dataType",{get:function(){return this.__dataType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"data",{get:function(){return this.__data},set:function(t){this.__data=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numElements",{get:function(){return this.__dimension},enumerable:true,configurable:true});t.prototype.getFloat32Value=function(t){return this.__data[t]};t.prototype.setFloat32Value=function(t,e){this.__data[t]=e};t.prototype.getValueRef=function(t){var e=this.__dimension;if(t>=this.__data.length/e)throw new Error("Invalid vertex index:"+t+". Num Vertices:"+this.__data.length/3);return this.__dataType.createFromFloat32Buffer(this.__data.buffer,t*e)};t.prototype.setValue=function(t,e){var a=this.__dimension;if(t>=this.__data.length/a)throw new Error("Invalid vertex index:"+t+". Num Vertices:"+this.__data.length/3);this.__dataType.createFromFloat32Buffer(this.__data.buffer,t*a).setFromOther(e)};t.prototype.toJSON=function(t,e){return{data:Array.from(this.__data),dataType:kn.getTypeName(this.__dataType),defaultValue:this.__defaultElementValue,length:this.__data.length/this.__dimension}};t.prototype.fromJSON=function(t){this.__data=Float32Array.from(t.data)};t.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return t}();var rl=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__boundingBox=new rr,e.__boundingBoxDirty=!0,e.__vertexAttributes=new Map,e.__metaData=new Map,e.addVertexAttribute("positions",Dn,0),e.boundingBoxDirtied=new dr,e.geomDataChanged=new dr,e.geomDataTopologyChanged=new dr;return e}e.prototype.setDebugName=function(t){this.__name=t};e.prototype.addVertexAttribute=function(t,e,a){var i;var n;return i=(n=a)&&void 0!==n.byteLength?new nl(e,a):new nl(e,null!=this.vertices?this.vertices.length:0,a),this.__vertexAttributes.set(t,i),i};e.prototype.hasVertexAttribute=function(t){return this.__vertexAttributes.has(t)};e.prototype.getVertexAttribute=function(t){return this.__vertexAttributes.get(t)};e.prototype.getVertexAttributes=function(t){var e={};for(var a=0,i=this.__vertexAttributes.entries();a<i.length;a++){var n=i[a],r=n[0],o=n[1];e[r]=o}return e};Object.defineProperty(e.prototype,"vertices",{get:function(){return this.__vertexAttributes.get("positions")},enumerable:true,configurable:true});e.prototype.numVertices=function(){return this.vertices.length};e.prototype.getNumVertices=function(){return this.vertices.length};e.prototype.setNumVertices=function(t){this.__vertexAttributes.forEach((function(e){return e.resize(t)}))};e.prototype.getVertex=function(t){return Dn.createFromFloat32Buffer(this.vertices.data.buffer,3*t)};e.prototype.setVertex=function(t,e){return Dn.createFromFloat32Buffer(this.vertices.data.buffer,3*t).setFromOther(e)};e.prototype.moveVertices=function(t){var e=this.vertices;for(var a=0;a<e.length;a++)e.getValueRef(a).addInPlace(t);this.setBoundingBoxDirty()};e.prototype.transformVertices=function(t){var e=this.vertices;for(var a=0;a<e.length;a++){var i=e.getValueRef(a),n=t.transformVec3(i);i.set(n.x,n.y,n.z)}this.setBoundingBoxDirty()};Object.defineProperty(e.prototype,"boundingBox",{get:function(){return this.__boundingBoxDirty&&this.updateBoundingBox(),this.__boundingBox},enumerable:true,configurable:true});e.prototype.setBoundingBoxDirty=function(){this.__boundingBoxDirty=!0,this.boundingBoxDirtied.emit()};e.prototype.updateBoundingBox=function(){var t=this.vertices,e=new rr,a=t.length;for(var i=0;i<a;i++)e.addPoint(t.getValueRef(i));this.__boundingBox=e,this.__boundingBoxDirty=!1};e.prototype.getMetadata=function(t){return this.__metaData.get(t)};e.prototype.hasMetadata=function(t){return this.__metaData.has(t)};e.prototype.setMetadata=function(t,e){this.__metaData.set(t,e)};e.prototype.deleteMetadata=function(t){this.__metaData.delete(t)};e.prototype.genBuffers=function(t){var e={};for(var a=0,i=this.__vertexAttributes;a<i.length;a++){var n=i[a],r=n[0],o=n[1];e[r]={values:o.data,count:o.size,dataType:o.dataType,normalized:o.normalized}}return{numVertices:this.numVertices(),attrBuffers:e}};e.prototype.freeBuffers=function(){};e.prototype.loadBaseGeomBinary=function(t){this.name=t.loadStr();var e=t.loadUInt8();this.debugColor=t.loadRGBFloat32Color();var a=t.loadUInt32();this.__boundingBox.set(t.loadFloat32Vec3(),t.loadFloat32Vec3()),this.setNumVertices(a);var i=this.vertices;var n,r;2&e&&(n=this.getVertexAttribute("normals"),n||(n=this.addVertexAttribute("normals",Dn,0))),4&e&&(r=this.getVertexAttribute("texCoords"),r||(r=this.addVertexAttribute("texCoords",Bn,0)));var o=function(t,e,a,n){for(var r=t[0];r<t[1];r++){var o=new Dn(n[3*r+0]/255,n[3*r+1]/255,n[3*r+2]/255);o.multiplyInPlace(a),o.addInPlace(e),i.setValue(r,o)}},l=function(t,e,a,i){a.isNull()&&a.set(1,1,1);for(var r=t[0];r<t[1];r++){var o=new Dn(i[3*r+0]/255,i[3*r+1]/255,i[3*r+2]/255);o.multiplyInPlace(a),o.addInPlace(e),o.normalizeInPlace(),n.setValue(r,o)}},s=function(t,e,a,i){for(var n=t[0];n<t[1];n++){var o=new Bn(i[2*n+0]/255,i[2*n+1]/255);o.multiplyInPlace(a),o.addInPlace(e),r.setValue(n,o)}},d=t.loadUInt32();if(1==d){{var c=this.__boundingBox,u=t.loadUInt8Array(3*a);o([0,a],c.p0,c.diagonal(),u)}if(n){var h=new rr(t.loadFloat32Vec3(),t.loadFloat32Vec3()),m=t.loadUInt8Array(3*a);l([0,a],h.p0,h.diagonal(),m),n.loadSplitValues(t)}if(r){var p=new ir(t.loadFloat32Vec2(),t.loadFloat32Vec2()),f=t.loadUInt8Array(2*a);s([0,a],p.p0,p.diagonal(),f),r.loadSplitValues(t)}}else{var b=[];var y=0;for(var g=0;g<d;g++){var _=t.loadUInt32(),Z={range:[y,y+_],bbox:new rr(t.loadFloat32Vec3(),t.loadFloat32Vec3())};n&&(Z.normalsRange=new rr(t.loadFloat32Vec3(),t.loadFloat32Vec3())),r&&(Z.texCoordsRange=new ir(t.loadFloat32Vec2(),t.loadFloat32Vec2())),b.push(Z),y+=_}var G=t.loadUInt8Array(3*a);var X=void 0,v;n&&(X=t.loadUInt8Array(3*a)),r&&(v=t.loadUInt8Array(2*a));for(var V=0;V<d;V++){{var I=b[V].bbox;o(b[V].range,I.p0,I.diagonal(),G)}if(n){var R=b[V].normalsRange;l(b[V].range,R.p0,R.diagonal(),X)}if(r){var x=b[V].texCoordsRange;s(b[V].range,x.p0,x.diagonal(),v)}}n&&n.loadSplitValues(t),r&&r.loadSplitValues(t)}};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);if(i||(i={}),i.type=br.getClassName(this),!(1024&a)){var n={};for(var r=0,o=this.__vertexAttributes.entries();r<o.length;r++){var l=o[r],s=l[0],d=l[1];n[s]=d.toJSON(e,a)}i.vertexAttributes=n}return i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i);for(var n in e.vertexAttributes){var r=this.__vertexAttributes.get(n);var o=e.vertexAttributes[n];if(!r){var l=kn.getType(o.dataType);r=new VertexAttribute(this,l,0,o.defaultScalarValue),this.__vertexAttributes.set(n,r)}r.fromJSON(o)}};e.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return e}(Rr);var ol=function(t){__extends(e,t);function e(e,a,i,n){var r=this;r=t.call(this,a,i,n)||this,r.__geom=e,r.__splits={},r.__splitValues=[];return r}e.prototype.getFaceVertexValueRef=function(t,e){var a=this.__geom.getFaceVertexIndex(t,e);return a in this.__splits&&t in this.__splits[a]?this.__splitValues[this.__splits[a][t]]:this.getValueRef(a)};e.prototype.setFaceVertexValue=function(t,e,a){var i=this.__geom.getFaceVertexIndex(t,e);this.setFaceVertexValue_ByVertexIndex(t,i,a)};e.prototype.setFaceVertexValue_ByVertexIndex=function(t,e,a){var i=this.getValueRef(e);if(i.isValid())if(i.approxEqual(a));else{if(e in this.__splits){var n=this.__splits[e];for(var r in n){var o=n[r];if(this.__splitValues[o].approxEqual(a))return void(n[t]=o)}if(t in this.__splits[e]){return void this.__splitValues[this.__splits[e][t]].setFromOther(a)}}else this.__splits[e]={};this.__splits[e][t]=this.__splitValues.length,this.__splitValues.push(a)}else i.setFromOther(a)};e.prototype.setSplitVertexValue=function(t,e,a){if(t in this.__splits||(this.__splits[t]={}),e in this.__splits[t]){if(this.__splitValues[this.__splits[t][e]].approxEqual(a))return;console.warn("Face Vertex Already Split with different value")}this.__splits[t][e]=this.__splitValues.length,this.__splitValues.push(a)};e.prototype.setSplitVertexValues=function(t,e,a){t in this.__splits||(this.__splits[t]={});var i=this.__splitValues.length;this.__splitValues.push(a);for(var n=0,r=e;n<r.length;n++){var o=r[n];this.__splits[t][o]=i}};e.prototype.getSplits=function(){return this.__splits};e.prototype.getSplitCount=function(){var t=0;for(var e in this.__splits)t+=Object.keys(this.__splits[e]).length;return t};e.prototype.generateSplitValues=function(t,e){if(0==e)return this.__data;var a=this.length,i=this.length+e,n=this.__dataType.numElements?this.__dataType.numElements():1,r=new Float32Array(i*n);for(var o=0;o<this.__data.length;o++)r[o]=this.__data[o];for(var l in t){var s=t[l];for(var d in s){var c=a+s[d];if(l in this.__splits&&d in this.__splits[l]){var u=this.__splits[l][d];6==this.__dataType?r[c*n]=this.__splitValues[u]:this.__dataType.createFromFloat32Buffer(r.buffer,c*n).setFromOther(this.__splitValues[u])}else{var h=parseInt(l);for(var m=0;m<n;m++)h*n+m>this.__data.length&&console.log("Error remapping src:"+h*n+m),c*n+m>r.length&&console.log("Error remapping tgt:"+c*n+m),r[c*n+m]=this.__data[h*n+m]}}}return r};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return i.splits=this.__splits,i.splitValues=this.__splitValues,i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__splits=e.splits,this.__splitValues=[];for(var n=0,r=e.splitValues;n<r.length;n++){var o=r[n];this.__splitValues.push(this.__dataType.createFromJSON(o))}};e.prototype.loadSplitValues=function(t){var e=t.loadUInt32Array();if(0==e.length)return;var a=0,i=0;for(;;){var n=e[a++],r=e[a++],o={};for(var l=0;l<r;l++){var s=e[a++],d=e[a++];o[s]=d,d>=i&&(i=d+1)}if(this.__splits[n]=o,a>=e.length)break}var c=this.__numFloat32Elements,u=t.loadFloat32Array(i*c);this.__splitValues=[];for(var h=0;h<i;h++){var m=this.__dataType.createFromFloat32Array(u.slice(h*c,h*c+c));this.__splitValues.push(m)}};return e}(nl);var ll=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.loadBin=function(t){this.name=t.loadStr();var e=t.loadUInt32();this.__boundingBox.set(t.loadFloat32Vec3(),t.loadFloat32Vec3()),this.setNumVertices(e);var a=this.vertices;if(e<256){var i=this.__boundingBox.toMat4(),n=t.loadUInt8Array(3*e);for(var r=0;r<e;r++){var o=new Vec3(n[3*r+0]/255,n[3*r+1]/255,n[3*r+2]/255);a.setValue(r,i.transformVec3(o))}}else{var l=t.loadUInt32(),n=[];for(var s=0;s<l;s++){var d=t.loadUInt32Vec2(),c=t.loadFloat32Vec3(),u=t.loadFloat32Vec3();n.push({range:d,bbox:new Box3(c,u)})}var h=t.loadUInt8Array(3*e);for(var m=0;m<l;m++){var p=n[m].bbox.toMat4();for(var f=n[m].range.x;f<n[m].range.y;f++){var b=new Vec3(h[3*f+0]/255,h[3*f+1]/255,h[3*f+2]/255);a.setValue(f,p.transformVec3(b))}}}};e.prototype.readBinary=function(e,a){t.prototype.loadBaseGeomBinary.call(this,e),this.geomDataChanged.emit()};return e}(rl);var sl=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__indices=new Uint32Array,e.__segmentAttributes=new Map,e.lineThickness=0;return e}e.prototype.getIndices=function(){return this.__indices};e.prototype.getNumSegments=function(){return this.__indices.length/2};e.prototype.setNumSegments=function(t){var e=new Uint32Array(2*t);this.__indices=e};e.prototype.setSegment=function(t,e,a){if(t>=this.__indices.length/2)throw new Error("Invalid line index:"+t+". Num Segments:"+this.__indices.length/2);this.__indices[2*t+0]=e,this.__indices[2*t+1]=a};e.prototype.getSegmentVertexIndex=function(t,e){if(t<this.numLines)return this.__indices[2*t+e]};e.prototype.addSegmentAttribute=function(t,e,a){var i=new Attribute(e,null!=a?a:this.polygonCount);return this.__segmentAttributes.set(t,i),i};e.prototype.hasSegmentAttribute=function(t){return this.__segmentAttributes.has(t)};e.prototype.getSegmentAttribute=function(t){return this.__segmentAttributes.get(t)};e.prototype.genBuffers=function(){var e=t.prototype.genBuffers.call(this);var a;return e.numVertices<Math.pow(2,8)?(a=new Uint8Array(this.__indices.length),this.__indices.forEach((function(t,e){a[e]=t}))):e.numVertices<Math.pow(2,16)?(a=new Uint16Array(this.__indices.length),this.__indices.forEach((function(t,e){a[e]=t}))):a=this.__indices,e.indices=a,e};e.prototype.readBinary=function(e,a){t.prototype.loadBaseGeomBinary.call(this,e),this.setNumSegments(e.loadUInt32());var i=e.loadUInt8();1==i?this.__indices=e.loadUInt8Array():2==i?this.__indices=e.loadUInt16Array():4==i&&(this.__indices=e.loadUInt32Array()),this.geomDataChanged.emit()};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return 1024&a||(i.indices=Array.from(this.__indices)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__indices=Uint32Array.from(e.indices)};return e}(rl);var dl=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.init();return e}e.prototype.init=function(){this.__faceCounts=[],this.__faceVertexCounts=new Uint8Array,this.__faceOffsets=new Uint32Array,this.__faceVertexIndices=new Uint32Array,this.__numPopulatedFaceVertexIndices=0,this.__faceAttributes=new Map,this.__edgeAttributes=new Map,this.__logTopologyWarnings=!1,this.edgeVerts=void 0,this.vertexEdges=void 0,this.numEdges=0,this.edgeFlags=new Uint32Array,this.edgeAngles=new Float32Array};e.prototype.getFaceVertexIndices=function(){return this.__faceVertexIndices};e.prototype.getFaceCounts=function(){return this.__faceCounts};e.prototype.clear=function(){this.__faceVertexIndices=void 0,this.__faceCounts=[],this.__numPopulatedFaceVertexIndices=0};e.prototype.setFaceCounts=function(t){if(this.__numPopulatedFaceVertexIndices)throw new Error("Cannot set face counts on a mesh that is already populated. Please call 'clear' before re-building the mesh.");this.__faceCounts=t;var e=0,a=0,i=3;for(var n=0,r=this.__faceCounts;n<r.length;n++){var o=r[n];e+=o,a+=o*i,i++}this.__faceVertexCounts=new Uint8Array(e),this.__faceOffsets=new Uint32Array(e),this.__faceVertexIndices=new Uint32Array(a);for(var l=0,s=this.__faceAttributes;l<s.length;l++){var d=s[l];d.resize(e)}};e.prototype.setFaceVertexIndices=function(t){var e=Array.prototype.slice.call(arguments,1),a=this.__numPopulatedFaceVertexIndices;for(var i=0;i<e.length;i++)this.__faceVertexIndices[a+i]=e[i];this.__faceVertexCounts[t]=e.length-3,this.__faceOffsets[t]=a,this.__numPopulatedFaceVertexIndices+=e.length};e.prototype.getFaceVertexIndices=function(t){var e=[],a=this.__faceOffsets[t],i=this.__faceVertexCounts[t]+3;for(var n=0;n<i;n++)e.push(this.__faceVertexIndices[a+n]);return e};e.prototype.getFaceVertexIndex=function(t,e){var a=this.__faceOffsets[t];return this.__faceVertexIndices[a+e]};e.prototype.getNumFaces=function(){return this.__faceVertexCounts.length};e.prototype.addVertexAttribute=function(t,e,a){var i=new ol(this,e,null!=this.vertices?this.vertices.length:0,a);return this.__vertexAttributes.set(t,i),i};e.prototype.addFaceAttribute=function(t,e,a){var i=new nl(e,null!=a?a:this.getNumFaces());return this.__faceAttributes.set(t,i),i};e.prototype.hasFaceAttribute=function(t){return this.__faceAttributes.has(t)};e.prototype.getFaceAttribute=function(t){return this.__faceAttributes.get(t)};e.prototype.addEdgeAttribute=function(t,e,a){var i=new nl(e,null!=a?a:this.getNumEdges());return this.__edgeAttributes.set(t,i),i};e.prototype.hasEdgeAttribute=function(t){return this.__edgeAttributes.has(t)};e.prototype.getEdgeAttribute=function(t){return this.__edgeAttributes.get(t)};e.prototype.genTopologyInfo=function(){var t=this;var e={};this.vertexEdges=[],this.edgeFaces=[],this.edgeVerts=[],this.faceEdges=[],this.numEdges=0;var a=function(a,i){var n=a,r=i;if(r<n){var o=n;n=r,r=o}var l=n+">"+r;if(l in e)return e[l];var s=t.vertices.getValueRef(n),d=t.vertices.getValueRef(r).subtract(s),c={edgeIndex:t.edgeFaces.length/2,edgeVec:d};return e[l]=c,t.edgeFaces.push(-1),t.edgeFaces.push(-1),t.edgeVerts.push(n),t.edgeVerts.push(r),t.numEdges++,c},i=function(e,i,n){var r=a(e,i).edgeIndex;if(i<e){var o=2*r+0;t.__logTopologyWarnings&&-1!=t.edgeFaces[o]&&console.warn("Edge poly 0 already set. Mesh is non-manifold."),t.edgeFaces[o]=n}else{var l=2*r+1;t.__logTopologyWarnings&&-1!=t.edgeFaces[l]&&console.warn("Edge poly 1 already set. Mesh is non-manifold."),t.edgeFaces[l]=n}n in t.faceEdges||(t.faceEdges[n]=[]),t.faceEdges[n].push(r),null==t.vertexEdges[e]&&(t.vertexEdges[e]=new Set),null==t.vertexEdges[i]&&(t.vertexEdges[i]=new Set),t.vertexEdges[e].add(r),t.vertexEdges[i].add(r)},n=this.getNumFaces();for(var r=0;r<n;r++){var o=this.getFaceVertexIndices(r);for(var l=0;l<o.length;l++){i(o[l],o[(l+1)%o.length],r)}}};e.prototype.computeFaceNormals=function(){var t=this.vertices,e=this.addFaceAttribute("normals",Dn),a=this.getNumFaces();for(var i=0;i<a;i++){var n=this.getFaceVertexIndices(i),r=t.getValueRef(n[0]);var o=t.getValueRef(n[1]);var l=new Dn;for(var s=2;s<n.length;s++){var d=t.getValueRef(n[s]),c=o.subtract(r),u=d.subtract(r);l.addInPlace(c.cross(u).normalize()),o=d}l.lengthSquared(),e.setValue(i,l.normalize())}};e.prototype.generateEdgeFlags=function(){null==this.vertexEdges&&this.genTopologyInfo(),this.hasFaceAttribute("normals")||this.computeFaceNormals();var t=this.vertices,e=this.getFaceAttribute("normals");this.edgeVecs=[],this.edgeAngles=new Float32Array(this.numEdges);for(var a=0;a<this.edgeFaces.length;a+=2){var i=this.edgeVerts[a],n=this.edgeVerts[a+1],r=t.getValueRef(n).subtract(t.getValueRef(i));r.normalizeInPlace(),this.edgeVecs.push(r);var o=this.edgeFaces[a],l=this.edgeFaces[a+1];if(-1==o||-1==l){this.edgeAngles[a/2]=2*Math.PI;continue}var s=e.getValueRef(o),d=e.getValueRef(l);this.edgeAngles[a/2]=s.angleTo(d)}};e.prototype.computeVertexNormals=function(t){var e=this;if(t===void 0){t=1}this.generateEdgeFlags();var a=this.getFaceAttribute("normals"),i=this.addVertexAttribute("normals",Dn),n=a.data.buffer,r=function(t){return new Dn(n,12*t)},o=i.data,l=function(t,e){o[3*t+0]=e.x,o[3*t+1]=e.y,o[3*t+2]=e.z},s=function(t,a){var i,n;var r=e.faceEdges[t];for(var o=0,l=r;o<l.length;o++){var s=l[o];(e.edgeVerts[2*s]==a||e.edgeVerts[2*s+1]==a)&&(i?n=e.edgeVecs[s]:i=e.edgeVecs[s])}return[i,n]};var d=function(e){if(null==c.vertexEdges[e])return"continue";var a=c.vertexEdges[e],n=[],o=function(t){var e=!1;for(var a=0,i=n;a<i.length;a++){var r=i[a];if(e=-1!=r.indexOf(t),e)break}e||n.push([t])};for(var d=0,u=a;d<u.length;d++){var h=u[d];var m=c.edgeFaces[2*h],p=c.edgeFaces[2*h+1];if(-1!=m&&-1==p&&c.edgeAngles[h]<t){var f=-1,b=-1;for(var y=0;y<n.length;y++)-1==f&&-1!=n[y].indexOf(m)&&(f=y),-1==b&&-1!=n[y].indexOf(p)&&(b=y);-1==f&&-1==b?n.push([m,p]):-1!=f&&-1!=b?f!=b&&(n[f]=n[f].concat(n[b]),n.splice(b,1)):(-1==f&&n[b].push(m),-1==b&&n[f].push(p))}else-1!=m&&o(m),-1!=p&&o(p)}n.sort((function(t,e){return t.length<e.length?1:t.length>e.length?-1:0}));var g=!0;for(var _=0,Z=n;_<Z.length;_++){var G=Z[_];var X=new Dn;for(var v=0,V=G;v<V.length;v++){var I=V[v];var R=s(I,e),x=R[0].angleTo(R[1]);X.addInPlace(r(I).scale(x))}X.normalizeInPlace(),g?(l(e,X),g=!1):i.setSplitVertexValues(e,G,X)}};var c=this;for(var u=0;u<this.vertexEdges.length;u++){d(u)}return i};e.prototype.computeNumTriangles=function(){var t=3,e=0;for(var a=0,i=this.__faceCounts;a<i.length;a++){var n=i[a];e+=n*(t-2),t++}return e};e.prototype.generateTriangulatedIndices=function(t,e,a){var i=this.computeNumTriangles();var n;n=t<Math.pow(2,8)?new Uint8Array(3*i):t<Math.pow(2,16)?new Uint16Array(3*i):new Uint32Array(3*i);var r=0;var o=function(t,i){t in a&&i in a[t]&&(t=e+a[t][i]),n[r]=t,r++},l=this.getNumFaces();for(var s=0;s<l;s++){var d=this.getFaceVertexIndices(s);for(var c=0;c<d.length;c++)c>=3&&(o(d[0],s),o(d[c-1],s)),o(d[c],s)}return n};e.prototype.computeHardEdgesIndices=function(t){var e=this;if(t===void 0){t=1}var a=[],i=function(t){a.push(e.edgeVerts[t]),a.push(e.edgeVerts[t+1])};for(var n=0;n<this.edgeFlags.length;n+=2)this.edgeAngles[n/2]>t&&i(n);return a};e.prototype.getWireframeIndices=function(){return indices};e.prototype.genBuffers=function(t){var e={};var a=0;for(var i=0,n=this.__vertexAttributes;i<n.length;i++){var r=n[i],o=r[1];var l=o.getSplits();for(var s in l){s in e||(e[s]={});var d=l[s];for(var c in d){var u=parseInt(c);u in e[s]||(e[s][u]=a,a++)}}}var h=this.vertices.length,m=h+a;var p;t&&0==t.includeIndices||(p=this.generateTriangulatedIndices(m,h,e));var f={};for(var b=0,y=this.__vertexAttributes;b<y.length;b++){var g=y[b],_=g[0],Z=g[1];var G=void 0;G=0==a?Z.data:Z.generateSplitValues(e,a);var X=Z.numElements,v=G.length/X;f[_]={values:G,count:v,dimension:X,normalized:"normals"==_,dataType:Z.dataType}}var V={numVertices:this.numVertices(),numRenderVerts:m,indices:p,attrBuffers:f};if(t&&t.includeVertexNeighbors){null==this.vertexEdges&&this.genTopologyInfo();var I=0;for(var R=0;R<this.vertexEdges.length;R++)this.vertexEdges[R]&&(I+=this.vertexEdges[R].size);var x=new Uint32Array(2*this.vertexEdges.length+I),S=function(t){for(var e=0;e<t.length;e++){var a=t[e];for(var i=0;i<e;i++){var n=t[i];if(-1!=a[0]&&a[0]==n[1]){e!=i+1&&(t.splice(e,1),t.splice(i+1,0,a));break}if(-1!=a[1]&&a[1]==n[0]){t.splice(e,1),t.splice(i,0,a);break}}}},W=function(t){if(!(-1!=t[0][0]&&-1!=t[t.length-1][1]||-1==t[0][0]&&-1==t[t.length-1][1]))throw new Error("If fan starts with -1, it must also end with -1");for(var e=0;e<t.length;e++){var a=t[e];if((-1==a[0]||-1==a[1])&&0!=e&&e!=t.length-1)throw new Error("-1 only allowed at the beginning and end of a fan.");if(-1!=a[0]){var i=e-1;if(i<0&&(i+=t.length),a[0]!=t[i][1])throw new Error("Faces are not sequential")}if(-1!=a[1]){var n=(e+1)%t.length;if(a[1]!=t[n][0])throw new Error("Faces are not sequential")}}};var L=2*this.vertexEdges.length;for(var T=0;T<this.vertexEdges.length;T++){if(null==this.vertexEdges[T])continue;var M=this.vertexEdges[T],F=[];for(var C=0,N=M;C<N.length;C++){var Y=N[C];var K=this.edgeVerts[2*Y],w=this.edgeVerts[2*Y+1];var z=void 0,U=this.edgeFaces[2*Y],J=this.edgeFaces[2*Y+1];if(K==T)z=w;else{if(w!=T)throw new Error("Invalid topology");{z=K;var P=U;U=J,J=P}}F.push([U,J,z])}S(F),W(F);var E=0;(-1!=F[0][0]||-1!=F[F.length-1][1])&&(E+=1),x[2*T]=L,x[2*T+1]=M.size+(E<<8);for(var H=0,k=F;H<k.length;H++){var B=k[H];x[L]=B[2],L++}}V.vertexNeighbors=x}return V};e.prototype.freeBuffers=function(){t.prototype.freeBuffers.call(this),this.init()};e.prototype.readBinary=function(e,a){t.prototype.loadBaseGeomBinary.call(this,e),this.setFaceCounts(e.loadUInt32Array()),this.__faceVertexCounts=e.loadUInt8Array(this.__faceVertexCounts.length);var i=e.loadSInt32Vec2(),n=e.loadUInt8();var r;1==n?r=e.loadUInt8Array():2==n?r=e.loadUInt16Array():4==n&&(r=e.loadUInt32Array());var o=this.getNumFaces();var l=0,s=0;for(var d=0;d<o;d++){var c=this.__faceVertexCounts[d]+3;this.__faceOffsets[d]=l;for(var u=0;u<c;u++){var h=l+u,m=r[h]+i.x;if(0==d)this.__faceVertexIndices[h]=m;else{var p=this.__faceOffsets[d-1];p+=u<s?u:s-1,this.__faceVertexIndices[h]=this.__faceVertexIndices[p]+m}}l+=c,s=c}this.__numPopulatedFaceVertexIndices=l;var f=e.loadUInt32();if(f>0){var b=this.vertices,y=this.addVertexAttribute("lightmapCoords",Bn);for(var g=0;g<f;g++){var _=new ar(e.loadFloat32Vec3(),e.loadFloat32Quat()),Z=e.loadFloat32(),G=e.loadFloat32Vec2(),X=e.loadSInt32Vec2(),v=e.loadUInt8();var V=void 0;V=1==v?e.loadUInt8Array():2==v?e.loadUInt16Array():e.loadUInt32Array();var I=0;for(var R=0,x=V;R<x.length;R++){var S=x[R];var W=S+X.x;W+=I,I=W;var L=this.getFaceVertexIndices(W);for(var T=0,M=L;T<M.length;T++){var F=M[T];var C=b.getValueRef(F),N=_.transformVec3(C),Y=new Bn(N.x,N.z);Y.scaleInPlace(Z),Y.addInPlace(G),y.setFaceVertexValue_ByVertexIndex(W,F,Y)}}}}this.hasVertexAttribute("normals")||this.computeVertexNormals(),this.geomDataChanged.emit()};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return 1024&a||(i.faceCounts=Array.from(this.__faceCounts),i.faceVertexIndices=Array.from(this.__faceVertexIndices)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.faceCounts&&(this.__faceCounts=Uint32Array.from(e.faceCounts)),e.faceVertexIndices&&(this.__faceVertexIndices=Uint32Array.from(e.faceVertexIndices))};return e}(rl);var cl=function(t){__extends(e,t);function e(e){var a=this;if(a=t.call(this)||this,a.name=e.name,a.__buffers=e.geomBuffers,a.__buffers.attrBuffers)for(var i in a.__buffers.attrBuffers){var n=a.__buffers.attrBuffers[i],r=kn.getType(n.dataType);n.dataType=r}a.boundingBox=new rr,a.boundingBox.p0.__data=e.bbox.p0.__data,a.boundingBox.p1.__data=e.bbox.p1.__data,a.__metaData=new Map,a.boundingBoxDirtied=new dr,a.geomDataChanged=new dr,a.geomDataTopologyChanged=new dr;return a}e.prototype.genBuffers=function(){return this.__buffers};e.prototype.freeBuffers=function(){if(this.__buffers.indices&&delete this.__buffers.indices,this.__buffers.attrBuffers){for(var t in this.__buffers.attrBuffers){delete this.__buffers.attrBuffers[t]}delete this.__buffers.attrBuffers}};e.prototype.getMetadata=function(t){return this.__metaData.get(t)};e.prototype.hasMetadata=function(t){return this.__metaData.has(t)};e.prototype.setMetadata=function(t,e){this.__metaData.set(t,e)};return e}(fr);var ul=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}return e}(cl);var hl=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}return e}(cl);var ml=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}return e}(cl);var pl=function(t){__extends(e,t);function e(e,a,i,n,r){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=1}if(r===void 0){r=!1}var o=this;if(o=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");o.__x=e,o.__y=a,o.__xDivisions=i,o.__yDivisions=n,r&&o.addVertexAttribute("texCoords",Bn),o.__rebuild();return o}Object.defineProperty(e.prototype,"x",{get:function(){return console.warn("getter is deprectated. Please use 'getX'"),this.getX()},set:function(t){console.warn("getter is deprectated. Please use 'setX'"),this.setX(t)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return console.warn("getter is deprectated. Please use 'getY'"),this.getY()},set:function(t){console.warn("getter is deprectated. Please use 'setY'"),this.setY(t)},enumerable:true,configurable:true});e.prototype.getX=function(){return this.__x};e.prototype.setX=function(t){this.__x=t,this.__resize()};e.prototype.getY=function(){return this.__y};e.prototype.setY=function(t){this.__y=t,this.__resize()};e.prototype.setSize=function(t,e){this.__x=t,this.__y=e,this.__resize()};e.prototype.__rebuild=function(){this.setNumVertices(this.__xDivisions*this.__yDivisions);var t=this.getVertexAttribute("texCoords");if(t)for(var e=0;e<this.__yDivisions;e++){var a=e/(this.__yDivisions-1);for(var i=0;i<this.__xDivisions;i++){var n=i/(this.__xDivisions-1);t.getValueRef(e*this.__xDivisions+i).set(n,a)}}this.__resize()};e.prototype.__resize=function(){for(var t=0;t<this.__yDivisions;t++){var e=(t/(this.__yDivisions-1)-.5)*this.__y;for(var a=0;a<this.__xDivisions;a++){var i=(a/(this.__xDivisions-1)-.5)*this.__x;this.getVertex(t*this.__xDivisions+a).set(i,e,0)}}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e.xDivisions=this.__xDivisions,e.yDivisions=this.__yDivisions,e};return e}(ll);var fl=function(t){__extends(e,t);function e(e,a){if(e===void 0){e=1}if(a===void 0){a=1}var i=this;if(i=t.call(this)||this,isNaN(e)||isNaN(a))throw new Error("Invalid geom args");i.__x=i.addParameter(new Br("x",e)),i.__x.valueChanged.connect(i.__resize.bind(i)),i.__y=i.addParameter(new Br("y",a)),i.__y.valueChanged.connect(i.__resize.bind(i)),i.__rebuild();return i}Object.defineProperty(e.prototype,"x",{get:function(){return this.__x.getValue()},set:function(t){this.__x.setValue(t)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this.__y.getValue()},set:function(t){this.__y.setValue(t)},enumerable:true,configurable:true});e.prototype.setSize=function(t,e){this.__x.setValue(t,-1),this.__y.setValue(e,-1),this.__resize()};e.prototype.__rebuild=function(){this.setNumVertices(4),this.setNumSegments(4),this.setSegment(0,0,1),this.setSegment(1,1,2),this.setSegment(2,2,3),this.setSegment(3,3,0),this.__resize(-1),this.geomDataTopologyChanged.emit()};e.prototype.__resize=function(t){var e=this.__x.getValue(),a=this.__y.getValue();this.getVertex(0).set(-.5*e,-.5*a,0),this.getVertex(1).set(.5*e,-.5*a,0),this.getVertex(2).set(.5*e,.5*a,0),this.getVertex(3).set(-.5*e,.5*a,0),this.setBoundingBoxDirty(),-1!=t&&this.geomDataChanged.emit()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e};return e}(sl);br.registerClass("Rect",fl);var bl=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=1}if(a===void 0){a=2*Math.PI}if(i===void 0){i=32}var n=this;if(n=t.call(this)||this,isNaN(e)||isNaN(i))throw new Error("Invalid geom args");n.__radius=n.addParameter(new Br("Radius",e)),n.__angle=n.addParameter(new Br("Angle",a)),n.__numSegments=n.addParameter(new Br("NumSegments",i>=3?i:3,[3,200],1)),n.__radius.valueChanged.connect(n.__resize.bind(n)),n.__angle.valueChanged.connect(n.__rebuild.bind(n)),n.__numSegments.valueChanged.connect(n.__rebuild.bind(n)),n.__rebuild();return n}e.prototype.__rebuild=function(){var t=this.__numSegments.getValue();this.setNumVertices(t);var e=this.__angle.getValue()<2*Math.PI;e?this.setNumSegments(t-1):this.setNumSegments(t);for(var a=0;a<(e?t-1:t);a++)this.setSegment(a,a,(a+1)%t);this.__resize(-1),this.geomDataTopologyChanged.emit()};e.prototype.__resize=function(t){var e=this.__radius.getValue(),a=this.__numSegments.getValue(),i=this.__angle.getValue()/a;for(var n=0;n<a;n++)this.getVertex(n).set(Math.cos(i*n)*e,Math.sin(i*n)*e,0);this.setBoundingBoxDirty(),-1!=t&&this.geomDataChanged.emit()};return e}(sl);br.registerClass("Circle",bl);var yl=function(t){__extends(e,t);function e(e){if(e===void 0){e=1}var a=this;if(a=t.call(this)||this,isNaN(e))throw new Error("Invalid geom args");a.__sizeParam=a.addParameter(new Br("size",e)),a.__rebuild();a.__sizeParam.valueChanged.connect((function(){a.__resize()}));return a}Object.defineProperty(e.prototype,"size",{get:function(){return this.__size},set:function(t){this.__size=t,this.__resize()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){this.setNumVertices(6),this.setNumSegments(3),this.setSegment(0,0,1),this.setSegment(1,2,3),this.setSegment(2,4,5),this.__resize()};e.prototype.__resize=function(){var t=this.__sizeParam.getValue();this.getVertex(0).set(-.5*t,0,0),this.getVertex(1).set(.5*t,0,0),this.getVertex(2).set(0,.5*t,0),this.getVertex(3).set(0,-.5*t,0),this.getVertex(4).set(0,0,.5*t),this.getVertex(5).set(0,0,-.5*t),this.setBoundingBoxDirty()};return e}(sl);br.registerClass("Cross",yl);var _l=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=!1}var r=this;r=t.call(this)||this,r.__x=r.addParameter(new Br("x",e)),r.__x.valueChanged.connect(r.__resize.bind(r)),r.__y=r.addParameter(new Br("y",a)),r.__y.valueChanged.connect(r.__resize.bind(r)),r.__z=r.addParameter(new Br("z",i)),r.__z.valueChanged.connect(r.__resize.bind(r)),r.__baseZAtZero=r.addParameter(new Br("BaseZAtZero",n)),r.__baseZAtZero.valueChanged.connect(r.__rebuild.bind(r)),r.__rebuild();return r}e.prototype.__rebuild=function(){this.setNumVertices(8),this.setNumSegments(12),this.setSegment(0,0,1),this.setSegment(1,1,2),this.setSegment(2,2,3),this.setSegment(3,3,0),this.setSegment(4,4,5),this.setSegment(5,5,6),this.setSegment(6,6,7),this.setSegment(7,7,4),this.setSegment(8,0,4),this.setSegment(9,1,5),this.setSegment(10,2,6),this.setSegment(11,3,7),this.__resize(-1),this.geomDataTopologyChanged.emit()};e.prototype.__resize=function(t){var e=this.__x.getValue(),a=this.__y.getValue(),i=this.__z.getValue(),n=this.__baseZAtZero.getValue();var r=.5;n&&(r=1),this.getVertex(0).set(.5*e,-.5*a,r*i),this.getVertex(1).set(.5*e,.5*a,r*i),this.getVertex(2).set(-.5*e,.5*a,r*i),this.getVertex(3).set(-.5*e,-.5*a,r*i),r=-.5,n&&(r=0),this.getVertex(4).set(.5*e,-.5*a,r*i),this.getVertex(5).set(.5*e,.5*a,r*i),this.getVertex(6).set(-.5*e,.5*a,r*i),this.getVertex(7).set(-.5*e,-.5*a,r*i),this.setBoundingBoxDirty(),-1!=t&&this.geomDataChanged.emit()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.size=this.__size,e};return e}(sl);br.registerClass("LinesCuboid",_l);var Zl=function(t){__extends(e,t);function e(e,a,i,n,r){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=10}if(n===void 0){n=10}if(r===void 0){r=!1}var o=this;if(o=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");o.__xParam=o.addParameter(new Br("x",e)),o.__yParam=o.addParameter(new Br("y",a)),o.__xDivisionsParam=o.addParameter(new Br("xDivisions",i)),o.__yDivisionsParam=o.addParameter(new Br("yDivisions",n)),o.__skipCenterLinesParam=o.addParameter(new Or("skipCenterLines",r)),o.__rebuild();return o}Object.defineProperty(e.prototype,"sizeX",{get:function(){return this.__x},set:function(t){this.__x=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sizeY",{get:function(){return this.__y},set:function(t){this.__y=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"divisionsX",{get:function(){return this.__xDivisions},set:function(t){this.__xDivisions=t,this.__rebuild()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"divisionsY",{get:function(){return this.__yDivisions},set:function(t){this.__yDivisions=t,this.__rebuild()},enumerable:true,configurable:true});e.prototype.setSize=function(t,e){this.__x=t,this.__y=e,this.__resize()};e.prototype.__rebuild=function(){var t=this.__xDivisionsParam.getValue(),e=this.__yDivisionsParam.getValue(),a=this.__skipCenterLinesParam.getValue()&&t%2==0&&e%2==0;this.setNumVertices(2*(t+e+2-(a?1:0))),this.setNumSegments(t+e+2-(a?1:0));var i=0;for(var n=0;n<=t;n++){if(a&&n==t/2)continue;var r=2*i,o=2*i+1;this.setSegment(i,r,o),i++}for(var r=0;r<=e;r++){if(a&&r==t/2)continue;var l=2*i,o=2*i+1;this.setSegment(i,l,o),i++}this.__resize()};e.prototype.__resize=function(){var t=this.__xDivisionsParam.getValue(),e=this.__yDivisionsParam.getValue(),a=this.__xParam.getValue(),i=this.__yParam.getValue(),n=this.__skipCenterLinesParam.getValue()&&t%2==0&&e%2==0;var r=0;for(var o=0;o<=t;o++){if(n&&o==t/2)continue;var l=2*r,s=2*r+1,d=(o/t-.5)*a;this.getVertex(l).set(d,-.5*i,0),this.getVertex(s).set(d,.5*i,0),r++}for(var l=0;l<=e;l++){if(n&&l==t/2)continue;var s=2*r,d=2*r+1,c=(l/e-.5)*i;this.getVertex(s).set(-.5*a,c,0),this.getVertex(d).set(.5*a,c,0),r++}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.z=this.__y,e.xDivisions=this.__xDivisions,e.yDivisions=this.__yDivisions,e};return e}(sl);br.registerClass("Grid",Zl);var Gl=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=.5}if(a===void 0){a=1}if(i===void 0){i=32}if(n===void 0){n=!0}var r=this;if(r=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");r.__radiusParam=r.addParameter(new Br("radius",e)),r.__heightParam=r.addParameter(new Br("height",a)),r.__detailParam=r.addParameter(new Br("detail",i>=3?i:3,[3,200],1)),r.__capParam=r.addParameter(new Or("cap",n)),r.addVertexAttribute("texCoords",Bn),r.addVertexAttribute("normals",Dn),r.__rebuild();var o=function(){r.__resize()},l=function(){r.__rebuild()};r.__radiusParam.valueChanged.connect(o),r.__heightParam.valueChanged.connect(o),r.__detailParam.valueChanged.connect(l),r.__capParam.valueChanged.connect(l);return r}Object.defineProperty(e.prototype,"radius",{get:function(){return this.__radiusParam.getValue()},set:function(t){this.__radiusParam.setValue(t),this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this.__heightParam.getValue()},set:function(t){this.__heightParam.setValue(t),this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"detail",{get:function(){return this.__detailParam.getValue()},set:function(t){this.__detailParam.setValue(t),this.__rebuild()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cap",{get:function(){return this.__capParam.getValue()},set:function(t){this.__capParam.setValue(t),this.__rebuild()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){this.clear();var t=this.__detailParam.getValue(),e=this.__radiusParam.getValue(),a=this.__heightParam.getValue(),i=this.__capParam.getValue();var n=t+1;i&&(n+=1),this.setNumVertices(n);var r=t,o=t+1;this.getVertex(r).set(0,0,a);for(var l=0;l<t;l++){var s=l/t*2*Math.PI;this.getVertex(l).set(e*Math.cos(s),e*Math.sin(s),0)}i&&this.getVertex(o).set(0,0,0),this.setFaceCounts([t+(i?t:0)]);for(var d=0;d<t;d++){var c=(d+1)%t;this.setFaceVertexIndices(d,c,d,r)}if(i)for(var u=0;u<t;u++){var h=(u+1)%t;this.setFaceVertexIndices(t+u,u,h,o)}var m=this.getVertexAttribute("normals");var p;var f=a;Math.abs(a)<1e-12&&(p=a<0?-1e-12:1e-12),p=e/f;var b=0;for(var y=0;y<t;y++){var g=(y+1)/t*2*Math.PI,_=y/t*2*Math.PI,Z=.5*(g+_);m.setFaceVertexValue(b,0,new Dn(Math.cos(g),p,Math.sin(g)).normalize()),m.setFaceVertexValue(b,1,new Dn(Math.cos(_),p,Math.sin(_)).normalize()),m.setFaceVertexValue(b,2,new Dn(Math.cos(Z),p,Math.sin(Z)).normalize()),b++}if(i){var G=new Dn(0,-1,0);for(var X=0;X<t;X++)m.setFaceVertexValue(b,0,G),m.setFaceVertexValue(b,1,G),m.setFaceVertexValue(b,2,G),b++}var v=this.getVertexAttribute("texCoords");b=0;for(var V=0;V<t;V++)v.setFaceVertexValue(b,0,new Bn((V+1)/t,0)),v.setFaceVertexValue(b,1,new Bn(V/t,0)),v.setFaceVertexValue(b,2,new Bn((V+.5)/t,1));if(i)for(var I=0;I<t;I++)v.setFaceVertexValue(b,0,new Bn(I/t,0)),v.setFaceVertexValue(b,1,new Bn((I+1)/t,0)),v.setFaceVertexValue(b,2,new Bn((I+.5)/t,1)),b++;this.setBoundingBoxDirty()};e.prototype.__resize=function(){var t=this.__detailParam.getValue(),e=this.__radiusParam.getValue(),a=this.__heightParam.getValue(),i=(this.__capParam.getValue(),t),n=t+1;this.getVertex(i).set(0,0,a);for(var r=0;r<t;r++){var o=r/t*2*Math.PI;this.getVertex(r).set(e*Math.cos(o),e*Math.sin(o),0)}this.__cap&&this.getVertex(n).set(0,0,0),this.setBoundingBoxDirty()};return e}(dl);br.registerClass("Cone",Gl);var Xl=function(t){__extends(e,t);function e(e,a,i,n){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=!1}var r=this;if(r=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");r.__xParam=r.addParameter(new Br("x",e)),r.__yParam=r.addParameter(new Br("y",a)),r.__zParam=r.addParameter(new Br("z",i)),r.__baseZAtZeroParam=r.addParameter(new Or("baseZAtZero",n)),r.setFaceCounts([0,6]),r.setFaceVertexIndices(0,0,1,2,3),r.setFaceVertexIndices(1,7,6,5,4),r.setFaceVertexIndices(2,1,0,4,5),r.setFaceVertexIndices(3,3,2,6,7),r.setFaceVertexIndices(4,0,3,7,4),r.setFaceVertexIndices(5,2,1,5,6),r.setNumVertices(8),r.addVertexAttribute("texCoords",Bn),r.addVertexAttribute("normals",Dn),r.__rebuild();var o=function(){r.__resize()};r.__xParam.valueChanged.connect(o),r.__yParam.valueChanged.connect(o),r.__zParam.valueChanged.connect(o),r.__baseZAtZeroParam.valueChanged.connect(o);return r}e.prototype.setSize=function(t,e,a){this.__xParam.setValue(t),this.__yParam.setValue(e),this.__zParam.setValue(a)};e.prototype.setBaseSize=function(t,e){this.__xParam.setValue(t),this.__yParam.setValue(e)};e.prototype.__rebuild=function(){var t=this.getVertexAttribute("normals");for(var e=0;e<6;e++){var a=void 0;switch(e){case 0:a=new Dn(0,0,1);break;case 1:a=new Dn(0,0,-1);break;case 2:a=new Dn(1,0,0);break;case 3:a=new Dn(-1,0,0);break;case 4:a=new Dn(0,1,0);break;case 5:a=new Dn(0,-1,0)}t.setFaceVertexValue(e,0,a),t.setFaceVertexValue(e,1,a),t.setFaceVertexValue(e,2,a),t.setFaceVertexValue(e,3,a)}var i=this.getVertexAttribute("texCoords");for(var n=0;n<6;n++)i.setFaceVertexValue(n,0,new Bn(0,0)),i.setFaceVertexValue(n,1,new Bn(1,0)),i.setFaceVertexValue(n,2,new Bn(1,1)),i.setFaceVertexValue(n,3,new Bn(0,1));this.__resize()};e.prototype.__resize=function(t){var e=this.__xParam.getValue(),a=this.__yParam.getValue(),i=this.__zParam.getValue(),n=this.__baseZAtZeroParam.getValue();var r=.5;n&&(r=1),this.getVertex(0).set(.5*e,-.5*a,r*i),this.getVertex(1).set(.5*e,.5*a,r*i),this.getVertex(2).set(-.5*e,.5*a,r*i),this.getVertex(3).set(-.5*e,-.5*a,r*i),r=-.5,n&&(r=0),this.getVertex(4).set(.5*e,-.5*a,r*i),this.getVertex(5).set(.5*e,.5*a,r*i),this.getVertex(6).set(-.5*e,.5*a,r*i),this.getVertex(7).set(-.5*e,-.5*a,r*i),this.setBoundingBoxDirty(),this.geomDataChanged.emit()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e.z=this.__z,e};return e}(dl);br.registerClass("Cuboid",Xl);var vl=function(t){__extends(e,t);function e(e,a,i,n,r,o){if(e===void 0){e=.5}if(a===void 0){a=1}if(i===void 0){i=32}if(n===void 0){n=2}if(r===void 0){r=!0}if(o===void 0){o=!1}var l=this;if(l=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");l.__radiusParam=l.addParameter(new Br("radius",e)),l.__heightParam=l.addParameter(new Br("height",a)),l.__sidesParam=l.addParameter(new Br("sides",i>=3?i:3,[3,200],1)),l.__loopsParam=l.addParameter(new Br("loops",n>=2?n:2,[1,200],1)),l.__capsParam=l.addParameter(new Or("caps",r)),l.__baseZAtZeroParam=l.addParameter(new Or("baseZAtZero",o)),l.addVertexAttribute("texCoords",Bn),l.addVertexAttribute("normals",Dn),l.__rebuild();var s=function(){l.__resize()},d=function(){l.__rebuild()};l.__radiusParam.valueChanged.connect(s),l.__heightParam.valueChanged.connect(s),l.__sidesParam.valueChanged.connect(d),l.__loopsParam.valueChanged.connect(d),l.__capsParam.valueChanged.connect(d),l.__baseZAtZeroParam.valueChanged.connect(s);return l}e.prototype.__rebuild=function(){this.clear();this.__radiusParam.getValue();var t=this.__sidesParam.getValue(),e=this.__loopsParam.getValue(),a=(this.__heightParam.getValue(),this.__capsParam.getValue());this.__baseZAtZeroParam.getValue();var i=t*e;a&&(i+=2),this.setNumVertices(i),a?this.setFaceCounts([2*t,t]):this.setFaceCounts([0,t]);var n=0;for(var r=0;r<e-1;r++)for(var o=0;o<t;o++){var l=t*r+(o+1)%t,s=t*r+o,d=t*(r+1)+o,c=t*(r+1)+(o+1)%t;this.setFaceVertexIndices(n++,l,s,d,c)}if(a){for(var u=0;u<t;u++){var h=i-1,m=u,p=(u+1)%t;this.setFaceVertexIndices(n++,h,m,p)}for(var f=0;f<t;f++){var b=t*(e-1)+f,y=i-2,c=t*(e-1)+(f+1)%t;this.setFaceVertexIndices(n++,b,y,c)}}var g=this.getVertexAttribute("normals");n=0;for(var _=0;_<e-1;_++)for(var Z=0;Z<t;Z++){var G=Z/t*2*Math.PI;var X=new Dn(Math.sin(G),Math.cos(G),0);g.setFaceVertexValue(n,0,X),g.setFaceVertexValue(n,1,X),G=(Z+1)/t*2*Math.PI;var v=new Dn(Math.sin(G),Math.cos(G),0);g.setFaceVertexValue(n,2,v),g.setFaceVertexValue(n,3,v),n++}if(a){var V=new Dn(0,0,-1);for(var I=0;I<t;I++)g.setFaceVertexValue(n,0,V),g.setFaceVertexValue(n,1,V),g.setFaceVertexValue(n,2,V),n++;V.set(0,0,1);for(var R=0;R<t;R++)g.setFaceVertexValue(n,0,V),g.setFaceVertexValue(n,1,V),g.setFaceVertexValue(n,2,V),n++}var x=this.getVertexAttribute("texCoords");n=0;for(var S=0;S<t;S++)x.setFaceVertexValue(n,0,new Bn((S+1)/t,0)),x.setFaceVertexValue(n,2,new Bn((S+1)/t,1)),x.setFaceVertexValue(n,1,new Bn(S/t,0)),x.setFaceVertexValue(n,3,new Bn(S/t,1)),n++;if(a){for(var W=0;W<t;W++)x.setFaceVertexValue(n,0,new Bn(W/t,0)),x.setFaceVertexValue(n,1,new Bn((W+1)/t,0)),x.setFaceVertexValue(n,2,new Bn((W+.5)/t,1)),n++;for(var L=0;L<t;L++)x.setFaceVertexValue(n,0,new Bn(L/t,0)),x.setFaceVertexValue(n,1,new Bn((L+1)/t,0)),x.setFaceVertexValue(n,2,new Bn((L+.5)/t,1)),n++}this.geomDataTopologyChanged.emit(),this.__resize()};e.prototype.__resize=function(){var t=this.__sidesParam.getValue(),e=this.__loopsParam.getValue(),a=this.__radiusParam.getValue(),i=this.__heightParam.getValue(),n=this.__capsParam.getValue(),r=this.__baseZAtZeroParam.getValue();var o=t*e;n&&(o+=2);var l=0,s=.5;r&&(s=0);for(var d=0;d<e;d++){var c=d/(e-1)*i-i*s;for(var u=0;u<t;u++){var h=u/t*2*Math.PI;this.getVertex(l).set(Math.sin(h)*a,Math.cos(h)*a,c),l++}}n&&(this.getVertex(o-1).set(0,0,i*(r?0:-.5)),this.getVertex(o-2).set(0,0,i*(r?1:.5))),this.setBoundingBoxDirty(),this.geomDataChanged.emit()};return e}(dl);br.registerClass("Cylinder",vl);var Vl=function(t){__extends(e,t);function e(e,a){if(e===void 0){e=.5}if(a===void 0){a=32}var i=this;if(i=t.call(this)||this,isNaN(e)||isNaN(a))throw new Error("Invalid geom args");i.__radiusParam=i.addParameter(new Br("radius",e)),i.__sidesParam=i.addParameter(new Br("sides",a>=3?a:3,[3,200],1)),i.addVertexAttribute("texCoords",Bn),i.addVertexAttribute("normals",Dn),i.__rebuild();return i}Object.defineProperty(e.prototype,"radius",{get:function(){return this.__radius},set:function(t){this.__radius=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sides",{set:function(t){this.__sides=t>=3?t:3,this.__rebuild()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){var t=this.__sidesParam.getValue();this.setNumVertices(t+1),this.setFaceCounts([t]),this.getVertex(0).set(0,0,0);for(var e=0;e<t;e++){var a=e%t+1,i=(e+1)%t+1;this.setFaceVertexIndices(e,0,a,i)}var n=this.getVertexAttribute("normals"),r=new Dn(0,0,1);n.setValue(0,r);for(var o=0;o<t;o++)n.setValue(o+1,r);var l=this.getVertexAttribute("texCoords");l.getValueRef(0).set(.5,.5);for(var s=0;s<t;s++){var d=s/t*2*Math.PI;l.getValueRef(s+1).set(.5*Math.sin(d)+.5,.5*Math.cos(d)+.5)}this.setBoundingBoxDirty(),this.__resize()};e.prototype.__resize=function(){var t=this.__sidesParam.getValue(),e=this.__radiusParam.getValue();for(var a=0;a<t;a++){var i=a/t*2*Math.PI;this.getVertex(a+1).set(Math.sin(i)*e,Math.cos(i)*e,0)}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.radius=this.__radius,e};return e}(dl);br.registerClass("Disc",Vl);var Il=function(t){__extends(e,t);function e(e,a,i,n,r,o){if(e===void 0){e=1}if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=1}if(r===void 0){r=!0}if(o===void 0){o=!0}var l=this;if(l=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i)||isNaN(n))throw new Error("Invalid geom args");l.__sizeXParam=l.addParameter(new Br("SizeX",e)),l.__sizeYParam=l.addParameter(new Br("SizeY",a)),l.__detailXParam=l.addParameter(new Br("DetailX",i)),l.__detailYParam=l.addParameter(new Br("DetailY",n)),r&&l.addVertexAttribute("normals",Dn),o&&l.addVertexAttribute("texCoords",Bn),l.__rebuild(),l.__sizeXParam.valueChanged.connect(l.__resize.bind(l)),l.__sizeYParam.valueChanged.connect(l.__resize.bind(l)),l.__detailXParam.valueChanged.connect(l.__rebuild.bind(l)),l.__detailYParam.valueChanged.connect(l.__rebuild.bind(l));return l}e.prototype.__rebuild=function(){var t=this.__detailXParam.getValue(),e=this.__detailYParam.getValue();this.setNumVertices((t+1)*(e+1)),this.setFaceCounts([0,t*e]);var a=0;for(var i=0;i<e;i++)for(var n=0;n<t;n++){var r=(t+1)*(i+1)+n,o=(t+1)*(i+1)+(n+1),l=(t+1)*i+(n+1),s=(t+1)*i+n;this.setFaceVertexIndices(a,r,o,l,s),a+=1}var d=0;var c=this.getVertexAttribute("normals");if(c)for(var u=0;u<=e;u++)for(var h=0;h<=t;h++)c.getValueRef(d).set(0,0,1),d++;d=0;var m=this.getVertexAttribute("texCoords");if(m)for(var p=0;p<=e;p++){var f=p/e;for(var b=0;b<=t;b++){var y=b/t;m.getValueRef(d).set(y,f),d++}}this.__resize(!1),this.geomDataTopologyChanged.emit()};e.prototype.__resize=function(t){if(t===void 0){t=!0}var e=this.__sizeXParam.getValue(),a=this.__sizeYParam.getValue(),i=this.__detailXParam.getValue(),n=this.__detailYParam.getValue();var r=0;for(var o=0;o<=n;o++){var l=(o/n-.5)*a;for(var s=0;s<=i;s++){var d=(s/i-.5)*e;this.getVertex(r).set(d,l,0),r++}}this.setBoundingBoxDirty(),t&&this.geomDataChanged.emit()};return e}(dl);var Rl=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=1}if(a===void 0){a=12}if(i===void 0){i=12}var n=this;if(n=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");n.__radiusParam=n.addParameter(new Br("radius",e)),n.__sidesParam=n.addParameter(new Br("sides",a>=3?a:3,[3,200],1)),n.__loopsParam=n.addParameter(new Br("loops",i>=3?i:3,[3,200],1)),n.addVertexAttribute("texCoords",Bn),n.addVertexAttribute("normals",Dn),n.__rebuild();var r=function(){n.__rebuild()};n.__radiusParam.valueChanged.connect((function(){n.__resize()})),n.__sidesParam.valueChanged.connect(r),n.__loopsParam.valueChanged.connect(r);return n}e.prototype.__rebuild=function(){var t=this.__radiusParam.getValue(),e=this.__sidesParam.getValue(),a=this.__loopsParam.getValue(),i=2+e*a,n=2*e,r=e*a;this.setNumVertices(i),this.setFaceCounts([n,r]);var o=this.getVertexAttribute("normals"),l=new Dn(0,0,1);var s=0;this.getVertex(s).set(0,0,t),o.getValueRef(s).set(0,0,1),s++;for(var d=0;d<a;d++){var c=(d+1)/(a+1)*Math.PI;for(var u=0;u<e;u++){var h=u/e*2*Math.PI;l.set(Math.sin(c)*Math.cos(h),Math.sin(c)*Math.sin(h),Math.cos(c)),this.getVertex(s).setFromOther(l.scale(t)),o.getValueRef(s).setFromOther(l),s++}}this.getVertex(s).set(0,0,-t),o.getValueRef(s).set(0,0,-1),s++;var m=this.getVertexAttribute("texCoords");var p=0;for(var f=0;f<e;f++){var b=0,y=(f+1)%e+1,g=f+1;this.setFaceVertexIndices(p,b,y,g);var _=new Bn(.5,0),Z=new Bn(1-(f+1)/e,0),G=new Bn(1-f/e,1/(a+1));m.setFaceVertexValue(p,0,_),m.setFaceVertexValue(p,1,Z),m.setFaceVertexValue(p,2,G),p++}for(var X=0;X<e;X++){var v=i-1,V=e*(a-1)+X+1,I=e*(a-1)+(X+1)%e+1;this.setFaceVertexIndices(p,v,V,I);var R=new Bn(1-X/e,a/(a+1)),x=new Bn(1-(X+1)/e,a/(a+1)),S=new Bn(.5,1);m.setFaceVertexValue(p,0,R),m.setFaceVertexValue(p,1,x),m.setFaceVertexValue(p,2,S),p++}for(var W=0;W<a-1;W++)for(var L=0;L<e;L++){var T=e*W+L+1,M=e*W+(L+1)%e+1,F=e*(W+1)+(L+1)%e+1,C=e*(W+1)+L+1;this.setFaceVertexIndices(p,T,M,F,C),m.setFaceVertexValue(p,0,new Bn(W/a,L/a)),m.setFaceVertexValue(p,1,new Bn(W/a,(L+1)/a)),m.setFaceVertexValue(p,2,new Bn((W+1)/a,(L+1)/a)),m.setFaceVertexValue(p,3,new Bn((W+1)/a,L/a)),p++}this.setBoundingBoxDirty(),this.geomDataTopologyChanged.emit()};e.prototype.__resize=function(){var t=this.__radiusParam.getValue(),e=this.__sidesParam.getValue(),a=this.__loopsParam.getValue();var i=0;var n=new Dn(0,0,1);this.getVertex(i).set(0,0,t),i++;for(var r=0;r<a;r++){var o=(r+1)/(a+1)*Math.PI;for(var l=0;l<e;l++){var s=l/e*2*Math.PI;n.set(Math.sin(o)*Math.cos(s),Math.sin(o)*Math.sin(s),Math.cos(o)),this.getVertex(i).setFromOther(n.scale(t)),i++}}this.getVertex(i).set(0,0,-t),i++,this.setBoundingBoxDirty(),this.geomDataChanged.emit()};return e}(dl);br.registerClass("Sphere",Rl);var xl=function(t){__extends(e,t);function e(e,a,i){if(e===void 0){e=.5}if(a===void 0){a=1}if(i===void 0){i=32}var n=this;if(n=t.call(this)||this,isNaN(e)||isNaN(a)||isNaN(i))throw new Error("Invalid geom args");n.__innerRadius=e,n.__outerRadius=a,n.__detail=i>=3?i:3,n.addVertexAttribute("texCoords",Bn),n.addVertexAttribute("normals",Dn),n.__rebuild();return n}Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this.__innerRadius},set:function(t){this.__innerRadius=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this.__outerRadius},set:function(t){this.__outerRadius=t,this.__resize()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"detail",{get:function(){return this.__detail},set:function(t){this.__detail=t>=3?t:3,this.__rebuild()},enumerable:true,configurable:true});e.prototype.__rebuild=function(){var t=this.__detail,e=2*this.__detail,a=t*e;this.setNumVertices(a),this.setFaceCounts([0,t*e]);var i=this.getVertexAttribute("normals");var n=0;for(var r=0;r<e;r++){var o=r/e*2*Math.PI,l=Math.cos(o),s=Math.sin(o);for(var d=0;d<t;d++){var c=d/t*2*Math.PI,u=Math.sin(c),h=Math.cos(c),m=this.__outerRadius+h*this.__innerRadius;this.getVertex(n).set(l*m,s*m,this.__innerRadius*u),i.getValueRef(n).set(l*h,s*h,u),n++}}var p=this.getVertexAttribute("texCoords");var f=0;for(var b=0;b<e;b++)for(var y=0;y<t;y++){var g=(b+1)%e,s=(y+1)%t,h=t*b+y,m=t*b+s,_=t*g+s,Z=t*g+y;this.setFaceVertexIndices(f,h,m,_,Z),p.setFaceVertexValue(f,0,new Bn(b/e,y/e)),p.setFaceVertexValue(f,1,new Bn(b/e,(y+1)/e)),p.setFaceVertexValue(f,2,new Bn((b+1)/e,(y+1)/e)),p.setFaceVertexValue(f,3,new Bn((b+1)/e,y/e)),f++}this.setBoundingBoxDirty()};e.prototype.__resize=function(){var t=this.__detail,e=2*this.__detail;for(var a=0;a<e;a++){var i=a/e*2*Math.PI,n=Math.cos(i),r=Math.sin(i);for(var o=0;o<t;o++){var l=o/t*2*Math.PI,s=Math.sin(l),d=Math.cos(l),c=this.__outerRadius+d*this.__innerRadius;this.getVertex(0).set(n*c,r*c,this.__innerRadius*s),index++}}this.setBoundingBoxDirty()};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.x=this.__x,e.y=this.__y,e.z=this.__z,e};return e}(dl);var Sl={SAVE_FLAG_SKIP_CHILDREN:1},Wl={LOAD_FLAG_LOADING_BIN_TREE_VALUES:16},Ll={CLONE_FLAG_INSTANCED_TREE:1};var Tl=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__visibleCounter=1,a.__visible=!0,a.__highlightMapping={},a.__highlights=[],a.__childItems=[],a.__childItemsSignalIds=[],a.__childItemsMapping={},a.mouseDown=new dr,a.mouseUp=new dr,a.mouseMove=new dr,a.mouseEnter=new dr,a.mouseLeave=new dr,a.__visibleParam=a.addParameter(new Or("Visible",!0)),a.__localXfoParam=a.addParameter(new eo("LocalXfo",new ar)),a.__globalXfoParam=a.addParameter(new eo("GlobalXfo",new ar)),a.__boundingBoxParam=a.addParameter(new Vr("BoundingBox",new rr)),a.parentChanged=a.ownerChanged,a.childAdded=new dr,a.childRemoved=new dr,a.highlightChanged=new dr,a.visibilityChanged=new dr,a.localXfoChanged=a.__localXfoParam.valueChanged,a.globalXfoChanged=a.__globalXfoParam.valueChanged,a.boundingChanged=a.__boundingBoxParam.valueChanged,a._cleanGlobalXfo=a._cleanGlobalXfo.bind(a),a._setGlobalXfoDirty=a._setGlobalXfoDirty.bind(a),a._setBoundingBoxDirty=a._setBoundingBoxDirty.bind(a),a._cleanBoundingBox=a._cleanBoundingBox.bind(a),a.__localXfoParam.valueChanged.connect(a._setGlobalXfoDirty);var i=function(t){var e=a.__globalXfoParam.getValue();return void 0!==a.__ownerItem?a.__ownerItem.getGlobalXfo().inverse().multiply(e):e};a.__globalXfoParam.valueChanged.connect((function(t){t!=gr.OPERATOR_DIRTIED&&a.__localXfoParam.setDirty(i),a._setBoundingBoxDirty()})),a.__visibleParam.valueChanged.connect((function(t){a.__visibleCounter+=a.__visibleParam.getValue()?1:-1,a.__updateVisiblity()}));return a}Object.defineProperty(e,"SaveFlags",{get:function(){return Sl},enumerable:true,configurable:true});Object.defineProperty(e,"LoadFlags",{get:function(){return Wl},enumerable:true,configurable:true});Object.defineProperty(e,"CloneFlags",{get:function(){return Ll},enumerable:true,configurable:true});e.getSelectionOutlineColor=function(){return selectionOutlineColor};e.setSelectionOutlineColor=function(t){selectionOutlineColor=t};e.getBranchSelectionOutlineColor=function(){return branchSelectionOutlineColor};e.setBranchSelectionOutlineColor=function(t){branchSelectionOutlineColor=t};e.prototype._childFlagsChanged=function(t){0!=(t&_r.USER_EDITED)&&this.setFlag(xr.USER_EDITED)};e.prototype.setFlag=function(e){t.prototype.setFlag.call(this,e),this.__ownerItem&&this.__ownerItem._childFlagsChanged(e)};e.prototype.setOwner=function(e){if(this.__ownerItem){this.__ownerItem.globalXfoChanged.disconnect(this._setGlobalXfoDirty),this.__ownerItem.getVisible()||this.__visibleCounter++;var a=this.__ownerItem.getChildIndex(this);a>=0&&this.__ownerItem.__unbindChild(a,this)}t.prototype.setOwner.call(this,e),this._setGlobalXfoDirty(),this.__ownerItem&&(this.setSelectable(this.__ownerItem.getSelectable(),!0),this.__ownerItem.getVisible()||this.__visibleCounter--,this.__ownerItem.globalXfoChanged.connect(this._setGlobalXfoDirty)),this.__updateVisiblity()};e.prototype.__updatePath=function(){t.prototype.__updatePath.call(this);for(var e=0,a=this.__childItems;e<a.length;e++){var i=a[e];i&&i.__updatePath()}};e.prototype.getParentItem=function(){return this.getOwner()};e.prototype.setParentItem=function(t){this.setOwner(t)};e.prototype.getLocalXfo=function(){return this.__localXfoParam.getValue()};e.prototype.setLocalXfo=function(t,e){this.__localXfoParam.setValue(t,e)};e.prototype.getGlobalXfo=function(t){return this.__globalXfoParam.getValue(t)};e.prototype.setGlobalXfo=function(t,e){var a=this.getOwner();if(a){var i=a.getGlobalXfo().inverse().multiply(t);this.__localXfoParam.setValue(i,e)}else this.__globalXfoParam.setValue(t,e)};e.prototype._cleanGlobalXfo=function(t){var e=this.getParentItem(),a=this.__localXfoParam.getValue();if(void 0!==e){return e.getGlobalXfo().multiply(a)}return a};e.prototype._setGlobalXfoDirty=function(){this.__globalXfoParam.setDirty(this._cleanGlobalXfo)};e.prototype.getVisible=function(){return this.__visibleCounter>0};e.prototype.setVisible=function(t){this.__visibleParam.setValue(t)};e.prototype.propagateVisiblity=function(t){this.__visibleCounter+=t,this.__updateVisiblity()};e.prototype.__updateVisiblity=function(){var t=this.__visibleCounter>0;if(t!=this.__visible){this.__visible=t;for(var a=0,i=this.__childItems;a<i.length;a++){var n=i[a];n instanceof e&&n.propagateVisiblity(this.__visible?1:-1)}return this.visibilityChanged.emit(t),!0}return!1};e.prototype.addHighlight=function(t,a,i){if(i===void 0){i=!1}if(t in this.__highlightMapping){var n=this.__highlights.indexOf(t);this.__highlights.splice(n,1)}this.__highlights.push(t),this.__highlightMapping[t]=a,this.highlightChanged.emit(),i&&this.__childItems.forEach((function(n){n instanceof e&&n.addHighlight(t,a,i)}))};e.prototype.removeHighlight=function(t,a){if(a===void 0){a=!1}if(t in this.__highlightMapping){var i=this.__highlights.indexOf(t);this.__highlights.splice(i,1),delete this.__highlightMapping[t],this.highlightChanged.emit()}a&&this.__childItems.forEach((function(i){i instanceof e&&i.removeHighlight(t,a)}))};e.prototype.getHighlight=function(){if(this.__highlights.length>0)return this.__highlightMapping[this.__highlights[this.__highlights.length-1]]};e.prototype.isHighlighted=function(){return this.__highlights.length>0};Object.defineProperty(e.prototype,"boundingBox",{get:function(){return console.warn("getter is deprectated. Please use 'getBoundingBox'"),this.getBoundingBox()},enumerable:true,configurable:true});e.prototype.getBoundingBox=function(){return this.__boundingBoxParam.getValue()};e.prototype._cleanBoundingBox=function(t){return t.reset(),this.__childItems.forEach((function(a){a instanceof e&&a.getVisible()&&!a.testFlag(xr.IGNORE_BBOX)&&t.addBox3(a.getBoundingBox())})),t};e.prototype._childBBoxChanged=function(){this._setBoundingBoxDirty()};e.prototype._setBoundingBoxDirty=function(){this.__boundingBoxParam&&this.__boundingBoxParam.setDirty(this._cleanBoundingBox)};e.prototype.getChildren=function(){return this.__childItems};e.prototype.numChildren=function(){return console.warn("Deprecated method. Please use getNumChildren"),this.__childItems.length};e.prototype.getNumChildren=function(){return this.__childItems.length};e.prototype.generateUniqueName=function(t){if(!(t in this.__childItemsMapping))return t;var e=1;t.length>4&&!Number.isNaN(parseInt(t.substring(t.length-4)))?e=parseInt(t.substr(t.length-4)):t.length>3&&!Number.isNaN(parseInt(t.substring(t.length-3)))?e=parseInt(t.substr(t.length-3)):t.length>2&&!Number.isNaN(parseInt(t.substring(t.length-2)))&&(e=parseInt(t.substr(t.length-2)));var a=[];for(var i=0,n=this.__childItems;i<n.length;i++){var r=n[i];r&&a.push(r.getName())}var o=t;for(;;){var l=""+e;for(;l.length<2;)l="0"+l;if(o=t+l,-1==a.indexOf(o))break;e++}return o};e.prototype.__updateMapping=function(t){for(var e=t;e<this.__childItems.length;e++)this.__childItemsMapping[this.__childItems[e].getName()]=e};e.prototype.insertChild=function(t,a,i,n){var r=this;if(i===void 0){i=!1}if(n===void 0){n=!0}if(t.getName()in this.__childItemsMapping){if(!n)throw new Error("Item '"+t.getName()+"' is already a child of :"+this.getPath());t.setName(this.generateUniqueName(t.getName()))}if(!(t instanceof Wr))throw new Error("Object is is not a tree item :"+t.constructor.name);var o={};var l;return o.nameChangedId=t.nameChanged.connect((function(t,e){var a=r.__childItemsMapping[e];delete r.__childItemsMapping[e],r.__childItemsMapping[t]=a})),t instanceof e&&(i&&(l=this.getGlobalXfo().inverse().multiply(t.getGlobalXfo())),o.bboxChangedId=t.boundingChanged.connect((function(){r._setBoundingBoxDirty()})),o.visChangedId=t.visibilityChanged.connect(this._setBoundingBoxDirty)),this.__childItems.splice(a,0,t),this.__childItemsSignalIds.splice(a,0,o),this.__childItemsMapping[t.getName()]=a,this.__updateMapping(a),t.setOwner(this),t instanceof e&&(i&&t.setLocalXfo(l),this._setBoundingBoxDirty()),t.testFlag(xr.USER_EDITED)&&this.setFlag(xr.USER_EDITED),this.childAdded.emit(t,a),t};e.prototype.addChild=function(t,e,a){if(e===void 0){e=!0}if(a===void 0){a=!0}var i=this.__childItems.length;return this.insertChild(t,i,e,a),i};e.prototype.getChild=function(t){return this.__childItems[t]};e.prototype.getChildByName=function(t){var e=this.__childItemsMapping[t];return null!=e?this.__childItems[e]:null};e.prototype.getChildNames=function(){var t=[];for(var e=0;e<this.__childItems.length;e++){var a=this.__childItems[e];null!=a&&(t[e]=a.getName())}return t};e.prototype.__unbindChild=function(t,a){var i=this.__childItemsSignalIds[t];a.nameChanged.disconnectId(i.nameChangedId),a instanceof e&&(a.boundingChanged.disconnectId(i.bboxChangedId),a.visibilityChanged.disconnectId(i.visChangedId)),this.__childItems.splice(t,1),this.__childItemsSignalIds.splice(t,1),delete this.__childItemsMapping[a.getName()],this.__updateMapping(t),a instanceof e&&this._setBoundingBoxDirty(),this.childRemoved.emit(a,t)};e.prototype.removeChild=function(t){var e=this.__childItems[t];e&&(this.__unbindChild(t,e),e.setOwner(void 0))};e.prototype.removeChildByName=function(t){var e=this.__childItemsMapping[t];return null!=e?this.removeChild(e):null};e.prototype.removeChildByHandle=function(t){console.warn("Deprecated method. Please use removeChild");var e=this.__childItems.indexOf(t);if(-1==e)throw new Error("Error in removeChildByHandle. Child not found:"+t.getName());this.removeChild(e)};e.prototype.removeAllChildren=function(){var t=this.__childItems.length;for(;t--;)this.removeChild(t);this._setBoundingBoxDirty()};e.prototype.getChildIndex=function(t){return this.__childItems.indexOf(t)};e.prototype.indexOfChild=function(t){return console.warn("Deprecated method. Please use getChildIndex"),this.getChildIndex(t)};e.prototype.resolvePath=function(t,e){if(e===void 0){e=0}if("string"==typeof t&&(t=t.split("/")),0==e)if("."==t[0]||t[0]==this.__name)e++;else if(".."==t[0])return this.__ownerItem.resolvePath(t,e+1);if(e==t.length)return this;var a=t[e],i=this.getChildByName(a);if(null==i){var n=this.getParameter(t[e]);return n||null}return i.resolvePath(t,e+1)};e.prototype.traverse=function(t,e){if(e===void 0){e=!0}var a=function(t,e){var a=t.getChildren();for(var n=0,r=a;n<r.length;n++){var o=r[n];o&&i(o,e+1)}},i=function(e,i){if(0==t(e,i))return!1;a(e,i)};e?i(this,1):a(this,0)};e.prototype.onMouseDown=function(t){this.mouseDown.emit(t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseDown(t)};e.prototype.onMouseUp=function(t){this.mouseUp.emit(t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseUp(t)};e.prototype.onMouseMove=function(t){this.mouseMove.emit(t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseMove(t)};e.prototype.onMouseEnter=function(t){this.mouseEnter.emit(t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseEnter(t)};e.prototype.onMouseLeave=function(t){this.mouseLeave.emit(t),t.propagating&&this.__ownerItem&&this.__ownerItem.onMouseLeave(t)};e.prototype.onWheel=function(t){t.propagating&&this.__ownerItem&&this.__ownerItem.onWheel(t)};e.prototype.toJSON=function(e,a){if(!this.testFlag(xr.USER_EDITED))return;var i=t.prototype.toJSON.call(this,e,a);if(!(a&Sl.SAVE_FLAG_SKIP_CHILDREN)){var n={};for(var r=0,o=this.__childItems;r<o.length;r++){var l=o[r];if(l){var s=l.toJSON(e,a);s&&(n[l.getName()]=s)}}Object.keys(n).length>0&&(i?i.children=n:i={name:this.__name,children:n})}return i};e.prototype.fromJSON=function(e,a,i){if(t.prototype.fromJSON.call(this,e,a,i),a.numTreeItems++,this.setFlag(xr.USER_EDITED),null!=e.children){var n=e.children;if(Array.isArray(n))for(var r=0,o=n;r<o.length;r++){var l=o[r];var s=this.getChildByName(l.name);s?s.fromJSON(l,a,i):l.type&&(s=br.constructClass(l.type),s&&(s.fromJSON(l,a,i),this.addChild(s,!1,!1)))}else for(var d in n){var c=n[d];var u=this.getChildByName(d);u?u.fromJSON(c,a,i):c.type&&(u=br.constructClass(c.type),u&&(u.fromJSON(c,a,i),this.addChild(u,!1,!1)))}}};e.prototype.readBinary=function(e,a){t.prototype.readBinary.call(this,e,a),a.numTreeItems++;var i=e.loadUInt8();if(4&i){var n=new ar;n.tr=e.loadFloat32Vec3(),n.ori=e.loadFloat32Quat(),n.sc.set(e.loadFloat32()),this.__localXfoParam.setValue(n,gr.DATA_LOAD)}8&i&&this.__boundingBoxParam.setValue(new rr(e.loadFloat32Vec3(),e.loadFloat32Vec3()),gr.DATA_LOAD);var r=e.loadUInt32();if(r>0){var o=e.loadUInt32Array(r);for(var l=0;l<r;l++){e.seek(o[l]);var s=e.loadStr();if(s.startsWith("N")&&s.endsWith("E")){var d=s.indexOf("podium");-1!=d&&(s=parseInt(s[d+7])?s.substring(d+8,s.length-1):s.substring(d+7,s.length-1)),-1!=s.indexOf("livenurbs")&&(s=s.substring(s.indexOf("CAD"),s.length-1))}var c=br.constructClass(s);if(c)e.seek(o[l]),c.readBinary(e,a),c.setFlag(xr.BIN_NODE),this.addChild(c,!1,!1);else{var u=e.loadStr();console.warn("Unable to construct child:"+u+" of type:"+s)}}}};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){var i=this;t.prototype.copyFrom.call(this,e,a),e.getChildren().forEach((function(t){t&&i.addChild(t.clone(a),!1,!1)}))};e.prototype.destroy=function(){this.removeAllChildren(),t.prototype.destroy.call(this)};return e}(Wr);br.registerClass("TreeItem",Tl);var Ml=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e.prototype.setSrcTree=function(t,e){var a=this;if(this.__srcTree=t,0==this.__srcTree.getNumChildren()){var i=this.__srcTree.clone(e);i.setLocalXfo(new ar,gr.DATA_LOAD),this.addChild(i,!1)}else{this.__srcTree.getChildren().forEach((function(t){var i=t.clone(e);a.addChild(i,!1)}))}};e.prototype.getSrcTree=function(){return this.__srcTree};e.prototype.readBinary=function(e,a){var i=this;if(a===void 0){a={}}t.prototype.readBinary.call(this,e,a);var n=e.loadStrArray();a.resolvePath(n,(function(t){i.setSrcTree(t,a)}))};e.prototype.toJSON=function(e,a){if(e===void 0){e={}}if(a===void 0){a=0}return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(t,e,a,i){if(e===void 0){e={}}if(a===void 0){a=0}};return e}(Tl);br.registerClass("InstanceItem",Ml);var Fl=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__loaded=!1,a.audioSourceCreated=new dr;var i=a.addParameter(new ro("FilePath"));var n,r;var o=function(){n=window.ZeaAudioaudioCtx.createBufferSource(),n.buffer=r,n.loop=c.getValue(),n.muted=d.getValue(),n.start(0),a.audioSourceCreated.emit(n)};i.valueChanged.connect((function(){var t=new XMLHttpRequest;t.open("GET",i.getURL(),!0),t.responseType="arraybuffer",t.onload=function(){var e=t.response;window.ZeaAudioaudioCtx.decodeAudioData(e,(function(t){r=t,a.__loaded=!0,a.loaded.emit(!0),l.getValue()&&o()}),(function(t){console.log("Error with decoding audio data"+t.err)}))},t.send()}));var l=a.addParameter(new Or("Autoplay",!1)),s=a.addParameter(new Br("PlayState",0));s.valueChanged.connect((function(t){if(t!=gr.CUSTOM)switch(s.getValue()){case 0:a.__loaded&&n&&(n.stop(0),n=void 0);break;case 1:a.__loaded&&o()}})),a.isPlaying=function(){return 0!=s.getValue()},a.play=function(){s.setValue(1,gr.CUSTOM)},a.stop=function(){s.setValue(0,gr.CUSTOM)},a.pause=function(){s.setValue(0,gr.CUSTOM)},a.getAudioSource=function(){return n};var d=a.addParameter(new Or("Mute",!1));a.addParameter(new Br("Gain",1)).setRange([0,5]);var c=a.addParameter(new Or("Loop",!1));a.addParameter(new Or("SpatializeAudio",!0)),a.addParameter(new Br("refDistance",2)),a.addParameter(new Br("maxDistance",1e4)),a.addParameter(new Br("rolloffFactor",1)),a.addParameter(new Br("coneInnerAngle",360)),a.addParameter(new Br("coneOuterAngle",0)),a.addParameter(new Br("coneOuterGain",1)),d.valueChanged.connect((function(){n&&(n.muted=d.getValue())})),c.valueChanged.connect((function(){n&&(n.loop=c.getValue())})),a.mute=function(t){d.setValue(t,gr.CUSTOM)},a.loaded=new dr(!0),a.loaded.setToggled(!1);return a}e.prototype.isLoaded=function(){return this.__loaded};e.prototype.setAudioStream=function(){this.__loaded=!0,this.loaded.emit(),this.audioSourceCreated.emit(audioSource)};return e}(Tl);var Cl=function(t){__extends(e,t);function e(t){var e=this;return e}return e}(Fl);var Nl=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.overlay=!1,a.__cutAway=!1,a.__cutAwayVector=!1,a.__cutAwayDist=!1,a.cutAwayChanged=new dr,a.__layers=[];return a}e.prototype.setOverlay=function(t){this.overlay=t};e.prototype.isOverlay=function(){return this.overlay};e.prototype.addLayer=function(t){this.__layers.push(t)};e.prototype.getLayers=function(){return this.__layers};e.prototype.isCutawayEnabled=function(){return this.__cutAway};e.prototype.setCutawayEnabled=function(t){this.__cutAway=t,this.cutAwayChanged.emit()};e.prototype.getCutVector=function(){return this.__cutAwayVector};e.prototype.setCutVector=function(t){this.__cutAwayVector=t,this.cutAwayChanged.emit()};e.prototype.getCutDist=function(){return this.__cutAwayDist};e.prototype.setCutDist=function(t){this.__cutAwayDist=t,this.cutAwayChanged.emit()};e.prototype.readBinary=function(e,a){if(t.prototype.readBinary.call(this,e,a),a.versions["zea-engine"].greaterOrEqualThan([0,0,4])){var i=e.loadStr();var n=a.assetItem.getMaterialLibrary().getMaterial(i,!1);if(n||(n=new yo(i,"SimpleSurfaceShader"),n.getParameter("BaseColor").setValue(An.random(.25),gr.DATA_LOAD),a.assetItem.getMaterialLibrary().addMaterial(n)),this.setMaterial(n,gr.DATA_LOAD),this.__layers=e.loadStrArray(),this.__layers.length>0)for(var r=0,o=this.__layers;r<o.length;r++){var l=o[r];a.addGeomToLayer(this,l)}}};return e}(Tl);var Yl=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e)||this,n.__geomParam=n.insertParameter(new ho("Geometry"),0),n.__geomParam.valueChanged.connect(n._setBoundingBoxDirty.bind(n)),n.__geomParam.boundingBoxDirtied.connect(n._setBoundingBoxDirty.bind(n)),n.__materialParam=n.insertParameter(new il("Material"),1),n.__paramMapping.material=n.getParameterIndex(n.__materialParam),n.__lightmapCoordOffset=new Bn,n.__geomOffsetXfoParam=n.addParameter(new eo("GeomOffsetXfo")),n.__geomMatParam=n.addParameter(new to("GeomMat")),n.__cleanGeomMat=n.__cleanGeomMat.bind(n),n.__globalXfoParam.valueChanged.connect((function(t){n.__geomMatParam.setDirty(n.__cleanGeomMat)})),n.__geomOffsetXfoParam.valueChanged.connect((function(t){n.__geomMatParam.setDirty(n.__cleanGeomMat)})),n.geomXfoChanged=n.__geomMatParam.valueChanged,n.materialAssigned=n.__materialParam.valueChanged,n.geomAssigned=n.__geomParam.valueChanged,a&&n.setGeometry(a,gr.DATA_LOAD),i&&n.setMaterial(i,gr.DATA_LOAD);return n}e.prototype.__cleanGeomMat=function(){var t=this.__globalXfoParam.getValue().toMat4(),e=this.__geomOffsetXfoParam.getValue().toMat4();return t.multiply(e)};e.prototype.getGeometry=function(){return this.__geomParam.getValue()};e.prototype.setGeometry=function(t,e){this.__geomParam.setValue(t,e)};e.prototype.getGeom=function(){return console.warn("getGeom is deprectated. Please use 'getGeometry'"),this.getGeometry()};e.prototype.setGeom=function(t){return console.warn("setGeom is deprectated. Please use 'setGeometry'"),this.setGeometry(t)};e.prototype.getMaterial=function(){return this.__materialParam.getValue()};e.prototype.setMaterial=function(t,e){this.__materialParam.setValue(t,e)};e.prototype._cleanBoundingBox=function(e){e=t.prototype._cleanBoundingBox.call(this,e);var a=this.getGeometry();return a&&e.addBox3(a.boundingBox,this.getGeomMat4()),e};e.prototype.getGeomOffsetXfo=function(){return this.__geomOffsetXfoParam.getValue()};e.prototype.setGeomOffsetXfo=function(t){this.__geomOffsetXfoParam.setValue(t)};e.prototype.getGeomMat4=function(){return this.__geomMatParam.getValue()};e.prototype.getLightmapName=function(){return this.__lightmapName};e.prototype.getLightmapCoordsOffset=function(){return this.__lightmapCoordOffset};e.prototype.applyAssetLightmapSettings=function(t,e){this.__lightmap=t,this.__lightmapCoordOffset.addInPlace(e)};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a){t.prototype.fromJSON.call(this,e,a),a.numGeomItems++};e.prototype.readBinary=function(e,a){var i=this;t.prototype.readBinary.call(this,e,a),a.numGeomItems++,this.__lightmapName=a.assetItem.getName();var n=e.loadUInt8(),r=e.loadUInt32(),o=a.assetItem.getGeometryLibrary(),l=o.getGeom(r);if(l)this.setGeometry(l,gr.DATA_LOAD);else{this.geomIndex=r;var s=function(t){if(r>=t[0]&&r<t[1]){var e=o.getGeom(r);e?i.setGeometry(e,gr.DATA_LOAD):console.warn("Geom not loaded:",i.getName()),o.rangeLoaded.disconnectId(d)}},d=o.rangeLoaded.connect(s)}if(4&n&&this.__geomOffsetXfoParam.setValue(new ar(e.loadFloat32Vec3(),e.loadFloat32Quat(),e.loadFloat32Vec3())),a.versions["zea-engine"].lessThan([0,0,4])){if(n&8){var c=a.assetItem.getMaterialLibrary(),u=e.loadStr();var h=c.getMaterial(u);h||(console.warn("Geom :'"+this.name+"' Material not found:"+u),h=c.getMaterial("Default")),this.setMaterial(h,gr.DATA_LOAD)}else this.setMaterial(a.assetItem.getMaterialLibrary().getMaterial("Default"),gr.DATA_LOAD)}this.__lightmapCoordOffset=e.loadFloat32Vec2()};e.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){var i=this;if(t.prototype.copyFrom.call(this,e,a),this.__lightmapCoordOffset=e.__lightmapCoordOffset,!e.getGeometry()&&-1!=e.geomIndex){var n=a.assetItem.getGeometryLibrary(),r=e.geomIndex,o=function(t){if(r>=t[0]&&r<t[1]){var e=n.getGeom(r);e?i.setGeometry(e,gr.DATA_LOAD):console.warn("Geom not loaded:",i.getName()),n.rangeLoaded.disconnectId(l)}},l=n.rangeLoaded.connect(o)}this.__geomMatParam.setDirty(this.__cleanGeomMat)};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(Nl);br.registerClass("GeomItem",Yl);var Kl={manual:0,first:1,average:2,globalOri:3};var wl=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.setFlag(xr.USER_EDITED),a.calculatingGroupXfo=!1,a.dirty=!1,a.invGroupXfo=void 0,a.__initialXfos=[],a.__signalIndices=[];var i=0;a.__itemsParam=a.insertParameter(new co("Items",(function(t){return t instanceof Tl})),i++),a.__itemsParam.itemAdded.connect((function(t,e){a.__bindItem(t,e)})),a.__itemsParam.itemRemoved.connect((function(t,e){a.__unbindItem(t,e)})),a.__itemsParam.valueChanged.connect((function(){a.calcGroupXfo(),a._setBoundingBoxDirty()})),a.__initialXfoModeParam=a.insertParameter(new Dr("InitialXfoMode",Kl.average,["manual","first","average","global"]),i++),a.__initialXfoModeParam.valueChanged.connect((function(){a.calcGroupXfo()})),a.__highlightedParam=a.insertParameter(new Or("Highlighted",!1),i++),a.__highlightedParam.valueChanged.connect((function(){a.__updateHighlight()})),a.__updateHighlight=a.__updateHighlight.bind(a),a.insertParameter(new qr("HighlightColor",new An(.5,.5,1)),i++).valueChanged.connect(a.__updateHighlight),a.insertParameter(new Br("HighlightFill",0,[0,1]),i++).valueChanged.connect(a.__updateHighlight),a.__materialParam=a.insertParameter(new il("Material"),i++),a.__materialParam.valueChanged.connect((function(){a.__updateMaterial()})),a.__updateCutaway=a.__updateCutaway.bind(a),a.insertParameter(new Or("CutAwayEnabled",!1),i++).valueChanged.connect(a.__updateCutaway),a.insertParameter(new Ar("CutVector",new Dn(1,0,0)),i++).valueChanged.connect(a.__updateCutaway),a.insertParameter(new Br("CutDist",0),i++).valueChanged.connect(a.__updateCutaway),a.__globalXfoParam.valueChanged.connect((function(t){a.calculatingGroupXfo||a._propagateDirtyXfoToItems()}));return a}Object.defineProperty(e,"INITIAL_XFO_MODES",{get:function(){return Kl},enumerable:true,configurable:true});e.prototype.__updateVisiblity=function(){if(t.prototype.__updateVisiblity.call(this)){var e=this.getVisible();return Array.from(this.__itemsParam.getValue()).forEach((function(t){t instanceof Tl&&t.propagateVisiblity(e?1:-1)})),!0}return!1};e.prototype.__updateHighlight=function(){var t,e=!1;(this.getParameter("Highlighted").getValue()||this.isSelected())&&(e=!0,t=this.getParameter("HighlightColor").getValue(),t.a=this.getParameter("HighlightFill").getValue());var a="groupItemHighlight"+this.getId();Array.from(this.__itemsParam.getValue()).forEach((function(i){i instanceof Tl&&(e?i.addHighlight(a,t,!0):i.removeHighlight(a,!0))}))};e.prototype.setSelected=function(e){t.prototype.setSelected.call(this,e),this.__updateHighlight()};e.prototype._setGlobalXfoDirty=function(){t.prototype._setGlobalXfoDirty.call(this)};e.prototype.calcGroupXfo=function(){var t=this;var e=Array.from(this.__itemsParam.getValue());if(0==e.length)return new ar;this.calculatingGroupXfo=!0;var a=this.__initialXfoModeParam.getValue();var i;if(a==Kl.manual)return this.invGroupXfo=this.getGlobalXfo().inverse(),void(this.calculatingGroupXfo=!1);if(a==Kl.first)i=this.__initialXfos[0];else if(a==Kl.average){i=new ar,i.ori.set(0,0,0,0);var n=0;e.forEach((function(e,a){e instanceof Tl&&(i.tr.addInPlace(t.__initialXfos[a].tr),i.ori.addInPlace(t.__initialXfos[a].ori),n++)})),i.tr.scaleInPlace(1/n),i.ori.normalizeInPlace()}else{if(a!=Kl.globalOri)throw new Error("Invalid mode.");{i=new ar;var r=0;e.forEach((function(e,a){e instanceof Tl&&(i.tr.addInPlace(t.__initialXfos[a].tr),r++)})),i.tr.scaleInPlace(1/r)}}this.setGlobalXfo(i,gr.GENERATED_VALUE);var o=this.getGlobalXfo();this.invGroupXfo=o.inverse(),this.calculatingGroupXfo=!1};e.prototype._propagateDirtyXfoToItems=function(){var t=this;if(this.calculatingGroupXfo)return;var e=Array.from(this.__itemsParam.getValue());if(!this.calculatingGroupXfo&&e.length>0&&this.invGroupXfo&&!this.dirty){var a;this.dirty=!0,this.propagatingXfoToItems=!0;var i=function(e,i){var n=e.getParameter("GlobalXfo");n.setDirty((function(){if(!a){var e=t.__globalXfoParam.getValue();a=e.multiply(t.invGroupXfo),t.dirty=!1}var r=a.multiply(i);n.setClean(r)}))};e.forEach((function(e,a){e instanceof Tl&&i(e,t.__initialXfos[a])})),this.propagatingXfoToItems=!1}};e.prototype.__updateMaterial=function(){var t=this.getParameter("Material").getValue();Array.from(this.__itemsParam.getValue()).forEach((function(e){e.traverse((function(e){if(e instanceof Tl&&e.hasParameter("Material")){var a=e.getParameter("Material");if(t){var i=a.getValue();i!=t&&(a.__backupMaterial=i,a.setValue(t,gr.GENERATED_VALUE))}else a.__backupMaterial&&a.setValue(a.__backupMaterial,gr.GENERATED_VALUE)}}),!1)}))};e.prototype.__updateCutaway=function(){var t=this.getParameter("CutAwayEnabled").getValue(),e=this.getParameter("CutVector").getValue(),a=this.getParameter("CutDist").getValue();Array.from(this.__itemsParam.getValue()).forEach((function(i){i.traverse((function(i){i instanceof Nl&&(i.setCutawayEnabled(t),i.setCutVector(e),i.setCutDist(a))}),!0)}))};e.prototype.setPaths=function(t){var e=this;this.clearItems(!1);var a=this.getOwner();if(null==a)return void console.warn("Group does not have an owner and so cannot resolve paths:",this.getName());var i=[];t.forEach((function(t){var n=a.resolvePath(t);n?i.push(n):console.warn("Path does not resolve to an Item:",t," group:",e.getName())})),this.setItems(i)};e.prototype.resolveItems=function(t){this.setPaths(t)};e.prototype.__bindItem=function(t,e){var a=this;if(!(t instanceof Tl))return;var i={};i.mouseDownIndex=t.mouseDown.connect((function(t){a.onMouseDown(t)})),i.mouseUpIndex=t.mouseUp.connect((function(t){a.onMouseUp(t)})),i.mouseMoveIndex=t.mouseMove.connect((function(t){a.onMouseMove(t)})),i.mouseEnterIndex=t.mouseEnter.connect((function(t){a.onMouseEnter(t)})),i.mouseLeaveIndex=t.mouseLeave.connect((function(t){a.onMouseLeave(t)}));var n=this.getParameter("Material").getValue();if(n&&t.traverse((function(t){if(t instanceof Tl&&t.hasParameter("Material")){var e=t.getParameter("Material");if(n){var a=e.getValue();a!=n&&(e.__backupMaterial=a,e.setValue(n,gr.GENERATED_VALUE))}}}),!0),t instanceof Tl&&this.getParameter("Highlighted").getValue()){var r=this.getParameter("HighlightColor").getValue();r.a=this.getParameter("HighlightFill").getValue(),t.addHighlight("groupItemHighlight"+this.getId(),r,!0)}var o=this.getParameter("CutAwayEnabled").getValue();if(o){var l=this.getParameter("CutVector").getValue(),s=this.getParameter("CutDist").getValue();t.traverse((function(t){t instanceof Nl&&(t.setCutawayEnabled(o),t.setCutVector(l),t.setCutDist(s))}),!0)}this.getVisible()||t.propagateVisiblity(-1);var d=function(){var t=a.__initialXfoModeParam.getValue();t==Kl.first&&0==e?a.calcGroupXfo():t!=Kl.average&&t!=Kl.globalOri||a.calcGroupXfo()};i.globalXfoChangedIndex=t.globalXfoChanged.connect((function(i){a.propagatingXfoToItems||(a.__initialXfos[e]=t.getGlobalXfo(),d())})),this.__initialXfos[e]=t.getGlobalXfo(),i.bboxChangedIndex=t.boundingChanged.connect(this._setBoundingBoxDirty),this.__signalIndices[e]=i,d()};e.prototype.__unbindItem=function(t,e){if(!(t instanceof Tl))return;t.removeHighlight("branchselected"+this.getId(),!0),this.getParameter("Highlighted").getValue()&&t.removeHighlight("groupItemHighlight"+this.getId(),!0),this.getVisible()||t.propagateVisiblity(1),t.traverse((function(t){t instanceof Nl&&t.setCutawayEnabled(!1)}),!0);var a=this.__signalIndices[e];t.mouseDown.disconnectId(a.mouseDownIndex),t.mouseUp.disconnectId(a.mouseUpIndex),t.mouseMove.disconnectId(a.mouseMoveIndex),t.mouseEnter.disconnectId(a.mouseEnterIndex),t.mouseLeave.disconnectId(a.mouseLeaveIndex),t.globalXfoChanged.disconnectId(a.globalXfoChangedIndex),t.boundingChanged.disconnectId(a.bboxChangedIndex),this.__signalIndices.splice(e,1),this.__initialXfos.splice(e,1)};e.prototype.addItem=function(t,e){if(e===void 0){e=!0}t?this.__itemsParam.addItem(t,e):console.warn("Error adding item to group. Item is null")};e.prototype.removeItem=function(t,e){if(e===void 0){e=!0}this.__itemsParam.removeItem(t,e)};e.prototype.clearItems=function(t){if(t===void 0){t=!0}var e=Array.from(this.__itemsParam.getValue());for(var a=e.length-1;a>=0;a--)this.__unbindItem(e[a],a);this.__signalIndices=[],this.__initialXfos=[],this.__itemsParam.clearItems(t)};e.prototype.getItems=function(){return this.__itemsParam.getValue()};e.prototype.setItems=function(t){this.clearItems(!1),this.__itemsParam.setItems(t)};e.prototype._cleanBoundingBox=function(e){var a=t.prototype._cleanBoundingBox.call(this,e);return Array.from(this.__itemsParam.getValue()).forEach((function(t){t instanceof Tl&&t.getVisible()&&!t.testFlag(xr.IGNORE_BBOX)&&a.addBox3(t.getBoundingBox())})),a};e.prototype.onMouseDown=function(e){t.prototype.onMouseDown.call(this,e)};e.prototype.onMouseUp=function(e){t.prototype.onMouseUp.call(this,e)};e.prototype.onMouseMove=function(e){t.prototype.onMouseMove.call(this,e)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a),n=Array.from(this.__itemsParam.getValue()),r=[];return n.forEach((function(t){var a=t.getPath();r.push(e?e.makeRelative(a):a)})),i.treeItems=r,i};e.prototype.fromJSON=function(e,a,i){var n=this;if(t.prototype.fromJSON.call(this,e,a,i),this.setFlag(xr.USER_EDITED),!e.treeItems)return void console.warn("Invalid Parameter JSON");var r=e.treeItems.length;var o=function(t){a.resolvePath(t,(function(t){n.addItem(t),r--,0==r&&(n.calculatingGroupXfo=!0,n.calcGroupXfo(),n.calculatingGroupXfo=!1)}),(function(e){console.warn("Group: '"+n.getName()+"'. Unable to load item:"+t)}))};for(var l=0,s=e.treeItems;l<s.length;l++){var d=s[l];o(d)}};e.prototype.clone=function(t){var a=new e;return a.copyFrom(this,t),a};e.prototype.copyFrom=function(e,a){t.prototype.copyFrom.call(this,e,a)};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(Tl);br.registerClass("Group",wl);var zl=wr("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwpjb25zdCB0PU1hdGguUEkvMTgwO01hdGguSEFMRl9QST0uNSpNYXRoLlBJLE1hdGguVFdPX1BJPTIqTWF0aC5QSTtNYXRoLnJhZFRvRGVnPWZ1bmN0aW9uKGUpe3JldHVybiBlL3R9LE1hdGguZGVnVG9SYWQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUqdH0sTnVtYmVyLmlzTnVtZXJpYz10PT4haXNOYU4ocGFyc2VGbG9hdCh0KSkmJmlzRmluaXRlKHQpLFN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbD1mdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnJlcGxhY2UobmV3IFJlZ0V4cCh0LCJnIiksZSl9O2Z1bmN0aW9uIGUodCxlPTAscz01KXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkodCwoZnVuY3Rpb24odCxlKXtyZXR1cm4gZSYmZS50b0ZpeGVkP051bWJlcihlLnRvRml4ZWQocykpOmV9KSxlKX1TdHJpbmcucHJvdG90eXBlLmhhc2g9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24odCl7bGV0IGUscyxhLGk9MDtpZigwPT09dC5sZW5ndGgpcmV0dXJuIGk7Zm9yKGU9MCxhPXQubGVuZ3RoO2U8YTtlKyspcz10LmNoYXJDb2RlQXQoZSksaT0oaTw8NSktaStzLGl8PTA7cmV0dXJuIE1hdGguYWJzKGkpfSh0aGlzKX0sU3RyaW5nLnByb3RvdHlwZS50cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzK3xccyskL2csIiIpfSxTdHJpbmcucHJvdG90eXBlLmx0cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzKy8sIiIpfSxTdHJpbmcucHJvdG90eXBlLnJ0cmltPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXHMrJC8sIiIpfSxTdHJpbmcucHJvdG90eXBlLmxwYWQ9ZnVuY3Rpb24odCxlKXtsZXQgcz10aGlzO2Zvcig7cy5sZW5ndGg8ZTspcz10K3M7cmV0dXJuIHN9LFN0cmluZy5wcm90b3R5cGUucnBhZD1mdW5jdGlvbih0LGUpe2xldCBzPXRoaXM7Zm9yKDtzLmxlbmd0aDxlOylzKz10O3JldHVybiBzfSxNYXRoLnJhbmRvbUludD1mdW5jdGlvbih0LGUpe3JldHVybiB0PU1hdGguY2VpbCh0KSxlPU1hdGguZmxvb3IoZSksTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihlLXQpKSt0fSxNYXRoLmxlcnA9KHQsZSxzKT0+dCtzKihlLXQpLE1hdGguY2xhbXA9ZnVuY3Rpb24odCxlLHMpe3JldHVybiBNYXRoLm1pbihNYXRoLm1heCh0LGUpLHMpfSxNYXRoLm5lYXJlc3RQb3cyPWZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdygyLE1hdGgucm91bmQoTWF0aC5sb2codCkvTWF0aC5sb2coMikpKX0sTWF0aC5uZWFyZXN0UG93MTA9ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGgucG93KDEwLE1hdGgucm91bmQoTWF0aC5sb2cxMCh0KS9NYXRoLmxvZzEwKDEwKSkpfSxNYXRoLm5leHRQb3cyPWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKDt0PjA7KWUrKyx0Pj49MTtyZXR1cm4gMTw8ZX0sTWF0aC5mcmFjdD1mdW5jdGlvbih0KXtyZXR1cm4gMD09dD8wOnQ8MD90Pi0xPy10Oi10JU1hdGguZmxvb3IoLXQpOnQ8MT90OnQlTWF0aC5mbG9vcih0KX0sTWF0aC5yZW1hcD1mdW5jdGlvbih0LGUscyxhLGkpe3JldHVybiBhKyh0LWUpLyhzLWUpKihpLWEpfSxNYXRoLmNvbnZlcnRGbG9hdDMyQXJyYXlUb1VJbnQxNkFycmF5PWZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IFVpbnQxNkFycmF5KHQubGVuZ3RoKSxzPW5ldyBJbnQzMkFycmF5KHQuYnVmZmVyKSxhPXQ9PntsZXQgZT10Pj4xNiYzMjc2OCxzPXQ+PjEyJjIwNDc7Y29uc3QgYT10Pj4yMyYyNTU7cmV0dXJuIGE8MTAzP2U6YT4xNDI/KGV8PTMxNzQ0LGV8PSgyNTU9PWE/MDoxKSYmODM4ODYwNyZ0LGUpOmE8MTEzPyhzfD0yMDQ4LGV8PShzPj4xMTQtYSkrKHM+PjExMy1hJjEpLGUpOihlfD1hLTExMjw8MTB8cz4+MSxlKz0xJnMsZSl9O2ZvcihsZXQgaT0wO2k8dC5sZW5ndGg7aSsrKWVbaV09YShzW2ldKTtyZXR1cm4gZX0sTWF0aC5kZWNvZGUxNkJpdEZsb2F0RnJvbTJ4VUludDg9dD0+e2NvbnN0IGU9dFswXSxzPSgxMjAmZSk+PjM7bGV0IGE9MD09cz8wOjIwNDg7Y29uc3QgaT1hKygoNyZlKTw8OCkrdFsxXTtyZXR1cm4gYT0wPT1zPzE6MCwoMTI4JmU/MTotMSkqaSpNYXRoLnBvdygyLHMrYS0xNil9LE1hdGguZW5jb2RlMTZCaXRGbG9hdEludG8yeFVJbnQ4PXQ9PntjfHwoYz1uZXcgVWludDhBcnJheSgyKSk7Y29uc3QgZT10Pj0wPzEyODowO3Q9TWF0aC5hYnModCk7bGV0IHMsYT0xNSxpPTEwMjQ7Zm9yKGxldCBlPTE1O2U+MDtlLS0pdDxpJiYoaS89MixhLS0pO3M9MD09YT90L2kvMjoodC1pKS9pO2NvbnN0IHI9TWF0aC5yb3VuZCgyMDQ4KnMpLG49ci8yNTYsaD1yLTI1NipuO3JldHVybiBjWzBdPWUrOCphK24sY1sxXT1oLHQ+PTIwNDgmJihjWzBdPTI1NSksY30sTWF0aC5lbmNvZGUxNkJpdEZsb2F0PXQ9Pntjb25zdCBlPW5ldyBGbG9hdDMyQXJyYXkoMSk7ZVswXT10O3JldHVybih0PT57bGV0IGU9dD4+MTYmMzI3Njgscz10Pj4xMiYyMDQ3O2NvbnN0IGE9dD4+MjMmMjU1O3JldHVybiBhPDEwMz9lOmE+MTQyPyhlfD0zMTc0NCxlfD0oMjU1PT1hPzA6MSkmJjgzODg2MDcmdCxlKTphPDExMz8oc3w9MjA0OCxlfD0ocz4+MTE0LWEpKyhzPj4xMTMtYSYxKSxlKTooZXw9YS0xMTI8PDEwfHM+PjEsZSs9MSZzLGUpfSkobmV3IEludDMyQXJyYXkoZS5idWZmZXIpWzBdKX0sTWF0aC5kZWNvZGUxNkJpdEZsb2F0PXQ9Pntjb25zdCBlPSgzMjc2OCZ0KT4+MTUscz0oMzE3NDQmdCk+PjEwLGE9MTAyMyZ0O3JldHVybiAwPT1zPyhlPy0xOjEpKk1hdGgucG93KDIsLTE0KSooYS9NYXRoLnBvdygyLDEwKSk6MzE9PXM/YT9OYU46MS8wKihlPy0xOjEpOihlPy0xOjEpKk1hdGgucG93KDIscy0xNSkqKDErYS9NYXRoLnBvdygyLDEwKSl9LE1hdGguc21vb3RoU3RlcD0odCxlLHMpPT57Y29uc3QgYT1NYXRoLmNsYW1wKChzLXQpLyhlLXQpLDAsMSk7cmV0dXJuIGEqYSooMy0yKmEpfSxNYXRoLmxpblN0ZXA9KHQsZSxzKT0+TWF0aC5jbGFtcCgocy10KS8oZS10KSwwLDEpO2NsYXNzIHN7aXNWYWxpZCgpe2Zvcihjb25zdCB0IG9mIHRoaXMuX19kYXRhKWlmKHQ9PTEvMHx8aXNOYU4odCkpcmV0dXJuITE7cmV0dXJuITB9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZSl7dGhyb3cgbmV3IEVycm9yKCJOb3QgeWV0IGltcGxlbWVudGVkIGZvciB0aGlzIHR5cGU6Iit0aGlzLmNvbnN0cnVjdG9yLm5hbWUpfXN0YXRpYyBudW1FbGVtZW50cygpe3Rocm93IG5ldyBFcnJvcigiTm90IHlldCBpbXBsZW1lbnRlZCBmb3IgdGhpcyB0eXBlOiIrdGhpcy5jb25zdHJ1Y3Rvci5uYW1lKX1hc0FycmF5KCl7cmV0dXJuIHRoaXMuX19kYXRhfXRvU3RyaW5nKCl7cmV0dXJuIGUodGhpcy50b0pTT04oKSl9fWNvbnN0IGE9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5fX3R5cGVzPXt9LHRoaXMuX19uYW1lcz17fSx0aGlzLnJlZ2lzdGVyVHlwZSgiU0ludDMyIiw1KSx0aGlzLnJlZ2lzdGVyVHlwZSgiVUludDMyIiw0KSx0aGlzLnJlZ2lzdGVyVHlwZSgiRmxvYXQzMiIsNil9cmVnaXN0ZXJUeXBlKHQsZSl7dGhpcy5fX3R5cGVzW3RdPWUsZS5uYW1lP3RoaXMuX19uYW1lc1tlLm5hbWVdPXQ6dGhpcy5fX25hbWVzW2VdPXR9Z2V0VHlwZSh0KXtyZXR1cm4gdGhpcy5fX3R5cGVzW3RdfWdldFR5cGVOYW1lKHQpe2lmKHRoaXMuX19uYW1lc1t0XSlyZXR1cm4gdGhpcy5fX25hbWVzW3RdO2lmKHRoaXMuX19uYW1lc1t0Lm5hbWVdKXJldHVybiB0aGlzLl9fbmFtZXNbdC5uYW1lXTt0aHJvdyB0fX07Y2xhc3MgaSBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgVWludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsMil9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMiksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMiksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lKX1nZXQgeCgpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgeCh0KXt0aGlzLl9fZGF0YVswXT10fWdldCB5KCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCB5KHQpe3RoaXMuX19kYXRhWzFdPXR9c2V0KHQsZSl7dGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lfXNldEZyb21PdGhlcih0KXt0aGlzLng9dC54LHRoaXMueT10Lnl9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueX1ub3RFcXVhbHModCl7cmV0dXJuIHRoaXMueCE9dC54JiZ0aGlzLnkhPXQueX1hcHByb3hFcXVhbCh0LGU9TnVtYmVyLkVQU0lMT04pe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KTxlJiZNYXRoLmFicyh0aGlzLnktdC55KTxlfWFkZCh0KXtyZXR1cm4gbmV3IGkodGhpcy54K3QueCx0aGlzLnkrdC55KX1hZGRJblBsYWNlKHQpe3RoaXMueCs9dC54LHRoaXMueSs9dC55fXN1YnRyYWN0KHQpe3JldHVybiBuZXcgaSh0aGlzLngtdC54LHRoaXMueS10LnkpfXN1YnRyYWN0SW5QbGFjZSh0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpc31zY2FsZSh0KXtyZXR1cm4gbmV3IGkodGhpcy54KnQsdGhpcy55KnQpfXNjYWxlSW5QbGFjZSh0KXt0aGlzLngqPXQsdGhpcy55Kj10fWludmVydCgpe3JldHVybiBuZXcgaSgxL3RoaXMueCwxL3RoaXMueSl9aW52ZXJ0SW5QbGFjZSgpe3JldHVybiB0aGlzLng9MS90aGlzLngsdGhpcy55PTEvdGhpcy55LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIG5ldyBpKHRoaXMueCp0LngsdGhpcy55KnQueSl9bXVsdGlwbHlJblBsYWNlKHQpe3RoaXMueCo9dC54LHRoaXMueSo9dC55fWxlbmd0aFNxdWFyZWQoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV07cmV0dXJuIHQqdCtlKmV9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLmxlbmd0aFNxdWFyZWQoKSl9ZGlzdGFuY2VUbyh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdLXQueCxzPXRoaXMuX19kYXRhWzFdLXQueTtyZXR1cm4gTWF0aC5zcXJ0KGUqZStzKnMpfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXTtsZXQgcz10KnQrZSplO3JldHVybiBzPE51bWJlci5FUFNJTE9OP25ldyBpOihzPTEvTWF0aC5zcXJ0KHMpLG5ldyBpKHQqcyxlKnMpKX1ub3JtYWxpemVJblBsYWNlKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdO2xldCBzPXQqdCtlKmU7czxOdW1iZXIuRVBTSUxPTnx8KHM9MS9NYXRoLnNxcnQocyksdGhpcy5zZXQodCpzLGUqcykpfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55fWNyb3NzKHQpe3JldHVybiB0aGlzLngqdC55LXRoaXMueSp0Lnh9YW5nbGVUbyh0KXtjb25zdCBlPXRoaXMubm9ybWFsaXplKCkuZG90KHQubm9ybWFsaXplKCkpO3JldHVybiBlPjE/MDplPC0xP01hdGguUEk6TWF0aC5hY29zKGUpfXNpZ25lZEFuZ2xlVG8odCl7Y29uc3QgZT10aGlzLmFuZ2xlVG8odCk7cmV0dXJuIHRoaXMuY3Jvc3ModCk8MD8tZTplfXJvdGF0ZSh0KXtjb25zdCBlPU1hdGguY29zKHQpLHM9TWF0aC5zaW4odCk7cmV0dXJuIG5ldyBpKHRoaXMueCplLXRoaXMueSpzLHRoaXMueCpzK3RoaXMueSplKX1sZXJwKHQsZSl7Y29uc3Qgcz10aGlzLngsYT10aGlzLnk7cmV0dXJuIG5ldyBpKHMrZSoodC54LXMpLGErZSoodC55LWEpKX1zZXRSYW5kb21EaXIodD0xKXtjb25zdCBlPTIqTWF0aC5yYW5kb20oKSpNYXRoLlBJO3JldHVybiB0aGlzLl9fZGF0YVswXT1NYXRoLmNvcyhlKSp6U2NhbGUsdGhpcy5fX2RhdGFbMV09TWF0aC5zaW4oZSkqelNjYWxlLHRoaXN9c2V0UmFuZG9tKHQ9MSl7cmV0dXJuIHRoaXMuX19kYXRhWzBdPU1hdGgucmFuZG9tKCkqdCx0aGlzLl9fZGF0YVsxXT1NYXRoLnJhbmRvbSgpKnQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgaSh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgaSguLi50KX1zdGF0aWMgY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodCxlPTApe3JldHVybiBuZXcgaSh0LDQqZSl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQXJyYXkodCl7cmV0dXJuIG5ldyBpKHQpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiAyfXRvSlNPTigpe3JldHVybnt4OnRoaXMueCx5OnRoaXMueX19ZnJvbUpTT04odCl7dGhpcy54PXQueCx0aGlzLnk9dC55fX1hLnJlZ2lzdGVyVHlwZSgiVmVjMiIsaSk7Y2xhc3MgciBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCxzPTApe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsMyl9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMyksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMyksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXMpfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCB4eSgpe3JldHVybiBuZXcgaSh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSl9Z2V0IHl6KCl7cmV0dXJuIG5ldyBpKHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdKX1zZXQodCxlLHMpe3RoaXMueD10LHRoaXMueT12b2lkIDAhPT1lP2U6dCx0aGlzLno9dm9pZCAwIT09cz9zOnR9c2V0RGF0YUFycmF5KHQpe3RoaXMuX19kYXRhPXR9c2V0RnJvbU90aGVyKHQpe3RoaXMueD10LngsdGhpcy55PXQueSx0aGlzLno9dC56fWlzTnVsbCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicyh0aGlzLnkpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicyh0aGlzLnopPE51bWJlci5FUFNJTE9OfWlzMTExKCl7cmV0dXJuIE1hdGguYWJzKDEtdGhpcy54KTxOdW1iZXIuRVBTSUxPTiYmTWF0aC5hYnMoMS10aGlzLnkpPE51bWJlci5FUFNJTE9OJiZNYXRoLmFicygxLXRoaXMueik8TnVtYmVyLkVQU0lMT059ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10Lnp9bm90RXF1YWxzKHQpe3JldHVybiB0aGlzLnghPXQueCYmdGhpcy55IT10LnkmJnRoaXMueiE9dC56fWFwcHJveEVxdWFsKHQsZT1OdW1iZXIuRVBTSUxPTil7cmV0dXJuIE1hdGguYWJzKHRoaXMueC10LngpPGUmJk1hdGguYWJzKHRoaXMueS10LnkpPGUmJk1hdGguYWJzKHRoaXMuei10LnopPGV9YWRkKHQpe3JldHVybiBuZXcgcih0aGlzLngrdC54LHRoaXMueSt0LnksdGhpcy56K3Queil9YWRkSW5QbGFjZSh0KXt0aGlzLngrPXQueCx0aGlzLnkrPXQueSx0aGlzLnorPXQuen1zdWJ0cmFjdCh0KXtyZXR1cm4gbmV3IHIodGhpcy54LXQueCx0aGlzLnktdC55LHRoaXMuei10LnopfXN1YnRyYWN0SW5QbGFjZSh0KXt0aGlzLngtPXQueCx0aGlzLnktPXQueSx0aGlzLnotPXQuen1tdWx0aXBseSh0KXtyZXR1cm4gbmV3IHIodGhpcy54KnQueCx0aGlzLnkqdC55LHRoaXMueip0LnopfW11bHRpcGx5SW5QbGFjZSh0KXt0aGlzLngqPXQueCx0aGlzLnkqPXQueSx0aGlzLnoqPXQuen1kaXZpZGUodCl7cmV0dXJuIG5ldyByKHRoaXMueC90LngsdGhpcy55L3QueSx0aGlzLnovdC56KX1kaXZpZGVJblBsYWNlKHQpe3RoaXMueC89dC54LHRoaXMueS89dC55LHRoaXMuei89dC56fXNjYWxlKHQpe3JldHVybiBuZXcgcih0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10fW5lZ2F0ZSgpe3JldHVybiBuZXcgcigtdGhpcy54LC10aGlzLnksLXRoaXMueil9aW52ZXJzZSgpe3JldHVybiBuZXcgcigxL3RoaXMueCwxL3RoaXMueSwxL3RoaXMueil9bGVuZ3RoU3F1YXJlZCgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdO3JldHVybiB0KnQrZSplK3Mqc31sZW5ndGgoKXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3F1YXJlZCgpKX1kaXN0YW5jZVRvKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0tdC54LHM9dGhpcy5fX2RhdGFbMV0tdC55LGE9dGhpcy5fX2RhdGFbMl0tdC56O3JldHVybiBNYXRoLnNxcnQoZSplK3MqcythKmEpfW5vcm1hbGl6ZSgpe2xldCB0PXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO3JldHVybiB0PE51bWJlci5FUFNJTE9OP25ldyByOih0PTEvTWF0aC5zcXJ0KHQpLG5ldyByKHRoaXMuX19kYXRhWzBdKnQsdGhpcy5fX2RhdGFbMV0qdCx0aGlzLl9fZGF0YVsyXSp0KSl9bm9ybWFsaXplSW5QbGFjZSgpe2xldCB0PXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO2lmKHQ8TnVtYmVyLkVQU0lMT04pcmV0dXJuO3Q9TWF0aC5zcXJ0KHQpO2NvbnN0IGU9MS90O3JldHVybiB0aGlzLl9fZGF0YVswXSo9ZSx0aGlzLl9fZGF0YVsxXSo9ZSx0aGlzLl9fZGF0YVsyXSo9ZSx0fXJlc2l6ZSh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdKnRoaXMuX19kYXRhWzBdK3RoaXMuX19kYXRhWzFdKnRoaXMuX19kYXRhWzFdK3RoaXMuX19kYXRhWzJdKnRoaXMuX19kYXRhWzJdO2lmKGU8TnVtYmVyLkVQU0lMT04pcmV0dXJuO2NvbnN0IHM9dC9NYXRoLnNxcnQoZSk7cmV0dXJuIG5ldyByKHRoaXMuX19kYXRhWzBdKnMsdGhpcy5fX2RhdGFbMV0qcyx0aGlzLl9fZGF0YVsyXSpzKX1yZXNpemVJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0qdGhpcy5fX2RhdGFbMF0rdGhpcy5fX2RhdGFbMV0qdGhpcy5fX2RhdGFbMV0rdGhpcy5fX2RhdGFbMl0qdGhpcy5fX2RhdGFbMl07aWYoZTxOdW1iZXIuRVBTSUxPTilyZXR1cm47Y29uc3Qgcz10L01hdGguc3FydChlKTt0aGlzLl9fZGF0YVswXSo9cyx0aGlzLl9fZGF0YVsxXSo9cyx0aGlzLl9fZGF0YVsyXSo9c31kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56fWNyb3NzKHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dC54LG49dC55LGg9dC56O3JldHVybiBuZXcgcihzKmgtYSpuLGEqaS1lKmgsZSpuLXMqaSl9YW5nbGVUbyh0KXtjb25zdCBlPXRoaXMuZG90KHQpO3JldHVybiBlPjE/MDpNYXRoLmFjb3MoZSl9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy54LGE9dGhpcy55LGk9dGhpcy56O3JldHVybiBuZXcgcihzK2UqKHQueC1zKSxhK2UqKHQueS1hKSxpK2UqKHQuei1pKSl9YWJzKCl7cmV0dXJuIG5ldyByKE1hdGguYWJzKHRoaXMueCksTWF0aC5hYnModGhpcy55KSxNYXRoLmFicyh0aGlzLnopKX1zZXRSYW5kb21EaXIodD0xKXtjb25zdCBlPTIqTWF0aC5yYW5kb20oKSpNYXRoLlBJLHM9MipNYXRoLnJhbmRvbSgpLTEsYT1NYXRoLnNxcnQoMS1zKnMpKnQ7cmV0dXJuIHRoaXMuX19kYXRhWzBdPU1hdGguY29zKGUpKmEsdGhpcy5fX2RhdGFbMV09TWF0aC5zaW4oZSkqYSx0aGlzLl9fZGF0YVsyXT1zKnQsdGhpc31zZXRSYW5kb20odD0xKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpcy5fX2RhdGFbMV09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpcy5fX2RhdGFbMl09KE1hdGgucmFuZG9tKCktLjUpKnQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgcih0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgciguLi50KX1zdGF0aWMgY3JlYXRlRnJvbUpTT04odCl7Y29uc3QgZT1uZXcgcjtyZXR1cm4gZS5mcm9tSlNPTih0KSxlfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyByKHQsNCplKX1zdGF0aWMgY3JlYXRlRnJvbUZsb2F0MzJBcnJheSh0KXtyZXR1cm4gbmV3IHIodCl9c3RhdGljIG51bUVsZW1lbnRzKCl7cmV0dXJuIDN9dG9KU09OKCl7cmV0dXJue3g6dGhpcy54LHk6dGhpcy55LHo6dGhpcy56fX1mcm9tSlNPTih0KXt0aGlzLng9dC54LHRoaXMueT10LnksdGhpcy56PXQuen19YS5yZWdpc3RlclR5cGUoIlZlYzMiLHIpO2NsYXNzIG4gZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MCl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSBudWxsIT10JiYib2JqZWN0Ij09dHlwZW9mIHQ/KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoNCksdGhpcy5mcm9tSlNPTih0KSk6KHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoNCksdGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXMsdGhpcy5fX2RhdGFbM109YSl9Z2V0IHgoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF19c2V0IHgodCl7dGhpcy5fX2RhdGFbMF09dH1nZXQgeSgpe3JldHVybiB0aGlzLl9fZGF0YVsxXX1zZXQgeSh0KXt0aGlzLl9fZGF0YVsxXT10fWdldCB6KCl7cmV0dXJuIHRoaXMuX19kYXRhWzJdfXNldCB6KHQpe3RoaXMuX19kYXRhWzJdPXR9Z2V0IHQoKXtyZXR1cm4gdGhpcy5fX2RhdGFbM119c2V0IHQodCl7dGhpcy5fX2RhdGFbM109dH1nZXQgeHl6KCl7cmV0dXJuIG5ldyByKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdKX1zZXQodCxlLHMsYSl7dGhpcy54PXQsdGhpcy55PWUsdGhpcy56PXMsdGhpcy50PWF9c2V0RnJvbU90aGVyKHQpe3RoaXMueD10LngsdGhpcy55PXQueSx0aGlzLno9dC56LHRoaXMudD10LnR9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10LnomJnRoaXMudD09dC50fW5vdEVxdWFscyh0KXtyZXR1cm4gdGhpcy54IT10LngmJnRoaXMueSE9dC55JiZ0aGlzLnohPXQueiYmdGhpcy50IT10LnR9YXBwcm94RXF1YWwodCxlPU51bWJlci5FUFNJTE9OKXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCk8ZSYmTWF0aC5hYnModGhpcy55LXQueSk8ZSYmTWF0aC5hYnModGhpcy56LXQueik8ZSYmTWF0aC5hYnModGhpcy50LXQudCk8ZX1hZGQodCl7cmV0dXJuIG5ldyBuKHRoaXMueCt0LngsdGhpcy55K3QueSx0aGlzLnordC56LHRoaXMudCt0LnQpfWFkZEluUGxhY2UodCl7dGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy50Kz10LnR9c3VidHJhY3QodCl7cmV0dXJuIG5ldyBuKHRoaXMueC10LngsdGhpcy55LXQueSx0aGlzLnotdC56LHRoaXMudC10LnQpfXN1YnRyYWN0SW5QbGFjZSh0KXt0aGlzLngtPXQueCx0aGlzLnktPXQueSx0aGlzLnotPXQueix0aGlzLnQtPXQudH1tdWx0aXBseSh0KXtyZXR1cm4gbmV3IG4odGhpcy54KnQueCx0aGlzLnkqdC55LHRoaXMueip0LnosdGhpcy50KnQudCl9bXVsdGlwbHlJblBsYWNlKHQpe3RoaXMueCo9dC54LHRoaXMueSo9dC55LHRoaXMueio9dC56LHRoaXMudCo9dC50fWRpdmlkZSh0KXtyZXR1cm4gbmV3IG4odGhpcy54L3QueCx0aGlzLnkvdC55LHRoaXMuei90LnosdGhpcy50L3QudCl9ZGl2aWRlSW5QbGFjZSh0KXt0aGlzLngvPXQueCx0aGlzLnkvPXQueSx0aGlzLnovPXQueix0aGlzLnQvPXQudH1zY2FsZSh0KXtyZXR1cm4gbmV3IG4odGhpcy54KnQsdGhpcy55KnQsdGhpcy56KnQsdGhpcy50KnQpfXNjYWxlSW5QbGFjZSh0KXt0aGlzLnNldCh0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCx0aGlzLnQqdCl9bGVuZ3RoKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVsyXTtyZXR1cm4gTWF0aC5zcXJ0KHQqdCtlKmUrcypzK2EqYSl9bGVuZ3RoU3F1YXJlZCgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107cmV0dXJuIHQqdCtlKmUrcypzK2EqYX1ub3JtYWxpemUoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO2xldCBpPXQqdCtlKmUrcypzK2EqYTtyZXR1cm4gaTxOdW1iZXIuRVBTSUxPTj9uZXcgbjooaT0xL01hdGguc3FydChpKSxuZXcgbih0KmksZSppLHMqaSkpfW5vcm1hbGl6ZUluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO2xldCBpPXQqdCtlKmUrcypzK2EqYTtpPE51bWJlci5FUFNJTE9OfHwoaT0xL01hdGguc3FydChpKSx0aGlzLnNldCh0KmksZSppLHMqaSxhKmkpKX1kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56K3RoaXMudCpiLnR9Y3Jvc3ModCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksYT10aGlzLnosaT10aGlzLnQscj10LngsaD10Lnksbz10LnosXz10LnQ7cmV0dXJuIG5ldyBuKHMqby1hKmgsYSpfLWkqbyxpKnItZSpfLGUqaC1zKnIpfWFuZ2xlVG8odCl7Y29uc3QgZT10aGlzLm5vcm1hbGl6ZSgpLHM9dC5ub3JtYWxpemUoKSxhPWUuZG90KHMpO3JldHVybiBhPjE/MDpNYXRoLmFjb3MoYSl9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy54LGE9dGhpcy55LGk9dGhpcy56O3JldHVybiBhdD10aGlzLnQsbmV3IG4ocytlKih0LngtcyksYStlKih0LnktYSksaStlKih0LnotaSksYXQrZSoodC50LWF0KSl9cmFuZG9tKHQ9MSl7Y29uc3QgZT0yKmdsTWF0cml4LlJBTkRPTSgpKk1hdGguUEkscz0yKmdsTWF0cml4LlJBTkRPTSgpLTEsYT1NYXRoLnNxcnQoMS1zKnMpKnQ7cmV0dXJuIG91dFswXT1NYXRoLmNvcyhlKSphLG91dFsxXT1NYXRoLnNpbihlKSphLG91dFsyXT1zKnQsb3V0fWNsb25lKCl7cmV0dXJuIG5ldyBuKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdKX10b1ZlYzMoKXtyZXR1cm4gbmV3IHIodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0pfWFzQXJyYXkoKXtyZXR1cm4gdGhpcy5fX2RhdGF9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IHIoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IG4odCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fXRvSlNPTigpe3JldHVybnt4OnRoaXMueCx5OnRoaXMueSx6OnRoaXMueix0OnRoaXMudH19fWEucmVnaXN0ZXJUeXBlKCJWZWM0IixuKTtjbGFzcyBoIGV4dGVuZHMgc3tjb25zdHJ1Y3Rvcih0PTAsZT0wLHM9MCxhPTI1NSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl0aGlzLl9fZGF0YT10O2Vsc2UgaWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBVaW50OEFycmF5KHMsYSw0KX1lbHNlIHRoaXMuX19kYXRhPW5ldyBVaW50OEFycmF5KDQpLCJzdHJpbmciPT10eXBlb2YgdD90LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tQ1NTQ29sb3JOYW1lKHQpOih0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hKX1nZXQgcigpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgcih0KXt0aGlzLl9fZGF0YVswXT10fWdldCBnKCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCBnKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IGIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IGIodCl7dGhpcy5fX2RhdGFbMl09dH1nZXQgYSgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgYSh0KXt0aGlzLl9fZGF0YVszXT10fXNldCh0LGUscyxhPTI1NSl7dGhpcy5yPXQsdGhpcy5nPWUsdGhpcy5iPXMsdGhpcy5hPWF9c2V0RnJvbU90aGVyKHQpe3RoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXMuYT10LmF9c2V0RnJvbUFycmF5KHQpe3RoaXMucj10WzBdLHRoaXMuZz10WzFdLHRoaXMuYj10WzJdLHRoaXMuYT00PT10Lmxlbmd0aD90WzNdOjF9c2V0RnJvbUhleCh0KXtjb25zdCBlPWZ1bmN0aW9uKHQpe2NvbnN0IGU9L14jPyhbYS1mXGRdezJ9KShbYS1mXGRdezJ9KShbYS1mXGRdezJ9KSQvaS5leGVjKHQpO3JldHVybiBlP3tyOnBhcnNlSW50KGVbMV0sMTYpLGc6cGFyc2VJbnQoZVsyXSwxNiksYjpwYXJzZUludChlWzNdLDE2KX06bnVsbH0odCk7ZT90aGlzLnNldChlLnIsZS5nLGUuYik6Y29uc29sZS53YXJuKCJJbnZhbGlkIGhleCBjb2RlOiIrdCl9c2V0RnJvbUNTU0NvbG9yTmFtZSh0KXt0LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tSGV4KCh0PT57Y29uc3QgZT17YWxpY2VibHVlOiIjZjBmOGZmIixhbnRpcXVld2hpdGU6IiNmYWViZDciLGFxdWE6IiMwMGZmZmYiLGFxdWFtYXJpbmU6IiM3ZmZmZDQiLGF6dXJlOiIjZjBmZmZmIixiZWlnZToiI2Y1ZjVkYyIsYmlzcXVlOiIjZmZlNGM0IixibGFjazoiIzAwMDAwMCIsYmxhbmNoZWRhbG1vbmQ6IiNmZmViY2QiLGJsdWU6IiMwMDAwZmYiLGJsdWV2aW9sZXQ6IiM4YTJiZTIiLGJyb3duOiIjYTUyYTJhIixidXJseXdvb2Q6IiNkZWI4ODciLGNhZGV0Ymx1ZToiIzVmOWVhMCIsY2hhcnRyZXVzZToiIzdmZmYwMCIsY2hvY29sYXRlOiIjZDI2OTFlIixjb3JhbDoiI2ZmN2Y1MCIsY29ybmZsb3dlcmJsdWU6IiM2NDk1ZWQiLGNvcm5zaWxrOiIjZmZmOGRjIixjcmltc29uOiIjZGMxNDNjIixjeWFuOiIjMDBmZmZmIixkYXJrYmx1ZToiIzAwMDA4YiIsZGFya2N5YW46IiMwMDhiOGIiLGRhcmtnb2xkZW5yb2Q6IiNiODg2MGIiLGRhcmtncmF5OiIjYTlhOWE5IixkYXJrZ3JlZW46IiMwMDY0MDAiLGRhcmtraGFraToiI2JkYjc2YiIsZGFya21hZ2VudGE6IiM4YjAwOGIiLGRhcmtvbGl2ZWdyZWVuOiIjNTU2YjJmIixkYXJrb3JhbmdlOiIjZmY4YzAwIixkYXJrb3JjaGlkOiIjOTkzMmNjIixkYXJrcmVkOiIjOGIwMDAwIixkYXJrc2FsbW9uOiIjZTk5NjdhIixkYXJrc2VhZ3JlZW46IiM4ZmJjOGYiLGRhcmtzbGF0ZWJsdWU6IiM0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IiMyZjRmNGYiLGRhcmt0dXJxdW9pc2U6IiMwMGNlZDEiLGRhcmt2aW9sZXQ6IiM5NDAwZDMiLGRlZXBwaW5rOiIjZmYxNDkzIixkZWVwc2t5Ymx1ZToiIzAwYmZmZiIsZGltZ3JheToiIzY5Njk2OSIsZG9kZ2VyYmx1ZToiIzFlOTBmZiIsZmlyZWJyaWNrOiIjYjIyMjIyIixmbG9yYWx3aGl0ZToiI2ZmZmFmMCIsZm9yZXN0Z3JlZW46IiMyMjhiMjIiLGZ1Y2hzaWE6IiNmZjAwZmYiLGdhaW5zYm9ybzoiI2RjZGNkYyIsZ2hvc3R3aGl0ZToiI2Y4ZjhmZiIsZ29sZDoiI2ZmZDcwMCIsZ29sZGVucm9kOiIjZGFhNTIwIixncmF5OiIjODA4MDgwIixncmVlbjoiIzAwODAwMCIsZ3JlZW55ZWxsb3c6IiNhZGZmMmYiLGhvbmV5ZGV3OiIjZjBmZmYwIixob3RwaW5rOiIjZmY2OWI0IiwiaW5kaWFucmVkICI6IiNjZDVjNWMiLGluZGlnbzoiIzRiMDA4MiIsaXZvcnk6IiNmZmZmZjAiLGtoYWtpOiIjZjBlNjhjIixsYXZlbmRlcjoiI2U2ZTZmYSIsbGF2ZW5kZXJibHVzaDoiI2ZmZjBmNSIsbGF3bmdyZWVuOiIjN2NmYzAwIixsZW1vbmNoaWZmb246IiNmZmZhY2QiLGxpZ2h0Ymx1ZToiI2FkZDhlNiIsbGlnaHRjb3JhbDoiI2YwODA4MCIsbGlnaHRjeWFuOiIjZTBmZmZmIixsaWdodGdvbGRlbnJvZHllbGxvdzoiI2ZhZmFkMiIsbGlnaHRncmV5OiIjZDNkM2QzIixsaWdodGdyZWVuOiIjOTBlZTkwIixsaWdodHBpbms6IiNmZmI2YzEiLGxpZ2h0c2FsbW9uOiIjZmZhMDdhIixsaWdodHNlYWdyZWVuOiIjMjBiMmFhIixsaWdodHNreWJsdWU6IiM4N2NlZmEiLGxpZ2h0c2xhdGVncmF5OiIjNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiI2IwYzRkZSIsbGlnaHR5ZWxsb3c6IiNmZmZmZTAiLGxpbWU6IiMwMGZmMDAiLGxpbWVncmVlbjoiIzMyY2QzMiIsbGluZW46IiNmYWYwZTYiLG1hZ2VudGE6IiNmZjAwZmYiLG1hcm9vbjoiIzgwMDAwMCIsbWVkaXVtYXF1YW1hcmluZToiIzY2Y2RhYSIsbWVkaXVtYmx1ZToiIzAwMDBjZCIsbWVkaXVtb3JjaGlkOiIjYmE1NWQzIixtZWRpdW1wdXJwbGU6IiM5MzcwZDgiLG1lZGl1bXNlYWdyZWVuOiIjM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IiM3YjY4ZWUiLG1lZGl1bXNwcmluZ2dyZWVuOiIjMDBmYTlhIixtZWRpdW10dXJxdW9pc2U6IiM0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiI2M3MTU4NSIsbWlkbmlnaHRibHVlOiIjMTkxOTcwIixtaW50Y3JlYW06IiNmNWZmZmEiLG1pc3R5cm9zZToiI2ZmZTRlMSIsbW9jY2FzaW46IiNmZmU0YjUiLG5hdmFqb3doaXRlOiIjZmZkZWFkIixuYXZ5OiIjMDAwMDgwIixvbGRsYWNlOiIjZmRmNWU2IixvbGl2ZToiIzgwODAwMCIsb2xpdmVkcmFiOiIjNmI4ZTIzIixvcmFuZ2U6IiNmZmE1MDAiLG9yYW5nZXJlZDoiI2ZmNDUwMCIsb3JjaGlkOiIjZGE3MGQ2IixwYWxlZ29sZGVucm9kOiIjZWVlOGFhIixwYWxlZ3JlZW46IiM5OGZiOTgiLHBhbGV0dXJxdW9pc2U6IiNhZmVlZWUiLHBhbGV2aW9sZXRyZWQ6IiNkODcwOTMiLHBhcGF5YXdoaXA6IiNmZmVmZDUiLHBlYWNocHVmZjoiI2ZmZGFiOSIscGVydToiI2NkODUzZiIscGluazoiI2ZmYzBjYiIscGx1bToiI2RkYTBkZCIscG93ZGVyYmx1ZToiI2IwZTBlNiIscHVycGxlOiIjODAwMDgwIixyZWJlY2NhcHVycGxlOiIjNjYzMzk5IixyZWQ6IiNmZjAwMDAiLHJvc3licm93bjoiI2JjOGY4ZiIscm95YWxibHVlOiIjNDE2OWUxIixzYWRkbGVicm93bjoiIzhiNDUxMyIsc2FsbW9uOiIjZmE4MDcyIixzYW5keWJyb3duOiIjZjRhNDYwIixzZWFncmVlbjoiIzJlOGI1NyIsc2Vhc2hlbGw6IiNmZmY1ZWUiLHNpZW5uYToiI2EwNTIyZCIsc2lsdmVyOiIjYzBjMGMwIixza3libHVlOiIjODdjZWViIixzbGF0ZWJsdWU6IiM2YTVhY2QiLHNsYXRlZ3JheToiIzcwODA5MCIsc25vdzoiI2ZmZmFmYSIsc3ByaW5nZ3JlZW46IiMwMGZmN2YiLHN0ZWVsYmx1ZToiIzQ2ODJiNCIsdGFuOiIjZDJiNDhjIix0ZWFsOiIjMDA4MDgwIix0aGlzdGxlOiIjZDhiZmQ4Iix0b21hdG86IiNmZjYzNDciLHR1cnF1b2lzZToiIzQwZTBkMCIsdmlvbGV0OiIjZWU4MmVlIix3aGVhdDoiI2Y1ZGViMyIsd2hpdGU6IiNmZmZmZmYiLHdoaXRlc21va2U6IiNmNWY1ZjUiLHllbGxvdzoiI2ZmZmYwMCIseWVsbG93Z3JlZW46IiM5YWNkMzIifTtyZXR1cm4gdm9pZCAwIT09ZVt0LnRvTG93ZXJDYXNlKCldJiZlW3QudG9Mb3dlckNhc2UoKV19KSh0KSl9dG9IZXgoKXtmdW5jdGlvbiB0KHQpe2NvbnN0IGU9dC50b1N0cmluZygxNik7cmV0dXJuIDE9PWUubGVuZ3RoPyIwIitlOmV9cmV0dXJuIiMiK3QodGhpcy5yKSt0KHRoaXMuZykrdCh0aGlzLmIpfWVxdWFsKHQpe3JldHVybiB0aGlzLnI9PXQuciYmdGhpcy5nPT10LmcmJnRoaXMuYj09dC5iJiZ0aGlzLmE9PXQuYX1ub3RlcXVhbHModCl7cmV0dXJuIHRoaXMuciE9dC5yJiZ0aGlzLmchPXQuZyYmdGhpcy5iIT10LmImJnRoaXMuYSE9dC5hfWFwcHJveEVxdWFsKHQsZT1OdW1iZXIuRVBTSUxPTil7cmV0dXJuIE1hdGguYWJzKHRoaXMuci10LnIpPGUmJk1hdGguYWJzKHRoaXMuZy10LmcpPGUmJk1hdGguYWJzKHRoaXMuYi10LmIpPGUmJk1hdGguYWJzKHRoaXMuYS10LmEpPGV9YWRkKHQpe3JldHVybiBuZXcgaCh0aGlzLnIrdC5yLHRoaXMuZyt0LmcsdGhpcy5iK3QuYix0aGlzLmErdC5hKX1zdWJ0cmFjdCh0KXtyZXR1cm4gbmV3IGgodGhpcy5yLXQucix0aGlzLmctdC5nLHRoaXMuYi10LmIsdGhpcy5hLXQuYSl9c2NhbGUodCl7cmV0dXJuIG5ldyBoKHRoaXMucip0LHRoaXMuZyp0LHRoaXMuYip0LHRoaXMuYSp0KX1zY2FsZUluUGxhY2UodCl7dGhpcy5yKj10LHRoaXMuZyo9dCx0aGlzLmIqPXQsdGhpcy5hKj10fWFwcGx5R2FtbWEodCl7dGhpcy5zZXQoTWF0aC5wb3codGhpcy5yLHQpLE1hdGgucG93KHRoaXMuZyx0KSxNYXRoLnBvdyh0aGlzLmIsdCksdGhpcy5hKX10b0xpbmVhcih0PTIuMil7cmV0dXJuIG5ldyBoKE1hdGgucG93KHRoaXMucix0KSxNYXRoLnBvdyh0aGlzLmcsdCksTWF0aC5wb3codGhpcy5iLHQpLHRoaXMuYSl9dG9HYW1tYSh0PTIuMil7cmV0dXJuIG5ldyBoKE1hdGgucG93KHRoaXMuciwxL3QpLE1hdGgucG93KHRoaXMuZywxL3QpLE1hdGgucG93KHRoaXMuYiwxL3QpLHRoaXMuYSl9bHVtaW5hbmNlKCl7cmV0dXJuLjIxMjYqdGhpcy5yKy43MTUyKnRoaXMuZysuMDcyMip0aGlzLmJ9bGVycCh0LGUpe2NvbnN0IHM9dGhpcy5yLGE9dGhpcy5nLGk9dGhpcy5iLHI9dGhpcy5hO3JldHVybiBuZXcgaChzK2UqKHQuci1zKSxhK2UqKHQuZy1hKSxpK2UqKHQuYi1pKSxyK2UqKHQuYS1yKSl9c3RhdGljIHJhbmRvbSh0PTAsZT0hMSl7cmV0dXJuIHQ+MD9uZXcgaCh0K01hdGgucmFuZG9tKCkqKDEtdCksdCtNYXRoLnJhbmRvbSgpKigxLXQpLHQrTWF0aC5yYW5kb20oKSooMS10KSxlP3QrTWF0aC5yYW5kb20oKSooMS10KToxKTp0PDA/bmV3IGgoTWF0aC5yYW5kb20oKSooMSt0KSxNYXRoLnJhbmRvbSgpKigxK3QpLE1hdGgucmFuZG9tKCkqKDErdCksZT9NYXRoLnJhbmRvbSgpKigxK3QpOjEpOm5ldyBoKE1hdGgucmFuZG9tKCksTWF0aC5yYW5kb20oKSxNYXRoLnJhbmRvbSgpLGU/TWF0aC5yYW5kb20oKToxKX1jbG9uZSgpe3JldHVybiBuZXcgaCh0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXSx0aGlzLl9fZGF0YVszXSl9YXNBcnJheSgpe3JldHVybiB0aGlzLl9fZGF0YX1hczNDb21wb25lbnRBcnJheSgpe3JldHVyblt0aGlzLl9fZGF0YVswXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVsyXV19c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IGgoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IGgodCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fXRvSlNPTigpe3JldHVybntyOnRoaXMucixnOnRoaXMuZyxiOnRoaXMuYixhOnRoaXMuYX19ZnJvbUpTT04odCl7dGhpcy5yPXQucix0aGlzLmc9dC5nLHRoaXMuYj10LmIsdGhpcy5hPXQuYX10b0NTU1N0cmluZygpe3JldHVybiJyZ2JhKCIrTWF0aC5yb3VuZCgyNTUqdGhpcy5yKSsiLCAiK01hdGgucm91bmQoMjU1KnRoaXMuZykrIiwgIitNYXRoLnJvdW5kKDI1NSp0aGlzLmIpKyIsICIrdGhpcy5hKyIpIn19YS5yZWdpc3RlclR5cGUoIlJHQkEiLGgpO2NsYXNzIG8gZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KXRoaXMuX19kYXRhPXQ7ZWxzZSBpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSB0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDQpLCJzdHJpbmciPT10eXBlb2YgdD90LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tQ1NTQ29sb3JOYW1lKHQpOih0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hKX1nZXQgcigpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgcih0KXt0aGlzLl9fZGF0YVswXT10fWdldCBnKCl7cmV0dXJuIHRoaXMuX19kYXRhWzFdfXNldCBnKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IGIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IGIodCl7dGhpcy5fX2RhdGFbMl09dH1nZXQgYSgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgYSh0KXt0aGlzLl9fZGF0YVszXT10fXNldCh0LGUscyxhPTEpe3RoaXMucj10LHRoaXMuZz1lLHRoaXMuYj1zLHRoaXMuYT1hfXNldEZyb21PdGhlcih0KXt0aGlzLnI9dC5yLHRoaXMuZz10LmcsdGhpcy5iPXQuYix0aGlzLmE9dC5hfXNldEZyb21TY2FsYXJBcnJheSh0KXt0aGlzLnI9dFswXSx0aGlzLmc9dFsxXSx0aGlzLmI9dFsyXSx0aGlzLmE9ND09dC5sZW5ndGg/dFszXToxfWdldEFzUkdCQXJyYXkoKXtyZXR1cm5bMjU1KnRoaXMuciwyNTUqdGhpcy5nLDI1NSp0aGlzLmJdfWdldEFzUkdCRGljdCgpe3JldHVybntyOjI1NSp0aGlzLnIsZzoyNTUqdGhpcy5nLGI6MjU1KnRoaXMuYn19c2V0RnJvbVJHQih0LGUscyxhKXt0aGlzLnI9dC8yNTUsdGhpcy5nPWUvMjU1LHRoaXMuYj1zLzI1NSx0aGlzLmE9YT9hLzI1NToxfXNldEZyb21SR0JBcnJheSh0KXt0aGlzLnI9dFswXS8yNTUsdGhpcy5nPXRbMV0vMjU1LHRoaXMuYj10WzJdLzI1NSx0aGlzLmE9ND09dC5sZW5ndGg/dFszXS8yNTU6MX1zZXRGcm9tUkdCRGljdCh0KXt0aGlzLnI9dC5yLzI1NSx0aGlzLmc9dC5nLzI1NSx0aGlzLmI9dC5iLzI1NSx0aGlzLmE9ND09dC5hP3QuYS8yNTU6MX1zZXRGcm9tSGV4KHQpe2NvbnN0IGU9ZnVuY3Rpb24odCl7Y29uc3QgZT0vXiM/KFthLWZcZF17Mn0pKFthLWZcZF17Mn0pKFthLWZcZF17Mn0pJC9pLmV4ZWModCk7cmV0dXJuIGU/e3I6cGFyc2VJbnQoZVsxXSwxNiksZzpwYXJzZUludChlWzJdLDE2KSxiOnBhcnNlSW50KGVbM10sMTYpfTpudWxsfSh0KTtlP3RoaXMuc2V0RnJvbVJHQihlLnIsZS5nLGUuYik6Y29uc29sZS53YXJuKCJJbnZhbGlkIGhleCBjb2RlOiIrdCl9c2V0RnJvbUNTU0NvbG9yTmFtZSh0KXt0LnN0YXJ0c1dpdGgoIiMiKT90aGlzLnNldEZyb21IZXgodCk6dGhpcy5zZXRGcm9tSGV4KCh0PT57Y29uc3QgZT17YWxpY2VibHVlOiIjZjBmOGZmIixhbnRpcXVld2hpdGU6IiNmYWViZDciLGFxdWE6IiMwMGZmZmYiLGFxdWFtYXJpbmU6IiM3ZmZmZDQiLGF6dXJlOiIjZjBmZmZmIixiZWlnZToiI2Y1ZjVkYyIsYmlzcXVlOiIjZmZlNGM0IixibGFjazoiIzAwMDAwMCIsYmxhbmNoZWRhbG1vbmQ6IiNmZmViY2QiLGJsdWU6IiMwMDAwZmYiLGJsdWV2aW9sZXQ6IiM4YTJiZTIiLGJyb3duOiIjYTUyYTJhIixidXJseXdvb2Q6IiNkZWI4ODciLGNhZGV0Ymx1ZToiIzVmOWVhMCIsY2hhcnRyZXVzZToiIzdmZmYwMCIsY2hvY29sYXRlOiIjZDI2OTFlIixjb3JhbDoiI2ZmN2Y1MCIsY29ybmZsb3dlcmJsdWU6IiM2NDk1ZWQiLGNvcm5zaWxrOiIjZmZmOGRjIixjcmltc29uOiIjZGMxNDNjIixjeWFuOiIjMDBmZmZmIixkYXJrYmx1ZToiIzAwMDA4YiIsZGFya2N5YW46IiMwMDhiOGIiLGRhcmtnb2xkZW5yb2Q6IiNiODg2MGIiLGRhcmtncmF5OiIjYTlhOWE5IixkYXJrZ3JlZW46IiMwMDY0MDAiLGRhcmtraGFraToiI2JkYjc2YiIsZGFya21hZ2VudGE6IiM4YjAwOGIiLGRhcmtvbGl2ZWdyZWVuOiIjNTU2YjJmIixkYXJrb3JhbmdlOiIjZmY4YzAwIixkYXJrb3JjaGlkOiIjOTkzMmNjIixkYXJrcmVkOiIjOGIwMDAwIixkYXJrc2FsbW9uOiIjZTk5NjdhIixkYXJrc2VhZ3JlZW46IiM4ZmJjOGYiLGRhcmtzbGF0ZWJsdWU6IiM0ODNkOGIiLGRhcmtzbGF0ZWdyYXk6IiMyZjRmNGYiLGRhcmt0dXJxdW9pc2U6IiMwMGNlZDEiLGRhcmt2aW9sZXQ6IiM5NDAwZDMiLGRlZXBwaW5rOiIjZmYxNDkzIixkZWVwc2t5Ymx1ZToiIzAwYmZmZiIsZGltZ3JheToiIzY5Njk2OSIsZG9kZ2VyYmx1ZToiIzFlOTBmZiIsZmlyZWJyaWNrOiIjYjIyMjIyIixmbG9yYWx3aGl0ZToiI2ZmZmFmMCIsZm9yZXN0Z3JlZW46IiMyMjhiMjIiLGZ1Y2hzaWE6IiNmZjAwZmYiLGdhaW5zYm9ybzoiI2RjZGNkYyIsZ2hvc3R3aGl0ZToiI2Y4ZjhmZiIsZ29sZDoiI2ZmZDcwMCIsZ29sZGVucm9kOiIjZGFhNTIwIixncmF5OiIjODA4MDgwIixncmVlbjoiIzAwODAwMCIsZ3JlZW55ZWxsb3c6IiNhZGZmMmYiLGhvbmV5ZGV3OiIjZjBmZmYwIixob3RwaW5rOiIjZmY2OWI0IiwiaW5kaWFucmVkICI6IiNjZDVjNWMiLGluZGlnbzoiIzRiMDA4MiIsaXZvcnk6IiNmZmZmZjAiLGtoYWtpOiIjZjBlNjhjIixsYXZlbmRlcjoiI2U2ZTZmYSIsbGF2ZW5kZXJibHVzaDoiI2ZmZjBmNSIsbGF3bmdyZWVuOiIjN2NmYzAwIixsZW1vbmNoaWZmb246IiNmZmZhY2QiLGxpZ2h0Ymx1ZToiI2FkZDhlNiIsbGlnaHRjb3JhbDoiI2YwODA4MCIsbGlnaHRjeWFuOiIjZTBmZmZmIixsaWdodGdvbGRlbnJvZHllbGxvdzoiI2ZhZmFkMiIsbGlnaHRncmV5OiIjZDNkM2QzIixsaWdodGdyZWVuOiIjOTBlZTkwIixsaWdodHBpbms6IiNmZmI2YzEiLGxpZ2h0c2FsbW9uOiIjZmZhMDdhIixsaWdodHNlYWdyZWVuOiIjMjBiMmFhIixsaWdodHNreWJsdWU6IiM4N2NlZmEiLGxpZ2h0c2xhdGVncmF5OiIjNzc4ODk5IixsaWdodHN0ZWVsYmx1ZToiI2IwYzRkZSIsbGlnaHR5ZWxsb3c6IiNmZmZmZTAiLGxpbWU6IiMwMGZmMDAiLGxpbWVncmVlbjoiIzMyY2QzMiIsbGluZW46IiNmYWYwZTYiLG1hZ2VudGE6IiNmZjAwZmYiLG1hcm9vbjoiIzgwMDAwMCIsbWVkaXVtYXF1YW1hcmluZToiIzY2Y2RhYSIsbWVkaXVtYmx1ZToiIzAwMDBjZCIsbWVkaXVtb3JjaGlkOiIjYmE1NWQzIixtZWRpdW1wdXJwbGU6IiM5MzcwZDgiLG1lZGl1bXNlYWdyZWVuOiIjM2NiMzcxIixtZWRpdW1zbGF0ZWJsdWU6IiM3YjY4ZWUiLG1lZGl1bXNwcmluZ2dyZWVuOiIjMDBmYTlhIixtZWRpdW10dXJxdW9pc2U6IiM0OGQxY2MiLG1lZGl1bXZpb2xldHJlZDoiI2M3MTU4NSIsbWlkbmlnaHRibHVlOiIjMTkxOTcwIixtaW50Y3JlYW06IiNmNWZmZmEiLG1pc3R5cm9zZToiI2ZmZTRlMSIsbW9jY2FzaW46IiNmZmU0YjUiLG5hdmFqb3doaXRlOiIjZmZkZWFkIixuYXZ5OiIjMDAwMDgwIixvbGRsYWNlOiIjZmRmNWU2IixvbGl2ZToiIzgwODAwMCIsb2xpdmVkcmFiOiIjNmI4ZTIzIixvcmFuZ2U6IiNmZmE1MDAiLG9yYW5nZXJlZDoiI2ZmNDUwMCIsb3JjaGlkOiIjZGE3MGQ2IixwYWxlZ29sZGVucm9kOiIjZWVlOGFhIixwYWxlZ3JlZW46IiM5OGZiOTgiLHBhbGV0dXJxdW9pc2U6IiNhZmVlZWUiLHBhbGV2aW9sZXRyZWQ6IiNkODcwOTMiLHBhcGF5YXdoaXA6IiNmZmVmZDUiLHBlYWNocHVmZjoiI2ZmZGFiOSIscGVydToiI2NkODUzZiIscGluazoiI2ZmYzBjYiIscGx1bToiI2RkYTBkZCIscG93ZGVyYmx1ZToiI2IwZTBlNiIscHVycGxlOiIjODAwMDgwIixyZWJlY2NhcHVycGxlOiIjNjYzMzk5IixyZWQ6IiNmZjAwMDAiLHJvc3licm93bjoiI2JjOGY4ZiIscm95YWxibHVlOiIjNDE2OWUxIixzYWRkbGVicm93bjoiIzhiNDUxMyIsc2FsbW9uOiIjZmE4MDcyIixzYW5keWJyb3duOiIjZjRhNDYwIixzZWFncmVlbjoiIzJlOGI1NyIsc2Vhc2hlbGw6IiNmZmY1ZWUiLHNpZW5uYToiI2EwNTIyZCIsc2lsdmVyOiIjYzBjMGMwIixza3libHVlOiIjODdjZWViIixzbGF0ZWJsdWU6IiM2YTVhY2QiLHNsYXRlZ3JheToiIzcwODA5MCIsc25vdzoiI2ZmZmFmYSIsc3ByaW5nZ3JlZW46IiMwMGZmN2YiLHN0ZWVsYmx1ZToiIzQ2ODJiNCIsdGFuOiIjZDJiNDhjIix0ZWFsOiIjMDA4MDgwIix0aGlzdGxlOiIjZDhiZmQ4Iix0b21hdG86IiNmZjYzNDciLHR1cnF1b2lzZToiIzQwZTBkMCIsdmlvbGV0OiIjZWU4MmVlIix3aGVhdDoiI2Y1ZGViMyIsd2hpdGU6IiNmZmZmZmYiLHdoaXRlc21va2U6IiNmNWY1ZjUiLHllbGxvdzoiI2ZmZmYwMCIseWVsbG93Z3JlZW46IiM5YWNkMzIifTtyZXR1cm4gdm9pZCAwIT09ZVt0LnRvTG93ZXJDYXNlKCldJiZlW3QudG9Mb3dlckNhc2UoKV19KSh0KSl9dG9IZXgoKXtmdW5jdGlvbiB0KHQpe2NvbnN0IGU9TWF0aC5yb3VuZCgyNTUqdCkudG9TdHJpbmcoMTYpO3JldHVybiAxPT1lLmxlbmd0aD8iMCIrZTplfXJldHVybiIjIit0KHRoaXMucikrdCh0aGlzLmcpK3QodGhpcy5iKX1lcXVhbCh0KXtyZXR1cm4gdGhpcy5yPT10LnImJnRoaXMuZz09dC5nJiZ0aGlzLmI9PXQuYiYmdGhpcy5hPT10LmF9bm90ZXF1YWxzKHQpe3JldHVybiB0aGlzLnIhPXQuciYmdGhpcy5nIT10LmcmJnRoaXMuYiE9dC5iJiZ0aGlzLmEhPXQuYX1hcHByb3hFcXVhbCh0LGU9TnVtYmVyLkVQU0lMT04pe3JldHVybiBNYXRoLmFicyh0aGlzLnItdC5yKTxlJiZNYXRoLmFicyh0aGlzLmctdC5nKTxlJiZNYXRoLmFicyh0aGlzLmItdC5iKTxlJiZNYXRoLmFicyh0aGlzLmEtdC5hKTxlfWFkZCh0KXtyZXR1cm4gbmV3IG8odGhpcy5yK3Qucix0aGlzLmcrdC5nLHRoaXMuYit0LmIsdGhpcy5hK3QuYSl9c3VidHJhY3QodCl7cmV0dXJuIG5ldyBvKHRoaXMuci10LnIsdGhpcy5nLXQuZyx0aGlzLmItdC5iLHRoaXMuYS10LmEpfXNjYWxlKHQpe3JldHVybiBuZXcgbyh0aGlzLnIqdCx0aGlzLmcqdCx0aGlzLmIqdCx0aGlzLmEqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMucio9dCx0aGlzLmcqPXQsdGhpcy5iKj10LHRoaXMuYSo9dH1hcHBseUdhbW1hKHQpe3RoaXMuc2V0KE1hdGgucG93KHRoaXMucix0KSxNYXRoLnBvdyh0aGlzLmcsdCksTWF0aC5wb3codGhpcy5iLHQpLHRoaXMuYSl9dG9MaW5lYXIodD0yLjIpe3JldHVybiBuZXcgbyhNYXRoLnBvdyh0aGlzLnIsdCksTWF0aC5wb3codGhpcy5nLHQpLE1hdGgucG93KHRoaXMuYix0KSx0aGlzLmEpfXRvR2FtbWEodD0yLjIpe3JldHVybiBuZXcgbyhNYXRoLnBvdyh0aGlzLnIsMS90KSxNYXRoLnBvdyh0aGlzLmcsMS90KSxNYXRoLnBvdyh0aGlzLmIsMS90KSx0aGlzLmEpfWx1bWluYW5jZSgpe3JldHVybi4yMTI2KnRoaXMucisuNzE1Mip0aGlzLmcrLjA3MjIqdGhpcy5ifWxlcnAodCxlKXtjb25zdCBzPXRoaXMucixhPXRoaXMuZyxpPXRoaXMuYixyPXRoaXMuYTtyZXR1cm4gbmV3IG8ocytlKih0LnItcyksYStlKih0LmctYSksaStlKih0LmItaSkscitlKih0LmEtcikpfXN0YXRpYyByYW5kb20odD0wLGU9ITEpe3JldHVybiB0PjA/bmV3IG8odCtNYXRoLnJhbmRvbSgpKigxLXQpLHQrTWF0aC5yYW5kb20oKSooMS10KSx0K01hdGgucmFuZG9tKCkqKDEtdCksZT90K01hdGgucmFuZG9tKCkqKDEtdCk6MSk6dDwwP25ldyBvKE1hdGgucmFuZG9tKCkqKDErdCksTWF0aC5yYW5kb20oKSooMSt0KSxNYXRoLnJhbmRvbSgpKigxK3QpLGU/TWF0aC5yYW5kb20oKSooMSt0KToxKTpuZXcgbyhNYXRoLnJhbmRvbSgpLE1hdGgucmFuZG9tKCksTWF0aC5yYW5kb20oKSxlP01hdGgucmFuZG9tKCk6MSl9Y2xvbmUoKXtyZXR1cm4gbmV3IG8odGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbM10pfWFzQXJyYXkoKXtyZXR1cm4gdGhpcy5fX2RhdGF9YXMzQ29tcG9uZW50QXJyYXkoKXtyZXR1cm5bdGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl1dfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBvKC4uLnQpfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyBvKHQsNCplKX1zdGF0aWMgbnVtRWxlbWVudHMoKXtyZXR1cm4gNH10b0pTT04oKXtyZXR1cm57cjp0aGlzLnIsZzp0aGlzLmcsYjp0aGlzLmIsYTp0aGlzLmF9fWZyb21KU09OKHQpe3RoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXMuYT10LmF9dG9DU1NTdHJpbmcoKXtyZXR1cm4icmdiYSgiK01hdGgucm91bmQoMjU1KnRoaXMucikrIiwgIitNYXRoLnJvdW5kKDI1NSp0aGlzLmcpKyIsICIrTWF0aC5yb3VuZCgyNTUqdGhpcy5iKSsiLCAiK3RoaXMuYSsiKSJ9fWEucmVnaXN0ZXJUeXBlKCJDb2xvciIsbyk7Y2xhc3MgXyBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0wLGU9MCxzPTAsYT0wKXtpZihzdXBlcigpLGlzTmFOKGEpKXN3aXRjaChhKXtjYXNlIlhZWiI6dGhpcy5vcmRlcj0wO2JyZWFrO2Nhc2UiWVpYIjp0aGlzLm9yZGVyPTE7YnJlYWs7Y2FzZSJaWFkiOnRoaXMub3JkZXI9MjticmVhaztjYXNlIlhaWSI6dGhpcy5vcmRlcj0zO2JyZWFrO2Nhc2UiWllYIjp0aGlzLm9yZGVyPTQ7YnJlYWs7Y2FzZSJZWFoiOnRoaXMub3JkZXI9NTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBFdWxlciBBbmdsZXMgT3JkZXI6IithKX1lbHNlIHRoaXMub3JkZXI9YTtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSB0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDMpLHRoaXMuX19kYXRhWzBdPXQsdGhpcy5fX2RhdGFbMV09ZSx0aGlzLl9fZGF0YVsyXT1zfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fXNldCh0LGUscyl7dGhpcy5fX2RhdGFbMF09dCx0aGlzLl9fZGF0YVsxXT1lLHRoaXMuX19kYXRhWzJdPXN9fWEucmVnaXN0ZXJUeXBlKCJFdWxlckFuZ2xlcyIsXyk7Y2xhc3MgZCBleHRlbmRzIHN7Y29uc3RydWN0b3IodD0xLGU9MCxzPTAsYT0wLGk9MSxyPTAsbj0wLGg9MCxvPTEpe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkocyxhLDkpfWVsc2UgdGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSg5KSx0aGlzLnNldCh0LGUscyxhLGkscixuLGgsbyl9Z2V0IG0wMCgpe3JldHVybiB0aGlzLl9fZGF0YVswXX1zZXQgbTAwKHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IG0wMSgpe3JldHVybiB0aGlzLl9fZGF0YVsxXX1zZXQgbTAxKHQpe3RoaXMuX19kYXRhWzFdPXR9Z2V0IG0wMigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgbTAyKHQpe3RoaXMuX19kYXRhWzJdPXR9Z2V0IG0xMCgpe3JldHVybiB0aGlzLl9fZGF0YVszXX1zZXQgbTEwKHQpe3RoaXMuX19kYXRhWzNdPXR9Z2V0IG0xMSgpe3JldHVybiB0aGlzLl9fZGF0YVs0XX1zZXQgbTExKHQpe3RoaXMuX19kYXRhWzRdPXR9Z2V0IG0xMigpe3JldHVybiB0aGlzLl9fZGF0YVs1XX1zZXQgbTEyKHQpe3RoaXMuX19kYXRhWzVdPXR9Z2V0IG0yMCgpe3JldHVybiB0aGlzLl9fZGF0YVs2XX1zZXQgbTIwKHQpe3RoaXMuX19kYXRhWzZdPXR9Z2V0IG0yMSgpe3JldHVybiB0aGlzLl9fZGF0YVs3XX1zZXQgbTIxKHQpe3RoaXMuX19kYXRhWzddPXR9Z2V0IG0yMigpe3JldHVybiB0aGlzLl9fZGF0YVs4XX1zZXQgbTIyKHQpe3RoaXMuX19kYXRhWzhdPXR9Z2V0IHhBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDApfXNldCB4QXhpcyh0KXt0aGlzLnhBeGlzLnNldCh0LngsdC55LHQueil9Z2V0IHlBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDMpfXNldCB5QXhpcyh0KXt0aGlzLnlBeGlzLnNldCh0LngsdC55LHQueil9Z2V0IHpBeGlzKCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLDYpfXNldCB6QXhpcyh0KXt0aGlzLnpBeGlzLnNldCh0LngsdC55LHQueil9c2V0KHQ9MSxlPTAscz0wLGE9MCxpPTEscj0wLG49MCxoPTAsbz0xKXt0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hLHRoaXMuX19kYXRhWzRdPWksdGhpcy5fX2RhdGFbNV09cix0aGlzLl9fZGF0YVs2XT1uLHRoaXMuX19kYXRhWzddPWgsdGhpcy5fX2RhdGFbOF09b31zZXRJZGVudGl0eSgpe3RoaXMuc2V0KCl9c2V0RnJvbU1hdCh0KXt0aGlzLl9fZGF0YVswXT10Lm0wMCx0aGlzLl9fZGF0YVsxXT10Lm0wMSx0aGlzLl9fZGF0YVsyXT10Lm0wMix0aGlzLl9fZGF0YVszXT10Lm0xMCx0aGlzLl9fZGF0YVs0XT10Lm0xMSx0aGlzLl9fZGF0YVs1XT10Lm0xMix0aGlzLl9fZGF0YVs2XT10Lm0yMCx0aGlzLl9fZGF0YVs3XT10Lm0yMSx0aGlzLl9fZGF0YVs4XT10Lm0yMn1zZXRGcm9tRGlyZWN0aW9uQW5kVXB2ZWN0b3IodCxlKXtjb25zdCBzPXQsYT1zLmxlbmd0aCgpO2lmKGE8TnVtYmVyLkVQU0lMT04pcmV0dXJuIHZvaWQgdGhpcy5zZXRJZGVudGl0eSgpO3Muc2NhbGVJblBsYWNlKDEvYSk7Y29uc3QgaT1lLmNyb3NzKHMpLHI9aS5sZW5ndGgoKTtyPk51bWJlci5FUFNJTE9OJiZpLnNjYWxlSW5QbGFjZSgxL3IpO2NvbnN0IG49cy5jcm9zcyhpKSxoPW4ubGVuZ3RoKCk7aD5OdW1iZXIuRVBTSUxPTiYmbi5zY2FsZUluUGxhY2UoMS9oKSx0aGlzLnNldChpLngsaS55LGkueixuLngsbi55LG4ueixzLngscy55LHMueil9aW52ZXJzZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM10saT10aGlzLl9fZGF0YVs0XSxyPXRoaXMuX19kYXRhWzVdLG49dGhpcy5fX2RhdGFbNl0saD10aGlzLl9fZGF0YVs3XSxvPXRoaXMuX19kYXRhWzhdLF89byppLXIqaCxsPS1vKmErcipuLGM9aCphLWkqbix1PXQqXytlKmwrcypjO3JldHVybiB1Pyh1PTEvdSxuZXcgZChfKnUsKC1vKmUrcypoKSp1LChyKmUtcyppKSp1LGwqdSwobyp0LXMqbikqdSwoLXIqdCtzKmEpKnUsYyp1LCgtaCp0K2UqbikqdSwoaSp0LWUqYSkqdSkpOihjb25zb2xlLndhcm4oIlVuYWJsZSB0byBpbnZlcnQgTWF0MyIpLG51bGwpfWludmVydEluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdLGk9dGhpcy5fX2RhdGFbNF0scj10aGlzLl9fZGF0YVs1XSxuPXRoaXMuX19kYXRhWzZdLGg9dGhpcy5fX2RhdGFbN10sbz10aGlzLl9fZGF0YVs4XSxfPW8qaS1yKmgsZD0tbyphK3IqbixsPWgqYS1pKm4sYz10Kl8rZSpkK3MqbDtyZXR1cm4gYz8oYz0xL2MsdGhpcy5zZXQoXypjLCgtbyplK3MqaCkqYywociplLXMqaSkqYyxkKmMsKG8qdC1zKm4pKmMsKC1yKnQrcyphKSpjLGwqYywoLWgqdCtlKm4pKmMsKGkqdC1lKmEpKmMpLCEwKTooY29uc29sZS53YXJuKCJVbmFibGUgdG8gaW52ZXJ0IE1hdDMiKSwhMSl9dHJhbnNwb3NlKCl7cmV0dXJuIGQodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbM10sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbNF0sdGhpcy5fX2RhdGFbN10sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbNV0sdGhpcy5fX2RhdGFbOF0pfXRyYW5zcG9zZUluUGxhY2UoKXtjb25zdCB0PXRoaXMuX19kYXRhWzFdLGU9dGhpcy5fX2RhdGFbMl0scz10aGlzLl9fZGF0YVs1XTt0aGlzLl9fZGF0YVsxXT10aGlzLl9fZGF0YVszXSx0aGlzLl9fZGF0YVsyXT10aGlzLl9fZGF0YVs2XSx0aGlzLl9fZGF0YVszXT10LHRoaXMuX19kYXRhWzVdPXRoaXMuX19kYXRhWzddLHRoaXMuX19kYXRhWzZdPWUsdGhpcy5fX2RhdGFbN109c310cmFuc2Zvcm1WZWMzKHQpe3JldHVybiBuZXcgcih0aGlzLl9fZGF0YVswXSp0LngrdGhpcy5fX2RhdGFbMV0qdC55K3RoaXMuX19kYXRhWzJdKnQueix0aGlzLl9fZGF0YVszXSp0LngrdGhpcy5fX2RhdGFbNF0qdC55K3RoaXMuX19kYXRhWzVdKnQueix0aGlzLl9fZGF0YVs2XSp0LngrdGhpcy5fX2RhdGFbN10qdC55K3RoaXMuX19kYXRhWzhdKnQueil9Y2xvbmUoKXtyZXR1cm4gbmV3IGQodGhpcy5fX2RhdGFbMF0sdGhpcy5fX2RhdGFbMV0sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbM10sdGhpcy5fX2RhdGFbNF0sdGhpcy5fX2RhdGFbNV0sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbN10sdGhpcy5fX2RhdGFbOF0sdGhpcy5fX2RhdGFbOV0pfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBkKC4uLnQpfXN0YXRpYyBjcmVhdGVGcm9tRmxvYXQzMkJ1ZmZlcih0LGU9MCl7cmV0dXJuIG5ldyBkKHQsNCplKX10b0pTT04oKXtyZXR1cm4gdGhpcy5fX2RhdGF9ZnJvbUpTT04odCl7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSh0KX10b1N0cmluZygpe3JldHVybiB0aGlzLnRvSlNPTigpLnRvU3RyaW5nKCl9fWEucmVnaXN0ZXJUeXBlKCJNYXQzIixkKTtjbGFzcyBsIGV4dGVuZHMgc3tjb25zdHJ1Y3Rvcih0PTEsZT0wLHM9MCxhPTAsaT0wLHI9MSxuPTAsaD0wLG89MCxfPTAsZD0xLGw9MCxjPTAsdT0wLGY9MCxtPTEpe2lmKHN1cGVyKCksdCBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSl0aGlzLl9fZGF0YT10O2Vsc2UgaWYodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKXtjb25zdCBzPXQsYT1lO3RoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkocyxhLDE2KX1lbHNlIHRoaXMuX19kYXRhPW5ldyBGbG9hdDMyQXJyYXkoMTYpLHRoaXMuc2V0KHQsZSxzLGEsaSxyLG4saCxvLF8sZCxsLGMsdSxmLG0pfWdldCBtMDAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMF19c2V0IG0wMCh0KXt0aGlzLl9fZGF0YVswXT10fWdldCBtMDEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IG0wMSh0KXt0aGlzLl9fZGF0YVsxXT10fWdldCBtMDIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMl19c2V0IG0wMih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCBtMDMoKXtyZXR1cm4gdGhpcy5fX2RhdGFbM119c2V0IG0wMyh0KXt0aGlzLl9fZGF0YVszXT10fWdldCBtMTAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNF19c2V0IG0xMCh0KXt0aGlzLl9fZGF0YVs0XT10fWdldCBtMTEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNV19c2V0IG0xMSh0KXt0aGlzLl9fZGF0YVs1XT10fWdldCBtMTIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbNl19c2V0IG0xMih0KXt0aGlzLl9fZGF0YVs2XT10fWdldCBtMTMoKXtyZXR1cm4gdGhpcy5fX2RhdGFbN119c2V0IG0xMyh0KXt0aGlzLl9fZGF0YVs3XT10fWdldCBtMjAoKXtyZXR1cm4gdGhpcy5fX2RhdGFbOF19c2V0IG0yMCh0KXt0aGlzLl9fZGF0YVs4XT10fWdldCBtMjEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbOV19c2V0IG0yMSh0KXt0aGlzLl9fZGF0YVs5XT10fWdldCBtMjIoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMTBdfXNldCBtMjIodCl7dGhpcy5fX2RhdGFbMTBdPXR9Z2V0IG0yMygpe3JldHVybiB0aGlzLl9fZGF0YVsxMV19c2V0IG0yMyh0KXt0aGlzLl9fZGF0YVsxMV09dH1nZXQgbTMwKCl7cmV0dXJuIHRoaXMuX19kYXRhWzEyXX1zZXQgbTMwKHQpe3RoaXMuX19kYXRhWzEyXT10fWdldCBtMzEoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMTNdfXNldCBtMzEodCl7dGhpcy5fX2RhdGFbMTNdPXR9Z2V0IG0zMigpe3JldHVybiB0aGlzLl9fZGF0YVsxNF19c2V0IG0zMih0KXt0aGlzLl9fZGF0YVsxNF09dH1nZXQgbTMzKCl7cmV0dXJuIHRoaXMuX19kYXRhWzE1XX1zZXQgbTMzKHQpe3RoaXMuX19kYXRhWzE1XT10fWdldCB4QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciwwKX1zZXQgeEF4aXModCl7dGhpcy54QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB5QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciw0KX1zZXQgeUF4aXModCl7dGhpcy55QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB6QXhpcygpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciw4KX1zZXQgekF4aXModCl7dGhpcy56QXhpcy5zZXQodC54LHQueSx0LnopfWdldCB0cmFuc2xhdGlvbigpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlciwxMil9c2V0IHRyYW5zbGF0aW9uKHQpe3RoaXMudHJhbnNsYXRpb24uc2V0KHQueCx0LnksdC56KX1zZXQodD0xLGU9MCxzPTAsYT0wLGk9MCxyPTEsbj0wLGg9MCxvPTAsXz0wLGQ9MSxsPTAsYz0wLHU9MCxmPTAsbT0xKXt0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hLHRoaXMuX19kYXRhWzRdPWksdGhpcy5fX2RhdGFbNV09cix0aGlzLl9fZGF0YVs2XT1uLHRoaXMuX19kYXRhWzddPWgsdGhpcy5fX2RhdGFbOF09byx0aGlzLl9fZGF0YVs5XT1fLHRoaXMuX19kYXRhWzEwXT1kLHRoaXMuX19kYXRhWzExXT1sLHRoaXMuX19kYXRhWzEyXT1jLHRoaXMuX19kYXRhWzEzXT11LHRoaXMuX19kYXRhWzE0XT1mLHRoaXMuX19kYXRhWzE1XT1tfXNldElkZW50aXR5KCl7dGhpcy5zZXQoKX1zZXREYXRhQXJyYXkodCl7dGhpcy5fX2RhdGE9dH1zZXRGcm9tTWF0NCh0KXt0aGlzLl9fZGF0YVswXT10Lm0wMCx0aGlzLl9fZGF0YVsxXT10Lm0wMSx0aGlzLl9fZGF0YVsyXT10Lm0wMix0aGlzLl9fZGF0YVszXT10Lm0wMyx0aGlzLl9fZGF0YVs0XT10Lm0xMCx0aGlzLl9fZGF0YVs1XT10Lm0xMSx0aGlzLl9fZGF0YVs2XT10Lm0xMix0aGlzLl9fZGF0YVs3XT10Lm0xMyx0aGlzLl9fZGF0YVs4XT10Lm0yMCx0aGlzLl9fZGF0YVs5XT10Lm0yMSx0aGlzLl9fZGF0YVsxMF09dC5tMjIsdGhpcy5fX2RhdGFbMTFdPXQubTIzLHRoaXMuX19kYXRhWzEyXT10Lm0zMCx0aGlzLl9fZGF0YVsxM109dC5tMzEsdGhpcy5fX2RhdGFbMTRdPXQubTMyLHRoaXMuX19kYXRhWzE1XT10Lm0zM310b01hdDModCl7cmV0dXJuIG5ldyBkKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzVdLHRoaXMuX19kYXRhWzZdLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzldLHRoaXMuX19kYXRhWzEwXSl9dHJhbnNwb3NlSW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMV0sZT10aGlzLl9fZGF0YVsyXSxzPXRoaXMuX19kYXRhWzNdLGE9dGhpcy5fX2RhdGFbNl0saT10aGlzLl9fZGF0YVs3XSxyPXRoaXMuX19kYXRhWzExXTt0aGlzLl9fZGF0YVsxXT10aGlzLl9fZGF0YVs0XSx0aGlzLl9fZGF0YVsyXT10aGlzLl9fZGF0YVs4XSx0aGlzLl9fZGF0YVszXT10aGlzLl9fZGF0YVsxMl0sdGhpcy5fX2RhdGFbNF09dCx0aGlzLl9fZGF0YVs2XT10aGlzLl9fZGF0YVs5XSx0aGlzLl9fZGF0YVs3XT10aGlzLl9fZGF0YVsxM10sdGhpcy5fX2RhdGFbOF09ZSx0aGlzLl9fZGF0YVs5XT1hLHRoaXMuX19kYXRhWzExXT10aGlzLl9fZGF0YVsxNF0sdGhpcy5fX2RhdGFbMTJdPXMsdGhpcy5fX2RhdGFbMTNdPWksdGhpcy5fX2RhdGFbMTRdPXJ9dHJhbnNwb3NlKCl7cmV0dXJuIG5ldyBsKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzEyXSx0aGlzLl9fZGF0YVsxXSx0aGlzLl9fZGF0YVs1XSx0aGlzLl9fZGF0YVs5XSx0aGlzLl9fZGF0YVsxM10sdGhpcy5fX2RhdGFbMl0sdGhpcy5fX2RhdGFbNl0sdGhpcy5fX2RhdGFbMTBdLHRoaXMuX19kYXRhWzE0XSx0aGlzLl9fZGF0YVszXSx0aGlzLl9fZGF0YVs3XSx0aGlzLl9fZGF0YVsxMV0sdGhpcy5fX2RhdGFbMTVdKX1pbnZlcnNlKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVszXSxpPXRoaXMuX19kYXRhWzRdLHI9dGhpcy5fX2RhdGFbNV0sbj10aGlzLl9fZGF0YVs2XSxoPXRoaXMuX19kYXRhWzddLG89dGhpcy5fX2RhdGFbOF0sXz10aGlzLl9fZGF0YVs5XSxkPXRoaXMuX19kYXRhWzEwXSxjPXRoaXMuX19kYXRhWzExXSx1PXRoaXMuX19kYXRhWzEyXSxmPXRoaXMuX19kYXRhWzEzXSxtPXRoaXMuX19kYXRhWzE0XSxnPXRoaXMuX19kYXRhWzE1XSx5PXQqci1lKmkscD10Km4tcyppLGI9dCpoLWEqaSx4PWUqbi1zKnIsdz1lKmgtYSpyLEk9cypoLWEqbixOPW8qZi1fKnUsRj1vKm0tZCp1LHo9bypnLWMqdSxWPV8qbS1kKmYsTT1fKmctYypmLEE9ZCpnLWMqbTtsZXQgUz15KkEtcCpNK2IqVit4KnotdypGK0kqTjtyZXR1cm4gUz8oUz0xL1MsbmV3IGwoKHIqQS1uKk0raCpWKSpTLChzKk0tZSpBLWEqVikqUywoZipJLW0qdytnKngpKlMsKGQqdy1fKkktYyp4KSpTLChuKnotaSpBLWgqRikqUywodCpBLXMqeithKkYpKlMsKG0qYi11KkktZypwKSpTLChvKkktZCpiK2MqcCkqUywoaSpNLXIqeitoKk4pKlMsKGUqei10Kk0tYSpOKSpTLCh1KnctZipiK2cqeSkqUywoXypiLW8qdy1jKnkpKlMsKHIqRi1pKlYtbipOKSpTLCh0KlYtZSpGK3MqTikqUywoZipwLXUqeC1tKnkpKlMsKG8qeC1fKnArZCp5KSpTKSk6KGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGludmVydCBNYXQ0IiksbnVsbCl9aW52ZXJ0SW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM10saT10aGlzLl9fZGF0YVs0XSxyPXRoaXMuX19kYXRhWzVdLG49dGhpcy5fX2RhdGFbNl0saD10aGlzLl9fZGF0YVs3XSxvPXRoaXMuX19kYXRhWzhdLF89dGhpcy5fX2RhdGFbOV0sZD10aGlzLl9fZGF0YVsxMF0sbD10aGlzLl9fZGF0YVsxMV0sYz10aGlzLl9fZGF0YVsxMl0sdT10aGlzLl9fZGF0YVsxM10sZj10aGlzLl9fZGF0YVsxNF0sbT10aGlzLl9fZGF0YVsxNV0sZz10KnItZSppLHk9dCpuLXMqaSxwPXQqaC1hKmksYj1lKm4tcypyLHg9ZSpoLWEqcix3PXMqaC1hKm4sST1vKnUtXypjLE49bypmLWQqYyxGPW8qbS1sKmMsej1fKmYtZCp1LFY9XyptLWwqdSxNPWQqbS1sKmY7bGV0IEE9ZypNLXkqVitwKnorYipGLXgqTit3Kkk7cmV0dXJuIEE/KEE9MS9BLHRoaXMuc2V0KChyKk0tbipWK2gqeikqQSwocypWLWUqTS1hKnopKkEsKHUqdy1mKngrbSpiKSpBLChkKngtXyp3LWwqYikqQSwobipGLWkqTS1oKk4pKkEsKHQqTS1zKkYrYSpOKSpBLChmKnAtYyp3LW0qeSkqQSwobyp3LWQqcCtsKnkpKkEsKGkqVi1yKkYraCpJKSpBLChlKkYtdCpWLWEqSSkqQSwoYyp4LXUqcCttKmcpKkEsKF8qcC1vKngtbCpnKSpBLChyKk4taSp6LW4qSSkqQSwodCp6LWUqTitzKkkpKkEsKHUqeS1jKmItZipnKSpBLChvKmItXyp5K2QqZykqQSksITApOihjb25zb2xlLndhcm4oIlVuYWJsZSB0byBpbnZlcnQgTWF0NCIpLCExKX1zZXRJbnZlcnNlKHQpe2NvbnN0IGU9dC5fX2RhdGFbMF0scz10Ll9fZGF0YVsxXSxhPXQuX19kYXRhWzJdLGk9dC5fX2RhdGFbM10scj10Ll9fZGF0YVs0XSxuPXQuX19kYXRhWzVdLGg9dC5fX2RhdGFbNl0sbz10Ll9fZGF0YVs3XSxfPXQuX19kYXRhWzhdLGQ9dC5fX2RhdGFbOV0sbD10Ll9fZGF0YVsxMF0sYz10Ll9fZGF0YVsxMV0sdT10Ll9fZGF0YVsxMl0sZj10Ll9fZGF0YVsxM10sbT10Ll9fZGF0YVsxNF0sZz10Ll9fZGF0YVsxNV0seT1lKm4tcypyLHA9ZSpoLWEqcixiPWUqby1pKnIseD1zKmgtYSpuLHc9cypvLWkqbixJPWEqby1pKmgsTj1fKmYtZCp1LEY9XyptLWwqdSx6PV8qZy1jKnUsVj1kKm0tbCpmLE09ZCpnLWMqZixBPWwqZy1jKm07bGV0IFM9eSpBLXAqTStiKlYreCp6LXcqRitJKk47aWYoIVMpdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gaW52ZXJ0IE1hdDQiKTtTPTEvUyx0aGlzLnNldCgobipBLWgqTStvKlYpKlMsKGEqTS1zKkEtaSpWKSpTLChmKkktbSp3K2cqeCkqUywobCp3LWQqSS1jKngpKlMsKGgqei1yKkEtbypGKSpTLChlKkEtYSp6K2kqRikqUywobSpiLXUqSS1nKnApKlMsKF8qSS1sKmIrYypwKSpTLChyKk0tbip6K28qTikqUywocyp6LWUqTS1pKk4pKlMsKHUqdy1mKmIrZyp5KSpTLChkKmItXyp3LWMqeSkqUywobipGLXIqVi1oKk4pKlMsKGUqVi1zKkYrYSpOKSpTLChmKnAtdSp4LW0qeSkqUywoXyp4LWQqcCtsKnkpKlMpfW11bHRpcGx5KHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0scz10aGlzLl9fZGF0YVsxXSxhPXRoaXMuX19kYXRhWzJdLGk9dGhpcy5fX2RhdGFbM10scj10aGlzLl9fZGF0YVs0XSxuPXRoaXMuX19kYXRhWzVdLGg9dGhpcy5fX2RhdGFbNl0sbz10aGlzLl9fZGF0YVs3XSxfPXRoaXMuX19kYXRhWzhdLGQ9dGhpcy5fX2RhdGFbOV0sYz10aGlzLl9fZGF0YVsxMF0sdT10aGlzLl9fZGF0YVsxMV0sZj10aGlzLl9fZGF0YVsxMl0sbT10aGlzLl9fZGF0YVsxM10sZz10aGlzLl9fZGF0YVsxNF0seT10aGlzLl9fZGF0YVsxNV0scD10LmFzQXJyYXkoKTtsZXQgYj1wWzBdLHg9cFsxXSx3PXBbMl0sST1wWzNdO2NvbnN0IE49bmV3IGw7cmV0dXJuIE4ubTAwPWIqZSt4KnIrdypfK0kqZixOLm0wMT1iKnMreCpuK3cqZCtJKm0sTi5tMDI9YiphK3gqaCt3KmMrSSpnLE4ubTAzPWIqaSt4Km8rdyp1K0kqeSxiPXBbNF0seD1wWzVdLHc9cFs2XSxJPXBbN10sTi5tMTA9YiplK3gqcit3Kl8rSSpmLE4ubTExPWIqcyt4Km4rdypkK0kqbSxOLm0xMj1iKmEreCpoK3cqYytJKmcsTi5tMTM9YippK3gqbyt3KnUrSSp5LGI9cFs4XSx4PXBbOV0sdz1wWzEwXSxJPXBbMTFdLE4ubTIwPWIqZSt4KnIrdypfK0kqZixOLm0yMT1iKnMreCpuK3cqZCtJKm0sTi5tMjI9YiphK3gqaCt3KmMrSSpnLE4ubTIzPWIqaSt4Km8rdyp1K0kqeSxiPXBbMTJdLHg9cFsxM10sdz1wWzE0XSxJPXBbMTVdLE4ubTMwPWIqZSt4KnIrdypfK0kqZixOLm0zMT1iKnMreCpuK3cqZCtJKm0sTi5tMzI9YiphK3gqaCt3KmMrSSpnLE4ubTMzPWIqaSt4Km8rdyp1K0kqeSxOfW11bHRpcGx5SW5QbGFjZSh0KXtjb25zdCBlPXRoaXMuYXNBcnJheSgpLHM9ZVswXSxhPWVbMV0saT1lWzJdLHI9ZVszXSxuPWVbNF0saD1lWzVdLG89ZVs2XSxfPWVbN10sZD1lWzhdLGw9ZVs5XSxjPWVbMTBdLHU9ZVsxMV0sZj1lWzEyXSxtPWVbMTNdLGc9ZVsxNF0seT1lWzE1XSxwPXQuYXNBcnJheSgpO2xldCBiPXBbMF0seD1wWzFdLHc9cFsyXSxJPXBbM107cmV0dXJuIHRoaXMubTAwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0wMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMDI9YippK3gqbyt3KmMrSSpnLHRoaXMubTAzPWIqcit4Kl8rdyp1K0kqeSxiPXBbNF0seD1wWzVdLHc9cFs2XSxJPXBbN10sdGhpcy5tMTA9YipzK3gqbit3KmQrSSpmLHRoaXMubTExPWIqYSt4KmgrdypsK0kqbSx0aGlzLm0xMj1iKmkreCpvK3cqYytJKmcsdGhpcy5tMTM9YipyK3gqXyt3KnUrSSp5LGI9cFs4XSx4PXBbOV0sdz1wWzEwXSxJPXBbMTFdLHRoaXMubTIwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0yMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMjI9YippK3gqbyt3KmMrSSpnLHRoaXMubTIzPWIqcit4Kl8rdyp1K0kqeSxiPXBbMTJdLHg9cFsxM10sdz1wWzE0XSxJPXBbMTVdLHRoaXMubTMwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0zMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMzI9YippK3gqbyt3KmMrSSpnLHRoaXMubTMzPWIqcit4Kl8rdyp1K0kqeSx0aGlzfXBvc3RtdWx0aXBseUluUGxhY2UodCl7Y29uc3QgZT10LmFzQXJyYXkoKSxzPWVbMF0sYT1lWzFdLGk9ZVsyXSxyPWVbM10sbj1lWzRdLGg9ZVs1XSxvPWVbNl0sXz1lWzddLGQ9ZVs4XSxsPWVbOV0sYz1lWzEwXSx1PWVbMTFdLGY9ZVsxMl0sbT1lWzEzXSxnPWVbMTRdLHk9ZVsxNV0scD10aGlzLmFzQXJyYXkoKTtsZXQgYj1wWzBdLHg9cFsxXSx3PXBbMl0sST1wWzNdO3JldHVybiB0aGlzLm0wMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMDE9YiphK3gqaCt3KmwrSSptLHRoaXMubTAyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0wMz1iKnIreCpfK3cqdStJKnksYj1wWzRdLHg9cFs1XSx3PXBbNl0sST1wWzddLHRoaXMubTEwPWIqcyt4Km4rdypkK0kqZix0aGlzLm0xMT1iKmEreCpoK3cqbCtJKm0sdGhpcy5tMTI9YippK3gqbyt3KmMrSSpnLHRoaXMubTEzPWIqcit4Kl8rdyp1K0kqeSxiPXBbOF0seD1wWzldLHc9cFsxMF0sST1wWzExXSx0aGlzLm0yMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMjE9YiphK3gqaCt3KmwrSSptLHRoaXMubTIyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0yMz1iKnIreCpfK3cqdStJKnksYj1wWzEyXSx4PXBbMTNdLHc9cFsxNF0sST1wWzE1XSx0aGlzLm0zMD1iKnMreCpuK3cqZCtJKmYsdGhpcy5tMzE9YiphK3gqaCt3KmwrSSptLHRoaXMubTMyPWIqaSt4Km8rdypjK0kqZyx0aGlzLm0zMz1iKnIreCpfK3cqdStJKnksdGhpc310cmFuc2xhdGVJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGEscz10LngsYT10LnksaT10Lno7cmV0dXJuIGVbMTJdPWVbMF0qcytlWzRdKmErZVs4XSppK2VbMTJdLGVbMTNdPWVbMV0qcytlWzVdKmErZVs5XSppK2VbMTNdLGVbMTRdPWVbMl0qcytlWzZdKmErZVsxMF0qaStlWzE0XSxlWzE1XT1lWzNdKnMrZVs3XSphK2VbMTFdKmkrZVsxNV0sdGhpc31zZXRMb29rQXQodCxlLHMpe2NvbnN0IGE9dC5zdWJ0cmFjdChlKSxpPWEubGVuZ3RoKCk7aWYoaTxOdW1iZXIuRVBTSUxPTilyZXR1cm4gdm9pZCB0aGlzLnNldElkZW50aXR5KCk7YS5zY2FsZUluUGxhY2UoMS9pKTtjb25zdCByPXMuY3Jvc3MoYSksbj1yLmxlbmd0aCgpO24+TnVtYmVyLkVQU0lMT04mJnIuc2NhbGVJblBsYWNlKDEvbik7Y29uc3QgaD1hLmNyb3NzKHIpLG89aC5sZW5ndGgoKTtvPk51bWJlci5FUFNJTE9OJiZoLnNjYWxlSW5QbGFjZSgxL28pLHRoaXMuc2V0KHIueCxyLnksci56LDAsaC54LGgueSxoLnosMCxhLngsYS55LGEueiwwLHQueCx0LnksdC56LDEpfXNldFJvdGF0aW9uKHQsZSl7Y29uc3Qgcz10Lmxlbmd0aCgpO2lmKE1hdGguYWJzKHMpPE51bWJlci5FUFNJTE9OKXJldHVybiBudWxsO2NvbnN0IGE9dC54L3MsaT10LnkvcyxyPXQuei9zLG49TWF0aC5zaW4oZSksaD1NYXRoLmNvcyhlKSxvPTEtaCxfPXRoaXMuX19kYXRhO3JldHVybiBfWzBdPWEqYSpvK2gsX1sxXT1pKmEqbytyKm4sX1syXT1yKmEqby1pKm4sX1szXT0wLF9bNF09YSppKm8tcipuLF9bNV09aSppKm8raCxfWzZdPXIqaSpvK2EqbixfWzddPTAsX1s4XT1hKnIqbytpKm4sX1s5XT1pKnIqby1hKm4sX1sxMF09cipyKm8raCxfWzExXT0wLF9bMTJdPTAsX1sxM109MCxfWzE0XT0wLF9bMTVdPTEsdGhpc31zZXRYUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09MSxhWzFdPTAsYVsyXT0wLGFbM109MCxhWzRdPTAsYVs1XT1zLGFbNl09ZSxhWzddPTAsYVs4XT0wLGFbOV09LWUsYVsxMF09cyxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc31zZXRZUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09cyxhWzFdPTAsYVsyXT0tZSxhWzNdPTAsYVs0XT0wLGFbNV09MSxhWzZdPTAsYVs3XT0wLGFbOF09ZSxhWzldPTAsYVsxMF09cyxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc31zZXRaUm90YXRpb24odCl7Y29uc3QgZT1NYXRoLnNpbih0KSxzPU1hdGguY29zKHQpLGE9dGhpcy5fX2RhdGE7cmV0dXJuIGFbMF09cyxhWzFdPWUsYVsyXT0wLGFbM109MCxhWzRdPS1lLGFbNV09cyxhWzZdPTAsYVs3XT0wLGFbOF09MCxhWzldPTAsYVsxMF09MSxhWzExXT0wLGFbMTJdPTAsYVsxM109MCxhWzE0XT0wLGFbMTVdPTEsdGhpc310cmFuc2Zvcm1WZWM0KHQpe2NvbnN0IGU9dGhpcy5fX2RhdGEscz10LngsYT10LnksaT10Lnoscj10LnQ7cmV0dXJuIG5ldyBWZWM0KGVbMF0qcytlWzRdKmErZVs4XSppK2VbMTJdKnIsZVsxXSpzK2VbNV0qYStlWzldKmkrZVsxM10qcixlWzJdKnMrZVs2XSphK2VbMTBdKmkrZVsxNF0qcixlWzNdKnMrZVs3XSphK2VbMTFdKmkrZVsxNV0qcil9dHJhbnNmb3JtVmVjMyh0KXtjb25zdCBlPXRoaXMuX19kYXRhLHM9dC54LGE9dC55LGk9dC56O3JldHVybiBuZXcgcihlWzBdKnMrZVs0XSphK2VbOF0qaStlWzEyXSxlWzFdKnMrZVs1XSphK2VbOV0qaStlWzEzXSxlWzJdKnMrZVs2XSphK2VbMTBdKmkrZVsxNF0pfXJvdGF0ZVZlYzModCl7Y29uc3QgZT10aGlzLl9fZGF0YSxzPXQueCxhPXQueSxpPXQuejtyZXR1cm4gbmV3IHIoZVswXSpzK2VbNF0qYStlWzhdKmksZVsxXSpzK2VbNV0qYStlWzldKmksZVsyXSpzK2VbNl0qYStlWzEwXSppKX1zZXRQZXJzcGVjdGl2ZU1hdHJpeCh0LGUscyxhKXtjb25zdCBpPU1hdGgudGFuKC41Kk1hdGguUEktLjUqdCkscj0xLyhzLWEpO3RoaXMuc2V0KGkvZSwwLDAsMCwwLGksMCwwLDAsMCwocythKSpyLC0xLDAsMCxzKmEqcioyLDApfXNldE9ydGhvZ3JhcGhpY01hdHJpeCh0LGUscyxhLGkscil7Y29uc3Qgbj0xLyh0LWUpLGg9MS8ocy1hKSxvPTEvKGktcik7dGhpcy5zZXQoLTIqbiwwLDAsMCwwLC0yKmgsMCwwLDAsMCwyKm8sMCwodCtlKSpuLChhK3MpKmgsKHIraSkqbywxKX1zZXRTY2FsZSh0LGUscyl7dCBpbnN0YW5jZW9mIHI/dGhpcy5zZXQodC54LDAsMCwwLDAsdC55LDAsMCwwLDAsdC56LDAsMCwwLDAsMSk6dGhpcy5zZXQodCwwLDAsMCwwLGUsMCwwLDAsMCxzLDAsMCwwLDAsMSl9c2V0RnJvbU1hdDN4NEFycmF5KHQpe3RoaXMuc2V0KHRbMF0sdFsxXSx0WzJdLDAsdFszXSx0WzRdLHRbNV0sMCx0WzZdLHRbN10sdFs4XSwwLHRbOV0sdFsxMF0sdFsxMV0sMSl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IGwodCw0KmUpfWNsb25lKCl7cmV0dXJuIG5ldyBsKHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdLHRoaXMuX19kYXRhWzRdLHRoaXMuX19kYXRhWzVdLHRoaXMuX19kYXRhWzZdLHRoaXMuX19kYXRhWzddLHRoaXMuX19kYXRhWzhdLHRoaXMuX19kYXRhWzldLHRoaXMuX19kYXRhWzEwXSx0aGlzLl9fZGF0YVsxMV0sdGhpcy5fX2RhdGFbMTJdLHRoaXMuX19kYXRhWzEzXSx0aGlzLl9fZGF0YVsxNF0sdGhpcy5fX2RhdGFbMTVdKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgbCguLi50KX10b0pTT04oKXtyZXR1cm4gdGhpcy5fX2RhdGF9ZnJvbUpTT04odCl7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheSh0KX19YS5yZWdpc3RlclR5cGUoIk1hdDQiLGwpO2NsYXNzIHUgZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLGE9MSl7aWYoc3VwZXIoKSx0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe2NvbnN0IHM9dCxhPWU7dGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShzLGEsNCl9ZWxzZSBpZih0aGlzLl9fZGF0YT1uZXcgRmxvYXQzMkFycmF5KDQpLCJvYmplY3QiPT10eXBlb2YgdCl7dGhpcy5fX2RhdGFbMF09MCx0aGlzLl9fZGF0YVsxXT0wLHRoaXMuX19kYXRhWzJdPTAsdGhpcy5fX2RhdGFbM109MTtmb3IoY29uc3QgZSBpbiB0KUFycmF5LmlzQXJyYXkodFtlXSk/dGhpc1tlXS5jYWxsKHRoaXMsLi4udFtlXSk6dGhpc1tlXS5jYWxsKHRoaXMsdFtlXSl9ZWxzZSB0aGlzLl9fZGF0YVswXT10LHRoaXMuX19kYXRhWzFdPWUsdGhpcy5fX2RhdGFbMl09cyx0aGlzLl9fZGF0YVszXT1hfWdldCB4KCl7cmV0dXJuIHRoaXMuX19kYXRhWzBdfXNldCB4KHQpe3RoaXMuX19kYXRhWzBdPXR9Z2V0IHkoKXtyZXR1cm4gdGhpcy5fX2RhdGFbMV19c2V0IHkodCl7dGhpcy5fX2RhdGFbMV09dH1nZXQgeigpe3JldHVybiB0aGlzLl9fZGF0YVsyXX1zZXQgeih0KXt0aGlzLl9fZGF0YVsyXT10fWdldCB3KCl7cmV0dXJuIHRoaXMuX19kYXRhWzNdfXNldCB3KHQpe3RoaXMuX19kYXRhWzNdPXR9c2V0KHQsZSxzLGEpe3RoaXMuX19kYXRhWzBdPXQsdGhpcy5fX2RhdGFbMV09ZSx0aGlzLl9fZGF0YVsyXT1zLHRoaXMuX19kYXRhWzNdPWF9c2V0RGF0YUFycmF5KHQpe3RoaXMuX19kYXRhPXR9c2V0RnJvbU90aGVyKHQpe3RoaXMuX19kYXRhWzBdPXQueCx0aGlzLl9fZGF0YVsxXT10LnksdGhpcy5fX2RhdGFbMl09dC56LHRoaXMuX19kYXRhWzNdPXQud31zZXRGcm9tRXVsZXJBbmdsZXModCl7Y29uc3QgZT1uZXcgcjtzd2l0Y2godC5vcmRlcil7Y2FzZSAwOmUuc2V0KHQueCwtdC55LHQueik7YnJlYWs7Y2FzZSAxOmUuc2V0KHQueSwtdC56LHQueCk7YnJlYWs7Y2FzZSAyOmUuc2V0KHQueiwtdC54LHQueSk7YnJlYWs7Y2FzZSAzOmUuc2V0KHQueCx0LnosdC55KTticmVhaztjYXNlIDQ6ZS5zZXQodC56LHQueSx0LngpO2JyZWFrO2Nhc2UgNTplLnNldCh0LnksdC54LHQueik7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoInNkcnR5Iil9Y29uc3Qgcz0uNSplLngsYT0uNSplLnksaT0uNSplLnosbj1NYXRoLmNvcyhzKSxoPU1hdGguY29zKGEpLG89TWF0aC5jb3MoaSksXz1NYXRoLnNpbihzKSxkPU1hdGguc2luKGEpLGw9TWF0aC5zaW4oaSksYz1uKm8sdT1uKmwsZj1fKm8sbT1fKmwsZz1oKmYtZCp1LHk9aCptK2QqYyxwPWgqdS1kKmY7c3dpdGNoKHRoaXMudz1oKmMrZCptLHQub3JkZXIpe2Nhc2UgMDp0aGlzLng9Zyx0aGlzLnk9LXksdGhpcy56PXA7YnJlYWs7Y2FzZSAxOnRoaXMueD1wLHRoaXMueT1nLHRoaXMuej0teTticmVhaztjYXNlIDI6dGhpcy54PS15LHRoaXMueT1wLHRoaXMuej1nO2JyZWFrO2Nhc2UgMzp0aGlzLng9Zyx0aGlzLnk9cCx0aGlzLno9eTticmVhaztjYXNlIDQ6dGhpcy54PXAsdGhpcy55PXksdGhpcy56PWc7YnJlYWs7Y2FzZSA1OnRoaXMueD15LHRoaXMueT1nLHRoaXMuej1wO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJzZHJ0eSIpfX10b0V1bGVyQW5nbGVzKHQpe2NvbnN0IGU9bmV3IHI7c3dpdGNoKHQpe2Nhc2UgMDplLnNldCh0aGlzLnosdGhpcy54LHRoaXMueSk7YnJlYWs7Y2FzZSAxOmUuc2V0KHRoaXMueCx0aGlzLnksdGhpcy56KTticmVhaztjYXNlIDI6ZS5zZXQodGhpcy55LHRoaXMueix0aGlzLngpO2JyZWFrO2Nhc2UgMzplLnNldCh0aGlzLnksLXRoaXMueCx0aGlzLnopO2JyZWFrO2Nhc2UgNDplLnNldCh0aGlzLngsLXRoaXMueix0aGlzLnkpO2JyZWFrO2Nhc2UgNTplLnNldCh0aGlzLnosLXRoaXMueSx0aGlzLngpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJvdGF0aW9uIG9yZGVyOiIrdCl9Y29uc3Qgcz1uZXcgcixhPWUueCplLnkrZS56KnRoaXMudztpZihhPi40OTk5OSlzLnk9MipNYXRoLmF0YW4yKGUueCx0aGlzLncpLHMuej0uNSpNYXRoLlBJLHMueD0wO2Vsc2UgaWYoYTwtLjQ5OTk5KXMueT0tMipNYXRoLmF0YW4yKGUueCx0aGlzLncpLHMuej0tLjUqTWF0aC5QSSxzLng9MDtlbHNle2NvbnN0IHQ9ZS54KmUueCxpPWUueSplLnkscj1lLnoqZS56O3MueT1NYXRoLmF0YW4yKDIqZS55KnRoaXMudy0yKmUueCplLnosMS0yKmktMipyKSxzLno9TWF0aC5hc2luKDIqYSkscy54PU1hdGguYXRhbjIoMiplLngqdGhpcy53LTIqZS55KmUueiwxLTIqdC0yKnIpfXN3aXRjaCh0KXtjYXNlIDA6cmV0dXJuIG5ldyBfKHMueSxzLnoscy54LHQpO2Nhc2UgMTpyZXR1cm4gbmV3IF8ocy54LHMueSxzLnosdCk7Y2FzZSAyOnJldHVybiBuZXcgXyhzLnoscy54LHMueSx0KTtjYXNlIDM6cmV0dXJuIG5ldyBfKC1zLnkscy54LHMueix0KTtjYXNlIDQ6cmV0dXJuIG5ldyBfKHMueCxzLnosLXMueSx0KTtjYXNlIDU6cmV0dXJuIG5ldyBfKHMueiwtcy55LHMueCx0KX19c2V0RnJvbUF4aXNBbmRBbmdsZSh0LGUpe2NvbnN0IHM9ZS8yLGE9dC5ub3JtYWxpemUoKS5zY2FsZShNYXRoLnNpbihzKSk7dGhpcy5zZXQoYS54LGEueSxhLnosTWF0aC5jb3MocykpfXNldEZyb21EaXJlY3Rpb25BbmRVcHZlY3Rvcih0LGUpe2NvbnN0IHM9bmV3IGQ7cy5zZXRGcm9tRGlyZWN0aW9uQW5kVXB2ZWN0b3IodCxlKSx0aGlzLnNldEZyb21NYXQzKHMpfXNldEZyb20yVmVjdG9ycyh0LGUpe3Qubm9ybWFsaXplKCksZS5ub3JtYWxpemUoKTtjb25zdCBzPXQuY3Jvc3MoZSksYT10LmRvdChlKSxpPU1hdGguc3FydCgyKigxK2EpKTt0aGlzLnNldChzLngvaSxzLnkvaSxzLnovaSxpLzIpLHRoaXMubm9ybWFsaXplSW5QbGFjZSgpfXNldEZyb21NYXQzKHQpe2NvbnN0IGU9dC5fX2RhdGFbMF0rdC5fX2RhdGFbNF0rdC5fX2RhdGFbOF07bGV0IHM7aWYoZT4wKXM9TWF0aC5zcXJ0KGUrMSksdGhpcy5fX2RhdGFbM109LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbMF09KHQuX19kYXRhWzVdLXQuX19kYXRhWzddKSpzLHRoaXMuX19kYXRhWzFdPSh0Ll9fZGF0YVs2XS10Ll9fZGF0YVsyXSkqcyx0aGlzLl9fZGF0YVsyXT0odC5fX2RhdGFbMV0tdC5fX2RhdGFbM10pKnM7ZWxzZXtsZXQgZT0wO3QuX19kYXRhWzRdPnQuX19kYXRhWzBdJiYoZT0xKSx0Ll9fZGF0YVs4XT50Ll9fZGF0YVszKmUrZV0mJihlPTIpO2NvbnN0IGE9KGUrMSklMyxpPShlKzIpJTM7cz1NYXRoLnNxcnQodC5fX2RhdGFbMyplK2VdLXQuX19kYXRhWzMqYSthXS10Ll9fZGF0YVszKmkraV0rMSksdGhpcy5fX2RhdGFbZV09LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbM109KHQuX19kYXRhWzMqYStpXS10Ll9fZGF0YVszKmkrYV0pKnMsdGhpcy5fX2RhdGFbYV09KHQuX19kYXRhWzMqYStlXSt0Ll9fZGF0YVszKmUrYV0pKnMsdGhpcy5fX2RhdGFbaV09KHQuX19kYXRhWzMqaStlXSt0Ll9fZGF0YVszKmUraV0pKnN9dGhpcy5ub3JtYWxpemVJblBsYWNlKCl9c2V0RnJvbU1hdDQodCl7Y29uc3QgZT10Ll9fZGF0YVswXSt0Ll9fZGF0YVs1XSt0Ll9fZGF0YVsxMF07bGV0IHM7aWYoZT4wKXM9TWF0aC5zcXJ0KGUrMSksdGhpcy5fX2RhdGFbM109LjUqcyxzPS41L3MsdGhpcy5fX2RhdGFbMF09KHQuX19kYXRhWzZdLXQuX19kYXRhWzldKSpzLHRoaXMuX19kYXRhWzFdPSh0Ll9fZGF0YVs4XS10Ll9fZGF0YVsyXSkqcyx0aGlzLl9fZGF0YVsyXT0odC5fX2RhdGFbMV0tdC5fX2RhdGFbNF0pKnM7ZWxzZXtsZXQgZT0wO3QuX19kYXRhWzVdPnQuX19kYXRhWzBdJiYoZT0xKSx0Ll9fZGF0YVsxMF0+dC5fX2RhdGFbNCplK2VdJiYoZT0yKTtjb25zdCBhPShlKzEpJTMsaT0oZSsyKSUzO3M9TWF0aC5zcXJ0KHQuX19kYXRhWzQqZStlXS10Ll9fZGF0YVs0KmErYV0tdC5fX2RhdGFbNCppK2ldKzEpLHRoaXMuX19kYXRhW2VdPS41KnMscz0uNS9zLHRoaXMuX19kYXRhWzNdPSh0Ll9fZGF0YVs0KmEraV0tdC5fX2RhdGFbNCppK2FdKSpzLHRoaXMuX19kYXRhW2FdPSh0Ll9fZGF0YVs0KmErZV0rdC5fX2RhdGFbNCplK2FdKSpzLHRoaXMuX19kYXRhW2ldPSh0Ll9fZGF0YVs0KmkrZV0rdC5fX2RhdGFbNCplK2ldKSpzfXRoaXMubm9ybWFsaXplSW5QbGFjZSgpfWlzSWRlbnRpdHkoKXtyZXR1cm4gdGhpcy5nZXRBbmdsZSgpPE51bWJlci5FUFNJTE9OfWdldEFuZ2xlKCl7cmV0dXJuIDIqTWF0aC5hY29zKHRoaXMudyl9ZXF1YWwodCl7cmV0dXJuIHRoaXMueD09dC54JiZ0aGlzLnk9PXQueSYmdGhpcy56PT10LnomJnRoaXMudz09dC53fW5vdGVxdWFscyh0KXtyZXR1cm4gdGhpcy54IT10LngmJnRoaXMueSE9dC55JiZ0aGlzLnohPXQueiYmdGhpcy53IT10Lnd9YXBwcm94RXF1YWwodCxlPU51bWJlci5FUFNJTE9OKXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCk8ZSYmTWF0aC5hYnModGhpcy55LXQueSk8ZSYmTWF0aC5hYnModGhpcy56LXQueik8ZSYmTWF0aC5hYnModGhpcy53LXQudyk8ZX1hZGQodCl7cmV0dXJuIG5ldyB1KHRoaXMueCt0LngsdGhpcy55K3QueSx0aGlzLnordC56LHRoaXMudyt0LncpfWFkZEluUGxhY2UodCl7dGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy53Kz10Lnd9c3VidHJhY3QodCl7cmV0dXJuIG5ldyB1KHRoaXMueC10LngsdGhpcy55LXQueSx0aGlzLnotdC56LHRoaXMudy10LncpfXNjYWxlKHQpe3JldHVybiBuZXcgdSh0aGlzLngqdCx0aGlzLnkqdCx0aGlzLnoqdCx0aGlzLncqdCl9c2NhbGVJblBsYWNlKHQpe3RoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10LHRoaXMudyo9dH1sZW5ndGgoKXtjb25zdCB0PXRoaXMuX19kYXRhWzBdLGU9dGhpcy5fX2RhdGFbMV0scz10aGlzLl9fZGF0YVsyXSxhPXRoaXMuX19kYXRhWzNdO3JldHVybiBNYXRoLnNxcnQodCp0K2UqZStzKnMrYSphKX1sZW5ndGhTcXVhcmVkKCl7Y29uc3QgdD10aGlzLl9fZGF0YVswXSxlPXRoaXMuX19kYXRhWzFdLHM9dGhpcy5fX2RhdGFbMl0sYT10aGlzLl9fZGF0YVszXTtyZXR1cm4gdCp0K2UqZStzKnMrYSphfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107bGV0IGk9dCp0K2UqZStzKnMrYSphO3JldHVybiBpPE51bWJlci5FUFNJTE9OP25ldyB1OihpPTEvTWF0aC5zcXJ0KGkpLG5ldyB1KHQqaSxlKmkscyppKSl9bm9ybWFsaXplSW5QbGFjZSgpe2NvbnN0IHQ9dGhpcy5fX2RhdGFbMF0sZT10aGlzLl9fZGF0YVsxXSxzPXRoaXMuX19kYXRhWzJdLGE9dGhpcy5fX2RhdGFbM107bGV0IGk9dCp0K2UqZStzKnMrYSphO2k8TnVtYmVyLkVQU0lMT058fChpPTEvTWF0aC5zcXJ0KGkpLHRoaXMuc2V0KHQqaSxlKmkscyppLGEqaSkpfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55K3RoaXMueip0LnordGhpcy53KnQud31jcm9zcyh0KXtjb25zdCBlPXRoaXMueCxzPXRoaXMueSxhPXRoaXMueixpPXRoaXMudyxyPXQueCxuPXQueSxoPXQueixvPXQudztyZXR1cm4gbmV3IHUocypoLWEqbixhKm8taSpoLGkqci1lKm8sZSpuLXMqcil9Y29uanVnYXRlKCl7cmV0dXJuIG5ldyB1KC10aGlzLngsLXRoaXMueSwtdGhpcy56LHRoaXMudyl9aW52ZXJzZSgpe3JldHVybiB0aGlzLmNvbmp1Z2F0ZSgpfWFsaWduV2l0aCh0KXt0aGlzLmRvdCh0KTwwJiZ0aGlzLnNldCgtdGhpcy54LC10aGlzLnksLXRoaXMueiwtdGhpcy53KX1tdWx0aXBseSh0KXtjb25zdCBlPXRoaXMuX19kYXRhWzBdLHM9dGhpcy5fX2RhdGFbMV0sYT10aGlzLl9fZGF0YVsyXSxpPXRoaXMuX19kYXRhWzNdLHI9dC5fX2RhdGFbMF0sbj10Ll9fZGF0YVsxXSxoPXQuX19kYXRhWzJdLG89dC5fX2RhdGFbM107cmV0dXJuIG5ldyB1KGUqbytpKnIrcypoLWEqbixzKm8raSpuK2Eqci1lKmgsYSpvK2kqaCtlKm4tcypyLGkqby1lKnItcypuLWEqaCl9bXVsdGlwbHlJblBsYWNlKHQpe2NvbnN0IGU9dGhpcy5fX2RhdGFbMF0scz10aGlzLl9fZGF0YVsxXSxhPXRoaXMuX19kYXRhWzJdLGk9dGhpcy5fX2RhdGFbM10scj10Ll9fZGF0YVswXSxuPXQuX19kYXRhWzFdLGg9dC5fX2RhdGFbMl0sbz10Ll9fZGF0YVszXTt0aGlzLnNldChlKm8raSpyK3MqaC1hKm4scypvK2kqbithKnItZSpoLGEqbytpKmgrZSpuLXMqcixpKm8tZSpyLXMqbi1hKmgpfXJvdGF0ZVZlYzModCl7Y29uc3QgZT1uZXcgdSh0LngsdC55LHQueiwwKSxzPXRoaXMubXVsdGlwbHkoZSkubXVsdGlwbHkodGhpcy5jb25qdWdhdGUoKSk7cmV0dXJuIG5ldyByKHMueCxzLnkscy56KX1yb3RhdGVYKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuK2kqcix0aGlzLnk9cypuK2Eqcix0aGlzLno9YSpuLXMqcix0aGlzLnc9aSpuLWUqcn1yb3RhdGVZKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuLWEqcix0aGlzLnk9cypuK2kqcix0aGlzLno9YSpuK2Uqcix0aGlzLnc9aSpuLXMqcn1yb3RhdGVaKHQpe3QqPS41O2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LGE9dGhpcy56LGk9dGhpcy53LHI9TWF0aC5zaW4odCksbj1NYXRoLmNvcyh0KTt0aGlzLng9ZSpuK3Mqcix0aGlzLnk9cypuLWUqcix0aGlzLno9YSpuK2kqcix0aGlzLnc9aSpuLWEqcn10b01hdDMoKXtjb25zdCB0PXRoaXMueCxlPXRoaXMueSxzPXRoaXMueixhPXRoaXMudyxpPXQrdCxyPWUrZSxuPXMrcyxoPXQqaSxvPWUqaSxfPWUqcixsPXMqaSxjPXMqcix1PXMqbixmPWEqaSxtPWEqcixnPWEqbix5PW5ldyBkO3JldHVybiB5Ll9fZGF0YVswXT0xLV8tdSx5Ll9fZGF0YVszXT1vLWcseS5fX2RhdGFbNl09bCttLHkuX19kYXRhWzFdPW8rZyx5Ll9fZGF0YVs0XT0xLWgtdSx5Ll9fZGF0YVs3XT1jLWYseS5fX2RhdGFbMl09bC1tLHkuX19kYXRhWzVdPWMrZix5Ll9fZGF0YVs4XT0xLWgtXyx5fWdldFhheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy55LGU9dGhpcy54KnRoaXMueixzPXRoaXMueSp0aGlzLnksYT10aGlzLnkqdGhpcy53LGk9dGhpcy56KnRoaXMueixuPXRoaXMueip0aGlzLnc7cmV0dXJuIG5ldyByKDEtMiooaStzKSwyKih0K24pLDIqKGUtYSkpfWdldFlheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy54LGU9dGhpcy54KnRoaXMueSxzPXRoaXMueCp0aGlzLncsYT10aGlzLnkqdGhpcy56LGk9dGhpcy56KnRoaXMueixuPXRoaXMueip0aGlzLnc7cmV0dXJuIG5ldyByKDIqKGUtbiksMS0yKihpK3QpLDIqKGErcykpfWdldFpheGlzKCl7Y29uc3QgdD10aGlzLngqdGhpcy54LGU9dGhpcy54KnRoaXMueixzPXRoaXMueCp0aGlzLncsYT10aGlzLnkqdGhpcy55LGk9dGhpcy55KnRoaXMueixuPXRoaXMueSp0aGlzLnc7bmV3IHI7cmV0dXJuIG5ldyByKDIqKG4rZSksMiooaS1zKSwxLTIqKGErdCkpfW1pcnJvcih0KXtzd2l0Y2godCl7Y2FzZSAwOnJldHVybiBuZXcgdSh0aGlzLnosdGhpcy53LHRoaXMueCx0aGlzLnkpO2Nhc2UgMTpyZXR1cm4gbmV3IHUoLXRoaXMudyx0aGlzLnosdGhpcy55LC10aGlzLngpO2Nhc2UgMjpyZXR1cm4gbmV3IHUodGhpcy54LHRoaXMueSx0aGlzLnosLXRoaXMudyl9fXRvTWF0NCgpe2NvbnN0IHQ9dGhpcy54LGU9dGhpcy55LHM9dGhpcy56LGE9dGhpcy53LGk9dCt0LHI9ZStlLG49cytzLGg9dCppLG89ZSppLF89ZSpyLGQ9cyppLGM9cypyLHU9cypuLGY9YSppLG09YSpyLGc9YSpuLHk9bmV3IGw7cmV0dXJuIHkuX19kYXRhWzBdPTEtXy11LHkuX19kYXRhWzRdPW8tZyx5Ll9fZGF0YVs4XT1kK20seS5fX2RhdGFbMV09bytnLHkuX19kYXRhWzVdPTEtaC11LHkuX19kYXRhWzldPWMtZix5Ll9fZGF0YVsyXT1kLW0seS5fX2RhdGFbNl09YytmLHkuX19kYXRhWzEwXT0xLWgtXyx5fWxlcnAodCxlKXtjb25zdCBzPW5ldyB1KHRoaXMueCtlKih0LngtdGhpcy54KSx0aGlzLnkrZSoodC55LXRoaXMueSksdGhpcy56K2UqKHQuei10aGlzLnopLHRoaXMudytlKih0LnctdGhpcy53KSk7cmV0dXJuIHMubm9ybWFsaXplSW5QbGFjZSgpLHN9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IHUoLi4udCl9c3RhdGljIGNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHQsZT0wKXtyZXR1cm4gbmV3IHUodCw0KmUpfXN0YXRpYyBudW1FbGVtZW50cygpe3JldHVybiA0fWNsb25lKCl7cmV0dXJuIG5ldyB1KHRoaXMuX19kYXRhWzBdLHRoaXMuX19kYXRhWzFdLHRoaXMuX19kYXRhWzJdLHRoaXMuX19kYXRhWzNdKX10b0pTT04oKXtyZXR1cm57eDp0aGlzLngseTp0aGlzLnksejp0aGlzLnosdzp0aGlzLnd9fWZyb21KU09OKHQpe3RoaXMuX19kYXRhWzBdPXQueCx0aGlzLl9fZGF0YVsxXT10LnksdGhpcy5fX2RhdGFbMl09dC56LHRoaXMuX19kYXRhWzNdPXQudyx0aGlzLm5vcm1hbGl6ZUluUGxhY2UoKX19YS5yZWdpc3RlclR5cGUoIlF1YXQiLHUpO2NsYXNzIGZ7Y29uc3RydWN0b3IodCxlKXt0aGlzLnN0YXJ0PXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIsdGhpcy5kaXI9ZSBpbnN0YW5jZW9mIHI/ZTpuZXcgcn1jbG9zZXN0UG9pbnQodCl7Y29uc3QgZT10LnN1YnRyYWN0KHRoaXMuc3RhcnQpLmRvdCh0aGlzLmRpcik7aWYoZTxOdW1iZXIuRVBTSUxPTilyZXR1cm4gdGhpcy5zdGFydDtjb25zdCBzPWUvdGhpcy5kaXIuZG90KHRoaXMuZGlyKTtyZXR1cm4gdGhpcy5zdGFydC5hZGQodGhpcy5kaXIuc2NhbGUocykpfXBvaW50QXREaXN0KHQpe3JldHVybiB0aGlzLnN0YXJ0LmFkZCh0aGlzLmRpci5zY2FsZSh0KSl9aW50ZXJzZWN0UmF5VmVjdG9yKHQpe2NvbnN0IGU9dGhpcy5kaXIscz10LmRpcixhPXRoaXMuc3RhcnQuc3VidHJhY3QodC5zdGFydCksaT1lLmRvdChlKSxyPWUuZG90KHMpLG49cy5kb3QocyksaD1lLmRvdChhKSxvPXMuZG90KGEpO2lmKDA9PWkmJjA9PW4pcmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUbyh0LnN0YXJ0KTtpZigwPT1pKXJldHVybiB0LmNsb3Nlc3RQb2ludCh0aGlzLnN0YXJ0KTtpZigwPT1uKXJldHVybiB0aGlzLmNsb3Nlc3RQb2ludCh0LnN0YXJ0KTtjb25zdCBfPWkqbi1yKnI7bGV0IGQsbDtyZXR1cm4gXzwuMDAxPyhkPTAsbD1yPm4/aC9yOm8vbik6KGQ9KHIqby1uKmgpL18sbD0oaSpvLXIqaCkvXyksW2QsbF19aW50ZXJzZWN0UmF5UGxhbmUodCl7Y29uc3QgZT10aGlzLnN0YXJ0LnN1YnRyYWN0KHQuc3RhcnQpLHM9dC5kaXIuZG90KHRoaXMuZGlyKSxhPS10LmRpci5kb3QoZSk7aWYoTWF0aC5hYnMocyk8TnVtYmVyLlBSRUNJU0lPTilyZXR1cm4tMTtjb25zdCBpPWEvcztyZXR1cm4gaTwtTnVtYmVyLlBSRUNJU0lPTj8tMTppfWNsb25lKCl7cmV0dXJuIG5ldyBmKHRoaXMuc3RhcnQuY2xvbmUoKSx0aGlzLmRpci5jbG9uZSgpKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgZiguLi50KX10b0pTT04oKXtyZXR1cm57c3RhcnQ6dGhpcy5zdGFydCxkaXI6dGhpcy5kaXJ9fWZyb21KU09OKHQpe3RoaXMuc3RhcnQuZnJvbUpTT04odC5zdGFydCksdGhpcy5kaXIuZnJvbUpTT04odC5kaXIpfXRvU3RyaW5nKCl7cmV0dXJuIGUodGhpcy50b0pTT04oKSl9fWEucmVnaXN0ZXJUeXBlKCJSYXkiLGYpO25ldyByKDEsMSwxKTtjbGFzcyBte2NvbnN0cnVjdG9yKHQsZSxzKXtpZih0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KXRoaXMuc2V0RnJvbUZsb2F0MzJBcnJheSh0KTtlbHNle2lmKHQgaW5zdGFuY2VvZiByKXRoaXMudHI9dDtlbHNle2lmKHQgaW5zdGFuY2VvZiB1JiZudWxsPT1lJiZudWxsPT1zKXJldHVybiB0aGlzLnRyPW5ldyByLHRoaXMub3JpPXQsdm9pZCh0aGlzLnNjPW5ldyByKDEsMSwxKSk7dGhpcy50cj1uZXcgcn10aGlzLm9yaT1lIGluc3RhbmNlb2YgdT9lOm5ldyB1LHRoaXMuc2M9cyBpbnN0YW5jZW9mIHI/czpuZXcgcigxLDEsMSl9fXNldCh0LGUscyl7dGhpcy50cj10LHRoaXMub3JpPWUscyBpbnN0YW5jZW9mIHImJih0aGlzLnNjPXMpfXNldEZyb21PdGhlcih0KXt0aGlzLnRyPXQudHIsdGhpcy5vcmk9dC5vcmksdGhpcy5zYz10LnNjfWlzSWRlbnRpdHkoKXtyZXR1cm4gdGhpcy50ci5pc051bGwoKSYmdGhpcy5vcmkuaXNJZGVudGl0eSgpJiZ0aGlzLnNjLmlzMTExKCl9c2V0TG9va0F0KHQsZSxzKXtjb25zdCBhPXQuc3VidHJhY3QoZSk7aWYoYS5sZW5ndGgoKTxOdW1iZXIuRVBTSUxPTil0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZGlyIik7dGhpcy5vcmkuc2V0RnJvbURpcmVjdGlvbkFuZFVwdmVjdG9yKGEscyksdGhpcy50cj10fW11bHRpcGx5KHQpe2xldCBlPXRoaXMuc2M7cmV0dXJuIHRoaXMuc2MueD09dGhpcy5zYy55JiZ0aGlzLnNjLng9PXRoaXMuc2Muenx8KGU9dC5vcmkucm90YXRlVmVjMyh0aGlzLnNjKSxNYXRoLnNpZ24oZS54KSE9TWF0aC5zaWduKHRoaXMuc2MueCkmJihlLng9LWUueCksTWF0aC5zaWduKGUueSkhPU1hdGguc2lnbih0aGlzLnNjLnkpJiYoZS55PS1lLnkpLE1hdGguc2lnbihlLnopIT1NYXRoLnNpZ24odGhpcy5zYy56KSYmKGUuej0tZS56KSksbmV3IG0odGhpcy50ci5hZGQodGhpcy5vcmkucm90YXRlVmVjMyhlLm11bHRpcGx5KHQudHIpKSksdGhpcy5vcmkubXVsdGlwbHkodC5vcmkpLGUubXVsdGlwbHkodC5zYykpfWludmVyc2UoKXtjb25zdCB0PW5ldyBtO3JldHVybiB0Lm9yaT10aGlzLm9yaS5pbnZlcnNlKCksdGhpcy5zYy54IT10aGlzLnNjLnl8fHRoaXMuc2MueCE9dGhpcy5zYy56Pyh0LnNjPXQub3JpLnJvdGF0ZVZlYzModGhpcy5zYyksTWF0aC5zaWduKHQuc2MueCkhPU1hdGguc2lnbih0aGlzLnNjLngpJiYodC5zYy54PS10LnNjLngpLE1hdGguc2lnbih0LnNjLnkpIT1NYXRoLnNpZ24odGhpcy5zYy55KSYmKHQuc2MueT0tdC5zYy55KSxNYXRoLnNpZ24odC5zYy56KSE9TWF0aC5zaWduKHRoaXMuc2MueikmJih0LnNjLno9LXQuc2MueikpOnQuc2M9dGhpcy5zYy5pbnZlcnNlKCksdC50cj10Lm9yaS5yb3RhdGVWZWMzKHRoaXMudHIubmVnYXRlKCkubXVsdGlwbHkodC5zYykpLHR9dHJhbnNmb3JtVmVjMyh0KXtyZXR1cm4gdGhpcy50ci5hZGQodGhpcy5vcmkucm90YXRlVmVjMyh0aGlzLnNjLm11bHRpcGx5KHQpKSl9dG9NYXQ0KCl7Y29uc3QgdD1uZXcgbCh0aGlzLnNjLngsMCwwLDAsMCx0aGlzLnNjLnksMCwwLDAsMCx0aGlzLnNjLnosMCwwLDAsMCwxKSxlPXRoaXMub3JpLnRvTWF0NCgpLHM9bmV3IGw7cmV0dXJuIHMudHJhbnNsYXRpb249dGhpcy50cixzLm11bHRpcGx5KGUpLm11bHRpcGx5KHQpfWZyb21NYXQ0KHQpe3RoaXMudHI9dC50cmFuc2xhdGlvbix0aGlzLm9yaS5zZXRGcm9tTWF0NCh0KX1zZXRGcm9tRmxvYXQzMkFycmF5KHQpe2lmKDc9PXQubGVuZ3RoKXJldHVybiB0aGlzLnRyPW5ldyByKHQuYnVmZmVyLHQuYnl0ZU9mZnNldCksdGhpcy5vcmk9bmV3IHUodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKSx2b2lkKHRoaXMuc2M9bmV3IHIoMSwxLDEpKTtpZig4IT10Lmxlbmd0aClyZXR1cm4gMTA9PXQubGVuZ3RoPyh0aGlzLnRyPW5ldyByKHQuYnVmZmVyLHQuYnl0ZU9mZnNldCksdGhpcy5vcmk9bmV3IHUodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKSx2b2lkKHRoaXMuc2M9bmV3IHIodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzIxKSkpOnZvaWQgMDt7dGhpcy50cj1uZXcgcih0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQpLHRoaXMub3JpPW5ldyB1KHQuYnVmZmVyLHQuYnl0ZU9mZnNldCsxMik7Y29uc3QgZT10WzddO3RoaXMuc2M9bmV3IHIoZSxlLGUpfX1jbG9uZSgpe3JldHVybiBuZXcgbSh0aGlzLnRyLmNsb25lKCksdGhpcy5vcmkuY2xvbmUoKSx0aGlzLnNjLmNsb25lKCkpfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBtKC4uLnQpfXRvSlNPTigpe2NvbnN0IHQ9e3RyOnRoaXMudHIudG9KU09OKCksb3JpOnRoaXMub3JpLnRvSlNPTigpfTtyZXR1cm4gdGhpcy5zYy5pczExMSgpfHwodC5zYz10aGlzLnNjLnRvSlNPTigpKSx0fWZyb21KU09OKHQpe3RoaXMudHIuZnJvbUpTT04odC50ciksdGhpcy5vcmkuZnJvbUpTT04odC5vcmkpLHQuc2MmJnRoaXMuc2MuZnJvbUpTT04odC5zYyl9dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIlhmbyIsbSk7Y2xhc3MgZ3tjb25zdHJ1Y3Rvcih0LGUpe3RoaXMucDA9dCBpbnN0YW5jZW9mIGk/dDpuZXcgaShOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSx0aGlzLnAxPWUgaW5zdGFuY2VvZiBpP2U6bmV3IGkoTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLE51bWJlci5ORUdBVElWRV9JTkZJTklUWSl9c2V0KHQsZSl7dGhpcy5wMD10LHRoaXMucDE9ZX1yZXNldCgpe3RoaXMucDAueD1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksdGhpcy5wMS54PU51bWJlci5ORUdBVElWRV9JTkZJTklUWSx0aGlzLnAwLnk9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLHRoaXMucDEueT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFl9aXNWYWxpZCgpe3JldHVybiB0aGlzLnAwLnghPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdGhpcy5wMS54IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJnRoaXMucDAueSE9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZJiZ0aGlzLnAxLnkhPU51bWJlci5ORUdBVElWRV9JTkZJTklUWX1hZGRQb2ludCh0KXsodGhpcy5wMC54PT1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFl8fHQueDx0aGlzLnAwLngpJiYodGhpcy5wMC54PXQueCksKHRoaXMucDAueT09TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZfHx0Lnk8dGhpcy5wMC55KSYmKHRoaXMucDAueT10LnkpLCh0aGlzLnAxLnk9PU51bWJlci5ORUdBVElWRV9JTkZJTklUWXx8dC54PnRoaXMucDEueCkmJih0aGlzLnAxLng9dC54KSwodGhpcy5wMS55PT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFl8fHQueT50aGlzLnAxLnkpJiYodGhpcy5wMS55PXQueSl9c2l6ZSgpe3JldHVybiB0aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApfWRpYWdvbmFsKCl7cmV0dXJuIHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCl9Y2VudGVyKCl7Y29uc3QgdD10aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApO3JldHVybiB0LnNjYWxlSW5QbGFjZSguNSksdC5hZGRJblBsYWNlKHRoaXMucDApLHR9c3RhdGljIGNyZWF0ZSguLi50KXtyZXR1cm4gbmV3IGcoLi4udCl9dG9KU09OKCl7cmV0dXJue3AwOnRoaXMucDAudG9KU09OKCkscDE6dGhpcy5wMS50b0pTT04oKX19dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIkJveDIiLGcpO2NsYXNzIHkgZXh0ZW5kcyBze2NvbnN0cnVjdG9yKHQsZT0wKXtzdXBlcigpLHRoaXMucG9zPXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIsdGhpcy5yYWRpdXM9ZX1jbG9uZSgpe3JldHVybiBuZXcgU3BoZXJlKHRoaXMucG9zLmNsb25lKCksdGhpcy5yYWRpdXMpfWludGVyc2VjdHNCb3godCl7cmV0dXJuIHQuaW50ZXJzZWN0c1NwaGVyZSh0aGlzKX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgU3BoZXJlKC4uLnQpfXRvSlNPTigpe3JldHVybntwb3M6dGhpcy5wb3MudG9KU09OKCkscmFkaXVzOnRoaXMucmFkaXVzfX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX1hLnJlZ2lzdGVyVHlwZSgiU3BoZXJlVHlwZSIseSk7Y2xhc3MgcHtjb25zdHJ1Y3Rvcih0LGUpe3QgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXk/dGhpcy5zZXRGcm9tRmxvYXQzMkFycmF5KHQpOih0aGlzLnAwPXQgaW5zdGFuY2VvZiByP3Q6bmV3IHIoTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLHRoaXMucDE9ZSBpbnN0YW5jZW9mIHI/ZTpuZXcgcihOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkpfWdldCBtaW4oKXtyZXR1cm4gdGhpcy5wMH1nZXQgbWF4KCl7cmV0dXJuIHRoaXMucDF9c2V0KHQsZSl7dGhpcy5wMD10LHRoaXMucDE9ZX1yZXNldCgpe3RoaXMucDAueD1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksdGhpcy5wMS54PU51bWJlci5ORUdBVElWRV9JTkZJTklUWSx0aGlzLnAwLnk9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLHRoaXMucDEueT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksdGhpcy5wMC56PU51bWJlci5QT1NJVElWRV9JTkZJTklUWSx0aGlzLnAxLno9TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZfWlzVmFsaWQoKXtyZXR1cm4gdGhpcy5wMC54IT1OdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkmJnRoaXMucDEueCE9TnVtYmVyLk5FR0FUSVZFX0lORklOSVRZJiZ0aGlzLnAwLnkhPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdGhpcy5wMS55IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJnRoaXMucDAueiE9TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZJiZ0aGlzLnAxLnohPU51bWJlci5ORUdBVElWRV9JTkZJTklUWX1hZGRQb2ludCh0KXt0LnghPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC54IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lng8dGhpcy5wMC54JiYodGhpcy5wMC54PXQueCksdC54PnRoaXMucDEueCYmKHRoaXMucDEueD10LngpKSx0LnkhPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC55IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lnk8dGhpcy5wMC55JiYodGhpcy5wMC55PXQueSksdC55PnRoaXMucDEueSYmKHRoaXMucDEueT10LnkpKSx0LnohPU51bWJlci5QT1NJVElWRV9JTkZJTklUWSYmdC56IT1OdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkmJih0Lno8dGhpcy5wMC56JiYodGhpcy5wMC56PXQueiksdC56PnRoaXMucDEueiYmKHRoaXMucDEuej10LnopKX1hZGRCb3gzKHQsZSl7ZT8odGhpcy5hZGRQb2ludChlLnRyYW5zZm9ybVZlYzModC5wMCkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAwLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAxLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAwLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDAueCx0LnAxLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAwLnksdC5wMS56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKG5ldyByKHQucDEueCx0LnAxLnksdC5wMC56KSkpLHRoaXMuYWRkUG9pbnQoZS50cmFuc2Zvcm1WZWMzKHQucDEpKSk6KHRoaXMuYWRkUG9pbnQodC5wMCksdGhpcy5hZGRQb2ludCh0LnAxKSl9c2l6ZSgpe3JldHVybiB0aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApfWRpYWdvbmFsKCl7cmV0dXJuIHRoaXMucDEuc3VidHJhY3QodGhpcy5wMCl9Y2VudGVyKCl7Y29uc3QgdD10aGlzLnAxLnN1YnRyYWN0KHRoaXMucDApO3JldHVybiB0LnNjYWxlSW5QbGFjZSguNSksdC5hZGRJblBsYWNlKHRoaXMucDApLHR9dG9NYXQ0KCl7Y29uc3QgdD10aGlzLnAxLngtdGhpcy5wMC54LGU9dGhpcy5wMS55LXRoaXMucDAueSxzPXRoaXMucDEuei10aGlzLnAwLno7cmV0dXJuIG5ldyBsKHQsMCwwLDAsMCxlLDAsMCwwLDAscywwLHRoaXMucDAueCx0aGlzLnAwLnksdGhpcy5wMC56LDEpfWdldEJvdW5kaW5nU3BoZXJlKCl7cmV0dXJuIG5ldyB5KHRoaXMuY2VudGVyKCksLjUqdGhpcy5kaWFnb25hbCgpLmxlbmd0aCgpKX1pbnRlcnNlY3RzQm94KHQpe3JldHVybiEodC5tYXgueDx0aGlzLm1pbi54fHx0Lm1pbi54PnRoaXMubWF4Lnh8fHQubWF4Lnk8dGhpcy5taW4ueXx8dC5taW4ueT50aGlzLm1heC55fHx0Lm1heC56PHRoaXMubWluLnp8fHQubWluLno+dGhpcy5tYXgueil9aW50ZXJzZWN0c1NwaGVyZSh0KXtyZXR1cm4gY2xvc2VzdFBvaW50LmRpc3RhbmNlVG9TcXVhcmVkKHQuY2VudGVyKTw9dC5yYWRpdXMqdC5yYWRpdXN9aW50ZXJzZWN0c1BsYW5lKHQpe2xldCBlLHM7cmV0dXJuIHQubm9ybWFsLng+MD8oZT10Lm5vcm1hbC54KnRoaXMubWluLngscz10Lm5vcm1hbC54KnRoaXMubWF4LngpOihlPXQubm9ybWFsLngqdGhpcy5tYXgueCxzPXQubm9ybWFsLngqdGhpcy5taW4ueCksdC5ub3JtYWwueT4wPyhlKz10Lm5vcm1hbC55KnRoaXMubWluLnkscys9dC5ub3JtYWwueSp0aGlzLm1heC55KTooZSs9dC5ub3JtYWwueSp0aGlzLm1heC55LHMrPXQubm9ybWFsLnkqdGhpcy5taW4ueSksdC5ub3JtYWwuej4wPyhlKz10Lm5vcm1hbC56KnRoaXMubWluLnoscys9dC5ub3JtYWwueip0aGlzLm1heC56KTooZSs9dC5ub3JtYWwueip0aGlzLm1heC56LHMrPXQubm9ybWFsLnoqdGhpcy5taW4ueiksZTw9LXQuY29uc3RhbnQmJnM+PS10LmNvbnN0YW50fWNsb25lKCl7cmV0dXJuIG5ldyBwKHRoaXMucDAuY2xvbmUoKSx0aGlzLnAxLmNsb25lKCkpfXN0YXRpYyBjcmVhdGUoLi4udCl7cmV0dXJuIG5ldyBwKC4uLnQpfXN0YXRpYyBzaXplSW5CeXRlcygpe3JldHVybiAyNH10b0pTT04oKXtyZXR1cm57cDA6dGhpcy5wMC50b0pTT04oKSxwMTp0aGlzLnAxLnRvSlNPTigpfX1mcm9tSlNPTih0KXt0aGlzLnAwLmZyb21KU09OKHQucDApLHRoaXMucDEuZnJvbUpTT04odC5wMSl9bG9hZEJpbih0LGUpe3RoaXMucDAubG9hZEJpbih0LGUpLHRoaXMucDAubG9hZEJpbih0LGUrMTIpfXNldEZyb21GbG9hdDMyQXJyYXkodCl7dGhpcy5wMD1uZXcgcih0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQpLHRoaXMucDE9bmV3IHIodC5idWZmZXIsdC5ieXRlT2Zmc2V0KzEyKX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX1hLnJlZ2lzdGVyVHlwZSgiQm94MyIscCk7Y2xhc3MgeCBleHRlbmRzIHN7Y29uc3RydWN0b3IodCxlPTApe3N1cGVyKCksdGhpcy5ub3JtYWw9dCBpbnN0YW5jZW9mIHI/dDpuZXcgcix0aGlzLnc9ZX1zZXQodCxlLHMsYSl7dGhpcy5ub3JtYWwuc2V0KHQsZSxzKSx0aGlzLnc9YX1kaXZpZGVTY2FsYXIodCl7dGhpcy5ub3JtYWwuc2NhbGVJblBsYWNlKDEvdCksdGhpcy53Lz10fWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdC5kb3QodGhpcy5ub3JtYWwpK3RoaXMud31ub3JtYWxpemVJblBsYWNlKCl7Y29uc3QgdD0xL3RoaXMubm9ybWFsLmxlbmd0aCgpO3RoaXMubm9ybWFsLnNjYWxlSW5QbGFjZSh0KSx0aGlzLncqPXR9Y2xvbmUoKXtyZXR1cm4gbmV3IFBsYW5lKHRoaXMubm9ybWFsLmNsb25lKCksdGhpcy53KX1zdGF0aWMgY3JlYXRlKC4uLnQpe3JldHVybiBuZXcgUGxhbmUoLi4udCl9dG9KU09OKCl7cmV0dXJue25vcm1hbDp0aGlzLm5vcm1hbC50b0pTT04oKSx3OnRoaXMud319dG9TdHJpbmcoKXtyZXR1cm4gZSh0aGlzLnRvSlNPTigpKX19YS5yZWdpc3RlclR5cGUoIlBsYW5lVHlwZSIseCk7YS5yZWdpc3RlclR5cGUoIkZydXN0dW0iLGNsYXNze2NvbnN0cnVjdG9yKHQsZSxzLGEsaSxyKXt0aGlzLnBsYW5lcz1bdHx8bmV3IHgsZXx8bmV3IHgsc3x8bmV3IHgsYXx8bmV3IHgsaXx8bmV3IHgscnx8bmV3IHhdfXNldEZyb21NYXRyaXgodCl7Y29uc3QgZT10LHM9dGhpcy5wbGFuZXM7c1swXS5zZXQoZS5tMDMtZS5tMDAsZS5tMTMtZS5tMTAsZS5tMjMtZS5tMjAsZS5tMzMtZS5tMzApLHNbMV0uc2V0KGUubTAzK2UubTAwLGUubTEzK2UubTEwLGUubTIzK2UubTIwLGUubTMzK2UubTMwKSxzWzJdLnNldChlLm0wMytlLm0wMSxlLm0xMytlLm0xMSxlLm0yMytlLm0yMSxlLm0zMytlLm0zMSksc1szXS5zZXQoZS5tMDMtZS5tMDEsZS5tMTMtZS5tMTEsZS5tMjMtZS5tMjEsZS5tMzMtZS5tMzEpLHNbNF0uc2V0KGUubTAzLWUubTAyLGUubTEzLWUubTEyLGUubTIzLWUubTIyLGUubTMzLWUubTMyKSxzWzVdLnNldChlLm0wMytlLm0wMixlLm0xMytlLm0xMixlLm0yMytlLm0yMixlLm0zMytlLm0zMikscy5mb3JFYWNoKHQ9PnQubm9ybWFsaXplSW5QbGFjZSgpKX1pbnRlcnNlY3RzQm94KHQpe2NvbnN0IGU9bmV3IHIscz10aGlzLnBsYW5lcyx7bWluOmEsbWF4Oml9PXQ7Zm9yKGxldCB0PTA7dDw2O3QrKyl7Y29uc3Qgcj1zW3RdO2lmKGUueD1yLm5vcm1hbC54PjA/aS54OmEueCxlLnk9ci5ub3JtYWwueT4wP2kueTphLnksZS56PXIubm9ybWFsLno+MD9pLno6YS56LHIuZGlzdGFuY2VUb1BvaW50KGUpPDApcmV0dXJuITF9cmV0dXJuITB9dG9KU09OKCl7cmV0dXJue3AwOnRoaXMucDAudG9KU09OKCkscDE6dGhpcy5wMS50b0pTT04oKSxwMjp0aGlzLnAyLnRvSlNPTigpLHAzOnRoaXMucDMudG9KU09OKCkscDQ6dGhpcy5wNC50b0pTT04oKSxwNTp0aGlzLnA1LnRvSlNPTigpfX1mcm9tSlNPTih0KXt0aGlzLnAwLmZyb21KU09OKHQucDApLHRoaXMucDEuZnJvbUpTT04odC5wMSksdGhpcy5wMi5mcm9tSlNPTih0LnAyKSx0aGlzLnAzLmZyb21KU09OKHQucDMpLHRoaXMucDQuZnJvbUpTT04odC5wNCksdGhpcy5wNS5mcm9tSlNPTih0LnA1KX10b1N0cmluZygpe3JldHVybiBlKHRoaXMudG9KU09OKCkpfX0pO2NsYXNzIHd7Y29uc3RydWN0b3IodD0hMSl7dGhpcy5fX3Nsb3RzPVtdLHRoaXMuX190b2dnbGVkU2lnbmFsPXQsdGhpcy5fX3RvZ2dsZWQ9ITEsdGhpcy5fX2RhdGE9bnVsbCx0aGlzLmNvbm5lY3Q9dGhpcy5jb25uZWN0LmJpbmQodGhpcyksdGhpcy5kaXNjb25uZWN0PXRoaXMuZGlzY29ubmVjdC5iaW5kKHRoaXMpLHRoaXMuZW1pdD10aGlzLmVtaXQuYmluZCh0aGlzKX1jb25uZWN0KHQpe2lmKG51bGw9PXQpdGhyb3cgbmV3IEVycm9yKCJhIGZ1bmN0aW9uIGNhbGxiYWNrIG11c3QgYmUgcGFzc2VkIHRvIFNpZ25hbC5jb25uZWN0Iik7aWYoLTEhPXRoaXMuX19zbG90cy5pbmRleE9mKHQpKXJldHVybiB2b2lkIGNvbnNvbGUud2FybigiZm4gJyIrdC5uYW1lKyInIGFscmVhZHkgY29ubmVjdGVkIHRvIFNpZ25hbC4iKTtjb25zdCBlPXRoaXMuX19zbG90cy5sZW5ndGg7cmV0dXJuIHRoaXMuX19zbG90c1tlXT10LHRoaXMuX190b2dnbGVkU2lnbmFsJiZ0aGlzLl9fdG9nZ2xlZCYmKHRoaXMuX19kYXRhP3QoLi4udGhpcy5fX2RhdGEpOnQoKSksZX1kaXNjb25uZWN0KHQpe2lmKG51bGw9PXQpdGhyb3cgbmV3IEVycm9yKCJhIGZ1bmN0aW9uIGNhbGxiYWNrIG11c3QgYmUgcGFzc2VkIHRvIFNpZ25hbC5kaXNjb25uZWN0Iik7Y29uc3QgZT1bXTtpZih0aGlzLl9fc2xvdHMuZm9yRWFjaCgoZnVuY3Rpb24ocyxhKXtzPT09dCYmZS5wdXNoKGEpfSkpLDAhPWUubGVuZ3RoKWZvcihjb25zdCB0IG9mIGUpdGhpcy5fX3Nsb3RzW3RdPXZvaWQgMDtlbHNlIGNvbnNvbGUud2FybigiY2FsbGJhY2sgOiIrdC5uYW1lKyIgd2FzIG5vdCBjb25uZWN0ZWQgdG8gdGhpcyBzaWduYWw6Iit0aGlzLl9fbmFtZSl9ZGlzY29ubmVjdElkKHQpe2lmKCF0aGlzLl9fc2xvdHNbdF0pdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIElEIik7dGhpcy5fX3Nsb3RzW3RdPXZvaWQgMH1lbWl0KC4uLnQpe3RoaXMuX190b2dnbGVkU2lnbmFsJiYodGhpcy5fX3RvZ2dsZWQ/Y29uc29sZS53YXJuKCJUb2dnbGVkIHNpZ25hbHMgc2hvdWxkIG9ubHkgYmUgZmlyZWQgb25jZSwgb3IgdW50b2dnbGVkIGJlZm9yZSByZS1maXJpbmcuLiIpOih0aGlzLl9fdG9nZ2xlZD0hMCx0aGlzLl9fZGF0YT10KSk7Y29uc3QgZT10aGlzLl9fc2xvdHMubGVuZ3RoO2ZvcihsZXQgcz0wO3M8ZTtzKyspe2NvbnN0IGU9dGhpcy5fX3Nsb3RzW3NdO2UmJmUoLi4udCl9fWlzVG9nZ2xlZCgpe3JldHVybiB0aGlzLl9fdG9nZ2xlZH1zZXRUb2dnbGVkKHQpe3RoaXMuX190b2dnbGVkPXQsdGhpcy5fX2RhdGE9dm9pZCAwfWdldE51bUNvbm5lY3Rpb25zKCl7cmV0dXJuIHRoaXMuX19zbG90cy5sZW5ndGh9dW50b2dnbGUoKXt0aGlzLl9fdG9nZ2xlZD0hMSx0aGlzLl9fZGF0YT12b2lkIDB9fWNvbnN0IEk9bmV3IGNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzPXt9LHRoaXMuX19jbGFzc05hbWVzPXt9LHRoaXMuX19jbGFzc0xpc3Q9W119cmVnaXN0ZXJDbGFzcyh0LGUpe3RoaXMuX19yZWdpc3RlcmVkQ2xhc3Nlc1t0XT17Y2xzOmUsY2FsbGJhY2tzOltdfTtjb25zdCBzPXRoaXMuX19jbGFzc0xpc3QubGVuZ3RoO3RoaXMuX19jbGFzc0xpc3QucHVzaChlKSx0aGlzLl9fY2xhc3NOYW1lc1tzXT10fWdldENsYXNzKHQpe2lmKHRoaXMuX19yZWdpc3RlcmVkQ2xhc3Nlc1t0XSlyZXR1cm4gdGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzW3RdLmNsc31nZXRDbGFzc05hbWUodCl7Y29uc3QgZT10aGlzLl9fY2xhc3NMaXN0LmluZGV4T2YodC5jb25zdHJ1Y3Rvcik7cmV0dXJuIHRoaXMuX19jbGFzc05hbWVzW2VdP3RoaXMuX19jbGFzc05hbWVzW2VdOihjb25zb2xlLndhcm4oIkNsYXNzIG5vdCByZWdpc3RlcmVkOiIsdC5jb25zdHJ1Y3Rvci5uYW1lKSx0LmNvbnN0cnVjdG9yLm5hbWUpfWNvbnN0cnVjdENsYXNzKHQpe2NvbnN0IGU9dGhpcy5fX3JlZ2lzdGVyZWRDbGFzc2VzW3RdO2lmKCFlKXJldHVybiBjb25zb2xlLndhcm4oIkZhY3Rvcnkgbm90IHJlZ2lzdGVyZWQ6Iit0KSxudWxsO3RoaXMuX19jb25zdHJ1Y3Rpbmc9ITA7Y29uc3Qgcz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksYT1uZXcgZS5jbHMoLi4ucyk7cmV0dXJuIHRoaXMuX19jb25zdHJ1Y3Rpbmc9ITEsYX19LE49MyxGPTI7bGV0IHo9MDtjbGFzcyBWe2NvbnN0cnVjdG9yKHQsZSxzKXtpZih0aGlzLl9fZGF0YVR5cGU9dCx0aGlzLm5vcm1hbGl6ZWQ9ITEsbnVsbCE9dC5udW1FbGVtZW50cyl0aGlzLl9fZGltZW5zaW9uPXRoaXMuX19kYXRhVHlwZS5udW1FbGVtZW50cygpO2Vsc2Ugc3dpdGNoKHQpe2Nhc2UgNjpjYXNlIDQ6Y2FzZSA1OnRoaXMuX19kaW1lbnNpb249MTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBkYXRhIHR5cGUgZm9yIGF0dHJpYnV0ZToiK3QpfXZhciBhO3RoaXMuX19kZWZhdWx0RWxlbWVudFZhbHVlPW51bGwhPXM/czpOdW1iZXIuTUFYX1ZBTFVFLChhPWUpJiZ2b2lkIDAhPT1hLmJ5dGVMZW5ndGg/dGhpcy5fX2RhdGE9ZToodGhpcy5fX2RhdGE9bmV3IEZsb2F0MzJBcnJheShlKnRoaXMuX19kaW1lbnNpb24pLHRoaXMuaW5pdFJhbmdlKDApKX1yZXNpemUodCl7Y29uc3QgZT10aGlzLl9fZGF0YS5sZW5ndGgscz10KnRoaXMuX19kaW1lbnNpb24sYT1uZXcgRmxvYXQzMkFycmF5KHMpO2ZvcihsZXQgdD0wO3Q8TWF0aC5taW4odGhpcy5fX2RhdGEubGVuZ3RoLHMpO3QrKylhW3RdPXRoaXMuX19kYXRhW3RdO3RoaXMuX19kYXRhLmxlbmd0aDxzJiYodGhpcy5fX2RhdGE9YSksdGhpcy5pbml0UmFuZ2UoZSl9aW5pdFJhbmdlKHQpe2ZvcihsZXQgZT10O2U8dGhpcy5fX2RhdGEubGVuZ3RoO2UrKyl0aGlzLl9fZGF0YVtlXT10aGlzLl9fZGVmYXVsdEVsZW1lbnRWYWx1ZX1nZXRDb3VudCgpe3JldHVybiB0aGlzLl9fZGF0YS5sZW5ndGgvdGhpcy5fX2RpbWVuc2lvbn1nZXQgbGVuZ3RoKCl7cmV0dXJuIHRoaXMuX19kYXRhLmxlbmd0aC90aGlzLl9fZGltZW5zaW9ufWdldCBkYXRhVHlwZSgpe3JldHVybiB0aGlzLl9fZGF0YVR5cGV9Z2V0IGRhdGEoKXtyZXR1cm4gdGhpcy5fX2RhdGF9c2V0IGRhdGEodCl7dGhpcy5fX2RhdGE9dH1nZXQgbnVtRWxlbWVudHMoKXtyZXR1cm4gdGhpcy5fX2RpbWVuc2lvbn1nZXRGbG9hdDMyVmFsdWUodCl7cmV0dXJuIHRoaXMuX19kYXRhW3RdfXNldEZsb2F0MzJWYWx1ZSh0LGUpe3RoaXMuX19kYXRhW3RdPWV9Z2V0VmFsdWVSZWYodCl7Y29uc3QgZT10aGlzLl9fZGltZW5zaW9uO2lmKHQ+PXRoaXMuX19kYXRhLmxlbmd0aC9lKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2ZXJ0ZXggaW5kZXg6Iit0KyIuIE51bSBWZXJ0aWNlczoiK3RoaXMuX19kYXRhLmxlbmd0aC8zKTtyZXR1cm4gdGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMuX19kYXRhLmJ1ZmZlcix0KmUpfXNldFZhbHVlKHQsZSl7Y29uc3Qgcz10aGlzLl9fZGltZW5zaW9uO2lmKHQ+PXRoaXMuX19kYXRhLmxlbmd0aC9zKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2ZXJ0ZXggaW5kZXg6Iit0KyIuIE51bSBWZXJ0aWNlczoiK3RoaXMuX19kYXRhLmxlbmd0aC8zKTt0aGlzLl9fZGF0YVR5cGUuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy5fX2RhdGEuYnVmZmVyLHQqcykuc2V0RnJvbU90aGVyKGUpfXRvSlNPTih0LGUpe3JldHVybntkYXRhOkFycmF5LmZyb20odGhpcy5fX2RhdGEpLGRhdGFUeXBlOmEuZ2V0VHlwZU5hbWUodGhpcy5fX2RhdGFUeXBlKSxkZWZhdWx0VmFsdWU6dGhpcy5fX2RlZmF1bHRFbGVtZW50VmFsdWUsbGVuZ3RoOnRoaXMuX19kYXRhLmxlbmd0aC90aGlzLl9fZGltZW5zaW9ufX1mcm9tSlNPTih0KXt0aGlzLl9fZGF0YT1GbG9hdDMyQXJyYXkuZnJvbSh0LmRhdGEpfXRvU3RyaW5nKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCksbnVsbCwyKX19Y2xhc3MgTSBleHRlbmRzIGNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5fX2lkPSsreix0aGlzLl9fcGFyYW1zPVtdLHRoaXMuX19wYXJhbU1hcHBpbmc9e30sdGhpcy5fX3BhcmFtU2lnbmFsSWRzPXt9LHRoaXMucGFyYW1ldGVyQWRkZWQ9bmV3IHcsdGhpcy5wYXJhbWV0ZXJSZW1vdmVkPW5ldyB3LHRoaXMucGFyYW1ldGVyVmFsdWVDaGFuZ2VkPW5ldyB3fWdldElkKCl7cmV0dXJuIHRoaXMuX19pZH1udW1QYXJhbWV0ZXJzKCl7cmV0dXJuIHRoaXMuX19wYXJhbXMubGVuZ3RofWdldFBhcmFtZXRlcnMoKXtyZXR1cm4gdGhpcy5fX3BhcmFtc31nZXRQYXJhbWV0ZXJJbmRleCh0KXtyZXR1cm4gdGhpcy5fX3BhcmFtTWFwcGluZ1t0XX1nZXRQYXJhbWV0ZXJCeUluZGV4KHQpe3JldHVybiB0aGlzLl9fcGFyYW1zW3RdfWhhc1BhcmFtZXRlcih0KXtyZXR1cm4gdCBpbiB0aGlzLl9fcGFyYW1NYXBwaW5nfWdldFBhcmFtZXRlcih0KXtjb25zdCBlPXRoaXMuX19wYXJhbU1hcHBpbmdbdF07cmV0dXJuLTE9PWU/bnVsbDp0aGlzLl9fcGFyYW1zW2VdfV9fcGFyYW1ldGVyVmFsdWVDaGFuZ2VkKHQsZSl7dGhpcy5wYXJhbWV0ZXJWYWx1ZUNoYW5nZWQuZW1pdCh0LGUpfWFkZFBhcmFtZXRlcih0KXtjb25zdCBlPXQuZ2V0TmFtZSgpO3JldHVybiBudWxsIT10aGlzLl9fcGFyYW1NYXBwaW5nW2VdJiYoY29uc29sZS53YXJuKCJSZXBsYWNpbmcgUGFyYW1ldGVyOiIrZSksdGhpcy5yZW1vdmVQYXJhbWV0ZXIoZSkpLHRoaXMuX19wYXJhbVNpZ25hbElkc1tlXT10LnZhbHVlQ2hhbmdlZC5jb25uZWN0KGU9PnRoaXMuX19wYXJhbWV0ZXJWYWx1ZUNoYW5nZWQodCxlKSksdGhpcy5fX3BhcmFtcy5wdXNoKHQpLHRoaXMuX19wYXJhbU1hcHBpbmdbZV09dGhpcy5fX3BhcmFtcy5sZW5ndGgtMSx0aGlzLnBhcmFtZXRlckFkZGVkLmVtaXQoZSksdH1pbnNlcnRQYXJhbWV0ZXIodCxlKXtjb25zdCBzPXQuZ2V0TmFtZSgpO251bGwhPXRoaXMuX19wYXJhbU1hcHBpbmdbc10mJihjb25zb2xlLndhcm4oIlJlcGxhY2luZyBQYXJhbWV0ZXI6IitzKSx0aGlzLnJlbW92ZVBhcmFtZXRlcihzKSksdGhpcy5fX3BhcmFtU2lnbmFsSWRzW3NdPXQudmFsdWVDaGFuZ2VkLmNvbm5lY3QoZT0+dGhpcy5fX3BhcmFtZXRlclZhbHVlQ2hhbmdlZCh0LGUpKSx0aGlzLl9fcGFyYW1zLnNwbGljZShlLDAsdCk7Y29uc3QgYT17fTtmb3IobGV0IHQ9MDt0PHRoaXMuX19wYXJhbXMubGVuZ3RoO3QrKylhW3RoaXMuX19wYXJhbXNbdF0uZ2V0TmFtZSgpXT10O3JldHVybiB0aGlzLl9fcGFyYW1NYXBwaW5nPWEsdGhpcy5wYXJhbWV0ZXJBZGRlZC5lbWl0KHMpLHR9cmVtb3ZlUGFyYW1ldGVyKHQpe251bGw9PXRoaXMuX19wYXJhbU1hcHBpbmdbdF0mJmNvbnNvbGUudGhyb3coIlVuYWJsZSB0byBSZW1vdmUgUGFyYW1ldGVyOiIrdCk7Y29uc3QgZT10aGlzLl9fcGFyYW1NYXBwaW5nW3RdO3RoaXMuX19wYXJhbXNbdGhpcy5fX3BhcmFtTWFwcGluZ1t0XV0udmFsdWVDaGFuZ2VkLmRpc2Nvbm5lY3RJZCh0aGlzLl9fcGFyYW1TaWduYWxJZHNbdF0pLHRoaXMuX19wYXJhbXMuc3BsaWNlKGUsMSk7Y29uc3Qgcz17fTtmb3IobGV0IHQ9MDt0PHRoaXMuX19wYXJhbXMubGVuZ3RoO3QrKylzW3RoaXMuX19wYXJhbXNbdF0uZ2V0TmFtZSgpXT10O3RoaXMuX19wYXJhbU1hcHBpbmc9cyx0aGlzLnBhcmFtZXRlclJlbW92ZWQuZW1pdCh0KX1yZXBsYWNlUGFyYW1ldGVyKHQpe2NvbnN0IGU9dC5nZXROYW1lKCkscz10aGlzLl9fcGFyYW1NYXBwaW5nW2VdO3JldHVybiB0aGlzLl9fcGFyYW1zW3RoaXMuX19wYXJhbU1hcHBpbmdbZV1dLnZhbHVlQ2hhbmdlZC5kaXNjb25uZWN0SWQodGhpcy5fX3BhcmFtU2lnbmFsSWRzW2VdKSx0aGlzLl9fcGFyYW1TaWduYWxJZHNbZV09dC52YWx1ZUNoYW5nZWQuY29ubmVjdChlPT50aGlzLl9fcGFyYW1ldGVyVmFsdWVDaGFuZ2VkKHQsZSkpLHRoaXMuX19wYXJhbXNbc109dCx0fXRvSlNPTih0LGUpe2NvbnN0IHM9e307bGV0IGE9MDtmb3IoY29uc3QgaSBvZiB0aGlzLl9fcGFyYW1zKWlmKGkudGVzdEZsYWcoRikpaWYoaS5udW1SZWZzKCk+MSYmMCE9aS5nZXRSZWZJbmRleCh0aGlzKSlzW2kuZ2V0TmFtZSgpXT17cGFyYW1QYXRoOnQubWFrZVJlbGF0aXZlKGkuZ2V0UGF0aCgpKX0sYSsrO2Vsc2V7Y29uc3Qgcj1pLnRvSlNPTih0LGUpO3ImJihzW2kuZ2V0TmFtZSgpXT1yLGErKyl9aWYoYT4wKXJldHVybntwYXJhbXM6c319ZnJvbUpTT04odCxlLHMpe2lmKHQucGFyYW1zKWZvcihjb25zdCBzIGluIHQucGFyYW1zKXtjb25zdCBhPXQucGFyYW1zW3NdLGk9dGhpcy5nZXRQYXJhbWV0ZXIocyk7aT9hLnBhcmFtUGF0aD9lLnJlc29sdmVQYXRoKGEucGFyYW1QYXRoLHQ9Pnt0aGlzLnJlcGxhY2VQYXJhbWV0ZXIodCl9LHQ9Pntjb25zb2xlLndhcm4oIlVuYWJsZSB0byByZXNvbHZlIHNoYXJlZCBwYXJhbWV0ZXI6IithLnBhcmFtUGF0aCl9KTppLmZyb21KU09OKGEsZSk6Y29uc29sZS53YXJuKCJQYXJhbSBub3QgZm91bmQ6IitzKX19cmVhZEJpbmFyeSh0LGUpe2lmKGUudmVyc2lvbnNbInplYS1lbmdpbmUiXS5ncmVhdGVyT3JFcXVhbFRoYW4oWzAsMCwzXSkpe2NvbnN0IHM9dC5sb2FkVUludDMyKCk7Zm9yKGxldCBhPTA7YTxzO2ErKyl7Y29uc3Qgcz10LmxvYWRTdHIoKSxhPXQubG9hZFN0cigpO2xldCBpPXRoaXMuZ2V0UGFyYW1ldGVyKGEpO2lmKCFpKXtpZihpPUkuY29uc3RydWN0Q2xhc3MocyxhKSwhaSl7Y29uc29sZS5lcnJvcigiVW5hYmxlIHRvIGNvbnN0cnVjdCBwcm9wOiIrYSsiIG9mIHR5cGU6IitzKTtjb250aW51ZX10aGlzLmFkZFBhcmFtZXRlcihpKX1pLnJlYWRCaW5hcnkodCxlKX19fXRvU3RyaW5nKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCksbnVsbCwyKX1jb3B5RnJvbSh0LGUpe2xldCBzPXQubnVtUGFyYW1ldGVycygpO2Zvcig7cy0tOyl7Y29uc3QgZT10LmdldFBhcmFtZXRlckJ5SW5kZXgocyksYT10aGlzLmdldFBhcmFtZXRlcihlLmdldE5hbWUoKSk7YT9hLnNldFZhbHVlKGUuZ2V0VmFsdWUoKSxOKTp0aGlzLmFkZFBhcmFtZXRlcihlLmNsb25lKCkpfX1kZXN0cm95KCl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5fX3BhcmFtcyl0LmRlc3Ryb3koKTtzdXBlci5kZXN0cm95KCl9fXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5fX2JvdW5kaW5nQm94PW5ldyBwLHRoaXMuX19ib3VuZGluZ0JveERpcnR5PSEwLHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzPW5ldyBNYXAsdGhpcy5fX21ldGFEYXRhPW5ldyBNYXAsdGhpcy5hZGRWZXJ0ZXhBdHRyaWJ1dGUoInBvc2l0aW9ucyIsciwwKSx0aGlzLmJvdW5kaW5nQm94RGlydGllZD1uZXcgdyx0aGlzLmdlb21EYXRhQ2hhbmdlZD1uZXcgdyx0aGlzLmdlb21EYXRhVG9wb2xvZ3lDaGFuZ2VkPW5ldyB3fXNldERlYnVnTmFtZSh0KXt0aGlzLl9fbmFtZT10fWFkZFZlcnRleEF0dHJpYnV0ZSh0LGUscyl7bGV0IGE7dmFyIGk7cmV0dXJuIGE9KGk9cykmJnZvaWQgMCE9PWkuYnl0ZUxlbmd0aD9uZXcgVihlLHMpOm5ldyBWKGUsbnVsbCE9dGhpcy52ZXJ0aWNlcz90aGlzLnZlcnRpY2VzLmxlbmd0aDowLHMpLHRoaXMuX192ZXJ0ZXhBdHRyaWJ1dGVzLnNldCh0LGEpLGF9aGFzVmVydGV4QXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5oYXModCl9Z2V0VmVydGV4QXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5nZXQodCl9Z2V0VmVydGV4QXR0cmlidXRlcyh0KXtjb25zdCBlPXt9O2Zvcihjb25zdFt0LHNdb2YgdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZW50cmllcygpKWVbdF09cztyZXR1cm4gZX1nZXQgdmVydGljZXMoKXtyZXR1cm4gdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuZ2V0KCJwb3NpdGlvbnMiKX1udW1WZXJ0aWNlcygpe3JldHVybiB0aGlzLnZlcnRpY2VzLmxlbmd0aH1nZXROdW1WZXJ0aWNlcygpe3JldHVybiB0aGlzLnZlcnRpY2VzLmxlbmd0aH1zZXROdW1WZXJ0aWNlcyh0KXt0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5mb3JFYWNoKGU9PmUucmVzaXplKHQpKX1nZXRWZXJ0ZXgodCl7cmV0dXJuIHIuY3JlYXRlRnJvbUZsb2F0MzJCdWZmZXIodGhpcy52ZXJ0aWNlcy5kYXRhLmJ1ZmZlciwzKnQpfXNldFZlcnRleCh0LGUpe3JldHVybiByLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHRoaXMudmVydGljZXMuZGF0YS5idWZmZXIsMyp0KS5zZXRGcm9tT3RoZXIoZSl9bW92ZVZlcnRpY2VzKHQpe2NvbnN0IGU9dGhpcy52ZXJ0aWNlcztmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyllLmdldFZhbHVlUmVmKHMpLmFkZEluUGxhY2UodCk7dGhpcy5zZXRCb3VuZGluZ0JveERpcnR5KCl9dHJhbnNmb3JtVmVydGljZXModCl7Y29uc3QgZT10aGlzLnZlcnRpY2VzO2ZvcihsZXQgcz0wO3M8ZS5sZW5ndGg7cysrKXtjb25zdCBhPWUuZ2V0VmFsdWVSZWYocyksaT10LnRyYW5zZm9ybVZlYzMoYSk7YS5zZXQoaS54LGkueSxpLnopfXRoaXMuc2V0Qm91bmRpbmdCb3hEaXJ0eSgpfWdldCBib3VuZGluZ0JveCgpe3JldHVybiB0aGlzLl9fYm91bmRpbmdCb3hEaXJ0eSYmdGhpcy51cGRhdGVCb3VuZGluZ0JveCgpLHRoaXMuX19ib3VuZGluZ0JveH1zZXRCb3VuZGluZ0JveERpcnR5KCl7dGhpcy5fX2JvdW5kaW5nQm94RGlydHk9ITAsdGhpcy5ib3VuZGluZ0JveERpcnRpZWQuZW1pdCgpfXVwZGF0ZUJvdW5kaW5nQm94KCl7Y29uc3QgdD10aGlzLnZlcnRpY2VzLGU9bmV3IHAscz10Lmxlbmd0aDtmb3IobGV0IGE9MDthPHM7YSsrKWUuYWRkUG9pbnQodC5nZXRWYWx1ZVJlZihhKSk7dGhpcy5fX2JvdW5kaW5nQm94PWUsdGhpcy5fX2JvdW5kaW5nQm94RGlydHk9ITF9Z2V0TWV0YWRhdGEodCl7cmV0dXJuIHRoaXMuX19tZXRhRGF0YS5nZXQodCl9aGFzTWV0YWRhdGEodCl7cmV0dXJuIHRoaXMuX19tZXRhRGF0YS5oYXModCl9c2V0TWV0YWRhdGEodCxlKXt0aGlzLl9fbWV0YURhdGEuc2V0KHQsZSl9ZGVsZXRlTWV0YWRhdGEodCl7dGhpcy5fX21ldGFEYXRhLmRlbGV0ZSh0KX1nZW5CdWZmZXJzKHQpe2NvbnN0IGU9e307Zm9yKGNvbnN0W3Qsc11vZiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcyllW3RdPXt2YWx1ZXM6cy5kYXRhLGNvdW50OnMuc2l6ZSxkYXRhVHlwZTpzLmRhdGFUeXBlLG5vcm1hbGl6ZWQ6cy5ub3JtYWxpemVkfTtyZXR1cm57bnVtVmVydGljZXM6dGhpcy5udW1WZXJ0aWNlcygpLGF0dHJCdWZmZXJzOmV9fWZyZWVCdWZmZXJzKCl7fWxvYWRCYXNlR2VvbUJpbmFyeSh0KXt0aGlzLm5hbWU9dC5sb2FkU3RyKCk7Y29uc3QgZT10LmxvYWRVSW50OCgpO3RoaXMuZGVidWdDb2xvcj10LmxvYWRSR0JGbG9hdDMyQ29sb3IoKTtjb25zdCBzPXQubG9hZFVJbnQzMigpO3RoaXMuX19ib3VuZGluZ0JveC5zZXQodC5sb2FkRmxvYXQzMlZlYzMoKSx0LmxvYWRGbG9hdDMyVmVjMygpKSx0aGlzLnNldE51bVZlcnRpY2VzKHMpO2NvbnN0IGE9dGhpcy52ZXJ0aWNlcztsZXQgbixoOzImZSYmKG49dGhpcy5nZXRWZXJ0ZXhBdHRyaWJ1dGUoIm5vcm1hbHMiKSxufHwobj10aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgibm9ybWFscyIsciwwKSkpLDQmZSYmKGg9dGhpcy5nZXRWZXJ0ZXhBdHRyaWJ1dGUoInRleENvb3JkcyIpLGh8fChoPXRoaXMuYWRkVmVydGV4QXR0cmlidXRlKCJ0ZXhDb29yZHMiLGksMCkpKTtjb25zdCBvPSh0LGUscyxpKT0+e2ZvcihsZXQgbj10WzBdO248dFsxXTtuKyspe2NvbnN0IHQ9bmV3IHIoaVszKm4rMF0vMjU1LGlbMypuKzFdLzI1NSxpWzMqbisyXS8yNTUpO3QubXVsdGlwbHlJblBsYWNlKHMpLHQuYWRkSW5QbGFjZShlKSxhLnNldFZhbHVlKG4sdCl9fSxfPSh0LGUscyxhKT0+e3MuaXNOdWxsKCkmJnMuc2V0KDEsMSwxKTtmb3IobGV0IGk9dFswXTtpPHRbMV07aSsrKXtjb25zdCB0PW5ldyByKGFbMyppKzBdLzI1NSxhWzMqaSsxXS8yNTUsYVszKmkrMl0vMjU1KTt0Lm11bHRpcGx5SW5QbGFjZShzKSx0LmFkZEluUGxhY2UoZSksdC5ub3JtYWxpemVJblBsYWNlKCksbi5zZXRWYWx1ZShpLHQpfX0sZD0odCxlLHMsYSk9Pntmb3IobGV0IHI9dFswXTtyPHRbMV07cisrKXtjb25zdCB0PW5ldyBpKGFbMipyKzBdLzI1NSxhWzIqcisxXS8yNTUpO3QubXVsdGlwbHlJblBsYWNlKHMpLHQuYWRkSW5QbGFjZShlKSxoLnNldFZhbHVlKHIsdCl9fSxsPXQubG9hZFVJbnQzMigpO2lmKDE9PWwpe3tjb25zdCBlPXRoaXMuX19ib3VuZGluZ0JveCxhPXQubG9hZFVJbnQ4QXJyYXkoMypzKTtvKFswLHNdLGUucDAsZS5kaWFnb25hbCgpLGEpfWlmKG4pe2NvbnN0IGU9bmV3IHAodC5sb2FkRmxvYXQzMlZlYzMoKSx0LmxvYWRGbG9hdDMyVmVjMygpKSxhPXQubG9hZFVJbnQ4QXJyYXkoMypzKTtfKFswLHNdLGUucDAsZS5kaWFnb25hbCgpLGEpLG4ubG9hZFNwbGl0VmFsdWVzKHQpfWlmKGgpe2NvbnN0IGU9bmV3IGcodC5sb2FkRmxvYXQzMlZlYzIoKSx0LmxvYWRGbG9hdDMyVmVjMigpKSxhPXQubG9hZFVJbnQ4QXJyYXkoMipzKTtkKFswLHNdLGUucDAsZS5kaWFnb25hbCgpLGEpLGgubG9hZFNwbGl0VmFsdWVzKHQpfX1lbHNle2NvbnN0IGU9W107bGV0IGE9MDtmb3IobGV0IHM9MDtzPGw7cysrKXtjb25zdCBzPXQubG9hZFVJbnQzMigpLGk9e3JhbmdlOlthLGErc10sYmJveDpuZXcgcCh0LmxvYWRGbG9hdDMyVmVjMygpLHQubG9hZEZsb2F0MzJWZWMzKCkpfTtuJiYoaS5ub3JtYWxzUmFuZ2U9bmV3IHAodC5sb2FkRmxvYXQzMlZlYzMoKSx0LmxvYWRGbG9hdDMyVmVjMygpKSksaCYmKGkudGV4Q29vcmRzUmFuZ2U9bmV3IGcodC5sb2FkRmxvYXQzMlZlYzIoKSx0LmxvYWRGbG9hdDMyVmVjMigpKSksZS5wdXNoKGkpLGErPXN9Y29uc3QgaT10LmxvYWRVSW50OEFycmF5KDMqcyk7bGV0IHIsYztuJiYocj10LmxvYWRVSW50OEFycmF5KDMqcykpLGgmJihjPXQubG9hZFVJbnQ4QXJyYXkoMipzKSk7Zm9yKGxldCB0PTA7dDxsO3QrKyl7e2NvbnN0IHM9ZVt0XS5iYm94O28oZVt0XS5yYW5nZSxzLnAwLHMuZGlhZ29uYWwoKSxpKX1pZihuKXtjb25zdCBzPWVbdF0ubm9ybWFsc1JhbmdlO18oZVt0XS5yYW5nZSxzLnAwLHMuZGlhZ29uYWwoKSxyKX1pZihoKXtjb25zdCBzPWVbdF0udGV4Q29vcmRzUmFuZ2U7ZChlW3RdLnJhbmdlLHMucDAscy5kaWFnb25hbCgpLGMpfX1uJiZuLmxvYWRTcGxpdFZhbHVlcyh0KSxoJiZoLmxvYWRTcGxpdFZhbHVlcyh0KX19dG9KU09OKHQsZSl7bGV0IHM9c3VwZXIudG9KU09OKHQsZSk7aWYoc3x8KHM9e30pLHMudHlwZT1JLmdldENsYXNzTmFtZSh0aGlzKSwhKDEwMjQmZSkpe2NvbnN0IGE9e307Zm9yKGNvbnN0W3MsaV1vZiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5lbnRyaWVzKCkpYVtzXT1pLnRvSlNPTih0LGUpO3MudmVydGV4QXR0cmlidXRlcz1hfXJldHVybiBzfWZyb21KU09OKHQsZSxzKXtzdXBlci5mcm9tSlNPTih0LGUscyk7Zm9yKGNvbnN0IGUgaW4gdC52ZXJ0ZXhBdHRyaWJ1dGVzKXtsZXQgcz10aGlzLl9fdmVydGV4QXR0cmlidXRlcy5nZXQoZSk7Y29uc3QgaT10LnZlcnRleEF0dHJpYnV0ZXNbZV07aWYoIXMpe2NvbnN0IHQ9YS5nZXRUeXBlKGkuZGF0YVR5cGUpO3M9bmV3IFZlcnRleEF0dHJpYnV0ZSh0aGlzLHQsMCxpLmRlZmF1bHRTY2FsYXJWYWx1ZSksdGhpcy5fX3ZlcnRleEF0dHJpYnV0ZXMuc2V0KGUscyl9cy5mcm9tSlNPTihpKX19dG9TdHJpbmcoKXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy50b0pTT04oKSxudWxsLDIpfX1jbGFzcyBBIGV4dGVuZHMgTXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCl9bG9hZEJpbih0KXt0aGlzLm5hbWU9dC5sb2FkU3RyKCk7Y29uc3QgZT10LmxvYWRVSW50MzIoKTt0aGlzLl9fYm91bmRpbmdCb3guc2V0KHQubG9hZEZsb2F0MzJWZWMzKCksdC5sb2FkRmxvYXQzMlZlYzMoKSksdGhpcy5zZXROdW1WZXJ0aWNlcyhlKTtjb25zdCBzPXRoaXMudmVydGljZXM7aWYoZTwyNTYpe2NvbnN0IGE9dGhpcy5fX2JvdW5kaW5nQm94LnRvTWF0NCgpLGk9dC5sb2FkVUludDhBcnJheSgzKmUpO2ZvcihsZXQgdD0wO3Q8ZTt0Kyspe2NvbnN0IGU9bmV3IFZlYzMoaVszKnQrMF0vMjU1LGlbMyp0KzFdLzI1NSxpWzMqdCsyXS8yNTUpO3Muc2V0VmFsdWUodCxhLnRyYW5zZm9ybVZlYzMoZSkpfX1lbHNle2NvbnN0IGE9dC5sb2FkVUludDMyKCksaT1bXTtmb3IobGV0IGU9MDtlPGE7ZSsrKXtjb25zdCBlPXQubG9hZFVJbnQzMlZlYzIoKSxzPXQubG9hZEZsb2F0MzJWZWMzKCksYT10LmxvYWRGbG9hdDMyVmVjMygpO2kucHVzaCh7cmFuZ2U6ZSxiYm94Om5ldyBCb3gzKHMsYSl9KX1jb25zdCByPXQubG9hZFVJbnQ4QXJyYXkoMyplKTtmb3IobGV0IHQ9MDt0PGE7dCsrKXtjb25zdCBlPWlbdF0uYmJveC50b01hdDQoKTtmb3IobGV0IGE9aVt0XS5yYW5nZS54O2E8aVt0XS5yYW5nZS55O2ErKyl7Y29uc3QgdD1uZXcgVmVjMyhyWzMqYSswXS8yNTUsclszKmErMV0vMjU1LHJbMyphKzJdLzI1NSk7cy5zZXRWYWx1ZShhLGUudHJhbnNmb3JtVmVjMyh0KSl9fX19cmVhZEJpbmFyeSh0LGUpe3N1cGVyLmxvYWRCYXNlR2VvbUJpbmFyeSh0KSx0aGlzLmdlb21EYXRhQ2hhbmdlZC5lbWl0KCl9fWNsYXNzIFMgZXh0ZW5kcyBNe2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLl9faW5kaWNlcz1uZXcgVWludDMyQXJyYXksdGhpcy5fX3NlZ21lbnRBdHRyaWJ1dGVzPW5ldyBNYXAsdGhpcy5saW5lVGhpY2tuZXNzPTB9Z2V0SW5kaWNlcygpe3JldHVybiB0aGlzLl9faW5kaWNlc31nZXROdW1TZWdtZW50cygpe3JldHVybiB0aGlzLl9faW5kaWNlcy5sZW5ndGgvMn1zZXROdW1TZWdtZW50cyh0KXtjb25zdCBlPW5ldyBVaW50MzJBcnJheSgyKnQpO3RoaXMuX19pbmRpY2VzPWV9c2V0U2VnbWVudCh0LGUscyl7aWYodD49dGhpcy5fX2luZGljZXMubGVuZ3RoLzIpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGxpbmUgaW5kZXg6Iit0KyIuIE51bSBTZWdtZW50czoiK3RoaXMuX19pbmRpY2VzLmxlbmd0aC8yKTt0aGlzLl9faW5kaWNlc1syKnQrMF09ZSx0aGlzLl9faW5kaWNlc1syKnQrMV09c31nZXRTZWdtZW50VmVydGV4SW5kZXgodCxlKXtpZih0PHRoaXMubnVtTGluZXMpcmV0dXJuIHRoaXMuX19pbmRpY2VzWzIqdCtlXX1hZGRTZWdtZW50QXR0cmlidXRlKHQsZSxzKXtjb25zdCBhPW5ldyBBdHRyaWJ1dGUoZSxudWxsIT1zP3M6dGhpcy5wb2x5Z29uQ291bnQpO3JldHVybiB0aGlzLl9fc2VnbWVudEF0dHJpYnV0ZXMuc2V0KHQsYSksYX1oYXNTZWdtZW50QXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fc2VnbWVudEF0dHJpYnV0ZXMuaGFzKHQpfWdldFNlZ21lbnRBdHRyaWJ1dGUodCl7cmV0dXJuIHRoaXMuX19zZWdtZW50QXR0cmlidXRlcy5nZXQodCl9Z2VuQnVmZmVycygpe2NvbnN0IHQ9c3VwZXIuZ2VuQnVmZmVycygpO2xldCBlO3JldHVybiB0Lm51bVZlcnRpY2VzPE1hdGgucG93KDIsOCk/KGU9bmV3IFVpbnQ4QXJyYXkodGhpcy5fX2luZGljZXMubGVuZ3RoKSx0aGlzLl9faW5kaWNlcy5mb3JFYWNoKCh0LHMpPT57ZVtzXT10fSkpOnQubnVtVmVydGljZXM8TWF0aC5wb3coMiwxNik/KGU9bmV3IFVpbnQxNkFycmF5KHRoaXMuX19pbmRpY2VzLmxlbmd0aCksdGhpcy5fX2luZGljZXMuZm9yRWFjaCgodCxzKT0+e2Vbc109dH0pKTplPXRoaXMuX19pbmRpY2VzLHQuaW5kaWNlcz1lLHR9cmVhZEJpbmFyeSh0LGUpe3N1cGVyLmxvYWRCYXNlR2VvbUJpbmFyeSh0KSx0aGlzLnNldE51bVNlZ21lbnRzKHQubG9hZFVJbnQzMigpKTtjb25zdCBzPXQubG9hZFVJbnQ4KCk7MT09cz90aGlzLl9faW5kaWNlcz10LmxvYWRVSW50OEFycmF5KCk6Mj09cz90aGlzLl9faW5kaWNlcz10LmxvYWRVSW50MTZBcnJheSgpOjQ9PXMmJih0aGlzLl9faW5kaWNlcz10LmxvYWRVSW50MzJBcnJheSgpKSx0aGlzLmdlb21EYXRhQ2hhbmdlZC5lbWl0KCl9dG9KU09OKHQsZSl7Y29uc3Qgcz1zdXBlci50b0pTT04odCxlKTtyZXR1cm4gMTAyNCZlfHwocy5pbmRpY2VzPUFycmF5LmZyb20odGhpcy5fX2luZGljZXMpKSxzfWZyb21KU09OKHQsZSxzKXtzdXBlci5mcm9tSlNPTih0LGUscyksdGhpcy5fX2luZGljZXM9VWludDMyQXJyYXkuZnJvbSh0LmluZGljZXMpfX1jbGFzcyBPIGV4dGVuZHMgVntjb25zdHJ1Y3Rvcih0LGUscyxhKXtzdXBlcihlLHMsYSksdGhpcy5fX2dlb209dCx0aGlzLl9fc3BsaXRzPXt9LHRoaXMuX19zcGxpdFZhbHVlcz1bXX1nZXRGYWNlVmVydGV4VmFsdWVSZWYodCxlKXtjb25zdCBzPXRoaXMuX19nZW9tLmdldEZhY2VWZXJ0ZXhJbmRleCh0LGUpO3JldHVybiBzIGluIHRoaXMuX19zcGxpdHMmJnQgaW4gdGhpcy5fX3NwbGl0c1tzXT90aGlzLl9fc3BsaXRWYWx1ZXNbdGhpcy5fX3NwbGl0c1tzXVt0XV06dGhpcy5nZXRWYWx1ZVJlZihzKX1zZXRGYWNlVmVydGV4VmFsdWUodCxlLHMpe2NvbnN0IGE9dGhpcy5fX2dlb20uZ2V0RmFjZVZlcnRleEluZGV4KHQsZSk7dGhpcy5zZXRGYWNlVmVydGV4VmFsdWVfQnlWZXJ0ZXhJbmRleCh0LGEscyl9c2V0RmFjZVZlcnRleFZhbHVlX0J5VmVydGV4SW5kZXgodCxlLHMpe2NvbnN0IGE9dGhpcy5nZXRWYWx1ZVJlZihlKTtpZihhLmlzVmFsaWQoKSlpZihhLmFwcHJveEVxdWFsKHMpKTtlbHNle2lmKGUgaW4gdGhpcy5fX3NwbGl0cyl7Y29uc3QgYT10aGlzLl9fc3BsaXRzW2VdO2Zvcihjb25zdCBlIGluIGEpe2NvbnN0IGk9YVtlXTtpZih0aGlzLl9fc3BsaXRWYWx1ZXNbaV0uYXBwcm94RXF1YWwocykpcmV0dXJuIHZvaWQoYVt0XT1pKX1pZih0IGluIHRoaXMuX19zcGxpdHNbZV0pe3JldHVybiB2b2lkIHRoaXMuX19zcGxpdFZhbHVlc1t0aGlzLl9fc3BsaXRzW2VdW3RdXS5zZXRGcm9tT3RoZXIocyl9fWVsc2UgdGhpcy5fX3NwbGl0c1tlXT17fTt0aGlzLl9fc3BsaXRzW2VdW3RdPXRoaXMuX19zcGxpdFZhbHVlcy5sZW5ndGgsdGhpcy5fX3NwbGl0VmFsdWVzLnB1c2gocyl9ZWxzZSBhLnNldEZyb21PdGhlcihzKX1zZXRTcGxpdFZlcnRleFZhbHVlKHQsZSxzKXtpZih0IGluIHRoaXMuX19zcGxpdHN8fCh0aGlzLl9fc3BsaXRzW3RdPXt9KSxlIGluIHRoaXMuX19zcGxpdHNbdF0pe2lmKHRoaXMuX19zcGxpdFZhbHVlc1t0aGlzLl9fc3BsaXRzW3RdW2VdXS5hcHByb3hFcXVhbChzKSlyZXR1cm47Y29uc29sZS53YXJuKCJGYWNlIFZlcnRleCBBbHJlYWR5IFNwbGl0IHdpdGggZGlmZmVyZW50IHZhbHVlIil9dGhpcy5fX3NwbGl0c1t0XVtlXT10aGlzLl9fc3BsaXRWYWx1ZXMubGVuZ3RoLHRoaXMuX19zcGxpdFZhbHVlcy5wdXNoKHMpfXNldFNwbGl0VmVydGV4VmFsdWVzKHQsZSxzKXt0IGluIHRoaXMuX19zcGxpdHN8fCh0aGlzLl9fc3BsaXRzW3RdPXt9KTtjb25zdCBhPXRoaXMuX19zcGxpdFZhbHVlcy5sZW5ndGg7dGhpcy5fX3NwbGl0VmFsdWVzLnB1c2gocyk7Zm9yKGNvbnN0IHMgb2YgZSl0aGlzLl9fc3BsaXRzW3RdW3NdPWF9Z2V0U3BsaXRzKCl7cmV0dXJuIHRoaXMuX19zcGxpdHN9Z2V0U3BsaXRDb3VudCgpe2xldCB0PTA7Zm9yKGNvbnN0IGUgaW4gdGhpcy5fX3NwbGl0cyl0Kz1PYmplY3Qua2V5cyh0aGlzLl9fc3BsaXRzW2VdKS5sZW5ndGg7cmV0dXJuIHR9Z2VuZXJhdGVTcGxpdFZhbHVlcyh0LGUpe2lmKDA9PWUpcmV0dXJuIHRoaXMuX19kYXRhO2NvbnN0IHM9dGhpcy5sZW5ndGgsYT10aGlzLmxlbmd0aCtlLGk9dGhpcy5fX2RhdGFUeXBlLm51bUVsZW1lbnRzP3RoaXMuX19kYXRhVHlwZS5udW1FbGVtZW50cygpOjEscj1uZXcgRmxvYXQzMkFycmF5KGEqaSk7Zm9yKGxldCB0PTA7dDx0aGlzLl9fZGF0YS5sZW5ndGg7dCsrKXJbdF09dGhpcy5fX2RhdGFbdF07Zm9yKGNvbnN0IGUgaW4gdCl7Y29uc3QgYT10W2VdO2Zvcihjb25zdCB0IGluIGEpe2NvbnN0IG49cythW3RdO2lmKGUgaW4gdGhpcy5fX3NwbGl0cyYmdCBpbiB0aGlzLl9fc3BsaXRzW2VdKXtjb25zdCBzPXRoaXMuX19zcGxpdHNbZV1bdF07Nj09dGhpcy5fX2RhdGFUeXBlP3JbbippXT10aGlzLl9fc3BsaXRWYWx1ZXNbc106dGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21GbG9hdDMyQnVmZmVyKHIuYnVmZmVyLG4qaSkuc2V0RnJvbU90aGVyKHRoaXMuX19zcGxpdFZhbHVlc1tzXSl9ZWxzZXtjb25zdCB0PXBhcnNlSW50KGUpO2ZvcihsZXQgZT0wO2U8aTtlKyspdCppK2U+dGhpcy5fX2RhdGEubGVuZ3RoJiZjb25zb2xlLmxvZygiRXJyb3IgcmVtYXBwaW5nIHNyYzoiK3QqaStlKSxuKmkrZT5yLmxlbmd0aCYmY29uc29sZS5sb2coIkVycm9yIHJlbWFwcGluZyB0Z3Q6IituKmkrZSkscltuKmkrZV09dGhpcy5fX2RhdGFbdCppK2VdfX19cmV0dXJuIHJ9dG9KU09OKHQsZSl7Y29uc3Qgcz1zdXBlci50b0pTT04odCxlKTtyZXR1cm4gcy5zcGxpdHM9dGhpcy5fX3NwbGl0cyxzLnNwbGl0VmFsdWVzPXRoaXMuX19zcGxpdFZhbHVlcyxzfWZyb21KU09OKHQsZSxzKXtzdXBlci5mcm9tSlNPTih0LGUscyksdGhpcy5fX3NwbGl0cz10LnNwbGl0cyx0aGlzLl9fc3BsaXRWYWx1ZXM9W107Zm9yKGNvbnN0IGUgb2YgdC5zcGxpdFZhbHVlcyl0aGlzLl9fc3BsaXRWYWx1ZXMucHVzaCh0aGlzLl9fZGF0YVR5cGUuY3JlYXRlRnJvbUpTT04oZSkpfWxvYWRTcGxpdFZhbHVlcyh0KXtjb25zdCBlPXQubG9hZFVJbnQzMkFycmF5KCk7aWYoMD09ZS5sZW5ndGgpcmV0dXJuO2xldCBzPTAsYT0wO2Zvcig7Oyl7Y29uc3QgdD1lW3MrK10saT1lW3MrK10scj17fTtmb3IobGV0IHQ9MDt0PGk7dCsrKXtjb25zdCB0PWVbcysrXSxpPWVbcysrXTtyW3RdPWksaT49YSYmKGE9aSsxKX1pZih0aGlzLl9fc3BsaXRzW3RdPXIscz49ZS5sZW5ndGgpYnJlYWt9Y29uc3QgaT10aGlzLl9fbnVtRmxvYXQzMkVsZW1lbnRzLHI9dC5sb2FkRmxvYXQzMkFycmF5KGEqaSk7dGhpcy5fX3NwbGl0VmFsdWVzPVtdO2ZvcihsZXQgdD0wO3Q8YTt0Kyspe2NvbnN0IGU9dGhpcy5fX2RhdGFUeXBlLmNyZWF0ZUZyb21GbG9hdDMyQXJyYXkoci5zbGljZSh0KmksdCppK2kpKTt0aGlzLl9fc3BsaXRWYWx1ZXMucHVzaChlKX19fWNsYXNzIFAgZXh0ZW5kcyBNe2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmluaXQoKX1pbml0KCl7dGhpcy5fX2ZhY2VDb3VudHM9W10sdGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHM9bmV3IFVpbnQ4QXJyYXksdGhpcy5fX2ZhY2VPZmZzZXRzPW5ldyBVaW50MzJBcnJheSx0aGlzLl9fZmFjZVZlcnRleEluZGljZXM9bmV3IFVpbnQzMkFycmF5LHRoaXMuX19udW1Qb3B1bGF0ZWRGYWNlVmVydGV4SW5kaWNlcz0wLHRoaXMuX19mYWNlQXR0cmlidXRlcz1uZXcgTWFwLHRoaXMuX19lZGdlQXR0cmlidXRlcz1uZXcgTWFwLHRoaXMuX19sb2dUb3BvbG9neVdhcm5pbmdzPSExLHRoaXMuZWRnZVZlcnRzPXZvaWQgMCx0aGlzLnZlcnRleEVkZ2VzPXZvaWQgMCx0aGlzLm51bUVkZ2VzPTAsdGhpcy5lZGdlRmxhZ3M9bmV3IFVpbnQzMkFycmF5LHRoaXMuZWRnZUFuZ2xlcz1uZXcgRmxvYXQzMkFycmF5fWdldEZhY2VWZXJ0ZXhJbmRpY2VzKCl7cmV0dXJuIHRoaXMuX19mYWNlVmVydGV4SW5kaWNlc31nZXRGYWNlQ291bnRzKCl7cmV0dXJuIHRoaXMuX19mYWNlQ291bnRzfWNsZWFyKCl7dGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzPXZvaWQgMCx0aGlzLl9fZmFjZUNvdW50cz1bXSx0aGlzLl9fbnVtUG9wdWxhdGVkRmFjZVZlcnRleEluZGljZXM9MH1zZXRGYWNlQ291bnRzKHQpe2lmKHRoaXMuX19udW1Qb3B1bGF0ZWRGYWNlVmVydGV4SW5kaWNlcyl0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgZmFjZSBjb3VudHMgb24gYSBtZXNoIHRoYXQgaXMgYWxyZWFkeSBwb3B1bGF0ZWQuIFBsZWFzZSBjYWxsICdjbGVhcicgYmVmb3JlIHJlLWJ1aWxkaW5nIHRoZSBtZXNoLiIpO3RoaXMuX19mYWNlQ291bnRzPXQ7bGV0IGU9MCxzPTAsYT0zO2Zvcihjb25zdCB0IG9mIHRoaXMuX19mYWNlQ291bnRzKWUrPXQscys9dCphLGErKzt0aGlzLl9fZmFjZVZlcnRleENvdW50cz1uZXcgVWludDhBcnJheShlKSx0aGlzLl9fZmFjZU9mZnNldHM9bmV3IFVpbnQzMkFycmF5KGUpLHRoaXMuX19mYWNlVmVydGV4SW5kaWNlcz1uZXcgVWludDMyQXJyYXkocyk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5fX2ZhY2VBdHRyaWJ1dGVzKXQucmVzaXplKGUpfXNldEZhY2VWZXJ0ZXhJbmRpY2VzKHQpe2NvbnN0IGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLHM9dGhpcy5fX251bVBvcHVsYXRlZEZhY2VWZXJ0ZXhJbmRpY2VzO2ZvcihsZXQgdD0wO3Q8ZS5sZW5ndGg7dCsrKXRoaXMuX19mYWNlVmVydGV4SW5kaWNlc1tzK3RdPWVbdF07dGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHNbdF09ZS5sZW5ndGgtMyx0aGlzLl9fZmFjZU9mZnNldHNbdF09cyx0aGlzLl9fbnVtUG9wdWxhdGVkRmFjZVZlcnRleEluZGljZXMrPWUubGVuZ3RofWdldEZhY2VWZXJ0ZXhJbmRpY2VzKHQpe2NvbnN0IGU9W10scz10aGlzLl9fZmFjZU9mZnNldHNbdF0sYT10aGlzLl9fZmFjZVZlcnRleENvdW50c1t0XSszO2ZvcihsZXQgdD0wO3Q8YTt0KyspZS5wdXNoKHRoaXMuX19mYWNlVmVydGV4SW5kaWNlc1tzK3RdKTtyZXR1cm4gZX1nZXRGYWNlVmVydGV4SW5kZXgodCxlKXtjb25zdCBzPXRoaXMuX19mYWNlT2Zmc2V0c1t0XTtyZXR1cm4gdGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzW3MrZV19Z2V0TnVtRmFjZXMoKXtyZXR1cm4gdGhpcy5fX2ZhY2VWZXJ0ZXhDb3VudHMubGVuZ3RofWFkZFZlcnRleEF0dHJpYnV0ZSh0LGUscyl7Y29uc3QgYT1uZXcgTyh0aGlzLGUsbnVsbCE9dGhpcy52ZXJ0aWNlcz90aGlzLnZlcnRpY2VzLmxlbmd0aDowLHMpO3JldHVybiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcy5zZXQodCxhKSxhfWFkZEZhY2VBdHRyaWJ1dGUodCxlLHMpe2NvbnN0IGE9bmV3IFYoZSxudWxsIT1zP3M6dGhpcy5nZXROdW1GYWNlcygpKTtyZXR1cm4gdGhpcy5fX2ZhY2VBdHRyaWJ1dGVzLnNldCh0LGEpLGF9aGFzRmFjZUF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX2ZhY2VBdHRyaWJ1dGVzLmhhcyh0KX1nZXRGYWNlQXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fZmFjZUF0dHJpYnV0ZXMuZ2V0KHQpfWFkZEVkZ2VBdHRyaWJ1dGUodCxlLHMpe2NvbnN0IGE9bmV3IFYoZSxudWxsIT1zP3M6dGhpcy5nZXROdW1FZGdlcygpKTtyZXR1cm4gdGhpcy5fX2VkZ2VBdHRyaWJ1dGVzLnNldCh0LGEpLGF9aGFzRWRnZUF0dHJpYnV0ZSh0KXtyZXR1cm4gdGhpcy5fX2VkZ2VBdHRyaWJ1dGVzLmhhcyh0KX1nZXRFZGdlQXR0cmlidXRlKHQpe3JldHVybiB0aGlzLl9fZWRnZUF0dHJpYnV0ZXMuZ2V0KHQpfWdlblRvcG9sb2d5SW5mbygpe2NvbnN0IHQ9e307dGhpcy52ZXJ0ZXhFZGdlcz1bXSx0aGlzLmVkZ2VGYWNlcz1bXSx0aGlzLmVkZ2VWZXJ0cz1bXSx0aGlzLmZhY2VFZGdlcz1bXSx0aGlzLm51bUVkZ2VzPTA7Y29uc3QgZT0oZSxzKT0+e2xldCBhPWUsaT1zO2lmKGk8YSl7Y29uc3QgdD1hO2E9aSxpPXR9Y29uc3Qgcj1hKyI+IitpO2lmKHIgaW4gdClyZXR1cm4gdFtyXTtjb25zdCBuPXRoaXMudmVydGljZXMuZ2V0VmFsdWVSZWYoYSksaD10aGlzLnZlcnRpY2VzLmdldFZhbHVlUmVmKGkpLnN1YnRyYWN0KG4pLG89e2VkZ2VJbmRleDp0aGlzLmVkZ2VGYWNlcy5sZW5ndGgvMixlZGdlVmVjOmh9O3JldHVybiB0W3JdPW8sdGhpcy5lZGdlRmFjZXMucHVzaCgtMSksdGhpcy5lZGdlRmFjZXMucHVzaCgtMSksdGhpcy5lZGdlVmVydHMucHVzaChhKSx0aGlzLmVkZ2VWZXJ0cy5wdXNoKGkpLHRoaXMubnVtRWRnZXMrKyxvfSxzPSh0LHMsYSk9Pntjb25zdCBpPWUodCxzKS5lZGdlSW5kZXg7aWYoczx0KXtjb25zdCB0PTIqaSswO3RoaXMuX19sb2dUb3BvbG9neVdhcm5pbmdzJiYtMSE9dGhpcy5lZGdlRmFjZXNbdF0mJmNvbnNvbGUud2FybigiRWRnZSBwb2x5IDAgYWxyZWFkeSBzZXQuIE1lc2ggaXMgbm9uLW1hbmlmb2xkLiIpLHRoaXMuZWRnZUZhY2VzW3RdPWF9ZWxzZXtjb25zdCB0PTIqaSsxO3RoaXMuX19sb2dUb3BvbG9neVdhcm5pbmdzJiYtMSE9dGhpcy5lZGdlRmFjZXNbdF0mJmNvbnNvbGUud2FybigiRWRnZSBwb2x5IDEgYWxyZWFkeSBzZXQuIE1lc2ggaXMgbm9uLW1hbmlmb2xkLiIpLHRoaXMuZWRnZUZhY2VzW3RdPWF9YSBpbiB0aGlzLmZhY2VFZGdlc3x8KHRoaXMuZmFjZUVkZ2VzW2FdPVtdKSx0aGlzLmZhY2VFZGdlc1thXS5wdXNoKGkpLG51bGw9PXRoaXMudmVydGV4RWRnZXNbdF0mJih0aGlzLnZlcnRleEVkZ2VzW3RdPW5ldyBTZXQpLG51bGw9PXRoaXMudmVydGV4RWRnZXNbc10mJih0aGlzLnZlcnRleEVkZ2VzW3NdPW5ldyBTZXQpLHRoaXMudmVydGV4RWRnZXNbdF0uYWRkKGkpLHRoaXMudmVydGV4RWRnZXNbc10uYWRkKGkpfSxhPXRoaXMuZ2V0TnVtRmFjZXMoKTtmb3IobGV0IHQ9MDt0PGE7dCsrKXtjb25zdCBlPXRoaXMuZ2V0RmFjZVZlcnRleEluZGljZXModCk7Zm9yKGxldCBhPTA7YTxlLmxlbmd0aDthKyspe3MoZVthXSxlWyhhKzEpJWUubGVuZ3RoXSx0KX19fWNvbXB1dGVGYWNlTm9ybWFscygpe2NvbnN0IHQ9dGhpcy52ZXJ0aWNlcyxlPXRoaXMuYWRkRmFjZUF0dHJpYnV0ZSgibm9ybWFscyIscikscz10aGlzLmdldE51bUZhY2VzKCk7Zm9yKGxldCBhPTA7YTxzO2ErKyl7Y29uc3Qgcz10aGlzLmdldEZhY2VWZXJ0ZXhJbmRpY2VzKGEpLGk9dC5nZXRWYWx1ZVJlZihzWzBdKTtsZXQgbj10LmdldFZhbHVlUmVmKHNbMV0pO2NvbnN0IGg9bmV3IHI7Zm9yKGxldCBlPTI7ZTxzLmxlbmd0aDtlKyspe2NvbnN0IGE9dC5nZXRWYWx1ZVJlZihzW2VdKSxyPW4uc3VidHJhY3QoaSksbz1hLnN1YnRyYWN0KGkpO2guYWRkSW5QbGFjZShyLmNyb3NzKG8pLm5vcm1hbGl6ZSgpKSxuPWF9aC5sZW5ndGhTcXVhcmVkKCksTnVtYmVyLkVQU0lMT04sZS5zZXRWYWx1ZShhLGgubm9ybWFsaXplKCkpfX1nZW5lcmF0ZUVkZ2VGbGFncygpe251bGw9PXRoaXMudmVydGV4RWRnZXMmJnRoaXMuZ2VuVG9wb2xvZ3lJbmZvKCksdGhpcy5oYXNGYWNlQXR0cmlidXRlKCJub3JtYWxzIil8fHRoaXMuY29tcHV0ZUZhY2VOb3JtYWxzKCk7Y29uc3QgdD10aGlzLnZlcnRpY2VzLGU9dGhpcy5nZXRGYWNlQXR0cmlidXRlKCJub3JtYWxzIik7dGhpcy5lZGdlVmVjcz1bXSx0aGlzLmVkZ2VBbmdsZXM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLm51bUVkZ2VzKTtmb3IobGV0IHM9MDtzPHRoaXMuZWRnZUZhY2VzLmxlbmd0aDtzKz0yKXtjb25zdCBhPXRoaXMuZWRnZVZlcnRzW3NdLGk9dGhpcy5lZGdlVmVydHNbcysxXSxyPXQuZ2V0VmFsdWVSZWYoaSkuc3VidHJhY3QodC5nZXRWYWx1ZVJlZihhKSk7ci5ub3JtYWxpemVJblBsYWNlKCksdGhpcy5lZGdlVmVjcy5wdXNoKHIpO2NvbnN0IG49dGhpcy5lZGdlRmFjZXNbc10saD10aGlzLmVkZ2VGYWNlc1tzKzFdO2lmKC0xPT1ufHwtMT09aCl7dGhpcy5lZGdlQW5nbGVzW3MvMl09MipNYXRoLlBJO2NvbnRpbnVlfWNvbnN0IG89ZS5nZXRWYWx1ZVJlZihuKSxfPWUuZ2V0VmFsdWVSZWYoaCk7dGhpcy5lZGdlQW5nbGVzW3MvMl09by5hbmdsZVRvKF8pfX1jb21wdXRlVmVydGV4Tm9ybWFscyh0PTEpe3RoaXMuZ2VuZXJhdGVFZGdlRmxhZ3MoKTt0aGlzLnZlcnRpY2VzO2NvbnN0IGU9dGhpcy5nZXRGYWNlQXR0cmlidXRlKCJub3JtYWxzIikscz10aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgibm9ybWFscyIsciksYT1lLmRhdGEuYnVmZmVyLGk9cy5kYXRhLG49KHQsZSk9PntpWzMqdCswXT1lLngsaVszKnQrMV09ZS55LGlbMyp0KzJdPWUuen0saD0odCxlKT0+e2xldCBzLGE7Y29uc3QgaT10aGlzLmZhY2VFZGdlc1t0XTtmb3IoY29uc3QgdCBvZiBpKSh0aGlzLmVkZ2VWZXJ0c1syKnRdPT1lfHx0aGlzLmVkZ2VWZXJ0c1syKnQrMV09PWUpJiYocz9hPXRoaXMuZWRnZVZlY3NbdF06cz10aGlzLmVkZ2VWZWNzW3RdKTtyZXR1cm5bcyxhXX07Zm9yKGxldCBlPTA7ZTx0aGlzLnZlcnRleEVkZ2VzLmxlbmd0aDtlKyspe2lmKG51bGw9PXRoaXMudmVydGV4RWRnZXNbZV0pY29udGludWU7Y29uc3QgaT10aGlzLnZlcnRleEVkZ2VzW2VdLF89W10sZD10PT57bGV0IGU9ITE7Zm9yKGNvbnN0IHMgb2YgXylpZihlPS0xIT1zLmluZGV4T2YodCksZSlicmVhaztlfHxfLnB1c2goW3RdKX07Zm9yKGNvbnN0IGUgb2YgaSl7Y29uc3Qgcz10aGlzLmVkZ2VGYWNlc1syKmVdLGE9dGhpcy5lZGdlRmFjZXNbMiplKzFdO2lmKC0xIT1zJiYtMT09YSYmdGhpcy5lZGdlQW5nbGVzW2VdPHQpe2xldCB0PS0xLGU9LTE7Zm9yKGxldCBpPTA7aTxfLmxlbmd0aDtpKyspLTE9PXQmJi0xIT1fW2ldLmluZGV4T2YocykmJih0PWkpLC0xPT1lJiYtMSE9X1tpXS5pbmRleE9mKGEpJiYoZT1pKTstMT09dCYmLTE9PWU/Xy5wdXNoKFtzLGFdKTotMSE9dCYmLTEhPWU/dCE9ZSYmKF9bdF09X1t0XS5jb25jYXQoX1tlXSksXy5zcGxpY2UoZSwxKSk6KC0xPT10JiZfW2VdLnB1c2gocyksLTE9PWUmJl9bdF0ucHVzaChhKSl9ZWxzZS0xIT1zJiZkKHMpLC0xIT1hJiZkKGEpfV8uc29ydCgodCxlKT0+dC5sZW5ndGg8ZS5sZW5ndGg/MTp0Lmxlbmd0aD5lLmxlbmd0aD8tMTowKTtsZXQgbD0hMDtmb3IoY29uc3QgdCBvZiBfKXtjb25zdCBpPW5ldyByO2Zvcihjb25zdCBzIG9mIHQpe2NvbnN0IHQ9aChzLGUpLG49dFswXS5hbmdsZVRvKHRbMV0pO2kuYWRkSW5QbGFjZSgobz1zLG5ldyByKGEsMTIqbykpLnNjYWxlKG4pKX1pLm5vcm1hbGl6ZUluUGxhY2UoKSxsPyhuKGUsaSksbD0hMSk6cy5zZXRTcGxpdFZlcnRleFZhbHVlcyhlLHQsaSl9fXZhciBvO3JldHVybiBzfWNvbXB1dGVOdW1UcmlhbmdsZXMoKXtsZXQgdD0zLGU9MDtmb3IoY29uc3QgcyBvZiB0aGlzLl9fZmFjZUNvdW50cyllKz1zKih0LTIpLHQrKztyZXR1cm4gZX1nZW5lcmF0ZVRyaWFuZ3VsYXRlZEluZGljZXModCxlLHMpe2NvbnN0IGE9dGhpcy5jb21wdXRlTnVtVHJpYW5nbGVzKCk7bGV0IGk7aT10PE1hdGgucG93KDIsOCk/bmV3IFVpbnQ4QXJyYXkoMyphKTp0PE1hdGgucG93KDIsMTYpP25ldyBVaW50MTZBcnJheSgzKmEpOm5ldyBVaW50MzJBcnJheSgzKmEpO2xldCByPTA7Y29uc3Qgbj1mdW5jdGlvbih0LGEpe3QgaW4gcyYmYSBpbiBzW3RdJiYodD1lK3NbdF1bYV0pLGlbcl09dCxyKyt9LGg9dGhpcy5nZXROdW1GYWNlcygpO2ZvcihsZXQgdD0wO3Q8aDt0Kyspe2NvbnN0IGU9dGhpcy5nZXRGYWNlVmVydGV4SW5kaWNlcyh0KTtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKylzPj0zJiYobihlWzBdLHQpLG4oZVtzLTFdLHQpKSxuKGVbc10sdCl9cmV0dXJuIGl9Y29tcHV0ZUhhcmRFZGdlc0luZGljZXModD0xKXtjb25zdCBlPVtdLHM9dD0+e2UucHVzaCh0aGlzLmVkZ2VWZXJ0c1t0XSksZS5wdXNoKHRoaXMuZWRnZVZlcnRzW3QrMV0pfTtmb3IobGV0IGU9MDtlPHRoaXMuZWRnZUZsYWdzLmxlbmd0aDtlKz0yKXRoaXMuZWRnZUFuZ2xlc1tlLzJdPnQmJnMoZSk7cmV0dXJuIGV9Z2V0V2lyZWZyYW1lSW5kaWNlcygpe3JldHVybiBpbmRpY2VzfWdlbkJ1ZmZlcnModCl7Y29uc3QgZT17fTtsZXQgcz0wO2Zvcihjb25zdFssdF1vZiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcyl7Y29uc3QgYT10LmdldFNwbGl0cygpO2Zvcihjb25zdCB0IGluIGEpe3QgaW4gZXx8KGVbdF09e30pO2NvbnN0IGk9YVt0XTtmb3IoY29uc3QgYSBpbiBpKXtjb25zdCBpPXBhcnNlSW50KGEpO2kgaW4gZVt0XXx8KGVbdF1baV09cyxzKyspfX19Y29uc3QgYT10aGlzLnZlcnRpY2VzLmxlbmd0aCxpPWErcztsZXQgcjt0JiYwPT10LmluY2x1ZGVJbmRpY2VzfHwocj10aGlzLmdlbmVyYXRlVHJpYW5ndWxhdGVkSW5kaWNlcyhpLGEsZSkpO2NvbnN0IG49e307Zm9yKGNvbnN0W3QsYV1vZiB0aGlzLl9fdmVydGV4QXR0cmlidXRlcyl7bGV0IGk7aT0wPT1zP2EuZGF0YTphLmdlbmVyYXRlU3BsaXRWYWx1ZXMoZSxzKTtjb25zdCByPWEubnVtRWxlbWVudHMsaD1pLmxlbmd0aC9yO25bdF09e3ZhbHVlczppLGNvdW50OmgsZGltZW5zaW9uOnIsbm9ybWFsaXplZDoibm9ybWFscyI9PXQsZGF0YVR5cGU6YS5kYXRhVHlwZX19Y29uc3QgaD17bnVtVmVydGljZXM6dGhpcy5udW1WZXJ0aWNlcygpLG51bVJlbmRlclZlcnRzOmksaW5kaWNlczpyLGF0dHJCdWZmZXJzOm59O2lmKHQmJnQuaW5jbHVkZVZlcnRleE5laWdoYm9ycyl7bnVsbD09dGhpcy52ZXJ0ZXhFZGdlcyYmdGhpcy5nZW5Ub3BvbG9neUluZm8oKTtsZXQgdD0wO2ZvcihsZXQgZT0wO2U8dGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGg7ZSsrKXRoaXMudmVydGV4RWRnZXNbZV0mJih0Kz10aGlzLnZlcnRleEVkZ2VzW2VdLnNpemUpO2NvbnN0IGU9bmV3IFVpbnQzMkFycmF5KDIqdGhpcy52ZXJ0ZXhFZGdlcy5sZW5ndGgrdCkscz10PT57Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspe2NvbnN0IHM9dFtlXTtmb3IobGV0IGE9MDthPGU7YSsrKXtjb25zdCBpPXRbYV07aWYoLTEhPXNbMF0mJnNbMF09PWlbMV0pe2UhPWErMSYmKHQuc3BsaWNlKGUsMSksdC5zcGxpY2UoYSsxLDAscykpO2JyZWFrfWlmKC0xIT1zWzFdJiZzWzFdPT1pWzBdKXt0LnNwbGljZShlLDEpLHQuc3BsaWNlKGEsMCxzKTticmVha319fX0sYT10PT57aWYoISgtMSE9dFswXVswXSYmLTEhPXRbdC5sZW5ndGgtMV1bMV18fC0xPT10WzBdWzBdJiYtMT09dFt0Lmxlbmd0aC0xXVsxXSkpdGhyb3cgbmV3IEVycm9yKCJJZiBmYW4gc3RhcnRzIHdpdGggLTEsIGl0IG11c3QgYWxzbyBlbmQgd2l0aCAtMSIpO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKXtjb25zdCBzPXRbZV07aWYoKC0xPT1zWzBdfHwtMT09c1sxXSkmJjAhPWUmJmUhPXQubGVuZ3RoLTEpdGhyb3cgbmV3IEVycm9yKCItMSBvbmx5IGFsbG93ZWQgYXQgdGhlIGJlZ2lubmluZyBhbmQgZW5kIG9mIGEgZmFuLiIpO2lmKC0xIT1zWzBdKXtsZXQgYT1lLTE7aWYoYTwwJiYoYSs9dC5sZW5ndGgpLHNbMF0hPXRbYV1bMV0pdGhyb3cgbmV3IEVycm9yKCJGYWNlcyBhcmUgbm90IHNlcXVlbnRpYWwiKX1pZigtMSE9c1sxXSl7Y29uc3QgYT0oZSsxKSV0Lmxlbmd0aDtpZihzWzFdIT10W2FdWzBdKXRocm93IG5ldyBFcnJvcigiRmFjZXMgYXJlIG5vdCBzZXF1ZW50aWFsIil9fX07bGV0IGk9Mip0aGlzLnZlcnRleEVkZ2VzLmxlbmd0aDtmb3IobGV0IHQ9MDt0PHRoaXMudmVydGV4RWRnZXMubGVuZ3RoO3QrKyl7aWYobnVsbD09dGhpcy52ZXJ0ZXhFZGdlc1t0XSljb250aW51ZTtjb25zdCByPXRoaXMudmVydGV4RWRnZXNbdF0sbj1bXTtmb3IoY29uc3QgZSBvZiByKXtjb25zdCBzPXRoaXMuZWRnZVZlcnRzWzIqZV0sYT10aGlzLmVkZ2VWZXJ0c1syKmUrMV07bGV0IGkscj10aGlzLmVkZ2VGYWNlc1syKmVdLGg9dGhpcy5lZGdlRmFjZXNbMiplKzFdO2lmKHM9PXQpaT1hO2Vsc2V7aWYoYSE9dCl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdG9wb2xvZ3kiKTt7aT1zO2NvbnN0IHQ9cjtyPWgsaD10fX1uLnB1c2goW3IsaCxpXSl9cyhuKSxhKG4pO2xldCBoPTA7KC0xIT1uWzBdWzBdfHwtMSE9bltuLmxlbmd0aC0xXVsxXSkmJihoKz0xKSxlWzIqdF09aSxlWzIqdCsxXT1yLnNpemUrKGg8PDgpO2Zvcihjb25zdCB0IG9mIG4pZVtpXT10WzJdLGkrK31oLnZlcnRleE5laWdoYm9ycz1lfXJldHVybiBofWZyZWVCdWZmZXJzKCl7c3VwZXIuZnJlZUJ1ZmZlcnMoKSx0aGlzLmluaXQoKX1yZWFkQmluYXJ5KHQsZSl7c3VwZXIubG9hZEJhc2VHZW9tQmluYXJ5KHQpLHRoaXMuc2V0RmFjZUNvdW50cyh0LmxvYWRVSW50MzJBcnJheSgpKSx0aGlzLl9fZmFjZVZlcnRleENvdW50cz10LmxvYWRVSW50OEFycmF5KHRoaXMuX19mYWNlVmVydGV4Q291bnRzLmxlbmd0aCk7Y29uc3Qgcz10LmxvYWRTSW50MzJWZWMyKCksYT10LmxvYWRVSW50OCgpO2xldCByOzE9PWE/cj10LmxvYWRVSW50OEFycmF5KCk6Mj09YT9yPXQubG9hZFVJbnQxNkFycmF5KCk6ND09YSYmKHI9dC5sb2FkVUludDMyQXJyYXkoKSk7Y29uc3Qgbj10aGlzLmdldE51bUZhY2VzKCk7bGV0IGg9MCxvPTA7Zm9yKGxldCB0PTA7dDxuO3QrKyl7Y29uc3QgZT10aGlzLl9fZmFjZVZlcnRleENvdW50c1t0XSszO3RoaXMuX19mYWNlT2Zmc2V0c1t0XT1oO2ZvcihsZXQgYT0wO2E8ZTthKyspe2NvbnN0IGU9aCthLGk9cltlXStzLng7aWYoMD09dCl0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbZV09aTtlbHNle2xldCBzPXRoaXMuX19mYWNlT2Zmc2V0c1t0LTFdO3MrPWE8bz9hOm8tMSx0aGlzLl9fZmFjZVZlcnRleEluZGljZXNbZV09dGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzW3NdK2l9fWgrPWUsbz1lfXRoaXMuX19udW1Qb3B1bGF0ZWRGYWNlVmVydGV4SW5kaWNlcz1oO2NvbnN0IF89dC5sb2FkVUludDMyKCk7aWYoXz4wKXtjb25zdCBlPXRoaXMudmVydGljZXMscz10aGlzLmFkZFZlcnRleEF0dHJpYnV0ZSgibGlnaHRtYXBDb29yZHMiLGkpO2ZvcihsZXQgYT0wO2E8XzthKyspe2NvbnN0IGE9bmV3IG0odC5sb2FkRmxvYXQzMlZlYzMoKSx0LmxvYWRGbG9hdDMyUXVhdCgpKSxyPXQubG9hZEZsb2F0MzIoKSxuPXQubG9hZEZsb2F0MzJWZWMyKCksaD10LmxvYWRTSW50MzJWZWMyKCksbz10LmxvYWRVSW50OCgpO2xldCBfO189MT09bz90LmxvYWRVSW50OEFycmF5KCk6Mj09bz90LmxvYWRVSW50MTZBcnJheSgpOnQubG9hZFVJbnQzMkFycmF5KCk7bGV0IGQ9MDtmb3IoY29uc3QgdCBvZiBfKXtsZXQgbz10K2gueDtvKz1kLGQ9bztjb25zdCBfPXRoaXMuZ2V0RmFjZVZlcnRleEluZGljZXMobyk7Zm9yKGNvbnN0IHQgb2YgXyl7Y29uc3QgaD1lLmdldFZhbHVlUmVmKHQpLF89YS50cmFuc2Zvcm1WZWMzKGgpLGQ9bmV3IGkoXy54LF8ueik7ZC5zY2FsZUluUGxhY2UociksZC5hZGRJblBsYWNlKG4pLHMuc2V0RmFjZVZlcnRleFZhbHVlX0J5VmVydGV4SW5kZXgobyx0LGQpfX19fXRoaXMuaGFzVmVydGV4QXR0cmlidXRlKCJub3JtYWxzIil8fHRoaXMuY29tcHV0ZVZlcnRleE5vcm1hbHMoKSx0aGlzLmdlb21EYXRhQ2hhbmdlZC5lbWl0KCl9dG9KU09OKHQsZSl7Y29uc3Qgcz1zdXBlci50b0pTT04odCxlKTtyZXR1cm4gMTAyNCZlfHwocy5mYWNlQ291bnRzPUFycmF5LmZyb20odGhpcy5fX2ZhY2VDb3VudHMpLHMuZmFjZVZlcnRleEluZGljZXM9QXJyYXkuZnJvbSh0aGlzLl9fZmFjZVZlcnRleEluZGljZXMpKSxzfWZyb21KU09OKHQsZSxzKXtzdXBlci5mcm9tSlNPTih0LGUscyksdC5mYWNlQ291bnRzJiYodGhpcy5fX2ZhY2VDb3VudHM9VWludDMyQXJyYXkuZnJvbSh0LmZhY2VDb3VudHMpKSx0LmZhY2VWZXJ0ZXhJbmRpY2VzJiYodGhpcy5fX2ZhY2VWZXJ0ZXhJbmRpY2VzPVVpbnQzMkFycmF5LmZyb20odC5mYWNlVmVydGV4SW5kaWNlcykpfX1jbGFzcyBFe2NvbnN0cnVjdG9yKHQsZT0wLHM9ITApe3RoaXMuX19kYXRhPXQsdGhpcy5fX2J5dGVPZmZzZXQ9ZSx0aGlzLl9fZGF0YVZpZXc9bmV3IERhdGFWaWV3KHRoaXMuX19kYXRhKSx0aGlzLl9faXNNb2JpbGVEZXZpY2U9cyx0aGlzLnV0ZjhkZWNvZGVyPW5ldyBUZXh0RGVjb2Rlcn1nZXQgaXNNb2JpbGVEZXZpY2UoKXtyZXR1cm4gdGhpcy5fX2lzTW9iaWxlRGV2aWNlfWdldCBkYXRhKCl7cmV0dXJuIHRoaXMuX19kYXRhfWdldCBieXRlTGVuZ3RoKCl7cmV0dXJuIHRoaXMuX19kYXRhVmlldy5ieXRlTGVuZ3RofWdldCByZW1haW5pbmdCeXRlTGVuZ3RoKCl7cmV0dXJuIHRoaXMuX19kYXRhVmlldy5ieXRlTGVuZ3RoLXRoaXMuX19ieXRlT2Zmc2V0fXBvcygpe3JldHVybiB0aGlzLl9fYnl0ZU9mZnNldH1zZWVrKHQpe3RoaXMuX19ieXRlT2Zmc2V0PXR9YWR2YW5jZSh0KXt0aGlzLl9fYnl0ZU9mZnNldCs9dH1sb2FkVUludDgoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRVaW50OCh0aGlzLl9fYnl0ZU9mZnNldCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz0xLHR9bG9hZFVJbnQxNigpe2NvbnN0IHQ9dGhpcy5fX2RhdGFWaWV3LmdldFVpbnQxNih0aGlzLl9fYnl0ZU9mZnNldCwhMCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz0yLHR9bG9hZFVJbnQzMigpe2NvbnN0IHQ9dGhpcy5fX2RhdGFWaWV3LmdldFVpbnQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz00LHR9bG9hZFNJbnQzMigpe2NvbnN0IHQ9dGhpcy5fX2RhdGFWaWV3LmdldEludDMyKHRoaXMuX19ieXRlT2Zmc2V0LCEwKTtyZXR1cm4gdGhpcy5fX2J5dGVPZmZzZXQrPTQsdH1sb2FkRmxvYXQxNigpe2NvbnN0IHQ9dGhpcy5sb2FkVUludDE2KCk7cmV0dXJuIE1hdGguZGVjb2RlMTZCaXRGbG9hdCh0KX1sb2FkVUZsb2F0MTYoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MTYoKTtyZXR1cm4gdDwwPzIwNDgtdDp0fWxvYWRGbG9hdDE2RnJvbTJ4VUludDgoKXtjb25zdCB0PXRoaXMuX19kYXRhVmlldy5nZXRGbG9hdDE2KHRoaXMuX19ieXRlT2Zmc2V0LCEwKTtyZXR1cm4gdGhpcy5fX2J5dGVPZmZzZXQrPTIsdH1sb2FkVUludDMyRnJvbTJ4VUZsb2F0MTYoKXtyZXR1cm4gdGhpcy5sb2FkVUZsb2F0MTYoKSs0MDk2KnRoaXMubG9hZFVGbG9hdDE2KCl9bG9hZFNJbnQzMkZyb20yeEZsb2F0MTYoKXtyZXR1cm4gdGhpcy5sb2FkRmxvYXQxNigpKzIwNDgqdGhpcy5sb2FkRmxvYXQxNigpfWxvYWRGbG9hdDMyKCl7Y29uc3QgdD10aGlzLl9fZGF0YVZpZXcuZ2V0RmxvYXQzMih0aGlzLl9fYnl0ZU9mZnNldCwhMCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz00LHR9bG9hZFVJbnQ4QXJyYXkodCxlPSExKXtudWxsPT10JiYodD10aGlzLmxvYWRVSW50MzIoKSk7Y29uc3Qgcz1uZXcgVWludDhBcnJheSh0aGlzLl9fZGF0YSx0aGlzLl9fYnl0ZU9mZnNldCx0KTt0aGlzLl9fYnl0ZU9mZnNldCs9dDt0aGlzLl9fYnl0ZU9mZnNldDtyZXR1cm4gc31sb2FkVUludDE2QXJyYXkodCxlPSExKXtpZihudWxsPT10JiYodD10aGlzLmxvYWRVSW50MzIoKSksMD09dClyZXR1cm4gbmV3IFVpbnQxNkFycmF5O2xldCBzO2lmKHRoaXMucmVhZFBhZGQoMiksdGhpcy5fX2lzTW9iaWxlRGV2aWNlKXtzPW5ldyBVaW50MTZBcnJheSh0KTtmb3IobGV0IGU9MDtlPHQ7ZSsrKXNbZV09dGhpcy5fX2RhdGFWaWV3LmdldFVpbnQxNih0aGlzLl9fYnl0ZU9mZnNldCwhMCksdGhpcy5fX2J5dGVPZmZzZXQrPTJ9ZWxzZSBzPW5ldyBVaW50MTZBcnJheSh0aGlzLl9fZGF0YSx0aGlzLl9fYnl0ZU9mZnNldCx0KSx0aGlzLl9fYnl0ZU9mZnNldCs9Mip0O3JldHVybiBzfWxvYWRVSW50MzJBcnJheSh0LGU9ITEpe2lmKG51bGw9PXQmJih0PXRoaXMubG9hZFVJbnQzMigpKSwwPT10KXJldHVybiBuZXcgVWludDMyQXJyYXk7bGV0IHM7aWYodGhpcy5yZWFkUGFkZCg0KSx0aGlzLl9faXNNb2JpbGVEZXZpY2Upe3M9bmV3IFVpbnQzMkFycmF5KHQpO2ZvcihsZXQgZT0wO2U8dDtlKyspc1tlXT10aGlzLl9fZGF0YVZpZXcuZ2V0VWludDMyKHRoaXMuX19ieXRlT2Zmc2V0LCEwKSx0aGlzLl9fYnl0ZU9mZnNldCs9NH1lbHNlIHM9bmV3IFVpbnQzMkFycmF5KHRoaXMuX19kYXRhLHRoaXMuX19ieXRlT2Zmc2V0LHQpLHRoaXMuX19ieXRlT2Zmc2V0Kz00KnQ7cmV0dXJuIHN9bG9hZEZsb2F0MzJBcnJheSh0LGU9ITEpe2lmKG51bGw9PXQmJih0PXRoaXMubG9hZFVJbnQzMigpKSwwPT10KXJldHVybiBuZXcgRmxvYXQzMkFycmF5O2xldCBzO2lmKHRoaXMucmVhZFBhZGQoNCksdGhpcy5fX2lzTW9iaWxlRGV2aWNlKXtzPW5ldyBGbG9hdDMyQXJyYXkodCk7Zm9yKGxldCBlPTA7ZTx0O2UrKylzW2VdPXRoaXMuX19kYXRhVmlldy5nZXRGbG9hdDMyKHRoaXMuX19ieXRlT2Zmc2V0LCEwKSx0aGlzLl9fYnl0ZU9mZnNldCs9NH1lbHNlIHM9bmV3IEZsb2F0MzJBcnJheSh0aGlzLl9fZGF0YSx0aGlzLl9fYnl0ZU9mZnNldCx0KSx0aGlzLl9fYnl0ZU9mZnNldCs9NCp0O3JldHVybiBzfWxvYWRTdHIoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQzMigpLGU9bmV3IFVpbnQ4QXJyYXkodGhpcy5fX2RhdGEsdGhpcy5fX2J5dGVPZmZzZXQsdCk7cmV0dXJuIHRoaXMuX19ieXRlT2Zmc2V0Kz10LHRoaXMudXRmOGRlY29kZXIuZGVjb2RlKGUpfWxvYWRTdHJBcnJheSgpe2NvbnN0IHQ9dGhpcy5sb2FkVUludDMyKCksZT1bXTtmb3IobGV0IHM9MDtzPHQ7cysrKWVbc109dGhpcy5sb2FkU3RyKCk7cmV0dXJuIGV9bG9hZFNJbnQzMlZlYzIoKXtjb25zdCB0PXRoaXMubG9hZFNJbnQzMigpLGU9dGhpcy5sb2FkU0ludDMyKCk7cmV0dXJuIG5ldyBpKHQsZSl9bG9hZFVJbnQzMlZlYzIoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQzMigpLGU9dGhpcy5sb2FkVUludDMyKCk7cmV0dXJuIG5ldyBpKHQsZSl9bG9hZEZsb2F0MTZWZWMyKCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDE2KCksZT10aGlzLmxvYWRGbG9hdDE2KCk7cmV0dXJuIG5ldyBpKHQsZSl9bG9hZEZsb2F0MzJWZWMyKCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDMyKCksZT10aGlzLmxvYWRGbG9hdDMyKCk7cmV0dXJuIG5ldyBpKHQsZSl9bG9hZEZsb2F0MTZWZWMzKCl7Y29uc3QgdD10aGlzLmxvYWRGbG9hdDE2KCksZT10aGlzLmxvYWRGbG9hdDE2KCkscz10aGlzLmxvYWRGbG9hdDE2KCk7cmV0dXJuIG5ldyByKHQsZSxzKX1sb2FkRmxvYXQzMlZlYzMoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MzIoKSxlPXRoaXMubG9hZEZsb2F0MzIoKSxzPXRoaXMubG9hZEZsb2F0MzIoKTtyZXR1cm4gbmV3IHIodCxlLHMpfWxvYWRGbG9hdDE2UXVhdCgpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQxNigpLGU9dGhpcy5sb2FkRmxvYXQxNigpLHM9dGhpcy5sb2FkRmxvYXQxNigpLGE9dGhpcy5sb2FkRmxvYXQxNigpO3JldHVybiBuZXcgdSh0LGUscyxhKX1sb2FkRmxvYXQzMlF1YXQoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MzIoKSxlPXRoaXMubG9hZEZsb2F0MzIoKSxzPXRoaXMubG9hZEZsb2F0MzIoKSxhPXRoaXMubG9hZEZsb2F0MzIoKTtyZXR1cm4gbmV3IHUodCxlLHMsYSl9bG9hZFJHQkZsb2F0MzJDb2xvcigpe2NvbnN0IHQ9dGhpcy5sb2FkRmxvYXQzMigpLGU9dGhpcy5sb2FkRmxvYXQzMigpLHM9dGhpcy5sb2FkRmxvYXQzMigpO3JldHVybiBuZXcgbyh0LGUscyl9bG9hZFJHQkFGbG9hdDMyQ29sb3IoKXtjb25zdCB0PXRoaXMubG9hZEZsb2F0MzIoKSxlPXRoaXMubG9hZEZsb2F0MzIoKSxzPXRoaXMubG9hZEZsb2F0MzIoKSxhPXRoaXMubG9hZEZsb2F0MzIoKTtyZXR1cm4gbmV3IG8odCxlLHMsYSl9bG9hZFJHQlVJbnQ4Q29sb3IoKXtjb25zdCB0PXRoaXMubG9hZFVJbnQ4KCksZT10aGlzLmxvYWRVSW50OCgpLHM9dGhpcy5sb2FkVUludDgoKTtyZXR1cm4gbmV3IG8odC8yNTUsZS8yNTUscy8yNTUpfWxvYWRSR0JBVUludDhDb2xvcigpe2NvbnN0IHQ9dGhpcy5sb2FkVUludDgoKSxlPXRoaXMubG9hZFVJbnQ4KCkscz10aGlzLmxvYWRVSW50OCgpLGE9dGhpcy5sb2FkVUludDgoKTtyZXR1cm4gbmV3IG8odC8yNTUsZS8yNTUscy8yNTUsYS8yNTUpfWxvYWRCb3gyKCl7cmV0dXJuIG5ldyBnKHRoaXMubG9hZEZsb2F0MzJWZWMyKCksdGhpcy5sb2FkRmxvYXQzMlZlYzIoKSl9bG9hZEJveDMoKXtyZXR1cm4gbmV3IHAodGhpcy5sb2FkRmxvYXQzMlZlYzMoKSx0aGlzLmxvYWRGbG9hdDMyVmVjMygpKX1yZWFkUGFkZCh0KXtjb25zdCBlPXRoaXMuX19ieXRlT2Zmc2V0JXQ7MCE9ZSYmKHRoaXMuX19ieXRlT2Zmc2V0Kz10LWUpfX1jbGFzcyB2e2NvbnN0cnVjdG9yKHQpe2lmKHQpe2NvbnN0IGU9dC5zcGxpdCgiLSIpLHM9ZVswXS5zcGxpdCgiLiIpO3RoaXMubWFqb3I9cGFyc2VJbnQoc1swXSksdGhpcy5taW5vcj1wYXJzZUludChzWzFdKSx0aGlzLnBhdGNoPXBhcnNlSW50KHNbMl0pLDI9PWUubGVuZ3RoJiYodGhpcy5icmFuY2g9ZVsxXSl9ZWxzZSB0aGlzLm1ham9yPTAsdGhpcy5taW5vcj0wLHRoaXMucGF0Y2g9MH1lcXVhbHModCl7cmV0dXJuISh0aGlzLnBhdGNoPT10WzJdJiZ0aGlzLm1pbm9yPT10WzFdJiZ0aGlzLm1ham9yPT10WzBdKX1sZXNzVGhhbih0KXtyZXR1cm4hKHRoaXMubWFqb3I+PXRbMF18fHRoaXMubWlub3I+PXRbMV18fHRoaXMucGF0Y2g+PXRbMl0pfWdyZWF0ZXJUaGFuKHQpe3JldHVybiB0aGlzLm1ham9yPnRbMF18fHRoaXMubWlub3I+dFsxXXx8dGhpcy5wYXRjaD50WzJdfWdyZWF0ZXJPckVxdWFsVGhhbih0KXtyZXR1cm4hKHRoaXMubWFqb3I8dFswXSkmJih0aGlzLm1ham9yPnRbMF18fCEodGhpcy5taW5vcjx0WzFdKSYmKHRoaXMubWlub3I+dFsxXXx8ISh0aGlzLnBhdGNoPHRbMl0pKSl9fXNlbGYub25tZXNzYWdlPWZ1bmN0aW9uKHQpeygodCxlKT0+e2ZvcihsZXQgZSBpbiB0LmNvbnRleHQudmVyc2lvbnMpe2NvbnN0IHM9dC5jb250ZXh0LnZlcnNpb25zW2VdLGE9bmV3IHY7YS5tYWpvcj1zLm1ham9yLGEubWlub3I9cy5taW5vcixhLnBhdGNoPXMucGF0Y2gsYS5icmFuY2g9cy5icmFuY2gsdC5jb250ZXh0LnZlcnNpb25zW2VdPWF9Y29uc3Qgcz1bXSxpPXQudG9jW3QuZ2VvbXNSYW5nZVswXV0scj1bXTtmb3IobGV0IGU9dC5nZW9tc1JhbmdlWzBdO2U8dC5nZW9tc1JhbmdlWzFdO2UrKyl7Y29uc3Qgbj1uZXcgRSh0LmJ1ZmZlclNsaWNlLHQudG9jW2VdLWksdC5pc01vYmlsZURldmljZSksaD1uLmxvYWRTdHIoKSxvPW4ucG9zKCk7bGV0IF87c3dpdGNoKGgpe2Nhc2UiUG9pbnRzIjpfPW5ldyBBO2JyZWFrO2Nhc2UiTGluZXMiOl89bmV3IFM7YnJlYWs7Y2FzZSJNZXNoIjpfPW5ldyBQO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJVbnN1cHBvcnRlZCBHZW9tIHR5cGU6IitoKX10cnl7bi5zZWVrKG8pLF8ucmVhZEJpbmFyeShuLHQuY29udGV4dCl9Y2F0Y2godCl7Y29uc29sZS53YXJuKCJFcnJvciBsb2FkaW5nOiIrXy5uYW1lKyJcbjoiK3QpLHMucHVzaCh7fSk7Y29udGludWV9Y29uc3QgZD1fLmdlbkJ1ZmZlcnModC5nZW5CdWZmZXJzT3B0cyk7ZC5pbmRpY2VzJiZyLnB1c2goZC5pbmRpY2VzLmJ1ZmZlcik7Zm9yKGNvbnN0IHQgaW4gZC5hdHRyQnVmZmVycyl7Y29uc3QgZT1kLmF0dHJCdWZmZXJzW3RdLHM9YS5nZXRUeXBlTmFtZShlLmRhdGFUeXBlKTtlLmRhdGFUeXBlPXMsci5wdXNoKGUudmFsdWVzLmJ1ZmZlcil9ZC52ZXJ0ZXhOZWlnaGJvcnMmJnIucHVzaChkLnZlcnRleE5laWdoYm9ycy5idWZmZXIpLHIucHVzaChfLmJvdW5kaW5nQm94LnAwLl9fZGF0YS5idWZmZXIpLHIucHVzaChfLmJvdW5kaW5nQm94LnAxLl9fZGF0YS5idWZmZXIpLHMucHVzaCh7bmFtZTpfLm5hbWUsdHlwZTpoLGdlb21CdWZmZXJzOmQsYmJveDpfLmJvdW5kaW5nQm94fSl9ZSh7a2V5OnQua2V5LGdlb21JbmRleE9mZnNldDp0Lmdlb21JbmRleE9mZnNldCxnZW9tc1JhbmdlOnQuZ2VvbXNSYW5nZSxnZW9tRGF0YXM6c30scil9KSh0LmRhdGEsKHQsZSk9PntzZWxmLnBvc3RNZXNzYWdlKHQsZSl9KX07Cgo=",null,!1);var Ul=function(){function t(){this.rangeLoaded=new dr,this.streamFileParsed=new dr,this.loaded=new dr(!0),this.__streamInfos={},this.__genBuffersOpts={},this.__workers=[],this.__nextWorker=0;for(var t=0;t<3;t++)this.__workers.push(this.__constructWorker());this.clear()}t.prototype.clear=function(){this.__loaded=0,this.__numGeoms=0,this.geoms=[]};t.prototype.__constructWorker=function(){var t=this;var e=new zl;return e.onmessage=function(e){t.__recieveGeomDatas(e.data.key,e.data.geomDatas,e.data.geomIndexOffset,e.data.geomsRange)},e};t.prototype.__terminateWorkers=function(){for(var t=0,e=this.__workers;t<e.length;t++){var a=e[t];a.terminate()}this.__workers=[]};t.prototype.setGenBufferOption=function(t,e){this.__genBuffersOpts[t]=e};t.prototype.setNumGeoms=function(t){this.__numGeoms=t};t.prototype.getGeom=function(t){return t>=this.geoms.length?null:this.geoms[t]};t.prototype.loadUrl=function(t){var e=this;Nr(t,(function(t){e.loadBin(t)}),(function(t){console.warn(t)}))};t.prototype.readBinaryBuffer=function(t,e,a){var i=zn.isMobileDevice,n=new Hr(e,0,i),r=n.loadUInt32(),o=n.loadUInt32();if(this.__streamInfos[t]={total:r,done:0},0==r)return this.streamFileParsed.emit(1),r;0==this.__numGeoms&&(this.__numGeoms=r);var l=n.loadUInt32Array(r);var s=window.navigator.hardwareConcurrency;s||(s=i?2:4);var d=Math.max(1,Math.floor(r/s+1));var c=0;for(;c<r;){var u=l[c];var h=void 0,m=void 0;c+d>=r?(m=[c,r],h=e.byteLength):(m=[c,c+d],h=l[m[1]]);var p=e.slice(u,h);c+=d,this.__workers[this.__nextWorker].postMessage({key:t,toc:l,geomIndexOffset:o,geomsRange:m,isMobileDevice:n.isMobileDevice,bufferSlice:p,genBuffersOpts:this.__genBuffersOpts,context:a},[p]),this.__nextWorker=(this.__nextWorker+1)%this.__workers.length}return r};t.prototype.__recieveGeomDatas=function(t,e,a,i){var n=a+i[0],r=[n,a+i[1]];for(var o=0;o<e.length;o++){var l=e[o];if(!l.type)continue;var s=void 0;switch(l.type){case"Points":s=new ul(l);break;case"Lines":s=new hl(l);break;case"Mesh":case"Plane":case"Sphere":case"Cone":s=new ml(l);break;default:throw new Error("Unsupported Geom type:"+className)}this.geoms[n+o]=s}this.rangeLoaded.emit(r);var d=r[1]-r[0],c=this.__streamInfos[t];c.done+=d,c.done==c.total&&this.streamFileParsed.emit(1),this.__loaded+=d,this.__loaded==this.__numGeoms&&(this.__terminateWorkers(),this.loaded.emit())};t.prototype.toJSON=function(){return{numGeoms:this.geoms.length()}};t.prototype.toString=function(){return JSON.stringify(this.toJSON(),null,2)};return t}();var Jl=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__geomLibrary=new Ul,a.__materials=new el,a.loaded=new dr(!0),a.loaded.setToggled(!0);return a}e.prototype.isLoaded=function(){return this.loaded.isToggled()};e.prototype.getEngineDataVersion=function(){return this.__engineDataVersion};e.prototype.getGeometryLibrary=function(){return this.__geomLibrary};e.prototype.getMaterialLibrary=function(){return this.__materials};e.prototype.getUnitsConversion=function(){return this.__unitsScale};e.prototype.readBinary=function(e,a){var i=this;if(a===void 0){a={}}var n;a.assetItem=this,a.numTreeItems=0,a.numGeomItems=0,a.versions["zea-engine"]||(a.versions["zea-engine"]=new Er(e.loadStr())),this.__engineDataVersion=a.versions["zea-engine"],console.log("Loading Engine File version:",a.versions["zea-engine"]);var r={};a.addGeomToLayer=function(t,e){if(!r[e]){n||(n=new Tl("Layers"),i.addChild(n,!1));var a=new wl(e);a.propagateXfoToItems=!1,n.addChild(a,!1),r[e]=a}r[e].addItem(t)};var o=function(){i.__units=e.loadStr();var t=1;switch(i.__units){case"Millimeters":t=.001;break;case"Centimeters":t=.01;break;case"Meters":t=1;break;case"Kilometers":t=1e3;break;case"Inches":t=.0254;break;case"Feet":t=.3048;break;case"Miles":t=1609.34}i.__unitsScale=t;var a=i.getLocalXfo().clone();a.sc.scaleInPlace(t),i.setLocalXfo(a)};a.versions["zea-engine"].greaterThan([0,0,6])&&o(),this.__materials.readBinary(e,a),t.prototype.readBinary.call(this,e,a),a.versions["zea-engine"].greaterOrEqualThan([0,0,5])&&a.versions["zea-engine"].lessThan([0,0,7])&&o()};e.prototype.toJSON=function(e,a){var i=this;if(e===void 0){e={}}if(a===void 0){a=0}return e.makeRelative=function(t){var e=i.getPath(),a=t.slice(0,e.length);for(var n=0;n<a.length-1;n++)if(a[n]!=e[n])return console.warn("Param Path is not relative to the asset. May not be able to be resolved at load time:"+t),t;var r=t.slice(e.length-1);return r[0]=".",r},e.assetItem=this,t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i,n){var r=this;if(a===void 0){a={}}if(i===void 0){i=0}a||(a={}),a.assetItem=this,a.numTreeItems=0,a.numGeomItems=0,null==a.version&&(a.version=0),a.assetItem=this;var o=[];a.resolvePath=function(t,e){if(!t)throw new Error("Path not spcecified");var a=r.resolvePath(t);a?e(a):o.push((function(){var a=r.resolvePath(t);a?e(a):console.warn("Path unable to be resolved:"+t)}))},a.addPLCB=function(t){return o.push(t)},t.prototype.fromJSON.call(this,e,a,i);for(var l=0,s=o;l<s.length;l++){var d=s[l];d()}n&&n()};return e}(Tl);br.registerClass("AssetItem",Jl);var Pl=function(t){__extends(e,t);function e(e,a){var i=t.call(this,e)||this;var n=i.addParameter(new ao("Image"));a&&n.setValue(a),i.addParameter(new Br("PixelsPerMeter",1e3)),i.addParameter(new Br("Alpha",1)),i.addParameter(new qr("Color",new An(1,1,1))),i.addParameter(new Or("AlignedToCamera",!1));return i}return e}(Tl);br.registerClass("BillboardItem",Pl);var El=function(t){__extends(e,t);function e(e){var a=this;null==e&&(e="Camera"),a=t.call(this,e)||this,a.__isOrthographicParam=a.addParameter(new Or("isOrthographic",!1)),a.__fovParam=a.addParameter(new Br("fov",1)),a.__nearParam=a.addParameter(new Br("near",.1)),a.__farParam=a.addParameter(new Br("far",1e3)),a.__focalDistanceParam=a.addParameter(new Br("focalDistance",5)),a.projectionParamChanged=new dr,a.movementFinished=new dr,a.__isOrthographicParam.valueChanged.connect(a.projectionParamChanged.emit),a.__fovParam.valueChanged.connect(a.projectionParamChanged.emit),a.__nearParam.valueChanged.connect(a.projectionParamChanged.emit),a.__farParam.valueChanged.connect(a.projectionParamChanged.emit),a.setPositionAndTarget(new Dn(3,3,1.75),new Dn(0,0,1),gr.GENERATED_VALUE),a.setLensFocalLength("28mm",gr.GENERATED_VALUE);return a}e.prototype.getNear=function(){return this.__nearParam.getValue()};e.prototype.setNear=function(t){this.__nearParam.setValue(t)};e.prototype.getFar=function(){return this.__farParam.getValue()};e.prototype.setFar=function(t){this.__farParam.setValue(t)};e.prototype.getFov=function(){return this.__fovParam.getValue()};e.prototype.setFov=function(t){this.__fovParam.setValue(t)};e.prototype.setLensFocalLength=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}var a={"10mm":100.4,"11mm":95,"12mm":90,"14mm":81.2,"15mm":77.3,"17mm":70.4,"18mm":67.4,"19mm":64.6,"20mm":61.9,"24mm":53.1,"28mm":46.4,"30mm":43.6,"35mm":37.8,"45mm":29.9,"50mm":27,"55mm":24.6,"60mm":22.6,"70mm":19.5,"75mm":18.2,"80mm":17.1,"85mm":16.1,"90mm":15.2,"100mm":13.7,"105mm":13,"120mm":11.4,"125mm":11,"135mm":10.2,"150mm":9.1,"170mm":8.1,"180mm":7.6,"210mm":6.5,"300mm":4.6,"400mm":3.4,"500mm":2.7,"600mm":2.3,"800mm":1.7};!t in a?console.warn("Camera lense focal length not suported:"+t):this.__fovParam.setValue(Math.degToRad(a[t]),e)};e.prototype.getFocalDistance=function(){return this.__focalDistanceParam.getValue()};e.prototype.setFocalDistance=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}t<1e-4&&console.error("Never set focal distance to zero"),this.__focalDistanceParam.setValue(t,e),this.__nearParam.setValue(.01*t,e),this.__farParam.setValue(200*t,e)};e.prototype.getIsOrthographic=function(){return this.__isOrthographicParam.getValue()};e.prototype.setIsOrthographic=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}this.__isOrthographicParam.setValue(t,e)};e.prototype.setPositionAndTarget=function(t,e,a){if(a===void 0){a=gr.USER_SETVALUE}this.setFocalDistance(t.distanceTo(e),a);var i=new ar;i.setLookAt(t,e,new Dn(0,0,1)),this.setGlobalXfo(i,a)};e.prototype.getTargetPostion=function(){var t=this.__focalDistanceParam.getValue(),e=this.getGlobalXfo(),a=e.ori.getZaxis();return a.scaleInPlace(-t),a.addInPlace(e.tr),a};e.prototype.frameView=function(t,e,a){if(a===void 0){a=gr.USER_SETVALUE}var i=new rr;for(var n=0,r=e;n<r.length;n++){var o=r[n];i.addBox3(o.getBoundingBox())}if(!i.isValid())return void console.warn("Bounding box not valid.");var l=this.__focalDistanceParam.getValue(),s=this.__fovParam.getValue(),d=this.getGlobalXfo().clone(),c=d.ori.getZaxis(),u=c.scale(-l),h=d.tr.add(u),m=i.center().subtract(h);d.tr.addInPlace(m);var p=new rr;p.addBox3(i,d.inverse());p.center();var f=s*(t.getWidth()/t.getHeight()),b=p.p1,y=Math.abs(b.x)/Math.tan(.5*f)*1.2,g=Math.abs(b.y)/Math.tan(.5*s)*1.2,_=-.5*(p.p0.z-p.p1.z),Z=Math.max(y,g)+_,G=Z-l;d.tr.addInPlace(c.scale(G)),this.setFocalDistance(Z,a),this.setGlobalXfo(d,a),this.movementFinished.emit()};e.prototype.updateProjectionMatrix=function(t,e){this.__isOrthographicParam.getValue();var a=this.__fovParam.getValue(),i=this.__nearParam.getValue(),n=this.__farParam.getValue();t.setPerspectiveMatrix(a,e,i,n)};return e}(Tl);br.registerClass("Camera",El);var Hl=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.addParameter(new qr("BackgroundColor",new An("#808080"))),a.addParameter(new ao("EnvMap")),a.addParameter(new Or("Display EnvMap",!1)),a.addParameter(new Br("EnvMapLOD",0));return a}return e}(Wr);var kl=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.loaded.setToggled(!1),a.lightmap=null,a.geomsLoaded=new dr(!0),a.geomsLoaded.setToggled(!1),a.loaded.setToggled(!1),a.__geomLibrary.loaded.connect((function(){a.geomsLoaded.emit()})),a.__datafileParam=a.addParameter(new ro("DataFilePath")),a.__datafileParam.valueChanged.connect((function(){var t=a.__datafileParam.getFileDesc();if(t){if(console.log(t),""==a.getName()){var e=a.__datafileParam.getStem();a.setName(e)}a.geomsLoaded.setToggled(!1),a.loadDataFile((function(){a.loaded.isToggled()||a.loaded.emit()}),(function(){}))}})),a.addParameter(new qr("LightmapTint",new An(1,1,1,1)));return a}e.prototype.readBinary=function(e,a){if(-1!=a.version){var i=new Er;i.patch=a.version,a.versions={"zea-mesh":i,"zea-engine":i},a.meshSdk="FBX"}else{var n=e.loadUInt8();if(e.seek(0),10!=n){var r=new Er;r.patch=e.loadUInt32(),a.versions={"zea-mesh":r,"zea-engine":r},a.meshSdk="FBX"}else{var o=new Er(e.loadStr());a.versions={"zea-mesh":o},a.meshSdk="FBX"}}this.meshfileversion=a.versions["zea-mesh"],this.meshSdk=a.meshSdk,console.log("Loading CAD File version:",a.versions["zea-mesh"]," exported using SDK:",a.meshSdk);var l=e.loadUInt32();return t.prototype.readBinary.call(this,e,a),a.versions["zea-engine"].lessThan([0,0,5])&&e.seek(e.byteLength-4),this.__geomLibrary.setNumGeoms(e.loadUInt32()),l};e.prototype.loadDataFile=function(t,e){var a=this;var i=this.__datafileParam.getFileDesc();if(!i)return void console.warn("VLAAsset data file not found.");var n=this.__datafileParam.getFileFolderPath(),r=this.__datafileParam.getValue(),o=this.__datafileParam.getStem();var l=0;var s=new RegExp("\\.(vla)$","i").test(i.name),d=[],c=function(i){var n,o=-1;if(i.tree2)n=new Hr(i.tree2.buffer,0,zn.isMobileDevice);else{var c=i.tree?i.tree:i[Object.keys(i)[0]];n=new Hr(c.buffer,0,zn.isMobileDevice),o=0}l=a.readBinary(n,{assetItem:a,version:o}),s||l!=d.length&&console.error("The number of GeomFiles does not match the count given by the VLA file."),t(),0==l&&i.geoms0?(Pr.addWork(r+"geoms",1),a.__geomLibrary.readBinaryBuffer(r,i.geoms0.buffer,{version:o}),e()):(Pr.addWork(r+"geoms",4*l),u())},u=function(){var t=[];for(var a=0;a<l;a++)if(s){var i=n+o+a+".vlageoms",r=Pr.resolveFilepath(i);if(!r)throw new Error("VLA Geoms file not found:"+i);t.push(h(a,r.url))}else t.push(h(a,d[a].url));Promise.all(t).then((function(){e&&e()}))},h=function(t,e){return new Promise((function(i){Pr.loadUrl(r+t,e,(function(t){var e=t[Object.keys(t)[0]];a.__geomLibrary.readBinaryBuffer(r,e.buffer),i()}),!1)}))};if(s)Pr.loadResource(r,c);else if(i.metadata.ConvertFile){var m;i.metadata.ConvertFile.map((function(t){t.filename.endsWith(".vla")?m=t:t.filename.endsWith(".vlageoms")&&d.push(t)})),m?Pr.loadUrl(r,m.url,c):console.warn("ConvertFile metadata contains no vla file.")}this.__geomLibrary.streamFileParsed.connect((function(t){Pr.addWorkDone(r+"geoms",t)}))};e.prototype.fromJSON=function(e,a,i){var n=this;a||(a={}),a.assetItem=this;var r=function(){t.prototype.fromJSON.call(n,e,a,i),i&&i()};if(e.params&&e.params.DataFilePath){this.__datafileLoaded=r;var o=e.params.DataFilePath;delete e.params.DataFilePath,this.__datafileParam.fromJSON(o,a)}else r()};return e}(Jl);br.registerClass("VLAAsset",kl);var Bl=new An("#DCDCDC");var Dl=function(){function t(t){t&&Pr.setResources(t),this.settings=new Hl("Scene Settings"),this.root=new Tl("root"),this.root.addChild(this.settings),this.__commonResources={}}t.prototype.getSettings=function(){return this.settings};t.prototype.getRoot=function(){return this.root};t.prototype.getResourceLoader=function(){return Pr};t.prototype.setEnvMap=function(t){console.warn("Deprecated Function. Please access the Scene Settings object."),this.settings.getParameter("EnvMap").setValue(t)};t.prototype.addAsset=function(t){console.warn("Deprecated Function. Please access the Scene Root object."),this.root.addChild(t,!1)};t.prototype.setupGrid=function(t,e,a){if(t===void 0){t=5}if(e===void 0){e=50}if(a===void 0){a=Bl}var i=new Tl("Grid"),n=new yo("gridMaterial","LinesShader");n.getParameter("BaseColor").setValue(a);var r=new Zl(t,t,e,e,!0);i.addChild(new Yl("GridItem",r,n),!1);var o=new sl;o.setNumVertices(2),o.setNumSegments(1),o.setSegment(0,0,1),o.getVertex(0).set(-.5*t,0,0),o.getVertex(1).set(.5*t,0,0);var l=new yo("gridXAxisMaterial","LinesShader");l.getParameter("BaseColor").setValue(new An(a.luminance(),0,0)),i.addChild(new Yl("xAxisLine",o,l),!1);var s=new yo("gridZAxisMaterial","LinesShader");s.getParameter("BaseColor").setValue(new An(0,a.luminance(),0));var d=new ar;d.ori.setFromAxisAndAngle(new Dn(0,0,1),.5*Math.PI);var c=new Yl("yAxisLine",o,s);return c.setGeomOffsetXfo(d),i.addChild(c,!1),i.setSelectable(!1,!0),i.setFlag(xr.IGNORE_BBOX),i.clearFlag(xr.USER_EDITED),i.setFlag(xr.INVISIBLE),this.root.addChild(i,!1),i};t.prototype.loadCommonAssetResource=function(t){if(t in this.__commonResources)return this.__commonResources[t];var e=new kl;return e.getParameter("DataFilePath").setValue(t),this.__commonResources[t]=e,e};t.prototype.toJSON=function(t,e){if(t===void 0){t={}}if(e===void 0){e=0}return t.makeRelative=function(t){return t},{root:this.root.toJSON(t,e)}};t.prototype.fromJSON=function(t,e){var a=this;if(e===void 0){e={}}var i=[];e.resolvePath=function(t,e){if(!t)throw new Error("Path not spcecified");var n=a.root.resolvePath(t);n?e(n):i.push((function(){var i=a.resolvePath(t);i?e(i):console.warn("Path unable to be resolved:"+t)}))},e.addPLCB=function(t){return i.push(t)},e.settings=this.settings,t.root&&this.root.fromJSON(t.root,e);for(var n=0,r=i;n<r.length;n++){var o=r[n];o()}};return t}();var Ol=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.geomsLoaded=new dr(!0),a.geomsLoaded.setToggled(!1),a.loaded.setToggled(!1),a.addParameter(new Or("splitObjects",!1)),a.addParameter(new Or("splitGroupsIntoObjects",!1)),a.addParameter(new Or("loadMtlFile",!0)),a.addParameter(new Br("unitsConversion",1)),a.addParameter(new io("defaultShader","")),a.objfileParam=a.addParameter(new ro("ObjFilePath")),a.objfileParam.valueChanged.connect((function(){a.loaded.untoggle(),a.__loadObj((function(){a.loaded.emit()}),(function(){a.geomsLoaded.emit()}))})),a.geomLibrary=new Ul,a.materials=new el;return a}e.prototype.getGeometryLibrary=function(){return this.geomLibrary};e.prototype.getMaterialLibrary=function(){return this.materials};e.prototype.__loadObj=function(t,e){var a=this;var i=this.objfileParam.getStem(),n=function(t){var e=t.split("\n"),i=/\s+/;var n;var r=function(t){if(3==t.length)return new An(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]));throw new Error("Unable to parse a color from the following parts:"+t.join("_"))},o=function(t){var e=a.objfileParam.getFileFolder();return new FileImage(t[0],e+t[0])};for(var l=0;l<e.length;l++){var s=e[l].trim();if(s.startsWith("#"))continue;-1!=s.indexOf("#")&&(s=s.substring(0,s.indexOf("#")).trim());var d=s.split(i),c=d.shift(),u=d.join(" ");switch(c){case"newmtl":n=new yo(u),n.setShaderName("StandardSurfaceShader"),a.materials.addMaterial(n);break;case"Kd":n.getParameter("BaseColor").setValue(r(d));break;case"map_Kd":n.getParameter("BaseColor").setValue(o(d));break;case"Ks":var h=(parseFloat(d[0])+parseFloat(d[1])+parseFloat(d[2]))/3;n.roughness=1-h,n.getParameter("Roughness").setValue(1-h),n.getParameter("Reflectance").setValue(h);break;case"map_Ks":n.getParameter("Roughness").setValue(o(d)),n.getParameter("Reflectance").setValue(.2);break;case"d":var m=parseFloat(u);m<1&&(n.setShaderName("TransparentSurfaceShader"),n.getParameter("Opacity").setValue(m));break;case"map_d":n.getParameter("alpha").setValue(parseFloat(d));break;case"map_bump":n.getParameter("normal").setValue(o(d))}}},r=new ur;r.incAsyncCount(),r.ready.connect((function(){h()}));var o=function(t){return new Promise((function(e){Mr(t.url,(function(t){Pr.addWorkDone(i,1),n(t),r.decAsyncCount(),Pr.addWorkDone(i,1),e()}))}))},l=new Array,s=new Array,d=new Array,c={},u=function(t){return __awaiter(a,void 0,void 0,(function(){var e,a,n,u,h,m,p,f,b,y,g,_,Z,G,X,v,V,I,R,x,S,W,L,T,M;return __generator(this,(function(F){switch(F.label){case 0:e=t.split("\n"),a=/\s+/;n=void 0,u=void 0;h=function(t){var e=0;for(;t in c;)e++,t+=String(e);n={verticesRemapping:{},texCoordsRemapping:{},normalsRemapping:{},vertexIndices:[],texCoordIndices:[],normalIndices:[],numVertices:0,numTexCoords:0,numNormals:0,numTris:0,numQuads:0,material:u},c[t]=n};h(i);m=this.getParameter("splitGroupsIntoObjects").getValue();p=0;F.label=1;case 1:if(!(p<e.length))return[3,15];f=e[p].trim();if(f.startsWith("#"))return[3,14];-1!=f.indexOf("#")&&(f=f.substring(0,f.indexOf("#")).trim());b=f.split(a),y=b.shift(),g=b.join(" ");_=y;switch(_){case"":return[3,2];case"s":return[3,2];case"mtllib":return[3,3];case"o":return[3,6];case"usemtl":return[3,7];case"g":return[3,8];case"v":return[3,9];case"vt":return[3,10];case"vn":return[3,11];case"f":return[3,12]}return[3,13];case 2:return[3,14];case 3:if(!this.getParameter("loadMtlFile").getValue())return[3,14];r.incAsyncCount(),Pr.addWork(i,2);Z=this.objfileParam.getFileFolderPath(),G=Pr.resolveFilepath(Z+g);X=G;if(!X)return[3,5];return[4,o(G)];case 4:X=F.sent();F.label=5;case 5:X;return[3,14];case 6:h(g);return[3,14];case 7:u=g,h(g+Object.keys(c).length);return[3,14];case 8:m&&h(b.join("_"));return[3,14];case 9:l.push(b.map((function(t){return parseFloat(t)})));return[3,14];case 10:d.push(b.map((function(t){return parseFloat(t)})));return[3,14];case 11:s.push(b.map((function(t){return parseFloat(t)})));return[3,14];case 12:{v=[],V=[],I=[];for(R=0,x=b.length;R<x;R++){S=b[R].split("/").map((function(t){return parseInt(t)-1})),W=S[0];L=n.verticesRemapping[W];if(null==L&&(L=n.numVertices,n.verticesRemapping[W]=L,n.numVertices++),v.push(L),S.length>1&&!isNaN(S[1])){T=S[1];V.push(T)}if(S.length>2&&!isNaN(S[2])){M=S[2];I.push(M)}}n.vertexIndices.push(v),I.length>0&&n.normalIndices.push(I),V.length>0&&n.texCoordIndices.push(V),3==v.length?n.numTris++:n.numQuads++;return[3,14]}F.label=13;case 13:console.warn("Unhandled line:"+f);F.label=14;case 14:p++;return[3,1];case 15:r.decAsyncCount();return[2]}}))}))},h=function(){for(var a in c)0!=c[a].numVertices&&m(a,c[a]);t(),e()},m=function(t,e){var i=e.numVertices,n=new dl(t);n.setFaceCounts([e.numTris,e.numQuads]),n.setNumVertices(i);var r=n.getVertexAttribute("positions"),o=a.getParameter("unitsConversion").getValue();for(var c in e.verticesRemapping){var u=e.verticesRemapping[c];r.getValueRef(u).set(l[c][0]*o,l[c][1]*o,l[c][2]*o)}var h,m;e.normalIndices.length>0&&(h=n.addVertexAttribute("normals",Dn)),e.texCoordIndices.length>0&&(m=n.addVertexAttribute("texCoords",Bn));for(var p=0;p<e.vertexIndices.length;p++){var f=e.vertexIndices[p];if(n.setFaceVertexIndices.apply(n,__spreadArrays([p],f)),h){var b=e.normalIndices[p];for(var y=0;y<b.length;y++){var g=new Dn(s[b[y]][0],s[b[y]][1],s[b[y]][2]);h.setFaceVertexValue(p,y,g)}}if(m&&e.texCoordIndices.length==e.vertexIndices.length){var _=e.texCoordIndices[p];for(var Z=0;Z<_.length;Z++){var G=new Bn(d[_[Z]][0],d[_[Z]][1]);m.setFaceVertexValue(p,Z,G)}}}var X=new Yl(t,n);X.selectable=!0;var v=n.boundingBox.center();if(n.moveVertices(v.negate()),X.setLocalXfo(new ar(v)),null!=e.material&&a.materials.hasMaterial(e.material))X.setMaterial(a.materials.getMaterial(e.material));else{var V=a.getParameter("defaultShader").getValue(),I=new yo(t+"mat");I.setShaderName(""!=V?V:"StandardSurfaceShader");var R=I.getParameter("BaseColor");if(R)R.setValue(An.random(.5));else{var x=I.getParameter("Color");x&&x.setValue(An.random(.5))}var S=I.getParameter("Roughness");S&&S.setValue(.6);var W=I.getParameter("Reflectance");W&&W.setValue(.2),a.materials.addMaterial(I),X.setMaterial(I)}a.addChild(X,!1)};(function(){var t=a.objfileParam.getFileDesc(),e=a.objfileParam.getStem();Pr.addWork(e,2),Mr(t.url,(function(t){Pr.addWorkDone(e,1),u(t),Pr.addWorkDone(e,1)}))})()};return e}(Jl);var Ql=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.setFlag(xr.USER_EDITED),a.__outputs=[],a.__evalOutput=a.__evalOutput.bind(a),a.postEval=new dr;return a}e.prototype.setDirty=function(){for(var t=0,e=this.__outputs;t<e.length;t++){var a=e[t];a.setDirtyFromOp()}};e.prototype.__parameterValueChanged=function(t,e){this.setDirty()};e.prototype.addOutput=function(t){var e=this;return this.__outputs.push(t),t.paramSet.connect((function(t){t.bindOperator(e)})),t};e.prototype.removeOutput=function(t){t.getParam()&&t.getParam().unbindOperator(this),this.__outputs.splice(this.__outputs.indexOf(t),1)};e.prototype.getNumOutputs=function(){return this.__outputs.length};e.prototype.getOutputByIndex=function(t){return this.__outputs[t]};e.prototype.getOutput=function(t){for(var e=0,a=this.__outputs;e<a.length;e++){var i=a[e];if(i.getName()==t)return i}};e.prototype.__evalOutput=function(t){for(var e=0,a=this.__outputs;e<a.length;e++){var i=a[e];i.removeCleanerFn(this.__evalOutput)}this.evaluate()};e.prototype.__opInputChanged=function(){this.setDirty()};e.prototype.evaluate=function(){throw new Error("Not yet implemented")};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);i.type=br.getClassName(this);var n=[];for(var r=0,o=this.__outputs;r<o.length;r++){var l=o[r];n.push(l.toJSON(e,a))}return i.outputs=n,i};e.prototype.fromJSON=function(e,a,i){var n=this;if(t.prototype.fromJSON.call(this,e,a,i),e.outputs){for(var r=0;r<this.__outputs.length;r++){this.__outputs[r].fromJSON(e.outputs[r],a)}a.addPLCB((function(){n.__opInputChanged()}))}};e.prototype.detach=function(){this.__outputs.forEach((function(t){return t.detach()}))};e.prototype.reattach=function(){this.__outputs.forEach((function(t){return t.reattach()}))};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__outputs=[]};return e}(Wr);var Al=function(){function t(t,e){this.__name=t,this.__filterFn=e,this._param=void 0,this.detached=!1,this.paramSet=new dr}t.prototype.getName=function(){return this.__name};t.prototype.getFilterFn=function(){return this.__filterFn};t.prototype.isConnected=function(){return null!=this._param};t.prototype.getParam=function(){return this._param};t.prototype.setParam=function(t){this._param=t,this.paramSet.emit()};t.prototype.getValue=function(t){if(t===void 0){t=yr.OPERATOR_GETVALUE}if(this._param)return this._param.getValue(t)};t.prototype.setValue=function(t,e){if(e===void 0){e=gr.OPERATOR_SETVALUE}this._param&&this._param.setValue(t,e)};t.prototype.setClean=function(t){this._param&&this._param.setClean(t)};t.prototype.setDirty=function(t){this._param&&this._param.setDirty(t)};t.prototype.setDirtyFromOp=function(){this._param&&this._param.setDirtyFromOp()};t.prototype.removeCleanerFn=function(t){this._param&&this._param.removeCleanerFn(t)};t.prototype.toJSON=function(t,e){var a=this._param?this._param.getPath():"";return{type:br.getClassName(this),paramPath:t&&t.makeRelative?t.makeRelative(a):a}};t.prototype.fromJSON=function(t,e,a){var i=this;t.paramPath&&e.resolvePath(t.paramPath,(function(t){i.setParam(t)}),(function(e){console.warn("Operator Output: '"+i.getName()+"'. Unable to load item:"+t.paramPath)}))};t.prototype.detach=function(){this.detached=!0};t.prototype.reattach=function(){this.detached=!1};return t}();br.registerClass("OperatorOutput",Al);var jl=function(t){__extends(e,t);function e(e){return t.call(this,e,(function(t){return"Xfo"==t.getDataType()}))||this}e.prototype.getInitialValue=function(){return this._initialParamValue};e.prototype.setParam=function(t){var e=this;(function(){if(e._initialParamValue=t.getValue(),e._initialParamValue.clone&&(e._initialParamValue=e._initialParamValue.clone()),null==e._initialParamValue)throw new Error("WTF?")})(),this._param=t,this.paramSet.emit(t)};return e}(Al);br.registerClass("XfoOperatorOutput",jl);var ql=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__stageParam=a._addMember(new Br("Stage",0)),a.__axisParam=a._addMember(new Ar("Axis",new Dn(1,0,0))),a.__movementParam=a._addMember(new Qr("MovementTiming",new Bn(0,1),[new Bn(0,0),new Bn(1,1)])),a.__multiplierParam=a._addMember(new Br("Multiplier",1)),a.__output=new jl("Part");return a}e.prototype.getStage=function(t){if(t===void 0){t=gr.USER_GETVALUE}return this.__stageParam.getValue(t)};e.prototype.setStage=function(t,e){if(e===void 0){e=gr.USER_SETVALUE}this.__stageParam.setValue(t,e)};e.prototype.getOutput=function(){return this.__output};e.prototype.evaluate=function(t,e,a,i,n,r,o,l){if(!this.__output.isConnected())return;var s=this.__stageParam.getValue(),d=this.__movementParam.getValue();var c;if(n){var u=s/i;r&&(u-=.5),c=e*Math.linStep(d.x,d.y,Math.max(0,t-u))}else{var h=1-s/i;r&&(h-=.5),c=e*Math.linStep(d.x,d.y,t)*h}c+=a;var m=this.__axisParam.getValue();var p=this.__multiplierParam.getValue(),f=this.__output.getInitialValue();var b;o?(b=l.multiply(f),m=o.ori.rotateVec3(m),b.tr.addInPlace(m.scale(c*p))):(b=this.__output.getValue(),b.tr=f.tr.add(m.scale(c*p))),this.__output.setClean(b)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return i&&(i.output=this.__output.toJSON(e,a)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.output&&this.__output.fromJSON(e.output,a)};return e}(lo);var $l=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__stagesParam=a.addParameter(new Br("Stages",0)),a._explodeParam=a.addParameter(new Br("Explode",0,[0,1])),a._distParam=a.addParameter(new Br("Dist",1)),a._offsetParam=a.addParameter(new Br("Offset",0)),a._cascadeParam=a.addParameter(new Or("Cascade",!1)),a._centeredParam=a.addParameter(new Or("Centered",!1)),a.__parentItemParam=a.addParameter(new so("RelativeTo")),a.__parentItemParam.valueChanged.connect((function(){var t=a.__parentItemParam.getValue();a.__invParentSpace=t?t.getGlobalXfo().inverse():void 0})),a.__parentItemParam.treeItemGlobalXfoChanged.connect((function(){a.setDirty()})),a.__itemsParam=a.addParameter(new oo("Parts",ql)),a.__itemsParam.elementAdded.connect((function(t,e){if(e>0){var i=a.__itemsParam.getElement(e-1).getStage();t.setStage(i+1),a.__stagesParam.setClean(i+2)}else a.__stagesParam.setClean(1);a.addOutput(t.getOutput()),a.setDirty()})),a.__itemsParam.elementRemoved.connect((function(t,e){a.removeOutput(t.getOutput())})),a.__localXfos=[],a.__parts=[],a.__stages=2;return a}e.prototype.evaluate=function(){var t=this.__stagesParam.getValue(),e=this._explodeParam.getValue(),a=this._distParam.getValue(),i=this._offsetParam.getValue(),n=this._cascadeParam.getValue(),r=this._centeredParam.getValue(),o=this.__parentItemParam.getValue();var l,s;o&&(l=o.getGlobalXfo(),s=this.__invParentSpace.multiply(l));var d=this.__itemsParam.getValue();for(var c=0;c<d.length;c++){d[c].evaluate(e,a,i,t,n,r,l,s)}};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i)};e.prototype.destroy=function(){clearTimeout(this.__timeoutId),t.prototype.destroy.call(this)};return e}(Ql);br.registerClass("ExplodePartsOperator",$l);var ts=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__ratioParam=a._addMember(new Br("Ratio",1)),a.__offsetParam=a._addMember(new Br("Offset",0)),a.__axisParam=a._addMember(new Ar("Axis",new Dn(1,0,0))),a.__output=new jl("Gear");return a}e.prototype.getOutput=function(){return this.__output};e.prototype.getRatio=function(){return this.__ratioParam.getValue()};e.prototype.getOffset=function(){return this.__offsetParam.getValue()};e.prototype.getAxis=function(){return this.__axisParam.getValue()};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return i&&(i.output=this.__output.toJSON(e,a)),i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.output&&this.__output.fromJSON(e.output,a)};return e}(lo);var es=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__revolutionsParam=a.addParameter(new Br("Revolutions",0));var i=a.addParameter(new Br("RPM",0));i.valueChanged.connect((function(){var t=i.getValue();if(Math.abs(t)>0){if(!a.__timeoutId){var e=function(){var t=i.getValue(),n=a.__revolutionsParam.getValue();a.__revolutionsParam.setValue(n+t*(1/3e3)),a.__timeoutId=setTimeout(e,20)};e()}}else clearTimeout(a.__timeoutId),a.__timeoutId=void 0})),a.__gearsParam=a.addParameter(new oo("Gears",ts)),a.__gearsParam.elementAdded.connect((function(t,e){a.addOutput(t.getOutput())})),a.__gearsParam.elementRemoved.connect((function(t,e){a.removeOutput(e)})),a.__gears=[];return a}e.prototype.evaluate=function(){var t=this.__revolutionsParam.getValue(),e=this.__gearsParam.getValue();for(var a=0,i=e;a<i.length;a++){var n=i[a];var r=n.getOutput(),o=r.getInitialValue();if(!o)return;var l=t*n.getRatio()+n.getOffset(),s=new tr;s.setFromAxisAndAngle(n.getAxis(),l*Math.PI*2);var d=r.getValue();d.ori=s.multiply(o.ori),r.setClean(d)}};e.prototype.detach=function(){t.prototype.detach.call(this),this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=null)};e.prototype.reattach=function(){t.prototype.reattach.call(this),this.getParameter("RPM").valueChanged.emit()};e.prototype.destroy=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=null),t.prototype.destroy.call(this)};return e}(Ql);br.registerClass("GearsOperator",es);var as=function(t){__extends(e,t);function e(){var e=this;e=t.call(this,"Piston")||this,e.__pistonAngleParam=e._addMember(new Br("PistonAngle",0)),e.__camPhaseParam=e._addMember(new Br("CamPhase",0)),e.__camLengthParam=e._addMember(new Br("CamLength",3)),e.__rodLengthParam=e._addMember(new Br("RodLength",3)),e.__rodoutput=new jl("Rod"),e.__capoutput=new jl("Cap"),e.__pistonAngleParam.valueChanged.connect(e.init.bind(e)),e.__camPhaseParam.valueChanged.connect(e.init.bind(e)),e.__camLengthParam.valueChanged.connect(e.init.bind(e)),e.__rodLengthParam.valueChanged.connect(e.init.bind(e)),e.__bindXfos={};return e}e.prototype.getRodOutput=function(){return this.__rodoutput};e.prototype.getCapOutput=function(){return this.__capoutput};e.prototype.setCrankXfo=function(t){this.__baseCrankXfo=t,this.init()};e.prototype.init=function(){if(!this.__baseCrankXfo)return;var t=this.__camPhaseParam.getValue(),e=this.__camLengthParam.getValue(),a=this.__rodLengthParam.getValue(),i=this.__pistonAngleParam.getValue(),n=new Dn(Math.sin(Math.degToRad(i)),Math.cos(Math.degToRad(i)),0);this.__pistonAxis=this.__baseCrankXfo.ori.rotateVec3(n),this.__camVec=this.__baseCrankXfo.ori.rotateVec3(new Dn(Math.sin(2*t*Math.PI)*e,Math.cos(2*t*Math.PI)*e,0));var r=2*t*Math.PI,o=Math.sin(r)*e,l=Math.sqrt(a*a-o*o)+Math.cos(r)*e;this.__pistonOffset=l};e.prototype.evaluate=function(t,e,a){var i=this.__camPhaseParam.getValue(),n=this.__camLengthParam.getValue(),r=this.__rodLengthParam.getValue(),o=2*(i+a)*Math.PI,l=Math.sin(o)*n,s=Math.asin(l/r),d=Math.sqrt(r*r-l*l)+Math.cos(o)*n;if(this.__rodoutput.isConnected()){var c=this.__rodoutput.getInitialValue().clone(),u=this.__rodoutput.getValue(),h=u.tr.subtract(this.__baseCrankXfo.tr).dot(e),m=new tr;m.setFromAxisAndAngle(e,-s),u.tr=this.__baseCrankXfo.tr.add(t.rotateVec3(this.__camVec)),u.tr.addInPlace(e.scale(h)),u.ori=m.multiply(c.ori),this.__rodoutput.setValue(u)}if(this.__capoutput.isConnected()){var p=this.__capoutput.getInitialValue().clone(),f=this.__capoutput.getValue();f.tr=p.tr.add(this.__pistonAxis.scale(d-this.__pistonOffset)),this.__capoutput.setValue(f)}};e.prototype.setOwner=function(t){this.__owner=t};e.prototype.getOwner=function(){return this.__owner};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i)};e.prototype.clone=function(t){return new e(this.__name,this.__value)};return e}(lo);var is=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__revolutionsParam=a.addParameter(new Br("Revolutions",0,[0,1]));var i=a.addParameter(new Br("RPM",0));i.valueChanged.connect((function(){var t=i.getValue();if(t>0){if(!a.__timeoutId){var e=function(){t=i.getValue();var n=a.__revolutionsParam.getValue();a.__revolutionsParam.setValue(n+t*(1/3e3)),a.__timeoutId=setTimeout(e,20)};e()}}else clearTimeout(a.__timeoutId),a.__timeoutId=void 0})),a.__crankOutput=a.addOutput(new jl("Crank")),a.__crankOutput.paramSet.connect(a.init.bind(a)),a.__crankAxisParam=a.addParameter(new Ar("CrankAxis",new Dn(1,0,0))),a.__crankAxisParam.valueChanged.connect((function(){a.__baseCrankXfo.ori.setFromDirectionAndUpvector(a.__crankAxisParam.getValue(),new Dn(0,0,1)),a.init()})),a.__pistonsParam=a.addParameter(new oo("Pistons",as)),a.__pistonsParam.elementAdded.connect((function(t){t.setCrankXfo(a.__baseCrankXfo),a.addOutput(t.getRodOutput()),a.addOutput(t.getCapOutput())})),a.__pistonsParam.elementRemoved.connect((function(t){a.removeOutput(t.getRodOutput()),a.removeOutput(t.getCapOutput())})),a.__baseCrankXfo=new ar,a.__pistons=[];return a}e.prototype.setOwner=function(e){t.prototype.setOwner.call(this,e)};e.prototype.getCrankOutput=function(){return this.__crankOutput};e.prototype.init=function(){var t=this.__pistonsParam.getValue();for(var e=0,a=t;e<a.length;e++){var i=a[e];i.setCrankXfo(this.__baseCrankXfo)}this.__crankOutput.isConnected()&&(this.__crankOffset=this.__baseCrankXfo.inverse().multiply(this.__crankOutput.getInitialValue()))};e.prototype.evaluate=function(){var t=this.__revolutionsParam.getValue(yr.OPERATOR_GETVALUE),e=this.__crankAxisParam.getValue(yr.OPERATOR_GETVALUE),a=new tr;if(a.setFromAxisAndAngle(e,t*Math.PI*2),this.__crankOutput.isConnected()){var i=this.__crankOutput.getValue();i.ori=a.multiply(this.__crankOutput.getInitialValue().ori),this.__crankOutput.setValue(i)}var n=this.__pistonsParam.getValue(),r=n.length;for(var o=0;o<r;o++){n[o].evaluate(a,e,t)}this.postEval.emit(t)};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),e.crankOutput&&this.__crankOutput.fromJSON(e.crankOutput,a),this.init()};e.prototype.destroy=function(){clearTimeout(this.__timeoutId),t.prototype.destroy.call(this)};return e}(Ql);br.registerClass("PistonOperator",is);var ns=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__inputParam=a.addParameter(new Br("Input")),a.__routesParam=a.addParameter(new oo("Routes",Br)),a.__routesParam.elementAdded.connect((function(t){t.setValue(1),a.addOutput(new Al("Output"))})),a.__routesParam.elementRemoved.connect((function(t,e){a.removeOutput(a.getOutputByIndex(e))}));return a}e.prototype.evaluate=function(){var t=this.__inputParam.getValue(yr.OPERATOR_GETVALUE),e=this.__routesParam.getValue();var a=this.__outputs.length;for(;a--;){this.__outputs[a].setValue(t*e[a].getValue(yr.OPERATOR_GETVALUE))}this.postEval.emit(t)};e.prototype.toJSON=function(e,a){return t.prototype.toJSON.call(this,e,a)};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i)};e.prototype.destroy=function(){t.prototype.destroy.call(this)};return e}(Ql);br.registerClass("RouterOperator",ns);var rs=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.addParameter(new Br("Weight",1)),a.addParameter(new Dr("Axis",0,["+X Axis","-X Axis","+Y Axis","-Y Axis","+Z Axis","-Z Axis"])),a.addParameter(new Br("Stretch",0)),a.addParameter(new Br("Initial Dist",1)),a.addParameter(new eo("Target")),a.addOutput(new jl("InputOutput"));return a}e.prototype.resetStretchRefDist=function(){var t=this.getParameter("Target").getValue(),e=this.getOutputByIndex(0).getValue(),a=t.tr.subtract(e.tr).length();this.getParameter("Initial Dist").setValue(a)};e.prototype.evaluate=function(){var t=this.getParameter("Weight").getValue(),e=this.getParameter("Target").getValue(),a=this.getParameter("Axis").getValue(),i=this.getOutputByIndex(0),n=i.getValue(),r=e.tr.subtract(n.tr),o=r.length();if(o<1e-6)return;var l;switch(r.scaleInPlace(1/o),a){case 0:l=n.ori.getXaxis();break;case 1:l=n.ori.getXaxis().negate();break;case 2:l=n.ori.getYaxis();break;case 3:l=n.ori.getYaxis().negate();break;case 4:l=n.ori.getZaxis();break;case 5:l=n.ori.getZaxis().negate()}var s=new tr;s.setFrom2Vectors(l,r),s.alignWith(new tr),t<1&&(s=(new tr).lerp(s,t)),n.ori=s.multiply(n.ori);var d=this.getParameter("Stretch").getValue();if(d>0){var c=1+(o/this.getParameter("Initial Dist").getValue()-1)*d;switch(a){case 0:case 1:n.sc.x=c;break;case 2:case 3:n.sc.y=c;break;case 4:case 5:n.sc.z=c}}i.setClean(n)};return e}(Ql);br.registerClass("AimOperator",rs);var os=function(t){__extends(e,t);function e(e){var a=this;null==e&&(e="Camera"),a=t.call(this,e)||this,a.__defaultManipulationState="orbit",a.__manipulationState=a.__defaultManipulationState,a.__mouseDown=!1,a.__dragging=!1,a.__mouseDragDelta=new Bn,a.__keyboardMovement=!1,a.__keysPressed=[],a.__maxVel=.002,a.__velocity=new Dn,a.__ongoingTouches={},a.__orbitRateParam=a.addParameter(new Br("orbitRate",zn.isMobileDevice?-.3:1)),a.__dollySpeedParam=a.addParameter(new Br("dollySpeed",.02)),a.__mouseWheelDollySpeedParam=a.addParameter(new Br("mouseWheelDollySpeed",5e-4)),a.movementFinished=new dr;return a}e.prototype.setDefaultManipulationMode=function(t){this.__defaultManipulationState=t};e.prototype.look=function(t,e){var a=t.viewport,i=a.getCamera(),n=i.getFocalDistance(),r=this.__orbitRateParam.getValue();if(this.__keyboardMovement){var o=i.getGlobalXfo();this.__mouseDownCameraXfo=o.clone(),this.__mouseDownZaxis=o.ori.getZaxis();var l=this.__mouseDownZaxis.scale(-n);this.__mouseDownCameraTarget=o.tr.add(l)}var s=this.__mouseDownCameraXfo.clone(),d=new tr;d.rotateZ(e.x/a.getWidth()*Math.PI*r),s.ori=d.multiply(s.ori);var c=new tr;c.rotateX(e.y/a.getHeight()*Math.PI*r),s.ori.multiplyInPlace(c),i.setGlobalXfo(s)};e.prototype.orbit=function(t,e){var a=t.viewport,i=a.getCamera(),n=i.getFocalDistance(),r=this.__orbitRateParam.getValue();if(this.__keyboardMovement){var o=i.getGlobalXfo();this.__mouseDownCameraXfo=o.clone(),this.__mouseDownZaxis=o.ori.getZaxis();var l=this.__mouseDownZaxis.scale(-n);this.__mouseDownCameraTarget=o.tr.add(l)}var s=this.__mouseDownCameraXfo.clone(),d=new tr;d.rotateZ(e.x/a.getWidth()*2*Math.PI*-r),s.ori=d.multiply(s.ori);var c=new tr;c.rotateX(e.y/a.getHeight()*Math.PI*-r),s.ori.multiplyInPlace(c),s.tr=this.__mouseDownCameraTarget.add(s.ori.getZaxis().scale(n)),i.setGlobalXfo(s)};e.prototype.pan=function(t,e){var a=t.viewport,i=a.getCamera(),n=i.getFocalDistance(),r=i.getFov(),o=new Dn(1,0,0),l=new Dn(0,1,0),s=2*n*Math.tan(.5*r),d=s*(a.getWidth()/a.getHeight()),c=new ar;c.tr=o.scale(-e.x/a.getWidth()*d),c.tr.addInPlace(l.scale(e.y/a.getHeight()*s)),i.setGlobalXfo(this.__mouseDownCameraXfo.multiply(c))};e.prototype.dolly=function(t,e){var a=t.viewport,i=a.getCamera(),n=e.x*this.__dollySpeedParam.getValue(),r=new ar;r.tr.set(0,0,n),i.setGlobalXfo(this.__mouseDownCameraXfo.multiply(r))};e.prototype.panAndZoom=function(t,e,a){var i=t.viewport,n=i.getCamera(),r=n.getFocalDistance(),o=n.getFov(),l=new Dn(1,0,0),s=new Dn(0,1,0),d=2*r*Math.tan(.5*o),c=d*(i.getWidth()/i.getHeight()),u=new ar;u.tr=l.scale(-e.x/i.getWidth()*c),u.tr.addInPlace(s.scale(e.y/i.getHeight()*d));var h=a*r;n.setFocalDistance(this.__mouseDownFocalDist+h),u.tr.z+=h,n.setGlobalXfo(this.__mouseDownCameraXfo.multiply(u))};e.prototype.initDrag=function(t){var e=t.viewport,a=e.getCamera(),i=a.getFocalDistance();this.__mouseDown=!0,this.__calculatingDragAction=!1,this.__mouseDownPos=t.mousePos,this.__mouseDownViewport=e,this.__mouseDragDelta.set(0,0),this.__mouseDownCameraXfo=a.getGlobalXfo().clone(),this.__mouseDownZaxis=this.__mouseDownCameraXfo.ori.getZaxis();var n=this.__mouseDownZaxis.scale(-i);this.__mouseDownCameraTarget=a.getGlobalXfo().tr.add(n),this.__mouseDownFocalDist=i,this.__dragListenerId=a.getParameter("GlobalXfo").valueChanged.connect(this.__globalXfoChangedDuringDrag.bind(this))};e.prototype.__globalXfoChangedDuringDrag=function(t){if(!this.__calculatingDragAction){this.__mouseDownViewport.getCamera().getParameter("GlobalXfo").valueChanged.disconnectId(this.__dragListenerId),this.initDrag({viewport:this.__mouseDownViewport,mousePos:this.__mouseDownPos})}};e.prototype.endDrag=function(t){if(this.__dragListenerId){var e=t.viewport;e.getCamera().getParameter("GlobalXfo").valueChanged.disconnectId(this.__dragListenerId),this.__dragListenerId=null}this.__mouseDown=!1,this.__dragging=!1};e.prototype.aimFocus=function(t,e){var a=this;var i=t.viewport,n=i.getCamera();this.__focusIntervalId&&clearInterval(this.__focusIntervalId);var r=0;var o=function(){var t=n.getGlobalXfo(),i=n.getFocalDistance(),l=e.subtract(t.tr),s=l.normalizeInPlace(),d=new tr,c=new tr;{var u=t.ori.getZaxis().clone();u.z=0;var h=l.negate();h.z=0,d.setFrom2Vectors(u,h)}{var m=t.ori.getZaxis().clone(),p=l.negate();m.x=p.x,m.y=p.y,m.normalizeInPlace(),m.cross(p).dot(t.ori.getXaxis())>0?c.rotateX(m.angleTo(p)):c.rotateX(-m.angleTo(p))}var f=t.clone();f.ori=d.multiply(f.ori),f.ori.multiplyInPlace(c);var b=Math.pow(r/20,2),y=t.clone();y.ori=t.ori.lerp(f.ori,b),n.setFocalDistance(i+(s-i)*b),n.setGlobalXfo(y),r++,r<=20?a.__focusIntervalId=setTimeout(o,20):(a.__focusIntervalId=void 0,a.movementFinished.emit())};o(),this.__manipulationState="focussing"};e.prototype.onMouseMove=function(t){};e.prototype.onDoubleClick=function(t){if(t.intersectionData){var e=t.viewport.getCamera().getGlobalXfo().tr.add(t.mouseRay.dir.scale(t.intersectionData.dist));this.aimFocus(t,e)}};e.prototype.onMouseDown=function(t){this.initDrag(t),2==t.button?this.__manipulationState="pan":t.ctrlKey&&t.altKey?this.__manipulationState="dolly":t.ctrlKey||2==t.button?this.__manipulationState="look":this.__manipulationState=this.__defaultManipulationState};e.prototype.onMouseMove=function(t){if(!this.__mouseDown)return;var e=t.mousePos;switch(this.__calculatingDragAction=!0,this.__keyboardMovement?this.__mouseDragDelta=e:this.__mouseDragDelta=e.subtract(this.__mouseDownPos),this.__manipulationState){case"orbit":this.orbit(t,this.__mouseDragDelta);break;case"look":this.look(t,this.__mouseDragDelta);break;case"pan":this.pan(t,this.__mouseDragDelta);break;case"dolly":this.dolly(t,this.__mouseDragDelta)}this.__dragging=!0,this.__calculatingDragAction=!1,t.stopPropagation()};e.prototype.onMouseUp=function(t){this.__dragging&&(this.movementFinished.emit(),t.stopPropagation()),this.endDrag(t)};e.prototype.onWheel=function(t){var e=this;var a=t.viewport,i=a.getCamera(),n=this.__mouseWheelDollySpeedParam.getValue(),r=t.shiftKey?.1:.5,o=i.getGlobalXfo(),l=o.ori.getZaxis();this.__mouseWheelZoomIntervalId&&clearInterval(this.__mouseWheelZoomIntervalId);var s=0;var d=function(){var a=i.getFocalDistance(),c=t.deltaY*n*a*r;o.tr.addInPlace(l.scale(c)),"orbit"==e.__defaultManipulationState&&i.setFocalDistance(i.getFocalDistance()+c),i.setGlobalXfo(o),s++,s<10?e.__mouseWheelZoomIntervalId=setTimeout(d,10):(e.__mouseWheelZoomIntervalId=void 0,e.movementFinished.emit())};d()};e.prototype.__integrateVelocityChange=function(t){var e=t.viewport,a=e.getCamera(),i=new ar;i.tr=this.__velocity.normalize().scale(this.__maxVel),a.setGlobalXfo(a.getGlobalXfo().multiply(i))};e.prototype.onKeyPressed=function(t,e){return!1};e.prototype.onKeyDown=function(t,e){};e.prototype.onKeyUp=function(t,e){};e.prototype.__startTouch=function(t){this.__ongoingTouches[t.identifier]={identifier:t.identifier,pos:new Bn(t.pageX,t.pageY)}};e.prototype.__endTouch=function(t){delete this.__ongoingTouches[t.identifier]};e.prototype.onTouchStart=function(t){console.log("onTouchStart"),t.preventDefault(),t.stopPropagation(),0==Object.keys(this.__ongoingTouches).length&&(this.__manipMode=void 0);var e=t.changedTouches;for(var a=0;a<e.length;a++)this.__startTouch(e[a]);1==Object.keys(this.__ongoingTouches).length&&(this.initDrag(t),this.__dragging=!0)};e.prototype.onTouchMove=function(t){t.preventDefault(),t.stopPropagation(),this.__calculatingDragAction=!0;var e=t.touches;if(1==e.length&&"panAndZoom"!=this.__manipMode){var a=e[0],i=new Bn(a.pageX,a.pageY),n=this.__ongoingTouches[a.identifier].pos.subtract(i);"look"==this.__defaultManipulationState?(n.scaleInPlace(6),this.look(t,n)):this.orbit(t,n)}else if(2==e.length){var r=e[0],o=this.__ongoingTouches[r.identifier],n=e[1],l=this.__ongoingTouches[n.identifier],s=new Bn(r.pageX,r.pageY),d=new Bn(n.pageX,n.pageY),c=l.pos.subtract(o.pos).length()-d.subtract(s).length(),u=s.subtract(o.pos),h=d.subtract(l.pos),m=u.add(h);m.scaleInPlace(.5),this.panAndZoom(t,m,.002*c),this.__manipMode="panAndZoom"}this.__calculatingDragAction=!1};e.prototype.onTouchEnd=function(t){t.preventDefault(),t.stopPropagation();var e=t.changedTouches;for(var a=0;a<e.length;a++)this.__endTouch(e[a]);0==Object.keys(this.__ongoingTouches).length&&this.endDrag(t)};e.prototype.onTouchCancel=function(t){t.preventDefault();var e=t.touches;for(var a=0;a<e.length;a++)this.__endTouch(e[a]);0==Object.keys(this.__ongoingTouches).length&&this.endDrag(t)};e.prototype.onDoubleTap=function(t){if(t.intersectionData){var e=t.viewport,a=e.getCamera().getGlobalXfo().tr.add(t.touchRay.dir.scale(t.intersectionData.dist));this.aimFocus(t,a)}t.preventDefault()};return e}(Rr);var ls=Object.freeze({__proto__:null,RefCounted:fr,ParameterOwner:Rr,ItemFlags:xr,BaseItem:Wr,getFileFolder:Lr,loadTextfile:Mr,loadJSONfile:Fr,loadXMLfile:Cr,loadBinfile:Nr,sgFactory:br,isObject:Ur,mergeDeep:Jr,resourceLoader:Pr,Version:Er,BinReader:Hr,BinWriter:kr,ParamFlags:_r,ValueGetMode:yr,ValueSetMode:gr,BaseParameter:vr,Parameter:Vr,MultiChoiceParameter:Dr,BooleanParameter:Or,NumberParameter:Br,Vec2Parameter:Qr,Vec3Parameter:Ar,Vec4Parameter:jr,ColorParameter:qr,Mat3Parameter:$r,Mat4Parameter:to,XfoParameter:eo,ImageParameter:ao,StringParameter:io,CodeParameter:no,FilePathParameter:ro,ListParameter:oo,StructParameter:lo,TreeItemParameter:so,ItemSetParameter:co,ProxyParameter:uo,GeometryParameter:ho,MaterialParameter:il,MaterialFloatParam:po,MaterialColorParam:fo,Attribute:nl,BaseGeom:rl,SAVE_FLAG_SKIP_GEOMDATA:1024,VertexAttribute:ol,Points:ll,Lines:sl,Mesh:dl,PointsProxy:ul,LinesProxy:hl,MeshProxy:ml,PointGrid:pl,Rect:fl,Circle:bl,Cross:yl,LinesCuboid:_l,Grid:Zl,Cone:Gl,Cuboid:Xl,Cylinder:vl,Disc:Vl,Plane:Il,Sphere:Rl,Torus:xl,DataImage:go,FileImage:Yo,FileImage2D:Ko,LDRImage:zo,LDRVideo:Uo,GIFImage:Jo,EnvMap:jo,Label:$o,VideoStreamImage2D:tl,labelManager:qo,SaveFlags:Sl,LoadFlags:Wl,CloneFlags:Ll,TreeItem:Tl,InstanceItem:Ml,AudioItem:Fl,FileAudioItem:Cl,BaseGeomItem:Nl,GeomItem:Yl,AssetItem:Jl,BillboardItem:Pl,Camera:El,Group:wl,GeomLibrary:Ul,Material:yo,BaseImage:mo,MaterialLibrary:el,Scene:Dl,VLAAsset:kl,ObjAsset:Ol,Operator:Ql,OperatorOutput:Al,XfoOperatorOutput:jl,ExplodePartsOperator:$l,GearsOperator:es,PistonOperator:is,RouterOperator:ns,AimOperator:rs,CameraMouseAndKeyboard:os});var ss=function(t,e){console.log(zn);var a=null;if(null!=e.webglContextType)try{a=t.getContext(e.webglContextType,e),a.name=e.webglContextType}catch(t){}else{["webgl2","webgl"].some((function(i){try{a=t.getContext(i,e),a.name=i}catch(t){}if(a)return!0}))}if(a)return a.sizeInBytes=function(t){switch(t){case this.BYTE:case this.UNSIGNED_BYTE:return 1;case this.SHORT:case this.UNSIGNED_SHORT:return 2;case this.INT:case this.UNSIGNED_INT:case this.FLOAT:return 4;default:throw new Error("unknown type")}},"webgl2"==a.name?(a.floatTexturesSupported=!0,a.__ext_float_linear=a.getExtension("OES_texture_float_linear"),a.__ext_texture_half_float_linear=a.getExtension("OES_texture_half_float_linear"),a.__ext_color_buffer_float=a.getExtension("EXT_color_buffer_float")):(a.__ext_float=a.getExtension("OES_texture_float"),a.__ext_float?(a.floatTexturesSupported=!0,a.__ext_float_linear=a.getExtension("OES_texture_float_linear")):console.warn("OES_texture_float is not available"),a.__ext_half_float=a.getExtension("OES_texture_half_float"),a.__ext_half_float&&(a.HALF_FLOAT=a.__ext_half_float.HALF_FLOAT_OES,a.floatTexturesSupported=!0,a.__ext_texture_half_float_linear=a.getExtension("OES_texture_half_float_linear")),a.__ext_color_buffer_float=a.getExtension("EXT_color_buffer_float"),a.__ext_std_derivatives=a.getExtension("OES_standard_derivatives"),a.__ext_Inst=a.getExtension("ANGLE_instanced_arrays"),a.__ext_Inst&&(a.vertexAttribDivisor=a.__ext_Inst.vertexAttribDivisorANGLE.bind(a.__ext_Inst),a.drawArraysInstanced=a.__ext_Inst.drawArraysInstancedANGLE.bind(a.__ext_Inst),a.drawElementsInstanced=a.__ext_Inst.drawElementsInstancedANGLE.bind(a.__ext_Inst)),a.__ext_VAO=a.getExtension("OES_vertex_array_object"),a.__ext_VAO&&(a.createVertexArray=a.__ext_VAO.createVertexArrayOES.bind(a.__ext_VAO),a.deleteVertexArray=a.__ext_VAO.deleteVertexArrayOES.bind(a.__ext_VAO),a.bindVertexArray=a.__ext_VAO.bindVertexArrayOES.bind(a.__ext_VAO)),a.__ext_element_index_uint=a.getExtension("OES_element_index_uint"),a.__ext_WEBGL_depth_texture=a.getExtension("WEBGL_depth_texture"),a.__ext_WEBGL_depth_texture&&(a.UNSIGNED_INT_24_8=a.__ext_WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL),a.DRAW_FRAMEBUFFER=a.FRAMEBUFFER),a.__ext_frag_depth=a.getExtension("EXT_frag_depth"),a.setupInstancedQuad=function(){var t=new Float32Array([0,1,2,3]),e=new Uint16Array([0,1,2,2,1,3]);this.__quadVertexIdsBuffer=this.createBuffer(),this.bindBuffer(this.ARRAY_BUFFER,this.__quadVertexIdsBuffer),this.bufferData(this.ARRAY_BUFFER,t,this.STATIC_DRAW),this.__quadIndexBuffer=this.createBuffer(),this.bindBuffer(this.ELEMENT_ARRAY_BUFFER,this.__quadIndexBuffer),this.bufferData(this.ELEMENT_ARRAY_BUFFER,e,this.STATIC_DRAW),this.__quadattrbuffers={vertexIDs:{buffer:this.__quadVertexIdsBuffer,dataType:6,dimension:1,count:t.length,shared:!0}}},a.drawQuad=function(){this.drawElements(this.TRIANGLES,6,this.UNSIGNED_SHORT,0)},a.setupLineSegAttrBuffers=function(){var t=new Float32Array([0,1]),e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e),a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW),a.__linesegattrbuffers={vertexIDs:{buffer:e,dimension:1,count:t.length,shared:!0}}},a};var ds=function(t){__extends(e,t);function e(e,a){var i=this;if(i=t.call(this)||this,i.__gl=e,i.ready=new dr(!0),i.updated=new dr,i.resized=new dr,i.width=0,i.height=0,i.textureType=1,i.textureDesc=[0,0,0,0],i.__loaded=!1,i.__bound=!1,null!=a)if(a instanceof mo){i.__texture=a,i.__texture.setMetadata("gltexture",i);var n=function(){var t=i.__texture.getParams(),e=t.width,a=t.height,n=t.data;i.bufferData(n,e,a)};i.__texture.isLoaded()?(i.configure(i.__texture.getParams()),i.__texture.updated.connect(n)):i.__texture.loaded.connect((function(){i.configure(i.__texture.getParams()),i.__texture.updated.connect(n)}))}else i.configure(a);return i}e.prototype.isLoaded=function(){return this.__loaded};e.prototype.getTexture=function(){return this.__texture};e.prototype.getInternalFormat=function(){return this.__internalFormat};e.prototype.getType=function(){return this.__typeParam};e.prototype.getTypeID=function(){return this.__type};e.prototype.getFormat=function(){return this.__formatParam};e.prototype.getFormatID=function(){return this.__format};e.prototype.getFilter=function(){return this.__filterParam};e.prototype.getWrap=function(){return this.__wrapParam};e.prototype.getMipMapped=function(){return this.__mipMapped};e.prototype.configure=function(t,e){if(e===void 0){e=!0}if(!("type"in t&&"format"in t&&"width"in t&&"height"in t))throw new Error("Invalid texture params");var a=this.__gl,i=t.width,n=t.height,r=t.data,o=a.getParameter(a.MAX_TEXTURE_SIZE);if(i<=0||i>o||n<=0||n>o)throw new Error("gl-texture2d: Invalid texture size. width:"+i+" height:"+n+" maxSize:"+o);var l=t.format,s=t.type;var d="minFilter"in t?t.minFilter:"filter"in t?t.filter:"LINEAR",c="magFilter"in t?t.magFilter:"filter"in t?t.filter:"LINEAR";var u="wrap"in t?t.wrap:"CLAMP_TO_EDGE";if("FLOAT"==s)if(this.textureType=3,"webgl2"==a.name)"LINEAR"!=d||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),c="NEAREST");else if(a.__ext_float)"LINEAR"!=d||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_float_linear||(console.warn("Floating point texture filtering not supported on this device"),c="NEAREST");else{if(!a.__ext_half_float)throw new Error("OES_texture_half_float is not available");s="HALF_FLOAT","LINEAR"!=d||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),c="NEAREST")}else if("HALF_FLOAT"==s)if("webgl2"==a.name);else{if(!a.supportUploadingHalfFloat&&null!=r)throw new Error("Safari does not support uploading HALF_FLOAT texture data.");if(!a.__ext_half_float)throw new Error("OES_texture_half_float is not available");if("LINEAR"!=d||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),d="NEAREST"),"LINEAR"!=c||a.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on this device"),c="NEAREST"),"RGB"==l)throw new Error("OES_texture_half_float onlysupports RGBA textures")}else if("sRGB"==s&&!a.__ext_sRGB)throw new Error("EXT_sRGB is not available");this.__formatParam=l,this.__typeParam=s,this.__minFilterParam=d,this.__magFilterParam=c,this.__wrapParam=u,this.__format=a[l],this.__internalFormat="internalFormat"in t?a[t.internalFormat]:this.__format,this.__type=a[s],"webgl2"==a.name&&("internalFormat"in t||(this.__type==a.FLOAT?this.__format==a.RED?this.__internalFormat=a.R32F:this.__format==a.RG?this.__internalFormat=a.RG32F:this.__format==a.RGB?this.__internalFormat=a.RGB32F:this.__format==a.RGBA&&(this.__internalFormat=a.RGBA32F):this.__type==a.HALF_FLOAT?this.__format==a.RED?this.__internalFormat=a.R16F:this.__format==a.RG?this.__internalFormat=a.RG16F:this.__format==a.RGB?this.__internalFormat=a.RGB16F:this.__format==a.RGBA&&(this.__internalFormat=a.RGBA16F):this.__type==a.UNSIGNED_BYTE&&(this.__format==a.RED&&(this.__internalFormat=a.R8),this.__format==a.RG&&(this.__internalFormat=a.RG8),this.__format==a.RGB?this.__internalFormat=a.RGB8:this.__format==a.RGBA&&(this.__internalFormat=a.RGBA8)))),this.__minFilter=a[d],this.__magFilter=a[c],this.__wrap=a[u],this.__flipY="flipY"in t&&t.flipY,this.__mipMapped="mipMapped"in t&&t.mipMapped,this.invert="invert"in t&&t.invert,this.alphaFromLuminance="alphaFromLuminance"in t&&t.alphaFromLuminance,this.textureDesc=[i,n,0,0],this.__gltex&&a.deleteTexture(this.__gltex),this.__gltex=a.createTexture(),this.__updateGLTexParams(),r?this.bufferData(r,i,n,!1,!1):this.resize(i,n,!1,!1),this.__loaded||(this.ready.emit(),this.__loaded=!0)};e.prototype.__updateGLTexParams=function(){var t=this.__gl;t.bindTexture(t.TEXTURE_2D,this.__gltex),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.__minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.__magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.__wrap),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.__wrap)};e.prototype.bufferData=function(t,e,a,i,n){if(e===void 0){e=-1}if(a===void 0){a=-1}if(i===void 0){i=!0}if(n===void 0){n=!0}var r=this.__gl;if(i&&r.bindTexture(r.TEXTURE_2D,this.__gltex),null!=t){if(t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,this.__format,this.__type,t),this.width=t.width,this.height=t.height;else{-1==e&&(e=this.width),-1==a&&(a=this.height);var o=e*a;var l;switch(this.__format){case r.RED:case r.RED_INTEGER:case r.ALPHA:case r.LUMINANCE:case r.LUMINANCE_ALPHA:l=1;break;case r.RG:l=2;break;case r.RGB:l=3;break;case r.RGBA:l=4}t.length!=o*l&&console.warn("Invalid data for Image width:"+e+" height:"+a+" format:"+this.__formatParam+" type:"+this.__typeParam+" Data Length:"+t.length+" Expected:"+o*l),this.__type==r.HALF_FLOAT&&t instanceof Float32Array&&(t=Math.convertFloat32ArrayToUInt16Array(t)),"webgl2"==r.name?r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,e,a,0,this.__format,this.__type,t,0):r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,e,a,0,this.__format,this.__type,t),this.width=e,this.height=a}this.__mipMapped&&r.generateMipmap(r.TEXTURE_2D)}else r.texImage2D(r.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,null),this.width=e,this.height=a;n&&this.updated.emit()};e.prototype.clear=function(){var t=this.__gl,e=this.width*this.height;var a,i;switch(this.__format){case t.RED:case t.RED_INTEGER:case t.ALPHA:case t.LUMINANCE:case t.LUMINANCE_ALPHA:a=1;break;case t.RG:a=2;break;case t.RGB:a=3;break;case t.RGBA:a=4;break;default:throw new Error("Invalid Format")}switch(this.__type){case t.UNSIGNED_BYTE:i=new UInt8Array(e*a);break;case t.HALF_FLOAT:i=new UInt16Array(e*a);break;case t.FLOAT:i=new Float32Array(e*a);break;default:throw new Error("Invalid Type")}"webgl2"==t.name?t.texImage2D(t.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,i,0):t.texImage2D(t.TEXTURE_2D,0,this.__internalFormat,this.width,this.height,0,this.__format,this.__type,i)};e.prototype.resize=function(t,e,a,i){if(a===void 0){a=!1}if(i===void 0){i=!0}var n=this.__gl;if(this.width!=t||this.height!=e){var r=n.getParameter(n.MAX_TEXTURE_SIZE);if(t<0||t>r||e<0||e>r)throw new Error("gl-texture2d: Invalid texture size. width:"+t+" height:"+e+" maxSize:"+r);if(a){var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,this.__internalFormat,t,e,0,this.__format,this.__type,null);var l=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,l),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.__gltex,0),n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,this.__internalFormat,0,0,this.width,this.height,0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteFramebuffer(l),this.__gl.deleteTexture(this.__gltex),this.__gltex=o,this.__updateGLTexParams()}else n.bindTexture(n.TEXTURE_2D,this.__gltex),n.texImage2D(n.TEXTURE_2D,0,this.__internalFormat,t,e,0,this.__format,this.__type,null);this.width=t,this.height=e,i&&this.resized.emit(t,e)}};e.prototype.populate=function(t,e,a,i,n,r){if(i===void 0){i=0}if(n===void 0){n=0}if(r===void 0){r=!0}var o=this.__gl;r&&o.bindTexture(o.TEXTURE_2D,this.__gltex),o.texSubImage2D(o.TEXTURE_2D,0,i,n,e,a,this.__format,this.__type,t)};e.prototype.getSize=function(){return[this.width,this.height]};Object.defineProperty(e.prototype,"glTex",{get:function(){return this.__gltex},enumerable:true,configurable:true});e.prototype.getTexHdl=function(){return this.__gltex};e.prototype.bind=function(t,e){return console.warn("'bind' is deprecated. Please use 'bindToUniform'"),this.bindToUniform(t,e)};e.prototype.preBind=function(t,e){return{textureTypeUnif:e[t.name+"Type"],textureDescUnif:e[t.name+"Desc"]}};e.prototype.bindToUniform=function(t,e,a){if(!this.__loaded)return!1;if(!this.__gltex)throw new Error("Unable to bind non-initialized or deleted texture.");var i=t.boundTextures++,n=this.__gl.TEXTURE0+i,r=this.__gl;return r.activeTexture(n),r.bindTexture(r.TEXTURE_2D,this.__gltex),r.uniform1i(e.location,i),a&&(a.textureTypeUnif&&r.uniform1i(a.textureTypeUnif.location,this.textureType),a.textureDescUnif&&this.__gl.uniform4fv(a.textureDescUnif.location,this.textureDesc)),!0};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__texture&&this.__texture.setMetadata("gltexture",void 0),this.__gl.deleteTexture(this.__gltex),this.__gltex=void 0};return e}(fr);var cs=function(){function t(t,e,a,i){this.__gl=t,this.__shaderAttrs=e,this.__glattrbuffers=a,this.__indexBuffer=i}t.prototype.bind=function(t){var e=this.__gl;for(var a in this.__shaderAttrs){if("instancedIds"==a)continue;var i=this.__shaderAttrs[a],n=i.location;if(-1==n)continue;var r=this.__glattrbuffers[a];if(!r){e.disableVertexAttribArray(n);continue}var o=void 0,l=void 0,s=void 0;switch(r.dataType){case 0:o=1,l=4,s=e.UNSIGNED_BYTE;break;case 1:o=1,l=4,s=e.BYTE;break;case 2:o=1,l=4,s=e.UNSIGNED_SHORT;break;case 3:o=1,l=4,s=e.SHORT;break;case 4:o=1,l=4,s=e.UNSIGNED_INT;break;case 5:o=1,l=4,s=e.INT;break;case 6:o=1,l=4,s=e.FLOAT;break;case Bn:o=2,l=4,s=e.FLOAT;break;case Dn:o=3,l=4,s=e.FLOAT;break;case On:case An:o=4,l=4,s=e.FLOAT;break;case Qn:o=4,l=1,s=e.UNSIGNED_BYTE;break;default:throw"Unhandled Type"}var d=o*l,c=null!=r.offset?r.offset*o*l:0,u=1==r.normalized,h=i.instanced;e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.vertexAttribPointer(n,o,s,u,d,c),e.vertexAttribDivisor&&(1==h?e.vertexAttribDivisor(n,1):e.vertexAttribDivisor(n,0))}return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),!0};t.prototype.unbind=function(){var t=this.__gl;for(var e in this.__shaderAttrs){var a=this.__shaderAttrs[e].location;-1!=a&&(t.disableVertexAttribArray(a),t.vertexAttribDivisor(a,0))}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)};t.prototype.destroy=function(){};return t}();var us=function(){function t(t,e,a,i){this.__gl=t,this.__vao=t.createVertexArray(),t.bindVertexArray(this.__vao);for(var n in e){if("instancedIds"==n)continue;var r=e[n],o=r.location;if(-1==o)continue;var l=a[n];if(!l){t.disableVertexAttribArray(o);continue}var s=void 0,d=void 0,c=void 0;switch(l.dataType){case 0:s=1,d=4,c=t.UNSIGNED_BYTE;break;case 1:s=1,d=4,c=t.BYTE;break;case 2:s=1,d=4,c=t.UNSIGNED_SHORT;break;case 3:s=1,d=4,c=t.SHORT;break;case 4:s=1,d=4,c=t.UNSIGNED_INT;break;case 5:s=1,d=4,c=t.INT;break;case 6:s=1,d=4,c=t.FLOAT;break;case Bn:s=2,d=4,c=t.FLOAT;break;case Dn:s=3,d=4,c=t.FLOAT;break;case On:case An:s=4,d=4,c=t.FLOAT;break;case Qn:s=4,d=1,c=t.UNSIGNED_BYTE;break;default:throw"Unhandled Type"}var u=s*d,h=null!=l.offset?l.offset*s*d:0,m=1==l.normalized,p=r.instanced;t.enableVertexAttribArray(o),t.bindBuffer(t.ARRAY_BUFFER,l.buffer),t.vertexAttribPointer(o,s,c,m,u,h),p?t.vertexAttribDivisor(o,1):t.vertexAttribDivisor(o,0)}this.__indexBuffer=i}t.prototype.bind=function(t){return this.__gl.bindVertexArray(this.__vao),this.__indexBuffer&&this.__gl.bindBuffer(this.__gl.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),!0};t.prototype.unbind=function(){var t=this.__gl;for(var e in this.__shaderAttrs){var a=this.__shaderAttrs[e].location;-1!=a&&(t.disableVertexAttribArray(a),t.vertexAttribDivisor(a,0))}this.__gl.bindVertexArray(null),this.__indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)};t.prototype.destroy=function(){this.__gl.deleteVertexArray(this.__vao)};return t}();function hs(t,e,a,i){return null==t.createVertexArray?new cs(t,e,a,i):new us(t,e,a,i)}var ms=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this)||this,i.__gl=e,i.__geom=a,i.__glattrs={},i.__glattrbuffers={},i.__shaderBindings={},i.destructing=new dr,i.updated=new dr;i.__geom.geomDataChanged.connect((function(t){i.updateBuffers(t),i.updated.emit()}));i.__geom.geomDataTopologyChanged.connect((function(t){i.clearShaderBindings(),i.updateBuffers(t),i.updated.emit()}));return i}e.prototype.getGeom=function(){return this.__geom};e.prototype.genBuffers=function(){};e.prototype.updateBuffers=function(t){};e.prototype.bind=function(t){if(this.__destroyed)throw new Error("Error binding a destroyed geom");var e=this.__shaderBindings[t.shaderkey];if(!e){e=hs(this.__gl,t.attrs,this.__glattrbuffers,this.__indexBuffer),this.__shaderBindings[t.shaderkey]=e}return e.bind(t),!0};e.prototype.unbind=function(t){var e=this.__shaderBindings[t.shaderkey];e&&e.unbind(t)};e.prototype.draw=function(){throw new Error("Not implemented. Implement this method in a derived class.")};e.prototype.drawInstanced=function(t){throw new Error("Not implemented. Implement this method in a derived class.")};e.prototype.bindAndDraw=function(t){this.bind(t),this.draw(t)};e.prototype.clearShaderBindings=function(){for(var t in this.__shaderBindings){this.__shaderBindings[t].destroy()}this.__shaderBindings={}};e.prototype.destroy=function(){this.__geom.deleteMetadata("glgeom"),this.clearShaderBindings();var t=this.__gl;for(var e in this.__glattrbuffers){var a=this.__glattrbuffers[e];a.shared||t.deleteBuffer(a.buffer)}this.__glattrs={},this.__shaderBindings={},this.__destroyed=!0,this.destructing.emit(this)};return e}(fr);var ps=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.genBuffers();return i}e.prototype.getNumTriangles=function(){return this.__numTriangles};e.prototype.genBuffers=function(){t.prototype.genBuffers.call(this);var e=this.__gl,a=this.__geom.genBuffers(),i=a.indices;this.__numTriIndices=a.indices.length,i instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),i instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),i instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT),this.__numTriangles=i.length/3,this.__numRenderVerts=a.numRenderVerts,this.__indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,a.indices,e.STATIC_DRAW);for(var n in a.attrBuffers){var r=a.attrBuffers[n],o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,r.values,e.STATIC_DRAW),this.__glattrbuffers[n]={buffer:o,dataType:r.dataType,normalized:r.normalized},"textureCoords"==n&&(this.__glattrbuffers.texCoords=this.__glattrbuffers.textureCoords)}};e.prototype.updateBuffers=function(t){var e=this.__gl,a=this.__geom.genBuffers({includeIndices:!1});for(var i in a.attrBuffers){var n=a.attrBuffers[i],r=this.__glattrbuffers[i];e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.bufferData(e.ARRAY_BUFFER,n.values,e.STATIC_DRAW)}};e.prototype.getNumUnSplitVerts=function(){return this.__geom.vertices.length};e.prototype.getNumSplitVerts=function(){return this.__numRenderVerts};e.prototype.generateWireframesVAO=function(){if(!this.__vao)return!1;this.__geom.edgeVerts||this.__geom.genTopologyInfo(),this.__wireframesVao&&this.__ext.deleteVertexArrayOES(this.__wireframesVao),this.__wireframesVao=this.__ext.createVertexArrayOES(),this.__ext.bindVertexArrayOES(this.__wireframesVao);var t=this.__gl,e=t.createBuffer(),a=Uint32Array.from(this.__geom.edgeVerts);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW);var i=this.__glattrbuffers.positions.buffer;t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(0,3,t.FLOAT,!1,12,0),this.__numWireIndices=a.length,this.__ext.bindVertexArrayOES(null)};e.prototype.bindWireframeVAO=function(t){return null!=this.__wireframesVao&&(this.__ext.bindVertexArrayOES(this.__wireframesVao),!0)};e.prototype.unbindWireframeVAO=function(){this.__ext.bindVertexArrayOES(null)};e.prototype.drawWireframe=function(){this.__wireframesVao&&this.__gl.drawElements(this.__gl.LINES,this.__numWireIndices,this.__gl.UNSIGNED_INT,0)};e.prototype.generateHardEdgesVAO=function(){if(!this.__vao)return!1;this.__geom.edgeVerts||this.__geom.generateHardEdgesFlags(),this.__hardEdgesVao&&this.__ext.deleteVertexArrayOES(this.__hardEdgesVao),this.__hardEdgesVao=this.__ext.createVertexArrayOES(),this.__ext.bindVertexArrayOES(this.__hardEdgesVao);var t=this.__gl,e=t.createBuffer(),a=Uint32Array.from(this.__geom.computeHardEdgesIndices());t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW);var i=this.__glattrbuffers.positions.buffer;t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(0,3,t.FLOAT,!1,12,0),this.__numEdgeIndices=a.length,this.__ext.bindVertexArrayOES(null)};e.prototype.bindHardEdgesVAO=function(t){return null!=this.__hardEdgesVao&&(this.__ext.bindVertexArrayOES(this.__hardEdgesVao),!0)};e.prototype.unbindHardEdgesVAO=function(){this.__ext.bindVertexArrayOES(null)};e.prototype.drawHardEdges=function(){this.__hardEdgesVao&&this.__gl.drawElements(this.__gl.LINES,this.__numEdgeIndices,this.__gl.UNSIGNED_INT,0)};e.prototype.drawPoints=function(){this.__gl.drawArrays(this.__gl.POINTS,0,this.__geom.numVertices())};e.prototype.draw=function(){this.__gl.drawElements(this.__gl.TRIANGLES,this.__numTriIndices,this.__indexDataType,0)};e.prototype.drawInstanced=function(t){this.__gl.drawElementsInstanced(this.__gl.TRIANGLES,this.__numTriIndices,this.__indexDataType,0,t)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__gl.deleteBuffer(this.__indexBuffer),this.__indexBuffer=void 0};return e}(ms);var fs=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.genBuffers();return i}e.prototype.genBuffers=function(){t.prototype.genBuffers.call(this);var e=this.__gl,a=this.__geom.genBuffers(),i=a.indices;if(this.fatLines=(this.__geom.lineThickness>0||a.attrBuffers.lineThickness)&&e.floatTexturesSupported,this.fatLines){e.__quadVertexIdsBuffer||e.setupInstancedQuad(),this.__glattrbuffers.vertexIDs=e.__quadattrbuffers.vertexIDs,this.__drawCount=i.length/2;var n=this.__geom.getVertexAttributes(),r=n.positions,o=n.lineThickness,l=4,s=new Float32Array(r.length*l);for(var d=0;d<r.length;d++){Dn.createFromFloat32Buffer(s.buffer,4*d).setFromOther(r.getValueRef(d)),s[4*d+3]=o?o.getFloat32Value(d):this.__geom.lineThickness}this.__positionsTexture=new ds(e,{format:"RGBA",type:"FLOAT",width:r.length,height:1,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",data:s,mipMapped:!1});var c=new Float32Array(i.length);for(var u=0;u<i.length;u++){var h=void 0;h=u%2==0?u>0?i[u]==i[u-1]:i[u]==i[i.length-1]:u<i.length-1?i[u]==i[u+1]:i[u]==i[0],c[u]=(h?1:0)+2*i[u]}var m=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,m),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW),this.__glattrbuffers.segmentIndices={buffer:m,dimension:2}}else{this.__indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW);for(var p in a.attrBuffers){var f=a.attrBuffers[p],o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,f.values,e.STATIC_DRAW),this.__glattrbuffers[p]={buffer:o,dataType:f.dataType,normalized:f.normalized}}this.__numSegIndices=i.length,this.__numVertices=a.numVertices}i instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),i instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),i instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT)};e.prototype.updateBuffers=function(t){var e=this.__gl,a=this.__geom.genBuffers(),i=a.indices;if(this.fatLines){this.__drawCount=i.length/2;var n=this.__geom.getVertexAttributes(),r=n.positions,o=n.lineThickness,l=4,s=new Float32Array(r.length*l);for(var d=0;d<r.length;d++){Dn.createFromFloat32Buffer(s.buffer,4*d).setFromOther(r.getValueRef(d)),s[4*d+3]=o?o.getFloat32Value(d):this.__geom.lineThickness}this.__positionsTexture.bufferData(s,r.length,1);var c=new Float32Array(i.length);for(var u=0;u<i.length;u++){var h=void 0;h=u%2==0?u>0&&i[u]==i[u-1]:u<i.length-1&&i[u]==i[u+1],c[u]=(h?1:0)+2*i[u]}e.bindBuffer(e.ARRAY_BUFFER,this.__glattrbuffers.segmentIndices.buffer),e.bufferData(e.ARRAY_BUFFER,c,e.STATIC_DRAW)}else{this.__geom.getVertexAttributes();if(t&&t.indicesChanged){var m=this.__geom.getIndices();this.__numSegIndices!=m.length&&(e.deleteBuffer(this.__indexBuffer),this.__indexBuffer=e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.__indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,m,e.STATIC_DRAW),this.__numSegIndices=m.length}var o=a.numVertices!=this.__numVertices;for(var p in a.attrBuffers){var f=a.attrBuffers[p],l=this.__glattrbuffers[p];o&&(e.deleteBuffer(l.buffer),l.buffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,l.buffer),e.bufferData(e.ARRAY_BUFFER,f.values,e.STATIC_DRAW)}this.__numVertices=a.numVertices,this.__numSegIndices=i.length}i instanceof Uint8Array&&(this.__indexDataType=this.__gl.UNSIGNED_BYTE),i instanceof Uint16Array&&(this.__indexDataType=this.__gl.UNSIGNED_SHORT),i instanceof Uint32Array&&(this.__indexDataType=this.__gl.UNSIGNED_INT)};e.prototype.bind=function(e){if(this.fatLines&&"LineThickness"in e.unifs){var a=this.__gl;var i=this.__shaderBindings[e.shaderkey];i||(i=hs(a,e.attrs,this.__glattrbuffers,a.__quadIndexBuffer),this.__shaderBindings[e.shaderkey]=i),i.bind(e);{var n=e.unifs;n.positionsTexture&&(this.__positionsTexture.bindToUniform(e,n.positionsTexture),a.uniform1i(n.positionsTextureSize.location,this.__positionsTexture.width))}var r=e.unifs;return a.uniform1f(r.LineThickness.location,(this.__geom.lineThickness?this.__geom.lineThickness:1)*e.viewScale),!0}return t.prototype.bind.call(this,e)};e.prototype.drawPoints=function(){this.__gl.drawArrays(this.__gl.POINTS,0,this.__geom.numVertices())};e.prototype.draw=function(t){var e=this.__gl;this.fatLines?t.unifs.LineThickness&&e.drawElementsInstanced(e.TRIANGLES,6,e.UNSIGNED_SHORT,0,this.__drawCount):e.drawElements(this.__gl.LINES,this.__numSegIndices,this.__indexDataType,0)};e.prototype.drawInstanced=function(t){this.__gl.drawElementsInstanced(this.__gl.LINES,this.__numSegIndices,this.__indexDataType,0,t)};return e}(ms);var bs=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.genBuffers();return i}e.prototype.genBuffers=function(){t.prototype.genBuffers.call(this);var e=this.__gl,a=this.__geom.genBuffers();for(var i in a.attrBuffers){var n=a.attrBuffers[i],r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,n.values,e.STATIC_DRAW),this.__glattrbuffers[i]={buffer:r,dataType:n.dataType,normalized:n.normalized}}this.__numVerts=a.numVertices,this.__vboState=2};e.prototype.bind=function(e){if(e.unifs.PointSize){var a=this.__gl;var i=this.__shaderBindings[e.shaderkey];if(!i){a.__quadVertexIdsBuffer||a.setupInstancedQuad();var n=Object.assign(this.__glattrbuffers,a.__quadattrbuffers);i=hs(a,e.attrs,n,a.__quadIndexBuffer),this.__shaderBindings[e.shaderkey]=i}return i.bind(e),!0}return t.prototype.bind.call(this,e)};e.prototype.draw=function(t){var e=this.__gl;t.unifs.PointSize?e.drawElementsInstanced(e.TRIANGLES,6,e.UNSIGNED_SHORT,0,this.__numVerts):e.drawArrays(e.POINTS,0,this.__numVerts)};e.prototype.drawInstanced=function(t){this.__gl.drawArraysInstanced(this.__gl.POINTS,0,this.__numVerts,t)};return e}(ms);var ys={bool:Boolean,int:5,uint:4,float:6,ivec2:Bn,ivec3:Dn,ivec4:On,vec2:Bn,vec3:Dn,vec4:On,color:An,mat3:qn,mat4:$n,sampler2D:mo};var gs=new(function(){function t(){this.__shaderModules={}}t.prototype.hasShaderModule=function(t){return t in this.__shaderModules};t.prototype.setShaderModule=function(t,e){return this.parseShader(t,e)};t.prototype.getShaderModule=function(t){return this.__shaderModules[t]};t.prototype.getShaderModuleNames=function(){var t=[];for(var e in this.__shaderModules)t.push(e);return t};t.prototype.parseShader=function(t,e){var a=function(t){if(t.startsWith("..")){return i.substring(0,i.lastIndexOf("/"))+t.substring(2)}return t.startsWith(".")?i+t.substring(1):t.startsWith("/")?t.substring(1):t},i=(Pn(t),t.substring(0,t.lastIndexOf("/"))),n=e.split("\n"),r={glsl:" //starting:"+t+"\n",lines:n,numLines:0,includeMetaData:[],uniforms:{},attributes:{}},o=/\s+/;var l=function(e){var i=n[e],l=i.trim();if(l.startsWith("//")||l.startsWith("*"))r.glsl=r.glsl+i+"\n",r.numLines++;else if(-1!=l.indexOf("//")&&(l=l.slice(0,l.indexOf("//")).trim()),l.startsWith("<%")||l.startsWith("</%")){var c=function(t){var e=(t=(t=t.startsWith("</%")?t.slice(3):t.slice(2)).endsWith("/>")?t.slice(0,t.length-2):t.slice(0,t.length-1)).split(o),a={tag:e.shift(),attributes:{}};for(var i=0,n=e;i<n.length;i++){var r=n[i];var l=r.split("=");a.attributes[l[0]]=l[1].replace(/['"]+/g,"")}return a}(n[e].trim());switch(c.tag){case"include":{var u=a(c.attributes.file);if(!s.hasShaderModule(u))throw new Error("Error while parsing :"+t+" \nShader module not found:"+u+"\n in:"+s.getShaderModuleNames());var h=s.getShaderModule(u);Pn(c.attributes.file);var m=h.glsl;m=m.substring(m.indexOf("\n")+1),r.glsl=r.glsl+" //including:"+c.attributes.file+"\n";var p={};for(var f in c.attributes){if("file"==f)continue;var b=c.attributes[f];m=m.replaceAll(f,b),p[f]=b}r.glsl=r.glsl+m,r.includeMetaData.push({src:r.numLines,tgt:e,length:h.numLines,key:u}),r.glsl=r.glsl+" //continuing:"+t+"\n",r.numLines+=h.numLines+1;for(var y in h.attributes){var g=y;for(var _ in p)g=g.replaceAll(_,p[_]);r.attributes[g]=h.attributes[y]}for(var Z in h.uniforms){var G=Z;for(var X in p)G=G.replaceAll(X,p[X]);r.uniforms[G]=h.uniforms[Z]}break}default:console.warn("Error while parsing :"+t+" \nUnhandled line:"+i);return d=e,"continue"}}else{var v=function(e,a){if(!(e[1]in ys))throw new Error("Error while parsing :"+t+" \nType not recognized:"+e[1]);var n=e[2].slice(0,e[2].length-1);r.attributes[n]={type:ys[e[1]],instanced:a},"color"==e[1]&&(e[1]="vec4",i=e.join(" "))};if(l.startsWith("struct")){var V="";if(-1!=l.indexOf("}"))V=l.substring(l.indexOf("{")+1,l.indexOf("}")-1);else for(e++;i+=n[e]+"\n",V+=i.trim(),e++,-1==V.indexOf("}"););var I=V.substring(V.indexOf("{")+1,V.indexOf("}")-1).split(";"),R=[];for(var x=0,S=I;x<S.length;x++){var W=S[x];if(0==W.length)continue;var L=W.trim().split(o);R.push({name:L[1],type:ys[L[0]]})}var p=l.split(o);ys[p[1]]=R}if(l.startsWith("attribute")){v(l.split(o),!1)}if(l.startsWith("instancedattribute")){var T=l.split(o);v(T,!0),T[0]="attribute",i=T.join(" ")}else if(l.startsWith("uniform")){var M=l.split(o);var F=1;4==M.length&&(F=2);var C=M[F];if(!(C in ys))throw new Error("Error while parsing :"+t+" \nType not recognized:"+M[1]);var p=M[F+1].slice(0,M[F+1].length-1);r.uniforms[p]=ys[C],"struct"==r.uniforms[p]&&console.log(M),"color"==M[1]&&(M[1]="vec4",i=M.join(" "))}r.glsl=r.glsl+i+"\n",r.numLines++}d=e};var s=this,d;for(var c=0;c<n.length;c++){l(c);c=d}return this.__shaderModules[t]=r,r};return t}());var _s=0;var Zs=function(t){__extends(e,t);function e(e){var a=this;if(a=t.call(this)||this,!e)throw new Error("gl context must be passed to shader constructor");a.__gl=e,a.__shaderStages={VERTEX_SHADER:{glsl:"",lines:0,uniforms:{},attributes:{}},FRAGMENT_SHADER:{glsl:"",lines:0,uniforms:{},attributes:{}}},a.__shaderProgramHdls={},a.__gltextures={},a.updated=new dr,a.__id=_s++,a.invisibleToGeomBuffer=!1;return a}e.isTransparent=function(){return!1};e.isOverlay=function(){return!1};e.prototype.__compileShaderStage=function(t,e,a,i){var n=this.__gl;if(i||(i=n.shaderopts),i){if(i.repl)for(var r in i.repl)t=t.replaceAll(r,i.repl[r]);i.defines&&(t=i.defines+t)}"webgl2"==n.name&&(t=t.replaceAll("attribute","in"),t="#version 300 es\n"+(t=(t="vertexShader"==a?t.replaceAll("varying","out"):t.replaceAll("varying","in")).replaceAll("texture2D","texture")));var o=n.createShader(e);if(n.shaderSource(o,t),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS)){console.log("Errors in :"+this.constructor.name);var l=n.getShaderInfoLog(o).split("\n"),s={};for(var d in l){if(l[d].startsWith("'")){l[d-1]=l[d-1]+l[d],delete l[d],d--;continue}var c=l[d].split(":");if(c.length>=2){var u=parseInt(c[2]);isNaN(u)||(s[u]?s[u].push(l[d]):s[u]=[l[d]])}}var h=[],m=t.split("\n");for(var p=0;p<m.length;p++)if(h.push((p+1+":").lpad(" ",3)+m[p]),p+1 in s){var f=s[p+1];for(var b=0,y=f;b<y.length;b++){var g=y[b];h.push(g),h.push("-".lpad("-",g.length))}}throw new Error("An error occurred compiling the shader \n=================\n"+this.constructor.name+"."+a+": \n\n"+l.join("\n")+"\n"+h.join("\n"))}return o};e.prototype.__createProgram=function(t){var e=this.__gl;this.__shaderCompilationAttempted=!0;var a=e.createProgram(),i=this.__shaderStages.VERTEX_SHADER.glsl,n={};if(null!=i){var r=this.__compileShaderStage(i,e.VERTEX_SHADER,"vertexShader",t);if(!r)return!1;e.attachShader(a,r),n[e.VERTEX_SHADER]=r}var o=this.__shaderStages.FRAGMENT_SHADER.glsl;if(null!=o){var l=Object.assign({},e.shaderopts,t);l.frag&&(l.defines=l.frag.defines+l.defines);var s=this.__compileShaderStage(o,e.FRAGMENT_SHADER,"fragmentShader",l);if(!s)return!1;e.attachShader(a,s),n[e.FRAGMENT_SHADER]=s}if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var d=e.getProgramInfoLog(a);if(d.includes("D3D shader compilation failed")){var c=e.getExtension("WEBGL_debug_shaders");if(c){var u=c.getTranslatedShaderSource(n[e.VERTEX_SHADER]);console.log(u)}}throw console.log("vertexShaderGLSL:"+i),console.log("fragmentShaderGLSL:"+o),new Error("Unable to link the shader program:"+this.constructor.name+"\n==================\n"+d)}var h=this.__extractAttributeAndUniformLocations(a,t);return h.shaderProgramHdl=a,h};e.prototype.__extractAttributeAndUniformLocations=function(t,e){var a=this.__gl,i=this.getAttributes(),n={attrs:{},unifs:{}};for(var r in i){var o=a.getAttribLocation(t,r);if(null==o){console.warn("Shader attribute not found:"+r);continue}var l=i[r];n.attrs[r]={name:r,location:o,type:l.type,instanced:l.instanced}}var s=this.getUniforms();for(var d in s){var l=s[d];if(l instanceof Array)for(var c=0,u=l;c<u.length;c++){var h=u[c];var m=d+"."+h.name,p=a.getUniformLocation(t,m);null!=p&&(n.unifs[m]={name:m,location:p,type:h.type})}if(e&&e.repl)for(var f in e.repl)d=d.replace(f,e.repl[f]);var b=a.getUniformLocation(t,d);null!=b&&(n.unifs[d]={name:d,location:b,type:l})}return n};e.prototype.getAttributes=function(){var t={};for(var e in this.__shaderStages){var a=this.__shaderStages[e];for(var i in a.attributes)t[i]=a.attributes[i]}return t};e.prototype.getUniforms=function(){var t={};for(var e in this.__shaderStages){var a=this.__shaderStages[e];for(var i in a.uniforms)t[i]=a.uniforms[i]}return t};e.prototype.finalize=function(){};e.prototype.compileForTarget=function(t,e){var a=t?this.__id+t:this.__id;var i=this.__shaderProgramHdls[a];return i||!1!==i&&(i=this.__createProgram(e),i.shaderkey=a,this.__shaderProgramHdls[a]=i),i};e.prototype.compile=function(){this.compileForTarget()};e.prototype.bind=function(t,e){var a=this.__gl;if(t.glshader!=this){var i=this.compileForTarget(e,t.shaderopts);if(!1===i)return console.warn(this.constructor.name+" is not compiled for "+e),!1;var n=i.shaderProgramHdl;a.useProgram(n),t.glshader=this,t.shaderkey=i.shaderkey,t.unifs=i.unifs,t.attrs=i.attrs,t.boundTextures=0,t.boundLightmap=void 0,t.glgeom=void 0,t.bindRendererUnifs&&t.bindRendererUnifs(i.unifs)}return t.supportsInstancing=!0,!0};e.prototype.unbind=function(t){return!0};e.getParamDeclarations=function(){return[]};e.getGeomDataShaderName=function(){};e.getSelectedShaderName=function(){};e.prototype.destroy=function(){var t=this.__gl;for(var e in this.__shaderProgramHdls){var a=this.__shaderProgramHdls[e];t.deleteProgram(a.shaderProgramHdl)}this.__shaderProgramHdls={}};return e}(Wr);gs.setShaderModule("utils/quadVertexFromID.glsl","\n\nattribute float vertexIDs;\n\nvec2 getQuadVertexPositionFromID(){\n    int vertexID = int(vertexIDs);\n    if(vertexID == 0)\n        return vec2(-0.5, -0.5);\n    else if(vertexID == 1)\n        return vec2(0.5, -0.5);\n    else if(vertexID == 2)\n        return vec2(-0.5, 0.5);\n    else if(vertexID == 3)\n        return vec2(0.5, 0.5);\n    return vec2(0,0);\n}\n"),gs.setShaderModule("utils/unpackHDR.glsl","\n\nvec3 decodeHDR(const in vec3 ldrPixel, const in float cdmAlpha) {\n    float avg = (cdmAlpha * 16.0 - 8.0);\n    float scl = 1.0;\n    vec3 color;\n    color.x = (tan((ldrPixel.x-0.5)*1.5)/scl)+avg;\n    color.y = (tan((ldrPixel.y-0.5)*1.5)/scl)+avg;\n    color.z = (tan((ldrPixel.z-0.5)*1.5)/scl)+avg;\n\n    // convert from logarithmic curve to linear curve.\n    // subtract the epsilon that was added during encoding.\n    const float eps = 0.001;\n    color.x = pow(10.0, color.x) - eps;\n    color.y = pow(10.0, color.y) - eps;\n    color.z = pow(10.0, color.z) - eps;\n    return color;\n}\n\nvec3 decodeHDR(sampler2D ldrSampler, sampler2D cdmSampler, vec2 texCoord) {\n#ifdef ENABLE_ES3\n    float cdm = texture2D(cdmSampler, texCoord).r;\n#else\n    float cdm = texture2D(cdmSampler, texCoord).a;\n#endif\n    return decodeHDR(texture2D(ldrSampler, texCoord).rgb, cdm);\n}\n\n");var Gs=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("UnpackHDRShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("UnpackHDRShader.fragmentShader",'\nprecision highp float;\n\nvarying vec2 v_texCoord;\nuniform sampler2D ldrSampler;\nuniform sampler2D cdmSampler;\nuniform float exposure;\nuniform vec4 tint;\n\n<%include file="utils/unpackHDR.glsl"/>\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(decodeHDR(ldrSampler, cdmSampler, v_texCoord) * tint.rgb * exposure, 1.0);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n\n');return a}return e}(Zs);var Xs=function(){function t(t,e,a){if(a===void 0){a=!1}!zn.isIOSDevice||"FLOAT"!=e.getType()&&"HALF_FLOAT"!=e.getType()||console.error("IOS devices are unable to render to float textures."),this.__gl=t,this.__colorTexture=e,this.__createDepthTexture=a,this.__clearColor=[0,0,0,0],this.__depthTexture=void 0,this.setup=this.setup.bind(this),this.resize=this.resize.bind(this),this.__colorTexture&&this.__colorTexture.resized.connect(this.resize),this.setup()}t.prototype.setClearColor=function(t){this.__clearColor=t};t.prototype.getWidth=function(){return this.__colorTexture.width};t.prototype.getHeight=function(){return this.__colorTexture.height};t.prototype.getSize=function(){return[this.__colorTexture.width,this.__colorTexture.height]};t.prototype.getColorTexture=function(){return this.__colorTexture};t.prototype.getDepthTextureGL=function(){return this.__depthTexture};Object.defineProperty(t.prototype,"width",{get:function(){return this.__colorTexture.width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this.__colorTexture.height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"size",{get:function(){return[this.__colorTexture.width,this.__colorTexture.height]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.__colorTexture},enumerable:true,configurable:true});t.prototype.setColorTexture=function(t){this.__colorTexture=t,gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.__colorTexture.glTex,0)};Object.defineProperty(t.prototype,"depthTextureGL",{get:function(){return this.__depthTexture},enumerable:true,configurable:true});t.prototype.setup=function(){var t=this.__gl;if(this.__fbo=t.createFramebuffer(),"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.__fbo):t.bindFramebuffer(t.FRAMEBUFFER,this.__fbo),this.__colorTexture&&("webgl2"==t.name?t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.__colorTexture.glTex,0):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.__colorTexture.glTex,0)),this.__createDepthTexture)if("webgl2"==t.name||t.__ext_WEBGL_depth_texture)t.activeTexture(t.TEXTURE0),this.__depthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.__depthTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),"webgl2"==t.name?(t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT24,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.__depthTexture,0)):(t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.__depthTexture,0));else{var e=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}this.__checkFramebuffer(),"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null)};t.prototype.resize=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.__fbo):t.bindFramebuffer(t.FRAMEBUFFER,this.__fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.__colorTexture.glTex,0),this.__depthTexture&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.__depthTexture),"webgl2"==t.name?t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT24,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null):t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null)),this.__checkFramebuffer()};t.prototype.__checkFramebuffer=function(){var t=this.__gl;var e;if(e="webgl2"==t.name?t.checkFramebufferStatus(t.DRAW_FRAMEBUFFER):t.checkFramebufferStatus(t.FRAMEBUFFER),e!==t.FRAMEBUFFER_COMPLETE)switch(t.bindTexture(t.TEXTURE_2D,null),"webgl2"==t.name?t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null),console.warn("Error creating Fbo width:",this.width,", height:",this.height," Texture Type:",this.__colorTexture.getType()),e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");case 36061:throw new Error("The framebuffer is unsupported");default:throw new Error("Incomplete Frambuffer")}};t.prototype.bindForWriting=function(t){t&&(this.__prevBoundFbo=t.boundRendertarget,t.boundRendertarget=this.__fbo);var e=this.__gl;"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.__fbo):e.bindFramebuffer(e.FRAMEBUFFER,this.__fbo),e.viewport(0,0,this.width,this.height)};t.prototype.unbindForWriting=function(t){t&&(t.boundRendertarget=this.__prevBoundFbo);var e=this.__gl;"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.__prevBoundFbo):e.bindFramebuffer(e.FRAMEBUFFER,this.__prevBoundFbo)};t.prototype.bind=function(t){this.bindForWriting(t)};t.prototype.unbind=function(t){this.unbindForWriting(t)};t.prototype.bindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,this.__fbo):t.bindFramebuffer(t.FRAMEBUFFER,this.__fbo)};t.prototype.unbindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null)};t.prototype.clear=function(){var t=this.__gl;t.colorMask(!0,!0,!0,!0),t.clearColor.apply(t,this.__clearColor),this.__createDepthTexture?t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT)};t.prototype.bindAndClear=function(t){this.bind(t),this.clear(t)};t.prototype.unbind=function(){var t=this.__gl;t.bindFramebuffer(t.FRAMEBUFFER,null)};t.prototype.destroy=function(){var t=this.__gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(this.__fbo),this.__fbo=null,this.__colorTexture.resized.disconnect(this.resize)};return t}();var vs=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__hdrImage=a,i.__hdrImage.setMetadata("gltexture",i),i.__hdrImage.updated.connect((function(){i.__unpackHDRImage(i.__hdrImage.getParams())})),i.__hdrImage.isLoaded()?i.__unpackHDRImage(i.__hdrImage.getParams()):i.__hdrImage.loaded.connect((function(){i.__unpackHDRImage(i.__hdrImage.getParams())}));return i}e.prototype.__unpackHDRImage=function(t){var e=this.__gl,a=t.data.ldr,i=t.data.cdm;if(this.__fbo)this.__srcLDRTex.bufferData(a),this.__srcCDMTex.bufferData(i);else{this.configure({format:"RGBA",type:"FLOAT",width:a.width,height:a.height,filter:"LINEAR",wrap:"CLAMP_TO_EDGE"}),this.__fbo=new Xs(e,this),this.__fbo.setClearColor([0,0,0,0]),this.__srcLDRTex=new ds(e,{format:"RGB",type:"UNSIGNED_BYTE",width:a.width,height:a.height,filter:"NEAREST",mipMapped:!1,wrap:"CLAMP_TO_EDGE",data:a}),this.__srcCDMTex=new ds(e,{format:"webgl2"==e.name?"RED":"ALPHA",type:"UNSIGNED_BYTE",width:a.width,height:a.height,filter:"NEAREST",mipMapped:!1,wrap:"CLAMP_TO_EDGE",data:i}),this.__unpackHDRShader=new Gs(e);var n=this.__unpackHDRShader.compileForTarget("GLHDRImage");this.__shaderBinding=hs(e,n.attrs,e.__quadattrbuffers,e.__quadIndexBuffer)}this.__fbo.bindAndClear();var r={};this.__unpackHDRShader.bind(r,"GLHDRImage"),this.__shaderBinding.bind(r);var o=r.unifs;this.__srcLDRTex.bindToUniform(r,o.ldrSampler),this.__srcCDMTex.bindToUniform(r,o.cdmSampler),e.uniform1f(o.exposure.location,1),e.uniform4fv(o.tint.location,this.__hdrImage.getHDRTint().asArray()),e.drawQuad(),this.__fbo.unbind(),this.updated.emit()};e.prototype.bindToUniform=function(e,a,i){return t.prototype.bindToUniform.call(this,e,a,i)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__fbo&&(this.__fbo.destroy(),this.__srcLDRTex.destroy(),this.__srcCDMTex.destroy()),this.__unpackHDRShader&&this.__unpackHDRShader.destroy(),this.__shaderBinding&&this.__shaderBinding.destroy(),this.__hdrImage.loaded.disconnectScope(this),this.__hdrImage.updated.disconnectScope(this)};return e}(ds);gs.setShaderModule("GLSLUtils.glsl","\n\n\nint ftoi(float val){\n    return int(floor(val + 0.5));\n}\n\n#ifdef ENABLE_ES3\n\nint imod(int x, int y) {\n    return x % y;\n}\n\nvoid setFlag(inout int flags, int flag) {\n    flags |= flag;\n}\n\nvoid clearFlag(inout int flags, int flag) {\n    flags &= ~flag;\n}\n\nbool testFlag(int flags, int flag) {\n    return (flags & flag) != 0;\n}\n\n// private function: Mangle me...\nivec2 _pixelIndexToUV(int index, int textureWidth){\n    return ivec2(index % textureWidth, index / textureWidth);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureWidth, int index) {\n    return texelFetch(texture, _pixelIndexToUV(index, textureWidth), 0);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n    return texelFetch(texture, texCoord, 0);\n}\n\n#else\n\n// TODO: integrate: https://gist.github.com/mattatz/70b96f8c57d4ba1ad2cd\n\nint max(int a, int b) {\n    return a > b ? a : b;\n}\nint min(int a, int b) {\n    return a < b ? a : b;\n}\n\n\nfloat round(float val){\n    return floor(val + 0.4);\n}\n\nint imod(int x, int y) {\n    return x-y*(x/y);\n}\n\nvoid setFlag(inout int flags, int flag) {\n    flags += flag;\n}\nvoid clearFlag(inout int flags, int flag) {\n    flags -= flag;\n}\n\nbool testFlag(int flags, int flag) {\n    return imod(flags / flag, 2) != 0;\n}\n\n// private function: Mangle me...\nvec2 _pixelIndexToUV(int index, int textureSize){\n    float flTexSize = float(textureSize);\n    float x = (float(imod(index, textureSize))+0.5)/flTexSize;\n    float y = (floor(float(index / textureSize))+0.5)/flTexSize;\n    return vec2(x, y);\n}\n\nvec4 fetchTexel(sampler2D texture, int textureSize, int index) {\n    vec2 texCoord = _pixelIndexToUV(index, textureSize);\n    return texture2D(texture, texCoord);\n}\n\nvec4 fetchTexel(sampler2D texture, ivec2 textureSize, ivec2 texCoord) {\n    vec2 ftextureSize = vec2(textureSize);\n    return texture2D(texture, (vec2(texCoord) + 0.5) / ftextureSize);\n}\n\n\n#endif\n\nint uvToPixelIndex(vec2 uv, int textureSize){\n    return int(uv.x * float(textureSize)) + (int(floor(uv.y * float(textureSize))) * textureSize);\n}\n\n\n\n"),gs.setShaderModule("utils/ImageStream.glsl","\n\n// Stream Desc looks like the following\n// x : atlas Width in images\n// y : atlas height in images\n// z : image Width\n// w : image Height\n\nvec2 calcFrameImageTexCoords(vec2 texCoord, int index, in vec4 streamDesc){\n\tfloat index_x = floor(mod(float(index), streamDesc.x));\n\tfloat index_y = floor(float(index) / streamDesc.x);\n    return vec2( \n    \t(index_x + texCoord.x) / streamDesc.x, \n    \t(index_y + texCoord.y) / streamDesc.y\n    \t);\n}\n\nvec4 sampleStreamFrame(vec2 texCoord, int index, in sampler2D streamImage, in vec4 streamDesc){\n    return texture2D(streamImage, calcFrameImageTexCoords(texCoord, index, streamDesc));\n}\n\n");var Vs=function(){function t(t,e){var a=this;this.__gl=t,this.__streamImage=e,this.ready=new dr(!0),this.updated=new dr,this.resized=new dr,this.__descParam=this.__streamImage.getParameter("StreamAtlasDesc"),this.__indexParam=this.__streamImage.getParameter("StreamAtlasIndex"),this.__indexParam.valueChanged.connect(this.updated.emit);var i=function(){var e=a.__streamImage.getParams();e.data.__atlasTexture||(e.data.__atlasTexture=new ds(t,e)),a.__atlasTexture=e.data.__atlasTexture,a.__atlasTexture.textureType=2,a.__atlasTexture.textureDesc=a.__descParam.getValue().asArray()};this.__streamImage.isLoaded()?i():this.__streamImage.loaded.connect((function(){i()}))}t.prototype.preBind=function(t,e){var a=this.__atlasTexture.preBind(t,e);return a.textureDescUnif=e[t.name+"Desc"],a.textureIndexUnif=e[t.name+"Index"],a};t.prototype.bindToUniform=function(t,e,a){return!!this.__atlasTexture.bindToUniform(t,e,a)&&(a&&a.textureIndexUnif&&this.__gl.uniform1i(a.textureIndexUnif.location,this.__indexParam.getValue()),!0)};return t}();var Is=function(){function t(t,e,a,i){var n=this;switch(this.__unif=i,i.type){case Boolean:this.uniformXX=t.uniform1i.bind(t);break;case 4:"webgl2"==t.name?this.uniformXX=t.uniform1ui.bind(t):this.uniformXX=t.uniform1i.bind(t);break;case 5:this.uniformXX=t.uniform1i.bind(t);break;case 6:this.uniformXX=t.uniform1f.bind(t)}this.__val=a.getValue(),a.valueChanged.connect((function(){n.__val=a.getValue(),e.updated.emit()}))}t.prototype.bind=function(t){this.uniformXX(this.__unif.location,this.__val)};t.prototype.unbind=function(){};t.prototype.destroy=function(){};return t}();var Rs=function(){function t(t,e,a,i){var n=this;switch(this.__unif=i,i.type){case Bn:this.uniformXX=t.uniform2fv.bind(t);break;case Dn:this.uniformXX=t.uniform3fv.bind(t);break;case On:this.uniformXX=t.uniform4fv.bind(t)}this.__vals=a.getValue().asArray(),a.valueChanged.connect((function(){n.__vals=a.getValue().asArray(),e.updated.emit()}))}t.prototype.bind=function(t){this.uniformXX(this.__unif.location,this.__vals)};t.prototype.unbind=function(){};t.prototype.destroy=function(){};return t}();var xs=function(){function t(t,e,a,i){var n=this;switch(this.__unif=i,i.type){case Mat3:this.uniformMatrixXXX=t.uniformMatrix3fv.bind(t);break;case $n:this.uniformMatrixXXX=t.uniformMatrix4fv.bind(t)}this.__vals=a.getValue().asArray(),a.valueChanged.connect((function(){n.__val=a.getValue().asArray(),e.updated.emit()}))}t.prototype.bind=function(t){this.uniformMatrixXXX(this.__unif.location,!1,this.__val)};t.prototype.unbind=function(){};t.prototype.destroy=function(){};return t}();var Ss=function(){function t(t,e,a,i,n){var r=this;this.__gl=t,this.__unif=i,this.__textureUnif=n[i.name+"Tex"],this.__textureTypeUnif=n[i.name+"TexType"],this.__vals=[0,0,0,0],this.bind=this.bindValue;var o=function(t){var a=t.getMetadata("gltexture");a||(a="FLOAT"===t.type?new vs(r.__gl,t):t.isStreamAtlas()?new Vs(r.__gl,t):new ds(r.__gl,t)),r.texBinding=a.preBind(r.__textureUnif,n),a.updated.connect((function(){e.updated.emit()})),r.gltexture=a,r.gltexture.addRef(r),r.textureType=1,r.bind=r.bindTexture,e.updated.emit()};var l,s;var d=function(){o(l)},c=function(t){t.isLoaded()?o(t):t.loaded.connect(d),l=t},u=function(){l.getMetadata("gltexture").removeRef(r),r.texBinding=null,r.gltexture=null,r.textureType=null,r.bind=r.bindValue,s&&l.loaded.disconnectId(s),l=null,s=null,e.updated.emit()},h=function(){var t=a.getValue(!1);if(r.__vals=t.asArray(),r.__textureUnif){var i;a.getImage&&(i=a.getImage()),i&&i!=l?c(i):!i&&l&&u()}e.updated.emit()};h(),a.textureConnected&&a.textureConnected.connect((function(){c(a.getImage())})),a.valueChanged.connect(h),this.uniform1i=t.uniform1i.bind(t),this.uniform4fv=t.uniform4fv.bind(t)}t.prototype.bindValue=function(t){this.uniform4fv(this.__unif.location,this.__vals),this.__textureTypeUnif&&this.uniform1i(this.__textureTypeUnif.location,0)};t.prototype.bindTexture=function(t){this.gltexture.bindToUniform(t,this.__textureUnif,this.texBinding)};return t}();var Ws={};var Ls=function(){function t(t,e,a,i){var n=this;this.__uniformBindings=[];var r=function(r){var o=r.getName(),l=a[o];if(null!=l)switch(l.type){case Boolean:case 4:case 5:case 6:n.__uniformBindings.push(new Is(t,e,r,l));break;case Bn:case Dn:case On:n.__uniformBindings.push(new Rs(t,e,r,l));break;case An:n.__uniformBindings.push(new Ss(t,e,r,l,a));break;case $n:n.__uniformBindings.push(new xs(t,e,r,l));break;default:return void console.warn("Param :"+o+" has unhandled data type:"+l.type)}else if(i){var s=e.getMaterial().getShaderName();Ws[s]||(Ws[s]={}),Ws[s][o]||(console.warn("Material:"+e.getMaterial().getName(),"with Shader ",s,"Param has no unif",o),Ws[s][o]=!0)}},o=e.getMaterial().getParameters();for(var l=0,s=o;l<s.length;l++){var d=s[l];r(d)}}t.prototype.bind=function(t){for(var e=0,a=this.__uniformBindings;e<a.length;e++){var i=a[e];i.bind(t)}return!0};t.prototype.unbind=function(){for(var t=0,e=this.__uniformBindings;t<e.length;t++){var a=e[t];a.unbind(renderstate)}};t.prototype.destroy=function(){for(var t=0,e=this.__uniformBindings;t<e.length;t++){var a=e[t];a.destroy(renderstate)}};return t}();var Ts=function(){function t(t,e,a){this.__gl=t,this.__material=e,this.__glshader=a,this.updated=new dr,this.__shaderBindings={}}t.prototype.getMaterial=function(){return this.__material};t.prototype.getGLShader=function(){return this.__glshader};t.prototype.generateShaderBinding=function(){var t=this.__material.getParameters();for(var e=0,a=t;e<a.length;e++){var i=a[e];bindParam(gl,i)}};t.prototype.bind=function(t,e){this.__boundTexturesBeforeMaterial=t.boundTextures;var a=this.__shaderBindings[t.shaderkey];if(!a){var i=this.__gl;a=new Ls(i,this,t.unifs,e),this.__shaderBindings[t.shaderkey]=a}return a.bind(t)};t.prototype.unbind=function(t){t.boundTextures=this.__boundTexturesBeforeMaterial};return t}();var Ms=function(){function t(t,e){this.resized=new dr,this.updated=new dr,this.__gl=t,this.textureTargets=[],this.depthTexture=null,e&&this.configure(e)}t.prototype.configure=function(t){var e=this.__gl,a=function(t,e){if(!e.width||!e.height)throw new Error("Invalid texture params");var a=t.getParameter(t.MAX_TEXTURE_SIZE);if(e.width<=0||e.width>a||e.height<=0||e.height>a)throw new Error("GLTextureParams: Invalid texture size. width:"+e.width+" height:"+e.height+" maxSize:"+a);var i={width:e.width,height:e.height},n=function(a,n){a in e?i[a]=isNaN(e[a])?t[e[a]]:e[a]:n&&(i[a]=n)};if(n("format"),n("internalFormat",i.format),n("type",t.UNSIGNED_BYTE),n("minFilter",t.LINEAR),n("magFilter",t.LINEAR),n("wrapS",t.CLAMP_TO_EDGE),n("wrapT",t.CLAMP_TO_EDGE),n("flipY",!1),n("mipMapped",!1),n("depthFormat"),n("depthType"),i.format==t.FLOAT)if("webgl2"==t.name)i.filter!=t.LINEAR||t.__ext_float_linear||(console.warn("Floating point texture filtering not supported on result device"),i.filter=t.NEAREST);else if(t.__ext_float)i.filter!=t.LINEAR||t.__ext_float_linear||(console.warn("Floating point texture filtering not supported on result device"),i.filter=t.NEAREST);else{if(!t.__ext_half_float)throw new Error("OES_texture_half_float is not available");i.format=t.HALF_FLOAT,i.filter!=t.LINEAR||t.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on result device"),i.filter=t.NEAREST)}else if(i.format==t.HALF_FLOAT)if("webgl2"==t.name);else{if(!t.__ext_half_float)throw new Error("OES_texture_half_float is not available");if(i.filter!=t.LINEAR||t.__ext_texture_half_float_linear||(console.warn("Half Float texture filtering not supported on result device"),i.filter=t.NEAREST),i.channels==t.RGB)throw new Error("OES_texture_half_float onlysupports RGBA textures")}else if("sRGB"==i.format&&!t.__ext_sRGB)throw new Error("EXT_sRGB is not available");return null!=i.format&&"webgl2"==t.name&&i.internalFormat==i.format&&(i.type==t.FLOAT?i.format==t.RED||i.format==t.RED?i.internalFormat=t.R32F:i.format==t.RG?i.internalFormat=t.RG32F:i.format==t.RGBA&&(i.internalFormat=t.RGBA32F):i.type==t.HALF_FLOAT?i.format==t.RED?i.internalFormat=t.R16F:i.format==t.RGB?i.internalFormat=t.RGB16F:i.format==t.RGBA&&(i.internalFormat=t.RGBA16F):i.type==t.UNSIGNED_BYTE&&(i.format==t.RED&&(i.internalFormat=t.R8),i.format==t.RGB?i.internalFormat=t.RGB8:i.format==t.RGBA&&(i.internalFormat=t.RGBA8))),null!=i.depthFormat&&("webgl2"==t.name?i.depthType==t.UNSIGNED_SHORT?i.depthInternalFormat=t.DEPTH_COMPONENT16:i.depthType==t.UNSIGNED_INT&&(i.depthInternalFormat=t.UNSIGNED_INT):i.depthInternalFormat=i.depthFormat),i}(e,t);this.textureTargets.forEach((function(t){e.deleteTexture(t)})),this.textureTargets=[],this.depthTexture&&(e.deleteTexture(this.depthTexture),this.depthTexture=null),this.frameBuffer&&e.deleteFramebuffer(this.frameBuffer),this.type=a.type,this.format=a.format,this.internalFormat=a.internalFormat,this.filter=a.filter,this.wrap=a.wrap,this.flipY=a.flipY,this.width=a.width,this.height=a.height,this.clearColor=new An(0,0,0,0),this.colorMask=[!0,!0,!0,!0],this.textureType=1,this.textureDesc=[this.width,this.height,0,0];var i=null!=t.numColorChannels?t.numColorChannels:null!=a.format?1:0;for(var n=0;n<i;n++){e.activeTexture(e.TEXTURE0+1);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a.wrapT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.minFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a.magFilter),e.texImage2D(e.TEXTURE_2D,0,this.internalFormat,a.width,a.height,0,this.format,this.type,null),this.textureTargets.push(r)}if(a.depthFormat){if("webgl"==e.name&&!e.__ext_WEBGL_depth_texture)throw new Error("Depth textures not support on this device");e.activeTexture(e.TEXTURE0),this.depthTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.depthTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a.wrapT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.minFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a.magFilter),e.texImage2D(e.TEXTURE_2D,0,a.depthInternalFormat,a.width,a.height,0,a.depthFormat,a.depthType,null)}if(this.frameBuffer=e.createFramebuffer(),"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.frameBuffer):e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),this.textureTargets.length>0){if(this.textureTargets.length>1&&"webgl"==e.name&&!e.drawBuffers){e.__ext_draw_buffers=e.getExtension("WEBGL_draw_buffers"),e.drawBuffers=e.__ext_draw_buffers.drawBuffersWEBGL.bind(e.__ext_draw_buffers);for(var o=1;o<14;o++)e["COLOR_ATTACHMENT"+o]=e.__ext_draw_buffers["COLOR_ATTACHMENT"+o+"_WEBGL"];e.MAX_COLOR_ATTACHMENTS=e.__ext_draw_buffers.MAX_COLOR_ATTACHMENTS_WEBGL,e.MAX_DRAW_BUFFERS=e.__ext_draw_buffers.MAX_DRAW_BUFFERS_WEBGL}var l=[];for(var s=0;s<this.textureTargets.length;s++)e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,this.textureTargets[s],0),l.push(e.COLOR_ATTACHMENT0+s);this.textureTargets.length>1&&e.drawBuffers(l)}this.depthTexture&&e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this.depthTexture,0);var d=e.checkFramebufferStatus(e.DRAW_FRAMEBUFFER);if(d!=e.FRAMEBUFFER_COMPLETE)switch(d){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer.");case 36061:throw new Error("The framebuffer is unsupported");default:throw new Error("Incomplete Frambuffer")}this.unbind()};t.prototype.bindForWriting=function(t,e){if(e===void 0){e=!1}t&&(this.__prevBoundFbo=t.boundRendertarget,t.boundRendertarget=this.frameBuffer);var a=this.__gl;"webgl2"==a.name?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.frameBuffer):a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.viewport(0,0,this.width,this.height),e&&this.clear()};t.prototype.unbindForWriting=function(t){t&&(t.boundRendertarget=this.__prevBoundFbo);var e=this.__gl;"webgl2"==e.name?e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.__prevBoundFbo):e.bindFramebuffer(e.FRAMEBUFFER,this.__prevBoundFbo)};t.prototype.clear=function(t){if(t===void 0){t=!0}var e=this.__gl;e.colorMask.apply(e,this.colorMask),e.clearColor.apply(e,this.clearColor.asArray());var a=0;this.textureTargets.length>0&&(a|=e.COLOR_BUFFER_BIT),this.depthTexture&&(a|=e.DEPTH_BUFFER_BIT),e.clear(a)};t.prototype.bindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer)};t.prototype.unbindForReading=function(){var t=this.__gl;"webgl2"==t.name?t.bindFramebuffer(t.READ_FRAMEBUFFER,null):t.bindFramebuffer(t.FRAMEBUFFER,null)};t.prototype.bindColorTexture=function(t,e,a){if(a===void 0){a=0}var i=this.__gl,n=t.boundTextures++;return i.uniform1i(e.location,n),i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,this.textureTargets[a]),!0};t.prototype.bindDepthTexture=function(t,e){var a=this.__gl,i=t.boundTextures++;return a.uniform1i(e.location,i),a.activeTexture(a.TEXTURE0+i),a.bindTexture(a.TEXTURE_2D,this.depthTexture),!0};t.prototype.unbind=function(){var t=this.__gl;t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)};t.prototype.resize=function(t,e,a){if(a===void 0){a=!1}};t.prototype.bindToUniform=function(t,e,a){var i=t.boundTextures++,n=this.__gl.TEXTURE0+i,r=this.__gl;return r.activeTexture(n),r.bindTexture(r.TEXTURE_2D,this.textureTargets[0]),r.uniform1i(e.location,i),a&&(a.textureTypeUnif&&r.uniform1i(a.textureTypeUnif.location,this.textureType),a.textureDescUnif&&this.__gl.uniform4fv(a.textureDescUnif.location,this.textureDesc)),!0};t.prototype.destroy=function(){var t=this.__gl;this.textureTargets.forEach((function(e){t.deleteTexture(e)})),this.textureTargets=[],this.depthTexture&&(t.deleteTexture(this.depthTexture),this.depthTexture=null),this.frameBuffer&&t.deleteFramebuffer(this.frameBuffer)};return t}();var Fs=new Uint32Array(1);function Cs(t){return Fs[0]=t,Fs[0]=(Fs[0]<<16|Fs[0]>>16)>>>0,Fs[0]=(1431655765&Fs[0])<<1|(2863311530&Fs[0])>>>1>>>0,Fs[0]=(858993459&Fs[0])<<2|(3435973836&Fs[0])>>>2>>>0,Fs[0]=(252645135&Fs[0])<<4|(4042322160&Fs[0])>>>4>>>0,Fs[0]=(16711935&Fs[0])<<8|(4278255360&Fs[0])>>>8>>>0,2.3283064365386963e-10*Fs[0]}function Ns(t,e){return[t/e,Cs(t)]}gs.setShaderModule("utils/imageAtlas.glsl","\n\n// Note: On mobile, I can't seem to pass around a stuct containing sampler2D.\n// I have to unpack the struct and pass its members. :(\n// struct ImageAtlas {\n//     sampler2D layout;\n//     sampler2D image;\n//     vec4 desc;\n// };\n\n\n\nvec4 getSubImageLayout(int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    return fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n}\n\nvec2 calcSubImageTexCoords(vec2 texCoord, int index, in sampler2D atlasLayout, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    // The following line is a hack to fix artifacts in our PBR lighting\n    // We were seeing loads of lighting garbage on some sufaces that were orthogonal\n    // to the world. The UV coordinates would have been landing right on the edges\n    // of our subimages and were often sampling outside the image. This couuld\n    // have been because of filtering, or an error in the uv coords. \n    texCoord = clamp(texCoord, vec2(0.01, 0.01), vec2(0.99, 0.99));\n    vec2 subimageTexel = texCoord * layoutData.zw;\n    // subimageTexel = clamp(subimageTexel, vec2(0.0, 0.0), vec2(1.0, 1.0));\n    return subimageTexel + layoutData.xy;\n}\n\nvec4 sampleSubImage(vec2 texCoord, int index, in sampler2D atlasLayout, in sampler2D atlasImage, in vec4 atlasDesc){\n    vec4 layoutData = fetchTexel(atlasLayout, int(floor(atlasDesc.z+0.5)), index);\n    vec2 atlasCoords = calcSubImageTexCoords(texCoord, index, atlasLayout, atlasDesc);\n    return texture2D(atlasImage, atlasCoords);\n}\n\n");var Ys=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("AtlasLayoutShader.vertexShader",'\n\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform vec2 pos;\nuniform vec2 size;\nuniform vec2 srctextureDim;\nconst int border = 2;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * size * 2.0), 0.0, 1.0);\n\n  vec2 borderVec2 = vec2(float(border), float(border));\n  v_texCoord *= (srctextureDim + (borderVec2 * 2.0)) / srctextureDim;\n  v_texCoord -= borderVec2 / srctextureDim;\n}\n\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("AtlasLayoutShader.fragmentShader","\nprecision highp float;\n\nuniform sampler2D srctexture;\nuniform vec2 srctextureDim;\nuniform bool alphaFromLuminance;\nuniform bool invert;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\nfloat luminanceFromRGB(vec3 rgb) {\n  return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n  vec2 pixelCoord = v_texCoord*srctextureDim;\n  vec2 uv = v_texCoord;\n\n  // Wrap X coords\n  if(pixelCoord.x < 0.0){\n    uv.x += 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n  else if(pixelCoord.x > srctextureDim.x){\n    uv.x -= 1.0/srctextureDim.x;\n    uv.y = 1.0 - uv.y;\n  }\n\n  // Wrap Y coords\n  if(pixelCoord.y < 0.0){\n    uv.y += 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n  else if(pixelCoord.y > srctextureDim.y){\n    uv.y -= 1.0/srctextureDim.y;\n    uv.x = 1.0 - uv.x;\n  }\n\n  vec4 texel = texture2D(srctexture, uv);\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  // TODO: check why we pre-multiply alphas here.\n  // fragColor = vec4(texel.rgb/texel.a, texel.a);\n\n  if(alphaFromLuminance) {\n    fragColor = vec4(texel.rgb, luminanceFromRGB(texel.rgb));\n  }\n  else {\n    fragColor = texel;\n  }\n  \n  if(invert) {\n    fragColor = vec4(1.0) - fragColor;\n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n");return a}return e}(Zs);var Ks=function(t){__extends(e,t);function e(e,a,i,n){if(i===void 0){i="RGBA"}if(n===void 0){n="FLOAT"}var r=this;r=t.call(this,e)||this,r.__name=a,r.__formatParam=i,r.__typeParam=n,r.clearColor=new An(0,0,0,0),r.__subImages=[],r.__layoutNeedsRegeneration=!1,r.__async=new ur,r.loaded=r.__async.ready;return r}e.prototype.isLoaded=function(){return 0==this.__async.count};e.prototype.getMainImage=function(){return this.super};e.prototype.addSubImage=function(t){var e=this;if(t instanceof mo){var a=new ds(this.__gl,t);t.isLoaded()||(this.__async.incAsyncCount(),t.loaded.connect((function(){e.__async.decAsyncCount()}))),t.setMetadata("ImageAtlas_gltex",a),a.addRef(this),t.updated.connect((function(){e.__layoutNeedsRegeneration=!0,e.renderAtlas()})),this.__subImages.push(a)}else t.addRef(this),this.__subImages.push(t);return this.__layoutNeedsRegeneration=!0,this.__subImages.length-1};e.prototype.removeSubImage=function(t){var e;if(t instanceof mo){var a=t.getMetadata("ImageAtlas_gltex");e=this.__subImages.indexOf(a),t.deleteMetadata("ImageAtlas_gltex")}else e=this.__subImages.indexOf(t);this.__subImages[e].removeRef(this),this.__subImages.splice(e,1),this.__layoutNeedsRegeneration=!0};e.prototype.getSubImage=function(t){return this.__subImages[t]};e.prototype.numSubImages=function(){return this.__layout?this.__layout.length:this.__subImages.length};e.prototype.generateAtlasLayout=function(){var t=this;if(0==this.__subImages.length)return void(this.__layoutNeedsRegeneration=!1);var e=[];this.__subImages.forEach((function(t,a){e.push({w:t.width+4,h:t.height+4,area:t.width*t.height,index:a})})),e.sort((function(t,e){return t.area>e.area?-1:t.area<e.area?1:0}));var a=new cr;a.fit(e),this.__layout=[],e.forEach((function(e,a){e.fit?t.__layout[e.index]={pos:new Bn(e.fit.x+2,e.fit.y+2),size:new Bn(e.w,e.h)}:console.warn("Unable to fit image")}));var i=a.root.w,n=a.root.h;this.configure({width:i,height:n,format:"FLOAT"==this.__typeParam&&"RGB"==this.__formatParam?"RGBA":this.__formatParam,type:this.__typeParam,filter:"LINEAR"});var r=this.__gl;if(r.__quadVertexIdsBuffer||r.setupInstancedQuad(),!r.__atlasLayoutShader){r.__atlasLayoutShader=new Ys(r);var o=r.__atlasLayoutShader.compileForTarget("GLImageAtlas");r.__atlasLayoutShaderBinding=hs(r,o.attrs,r.__quadattrbuffers,r.__quadIndexBuffer)}var l=Math.round(Math.sqrt(1*this.__layout.length)+.5);if(l=Math.nextPow2(l),l%1!=0&&(l+=1-l%1),r.floatTexturesSupported){var s=new Float32Array(l*l*4);for(var d=0;d<this.__layout.length;d++){var c=this.__layout[d];On.createFromFloat32Buffer(s.buffer,4*d).set(c.pos.x/i,c.pos.y/n,c.size.x/i,c.size.y/n)}this.__atlasLayoutTexture&&this.__atlasLayoutTexture.width==l&&this.__atlasLayoutTexture.height==l?this.__atlasLayoutTexture.bufferData(s,l,l):(this.__atlasLayoutTexture&&this.__atlasLayoutTexture.destroy(),this.__atlasLayoutTexture=new ds(r,{format:"RGBA",type:"FLOAT",filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1,width:l,height:l,data:s}))}else this.__layoutVec4s=[],this.__layout.forEach((function(e,a){t.__layoutVec4s[a]=[e.pos.x/i,e.pos.y/n,e.size.x/i,e.size.y/n]}));this.__layoutNeedsRegeneration=!1};e.prototype.getLayoutData=function(t){return this.__layoutVec4s[t]};e.prototype.renderAtlas=function(t,e){if(t===void 0){t=!1}if(e===void 0){e=0}if(0==this.__subImages.length)return;this.__layoutNeedsRegeneration&&this.generateAtlasLayout();var a=this.__gl,i={};this.bindForWriting(i,!0),a.__atlasLayoutShader.bind(i,"GLImageAtlas"),a.__atlasLayoutShaderBinding.bind(i);var n=new Bn(1/this.width,1/this.height),r=i.unifs;for(var o=e;o<this.__subImages.length;o++){var l=this.__subImages[o],s=this.__layout[o];l.bindToUniform(i,r.srctexture),a.uniform2fv(r.pos.location,s.pos.multiply(n).asArray()),a.uniform2fv(r.size.location,s.size.multiply(n).asArray()),a.uniform2f(r.srctextureDim.location,l.width,l.height),a.uniform1i(r.alphaFromLuminance.location,l.alphaFromLuminance),a.uniform1i(r.invert.location,l.invert),a.drawQuad(),i.boundTextures--}t&&this.cleanup(),this.unbind(i),this.updated.emit()};e.prototype.isReady=function(){return null!=this.__atlasLayoutTexture};e.prototype.bindToUniform=function(e,a){if(!this.__atlasLayoutTexture)return!1;t.prototype.bindToUniform.call(this,e,a);var i=e.unifs,n=i[a.name+"_layout"];n&&this.__atlasLayoutTexture.bindToUniform(e,n);var r=i[a.name+"_desc"];return r&&this.__gl.uniform4f(r.location,this.width,this.height,this.__atlasLayoutTexture.width,0),!0};e.prototype.cleanup=function(){for(var t=0,e=this.__subImages;t<e.length;t++){var a=e[t];a.removeRef(this)}this.__subImages=[],this.destroy()};e.prototype.destroy=function(){this.cleanup(),t.prototype.destroy.call(this)};return e}(Ms);var ws=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("ConvolverShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID();\n  v_texCoord = position+0.5;\n  gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("ConvolverShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n\nuniform float roughness;\nvarying vec2 v_texCoord;\n\nuniform sampler2D hammersleyMap;\nvec2 Hammersley(int i, int N) {\n  vec4 rgba =  texture2D(hammersleyMap, vec2((float(i) + 0.5)/float(N)), 0.5);\n  return rgba.rg;\n}\n\nmat3 matrixFromVector(vec3 n) { // frisvad\n  float a = 1.0 / (1.0 + n.z);\n  float b = -n.x * n.y * a;\n  vec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n  vec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n  return mat3(b1, b2, n);\n}\n\nvec3 ImportanceSampleGGX(vec2 Xi, float a) {\n  float phi = 2.0 * PI * Xi.x;\n  float cos_theta = sqrt((1.0 - Xi.y)/(1.0 + (a*a - 1.0) * Xi.y));\n  float sin_theta = sqrt(1.0 - cos_theta * cos_theta);\n\n  // float phi = Xi.y * 2.0 * PI;\n  // float cos_theta = sqrt(1.0 - Xi.x);\n  // float sin_theta = sqrt(1.0 - cos_theta * cos_theta);\n\n  vec3 H;\n  H.x = sin_theta * cos(phi);\n  H.y = sin_theta * sin(phi);\n  H.z = cos_theta;\n  return H;\n}\n\n// TODO: use tobias\'s code. The guy clearly knows what he\'s doing...\n// https://github.com/thefranke/dirtchamber/blob/master/shader/importance.hlsl\n// Compute a LOD level for filtered importance sampling.\n// From GPU Gems 3: GPU-Based Importance Sampling.\n\n\n#define M_PI       3.14159265358979323846   // pi\n#define M_HALF_PI  1.57079632679489661923   // pi/2\nfloat sqr(float val){ return val*val; }\nfloat saturate(float val) { return clamp(val, 0.0, 1.0); }\nvec3 saturate(vec3 val) { return clamp(val, 0.0, 1.0); }\n\n// Microfacet Models for Refraction through Rough Surfaces\n// Walter et al.\n// http://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.html\n// aka Towbridge-Reitz\nfloat D_ggx(in float alpha, in float NoH)\n{\n  float a2 = alpha*alpha;\n  float cos2 = NoH*NoH;\n\n  return (1.0/M_PI) * sqr(alpha/(cos2 * (a2 - 1.0) + 1.0));\n\n  /*\n  // version from the paper, eq 33\n  float CosSquared = NoH*NoH;\n  float TanSquared = (1.0 - CosSquared)/CosSquared;\n  return (1.0/M_PI) * sqr(alpha/(CosSquared * (alpha*alpha + TanSquared)));\n  */\n}\nfloat compute_lod(in vec3 H, in float pdf, in int num_samples, in int ww, in int hh)\n{\n  return max(0.0, 0.5*log2(float(ww*hh)/float(num_samples)) - 0.5*log2(pdf));\n}\n\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec3 N = sphOctUvToDir(v_texCoord);\n\n  if(false){\n    vec2 uv = dirToSphOctUv(N);\n    // fragColor = vec4(uv.x, uv.y, 0.0, 1.0);\n    fragColor = sampleImagePyramid(uv, 0.5, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc);\n    // fragColor = sampleSubImage(uv, 0, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc);\n    // fragColor = texture2D(envMapPyramid, uv);\n  }\n  else{\n    const int numSamples = NUM_SAMPLES;\n    int w = int(floor(envMapPyramid_desc.x + 0.5));\n    int h = int(floor(envMapPyramid_desc.y + 0.5));\n\n    vec4 color = vec4(0.0,0.0,0.0,0.0);\n    float weight = 0.0;\n    mat3 vecSpace = matrixFromVector(N);\n    float a = roughness*roughness;\n    for(int i=0; i<numSamples; i++) {\n      vec2 Xi = Hammersley(i, numSamples);\n      vec3 H = ImportanceSampleGGX(Xi, a);\n      vec3 V = normalize(vecSpace * H);\n      float VdotN = dot(V, N);\n      float NoH = saturate( dot( N, H ) );\n      float VoH = saturate( dot( V, H ) );\n\n      vec2 uv = dirToSphOctUv(V);\n      // float pdf = D_ggx(a, NoH) * NoH / (4.0 * VoH);\n      // float lod = compute_lod(H, pdf, numSamples, w, h);\n\n      color += sampleImagePyramid(uv, a, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc) * VdotN;\n      weight += VdotN;\n    }\n    color /= float(weight);\n    fragColor = vec4(color.rgb, 1.0);\n  }\n  \n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n\n');return a}return e}(Zs);gs.setShaderModule("utils/imagePyramid.glsl",'\n\n<%include file="utils/imageAtlas.glsl"/>\n\nvec4 sampleImagePyramid(vec2 uv, float lod, in sampler2D atlasLayout, in sampler2D atlasImage, in vec4 atlasDesc){\n  if (lod < 0.00001 || lod > 0.9999) {\n    float imageIndex = lod * (atlasDesc.z-1.0);\n    int imageId0 = int(imageIndex);\n    return sampleSubImage(uv, imageId0, atlasLayout, atlasImage, atlasDesc);\n  } else {\n    float imageIndex = lod * (atlasDesc.z-1.0);\n    int imageId0 = int(floor(imageIndex));\n    int imageId1 = imageId0+1;\n    float blend = fract(imageIndex);\n    vec4 c0 = sampleSubImage(uv, imageId0, atlasLayout, atlasImage, atlasDesc);\n    vec4 c1 = sampleSubImage(uv, imageId1, atlasLayout, atlasImage, atlasDesc);\n    return mix(c0, c1, blend);\n  } \n}\n\n\n');var zs=function(t){__extends(e,t);function e(e,a,i,n,r){if(n===void 0){n=!0}if(r===void 0){r=16}var o=this;o=t.call(this,e,a)||this,o.__srcGLTex=i,o.__fbos=[],i.updated.connect((function(){o.renderAtlas(n)})),o.__srcGLTex.isLoaded()?(o.generateAtlasLayout(r),o.renderAtlas(n)):o.__srcGLTex.updated.connect((function(){o.generateAtlasLayout(r),o.renderAtlas(n)}));return o}e.prototype.generateAtlasLayout=function(e){var a=this.__gl;this.size=this.__srcGLTex.height;var i=this.__srcGLTex.width/this.__srcGLTex.height;this.addSubImage(this.__srcGLTex);for(var n=Math.round(function(t){return Math.log2(t)}(this.size))-1;n>=0;--n){var r=Math.pow(2,n);if(r<e)break;var o=new ds(a,{format:this.__srcGLTex.getFormat(),type:this.__srcGLTex.getType(),width:r*i,height:r,filter:"LINEAR",wrap:"CLAMP_TO_EDGE"});this.addSubImage(o),this.__fbos.push(new Xs(a,o))}t.prototype.generateAtlasLayout.call(this)};e.prototype.renderAtlas=function(e){if(e===void 0){e=!0}var a=this.__gl,i={};a.screenQuad.bindShader(i);for(var n=0;n<this.__fbos.length;n++)this.__fbos[n].bindAndClear(),a.screenQuad.draw(i,this.getSubImage(n));t.prototype.renderAtlas.call(this,e)};e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0,a=this.__fbos;e<a.length;e++){var i=a[e];i.destroy()}};return e}(Ks);var Us=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e,a)||this,i.__gl=e,e.__quadVertexIdsBuffer||e.setupInstancedQuad(),i.__convolved=!1,i.__fbos=[];return i}e.prototype.generateHammersleySamples=function(t){var e=this.__gl;if(!e["Hammersley"+t]){var a=new Float32Array(3*t);for(var i=0;i<t;i++){var n=Ns(i,t),r=3*i;a[r+0]=n[0],a[r+1]=n[1]}e["Hammersley"+t]=new ds(e,{format:"RGB",type:"FLOAT",filter:"NEAREST",wrap:"CLAMP_TO_EDGE",width:t,height:1,data:a,mipMapped:!1})}return e["Hammersley"+t]};e.prototype.convolveProbe=function(t){var e=this;var a=this.__gl,i=this.generateHammersleySamples(1024);if(!this.__convolved){this.__lodPyramid||(this.__lodPyramid=new zs(a,"Probe Lods",t,!1),this.__lodPyramid.updated.connect((function(){e.convolveProbe(t)}))),this.addSubImage(t);var n=[t.width/2,t.height/2];var r=6;for(var o=0;o<r;o++){var l=new ds(a,{format:"RGBA",type:"FLOAT",filter:"LINEAR",wrap:"CLAMP_TO_EDGE",width:n[0],height:n[1]});this.addSubImage(l);var s=new Xs(a,l);s.setClearColor([0,1,0,0]),this.__fbos.push(s),n=[n[0]/2,n[1]/2]}this.generateAtlasLayout(),this.__convolverShader=new ws(a);var d=this.__convolverShader.compileForTarget("GLProbe",Object.assign({repl:{NUM_SAMPLES:1024}},a.shaderopts));this.__covolverShaderBinding=hs(a,d.attrs,a.__quadattrbuffers,a.__quadIndexBuffer)}var c={};this.__convolverShader.bind(c,"GLProbe"),this.__covolverShaderBinding.bind(c);var u=c.unifs;for(var h=0;h<this.__fbos.length;h++){if(this.__fbos[h].bindAndClear(),this.__lodPyramid.bindToUniform(c,u.envMapPyramid),"hammersleyMap"in u&&i.bindToUniform(c,u.hammersleyMap),"roughness"in u){var m=(h+1)/this.__fbos.length;a.uniform1f(u.roughness.location,m)}a.drawQuad()}this.__convolved=!0,this.renderAtlas(!1)};e.prototype.bindProbeToUniform=function(e,a){this.__convolved&&t.prototype.bindToUniform.call(this,e,a)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__convolverShader.destroy();for(var e=0,a=this.__fbos;e<a.length;e++){var i=a[e];i.destroy()}};return e}(Ks);gs.setShaderModule("stack-gl/inverse.glsl","\n\n\n#ifndef ENABLE_ES3\n\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n#endif\n\n"),gs.setShaderModule("stack-gl/transpose.glsl","\n\n\n#ifndef ENABLE_ES3\n\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\n#endif\n\n"),gs.setShaderModule("pragmatic-pbr/envmap-octahedral.glsl","\n\n#define sectorize(value) step(0.0, (value))*2.0-1.0\n#define sum(value) dot(clamp((value), 1.0, 1.0), (value))\n\n\nvec2 dirToSphOctUv(vec3 normal){\n    normal = normalize(normal);\n    vec3 aNorm = abs(normal);\n    vec3 sNorm = sectorize(normal);\n\n    vec2 dir = max(aNorm.xy, 1e-20);\n    float orient = atan(dir.x, dir.y)/HalfPI;\n\n    dir = max(vec2(aNorm.z, length(aNorm.xy)), 1e-20);\n    float pitch = atan(dir.y, dir.x)/HalfPI;\n\n    vec2 uv = vec2(sNorm.x*orient, sNorm.y*(1.0-orient))*pitch;\n\n    if(normal.z < 0.0){\n        uv = sNorm.xy - abs(uv.ts)*sNorm.xy;\n    }\n    return uv*0.5+0.5;\n}\n\n\nvec3 sphOctUvToDir(vec2 uv){\n    uv = uv*2.0-1.0;\n    vec2 suv = sectorize(uv);\n    float sabsuv =  sum(abs(uv));\n    float pitch = sabsuv*HalfPI;\n\n    if (pitch <= 0.0) {\n        return vec3(0.0, 0.0, 1.0);\n    }\n    if (abs(pitch - PI) < 0.000001) {\n        return vec3(0.0, 0.0, -1.0);\n    }\n    if(sabsuv > 1.0){\n        uv = (1.0-abs(uv.ts))*suv;\n    }\n\n    float orient = (abs(uv.s)/sabsuv)*HalfPI;\n    float sOrient = sin(orient);\n    float cOrient = cos(orient);\n    float sPitch = sin(pitch);\n    float cPitch = cos(pitch);\n\n    return vec3(\n        sOrient*suv.s*sPitch,\n        cOrient*suv.t*sPitch,\n        cPitch\n    );\n}\n\n"),gs.setShaderModule("pragmatic-pbr/envmap-equirect.glsl","\n\n\nvec2 latLongUVsFromDir(vec3 dir) {\n  // Math function taken from...\n  // http://gl.ict.usc.edu/Data/HighResProbes/\n  // Note: Scaling from u=[0,2], v=[0,1] to u=[0,1], v=[0,1]\n  float phi = acos(dir.z);\n  float theta = atan(dir.x, dir.y);\n  return vec2((1.0 + theta / PI) / 2.0, phi / PI);\n}\n\n// Note: when u == 0.5 z = 1.0\nvec3 dirFromLatLongUVs(float u, float v) {\n    // http://gl.ict.usc.edu/Data/HighResProbes/\n    float theta = PI*((u * 2.0) - 1.0);\n    float phi = PI*v;\n    return vec3(sin(phi)*sin(theta), sin(phi)*cos(theta), cos(phi));\n}\n\nvec3 dirFromPolar(vec2 polar) {\n    float u = polar.x / (PI * 2.0);\n    float v = polar.y / PI;\n    return dirFromLatLongUVs(u, v);\n}\n\n"),gs.setShaderModule("pragmatic-pbr/envmap-dualfisheye.glsl","\n\n\n\nvec2 dualfisheyeUVsFromDir(vec3 dir) {\n  vec2 result;\n  float angle = 0.465;\n    if(dir.x < 0.0) {\n        result = vec2(((dir.z * -angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n    }\n    else {\n        result = vec2( 0.5 + ((dir.z * angle) + 0.5) * 0.5, (dir.y * angle) + 0.5);\n    }\n    return result;\n}\n\n\n");var Js=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("EnvMapShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\n\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n  vec2 position = getQuadVertexPositionFromID() * 2.0;\n  v_texCoord = position * 0.5 + 0.5;\n\n  mat4 inverseProjection = inverse(projectionMatrix);\n  mat3 inverseModelview = transpose(mat3(viewMatrix));\n\n  // transform from the normalized device coordinates back to the view space\n  vec3 unprojected = (inverseProjection * vec4(position, 0, 1)).xyz;\n\n  // transfrom from the view space back to the world space\n  // and use it as a sampling vector\n  v_worldDir = inverseModelview * unprojected;\n\n  gl_Position = vec4(position, 0, 1);\n}\n\n');return a}return e}(Zs);var Ps=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("LatLongEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec4 texel = texture2D(backgroundImage, v_texCoord);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(Js);var Es=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("OctahedralEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n\nuniform float focus;\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\n// uniform ImageAtlas envMap;\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dirToSphOctUv(normalize(v_worldDir));\n  if(false){\n    // Use these lines to debug the src GL image.\n    vec4 texel = texture2D(envMapPyramid, uv);\n    fragColor = vec4(texel.rgb/texel.a, 1.0);\n  }\n  else{\n    fragColor = vec4(sampleImagePyramid(uv, focus, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc).rgb, 1.0);\n  }\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(Js);var Hs=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("LatLongEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = latLongUVsFromDir(normalize(v_worldDir));\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){return t.getParamDeclarations.call(this)};return e}(Js);var ks=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("SterioLatLongEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform int eye;// L = 0, R = 1;\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = latLongUVsFromDir(normalize(v_worldDir));\n  uv.y *= 0.5;\n  if(eye == 1){\n    uv.y += 0.5;\n  }\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(Js);var Bs=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("DualFishEyeEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-dualfisheye.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dualfisheyeUVsFromDir(normalize(v_worldDir));\n\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(Js);var Ds=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("DualFishEyeEnvMapShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n<%include file="pragmatic-pbr/envmap-dualfisheye.glsl"/>\n\n#define ENABLE_INLINE_GAMMACORRECTION\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\nuniform float exposure;\n#endif\n\nuniform sampler2D backgroundImage;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\n\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 uv = dualfisheyeUVsFromDir(dirFromLatLongUVs(v_texCoord.x, v_texCoord.y));\n  vec4 texel = texture2D(backgroundImage, uv);\n  fragColor = vec4(texel.rgb/texel.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  //fragColor.rgb = toGamma(fragColor.rgb * exposure);\n\n  // Assuming a simple RGB image in gamma space for now.\n  // fragColor.rgb = fragColor.rgb * exposure;\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(Js);var Os=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,e.gl,"EnvMap")||this,n.__renderer=e,n.__envMap=a,n.__backgroundFocus=0;var r=e.gl;r.__quadVertexIdsBuffer||r.setupInstancedQuad();var o=n.__envMap.getMetadata("gltexture");o||(o=new vs(r,n.__envMap)),n.__srcGLTex=o,n.__envMapShader=new Es(r);var l=n.__envMapShader.compileForTarget("GLEnvMap",i);n.__envMapShaderBinding=hs(r,l.attrs,r.__quadattrbuffers,r.__quadIndexBuffer),n.__envMap.isLoaded()?n.convolveProbe(o):n.__envMap.loaded.connect((function(){n.convolveProbe(o),n.loaded.emit()}));return n}e.prototype.getEnvMap=function(){return this.__envMap};e.prototype.getBackgroundFocus=function(){return this.__backgroundFocus};e.prototype.setBackgroundFocus=function(t){this.__backgroundFocus=t,this.__renderer.requestRedraw()};e.prototype.draw=function(t){if(this.__envMap.isLoaded()){var e=this.__gl;{this.__envMapShader.bind(t,"GLEnvMap");var a=t.unifs;this.bindProbeToUniform(t,a.envMapPyramid);{var i=a.focus;i&&e.uniform1f(i.location,this.__backgroundFocus)}{var n=a.exposure;n&&e.uniform1f(n.location,t.exposure)}this.__envMapShaderBinding.bind(t),e.depthMask(!1),t.bindViewports(a,(function(){e.drawQuad()}))}}};e.prototype.bindToUniform=function(t,e,a){return this.__srcGLTex.bindToUniform(t,e,a)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__srcGLTex.loaded.disconnectScope(this),this.__srcGLTex.updated.disconnectScope(this),this.__srcGLTex.destroy()};return e}(Us);var Qs=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("ScreenQuadShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform vec2 pos;\nuniform vec2 size;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(vec2(-1.0, -1.0) + (pos * 2.0) + (v_texCoord * abs(size) * 2.0), 0.0, 1.0);\n    if(size.x < 0.0)\n        v_texCoord.x = 1.0 - v_texCoord.x;\n    if(size.y < 0.0)\n        v_texCoord.y = 1.0 - v_texCoord.y;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("ScreenQuadShader.fragmentShader","\nprecision highp float;\n\nuniform sampler2D image;\n\nvarying vec2 v_texCoord;\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = texture2D(image, v_texCoord);\n    fragColor = vec4(fragColor.rgb/fragColor.a, 1.0);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n"),a.finalize();return a}return e}(Zs);var As=function(){function t(t,e){this.__gl=t,this.__pos=[0,0],this.__size=[1,1],this.flipY=!0,this.__glshader=new Qs(t),t.__quadVertexIdsBuffer||t.setupInstancedQuad();var a=this.__glshader.compileForTarget("GLScreenQuad",e);this.__quadBinding=hs(t,a.attrs,t.__quadattrbuffers,t.__quadIndexBuffer),this.ready=!0}t.prototype.bind=function(t,e,a,i){var n=t.unifs;e.bindToUniform(t,t.unifs.image);var r=this.__gl;{var o=n.pos;o&&r.uniform2fv(o.location,a?a instanceof Hn?a.asArray():a:this.__pos)}{var l=n.size;l&&r.uniform2fv(l.location,i?i instanceof Hn?i.asArray():i:this.__size)}this.__quadBinding.bind(t)};t.prototype.bindShader=function(t){return this.__glshader.bind(t,"GLScreenQuad")};t.prototype.draw=function(t,e,a,i){this.bind(t,e,a,i),this.__gl.drawQuad()};t.prototype.destroy=function(){};return t}();var js=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__renderer=e,a.__doubleClickTimeMSParam=a.addParameter(new Br("DoubleClickTimeMS",200)),a.__fbo=void 0,a.updated=new dr,a.resized=new dr,a.__renderer.sceneSet.connect((function(){var t=e.getScene().settings.getParameter("BackgroundColor"),i=function(e){var i=t.getValue();var n=a.__renderer.gl;i instanceof mo?"FLOAT"===i.type?(a.__backgroundTexture=i,a.__backgroundGLTexture=new vs(n,i)):(a.__backgroundTexture=i,a.__backgroundGLTexture=new ds(n,i)):i instanceof An?(a.__backgroundGLTexture&&(a.__backgroundGLTexture.destroy(),a.__backgroundGLTexture=void 0,a.__backgroundTexture=void 0),a.__backgroundColor=i):console.warn("Invalid background:"+i),a.updated.emit()};i(t.getValue()),t.valueChanged.connect(i)}));return a}e.prototype.getRenderer=function(){return this.__renderer};e.prototype.getName=function(){return this.__name};e.prototype.getBl=function(){return this.__bl};e.prototype.setBl=function(t){this.__bl=t,this.resize(this.__canvasWidth,this.__canvasHeight)};e.prototype.getTr=function(){return this.__tr};e.prototype.setTr=function(t){this.__tr=t,this.resize(this.__canvasWidth,this.__canvasHeight)};e.prototype.getPosX=function(){return this.__x};e.prototype.getPosY=function(){return this.__y};e.prototype.getWidth=function(){return this.__width};e.prototype.getHeight=function(){return this.__height};e.prototype.getBackground=function(){return console.warn("Deprecated Function. Please access the Scene Settings object."),this.__renderer.getScene().settings.getParameter("BackgroundColor").getValue()};e.prototype.setBackground=function(t){console.warn("Deprecated Function. Please access the Scene Settings object."),this.__renderer.getScene().settings.getParameter("BackgroundColor").setValue(t),this.updated.emit()};e.prototype.resize=function(t,e){this.__canvasWidth=t,this.__canvasHeight=e,this.__width=t,this.__height=e,this.resized.emit()};e.prototype.onMouseDown=function(t){return!1};e.prototype.onMouseUp=function(t){return!1};e.prototype.onMouseMove=function(t){return!1};e.prototype.onMouseLeave=function(t){return!1};e.prototype.onKeyPressed=function(t,e){return!1};e.prototype.onKeyDown=function(t,e){return!1};e.prototype.onKeyUp=function(t,e){return!1};return e}(Rr);var qs=function(t){__extends(e,t);function e(e,a,i,n){var r=this;r=t.call(this,e)||this,r.__name=a,r.__projectionMatrix=new $n,r.__frustumDim=new Bn,r.__bl=new Bn(0,0),r.__tr=new Bn(1,1),r.__exposure=0,r.__exposureRange=[-5,10],r.__tonemap=!0,r.__gamma=2.2,r.__prevDownTime=0,r.__geomDataBuffer=void 0,r.__geomDataBufferFbo=void 0,r.viewChanged=new dr,r.capturedItem=null,r.keyDown=new dr,r.keyPressed=new dr,r.keyUp=new dr,r.mouseDown=new dr,r.mouseDoubleClicked=new dr,r.mouseMove=new dr,r.mouseUp=new dr,r.mouseLeave=new dr,r.mouseDownOnGeom=new dr,r.mouseWheel=new dr,r.touchStart=new dr,r.touchMove=new dr,r.touchEnd=new dr,r.touchCancel=new dr,r.doubleTapped=new dr,r.setCamera(new El("Default")),r.setManipulator(new os),r.resize(i,n);return r}e.prototype.resize=function(t,e){this.__canvasWidth=t,this.__canvasHeight=e,this.__x=t*this.__bl.x,this.__y=t*this.__bl.y,this.__width=t*this.__tr.x-t*this.__bl.x,this.__height=e*this.__tr.y-e*this.__bl.y,this.region=[this.__x,this.__y,this.__width,this.__height],this.__camera&&this.__updateProjectionMatrix(),this.__geomDataBufferFbo&&(this.__geomDataBuffer.resize(this.__width,this.__height),this.__geomDataBufferFbo.resize()),this.resized.emit()};e.prototype.getCamera=function(){return this.__camera};e.prototype.setCamera=function(t){var e=this;this.__camera=t;var a=t.getParameter("GlobalXfo"),i=function(){e.__cameraXfo=a.getValue(),e.__cameraMat=e.__cameraXfo.toMat4(),e.__viewMat=e.__cameraMat.inverse()};i(),a.valueChanged.connect((function(){i(),e.invalidateGeomDataBuffer(),e.updated.emit(),e.viewChanged.emit({interfaceType:"CameraAndPointer",viewXfo:e.__cameraXfo,focalDistance:e.__camera.getFocalDistance()})})),this.__camera.projectionParamChanged.connect((function(){e.__updateProjectionMatrix(),e.updated.emit()})),this.__updateProjectionMatrix()};e.prototype.getManipulator=function(){return this.__cameraManipulator};e.prototype.setManipulator=function(t){this.__cameraManipulator=t};e.prototype.__updateProjectionMatrix=function(){var t=this.__width/this.__height;this.__camera.updateProjectionMatrix(this.__projectionMatrix,t);var e=Math.tan(this.__camera.getFov()/2)*this.__camera.getNear()*2,a=e*t;this.__frustumDim.set(a,e)};e.prototype.getProjectionMatrix=function(){return this.__projectionMatrix};e.prototype.getViewMatrix=function(){return this.__viewMat};e.prototype.setActive=function(t){activeViewport=t?this:void 0};e.prototype.frameView=function(t){this.__camera.frameView(this,t)};e.prototype.calcRayFromScreenPos=function(t){var e=this.__canvasHeight*(1-this.__tr.y);var a=(t.x-this.__x)/this.__width,i=(t.y-e)/this.__height;a=2*a-1,i=2*i-1;var n=this.__cameraMat,r=this.__projectionMatrix.inverse();if(null==r)return null;var o,l;return this.__camera.getIsOrthographic()?(o=n.transformVec3(r.transformVec3(new Dn(a,-i,-1))),l=new Dn(0,0,-1)):(o=n.translation,l=r.transformVec3(new Dn(a,-i,-1))),l=n.rotateVec3(l).normalize(),new er(o,l)};e.prototype.createGeomDataFbo=function(t){var e=this.__renderer.gl;this.__floatGeomBuffer=t,this.__floatGeomBuffer?this.__geomDataBuffer=new ds(e,{type:"FLOAT",format:"RGBA",filter:"NEAREST",width:this.__width<=1?1:this.__width,height:this.__height<=1?1:this.__height}):this.__geomDataBuffer=new ds(e,{type:"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:this.__width<=1?1:this.__width,height:this.__height<=1?1:this.__height}),this.__geomDataBufferFbo=new Xs(e,this.__geomDataBuffer,!0),this.__geomDataBufferFbo.setClearColor([0,0,0,0])};e.prototype.getGeomDataFbo=function(){return this.__geomDataBufferFbo};e.prototype.renderGeomDataFbo=function(){if(this.__geomDataBufferFbo){this.__geomDataBufferFbo.bindAndClear();var t={};this.__initRenderState(t),this.__renderer.drawSceneGeomData(t),this.__geomDataBufferInvalid=!1}};e.prototype.invalidateGeomDataBuffer=function(){this.__geomDataBufferInvalid=!0};e.prototype.getGeomDataAtPos=function(t,e){if(this.__geomDataBufferFbo){if(this.__geomDataBufferInvalid&&(this.renderGeomDataFbo(),this.__screenPos=null),t===this.__screenPos)return this.__intersectionData;this.__screenPos=t,this.__intersectionData=null;var a=this.__renderer.gl;var i,n=void 0;if(a.finish(),this.__geomDataBufferFbo.bindForReading(),a.floatGeomBuffer){if(n=new Float32Array(4),a.readPixels(t.x,this.__height-t.y,1,1,a.RGBA,a.FLOAT,n),0==n[3])return;i=63&Math.round(n[0])}else{if(n=new Uint8Array(4),a.readPixels(t.x,this.__height-t.y,1,1,a.RGBA,a.UNSIGNED_BYTE,n),a.bindFramebuffer(a.FRAMEBUFFER,null),0==n[0]&&0==n[1])return;i=0}this.__geomDataBufferFbo.unbind();var r=this.__renderer.getPass(i);if(!r)return void console.warn("Geom data buffer returns invalid pass id:",i);var o=r.getGeomItemAndDist(n);if(o){e||(e=this.calcRayFromScreenPos(t));var l=e.start.add(e.dir.scale(o.dist));this.__intersectionData={screenPos:t,mouseRay:e,intersectionPos:l,geomItem:o.geomItem,dist:o.dist,geomData:n}}return this.__intersectionData}};e.prototype.getGeomItemsInRect=function(t,e){if(this.__geomDataBufferFbo){var a=this.__renderer.gl;a.finish();var i=Math.round(this.__height-e.y),n=Math.round(t.x),r=Math.round(e.x-t.x),o=Math.round(e.y-t.y),l=r*o;var s=void 0;this.__geomDataBufferFbo.bindForReading(),a.floatGeomBuffer?(s=new Float32Array(4*l),a.readPixels(n,i,r,o,a.RGBA,a.FLOAT,s)):(s=new Uint8Array(4*l),a.readPixels(n,i,r,o,a.RGBA,a.UNSIGNED_BYTE,s)),a.bindFramebuffer(a.FRAMEBUFFER,null);var d=new Set;for(var c=0;c<l;c++){var u=void 0;var h=s.subarray(4*c,4*(c+1));u=a.floatGeomBuffer?Math.round(h[0]):0;var m=this.__renderer.getPass(u).getGeomItemAndDist(h);m&&d.add(m.geomItem)}return d}};e.prototype.__eventMousePos=function(t){return new Bn(t.rendererX-this.getPosX(),t.rendererY-this.getPosY())};e.prototype.__prepareEvent=function(t){var e=this;if(t.viewport=this,t.propagating=!0,t.stopPropagation(),t.stopPropagation=function(){t.propagating=!1},t.setCapture=function(t){e.capturedItem=t},t.getCapture=function(t){return e.capturedItem},t.releaseCapture=function(){e.capturedItem=null,e.renderGeomDataFbo()},t instanceof MouseEvent){var a=this.__eventMousePos(t);t.mousePos=a,t.mouseRay=this.calcRayFromScreenPos(a);var i=this.getGeomDataAtPos(t.mousePos,t.mouseRay);null!=i&&(t.intersectionData=i)}};e.prototype.setCapture=function(t){this.capturedItem=t};e.prototype.getCapture=function(){return this.capturedItem};e.prototype.releaseCapture=function(){this.capturedItem=null,this.renderGeomDataFbo()};e.prototype.onMouseDown=function(t){if(this.__prepareEvent(t),this.capturedItem)return void this.capturedItem.onMouseDown(t);if(null!=t.intersectionData){if(t.intersectionData.geomItem.onMouseDown(t),!t.propagating||this.capturedItem)return;if(this.mouseDownOnGeom.emit(t),!t.propagating)return}var e=Date.now();if(e-this.__prevDownTime<this.__doubleClickTimeMSParam.getValue()){if(this.__cameraManipulator&&(this.__cameraManipulator.onDoubleClick(t),!t.propagating))return;this.mouseDoubleClicked.emit(t)}else{if(this.__prevDownTime=e,this.__cameraManipulator&&(this.__cameraManipulator.onMouseDown(t),!t.propagating))return;this.mouseDown.emit(t)}return!1};e.prototype.onMouseMove=function(t){if(this.__prepareEvent(t),this.capturedItem)this.capturedItem.onMouseMove(t);else{if(null!=t.intersectionData){if(t.intersectionData.geomItem!=this.mouseOverItem&&(this.mouseOverItem&&this.mouseOverItem.onMouseLeave(t),this.mouseOverItem=t.intersectionData.geomItem,this.mouseOverItem.onMouseEnter(t)),t.intersectionData.geomItem.onMouseMove(t),!t.propagating||this.capturedItem)return}else this.mouseOverItem&&(this.mouseOverItem.onMouseLeave(t),this.mouseOverItem=null);this.__cameraManipulator&&(this.__cameraManipulator.onMouseMove(t),!t.propagating)||this.mouseMove.emit(t)}};e.prototype.onMouseUp=function(t){this.__prepareEvent(t),this.capturedItem?this.capturedItem.onMouseUp(t):(null==t.intersectionData||(t.intersectionData.geomItem.onMouseUp(t),t.propagating))&&(this.__cameraManipulator&&(this.__cameraManipulator.onMouseUp(t),!t.propagating)||this.mouseUp.emit(t))};e.prototype.onMouseLeave=function(t){this.__prepareEvent(t),this.mouseLeave.emit(t)};e.prototype.onKeyPressed=function(t,e){this.__prepareEvent(e),this.__cameraManipulator&&this.__cameraManipulator.onKeyPressed(t,e)||this.keyPressed.emit(t,e)};e.prototype.onKeyDown=function(t,e){this.__prepareEvent(e),this.__cameraManipulator&&this.__cameraManipulator.onKeyDown(t,e)||this.keyDown.emit(t,e)};e.prototype.onKeyUp=function(t,e){this.__prepareEvent(e),this.__cameraManipulator&&this.__cameraManipulator.onKeyUp(t,e)||this.keyUp.emit(t,e)};e.prototype.onWheel=function(t){this.__prepareEvent(t),(null==t.intersectionData||(t.intersectionData.geomItem.onWheel(t),t.propagating))&&(this.__cameraManipulator?this.__cameraManipulator.onWheel(t):this.mouseWheel.emit(t))};e.prototype.__eventTouchPos=function(t){return new Bn(t.rendererX-this.getPosX(),t.rendererY-this.getPosY())};e.prototype.onTouchStart=function(t){if(this.__prepareEvent(t),1==t.touches.length){var e=t.touches[0],a=this.__eventTouchPos(e);t.touchPos=a,t.touchRay=this.calcRayFromScreenPos(a);var i=this.getGeomDataAtPos(a,t.touchRay);if(null!=i){if(t.intersectionData=i,i.geomItem.onMouseDown(t,i),!t.propagating)return;if(this.capturedItem)return;if(this.mouseDownOnGeom.emit(t),!t.propagating)return}var n=Date.now();if(n-this.__prevDownTime<this.__doubleClickTimeMSParam.getValue()){if(this.__cameraManipulator&&(this.__cameraManipulator.onDoubleTap(t),!t.propagating))return;return void this.doubleTapped.emit(t)}this.__prevDownTime=n}this.__cameraManipulator?this.__cameraManipulator.onTouchStart(t):this.touchStart.emit(t)};e.prototype.onTouchMove=function(t){if(this.__prepareEvent(t),this.capturedItem){t.touchPos=[],t.touchRay=[];for(var e=0;e<t.touches.length;e++){var a=t.touches[e],i=this.__eventTouchPos(a);t.touchPos[e]=i,t.touchRay[e]=this.calcRayFromScreenPos(i)}return t.mousePos=t.touchPos[0],t.mouseRay=t.touchRay[0],void this.capturedItem.onMouseMove(t)}this.__cameraManipulator?this.__cameraManipulator.onTouchMove(t):this.touchMove.emit(t)};e.prototype.onTouchEnd=function(t){this.__prepareEvent(t),this.capturedItem?this.capturedItem.onMouseUp(t):this.__cameraManipulator?this.__cameraManipulator.onTouchEnd(t):this.touchEnd.emit(t)};e.prototype.onTouchCancel=function(t){this.__prepareEvent(t),this.capturedItem?this.capturedItem.onTouchCancel(t):this.__cameraManipulator?this.__cameraManipulator.onTouchCancel(t):this.touchCancel.emit(t)};e.prototype.__initRenderState=function(t){t.viewXfo=this.__cameraXfo,t.viewScale=1,t.region=this.region,t.cameraMatrix=this.__cameraMat,t.viewports=[{region:this.region,viewMatrix:this.__viewMat,projectionMatrix:this.__projectionMatrix,viewportFrustumSize:this.__frustumDim,isOrthographic:this.__camera.getIsOrthographic(),fovY:this.__camera.getFov()}]};e.prototype.draw=function(){var t=this.__renderer.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport.apply(t,this.region),this.__backgroundColor&&t.clearColor.apply(t,this.__backgroundColor.asArray()),t.colorMask(!0,!0,!0,!0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);var e={};this.__initRenderState(e),this.__renderer.drawScene(e)};return e}(js);var $s=function(){function t(t,e){this.__vrviewport=t,this.__treeItem=new Tl("VRHead"),e.addChild(this.__treeItem),this.__mat4=new $n,this.__localXfo=new ar}t.prototype.update=function(t){this.__mat4.setDataArray(t.transform.matrix),this.__localXfo.fromMat4(this.__mat4),this.__treeItem.setLocalXfo(this.__localXfo)};t.prototype.getTreeItem=function(){return this.__treeItem};t.prototype.getXfo=function(){return this.__localXfo};return t}();var td=function(){function t(t,e,a){var i=this;if(this.__vrviewport=t,this.__inputSource=e,this.__id=a,this.__isDaydramController=zn.isMobileDevice,this.touchpadTouched=new dr,this.buttonPressed=new dr,this.buttonReleased=new dr,this.__pressedButtons=[],this.__mat4=new $n,this.__xfo=new ar,this.__treeItem=new Tl("VRController:"+e.handedness+a),!this.__isDaydramController){this.__tip=new Tl("Tip");var n=new ar;n.tr.set(0,-.05,-.13),this.__tip.setLocalXfo(n),this.__treeItem.addChild(this.__tip,!1),t.getTreeItem().addChild(this.__treeItem),this.__activeVolumeSize=.04,t.loadHMDResources().then((function(t){t.loaded.connect((function(){var e;0==a?e=t.getChildByName("LeftController"):1==a&&(e=t.getChildByName("RightController")),e||(e=t.getChildByName("Controller"));var n=e.clone();n.setLocalXfo(new ar(new Dn(0,-.035,-.085),new tr({setFromAxisAndAngle:[new Dn(0,1,0),Math.PI]}),new Dn(.001,.001,.001))),i.__treeItem.addChild(n,!1)}))}))}}t.prototype.getHandedness=function(){return this.__inputSource.handedness};t.prototype.getId=function(){return this.__id};t.prototype.getTreeItem=function(){return this.__treeItem};t.prototype.getTipItem=function(){return this.__tip};t.prototype.getTipXfo=function(){return this.__tip.getGlobalXfo()};t.prototype.getTouchPadValue=function(){return this.__touchpadValue};t.prototype.isButtonPressed=function(){return this.__buttonPressed};t.prototype.getControllerStageLocalXfo=function(){return this.__xfo};t.prototype.getControllerTipStageLocalXfo=function(){return this.__xfo.multiply(this.__tip.getLocalXfo())};t.prototype.updatePose=function(t,e,a){var i=e.getPose(a.gripSpace,t);i&&i.transform&&(this.__mat4.setDataArray(i.transform.matrix),this.__xfo.fromMat4(this.__mat4),this.__treeItem.setLocalXfo(this.__xfo),this.__geomAtTip=void 0,this.__hitTested=!1)};t.prototype.getGeomItemAtTip=function(){if(this.__hitTested)return this.__intersectionData;this.__hitTested=!0;var t=this.__vrviewport.getRenderer(),e=this.__tip.getGlobalXfo(),a=this.__activeVolumeSize;return this.__intersectionData=t.raycastWithXfo(e,a,a),this.__intersectionData};return t}();var ed=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.getParameter("DoubleClickTimeMS").setValue(300),a.__projectionMatriciesUpdated=!1,a.__far=1024,a.__near=.1,a.__stageTreeItem=new Tl("VRStage"),a.__stageTreeItem.setSelectable(!1),a.__stageTreeItem.setVisible(!1),a.__renderer.addTreeItem(a.__stageTreeItem),a.__vrhead=new $s(a.__renderer.gl,a.__stageTreeItem),a.__vrControllersMap={},a.__vrControllers=[];var i=new ar;i.ori.setFromAxisAndAngle(new Dn(1,0,0),.5*Math.PI),a.setXfo(i),a.__leftViewMatrix=new $n,a.__leftProjectionMatrix=new $n,a.__rightViewMatrix=new $n,a.__rightProjectionMatrix=new $n,a.resized=new dr,a.viewChanged=new dr,a.presentingChanged=new dr,a.controllerAdded=new dr,a.controllerButtonDown=new dr,a.controllerButtonUp=new dr,a.controllerDoubleClicked=new dr,a.controllerTouchpadTouched=new dr;return a}e.prototype.getVRDisplay=function(){return this.__vrDisplay};e.prototype.getAsset=function(){return this.__vrAsset};e.prototype.getTreeItem=function(){return this.__stageTreeItem};e.prototype.getVRHead=function(){return this.__vrhead};e.prototype.getXfo=function(){return this.__stageXfo};e.prototype.setXfo=function(t){this.__stageXfo=t,this.__stageTreeItem.setGlobalXfo(t),this.__stageMatrix=t.inverse().toMat4(),this.__stageScale=t.sc.x};e.prototype.getControllers=function(){return this.__vrControllers};e.prototype.canPresent=function(){return this.__canPresent};e.prototype.isPresenting=function(){return this.__session};e.prototype.__startSession=function(){var t=this;var e=function(a,i){t.__session&&(t.__session.requestAnimationFrame(e),t.draw(i))};this.__session.requestAnimationFrame(e)};e.prototype.loadHMDResources=function(){var t=this;var e=localStorage.getItem("hmd");return this.__hmd!=e&&(this.__hmdAssetPromise=void 0),this.__hmdAssetPromise||(this.__hmd=e,this.__hmdAssetPromise=new Promise((function(a,i){t.__renderer.sceneSet.connect((function(n){var r=n.getResourceLoader();var o;switch(e){case"Vive":o="ZeaEngine/Vive.vla";break;case"Oculus":default:o="ZeaEngine/Oculus.vla"}var l=r.resolveFilePathToId(o);l&&!zn.isMobileDevice?(t.__vrAsset=t.__renderer.getScene().loadCommonAssetResource(l),t.__vrAsset.loaded.connect((function(){var e=t.__vrAsset.getMaterialLibrary(),i=e.getMaterialNames();for(var n=0,r=i;n<r.length;n++){var o=r[n];var l=e.getMaterial(o,!1);l&&(l.visibleInGeomDataBuffer=!1,l.setShaderName("SimpleSurfaceShader"))}a(t.__vrAsset)}))):i()}))}))),this.__hmdAssetPromise};e.prototype.startPresenting=function(){var t=this;return new Promise((function(e,a){var i=t.__renderer.gl,n=function(){navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor"]}).then((function(n){var r;t.__renderer.__xrViewportPresenting=!0,zn.isMobileDevice||(r=document.createElement("canvas"),r.style.position="relative",r.style.left="0px",r.style.top="0px",r.style.width="100%",r.style.height="100%",t.__renderer.getDiv().replaceChild(r,t.__renderer.getGLCanvas()),n.addEventListener("end",(function(e){t.__renderer.getDiv().replaceChild(t.__renderer.getGLCanvas(),r)}))),n.addEventListener("end",(function(e){t.__stageTreeItem.setVisible(!1),t.__session=null,t.presentingChanged.emit(!1)}));n.addEventListener("selectstart",(function(e){var a=t.__vrControllersMap[e.inputSource.handedness];if(a){var i=Date.now();console.log("controller:",e.inputSource.handedness," down",i-a.__prevDownTime),i-a.__prevDownTime<t.__doubleClickTimeMSParam.getValue()?t.controllerDoubleClicked.emit({button:1,controller:a,vleStopPropagation:!1,vrviewport:t},t):(a.__prevDownTime=i,t.controllerButtonDown.emit({button:1,controller:a,vleStopPropagation:!1,vrviewport:t},t))}})),n.addEventListener("selectend",(function(e){var a=t.__vrControllersMap[e.inputSource.handedness];a&&(console.log("controller:",e.inputSource.handedness," up"),t.controllerButtonUp.emit({button:1,controller:a,vleStopPropagation:!1,vrviewport:t},t))})),t.__session=n,n.updateRenderState({baseLayer:new XRWebGLLayer(n,i,{compositionDisabled:"inline"==n.mode}),outputContext:r?r.getContext("xrpresent"):null}),n.requestReferenceSpace(zn.isMobileDevice?"local":"local-floor").catch((function(t){return console.log("Falling back to identity reference space"),n.requestReferenceSpace("viewer").then((function(t){return t.getOffsetReferenceSpace(new XRRigidTransform({y:-1.6}))}))})).then((function(a){t.__refSpace=a,t.__stageTreeItem.setVisible(!0),t.presentingChanged.emit(!0),t.__startSession(),e()})).catch((function(t){console.warn(t.message),a("Unable to start XR Session:"+t.message)}))})).catch((function(t){console.warn(t.message)}))};zn.isMobileDevice?n():t.loadHMDResources().then(n)}))};e.prototype.stopPresenting=function(){this.__session&&this.__session.end()};e.prototype.togglePresenting=function(){this.__session?this.stopPresenting():this.startPresenting()};e.prototype.getHMDCanvasSize=function(){return this.__hmdCanvasSize};e.prototype.__createController=function(t,e){console.log("creating controller:",e.handedness);var a=new td(this,e,t);return this.__vrControllersMap[e.handedness]=a,this.__vrControllers[t]=a,this.controllerAdded.emit(a),a};e.prototype.updateControllers=function(t){var e=this.__session.inputSources;for(var a=0;a<e.length;a++){var i=e[a];if(""==i.handedness||"none"==i.handedness)return;this.__vrControllers[a]||this.__createController(a,i),this.__vrControllers[a].updatePose(this.__refSpace,t,i)}};e.prototype.draw=function(t){var e=t.session.renderState.baseLayer,a=t.getViewerPose(this.__refSpace),i=a.views;if(!this.__projectionMatriciesUpdated){this.__projectionMatrices=[],this.__viewMatrices=[],this.__cameraMatrices=[],this.__region=[0,0,0,0];for(var n=0;n<i.length;n++){var r=i[n],o=new $n;o.setDataArray(r.projectionMatrix),this.__projectionMatrices[n]=o,this.__viewMatrices[n]=new $n,this.__cameraMatrices[n]=new $n;var l=e.getViewport(r);this.__region[2]=Math.max(this.__region[2],l.x+l.width),this.__region[3]=Math.max(this.__region[3],l.y+l.height)}this.__renderer.resizeFbos(this.__region[2],this.__region[3]),this.__projectionMatriciesUpdated=!0}var s=this.__renderer.gl;s.bindFramebuffer(s.FRAMEBUFFER,e.framebuffer),this.__backgroundColor&&s.clearColor.apply(s,this.__backgroundColor.asArray()),s.colorMask(!0,!0,!0,!0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var d={boundRendertarget:e.framebuffer,region:this.__region,viewports:[]};for(var c=0;c<i.length;c++){var u=i[c];this.__viewMatrices[c].setDataArray(u.transform.inverse.matrix),this.__viewMatrices[c].multiplyInPlace(this.__stageMatrix);var h=e.getViewport(u);d.viewports.push({viewMatrix:this.__viewMatrices[c],projectionMatrix:this.__projectionMatrices[c],region:[h.x,h.y,h.width,h.height]})}if(this.__vrhead.update(a),this.updateControllers(t),d.viewXfo=this.__vrhead.getTreeItem().getGlobalXfo(),d.viewScale=1/this.__stageScale,d.cameraMatrix=d.viewXfo.toMat4(),d.region=this.__region,this.__renderer.drawScene(d),this.capturedElement){var m={viewport:this};this.capturedElement.onMouseMove(m)}var p={interfaceType:"VR",hmd:this.__hmd,viewXfo:d.viewXfo,controllers:this.__vrControllers,vrviewport:this};this.viewChanged.emit(p,this)};e.prototype.setCapture=function(t){this.capturedElement=t};e.prototype.getCapture=function(){return this.capturedElement};e.prototype.releaseCapture=function(){this.capturedElement=null,this.renderGeomDataFbo()};return e}(js);var ad=void 0,id=!1,nd=!1;var rd={};var od={OPAQUE:1,TRANSPARENT:2,OVERLAY:4};var ld=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.updated=new dr,e.enabled=!0,e.__passIndex=0;var a=e.addParameter(new Or("Enabled",!0));a.valueChanged.connect((function(t){return e.enabled=a.getValue()}));return e}e.prototype.__parameterValueChanged=function(e,a){t.prototype.__parameterValueChanged.call(this,e,a),this.__renderer&&this.__renderer.requestRedraw()};e.prototype.init=function(t,e){if(null==e)throw new Error("Missing constructor argument.");this.__gl=t.gl,this.__renderer=t,this.__passIndex=e};e.prototype.setPassIndex=function(t){this.__passIndex=t};e.prototype.startPresenting=function(){};e.prototype.stopPresenting=function(){};e.prototype.draw=function(t){};e.prototype.drawHighlightedGeoms=function(t){};e.prototype.drawGeomData=function(t){};e.prototype.getGeomItemAndDist=function(t){};return e}(Rr);var sd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("OutlinesShader.vertexShader","\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    v_texCoord = positions.xy+0.5;\n    gl_Position = vec4(positions.xy*2.0, 0.0, 1.0);\n}\n\n"),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("OutlinesShader.fragmentShader","\nprecision highp float;\n\nuniform sampler2D highlightDataTexture;\nuniform vec2 highlightDataTextureSize;\n\nvarying vec2 v_texCoord;\n\n\nbool isFilledPixel(vec4 p) {\n    return p.r > 0.01 || p.g > 0.01 || p.b > 0.01;\n}\nvoid accumOutlinePixel(vec2 fragCoord, inout vec4 res) {\n    vec3 p = texture2D(highlightDataTexture, fragCoord/highlightDataTextureSize).rgb;\n    if(p.r > 0.01 || p.g > 0.01 || p.b > 0.01) {\n        res.r += p.r;\n        res.g += p.g;\n        res.b += p.b;\n        res.a += 1.0;\n    }\n}\nvec4 getOutlinePixelColor(vec2 fragCoord) {\n    vec4 M = texture2D(highlightDataTexture, fragCoord/highlightDataTextureSize);\n    \n    /// To display a fill instead of an outline.\n    // return M;\n\n    if( isFilledPixel(M) ) {\n        // Note: the filled pixel has an alpha value\n        // that determines how much fill is applied\n        // The outline is a solid color. \n        return M;\n    }\n    // Search surrounding pixels for selected geoms.\n    vec4 res;\n    accumOutlinePixel(fragCoord+vec2( 1, 1), res); // NW\n    accumOutlinePixel(fragCoord+vec2(-1, 1), res); // NE\n    accumOutlinePixel(fragCoord+vec2( 1,-1), res); // SW\n    accumOutlinePixel(fragCoord+vec2(-1,-1), res); // SE\n    accumOutlinePixel(fragCoord+vec2( 0, 2), res); // NN\n    accumOutlinePixel(fragCoord+vec2(-2, 0), res); // EE\n    accumOutlinePixel(fragCoord+vec2( 2, 0), res); // WW\n    accumOutlinePixel(fragCoord+vec2( 0,-2), res); // SS\n    accumOutlinePixel(fragCoord+vec2( 1, 2), res); // NNW\n    accumOutlinePixel(fragCoord+vec2(-1, 2), res); // NNE\n    accumOutlinePixel(fragCoord+vec2(-2, 1), res); // EEN\n    accumOutlinePixel(fragCoord+vec2(-2,-1), res); // EES\n    accumOutlinePixel(fragCoord+vec2( 2, 1), res); // WWN\n    accumOutlinePixel(fragCoord+vec2( 2,-1), res); // WWS\n    accumOutlinePixel(fragCoord+vec2( 1,-2), res); // SSW\n    accumOutlinePixel(fragCoord+vec2(-1,-2), res); // SSE\n\n    if(isFilledPixel(res))\n        return vec4(res.rgb / res.a, 1.0);\n    else\n        return vec4(0.0, 0.0, 0.0, 0.0);\n}\n\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n    // fragColor = texture2D(highlightDataTexture, v_texCoord);;\n    //can also use gl_FragCoord.xy\n    mediump vec2 fragCoord = v_texCoord * highlightDataTextureSize; \n    /////////////////\n    // Selection Outlines\n    vec4 outlineColor = getOutlinePixelColor(fragCoord);\n    if(outlineColor.a > 0.0001){\n#ifndef ENABLE_ES3\n        gl_FragColor = outlineColor;\n#else\n        fragColor = outlineColor;\n#endif\n    }\n    else {\n        discard;\n    }\n}\n\n");return a}return e}(Zs);var dd=od.OPAQUE|od.TRANSPARENT|od.OVERLAY;var cd=function(t){__extends(e,t);function e(e,a){if(a===void 0){a={}}var i=this;i=t.call(this,e,a,{antialias:!0,depth:!0})||this,i.__exposure=1,i.__tonemap=!0,i.__gamma=2.2,i.__glEnvMap=void 0,i.__glBackgroundMap=void 0,i.envMapAssigned=new dr(!0),i.__glLightmaps={},i.__displayEnvironment=!0,i.__debugMode=0,i.__debugLightmaps=!1,i._planeDist=0,i.__cutPlaneNormal=new Dn(1,0,0);var n=i.__gl;i.__debugTextures=[void 0],i.addShaderPreprocessorDirective("ENABLE_INLINE_GAMMACORRECTION"),a.disableLightmaps||i.addShaderPreprocessorDirective("ENABLE_LIGHTMAPS"),a.disableTextures||i.addShaderPreprocessorDirective("ENABLE_TEXTURES"),zn.isMobileDevice||a.disableSpecular||i.addShaderPreprocessorDirective("ENABLE_SPECULAR"),i.__outlineShader=new sd(n),i.quad=new ps(n,new Il(1,1)),i.createSelectedGeomsFbo(),i.createRayCastRenderTarget();return i}e.prototype.__bindEnvMap=function(t){if(t instanceof jo)this.__glEnvMap=t.getMetadata("gltexture"),this.__glEnvMap||("FLOAT"===t.type?(this.addShaderPreprocessorDirective("ENABLE_SPECULAR"),this.__glEnvMap=new Os(this,t,this.__preproc)):t.isStreamAtlas()?this.__glEnvMap=new GLImageStream(this.__gl,t):this.__glEnvMap=new ds(this.__gl,t)),this.__glEnvMap.loaded.connect(this.requestRedraw),this.__glEnvMap.updated.connect(this.requestRedraw),this.envMapAssigned.emit(this.__glEnvMap);else{var e=t;if(this.__glBackgroundMap=e.getMetadata("gltexture"),this.__glBackgroundMap||("FLOAT"===e.type?this.__glBackgroundMap=new vs(gl,e):this.__glBackgroundMap=new ds(gl,e)),this.__glBackgroundMap.loaded.connect(this.requestRedraw),this.__glBackgroundMap.updated.connect(this.requestRedraw),!this.__backgroundMapShader){switch(gl.__quadVertexIdsBuffer||gl.setupInstancedQuad(),e.getMapping()){case"octahedral":this.__backgroundMapShader=new Es(gl);break;case"latlong":this.__backgroundMapShader=new Hs(gl);break;case"steriolatlong":this.__backgroundMapShader=new ks(gl);break;case"dualfisheye":this.__backgroundMapShader=new Ds(gl);break;case"uv":default:this.__backgroundMapShader=new Ps(gl)}var a=this.__backgroundMapShader.compileForTarget();this.__backgroundMapShaderBinding=hs(gl,a.attrs,gl.__quadattrbuffers,gl.__quadIndexBuffer)}}};e.prototype.getGLEnvMap=function(){return this.__glEnvMap};e.prototype.getEnvMapTex=function(){return console.warn("Deprecated Function"),this.__glEnvMap};e.prototype.setScene=function(e){var a=this;var i=e.settings.getParameter("EnvMap");null!=i.getValue()&&this.__bindEnvMap(i.getValue()),i.valueChanged.connect((function(){a.__bindEnvMap(i.getValue())}));var n=e.settings.getParameter("Display EnvMap");this.__displayEnvironment=n.getValue(),n.valueChanged.connect((function(){a.__displayEnvironment=n.getValue(),a.requestRedraw()})),t.prototype.setScene.call(this,e)};e.prototype.addTreeItem=function(e){var a=this;if(t.prototype.addTreeItem.call(this,e),e instanceof kl){var i=function(t,e){var i=e.image.getMetadata("gltexture");i||(i=new vs(a.__gl,e.image)),i.updated.connect((function(t){a.requestRedraw()})),a.__glLightmaps[t]={atlasSize:e.atlasSize,glimage:i}},n=e;n.loaded.connect((function(){a.__glEnvMap&&n.getLightmap()&&i(n.getName(),n.getLightmap())}))}};e.prototype.removeTreeItem=function(e){t.prototype.removeTreeItem.call(this,e)};e.prototype.addViewport=function(e){return t.prototype.addViewport.call(this,e)};e.prototype.onKeyPressed=function(e,a){switch(e){case"b":this.__displayEnvironment=!this.__displayEnvironment,this.requestRedraw();break;default:t.prototype.onKeyPressed.call(this,e,a)}};Object.defineProperty(e.prototype,"exposure",{get:function(){return this.__exposure},set:function(t){this.__exposure=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"gamma",{get:function(){return this.__gamma},set:function(t){this.__gamma=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"displayEnvironment",{get:function(){return this.__displayEnvironment},set:function(t){this.__displayEnvironment=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"planeDist",{get:function(){return this._planeDist},set:function(t){this._planeDist=t,this.requestRedraw()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cutPlaneNormal",{get:function(){return this.__cutPlaneNormal},set:function(t){this.__cutPlaneNormal=t,this.requestRedraw()},enumerable:true,configurable:true});e.prototype.resizeFbos=function(e,a){t.prototype.resizeFbos.call(this),this.__fbo&&this.__fbo.colorTexture.resize(e,a),this.__highlightedGeomsBufferFbo&&this.__highlightedGeomsBuffer.resize(e,a)};e.prototype.createSelectedGeomsFbo=function(){var t=this.__gl;this.__highlightedGeomsBuffer=new ds(t,{type:"UNSIGNED_BYTE",format:"RGBA",filter:"NEAREST",width:this.__glcanvas.width<=1?1:this.__glcanvas.width,height:this.__glcanvas.height<=1?1:this.__glcanvas.height}),this.__highlightedGeomsBufferFbo=new Xs(t,this.__highlightedGeomsBuffer,!0),this.__highlightedGeomsBufferFbo.setClearColor([0,0,0,0])};e.prototype.getFbo=function(){return this.__fbo};e.prototype.createOffscreenFbo=function(t){if(t===void 0){t="RGB"}var e=this.__glcanvas.width,a=this.__glcanvas.height,i=this.__gl;this.__fwBuffer=new ds(i,{type:"FLOAT",format:t,filter:"NEAREST",width:e,height:a}),this.__fbo=new Xs(i,this.__fwBuffer,!0),this.__fbo.setClearColor(this.__backgroundColor.asArray())};e.prototype.createRayCastRenderTarget=function(){var t=this.__gl;this.__rayCastRenderTarget=new Ms(t,{type:"FLOAT",format:"RGBA",filter:"NEAREST",width:3,height:3,numColorChannels:1}),this.__rayCastRenderTargetProjMatrix=new $n,this.rayCastDist=0,this.rayCastArea=0};e.prototype.raycastWithRay=function(t,e,a,i){if(a===void 0){a=.01}if(i===void 0){i=dd}var n=new ar;return n.setLookAt(t.start,t.start.add(t.dir)),this.raycast(n,t,e,a,i)};e.prototype.raycastWithXfo=function(t,e,a,i){if(a===void 0){a=.01}if(i===void 0){i=dd}var n=new er(t.tr,t.ori.getZaxis().negate());return this.raycast(t,n,e,a,i)};e.prototype.raycast=function(t,e,a,i,n){if(i===void 0){i=.01}if(n===void 0){n=dd}this.rayCastDist==a&&this.rayCastArea==i||(this.__rayCastRenderTargetProjMatrix.setOrthographicMatrix(-.5*i,.5*i,-.5*i,.5*i,0,a),this.rayCastDist=a,this.rayCastArea=i);var r=this.__gl,o={cameraMatrix:t.toMat4(),viewports:[{region:[0,0,3,3],viewMatrix:t.inverse().toMat4(),projectionMatrix:this.__rayCastRenderTargetProjMatrix,isOrthographic:!0}]};this.__rayCastRenderTarget.bindForWriting(o,!0),r.enable(r.CULL_FACE),r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.depthMask(!0),this.drawSceneGeomData(o,n),r.finish(),this.__rayCastRenderTarget.unbindForWriting(),this.__rayCastRenderTarget.bindForReading();var l=new Float32Array(36);r.readPixels(0,0,3,3,r.RGBA,r.FLOAT,l),this.__rayCastRenderTarget.unbindForReading();var s=[4,3,5,1,7];var d;for(var c=0,u=s;c<u.length;c++){var h=u[c];if(0!=l[4*h+3]){d=l.subarray(4*h,4*h+4);break}}if(!d)return;var m=63&Math.round(d[0]),p=this.getPass(m).getGeomItemAndDist(d);if(p){var f=e.start.add(e.dir.scale(p.dist));return{ray:e,intersectionPos:f,geomItem:p.geomItem,dist:p.dist,geomData:d}}};e.prototype.drawBackground=function(t){if(this.__glBackgroundMap){if(!this.__glBackgroundMap.isLoaded())return;var e=this.__gl;e.depthMask(!1),this.__backgroundMapShader.bind(t);var a=t.unifs;this.__glBackgroundMap.bindToUniform(t,a.backgroundImage),this.__backgroundMapShaderBinding.bind(t),e.drawQuad()}else this.__glEnvMap&&this.__glEnvMap.draw&&this.__glEnvMap.draw(t)};e.prototype.bindGLRenderer=function(e){var a=this;t.prototype.bindGLBaseRenderer.call(this,e),e.envMap=this.__glEnvMap,e.exposure=this.__exposure,e.gamma=this.__gamma,e.lightmaps=this.__glLightmaps,e.boundLightmap=void 0;var i=this.__gl,n=e.bindRendererUnifs;e.bindRendererUnifs=function(t){if(n(t),a.__glEnvMap){var r=t.envMapPyramid;if(r&&a.__glEnvMap.bindProbeToUniform)a.__glEnvMap.bindProbeToUniform(e,r);else{var o=t.envMapTex,l=t.envMapTexType;o&&a.__glEnvMap.bindToUniform(e,o,{textureTypeUnif:l})}}{var s=t.exposure;s&&i.uniform1f(s.location,a.__exposure)}{var d=t.gamma;d&&i.uniform1f(d.location,a.__gamma)}}};e.prototype.drawScene=function(e){if(this.bindGLRenderer(e),this.__displayEnvironment&&this.drawBackground(e),t.prototype.drawScene.call(this,e),this.__highlightedGeomsBufferFbo){var a=this.__gl;this.__highlightedGeomsBufferFbo.bindForWriting(e),this.__highlightedGeomsBufferFbo.clear(),a.disable(a.BLEND),a.enable(a.DEPTH_TEST),a.depthFunc(a.LESS),a.depthMask(!0),this.drawHighlightedGeoms(e),this.__highlightedGeomsBufferFbo.unbindForWriting(e),a.viewport.apply(a,e.region),this.__outlineShader.bind(e),a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);var i=e.unifs;this.__highlightedGeomsBuffer.bindToUniform(e,i.highlightDataTexture),a.uniform2f(i.highlightDataTextureSize.location,e.region[2],e.region[3]),this.quad.bindAndDraw(e),a.disable(a.BLEND)}this.redrawOccured.emit()};return e}(function(){function t(t,e){var a=this;if(e===void 0){e={}}if(zn.gpuDesc){this.__shaders={},this.__passes={},this.__passCallbacks=[],this.addTreeItem=this.addTreeItem.bind(this),this.removeTreeItem=this.removeTreeItem.bind(this),this.__viewports=[],this.__activeViewport=void 0,this.__continuousDrawing=!1,this.__redrawRequested=!1,this.__isMobile=zn.isMobileDevice,this.__drawSuspensionLevel=1,this.__shaderDirectives={},this.__preproc={},this.__xrViewportPresenting=!1,this.renderGeomDataFbos=this.renderGeomDataFbos.bind(this),this.requestRedraw=this.requestRedraw.bind(this),this.resized=new dr,this.keyPressed=new dr,this.sceneSet=new dr(!0),this.vrViewportSetup=new dr(!0),this.sessionClientSetup=new dr(!0),this.viewChanged=new dr,this.redrawOccured=new dr,this.setupWebGL(t,e.webglOptions?e.webglOptions:{}),this.bindEventHandlers();for(var i in rd)for(var n=0,r=rd[i];n<r.length;n++){var o=r[n];this.addPass(new o,i,!1)}this.addViewport("main"),this.__supportXR=void 0===e.supportXR||e.supportXR,this.__xrViewport=void 0,this.__xrViewportPromise=new Promise((function(t,e){if(a.__supportXR&&navigator.xr){var i=function(){a.__gl.makeXRCompatible().then((function(){a.__xrViewport=a.__setupXRViewport(),a.vrViewportSetup.emit(a.__xrViewport),t(a.__xrViewport)}))};navigator.xr.supportsSessionMode?navigator.xr.supportsSessionMode("immersive-vr").then(i).catch((function(t){console.warn("Unable to setup XR:"+t)})):navigator.xr.isSessionSupported("immersive-vr").then((function(t){t&&i()})).catch((function(t){console.warn("Unable to setup XR:"+t)}))}}))}else console.warn("Unable to create renderer")}t.prototype.addShaderPreprocessorDirective=function(t,e){this.__shaderDirectives[t]=e?"#define "+t+" = "+e:"#define "+t;var a=[];for(var i in this.__shaderDirectives)a.push(this.__shaderDirectives[i]);this.__preproc.defines=a.join("\n")+"\n",this.__gl.shaderopts=this.__preproc};t.prototype.getShaderPreproc=function(){return this.__preproc};t.prototype.getWidth=function(){return this.__glcanvas.width};t.prototype.getHeight=function(){return this.__glcanvas.height};t.prototype.addViewport=function(t){var e=this;var a=new qs(this,t,this.getWidth(),this.getHeight());return a.updated.connect((function(){e.requestRedraw()})),a.createGeomDataFbo(this.__floatGeomBuffer),a.viewChanged.connect((function(t){e.__xrViewportPresenting||e.viewChanged.emit(t)})),this.__viewports.push(a),a};t.prototype.getViewport=function(t){if(t===void 0){t=0}return this.__viewports[t]};t.prototype.getViewportAtPos=function(t,e){for(var a=0,i=this.__viewports;a<i.length;a++){var n=i[a];var r=n.getPosX(),o=n.getPosY(),l=n.getWidth(),s=n.getHeight();if(t>=r&&e>=o&&t<=l+r&&e<=s+o)return n}};t.prototype.activateViewport=function(t){this.__activeViewport!=t&&(this.__activeViewport=t)};t.prototype.activateViewportAtPos=function(t,e){if(this.__xrViewportPresenting)return;var a=this.getViewportAtPos(t,e);a&&a!=this.__activeViewport&&this.activateViewport(a)};t.prototype.getActiveViewport=function(){return this.__xrViewportPresenting?this.__xrViewport:this.__activeViewport};t.prototype.suspendDrawing=function(){this.__drawSuspensionLevel++};t.prototype.resumeDrawing=function(){this.__drawSuspensionLevel--,0==this.__drawSuspensionLevel&&(this.__loadingImg&&this.__glcanvasDiv.removeChild(this.__loadingImg),this.renderGeomDataFbos(),this.requestRedraw())};t.prototype.renderGeomDataFbos=function(){var t=this;if(1==this.__renderGeomDataFbosRequested)return;this.__renderGeomDataFbosRequested=!0;window.requestAnimationFrame((function(){for(var e=0,a=t.__viewports;e<a.length;e++){var i=a[e];i.renderGeomDataFbo()}t.__renderGeomDataFbosRequested=!1}))};t.prototype.setupGrid=function(t,e,a,i){return console.warn("Deprecated Method. Please use scene.setupGrid"),this.__scene.setupGrid(t,a,e)};t.prototype.getScene=function(){return this.__scene};t.prototype.setScene=function(t){this.__scene=t,this.addTreeItem(this.__scene.getRoot()),this.__gizmoContext&&this.__gizmoContext.setSelectionManager(t.getSelectionManager()),this.sceneSet.emit(this.__scene)};t.prototype.addTreeItem=function(t){if(t instanceof Tl){for(var e=0,a=this.__passCallbacks;e<a.length;e++){var i=a[e];var n={continueInSubTree:!0};if(i.itemAddedFn(t,n)){if(!n.continueInSubTree)return;break}}for(var r=0,o=t.getChildren();r<o.length;r++){var l=o[r];l&&this.addTreeItem(l)}t.childAdded.connect(this.addTreeItem),t.childRemoved.connect(this.removeTreeItem),this.renderGeomDataFbos()}};t.prototype.removeTreeItem=function(t){if(t instanceof Tl){t.childAdded.disconnect(this.addTreeItem),t.childRemoved.disconnect(this.removeTreeItem);for(var e=0,a=this.__passCallbacks;e<a.length;e++){var i=a[e];if(!i.itemRemovedFn)continue;var n={continueInSubTree:!0};if(i.itemRemovedFn(t,n)){if(!n.continueInSubTree)return;break}}for(var r=0,o=t.getChildren();r<o.length;r++){var l=o[r];l&&this.removeTreeItem(l)}this.renderGeomDataFbos()}};Object.defineProperty(t.prototype,"gl",{get:function(){return this.__gl},enumerable:true,configurable:true});t.prototype.getGL=function(){return this.__gl};t.prototype.resizeFbos=function(t,e){};t.prototype.__onResize=function(){if(!this.__xrViewportPresenting){var t=1;this.__glcanvas.width=this.__glcanvas.clientWidth*t,this.__glcanvas.height=this.__glcanvas.clientHeight*t;for(var e=0,a=this.__viewports;e<a.length;e++){var i=a[e];i.resize(this.__glcanvas.width,this.__glcanvas.height)}this.resizeFbos(this.__glcanvas.width,this.__glcanvas.height),this.resized.emit(this.__glcanvas.width,this.__glcanvas.height),this.requestRedraw()}};t.prototype.getDiv=function(){return this.__glcanvasDiv};t.prototype.setupWebGL=function(t,e){var a=this;this.__glcanvas=document.createElement("canvas"),this.__glcanvas.style.position=e.canvasPosition?e.canvasPosition:"absolute",this.__glcanvas.style.left="0px",this.__glcanvas.style.top="0px",this.__glcanvas.style.width="100%",this.__glcanvas.style.height="100%",this.__glcanvasDiv=t,this.__glcanvasDiv.appendChild(this.__glcanvas),wn(this.__glcanvas,(function(t){a.__onResize()})),this.__onResize(),e.preserveDrawingBuffer=!0,e.stencil=!!e.stencil&&e.stencil,e.alpha=!!e.alpha&&e.alpha,e.xrCompatible=!0,this.__gl=ss(this.__glcanvas,e),this.__gl||alert("Unable to create WebGL context. WebGL not supported."),this.__gl.renderer=this,"webgl2"==this.__gl.name&&this.addShaderPreprocessorDirective("ENABLE_ES3"),this.__gl.floatTexturesSupported&&this.addShaderPreprocessorDirective("ENABLE_FLOAT_TEXTURES"),this.__gl.screenQuad=new As(this.__gl),this.__screenQuad=this.__gl.screenQuad,this.__floatGeomBuffer=this.__gl.floatTexturesSupported&&"Safari"!=zn.browserName,this.__gl.floatGeomBuffer=this.__floatGeomBuffer};t.prototype.bindEventHandlers=function(){var t=this;var e=function(){return t.__glcanvas.width>0&&t.__glcanvas.height},a=function(e){var a=t.__glcanvas.getBoundingClientRect();e.rendererX=1*(e.clientX-a.left),e.rendererY=1*(e.clientY-a.top)};this.__glcanvas.addEventListener("mouseenter",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager,id||(ad=t,a(e),ad.activateViewportAtPos(e.rendererX,e.rendererY),nd=!1)})),this.__glcanvas.addEventListener("mouseleave",(function(a){if(ad==t&&e())if(a.stopPropagation(),a.undoRedoManager=t.undoRedoManager,id)nd=!0;else{var i=ad.getActiveViewport();i&&(i.onMouseLeave(a),a.preventDefault()),ad=void 0}})),this.__glcanvas.addEventListener("mousedown",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager,a(e),id=!0,ad=t,ad.activateViewportAtPos(e.rendererX,e.rendererY);var i=ad.getActiveViewport();return i&&i.onMouseDown(e),nd=!1,!1})),document.addEventListener("mouseup",(function(i){if(ad!=t||!e())return;i.stopPropagation(),i.undoRedoManager=t.undoRedoManager,a(i),id=!1;var n=ad.getActiveViewport();if(n&&n.onMouseUp(i),nd){var r=ad.getActiveViewport();r&&(r.onMouseLeave(i),i.preventDefault()),ad=void 0}return!1})),document.addEventListener("mousemove",(function(i){if(ad!=t||!e())return;i.preventDefault(),i.stopPropagation(),i.undoRedoManager=t.undoRedoManager,a(i),id||ad.activateViewportAtPos(i.rendererX,i.rendererY);var n=ad.getActiveViewport();return n&&n.onMouseMove(i),!1}));var i=function(a){if(ad==t&&e())return ad&&(a.stopPropagation(),a.undoRedoManager=t.undoRedoManager,window.addEventListener||a.preventDefault(),t.onWheel(a)),!1};window.addEventListener?window.addEventListener("wheel",i,{passive:!0}):window.onmousewheel=document.onmousewheel=i,window.oncontextmenu=function(){return!1},document.addEventListener("keypress",(function(a){if(ad!=t||!e())return;var i=String.fromCharCode(a.keyCode).toLowerCase(),n=ad.getActiveViewport();n&&n.onKeyPressed(i,a)})),document.addEventListener("keydown",(function(a){if(ad!=t||!e())return;var i=String.fromCharCode(a.keyCode).toLowerCase(),n=ad.getActiveViewport();n&&n.onKeyDown(i,a)})),document.addEventListener("keyup",(function(a){if(ad!=t||!e())return;var i=String.fromCharCode(a.keyCode).toLowerCase(),n=ad.getActiveViewport();n&&n.onKeyUp(i,a)})),this.__glcanvas.addEventListener("touchstart",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager;for(var i=0;i<e.touches.length;i++)a(e.touches[i]);t.getViewport().onTouchStart(e)}),!1),this.__glcanvas.addEventListener("touchmove",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager;for(var i=0;i<e.touches.length;i++)a(e.touches[i]);t.getViewport().onTouchMove(e)}),!1),this.__glcanvas.addEventListener("touchend",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager;for(var i=0;i<e.touches.length;i++)a(e.touches[i]);t.getViewport().onTouchEnd(e)}),!1),this.__glcanvas.addEventListener("touchcancel",(function(e){e.stopPropagation(),e.undoRedoManager=t.undoRedoManager,t.getViewport().onTouchCancel(e)}),!1)};t.prototype.setUndoRedoManager=function(t){this.undoRedoManager=t};t.prototype.getGLCanvas=function(){return this.__glcanvas};t.prototype.getScreenQuad=function(){return this.__screenQuad};t.prototype.onWheel=function(t){this.__viewports[0].onWheel(t)};t.prototype.frameAll=function(t){if(t===void 0){t=0}this.__viewports[t].frameView([this.__scene.getRoot()])};t.prototype.getOrCreateShader=function(t){var e=this.__shaders[t];return e||(e=br.constructClass(t,this.__gl),e||console.error("Shader not registered with the SGFactory:",t),this.__shaders[t]=e),e};t.prototype.addPass=function(t,e,a){if(e===void 0){e=0}if(a===void 0){a=!0}this.__passes[e]||(this.__passes[e]=[]);var i=0;for(var n in this.__passes){if(n==e)break;i+=this.__passes[n].length}if(i+=this.__passes[e].length,t.updated.connect(this.requestRedraw.bind(this)),t.init(this,i),this.__passes[e].push(t),a){var r=0;for(var o in this.__passes){var l=this.__passes[o];l.forEach((function(t,e){t.setPassIndex(r+e)})),r+=l.length}}return this.requestRedraw(),i};t.prototype.registerPass=function(t,e){this.__passCallbacks.splice(0,0,{itemAddedFn:t,itemRemovedFn:e})};t.prototype.getPass=function(t){var e=0;for(var a in this.__passes){var i=this.__passes[a];if(t-e<i.length)return i[t-e];e+=i.length}};t.prototype.findPass=function(t){for(var e in this.__passes){var a=this.__passes[e];for(var i=0,n=a;i<n.length;i++){var r=n[i];if(r.constructor==t)return r}}};t.prototype.getGizmoPass=function(){return this.__gizmoPass};t.prototype.supportsVR=function(){return console.warn("Deprecated Method. Please instead connect to the vrViewportSetup signal."),this.__supportXR&&null!=navigator.xr};t.prototype.__setupXRViewport=function(){var t=this;var e=new ed(this);return e.presentingChanged.connect((function(a){if(t.__xrViewportPresenting=a,a){for(var i in t.__passes){var n=t.__passes[i];for(var r=0,o=n;r<o.length;r++){var l=o[r];l.startPresenting()}}e.viewChanged.connect(t.viewChanged.emit)}else{e.viewChanged.disconnect(t.viewChanged.emit);for(var s in t.__passes){var d=t.__passes[s];for(var c=0,u=d;c<u.length;c++){var h=u[c];h.stopPresenting()}}t.viewChanged.emit({interfaceType:"CameraAndPointer",viewXfo:t.getViewport().getCamera().getGlobalXfo()}),t.resizeFbos(t.__glcanvas.width,t.__glcanvas.height),t.requestRedraw()}})),e};t.prototype.getVRViewport=function(){return this.__xrViewport};t.prototype.getXRViewport=function(){return this.__xrViewportPromise};t.prototype.isXRViewportPresenting=function(){return this.__xrViewportPresenting};t.prototype.isContinuouslyDrawing=function(){return this.__continuousDrawing};t.prototype.startContinuousDrawing=function(){var t=this;if(this.isContinuouslyDrawing()||this.__xrViewportPresenting)return;var e=function(){t.__continuousDrawing&&!t.__xrViewportPresenting&&window.requestAnimationFrame(e);for(var a=0,i=t.__viewports;a<i.length;a++){var n=i[a];n.draw()}};this.__continuousDrawing=!0,window.requestAnimationFrame(e)};t.prototype.stopContinuousDrawing=function(){this.__continuousDrawing=!1};t.prototype.toggleContinuousDrawing=function(){this.__continuousDrawing?this.stopContinuousDrawing():this.startContinuousDrawing()};t.prototype.drawItemChanged=function(){for(var t=0,e=this.__viewports;t<e.length;t++){var a=e[t];a.invalidateGeomDataBuffer()}this.requestRedraw()};t.prototype.requestRedraw=function(){var t=this;if(this.__redrawRequested||this.__continuousDrawing||this.__xrViewportPresenting)return!1;return window.requestAnimationFrame((function(){t.__redrawRequested=!1;for(var e=0,a=t.__viewports;e<a.length;e++){var i=a[e];i.draw()}})),this.__redrawRequested=!0,!0};t.prototype.bindGLBaseRenderer=function(t){t.shaderopts=this.__preproc;var e=this.__gl;t.viewports&&1!=t.viewports.length?(t.bindRendererUnifs=function(a){var i=a.cameraMatrix;i&&e.uniformMatrix4fv(i.location,!1,t.cameraMatrix.asArray())},t.bindViewports=function(a,i){t.viewports.forEach((function(t,n){e.viewport.apply(e,t.region);var r=a.viewMatrix,o=a.projectionMatrix,l=a.eye;r&&e.uniformMatrix4fv(r.location,!1,t.viewMatrix.asArray()),o&&e.uniformMatrix4fv(o.location,!1,t.projectionMatrix.asArray()),l&&e.uniform1i(l.location,n),i()}))}):(t.bindRendererUnifs=function(a){var i=a.cameraMatrix,n=a.viewMatrix,r=a.projectionMatrix,o=a.eye;i&&e.uniformMatrix4fv(i.location,!1,t.cameraMatrix.asArray());var l=t.viewports[0];n&&e.uniformMatrix4fv(n.location,!1,l.viewMatrix.asArray()),r&&e.uniformMatrix4fv(r.location,!1,l.projectionMatrix.asArray()),o&&e.uniform1i(o.location,index)},t.bindViewports=function(t,e){return e()})};t.prototype.drawScene=function(t){for(var e in this.__passes){var a=this.__passes[e];for(var i=0,n=a;i<n.length;i++){var r=n[i];r.enabled&&r.draw(t)}}};t.prototype.drawHighlightedGeoms=function(t){this.bindGLBaseRenderer(t);for(var e in this.__passes){var a=this.__passes[e];for(var i=0,n=a;i<n.length;i++){var r=n[i];r.enabled&&r.drawHighlightedGeoms(t)}}};t.prototype.drawSceneGeomData=function(t,e){if(e===void 0){e=255}this.bindGLBaseRenderer(t);for(var a in this.__passes){if(0==(Number.parseInt(a)&e))continue;var i=this.__passes[a];for(var n=0,r=i;n<r.length;n++){var o=r[n];o.enabled&&o.drawGeomData(t)}}};t.registerPass=function(t,e){rd[e]||(rd[e]=[]),rd[e].push(t)};return t}());gs.setShaderModule("drawItemId.glsl","\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nattribute float instancedIds;    // instanced attribute..\nuniform int instancedDraw;\nuniform int transformIndex;\n\nint getDrawItemId() {\n    if(instancedDraw == 0){\n       return transformIndex;\n    }\n    else{\n       return int(instancedIds);\n    }\n}\n\n\n#else\n\nuniform int transformIndex;\n\nint getDrawItemId() {\n    return transformIndex;\n}\n\n#endif\n\n"),gs.setShaderModule("drawItemTexture.glsl",'\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nuniform sampler2D instancesTexture;\nuniform highp int instancesTextureSize;\n\n<%include file="GLSLUtils.glsl"/>\n\nconst int pixelsPerItem = 6;\n\nvec4 getInstanceData(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 0);\n}\n\n#else\n\nuniform vec4 drawItemData;\n\nvec4 getInstanceData(int id) {\n    return drawItemData;\n}\n\n#endif\n\n\n'),gs.setShaderModule("modelMatrix.glsl","\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n    // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\n    vec4 col0 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 1);\n    vec4 col1 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 2);\n    vec4 col2 = fetchTexel(texture, textureSize, (index * pixelsPerItem) + 3);\n    mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\n    return transpose(result);\n    // return mat4(1.0);\n}\n\nmat4 getModelMatrix(int id) {\n    return getMatrix(instancesTexture, instancesTextureSize, id);\n}\n\n#else\n\nuniform mat4 modelMatrix;\n\nmat4 getModelMatrix(int id) {\n    return modelMatrix;\n}\n\n#endif\n\n\n"),gs.setShaderModule("materialparams.glsl","\n\n////////////////////////\n// Material Param Helpers.\n\nvec4 getColorParamValue(vec4 value, sampler2D tex, int texType, vec2 texCoord) {\n    if(texType == 0){\n        return toLinear(value);\n    }\n    else if(texType == 1 || texType == 2){\n        // TODO: Use SRGB textures.\n        return toLinear(texture2D(tex, texCoord));\n    }\n    else if(texType == 3){\n        // Float HDR Texture\n        return texture2D(tex, texCoord);\n    }\n    else\n        return value;\n}\n\n\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\nfloat getLuminanceParamValue(float value, sampler2D tex, int texType, vec2 texCoord) {\n    if(texType == 0)\n        return value;\n    else\n        return luminanceFromRGB(texture2D(tex, texCoord).rgb);\n}\n"),gs.setShaderModule("debugColors.glsl","\n\nfloat modI(float a, float b) {\n    float m=a-floor((a+0.5)/b)*b;\n    return floor(m+0.5);\n}\n\nvec3 getDebugColor(float id) {\n#ifdef GLSL_ES3\n    const vec3 clusterColors[4] = vec3[4]( vec3(0.0, 0.25, 0.25), vec3(0.0, 0.85, 0.25), vec3(0.0, 0.25, 0.85), vec3(0.0, 0.85, 0.85) );\n#else\n    vec3 clusterColors[8];\n    clusterColors[0] = vec3(0.0, 0.15, 0.15);\n    clusterColors[1] = vec3(0.0, 0.85, 0.15);\n    clusterColors[2] = vec3(0.0, 0.15, 0.85);\n    clusterColors[3] = vec3(0.0, 0.85, 0.85);\n    clusterColors[4] = vec3(0.75, 0.15, 0.15);\n    clusterColors[5] = vec3(0.75, 0.85, 0.15);\n    clusterColors[6] = vec3(0.75, 0.15, 0.85);\n    clusterColors[7] = vec3(0.75, 0.85, 0.85);\n#endif\n\n    if(modI(id, 8.0) == 0.0)\n        return clusterColors[0];\n    else if(modI(id, 8.0) == 1.0)\n        return clusterColors[1];\n    else if(modI(id, 8.0) == 2.0)\n        return clusterColors[2];\n    else if(modI(id, 8.0) == 3.0)\n        return clusterColors[3];\n    else if(modI(id, 8.0) == 4.0)\n        return clusterColors[4];\n    else if(modI(id, 8.0) == 5.0)\n        return clusterColors[5];\n    else if(modI(id, 8.0) == 6.0)\n        return clusterColors[6];\n    else if(modI(id, 8.0) == 7.0)\n        return clusterColors[7];\n\n    return vec3(1,0,0);\n}\n\n\n");var ud=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("BillboardShader.vertexShader",'\nprecision highp float;\n\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 cameraMatrix;\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\ninstancedattribute float instanceIds;\n\n<%include file="GLSLUtils.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="utils/imageAtlas.glsl"/>\n\nuniform sampler2D atlasBillboards_layout;\nuniform vec4 atlasBillboards_desc;\n\nuniform sampler2D instancesTexture;\nuniform int instancesTextureSize;\n\n\nconst int cols_per_instance = 5;\n\nmat4 getMatrix(sampler2D texture, int textureSize, int index) {\n  // Unpack 3 x 4 matix columns into a 4 x 4 matrix.\n  vec4 col0 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 0);\n  vec4 col1 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 1);\n  vec4 col2 = fetchTexel(texture, textureSize, (index * cols_per_instance) + 2);\n  mat4 result = mat4(col0, col1, col2, vec4(0.0, 0.0, 0.0, 1.0));\n  return transpose(result);\n  // return mat4(1.0);\n}\n\nmat4 getModelMatrix(int id) {\n  return getMatrix(instancesTexture, instancesTextureSize, id);\n}\nvec4 getInstanceData(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 3);\n}\nvec4 getTintColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * cols_per_instance) + 4);\n}\n\n\n#else\n\nuniform vec4 atlasBillboards_desc;\n\nuniform mat4 modelMatrix;\nuniform vec4 billboardData;\nuniform vec4 tintColor;\nuniform vec4 layoutData;\n\n\n#endif\n\nmat4 calcLookAtMatrix(vec3 origin, vec3 target, float roll) {\n  // vec3 rr = vec3(sin(roll), 0.0, cos(roll));\n  vec3 rr = vec3(0.0, 0.0, 1.0);\n  vec3 ww = normalize(target - origin);\n  vec3 uu = normalize(cross(rr, ww));\n  vec3 vv = normalize(cross(ww, uu));\n\n  return mat4(vec4(uu, 0.0), vec4(vv, 0.0), vec4(ww, 0.0), vec4(origin, 1.0));\n}\n\nfloat map(float value, float inMin, float inMax, float outMin, float outMax) {\n  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);\n}\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\n\nvoid main(void) {\n\n#ifdef ENABLE_FLOAT_TEXTURES\n\n  int instanceID = int(instanceIds);\n\n  mat4 modelMatrix = getModelMatrix(instanceID);\n  vec4 billboardData = getInstanceData(instanceID);\n  vec4 layoutData = fetchTexel(atlasBillboards_layout, int(atlasBillboards_desc.z), int(billboardData.z));\n  v_tint = getTintColor(instanceID);\n\n#else\n\n  v_tint = tintColor;\n\n#endif\n\n  vec2 quadVertex = getQuadVertexPositionFromID();\n\n\n  v_texCoord = vec2(quadVertex.x, -quadVertex.y) + 0.5;\n  v_alpha = billboardData.w;\n  v_texCoord *= layoutData.zw;\n  v_texCoord += layoutData.xy;\n\n  float scl = billboardData.x;\n  float width = layoutData.z * atlasBillboards_desc.x * scl;\n  float height = layoutData.w * atlasBillboards_desc.y * scl;\n  int flags = int(billboardData.y);\n  bool alignedToCamera = flags > 0;\n  if(alignedToCamera){\n    vec3 cameraPos = vec3(cameraMatrix[3][0], cameraMatrix[3][1], cameraMatrix[3][2]);\n    vec3 billboardPos = vec3(modelMatrix[3][0], modelMatrix[3][1], modelMatrix[3][2]);\n    mat4 lookAt = calcLookAtMatrix(billboardPos, cameraPos, 0.0);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * lookAt;\n    gl_Position = modelViewProjectionMatrix * vec4(quadVertex.x * width, (quadVertex.y + 0.5) * height, 0.0, 1.0);\n  }\n  else{\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(quadVertex.x * width, (quadVertex.y + 0.5) * height, 0.0, 1.0);\n  }\n\n  bool overlay = flags > 0;\n  if(overlay){\n    gl_Position.z -= 0.05;\n  }\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("BillboardShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="materialparams.glsl"/>\n<%include file="utils/imageAtlas.glsl"/>\n\nuniform sampler2D atlasBillboards;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying float v_alpha;\nvarying vec4 v_tint;\n\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = texture2D(atlasBillboards, v_texCoord) * v_tint;\n  fragColor.a *= v_alpha;\n\n  // fragColor.r = 1.0;\n  // fragColor.a = 1.0;\n  \n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}return e}(Zs);var hd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("DepthMapShader.vertexShader","\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 modelMatrix;\nuniform mat4 lightViewMatrix;\nuniform mat4 lightProjectionMatrix;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n\nvoid main(void) {\n  mat4 modelViewMatrix = lightViewMatrix * modelMatrix;\n  v_viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = lightProjectionMatrix * v_viewPos;\n}\n\n"),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("DepthMapShader.fragmentShader","\n#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\nuniform float near;\nuniform float far;\n\nvarying vec3 v_viewPos;\n\nfloat linstep(float edge0, float edge1, float value){\n  return clamp((value-edge0)/(edge1-edge0), 0.0, 1.0);\n}\n\nvoid main(void) {\n  float depth = linstep(near, far, -v_viewPos.z);\n  //gl_FragColor = vec4(depth, depth, depth,  1.0);\n\n  float dx = dFdx(depth);\n  float dy = dFdy(depth);\n  gl_FragColor = vec4(depth, pow(depth, 2.0) + 0.25*(dx*dx + dy*dy), 0.0, 1.0);\n}\n");return a}return e}(Zs);var md=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("EnvProjectionShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 projectionCenter;\n\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n \nvoid main()\n{\n  int drawItemId = getDrawItemId();\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n\n  gl_Position = modelViewProjectionMatrix * pos;\n\n  vec4 worldPos = modelMatrix * pos;\n  v_worldDir = worldPos.xyz - projectionCenter;\n}\n\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"projectionCenter",defaultValue:new Dn(0,0,1.7)}),e};return e}(Zs);var pd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("OctahedralEnvProjectionShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = dirToSphOctUv(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(md);br.registerClass("OctahedralEnvProjectionShader",pd);var fd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("LatLongEnvProjectionShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-equirect.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\nuniform float exposure;\n\n/* VS Outputs */\nvarying vec3 v_worldDir;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  vec2 texCoord = latLongUVsFromDir(normalize(v_worldDir));\n  vec4 env = getColorParamValue(envMap, envMapTex, envMapTexType, texCoord);\n  fragColor = vec4(env.rgb/env.a, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n  fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}return e}(md);br.registerClass("LatLongEnvProjectionShader",fd);var bd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("FatLinesShader.vertexShader",'\nprecision highp float;\n\ninstancedattribute vec2 segmentIndices;\nattribute float vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nuniform sampler2D positionsTexture;\nuniform int positionsTextureSize;\n\nuniform float LineThickness;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  int vertexID = int(vertexIDs);\n\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  int seqentialIndex_0 = int(mod(segmentIndices.x, 2.));\n  int seqentialIndex_1 = int(mod(segmentIndices.y, 2.));\n  int index_0 = int(segmentIndices.x) / 2;\n  int index_1 = int(segmentIndices.y) / 2;\n\n  vec3 viewPos;\n  vec4 data_0 = fetchTexel(positionsTexture, positionsTextureSize, index_0);\n  vec4 data_1 = fetchTexel(positionsTexture, positionsTextureSize, index_1);\n\n  vec4 pos_0 = modelViewMatrix * vec4(data_0.xyz, 1.0);\n  vec4 pos_1 = modelViewMatrix * vec4(data_1.xyz, 1.0);\n  // Note: multiply the per-vertex line thickness with the line thickness uniform value;\n  float lineThickness_0 = LineThickness * data_0.w;\n  float lineThickness_1 = LineThickness * data_1.w;\n\n  if(vertexID < 2){\n    viewPos = pos_0.xyz;\n  }\n  else{\n    viewPos = pos_1.xyz;\n  }\n  if(pos_1 != pos_0){\n    vec3 segmentDir = normalize(pos_1.xyz - pos_0.xyz);\n    vec3 viewVector = normalize(viewPos);\n\n    if(vertexID < 2){\n      vec3 segmentStartDir = segmentDir;\n      if(seqentialIndex_0 != 0){\n        //if index_0 == 0, get the last index in the line as previous\n        int index_prev = (index_0 > 0) ? (index_0-1) : (positionsTextureSize-1);\n        vec4 data_prev = fetchTexel(positionsTexture, positionsTextureSize, index_prev);\n        vec4 pos_prev = modelViewMatrix * vec4(data_prev.xyz, 1.0);\n        segmentStartDir = normalize(segmentDir + normalize(pos_0.xyz - pos_prev.xyz));\n      }\n      vec3 startBiTangent = normalize(cross(segmentStartDir, viewVector));\n      v_viewNormal = normalize(cross(segmentStartDir, startBiTangent));\n      // Move the endpoints to overlap a bit more.\n      //viewPos -= vec3(segmentStartDir * lineThickness_0 * 0.25);\n      if(mod(vertexIDs, 2.0) == 0.0){\n        viewPos += vec3(startBiTangent * lineThickness_0);\n        v_texCoord.x = 1.0;\n      }\n      else{\n        viewPos -= vec3(startBiTangent * lineThickness_0);\n        v_texCoord.x = 0.0;\n      }\n      v_texCoord.y = 0.0;\n    }\n    else{\n      vec3 segmentEndDir = segmentDir;\n      if(seqentialIndex_1 != 0){\n        //if index_1 == numPoints-1, get the first index in the line as next\n        int index_next = (index_1 < (positionsTextureSize-1)) ? (index_1+1) : 0;\n        vec4 data_next = fetchTexel(positionsTexture, positionsTextureSize, index_next);\n        vec4 pos_next = modelViewMatrix * vec4(data_next.xyz, 1.0);\n        segmentEndDir = normalize(segmentDir + normalize(pos_next.xyz - pos_1.xyz));\n      }\n      vec3 endBiTangent = normalize(cross(segmentEndDir, viewVector));\n      v_viewNormal = normalize(cross(segmentEndDir, endBiTangent));\n      // Move the endpoints to overlap a bit more.\n      //viewPos += vec3(segmentEndDir * lineThickness_1 * 0.25);\n      if(mod(vertexIDs, 2.0) == 0.0){\n        viewPos += vec3(endBiTangent * lineThickness_1);\n        v_texCoord.x = 1.0;\n      }\n      else{\n        viewPos -= vec3(endBiTangent * lineThickness_1);\n        v_texCoord.x = 0.0;\n      }\n      v_texCoord.y = 1.0;\n    }\n\n    // Move the line towards the viewer by the line thickness.\n    // this is to avoid depth issues when lines are rendered over meshes. \n    viewPos.z -= (lineThickness_0 + lineThickness_1) * 0.25;\n  }\n\n  v_viewPos       = viewPos;\n  gl_Position     = projectionMatrix * vec4(viewPos, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("FatLinesShader.fragmentShader","\nprecision highp float;\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\nvarying vec2 v_texCoord;\n\nuniform color BaseColor;\nuniform mat4 cameraMatrix;\n\n#ifdef ENABLE_ES3\n  out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  int debugLevel = 0;\n  if(debugLevel == 0){\n\n    vec3 viewVector = mat3(cameraMatrix) * normalize(-v_viewPos);\n    vec3 normal = mat3(cameraMatrix) * v_viewNormal;\n    float NdotV = dot(normalize(normal), normalize(viewVector));\n\n    // Modulate the lighting using the texture coord so the line looks round.\n    NdotV *= cos((v_texCoord.x - 0.5) * 2.0);\n\n    vec4 color = BaseColor * NdotV;\n    fragColor = vec4(color.rgb, BaseColor.a);\n  }\n  else{\n    fragColor = vec4(v_texCoord.x, 0.0, 0.0, 1.0);\n  }\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n"),a.finalize();return a}e.prototype.bind=function(e){return!!t.prototype.bind.call(this,e)&&(e.supportsInstancing=!1,!0)};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e.push({name:"Opacity",defaultValue:1}),e};return e}(Zs);br.registerClass("FatLinesShader",bd),gs.setShaderModule("stack-gl/gamma.glsl","\n\nconst float gamma_const = 2.2;\n\nfloat toLinear(float v) {\n  return pow(v, gamma_const);\n}\n\nvec2 toLinear(vec2 v) {\n  return pow(v, vec2(gamma_const));\n}\n\nvec3 toLinear(vec3 v) {\n  return pow(v, vec3(gamma_const));\n}\n\nvec4 toLinear(vec4 v) {\n  return vec4(toLinear(v.rgb), v.a);\n}\n\n\nfloat toGamma(float v) {\n  return pow(v, 1.0 / gamma_const);\n}\n\nvec2 toGamma(vec2 v) {\n  return pow(v, vec2(1.0 / gamma_const));\n}\n\nvec3 toGamma(vec3 v) {\n  return pow(v, vec3(1.0 / gamma_const));\n}\n\nvec4 toGamma(vec4 v) {\n  return vec4(toGamma(v.rgb), v.a);\n}\n\nfloat toGamma(float v, float gamma) {\n  return pow(v, 1.0 / gamma);\n}\n\nvec2 toGamma(vec2 v, float gamma) {\n  return pow(v, vec2(1.0 / gamma));\n}\n\nvec3 toGamma(vec3 v, float gamma) {\n  return pow(v, vec3(1.0 / gamma));\n}\n\nvec4 toGamma(vec4 v, float gamma) {\n  return vec4(toGamma(v.rgb, gamma), v.a);\n}\n\n\n");var yd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("FlatSurfaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n    vec4 viewPos = (modelViewMatrix * vec4(positions, 1.0));\n    gl_Position = projectionMatrix * viewPos;\n\n    v_viewPos = viewPos.xyz;\n    v_textureCoord = texCoords;\n    v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("FlatSurfaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Zs);br.registerClass("FlatSurfaceShader",yd);var gd=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(yd);br.registerClass("FlatAlphaSurfaceShader",gd),gs.setShaderModule("math/constants.glsl","\n\n#define PI 3.141592653589793\n#define TwoPI (2.0 * PI)\n#define HalfPI (0.5 * PI)\n\n"),gs.setShaderModule("GGX_Specular.glsl",'\n\n\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n<%include file="utils/imagePyramid.glsl"/>\n\n// uniform ImageAtlas envMap;\n// see: GLImageAtlas.js: line 460.\nuniform sampler2D   envMapPyramid;\nuniform sampler2D   envMapPyramid_layout;\nuniform vec4        envMapPyramid_desc;\n\n\nvec3 sampleEnvMap(vec3 dir, float roughness) {\n    return sampleImagePyramid(dirToSphOctUv(dir), roughness, envMapPyramid_layout, envMapPyramid, envMapPyramid_desc).rgb;\n}\n\n\n// Borrowed heavily from here: http://www.codinglabs.net/article_physically_based_rendering_cook_torrance.aspx\n\nvec3 Fresnel_Schlick(float cosT, vec3 F0)\n{\n    return F0 + (vec3(1.0)-F0) * vec3(pow( 1.0 - cosT, 5.0));\n\n    // for now we calculate this in the suface shader\n    // float schlick = reflectance + pow((1.0-reflectance)*(1.0-dot(N,V)), 5.0);\n}\n\nfloat chiGGX(float v)\n{\n    return v > 0.0 ? 1.0 : 0.0;\n}\n\nfloat saturate(float v)\n{\n    return clamp(v, 0.0, 1.0);\n}\n\nvec3 saturate(vec3 v)\n{\n    return clamp(v, vec3(0.0), vec3(1.0));\n}\n\nfloat saturatedDot( in vec3 a, in vec3 b )\n{\n    return max( dot( a, b ), 0.0 );   \n}\n\nfloat GGX_PartialGeometryTerm(vec3 v, vec3 n, vec3 h, float alpha)\n{\n    float VoH2 = saturate(dot(v,h));\n    float chi = chiGGX( VoH2 / saturate(dot(v,n)) );\n    VoH2 = VoH2 * VoH2;\n    float tan2 = ( 1.0 - VoH2 ) / VoH2;\n    return (chi * 2.0) / ( 1.0 + sqrt( 1.0 + alpha * alpha * tan2 ) );\n}\n\nvec3 GGX_Specular_PrefilteredEnv(vec3 normal, vec3 viewVector, float roughness, float fresnel)\n{\n    vec3 reflectionVector = reflect(-viewVector, normal);\n    vec3 radiance = vec3(0.0);\n    float NoV = saturate(dot(normal, viewVector));\n\n    vec3 sampleVector = reflectionVector;\n\n    // Calculate the half vector\n    vec3 halfVector = normalize(sampleVector + viewVector);\n    float cosT = saturatedDot(reflectionVector, normal);\n    float sinT = sqrt( 1.0 - cosT * cosT);\n\n    // Calculate fresnel\n    // vec3 fresnel = Fresnel_Schlick( saturate(dot( halfVector, viewVector ) ), F0 );\n    // Geometry term\n    float geometry = GGX_PartialGeometryTerm(viewVector, normal, halfVector, clamp(roughness, 0.01, 1.0)) * GGX_PartialGeometryTerm(reflectionVector, normal, halfVector, clamp(roughness, 0.01, 1.0));\n\n    // Calculate the Cook-Torrance denominator\n    float denominator = clamp( 4.0 * (NoV * saturate(dot(halfVector, normal)) + 0.05), 0.0, 1.0 );\n    // kS += fresnel;\n\n    // Accumulate the radiance\n    vec3 envColor = sampleEnvMap(reflectionVector, roughness);\n    radiance += envColor * geometry * fresnel * sinT / denominator;\n    //radiance += envColor * fresnel; // Removing "geometry" for now until we construct a better geometric shading term\n\n    return radiance;        \n}\n'),gs.setShaderModule("PBRSurfaceRadiance.glsl","\n\nstruct MaterialParams {\n    vec3 baseColor;\n    float metallic;\n    float roughness;\n    float reflectance;\n};\n\nvec4 pbrSpecularReflectance(in MaterialParams materialParams, vec3 normal, in vec3 viewVector) {\n\n    float NdotV = dot(normal, viewVector);\n    \n    // -------------------------- Specular Reflectance --------------------------\n    // vec3 ks = vec3(0.0);\n    // vec3 specular = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, F0, ks );\n    // vec3 kd = (vec3(1.0) - ks) * vec3(1.0 - metallic);    \n\n    float schlickFresnel = materialParams.reflectance + pow((1.0-materialParams.reflectance)*(1.0-NdotV), 5.0);\n\n    vec3 specularReflectance = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, schlickFresnel);\n\n\n    // -------------------------- Specular Occlusion --------------------------\n    // Fast and quick way of reducing specular reflection in areas that are less exposed to the environment\n    // A better approch is to try screen space specular occlusion but need to check performance and feasibility in webGL\n    //float specularOcclusion = clamp(length(irradiance), 0.01, 1.0);    \n    //specularReflectance = (specularReflectance * specularOcclusion); \n\n    return vec4(specularReflectance, schlickFresnel);\n}\n\n\nvec3 pbrSurfaceRadiance(in MaterialParams materialParams, vec3 irradiance, vec3 normal, in vec3 viewVector) {\n\n    float NdotV = dot(normal, viewVector);\n    vec3 specularReflectance;\n\n    // -------------------------- Diffuse Reflectance --------------------------\n\n    vec3 diffuseReflectance = materialParams.baseColor * irradiance;\n\n    // From the Disney dielectric BRDF    \n    // Need to check if this is useful for us but the implementation works based on their paper\n    //diffuseReflectance = (diffuseReflectance / PI); // << [PT 18-08-2018] What did this line do??? (makes everything 3.1x darker.)\n    // diffuseReflectance = vec3(mix(diffuseReflectance, diffuseReflectance * mix(0.5, 2.5, materialParams.roughness), pow(1.0 - NdotV, 5.0)));\n    diffuseReflectance = vec3(mix(diffuseReflectance, diffuseReflectance * mix(0.5, 1.0, materialParams.roughness), pow(1.0 - NdotV, 5.0)));\n\n\n    // -------------------------- Color at normal incidence --------------------------\n    \n    // Need to use 'Reflectance' here instead of 'ior'\n    //vec3 F0 = vec3(abs((1.0 - ior) / (1.0 + ior)));    \n    //F0 = F0 * F0;\n    //F0 = mix(F0, materialParams.baseColor, materialParams.metallic);      \n\n\n    // -------------------------- Specular Reflectance --------------------------\n    // vec3 ks = vec3(0.0);\n    // vec3 specular = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, F0, ks );\n    // vec3 kd = (vec3(1.0) - ks) * vec3(1.0 - metallic);    \n\n    float schlickFresnel = materialParams.reflectance + pow((1.0-materialParams.reflectance)*(1.0-NdotV), 5.0);\n\n    specularReflectance = GGX_Specular_PrefilteredEnv(normal, viewVector, materialParams.roughness, schlickFresnel);\n\n\n    // -------------------------- Specular Occlusion --------------------------\n    // Fast and quick way of reducing specular reflection in areas that are less exposed to the environment\n    // A better approch is to try screen space specular occlusion but need to check performance and feasibility in webGL\n    //float specularOcclusion = clamp(length(irradiance), 0.01, 1.0);    \n    //specularReflectance = (specularReflectance * specularOcclusion);  \n      \n\n    // -------------------------- Metallic --------------------------\n    // We need to do few things given a higher > 0 metallic value\n    //      1. tint specular reflectance by the albedo color (not at grazing angles)\n    //      2. almost elliminate all diffuse reflectance (in reality metals have some diffuse due to layering (i.e. dust, prints, etc.))\n    //      3. set \"specular\" artistic value to metallic range (0.6 - 0.85)\n\n    specularReflectance = mix(specularReflectance, specularReflectance * materialParams.baseColor, materialParams.metallic);\n    diffuseReflectance = mix(diffuseReflectance, vec3(0.0,0.0,0.0), materialParams.metallic); // Leaveing at pure black for now but always need some %3 diffuse left for imperfection of pulished pure metal\n    // Would be best to compute reflectace internally and set here to 0.6-0.85 for metals\n    \n\n    // -------------------------- Final color --------------------------\n    // Energy conservation already taken into account in both the diffuse and specular reflectance\n    vec3 radiance = diffuseReflectance + specularReflectance;\n\n    // radiance = vec4( kd * diffuse + /*ks */ specular, 1);\n    return radiance;\n}\n");var _d=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("LayeredCarPaintShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nattribute float clusterIDs;\nuniform vec2 lightmapSize;\n\n/* VS Outputs */\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    v_geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n#endif\n    // v_lightmapCoord = (lightmapCoords + geomItemData.zw) / lightmapSize;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + geomItemData.xy), 0., 1.);\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n//     v_clusterID = clusterIDs;\n// #endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("LayeredCarPaintShader.fragmentShader",'\n#ifndef ENABLE_ES3\n    #extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n<%include file="materialparams.glsl"/>\n\n/* VS Outputs */\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\nuniform sampler2D lightmap;\nuniform vec2 lightmapSize;\n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n<%include file="debugColors.glsl"/>\nuniform bool debugLightmapTexelSize;\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform color MidColorTint;\nuniform float MidColorTintReflectance;\n\nuniform float MicroflakePerturbation;\nuniform sampler2D FlakesNormalTex;\nuniform float FlakesScale;\n\n#ifdef ENABLE_SPECULAR\n\nuniform float BaseRoughness;\nuniform float BaseMetallic;\nuniform float BaseReflectance;\nuniform float GlossRoughness;\nuniform float GlossMetallic;\nuniform float GlossReflectance;\n\n#endif\n\n#ifdef ENABLE_TEXTURES\n\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n\n#endif\n\n// Followup: Normal Mapping Without Precomputed Tangents\n// http://www.thetenthplanet.de/archives/1180\nmat3 cotangent_frame( vec3 normal, vec3 position, vec2 uv )\n{\n    // get edge vectors of the pixel triangle\n    vec3 dp1 = dFdx( position );\n    vec3 dp2 = dFdy( position );\n    vec2 duv1 = dFdx( uv );\n    vec2 duv2 = dFdy( uv );\n \n    // solve the linear system\n    vec3 dp2perp = cross( dp2, normal );\n    vec3 dp1perp = cross( normal, dp1 );\n    vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 bitangent = dp2perp * duv1.y + dp1perp * duv2.y;\n \n    // construct a scale-invariant frame \n    float invmax = inversesqrt( max( dot(tangent,tangent), dot(bitangent,bitangent) ) );\n    return mat3( tangent * invmax, bitangent * invmax, normal );\n}\n\n#define WITH_NORMALMAP_UNSIGNED 1\n\nvec3 sampleNormalMap( sampler2D normalMap, vec2 texcoord )\n{\n    // assume normal, the interpolated vertex normal and \n    // viewVec, the view vector (vertex to eye)\n    vec3 map = texture2D( normalMap, texcoord ).xyz;\n#ifdef WITH_NORMALMAP_UNSIGNED\n    map = map * 255./127. - 128./127.;\n#endif\n#ifdef WITH_NORMALMAP_2CHANNEL\n    map.z = sqrt( 1. - dot( map.xy, map.xy ) );\n#endif\n#ifdef WITH_NORMALMAP_GREEN_UP\n    map.y = -map.y;\n#endif\n    return map;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n    MaterialParams material;\n\n#ifndef ENABLE_TEXTURES\n    material.baseColor      = BaseColor.rgb;\n#else\n    vec2 texCoord           = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n#endif\n\n#ifdef ENABLE_SPECULAR\n    material.roughness      = BaseRoughness;\n    material.metallic       = BaseMetallic;\n    material.reflectance    = BaseReflectance;\n#endif\n\n    vec3 irradiance = texture2D(lightmap, v_lightmapCoord).rgb;\n \n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n    if(debugLightmapTexelSize)\n    {\n        vec2 coord_texelSpace = (v_lightmapCoord * lightmapSize) - v_geomItemData.zw;\n        //vec2 coord_texelSpace = (v_textureCoord * lightmapSize);\n        float total = floor(coord_texelSpace.x) +\n                      floor(coord_texelSpace.y);\n                      \n        vec3 clustercolor = getDebugColor(v_clusterID);\n\n        if(mod(total,2.0)==0.0){\n            material.baseColor = clustercolor;\n            irradiance = vec3(1.0);\n        }\n        else{\n            material.baseColor = material.baseColor * 1.5;\n        }\n    }\n#endif\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    vec3 surfacePos = -v_viewPos;\n\n    // The vector from the camera to the surface point.\n    vec3 viewVector = mat3(cameraMatrix) * normalize(v_viewPos);\n    vec3 viewDir = normalize(viewVector);\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n\n    float NdotV = dot(normal, viewDir);\n    if(NdotV < 0.0){\n        normal = -normal;\n        NdotV = dot(normal, viewDir);\n    }\n\n#ifndef ENABLE_SPECULAR\n    vec3 radiance = material.baseColor * irradiance;\n#else\n    \n    // Mix the base color to give a multi-layered paint look.\n    material.baseColor      = mix(material.baseColor, material.baseColor * MidColorTint.rgb, (1.0-NdotV));\n\n    mat3 TBN = cotangent_frame( normal, surfacePos, v_lightmapCoord );\n    vec3 flakesNormal = TBN * -sampleNormalMap( FlakesNormalTex, (v_lightmapCoord * lightmapSize) / FlakesScale );\n    flakesNormal = normalize(mix(normal, flakesNormal, MicroflakePerturbation));\n\n    vec3 baseRadiance = pbrSurfaceRadiance(material, irradiance, flakesNormal, viewVector);\n\n    material.roughness      = GlossRoughness;\n    material.reflectance    = GlossReflectance;\n    vec4 gloss = pbrSpecularReflectance(material, normal, viewVector);\n    vec3 radiance = mix(baseRadiance, gloss.rgb, gloss.a);\n    //vec3 radiance = baseRadiance;\n\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(radiance, 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);e.push({name:"BaseColor",defaultValue:new An(1,0,0)}),e.push({name:"BaseMetallic",defaultValue:0}),e.push({name:"BaseRoughness",defaultValue:.35}),e.push({name:"BaseReflectance",defaultValue:.03}),e.push({name:"MidColorTint",defaultValue:new An(1,1,1)}),e.push({name:"MidColorTintReflectance",defaultValue:.03}),e.push({name:"GlossMetallic",defaultValue:0}),e.push({name:"GlossRoughness",defaultValue:.35}),e.push({name:"GlossReflectance",defaultValue:.03});var a=new Yo("flakes","ZeaEngine/FlakesNormalMap.png");return a.wrap="REPEAT",a.mipMapped=!0,e.push({name:"FlakesNormal",defaultValue:a}),e.push({name:"FlakesScale",defaultValue:.1}),e.push({name:"MicroflakePerturbation",defaultValue:.1}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Zs);br.registerClass("LayeredCarPaintShader",_d);var Zd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("FlatShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 ProjectionCenter;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nattribute float clusterIDs;\nuniform vec2 lightmapSize;\n\n/* VS Outputs */\n// varying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    vec4 geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position     = modelViewProjectionMatrix * pos;\n\n    vec4 worldPos = modelMatrix * pos;\n    v_worldDir = worldPos.xyz - ProjectionCenter;\n\n    v_lightmapCoord = (lightmapCoords + geomItemData.zw) / lightmapSize;\n}\n');return a}return e}(Zs);br.registerClass("ShadowCatcherShader",function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("ShadowCatcherShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n\n/* VS Outputs */\nvarying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nuniform sampler2D lightmap;\nuniform float ShadowMultiplier;\n\nuniform color envMap;\nuniform sampler2D envMapTex;\nuniform int envMapTexType;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n    vec4 env = envMap;\n    if(envMapTexType != 0) {\n        vec2 texCoord = dirToSphOctUv(normalize(v_worldDir));\n        env = texture2D(envMapTex, texCoord);\n    }\n\n    vec3 irradiance = texture2D(lightmap, v_lightmapCoord).rgb * ShadowMultiplier;\n    float irradianceLum = clamp(luminanceFromRGB(irradiance), 0.0, 1.0);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(env.rgb/env.a, 1.0);\n    fragColor.rgb = mix(fragColor.rgb * irradiance, fragColor.rgb, irradianceLum);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"ProjectionCenter",defaultValue:new Dn(0,0,1.7)}),e.push({name:"ShadowMultiplier",defaultValue:1}),e};e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(Zd));br.registerClass("FloatingShadowCatcherShader",function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("FloatingShadowCatcherShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLUtils.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n<%include file="pragmatic-pbr/envmap-octahedral.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_lightmapCoord;\nvarying vec3 v_worldDir;\n\nuniform sampler2D lightmap;\n\nuniform float ShadowMultiplier;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    \n    float shadow = luminanceFromRGB(texture2D(lightmap, v_lightmapCoord).rgb) * ShadowMultiplier;\n\n    // This material works by multiplying the image buffer values by the luminance in the lightmap.\n    fragColor.rgb = vec3(pow(shadow, 1.0/ShadowMultiplier));\n    fragColor.a = 1.0;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');return a}e.prototype.bind=function(e,a){return"MULTIPLY"==e.pass&&t.prototype.bind.call(this,e,a)};e.isTransparent=function(){return!0};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"ShadowMultiplier",defaultValue:1}),e};return e}(Zd));var Gd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("LinesShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("LinesShader.fragmentShader","\nprecision highp float;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = BaseColor;\n    fragColor.a *= Opacity;\n    \n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n"),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e.push({name:"Opacity",defaultValue:1}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(Zs);br.registerClass("LinesShader",Gd);var Xd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("NormalsShader.vertexShader",'\nprecision highp float;\n\ninstancedattribute vec3 positions;\ninstancedattribute vec3 normals;\nattribute vec2 vertexIDs;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nuniform float normalLength;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\n/* VS Outputs */\nvarying float v_weight;\n\nvoid main(void) {\n  mat4 modelMatrix = getModelMatrix(transformIndex);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n  if(vertexIDs.x == 0.0){\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n    v_weight = 1.0;\n  }\n  else{\n    gl_Position = modelViewProjectionMatrix * vec4(positions+(normals*normalLength), 1.0);\n    v_weight = 0.0;\n  }\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("NormalsShader.fragmentShader","\nprecision highp float;\n\nuniform color normalColor;\n\n/* VS Outputs */\nvarying float v_weight;\n\n\nvoid main(void) {\n  gl_FragColor = normalColor;\n  gl_FragColor.a = v_weight;\n}\n");return a}return e}(Zs);var vd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("PointsShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n  gl_Position = modelViewProjectionMatrix * vec4(positions, 1.);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("PointsShader.fragmentShader","\nprecision highp float;\n\nuniform color BaseColor;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  fragColor = BaseColor;\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n");return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e};return e}(Zs);br.registerClass("PointsShader",vd);var Vd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("FatPointsShader.vertexShader",'\nprecision highp float;\n\ninstancedattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n<%include file="utils/quadVertexFromID.glsl"/>\n\nuniform float PointSize;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  vec2 quadPointPos = getQuadVertexPositionFromID();\n  v_texCoord = quadPointPos + 0.5;\n\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.);\n\n  viewPos += vec4(vec3(quadPointPos, 0.0) * PointSize, 0.);\n\n  // Generate a quad which is 0.5 * PointSize closer towards\n  // us. This allows points to be visualized even if snug on \n  // a surface. (else they get fully clipped)\n  viewPos.z += 0.5 * PointSize;\n\n  v_drawItemId = float(getDrawItemId());\n  v_viewPos = -viewPos.xyz;\n  \n  gl_Position = projectionMatrix * viewPos;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("FatPointsShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n\nuniform color BaseColor;\nuniform float Rounded;\nuniform float BorderWidth;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n  if(dist > 0.5 - (BorderWidth * 0.5))\n    fragColor = vec4(0.,0.,0.,1.);\n  else {\n    // Modulate the lighting using the texture coord so the point looks round.\n    float NdotV = cos(dist * PI);\n\n    fragColor = BaseColor * mix(1.0, NdotV, Rounded);\n  }\n  \n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}e.prototype.bind=function(e){return!!t.prototype.bind.call(this,e)&&(e.supportsInstancing=!1,!0)};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e.push({name:"PointSize",defaultValue:.05}),e.push({name:"Rounded",defaultValue:1}),e.push({name:"BorderWidth",defaultValue:.2}),e};e.getGeomDataShaderName=function(){return"FatPointsGeomDataShader"};e.getSelectedShaderName=function(){return"FatPointsSelectedShader"};return e}(Zs);var Id=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("FatPointsGeomDataShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n    \n\n  float viewDist = length(v_viewPos);\n\n  if(floatGeomBuffer != 0) {\n    fragColor.r = float(passId); \n    fragColor.g = float(v_drawItemId);\n    fragColor.b = 0.0;// TODO: store poly-id or something.\n    fragColor.a = viewDist;\n  }\n  else {\n    ///////////////////////////////////\n    // UInt8 buffer\n    fragColor.r = (mod(v_drawItemId, 256.) + 0.5) / 255.;\n    fragColor.g = (floor(v_drawItemId / 256.) + 0.5) / 255.;\n\n    // encode the dist as a 16 bit float\n    vec2 float16bits = encode16BitFloatInto2xUInt8(viewDist);\n    fragColor.b = float16bits.x;\n    fragColor.a = float16bits.y;\n  }\n\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}return e}(Vd);var Rd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("FatPointsSelectedShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\nvarying vec3 v_viewPos;\nvarying float v_drawItemId;\n\n\n<%include file="drawItemTexture.glsl"/>\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n    return highlightColor;\n}\n\n#endif\n\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n#endif\n\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n  vec4 fragColor;\n#endif\n\n  float dist = length(v_texCoord - 0.5);\n  if(dist > 0.5)\n    discard;\n  \n  int drawItemId = int(v_drawItemId + 0.5);\n  fragColor = getHighlightColor(drawItemId);\n\n#ifndef ENABLE_ES3\n  gl_FragColor = fragColor;\n#endif\n}\n');return a}return e}(Vd);br.registerClass("FatPointsShader",Vd),br.registerClass("FatPointsGeomDataShader",Id),br.registerClass("FatPointsSelectedShader",Rd),gs.setShaderModule("pragmatic-pbr/exposure.glsl","\n\n/*\n* Get an exposure using the Saturation-based Speed method.\n*/\nfloat getSaturationBasedExposure(float aperture,\n                                 float shutterSpeed,\n                                 float iso)\n{\n    float l_max = (7800.0 / 65.0) * sqrt(aperture) / (iso * shutterSpeed);\n    return 1.0 / l_max;\n}\n\n//White balance middle grey we are targetting for a good scene exposure\n//https://en.wikipedia.org/wiki/Middle_gray\nconst float MIDDLE_GREY = 0.18;\n\n/*\n* Get an exposure using the Standard Output Sensitivity method.\n* Accepts an additional parameter of the target middle grey.\n*/\nfloat getStandardOutputBasedExposure(float aperture,\n                                     float shutterSpeed,\n                                     float iso)\n{\n    //https://placeholderart.wordpress.com/2014/11/21/implementing-a-physically-based-camera-manual-exposure/\n    //https://en.wikipedia.org/wiki/Film_speed#Standard_output_sensitivity_.28SOS.29\n    //photometric exposure magic\n    //represents the properties of lens\n    float q = 0.65;\n\n    //float l_avg = (1000.0f / 65.0f) * sqrt(aperture) / (iso * shutterSpeed);\n    float l_avg = (1.0 / q) * sqrt(aperture) / (iso * shutterSpeed);\n    //float l_avg = sqrt(aperture) / (iso * shutterSpeed);\n    return MIDDLE_GREY / l_avg;\n}\n\n"),gs.setShaderModule("pragmatic-pbr/tonemap-filmic.glsl","\n\n//Based on Filmic Tonemapping Operators http://filmicgames.com/archives/75\nvec3 tonemapFilmic(vec3 color) {\n    vec3 x = max(vec3(0.0), color - 0.004);\n    return (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);\n}\n\n"),gs.setShaderModule("mattdesl/fxaa-texcoords.glsl","\n//To save 9 dependent texture reads, you can compute\n//these in the vertex shader and use the optimized\n//frag.glsl function in your frag shader. \n\n//This is best suited for mobile devices, like iOS.\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\n"),gs.setShaderModule("mattdesl/fxaa.glsl",'\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n--\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\nCopyright (c) 2011 by Armin Ronacher.\nSome rights reserved.\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent \n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE, \n            vec2 v_rgbSW, vec2 v_rgbSE, \n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n'),gs.setShaderModule("mattdesl/fxaa-apply.glsl",'\n\n<%include file="mattdesl/fxaa.glsl"/>\n\nvec4 apply(sampler2D tex, vec2 fragCoord, vec2 resolution) {\n    mediump vec2 v_rgbNW;\n    mediump vec2 v_rgbNE;\n    mediump vec2 v_rgbSW;\n    mediump vec2 v_rgbSE;\n    mediump vec2 v_rgbM;\n\n    //compute the texture coords\n    texcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n    \n    //compute FXAA\n    return fxaa(tex, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\n');var xd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("PostProcessing.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n<%include file="mattdesl/fxaa-texcoords.glsl"/>\n\nuniform vec2 textureSize;\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n\n    vec2 fragCoord = v_texCoord * textureSize;\n    texcoords(fragCoord, textureSize, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("PostProcessing.fragmentShader",'\nprecision highp float;\n\n<%include file="pragmatic-pbr/exposure.glsl"/>\n<%include file="pragmatic-pbr/tonemap-filmic.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n\n<%include file="mattdesl/fxaa.glsl"/>\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D texture;\nuniform vec2 textureSize;\n\nuniform bool antialiase;\nuniform bool tonemap;\nuniform float exposure;\nuniform float gamma;\n\nvarying vec2 v_texCoord;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n    //can also use gl_FragCoord.xy\n    mediump vec2 fragCoord = v_texCoord * textureSize; \n\n    if (antialiase) {\n        fragColor = fxaa(texture, fragCoord, textureSize, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n    } else {\n        fragColor = texture2D(texture, v_texCoord);\n    }\n    \n    //fragColor.rgb *= getStandardOutputBasedExposure(aperture, shutterSpeed, iso);\n    fragColor.rgb *= exposure;\n    \n    if (tonemap) \n        fragColor.rgb = tonemapFilmic(fragColor.rgb);\n    else\n        fragColor.rgb = toGamma(fragColor.rgb, gamma);\n\n    \n    //fragColor.rgb = toGamma(fragColor.rgb, gamma);\n    \n    fragColor.a = 1.0;\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}'),a.finalize();return a}return e}(Zs);var Sd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("SimpleSurfaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    v_geomItemData  = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n    // v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n#endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("SimpleSurfaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\nvarying vec3 v_worldPos;\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_TEXTURES\n\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\nuniform sampler2D OpacityTex;\nuniform int OpacityTexType;\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\n\nvoid main(void) {\n    int drawItemId = int(v_drawItemId + 0.5);\n\n    int flags = int(v_geomItemData.r + 0.5);\n    // Cutaways\n    if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) \n    {\n        vec4 cutAwayData   = getCutaway(drawItemId);\n        vec3 planeNormal = cutAwayData.xyz;\n        float planeDist = cutAwayData.w;\n        if(cutaway(v_worldPos, planeNormal, planeDist)){\n            discard;\n            return;\n        }\n        else if(!gl_FrontFacing){\n            fragColor = cutColor;\n#ifndef ENABLE_ES3\n            gl_FragColor = fragColor;\n#endif\n            return;\n        }\n    }\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor      = BaseColor;\n    float opacity       = baseColor.a * Opacity;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n    float opacity       = baseColor.a * getLuminanceParamValue(Opacity, OpacityTex, OpacityTexType, v_textureCoord);\n#endif\n\n    // Hacky simple irradiance. \n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * v_viewNormal);\n    float ndotv = dot(normal, viewVector);\n    if(ndotv < 0.0){\n        normal = -normal;\n        ndotv = dot(normal, viewVector);\n\n        // Note: these 2 lines can be used to debug inverted meshes.\n        //baseColor = vec4(1.0, 0.0, 0.0, 1.0);\n        //ndotv = 1.0;\n    }\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = vec4(ndotv * baseColor.rgb, opacity);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e.push({name:"Opacity",defaultValue:1,range:[0,1]}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Zs);br.registerClass("SimpleSurfaceShader",Sd),gs.setShaderModule("cutaways.glsl","\n\n\nconst int GEOMITEM_FLAG_CUTAWAY =  1; // 1<<0;\n\n#define RAY_EPS 0.0000001\nstruct Ray {\n    vec3 start;\n    vec3 dir;\n};\n\nfloat intersectRayPlane(Ray ray, Ray plane) {\n    vec3 w = ray.start - plane.start;\n    float D = dot(plane.dir, ray.dir);\n    float N = dot(-plane.dir, w);\n\n    if (abs(D) < RAY_EPS) {\n        // segment is parallel to plane\n        if (N == 0.0)\n            return -1.0; // segment lies in plane\n        else\n            return -1.0; // no intersection\n    }\n    // they are not parallel\n    // compute intersect param\n    float sI = N / D;\n    if (sI < -RAY_EPS) {\n        return -1.0; // no intersection\n    }\n    return sI;\n}\n\n\nbool cutaway(vec3 worldPos, vec3 planeNormal, float planeDist) {\n\n    vec3 planePos = planeNormal * planeDist;\n    vec3 planeDir = worldPos + planePos;\n    float planeOffset = dot(planeDir, planeNormal);\n    if(planeOffset > 0.0){\n        return true;\n    }\n    return  false;\n}\n");var Wd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("StandardSurfaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\nattribute vec3 normals;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\nattribute vec2 lightmapCoords;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n// attribute float clusterIDs;\n// uniform vec2 lightmapSize;\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    v_geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n\n#ifdef ENABLE_TEXTURES\n    v_textureCoord  = texCoords;\n#endif\n\n    // v_lightmapCoord = (lightmapCoords + v_geomItemData.zw) / lightmapSize;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + v_geomItemData.zw), 0., 1.);\n#ifdef ENABLE_DEBUGGING_LIGHTMAPS\n    v_clusterID = clusterIDs;\n#endif\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("StandardSurfaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="math/constants.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\n\n/* VS Outputs */\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n// varying vec2 v_lightmapCoord;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// varying float v_clusterID;\n// #endif\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\n// uniform sampler2D lightmap;\n// uniform bool lightmapConnected;\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n// <%include file="debugColors.glsl"/>\n// uniform vec2 lightmapSize;\n// uniform bool debugLightmapTexelSize;\n// #endif\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\n\nuniform color BaseColor;\nuniform float EmissiveStrength;\n\n\n#ifdef ENABLE_SPECULAR\nuniform float Roughness;\nuniform float Metallic;\nuniform float Reflectance;\n#endif\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n\n#ifdef ENABLE_SPECULAR\nuniform sampler2D RoughnessTex;\nuniform int RoughnessTexType;\n\nuniform sampler2D MetallicTex;\nuniform int MetallicTexType;\n\nuniform sampler2D ReflectanceTex;\nuniform int ReflectanceTexType;\n\nuniform sampler2D NormalTex;\nuniform int NormalTexType;\n// uniform float NormalScale;\n#endif\n\nuniform sampler2D EmissiveStrengthTex;\nuniform int EmissiveStrengthTexType;\n\n\n#endif\n\n#ifdef ENABLE_ES3\nout vec4 fragColor;\n\n#endif\n\nvoid main(void) {\n    int drawItemId = int(v_drawItemId + 0.5);\n\n    int flags = int(v_geomItemData.r + 0.5);\n    // Cutaways\n    if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n        vec4 cutAwayData   = getCutaway(drawItemId);\n        vec3 planeNormal = cutAwayData.xyz;\n        float planeDist = cutAwayData.w;\n        if(cutaway(v_worldPos, planeNormal, planeDist)){\n            discard;\n            return;\n        }\n        else if(!gl_FrontFacing){\n            fragColor = cutColor;\n#ifndef ENABLE_ES3\n            gl_FragColor = fragColor;\n#endif\n            return;\n        }\n    }\n\n\n    MaterialParams material;\n\n#ifndef ENABLE_TEXTURES\n    material.BaseColor     = BaseColor.rgb;\n    float emission         = EmissiveStrength;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness     = Roughness;\n    material.metallic      = Metallic;\n    material.reflectance   = Reflectance;\n#endif\n\n#else\n    // Planar YZ projection for texturing, repeating every meter.\n    // vec2 texCoord       = v_worldPos.xz * 0.2;\n    vec2 texCoord          = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor     = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness     = getLuminanceParamValue(Roughness, RoughnessTex, RoughnessTexType, texCoord);\n    material.metallic      = getLuminanceParamValue(Metallic, MetallicTex, MetallicTexType, texCoord);\n    material.reflectance   = getLuminanceParamValue(Reflectance, ReflectanceTex, ReflectanceTexType, texCoord);\n#endif\n    float emission         = getLuminanceParamValue(EmissiveStrength, EmissiveStrengthTex, EmissiveStrengthTexType, texCoord);\n#endif\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    //vec3 surfacePos = -v_viewPos;\n\n#ifdef ENABLE_TEXTURES\n#ifdef ENABLE_SPECULAR\n    if(NormalTexType != 0){\n        vec3 textureNormal_tangentspace = normalize(texture2D(NormalTex, texCoord).rgb * 2.0 - 1.0);\n        viewNormal = normalize(mix(viewNormal, textureNormal_tangentspace, 0.3));\n    }\n#endif\n#endif\n\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n    if(dot(normal, viewVector) < 0.0){\n        normal = -normal;\n        // Note: this line can be used to debug inverted meshes.\n        //material.baseColor = vec3(1.0, 0.0, 0.0);\n    }\n\n    vec3 irradiance;\n    // if(lightmapConnected){\n    //     irradiance = texture2D(lightmap, v_lightmapCoord).rgb;\n    // }\n    // else{\n#ifndef ENABLE_SPECULAR\n        irradiance = sampleEnvMap(normal, 1.0);\n#else\n        irradiance = vec3(dot(normal, viewVector));\n#endif\n        \n    // }\n\n// #ifdef ENABLE_DEBUGGING_LIGHTMAPS\n//     if(debugLightmapTexelSize)\n//     {\n//         vec2 coord_texelSpace = (v_lightmapCoord * lightmapSize) - v_geomItemData.zw;\n//         //vec2 coord_texelSpace = (v_textureCoord * lightmapSize);\n//         float total = floor(coord_texelSpace.x) +\n//                       floor(coord_texelSpace.y);\n                      \n//         vec3 clustercolor = getDebugColor(v_clusterID);\n\n//         material.metallic = 0.0;\n//         material.reflectance = 0.0;\n//         if(mod(total,2.0)==0.0){\n//             material.baseColor = clustercolor;\n//             irradiance = vec3(1.0);\n//         }\n//         else{\n//             material.baseColor = material.baseColor * 1.5;\n//         }\n//     }\n// #endif\n\n#ifndef ENABLE_SPECULAR\n    vec3 radiance = material.baseColor * irradiance;\n#else\n    vec3 radiance = pbrSurfaceRadiance(material, irradiance, normal, viewVector);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    // fragColor = vec4(material.baseColor, 1.0);\n    // fragColor = vec4(material.baseColor * irradiance, 1.0);\n    fragColor = vec4(radiance + (emission * material.baseColor), 1.0);\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e.push({name:"Metallic",defaultValue:0,range:[0,1]}),e.push({name:"Roughness",defaultValue:.85,range:[0,1]}),e.push({name:"Reflectance",defaultValue:.1,range:[0,1]}),e.push({name:"EmissiveStrength",defaultValue:0,range:[0,1]}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};return e}(Zs);br.registerClass("StandardSurfaceShader",Wd),gs.setShaderModule("GLSLBits.glsl",'\n    \n/////////////////////////////////////////////////////////////////\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\nfloat shift_right(float v, float amt) {\n  v = floor(v) + 0.5;\n  return floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\n  return floor(v * exp2(amt) + 0.5);\n}\n\nfloat mask_last(float v, float bits) {\n  return mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\n  from = floor(from + 0.5);\n  to = floor(to + 0.5);\n  return mask_last(shift_right(num, from), to - from);\n}\n\n/////////////////////////////////////////////////////////////////\n// https://stackoverflow.com/questions/18453302/how-do-you-pack-one-32bit-int-into-4-8bit-ints-in-glsl-webgl\n\nconst vec4 bitEnc = vec4(1.,255.,65025.,16581375.);\nconst vec4 bitDec = 1./bitEnc;\nvec4 EncodeFloatRGBA (float v) {\n    vec4 enc = bitEnc * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec2(1./255., 0.).xxxy;\n    return enc;\n}\nfloat DecodeFloatRGBA (vec4 v) {\n    return dot(v, bitDec);\n}\n\n\n\n/////////////////////////////////////////////////////////////////\n// https://gist.github.com/Flexi23/1713774\n// \nvec2 encode16BitFloatInto2xUInt8(float v){\n    vec2 c = vec2(0.);\n\n    int signum = (v >= 0.) ? 128 : 0;\n    v = abs(v);\n    int exponent = 15;\n    float limit = 1024.; // considering the bias from 2^-5 to 2^10 (==1024)\n    for(int exp = 15; exp > 0; exp--){\n        if( v < limit){\n            limit /= 2.;\n            exponent--;\n        }\n    }\n\n    float rest;\n    if(exponent == 0){\n        rest = v / limit / 2.;      // "subnormalize" implicite preceding 0. \n    }else{\n        rest = (v - limit)/limit;   // normalize accordingly to implicite preceding 1.\n    }\n\n    int mantissa = int(rest * 2048.);   // 2048 = 2^11 for the (split) 11 bit mantissa\n    int msb = mantissa / 256;           // the most significant 3 bits go into the lower part of the first byte\n    int lsb = mantissa - msb * 256;     // there go the other 8 bit of the lower significance\n\n    c.x = float(signum + exponent * 8 + msb) / 255.;    // color normalization for texture2D\n    c.y = float(lsb) / 255.;\n\n    if(v >= 2048.){\n        c.y = 1.;\n    }\n\n    return c;\n}\n\nfloat decode16BitFloatFrom2xUInt8(vec2 c){\n    float v = 0.;\n\n    int ix = int(c.x*255.); // 1st byte: 1 bit signum, 4 bits exponent, 3 bits mantissa (MSB)\n    int iy = int(c.y*255.); // 2nd byte: 8 bit mantissa (LSB)\n\n    int s = (c.x >= 0.5) ? 1 : -1;\n    ix = (s > 0) ? ix - 128 : ix;   // remove the signum bit from exponent\n    int iexp = ix / 8;              // cut off the last 3 bits of the mantissa to select the 4 exponent bits\n    int msb = ix - iexp * 8;        // subtract the exponent bits to select the 3 most significant bits of the mantissa\n\n    int norm = (iexp == 0) ? 0 : 2048;          // distinguish between normalized and subnormalized numbers\n    int mantissa = norm + msb * 256 + iy;       // implicite preceding 1 or 0 added here\n    norm = (iexp == 0) ? 1 : 0;                 // normalization toggle\n    float exponent = pow( 2., float(iexp + norm) - 16.); // -5 for the the exponent bias from 2^-5 to 2^10 plus another -11 for the normalized 12 bit mantissa \n    v = float( s * mantissa ) * exponent;\n\n    return v;\n}\n\n\n// TODO : Encoding Float32 to 4x UInt8\n// http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\n// http://ultraist.hatenablog.com/entry/20110608/1307539319\n\n');var Ld=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__shaderStages.VERTEX_SHADER=gs.parseShader("StandardSurfaceGeomDataShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  v_drawItemId = float(drawItemId);\n  v_geomItemData = getInstanceData(drawItemId);\n\n  vec4 pos = vec4(positions, 1.);\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  vec4 viewPos = modelViewMatrix * pos;\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = -viewPos.xyz;\n\n  v_drawItemID = float(getDrawItemId());\n  \n  v_worldPos      = (modelMatrix * pos).xyz;\n}\n'),i.__shaderStages.FRAGMENT_SHADER=gs.parseShader("StandardSurfaceGeomDataShader.fragmentShader",'\nprecision highp float;\n\n<%include file="drawItemTexture.glsl"/>\n<%include file="cutaways.glsl"/>\n<%include file="GLSLBits.glsl"/>\n\nuniform int floatGeomBuffer;\nuniform int passId;\n\nuniform color cutColor;\nvec4 getCutaway(int id) {\n    return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 5);\n}\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n  int drawItemId = int(v_drawItemId + 0.5);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n  int flags = int(v_geomItemData.r + 0.5);\n  // Cutaways\n  if(testFlag(flags, GEOMITEM_FLAG_CUTAWAY)) {\n      vec4 cutAwayData   = getCutaway(drawItemId);\n      vec3 planeNormal = cutAwayData.xyz;\n      float planeDist = cutAwayData.w;\n      if(cutaway(v_worldPos, planeNormal, planeDist)){\n          discard;\n          return;\n      }\n      else if(!gl_FrontFacing){\n          fragColor = cutColor;\n  #ifndef ENABLE_ES3\n          gl_FragColor = fragColor;\n  #endif\n          return;\n      }\n  }\n\n    float dist = length(v_viewPos);\n\n    if(floatGeomBuffer != 0) {\n        fragColor.r = float(passId); \n        fragColor.g = float(v_drawItemID);\n        fragColor.b = 0.0;// TODO: store poly-id or something.\n        fragColor.a = dist;\n    }\n    else {\n        ///////////////////////////////////\n        // UInt8 buffer\n        fragColor.r = (mod(v_drawItemID, 256.) + 0.5) / 255.;\n        fragColor.g = (floor(v_drawItemID / 256.) + 0.5) / 255.;\n\n\n        // encode the dist as a 16 bit float\n        vec2 float16bits = encode16BitFloatInto2xUInt8(dist);\n        fragColor.b = float16bits.x;\n        fragColor.a = float16bits.y;\n    }\n\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');return i}return e}(Zs);br.registerClass("StandardSurfaceGeomDataShader",Ld);var Td=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__shaderStages.VERTEX_SHADER=gs.parseShader("StandardSurfaceSelectedGeomsShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\nvarying float v_drawItemId;\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n    v_drawItemId = float(drawItemId);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n    gl_Position = projectionMatrix * viewPos;\n\n}\n'),i.__shaderStages.FRAGMENT_SHADER=gs.parseShader("StandardSurfaceSelectedGeomsShader.fragmentShader",'\nprecision highp float;\n\nvarying float v_drawItemId;\n\n\n<%include file="drawItemTexture.glsl"/>\n\n#ifdef ENABLE_FLOAT_TEXTURES\nvec4 getHighlightColor(int id) {\n  return fetchTexel(instancesTexture, instancesTextureSize, (id * pixelsPerItem) + 4);\n}\n#else\n\nuniform vec4 highlightColor;\n\nvec4 getHighlightColor() {\n    return highlightColor;\n}\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    int drawItemId = int(v_drawItemId + 0.5);\n    fragColor = getHighlightColor(drawItemId);\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n');return i}return e}(Zs);br.registerClass("StandardSurfaceSelectedGeomsShader",Td);var Md=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("HandleShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int maintainScreenSize;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n\n  if(maintainScreenSize != 0) {\n    float dist = modelViewMatrix[3][2];\n    float sc = dist;\n    mat4 scmat = mat4(\n      sc, 0.0, 0.0, 0.0,\n      0.0, sc, 0.0, 0.0,\n      0.0, 0.0, sc, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n    modelViewMatrix = modelViewMatrix * scmat;\n  }\n\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = viewPos.xyz;\n  v_textureCoord = texCoords;\n  v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("HandleShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e.push({name:"maintainScreenSize",defaultValue:0}),e};e.isOverlay=function(){return!0};e.getGeomDataShaderName=function(){return"HandleGeomDataShader"};return e}(Zs);br.registerClass("HandleShader",Md);var Fd=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,e)||this,i.__shaderStages.VERTEX_SHADER=gs.parseShader("HandleGeomDataShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform int maintainScreenSize;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n\nvarying float v_drawItemId;\nvarying vec4 v_geomItemData;\nvarying vec3 v_viewPos;\nvarying float v_drawItemID;\nvarying vec3 v_worldPos;\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n  mat4 modelMatrix = getModelMatrix(drawItemId);\n  mat4 modelViewMatrix = viewMatrix * modelMatrix;\n  \n  if(maintainScreenSize != 0) {\n    float dist = modelViewMatrix[3][2];\n    float sc = dist;\n    mat4 scmat = mat4(\n      sc, 0.0, 0.0, 0.0,\n      0.0, sc, 0.0, 0.0,\n      0.0, 0.0, sc, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n    modelViewMatrix = modelViewMatrix * scmat;\n  }\n\n  vec4 viewPos = modelViewMatrix * vec4(positions, 1.0);\n  gl_Position = projectionMatrix * viewPos;\n\n  v_viewPos = -viewPos.xyz;\n\n  v_drawItemID = float(getDrawItemId());\n}\n');return i}return e}(Ld);br.registerClass("HandleGeomDataShader",Fd);var Cd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("TransparentSurfaceShader.vertexShader",'\nprecision highp float;\n\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="stack-gl/inverse.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\nvoid main(void) {\n    int drawItemId = getDrawItemId();\n\n    vec4 geomItemData = getInstanceData(drawItemId);\n\n    vec4 pos = vec4(positions, 1.);\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n    mat4 modelViewMatrix = viewMatrix * modelMatrix;\n    vec4 viewPos    = modelViewMatrix * pos;\n    gl_Position     = projectionMatrix * viewPos;\n\n    // mat4 mvp = projectionMatrix * viewMatrix * modelMatrix;\n    // gl_Position = mvp * vec4((lightmapCoords + geomItemData.xy), 0., 1.);\n\n    v_worldPos      = (modelMatrix * pos).xyz;\n\n    mat3 normalMatrix = mat3(transpose(inverse(modelViewMatrix)));\n    v_viewPos       = -viewPos.xyz;\n    v_viewNormal    = normalMatrix * normals;\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("TransparentSurfaceShader.fragmentShader",'\nprecision highp float;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n<%include file="stack-gl/gamma.glsl"/>\n#endif\n<%include file="GLSLUtils.glsl"/>\n\n/* VS Outputs */\nvarying vec3 v_viewPos;\nvarying vec3 v_viewNormal;\n\nvarying vec3 v_worldPos;\n/* VS Outputs */\n\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\nuniform float exposure;\n#endif\n\nuniform mat4 cameraMatrix;\nuniform float planeDist;\nuniform float planeAngle;\n\nuniform color BaseColor;\nuniform float Opacity;\n\n#ifdef ENABLE_SPECULAR\n<%include file="math/constants.glsl"/>\n<%include file="GGX_Specular.glsl"/>\n<%include file="PBRSurfaceRadiance.glsl"/>\nuniform float Roughness;\nuniform float Metallic;\nuniform float Reflectance;\n#endif\n\n#ifdef __ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform bool BaseColorTexType;\n\nuniform sampler2D OpacityTex;\nuniform bool OpacityTexType;\n\nuniform sampler2D RoughnessTex;\nuniform bool RoughnessTexType;\n\nuniform sampler2D ReflectanceTex;\nuniform bool ReflectanceTexType;\n\nuniform sampler2D NormalTex;\nuniform bool NormalTexType;\nuniform float NormalScale;\n\n\n#endif\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n    MaterialParams material;\n\n#ifndef __ENABLE_TEXTURES\n    material.baseColor      = BaseColor.rgb;\n    float opacity           = Opacity;\n\n#ifdef ENABLE_SPECULAR\n    material.roughness      = Roughness;\n    material.metallic       = Metallic;\n    material.reflectance    = Reflectance;\n#endif\n\n#else\n    // Planar YZ projection for texturing, repeating every meter.\n    // vec2 texCoord        = v_worldPos.xz * 0.2;\n    vec2 texCoord           = vec2(v_textureCoord.x, 1.0 - v_textureCoord.y);\n    material.baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, texCoord).rgb;\n    material.roughness      = getLuminanceParamValue(Roughness, RoughnessTex, RoughnessTexType, texCoord);\n    material.metallic       = getLuminanceParamValue(Metallic, MetallicTex, MetallicTexType, texCoord);\n    material.reflectance    = Reflectance;//getLuminanceParamValue(Reflectance, ReflectanceTex, ReflectanceTexType, texCoord);\n\n    float opacity           = getLuminanceParamValue(Opacity, OpacityTex, OpacityTexType, texCoords);\n#endif\n\n#ifndef ENABLE_SPECULAR\n    gl_FragColor = vec4(material.baseColor.rgb, opacity);\n#else\n\n    vec3 viewNormal = normalize(v_viewNormal);\n    //vec3 surfacePos = -v_viewPos;\n\n#ifdef __ENABLE_TEXTURES\n    if(NormalTexType != 0){\n        vec3 textureNormal_tangentspace = normalize(texture2D(NormalTex, texCoord).rgb * 2.0 - 1.0);\n        viewNormal = normalize(mix(viewNormal, textureNormal_tangentspace, 0.3));\n    }\n#endif\n\n    vec3 viewVector = normalize(mat3(cameraMatrix) * normalize(v_viewPos));\n    vec3 normal = normalize(mat3(cameraMatrix) * viewNormal);\n    if(dot(normal, viewVector) < 0.0){\n        normal = -normal;\n        // Note: this line can be used to debug inverted meshes.\n        //material.baseColor = vec3(1.0, 0.0, 0.0);\n    }\n\n    vec4 specularReflectance = pbrSpecularReflectance(material, normal, viewVector);\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(specularReflectance.rgb, mix(opacity, 1.0, specularReflectance.a));\n\n#endif\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb * exposure);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e.push({name:"Opacity",defaultValue:1,range:[0,1]}),e.push({name:"Roughness",defaultValue:.85}),e.push({name:"Reflectance",defaultValue:1e-4}),e};e.getGeomDataShaderName=function(){return"StandardSurfaceGeomDataShader"};e.getSelectedShaderName=function(){return"StandardSurfaceSelectedGeomsShader"};e.isTransparent=function(){return!0};e.prototype.bind=function(e,a){return"ADD"==e.pass&&t.prototype.bind.call(this,e,a)};return e}(Zs);br.registerClass("TransparentSurfaceShader",Cd);var Nd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("ScreenSpaceShader.vertexShader",'\nprecision highp float;\n\nattribute vec3 positions;\n#ifdef ENABLE_TEXTURES\nattribute vec2 texCoords;\n#endif\n\n<%include file="stack-gl/transpose.glsl"/>\n<%include file="drawItemId.glsl"/>\n<%include file="drawItemTexture.glsl"/>\n<%include file="modelMatrix.glsl"/>\n\n/* VS Outputs */\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\nvoid main(void) {\n  int drawItemId = getDrawItemId();\n    mat4 modelMatrix = getModelMatrix(drawItemId);\n\n    gl_Position = (modelMatrix * vec4(positions, 1.0));\n\n    v_textureCoord = texCoords;\n    v_textureCoord.y = 1.0 - v_textureCoord.y;// Flip y\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("ScreenSpaceShader.fragmentShader",'\nprecision highp float;\n\n<%include file="stack-gl/gamma.glsl"/>\n<%include file="materialparams.glsl"/>\n\nuniform color BaseColor;\n\n#ifdef ENABLE_TEXTURES\nuniform sampler2D BaseColorTex;\nuniform int BaseColorTexType;\n#endif\n\n/* VS Outputs */\n#ifdef ENABLE_TEXTURES\nvarying vec2 v_textureCoord;\n#endif\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_TEXTURES\n    vec4 baseColor = BaseColor;\n#else\n    vec4 baseColor      = getColorParamValue(BaseColor, BaseColorTex, BaseColorTexType, v_textureCoord);\n#endif\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n    fragColor = baseColor;\n\n#ifdef ENABLE_INLINE_GAMMACORRECTION\n    fragColor.rgb = toGamma(fragColor.rgb);\n#endif\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n'),a.finalize();return a}e.isOverlay=function(){return!0};e.getParamDeclarations=function(){var e=t.getParamDeclarations.call(this);return e.push({name:"BaseColor",defaultValue:new An(1,1,.5)}),e};e.getGeomDataShaderName=function(){return null};e.getSelectedShaderName=function(){return null};return e}(Zs);br.registerClass("ScreenSpaceShader",Nd);var Yd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.invisibleToGeomBuffer=!0;return a}return e}(yd);br.registerClass("ToolIconShader",Yd);var Kd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("UnpackLDRAlphaImageShader.vertexShader",'\nprecision highp float;\n\n<%include file="utils/quadVertexFromID.glsl"/>\n\n/* VS Outputs */\nvarying vec2 v_texCoord;\n \nvoid main()\n{\n    vec2 position = getQuadVertexPositionFromID();\n    v_texCoord = position+0.5;\n    gl_Position = vec4(position*2.0, 0.0, 1.0);\n}\n'),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("UnpackLDRAlphaImageShader.fragmentShader","\nprecision highp float;\n\nvarying vec2 v_texCoord;\nuniform sampler2D ldrSampler;\nuniform sampler2D alphaSampler;\n\nfloat luminanceFromRGB(vec3 rgb) {\n    return 0.2126*rgb.r + 0.7152*rgb.g + 0.0722*rgb.b;\n}\n\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n\n#ifndef ENABLE_ES3\n    vec4 fragColor;\n#endif\n\n    fragColor = vec4(texture2D(ldrSampler, v_texCoord).rgb, luminanceFromRGB(texture2D(alphaSampler, v_texCoord).rgb));\n\n#ifndef ENABLE_ES3\n    gl_FragColor = fragColor;\n#endif\n}\n\n");return a}return e}(Zs);var wd=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__shaderStages.VERTEX_SHADER=gs.parseShader("WireShader.vertexShader","\nprecision highp float;\n\nattribute vec3 positions;    //(location = 0)\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\n/* VS Outputs */\n\nvoid main(void) {\n    mat4 modelViewProjectionMatrix = projectionMatrix * viewMatrix * modelMatrix;\n    gl_Position = modelViewProjectionMatrix * vec4(positions, 1.0);\n\n    // Apply the perspective transform, and then move the vertices\n    //  towards the camera by a tiny little bit...\n    gl_Position.z -= 0.001 / gl_Position.w;\n    //gl_Position.z *= 0.999;\n}\n"),a.__shaderStages.FRAGMENT_SHADER=gs.parseShader("WireShader.fragmentShader","\nprecision highp float;\n\nuniform color wireColor;\n\n#ifdef ENABLE_ES3\n    out vec4 fragColor;\n#endif\nvoid main(void) {\n#ifdef ENABLE_ES3\n    gl_FragColor = color;\n#else\n    fragColor = color;\n#endif  \n}\n");return a}return e}(Zs);var zd=0,Ud=1,Jd=2,Pd=3;var Ed=function(){function t(t,e,a,i,n){var r=this;if(n===void 0){n=null}this.gl=t,this.geomItem=e,this.glGeom=a,this.id=i,this.flags=n,this.visible=this.geomItem.getVisible(),this.culled=!1,this.lightmapName=e.getLightmapName(),this.updated=new dr,this.visibilityChanged=new dr,this.highlightChanged=e.highlightChanged,this.updateVisibility=this.updateVisibility.bind(this),this.updateVisibility=this.updateVisibility.bind(this),this.destroy=this.destroy.bind(this),t.floatTexturesSupported?this.updateXfo=function(t){r.updated.emit(zd)}:this.updateXfo=function(t){r.updateGeomMatrix()},this.geomItem.geomXfoChanged.connect(this.updateXfo),this.geomItem.visibilityChanged.connect(this.updateVisibility),this.geomItem.cutAwayChanged.connect((function(){r.updated.emit(zd)})),this.highlightChangedId=this.geomItem.highlightChanged.connect((function(){r.updated.emit(Pd)})),this.glGeom.updated.connect((function(){r.updated.emit(Ud)}));var o=this.geomItem.getLightmapCoordsOffset();this.geomData=[o.x,o.y,0,0]}t.prototype.getGeomItem=function(){return this.geomItem};t.prototype.getGLGeom=function(){return this.glGeom};t.prototype.getVisible=function(){return this.geomItem.getVisible()};t.prototype.getId=function(){return this.id};t.prototype.getFlags=function(){return this.flags};t.prototype.updateVisibility=function(){var t=this.geomItem.getVisible()&&!this.culled;this.visible!=t&&(this.visible=t,this.visibilityChanged.emit(t),this.updated.emit())};t.prototype.setCullState=function(t){this.culled=t,this.updateVisibility()};t.prototype.updateGeomMatrix=function(){this.modelMatrixArray=this.geomItem.getGeomMat4().asArray()};t.prototype.getGeomMatrixArray=function(){return this.modelMatrixArray};t.prototype.bind=function(t){var e=this.gl,a=t.unifs;if(!e.floatTexturesSupported){var i=a.modelMatrix;i&&e.uniformMatrix4fv(i.location,!1,this.modelMatrixArray);var n=a.drawItemData;n&&e.uniform4f(n.location,this.geomData)}var r=a.transformIndex;if(r&&e.uniform1i(r.location,this.id),t.lightmaps&&a.lightmap&&t.boundLightmap!=this.lightmapName){var o=t.lightmaps[this.lightmapName];o&&o.glimage.isLoaded()?(o.glimage.bindToUniform(t,a.lightmap),e.uniform2fv(a.lightmapSize.location,o.atlasSize.asArray()),a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!0),t.boundLightmap=this.lightmapName):a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!1)}return!0};t.prototype.destroy=function(){this.geomItem.visibilityChanged.disconnect(this.updateVisibility),this.geomItem.geomXfoChanged.disconnect(this.updateXfo),this.geomItem.highlightChanged.disconnectId(this.highlightChangedId)};return t}();var Hd=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__drawItems=[void 0],e.__drawItemsIndexFreeList=[],e.__dirtyItemIndices=[];return e}e.prototype.init=function(e,a){var i=this;t.prototype.init.call(this,e,a),this.__renderer.registerPass((function(t){if(t instanceof Yl){if(t.getMetadata("glgeomItem"))return!1;{var e=function(e){return!!i.filterGeomItem(e)&&(null==t.getGeometry()?t.geomAssigned.connect((function(){i.addGeomItem(e)})):i.addGeomItem(e),!0)};return null==t.getMaterial()?(console.warn("Scene item :"+t.getPath()+" has no material"),!1):e(t)}}return!1}),(function(t){return!!(t instanceof Yl&&t.getMetadata("glgeomItem"))&&i.removeGeomItem(t)}))};e.prototype.filterGeomItem=function(t){return!0};e.prototype.addShader=function(t){return this.__renderer.getOrCreateShader(t.getShaderName())};e.prototype.constructShaders=function(t){var e,a;var i=this.__renderer.getOrCreateShader(t);return i.constructor.getGeomDataShaderName()&&(e=this.__renderer.getOrCreateShader(i.constructor.getGeomDataShaderName())),i.constructor.getSelectedShaderName()&&(a=this.__renderer.getOrCreateShader(i.constructor.getSelectedShaderName())),{glshader:i,glgeomdatashader:e,glselectedshader:a}};e.prototype.addMaterial=function(t){var e=this;var a=t.getMetadata("glmaterial");if(a)return a;var i=this.__renderer.getOrCreateShader(t.getShaderName());return a=new Ts(this.__gl,t,i),a.updated.connect((function(){e.__renderer.requestRedraw()})),t.setMetadata("glmaterial",a),a};e.prototype.addGeom=function(t){var e=t.getMetadata("glgeom");if(e)return e.addRef(this),e;var a=this.__gl;if(t instanceof dl||t instanceof ml)e=new ps(a,t);else if(t instanceof sl||t instanceof hl)e=new fs(a,t);else{if(!(t instanceof ll||t instanceof ul))throw new Error("Unsupported geom type:"+t.constructor.name);e=new bs(a,t)}return t.setMetadata("glgeom",e),e.addRef(this),e};e.prototype.removeGeom=function(t){var e=t.getMetadata("glgeom");if(e)return e.removeRef(this),e};e.prototype.addGeomItem=function(t){var e=this;var a=this.addGeom(t.getGeometry());var i;this.__drawItemsIndexFreeList.length>0?i=this.__drawItemsIndexFreeList.pop():(i=this.__drawItems.length,this.__drawItems.push(null)),this.__dirtyItemIndices.push(i);var n=this.__gl,r=new Ed(n,t,a,i,1);t.setMetadata("glgeomItem",r);r.updated.connect((function(t){switch(t){case zd:if(-1!=e.__dirtyItemIndices.indexOf(i))return;e.__dirtyItemIndices.push(i);break;case Ud:case Jd:break;case Pd:if(-1!=e.__dirtyItemIndices.indexOf(i))return;return e.__dirtyItemIndices.push(i),void e.__renderer.requestRedraw()}e.__renderer.drawItemChanged()}));return this.__drawItems[i]=r,this.__renderer.requestRedraw(),t.setMetadata("glpass",this),r};e.prototype.removeGeomItem=function(t){if(t.getMetadata("glpass")!=this)return;var e=t.getMetadata("glgeomItem"),a=e.getId();return this.__drawItems[a]=null,this.__drawItemsIndexFreeList.push(a),this.__renderer.requestRedraw(),t.getMetadata("glpass"),t.deleteMetadata("glgeomItem"),e};e.prototype.removeGLGeom=function(t,e){var a=e.geomItemMappings.indexOf(t);e.geomItemMappings.splice(a,1)};e.prototype.getGeomItem=function(t){if(!(t>=this.__drawItems.length))return this.__drawItems[t];console.warn("Invalid Draw Item id:"+t+" NumItems:"+(this.__drawItems.length-1))};e.prototype.__populateDrawItemDataArray=function(t,e,a){var i=24*e;var n=0;if(t.isCutawayEnabled()){n|=1}var r=t.getLightmapCoordsOffset();On.createFromFloat32Buffer(a.buffer,i+0).set(n,0,r.x,r.y);var o=t.getGeomMat4(),l=On.createFromFloat32Buffer(a.buffer,i+4),s=On.createFromFloat32Buffer(a.buffer,i+8),d=On.createFromFloat32Buffer(a.buffer,i+12);l.set(o.xAxis.x,o.yAxis.x,o.zAxis.x,o.translation.x),s.set(o.xAxis.y,o.yAxis.y,o.zAxis.y,o.translation.y),d.set(o.xAxis.z,o.yAxis.z,o.zAxis.z,o.translation.z);var c=On.createFromFloat32Buffer(a.buffer,i+16);if(t.isHighlighted()){var u=t.getHighlight();c.set(u.r,u.g,u.b,u.a)}var h=On.createFromFloat32Buffer(a.buffer,i+20);if(t.isCutawayEnabled()){var m=t.getCutVector(),p=t.getCutDist();h.set(m.x,m.y,m.z,p)}};e.prototype.newItemsReadyForLoading=function(){return this.__dirtyItemIndices.length>0};e.prototype.uploadGeomItems=function(){var t=this.__gl;if(!t.floatTexturesSupported){var e=this.__dirtyItemIndices.length;for(var a=0;a<e;a++){var i=this.__drawItems[this.__dirtyItemIndices[a]];i&&i.updateGeomMatrix()}return void(this.__dirtyItemIndices=[])}var n=Math.round(Math.sqrt(6*this.__drawItems.length)+.5);n=Math.nextPow2(n),n%6!=0&&(n+=6-n%6),this.__drawItemsTexture?this.__drawItemsTexture.width!=n&&(this.__drawItemsTexture.resize(n,n),this.__dirtyItemIndices=Array(n*n/6).fill().map((function(t,e){return e}))):(this.__drawItemsTexture=new ds(t,{format:"RGBA",type:"FLOAT",width:n,height:n,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),this.__drawItemsTexture.clear()),t.bindTexture(t.TEXTURE_2D,this.__drawItemsTexture.glTex);var r=this.__drawItemsTexture.getTypeID();for(var o=0;o<this.__dirtyItemIndices.length;o++){var l=this.__dirtyItemIndices[o],s=Math.floor(6*l/n);var d=l+1;for(var c=o+1;c<this.__dirtyItemIndices.length;c++){var u=this.__dirtyItemIndices[c];if(Math.floor(6*u/n)!=s)break;if(u!=d)break;d++}var h=d-l,m=6*l%n,p=6*h,f=1,b=new Float32Array(24*h);for(var y=l;y<d;y++){var g=this.__drawItems[y];g&&this.__populateDrawItemDataArray(g.getGeomItem(),y-l,b)}if(r==t.FLOAT)this.__drawItemsTexture.populate(b,p,f,m,s,!1);else{var _=Math.convertFloat32ArrayToUInt16Array(b);this.__drawItemsTexture.populate(_,p,f,m,s,!1)}o+=h-1}this.__dirtyItemIndices=[]};e.prototype.finalize=function(){0!=this.__dirtyItemIndices.length&&this.uploadGeomItems()};e.prototype.bind=function(t){var e=this.__gl,a=t.unifs;return this.__drawItemsTexture&&a.instancesTexture&&(this.__drawItemsTexture.bindToUniform(t,a.instancesTexture),e.uniform1i(a.instancesTextureSize.location,this.__drawItemsTexture.width)),!0};e.prototype.bindShader=function(t,e){return!!e.bind(t)&&!!this.bind(t)};e.prototype.bindMaterial=function(t,e,a){return e.bind(t,a)};return e}(ld);var kd=function(){function t(t,e){this.gl=t,this.glgeom=e,this.glgeomItems=[],this.glgeomItems_freeIndices=[],this.glgeomItemSignalIds=[],this.drawIdsArray=null,this.drawIdsBuffer=null,this.drawIdsBufferDirty=!0,this.highlightedIdsArray=null,this.highlightedIdsBuffer=null,this.highlightedIdsBufferDirty=!0,this.lightmapName=void 0,this.drawCountChanged=new dr,this.visibleItems=[],this.highlightedItems=[]}t.prototype.getGLGeom=function(){return this.glgeom};t.prototype.getLightmapName=function(){return this.lightmapName};t.prototype.getDrawCount=function(){return this.visibleItems.length};t.prototype.addGeomItem=function(t){var e=this;var a;this.glgeomItems_freeIndices.length>0?a=this.glgeomItems_freeIndices.pop():(a=this.glgeomItems.length,this.glgeomItems.push(null)),t.visible&&(this.visibleItems.push(a),this.drawCountChanged.emit(1)),t.getGeomItem().isHighlighted()&&(this.highlightedItems.push(a),this.highlightedIdsBufferDirty=!0),1==this.glgeomItems.length&&(this.lightmapName=t.getGeomItem().getLightmapName());var i={};i.sel=t.highlightChanged.connect((function(){if(t.getGeomItem().isHighlighted()){if(-1!=e.highlightedItems.indexOf(a))return;e.highlightedItems.push(a)}else e.highlightedItems.splice(e.highlightedItems.indexOf(a),1);e.highlightedIdsBufferDirty=!0})),i.vis=t.visibilityChanged.connect((function(t){t?(e.visibleItems.push(a),e.drawCountChanged.emit(1)):(e.visibleItems.splice(e.visibleItems.indexOf(a),1),e.drawCountChanged.emit(-1)),e.drawIdsBufferDirty=!0})),this.glgeomItems[a]=t,this.glgeomItemSignalIds[a]=i,this.drawIdsBufferDirty=!0};t.prototype.removeGeomItem=function(t){var e=this.glgeomItems.indexOf(t),a=this.glgeomItemSignalIds[e];t.highlightChanged.disconnectId(a.sel),t.visibilityChanged.disconnectId(a.vis),this.glgeomItems[e]=null,this.glgeomItemSignalIds[e]=null,this.glgeomItems_freeIndices.push(e),t.visible&&(this.visibleItems.splice(this.visibleItems.indexOf(e),1),this.drawCountChanged.emit(-1)),t.getGeomItem().isHighlighted()&&this.highlightedItems.splice(this.highlightedItems.indexOf(e),1),this.drawIdsBufferDirty=!0,0==this.glgeomItems.length&&this.destroy()};t.prototype.updateDrawIDsBuffer=function(){var t=this;var e=this.gl;e.floatTexturesSupported?(this.drawIdsBuffer&&this.glgeomItems.length!=this.drawIdsArray.length&&(this.gl.deleteBuffer(this.drawIdsBuffer),this.drawIdsBuffer=null),this.drawIdsBuffer||(this.drawIdsArray=new Float32Array(this.glgeomItems.length),this.drawIdsBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.drawIdsBuffer)),this.visibleItems.forEach((function(e,a){t.drawIdsArray[a]=t.glgeomItems[e].getId()})),e.bindBuffer(e.ARRAY_BUFFER,this.drawIdsBuffer),e.bufferData(e.ARRAY_BUFFER,this.drawIdsArray,e.STATIC_DRAW),this.drawIdsBufferDirty=!1):this.drawIdsBufferDirty=!1};t.prototype.updateHighlightedIDsBuffer=function(){var t=this;var e=this.gl;e.floatTexturesSupported?(this.highlightedIdsBuffer&&this.glgeomItems.length!=this.highlightedIdsArray.length&&(this.gl.deleteBuffer(this.highlightedIdsBuffer),this.highlightedIdsBuffer=null),(!this.highlightedIdsArray||this.highlightedItems.length>this.highlightedIdsArray.length)&&(this.highlightedIdsArray=new Float32Array(this.highlightedItems.length),this.highlightedIdsBuffer&&(e.deleteBuffer(this.highlightedIdsBuffer),this.highlightedIdsBuffer=null)),this.highlightedItems.forEach((function(e,a){t.highlightedIdsArray[a]=t.glgeomItems[e].getId()})),this.highlightedIdsBuffer||(this.highlightedIdsBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.highlightedIdsBuffer),e.bufferData(e.ARRAY_BUFFER,this.highlightedIdsArray,e.STATIC_DRAW),this.highlightedIdsBufferDirty=!1):this.highlightedIdsBufferDirty=!1};t.prototype.draw=function(t){if(0==this.visibleItems.length)return;this.drawIdsBufferDirty&&this.updateDrawIDsBuffer();var e=this.gl,a=t.unifs;if(t.lightmaps&&a.lightmap&&t.boundLightmap!=this.lightmapName){var i=t.lightmaps[this.lightmapName];i&&i.glimage.isLoaded()?(i.glimage.bindToUniform(t,a.lightmap),e.uniform2fv(a.lightmapSize.location,i.atlasSize.asArray()),a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!0),t.boundLightmap=this.lightmapName):a.lightmapConnected&&e.uniform1i(a.lightmapConnected.location,!1)}this.__bindAndRender(t,this.visibleItems,this.drawIdsBuffer)};t.prototype.drawHighlighted=function(t){0!=this.highlightedItems.length&&(this.highlightedIdsBufferDirty&&this.updateHighlightedIDsBuffer(),this.__bindAndRender(t,this.highlightedItems,this.highlightedIdsBuffer))};t.prototype.__bindAndRender=function(t,e,a){var i=this;var n=this.gl,r=t.unifs;if(t.glgeom!=this.glgeom&&(this.glgeom.bind(t),t.glgeom=this.glgeom),n.floatTexturesSupported&&n.drawElementsInstanced&&t.supportsInstancing){n.uniform1i(t.unifs.instancedDraw.location,1);var o=t.attrs.instancedIds.location;n.enableVertexAttribArray(o),n.bindBuffer(n.ARRAY_BUFFER,a),n.vertexAttribPointer(o,1,n.FLOAT,!1,4,0),n.vertexAttribDivisor(o,1),t.bindViewports(r,(function(){i.glgeom.drawInstanced(e.length)}))}else t.unifs.instancedDraw&&n.uniform1i(t.unifs.instancedDraw.location,0),e.forEach((function(e){i.glgeomItems[e].bind(t),t.bindViewports(r,(function(){i.glgeom.draw(t)}))}))};t.prototype.destroy=function(){};return t}();var Bd=function(){function t(t){this.glshader=t.glshader,this.glgeomdatashader=t.glgeomdatashader,this.glselectedshader=t.glselectedshader,this.glmaterialGeomItemSets=[]}t.prototype.findMaterialGeomItemSets=function(t){for(var e=0,a=this.glmaterialGeomItemSets;e<a.length;e++){var i=a[e];if(i.glmaterial==t)return i}};t.prototype.addMaterialGeomItemSets=function(t){this.glmaterialGeomItemSets.push(t)};t.prototype.removeMaterialGeomItemSets=function(t){var e=this.glmaterialGeomItemSets.indexOf(t);this.glmaterialGeomItemSets.splice(e,1)};t.prototype.getMaterialGeomItemSets=function(){return this.glmaterialGeomItemSets};return t}();var Dd=function(){function t(t){this.glmaterial=t,this.geomItemSets=[],this.drawCount=0,this.visibleInGeomDataBuffer=t.getMaterial().visibleInGeomDataBuffer,this.__drawCountChanged=this.__drawCountChanged.bind(this)}t.prototype.getGLMaterial=function(){return this.glmaterial};t.prototype.__drawCountChanged=function(t){this.drawCount+=t};t.prototype.addGeomItemSet=function(t){-1==this.geomItemSets.indexOf(t)?(this.geomItemSets.push(t),this.drawCount+=t.drawCount,t.drawCountChanged.connect(this.__drawCountChanged)):console.warn("geomItemSet already added to GLMaterialGeomItemSets")};t.prototype.removeGeomItemSet=function(t){var e=this.geomItemSets.indexOf(t);this.geomItemSets.splice(e,1),t.drawCountChanged.disconnect(this.__drawCountChanged),t.destroy()};t.prototype.findGeomItemSet=function(t){for(var e=0,a=this.geomItemSets;e<a.length;e++){var i=a[e];if(i.getGLGeom()==t)return i}return null};t.prototype.getGeomItemSets=function(){return this.geomItemSets};return t}();var Od=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__glshadermaterials={};return e}e.prototype.init=function(e,a){t.prototype.init.call(this,e,a)};e.prototype.filterGeomItem=function(t){var e=t.getMaterial().getShaderClass();if(e){if(e.isTransparent())return!1;if(e.isOverlay())return!1;var a=t.getMaterial().getParameter("BaseColor");return!(a&&a.getValue().a<1)}return!1};e.prototype.addGeomItem=function(e){var a=e.getMaterial(),i=a.getShaderName(),n=this.constructShaders(i);var r=this.addMaterial(a),o=t.prototype.addGeomItem.call(this,e);var l=this.__glshadermaterials[i];l||(l=new Bd(n),this.__glshadermaterials[i]=l);var s=l.findMaterialGeomItemSets(r);s||(s=new Dd(r),l.addMaterialGeomItemSets(s));var d=s.findGeomItemSet(o.glGeom);return d||(d=new kd(this.__gl,o.glGeom),s.addGeomItemSet(d)),e.setMetadata("geomItemSet",d),d.addGeomItem(o),!0};e.prototype.removeGeomItem=function(e){var a=t.prototype.removeGeomItem.call(this,e);if(!a)return!1;var i=e.getMetadata("geomItemSet");return i&&(i.removeGeomItem(a),e.deleteMetadata("geomItemSet")),!0};e.prototype.removeMaterial=function(t){var e=this.__glshadermaterials[t.hash];if(!e||e!=t.getMetadata("glshaderMaterials"))return void console.warn("Material not found in pass");var a=t.getMetadata("glmaterialGeomItemSets");e.removeMaterialGeomItemSets(a)};e.prototype.__traverseTreeAndDraw=function(t){for(var e in this.__glshadermaterials){var a=this.__glshadermaterials[e],i=a.glshader;if(this.bindShader(t,i)){var n=a.getMaterialGeomItemSets();for(var r=0,o=n;r<o.length;r++){var l=o[r];if(0!=l.drawCount&&this.bindMaterial(t,l.getGLMaterial(),!0)){var s=l.getGeomItemSets();for(var d=0,c=s;d<c.length;d++){var u=c[d];u.draw(t)}}}}i.unbind(t)}t.glgeom&&t.glgeom.unbind(t)};e.prototype.draw=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0),this.__traverseTreeAndDraw(t)};e.prototype.drawHighlightedGeoms=function(t){var e=this.__gl;e.disable(e.CULL_FACE);for(var a in this.__glshadermaterials){var i=this.__glshadermaterials[a];if(!i.glselectedshader)continue;if(!this.bindShader(t,i.glselectedshader))continue;var n=i.getMaterialGeomItemSets();for(var r=0,o=n;r<o.length;r++){var l=o[r];var s=l.getGeomItemSets();for(var d=0,c=s;d<c.length;d++){var u=c[d];u.drawHighlighted(t)}}}t.glgeom&&t.glgeom.unbind(t)};e.prototype.getGeomItemAndDist=function(t){var e,a;this.__gl.floatGeomBuffer?(e=Math.round(t[1]),a=t[3]):(e=t[0]+(t[1]<<8),a=Math.decode16BitFloatFrom2xUInt8([t[2],t[3]]));var i=this.__drawItems[e];if(i)return{geomItem:i.getGeomItem(),dist:a}};e.prototype.drawGeomData=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0);for(var a in this.__glshadermaterials){var i=this.__glshadermaterials[a];if(!i.glgeomdatashader)continue;if(!this.bindShader(t,i.glgeomdatashader))continue;{var n=t.unifs.floatGeomBuffer;n&&e.uniform1i(n.location,e.floatGeomBuffer?1:0)}{var r=t.unifs.passId;r&&e.uniform1i(r.location,this.__passIndex)}var o=i.getMaterialGeomItemSets();for(var l=0,s=o;l<s.length;l++){var d=s[l];if(0!=d.drawCount&&d.visibleInGeomDataBuffer&&this.bindMaterial(t,d.getGLMaterial(),!1)){var c=d.getGeomItemSets();for(var u=0,h=c;u<h.length;u++){var m=h[u];m.draw(t)}}}}t.glgeom&&t.glgeom.unbind(t)};return e}(Hd);cd.registerPass(Od,od.OPAQUE);var Qd=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.init=function(e,a){t.prototype.init.call(this,e,a),this.transparentItems=[],this.freeList=[],this.visibleItems=[],this.prevSortCameraPos=new Dn(999,999,999),this.resort=!1};e.prototype.filterGeomItem=function(t){var e=t.getMaterial().getShaderClass();if(e){if(e.isTransparent())return!0;if(e.isOverlay())return!1;var a=t.getMaterial().getParameter("BaseColor");if(a&&a.getValue().a<.999)return!0}return!1};e.prototype.addGeomItem=function(e){var a=this;var i=e.getMaterial(),n=i.getShaderName(),r=this.constructShaders(n),o=this.addMaterial(i),l=t.prototype.addGeomItem.call(this,e),s=e.visibilityChanged.connect((function(t){if(t)a.visibleItems.push(c);else{var e=a.visibleItems.indexOf(c);a.visibleItems.splice(e,1)}})),d=e.geomXfoChanged.connect((function(){a.resort=!0})),c={geomItem:e,shaders:r,glmaterial:o,glgeomitem:l,visibilityChangedId:s,geomXfoChangedId:d};var u;u=this.freeList.length>0?this.freeList.pop():this.transparentItems.length,this.transparentItems[u]=c,e.setMetadata("itemIndex",u),e.getVisible()&&this.visibleItems.push(c),this.resort=!0};e.prototype.removeGeomItem=function(e){if(!t.prototype.removeGeomItem.call(this,e))return;var a=e.getMetadata("itemIndex"),i=this.transparentItems[a];this.transparentItems[a]=null,this.freeList.push(a);var n=this.visibleItems.indexOf(i);-1!=n&&this.visibleItems.splice(n,1)};e.prototype.sortItems=function(t){for(var e=0,a=this.visibleItems;e<a.length;e++){var i=a[e];var n=i.glgeomitem.geomItem.getGeomMat4();i.dist=n.translation.distanceTo(t)}this.visibleItems.sort((function(t,e){return t.dist>e.dist?-1:t.dist<e.dist?1:0})),this.prevSortCameraPos=t,this.resort=!1};e.prototype._drawItem=function(t,e,a){if(a.currentglMaterial!=e.glmaterial&&(a.currentglMaterial=e.glmaterial,!a.currentglMaterial.bind(t)))return;var i=e.glgeomitem;if((a.currentglGeom==i.glGeom||(a.currentglGeom=i.glGeom,a.currentglGeom.bind(t)))&&i.bind(t)){if(t.unifs.instancedDraw){var n=this.__gl;n.uniform1i(t.unifs.instancedDraw.location,0),n.disableVertexAttribArray(t.attrs.instancedIds.location)}t.bindViewports(t.unifs,(function(){a.currentglGeom.draw(t)}))}};e.prototype._drawItems=function(t){var e={currentglShader:null,currentglMaterial:null,currentglGeom:null};for(var a=0,i=this.visibleItems;a<i.length;a++){var n=i[a];if(e.currentglShader!=n.shaders.glshader){if(!this.bindShader(t,n.shaders.glshader))continue;e.currentglShader=n.shaders.glshader}this._drawItem(t,n,e)}e.currentglGeom&&e.currentglGeom.unbind(t)};e.prototype.draw=function(t){if(0==this.visibleItems.length)return;this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl,a=t.viewXfo.tr;(this.resort||a.distanceTo(this.prevSortCameraPos)>.3)&&this.sortItems(a),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),t.pass="MULTIPLY",e.blendFunc(e.DST_COLOR,e.ZERO),this._drawItems(t),t.pass="ADD",e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this._drawItems(t),e.disable(e.BLEND)};e.prototype.drawHighlightedGeoms=function(t){var e=this.__gl;e.disable(e.CULL_FACE);var a={currentglShader:null,currentglMaterial:null,currentglGeom:null};for(var i=0,n=this.visibleItems;i<n.length;i++){var r=n[i];if(!r.geomItem.isHighlighted())continue;if(!r.shaders.glselectedshader)continue;var o=r.shaders;if(a.currentglShader!=o.glselectedshader){if(!this.bindShader(t,o.glselectedshader))continue;a.currentglShader=o.glselectedshader}this._drawItem(t,r,a)}a.currentglGeom&&a.currentglGeom.unbind(t)};e.prototype.getGeomItemAndDist=function(t){var e,a;this.__gl.floatGeomBuffer?(e=Math.round(t[1]),a=t[3]):(e=t[0]+(t[1]<<8),a=Math.decode16BitFloatFrom2xUInt8([t[2],t[3]]));var i=this.__drawItems[e];if(i)return{geomItem:i.getGeomItem(),dist:a}};e.prototype.drawGeomData=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0);var a={currentglShader:null,currentglMaterial:null,currentglGeom:null};for(var i=0,n=this.visibleItems;i<n.length;i++){var r=n[i];var o=r.shaders;if(a.currentglShader!=o.glgeomdatashader){if(!this.bindShader(t,o.glgeomdatashader))continue;a.currentglShader=o.glgeomdatashader}{var l=t.unifs.floatGeomBuffer;l&&e.uniform1i(l.location,e.floatGeomBuffer?1:0)}{var s=t.unifs.passId;s&&e.uniform1i(s.location,this.__passIndex)}this._drawItem(t,r,a)}a.currentglGeom&&a.currentglGeom.unbind(t)};return e}(Hd);cd.registerPass(Qd,od.TRANSPARENT);var Ad=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.init=function(e,a){var i=this;t.prototype.init.call(this,e,a),this.__billboards=[],this.__freeIndices=[],this.__drawCount=0,this.__threshold=0,this.__updateRequested=!1,this.__prevSortCameraPos=new Dn,this.__atlas=new Ks(this.__renderer.gl,"Billboards","RGBA","UNSIGNED_BYTE",[1,1,1,0]),this.__atlas.loaded.connect(this.updated.emit),this.__atlas.updated.connect(this.updated.emit),this.__renderer.registerPass((function(t){return t instanceof Pl&&(i.addBillboard(t),!0)}),(function(t){return t instanceof Pl&&(i.removeBillboard(t),!0)}))};e.prototype.filterRenderTree=function(){};e.prototype.addBillboard=function(t){var e=this;var a=t.getParameter("Image"),i=a.getValue();if(!i)return void a.valueChanged.connect((function(){return e.addBillboard(t)}));var n;n=this.__freeIndices.length>0?this.__freeIndices.pop():this.__billboards.length;var r=this.__atlas.addSubImage(i);t.setMetadata("GLBillboardsPass_Index",n);var o=t.visibilityChanged.connect((function(){t.getVisible()?(e.__drawCount++,e.__updateBillboard(n)):e.__drawCount--,e.__reqUpdateIndexArray()})),l=t.getParameter("GlobalXfo").valueChanged.connect((function(){t.getVisible()&&(e.__updateBillboard(n),e.updated.emit())})),s=t.getParameter("Alpha").valueChanged.connect((function(){t.getVisible()&&(e.__updateBillboard(n),e.updated.emit())}));t.getVisible()&&this.__drawCount++,this.__billboards[n]={billboard:t,imageIndex:r,visibilityChangedId:o,xfoChangedId:l,alphaChangedId:s},this.indexArrayUpdateNeeded=!0,this.__requestUpdate()};e.prototype.removeBillboard=function(t){var e=t.getMetadata("GLBillboardsPass_Index");if(-1==e)return void console.warn("Billboard already removed.");var a=this.__billboards[e],i=a.billboard.getParameter("Image").getValue();this.__atlas.removeSubImage(i),t.visibilityChanged.disconnectId(a.visibilityChangedId),t.getParameter("GlobalXfo").valueChanged.disconnectId(a.xfoChangedId),t.getParameter("Alpha").valueChanged.disconnectId(a.alphaChangedId),this.__billboards[e]=null,this.__freeIndices.push(e),t.getVisible()&&this.__drawCount--,this.indexArrayUpdateNeeded=!0,this.__requestUpdate()};e.prototype.__populateBillboardDataArray=function(t,e,a){var i=t.billboard,n=i.getGlobalXfo().toMat4(),r=1/i.getParameter("PixelsPerMeter").getValue();var o=0;i.getParameter("AlignedToCamera").getValue()&&(o|=4);var l=i.getParameter("Alpha").getValue(),s=i.getParameter("Color").getValue(),d=5*e*4,c=On.createFromFloat32Buffer(a.buffer,d),u=On.createFromFloat32Buffer(a.buffer,d+4),h=On.createFromFloat32Buffer(a.buffer,d+8),m=On.createFromFloat32Buffer(a.buffer,d+12);c.set(n.xAxis.x,n.yAxis.x,n.zAxis.x,n.translation.x),u.set(n.xAxis.y,n.yAxis.y,n.zAxis.y,n.translation.y),h.set(n.xAxis.z,n.yAxis.z,n.zAxis.z,n.translation.z),m.set(r,o,t.imageIndex,l),On.createFromFloat32Buffer(a.buffer,d+16).set(s.r,s.g,s.b,s.a)};e.prototype.__requestUpdate=function(){var t=this;this.__updateRequested||(this.__updateRequested=!0,setTimeout((function(){t.__updateBillboards()}),100))};e.prototype.__reqUpdateIndexArray=function(){var t=this;this.indexArrayUpdateNeeded||(this.indexArrayUpdateNeeded=!0,this.updateIndexArrayId=setTimeout((function(){t.indexArrayUpdateNeeded&&(t.__updateIndexArray(),t.updated.emit())}),1))};e.prototype.__updateIndexArray=function(){var t=this.__gl;this.__indexArray&&this.__indexArray.length!=this.__drawCount&&(t.deleteBuffer(this.__instanceIdsBuffer),this.__instanceIdsBuffer=null),this.__indexArray=new Float32Array(this.__drawCount);var e=0;for(var a=0;a<this.__billboards.length;a++)this.__billboards[a]&&this.__billboards[a].billboard.getVisible()&&(this.__indexArray[e]=a,e++);this.__instanceIdsBuffer||(this.__instanceIdsBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.__instanceIdsBuffer),t.bufferData(t.ARRAY_BUFFER,this.__indexArray,t.STATIC_DRAW),this.indexArrayUpdateNeeded=!1};e.prototype.__updateBillboards=function(){var t=this;var e=function(){t.indexArrayUpdateNeeded&&t.__updateIndexArray();var e=t.__gl;if(!t.__glshader){e.__quadVertexIdsBuffer||e.setupInstancedQuad(),t.__glshader=new ud(e);var a=t.__glshader.compileForTarget("GLBillboardsPass",t.__renderer.getShaderPreproc());t.__shaderBinding=hs(e,a.attrs,e.__quadattrbuffers,e.__quadIndexBuffer)}if(t.__atlas.renderAtlas(),!e.floatTexturesSupported||!e.drawElementsInstanced)return t.__modelMatrixArray=[],t.__billboardDataArray=[],t.__tintColorArray=[],t.__indexArray.forEach((function(e){var a=t.__billboards[e],i=a.billboard,n=i.getGlobalXfo().toMat4(),r=1/i.getParameter("PixelsPerMeter").getValue();var o=0;i.getParameter("AlignedToCamera").getValue()&&(o|=4);var l=i.getParameter("Alpha").getValue(),s=i.getParameter("Color").getValue();t.__modelMatrixArray[e]=n.asArray(),t.__billboardDataArray[e]=[r,o,a.imageIndex,l],t.__tintColorArray[e]=[s.r,s.g,s.b,s.a]})),void(t.__updateRequested=!1);var i=Math.round(Math.sqrt(5*(t.__billboards.length-t.__freeIndices.length))+.5);i%5!=0&&(i+=5-i%5),t.__width=i,t.__drawItemsTexture?t.__drawItemsTexture.resize(i,i):(t.__drawItemsTexture=new ds(e,{format:"RGBA",type:"FLOAT",width:i,height:i,filter:"NEAREST",wrap:"CLAMP_TO_EDGE",mipMapped:!1}),t.__drawItemsTexture.clear()),t.__indexArray.forEach((function(e){-1!=e&&t.__updateBillboard(e)})),t.__updateRequested=!1};this.__atlas.isLoaded()?e():this.__atlas.loaded.connect(e)};e.prototype.__updateBillboard=function(t){if(0==this.__drawCount||!this.__drawItemsTexture)return;var e=this.__billboards[t];if(!e.billboard.getVisible())return;var a=this.__gl,i=new Float32Array(20);this.__populateBillboardDataArray(e,0,i),a.bindTexture(a.TEXTURE_2D,this.__drawItemsTexture.glTex);var n=5*t%this.__width,r=Math.floor(5*t/this.__width),o=this.__drawItemsTexture.getType(),l=this.__drawItemsTexture.getFormat();if("FLOAT"==o)a.texSubImage2D(a.TEXTURE_2D,0,n,r,5,1,a[l],a[o],i);else{var s=Math.convertFloat32ArrayToUInt16Array(i);a.texSubImage2D(a.TEXTURE_2D,0,n,r,5,1,a[l],a[o],s)}};e.prototype.sort=function(t){var e=this;for(var a=0,i=this.__billboards;a<i.length;a++){var n=i[a];n&&n.billboard.getVisible()&&(n.dist=n.billboard.getGlobalXfo().tr.distanceTo(t))}this.__indexArray.sort((function(t,a){return-1==t?1:-1==a||e.__billboards[t].dist>e.__billboards[a].dist?-1:e.__billboards[t].dist<e.__billboards[a].dist?1:0}));var r=this.__gl;r.floatTexturesSupported&&this.__instanceIdsBuffer&&(r.bindBuffer(r.ARRAY_BUFFER,this.__instanceIdsBuffer),r.bufferData(r.ARRAY_BUFFER,this.__indexArray,r.STATIC_DRAW))};e.prototype.draw=function(t){var e=this;if(0==this.__drawCount||!this.__atlas.isReady()||this.__updateRequested)return;this.indexArrayUpdateNeeded&&this.__updateIndexArray();var a=this.__gl;a.disable(a.CULL_FACE),a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);var i=t.viewXfo.tr;if(i.distanceTo(this.__prevSortCameraPos)>this.__threshold)if(this.sort(i),this.__prevSortCameraPos=i.clone(),this.__drawCount>1){var n=this.__billboards[this.__indexArray[0]].billboard.getGlobalXfo().tr,r=this.__billboards[this.__indexArray[1]].billboard.getGlobalXfo().tr;this.__threshold=n.distanceTo(r)}else this.__threshold=9999;this.__glshader.bind(t),this.__shaderBinding.bind(t);var o=t.unifs;if(this.__atlas.bindToUniform(t,o.atlasBillboards),a.floatTexturesSupported&&a.drawElementsInstanced){this.__drawItemsTexture.bindToUniform(t,o.instancesTexture),a.uniform1i(o.instancesTextureSize.location,this.__width);{var l=t.attrs.instanceIds.location;a.enableVertexAttribArray(l),a.bindBuffer(a.ARRAY_BUFFER,this.__instanceIdsBuffer),a.vertexAttribPointer(l,1,a.FLOAT,!1,4,0),a.vertexAttribDivisor(l,1)}t.bindViewports(o,(function(){a.drawElementsInstanced(a.TRIANGLES,6,a.UNSIGNED_SHORT,0,e.__drawCount)}))}else{var s=this.__indexArray.length;for(var d=0;d<s;d++)a.uniformMatrix4fv(o.modelMatrix.location,!1,this.__modelMatrixArray[d]),a.uniform4fv(o.billboardData.location,this.__billboardDataArray[d]),a.uniform4fv(o.tintColor.location,this.__tintColorArray[d]),a.uniform4fv(o.layoutData.location,this.__atlas.getLayoutData(this.__billboards[d].imageIndex)),t.bindViewports(o,(function(){a.drawQuad()}))}a.disable(a.BLEND)};return e}(ld);cd.registerPass(Ad,od.TRANSPARENT);var jd=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.init=function(e,a){t.prototype.init.call(this,e,a)};e.prototype.filterGeomItem=function(t){if(t.isOverlay())return!0;var e=t.getMaterial().getShaderClass();return!(!e||!e.isOverlay())};e.prototype.draw=function(t){this.newItemsReadyForLoading()&&this.finalize();var e=this.__gl;e.clear(e.DEPTH_BUFFER_BIT),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),t.pass="ADD",e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.__traverseTreeAndDraw(t),e.disable(e.BLEND)};e.prototype.drawGeomData=function(e){var a=this.__gl;a.clear(a.DEPTH_BUFFER_BIT),a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),e.pass="ADD",a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),t.prototype.drawGeomData.call(this,e),a.disable(a.BLEND),a.enable(a.DEPTH_TEST)};return e}(Od);cd.registerPass(jd,od.OVERLAY);var qd=window.AudioContext||window.webkitAudioContext||!1;var $d;qd?$d=new qd:alert("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox");var tc=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__audioItems=[];return e}e.prototype.init=function(e,a){var i=this;t.prototype.init.call(this,e,a),$d&&this.__renderer.registerPass((function(t){if(t instanceof Fl)return t.audioSourceCreated.connect((function(e){i.addAudioSource(t,e,t)})),!0;if(t instanceof Yl){var e=t.getMaterial();if(e){var a=e.getParameter("BaseColor");if(a&&a.getImage&&a.getImage()){var n=a.getImage();n.loaded.connect((function(){if(n.getAudioSource){var e=n.getAudioSource();(e instanceof HTMLMediaElement||e instanceof AudioBufferSourceNode)&&i.addAudioSource(t,e,n)}}))}}return!1}}),(function(t){}))};e.prototype.addAudioSource=function(t,e,a){if(e.addedToCollector)return;var i;i=e instanceof HTMLMediaElement?$d.createMediaElementSource(e):e instanceof AudioBufferSourceNode?e:$d.createMediaStreamSource(e);var n=$d.createGain(),r=a.getParameter("Gain");var o,l;r&&(o=r,l=n.gain,o&&(l.setValueAtTime(o.getValue(),0),l.setValueAtTime(o.getValue(),5),o.valueChanged.connect((function(){l.value=o.getValue()})))),i.connect(n);var s=a.getParameter("SpatializeAudio");if(s&&0==s.getValue())i.connect($d.destination);else{var d=$d.createPanner();d.panningModel="HRTF",d.distanceModel="inverse",i.connect(d),d.connect($d.destination);var c=function(t){var e=a.getParameter(t);e&&(d[t]=e.getValue(),e.valueChanged.connect((function(){d[t]=e.getValue()})))};c("coneInnerAngle"),c("coneOuterAngle"),c("coneOuterGain");var u=function(){var e;e=t instanceof Yl?t.getGeomMat4():t.getGlobalXfo().toMat4();var a=e.translation;d.setPosition(a.x,a.y,a.z);var i=e.zAxis;d.setOrientation(i.x,i.y,i.z)};u(),t.globalXfoChanged.connect((function(t){u()}))}e.addedToCollector=!0,this.__audioItems.push({treeItem:t,audioSource:e,parameterOwner:a}),this.updated.emit()};e.prototype.__updateListenerPosition=function(t){if(!$d)return;var e=$d.listener;e.setPosition(t.tr.x,t.tr.y,t.tr.z);var a=t.ori.getYaxis(),i=t.ori.getZaxis().negate();e.setOrientation(i.x,i.y,i.z,a.x,a.y,a.z)};e.prototype.draw=function(t){0!=this.__audioItems.length&&this.__updateListenerPosition(t.viewXfo)};return e}(ld);cd.registerPass(tc,od.OVERLAY),window&&(window.ZeaAudioaudioCtx=$d);var ec=Object.freeze({__proto__:null,create3DContext:ss,GLTexture2D:ds,GLMesh:ps,GLLines:fs,GLPoints:bs,GLMaterial:Ts,GLShader:Zs,GLFbo:Xs,GLRenderTarget:Ms,GLRenderer:cd,GLBaseViewport:js,GLViewport:qs,shaderLibrary:gs,generateShaderGeomBinding:hs,BillboardShader:ud,ConvolverShader:ws,DepthMapShader:hd,EnvMapShader:Js,BackgroundImageShader:Ps,OctahedralEnvMapShader:Es,LatLongEnvMapShader:Hs,SterioLatLongEnvMapShader:ks,DualFishEyeEnvMapShader:Bs,DualFishEyeToLatLongBackgroundShader:Ds,EnvProjectionShader:md,OctahedralEnvProjectionShader:pd,LatLongEnvProjectionShader:fd,FatLinesShader:bd,FlatSurfaceShader:yd,FlatAlphaSurfaceShader:gd,LayeredCarPaintShader:_d,LinesShader:Gd,NormalsShader:Xd,PointsShader:vd,FatPointsShader:Vd,FatPointsGeomDataShader:Id,FatPointsSelectedShader:Rd,PostProcessing:xd,ScreenQuadShader:Qs,SimpleSurfaceShader:Sd,StandardSurfaceShader:Wd,StandardSurfaceGeomDataShader:Ld,StandardSurfaceSelectedGeomsShader:Td,HandleShader:Md,HandleGeomDataShader:Fd,TransparentSurfaceShader:Cd,ScreenSpaceShader:Nd,ToolIconShader:Yd,UnpackHDRShader:Gs,UnpackLDRAlphaImageShader:Kd,WireShader:wd,GLPass:ld,PassType:od,GLStandardGeomsPass:Hd,GLOpaqueGeomsPass:Od,GLTransparentGeomsPass:Qd,GLBillboardsPass:Ad,GLOverlayPass:jd,GLAudioItemsPass:tc,get audioCtx(){return $d},VRViewport:ed});var ac=function(){function t(t){this.__name=t||br.getClassName(this),this.__stateEvents=[],this.__activationActions=[],this.__deactivationActions=[]}t.prototype.getName=function(){return this.__name};t.prototype.setName=function(t){this.__name=t};t.prototype.setStateMachine=function(t){this.__stateMachine=t};t.prototype.getStateMachine=function(){return this.__stateMachine};t.prototype.activate=function(){this.__stateEvents.forEach((function(t){t.activate()})),this.__activationActions.forEach((function(t){t.activate()}))};t.prototype.deactivate=function(){this.__stateEvents.forEach((function(t){t.deactivate()})),this.__deactivationActions.forEach((function(t){t.activate()}))};t.prototype.addStateEvent=function(t){t.setState(this),this.__stateEvents.push(t)};t.prototype.getStateEvent=function(t){return this.__stateEvents[t]};t.prototype.addActivationAction=function(t){t.setState(this),this.__activationActions.push(t)};t.prototype.getActivationAction=function(t){return this.__activationActions[t]};t.prototype.addDeactivationAction=function(t){t.setState(this),this.__deactivationActions.push(t)};t.prototype.toJSON=function(t,e){var a={name:this.__name,type:br.getClassName(this)},i=[];for(var n=0,r=this.__stateEvents;n<r.length;n++){var o=r[n];i.push(o.toJSON(t,e))}a.stateEvents=i;var l=[];for(var s=0,d=this.__activationActions;s<d.length;s++){var c=d[s];l.push(c.toJSON(t,e))}a.activationActions=l;var u=[];for(var h=0,m=this.__deactivationActions;h<m.length;h++){var p=m[h];u.push(p.toJSON(t,e))}return a.deactivationActions=u,a};t.prototype.fromJSON=function(t,e,a){this.__name=t.name;for(var i=0,n=t.stateEvents;i<n.length;i++){var r=n[i];var o=br.constructClass(r.type);o.fromJSON(r,e),this.addStateEvent(o)}for(var l=0,s=t.activationActions;l<s.length;l++){var d=s[l];var c=br.constructClass(d.type);c.fromJSON(d,e),this.addActivationAction(c)}for(var u=0,h=t.deactivationActions;u<h.length;u++){var m=h[u];var p=br.constructClass(m.type);p.fromJSON(m,e),this.addDeactivationAction(p)}};return t}();br.registerClass("State",ac);var ic=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__name=e,a.__childActions=[],a.__outputs={};return a}e.prototype.addOutput=function(t){return this.__outputs[t.getName()]=t,t};e.prototype.getOutput=function(t){return this.__outputs[t]};e.prototype.setState=function(t){this.__state=t,this.__childActions.forEach((function(e){e.setState(t)}))};e.prototype.addChild=function(t){this.__childActions.push(t),t.setState(this.__state)};e.prototype.getChild=function(t){return this.__childActions[t]};e.prototype.activate=function(){console.warn("activate must be implmented by each action. this:"+br.getClassName(this))};e.prototype.addChild=function(t){this.__childActions.push(t),t.setState(this.__state)};e.prototype.deactivate=function(){};e.prototype.__onDone=function(){this.__childActions.forEach((function(t){t.activate()}))};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);i||(i={}),i.type=br.getClassName(this);var n=[];for(var r=0,o=this.__childActions;r<o.length;r++){var l=o[r];n.push(l.toJSON(e,a))}i.childActions=n;var s={};for(var d in this.__outputs)s[d]=this.__outputs[d].toJSON(e,a);return i.outputs=s,i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i);for(var n=0,r=e.childActions;n<r.length;n++){var o=r[n];var l=br.constructClass(o.type);if(!l)throw new Error("Invalid type:"+o.type);l.fromJSON(o,a),this.addChild(l)}for(var s in e.outputs)this.__outputs[s].fromJSON(e.outputs[s],a)};e.prototype.destroy=function(){t.prototype.destroy.call(this),this.__outputs=[]};return e}(Rr);var nc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,a.__name=e,a.__onEvent=a.__onEvent.bind(a);return a}e.prototype.__onEvent=function(){this.__childActions.forEach((function(t){t.activate()}))};return e}(ic);var rc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__states={},a.stateChanged=new dr,a.setFlag(xr.USER_EDITED),br.isConstructing()||br.invokeCallbacks(a);return a}e.prototype.addState=function(t){t.setStateMachine(this),this.__states[t.getName()]=t,1==Object.keys(this.__states).length&&null==this.__initialStateName&&(this.__initialStateName=t.getName())};e.prototype.getState=function(t){return this.__states[t]};e.prototype.activateState=function(t){if(!this.__states[t])throw new Error("Invalid state transtion:"+t);this.__currentState!=this.__states[t]&&(this.__currentState&&this.__currentState.deactivate(),this.__currentState=this.__states[t],this.__currentState.activate(),this.stateChanged.emit(t))};e.prototype.getActiveState=function(){return this.__currentState};e.prototype.getActiveStateName=function(){return br.getClassName(this.__currentState)};e.prototype.getInitialState=function(){return this.__initialStateName};e.prototype.setInitialState=function(t){this.__initialStateName=t};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);i.initialStateName=this.__initialStateName;var n={};for(var r in this.__states)n[r]=this.__states[r].toJSON(e,a);return i.states=n,i};e.prototype.fromJSON=function(e,a,i){t.prototype.fromJSON.call(this,e,a,i),this.__initialStateName=e.initialStateName,a.stateMachine=this;for(var n in e.states){var r=e.states[n],o=br.constructClass(r.type);if(!o)throw new Error("Invalid type:"+r.type);o.fromJSON(r,a),this.addState(o)}a.addPLCB((function(){}))};return e}(Wr);br.registerClass("StateMachine",rc);var oc=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__targetStateParam=e.addParameter(new io("TargetState",""));return e}e.prototype.activate=function(){this.__state.getStateMachine().activateState(this.__targetStateParam.getValue())};return e}(ic);br.registerClass("SwitchState",oc);var lc=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.addParameter(new so("Camera",(function(t){return t instanceof El}))),e.addParameter(new Ar("cameraPos")),e.addParameter(new Ar("cameraTarget")),e.addParameter(new Br("interpTime",1)),e.addParameter(new Br("updateFrequency",30));return e}e.prototype.SetCameraPositionAndTarget=function(t,e){this.getParameter("cameraPos").setValue(t),this.getParameter("cameraTarget").setValue(e)};e.prototype.activate=function(){var t=this;var e=this.getParameter("Camera").getValue();if(!e)return void console.warn("Camera not assigned to SetCameraPositionAndTarget state action");var a=this.getParameter("cameraPos").getValue(),i=this.getParameter("cameraTarget").getValue(),n=this.getParameter("interpTime").getValue();if(n>0){var r=e.getGlobalXfo().tr,o=e.getTargetPostion(),l=(r.subtract(o).length(),this.getParameter("updateFrequency").getValue()),s=a.subtract(i).length();var d=!0,c=0,u=0;var h=Math.round(n*l);var m=!1;var p=function(){m||(d=!1)};e.globalXfoChanged.connect(p);var f=function(){if(u++,u<h){var n=u/h,r=Math.smoothStep(0,1,n),o=(r-c)/(1-n);c=r;var b=e.getGlobalXfo().tr,y=e.getTargetPostion(),g=b.subtract(y).length();var _=b;var Z=y.lerp(i,o);d&&(_=b.lerp(a,o));var G=_.subtract(Z),X=(G.length(),Math.lerp(g,s,o));G.scaleInPlace(X/G.length()),m=!0,e.setPositionAndTarget(Z.add(G),Z),m=!1,t.__timeoutId=window.setTimeout(f,1e3/l)}else e.globalXfoChanged.disconnect(p),e.movementFinished.emit(),t.__timeoutId=void 0,t.__onDone()};f()}else e.setPositionAndTarget(a,i)};e.prototype.cancel=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=void 0)};return e}(ic);br.registerClass("SetCameraPositionAndTarget",lc);var sc=function(t){__extends(e,t);function e(){var e=this;e=t.call(this)||this,e.__interpTimeParam=e.addParameter(new Br("InterpTime",1)),e.__updateFrequencyParam=e.addParameter(new Br("UpdateFrequency",30)),e.__outParam=e.addOutput(new Al("Param")),e.__outParam.paramSet.connect((function(){if(!e.__valueParam||e.__outParam.getParam().getDataType()!=e.__valueParam.getDataType()){var t=e.__outParam.getParam().clone();t.setName("Value"),e.__outParam.getInitialValue?t.setValue(e.__outParam.getInitialValue()):t.setValue(e.__outParam.getParam().getValue()),e.__valueParam=e.addParameter(t)}}));return e}e.prototype.activate=function(){var t=this;if(this.__outParam.isConnected()){var e=this.__interpTimeParam.getValue();if(e>0){var a=this.__updateFrequencyParam.getValue(),i=this.__outParam.getValue(),n=this.__valueParam.getValue();var r=0;var o=Math.round(e/(1/a)),l=function(){if(r++,r<o){var e=r/o,s=Math.smoothStep(0,1,e),d=Math.lerp(i,n,s);t.__outParam.setValue(d,gr.GENERATED_VALUE),t.__timeoutId=window.setTimeout(l,1e3/a)}else t.__outParam.setValue(t.__valueParam.getValue(),gr.GENERATED_VALUE),t.__timeoutId=void 0,t.__onDone()};l()}else this.__outParam.setValue(this.__valueParam.getValue(),gr.GENERATED_VALUE),this.__onDone()}};e.prototype.cancel=function(){this.__timeoutId&&(clearTimeout(this.__timeoutId),this.__timeoutId=void 0)};e.prototype.toJSON=function(e,a){var i=t.prototype.toJSON.call(this,e,a);return this.__valueParam&&(i.valueParamType=br.getClassName(this.__valueParam)),i};e.prototype.fromJSON=function(e,a,i){if(e.valueParamType){var n=br.constructClass(e.valueParamType,"Value");n&&(this.__valueParam=this.addParameter(n))}t.prototype.fromJSON.call(this,e,a,i)};return e}(ic);br.registerClass("SetParameterValue",sc);var dc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__geomParam=a.addParameter(new so("TreeItem")),a.__geomParam.valueChanged.connect((function(){a.__geom=a.__geomParam.getValue()}));return a}e.prototype.__geomClicked=function(t){t.stopPropagation(),this.__onEvent()};e.prototype.activate=function(){this.__geom&&this.__geom.mouseDown.connect(this.__geomClicked.bind(this))};e.prototype.deactivate=function(){this.__geom&&this.__geom.mouseDown.disconnect(this.__geomClicked.bind(this))};return e}(nc);br.registerClass("GeomClicked",dc);var cc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.onKeyPressed=a.onKeyPressed.bind(a),a.__keyParam=a.addParameter(new io("Key",""));return a}e.prototype.onKeyPressed=function(t){console.log(t.key),t.key==this.__keyParam.getValue()&&this.__onEvent()};e.prototype.activate=function(){document.addEventListener("keydown",this.onKeyPressed)};e.prototype.deactivate=function(){document.removeEventListener("keydown",this.onKeyPressed)};return e}(nc);br.registerClass("KeyPressedEvent",cc);var uc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.__waitTimeParam=a.addParameter(new Br("WaitTime",1));return a}e.prototype.activate=function(){var t=this;this.__timeoutId=window.setTimeout((function(){delete t.__timeoutId,t.__onEvent()}),1e3*this.__waitTimeParam.getValue())};e.prototype.deactivate=function(){this.__timeoutId&&window.clearTimeout(this.__timeoutId)};return e}(nc);br.registerClass("TimedWait",uc);var hc=__assign(__assign(__assign(__assign(__assign(__assign({onResize:wn},Un),sr),mr),ls),ec),Object.freeze({__proto__:null,State:ac,StateAction:ic,StateEvent:nc,StateMachine:rc,SwitchState:oc,SetCameraPositionAndTarget:lc,SetParameterValue:sc,GeomClicked:dc,KeyPressedEvent:cc,TimedWait:uc}));var mc={},pc={},fc=[];var bc=function(){function t(){this.__undoStack=[],this.__redoStack=[],this.changeAdded=new dr,this.changeUpdated=new dr,this.changeUndone=new dr,this.changeRedone=new dr,this.__currChangeUpdated=this.__currChangeUpdated.bind(this)}t.prototype.flush=function(){for(var t=0,e=this.__undoStack;t<e.length;t++){var a=e[t];a.destroy()}this.__undoStack=[];for(var i=0,n=this.__redoStack;i<n.length;i++){var r=n[i];r.destroy()}this.__redoStack=[]};t.prototype.addChange=function(t){this.getCurrentChange()&&this.getCurrentChange().updated.disconnect(this.__currChangeUpdated),this.__undoStack.push(t),t.updated.connect(this.__currChangeUpdated);for(var e=0,a=this.__redoStack;e<a.length;e++){var i=a[e];i.destroy()}this.__redoStack=[],this.changeAdded.emit(t)};t.prototype.getCurrentChange=function(){return this.__undoStack[this.__undoStack.length-1]};t.prototype.__currChangeUpdated=function(t){this.changeUpdated.emit(t)};t.prototype.undo=function(t){if(t===void 0){t=!0}if(this.__undoStack.length>0){var e=this.__undoStack.pop();e.undo(),t&&(this.__redoStack.push(e),this.changeUndone.emit())}};t.prototype.redo=function(){if(this.__redoStack.length>0){var t=this.__redoStack.pop();t.redo(),this.__undoStack.push(t),this.changeRedone.emit()}};t.prototype.constructChange=function(t){return new mc[t]};t.getChangeClassName=function(t){var e=fc.indexOf(t.constructor);return pc[e]?pc[e]:(console.warn("Change not registered:",t.constructor.name),t.constructor.name)};t.registerChange=function(t,e){-1!=fc.indexOf(e)&&console.warn("Class already registered:",t);var a=fc.length;fc.push(e),mc[t]=e,pc[a]=t};return t}();var yc=function(){function t(t){this.name=t||bc.getChangeClassName(this),this.updated=new dr}t.prototype.undo=function(){throw new Error("Implement me")};t.prototype.redo=function(){throw new Error("Implement me")};t.prototype.update=function(t){throw new Error("Implement me")};t.prototype.toJSON=function(t){return{}};t.prototype.fromJSON=function(t,e){};t.prototype.changeFromJSON=function(t){this.update(t)};t.prototype.destroy=function(){};return t}();var gc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.captured=!1;return a}e.prototype.highlight=function(){};e.prototype.unhighlight=function(){};e.prototype.getManipulationPlane=function(){var t=this.getGlobalXfo();return new er(t.tr,t.ori.getZaxis())};e.prototype.onMouseEnter=function(t){this.highlight()};e.prototype.onMouseLeave=function(t){this.unhighlight()};e.prototype.onMouseDown=function(t){t.setCapture(this),t.stopPropagation(),this.captured=!0,t.viewport?this.handleMouseDown(t):t.vrviewport&&this.onVRControllerButtonDown(t)};e.prototype.onMouseMove=function(t){this.captured&&(t.stopPropagation(),t.viewport?this.handleMouseMove(t):t.vrviewport&&this.onVRPoseChanged(t))};e.prototype.onMouseUp=function(t){this.captured&&(t.releaseCapture(),t.stopPropagation(),this.captured=!1,t.viewport?this.handleMouseUp(t):t.vrviewport&&this.onVRControllerButtonUp(t))};e.prototype.onWheel=function(t){};e.prototype.handleMouseDown=function(t){this.gizmoRay=this.getManipulationPlane();var e=t.mouseRay.intersectRayPlane(this.gizmoRay);return t.grabPos=t.mouseRay.pointAtDist(e),this.onDragStart(t),!0};e.prototype.handleMouseMove=function(t){var e=t.mouseRay.intersectRayPlane(this.gizmoRay);return t.holdPos=t.mouseRay.pointAtDist(e),this.onDrag(t),!0};e.prototype.handleMouseUp=function(t){var e=t.mouseRay.intersectRayPlane(this.gizmoRay);return t.releasePos=t.mouseRay.pointAtDist(e),this.onDragEnd(t),!0};e.prototype.onVRControllerButtonDown=function(t){this.activeController=t.controller;var e=this.activeController.getTipXfo().clone(),a=this.getManipulationPlane(),i=e.tr.subtract(a.start),n=e.tr.subtract(a.dir.scale(i.dot(a.dir)));return t.grabPos=n,this.onDragStart(t),!0};e.prototype.onVRPoseChanged=function(t){if(this.activeController){var e=this.activeController.getTipXfo(),a=this.getManipulationPlane(),i=e.tr.subtract(a.start),n=e.tr.subtract(a.dir.scale(i.dot(a.dir)));return t.holdPos=n,this.onDrag(t),!0}};e.prototype.onVRControllerButtonUp=function(t){if(this.activeController==t.controller){var e=this.activeController.getTipXfo();return this.onDragEnd(t,e.tr),this.activeController=void 0,!0}};e.prototype.onDragStart=function(t){console.log("onDragStart",t)};e.prototype.onDrag=function(t){console.log("onDrag",t)};e.prototype.onDragEnd=function(t){console.log("onDragEnd",t)};return e}(Tl);var _c=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e.prototype.handleMouseDown=function(t){this.gizmoRay=this.getManipulationPlane(),this.grabDist=t.mouseRay.intersectRayVector(this.gizmoRay)[1];var e=this.gizmoRay.pointAtDist(this.grabDist);return t.grabDist=this.grabDist,t.grabPos=e,this.onDragStart(t),!0};e.prototype.handleMouseMove=function(t){var e=t.mouseRay.intersectRayVector(this.gizmoRay)[1],a=this.gizmoRay.pointAtDist(e);t.holdDist=e,t.holdPos=a,t.value=e,t.delta=e-this.grabDist,this.onDrag(t)};e.prototype.handleMouseUp=function(t){var e=t.mouseRay.intersectRayVector(this.gizmoRay)[1],a=this.gizmoRay.pointAtDist(e);return t.releasePos=a,this.onDragEnd(t),!0};e.prototype.onVRControllerButtonDown=function(t){this.gizmoRay=this.getManipulationPlane(),this.activeController=t.controller;var e=this.activeController.getTipXfo();this.grabDist=e.tr.subtract(this.gizmoRay.start).dot(this.gizmoRay.dir);var a=this.gizmoRay.start.add(this.gizmoRay.dir.scale(this.grabDist));return t.grabPos=a,this.onDragStart(t),!0};e.prototype.onVRPoseChanged=function(t){var e=this.activeController.getTipXfo().tr.subtract(this.gizmoRay.start).dot(this.gizmoRay.dir),a=this.gizmoRay.start.add(this.gizmoRay.dir.scale(e));return t.value=e,t.holdPos=a,t.delta=e-this.grabDist,this.onDrag(t),!0};e.prototype.onVRControllerButtonUp=function(t){if(this.activeController==t.controller)return this.onDragEnd(),this.activeController=void 0,!0};return e}(gc);var Zc=function(t){__extends(e,t);function e(e,a,i){if(i===void 0){i=gr.USER_SETVALUE}var n=this;e?(n=t.call(this,e?e.getName()+" Changed":"ParameterValueChange")||this,n.__prevValue=e.getValue(),n.__param=e,n.__mode=i,null!=a&&(n.__nextValue=a,n.__param.setValue(n.__nextValue,i))):n=t.call(this)||this;return n}e.prototype.undo=function(){this.__param&&this.__param.setValue(this.__prevValue,this.__mode)};e.prototype.redo=function(){this.__param&&this.__param.setValue(this.__nextValue,this.__mode)};e.prototype.update=function(t){if(!this.__param)return;this.__nextValue=t.value;var e=t.mode?t.mode:this.__mode;this.__param.setValue(this.__nextValue,e),this.updated.emit(t)};e.prototype.toJSON=function(t){var e={name:this.name,paramPath:this.__param.getPath()};return null!=this.__nextValue&&(this.__nextValue.toJSON?e.value=this.__nextValue.toJSON():e.value=this.__nextValue),e};e.prototype.fromJSON=function(t,e){var a=e.appData.scene.getRoot().resolvePath(t.paramPath,1);a&&a instanceof Vr?(this.__param=a,this.__prevValue=this.__param.getValue(),this.__prevValue.clone?this.__nextValue=this.__prevValue.clone():this.__nextValue=this.__prevValue,this.name=t.name,null!=t.value&&this.changeFromJSON(t)):console.warn("resolvePath is unable to resolve",t.paramPath)};e.prototype.changeFromJSON=function(t){this.__param&&(this.__nextValue.fromJSON?this.__nextValue.fromJSON(t.value):this.__nextValue=t.value,this.__param.setValue(this.__nextValue,gr.REMOTEUSER_SETVALUE))};return e}(yc);t("N",Zc);bc.registerChange("ParameterValueChange",Zc);var Gc=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e.prototype.setTargetParam=function(t,e){var a=this;if(e===void 0){e=!0}if(this.param=t,e){var i=function(){a.setGlobalXfo(t.getValue())};i(),t.valueChanged.connect(i)}};e.prototype.getTargetParam=function(){return this.param?this.param:this.getParameter("GlobalXfo")};e.prototype.onDragStart=function(t){this.baseXfo=this.getGlobalXfo().clone(),this.baseXfo.sc.set(1,1,1),this.deltaXfo=new ar;var e=this.getTargetParam(),a=e.getValue();this.offsetXfo=this.baseXfo.inverse().multiply(a),this.vec0=t.grabPos.subtract(this.baseXfo.tr),this.grabCircleRadius=this.vec0.length(),this.vec0.normalizeInPlace(),t.undoRedoManager&&(this.change=new Zc(e),t.undoRedoManager.addChange(this.change))};e.prototype.onDrag=function(t){var e=t.holdPos.subtract(this.baseXfo.tr),a=e.length();e.normalizeInPlace();var i=a/this.grabCircleRadius;var n=this.vec0.angleTo(e)*i;if(this.vec0.cross(e).dot(this.baseXfo.ori.getZaxis())<0&&(n=-n),this.range&&(n=Math.clamp(n,this.range[0],this.range[1])),t.shiftKey){var r=Math.degToRad(22.5);n=Math.floor(n/r)*r}this.deltaXfo.ori.setFromAxisAndAngle(new Dn(0,0,1),n);var o=this.baseXfo.multiply(this.deltaXfo).multiply(this.offsetXfo);if(this.change)this.change.update({value:o});else{this.getTargetParam().setValue(o)}};e.prototype.onDragEnd=function(t){this.change=null};return e}(gc);var Xc=function(t){__extends(e,t);function e(e,a,i){var n=this;n=t.call(this,"SelectionChange")||this,n.__selectionManager=e,n.__prevSelection=a,n.__newSelection=i;return n}e.prototype.undo=function(){this.__selectionManager.setSelection(this.__prevSelection,!1)};e.prototype.redo=function(){this.__selectionManager.setSelection(this.__newSelection,!1)};e.prototype.toJSON=function(e){var a=t.prototype.toJSON.call(this,e),i=[];for(var n=0,r=this.__newSelection;n<r.length;n++){var o=r[n];i.push(o.getPath())}return a.itemPaths=i,a};e.prototype.fromJSON=function(e,a){t.prototype.fromJSON.call(this,e,a),this.__selectionManager=a.appData.selectionManager,this.__prevSelection=new Set(this.__selectionManager.getSelection());var i=a.appData.scene.getRoot(),n=new Set;for(var r=0,o=e.itemPaths;r<o.length;r++){var l=o[r];n.add(i.resolvePath(l,1))}this.__newSelection=n,this.__selectionManager.setSelection(this.__newSelection,!1)};return e}(yc);bc.registerChange("SelectionChange",Xc);var vc=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,"Selection Visibility Change")||this,i.selection=e,i.state=a,i.do(i.state);return i}e.prototype.undo=function(){this.do(!this.state)};e.prototype.redo=function(){this.do(this.state)};e.prototype.do=function(t){for(var e=0,a=this.selection;e<a.length;e++){var i=a[e];i.getParameter("Visible").setValue(t)}};return e}(yc);bc.registerChange("ToggleSelectionVisibility",vc);var Vc=function(t){__extends(e,t);function e(e,a,i){var n=this;e?(n=t.call(this,e.getName()+" Added")||this,n.treeItem=e,n.owner=a,n.selectionManager=i,n.prevSelection=new Set(n.selectionManager.getSelection()),n.treeItemIndex=n.owner.addChild(n.treeItem),n.selectionManager.setSelection(new Set([n.treeItem]),!1),n.treeItem.addRef(n)):n=t.call(this)||this;return n}e.prototype.undo=function(){if(this.treeItem instanceof Ql){this.treeItem.detach()}else this.treeItem instanceof Tl&&this.treeItem.traverse((function(t){if(t instanceof Ql){t.detach()}}),!1);this.owner.removeChild(this.treeItemIndex),this.selectionManager&&this.selectionManager.setSelection(this.prevSelection,!1)};e.prototype.redo=function(){if(this.treeItem instanceof Ql){this.treeItem.reattach()}else subTreeItem instanceof Tl&&this.treeItem.traverse((function(t){if(t instanceof Ql){t.reattach()}}),!1);this.owner.addChild(this.treeItem),this.selectionManager&&this.selectionManager.setSelection(new Set([this.treeItem]),!1)};e.prototype.toJSON=function(t){return{name:this.name,treeItem:this.treeItem.toJSON(t),treeItemPath:this.treeItem.getPath(),treeItemIndex:this.treeItemIndex}};e.prototype.fromJSON=function(t,e){var a=br.constructClass(t.treeItem.type);a?(this.name=t.name,this.treeItem=a,this.treeItem.addRef(this),this.treeItem.fromJSON(t.treeItem,e),this.treeItemIndex=this.owner.addChild(this.treeItem,!1,!1)):console.warn("resolvePath is unable to conostruct",t.treeItem)};e.prototype.destroy=function(){this.treeItem.removeRef(this)};return e}(yc);bc.registerChange("TreeItemAddChange",Vc);var Ic=function(t){__extends(e,t);function e(e,a){var i=this;if(i=t.call(this)||this,i.items=[],i.itemOwners=[],i.itemPaths=[],i.itemIndices=[],e){i.selectionManager=a.selectionManager,i.prevSelection=new Set(i.selectionManager.getSelection()),i.items=e,i.newSelection=new Set(i.prevSelection);var n=[];i.items.forEach((function(t){var e=t.getOwner(),a=e.getChildIndex(t);if(n.push(t.getName()),t.addRef(i),i.itemOwners.push(e),i.itemPaths.push(t.getPath()),i.itemIndices.push(a),i.selectionManager&&i.newSelection.has(t)&&i.newSelection.delete(t),t instanceof Ql){t.detach()}else t instanceof Tl&&t.traverse((function(t){if(t instanceof Ql){t.detach()}i.selectionManager&&i.newSelection.has(t)&&i.newSelection.delete(t)}),!1);e.removeChild(a)})),i.selectionManager.setSelection(i.newSelection,!1),i.name=n+" Deleted"}return i}e.prototype.undo=function(){var t=this;this.items.forEach((function(e,a){if(t.itemOwners[a].insertChild(e,t.itemIndices[a],!1,!1),e instanceof Ql){e.reattach()}else subTreeItem instanceof Tl&&e.traverse((function(t){if(t instanceof Ql){t.reattach()}}),!1)})),this.selectionManager&&this.selectionManager.setSelection(this.prevSelection,!1)};e.prototype.redo=function(){var t=this;this.selectionManager&&this.selectionManager.setSelection(this.newSelection,!1),this.items.forEach((function(e,a){if(t.itemOwners[a].removeChild(t.itemIndices[a]),e instanceof Ql){e.detach()}else subTreeItem instanceof Tl&&e.traverse((function(t){if(t instanceof Ql){t.detach()}}),!1)}))};e.prototype.toJSON=function(t){var e={name:this.name,items:[],itemPaths:this.itemPaths,itemIndices:this.itemIndices};return this.items.forEach((function(t){e.items.push(t.toJSON())})),e};e.prototype.fromJSON=function(t,e){var a=this;this.name=t.name,t.itemPaths.forEach((function(t){var i=e.scene.getRoot().resolvePath(t,1);if(!i)return void console.warn("resolvePath is unable to resolve",t);var n=i.getOwner();a.itemOwners.push(n),a.itemPaths.push(i.getPath()),a.itemIndices.push(n.getChildIndex(i))}))};e.prototype.destroy=function(){var t=this;this.items.forEach((function(e){return e.removeRef(t)}))};return e}(yc);bc.registerChange("TreeItemsRemoveChange",Ic);var Rc=function(t){__extends(e,t);function e(e,a){var i=this;e?(console.log("TreeItemMoveChange"),i=t.call(this,e.getName()+" Added")||this,i.treeItem=e,i.oldOwner=i.treeItem.getOwner(),i.oldOwnerIndex=i.oldOwner.getChildIndex(i.treeItem),i.newOwner=a,i.newOwner.addChild(i.treeItem,!0)):i=t.call(this)||this;return i}e.prototype.undo=function(){this.oldOwner.insertChild(this.treeItem,this.oldOwnerIndex,!0)};e.prototype.redo=function(){this.newOwner.addChild(this.treeItem,!0)};e.prototype.toJSON=function(t){return{name:this.name,treeItemPath:this.treeItem.getPath(),newOwnerPath:this.newOwner.getPath()}};e.prototype.fromJSON=function(t,e){var a=appData.scene.getRoot().resolvePath(t.treeItemPath,1);if(!a)return void console.warn("resolvePath is unable to resolve",t.treeItemPath);var i=appData.scene.getRoot().resolvePath(t.newOwnerPath,1);i?(this.name=t.name,this.treeItem=a,this.newOwner=i,this.oldOwner=this.treeItem.getOwner(),this.oldOwnerIndex=this.oldOwner.getChildIndex(this.treeItem),this.newOwner.addChild(this.treeItem,!0)):console.warn("resolvePath is unable to resolve",t.newOwnerPath)};return e}(yc);bc.registerChange("TreeItemMoveChange",Rc);var xc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this)||this,e||console.error("App data not provided to tool"),a.appData=e,a.installChanged=new dr,a.activatedChanged=new dr,a.actionFinished=new dr,a.__params=[],a.__installed=!1,a.__activated=!1;return a}e.prototype.getName=function(){return this.constructor.name};e.prototype.isPrimaryTool=function(){return!1};e.prototype.installed=function(){return this.__installed};e.prototype.install=function(t){if(this.__installed)throw new Error("Tool already installed");this.index=t,this.__installed=!0,this.installChanged.emit(!0)};e.prototype.uninstall=function(){this.__installed=!1,this.installChanged.emit(!1)};e.prototype.activateTool=function(){if(this.__activated)throw new Error("Tool already activate");this.__activated=!0,this.activatedChanged.emit(!0)};e.prototype.deactivateTool=function(){this.__activated=!1,this.activatedChanged.emit(!1)};e.prototype.onMouseDown=function(t){};e.prototype.onMouseMove=function(t){};e.prototype.onMouseUp=function(t){};e.prototype.onDoubleClick=function(t){};e.prototype.onWheel=function(t){};e.prototype.onKeyPressed=function(t,e){};e.prototype.onKeyDown=function(t,e){};e.prototype.onKeyUp=function(t,e){};e.prototype.onTouchStart=function(t){};e.prototype.onTouchMove=function(t){};e.prototype.onTouchEnd=function(t){};e.prototype.onTouchCancel=function(t){};e.prototype.onDoubleTap=function(t){};e.prototype.onVRControllerButtonDown=function(t){};e.prototype.onVRControllerButtonUp=function(t){};e.prototype.onVRControllerDoubleClicked=function(t){};e.prototype.onVRPoseChanged=function(t){};return e}(Rr);var Sc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,e)||this,a.dragging=!1,a.selectionRect=new fl(1,1),a.selectionRectMat=new yo("marker","ScreenSpaceShader"),a.selectionRectMat.getParameter("BaseColor").setValue(new An("#03E3AC")),a.selectionRectXfo=new ar,a.selectionRectXfo.tr.set(.5,.5,0),a.selectionRectXfo.sc.set(0,0,0);return a}e.prototype.activateTool=function(){t.prototype.activateTool.call(this),this.rectItem||(this.rectItem=new Yl("selectionRect",this.selectionRect,this.selectionRectMat),this.rectItem.getParameter("Visible").setValue(!1),this.appData.renderer.addTreeItem(this.rectItem))};e.prototype.deactivateTool=function(){t.prototype.deactivateTool.call(this),this.selectionRectXfo.sc.set(0,0,0),this.rectItem.setGlobalXfo(this.selectionRectXfo)};e.prototype.onMouseDown=function(t){return 0==t.button&&!t.altKey&&(console.log("onMouseDown"),this.mouseDownPos=t.mousePos,this.dragging=!1,!0)};e.prototype.__resizeRect=function(t,e){var a=new Bn(1/t.getWidth()*2,1/t.getHeight()*2),i=e.multiply(a);this.selectionRectXfo.sc.set(Math.abs(i.x),Math.abs(i.y),1);var n=this.mouseDownPos.subtract(e.scale(.5)).multiply(a).subtract(new Bn(1,1));this.selectionRectXfo.tr.x=n.x,this.selectionRectXfo.tr.y=-n.y,this.rectItem.setGlobalXfo(this.selectionRectXfo)};e.prototype.onMouseMove=function(t){if(this.mouseDownPos){var e=this.mouseDownPos.subtract(t.mousePos);this.dragging&&this.__resizeRect(t.viewport,e),e.length()>4&&(this.dragging=!0,this.rectItem.getParameter("Visible").setValue(!0),this.__resizeRect(t.viewport,e))}return!0};e.prototype.onMouseUp=function(t){if(this.mouseDownPos){if(this.dragging){this.rectItem.getParameter("Visible").setValue(!1);var e=t.mousePos,a=new Bn(Math.min(this.mouseDownPos.x,e.x),Math.min(this.mouseDownPos.y,e.y)),i=new Bn(Math.max(this.mouseDownPos.x,e.x),Math.max(this.mouseDownPos.y,e.y)),n=t.viewport.getGeomItemsInRect(a,i);if(this.appData.selectionManager.pickingModeActive())this.appData.selectionManager.pick(n);else{var r=new Set(__spreadArrays(n).filter((function(t){return!(t.getOwner()instanceof gc)})));t.shiftKey?this.appData.selectionManager.deselectItems(r):this.appData.selectionManager.selectItems(r,!t.ctrlKey),this.selectionRectXfo.sc.set(0,0,0),this.rectItem.setGlobalXfo(this.selectionRectXfo)}}else{var o=t.viewport.getGeomDataAtPos(t.mousePos);if(null==o||o.geomItem.getOwner()instanceof gc)this.appData.selectionManager.clearSelection();else if(this.appData.selectionManager.pickingModeActive())this.appData.selectionManager.pick(o.geomItem);else if(t.shiftKey){var l=new Set;l.add(o.geomItem),this.appData.selectionManager.deselectItems(l)}else this.appData.selectionManager.toggleItemSelection(o.geomItem,!t.ctrlKey)}return this.mouseDownPos=void 0,!0}};e.prototype.onVRControllerButtonDown=function(t){if(1==t.button){var e=t.controller.getGeomItemAtTip();if(null!=e&&!(e.geomItem.getOwner()instanceof gc))return this.appData.selectionManager.toggleItemSelection(e.geomItem),!0}};return e}(xc);bc.registerChange("SelectionTool",Sc);var Wc=function(t){__extends(e,t);function e(e){var a=this;a=t.call(this,"HoldObjectsChange")||this,a.__selection=[],a.__prevXfos=[],a.__newXfos=[],e&&a.update(e);return a}e.prototype.undo=function(){for(var t=0;t<this.__selection.length;t++)this.__selection[t]&&this.__selection[t].setGlobalXfo(this.__prevXfos[t])};e.prototype.redo=function(){for(var t=0;t<this.__selection.length;t++)this.__selection[t]&&this.__selection[t].setGlobalXfo(this.__newXfos[t])};e.prototype.update=function(t){if(t.newItem)this.__selection[t.newItemId]=t.newItem,this.__prevXfos[t.newItemId]=t.newItem.getGlobalXfo();else if(t.changeXfos)for(var e=0;e<t.changeXfoIds.length;e++){var a=t.changeXfoIds[e];this.__selection[a]&&(this.__selection[a].setGlobalXfo(t.changeXfos[e]),this.__newXfos[a]=t.changeXfos[e])}this.updated.emit(t)};e.prototype.toJSON=function(e){var a=t.prototype.toJSON.call(this,e),i=[];for(var n=0;n<this.__selection.length;n++)this.__selection[n]?i[n]=this.__selection[n].getPath():i.push(null);return a.itemPaths=i,a};e.prototype.fromJSON=function(e,a){t.prototype.fromJSON.call(this,e,a);var i=a.appData.scene.getRoot(),n=[];for(var r=0;r<e.itemPaths.length;r++){var o=e.itemPaths[r];o&&(n[r]=i.resolvePath(o,1))}this.__selection=n};return e}(yc);bc.registerChange("HoldObjectsChange",Wc);var Lc=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e.prototype.setParentAndXfo=function(t,e){this.parentItem=t;var a=this.parentItem.generateUniqueName(this.geomItem.getName());this.geomItem.setName(a),this.geomItem.setGlobalXfo(e),this.childIndex=this.parentItem.addChild(this.geomItem,!0),this.geomItem.addRef(this)};e.prototype.undo=function(){this.parentItem.removeChild(this.childIndex)};e.prototype.redo=function(){this.parentItem.addChild(this.geomItem,!1,!1)};e.prototype.toJSON=function(e){var a=t.prototype.toJSON.call(this,e);return a.parentItemPath=this.parentItem.getPath(),a.geomItemName=this.geomItem.getName(),a.geomItemXfo=this.geomItem.getParameter("LocalXfo").getValue(),a};e.prototype.fromJSON=function(t,e){var a=e.appData.scene.getRoot();this.parentItem=a.resolvePath(t.parentItemPath,1),this.geomItem.setName(this.parentItem.generateUniqueName(t.geomItemName));var i=new ar;i.fromJSON(t.geomItemXfo),this.geomItem.setLocalXfo(i),this.childIndex=this.parentItem.addChild(this.geomItem,!1)};e.prototype.destroy=function(){this.geomItem.removeRef(this)};return e}(yc);var Tc=function(t){__extends(e,t);function e(e,a,i,n){var r=this;r=t.call(this,"Create Line")||this,r.line=new sl(0),r.line.setNumVertices(2),r.line.setNumSegments(1),r.line.setSegment(0,0,1);var o=new yo("Line","LinesShader");o.getParameter("Color").setValue(new An(.7,.2,.2)),r.geomItem=new Yl("Line"),r.geomItem.setGeometry(r.line),r.geomItem.setMaterial(o),i&&o.getParameter("Color").setValue(i),n&&(r.line.lineThickness=n),e&&a&&r.setParentAndXfo(e,a);return r}e.prototype.update=function(t){t.p1&&(this.line.getVertex(1).setFromOther(t.p1),this.line.geomDataChanged.emit()),this.updated.emit(t)};e.prototype.fromJSON=function(e,a){if(t.prototype.fromJSON.call(this,e,a),e.color){var i=new An;i.fromJSON(e.color),material.getParameter("Color").setValue(i)}e.thickness&&(this.line.lineThickness=e.thickness)};return e}(Lc);bc.registerChange("CreateLineChange",Tc);var Mc=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,"Create Circle",e)||this,i.circle=new bl(0,64),i.circle.lineThickness=.05;var n=new yo("circle","FatLinesShader");n.getParameter("Color").setValue(new An(.7,.2,.2)),i.geomItem=new Yl("Circle"),i.geomItem.setGeometry(i.circle),i.geomItem.setMaterial(n),e&&a&&i.setParentAndXfo(e,a);return i}e.prototype.update=function(t){this.circle.getParameter("Radius").setValue(t.radius),this.updated.emit(t)};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.radius=this.circle.getParameter("Radius").getValue(),e};e.prototype.changeFromJSON=function(t){console.log("CreateCircleChange:",t),t.radius&&this.circle.getParameter("Radius").setValue(t.radius)};return e}(Lc);bc.registerChange("CreateCircleChange",Mc);var Fc=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,"Create Rect")||this,i.rect=new fl(0,0),i.rect.lineThickness=.05;var n=new yo("circle","FatLinesShader");n.getParameter("Color").setValue(new An(.7,.2,.2)),i.geomItem=new Yl("Rect"),i.geomItem.setGeometry(i.rect),i.geomItem.setMaterial(n),e&&a&&i.setParentAndXfo(e,a);return i}e.prototype.update=function(t){if(t.baseSize&&this.rect.setSize(t.baseSize[0],t.baseSize[1]),t.tr){var e=this.geomItem.getParameter("LocalXfo").getValue();e.tr.fromJSON(t.tr),this.geomItem.getParameter("LocalXfo").setValue(e)}this.updated.emit(t)};return e}(Lc);bc.registerChange("CreateRectChange",Fc);var Cc=function(t){__extends(e,t);function e(e,a,i,n){var r=this;r=t.call(this,"Create Freehand Line")||this,r.used=0,r.vertexCount=100,r.line=new sl,r.line.setNumVertices(r.vertexCount),r.line.setNumSegments(r.vertexCount-1),r.line.vertices.setValue(0,new Dn);var o=new yo("freeHandLine","FatLinesShader");r.geomItem=new Yl("freeHandLine"),r.geomItem.setGeometry(r.line),r.geomItem.setMaterial(o),i&&o.getParameter("Color").setValue(i),n&&(r.line.lineThickness=n),e&&a&&r.setParentAndXfo(e,a);return r}e.prototype.update=function(t){this.used++;var e=!1;this.used>=this.line.getNumSegments()&&(this.vertexCount=this.vertexCount+100,this.line.setNumVertices(this.vertexCount),this.line.setNumSegments(this.vertexCount-1),e=!0),this.line.vertices.setValue(this.used,t.point),this.line.setSegment(this.used-1,this.used-1,this.used),e?this.line.geomDataTopologyChanged.emit({indicesChanged:!0}):this.line.geomDataChanged.emit({indicesChanged:!0}),this.updated.emit(t)};e.prototype.toJSON=function(e){var a=t.prototype.toJSON.call(this,e);return a.lineThickness=this.line.lineThickness,a.color=this.geomItem.getMaterial().getParameter("Color").getValue(),a};e.prototype.fromJSON=function(e,a){e.lineThickness&&(this.line.lineThickness=e.lineThickness);var i=new An(.7,.2,.2);e.color&&i.fromJSON(e.color),this.geomItem.getMaterial().getParameter("Color").setValue(i),t.prototype.fromJSON.call(this,e,a)};return e}(Lc);bc.registerChange("CreateFreehandLineChange",Cc);var Nc=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,"Create Sphere",e)||this,i.sphere=new Rl(0,64,32);var n=new yo("Sphere","SimpleSurfaceShader");i.geomItem=new Yl("Sphere"),i.geomItem.setGeometry(i.sphere),i.geomItem.setMaterial(n),e&&a&&i.setParentAndXfo(e,a);return i}e.prototype.update=function(t){this.sphere.radius=t.radius,this.updated.emit(t)};e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.radius=this.geomItem.getGeometry().radius,e};e.prototype.changeFromJSON=function(t){t.radius&&(this.geomItem.getGeometry().radius=t.radius)};return e}(Lc);bc.registerChange("CreateSphereChange",Nc);var Yc=function(t){__extends(e,t);function e(e,a){var i=this;i=t.call(this,"Create Cuboid")||this,i.cuboid=new Xl(0,0,0,!0);var n=new yo("Cuboid","SimpleSurfaceShader");i.geomItem=new Yl("Cuboid"),i.geomItem.setGeometry(i.cuboid),i.geomItem.setMaterial(n),e&&a&&i.setParentAndXfo(e,a);return i}e.prototype.update=function(t){if(t.baseSize&&this.cuboid.setBaseSize(t.baseSize[0],t.baseSize[1]),t.tr){var e=this.geomItem.getParameter("LocalXfo").getValue();e.tr.fromJSON(t.tr),this.geomItem.getParameter("LocalXfo").setValue(e)}t.height&&(this.cuboid.z=t.height),this.updated.emit(t)};return e}(Lc);bc.registerChange("CreateCuboidChange",Yc);var Kc=function(t){__extends(e,t);function e(e,a,i,n){if(a===void 0){a=.5}if(i===void 0){i=.02}if(n===void 0){n=new An(1,1,0)}var r=this;r=t.call(this,e)||this,r.lengthParam=r.addParameter(new Br("Length",a)),r.handleRadiusParam=r.addParameter(new Br("Handle Radius",i)),r.barRadiusParam=r.addParameter(new Br("Bar Radius",.25*i)),r.colorParam=r.addParameter(new qr("Color",n)),r.hilghlightColorParam=r.addParameter(new qr("Highlight Color",new An(1,1,1))),r.handleMat=new yo("handle","FlatSurfaceShader"),r.handleMat.getParameter("BaseColor").setValue(r.colorParam.getValue());var o=new yo("topBar","FlatSurfaceShader");o.getParameter("BaseColor").setValue(new An(.5,.5,.5));var l=new vl(.25*i,1,64,2,!0,!0),s=new Rl(i,64);r.handle=new Yl("handle",s,r.handleMat),r.baseBar=new Yl("baseBar",l,r.handleMat),r.topBar=new Yl("topBar",l,o),r.handleXfo=new ar,r.baseBarXfo=new ar,r.topBarXfo=new ar,r.barRadiusParam.valueChanged.connect((function(){l.getParameter("radius").setValue(r.barRadiusParam.getValue())})),r.handleRadiusParam.valueChanged.connect((function(){s.getParameter("radius").setValue(r.handleRadiusParam.getValue())})),r.lengthParam.valueChanged.connect((function(){r.__updateSlider(r.value)})),r.colorParam.valueChanged.connect((function(){r.handleMat.getParameter("BaseColor").setValue(r.colorParam.getValue())})),r.addChild(r.handle),r.addChild(r.baseBar),r.addChild(r.topBar),r.__updateSlider(0);return r}e.prototype.highlight=function(){this.handleMat.getParameter("BaseColor").setValue(this.hilghlightColorParam.getValue())};e.prototype.unhighlight=function(){this.handleMat.getParameter("BaseColor").setValue(this.colorParam.getValue())};e.prototype.setTargetParam=function(t){var e=this;this.param=t;var a=function(){e.__updateSlider(t.getValue())};a(),t.valueChanged.connect(a)};e.prototype.__updateSlider=function(t){this.value=t;var e=this.param&&this.param.getRange()?this.param.getRange():[0,1],a=Math.remap(t,e[0],e[1],0,1),i=this.lengthParam.getValue();this.baseBarXfo.sc.z=a*i,this.handleXfo.tr.z=a*i,this.topBarXfo.tr.z=a*i,this.topBarXfo.sc.z=(1-a)*i,this.handle.setLocalXfo(this.handleXfo,gr.GENERATED_VALUE),this.baseBar.setLocalXfo(this.baseBarXfo,gr.GENERATED_VALUE),this.topBar.setLocalXfo(this.topBarXfo,gr.GENERATED_VALUE)};e.prototype.onDragStart=function(t){this.handleXfo.sc.x=this.handleXfo.sc.y=this.handleXfo.sc.z=1.2,this.handle.setLocalXfo(this.handleXfo,gr.GENERATED_VALUE),this.param&&t.undoRedoManager&&(this.change=new Zc(this.param),t.undoRedoManager.addChange(this.change))};e.prototype.onDrag=function(t){var e=this.lengthParam.getValue(),a=this.param&&this.param.getRange()?this.param.getRange():[0,1],i=Math.clamp(Math.remap(t.value,0,e,a[0],a[1]),a[0],a[1]);if(!this.param)return this.__updateSlider(i),void(this.value=i);this.change?this.change.update({value:i}):this.param.setValue(i)};e.prototype.onDragEnd=function(t){this.change=null,this.handleXfo.sc.x=this.handleXfo.sc.y=this.handleXfo.sc.z=1,this.handle.setLocalXfo(this.handleXfo,gr.GENERATED_VALUE)};e.prototype.toJSON=function(e,a){if(a===void 0){a=0}var i=t.prototype.toJSON.call(this,e,a|SAVE_FLAG_SKIP_CHILDREN);return this.param&&(i.targetParam=this.param.getPath()),i};e.prototype.fromJSON=function(e,a,i){var n=this;t.prototype.fromJSON.call(this,e,a,i),e.targetParam&&a.resolvePath(e.targetParam).then((function(t){n.setTargetParam(t)}))};return e}(_c);br.registerClass("SliderHandle",Kc);var wc=function(t){__extends(e,t);function e(e,a,i,n,r){if(a===void 0){a=1}if(i===void 0){i=1}if(n===void 0){n=.02}if(r===void 0){r=new An(1,1,0)}var o=this;o=t.call(this,e)||this,o.arcRadiusParam=o.addParameter(new Br("Arc Radius",a)),o.arcAngleParam=o.addParameter(new Br("Arc Angle",i)),o.handleRadiusParam=o.addParameter(new Br("Handle Radius",n)),o.colorParam=o.addParameter(new qr("Color",r)),o.hilghlightColorParam=o.addParameter(new qr("Highlight Color",new An(1,1,1))),o.handleMat=new yo("handleMat","HandleShader");var l=new bl(a,i,64),s=new Rl(n,64);o.handle=new Yl("handle",s,o.handleMat),o.arc=new Yl("arc",l,o.handleMat),o.handleXfo=new ar,o.handleGeomOffsetXfo=new ar,o.handleGeomOffsetXfo.tr.x=a,o.handle.getParameter("GeomOffsetXfo").setValue(o.handleGeomOffsetXfo),o.range=[0,i],o.arcAngleParam.valueChanged.connect((function(){var t=o.arcAngleParam.getValue();l.getParameter("Angle").setValue(t),o.range=[0,t]})),o.arcRadiusParam.valueChanged.connect((function(){var t=o.arcRadiusParam.getValue();l.getParameter("Radius").setValue(t),o.handleGeomOffsetXfo.tr.x=t,o.handle.getParameter("GeomOffsetXfo").setValue(o.handleGeomOffsetXfo)})),o.handleRadiusParam.valueChanged.connect((function(){s.getParameter("radius").setValue(o.handleRadiusParam.getValue())})),o.colorParam.valueChanged.connect((function(){o.handleMat.getParameter("BaseColor").setValue(o.colorParam.getValue())})),o.addChild(o.handle),o.addChild(o.arc),o.setTargetParam(o.handle.getParameter("GlobalXfo"),!1),o.dragStart=new dr,o.dragEnd=new dr;return o}e.prototype.onMouseEnter=function(t){t.intersectionData&&t.intersectionData.geomItem==this.handle&&this.highlight()};e.prototype.onMouseLeave=function(t){this.unhighlight()};e.prototype.onMouseDown=function(e){e.intersectionData&&e.intersectionData.geomItem==this.handle&&t.prototype.onMouseDown.call(this,e)};e.prototype.highlight=function(){this.handleMat.getParameter("BaseColor").setValue(this.hilghlightColorParam.getValue())};e.prototype.unhighlight=function(){this.handleMat.getParameter("BaseColor").setValue(this.colorParam.getValue())};e.prototype.getBaseXfo=function(){return this.handle.getParameter("GlobalXfo").getValue()};e.prototype.onDragStart=function(t){this.baseXfo=this.getGlobalXfo().clone(),this.baseXfo.sc.set(1,1,1),this.deltaXfo=new ar,this.vec0=this.getGlobalXfo().ori.getXaxis(),this.vec0.normalizeInPlace(),t.undoRedoManager&&(this.change=new Zc(this.param),t.undoRedoManager.addChange(this.change)),this.handleGeomOffsetXfo.sc.x=this.handleGeomOffsetXfo.sc.y=this.handleGeomOffsetXfo.sc.z=1.2,this.handle.getParameter("GeomOffsetXfo").setValue(this.handleGeomOffsetXfo),this.dragStart.emit()};e.prototype.onDrag=function(t){var e=t.holdPos.subtract(this.baseXfo.tr);e.normalizeInPlace();var a=this.vec0.angleTo(e);if(this.vec0.cross(e).dot(this.baseXfo.ori.getZaxis())<0&&(a=-a),this.range&&(a=Math.clamp(a,this.range[0],this.range[1])),t.shiftKey){var i=Math.degToRad(22.5);a=Math.floor(a/i)*i}this.deltaXfo.ori.setFromAxisAndAngle(new Vec3(0,0,1),a);var n=this.baseXfo.multiply(this.deltaXfo);if(this.change)this.change.update({value:n});else{(this.param?this.param:this.getParameter("GlobalXfo")).setValue(n)}};e.prototype.onDragEnd=function(t){this.change=null,this.handleGeomOffsetXfo.sc.x=this.handleGeomOffsetXfo.sc.y=this.handleGeomOffsetXfo.sc.z=1,this.handle.getParameter("GeomOffsetXfo").setValue(this.handleGeomOffsetXfo),this.dragEnd.emit()};e.prototype.toJSON=function(e,a){if(a===void 0){a=0}var i=t.prototype.toJSON.call(this,e,a|SAVE_FLAG_SKIP_CHILDREN);return this.param&&(i.targetParam=this.param.getPath()),i};e.prototype.fromJSON=function(e,a,i){var n=this;t.prototype.fromJSON.call(this,e,a,i),e.targetParam&&a.resolvePath(e.targetParam).then((function(t){n.setTargetParam(t)}))};return e}(Gc);br.registerClass("ArcSlider",wc);var zc=function(t){__extends(e,t);function e(){var a=t.call(this)||this;var i=a.attachShadow({mode:"open"}),n=document.createElement("style");n.appendChild(document.createTextNode(e.css)),i.appendChild(n),a.itemContainer=document.createElement("div"),a.itemHeader=document.createElement("div"),a.itemHeader.className="TreeNodeHeader",a.itemContainer.appendChild(a.itemHeader),a.itemChildren=document.createElement("div"),a.itemChildren.className="TreeNodesList",a.itemContainer.appendChild(a.itemChildren),a.expandBtn=document.createElement("button"),a.expandBtn.className="TreeNodesListItem__ToggleExpanded",a.itemHeader.appendChild(a.expandBtn),a.expanded=!1,a.childrenAlreadyCreated=!1,a.expandBtn.addEventListener("click",(function(){a.treeItem.getNumChildren()>0&&(a.expanded?a.collapse():a.expand())})),a.titleElement=document.createElement("span"),a.titleElement.className="TreeNodesListItem__Title",a.titleElement.addEventListener("click",(function(t){a.appData&&a.appData.selectionManager?a.appData.selectionManager.pickingModeActive()?a.appData.selectionManager.pick(a.treeItem):a.appData.selectionManager.toggleItemSelection(a.treeItem,!t.ctrlKey):a.treeItem.setSelected(!a.treeItem.getSelected())})),a.itemHeader.appendChild(a.titleElement),i.appendChild(a.itemContainer);return a}e.prototype.setTreeItem=function(t,e){var a=this;this.treeItem=t,this.appData=e,this.titleElement.textContent=t.getName();this.treeItem.nameChanged.connect((function(){a.titleElement.textContent=t.getName()})),this.updateSelectedId=this.treeItem.selectedChanged.connect(this.updateSelected.bind(this)),this.updateSelected(),t instanceof Tl&&(this.toggleVisibilityBtn=document.createElement("button"),this.toggleVisibilityBtn.className="TreeNodesListItem__ToggleVisibility",this.itemHeader.insertBefore(this.toggleVisibilityBtn,this.titleElement),this.toggleVisibilityBtn.innerHTML='<i class="material-icons-outlined md-15">visibility</i>',this.toggleVisibilityBtn.addEventListener("click",(function(){var t=a.treeItem.getParameter("Visible");if(a.appData&&a.appData.undoRedoManager){var e=new ParameterValueChange(t,!t.getValue());a.appData.undoRedoManager.addChange(e)}else t.setValue(!t.getValue())})),this.updateVisibilityId=this.treeItem.visibilityChanged.connect(this.updateVisibility.bind(this)),this.updateVisibility(),this.updateHighlightId=this.treeItem.highlightChanged.connect(this.updateHighlight.bind(this)),this.updateHighlight(),this.treeItem.getChildren().length&&this.collapse(),this.childAddedId=this.treeItem.childAdded.connect(this.childAdded.bind(this)),this.childRemovedId=this.treeItem.childRemoved.connect(this.childRemoved.bind(this)))};e.prototype.updateVisibility=function(){var t=this.treeItem.getVisible();t?this.itemContainer.classList.remove("TreeNodesListItem--isHidden"):this.itemContainer.classList.add("TreeNodesListItem--isHidden"),this.toggleVisibilityBtn.innerHTML=t?'<i class="material-icons-outlined md-15">visibility</i>':'<i class="material-icons-outlined md-15">visibility_off</i>'};e.prototype.updateSelected=function(){this.treeItem.getSelected()?this.itemContainer.classList.add("TreeNodesListItem--isSelected"):this.itemContainer.classList.remove("TreeNodesListItem--isSelected")};e.prototype.updateHighlight=function(){var t=this.treeItem.isHighlighted();if(t?this.itemContainer.classList.add("TreeNodesListItem--isHighlighted"):this.itemContainer.classList.remove("TreeNodesListItem--isHighlighted"),t){var e=this.treeItem.getHighlight(),a=e.lerp(new An(.75,.75,.75,0),.5);this.titleElement.style.setProperty("border-color",e.toHex()),this.titleElement.style.setProperty("background-color",a.toHex())}else this.titleElement.style.removeProperty("border-color"),this.titleElement.style.removeProperty("background-color")};e.prototype.expand=function(){var t=this;if(this.expanded=!0,this.itemChildren.classList.remove("TreeNodesList--collapsed"),this.expandBtn.innerHTML='<i class="material-icons md-24">arrow_drop_down</i>',!this.childrenAlreadyCreated){this.treeItem.getChildren().forEach((function(e,a){t.addChild(e,a)})),this.childrenAlreadyCreated=!0}};e.prototype.collapse=function(){this.itemChildren.classList.add("TreeNodesList--collapsed"),this.expandBtn.innerHTML='<i class="material-icons md-24">arrow_right</i>',this.expanded=!1};e.prototype.addChild=function(t,e){if(this.expanded){var a=document.createElement("tree-item-view");a.setTreeItem(t,this.appData),e==this.itemChildren.childElementCount?this.itemChildren.appendChild(a):this.itemChildren.insertBefore(a,this.itemChildren.children[e])}else this.collapse()};e.prototype.childAdded=function(t,e){this.addChild(t,e)};e.prototype.childRemoved=function(t,e){this.expanded&&(this.itemChildren.children[e].destroy(),this.itemChildren.removeChild(this.itemChildren.children[e]))};e.prototype.destroy=function(){this.treeItem.selectedChanged.disconnectId(this.updateSelectedId),this.treeItem instanceof Tl&&(this.treeItem.highlightChanged.disconnectId(this.updateHighlightId),this.treeItem.visibilityChanged.disconnectId(this.updateVisibilityId),this.treeItem.childAdded.disconnectId(this.childAddedId),this.treeItem.childRemoved.disconnectId(this.childRemovedId))};return e}(HTMLElement);zc.css="\n  /* tree-view.css */\n\n  ////\n  /// From https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined\n\n  /* fallback */\n  @font-face {\n    font-family: 'Material Icons';\n    font-style: normal;\n    font-weight: 400;\n    src: url(https://fonts.gstatic.com/s/materialicons/v48/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2');\n  }\n  /* fallback */\n  @font-face {\n    font-family: 'Material Icons Outlined';\n    font-style: normal;\n    font-weight: 400;\n    src: url(https://fonts.gstatic.com/s/materialiconsoutlined/v14/gok-H7zzDkdnRel8-DQ6KAXJ69wP1tGnf4ZGhUce.woff2) format('woff2');\n  }\n\n  .material-icons {\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: 1;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n\n  .material-icons-outlined {\n    font-family: 'Material Icons Outlined';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: 1;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n  .TreeNodesList {\n    border-left: 1px dotted;\n    list-style-type: none;\n    padding: 0 0 0 15px;\n    margin: 0 0 0 10px;\n  }\n\n  .TreeNodesList--collapsed {\n    display: none;\n  }\n\n  .TreeNodesList--root {\n    border: none;\n    margin: 0;\n    padding: 0;\n    width: max-content;\n  }\n\n  .TreeNodesListItem{\n    display: flex;\n  }\n\n  .TreeNodesListItem__ToggleVisibility {\n    border: none;\n    color: #333;\n    height: 24px;\n    padding: 0;\n    width: 25px;\n  }\n\n  .TreeNodesListItem__ToggleVisibility:focus {\n    outline: none;\n  }\n\n  .TreeNodesListItem__ToggleExpanded {\n    border: none;\n    height: 24px;\n    width: 24px;\n    padding: 0;\n    background-color: #0000;\n    outline: none;\n  }\n\n  .TreeNodesListItem::before {\n    border-bottom: 1px dotted;\n    content: '';\n    display: inline-block;\n    left: -15px;\n    position: relative;\n    top: -5px;\n    width: 10px;\n  }\n\n  .TreeNodesListItem__Toggle:focus {\n    outline: none;\n  }\n\n  .TreeNodeHeader{\n    display: flex;\n    margin: 0.4em auto;\n  }\n\n  .TreeNodesListItem__Title {\n    cursor: default;\n    padding: 2px 4px;\n    border-radius: 5px;\n  }\n\n  .TreeNodesListItem__Title:hover {\n    background-color: #e1f5fe;\n  }\n  .TreeNodesListItem__Hover {\n    background-color: #e1f5fe;\n  }\n\n  .TreeNodesListItem__Dragging {\n    background-color: #e1f5fe;\n  }\n\n  .TreeNodesListItem--isSelected > .TreeNodeHeader > .TreeNodesListItem__Title {\n    background-color: #76d2bb;\n    color: #3B3B3B;\n  }\n\n  .TreeNodesListItem--isHidden > .TreeNodeHeader >  .TreeNodesListItem__Title {\n    color: #9e9e9e;\n  }\n\n  .TreeNodesListItem--isHighlighted > .TreeNodeHeader >  .TreeNodesListItem__Title {\n    border-style: solid;\n    border-width: thin;\n  }\n\n  /* Rules for sizing the icon. */\n  .material-icons-outlined.md-15,\n  .material-icons.md-15 {\n    font-size: 15px;\n  }\n  .material-icons.md-18 {\n    font-size: 18px;\n  }\n  .material-icons.md-24 {\n    font-size: 24px;\n  }\n  .material-icons.md-36 {\n    font-size: 36px;\n  }\n  .material-icons.md-48 {\n    font-size: 48px;\n  }\n\n  /* Rules for using icons as black on a light background. */\n  .material-icons.md-dark {\n    color: rgba(0, 0, 0, 0.54);\n  }\n  .material-icons.md-dark.md-inactive {\n    color: rgba(0, 0, 0, 0.26);\n  }\n\n  /* Rules for using icons as white on a dark background. */\n  .material-icons.md-light {\n    color: rgba(255, 255, 255, 1);\n  }\n  .material-icons.md-light.md-inactive {\n    color: rgba(255, 255, 255, 0.3);\n  }\n\n  ";customElements.get("tree-item-view")||customElements.define("tree-item-view",zc);var Uc=function(t){__extends(e,t);function e(){var e=t.call(this)||this;var a=e.attachShadow({mode:"open"});e.treeContainer=document.createElement("div"),a.appendChild(e.treeContainer),e.treeItemView=document.createElement("tree-item-view");var i=new CSSStyleSheet;i.replaceSync("@font-face {\n      font-family: \"Material Icons\";\n      font-style: normal;\n      font-weight: 400;\n      src: url('https://fonts.gstatic.com/s/materialicons/v48/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2') format('woff');\n    }");var n=new CSSStyleSheet;n.replaceSync("@font-face {\n      font-family: \"Material Icons Outlined\";\n      font-style: normal;\n      font-weight: 400;\n      src: url('https://fonts.gstatic.com/s/materialiconsoutlined/v14/gok-H7zzDkdnRel8-DQ6KAXJ69wP1tGnf4ZGhUce.woff2') format('woff');\n    }"),document.adoptedStyleSheets=__spreadArrays(document.adoptedStyleSheets,[i,n]);return e}e.prototype.setTreeItem=function(t,e){this.treeItemView.setTreeItem(t,e),this.treeContainer.appendChild(this.treeItemView)};return e}(HTMLElement);customElements.get("scene-tree-view")||customElements.define("scene-tree-view",Uc)}}}));