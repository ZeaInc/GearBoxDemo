System.register(["./p-d64ff0b9.system.js"],(function(t){"use strict";var e,s;return{setters:[function(t){e=t.s;s=t.e}],execute:function(){var o={JOIN_ROOM:"join-room",PING_ROOM:"ping-room",LEAVE_ROOM:"leave-room"};var i=function(){function t(t,e){this.userData=t,this.socketUrl=e,this.users={},this.userStreams={},this.callbacks={},this.envIsBrowser="undefined"!=typeof window}t.prototype.stopCamera=function(e){if(e===void 0){e=!0}this.stream&&(this.stream.getVideoTracks()[0].enabled=!1,e&&this.pub(t.actions.USER_VIDEO_STOPPED,{}))};t.prototype.startCamera=function(e){if(e===void 0){e=!0}this.stream&&(this.stream.getVideoTracks()[0].enabled=!0,e&&this.pub(t.actions.USER_VIDEO_STARTED,{}))};t.prototype.muteAudio=function(e){if(e===void 0){e=!0}this.stream&&(this.stream.getAudioTracks()[0].enabled=!1,e&&this.pub(t.actions.USER_VIDEO_STOPPED,{}))};t.prototype.unmuteAudio=function(e){if(e===void 0){e=!0}this.stream&&(this.stream.getAudioTracks()[0].enabled=!0,e&&this.pub(t.actions.USER_AUDIO_STARTED,{}))};t.prototype.getVideoStream=function(t){return this.userStreams[t]};t.prototype.setVideoStream=function(t,e){if(this.userStreams[e])return;var s=document.createElement("video");s.srcObject=t,this.userStreams[e]=s,s.onloadedmetadata=function(){s.play()},document.body.appendChild(s)};t.concatFullRoomId=function(t,e,s){return t+(e||"_ALL_FILES_")+(s||"_ALL_ROOMS_")};t.prototype.isJoiningTheSameRoom=function(e,s,o){return this.fullRoomId===t.concatFullRoomId(e,s,o)};t.prototype.joinRoom=function(i,r,n){var a=this;this.projectId=i,this.fileId=r,this.roomId=n,this.fullRoomId=t.concatFullRoomId(this.projectId,this.fileId,this.roomId),this.leaveRoom(),this.socket=e(this.socketUrl,{"sync disconnect on unload":!0,query:"userId="+this.userData.id+"&roomId="+this.fullRoomId}),s(e.Manager)(this.socket),this.socket.on("*",(function(t){var e=t.data,s=e[0],i=e[1];s in o||a._emit(s,i.payload,i.userId)})),this.envIsBrowser&&window.addEventListener("beforeunload",(function(){a.leaveRoom()})),this.pub(o.JOIN_ROOM),this.socket.on(o.JOIN_ROOM,(function(t){console.info(o.JOIN_ROOM+":",t);var e=t.userData;a._addUserIfNew(e),a.pub(o.PING_ROOM)})),this.socket.on(o.LEAVE_ROOM,(function(e){console.info(o.LEAVE_ROOM+":",e);var s=e.userData,i=s.id;if(i in a.users)return delete a.users[i],void a._emit(t.actions.USER_LEFT,s);console.warn("Outgoing user was not found in room.")})),this.socket.on(o.PING_ROOM,(function(t){console.info(o.PING_ROOM+":",t);var e=t.userData;a._addUserIfNew(e)}))};t.prototype._prepareMediaStream=function(){var t=this;return this.__streamPromise||(this.__streamPromise=new window.Promise((function(e,s){t.stream?e():navigator.mediaDevices.getUserMedia({audio:!0,video:{width:400,height:300}}).then((function(s){t.stream=s,t.stopCamera(!1),t.muteAudio(!1),e()})).catch((function(t){s(t)}))}))),this.__streamPromise};t.prototype.leaveRoom=function(){var e=this;this._emit(t.actions.LEFT_ROOM),this.users={},this.socket&&this.pub(o.LEAVE_ROOM,void 0,(function(){e.socket.close()}))};t.prototype._addUserIfNew=function(e){e.id in this.users||(this.users[e.id]=e,this._emit(t.actions.USER_JOINED,e))};t.prototype.createRoom=function(){return this.roomId=shortid.generate(),this.joinRoom(this.projectId,this.fileId,this.roomId),this.envIsBrowser&&window.history.pushState(null,null,"?project-id="+this.projectId+"&file-id="+this.fileId+"&room-id="+this.roomId),this.roomId};t.prototype.getUsers=function(){return this.users};t.prototype.getUser=function(t){return this.users[t]};t.prototype.pub=function(t,e,s){if(!t)throw new Error("Missing messageType");this.socket.emit(t,{userData:this.userData,userId:this.userData.id,payload:e},s)};t.prototype._emit=function(t,e,s){var o=this.callbacks[t];o&&o.forEach((function(t){return t(e,s)}))};t.prototype.sub=function(t,e){var s=this;if(!t)throw new Error("Missing messageType");if(!e)throw new Error("Missing callback");this.callbacks[t]=this.callbacks[t]||[],this.callbacks[t].push(e);return function(){s.callbacks[t].splice(s.callbacks[t].indexOf(e),1)}};return t}();t("i",i);i.actions={USER_JOINED:"user-joined",USER_VIDEO_STARTED:"user-video-started",USER_VIDEO_STOPPED:"user-video-stopped",USER_AUDIO_STARTED:"user-audio-started",USER_AUDIO_STOPPED:"user-audio-stopped",USER_LEFT:"user-left",LEFT_ROOM:"left-room",TEXT_MESSAGE:"text-message",POSE_CHANGED:"pose-message",COMMAND_ADDED:"command-added",COMMAND_UPDATED:"command-updated",FILE_WITH_PROGRESS:"file-with-progress"};var r=function(){function t(){}t.setSocketURL=function(t){this.socketUrl=t};t.getInstance=function(t,e,s,o){if(!this.session){if(!this.socketUrl)throw new Error("Missing #socketUrl. Call #setSocketURL first.");this.session=new i(t,this.socketUrl)}return this.session.isJoiningTheSameRoom(e,s,o)||this.session.joinRoom(e,s,o),this.session};t.getCurrentSession=function(){return this.session};return t}();t("o",r)}}}));