System.register(["./p-95ff8c2d.system.js","./p-29030769.system.js","./p-4b8c416c.system.js"],(function(e){"use strict";var t,r,n,i,o;return{setters:[function(e){t=e.c;r=e.a;n=e.b},function(e){i=e.p},function(e){o=e.E}],execute:function(){var a=t.MutationObserver||t.WebKitMutationObserver;var u;{if(a){var s=0;var f=new a(h);var c=t.document.createTextNode("");f.observe(c,{characterData:true});u=function(){c.data=s=++s%2}}else if(!t.setImmediate&&typeof t.MessageChannel!=="undefined"){var l=new t.MessageChannel;l.port1.onmessage=h;u=function(){l.port2.postMessage(0)}}else if("document"in t&&"onreadystatechange"in t.document.createElement("script")){u=function(){var e=t.document.createElement("script");e.onreadystatechange=function(){h();e.onreadystatechange=null;e.parentNode.removeChild(e);e=null};t.document.documentElement.appendChild(e)}}else{u=function(){setTimeout(h,0)}}}var d;var v=[];function h(){d=true;var e,t;var r=v.length;while(r){t=v;v=[];e=-1;while(++e<r){t[e]()}r=v.length}d=false}var p=y;function y(e){if(v.push(e)===1&&!d){u()}}var g=r((function(e){var t=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function e(){t(r);return r}}else{var n=new Array(16);e.exports=function e(){for(var t=0,r;t<16;t++){if((t&3)===0)r=Math.random()*4294967296;n[t]=r>>>((t&3)<<3)&255}return n}}}));var _=[];for(var m=0;m<256;++m){_[m]=(m+256).toString(16).substr(1)}function b(e,t){var r=t||0;var n=_;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}var w=b;var k;var j;var O=0;var q=0;function A(e,t,r){var n=t&&r||0;var i=t||[];e=e||{};var o=e.node||k;var a=e.clockseq!==undefined?e.clockseq:j;if(o==null||a==null){var u=g();if(o==null){o=k=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]}if(a==null){a=j=(u[6]<<8|u[7])&16383}}var s=e.msecs!==undefined?e.msecs:(new Date).getTime();var f=e.nsecs!==undefined?e.nsecs:q+1;var c=s-O+(f-q)/1e4;if(c<0&&e.clockseq===undefined){a=a+1&16383}if((c<0||s>O)&&e.nsecs===undefined){f=0}if(f>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}O=s;q=f;j=a;s+=122192928e5;var l=((s&268435455)*1e4+f)%4294967296;i[n++]=l>>>24&255;i[n++]=l>>>16&255;i[n++]=l>>>8&255;i[n++]=l&255;var d=s/4294967296*1e4&268435455;i[n++]=d>>>8&255;i[n++]=d&255;i[n++]=d>>>24&15|16;i[n++]=d>>>16&255;i[n++]=a>>>8|128;i[n++]=a&255;for(var v=0;v<6;++v){i[n+v]=o[v]}return t?t:w(i)}var $=A;function S(e,t,r){var n=t&&r||0;if(typeof e=="string"){t=e==="binary"?new Array(16):null;e=null}e=e||{};var i=e.random||(e.rng||g)();i[6]=i[6]&15|64;i[8]=i[8]&63|128;if(t){for(var o=0;o<16;++o){t[n+o]=i[o]}}return t||w(i)}var x=S;var E=x;E.v1=$;E.v4=x;var P=E;var C=r((function(e,t){(function(t){{e.exports=t()}})((function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];r+=(n&i|~n&o)+t[0]-680876936|0;r=(r<<7|r>>>25)+n|0;o+=(r&n|~r&i)+t[1]-389564586|0;o=(o<<12|o>>>20)+r|0;i+=(o&r|~o&n)+t[2]+606105819|0;i=(i<<17|i>>>15)+o|0;n+=(i&o|~i&r)+t[3]-1044525330|0;n=(n<<22|n>>>10)+i|0;r+=(n&i|~n&o)+t[4]-176418897|0;r=(r<<7|r>>>25)+n|0;o+=(r&n|~r&i)+t[5]+1200080426|0;o=(o<<12|o>>>20)+r|0;i+=(o&r|~o&n)+t[6]-1473231341|0;i=(i<<17|i>>>15)+o|0;n+=(i&o|~i&r)+t[7]-45705983|0;n=(n<<22|n>>>10)+i|0;r+=(n&i|~n&o)+t[8]+1770035416|0;r=(r<<7|r>>>25)+n|0;o+=(r&n|~r&i)+t[9]-1958414417|0;o=(o<<12|o>>>20)+r|0;i+=(o&r|~o&n)+t[10]-42063|0;i=(i<<17|i>>>15)+o|0;n+=(i&o|~i&r)+t[11]-1990404162|0;n=(n<<22|n>>>10)+i|0;r+=(n&i|~n&o)+t[12]+1804603682|0;r=(r<<7|r>>>25)+n|0;o+=(r&n|~r&i)+t[13]-40341101|0;o=(o<<12|o>>>20)+r|0;i+=(o&r|~o&n)+t[14]-1502002290|0;i=(i<<17|i>>>15)+o|0;n+=(i&o|~i&r)+t[15]+1236535329|0;n=(n<<22|n>>>10)+i|0;r+=(n&o|i&~o)+t[1]-165796510|0;r=(r<<5|r>>>27)+n|0;o+=(r&i|n&~i)+t[6]-1069501632|0;o=(o<<9|o>>>23)+r|0;i+=(o&n|r&~n)+t[11]+643717713|0;i=(i<<14|i>>>18)+o|0;n+=(i&r|o&~r)+t[0]-373897302|0;n=(n<<20|n>>>12)+i|0;r+=(n&o|i&~o)+t[5]-701558691|0;r=(r<<5|r>>>27)+n|0;o+=(r&i|n&~i)+t[10]+38016083|0;o=(o<<9|o>>>23)+r|0;i+=(o&n|r&~n)+t[15]-660478335|0;i=(i<<14|i>>>18)+o|0;n+=(i&r|o&~r)+t[4]-405537848|0;n=(n<<20|n>>>12)+i|0;r+=(n&o|i&~o)+t[9]+568446438|0;r=(r<<5|r>>>27)+n|0;o+=(r&i|n&~i)+t[14]-1019803690|0;o=(o<<9|o>>>23)+r|0;i+=(o&n|r&~n)+t[3]-187363961|0;i=(i<<14|i>>>18)+o|0;n+=(i&r|o&~r)+t[8]+1163531501|0;n=(n<<20|n>>>12)+i|0;r+=(n&o|i&~o)+t[13]-1444681467|0;r=(r<<5|r>>>27)+n|0;o+=(r&i|n&~i)+t[2]-51403784|0;o=(o<<9|o>>>23)+r|0;i+=(o&n|r&~n)+t[7]+1735328473|0;i=(i<<14|i>>>18)+o|0;n+=(i&r|o&~r)+t[12]-1926607734|0;n=(n<<20|n>>>12)+i|0;r+=(n^i^o)+t[5]-378558|0;r=(r<<4|r>>>28)+n|0;o+=(r^n^i)+t[8]-2022574463|0;o=(o<<11|o>>>21)+r|0;i+=(o^r^n)+t[11]+1839030562|0;i=(i<<16|i>>>16)+o|0;n+=(i^o^r)+t[14]-35309556|0;n=(n<<23|n>>>9)+i|0;r+=(n^i^o)+t[1]-1530992060|0;r=(r<<4|r>>>28)+n|0;o+=(r^n^i)+t[4]+1272893353|0;o=(o<<11|o>>>21)+r|0;i+=(o^r^n)+t[7]-155497632|0;i=(i<<16|i>>>16)+o|0;n+=(i^o^r)+t[10]-1094730640|0;n=(n<<23|n>>>9)+i|0;r+=(n^i^o)+t[13]+681279174|0;r=(r<<4|r>>>28)+n|0;o+=(r^n^i)+t[0]-358537222|0;o=(o<<11|o>>>21)+r|0;i+=(o^r^n)+t[3]-722521979|0;i=(i<<16|i>>>16)+o|0;n+=(i^o^r)+t[6]+76029189|0;n=(n<<23|n>>>9)+i|0;r+=(n^i^o)+t[9]-640364487|0;r=(r<<4|r>>>28)+n|0;o+=(r^n^i)+t[12]-421815835|0;o=(o<<11|o>>>21)+r|0;i+=(o^r^n)+t[15]+530742520|0;i=(i<<16|i>>>16)+o|0;n+=(i^o^r)+t[2]-995338651|0;n=(n<<23|n>>>9)+i|0;r+=(i^(n|~o))+t[0]-198630844|0;r=(r<<6|r>>>26)+n|0;o+=(n^(r|~i))+t[7]+1126891415|0;o=(o<<10|o>>>22)+r|0;i+=(r^(o|~n))+t[14]-1416354905|0;i=(i<<15|i>>>17)+o|0;n+=(o^(i|~r))+t[5]-57434055|0;n=(n<<21|n>>>11)+i|0;r+=(i^(n|~o))+t[12]+1700485571|0;r=(r<<6|r>>>26)+n|0;o+=(n^(r|~i))+t[3]-1894986606|0;o=(o<<10|o>>>22)+r|0;i+=(r^(o|~n))+t[10]-1051523|0;i=(i<<15|i>>>17)+o|0;n+=(o^(i|~r))+t[1]-2054922799|0;n=(n<<21|n>>>11)+i|0;r+=(i^(n|~o))+t[8]+1873313359|0;r=(r<<6|r>>>26)+n|0;o+=(n^(r|~i))+t[15]-30611744|0;o=(o<<10|o>>>22)+r|0;i+=(r^(o|~n))+t[6]-1560198380|0;i=(i<<15|i>>>17)+o|0;n+=(o^(i|~r))+t[13]+1309151649|0;n=(n<<21|n>>>11)+i|0;r+=(i^(n|~o))+t[4]-145523070|0;r=(r<<6|r>>>26)+n|0;o+=(n^(r|~i))+t[11]-1120210379|0;o=(o<<10|o>>>22)+r|0;i+=(r^(o|~n))+t[2]+718787259|0;i=(i<<15|i>>>17)+o|0;n+=(o^(i|~r))+t[9]-343485551|0;n=(n<<21|n>>>11)+i|0;e[0]=r+e[0]|0;e[1]=n+e[1]|0;e[2]=i+e[2]|0;e[3]=o+e[3]|0}function n(e){var t=[],r;for(r=0;r<64;r+=4){t[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24)}return t}function i(e){var t=[],r;for(r=0;r<64;r+=4){t[r>>2]=e[r]+(e[r+1]<<8)+(e[r+2]<<16)+(e[r+3]<<24)}return t}function o(e){var t=e.length,i=[1732584193,-271733879,-1732584194,271733878],o,a,u,s,f,c;for(o=64;o<=t;o+=64){r(i,n(e.substring(o-64,o)))}e=e.substring(o-64);a=e.length;u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<a;o+=1){u[o>>2]|=e.charCodeAt(o)<<(o%4<<3)}u[o>>2]|=128<<(o%4<<3);if(o>55){r(i,u);for(o=0;o<16;o+=1){u[o]=0}}s=t*8;s=s.toString(16).match(/(.*?)(.{0,8})$/);f=parseInt(s[2],16);c=parseInt(s[1],16)||0;u[14]=f;u[15]=c;r(i,u);return i}function a(e){var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],o,a,u,s,f,c;for(o=64;o<=t;o+=64){r(n,i(e.subarray(o-64,o)))}e=o-64<t?e.subarray(o-64):new Uint8Array(0);a=e.length;u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<a;o+=1){u[o>>2]|=e[o]<<(o%4<<3)}u[o>>2]|=128<<(o%4<<3);if(o>55){r(n,u);for(o=0;o<16;o+=1){u[o]=0}}s=t*8;s=s.toString(16).match(/(.*?)(.{0,8})$/);f=parseInt(s[2],16);c=parseInt(s[1],16)||0;u[14]=f;u[15]=c;r(n,u);return n}function u(e){var r="",n;for(n=0;n<4;n+=1){r+=t[e>>n*8+4&15]+t[e>>n*8&15]}return r}function s(e){var t;for(t=0;t<e.length;t+=1){e[t]=u(e[t])}return e.join("")}if(s(o("hello"))!=="5d41402abc4b2a76b9719d911017c592");if(typeof ArrayBuffer!=="undefined"&&!ArrayBuffer.prototype.slice){(function(){function t(e,t){e=e|0||0;if(e<0){return Math.max(e+t,0)}return Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i=this.byteLength,o=t(r,i),a=i,u,s,f,c;if(n!==e){a=t(n,i)}if(o>a){return new ArrayBuffer(0)}u=a-o;s=new ArrayBuffer(u);f=new Uint8Array(s);c=new Uint8Array(this,o,u);f.set(c);return s}})()}function f(e){if(/[\u0080-\uFFFF]/.test(e)){e=unescape(encodeURIComponent(e))}return e}function c(e,t){var r=e.length,n=new ArrayBuffer(r),i=new Uint8Array(n),o;for(o=0;o<r;o+=1){i[o]=e.charCodeAt(o)}return t?i:n}function l(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function d(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);n.set(new Uint8Array(e));n.set(new Uint8Array(t),e.byteLength);return r?n:n.buffer}function v(e){var t=[],r=e.length,n;for(n=0;n<r-1;n+=2){t.push(parseInt(e.substr(n,2),16))}return String.fromCharCode.apply(String,t)}function h(){this.reset()}h.prototype.append=function(e){this.appendBinary(f(e));return this};h.prototype.appendBinary=function(e){this._buff+=e;this._length+=e.length;var t=this._buff.length,i;for(i=64;i<=t;i+=64){r(this._hash,n(this._buff.substring(i-64,i)))}this._buff=this._buff.substring(i-64);return this};h.prototype.end=function(e){var t=this._buff,r=t.length,n,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o;for(n=0;n<r;n+=1){i[n>>2]|=t.charCodeAt(n)<<(n%4<<3)}this._finish(i,r);o=s(this._hash);if(e){o=v(o)}this.reset();return o};h.prototype.reset=function(){this._buff="";this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878];return this};h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}};h.prototype.setState=function(e){this._buff=e.buff;this._length=e.length;this._hash=e.hash;return this};h.prototype.destroy=function(){delete this._hash;delete this._buff;delete this._length};h.prototype._finish=function(e,t){var n=t,i,o,a;e[n>>2]|=128<<(n%4<<3);if(n>55){r(this._hash,e);for(n=0;n<16;n+=1){e[n]=0}}i=this._length*8;i=i.toString(16).match(/(.*?)(.{0,8})$/);o=parseInt(i[2],16);a=parseInt(i[1],16)||0;e[14]=o;e[15]=a;r(this._hash,e)};h.hash=function(e,t){return h.hashBinary(f(e),t)};h.hashBinary=function(e,t){var r=o(e),n=s(r);return t?v(n):n};h.ArrayBuffer=function(){this.reset()};h.ArrayBuffer.prototype.append=function(e){var t=d(this._buff.buffer,e,true),n=t.length,o;this._length+=e.byteLength;for(o=64;o<=n;o+=64){r(this._hash,i(t.subarray(o-64,o)))}this._buff=o-64<n?new Uint8Array(t.buffer.slice(o-64)):new Uint8Array(0);return this};h.ArrayBuffer.prototype.end=function(e){var t=this._buff,r=t.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i,o;for(i=0;i<r;i+=1){n[i>>2]|=t[i]<<(i%4<<3)}this._finish(n,r);o=s(this._hash);if(e){o=v(o)}this.reset();return o};h.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._hash=[1732584193,-271733879,-1732584194,271733878];return this};h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);e.buff=l(e.buff);return e};h.ArrayBuffer.prototype.setState=function(e){e.buff=c(e.buff,true);return h.prototype.setState.call(this,e)};h.ArrayBuffer.prototype.destroy=h.prototype.destroy;h.ArrayBuffer.prototype._finish=h.prototype._finish;h.ArrayBuffer.hash=function(e,t){var r=a(new Uint8Array(e)),n=s(r);return t?v(n):n};return h}))}));var D=function e(t){var r=[];r.push({obj:t});var n="";var i,o,a,u,s,f,c,l,d,v,h;while(i=r.pop()){o=i.obj;a=i.prefix||"";u=i.val||"";n+=a;if(u){n+=u}else if(typeof o!=="object"){n+=typeof o==="undefined"?null:JSON.stringify(o)}else if(o===null){n+="null"}else if(Array.isArray(o)){r.push({val:"]"});for(s=o.length-1;s>=0;s--){f=s===0?"":",";r.push({obj:o[s],prefix:f})}r.push({val:"["})}else{c=[];for(l in o){if(o.hasOwnProperty(l)){c.push(l)}}r.push({val:"}"});for(s=c.length-1;s>=0;s--){d=c[s];v=o[d];h=s>0?",":"";h+=JSON.stringify(d)+":";r.push({obj:v,prefix:h})}r.push({val:"{"})}}return n};function I(e,t,r){var n=r[r.length-1];if(e===n.element){r.pop();n=r[r.length-1]}var i=n.element;var o=n.index;if(Array.isArray(i)){i.push(e)}else if(o===t.length-2){var a=t.pop();i[a]=e}else{t.push(e)}}var B=function(e){var t=[];var r=[];var n=0;var i,o,a;var u,s,f,c;var l,d;while(true){i=e[n++];if(i==="}"||i==="]"||typeof i==="undefined"){if(t.length===1){return t.pop()}else{I(t.pop(),t,r);continue}}switch(i){case" ":case"\t":case"\n":case":":case",":break;case"n":n+=3;I(null,t,r);break;case"t":n+=3;I(true,t,r);break;case"f":n+=4;I(false,t,r);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":o="";n--;while(true){a=e[n++];if(/[\d\.\-e\+]/.test(a)){o+=a}else{n--;break}}I(parseFloat(o),t,r);break;case'"':u="";s=void 0;f=0;while(true){c=e[n++];if(c!=='"'||s==="\\"&&f%2===1){u+=c;s=c;if(s==="\\"){f++}else{f=0}}else{break}}I(JSON.parse('"'+u+'"'),t,r);break;case"[":l={element:[],index:t.length};t.push(l.element);r.push(l);break;case"{":d={element:{},index:t.length};t.push(d.element);r.push(d);break;default:throw new Error("unexpectedly reached end of input: "+i)}}};var L={stringify:D,parse:B};var T=M;function M(e){return function(){var t=arguments.length;if(t){var r=[];var n=-1;while(++n<t){r[n]=arguments[n]}return e.call(this,r)}else{return e.call(this,[])}}}var N=r((function(e){if(typeof Object.create==="function"){e.exports=function e(t,r){if(r){t.super_=r;t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}}else{e.exports=function e(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype;t.prototype=new n;t.prototype.constructor=t}}}}));function R(e){return"$"+e}function F(e){return e.substring(1)}function U(){this._store={}}U.prototype.get=function(e){var t=R(e);return this._store[t]};U.prototype.set=function(e,t){var r=R(e);this._store[r]=t;return true};U.prototype.has=function(e){var t=R(e);return t in this._store};U.prototype.delete=function(e){var t=R(e);var r=t in this._store;delete this._store[t];return r};U.prototype.forEach=function(e){var t=Object.keys(this._store);for(var r=0,n=t.length;r<n;r++){var i=t[r];var o=this._store[i];i=F(i);e(o,i)}};Object.defineProperty(U.prototype,"size",{get:function(){return Object.keys(this._store).length}});function J(e){this._store=new U;if(e&&Array.isArray(e)){for(var t=0,r=e.length;t<r;t++){this.add(e[t])}}}J.prototype.add=function(e){return this._store.set(e,true)};J.prototype.has=function(e){return this._store.has(e)};J.prototype.forEach=function(e){this._store.forEach((function(t,r){e(r)}))};Object.defineProperty(J.prototype,"size",{get:function(){return this._store.size}});function z(){if(typeof Symbol==="undefined"||typeof Map==="undefined"||typeof Set==="undefined"){return false}var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var K;var V;{if(z()){K=Set;V=Map}else{K=J;V=U}}function W(e){return typeof ArrayBuffer!=="undefined"&&e instanceof ArrayBuffer||typeof Blob!=="undefined"&&e instanceof Blob}function G(e){if(typeof e.slice==="function"){return e.slice(0)}var t=new ArrayBuffer(e.byteLength);var r=new Uint8Array(t);var n=new Uint8Array(e);r.set(n);return t}function Q(e){if(e instanceof ArrayBuffer){return G(e)}var t=e.size;var r=e.type;if(typeof e.slice==="function"){return e.slice(0,t,r)}return e.webkitSlice(0,t,r)}var Z=Function.prototype.toString;var X=Z.call(Object);function Y(e){var t=Object.getPrototypeOf(e);if(t===null){return true}var r=t.constructor;return typeof r=="function"&&r instanceof r&&Z.call(r)==X}function H(e){var t;var r;var n;if(!e||typeof e!=="object"){return e}if(Array.isArray(e)){t=[];for(r=0,n=e.length;r<n;r++){t[r]=H(e[r])}return t}if(e instanceof Date){return e.toISOString()}if(W(e)){return Q(e)}if(!Y(e)){return e}t={};for(r in e){if(Object.prototype.hasOwnProperty.call(e,r)){var i=H(e[r]);if(typeof i!=="undefined"){t[r]=i}}}return t}function ee(e){var t=false;return T((function(r){if(t){throw new Error("once called more than once")}else{t=true;e.apply(this,r)}}))}function te(e){return T((function(t){t=H(t);var r=this;var n=typeof t[t.length-1]==="function"?t.pop():false;var i=new Promise((function(n,i){var o;try{var a=ee((function(e,t){if(e){i(e)}else{n(t)}}));t.push(a);o=e.apply(r,t);if(o&&typeof o.then==="function"){n(o)}}catch(u){i(u)}}));if(n){i.then((function(e){n(null,e)}),n)}return i}))}function re(e,t,r){if(e.constructor.listeners("debug").length){var n=["api",e.name,t];for(var i=0;i<r.length-1;i++){n.push(r[i])}e.constructor.emit("debug",n);var o=r[r.length-1];r[r.length-1]=function(r,n){var i=["api",e.name,t];i=i.concat(r?["error",r]:["success",n]);e.constructor.emit("debug",i);o(r,n)}}}function ne(e,t){return te(T((function(r){if(this._closed){return Promise.reject(new Error("database is closed"))}if(this._destroyed){return Promise.reject(new Error("database is destroyed"))}var n=this;re(n,e,r);if(!this.taskqueue.isReady){return new Promise((function(t,i){n.taskqueue.addTask((function(o){if(o){i(o)}else{t(n[e].apply(n,r))}}))}))}return t.apply(this,r)})))}function ie(e,t){var r={};for(var n=0,i=t.length;n<i;n++){var o=t[n];if(o in e){r[o]=e[o]}}return r}var oe=6;function ae(e){return e}function ue(e){return[{ok:e}]}function se(e,t,r){var n=t.docs;var i=new V;n.forEach((function(e){if(i.has(e.id)){i.get(e.id).push(e)}else{i.set(e.id,[e])}}));var o=i.size;var a=0;var u=new Array(o);function s(){var e=[];u.forEach((function(t){t.docs.forEach((function(r){e.push({id:t.id,docs:[r]})}))}));r(null,{results:e})}function f(){if(++a===o){s()}}function c(e,t,r){u[e]={id:t,docs:r};f()}var l=[];i.forEach((function(e,t){l.push(t)}));var d=0;function v(){if(d>=l.length){return}var e=Math.min(d+oe,l.length);var t=l.slice(d,e);h(t,d);d+=t.length}function h(r,n){r.forEach((function(r,o){var a=n+o;var u=i.get(r);var s=ie(u[0],["atts_since","attachments"]);s.open_revs=u.map((function(e){return e.rev}));s.open_revs=s.open_revs.filter(ae);var f=ae;if(s.open_revs.length===0){delete s.open_revs;f=ue}["revs","attachments","binary","ajax","latest"].forEach((function(e){if(e in t){s[e]=t[e]}}));e.get(r,s,(function(e,t){var n;if(e){n=[{error:e}]}else{n=f(t)}c(a,r,n);v()}))}))}v()}var fe;try{localStorage.setItem("_pouch_check_localstorage",1);fe=!!localStorage.getItem("_pouch_check_localstorage")}catch(Mf){fe=false}function ce(){return fe}N(de,o);function le(e){if(ce()){addEventListener("storage",(function(t){e.emit(t.key)}))}}function de(){o.call(this);this._listeners={};le(this)}de.prototype.addListener=function(e,t,r,n){if(this._listeners[t]){return}var i=this;var o=false;function a(){if(!i._listeners[t]){return}if(o){o="waiting";return}o=true;var e=ie(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function u(){o=false}r.changes(e).on("change",(function(e){if(e.seq>n.since&&!n.cancelled){n.since=e.seq;n.onChange(e)}})).on("complete",(function(){if(o==="waiting"){p(a)}o=false})).on("error",u)}this._listeners[t]=a;this.on(e,a)};de.prototype.removeListener=function(e,t){if(!(t in this._listeners)){return}o.prototype.removeListener.call(this,e,this._listeners[t]);delete this._listeners[t]};de.prototype.notifyLocalWindows=function(e){if(ce()){localStorage[e]=localStorage[e]==="a"?"b":"a"}};de.prototype.notify=function(e){this.emit(e);this.notifyLocalWindows(e)};function ve(e){if(typeof console!=="undefined"&&typeof console[e]==="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function he(e,t){var r=6e5;e=parseInt(e,10)||0;t=parseInt(t,10);if(t!==t||t<=e){t=(e||1)<<1}else{t=t+1}if(t>r){e=r>>1;t=r}var n=Math.random();var i=t-e;return~~(i*n+e)}function pe(e){var t=0;if(!e){t=2e3}return he(e,t)}function ye(e,t){ve("info","The above "+e+" is totally normal. "+t)}var ge;{if(typeof Object.assign==="function"){ge=Object.assign}else{ge=function(e){var t=Object(e);for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!=null){for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i)){t[i]=n[i]}}}}return t}}}var _e=ge;N(me,Error);function me(e,t,r){Error.call(this,r);this.status=e;this.name=t;this.message=r;this.error=true}me.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var be=new me(401,"unauthorized","Name or password is incorrect.");var we=new me(400,"bad_request","Missing JSON list of 'docs'");var ke=new me(404,"not_found","missing");var je=new me(409,"conflict","Document update conflict");var Oe=new me(400,"bad_request","_id field must contain a string");var qe=new me(412,"missing_id","_id is required for puts");var Ae=new me(400,"bad_request","Only reserved document ids may start with underscore.");var $e=new me(412,"precondition_failed","Database not open");var Se=new me(500,"unknown_error","Database encountered an unknown error");var xe=new me(500,"badarg","Some query argument is invalid");var Ee=new me(400,"invalid_request","Request was invalid");var Pe=new me(400,"query_parse_error","Some query parameter is invalid");var Ce=new me(500,"doc_validation","Bad special document member");var De=new me(400,"bad_request","Something wrong with the request");var Ie=new me(400,"bad_request","Document must be a JSON object");var Be=new me(404,"not_found","Database not found");var Le=new me(500,"indexed_db_went_bad","unknown");var Te=new me(500,"web_sql_went_bad","unknown");var Me=new me(500,"levelDB_went_went_bad","unknown");var Ne=new me(403,"forbidden","Forbidden by design doc validate_doc_update function");var Re=new me(400,"bad_request","Invalid rev format");var Fe=new me(412,"file_exists","The database could not be created, the file already exists.");var Ue=new me(412,"missing_stub","A pre-existing attachment stub wasn't found");var Je=new me(413,"invalid_url","Provided URL is invalid");function ze(e,t){function r(t){for(var r in e){if(typeof e[r]!=="function"){this[r]=e[r]}}if(t!==undefined){this.reason=t}}r.prototype=me.prototype;return new r(t)}function Ke(e){if(typeof e!=="object"){var t=e;e=Se;e.data=t}if("error"in e&&e.error==="conflict"){e.name="conflict";e.status=409}if(!("name"in e)){e.name=e.error||"unknown"}if(!("status"in e)){e.status=500}if(!("message"in e)){e.message=e.message||e.reason}return e}function Ve(e,t,r){try{return!e(t,r)}catch(i){var n="Filter function threw: "+i.toString();return ze(De,n)}}function We(e){var t={};var r=e.filter&&typeof e.filter==="function";t.query=e.query_params;return function n(i){if(!i.doc){i.doc={}}var o=r&&Ve(e.filter,i.doc,t);if(typeof o==="object"){return o}if(o){return false}if(!e.include_docs){delete i.doc}else if(!e.attachments){for(var a in i.doc._attachments){if(i.doc._attachments.hasOwnProperty(a)){i.doc._attachments[a].stub=true}}}return true}}function Ge(e){var t=[];for(var r=0,n=e.length;r<n;r++){t=t.concat(e[r])}return t}function Qe(e){var t;if(!e){t=ze(qe)}else if(typeof e!=="string"){t=ze(Oe)}else if(/^_/.test(e)&&!/^_(design|local)/.test(e)){t=ze(Ae)}if(t){throw t}}function Ze(e){if(typeof e._remote==="boolean"){return e._remote}if(typeof e.type==="function"){ve("warn","db.type() is deprecated and will be removed in "+"a future version of PouchDB");return e.type()==="http"}return false}function Xe(e,t){return"listenerCount"in e?e.listenerCount(t):o.listenerCount(e,t)}function Ye(e){if(!e){return null}var t=e.split("/");if(t.length===2){return t}if(t.length===1){return[e,e]}return null}function He(e){var t=Ye(e);return t?t.join("/"):null}var et=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];var tt="queryKey";var rt=/(?:^|&)([^&=]*)=?([^&]*)/g;var nt=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function it(e){var t=nt.exec(e);var r={};var n=14;while(n--){var i=et[n];var o=t[n]||"";var a=["user","password"].indexOf(i)!==-1;r[i]=a?decodeURIComponent(o):o}r[tt]={};r[et[12]].replace(rt,(function(e,t,n){if(t){r[tt][t]=n}}));return r}function ot(e,t){var r=[];var n=[];for(var i in t){if(t.hasOwnProperty(i)){r.push(i);n.push(t[i])}}r.push(e);return Function.apply(null,r).apply(null,n)}function at(e,t,r){return new Promise((function(n,i){e.get(t,(function(o,a){if(o){if(o.status!==404){return i(o)}a={}}var u=a._rev;var s=r(a);if(!s){return n({updated:false,rev:u})}s._id=t;s._rev=u;n(ut(e,s,r))}))}))}function ut(e,t,r){return e.put(t).then((function(e){return{updated:true,rev:e.rev}}),(function(n){if(n.status!==409){throw n}return at(e,t._id,r)}))}var st=function(e){return atob(e)};var ft=function(e){return btoa(e)};function ct(e,t){e=e||[];t=t||{};try{return new Blob(e,t)}catch(Mf){if(Mf.name!=="TypeError"){throw Mf}var r=typeof BlobBuilder!=="undefined"?BlobBuilder:typeof MSBlobBuilder!=="undefined"?MSBlobBuilder:typeof MozBlobBuilder!=="undefined"?MozBlobBuilder:WebKitBlobBuilder;var n=new r;for(var i=0;i<e.length;i+=1){n.append(e[i])}return n.getBlob(t.type)}}function lt(e){var t=e.length;var r=new ArrayBuffer(t);var n=new Uint8Array(r);for(var i=0;i<t;i++){n[i]=e.charCodeAt(i)}return r}function dt(e,t){return ct([lt(e)],{type:t})}function vt(e,t){return dt(st(e),t)}function ht(e){var t="";var r=new Uint8Array(e);var n=r.byteLength;for(var i=0;i<n;i++){t+=String.fromCharCode(r[i])}return t}function pt(e,t){var r=new FileReader;var n=typeof r.readAsBinaryString==="function";r.onloadend=function(e){var r=e.target.result||"";if(n){return t(r)}t(ht(r))};if(n){r.readAsBinaryString(e)}else{r.readAsArrayBuffer(e)}}function yt(e,t){pt(e,(function(e){t(e)}))}function gt(e,t){yt(e,(function(e){t(ft(e))}))}function _t(e,t){var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)};r.readAsArrayBuffer(e)}var mt=n.setImmediate||n.setTimeout;var bt=32768;function wt(e){return ft(e)}function kt(e,t,r){if(e.webkitSlice){return e.webkitSlice(t,r)}return e.slice(t,r)}function jt(e,t,r,n,i){if(r>0||n<t.size){t=kt(t,r,n)}_t(t,(function(t){e.append(t);i()}))}function Ot(e,t,r,n,i){if(r>0||n<t.length){t=t.substring(r,n)}e.appendBinary(t);i()}function qt(e,t){var r=typeof e==="string";var n=r?e.length:e.size;var i=Math.min(bt,n);var o=Math.ceil(n/i);var a=0;var u=r?new C:new C.ArrayBuffer;var s=r?Ot:jt;function f(){mt(l)}function c(){var e=u.end(true);var r=wt(e);t(r);u.destroy()}function l(){var t=a*i;var r=t+i;a++;if(a<o){s(u,e,t,r,f)}else{s(u,e,t,r,c)}}l()}function At(e){return C.hash(e)}function $t(e,t){var r=H(e);if(!t){return P.v4().replace(/-/g,"").toLowerCase()}delete r._rev_tree;return At(JSON.stringify(r))}var St=P.v4;function xt(e){var t;var r;var n;var i=e.rev_tree.slice();var o;while(o=i.pop()){var a=o.ids;var u=a[2];var s=o.pos;if(u.length){for(var f=0,c=u.length;f<c;f++){i.push({pos:s+1,ids:u[f]})}continue}var l=!!a[1].deleted;var d=a[0];if(!t||(n!==l?n:r!==s?r<s:t<d)){t=d;r=s;n=l}}return r+"-"+t}function Et(e,t){var r=e.slice();var n;while(n=r.pop()){var i=n.pos;var o=n.ids;var a=o[2];var u=t(a.length===0,i,o[0],n.ctx,o[1]);for(var s=0,f=a.length;s<f;s++){r.push({pos:i+1,ids:a[s],ctx:u})}}}function Pt(e,t){return e.pos-t.pos}function Ct(e){var t=[];Et(e,(function(e,r,n,i,o){if(e){t.push({rev:r+"-"+n,pos:r,opts:o})}}));t.sort(Pt).reverse();for(var r=0,n=t.length;r<n;r++){delete t[r].pos}return t}function Dt(e){var t=xt(e);var r=Ct(e.rev_tree);var n=[];for(var i=0,o=r.length;i<o;i++){var a=r[i];if(a.rev!==t&&!a.opts.deleted){n.push(a.rev)}}return n}function It(e){var t=[];Et(e.rev_tree,(function(e,r,n,i,o){if(o.status==="available"&&!e){t.push(r+"-"+n);o.status="missing"}}));return t}function Bt(e){var t=[];var r=e.slice();var n;while(n=r.pop()){var i=n.pos;var o=n.ids;var a=o[0];var u=o[1];var s=o[2];var f=s.length===0;var c=n.history?n.history.slice():[];c.push({id:a,opts:u});if(f){t.push({pos:i+1-c.length,ids:c})}for(var l=0,d=s.length;l<d;l++){r.push({pos:i+1,ids:s[l],history:c})}}return t.reverse()}function Lt(e,t){return e.pos-t.pos}function Tt(e,t,r){var n=0;var i=e.length;var o;while(n<i){o=n+i>>>1;if(r(e[o],t)<0){n=o+1}else{i=o}}return n}function Mt(e,t,r){var n=Tt(e,t,r);e.splice(n,0,t)}function Nt(e,t){var r;var n;for(var i=t,o=e.length;i<o;i++){var a=e[i];var u=[a.id,a.opts,[]];if(n){n[2].push(u);n=u}else{r=n=u}}return r}function Rt(e,t){return e[0]<t[0]?-1:1}function Ft(e,t){var r=[{tree1:e,tree2:t}];var n=false;while(r.length>0){var i=r.pop();var o=i.tree1;var a=i.tree2;if(o[1].status||a[1].status){o[1].status=o[1].status==="available"||a[1].status==="available"?"available":"missing"}for(var u=0;u<a[2].length;u++){if(!o[2][0]){n="new_leaf";o[2][0]=a[2][u];continue}var s=false;for(var f=0;f<o[2].length;f++){if(o[2][f][0]===a[2][u][0]){r.push({tree1:o[2][f],tree2:a[2][u]});s=true}}if(!s){n="new_branch";Mt(o[2],a[2][u],Rt)}}}return{conflicts:n,tree:e}}function Ut(e,t,r){var n=[];var i=false;var o=false;var a;if(!e.length){return{tree:[t],conflicts:"new_leaf"}}for(var u=0,s=e.length;u<s;u++){var f=e[u];if(f.pos===t.pos&&f.ids[0]===t.ids[0]){a=Ft(f.ids,t.ids);n.push({pos:f.pos,ids:a.tree});i=i||a.conflicts;o=true}else if(r!==true){var c=f.pos<t.pos?f:t;var l=f.pos<t.pos?t:f;var d=l.pos-c.pos;var v=[];var h=[];h.push({ids:c.ids,diff:d,parent:null,parentIdx:null});while(h.length>0){var p=h.pop();if(p.diff===0){if(p.ids[0]===l.ids[0]){v.push(p)}continue}var y=p.ids[2];for(var g=0,_=y.length;g<_;g++){h.push({ids:y[g],diff:p.diff-1,parent:p.ids,parentIdx:g})}}var m=v[0];if(!m){n.push(f)}else{a=Ft(m.ids,l.ids);m.parent[2][m.parentIdx]=a.tree;n.push({pos:c.pos,ids:c.ids});i=i||a.conflicts;o=true}}else{n.push(f)}}if(!o){n.push(t)}n.sort(Lt);return{tree:n,conflicts:i||"internal_node"}}function Jt(e,t){var r=Bt(e);var n;var i;for(var o=0,a=r.length;o<a;o++){var u=r[o];var s=u.ids;var f;if(s.length>t){if(!n){n={}}var c=s.length-t;f={pos:u.pos+c,ids:Nt(s,c)};for(var l=0;l<c;l++){var d=u.pos+l+"-"+s[l].id;n[d]=true}}else{f={pos:u.pos,ids:Nt(s,0)}}if(i){i=Ut(i,f,true).tree}else{i=[f]}}if(n){Et(i,(function(e,t,r){delete n[t+"-"+r]}))}return{tree:i,revs:n?Object.keys(n):[]}}function zt(e,t,r){var n=Ut(e,t);var i=Jt(n.tree,r);return{tree:i.tree,stemmedRevs:i.revs,conflicts:n.conflicts}}function Kt(e,t){var r=e.slice();var n=t.split("-");var i=parseInt(n[0],10);var o=n[1];var a;while(a=r.pop()){if(a.pos===i&&a.ids[0]===o){return true}var u=a.ids[2];for(var s=0,f=u.length;s<f;s++){r.push({pos:a.pos+1,ids:u[s]})}}return false}function Vt(e){return e.ids}function Wt(e,t){if(!t){t=xt(e)}var r=t.substring(t.indexOf("-")+1);var n=e.rev_tree.map(Vt);var i;while(i=n.pop()){if(i[0]===r){return!!i[1].deleted}n=n.concat(i[2])}}function Gt(e){return/^_local/.test(e)}function Qt(e,t){var r=t.rev_tree.slice();var n;while(n=r.pop()){var i=n.pos;var o=n.ids;var a=o[0];var u=o[1];var s=o[2];var f=s.length===0;var c=n.history?n.history.slice():[];c.push({id:a,pos:i,opts:u});if(f){for(var l=0,d=c.length;l<d;l++){var v=c[l];var h=v.pos+"-"+v.id;if(h===e){return i+"-"+a}}}for(var p=0,y=s.length;p<y;p++){r.push({pos:i+1,ids:s[p],history:c})}}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}N(Xt,o);function Zt(e,t,r,n){try{e.emit("change",t,r,n)}catch(Mf){ve("error",'Error in .on("change", function):',Mf)}}function Xt(e,t,r){o.call(this);var n=this;this.db=e;t=t?H(t):{};var i=t.complete=ee((function(t,r){if(t){if(Xe(n,"error")>0){n.emit("error",t)}}else{n.emit("complete",r)}n.removeAllListeners();e.removeListener("destroyed",a)}));if(r){n.on("complete",(function(e){r(null,e)}));n.on("error",r)}function a(){n.cancel()}e.once("destroyed",a);t.onChange=function(e,t,r){if(n.isCancelled){return}Zt(n,e,t,r)};var u=new Promise((function(e,r){t.complete=function(t,n){if(t){r(t)}else{e(n)}}}));n.once("cancel",(function(){e.removeListener("destroyed",a);t.complete(null,{status:"cancelled"})}));this.then=u.then.bind(u);this["catch"]=u["catch"].bind(u);this.then((function(e){i(null,e)}),i);if(!e.taskqueue.isReady){e.taskqueue.addTask((function(e){if(e){t.complete(e)}else if(n.isCancelled){n.emit("cancel")}else{n.validateChanges(t)}}))}else{n.validateChanges(t)}}Xt.prototype.cancel=function(){this.isCancelled=true;if(this.db.taskqueue.isReady){this.emit("cancel")}};function Yt(e,t,r){var n=[{rev:e._rev}];if(r.style==="all_docs"){n=Ct(t.rev_tree).map((function(e){return{rev:e.rev}}))}var i={id:t.id,changes:n,doc:e};if(Wt(t,e._rev)){i.deleted=true}if(r.conflicts){i.doc._conflicts=Dt(t);if(!i.doc._conflicts.length){delete i.doc._conflicts}}return i}Xt.prototype.validateChanges=function(e){var t=e.complete;var r=this;if(lr._changesFilterPlugin){lr._changesFilterPlugin.validate(e,(function(n){if(n){return t(n)}r.doChanges(e)}))}else{r.doChanges(e)}};Xt.prototype.doChanges=function(e){var t=this;var r=e.complete;e=H(e);if("live"in e&&!("continuous"in e)){e.continuous=e.live}e.processChange=Yt;if(e.since==="latest"){e.since="now"}if(!e.since){e.since=0}if(e.since==="now"){this.db.info().then((function(n){if(t.isCancelled){r(null,{status:"cancelled"});return}e.since=n.update_seq;t.doChanges(e)}),r);return}if(lr._changesFilterPlugin){lr._changesFilterPlugin.normalize(e);if(lr._changesFilterPlugin.shouldFilter(this,e)){return lr._changesFilterPlugin.filter(this,e)}}else{["doc_ids","filter","selector","view"].forEach((function(t){if(t in e){ve("warn",'The "'+t+'" option was passed in to changes/replicate, '+"but pouchdb-changes-filter plugin is not installed, so it "+"was ignored. Please install the plugin to enable filtering.")}}))}if(!("descending"in e)){e.descending=false}e.limit=e.limit===0?1:e.limit;e.complete=r;var n=this.db._changes(e);if(n&&typeof n.cancel==="function"){var i=t.cancel;t.cancel=T((function(e){n.cancel();i.apply(this,e)}))}};function Ht(e,t){return e<t?-1:e>t?1:0}function er(e,t){return function(r,n){if(r||n[0]&&n[0].error){r=r||n[0];r.docId=t;e(r)}else{e(null,n.length?n[0]:n)}}}function tr(e){for(var t=0;t<e.length;t++){var r=e[t];if(r._deleted){delete r._attachments}else if(r._attachments){var n=Object.keys(r._attachments);for(var i=0;i<n.length;i++){var o=n[i];r._attachments[o]=ie(r._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}}function rr(e,t){var r=Ht(e._id,t._id);if(r!==0){return r}var n=e._revisions?e._revisions.start:0;var i=t._revisions?t._revisions.start:0;return Ht(n,i)}function nr(e){var t={};var r=[];Et(e,(function(e,n,i,o){var a=n+"-"+i;if(e){t[a]=0}if(o!==undefined){r.push({from:o,to:a})}return a}));r.reverse();r.forEach((function(e){if(t[e.from]===undefined){t[e.from]=1+t[e.to]}else{t[e.from]=Math.min(t[e.from],1+t[e.to])}}));return t}function ir(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t;e.skip=0;delete e.limit;if(e.descending){t.reverse();e.descending=false}}function or(e){var t=e._compactionQueue[0];var r=t.opts;var n=t.callback;e.get("_local/compaction").catch((function(){return false})).then((function(t){if(t&&t.last_seq){r.last_seq=t.last_seq}e._compact(r,(function(t,r){if(t){n(t)}else{n(null,r)}p((function(){e._compactionQueue.shift();if(e._compactionQueue.length){or(e)}}))}))}))}function ar(e){if(e.charAt(0)==="_"){return e+" is not a valid attachment name, attachment "+"names cannot start with '_'"}return false}N(ur,o);function ur(){o.call(this);for(var e in ur.prototype){if(typeof this[e]==="function"){this[e]=this[e].bind(this)}}}ur.prototype.post=ne("post",(function(e,t,r){if(typeof t==="function"){r=t;t={}}if(typeof e!=="object"||Array.isArray(e)){return r(ze(Ie))}this.bulkDocs({docs:[e]},t,er(r,e._id))}));ur.prototype.put=ne("put",(function(e,t,r){if(typeof t==="function"){r=t;t={}}if(typeof e!=="object"||Array.isArray(e)){return r(ze(Ie))}Qe(e._id);if(Gt(e._id)&&typeof this._putLocal==="function"){if(e._deleted){return this._removeLocal(e,r)}else{return this._putLocal(e,r)}}var n=this;if(t.force&&e._rev){i();o((function(t){var n=t?null:{ok:true,id:e._id,rev:e._rev};r(t,n)}))}else{o(r)}function i(){var r=e._rev.split("-");var n=r[1];var i=parseInt(r[0],10);var o=i+1;var a=$t();e._revisions={start:o,ids:[a,n]};e._rev=o+"-"+a;t.new_edits=false}function o(r){if(typeof n._put==="function"&&t.new_edits!==false){n._put(e,t,r)}else{n.bulkDocs({docs:[e]},t,er(r,e._id))}}}));ur.prototype.putAttachment=ne("putAttachment",(function(e,t,r,n,i){var o=this;if(typeof i==="function"){i=n;n=r;r=null}if(typeof i==="undefined"){i=n;n=r;r=null}if(!i){ve("warn","Attachment",t,"on document",e,"is missing content_type")}function a(e){var r="_rev"in e?parseInt(e._rev,10):0;e._attachments=e._attachments||{};e._attachments[t]={content_type:i,data:n,revpos:++r};return o.put(e)}return o.get(e).then((function(e){if(e._rev!==r){throw ze(je)}return a(e)}),(function(t){if(t.reason===ke.message){return a({_id:e})}else{throw t}}))}));ur.prototype.removeAttachment=ne("removeAttachment",(function(e,t,r,n){var i=this;i.get(e,(function(e,o){if(e){n(e);return}if(o._rev!==r){n(ze(je));return}if(!o._attachments){return n()}delete o._attachments[t];if(Object.keys(o._attachments).length===0){delete o._attachments}i.put(o,n)}))}));ur.prototype.remove=ne("remove",(function(e,t,r,n){var i;if(typeof t==="string"){i={_id:e,_rev:t};if(typeof r==="function"){n=r;r={}}}else{i=e;if(typeof t==="function"){n=t;r={}}else{n=r;r=t}}r=r||{};r.was_delete=true;var o={_id:i._id,_rev:i._rev||r.rev};o._deleted=true;if(Gt(o._id)&&typeof this._removeLocal==="function"){return this._removeLocal(i,n)}this.bulkDocs({docs:[o]},r,er(n,o._id))}));ur.prototype.revsDiff=ne("revsDiff",(function(e,t,r){if(typeof t==="function"){r=t;t={}}var n=Object.keys(e);if(!n.length){return r(null,{})}var i=0;var o=new V;function a(e,t){if(!o.has(e)){o.set(e,{missing:[]})}o.get(e).missing.push(t)}function u(t,r){var n=e[t].slice(0);Et(r,(function(e,r,i,o,u){var s=r+"-"+i;var f=n.indexOf(s);if(f===-1){return}n.splice(f,1);if(u.status!=="available"){a(t,s)}}));n.forEach((function(e){a(t,e)}))}n.map((function(t){this._getRevisionTree(t,(function(a,s){if(a&&a.status===404&&a.message==="missing"){o.set(t,{missing:e[t]})}else if(a){return r(a)}else{u(t,s)}if(++i===n.length){var f={};o.forEach((function(e,t){f[t]=e}));return r(null,f)}}))}),this)}));ur.prototype.bulkGet=ne("bulkGet",(function(e,t){se(this,e,t)}));ur.prototype.compactDocument=ne("compactDocument",(function(e,t,r){var n=this;this._getRevisionTree(e,(function(i,o){if(i){return r(i)}var a=nr(o);var u=[];var s=[];Object.keys(a).forEach((function(e){if(a[e]>t){u.push(e)}}));Et(o,(function(e,t,r,n,i){var o=t+"-"+r;if(i.status==="available"&&u.indexOf(o)!==-1){s.push(o)}}));n._doCompaction(e,s,r)}))}));ur.prototype.compact=ne("compact",(function(e,t){if(typeof e==="function"){t=e;e={}}var r=this;e=e||{};r._compactionQueue=r._compactionQueue||[];r._compactionQueue.push({opts:e,callback:t});if(r._compactionQueue.length===1){or(r)}}));ur.prototype._compact=function(e,t){var r=this;var n={return_docs:false,last_seq:e.last_seq||0};var i=[];function o(e){i.push(r.compactDocument(e.id,0))}function a(e){var n=e.last_seq;Promise.all(i).then((function(){return at(r,"_local/compaction",(function e(t){if(!t.last_seq||t.last_seq<n){t.last_seq=n;return t}return false}))})).then((function(){t(null,{ok:true})})).catch(t)}r.changes(n).on("change",o).on("complete",a).on("error",t)};ur.prototype.get=ne("get",(function(e,t,r){if(typeof t==="function"){r=t;t={}}if(typeof e!=="string"){return r(ze(Oe))}if(Gt(e)&&typeof this._getLocal==="function"){return this._getLocal(e,r)}var n=[],i=this;function o(){var o=[];var a=n.length;if(!a){return r(null,o)}n.forEach((function(n){i.get(e,{rev:n,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},(function(e,t){if(!e){var i;for(var u=0,s=o.length;u<s;u++){if(o[u].ok&&o[u].ok._rev===t._rev){i=true;break}}if(!i){o.push({ok:t})}}else{o.push({missing:n})}a--;if(!a){r(null,o)}}))}))}if(t.open_revs){if(t.open_revs==="all"){this._getRevisionTree(e,(function(e,t){if(e){return r(e)}n=Ct(t).map((function(e){return e.rev}));o()}))}else{if(Array.isArray(t.open_revs)){n=t.open_revs;for(var a=0;a<n.length;a++){var u=n[a];if(!(typeof u==="string"&&/^\d+-/.test(u))){return r(ze(Re))}}o()}else{return r(ze(Se,"function_clause"))}}return}return this._get(e,t,(function(n,o){if(n){n.docId=e;return r(n)}var a=o.doc;var u=o.metadata;var s=o.ctx;if(t.conflicts){var f=Dt(u);if(f.length){a._conflicts=f}}if(Wt(u,a._rev)){a._deleted=true}if(t.revs||t.revs_info){var c=a._rev.split("-");var l=parseInt(c[0],10);var d=c[1];var v=Bt(u.rev_tree);var h=null;for(var p=0;p<v.length;p++){var y=v[p];var g=y.ids.map((function(e){return e.id})).indexOf(d);var _=g===l-1;if(_||!h&&g!==-1){h=y}}if(!h){n=new Error("invalid rev tree");n.docId=e;return r(n)}var m=h.ids.map((function(e){return e.id})).indexOf(a._rev.split("-")[1])+1;var b=h.ids.length-m;h.ids.splice(m,b);h.ids.reverse();if(t.revs){a._revisions={start:h.pos+h.ids.length-1,ids:h.ids.map((function(e){return e.id}))}}if(t.revs_info){var w=h.pos+h.ids.length;a._revs_info=h.ids.map((function(e){w--;return{rev:w+"-"+e.id,status:e.opts.status}}))}}if(t.attachments&&a._attachments){var k=a._attachments;var j=Object.keys(k).length;if(j===0){return r(null,a)}Object.keys(k).forEach((function(e){this._getAttachment(a._id,e,k[e],{rev:a._rev,binary:t.binary,ctx:s},(function(t,n){var i=a._attachments[e];i.data=n;delete i.stub;delete i.length;if(!--j){r(null,a)}}))}),i)}else{if(a._attachments){for(var O in a._attachments){if(a._attachments.hasOwnProperty(O)){a._attachments[O].stub=true}}}r(null,a)}}))}));ur.prototype.getAttachment=ne("getAttachment",(function(e,t,r,n){var i=this;if(r instanceof Function){n=r;r={}}this._get(e,r,(function(o,a){if(o){return n(o)}if(a.doc._attachments&&a.doc._attachments[t]){r.ctx=a.ctx;r.binary=true;i._getAttachment(e,t,a.doc._attachments[t],r,n)}else{return n(ze(ke))}}))}));ur.prototype.allDocs=ne("allDocs",(function(e,t){if(typeof e==="function"){t=e;e={}}e.skip=typeof e.skip!=="undefined"?e.skip:0;if(e.start_key){e.startkey=e.start_key}if(e.end_key){e.endkey=e.end_key}if("keys"in e){if(!Array.isArray(e.keys)){return t(new TypeError("options.keys must be an array"))}var r=["startkey","endkey","key"].filter((function(t){return t in e}))[0];if(r){t(ze(Pe,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Ze(this)){ir(e);if(e.keys.length===0){return this._allDocs({limit:0},t)}}}return this._allDocs(e,t)}));ur.prototype.changes=function(e,t){if(typeof e==="function"){t=e;e={}}e=e||{};e.return_docs="return_docs"in e?e.return_docs:!e.live;return new Xt(this,e,t)};ur.prototype.close=ne("close",(function(e){this._closed=true;this.emit("closed");return this._close(e)}));ur.prototype.info=ne("info",(function(e){var t=this;this._info((function(r,n){if(r){return e(r)}n.db_name=n.db_name||t.name;n.auto_compaction=!!(t.auto_compaction&&!Ze(t));n.adapter=t.adapter;e(null,n)}))}));ur.prototype.id=ne("id",(function(e){return this._id(e)}));ur.prototype.type=function(){return typeof this._type==="function"?this._type():this.adapter};ur.prototype.bulkDocs=ne("bulkDocs",(function(e,t,r){if(typeof t==="function"){r=t;t={}}t=t||{};if(Array.isArray(e)){e={docs:e}}if(!e||!e.docs||!Array.isArray(e.docs)){return r(ze(we))}for(var n=0;n<e.docs.length;++n){if(typeof e.docs[n]!=="object"||Array.isArray(e.docs[n])){return r(ze(Ie))}}var i;e.docs.forEach((function(e){if(e._attachments){Object.keys(e._attachments).forEach((function(t){i=i||ar(t);if(!e._attachments[t].content_type){ve("warn","Attachment",t,"on document",e._id,"is missing content_type")}}))}}));if(i){return r(ze(De,i))}if(!("new_edits"in t)){if("new_edits"in e){t.new_edits=e.new_edits}else{t.new_edits=true}}var o=this;if(!t.new_edits&&!Ze(o)){e.docs.sort(rr)}tr(e.docs);var a=e.docs.map((function(e){return e._id}));return this._bulkDocs(e,t,(function(e,n){if(e){return r(e)}if(!t.new_edits){n=n.filter((function(e){return e.error}))}if(!Ze(o)){for(var i=0,u=n.length;i<u;i++){n[i].id=n[i].id||a[i]}}r(null,n)}))}));ur.prototype.registerDependentDatabase=ne("registerDependentDatabase",(function(e,t){var r=new this.constructor(e,this.__opts);function n(t){t.dependentDbs=t.dependentDbs||{};if(t.dependentDbs[e]){return false}t.dependentDbs[e]=true;return t}at(this,"_local/_pouch_dependentDbs",n).then((function(){t(null,{db:r})})).catch(t)}));ur.prototype.destroy=ne("destroy",(function(e,t){if(typeof e==="function"){t=e;e={}}var r=this;var n="use_prefix"in r?r.use_prefix:true;function i(){r._destroy(e,(function(e,n){if(e){return t(e)}r._destroyed=true;r.emit("destroyed");t(null,n||{ok:true})}))}if(Ze(r)){return i()}r.get("_local/_pouch_dependentDbs",(function(e,o){if(e){if(e.status!==404){return t(e)}else{return i()}}var a=o.dependentDbs;var u=r.constructor;var s=Object.keys(a).map((function(e){var t=n?e.replace(new RegExp("^"+u.prefix),""):e;return new u(t,r.__opts).destroy()}));Promise.all(s).then(i,t)}))}));function sr(){this.isReady=false;this.failed=false;this.queue=[]}sr.prototype.execute=function(){var e;if(this.failed){while(e=this.queue.shift()){e(this.failed)}}else{while(e=this.queue.shift()){e()}}};sr.prototype.fail=function(e){this.failed=e;this.execute()};sr.prototype.ready=function(e){this.isReady=true;this.db=e;this.execute()};sr.prototype.addTask=function(e){this.queue.push(e);if(this.failed){this.execute()}};function fr(e,t){var r=e.match(/([a-z-]*):\/\/(.*)/);if(r){return{name:/https?/.test(r[1])?r[1]+"://"+r[2]:r[2],adapter:r[1]}}var n=lr.adapters;var i=lr.preferredAdapters;var o=lr.prefix;var a=t.adapter;if(!a){for(var u=0;u<i.length;++u){a=i[u];if(a==="idb"&&"websql"in n&&ce()&&localStorage["_pouch__websqldb_"+o+e]){ve("log",'PouchDB is downgrading "'+e+'" to WebSQL to'+" avoid data loss, because it was already opened with WebSQL.");continue}break}}var s=n[a];var f=s&&"use_prefix"in s?s.use_prefix:true;return{name:f?o+e:e,adapter:a}}function cr(e){function t(t){e.removeListener("closed",r);if(!t){e.constructor.emit("destroyed",e.name)}}function r(){e.removeListener("destroyed",t);e.constructor.emit("unref",e)}e.once("destroyed",t);e.once("closed",r);e.constructor.emit("ref",e)}N(lr,ur);function lr(e,t){if(!(this instanceof lr)){return new lr(e,t)}var r=this;t=t||{};if(e&&typeof e==="object"){t=e;e=t.name;delete t.name}if(t.deterministic_revs===undefined){t.deterministic_revs=true}this.__opts=t=H(t);r.auto_compaction=t.auto_compaction;r.prefix=lr.prefix;if(typeof e!=="string"){throw new Error("Missing/invalid DB name")}var n=(t.prefix||"")+e;var i=fr(n,t);t.name=i.name;t.adapter=t.adapter||i.adapter;r.name=e;r._adapter=t.adapter;lr.emit("debug",["adapter","Picked adapter: ",t.adapter]);if(!lr.adapters[t.adapter]||!lr.adapters[t.adapter].valid()){throw new Error("Invalid Adapter: "+t.adapter)}ur.call(r);r.taskqueue=new sr;r.adapter=t.adapter;lr.adapters[t.adapter].call(r,t,(function(e){if(e){return r.taskqueue.fail(e)}cr(r);r.emit("created",r);lr.emit("created",r.name);r.taskqueue.ready(r)}))}var dr=typeof AbortController!=="undefined"?AbortController:function(){return{abort:function(){}}};var vr=fetch;var hr=Headers;lr.adapters={};lr.preferredAdapters=[];lr.prefix="_pouch_";var pr=new o;function yr(e){Object.keys(o.prototype).forEach((function(t){if(typeof o.prototype[t]==="function"){e[t]=pr[t].bind(pr)}}));var t=e._destructionListeners=new V;e.on("ref",(function e(r){if(!t.has(r.name)){t.set(r.name,[])}t.get(r.name).push(r)}));e.on("unref",(function e(r){if(!t.has(r.name)){return}var n=t.get(r.name);var i=n.indexOf(r);if(i<0){return}n.splice(i,1);if(n.length>1){t.set(r.name,n)}else{t.delete(r.name)}}));e.on("destroyed",(function e(r){if(!t.has(r)){return}var n=t.get(r);t.delete(r);n.forEach((function(e){e.emit("destroyed",true)}))}))}yr(lr);lr.adapter=function(e,t,r){if(t.valid()){lr.adapters[e]=t;if(r){lr.preferredAdapters.push(e)}}};lr.plugin=function(e){if(typeof e==="function"){e(lr)}else if(typeof e!=="object"||Object.keys(e).length===0){throw new Error('Invalid plugin: got "'+e+'", expected an object or a function')}else{Object.keys(e).forEach((function(t){lr.prototype[t]=e[t]}))}if(this.__defaults){lr.__defaults=_e({},this.__defaults)}return lr};lr.defaults=function(e){function t(e,r){if(!(this instanceof t)){return new t(e,r)}r=r||{};if(e&&typeof e==="object"){r=e;e=r.name;delete r.name}r=_e({},t.__defaults,r);lr.call(this,e,r)}N(t,lr);t.preferredAdapters=lr.preferredAdapters.slice();Object.keys(lr).forEach((function(e){if(!(e in t)){t[e]=lr[e]}}));t.__defaults=_e({},this.__defaults,e);return t};lr.fetch=function(e,t){return vr(e,t)};var gr="7.2.1";function _r(e,t){var r=e;for(var n=0,i=t.length;n<i;n++){var o=t[n];r=r[o];if(!r){break}}return r}function mr(e,t){return e<t?-1:e>t?1:0}function br(e){var t=[];var r="";for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o==="."){if(n>0&&e[n-1]==="\\"){r=r.substring(0,r.length-1)+"."}else{t.push(r);r=""}}else{r+=o}}t.push(r);return t}var wr=["$or","$nor","$not"];function kr(e){return wr.indexOf(e)>-1}function jr(e){return Object.keys(e)[0]}function Or(e){return e[jr(e)]}function qr(e){var t={};e.forEach((function(e){Object.keys(e).forEach((function(r){var n=e[r];if(typeof n!=="object"){n={$eq:n}}if(kr(r)){if(n instanceof Array){t[r]=n.map((function(e){return qr([e])}))}else{t[r]=qr([n])}}else{var i=t[r]=t[r]||{};Object.keys(n).forEach((function(e){var t=n[e];if(e==="$gt"||e==="$gte"){return Ar(e,t,i)}else if(e==="$lt"||e==="$lte"){return $r(e,t,i)}else if(e==="$ne"){return Sr(t,i)}else if(e==="$eq"){return xr(t,i)}i[e]=t}))}}))}));return t}function Ar(e,t,r){if(typeof r.$eq!=="undefined"){return}if(typeof r.$gte!=="undefined"){if(e==="$gte"){if(t>r.$gte){r.$gte=t}}else{if(t>=r.$gte){delete r.$gte;r.$gt=t}}}else if(typeof r.$gt!=="undefined"){if(e==="$gte"){if(t>r.$gt){delete r.$gt;r.$gte=t}}else{if(t>r.$gt){r.$gt=t}}}else{r[e]=t}}function $r(e,t,r){if(typeof r.$eq!=="undefined"){return}if(typeof r.$lte!=="undefined"){if(e==="$lte"){if(t<r.$lte){r.$lte=t}}else{if(t<=r.$lte){delete r.$lte;r.$lt=t}}}else if(typeof r.$lt!=="undefined"){if(e==="$lte"){if(t<r.$lt){delete r.$lt;r.$lte=t}}else{if(t<r.$lt){r.$lt=t}}}else{r[e]=t}}function Sr(e,t){if("$ne"in t){t.$ne.push(e)}else{t.$ne=[e]}}function xr(e,t){delete t.$gt;delete t.$gte;delete t.$lt;delete t.$lte;delete t.$ne;t.$eq=e}function Er(e){for(var t in e){if(Array.isArray(e)){for(var r in e){if(e[r]["$and"]){e[r]=qr(e[r]["$and"])}}}var n=e[t];if(typeof n==="object"){Er(n)}}return e}function Pr(e,t){for(var r in e){if(r==="$and"){t=true}var n=e[r];if(typeof n==="object"){t=Pr(n,t)}}return t}function Cr(e){var t=H(e);var r=false;if(Pr(t,false)){t=Er(t);if("$and"in t){t=qr(t["$and"])}r=true}["$or","$nor"].forEach((function(e){if(e in t){t[e].forEach((function(e){var t=Object.keys(e);for(var r=0;r<t.length;r++){var n=t[r];var i=e[n];if(typeof i!=="object"||i===null){e[n]={$eq:i}}}}))}}));if("$not"in t){t["$not"]=qr([t["$not"]])}var n=Object.keys(t);for(var i=0;i<n.length;i++){var o=n[i];var a=t[o];if(typeof a!=="object"||a===null){a={$eq:a}}else if("$ne"in a&&!r){a.$ne=[a.$ne]}t[o]=a}return t}function Dr(e,t,r){var n="";var i=r-e.length;while(n.length<i){n+=t}return n}function Ir(e,t,r){var n=Dr(e,t,r);return n+e}var Br=-324;var Lr=3;var Tr="";function Mr(e,t){if(e===t){return 0}e=Nr(e);t=Nr(t);var r=Gr(e);var n=Gr(t);if(r-n!==0){return r-n}switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Vr(e,t)}return Array.isArray(e)?Kr(e,t):Wr(e,t)}function Nr(e){switch(typeof e){case"undefined":return null;case"number":if(e===Infinity||e===-Infinity||isNaN(e)){return null}return e;case"object":var t=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var n=0;n<r;n++){e[n]=Nr(t[n])}}else if(e instanceof Date){return e.toJSON()}else if(e!==null){e={};for(var i in t){if(t.hasOwnProperty(i)){var o=t[i];if(typeof o!=="undefined"){e[i]=Nr(o)}}}}}return e}function Rr(e){if(e!==null){switch(typeof e){case"boolean":return e?1:0;case"number":return Qr(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e);var r=t?e:Object.keys(e);var n=-1;var i=r.length;var o="";if(t){while(++n<i){o+=Fr(r[n])}}else{while(++n<i){var a=r[n];o+=Fr(a)+Fr(e[a])}}return o}}return""}function Fr(e){var t="\0";e=Nr(e);return Gr(e)+Tr+Rr(e)+t}function Ur(e,t){var r=t;var n;var i=e[t]==="1";if(i){n=0;t++}else{var o=e[t]==="0";t++;var a="";var u=e.substring(t,t+Lr);var s=parseInt(u,10)+Br;if(o){s=-s}t+=Lr;while(true){var f=e[t];if(f==="\0"){break}else{a+=f}t++}a=a.split(".");if(a.length===1){n=parseInt(a,10)}else{n=parseFloat(a[0]+"."+a[1])}if(o){n=n-10}if(s!==0){n=parseFloat(n+"e"+s)}}return{num:n,length:t-r}}function Jr(e,t){var r=e.pop();if(t.length){var n=t[t.length-1];if(r===n.element){t.pop();n=t[t.length-1]}var i=n.element;var o=n.index;if(Array.isArray(i)){i.push(r)}else if(o===e.length-2){var a=e.pop();i[a]=r}else{e.push(r)}}}function zr(e){var t=[];var r=[];var n=0;while(true){var i=e[n++];if(i==="\0"){if(t.length===1){return t.pop()}else{Jr(t,r);continue}}switch(i){case"1":t.push(null);break;case"2":t.push(e[n]==="1");n++;break;case"3":var o=Ur(e,n);t.push(o.num);n+=o.length;break;case"4":var a="";while(true){var u=e[n];if(u==="\0"){break}a+=u;n++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"");t.push(a);break;case"5":var s={element:[],index:t.length};t.push(s.element);r.push(s);break;case"6":var f={element:{},index:t.length};t.push(f.element);r.push(f);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Kr(e,t){var r=Math.min(e.length,t.length);for(var n=0;n<r;n++){var i=Mr(e[n],t[n]);if(i!==0){return i}}return e.length===t.length?0:e.length>t.length?1:-1}function Vr(e,t){return e===t?0:e>t?1:-1}function Wr(e,t){var r=Object.keys(e),n=Object.keys(t);var i=Math.min(r.length,n.length);for(var o=0;o<i;o++){var a=Mr(r[o],n[o]);if(a!==0){return a}a=Mr(e[r[o]],t[n[o]]);if(a!==0){return a}}return r.length===n.length?0:r.length>n.length?1:-1}function Gr(e){var t=["boolean","number","string","object"];var r=t.indexOf(typeof e);if(~r){if(e===null){return 1}if(Array.isArray(e)){return 5}return r<3?r+2:r+3}if(Array.isArray(e)){return 5}}function Qr(e){if(e===0){return"1"}var t=e.toExponential().split(/e\+?/);var r=parseInt(t[1],10);var n=e<0;var i=n?"0":"2";var o=(n?-r:r)-Br;var a=Ir(o.toString(),"0",Lr);i+=Tr+a;var u=Math.abs(parseFloat(t[0]));if(n){u=10-u}var s=u.toFixed(20);s=s.replace(/\.?0+$/,"");i+=Tr+s;return i}function Zr(e){function t(t){return e.map((function(e){var r=jr(e);var n=br(r);var i=_r(t,n);return i}))}return function(e,r){var n=t(e.doc);var i=t(r.doc);var o=Mr(n,i);if(o!==0){return o}return mr(e.doc._id,r.doc._id)}}function Xr(e,t,r){e=e.filter((function(e){return Yr(e.doc,t.selector,r)}));if(t.sort){var n=Zr(t.sort);e=e.sort(n);if(typeof t.sort[0]!=="string"&&Or(t.sort[0])==="desc"){e=e.reverse()}}if("limit"in t||"skip"in t){var i=t.skip||0;var o=("limit"in t?t.limit:e.length)+i;e=e.slice(i,o)}return e}function Yr(e,t,r){return r.every((function(r){var n=t[r];var i=br(r);var o=_r(e,i);if(kr(r)){return en(r,n,e)}return Hr(n,e,i,o)}))}function Hr(e,t,r,n){if(!e){return true}if(typeof e==="object"){return Object.keys(e).every((function(i){var o=e[i];return tn(i,t,o,r,n)}))}return e===n}function en(e,t,r){if(e==="$or"){return t.some((function(e){return Yr(r,e,Object.keys(e))}))}if(e==="$not"){return!Yr(r,t,Object.keys(t))}return!t.find((function(e){return Yr(r,e,Object.keys(e))}))}function tn(e,t,r,n,i){if(!ln[e]){throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, '+"$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all")}return ln[e](t,r,n,i)}function rn(e){return typeof e!=="undefined"&&e!==null}function nn(e){return typeof e!=="undefined"}function on(e,t){var r=t[0];var n=t[1];if(r===0){throw new Error("Bad divisor, cannot divide by zero")}if(parseInt(r,10)!==r){throw new Error("Divisor is not an integer")}if(parseInt(n,10)!==n){throw new Error("Modulus is not an integer")}if(parseInt(e,10)!==e){return false}return e%r===n}function an(e,t){return t.some((function(t){if(e instanceof Array){return e.indexOf(t)>-1}return e===t}))}function un(e,t){return t.every((function(t){return e.indexOf(t)>-1}))}function sn(e,t){return e.length===t}function fn(e,t){var r=new RegExp(t);return r.test(e)}function cn(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e==="boolean";case"number":return typeof e==="number";case"string":return typeof e==="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}throw new Error(t+" not supported as a type."+"Please use one of object, string, array, number, boolean or null.")}var ln={$elemMatch:function(e,t,r,n){if(!Array.isArray(n)){return false}if(n.length===0){return false}if(typeof n[0]==="object"){return n.some((function(e){return Yr(e,t,Object.keys(t))}))}return n.some((function(n){return Hr(t,e,r,n)}))},$allMatch:function(e,t,r,n){if(!Array.isArray(n)){return false}if(n.length===0){return false}if(typeof n[0]==="object"){return n.every((function(e){return Yr(e,t,Object.keys(t))}))}return n.every((function(n){return Hr(t,e,r,n)}))},$eq:function(e,t,r,n){return nn(n)&&Mr(n,t)===0},$gte:function(e,t,r,n){return nn(n)&&Mr(n,t)>=0},$gt:function(e,t,r,n){return nn(n)&&Mr(n,t)>0},$lte:function(e,t,r,n){return nn(n)&&Mr(n,t)<=0},$lt:function(e,t,r,n){return nn(n)&&Mr(n,t)<0},$exists:function(e,t,r,n){if(t){return nn(n)}return!nn(n)},$mod:function(e,t,r,n){return rn(n)&&on(n,t)},$ne:function(e,t,r,n){return t.every((function(e){return Mr(n,e)!==0}))},$in:function(e,t,r,n){return rn(n)&&an(n,t)},$nin:function(e,t,r,n){return rn(n)&&!an(n,t)},$size:function(e,t,r,n){return rn(n)&&sn(n,t)},$all:function(e,t,r,n){return Array.isArray(n)&&un(n,t)},$regex:function(e,t,r,n){return rn(n)&&fn(n,t)},$type:function(e,t,r,n){return cn(n,t)}};function dn(e,t){if(typeof t!=="object"){throw new Error("Selector error: expected a JSON object")}t=Cr(t);var r={doc:e};var n=Xr([r],{selector:t},Object.keys(t));return n&&n.length===1}function vn(e){return ot('"use strict";\nreturn '+e+";",{})}function hn(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return ot(t,{})}function pn(e,t){if(e.selector){if(e.filter&&e.filter!=="_selector"){var r=typeof e.filter==="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+r+'"'))}}t()}function yn(e){if(e.view&&!e.filter){e.filter="_view"}if(e.selector&&!e.filter){e.filter="_selector"}if(e.filter&&typeof e.filter==="string"){if(e.filter==="_view"){e.view=He(e.view)}else{e.filter=He(e.filter)}}}function gn(e,t){return t.filter&&typeof t.filter==="string"&&!t.doc_ids&&!Ze(e.db)}function _n(e,t){var r=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!=="string"){var n=ze(De,"`view` filter parameter not found or invalid.");return r(n)}var i=Ye(t.view);e.db.get("_design/"+i[0],(function(n,o){if(e.isCancelled){return r(null,{status:"cancelled"})}if(n){return r(Ke(n))}var a=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;if(!a){return r(ze(ke,o.views?"missing json key: "+i[1]:"missing json key: views"))}t.filter=hn(a);e.doChanges(t)}))}else if(t.selector){t.filter=function(e){return dn(e,t.selector)};e.doChanges(t)}else{var o=Ye(t.filter);e.db.get("_design/"+o[0],(function(n,i){if(e.isCancelled){return r(null,{status:"cancelled"})}if(n){return r(Ke(n))}var a=i&&i.filters&&i.filters[o[1]];if(!a){return r(ze(ke,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"))}t.filter=vn(a);e.doChanges(t)}))}}function mn(e){e._changesFilterPlugin={validate:pn,normalize:yn,shouldFilter:gn,filter:_n}}lr.plugin(mn);lr.version=gr;function bn(e){return e.reduce((function(e,t){e[t]=true;return e}),{})}var wn=bn(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]);var kn=bn(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function jn(e){if(!/^\d+-/.test(e)){return ze(Re)}var t=e.indexOf("-");var r=e.substring(0,t);var n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function On(e,t){var r=e.start-e.ids.length+1;var n=e.ids;var i=[n[0],t,[]];for(var o=1,a=n.length;o<a;o++){i=[n[o],{status:"missing"},[i]]}return[{pos:r,ids:i}]}function qn(e,t,r){if(!r){r={deterministic_revs:true}}var n;var i;var o;var a={status:"available"};if(e._deleted){a.deleted=true}if(t){if(!e._id){e._id=St()}i=$t(e,r.deterministic_revs);if(e._rev){o=jn(e._rev);if(o.error){return o}e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[i,a,[]]]]}];n=o.prefix+1}else{e._rev_tree=[{pos:1,ids:[i,a,[]]}];n=1}}else{if(e._revisions){e._rev_tree=On(e._revisions,a);n=e._revisions.start;i=e._revisions.ids[0]}if(!e._rev_tree){o=jn(e._rev);if(o.error){return o}n=o.prefix;i=o.id;e._rev_tree=[{pos:n,ids:[i,a,[]]}]}}Qe(e._id);e._rev=n+"-"+i;var u={metadata:{},data:{}};for(var s in e){if(Object.prototype.hasOwnProperty.call(e,s)){var f=s[0]==="_";if(f&&!wn[s]){var c=ze(Ce,s);c.message=Ce.message+": "+s;throw c}else if(f&&!kn[s]){u.metadata[s.slice(1)]=e[s]}else{u.data[s]=e[s]}}}return u}function An(e){try{return st(e)}catch(Mf){var t=ze(xe,"Attachment is not a valid base64 string");return{error:t}}}function $n(e,t,r){var n=An(e.data);if(n.error){return r(n.error)}e.length=n.length;if(t==="blob"){e.data=dt(n,e.content_type)}else if(t==="base64"){e.data=ft(n)}else{e.data=n}qt(n,(function(t){e.digest="md5-"+t;r()}))}function Sn(e,t,r){qt(e.data,(function(n){e.digest="md5-"+n;e.length=e.data.size||e.data.length||0;if(t==="binary"){yt(e.data,(function(t){e.data=t;r()}))}else if(t==="base64"){gt(e.data,(function(t){e.data=t;r()}))}else{r()}}))}function xn(e,t,r){if(e.stub){return r()}if(typeof e.data==="string"){$n(e,t,r)}else{Sn(e,t,r)}}function En(e,t,r){if(!e.length){return r()}var n=0;var i;e.forEach((function(e){var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];var n=0;if(!r.length){return o()}function a(e){i=e;n++;if(n===r.length){o()}}for(var u in e.data._attachments){if(e.data._attachments.hasOwnProperty(u)){xn(e.data._attachments[u],t,a)}}}));function o(){n++;if(e.length===n){if(i){r(i)}else{r()}}}}function Pn(e,t,r,n,i,o,a,u){if(Kt(t.rev_tree,r.metadata.rev)&&!u){n[i]=r;return o()}var s=t.winningRev||xt(t);var f="deleted"in t?t.deleted:Wt(t,s);var c="deleted"in r.metadata?r.metadata.deleted:Wt(r.metadata);var l=/^1-/.test(r.metadata.rev);if(f&&!c&&u&&l){var d=r.data;d._rev=s;d._id=r.metadata.id;r=qn(d,u)}var v=zt(t.rev_tree,r.metadata.rev_tree[0],e);var h=u&&(f&&c&&v.conflicts!=="new_leaf"||!f&&v.conflicts!=="new_leaf"||f&&!c&&v.conflicts==="new_branch");if(h){var p=ze(je);n[i]=p;return o()}var y=r.metadata.rev;r.metadata.rev_tree=v.tree;r.stemmedRevs=v.stemmedRevs||[];if(t.rev_map){r.metadata.rev_map=t.rev_map}var g=xt(r.metadata);var _=Wt(r.metadata,g);var m=f===_?0:f<_?-1:1;var b;if(y===g){b=_}else{b=Wt(r.metadata,y)}a(r,g,_,b,true,m,i,o)}function Cn(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function Dn(e,t,r,n,i,o,a,u,s){e=e||1e3;function f(e,t,r){var n=xt(e.metadata);var i=Wt(e.metadata,n);if("was_delete"in u&&i){o[t]=ze(ke,"deleted");return r()}var s=c&&Cn(e);if(s){var f=ze(je);o[t]=f;return r()}var l=i?0:1;a(e,n,i,i,false,l,t,r)}var c=u.new_edits;var l=new V;var d=0;var v=t.length;function h(){if(++d===v&&s){s()}}t.forEach((function(e,t){if(e._id&&Gt(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";r[n](e,{ctx:i},(function(e,r){o[t]=e||r;h()}));return}var a=e.metadata.id;if(l.has(a)){v--;l.get(a).push([e,t])}else{l.set(a,[[e,t]])}}));l.forEach((function(t,r){var i=0;function u(){if(++i<t.length){s()}else{h()}}function s(){var s=t[i];var l=s[0];var d=s[1];if(n.has(r)){Pn(e,n.get(r),l,o,d,u,a,c)}else{var v=zt([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=v.tree;l.stemmedRevs=v.stemmedRevs||[];f(l,d,u)}}s()}))}var In=5;var Bn="document-store";var Ln="by-sequence";var Tn="attach-store";var Mn="attach-seq-store";var Nn="meta-store";var Rn="local-store";var Fn="detect-blob-support";function Un(e){try{return JSON.parse(e)}catch(Mf){return L.parse(e)}}function Jn(e){try{return JSON.stringify(e)}catch(Mf){return L.stringify(e)}}function zn(e){return function(t){var r="unknown_error";if(t.target&&t.target.error){r=t.target.error.name||t.target.error.message}e(ze(Le,r))}}function Kn(e,t,r){return{data:Jn(e),winningRev:t,deletedOrLocal:r?"1":"0",seq:e.seq,id:e.id}}function Vn(e){if(!e){return null}var t=Un(e.data);t.winningRev=e.winningRev;t.deleted=e.deletedOrLocal==="1";t.seq=e.seq;return t}function Wn(e){if(!e){return e}var t=e._doc_id_rev.lastIndexOf(":");e._id=e._doc_id_rev.substring(0,t-1);e._rev=e._doc_id_rev.substring(t+1);delete e._doc_id_rev;return e}function Gn(e,t,r,n){if(r){if(!e){n(ct([""],{type:t}))}else if(typeof e!=="string"){n(e)}else{n(vt(e,t))}}else{if(!e){n("")}else if(typeof e!=="string"){pt(e,(function(e){n(ft(e))}))}else{n(e)}}}function Qn(e,t,r,n){var i=Object.keys(e._attachments||{});if(!i.length){return n&&n()}var o=0;function a(){if(++o===i.length&&n){n()}}function u(e,t){var n=e._attachments[t];var i=n.digest;var o=r.objectStore(Tn).get(i);o.onsuccess=function(e){n.body=e.target.result.body;a()}}i.forEach((function(r){if(t.attachments&&t.include_docs){u(e,r)}else{e._attachments[r].stub=true;a()}}))}function Zn(e,t){return Promise.all(e.map((function(e){if(e.doc&&e.doc._attachments){var r=Object.keys(e.doc._attachments);return Promise.all(r.map((function(r){var n=e.doc._attachments[r];if(!("body"in n)){return}var i=n.body;var o=n.content_type;return new Promise((function(a){Gn(i,o,t,(function(t){e.doc._attachments[r]=_e(ie(n,["digest","content_type"]),{data:t});a()}))}))})))}})))}function Xn(e,t,r){var n=[];var i=r.objectStore(Ln);var o=r.objectStore(Tn);var a=r.objectStore(Mn);var u=e.length;function s(){u--;if(!u){f()}}function f(){if(!n.length){return}n.forEach((function(e){var t=a.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::￿",false,false));t.onsuccess=function(t){var r=t.target.result;if(!r){o.delete(e)}}}))}e.forEach((function(e){var r=i.index("_doc_id_rev");var o=t+"::"+e;r.getKey(o).onsuccess=function(e){var t=e.target.result;if(typeof t!=="number"){return s()}i.delete(t);var r=a.index("seq").openCursor(IDBKeyRange.only(t));r.onsuccess=function(e){var t=e.target.result;if(t){var r=t.value.digestSeq.split("::")[0];n.push(r);a.delete(t.primaryKey);t.continue()}else{s()}}}}))}function Yn(e,t,r){try{return{txn:e.transaction(t,r)}}catch(n){return{error:n}}}var Hn=new de;function ei(e,t,r,n,i,o){var a=t.docs;var u;var s;var f;var c;var l;var d;var v;var h;for(var p=0,y=a.length;p<y;p++){var g=a[p];if(g._id&&Gt(g._id)){continue}g=a[p]=qn(g,r.new_edits,e);if(g.error&&!v){v=g}}if(v){return o(v)}var _=false;var m=0;var b=new Array(a.length);var w=new V;var k=false;var j=n._meta.blobSupport?"blob":"base64";En(a,j,(function(e){if(e){return o(e)}O()}));function O(){var e=[Bn,Ln,Tn,Rn,Mn,Nn];var t=Yn(i,e,"readwrite");if(t.error){return o(t.error)}u=t.txn;u.onabort=zn(o);u.ontimeout=zn(o);u.oncomplete=x;s=u.objectStore(Bn);f=u.objectStore(Ln);c=u.objectStore(Tn);l=u.objectStore(Mn);d=u.objectStore(Nn);d.get(Nn).onsuccess=function(e){h=e.target.result;$()};P((function(e){if(e){k=true;return o(e)}S()}))}function q(){_=true;$()}function A(){Dn(e.revs_limit,a,n,w,u,b,C,r,q)}function $(){if(!h||!_){return}h.docCount+=m;d.put(h)}function S(){if(!a.length){return}var e=0;function t(){if(++e===a.length){A()}}function r(e){var r=Vn(e.target.result);if(r){w.set(r.id,r)}t()}for(var n=0,i=a.length;n<i;n++){var o=a[n];if(o._id&&Gt(o._id)){t();continue}var u=s.get(o.metadata.id);u.onsuccess=r}}function x(){if(k){return}Hn.notify(n._meta.name);o(null,b)}function E(e,t){var r=c.get(e);r.onsuccess=function(r){if(!r.target.result){var n=ze(Ue,"unknown stub attachment with digest "+e);n.status=412;t(n)}else{t()}}}function P(e){var t=[];a.forEach((function(e){if(e.data&&e.data._attachments){Object.keys(e.data._attachments).forEach((function(r){var n=e.data._attachments[r];if(n.stub){t.push(n.digest)}}))}}));if(!t.length){return e()}var r=0;var n;function i(){if(++r===t.length){e(n)}}t.forEach((function(e){E(e,(function(e){if(e&&!n){n=e}i()}))}))}function C(e,t,r,n,i,o,a,u){e.metadata.winningRev=t;e.metadata.deleted=r;var s=e.data;s._id=e.metadata.id;s._rev=e.metadata.rev;if(n){s._deleted=true}var f=s._attachments&&Object.keys(s._attachments).length;if(f){return I(e,t,r,i,a,u)}m+=o;$();D(e,t,r,i,a,u)}function D(e,t,r,i,o,a){var c=e.data;var l=e.metadata;c._doc_id_rev=l.id+"::"+l.rev;delete c._id;delete c._rev;function d(o){var a=e.stemmedRevs||[];if(i&&n.auto_compaction){a=a.concat(It(e.metadata))}if(a&&a.length){Xn(a,e.metadata.id,u)}l.seq=o.target.result;var f=Kn(l,t,r);var c=s.put(f);c.onsuccess=h}function v(e){e.preventDefault();e.stopPropagation();var t=f.index("_doc_id_rev");var r=t.getKey(c._doc_id_rev);r.onsuccess=function(e){var t=f.put(c,e.target.result);t.onsuccess=d}}function h(){b[o]={ok:true,id:l.id,rev:l.rev};w.set(e.metadata.id,e.metadata);B(e,l.seq,a)}var p=f.put(c);p.onsuccess=d;p.onerror=v}function I(e,t,r,n,i,o){var a=e.data;var u=0;var s=Object.keys(a._attachments);function f(){if(u===s.length){D(e,t,r,n,i,o)}}function c(){u++;f()}s.forEach((function(r){var n=e.data._attachments[r];if(!n.stub){var i=n.data;delete n.data;n.revpos=parseInt(t,10);var o=n.digest;L(o,i,c)}else{u++;f()}}))}function B(e,t,r){var n=0;var i=Object.keys(e.data._attachments||{});if(!i.length){return r()}function o(){if(++n===i.length){r()}}function a(r){var n=e.data._attachments[r].digest;var i=l.put({seq:t,digestSeq:n+"::"+t});i.onsuccess=o;i.onerror=function(e){e.preventDefault();e.stopPropagation();o()}}for(var u=0;u<i.length;u++){a(i[u])}}function L(e,t,r){var n=c.count(e);n.onsuccess=function(n){var i=n.target.result;if(i){return r()}var o={digest:e,body:t};var a=c.put(o);a.onsuccess=r}}}function ti(e,t,r,n,i){if(n===-1){n=1e3}var o=typeof e.getAll==="function"&&typeof e.getAllKeys==="function"&&n>1&&!r;var a;var u;var s;function f(e){u=e.target.result;if(a){i(a,u,s)}}function c(e){a=e.target.result;if(u){i(a,u,s)}}function l(){if(!a.length){return i()}var r=a[a.length-1];var o;if(t&&t.upper){try{o=IDBKeyRange.bound(r,t.upper,true,t.upperOpen)}catch(Mf){if(Mf.name==="DataError"&&Mf.code===0){return i()}}}else{o=IDBKeyRange.lowerBound(r,true)}t=o;a=null;u=null;e.getAll(t,n).onsuccess=f;e.getAllKeys(t,n).onsuccess=c}function d(e){var t=e.target.result;if(!t){return i()}i([t.key],[t.value],t)}if(o){s={continue:l};e.getAll(t,n).onsuccess=f;e.getAllKeys(t,n).onsuccess=c}else if(r){e.openCursor(t,"prev").onsuccess=d}else{e.openCursor(t).onsuccess=d}}function ri(e,t,r){if(typeof e.getAll==="function"){e.getAll(t).onsuccess=r;return}var n=[];function i(e){var t=e.target.result;if(t){n.push(t.value);t.continue()}else{r({target:{result:n}})}}e.openCursor(t).onsuccess=i}function ni(e,t,r){var n=new Array(e.length);var i=0;e.forEach((function(o,a){t.get(o).onsuccess=function(t){if(t.target.result){n[a]=t.target.result}else{n[a]={key:o,error:"not_found"}}i++;if(i===e.length){r(e,n,{})}}}))}function ii(e,t,r,n,i){try{if(e&&t){if(i){return IDBKeyRange.bound(t,e,!r,false)}else{return IDBKeyRange.bound(e,t,false,!r)}}else if(e){if(i){return IDBKeyRange.upperBound(e)}else{return IDBKeyRange.lowerBound(e)}}else if(t){if(i){return IDBKeyRange.lowerBound(t,!r)}else{return IDBKeyRange.upperBound(t,!r)}}else if(n){return IDBKeyRange.only(n)}}catch(Mf){return{error:Mf}}return null}function oi(e,t,r){var n="startkey"in e?e.startkey:false;var i="endkey"in e?e.endkey:false;var o="key"in e?e.key:false;var a="keys"in e?e.keys:false;var u=e.skip||0;var s=typeof e.limit==="number"?e.limit:-1;var f=e.inclusive_end!==false;var c;var l;if(!a){c=ii(n,i,f,o,e.descending);l=c&&c.error;if(l&&!(l.name==="DataError"&&l.code===0)){return r(ze(Le,l.name))}}var d=[Bn,Ln,Nn];if(e.attachments){d.push(Tn)}var v=Yn(t,d,"readonly");if(v.error){return r(v.error)}var h=v.txn;h.oncomplete=x;h.onabort=zn(r);var p=h.objectStore(Bn);var y=h.objectStore(Ln);var g=h.objectStore(Nn);var _=y.index("_doc_id_rev");var m=[];var b;var w;g.get(Nn).onsuccess=function(e){b=e.target.result.docCount};if(e.update_seq){k(y,(function(e){if(e.target.result&&e.target.result.length>0){w=e.target.result[0]}}))}function k(e,t){function r(e){var r=e.target.result;var n=undefined;if(r&&r.key){n=r.key}return t({target:{result:[n]}})}e.openCursor(null,"prev").onsuccess=r}function j(t,r,n){var i=t.id+"::"+n;_.get(i).onsuccess=function n(i){r.doc=Wn(i.target.result)||{};if(e.conflicts){var o=Dt(t);if(o.length){r.doc._conflicts=o}}Qn(r.doc,e,h)}}function O(t,r){var n={id:r.id,key:r.id,value:{rev:t}};var i=r.deleted;if(i){if(a){m.push(n);n.value.deleted=true;n.doc=null}}else if(u--<=0){m.push(n);if(e.include_docs){j(r,n,t)}}}function q(e){for(var t=0,r=e.length;t<r;t++){if(m.length===s){break}var n=e[t];if(n.error&&a){m.push(n);continue}var i=Vn(n);var o=i.winningRev;O(o,i)}}function A(e,t,r){if(!r){return}q(t);if(m.length<s){r.continue()}}function $(t){var r=t.target.result;if(e.descending){r=r.reverse()}q(r)}function S(){var t={total_rows:b,offset:e.skip,rows:m};if(e.update_seq&&w!==undefined){t.update_seq=w}r(null,t)}function x(){if(e.attachments){Zn(m,e.binary).then(S)}else{S()}}if(l||s===0){return}if(a){return ni(e.keys,p,A)}if(s===-1){return ri(p,c,$)}ti(p,c,e.descending,s+u,A)}function ai(e){return new Promise((function(t){var r=ct([""]);var n=e.objectStore(Fn).put(r,"key");n.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/);var r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)};n.onerror=e.onabort=function(e){e.preventDefault();e.stopPropagation();t(false)}})).catch((function(){return false}))}function ui(e,t){var r=e.objectStore(Bn).index("deletedOrLocal");r.count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}var si=false;var fi=[];function ci(e,t,r,n){try{e(t,r)}catch(t){n.emit("error",t)}}function li(){if(si||!fi.length){return}si=true;fi.shift()()}function di(e,t,r){fi.push((function n(){e((function e(n,i){ci(t,n,i,r);si=false;p((function e(){li()}))}))}));li()}function vi(e,t,r,n){e=H(e);if(e.continuous){var i=r+":"+St();Hn.addListener(r,i,t,e);Hn.notify(r);return{cancel:function(){Hn.removeListener(r,i)}}}var o=e.doc_ids&&new K(e.doc_ids);e.since=e.since||0;var a=e.since;var u="limit"in e?e.limit:-1;if(u===0){u=1}var s=[];var f=0;var c=We(e);var l=new V;var d;var v;var h;var p;function y(t,r,n){if(!n||!t.length){return}var i=new Array(t.length);var o=new Array(t.length);function l(t,r){var n=e.processChange(r,t,e);a=n.seq=t.seq;var i=c(n);if(typeof i==="object"){return Promise.reject(i)}if(!i){return Promise.resolve()}f++;if(e.return_docs){s.push(n)}if(e.attachments&&e.include_docs){return new Promise((function(t){Qn(r,e,d,(function(){Zn([n],e.binary).then((function(){t(n)}))}))}))}else{return Promise.resolve(n)}}function v(){var t=[];for(var r=0,a=i.length;r<a;r++){if(f===u){break}var s=i[r];if(!s){continue}var c=o[r];t.push(l(c,s))}Promise.all(t).then((function(t){for(var r=0,n=t.length;r<n;r++){if(t[r]){e.onChange(t[r])}}})).catch(e.complete);if(f!==u){n.continue()}}var h=0;r.forEach((function(e,r){var n=Wn(e);var a=t[r];_(n,a,(function(e,n){o[r]=e;i[r]=n;if(++h===t.length){v()}}))}))}function g(e,t,r,n){if(r.seq!==t){return n()}if(r.winningRev===e._rev){return n(r,e)}var i=e._id+"::"+r.winningRev;var o=p.get(i);o.onsuccess=function(e){n(r,Wn(e.target.result))}}function _(e,t,r){if(o&&!o.has(e._id)){return r()}var n=l.get(e._id);if(n){return g(e,t,n,r)}h.get(e._id).onsuccess=function(i){n=Vn(i.target.result);l.set(e._id,n);g(e,t,n,r)}}function m(){e.complete(null,{results:s,last_seq:a})}function b(){if(!e.continuous&&e.attachments){Zn(s).then(m)}else{m()}}var w=[Bn,Ln];if(e.attachments){w.push(Tn)}var k=Yn(n,w,"readonly");if(k.error){return e.complete(k.error)}d=k.txn;d.onabort=zn(e.complete);d.oncomplete=b;v=d.objectStore(Ln);h=d.objectStore(Bn);p=v.index("_doc_id_rev");var j=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,true):null;ti(v,j,e.descending,u,y)}var hi=new V;var pi;var yi=new V;function gi(e,t){var r=this;di((function(t){_i(r,e,t)}),t,r.constructor)}function _i(e,t,r){var n=t.name;var i=null;e._meta=null;function o(e){var t=e.createObjectStore(Bn,{keyPath:"id"});e.createObjectStore(Ln,{autoIncrement:true}).createIndex("_doc_id_rev","_doc_id_rev",{unique:true});e.createObjectStore(Tn,{keyPath:"digest"});e.createObjectStore(Nn,{keyPath:"id",autoIncrement:false});e.createObjectStore(Fn);t.createIndex("deletedOrLocal","deletedOrLocal",{unique:false});e.createObjectStore(Rn,{keyPath:"_id"});var r=e.createObjectStore(Mn,{autoIncrement:true});r.createIndex("seq","seq");r.createIndex("digestSeq","digestSeq",{unique:true})}function a(e,t){var r=e.objectStore(Bn);r.createIndex("deletedOrLocal","deletedOrLocal",{unique:false});r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var i=n.value;var o=Wt(i);i.deletedOrLocal=o?"1":"0";r.put(i);n.continue()}else{t()}}}function u(e){e.createObjectStore(Rn,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:true})}function s(e,t){var r=e.objectStore(Rn);var n=e.objectStore(Bn);var i=e.objectStore(Ln);var o=n.openCursor();o.onsuccess=function(e){var o=e.target.result;if(o){var a=o.value;var u=a.id;var s=Gt(u);var f=xt(a);if(s){var c=u+"::"+f;var l=u+"::";var d=u+"::~";var v=i.index("_doc_id_rev");var h=IDBKeyRange.bound(l,d,false,false);var p=v.openCursor(h);p.onsuccess=function(e){p=e.target.result;if(!p){n.delete(o.primaryKey);o.continue()}else{var t=p.value;if(t._doc_id_rev===c){r.put(t)}i.delete(p.primaryKey);p.continue()}}}else{o.continue()}}else if(t){t()}}}function f(e){var t=e.createObjectStore(Mn,{autoIncrement:true});t.createIndex("seq","seq");t.createIndex("digestSeq","digestSeq",{unique:true})}function c(e,t){var r=e.objectStore(Ln);var n=e.objectStore(Tn);var i=e.objectStore(Mn);var o=n.count();o.onsuccess=function(e){var n=e.target.result;if(!n){return t()}r.openCursor().onsuccess=function(e){var r=e.target.result;if(!r){return t()}var n=r.value;var o=r.primaryKey;var a=Object.keys(n._attachments||{});var u={};for(var s=0;s<a.length;s++){var f=n._attachments[a[s]];u[f.digest]=true}var c=Object.keys(u);for(s=0;s<c.length;s++){var l=c[s];i.put({seq:o,digestSeq:l+"::"+o})}r.continue()}}}function l(e){function t(e){if(!e.data){e.deleted=e.deletedOrLocal==="1";return e}return Vn(e)}var r=e.objectStore(Ln);var n=e.objectStore(Bn);var i=n.openCursor();i.onsuccess=function(e){var i=e.target.result;if(!i){return}var o=t(i.value);o.winningRev=o.winningRev||xt(o);function a(){var e=o.id+"::";var t=o.id+"::￿";var n=r.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,t));var i=0;n.onsuccess=function(e){var t=e.target.result;if(!t){o.seq=i;return u()}var r=t.primaryKey;if(r>i){i=r}t.continue()}}function u(){var e=Kn(o,o.winningRev,o.deleted);var t=n.put(e);t.onsuccess=function(){i.continue()}}if(o.seq){return u()}a()}}e._remote=false;e.type=function(){return"idb"};e._id=te((function(t){t(null,e._meta.instanceId)}));e._bulkDocs=function r(n,o,a){ei(t,n,o,e,i,a)};e._get=function e(t,r,n){var o;var a;var u;var s=r.ctx;if(!s){var f=Yn(i,[Bn,Ln,Tn],"readonly");if(f.error){return n(f.error)}s=f.txn}function c(){n(u,{doc:o,metadata:a,ctx:s})}s.objectStore(Bn).get(t).onsuccess=function(e){a=Vn(e.target.result);if(!a){u=ze(ke,"missing");return c()}var t;if(!r.rev){t=a.winningRev;var n=Wt(a);if(n){u=ze(ke,"deleted");return c()}}else{t=r.latest?Qt(r.rev,a):r.rev}var i=s.objectStore(Ln);var f=a.id+"::"+t;i.index("_doc_id_rev").get(f).onsuccess=function(e){o=e.target.result;if(o){o=Wn(o)}if(!o){u=ze(ke,"missing");return c()}c()}}};e._getAttachment=function(e,t,r,n,o){var a;if(n.ctx){a=n.ctx}else{var u=Yn(i,[Bn,Ln,Tn],"readonly");if(u.error){return o(u.error)}a=u.txn}var s=r.digest;var f=r.content_type;a.objectStore(Tn).get(s).onsuccess=function(e){var t=e.target.result.body;Gn(t,f,n.binary,(function(e){o(null,e)}))}};e._info=function t(r){var n;var o;var a=Yn(i,[Nn,Ln],"readonly");if(a.error){return r(a.error)}var u=a.txn;u.objectStore(Nn).get(Nn).onsuccess=function(e){o=e.target.result.docCount};u.objectStore(Ln).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;n=t?t.key:0};u.oncomplete=function(){r(null,{doc_count:o,update_seq:n,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}};e._allDocs=function e(t,r){oi(t,i,r)};e._changes=function t(r){return vi(r,e,n,i)};e._close=function(e){i.close();hi.delete(n);e()};e._getRevisionTree=function(e,t){var r=Yn(i,[Bn],"readonly");if(r.error){return t(r.error)}var n=r.txn;var o=n.objectStore(Bn).get(e);o.onsuccess=function(e){var r=Vn(e.target.result);if(!r){t(ze(ke))}else{t(null,r.rev_tree)}}};e._doCompaction=function(e,t,r){var n=[Bn,Ln,Tn,Mn];var o=Yn(i,n,"readwrite");if(o.error){return r(o.error)}var a=o.txn;var u=a.objectStore(Bn);u.get(e).onsuccess=function(r){var n=Vn(r.target.result);Et(n.rev_tree,(function(e,r,n,i,o){var a=r+"-"+n;if(t.indexOf(a)!==-1){o.status="missing"}}));Xn(t,e,a);var i=n.winningRev;var o=n.deleted;a.objectStore(Bn).put(Kn(n,i,o))};a.onabort=zn(r);a.oncomplete=function(){r()}};e._getLocal=function(e,t){var r=Yn(i,[Rn],"readonly");if(r.error){return t(r.error)}var n=r.txn;var o=n.objectStore(Rn).get(e);o.onerror=zn(t);o.onsuccess=function(e){var r=e.target.result;if(!r){t(ze(ke))}else{delete r["_doc_id_rev"];t(null,r)}}};e._putLocal=function(e,t,r){if(typeof t==="function"){r=t;t={}}delete e._revisions;var n=e._rev;var o=e._id;if(!n){e._rev="0-1"}else{e._rev="0-"+(parseInt(n.split("-")[1],10)+1)}var a=t.ctx;var u;if(!a){var s=Yn(i,[Rn],"readwrite");if(s.error){return r(s.error)}a=s.txn;a.onerror=zn(r);a.oncomplete=function(){if(u){r(null,u)}}}var f=a.objectStore(Rn);var c;if(n){c=f.get(o);c.onsuccess=function(i){var o=i.target.result;if(!o||o._rev!==n){r(ze(je))}else{var a=f.put(e);a.onsuccess=function(){u={ok:true,id:e._id,rev:e._rev};if(t.ctx){r(null,u)}}}}}else{c=f.add(e);c.onerror=function(e){r(ze(je));e.preventDefault();e.stopPropagation()};c.onsuccess=function(){u={ok:true,id:e._id,rev:e._rev};if(t.ctx){r(null,u)}}}};e._removeLocal=function(e,t,r){if(typeof t==="function"){r=t;t={}}var n=t.ctx;if(!n){var o=Yn(i,[Rn],"readwrite");if(o.error){return r(o.error)}n=o.txn;n.oncomplete=function(){if(a){r(null,a)}}}var a;var u=e._id;var s=n.objectStore(Rn);var f=s.get(u);f.onerror=zn(r);f.onsuccess=function(n){var i=n.target.result;if(!i||i._rev!==e._rev){r(ze(ke))}else{s.delete(u);a={ok:true,id:u,rev:"0-0"};if(t.ctx){r(null,a)}}}};e._destroy=function(e,t){Hn.removeAllListeners(n);var r=yi.get(n);if(r&&r.result){r.result.close();hi.delete(n)}var i=indexedDB.deleteDatabase(n);i.onsuccess=function(){yi.delete(n);if(ce()&&n in localStorage){delete localStorage[n]}t(null,{ok:true})};i.onerror=zn(t)};var d=hi.get(n);if(d){i=d.idb;e._meta=d.global;return p((function(){r(null,e)}))}var v=indexedDB.open(n,In);yi.set(n,v);v.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1){return o(t)}var r=e.currentTarget.transaction;if(e.oldVersion<3){u(t)}if(e.oldVersion<4){f(t)}var n=[a,s,c,l];var i=e.oldVersion;function d(){var e=n[i-1];i++;if(e){e(r,d)}}d()};v.onsuccess=function(t){i=t.target.result;i.onversionchange=function(){i.close();hi.delete(n)};i.onabort=function(e){ve("error","Database has a global failure",e.target.error);i.close();hi.delete(n)};var o=i.transaction([Nn,Fn,Bn],"readwrite");var a=false;var u;var s;var f;var c;function l(){if(typeof f==="undefined"||!a){return}e._meta={name:n,instanceId:c,blobSupport:f};hi.set(n,{idb:i,global:e._meta});r(null,e)}function d(){if(typeof s==="undefined"||typeof u==="undefined"){return}var e=n+"_id";if(e in u){c=u[e]}else{u[e]=c=St()}u.docCount=s;o.objectStore(Nn).put(u)}o.objectStore(Nn).get(Nn).onsuccess=function(e){u=e.target.result||{id:Nn};d()};ui(o,(function(e){s=e;d()}));if(!pi){pi=ai(o)}pi.then((function(e){f=e;l()}));o.oncomplete=function(){a=true;l()};o.onabort=zn(r)};v.onerror=function(e){var t=e.target.error&&e.target.error.message;if(!t){t="Failed to open indexedDB, are you in private browsing mode?"}else if(t.indexOf("stored database is a higher version")!==-1){t=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')}ve("error",t);r(ze(Le,t))}}gi.valid=function(){try{return typeof indexedDB!=="undefined"&&typeof IDBKeyRange!=="undefined"}catch(Mf){return false}};function mi(e){e.adapter("idb",gi,true)}function bi(e,t){return new Promise((function(r,n){var i=0;var o=0;var a=0;var u=e.length;var s;function f(){i++;e[o++]().then(l,d)}function c(){if(++a===u){if(s){n(s)}else{r()}}else{v()}}function l(){i--;c()}function d(e){i--;s=s||e;c()}function v(){while(i<t&&o<u){f()}}v()}))}var wi=25;var ki=50;var ji=1e4;var Oi={};function qi(e){var t=e.doc||e.ok;var r=t&&t._attachments;if(!r){return}Object.keys(r).forEach((function(e){var t=r[e];t.data=vt(t.data,t.content_type)}))}function Ai(e){if(/^_design/.test(e)){return"_design/"+encodeURIComponent(e.slice(8))}if(/^_local/.test(e)){return"_local/"+encodeURIComponent(e.slice(7))}return encodeURIComponent(e)}function $i(e){if(!e._attachments||!Object.keys(e._attachments)){return Promise.resolve()}return Promise.all(Object.keys(e._attachments).map((function(t){var r=e._attachments[t];if(r.data&&typeof r.data!=="string"){return new Promise((function(e){gt(r.data,e)})).then((function(e){r.data=e}))}})))}function Si(e){if(!e.prefix){return false}var t=it(e.prefix).protocol;return t==="http"||t==="https"}function xi(e,t){if(Si(t)){var r=t.name.substr(t.prefix.length);var n=t.prefix.replace(/\/?$/,"/");e=n+encodeURIComponent(r)}var i=it(e);if(i.user||i.password){i.auth={username:i.user,password:i.password}}var o=i.path.replace(/(^\/|\/$)/g,"").split("/");i.db=o.pop();if(i.db.indexOf("%")===-1){i.db=encodeURIComponent(i.db)}i.path=o.join("/");return i}function Ei(e,t){return Pi(e,e.db+"/"+t)}function Pi(e,t){var r=!e.path?"":"/";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+r+t}function Ci(e){return"?"+Object.keys(e).map((function(t){return t+"="+encodeURIComponent(e[t])})).join("&")}function Di(e){var t=typeof navigator!=="undefined"&&navigator.userAgent?navigator.userAgent.toLowerCase():"";var r=t.indexOf("msie")!==-1;var n=t.indexOf("trident")!==-1;var i=t.indexOf("edge")!==-1;var o=!("method"in e)||e.method==="GET";return(r||n||i)&&o}function Ii(e,t){var r=this;var n=xi(e.name,e);var o=Ei(n,"");e=H(e);var a=function(t,r){r=r||{};r.headers=r.headers||new hr;r.credentials="include";if(e.auth||n.auth){var i=e.auth||n.auth;var o=i.username+":"+i.password;var a=ft(unescape(encodeURIComponent(o)));r.headers.set("Authorization","Basic "+a)}var u=e.headers||{};Object.keys(u).forEach((function(e){r.headers.append(e,u[e])}));if(Di(r)){t+=(t.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()}var s=e.fetch||vr;return s(t,r)};function u(e,t){return ne(e,T((function(e){c().then((function(){return t.apply(this,e)})).catch((function(t){var r=e.pop();r(t)}))}))).bind(r)}function s(e,t,r){var n={};t=t||{};t.headers=t.headers||new hr;if(!t.headers.get("Content-Type")){t.headers.set("Content-Type","application/json")}if(!t.headers.get("Accept")){t.headers.set("Accept","application/json")}return a(e,t).then((function(e){n.ok=e.ok;n.status=e.status;return e.json()})).then((function(e){n.data=e;if(!n.ok){n.data.status=n.status;var t=Ke(n.data);if(r){return r(t)}else{throw t}}if(Array.isArray(n.data)){n.data=n.data.map((function(e){if(e.error||e.missing){return Ke(e)}else{return e}}))}if(r){r(null,n.data)}else{return n}}))}var f;function c(){if(e.skip_setup){return Promise.resolve()}if(f){return f}f=s(o).catch((function(e){if(e&&e.status&&e.status===404){ye(404,"PouchDB is just detecting if the remote exists.");return s(o,{method:"PUT"})}else{return Promise.reject(e)}})).catch((function(e){if(e&&e.status&&e.status===412){return true}return Promise.reject(e)}));f.catch((function(){f=null}));return f}p((function(){t(null,r)}));r._remote=true;r.type=function(){return"http"};r.id=u("id",(function(e){a(Pi(n,"")).then((function(e){return e.json()})).catch((function(){return{}})).then((function(t){var r=t&&t.uuid?t.uuid+n.db:Ei(n,"");e(null,r)}))}));r.compact=u("compact",(function(e,t){if(typeof e==="function"){t=e;e={}}e=H(e);s(Ei(n,"_compact"),{method:"POST"}).then((function(){function n(){r.info((function(r,i){if(i&&!i.compact_running){t(null,{ok:true})}else{setTimeout(n,e.interval||200)}}))}n()}))}));r.bulkGet=ne("bulkGet",(function(e,t){var r=this;function i(t){var r={};if(e.revs){r.revs=true}if(e.attachments){r.attachments=true}if(e.latest){r.latest=true}s(Ei(n,"_bulk_get"+Ci(r)),{method:"POST",body:JSON.stringify({docs:e.docs})}).then((function(r){if(e.attachments&&e.binary){r.data.results.forEach((function(e){e.docs.forEach(qi)}))}t(null,r.data)})).catch(t)}function o(){var n=ki;var i=Math.ceil(e.docs.length/n);var o=0;var a=new Array(i);function u(e){return function(r,n){a[e]=n.results;if(++o===i){t(null,{results:Ge(a)})}}}for(var s=0;s<i;s++){var f=ie(e,["revs","attachments","binary","latest"]);f.docs=e.docs.slice(s*n,Math.min(e.docs.length,(s+1)*n));se(r,f,u(s))}}var a=Pi(n,"");var u=Oi[a];if(typeof u!=="boolean"){i((function(e,r){if(e){Oi[a]=false;ye(e.status,"PouchDB is just detecting if the remote "+"supports the _bulk_get API.");o()}else{Oi[a]=true;t(null,r)}}))}else if(u){i(t)}else{o()}}));r._info=function(e){c().then((function(){return a(Ei(n,""))})).then((function(e){return e.json()})).then((function(t){t.host=Ei(n,"");e(null,t)})).catch(e)};r.fetch=function(e,t){return c().then((function(){var r=e.substring(0,1)==="/"?Pi(n,e.substring(1)):Ei(n,e);return a(r,t)}))};r.get=u("get",(function(e,t,r){if(typeof t==="function"){r=t;t={}}t=H(t);var i={};if(t.revs){i.revs=true}if(t.revs_info){i.revs_info=true}if(t.latest){i.latest=true}if(t.open_revs){if(t.open_revs!=="all"){t.open_revs=JSON.stringify(t.open_revs)}i.open_revs=t.open_revs}if(t.rev){i.rev=t.rev}if(t.conflicts){i.conflicts=t.conflicts}if(t.update_seq){i.update_seq=t.update_seq}e=Ai(e);function o(e){var r=e._attachments;var i=r&&Object.keys(r);if(!r||!i.length){return}function o(i){var o=r[i];var u=Ai(e._id)+"/"+l(i)+"?rev="+e._rev;return a(Ei(n,u)).then((function(e){if("buffer"in e){return e.buffer()}else{return e.blob()}})).then((function(e){if(t.binary){var r=Object.getOwnPropertyDescriptor(e.__proto__,"type");if(!r||r.set){e.type=o.content_type}return e}return new Promise((function(t){gt(e,t)}))})).then((function(e){delete o.stub;delete o.length;o.data=e}))}var u=i.map((function(e){return function(){return o(e)}}));return bi(u,5)}function u(e){if(Array.isArray(e)){return Promise.all(e.map((function(e){if(e.ok){return o(e.ok)}})))}return o(e)}var f=Ei(n,e+Ci(i));s(f).then((function(e){return Promise.resolve().then((function(){if(t.attachments){return u(e.data)}})).then((function(){r(null,e.data)}))})).catch((function(t){t.docId=e;r(t)}))}));r.remove=u("remove",(function(e,t,r,i){var o;if(typeof t==="string"){o={_id:e,_rev:t};if(typeof r==="function"){i=r;r={}}}else{o=e;if(typeof t==="function"){i=t;r={}}else{i=r;r=t}}var a=o._rev||r.rev;var u=Ei(n,Ai(o._id))+"?rev="+a;s(u,{method:"DELETE"},i).catch(i)}));function l(e){return e.split("/").map(encodeURIComponent).join("/")}r.getAttachment=u("getAttachment",(function(e,t,r,o){if(typeof r==="function"){o=r;r={}}var u=r.rev?"?rev="+r.rev:"";var s=Ei(n,Ai(e))+"/"+l(t)+u;var f;a(s,{method:"GET"}).then((function(e){f=e.headers.get("content-type");if(!e.ok){throw e}else{if(typeof i!=="undefined"&&!i.browser&&typeof e.buffer==="function"){return e.buffer()}else{return e.blob()}}})).then((function(e){if(typeof i!=="undefined"&&!i.browser){e.type=f}o(null,e)})).catch((function(e){o(e)}))}));r.removeAttachment=u("removeAttachment",(function(e,t,r,i){var o=Ei(n,Ai(e)+"/"+l(t))+"?rev="+r;s(o,{method:"DELETE"},i).catch(i)}));r.putAttachment=u("putAttachment",(function(e,t,r,i,o,a){if(typeof o==="function"){a=o;o=i;i=r;r=null}var u=Ai(e)+"/"+l(t);var f=Ei(n,u);if(r){f+="?rev="+r}if(typeof i==="string"){var c;try{c=st(i)}catch(d){return a(ze(xe,"Attachment is not a valid base64 string"))}i=c?dt(c,o):""}s(f,{headers:new hr({"Content-Type":o}),method:"PUT",body:i},a).catch(a)}));r._bulkDocs=function(e,t,r){e.new_edits=t.new_edits;c().then((function(){return Promise.all(e.docs.map($i))})).then((function(){return s(Ei(n,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},r)})).catch(r)};r._put=function(e,t,r){c().then((function(){return $i(e)})).then((function(){return s(Ei(n,Ai(e._id)),{method:"PUT",body:JSON.stringify(e)})})).then((function(e){r(null,e.data)})).catch((function(t){t.docId=e&&e._id;r(t)}))};r.allDocs=u("allDocs",(function(e,t){if(typeof e==="function"){t=e;e={}}e=H(e);var r={};var i;var o="GET";if(e.conflicts){r.conflicts=true}if(e.update_seq){r.update_seq=true}if(e.descending){r.descending=true}if(e.include_docs){r.include_docs=true}if(e.attachments){r.attachments=true}if(e.key){r.key=JSON.stringify(e.key)}if(e.start_key){e.startkey=e.start_key}if(e.startkey){r.startkey=JSON.stringify(e.startkey)}if(e.end_key){e.endkey=e.end_key}if(e.endkey){r.endkey=JSON.stringify(e.endkey)}if(typeof e.inclusive_end!=="undefined"){r.inclusive_end=!!e.inclusive_end}if(typeof e.limit!=="undefined"){r.limit=e.limit}if(typeof e.skip!=="undefined"){r.skip=e.skip}var a=Ci(r);if(typeof e.keys!=="undefined"){o="POST";i={keys:e.keys}}s(Ei(n,"_all_docs"+a),{method:o,body:JSON.stringify(i)}).then((function(r){if(e.include_docs&&e.attachments&&e.binary){r.data.rows.forEach(qi)}t(null,r.data)})).catch(t)}));r._changes=function(e){var t="batch_size"in e?e.batch_size:wi;e=H(e);if(e.continuous&&!("heartbeat"in e)){e.heartbeat=ji}var r={};if("timeout"in e&&e.timeout){r.timeout=e.timeout}var i=typeof e.limit!=="undefined"?e.limit:false;var o=i;if(e.style){r.style=e.style}if(e.include_docs||e.filter&&typeof e.filter==="function"){r.include_docs=true}if(e.attachments){r.attachments=true}if(e.continuous){r.feed="longpoll"}if(e.seq_interval){r.seq_interval=e.seq_interval}if(e.conflicts){r.conflicts=true}if(e.descending){r.descending=true}if(e.update_seq){r.update_seq=true}if("heartbeat"in e){if(e.heartbeat){r.heartbeat=e.heartbeat}}if(e.filter&&typeof e.filter==="string"){r.filter=e.filter}if(e.view&&typeof e.view==="string"){r.filter="_view";r.view=e.view}if(e.query_params&&typeof e.query_params==="object"){for(var a in e.query_params){if(e.query_params.hasOwnProperty(a)){r[a]=e.query_params[a]}}}var u="GET";var f;if(e.doc_ids){r.filter="_doc_ids";u="POST";f={doc_ids:e.doc_ids}}else if(e.selector){r.filter="_selector";u="POST";f={selector:e.selector}}var l=new dr;var d;var v=function(a,v){if(e.aborted){return}r.since=a;if(typeof r.since==="object"){r.since=JSON.stringify(r.since)}if(e.descending){if(i){r.limit=o}}else{r.limit=!i||o>t?t:o}var h=Ei(n,"_changes"+Ci(r));var p={signal:l.signal,method:u,body:JSON.stringify(f)};d=a;if(e.aborted){return}c().then((function(){return s(h,p,v)})).catch(v)};var h={results:[]};var y=function(r,n){if(e.aborted){return}var a=0;if(n&&n.results){a=n.results.length;h.last_seq=n.last_seq;var u=null;var s=null;if(typeof n.pending==="number"){u=n.pending}if(typeof h.last_seq==="string"||typeof h.last_seq==="number"){s=h.last_seq}var f={};f.query=e.query_params;n.results=n.results.filter((function(t){o--;var r=We(e)(t);if(r){if(e.include_docs&&e.attachments&&e.binary){qi(t)}if(e.return_docs){h.results.push(t)}e.onChange(t,u,s)}return r}))}else if(r){e.aborted=true;e.complete(r);return}if(n&&n.last_seq){d=n.last_seq}var c=i&&o<=0||n&&a<t||e.descending;if(e.continuous&&!(i&&o<=0)||!c){p((function(){v(d,y)}))}else{e.complete(null,h)}};v(e.since||0,y);return{cancel:function(){e.aborted=true;l.abort()}}};r.revsDiff=u("revsDiff",(function(e,t,r){if(typeof t==="function"){r=t;t={}}s(Ei(n,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},r).catch(r)}));r._close=function(e){e()};r._destroy=function(e,t){s(Ei(n,""),{method:"DELETE"}).then((function(e){t(null,e)})).catch((function(e){if(e.status===404){t(null,{ok:true})}else{t(e)}}))}}Ii.valid=function(){return true};function Bi(e){e.adapter("http",Ii,false);e.adapter("https",Ii,false)}function Li(e){this.status=400;this.name="query_parse_error";this.message=e;this.error=true;try{Error.captureStackTrace(this,Li)}catch(Mf){}}N(Li,Error);function Ti(e){this.status=404;this.name="not_found";this.message=e;this.error=true;try{Error.captureStackTrace(this,Ti)}catch(Mf){}}N(Ti,Error);function Mi(e){this.status=500;this.name="invalid_value";this.message=e;this.error=true;try{Error.captureStackTrace(this,Mi)}catch(Mf){}}N(Mi,Error);function Ni(e,t){if(t){e.then((function(e){p((function(){t(null,e)}))}),(function(e){p((function(){t(e)}))}))}return e}function Ri(e){return T((function(t){var r=t.pop();var n=e.apply(this,t);if(typeof r==="function"){Ni(n,r)}return n}))}function Fi(e,t){return e.then((function(e){return t().then((function(){return e}))}),(function(e){return t().then((function(){throw e}))}))}function Ui(e,t){return function(){var r=arguments;var n=this;return e.add((function(){return t.apply(n,r)}))}}function Ji(e){var t=new K(e);var r=new Array(t.size);var n=-1;t.forEach((function(e){r[++n]=e}));return r}function zi(e){var t=new Array(e.size);var r=-1;e.forEach((function(e,n){t[++r]=n}));return t}function Ki(e){var t="builtin "+e+" function requires map values to be numbers"+" or number arrays";return new Mi(t)}function Vi(e){var t=0;for(var r=0,n=e.length;r<n;r++){var i=e[r];if(typeof i!=="number"){if(Array.isArray(i)){t=typeof t==="number"?[t]:t;for(var o=0,a=i.length;o<a;o++){var u=i[o];if(typeof u!=="number"){throw Ki("_sum")}else if(typeof t[o]==="undefined"){t.push(u)}else{t[o]+=u}}}else{throw Ki("_sum")}}else if(typeof t==="number"){t+=i}else{t[0]+=i}}return t}var Wi=ve.bind(null,"log");var Gi=Array.isArray;var Qi=JSON.parse;function Zi(e,t){return ot("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Vi,log:Wi,isArray:Gi,toJSON:Qi})}function Xi(){this.promise=new Promise((function(e){e()}))}Xi.prototype.add=function(e){this.promise=this.promise.catch((function(){})).then((function(){return e()}));return this.promise};Xi.prototype.finish=function(){return this.promise};function Yi(e){if(!e){return"undefined"}switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function Hi(e,t){return Yi(e)+Yi(t)+"undefined"}function eo(e,t,r,n,i,o){var a=Hi(r,n);var u;if(!i){u=e._cachedViews=e._cachedViews||{};if(u[a]){return u[a]}}var s=e.info().then((function(s){var f=s.db_name+"-mrview-"+(i?"temp":At(a));function c(e){e.views=e.views||{};var r=t;if(r.indexOf("/")===-1){r=t+"/"+t}var n=e.views[r]=e.views[r]||{};if(n[f]){return}n[f]=true;return e}return at(e,"_local/"+o,c).then((function(){return e.registerDependentDatabase(f).then((function(t){var i=t.db;i.auto_compaction=true;var o={name:f,db:i,sourceDB:e,adapter:e.adapter,mapFun:r,reduceFun:n};return o.db.get("_local/lastSeq").catch((function(e){if(e.status!==404){throw e}})).then((function(e){o.seq=e?e.seq:0;if(u){o.db.once("destroyed",(function(){delete u[a]}))}return o}))}))}))}));if(u){u[a]=s}return s}var to={};var ro=new Xi;var no=50;function io(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function oo(e){return e.length===1&&/^1-/.test(e[0].rev)}function ao(e,t){try{e.emit("error",t)}catch(r){ve("error","The user's map/reduce function threw an uncaught error.\n"+"You can debug this error by doing:\n"+"myDatabase.on('error', function (err) { debugger; });\n"+"Please double-check your map/reduce function.");ve("error",t)}}function uo(e,t,r,n){function i(e,t,r){try{t(r)}catch(Mf){ao(e,Mf)}}function o(e,t,r,n,i){try{return{output:t(r,n,i)}}catch(Mf){ao(e,Mf);return{error:Mf}}}function a(e,t){var r=Mr(e.key,t.key);return r!==0?r:Mr(e.value,t.value)}function u(e,t,r){r=r||0;if(typeof t==="number"){return e.slice(r,t+r)}else if(r>0){return e.slice(r)}return e}function s(e){var t=e.value;var r=t&&typeof t==="object"&&t._id||e.id;return r}function f(e){e.rows.forEach((function(e){var t=e.doc&&e.doc._attachments;if(!t){return}Object.keys(t).forEach((function(e){var r=t[e];t[e].data=vt(r.data,r.content_type)}))}))}function c(e){return function(t){if(e.include_docs&&e.attachments&&e.binary){f(t)}return t}}function l(e,t,r,n){var i=t[e];if(typeof i!=="undefined"){if(n){i=encodeURIComponent(JSON.stringify(i))}r.push(e+"="+i)}}function d(e){if(typeof e!=="undefined"){var t=Number(e);if(!isNaN(t)&&t===parseInt(e,10)){return t}else{return e}}}function v(e){e.group_level=d(e.group_level);e.limit=d(e.limit);e.skip=d(e.skip);return e}function h(e){if(e){if(typeof e!=="number"){return new Li('Invalid value for integer: "'+e+'"')}if(e<0){return new Li("Invalid value for positive integer: "+'"'+e+'"')}}}function y(e,t){var r=e.descending?"endkey":"startkey";var n=e.descending?"startkey":"endkey";if(typeof e[r]!=="undefined"&&typeof e[n]!=="undefined"&&Mr(e[r],e[n])>0){throw new Li("No rows can match your key range, "+"reverse your start_key and end_key or set {descending : true}")}else if(t.reduce&&e.reduce!==false){if(e.include_docs){throw new Li("{include_docs:true} is invalid for reduce")}else if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level){throw new Li("Multi-key fetches for reduce views must use "+"{group: true}")}}["group_level","limit","skip"].forEach((function(t){var r=h(e[t]);if(r){throw r}}))}function g(e,t,r){var n=[];var i;var o="GET";var a,u;l("reduce",r,n);l("include_docs",r,n);l("attachments",r,n);l("limit",r,n);l("descending",r,n);l("group",r,n);l("group_level",r,n);l("skip",r,n);l("stale",r,n);l("conflicts",r,n);l("startkey",r,n,true);l("start_key",r,n,true);l("endkey",r,n,true);l("end_key",r,n,true);l("inclusive_end",r,n);l("key",r,n,true);l("update_seq",r,n);n=n.join("&");n=n===""?"":"?"+n;if(typeof r.keys!=="undefined"){var s=2e3;var f="keys="+encodeURIComponent(JSON.stringify(r.keys));if(f.length+n.length+1<=s){n+=(n[0]==="?"?"&":"?")+f}else{o="POST";if(typeof t==="string"){i={keys:r.keys}}else{t.keys=r.keys}}}if(typeof t==="string"){var d=io(t);return e.fetch("_design/"+d[0]+"/_view/"+d[1]+n,{headers:new hr({"Content-Type":"application/json"}),method:o,body:JSON.stringify(i)}).then((function(e){a=e.ok;u=e.status;return e.json()})).then((function(e){if(!a){e.status=u;throw Ke(e)}e.rows.forEach((function(e){if(e.value&&e.value.error&&e.value.error==="builtin_reduce_error"){throw new Error(e.reason)}}));return e})).then(c(r))}i=i||{};Object.keys(t).forEach((function(e){if(Array.isArray(t[e])){i[e]=t[e]}else{i[e]=t[e].toString()}}));return e.fetch("_temp_view"+n,{headers:new hr({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(i)}).then((function(e){a=e.ok;u=e.status;return e.json()})).then((function(e){if(!a){e.status=u;throw Ke(e)}return e})).then(c(r))}function _(e,t,r){return new Promise((function(n,i){e._query(t,r,(function(e,t){if(e){return i(e)}n(t)}))}))}function m(e){return new Promise((function(t,r){e._viewCleanup((function(e,n){if(e){return r(e)}t(n)}))}))}function b(e){return function(t){if(t.status===404){return e}else{throw t}}}function w(e,t,r){var n="_local/doc_"+e;var i={_id:n,keys:[]};var o=r.get(e);var a=o[0];var u=o[1];function s(){if(oo(u)){return Promise.resolve(i)}return t.db.get(n).catch(b(i))}function f(e){if(!e.keys.length){return Promise.resolve({rows:[]})}return t.db.allDocs({keys:e.keys,include_docs:true})}function c(e,t){var r=[];var n=new K;for(var i=0,o=t.rows.length;i<o;i++){var u=t.rows[i];var s=u.doc;if(!s){continue}r.push(s);n.add(s._id);s._deleted=!a.has(s._id);if(!s._deleted){var f=a.get(s._id);if("value"in f){s.value=f.value}}}var c=zi(a);c.forEach((function(e){if(!n.has(e)){var t={_id:e};var i=a.get(e);if("value"in i){t.value=i.value}r.push(t)}}));e.keys=Ji(c.concat(e.keys));r.push(e);return r}return s().then((function(e){return f(e).then((function(t){return c(e,t)}))}))}function k(e,t,r){var n="_local/lastSeq";return e.db.get(n).catch(b({_id:n,seq:0})).then((function(n){var i=zi(t);return Promise.all(i.map((function(r){return w(r,e,t)}))).then((function(t){var i=Ge(t);n.seq=r;i.push(n);return e.db.bulkDocs({docs:i})}))}))}function j(e){var t=typeof e==="string"?e:e.name;var r=to[t];if(!r){r=to[t]=new Xi}return r}function O(e){return Ui(j(e),(function(){return q(e)}))()}function q(e){var r;var n;function o(e,t){var i={id:n._id,key:Nr(e)};if(typeof t!=="undefined"&&t!==null){i.value=Nr(t)}r.push(i)}var u=t(e.mapFun,o);var s=e.seq||0;function f(t,r){return function(){return k(e,t,r)}}var c=new Xi;function l(){return e.sourceDB.changes({return_docs:true,conflicts:true,include_docs:true,style:"all_docs",since:s,limit:no}).then(d)}function d(e){var t=e.results;if(!t.length){return}var r=v(t);c.add(f(r,s));if(t.length<no){return}return l()}function v(t){var o=new V;for(var f=0,c=t.length;f<c;f++){var l=t[f];if(l.doc._id[0]!=="_"){r=[];n=l.doc;if(!n._deleted){i(e.sourceDB,u,n)}r.sort(a);var d=h(r);o.set(l.doc._id,[d,l.changes])}s=l.seq}return o}function h(e){var t=new V;var r;for(var n=0,i=e.length;n<i;n++){var o=e[n];var a=[o.key,o.id];if(n>0&&Mr(o.key,r)===0){a.push(n)}t.set(Fr(a),o);r=o.key}return t}return l().then((function(){return c.finish()})).then((function(){e.seq=s}))}function A(e,t,n){if(n.group_level===0){delete n.group_level}var i=n.group||n.group_level;var a=r(e.reduceFun);var s=[];var f=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach((function(e){var t=s[s.length-1];var r=i?e.key:null;if(i&&Array.isArray(r)){r=r.slice(0,f)}if(t&&Mr(t.groupKey,r)===0){t.keys.push([e.key,e.id]);t.values.push(e.value);return}s.push({keys:[[e.key,e.id]],values:[e.value],groupKey:r})}));t=[];for(var c=0,l=s.length;c<l;c++){var d=s[c];var v=o(e.sourceDB,a,d.keys,d.values,false);if(v.error&&v.error instanceof Mi){throw v.error}t.push({value:v.error?null:v.output,key:d.groupKey})}return{rows:u(t,n.limit,n.skip)}}function $(e,t){return Ui(j(e),(function(){return S(e,t)}))()}function S(e,t){var r;var n=e.reduceFun&&t.reduce!==false;var i=t.skip||0;if(typeof t.keys!=="undefined"&&!t.keys.length){t.limit=0;delete t.keys}function o(t){t.include_docs=true;return e.db.allDocs(t).then((function(e){r=e.total_rows;return e.rows.map((function(e){if("value"in e.doc&&typeof e.doc.value==="object"&&e.doc.value!==null){var t=Object.keys(e.doc.value).sort();var r=["id","key","value"];if(!(t<r||t>r)){return e.doc.value}}var n=zr(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}}))}))}function a(o){var a;if(n){a=A(e,o,t)}else{a={total_rows:r,offset:i,rows:o}}if(t.update_seq){a.update_seq=e.seq}if(t.include_docs){var u=Ji(o.map(s));return e.sourceDB.allDocs({keys:u,include_docs:true,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then((function(e){var t=new V;e.rows.forEach((function(e){t.set(e.id,e.doc)}));o.forEach((function(e){var r=s(e);var n=t.get(r);if(n){e.doc=n}}));return a}))}else{return a}}if(typeof t.keys!=="undefined"){var u=t.keys;var f=u.map((function(e){var r={startkey:Fr([e]),endkey:Fr([e,{}])};if(t.update_seq){r.update_seq=true}return o(r)}));return Promise.all(f).then(Ge).then(a)}else{var c={descending:t.descending};if(t.update_seq){c.update_seq=true}var l;var d;if("start_key"in t){l=t.start_key}if("startkey"in t){l=t.startkey}if("end_key"in t){d=t.end_key}if("endkey"in t){d=t.endkey}if(typeof l!=="undefined"){c.startkey=t.descending?Fr([l,{}]):Fr([l])}if(typeof d!=="undefined"){var v=t.inclusive_end!==false;if(t.descending){v=!v}c.endkey=Fr(v?[d,{}]:[d])}if(typeof t.key!=="undefined"){var h=Fr([t.key]);var p=Fr([t.key,{}]);if(c.descending){c.endkey=h;c.startkey=p}else{c.startkey=h;c.endkey=p}}if(!n){if(typeof t.limit==="number"){c.limit=t.limit}c.skip=i}return o(c).then(a)}}function x(e){return e.fetch("_view_cleanup",{headers:new hr({"Content-Type":"application/json"}),method:"POST"}).then((function(e){return e.json()}))}function E(t){return t.get("_local/"+e).then((function(e){var r=new V;Object.keys(e.views).forEach((function(e){var t=io(e);var n="_design/"+t[0];var i=t[1];var o=r.get(n);if(!o){o=new K;r.set(n,o)}o.add(i)}));var n={keys:zi(r),include_docs:true};return t.allDocs(n).then((function(n){var i={};n.rows.forEach((function(t){var n=t.key.substring(8);r.get(t.key).forEach((function(r){var o=n+"/"+r;if(!e.views[o]){o=r}var a=Object.keys(e.views[o]);var u=t.doc&&t.doc.views&&t.doc.views[r];a.forEach((function(e){i[e]=i[e]||u}))}))}));var o=Object.keys(i).filter((function(e){return!i[e]}));var a=o.map((function(e){return Ui(j(e),(function(){return new t.constructor(e,t.__opts).destroy()}))()}));return Promise.all(a).then((function(){return{ok:true}}))}))}),b({ok:true}))}function P(t,r,i){if(typeof t._query==="function"){return _(t,r,i)}if(Ze(t)){return g(t,r,i)}if(typeof r!=="string"){y(i,r);ro.add((function(){var n=eo(t,"temp_view/temp_view",r.map,r.reduce,true,e);return n.then((function(e){return Fi(O(e).then((function(){return $(e,i)})),(function(){return e.db.destroy()}))}))}));return ro.finish()}else{var o=r;var a=io(o);var u=a[0];var s=a[1];return t.get("_design/"+u).then((function(r){var a=r.views&&r.views[s];if(!a){throw new Ti("ddoc "+r._id+" has no view named "+s)}n(r,s);y(i,a);var u=eo(t,o,a.map,a.reduce,false,e);return u.then((function(e){if(i.stale==="ok"||i.stale==="update_after"){if(i.stale==="update_after"){p((function(){O(e)}))}return $(e,i)}else{return O(e).then((function(){return $(e,i)}))}}))}))}}function C(e,t,r){var n=this;if(typeof t==="function"){r=t;t={}}t=t?v(t):{};if(typeof e==="function"){e={map:e}}var i=Promise.resolve().then((function(){return P(n,e,t)}));Ni(i,r);return i}var D=Ri((function(){var e=this;if(typeof e._viewCleanup==="function"){return m(e)}if(Ze(e)){return x(e)}return E(e)}));return{query:C,viewCleanup:D}}var so={_sum:function(e,t){return Vi(t)},_count:function(e,t){return t.length},_stats:function(e,t){function r(e){var t=0;for(var r=0,n=e.length;r<n;r++){var i=e[r];t+=i*i}return t}return{sum:Vi(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:r(t)}}};function fo(e){if(/^_sum/.test(e)){return so._sum}else if(/^_count/.test(e)){return so._count}else if(/^_stats/.test(e)){return so._stats}else if(/^_/.test(e)){throw new Error(e+" is not a supported reduce function.")}}function co(e,t){if(typeof e==="function"&&e.length===2){var r=e;return function(e){return r(e,t)}}else{return Zi(e.toString(),t)}}function lo(e){var t=e.toString();var r=fo(t);if(r){return r}else{return Zi(t)}}function vo(e,t){var r=e.views&&e.views[t];if(typeof r.map!=="string"){throw new Ti("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof r.map)}}var ho="mrviews";var po=uo(ho,co,lo,vo);function yo(e,t,r){return po.query.call(this,e,t,r)}function go(e){return po.viewCleanup.call(this,e)}var _o={query:yo,viewCleanup:go};function mo(e){return/^1-/.test(e)}function bo(e,t,r){return!e._attachments||!e._attachments[r]||e._attachments[r].digest!==t._attachments[r].digest}function wo(e,t){var r=Object.keys(t._attachments);return Promise.all(r.map((function(r){return e.getAttachment(t._id,r,{rev:t._rev})})))}function ko(e,t,r){var n=Ze(t)&&!Ze(e);var i=Object.keys(r._attachments);if(!n){return wo(t,r)}return e.get(r._id).then((function(n){return Promise.all(i.map((function(i){if(bo(n,r,i)){return t.getAttachment(r._id,i)}return e.getAttachment(n._id,i)})))})).catch((function(e){if(e.status!==404){throw e}return wo(t,r)}))}function jo(e){var t=[];Object.keys(e).forEach((function(r){var n=e[r].missing;n.forEach((function(e){t.push({id:r,rev:e})}))}));return{docs:t,revs:true,latest:true}}function Oo(e,t,r,n){r=H(r);var i=[],o=true;function a(){var a=jo(r);if(!a.docs.length){return}return e.bulkGet(a).then((function(r){if(n.cancelled){throw new Error("cancelled")}return Promise.all(r.results.map((function(r){return Promise.all(r.docs.map((function(r){var n=r.ok;if(r.error){o=false}if(!n||!n._attachments){return n}return ko(t,e,n).then((function(e){var t=Object.keys(n._attachments);e.forEach((function(e,r){var i=n._attachments[t[r]];delete i.stub;delete i.length;i.data=e}));return n}))})))}))).then((function(e){i=i.concat(Ge(e).filter(Boolean))}))}))}function u(e){return e._attachments&&Object.keys(e._attachments).length>0}function s(e){return e._conflicts&&e._conflicts.length>0}function f(t){return e.allDocs({keys:t,include_docs:true,conflicts:true}).then((function(e){if(n.cancelled){throw new Error("cancelled")}e.rows.forEach((function(e){if(e.deleted||!e.doc||!mo(e.value.rev)||u(e.doc)||s(e.doc)){return}if(e.doc._conflicts){delete e.doc._conflicts}i.push(e.doc);delete r[e.id]}))}))}function c(){var e=Object.keys(r).filter((function(e){var t=r[e].missing;return t.length===1&&mo(t[0])}));if(e.length>0){return f(e)}}function l(){return{ok:o,docs:i}}return Promise.resolve().then(c).then(a).then(l)}var qo=1;var Ao="pouchdb";var $o=5;var So=0;function xo(e,t,r,n,i){return e.get(t).catch((function(r){if(r.status===404){if(e.adapter==="http"||e.adapter==="https"){ye(404,"PouchDB is just checking if a remote checkpoint exists.")}return{session_id:n,_id:t,history:[],replicator:Ao,version:qo}}throw r})).then((function(o){if(i.cancelled){return}if(o.last_seq===r){return}o.history=(o.history||[]).filter((function(e){return e.session_id!==n}));o.history.unshift({last_seq:r,session_id:n});o.history=o.history.slice(0,$o);o.version=qo;o.replicator=Ao;o.session_id=n;o.last_seq=r;return e.put(o).catch((function(o){if(o.status===409){return xo(e,t,r,n,i)}throw o}))}))}function Eo(e,t,r,n,i){this.src=e;this.target=t;this.id=r;this.returnValue=n;this.opts=i||{}}Eo.prototype.writeCheckpoint=function(e,t){var r=this;return this.updateTarget(e,t).then((function(){return r.updateSource(e,t)}))};Eo.prototype.updateTarget=function(e,t){if(this.opts.writeTargetCheckpoint){return xo(this.target,this.id,e,t,this.returnValue)}else{return Promise.resolve(true)}};Eo.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var r=this;return xo(this.src,this.id,e,t,this.returnValue).catch((function(e){if(Bo(e)){r.opts.writeSourceCheckpoint=false;return true}throw e}))}else{return Promise.resolve(true)}};var Po={undefined:function(e,t){if(Mr(e.last_seq,t.last_seq)===0){return t.last_seq}return 0},1:function(e,t){return Co(t,e).last_seq}};Eo.prototype.getCheckpoint=function(){var e=this;if(e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint){return e.src.get(e.id).then((function(e){return e.last_seq||So})).catch((function(e){if(e.status!==404){throw e}return So}))}return e.target.get(e.id).then((function(t){if(e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint){return t.last_seq||So}return e.src.get(e.id).then((function(e){if(t.version!==e.version){return So}var r;if(t.version){r=t.version.toString()}else{r="undefined"}if(r in Po){return Po[r](t,e)}return So}),(function(r){if(r.status===404&&t.last_seq){return e.src.put({_id:e.id,last_seq:So}).then((function(){return So}),(function(r){if(Bo(r)){e.opts.writeSourceCheckpoint=false;return t.last_seq}return So}))}throw r}))})).catch((function(e){if(e.status!==404){throw e}return So}))};function Co(e,t){if(e.session_id===t.session_id){return{last_seq:e.last_seq,history:e.history}}return Do(e.history,t.history)}function Do(e,t){var r=e[0];var n=e.slice(1);var i=t[0];var o=t.slice(1);if(!r||t.length===0){return{last_seq:So,history:[]}}var a=r.session_id;if(Io(a,t)){return{last_seq:r.last_seq,history:e}}var u=i.session_id;if(Io(u,n)){return{last_seq:i.last_seq,history:o}}return Do(n,o)}function Io(e,t){var r=t[0];var n=t.slice(1);if(!e||t.length===0){return false}if(e===r.session_id){return true}return Io(e,n)}function Bo(e){return typeof e.status==="number"&&Math.floor(e.status/100)===4}var Lo=0;function To(e,t,r,n){if(e.retry===false){t.emit("error",r);t.removeAllListeners();return}if(typeof e.back_off_function!=="function"){e.back_off_function=pe}t.emit("requestError",r);if(t.state==="active"||t.state==="pending"){t.emit("paused",r);t.state="stopped";var i=function t(){e.current_back_off=Lo};var o=function e(){t.removeListener("active",i)};t.once("paused",o);t.once("active",i)}e.current_back_off=e.current_back_off||Lo;e.current_back_off=e.back_off_function(e.current_back_off);setTimeout(n,e.current_back_off)}function Mo(e){return Object.keys(e).sort(Mr).reduce((function(t,r){t[r]=e[r];return t}),{})}function No(e,t,r){var n=r.doc_ids?r.doc_ids.sort(Mr):"";var i=r.filter?r.filter.toString():"";var o="";var a="";var u="";if(r.selector){u=JSON.stringify(r.selector)}if(r.filter&&r.query_params){o=JSON.stringify(Mo(r.query_params))}if(r.filter&&r.filter==="_view"){a=r.view.toString()}return Promise.all([e.id(),t.id()]).then((function(e){var t=e[0]+e[1]+i+a+o+n+u;return new Promise((function(e){qt(t,e)}))})).then((function(e){e=e.replace(/\//g,".").replace(/\+/g,"_");return"_local/"+e}))}function Ro(e,t,r,n,i){var o=[];var a;var u={seq:0,changes:[],docs:[]};var s=false;var f=false;var c=false;var l=0;var d=r.continuous||r.live||false;var v=r.batch_size||100;var h=r.batches_limit||10;var y=false;var g=r.doc_ids;var _=r.selector;var m;var b;var w=[];var k=St();i=i||{ok:true,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var j={};n.ready(e,t);function O(){if(b){return Promise.resolve()}return No(e,t,r).then((function(i){m=i;var o={};if(r.checkpoint===false){o={writeSourceCheckpoint:false,writeTargetCheckpoint:false}}else if(r.checkpoint==="source"){o={writeSourceCheckpoint:true,writeTargetCheckpoint:false}}else if(r.checkpoint==="target"){o={writeSourceCheckpoint:false,writeTargetCheckpoint:true}}else{o={writeSourceCheckpoint:true,writeTargetCheckpoint:true}}b=new Eo(e,t,m,n,o)}))}function q(){w=[];if(a.docs.length===0){return}var e=a.docs;var o={timeout:r.timeout};return t.bulkDocs({docs:e,new_edits:false},o).then((function(t){if(n.cancelled){C();throw new Error("cancelled")}var r=Object.create(null);t.forEach((function(e){if(e.error){r[e.id]=e}}));var o=Object.keys(r).length;i.doc_write_failures+=o;i.docs_written+=e.length-o;e.forEach((function(e){var t=r[e._id];if(t){i.errors.push(t);var o=(t.name||"").toLowerCase();if(o==="unauthorized"||o==="forbidden"){n.emit("denied",H(t))}else{throw t}}else{w.push(e)}}))}),(function(t){i.doc_write_failures+=e.length;throw t}))}function A(){if(a.error){throw new Error("There was a problem getting docs.")}i.last_seq=l=a.seq;var e=H(i);if(w.length){e.docs=w;if(typeof a.pending==="number"){e.pending=a.pending;delete a.pending}n.emit("change",e)}s=true;return b.writeCheckpoint(a.seq,k).then((function(){s=false;if(n.cancelled){C();throw new Error("cancelled")}a=undefined;L()})).catch((function(e){M(e);throw e}))}function $(){var e={};a.changes.forEach((function(t){if(t.id==="_user/"){return}e[t.id]=t.changes.map((function(e){return e.rev}))}));return t.revsDiff(e).then((function(e){if(n.cancelled){C();throw new Error("cancelled")}a.diffs=e}))}function S(){return Oo(e,t,a.diffs,n).then((function(e){a.error=!e.ok;e.docs.forEach((function(e){delete a.diffs[e._id];i.docs_read++;a.docs.push(e)}))}))}function x(){if(n.cancelled||a){return}if(o.length===0){E(true);return}a=o.shift();$().then(S).then(q).then(A).then(x).catch((function(e){P("batch processing terminated with error",e)}))}function E(e){if(u.changes.length===0){if(o.length===0&&!a){if(d&&j.live||f){n.state="pending";n.emit("paused")}if(f){C()}}return}if(e||f||u.changes.length>=v){o.push(u);u={seq:0,changes:[],docs:[]};if(n.state==="pending"||n.state==="stopped"){n.state="active";n.emit("active")}x()}}function P(e,t){if(c){return}if(!t.message){t.message=e}i.ok=false;i.status="aborting";o=[];u={seq:0,changes:[],docs:[]};C(t)}function C(o){if(c){return}if(n.cancelled){i.status="cancelled";if(s){return}}i.status=i.status||"complete";i.end_time=(new Date).toISOString();i.last_seq=l;c=true;if(o){o=ze(o);o.result=i;var a=(o.name||"").toLowerCase();if(a==="unauthorized"||a==="forbidden"){n.emit("error",o);n.removeAllListeners()}else{To(r,n,o,(function(){Ro(e,t,r,n)}))}}else{n.emit("complete",i);n.removeAllListeners()}}function D(e,t,i){if(n.cancelled){return C()}if(typeof t==="number"){u.pending=t}var a=We(r)(e);if(!a){return}u.seq=e.seq||i;u.changes.push(e);p((function(){E(o.length===0&&j.live)}))}function I(e){y=false;if(n.cancelled){return C()}if(e.results.length>0){j.since=e.results[e.results.length-1].seq;L();E(true)}else{var t=function(){if(d){j.live=true;L()}else{f=true}E(true)};if(!a&&e.results.length===0){s=true;b.writeCheckpoint(e.last_seq,k).then((function(){s=false;i.last_seq=l=e.last_seq;t()})).catch(M)}else{t()}}}function B(e){y=false;if(n.cancelled){return C()}P("changes rejected",e)}function L(){if(!(!y&&!f&&o.length<h)){return}y=true;function t(){a.cancel()}function i(){n.removeListener("cancel",t)}if(n._changes){n.removeListener("cancel",n._abortChanges);n._changes.cancel()}n.once("cancel",t);var a=e.changes(j).on("change",D);a.then(i,i);a.then(I).catch(B);if(r.retry){n._changes=a;n._abortChanges=t}}function T(){O().then((function(){if(n.cancelled){C();return}return b.getCheckpoint().then((function(e){l=e;j={since:l,limit:v,batch_size:v,style:"all_docs",doc_ids:g,selector:_,return_docs:true};if(r.filter){if(typeof r.filter!=="string"){j.include_docs=true}else{j.filter=r.filter}}if("heartbeat"in r){j.heartbeat=r.heartbeat}if("timeout"in r){j.timeout=r.timeout}if(r.query_params){j.query_params=r.query_params}if(r.view){j.view=r.view}L()}))})).catch((function(e){P("getCheckpoint rejected with ",e)}))}function M(e){s=false;P("writeCheckpoint completed with error",e)}if(n.cancelled){C();return}if(!n._addedListeners){n.once("cancel",C);if(typeof r.complete==="function"){n.once("error",r.complete);n.once("complete",(function(e){r.complete(null,e)}))}n._addedListeners=true}if(typeof r.since==="undefined"){T()}else{O().then((function(){s=true;return b.writeCheckpoint(r.since,k)})).then((function(){s=false;if(n.cancelled){C();return}l=r.since;T()})).catch(M)}}N(Fo,o);function Fo(){o.call(this);this.cancelled=false;this.state="pending";var e=this;var t=new Promise((function(t,r){e.once("complete",t);e.once("error",r)}));e.then=function(e,r){return t.then(e,r)};e.catch=function(e){return t.catch(e)};e.catch((function(){}))}Fo.prototype.cancel=function(){this.cancelled=true;this.state="cancelled";this.emit("cancel")};Fo.prototype.ready=function(e,t){var r=this;if(r._readyCalled){return}r._readyCalled=true;function n(){r.cancel()}e.once("destroyed",n);t.once("destroyed",n);function i(){e.removeListener("destroyed",n);t.removeListener("destroyed",n)}r.once("complete",i)};function Uo(e,t){var r=t.PouchConstructor;if(typeof e==="string"){return new r(e,t)}else{return e}}function Jo(e,t,r,n){if(typeof r==="function"){n=r;r={}}if(typeof r==="undefined"){r={}}if(r.doc_ids&&!Array.isArray(r.doc_ids)){throw ze(De,"`doc_ids` filter parameter is not a list.")}r.complete=n;r=H(r);r.continuous=r.continuous||r.live;r.retry="retry"in r?r.retry:false;r.PouchConstructor=r.PouchConstructor||this;var i=new Fo(r);var o=Uo(e,r);var a=Uo(t,r);Ro(o,a,r,i);return i}N(Ko,o);function zo(e,t,r,n){if(typeof r==="function"){n=r;r={}}if(typeof r==="undefined"){r={}}r=H(r);r.PouchConstructor=r.PouchConstructor||this;e=Uo(e,r);t=Uo(t,r);return new Ko(e,t,r,n)}function Ko(e,t,r,n){var i=this;this.canceled=false;var o=r.push?_e({},r,r.push):r;var a=r.pull?_e({},r,r.pull):r;this.push=Jo(e,t,o);this.pull=Jo(t,e,a);this.pushPaused=true;this.pullPaused=true;function u(e){i.emit("change",{direction:"pull",change:e})}function s(e){i.emit("change",{direction:"push",change:e})}function f(e){i.emit("denied",{direction:"push",doc:e})}function c(e){i.emit("denied",{direction:"pull",doc:e})}function l(){i.pushPaused=true;if(i.pullPaused){i.emit("paused")}}function d(){i.pullPaused=true;if(i.pushPaused){i.emit("paused")}}function v(){i.pushPaused=false;if(i.pullPaused){i.emit("active",{direction:"push"})}}function h(){i.pullPaused=false;if(i.pushPaused){i.emit("active",{direction:"pull"})}}var p={};function y(e){return function(t,r){var n=t==="change"&&(r===u||r===s);var o=t==="denied"&&(r===c||r===f);var a=t==="paused"&&(r===d||r===l);var y=t==="active"&&(r===h||r===v);if(n||o||a||y){if(!(t in p)){p[t]={}}p[t][e]=true;if(Object.keys(p[t]).length===2){i.removeAllListeners(t)}}}}if(r.live){this.push.on("complete",i.pull.cancel.bind(i.pull));this.pull.on("complete",i.push.cancel.bind(i.push))}function g(e,t,r){if(e.listeners(t).indexOf(r)==-1){e.on(t,r)}}this.on("newListener",(function(e){if(e==="change"){g(i.pull,"change",u);g(i.push,"change",s)}else if(e==="denied"){g(i.pull,"denied",c);g(i.push,"denied",f)}else if(e==="active"){g(i.pull,"active",h);g(i.push,"active",v)}else if(e==="paused"){g(i.pull,"paused",d);g(i.push,"paused",l)}}));this.on("removeListener",(function(e){if(e==="change"){i.pull.removeListener("change",u);i.push.removeListener("change",s)}else if(e==="denied"){i.pull.removeListener("denied",c);i.push.removeListener("denied",f)}else if(e==="active"){i.pull.removeListener("active",h);i.push.removeListener("active",v)}else if(e==="paused"){i.pull.removeListener("paused",d);i.push.removeListener("paused",l)}}));this.pull.on("removeListener",y("pull"));this.push.on("removeListener",y("push"));var _=Promise.all([this.push,this.pull]).then((function(e){var t={push:e[0],pull:e[1]};i.emit("complete",t);if(n){n(null,t)}i.removeAllListeners();return t}),(function(e){i.cancel();if(n){n(e)}else{i.emit("error",e)}i.removeAllListeners();if(n){throw e}}));this.then=function(e,t){return _.then(e,t)};this.catch=function(e){return _.catch(e)}}Ko.prototype.cancel=function(){if(!this.canceled){this.canceled=true;this.push.cancel();this.pull.cancel()}};function Vo(e){e.replicate=Jo;e.sync=zo;Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;if(typeof this.replicateMethods==="undefined"){this.replicateMethods={from:function(t,r,n){return e.constructor.replicate(t,e,r,n)},to:function(t,r,n){return e.constructor.replicate(e,t,r,n)}}}return this.replicateMethods}});e.prototype.sync=function(e,t,r){return this.constructor.sync(this,e,t,r)}}lr.plugin(mi).plugin(Bi).plugin(_o).plugin(Vo);N(Wo,Error);function Wo(e,t,r){Error.call(this,r);this.status=e;this.name=t;this.message=r;this.error=true}Wo.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var Go=new Wo(401,"unauthorized","Name or password is incorrect.");var Qo=new Wo(400,"bad_request","Missing JSON list of 'docs'");var Zo=new Wo(404,"not_found","missing");var Xo=new Wo(409,"conflict","Document update conflict");var Yo=new Wo(400,"bad_request","_id field must contain a string");var Ho=new Wo(412,"missing_id","_id is required for puts");var ea=new Wo(400,"bad_request","Only reserved document ids may start with underscore.");var ta=new Wo(412,"precondition_failed","Database not open");var ra=new Wo(500,"unknown_error","Database encountered an unknown error");var na=new Wo(500,"badarg","Some query argument is invalid");var ia=new Wo(400,"invalid_request","Request was invalid");var oa=new Wo(400,"query_parse_error","Some query parameter is invalid");var aa=new Wo(500,"doc_validation","Bad special document member");var ua=new Wo(400,"bad_request","Something wrong with the request");var sa=new Wo(400,"bad_request","Document must be a JSON object");var fa=new Wo(404,"not_found","Database not found");var ca=new Wo(500,"indexed_db_went_bad","unknown");var la=new Wo(500,"web_sql_went_bad","unknown");var da=new Wo(500,"levelDB_went_went_bad","unknown");var va=new Wo(403,"forbidden","Forbidden by design doc validate_doc_update function");var ha=new Wo(400,"bad_request","Invalid rev format");var pa=new Wo(412,"file_exists","The database could not be created, the file already exists.");var ya=new Wo(412,"missing_stub","A pre-existing attachment stub wasn't found");var ga=new Wo(413,"invalid_url","Provided URL is invalid");function _a(e){if(typeof e!=="object"){var t=e;e=ra;e.data=t}if("error"in e&&e.error==="conflict"){e.name="conflict";e.status=409}if(!("name"in e)){e.name=e.error||"unknown"}if(!("status"in e)){e.status=500}if(!("message"in e)){e.message=e.message||e.reason}return e}var ma=Headers;function ba(e){return"$"+e}function wa(e){return e.substring(1)}function ka(){this._store={}}ka.prototype.get=function(e){var t=ba(e);return this._store[t]};ka.prototype.set=function(e,t){var r=ba(e);this._store[r]=t;return true};ka.prototype.has=function(e){var t=ba(e);return t in this._store};ka.prototype.delete=function(e){var t=ba(e);var r=t in this._store;delete this._store[t];return r};ka.prototype.forEach=function(e){var t=Object.keys(this._store);for(var r=0,n=t.length;r<n;r++){var i=t[r];var o=this._store[i];i=wa(i);e(o,i)}};Object.defineProperty(ka.prototype,"size",{get:function(){return Object.keys(this._store).length}});function ja(e){this._store=new ka;if(e&&Array.isArray(e)){for(var t=0,r=e.length;t<r;t++){this.add(e[t])}}}ja.prototype.add=function(e){return this._store.set(e,true)};ja.prototype.has=function(e){return this._store.has(e)};ja.prototype.forEach=function(e){this._store.forEach((function(t,r){e(r)}))};Object.defineProperty(ja.prototype,"size",{get:function(){return this._store.size}});function Oa(){if(typeof Symbol==="undefined"||typeof Map==="undefined"||typeof Set==="undefined"){return false}var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var qa;var Aa;{if(Oa()){qa=Set;Aa=Map}else{qa=ja;Aa=ka}}var $a=function(e){return atob(e)};function Sa(e,t){e=e||[];t=t||{};try{return new Blob(e,t)}catch(Mf){if(Mf.name!=="TypeError"){throw Mf}var r=typeof BlobBuilder!=="undefined"?BlobBuilder:typeof MSBlobBuilder!=="undefined"?MSBlobBuilder:typeof MozBlobBuilder!=="undefined"?MozBlobBuilder:WebKitBlobBuilder;var n=new r;for(var i=0;i<e.length;i+=1){n.append(e[i])}return n.getBlob(t.type)}}function xa(e){var t=e.length;var r=new ArrayBuffer(t);var n=new Uint8Array(r);for(var i=0;i<t;i++){n[i]=e.charCodeAt(i)}return r}function Ea(e,t){return Sa([xa(e)],{type:t})}function Pa(e,t){return Ea($a(e),t)}function Ca(e,t,r){var n="";var i=r-e.length;while(n.length<i){n+=t}return n}function Da(e,t,r){var n=Ca(e,t,r);return n+e}var Ia=-324;var Ba=3;var La="";function Ta(e,t){if(e===t){return 0}e=Ma(e);t=Ma(t);var r=Wa(e);var n=Wa(t);if(r-n!==0){return r-n}switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Ka(e,t)}return Array.isArray(e)?za(e,t):Va(e,t)}function Ma(e){switch(typeof e){case"undefined":return null;case"number":if(e===Infinity||e===-Infinity||isNaN(e)){return null}return e;case"object":var t=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var n=0;n<r;n++){e[n]=Ma(t[n])}}else if(e instanceof Date){return e.toJSON()}else if(e!==null){e={};for(var i in t){if(t.hasOwnProperty(i)){var o=t[i];if(typeof o!=="undefined"){e[i]=Ma(o)}}}}}return e}function Na(e){if(e!==null){switch(typeof e){case"boolean":return e?1:0;case"number":return Ga(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e);var r=t?e:Object.keys(e);var n=-1;var i=r.length;var o="";if(t){while(++n<i){o+=Ra(r[n])}}else{while(++n<i){var a=r[n];o+=Ra(a)+Ra(e[a])}}return o}}return""}function Ra(e){var t="\0";e=Ma(e);return Wa(e)+La+Na(e)+t}function Fa(e,t){var r=t;var n;var i=e[t]==="1";if(i){n=0;t++}else{var o=e[t]==="0";t++;var a="";var u=e.substring(t,t+Ba);var s=parseInt(u,10)+Ia;if(o){s=-s}t+=Ba;while(true){var f=e[t];if(f==="\0"){break}else{a+=f}t++}a=a.split(".");if(a.length===1){n=parseInt(a,10)}else{n=parseFloat(a[0]+"."+a[1])}if(o){n=n-10}if(s!==0){n=parseFloat(n+"e"+s)}}return{num:n,length:t-r}}function Ua(e,t){var r=e.pop();if(t.length){var n=t[t.length-1];if(r===n.element){t.pop();n=t[t.length-1]}var i=n.element;var o=n.index;if(Array.isArray(i)){i.push(r)}else if(o===e.length-2){var a=e.pop();i[a]=r}else{e.push(r)}}}function Ja(e){var t=[];var r=[];var n=0;while(true){var i=e[n++];if(i==="\0"){if(t.length===1){return t.pop()}else{Ua(t,r);continue}}switch(i){case"1":t.push(null);break;case"2":t.push(e[n]==="1");n++;break;case"3":var o=Fa(e,n);t.push(o.num);n+=o.length;break;case"4":var a="";while(true){var u=e[n];if(u==="\0"){break}a+=u;n++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"");t.push(a);break;case"5":var s={element:[],index:t.length};t.push(s.element);r.push(s);break;case"6":var f={element:{},index:t.length};t.push(f.element);r.push(f);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function za(e,t){var r=Math.min(e.length,t.length);for(var n=0;n<r;n++){var i=Ta(e[n],t[n]);if(i!==0){return i}}return e.length===t.length?0:e.length>t.length?1:-1}function Ka(e,t){return e===t?0:e>t?1:-1}function Va(e,t){var r=Object.keys(e),n=Object.keys(t);var i=Math.min(r.length,n.length);for(var o=0;o<i;o++){var a=Ta(r[o],n[o]);if(a!==0){return a}a=Ta(e[r[o]],t[n[o]]);if(a!==0){return a}}return r.length===n.length?0:r.length>n.length?1:-1}function Wa(e){var t=["boolean","number","string","object"];var r=t.indexOf(typeof e);if(~r){if(e===null){return 1}if(Array.isArray(e)){return 5}return r<3?r+2:r+3}if(Array.isArray(e)){return 5}}function Ga(e){if(e===0){return"1"}var t=e.toExponential().split(/e\+?/);var r=parseInt(t[1],10);var n=e<0;var i=n?"0":"2";var o=(n?-r:r)-Ia;var a=Da(o.toString(),"0",Ba);i+=La+a;var u=Math.abs(parseFloat(t[0]));if(n){u=10-u}var s=u.toFixed(20);s=s.replace(/\.?0+$/,"");i+=La+s;return i}function Qa(e){return C.hash(e)}function Za(e){return typeof ArrayBuffer!=="undefined"&&e instanceof ArrayBuffer||typeof Blob!=="undefined"&&e instanceof Blob}function Xa(e){if(typeof e.slice==="function"){return e.slice(0)}var t=new ArrayBuffer(e.byteLength);var r=new Uint8Array(t);var n=new Uint8Array(e);r.set(n);return t}function Ya(e){if(e instanceof ArrayBuffer){return Xa(e)}var t=e.size;var r=e.type;if(typeof e.slice==="function"){return e.slice(0,t,r)}return e.webkitSlice(0,t,r)}var Ha=Function.prototype.toString;var eu=Ha.call(Object);function tu(e){var t=Object.getPrototypeOf(e);if(t===null){return true}var r=t.constructor;return typeof r=="function"&&r instanceof r&&Ha.call(r)==eu}function ru(e){var t;var r;var n;if(!e||typeof e!=="object"){return e}if(Array.isArray(e)){t=[];for(r=0,n=e.length;r<n;r++){t[r]=ru(e[r])}return t}if(e instanceof Date){return e.toISOString()}if(Za(e)){return Ya(e)}if(!tu(e)){return e}t={};for(r in e){if(Object.prototype.hasOwnProperty.call(e,r)){var i=ru(e[r]);if(typeof i!=="undefined"){t[r]=i}}}return t}function nu(e){var t=false;return T((function(r){if(t){throw new Error("once called more than once")}else{t=true;e.apply(this,r)}}))}function iu(e){return T((function(t){t=ru(t);var r=this;var n=typeof t[t.length-1]==="function"?t.pop():false;var i=new Promise((function(n,i){var o;try{var a=nu((function(e,t){if(e){i(e)}else{n(t)}}));t.push(a);o=e.apply(r,t);if(o&&typeof o.then==="function"){n(o)}}catch(Mf){i(Mf)}}));if(n){i.then((function(e){n(null,e)}),n)}return i}))}function ou(e,t){var r={};for(var n=0,i=t.length;n<i;n++){var o=t[n];if(o in e){r[o]=e[o]}}return r}var au;try{localStorage.setItem("_pouch_check_localstorage",1);au=!!localStorage.getItem("_pouch_check_localstorage")}catch(Mf){au=false}function uu(){return au}N(fu,o);function su(e){if(uu()){addEventListener("storage",(function(t){e.emit(t.key)}))}}function fu(){o.call(this);this._listeners={};su(this)}fu.prototype.addListener=function(e,t,r,n){if(this._listeners[t]){return}var i=this;var o=false;function a(){if(!i._listeners[t]){return}if(o){o="waiting";return}o=true;var e=ou(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function u(){o=false}r.changes(e).on("change",(function(e){if(e.seq>n.since&&!n.cancelled){n.since=e.seq;n.onChange(e)}})).on("complete",(function(){if(o==="waiting"){p(a)}o=false})).on("error",u)}this._listeners[t]=a;this.on(e,a)};fu.prototype.removeListener=function(e,t){if(!(t in this._listeners)){return}o.prototype.removeListener.call(this,e,this._listeners[t]);delete this._listeners[t]};fu.prototype.notifyLocalWindows=function(e){if(uu()){localStorage[e]=localStorage[e]==="a"?"b":"a"}};fu.prototype.notify=function(e){this.emit(e);this.notifyLocalWindows(e)};function cu(e){if(typeof console!=="undefined"&&typeof console[e]==="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}var lu;{if(typeof Object.assign==="function"){lu=Object.assign}else{lu=function(e){var t=Object(e);for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!=null){for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i)){t[i]=n[i]}}}}return t}}}var du=lu;function vu(e){var t=[];for(var r=0,n=e.length;r<n;r++){t=t.concat(e[r])}return t}function hu(e){if(typeof e._remote==="boolean"){return e._remote}if(typeof e.type==="function"){cu("warn","db.type() is deprecated and will be removed in "+"a future version of PouchDB");return e.type()==="http"}return false}function pu(e,t,r){return new Promise((function(n,i){e.get(t,(function(o,a){if(o){if(o.status!==404){return i(o)}a={}}var u=a._rev;var s=r(a);if(!s){return n({updated:false,rev:u})}s._id=t;s._rev=u;n(yu(e,s,r))}))}))}function yu(e,t,r){return e.put(t).then((function(e){return{updated:true,rev:e.rev}}),(function(n){if(n.status!==409){throw n}return pu(e,t._id,r)}))}function gu(e){this.status=400;this.name="query_parse_error";this.message=e;this.error=true;try{Error.captureStackTrace(this,gu)}catch(Mf){}}N(gu,Error);function _u(e){this.status=404;this.name="not_found";this.message=e;this.error=true;try{Error.captureStackTrace(this,_u)}catch(Mf){}}N(_u,Error);function mu(e){this.status=500;this.name="invalid_value";this.message=e;this.error=true;try{Error.captureStackTrace(this,mu)}catch(Mf){}}N(mu,Error);function bu(e,t){if(t){e.then((function(e){p((function(){t(null,e)}))}),(function(e){p((function(){t(e)}))}))}return e}function wu(e){return T((function(t){var r=t.pop();var n=e.apply(this,t);if(typeof r==="function"){bu(n,r)}return n}))}function ku(e,t){return e.then((function(e){return t().then((function(){return e}))}),(function(e){return t().then((function(){throw e}))}))}function ju(e,t){return function(){var r=arguments;var n=this;return e.add((function(){return t.apply(n,r)}))}}function Ou(e){var t=new qa(e);var r=new Array(t.size);var n=-1;t.forEach((function(e){r[++n]=e}));return r}function qu(e){var t=new Array(e.size);var r=-1;e.forEach((function(e,n){t[++r]=n}));return t}function Au(){this.promise=new Promise((function(e){e()}))}Au.prototype.add=function(e){this.promise=this.promise.catch((function(){})).then((function(){return e()}));return this.promise};Au.prototype.finish=function(){return this.promise};function $u(e){if(!e){return"undefined"}switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function Su(e,t){return $u(e)+$u(t)+"undefined"}function xu(e,t,r,n,i,o){var a=Su(r,n);var u;if(!i){u=e._cachedViews=e._cachedViews||{};if(u[a]){return u[a]}}var s=e.info().then((function(s){var f=s.db_name+"-mrview-"+(i?"temp":Qa(a));function c(e){e.views=e.views||{};var r=t;if(r.indexOf("/")===-1){r=t+"/"+t}var n=e.views[r]=e.views[r]||{};if(n[f]){return}n[f]=true;return e}return pu(e,"_local/"+o,c).then((function(){return e.registerDependentDatabase(f).then((function(t){var i=t.db;i.auto_compaction=true;var o={name:f,db:i,sourceDB:e,adapter:e.adapter,mapFun:r,reduceFun:n};return o.db.get("_local/lastSeq").catch((function(e){if(e.status!==404){throw e}})).then((function(e){o.seq=e?e.seq:0;if(u){o.db.once("destroyed",(function(){delete u[a]}))}return o}))}))}))}));if(u){u[a]=s}return s}var Eu={};var Pu=new Au;var Cu=50;function Du(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function Iu(e){return e.length===1&&/^1-/.test(e[0].rev)}function Bu(e,t){try{e.emit("error",t)}catch(r){cu("error","The user's map/reduce function threw an uncaught error.\n"+"You can debug this error by doing:\n"+"myDatabase.on('error', function (err) { debugger; });\n"+"Please double-check your map/reduce function.");cu("error",t)}}function Lu(e,t,r,n){function i(e,t,r){try{t(r)}catch(Mf){Bu(e,Mf)}}function o(e,t,r,n,i){try{return{output:t(r,n,i)}}catch(Mf){Bu(e,Mf);return{error:Mf}}}function a(e,t){var r=Ta(e.key,t.key);return r!==0?r:Ta(e.value,t.value)}function u(e,t,r){r=r||0;if(typeof t==="number"){return e.slice(r,t+r)}else if(r>0){return e.slice(r)}return e}function s(e){var t=e.value;var r=t&&typeof t==="object"&&t._id||e.id;return r}function f(e){e.rows.forEach((function(e){var t=e.doc&&e.doc._attachments;if(!t){return}Object.keys(t).forEach((function(e){var r=t[e];t[e].data=Pa(r.data,r.content_type)}))}))}function c(e){return function(t){if(e.include_docs&&e.attachments&&e.binary){f(t)}return t}}function l(e,t,r,n){var i=t[e];if(typeof i!=="undefined"){if(n){i=encodeURIComponent(JSON.stringify(i))}r.push(e+"="+i)}}function d(e){if(typeof e!=="undefined"){var t=Number(e);if(!isNaN(t)&&t===parseInt(e,10)){return t}else{return e}}}function v(e){e.group_level=d(e.group_level);e.limit=d(e.limit);e.skip=d(e.skip);return e}function h(e){if(e){if(typeof e!=="number"){return new gu('Invalid value for integer: "'+e+'"')}if(e<0){return new gu("Invalid value for positive integer: "+'"'+e+'"')}}}function y(e,t){var r=e.descending?"endkey":"startkey";var n=e.descending?"startkey":"endkey";if(typeof e[r]!=="undefined"&&typeof e[n]!=="undefined"&&Ta(e[r],e[n])>0){throw new gu("No rows can match your key range, "+"reverse your start_key and end_key or set {descending : true}")}else if(t.reduce&&e.reduce!==false){if(e.include_docs){throw new gu("{include_docs:true} is invalid for reduce")}else if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level){throw new gu("Multi-key fetches for reduce views must use "+"{group: true}")}}["group_level","limit","skip"].forEach((function(t){var r=h(e[t]);if(r){throw r}}))}function g(e,t,r){var n=[];var i;var o="GET";var a,u;l("reduce",r,n);l("include_docs",r,n);l("attachments",r,n);l("limit",r,n);l("descending",r,n);l("group",r,n);l("group_level",r,n);l("skip",r,n);l("stale",r,n);l("conflicts",r,n);l("startkey",r,n,true);l("start_key",r,n,true);l("endkey",r,n,true);l("end_key",r,n,true);l("inclusive_end",r,n);l("key",r,n,true);l("update_seq",r,n);n=n.join("&");n=n===""?"":"?"+n;if(typeof r.keys!=="undefined"){var s=2e3;var f="keys="+encodeURIComponent(JSON.stringify(r.keys));if(f.length+n.length+1<=s){n+=(n[0]==="?"?"&":"?")+f}else{o="POST";if(typeof t==="string"){i={keys:r.keys}}else{t.keys=r.keys}}}if(typeof t==="string"){var d=Du(t);return e.fetch("_design/"+d[0]+"/_view/"+d[1]+n,{headers:new ma({"Content-Type":"application/json"}),method:o,body:JSON.stringify(i)}).then((function(e){a=e.ok;u=e.status;return e.json()})).then((function(e){if(!a){e.status=u;throw _a(e)}e.rows.forEach((function(e){if(e.value&&e.value.error&&e.value.error==="builtin_reduce_error"){throw new Error(e.reason)}}));return e})).then(c(r))}i=i||{};Object.keys(t).forEach((function(e){if(Array.isArray(t[e])){i[e]=t[e]}else{i[e]=t[e].toString()}}));return e.fetch("_temp_view"+n,{headers:new ma({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(i)}).then((function(e){a=e.ok;u=e.status;return e.json()})).then((function(e){if(!a){e.status=u;throw _a(e)}return e})).then(c(r))}function _(e,t,r){return new Promise((function(n,i){e._query(t,r,(function(e,t){if(e){return i(e)}n(t)}))}))}function m(e){return new Promise((function(t,r){e._viewCleanup((function(e,n){if(e){return r(e)}t(n)}))}))}function b(e){return function(t){if(t.status===404){return e}else{throw t}}}function w(e,t,r){var n="_local/doc_"+e;var i={_id:n,keys:[]};var o=r.get(e);var a=o[0];var u=o[1];function s(){if(Iu(u)){return Promise.resolve(i)}return t.db.get(n).catch(b(i))}function f(e){if(!e.keys.length){return Promise.resolve({rows:[]})}return t.db.allDocs({keys:e.keys,include_docs:true})}function c(e,t){var r=[];var n=new qa;for(var i=0,o=t.rows.length;i<o;i++){var u=t.rows[i];var s=u.doc;if(!s){continue}r.push(s);n.add(s._id);s._deleted=!a.has(s._id);if(!s._deleted){var f=a.get(s._id);if("value"in f){s.value=f.value}}}var c=qu(a);c.forEach((function(e){if(!n.has(e)){var t={_id:e};var i=a.get(e);if("value"in i){t.value=i.value}r.push(t)}}));e.keys=Ou(c.concat(e.keys));r.push(e);return r}return s().then((function(e){return f(e).then((function(t){return c(e,t)}))}))}function k(e,t,r){var n="_local/lastSeq";return e.db.get(n).catch(b({_id:n,seq:0})).then((function(n){var i=qu(t);return Promise.all(i.map((function(r){return w(r,e,t)}))).then((function(t){var i=vu(t);n.seq=r;i.push(n);return e.db.bulkDocs({docs:i})}))}))}function j(e){var t=typeof e==="string"?e:e.name;var r=Eu[t];if(!r){r=Eu[t]=new Au}return r}function O(e){return ju(j(e),(function(){return q(e)}))()}function q(e){var r;var n;function o(e,t){var i={id:n._id,key:Ma(e)};if(typeof t!=="undefined"&&t!==null){i.value=Ma(t)}r.push(i)}var u=t(e.mapFun,o);var s=e.seq||0;function f(t,r){return function(){return k(e,t,r)}}var c=new Au;function l(){return e.sourceDB.changes({return_docs:true,conflicts:true,include_docs:true,style:"all_docs",since:s,limit:Cu}).then(d)}function d(e){var t=e.results;if(!t.length){return}var r=v(t);c.add(f(r,s));if(t.length<Cu){return}return l()}function v(t){var o=new Aa;for(var f=0,c=t.length;f<c;f++){var l=t[f];if(l.doc._id[0]!=="_"){r=[];n=l.doc;if(!n._deleted){i(e.sourceDB,u,n)}r.sort(a);var d=h(r);o.set(l.doc._id,[d,l.changes])}s=l.seq}return o}function h(e){var t=new Aa;var r;for(var n=0,i=e.length;n<i;n++){var o=e[n];var a=[o.key,o.id];if(n>0&&Ta(o.key,r)===0){a.push(n)}t.set(Ra(a),o);r=o.key}return t}return l().then((function(){return c.finish()})).then((function(){e.seq=s}))}function A(e,t,n){if(n.group_level===0){delete n.group_level}var i=n.group||n.group_level;var a=r(e.reduceFun);var s=[];var f=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach((function(e){var t=s[s.length-1];var r=i?e.key:null;if(i&&Array.isArray(r)){r=r.slice(0,f)}if(t&&Ta(t.groupKey,r)===0){t.keys.push([e.key,e.id]);t.values.push(e.value);return}s.push({keys:[[e.key,e.id]],values:[e.value],groupKey:r})}));t=[];for(var c=0,l=s.length;c<l;c++){var d=s[c];var v=o(e.sourceDB,a,d.keys,d.values,false);if(v.error&&v.error instanceof mu){throw v.error}t.push({value:v.error?null:v.output,key:d.groupKey})}return{rows:u(t,n.limit,n.skip)}}function $(e,t){return ju(j(e),(function(){return S(e,t)}))()}function S(e,t){var r;var n=e.reduceFun&&t.reduce!==false;var i=t.skip||0;if(typeof t.keys!=="undefined"&&!t.keys.length){t.limit=0;delete t.keys}function o(t){t.include_docs=true;return e.db.allDocs(t).then((function(e){r=e.total_rows;return e.rows.map((function(e){if("value"in e.doc&&typeof e.doc.value==="object"&&e.doc.value!==null){var t=Object.keys(e.doc.value).sort();var r=["id","key","value"];if(!(t<r||t>r)){return e.doc.value}}var n=Ja(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}}))}))}function a(o){var a;if(n){a=A(e,o,t)}else{a={total_rows:r,offset:i,rows:o}}if(t.update_seq){a.update_seq=e.seq}if(t.include_docs){var u=Ou(o.map(s));return e.sourceDB.allDocs({keys:u,include_docs:true,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then((function(e){var t=new Aa;e.rows.forEach((function(e){t.set(e.id,e.doc)}));o.forEach((function(e){var r=s(e);var n=t.get(r);if(n){e.doc=n}}));return a}))}else{return a}}if(typeof t.keys!=="undefined"){var u=t.keys;var f=u.map((function(e){var r={startkey:Ra([e]),endkey:Ra([e,{}])};if(t.update_seq){r.update_seq=true}return o(r)}));return Promise.all(f).then(vu).then(a)}else{var c={descending:t.descending};if(t.update_seq){c.update_seq=true}var l;var d;if("start_key"in t){l=t.start_key}if("startkey"in t){l=t.startkey}if("end_key"in t){d=t.end_key}if("endkey"in t){d=t.endkey}if(typeof l!=="undefined"){c.startkey=t.descending?Ra([l,{}]):Ra([l])}if(typeof d!=="undefined"){var v=t.inclusive_end!==false;if(t.descending){v=!v}c.endkey=Ra(v?[d,{}]:[d])}if(typeof t.key!=="undefined"){var h=Ra([t.key]);var p=Ra([t.key,{}]);if(c.descending){c.endkey=h;c.startkey=p}else{c.startkey=h;c.endkey=p}}if(!n){if(typeof t.limit==="number"){c.limit=t.limit}c.skip=i}return o(c).then(a)}}function x(e){return e.fetch("_view_cleanup",{headers:new ma({"Content-Type":"application/json"}),method:"POST"}).then((function(e){return e.json()}))}function E(t){return t.get("_local/"+e).then((function(e){var r=new Aa;Object.keys(e.views).forEach((function(e){var t=Du(e);var n="_design/"+t[0];var i=t[1];var o=r.get(n);if(!o){o=new qa;r.set(n,o)}o.add(i)}));var n={keys:qu(r),include_docs:true};return t.allDocs(n).then((function(n){var i={};n.rows.forEach((function(t){var n=t.key.substring(8);r.get(t.key).forEach((function(r){var o=n+"/"+r;if(!e.views[o]){o=r}var a=Object.keys(e.views[o]);var u=t.doc&&t.doc.views&&t.doc.views[r];a.forEach((function(e){i[e]=i[e]||u}))}))}));var o=Object.keys(i).filter((function(e){return!i[e]}));var a=o.map((function(e){return ju(j(e),(function(){return new t.constructor(e,t.__opts).destroy()}))()}));return Promise.all(a).then((function(){return{ok:true}}))}))}),b({ok:true}))}function P(t,r,i){if(typeof t._query==="function"){return _(t,r,i)}if(hu(t)){return g(t,r,i)}if(typeof r!=="string"){y(i,r);Pu.add((function(){var n=xu(t,"temp_view/temp_view",r.map,r.reduce,true,e);return n.then((function(e){return ku(O(e).then((function(){return $(e,i)})),(function(){return e.db.destroy()}))}))}));return Pu.finish()}else{var o=r;var a=Du(o);var u=a[0];var s=a[1];return t.get("_design/"+u).then((function(r){var a=r.views&&r.views[s];if(!a){throw new _u("ddoc "+r._id+" has no view named "+s)}n(r,s);y(i,a);var u=xu(t,o,a.map,a.reduce,false,e);return u.then((function(e){if(i.stale==="ok"||i.stale==="update_after"){if(i.stale==="update_after"){p((function(){O(e)}))}return $(e,i)}else{return O(e).then((function(){return $(e,i)}))}}))}))}}function C(e,t,r){var n=this;if(typeof t==="function"){r=t;t={}}t=t?v(t):{};if(typeof e==="function"){e={map:e}}var i=Promise.resolve().then((function(){return P(n,e,t)}));bu(i,r);return i}var D=wu((function(){var e=this;if(typeof e._viewCleanup==="function"){return m(e)}if(hu(e)){return x(e)}return E(e)}));return{query:C,viewCleanup:D}}function Tu(e,t){var r=e;for(var n=0,i=t.length;n<i;n++){var o=t[n];r=r[o];if(!r){break}}return r}function Mu(e,t,r){for(var n=0,i=t.length;n<i-1;n++){var o=t[n];e=e[o]=e[o]||{}}e[t[i-1]]=r}function Nu(e,t){return e<t?-1:e>t?1:0}function Ru(e){var t=[];var r="";for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o==="."){if(n>0&&e[n-1]==="\\"){r=r.substring(0,r.length-1)+"."}else{t.push(r);r=""}}else{r+=o}}t.push(r);return t}var Fu=["$or","$nor","$not"];function Uu(e){return Fu.indexOf(e)>-1}function Ju(e){return Object.keys(e)[0]}function zu(e){return e[Ju(e)]}function Ku(e){var t={};e.forEach((function(e){Object.keys(e).forEach((function(r){var n=e[r];if(typeof n!=="object"){n={$eq:n}}if(Uu(r)){if(n instanceof Array){t[r]=n.map((function(e){return Ku([e])}))}else{t[r]=Ku([n])}}else{var i=t[r]=t[r]||{};Object.keys(n).forEach((function(e){var t=n[e];if(e==="$gt"||e==="$gte"){return Vu(e,t,i)}else if(e==="$lt"||e==="$lte"){return Wu(e,t,i)}else if(e==="$ne"){return Gu(t,i)}else if(e==="$eq"){return Qu(t,i)}i[e]=t}))}}))}));return t}function Vu(e,t,r){if(typeof r.$eq!=="undefined"){return}if(typeof r.$gte!=="undefined"){if(e==="$gte"){if(t>r.$gte){r.$gte=t}}else{if(t>=r.$gte){delete r.$gte;r.$gt=t}}}else if(typeof r.$gt!=="undefined"){if(e==="$gte"){if(t>r.$gt){delete r.$gt;r.$gte=t}}else{if(t>r.$gt){r.$gt=t}}}else{r[e]=t}}function Wu(e,t,r){if(typeof r.$eq!=="undefined"){return}if(typeof r.$lte!=="undefined"){if(e==="$lte"){if(t<r.$lte){r.$lte=t}}else{if(t<=r.$lte){delete r.$lte;r.$lt=t}}}else if(typeof r.$lt!=="undefined"){if(e==="$lte"){if(t<r.$lt){delete r.$lt;r.$lte=t}}else{if(t<r.$lt){r.$lt=t}}}else{r[e]=t}}function Gu(e,t){if("$ne"in t){t.$ne.push(e)}else{t.$ne=[e]}}function Qu(e,t){delete t.$gt;delete t.$gte;delete t.$lt;delete t.$lte;delete t.$ne;t.$eq=e}function Zu(e){for(var t in e){if(Array.isArray(e)){for(var r in e){if(e[r]["$and"]){e[r]=Ku(e[r]["$and"])}}}var n=e[t];if(typeof n==="object"){Zu(n)}}return e}function Xu(e,t){for(var r in e){if(r==="$and"){t=true}var n=e[r];if(typeof n==="object"){t=Xu(n,t)}}return t}function Yu(e){var t=ru(e);var r=false;if(Xu(t,false)){t=Zu(t);if("$and"in t){t=Ku(t["$and"])}r=true}["$or","$nor"].forEach((function(e){if(e in t){t[e].forEach((function(e){var t=Object.keys(e);for(var r=0;r<t.length;r++){var n=t[r];var i=e[n];if(typeof i!=="object"||i===null){e[n]={$eq:i}}}}))}}));if("$not"in t){t["$not"]=Ku([t["$not"]])}var n=Object.keys(t);for(var i=0;i<n.length;i++){var o=n[i];var a=t[o];if(typeof a!=="object"||a===null){a={$eq:a}}else if("$ne"in a&&!r){a.$ne=[a.$ne]}t[o]=a}return t}function Hu(e){function t(t){return e.map((function(e){var r=Ju(e);var n=Ru(r);var i=Tu(t,n);return i}))}return function(e,r){var n=t(e.doc);var i=t(r.doc);var o=Ta(n,i);if(o!==0){return o}return Nu(e.doc._id,r.doc._id)}}function es(e,t,r){e=e.filter((function(e){return ts(e.doc,t.selector,r)}));if(t.sort){var n=Hu(t.sort);e=e.sort(n);if(typeof t.sort[0]!=="string"&&zu(t.sort[0])==="desc"){e=e.reverse()}}if("limit"in t||"skip"in t){var i=t.skip||0;var o=("limit"in t?t.limit:e.length)+i;e=e.slice(i,o)}return e}function ts(e,t,r){return r.every((function(r){var n=t[r];var i=Ru(r);var o=Tu(e,i);if(Uu(r)){return ns(r,n,e)}return rs(n,e,i,o)}))}function rs(e,t,r,n){if(!e){return true}if(typeof e==="object"){return Object.keys(e).every((function(i){var o=e[i];return is(i,t,o,r,n)}))}return e===n}function ns(e,t,r){if(e==="$or"){return t.some((function(e){return ts(r,e,Object.keys(e))}))}if(e==="$not"){return!ts(r,t,Object.keys(t))}return!t.find((function(e){return ts(r,e,Object.keys(e))}))}function is(e,t,r,n,i){if(!vs[e]){throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, '+"$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all")}return vs[e](t,r,n,i)}function os(e){return typeof e!=="undefined"&&e!==null}function as(e){return typeof e!=="undefined"}function us(e,t){var r=t[0];var n=t[1];if(r===0){throw new Error("Bad divisor, cannot divide by zero")}if(parseInt(r,10)!==r){throw new Error("Divisor is not an integer")}if(parseInt(n,10)!==n){throw new Error("Modulus is not an integer")}if(parseInt(e,10)!==e){return false}return e%r===n}function ss(e,t){return t.some((function(t){if(e instanceof Array){return e.indexOf(t)>-1}return e===t}))}function fs(e,t){return t.every((function(t){return e.indexOf(t)>-1}))}function cs(e,t){return e.length===t}function ls(e,t){var r=new RegExp(t);return r.test(e)}function ds(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e==="boolean";case"number":return typeof e==="number";case"string":return typeof e==="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}throw new Error(t+" not supported as a type."+"Please use one of object, string, array, number, boolean or null.")}var vs={$elemMatch:function(e,t,r,n){if(!Array.isArray(n)){return false}if(n.length===0){return false}if(typeof n[0]==="object"){return n.some((function(e){return ts(e,t,Object.keys(t))}))}return n.some((function(n){return rs(t,e,r,n)}))},$allMatch:function(e,t,r,n){if(!Array.isArray(n)){return false}if(n.length===0){return false}if(typeof n[0]==="object"){return n.every((function(e){return ts(e,t,Object.keys(t))}))}return n.every((function(n){return rs(t,e,r,n)}))},$eq:function(e,t,r,n){return as(n)&&Ta(n,t)===0},$gte:function(e,t,r,n){return as(n)&&Ta(n,t)>=0},$gt:function(e,t,r,n){return as(n)&&Ta(n,t)>0},$lte:function(e,t,r,n){return as(n)&&Ta(n,t)<=0},$lt:function(e,t,r,n){return as(n)&&Ta(n,t)<0},$exists:function(e,t,r,n){if(t){return as(n)}return!as(n)},$mod:function(e,t,r,n){return os(n)&&us(n,t)},$ne:function(e,t,r,n){return t.every((function(e){return Ta(n,e)!==0}))},$in:function(e,t,r,n){return os(n)&&ss(n,t)},$nin:function(e,t,r,n){return os(n)&&!ss(n,t)},$size:function(e,t,r,n){return os(n)&&cs(n,t)},$all:function(e,t,r,n){return Array.isArray(n)&&fs(n,t)},$regex:function(e,t,r,n){return os(n)&&ls(n,t)},$type:function(e,t,r,n){return ds(n,t)}};function hs(e){e=ru(e);if(!e.index){e.index={}}["type","name","ddoc"].forEach((function(t){if(e.index[t]){e[t]=e.index[t];delete e.index[t]}}));if(e.fields){e.index.fields=e.fields;delete e.fields}if(!e.type){e.type="json"}return e}function ps(e,t,r,n){var i,o;r.headers=new ma({"Content-type":"application/json"});e.fetch(t,r).then((function(e){i=e.status;o=e.ok;return e.json()})).then((function(e){if(!o){e.status=i;var t=_a(e);n(t)}else{n(null,e)}})).catch(n)}function ys(e,t,r){t=hs(t);ps(e,"_index",{method:"POST",body:JSON.stringify(t)},r)}function gs(e,t,r){ps(e,"_find",{method:"POST",body:JSON.stringify(t)},r)}function _s(e,t,r){ps(e,"_explain",{method:"POST",body:JSON.stringify(t)},r)}function ms(e,t){ps(e,"_index",{method:"GET"},t)}function bs(e,t,r){var n=t.ddoc;var i=t.type||"json";var o=t.name;if(!n){return r(new Error("you must provide an index's ddoc"))}if(!o){return r(new Error("you must provide an index's name"))}var a="_index/"+[n,i,o].map(encodeURIComponent).join("/");ps(e,a,{method:"DELETE"},r)}function ws(e){return function(){var t=arguments.length;var r=new Array(t);var n=-1;while(++n<t){r[n]=arguments[n]}return e.call(this,r)}}function ks(e){return ws((function(t){var r=t.pop();var n=e.apply(this,t);js(n,r);return n}))}function js(e,t){e.then((function(e){p((function(){t(null,e)}))}),(function(e){p((function(){t(e)}))}));return e}var Os=ws((function(e){var t=[];for(var r=0,n=e.length;r<n;r++){var i=e[r];if(Array.isArray(i)){t=t.concat(Os.apply(null,i))}else{t.push(i)}}return t}));function qs(e){var t={};for(var r=0,n=e.length;r<n;r++){t=du(t,e[r])}return t}function As(e,t){var r={};for(var n=0,i=t.length;n<i;n++){var o=Ru(t[n]);var a=Tu(e,o);if(typeof a!=="undefined"){Mu(r,o,a)}}return r}function $s(e,t){for(var r=0,n=Math.min(e.length,t.length);r<n;r++){if(e[r]!==t[r]){return false}}return true}function Ss(e,t){if(e.length>t.length){return false}return $s(e,t)}function xs(e,t){e=e.slice();for(var r=0,n=t.length;r<n;r++){var i=t[r];if(!e.length){break}var o=e.indexOf(i);if(o===-1){return false}else{e.splice(o,1)}}return true}function Es(e){var t={};for(var r=0,n=e.length;r<n;r++){t[e[r]]=true}return t}function Ps(e,t){var r=null;var n=-1;for(var i=0,o=e.length;i<o;i++){var a=e[i];var u=t(a);if(u>n){n=u;r=a}}return r}function Cs(e,t){if(e.length!==t.length){return false}for(var r=0,n=e.length;r<n;r++){if(e[r]!==t[r]){return false}}return true}function Ds(e){var t={};for(var r=0;r<e.length;r++){t["$"+e[r]]=true}return Object.keys(t).map((function(e){return e.substring(1)}))}function Is(e,t){return function(r){var n=[];for(var i=0,o=e.length;i<o;i++){var a=Ru(e[i]);var u=r;for(var s=0,f=a.length;s<f;s++){var c=a[s];u=u[c];if(typeof u==="undefined"){return}}n.push(u)}t(n)}}function Bs(e,t){var r=Ru(e);return function(e){var n=e;for(var i=0,o=r.length;i<o;i++){var a=r[i];n=n[a];if(typeof n==="undefined"){return}}t(n)}}function Ls(e,t){return function(r){t(r[e])}}function Ts(e,t){return function(r){var n=[];for(var i=0,o=e.length;i<o;i++){n.push(r[e[i]])}t(n)}}function Ms(e){for(var t=0,r=e.length;t<r;t++){var n=e[t];if(n.indexOf(".")!==-1){return false}}return true}function Ns(e,t){var r=Ms(e);var n=e.length===1;if(r){if(n){return Ls(e[0],t)}else{return Ts(e,t)}}else{if(n){return Bs(e[0],t)}else{return Is(e,t)}}}function Rs(e,t){var r=Object.keys(e.fields);return Ns(r,t)}function Fs(){throw new Error("reduce not supported")}function Us(e,t){var r=e.views[t];if(!r.map||!r.map.fields){throw new Error("ddoc "+e._id+" with view "+t+" doesn't have map.fields defined. "+"maybe it wasn't created by this plugin?")}}var Js=Lu("indexes",Rs,Fs,Us);function zs(e){return e._customFindAbstractMapper||Js}function Ks(e){if(!Array.isArray(e)){throw new Error("invalid sort json - should be an array")}return e.map((function(e){if(typeof e==="string"){var t={};t[e]="asc";return t}else{return e}}))}function Vs(e){var t=[];if(typeof e==="string"){t.push(e)}else{t=e}return t.map((function(e){return e.replace("_design/","")}))}function Ws(e){e.fields=e.fields.map((function(e){if(typeof e==="string"){var t={};t[e]="asc";return t}return e}));return e}function Gs(e,t){var r=[];for(var n=0;n<t.def.fields.length;n++){var i=Ju(t.def.fields[n]);r.push(e[i])}return r}function Qs(e,t,r){var n=r.def.fields;for(var i=0,o=e.length;i<o;i++){var a=e[i];var u=Gs(a.doc,r);if(n.length===1){u=u[0]}else{while(u.length>t.length){u.pop()}}if(Math.abs(Ta(u,t))>0){break}}return i>0?e.slice(i):e}function Zs(e){var t=ru(e);delete t.startkey;delete t.endkey;delete t.inclusive_start;delete t.inclusive_end;if("endkey"in e){t.startkey=e.endkey}if("startkey"in e){t.endkey=e.startkey}if("inclusive_start"in e){t.inclusive_end=e.inclusive_start}if("inclusive_end"in e){t.inclusive_start=e.inclusive_end}return t}function Xs(e){var t=e.fields.filter((function(e){return zu(e)==="asc"}));if(t.length!==0&&t.length!==e.fields.length){throw new Error("unsupported mixed sorting")}}function Ys(e,t){if(t.defaultUsed&&e.sort){var r=e.sort.filter((function(e){return Object.keys(e)[0]!=="_id"})).map((function(e){return Object.keys(e)[0]}));if(r.length>0){throw new Error('Cannot sort on field(s) "'+r.join(",")+'" when using the default index')}}if(t.defaultUsed){return}}function Hs(e){if(typeof e.selector!=="object"){throw new Error("you must provide a selector when you find()")}}function ef(e,t){var r=Object.keys(e);var n=t?t.map(Ju):[];var i;if(r.length>=n.length){i=r}else{i=n}if(n.length===0){return{fields:i}}i=i.sort((function(e,t){var r=n.indexOf(e);if(r===-1){r=Number.MAX_VALUE}var i=n.indexOf(t);if(i===-1){i=Number.MAX_VALUE}return r<i?-1:r>i?1:0}));return{fields:i,sortOrder:t.map(Ju)}}function tf(e,t){t=hs(t);var r=ru(t.index);t.index=Ws(t.index);Xs(t.index);var n;function i(){return n||(n=Qa(JSON.stringify(t)))}var o=t.name||"idx-"+i();var a=t.ddoc||"idx-"+i();var u="_design/"+a;var s=false;var f=false;function c(e){if(e._rev&&e.language!=="query"){s=true}e.language="query";e.views=e.views||{};f=!!e.views[o];if(f){return false}e.views[o]={map:{fields:qs(t.index.fields)},reduce:"_count",options:{def:r}};return e}e.constructor.emit("debug",["find","creating index",u]);return pu(e,u,c).then((function(){if(s){throw new Error('invalid language for ddoc with id "'+u+'" (should be "query")')}})).then((function(){var t=a+"/"+o;return zs(e).query.call(e,t,{limit:0,reduce:false}).then((function(){return{id:u,name:o,result:f?"exists":"created"}}))}))}function rf(e){return e.allDocs({startkey:"_design/",endkey:"_design/￿",include_docs:true}).then((function(e){var t={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};t.indexes=Os(t.indexes,e.rows.filter((function(e){return e.doc.language==="query"})).map((function(e){var t=e.doc.views!==undefined?Object.keys(e.doc.views):[];return t.map((function(t){var r=e.doc.views[t];return{ddoc:e.id,name:t,type:"json",def:Ws(r.options.def)}}))})));t.indexes.sort((function(e,t){return Nu(e.name,t.name)}));t.total_rows=t.indexes.length;return t}))}var nf=null;var of={"￿":{}};function af(e,t){var r=e.def.fields.map(Ju);for(var n=0,i=r.length;n<i;n++){var o=r[n];if(t===o){return true}}return false}function uf(e,t){var r=e[t];var n=Ju(r);return n!=="$eq"}function sf(e,t){var r=t.def.fields.map(Ju);return e.slice().sort((function(e,t){var n=r.indexOf(e);var i=r.indexOf(t);if(n===-1){n=Number.MAX_VALUE}if(i===-1){i=Number.MAX_VALUE}return Nu(n,i)}))}function ff(e,t,r){r=sf(r,e);var n=false;for(var i=0,o=r.length;i<o;i++){var a=r[i];if(n||!af(e,a)){return r.slice(i)}if(i<o-1&&uf(t,a)){n=true}}return[]}function cf(e){var t=[];Object.keys(e).forEach((function(r){var n=e[r];Object.keys(n).forEach((function(e){if(e==="$ne"){t.push(r)}}))}));return t}function lf(e,t,r,n){var i=Os(e,ff(t,r,n),cf(r));return sf(Ds(i),t)}function df(e,t,r){if(t){var n=Ss(t,e);var i=$s(r,e);return n&&i}return xs(r,e)}var vf=["$eq","$gt","$gte","$lt","$lte"];function hf(e){return vf.indexOf(e)===-1}function pf(e,t){var r=e[0];var n=t[r];if(typeof n==="undefined"){return true}var i=Object.keys(n).length===1&&Ju(n)==="$ne";return!i}function yf(e,t,r,n){var i=e.def.fields.map(Ju);var o=df(i,t,r);if(!o){return false}return pf(i,n)}function gf(e,t,r,n){return n.reduce((function(n,i){var o=yf(i,r,t,e);if(o){n.push(i)}return n}),[])}function _f(e,t,r,n,i){var o=gf(e,t,r,n);if(o.length===0){if(i){throw{error:"no_usable_index",message:"There is no index available for this selector."}}var a=n[0];a.defaultUsed=true;return a}if(o.length===1&&!i){return o[0]}var u=Es(t);function s(e){var t=e.def.fields.map(Ju);var r=0;for(var n=0,i=t.length;n<i;n++){var o=t[n];if(u[o]){r++}}return r}if(i){var f="_design/"+i[0];var c=i.length===2?i[1]:false;var l=o.find((function(e){if(c&&e.ddoc===f&&c===e.name){return true}if(e.ddoc===f){return true}return false}));if(!l){throw{error:"unknown_error",message:"Could not find that index or could not use that index for the query"}}return l}return Ps(o,s)}function mf(e,t){switch(e){case"$eq":return{key:t};case"$lte":return{endkey:t};case"$gte":return{startkey:t};case"$lt":return{endkey:t,inclusive_end:false};case"$gt":return{startkey:t,inclusive_start:false}}return{startkey:nf}}function bf(e,t){var r=Ju(t.def.fields[0]);var n=e[r]||{};var i=[];var o=Object.keys(n);var a;o.forEach((function(e){if(hf(e)){i.push(r)}var t=n[e];var o=mf(e,t);if(a){a=qs([a,o])}else{a=o}}));return{queryOpts:a,inMemoryFields:i}}function wf(e,t){switch(e){case"$eq":return{startkey:t,endkey:t};case"$lte":return{endkey:t};case"$gte":return{startkey:t};case"$lt":return{endkey:t,inclusive_end:false};case"$gt":return{startkey:t,inclusive_start:false}}}function kf(e,t){var r=t.def.fields.map(Ju);var n=[];var i=[];var o=[];var a;var u;function s(e){if(a!==false){i.push(nf)}if(u!==false){o.push(of)}n=r.slice(e)}for(var f=0,c=r.length;f<c;f++){var l=r[f];var d=e[l];if(!d||!Object.keys(d).length){s(f);break}else if(f>0){if(Object.keys(d).some(hf)){s(f);break}var v="$gt"in d||"$gte"in d||"$lt"in d||"$lte"in d;var h=Object.keys(e[r[f-1]]);var p=Cs(h,["$eq"]);var y=Cs(h,Object.keys(d));var g=v&&!p&&!y;if(g){s(f);break}}var _=Object.keys(d);var m=null;for(var b=0;b<_.length;b++){var w=_[b];var k=d[w];var j=wf(w,k);if(m){m=qs([m,j])}else{m=j}}i.push("startkey"in m?m.startkey:nf);o.push("endkey"in m?m.endkey:of);if("inclusive_start"in m){a=m.inclusive_start}if("inclusive_end"in m){u=m.inclusive_end}}var O={startkey:i,endkey:o};if(typeof a!=="undefined"){O.inclusive_start=a}if(typeof u!=="undefined"){O.inclusive_end=u}return{queryOpts:O,inMemoryFields:n}}function jf(e){return{queryOpts:{startkey:null},inMemoryFields:[Object.keys(e)]}}function Of(e,t){if(t.defaultUsed){return jf(e)}if(t.def.fields.length===1){return bf(e,t)}return kf(e,t)}function qf(e,t){var r=e.selector;var n=e.sort;var i=ef(r,n);var o=i.fields;var a=i.sortOrder;var u=_f(r,o,a,t,e.use_index);var s=Of(r,u);var f=s.queryOpts;var c=s.inMemoryFields;var l=lf(c,u,r,o);var d={queryOpts:f,index:u,inMemoryFields:l};return d}function Af(e){return e.ddoc.substring(8)+"/"+e.name}function $f(e,t){var r=ru(t);if(r.descending){if("endkey"in r&&typeof r.endkey!=="string"){r.endkey=""}if("startkey"in r&&typeof r.startkey!=="string"){r.limit=0}}else{if("startkey"in r&&typeof r.startkey!=="string"){r.startkey=""}if("endkey"in r&&typeof r.endkey!=="string"){r.limit=0}}if("key"in r&&typeof r.key!=="string"){r.limit=0}return e.allDocs(r).then((function(e){e.rows=e.rows.filter((function(e){return!/^_design\//.test(e.id)}));return e}))}function Sf(e,t,r){if(t.selector){t.selector=Yu(t.selector)}if(t.sort){t.sort=Ks(t.sort)}if(t.use_index){t.use_index=Vs(t.use_index)}Hs(t);return rf(e).then((function(n){e.constructor.emit("debug",["find","planning query",t]);var i=qf(t,n.indexes);e.constructor.emit("debug",["find","query plan",i]);var o=i.index;Ys(t,o);var a=du({include_docs:true,reduce:false},i.queryOpts);if("startkey"in a&&"endkey"in a&&Ta(a.startkey,a.endkey)>0){return{docs:[]}}var u=t.sort&&typeof t.sort[0]!=="string"&&zu(t.sort[0])==="desc";if(u){a.descending=true;a=Zs(a)}if(!i.inMemoryFields.length){if("limit"in t){a.limit=t.limit}if("skip"in t){a.skip=t.skip}}if(r){return Promise.resolve(i,a)}return Promise.resolve().then((function(){if(o.name==="_all_docs"){return $f(e,a)}else{var t=Af(o);return zs(e).query.call(e,t,a)}})).then((function(e){if(a.inclusive_start===false){e.rows=Qs(e.rows,a.startkey,o)}if(i.inMemoryFields.length){e.rows=es(e.rows,t,i.inMemoryFields)}var r={docs:e.rows.map((function(e){var r=e.doc;if(t.fields){return As(r,t.fields)}return r}))};if(o.defaultUsed){r.warning="no matching index found, create an index to optimize query time"}return r}))}))}function xf(e,t){return Sf(e,t,true).then((function(r){return{dbname:e.name,index:r.index,selector:t.selector,range:{start_key:r.queryOpts.startkey,end_key:r.queryOpts.endkey},opts:{use_index:t.use_index||[],bookmark:"nil",limit:t.limit,skip:t.skip,sort:t.sort||{},fields:t.fields,conflicts:false,r:[49]},limit:t.limit,skip:t.skip||0,fields:t.fields}}))}function Ef(e,t){if(!t.ddoc){throw new Error("you must supply an index.ddoc when deleting")}if(!t.name){throw new Error("you must supply an index.name when deleting")}var r=t.ddoc;var n=t.name;function i(e){if(Object.keys(e.views).length===1&&e.views[n]){return{_id:r,_deleted:true}}delete e.views[n];return e}return pu(e,r,i).then((function(){return zs(e).viewCleanup.apply(e)})).then((function(){return{ok:true}}))}var Pf=ks(tf);var Cf=ks(Sf);var Df=ks(xf);var If=ks(rf);var Bf=ks(Ef);var Lf={};Lf.createIndex=iu((function(e,t){if(typeof e!=="object"){return t(new Error("you must provide an index to create"))}var r=hu(this)?ys:Pf;r(this,e,t)}));Lf.find=iu((function(e,t){if(typeof t==="undefined"){t=e;e=undefined}if(typeof e!=="object"){return t(new Error("you must provide search parameters to find()"))}var r=hu(this)?gs:Cf;r(this,e,t)}));Lf.explain=iu((function(e,t){if(typeof t==="undefined"){t=e;e=undefined}if(typeof e!=="object"){return t(new Error("you must provide search parameters to explain()"))}var r=hu(this)?_s:Df;r(this,e,t)}));Lf.getIndexes=iu((function(e){var t=hu(this)?ms:If;t(this,e)}));Lf.deleteIndex=iu((function(e,t){if(typeof e!=="object"){return t(new Error("you must provide an index to delete"))}var r=hu(this)?bs:Bf;r(this,e,t)}));lr.plugin(Lf);var Tf=function(){function e(){}e.prototype.getDb=function(e){var t=new lr(e,{auto_compaction:true});return t};e.prototype.upsertDoc=function(e){var t=this;return new Promise((function(r,n){if(!e||!("type"in e)||!e.type){var i="ZeaWcDataConnector: Data must have a type property";console.error(i);r(i)}var o=t.getDb(e.type);var a=function(){o.put(e).then((function(e){r(e)})).catch((function(e){n(e)}))};if(e._id){o.get(e._id).then((function(t){e=Object.assign(Object.assign({},t),e);a()})).catch((function(){a()}))}else{e._id=e.type+"|"+(new Date).getTime();a()}}))};e.prototype.getDoc=function(e){var t=this;return new Promise((function(r){if(!e){var n="ZeaWcDataConnector: Id must be provided";console.error(n);r(n)}var i=e.split("|",0);var o=t.getDb(i);o.get(e).then((function(e){r(e)})).catch((function(e){console.error(e);r(e)}))}))};e.prototype.deleteDoc=function(e){var t=this;return new Promise((function(r,n){if(!e){var i="ZeaWcDataConnector: Id to delete must be provided";console.error(i);r(i)}var o=e.split("|")[0];var a=t.getDb(o);a.get(e).then((function(e){e._deleted=true;t.upsertDoc(e).then((function(){r(e)})).catch((function(e){console.error(e);n(e)}))})).catch((function(e){console.error(e);n(e)}))}))};e.prototype.getDocs=function(e){var t=this;return new Promise((function(r,n){var i={limit:10,skip:0};e=Object.assign(Object.assign({},i),e);if(!e.type){var o="ZeaWcDataConnector: Type must be provided";console.error(o);r(o)}var a=t.getDb(e.type);var u={};a.find({selector:u,limit:e.limit,skip:e.skip}).then((function(e){r(e)})).catch((function(e){n(e)}))}))};e.prototype.destroyDb=function(e){var t=this;return new Promise((function(r,n){t.getDb(e).destroy().then((function(){r()})).catch((function(e){n(e)}))}))};return e}();e("Z",Tf)}}}));